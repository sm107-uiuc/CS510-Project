{"url": "https://gab41.lab41.org/taking-keras-to-the-zoo-9a76243152cb", "time": 1682988329.046868, "path": "gab41.lab41.org/taking-keras-to-the-zoo-9a76243152cb/", "webpage": {"metadata": {"title": "Taking Keras to the Zoo. If you follow any of the popular blogs\u2026 | by Karl N. | Gab41", "h1": "Taking Keras to the Zoo", "description": "If you follow any of the popular blogs like Google\u2019s research, FastML, Smola\u2019s Adventures in Data Land, or one of the indie-pop ones like Edwin Chen\u2019s blog, you\u2019ve probably also used ModelZoo\u2026"}, "outgoing_paragraph_urls": [{"url": "http://googleresearch.blogspot.com/", "anchor_text": "Google\u2019s research", "paragraph_index": 0}, {"url": "http://fastml.com/", "anchor_text": "FastML", "paragraph_index": 0}, {"url": "http://blog.smola.org/", "anchor_text": "Adventures in Data Land", "paragraph_index": 0}, {"url": "http://blog.echen.me/", "anchor_text": "Edwin Chen\u2019s blog", "paragraph_index": 0}, {"url": "http://tensorflow.org/", "anchor_text": "TensorFlow", "paragraph_index": 3}, {"url": "http://neon.nervanasys.com/", "anchor_text": "Neon", "paragraph_index": 3}, {"url": "https://www.cs.toronto.edu/~hinton/absps/JMLRdropout.pdf", "anchor_text": "Hinton explains the reason", "paragraph_index": 7}, {"url": "http://caffe.berkeleyvision.org/gathered/examples/siamese.html", "anchor_text": "Siamese Networks", "paragraph_index": 7}, {"url": "https://github.com/Lab41/Misc/tree/master/blog/kerasvgg", "anchor_text": "Github", "paragraph_index": 18}], "all_paragraphs": ["If you follow any of the popular blogs like Google\u2019s research, FastML, Smola\u2019s Adventures in Data Land, or one of the indie-pop ones like Edwin Chen\u2019s blog, you\u2019ve probably also used ModelZoo. Actually, if you\u2019re like our boss, you affectionately call it \u201cThe Zoo\u201d. (Actually x 2, if you have interesting blogs that you read, feel free to let us know!)", "Unfortunately, ModelZoo is only supported in Caffe. Fortunately, we\u2019ve taken a look at the difference between the kernels in Keras, Theano, and Caffe for you, and after reading this blog, you\u2019ll be able to load models from ModelZoo into any of your favorite Python tools.", "Why this post? Why not just download our Github code?", "In short, it\u2019s better you figure out how these things work before you use them. That way, you\u2019re better armed to use the latest TensorFlow and Neon toolboxes if you\u2019re prototyping and transitioning your code to Caffe.", "So, there\u2019s Hinton\u2019s Dropout and then there\u2019s Caffe\u2019s Dropout\u2026and they\u2019re different. You might be wondering, \u201cWhat\u2019s the big deal?\u201d Well sir, I have a name of a guy for you, and it\u2019s Willy\u2026Mr. Willy Nilly. One thing Willy Nilly likes is the number 4096. Another thing he likes is to introduce regularization (which includes Dropout) arbitrarily, and Bayesian theorists aren\u2019t a fan. Those people try to fit their work into the probabilistic framework, and they\u2019re trying to hold onto what semblance of theoretical bounds exist for neural networks. However, for you as a practitioner, understanding who\u2019s doing what will save you hours of debugging code.", "We singled out Dropout because the way people have implemented it spans the gamut. There\u2019s actually some history as to this variation, but no one really cared, because optimizing for it has almost universally produced similar results. Much of the discussion stems from how the chain rule is implemented since randomly throwing stuff away is apparently not really a differentiable operation. Passing gradients back (i.e., backpropagation) is a fun thing to do; there\u2019s a \u201ctechnically right\u201d way to do it, and then there\u2019s what\u2019s works.", "Back to ModelZoo, where we\u2019d recommend you note the only sentence of any substance in this section, and the sentence is as follows. While Keras and perhaps other packages multiply the gradients by the retention probability at inference time, Caffe does not. That is to say, if you have a dropout level of 0.2, your retention probability is 0.8, and at inference time, Keras will scale the output of your prediction by 0.8. So, download the ModelZoo *.caffemodels, but know that deploying them on Caffe will produce non-scaled results, whereas Keras will.", "Hinton explains the reason why you need to scale, and the intuition is as follows. If you\u2019ve only got a portion of your signal seeping through to the next layer during training, you should scale the expectation of what the energy of your final result should be. Seems like a weird thing to care about, right? The argument that minimizes x is still the same as the argument that minimizes 2x. This turns out to be a problem when you\u2019re passing multiple gradients back and don\u2019t implement your layers uniformly. Caffe works in instances like Siamese Networks or Bilinear Networks, but should you scale your networks on two sides differently, don\u2019t be surprised if you\u2019re getting unexpected results.", "What does this look like in Francois\u2019s code? Look at the \u201cDropout\u201d code on Github, or in your installation folder under keras/layers/core.py. If you want to make your own layer for loading in the Dropout module, just comment out the part of the code that does this scaling:", "You can modify the original code, or you can create your own custom layer. (We\u2019ve opted to keep our installation of Keras clean and just implemented a new class that extended MaskedLayer.) BTW, you should be careful in your use of Dropout. Our experience with them is that they regularize okay, but could contribute to vanishing gradients really quickly.", "Everyday except for Sunday and some holidays, a select few machine learning professors and some signal processing leaders meet in an undisclosed location in the early hours of the morning. The topic of their discussion is almost universally, \u201cHow do we get researchers and deep learning practitioners to code bugs into their programs?\u201d One of the conclusions a while back was that the definition of convolution and dense matrix multiplication (or cross-correlation) should be exactly opposite of each other. That way, when people are building algorithms that call themselves \u201cConvolutional Neural Networks\u201d, no one will know which implementation is actually being used for the convolution portion itself.", "For those who don\u2019t know, convolutions and sweeping matrix multiplication across an array of data, differ in that convolutions will be flipped before being slid across the array. From Wikipedia, the definition is:", "On the other hand, if you\u2019re sweeping matrix multiplications across the array of data, you\u2019re essentially doing cross-correlation, which on Wikipedia, looks like:", "Like we said, the only difference is that darned minus/plus sign, which caused us some headache.", "We happen to know that Theano and Caffe follow different philosophies. Once again, Caffe doesn\u2019t bother with pleasantries and straight up codes efficient matrix multiplies. To load models from ModelZoo into either Keras and Theano will require the transformation because they strictly follow the definition of convolution. The easy fix is to flip it yourself when you\u2019re loading the weights into your model. For 2D convolution, this looks like:", "Here, the variable \u201cweights\u201d will be inserted into your model\u2019s parameters. You can set weights by indexing into the model. For example, say I want to set the 9th layer\u2019s weights. I would type:", "Incidentally, and this is important, when loading any *.caffemodel into Python, you may have to transpose it in order to use it. You can quickly find this out by loading it if you get an error, but we thought it worth noting.", "Alright, alright, we know what you\u2019re really here for; just getting the code and running with it. So, we\u2019ve got some example code that classifies using Keras and the VGG net from the web at our Git (see the link below). But, let\u2019s go through it just a bit. Here\u2019s a step by step account of what you need to do to use the VGG caffe model.", "And now you have the basics! Go ahead and take a look at our Github for some goodies. Let us know!", "Gab41 is Lab41's blog exploring data science, machine learning, and artificial intelligence. Geek out with us!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9a76243152cb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://gab41.lab41.org/?source=post_page-----9a76243152cb--------------------------------", "anchor_text": ""}, {"url": "https://gab41.lab41.org/?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Gab41"}, {"url": "https://medium.com/@karl1980.lab41?source=post_page-----9a76243152cb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@karl1980.lab41?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Karl N."}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc4e504f0bf5d&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&user=Karl+N.&userId=c4e504f0bf5d&source=post_page-c4e504f0bf5d----9a76243152cb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://googleresearch.blogspot.com/", "anchor_text": "Google\u2019s research"}, {"url": "http://fastml.com/", "anchor_text": "FastML"}, {"url": "http://blog.smola.org/", "anchor_text": "Adventures in Data Land"}, {"url": "http://blog.echen.me/", "anchor_text": "Edwin Chen\u2019s blog"}, {"url": "https://github.com/fchollet/keras", "anchor_text": "fchollet"}, {"url": "http://tensorflow.org/", "anchor_text": "TensorFlow"}, {"url": "http://neon.nervanasys.com/", "anchor_text": "Neon"}, {"url": "https://www.cs.toronto.edu/~hinton/absps/JMLRdropout.pdf", "anchor_text": "Hinton explains the reason"}, {"url": "http://caffe.berkeleyvision.org/gathered/examples/siamese.html", "anchor_text": "Siamese Networks"}, {"url": "https://gist.github.com/ksimonyan/211839e770f7b538e2d8#file-readme-md", "anchor_text": "ModelZoo"}, {"url": "http://www.robots.ox.ac.uk/~vgg/software/very_deep/caffe/VGG_ILSVRC_16_layers.caffemodel", "anchor_text": "here"}, {"url": "https://github.com/Lab41/Misc/tree/master/blog/kerasvgg", "anchor_text": "Github"}, {"url": "https://www.lab41.org/taking-keras-to-the-zoo/", "anchor_text": "www.lab41.org"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9a76243152cb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----9a76243152cb---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----9a76243152cb---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----9a76243152cb---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fgab41%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&user=Karl+N.&userId=c4e504f0bf5d&source=-----9a76243152cb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fgab41%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&user=Karl+N.&userId=c4e504f0bf5d&source=-----9a76243152cb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://gab41.lab41.org/?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "More from Gab41"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fgab41%2F9a76243152cb&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&collection=Gab41&collectionId=b9e75b66ab60&source=post_page-----9a76243152cb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://gab41.lab41.org/?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Read more from Gab41"}, {"url": "https://medium.com/?source=post_page-----9a76243152cb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9a76243152cb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9a76243152cb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9a76243152cb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9a76243152cb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@karl1980.lab41?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@karl1980.lab41?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Karl N."}, {"url": "https://medium.com/@karl1980.lab41/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "400 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc4e504f0bf5d&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&user=Karl+N.&userId=c4e504f0bf5d&source=post_page-c4e504f0bf5d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7316e37403d1&operation=register&redirect=https%3A%2F%2Fgab41.lab41.org%2Ftaking-keras-to-the-zoo-9a76243152cb&newsletterV3=c4e504f0bf5d&newsletterV3Id=7316e37403d1&user=Karl+N.&userId=c4e504f0bf5d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}