{"url": "https://chatbotslife.com/using-augmentation-to-mimic-human-driving-496b569760a9", "time": 1683019547.708108, "path": "chatbotslife.com/using-augmentation-to-mimic-human-driving-496b569760a9/", "webpage": {"metadata": {"title": "An augmentation based deep neural network approach to learn human driving behavior | by Vivek Yadav | Chatbots Life", "h1": "An augmentation based deep neural network approach to learn human driving behavior", "description": "In this post, we will go over the work I did for project 3 of Udacity\u2019s self-driving car project, behavior cloning for driving. The main task is to drive a car around in a simulator on a race track\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@vivek.yadav/deep-learning-machine-first-build-experience-d04abf198831#.3cuefuy6v", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html", "anchor_text": "https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html", "paragraph_index": 4}], "all_paragraphs": ["In this post, we will go over the work I did for project 3 of Udacity\u2019s self-driving car project, behavior cloning for driving. The main task is to drive a car around in a simulator on a race track, and then use deep learning to mimic the behavior of human. This is a very interesting problem because it is not possible to drive under all possible scenarios on the track, so the deep learning algorithm will have to learn general rules for driving. We must be very careful while using deep learning models, because they have a tendency to overfit the data. Overfitting refers to the condition where the model is very sensitive to the training data itself, and the model\u2019s behavior does not generalize to new/unseen data. One way to avoid overfitting is to collect a lot of data. A typical convolutional neural network can have up to a million parameters, and tuning these parameters requires millions of training instances of uncorrelated data, which may not always be possible and in some cases cost prohibitive. For our car example, this will require us to drive the car under different weather, lighting, traffic and road conditions. One way to avoid overfitting is to use augmentation.", "Augmentation refers to the process of generating new training data from a smaller data set such that the new data set represents the real world data one may see in practice. As we are generating thousands of new training instances from each image, it is not possible to generate and store all these data on the disk. We will therefore utilize keras generators to read data from the file, augment on the fly and use it to train the model. We will utilize images from the left and right cameras so we can generate additional training data to simulate recovery. Keras generator is set up such that in the initial phases of learning, the model drops data with lower steering angles with higher probability. This removes any potential for bias towards driving at zero angle. After setting up the image augmentation pipeline, we can proceed to train the model. The training was performed using simple adam learning algorithm with learning rate of 0.0001. After this training, the model was able to drive the car by itself on the first track for hours and generalized to the second track.", "All the training was based on driving data of about 4 laps using ps4 controller on track 1 in one direction alone. The model never saw track 2 in training, but with image augmentation (flipping, darkening, shifting, etc) and using data from all the cameras (left, right and center) the model was able to learn general rules of driving that helped translate this learning to a different track.", "IMPORTANT: These results were obtained on Titan X GPU machine I built earlier. Full specifications of the computer can be found here. Please note that computers with different performance will provide a different performance of the network.", "Augmentation helps us extract as much information from data as possible. We will generate additional data using the following data augmentation techniques. Augmentation is a technique of manipulating the incoming training data to generate more instances of training data. This technique has been used to develop powerful classifiers with little data. https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html . However, augmentation is very specific to the objective of the neural network.", "Changing brightness to simulate day and night conditions. We will generate images with different brightness by first converting images to HSV, scaling up or down the V channel and converting back to the RGB channel.", "Using left and right camera images", "Using left and right camera images to simulate the effect of car wandering off to the side, and recovering. We will add a small angle .25 to the left camera and subtract a small angle of 0.25 from the right camera. The main idea being the left camera has to move right to get to center, and right camera has to move left.", "We will shift the camera images horizontally to simulate the effect of car being at different positions on the road, and add an offset corresponding to the shift to the steering angle. We added 0.004 steering angle units per pixel shift to the right, and subtracted 0.004 steering angle units per pixel shift to the left. We will also shift the images vertically by a random number to simulate the effect of driving up or down the slope.", "The next augmentation we will add is shadow augmentation where random shadows are cast across the image. This is implemented by choosing random points and shading all points on one side (chosen randomly) of the image. The code for this augmentation is presented below.", "In addition to the transformations above, we will also flip images at random and change the sign of the predicted angle to simulate driving in the opposite direction.", "After augmenting the image as above, we will crop the top 1/5 of the image to remove the horizon and the bottom 25 pixels to remove the car\u2019s hood. Originally 1/3 of the top of car image was removed, but later it was changed to 1/5 to include images for cases when the car may be driving up or down a slope. We will next rescale the image to a 64X64 square image. After augmentation, the augmented images looks as follows. These images are generated using kera\u2019s generator, and unlimited number of images can be generated from one image. I used Lambda layer in keras to normalize intensities between -.5 and .5.", "As there was limited data and we are generating thousands of training examples from the same image, it is not possible to store all the images apriori into memory. We will utilize kera\u2019s generator function to sample images such that images with lower angles have lower probability of getting represented in the data set. This alleviates any problems we may ecounter due to model having a bias towards driving straight. Panel below shows multiple training samples generated from one image. The keras generator is presented below. The \u2018pr_threshold\u2019 variable is a threshold that determines if a data with small angle will be dropped or not.", "I implemented the model architecture above for training the data. The first layer is 3 1X1 filters, this has the effect of transforming the color space of the images. Research has shown that different color spaces are better suited for different applications. As we do not know the best color space apriori, using 3 1X1 filters allows the model to choose its best color space. This is followed by 3 convolutional blocks each comprised of 32, 64 and 128 filters of size 3X3. These convolution layers were followed by 3 fully connected layers. All the convolution blocks and the 2 following fully connected layers had exponential relu (ELU) as activation function. I chose leaky relu to make transition between angles smoother.", "I trained the model using the keras generator with batch size of 256 for 8 epochs. In each epoch, I generated 20000 images. I started with pr_threshold, the chance of dropping data with small angles as 1, and reduced the probability by dividing it by the iteration number after each epoch. The entire training took about 5 minutes. However, it too more than 20 hours to arrive at the right architecture and training parameters. Snippet below presents the result of training.", "Video below shows the performance of algorithm on the track 1 on which the original data was collected. The car is able to drive around for hours, we will next look into the case where either the camera resolution, video size or tracks are changed.", "Generalization from one image size to another", "Video below presents generalization from one image size to another. I used the same pretrained model and tested it on all the other image sizes and found that the deep learning neural network was able to drive the car around for all image sizes.", "Generalization from one image resolution to another", "Video below presents generalization from one image resolution to another. I used the same pretrained model and tested it on all the other image resolutions and found that the deep learning neural network was able to drive the car around for all image resolutions.", "I also tested different combinations of image size and image resolutions, and on track 1 the deep learning algorithm was able to drive the car around for all combinations of image resolution and sizes.", "Generalization from one track to another", "Figure below presents generalization from one track to another. This was perhaps the toughest test for the deep learning algorithm. In the second track, there were more right turns and u-turns, it was darker, and the road had slopes. All of which were absent in the original track. However, all these effects were artificially included into the model via image augmentation.", "This project is far from over. This project opened more questions than it answered. A few more things to try are,", "This was perhaps the weirdest project I did. This project challenged all the previous knowledge I had about deep learning. In general large epoch size and training with more data results in better performance, but in this case any time I got beyond 10 epochs, the car simply drove off the track. Although all the image augmentation and tweaks seem reasonable n0w, I did not think of them apriori. I hope others find this post useful, and get inspried to try novel things. I havent used on-the fly training agile trainer by John Chen yet. I wanted to try and stretch the data as much as possible. Next thing to try is to experiment with parallel network using John\u2019s trainer.", "I am very thankful to Udacity for selecting me for the first cohort, this allowed me to connect with many like-minded individuals. As always, learned a lot from discussions with Henrik T\u00fcnnermann and John Chen. I am also thankful for getting the NVIDA\u2019s GPU grant. Although, its for work, but I use it for Udacity too.", "Best place to learn about Conversational AI. We share the latest News, Info, AI & NLP, Tools, Tutorials & More.", "Staff Software Engineer at Lockheed Martin-Autonomous System with research interest in control, machine learning/AI. Lifelong learner with glassblowing problem."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F496b569760a9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://chatbotslife.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": ""}, {"url": "https://chatbotslife.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Chatbots Life"}, {"url": "https://vivek-yadav.medium.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": ""}, {"url": "https://vivek-yadav.medium.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Vivek Yadav"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb783495cc56b&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&user=Vivek+Yadav&userId=b783495cc56b&source=post_page-b783495cc56b----496b569760a9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.chatbotconference.com/", "anchor_text": ""}, {"url": "https://chatbotslife.com/finding-the-genre-of-a-song-with-deep-learning-da8f59a61194", "anchor_text": "Finding the genre of a song with Deep Learning \u2014 A.I. Odyssey part. 1A step-by-step guide to make your computer a music expert.chatbotslife.com"}, {"url": "https://medium.com/@vivek.yadav/deep-learning-machine-first-build-experience-d04abf198831#.3cuefuy6v", "anchor_text": "here"}, {"url": "https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html", "anchor_text": "https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html"}, {"url": "https://chatbotslife.com/machine-learning-for-dummies-part-1-dbaca076ec07", "anchor_text": "Machine Learning for Dummies: Part 1I often get asked on how to get started with Machine Learning. Most of the time, people have troubles understanding the\u2026chatbotslife.com"}, {"url": "https://docs.google.com/forms/d/e/1FAIpQLSeWqtQR0M5J8kRY9fs18qAu746nJJvFyfjc7I2r_El_nuvCBw/viewform?c=0&w=1", "anchor_text": ""}, {"url": "https://goo.gl/forms/5GyWOvyqdqxXbCA43", "anchor_text": ""}, {"url": "https://chatbotslife.com/how-to-get-a-free-chatbot-b1fb9dfe109#.z9dtp2sy0", "anchor_text": ""}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----496b569760a9---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----496b569760a9---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/udacity?source=post_page-----496b569760a9---------------udacity-----------------", "anchor_text": "Udacity"}, {"url": "https://medium.com/tag/self-driving-cars?source=post_page-----496b569760a9---------------self_driving_cars-----------------", "anchor_text": "Self Driving Cars"}, {"url": "https://medium.com/tag/ai?source=post_page-----496b569760a9---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fa-chatbots-life%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&user=Vivek+Yadav&userId=b783495cc56b&source=-----496b569760a9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fa-chatbots-life%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&user=Vivek+Yadav&userId=b783495cc56b&source=-----496b569760a9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://chatbotslife.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": "More from Chatbots Life"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fa-chatbots-life%2F496b569760a9&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&collection=Chatbots+Life&collectionId=a49517e4c30b&source=post_page-----496b569760a9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://chatbotslife.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Read more from Chatbots Life"}, {"url": "https://medium.com/?source=post_page-----496b569760a9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----496b569760a9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----496b569760a9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----496b569760a9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----496b569760a9--------------------------------", "anchor_text": ""}, {"url": "https://vivek-yadav.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://vivek-yadav.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Vivek Yadav"}, {"url": "https://vivek-yadav.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.5K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb783495cc56b&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&user=Vivek+Yadav&userId=b783495cc56b&source=post_page-b783495cc56b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdd1d1075c9b3&operation=register&redirect=https%3A%2F%2Fchatbotslife.com%2Fusing-augmentation-to-mimic-human-driving-496b569760a9&newsletterV3=b783495cc56b&newsletterV3Id=dd1d1075c9b3&user=Vivek+Yadav&userId=b783495cc56b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}