{"url": "https://towardsdatascience.com/create-a-model-with-azure-custom-vision-and-python-7bc5caed82c4", "time": 1683002525.859516, "path": "towardsdatascience.com/create-a-model-with-azure-custom-vision-and-python-7bc5caed82c4/", "webpage": {"metadata": {"title": "Create a model with Azure Custom Vision and Python | by Henk Boelman | Towards Data Science", "h1": "Create a model with Azure Custom Vision and Python", "description": "The answer to that is simple, if you build the training process in code you can version it for instance on Github. Having your code versioned means you can read back what you have done, work ina team\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.python.org/downloads/", "anchor_text": "Python 3.6", "paragraph_index": 1}, {"url": "https://azure.microsoft.com/free/?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure subscription", "paragraph_index": 2}, {"url": "https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure CLI", "paragraph_index": 3}, {"url": "https://pypi.org/project/azure-cli/?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure cli", "paragraph_index": 3}, {"url": "https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Custom Vision Service Python SDK", "paragraph_index": 10}, {"url": "https://www.bing.com/images/search?q=marge+simpson+lego", "anchor_text": "Marge", "paragraph_index": 41}, {"url": "https://www.bing.com/images/search?q=homer+simpson+lego", "anchor_text": "Homer", "paragraph_index": 41}], "all_paragraphs": ["The answer to that is simple, if you build the training process in code you can version it for instance on Github. Having your code versioned means you can read back what you have done, work ina team on it and run it again if you need to.", "Let\u2019s dive into the code! Before we start, I assume you have Python 3.6 installed.", "The first thing you need to do is create an Azure Custom Vision service. If you don\u2019t have an Azure subscription you can get $200 credit for the first month.", "You can create an Azure Custom Vision endpoint easily through the portal, but you can also use the Azure CLI for this. If you don\u2019 t have the Azure cli installed you can install it using pip.", "The first step is to login to your Azure subscription, select the right subscription and create a resource group for the Custom Vision Endpoints.", "The Custom Vision Service has 2 types of endpoints. One for training the model and one for running predictions against the model.", "Now that we have created the endpoints we can start with training the model.", "Every Machine Learning journey starts with a question you want to have answered. For this example, you are going to answer the question: Is it a Homer or a Marge Lego figure.", "Now that we know what to ask the model, we can go on to the next requirement; that is data. Our model is going to be a classification model, meaning the model will look at the picture and scores the pictures against the different classes. So, the output will be I\u2019m 70% confident this is Homer and 1% confident that this is Marge. By taking the class with the highest score and setting a minimum threshold for the confidence score we know what is on the picture.", "I have created a dataset for you with 50 pictures of a Homer Simpson Lego figure and 50 pictures of a Marge Simpsons Lego figure. I have taken the photos with a few things in mind, used a lot of different backgrounds and took the photos from different angles. I made sure the only object in the photo was Homer or Marge and the quality of the photos was somehow the consistent.", "For the training we are going the use the Custom Vision Service Python SDK, you can install this package using pip.", "Create a new Python file called \u2018train.py\u2019 and start adding code.", "Start with importing the packages needed.", "Next, create variables for the Custom Vision endpoint, Custom Vision training key and the location where the training images are stored.", "To start with the training, we need to create a Training Client. This method takes as input the endpoint and the training key.", "Now you are ready to create your first project. The project takes a name and domain as input, the name can be anything. The domain is a different story. You can ask for a list of all possible domains and choose the one closest to what you are trying to accomplish. For instance if you are trying to classify food you pick the domain \u201cFood\u201d or \u201cLandmarks\u201d for landmarks. Use the code below to show all domains.", "You might notice that some domains have the word \u201cCompact\u201d next to them. If this is the case it means the Azure Custom Vision Service will create a smaller model, which you will be able to export and run locally on your mobile phone or desktop.", "Let\u2019s create a new project with the domain set to \u201cGeneral Compact\u201d.", "Next you need to create tags, these tags are the same as classes mentioned above. When you have created a few tags we can tag images with them and upload the images to the Azure Custom Vision Service.", "Our images are sorted per tag/class in a folder. All the photos of Marge are in the folder named \u2018Marge\u2019 and all the images of Homer are in the folder named \u2018Homer\u2019.", "In the code below we do the following steps:", "Now you have a list that contains all tagged images. So far no images have been added to the Azure Custom Vision service, only the tags have been created.", "Uploading images goes in batches with a max size of 64 images per batch. Our dataset is 100 images big, so first we need to split the list into chunks of 64 images.", "Now we have our images split in batches of 64, we can upload them batch by batch to the Azure Custom Vision Service. Note: This can take a while!", "Now you have reached the final step, we can publish the model. Its then available in a prediction API and ready to be consumed from an application.", "Every time you train your model its called an iteration. Often you have to retrain your model when you have new data or when you find out that in the real world your model is behaving different than expected.", "The concept of the Custom Vision Service is that you can publish an iteration of your model under a specific name. This means that you can have multiple versions of your model available for your application to use, for instance you can a-b test your model very quickly with this.", "To publish an iteration of your model you call the publish_iteration method, this method requires a few parameters.", "Project ID and Iteration ID, these are values from the previous steps. You can choose a name for publication of your model, for instance \u2018latest\u2019 or \u2018version1 . The last parameter you need is the \u2018resource identifier\u2019 of the resource where you want to publish it to. This is the resource identifier of the Azure Custom Vision Prediction resource we created at the beginning with our AZ command.", "You can use this command to retrieve all the details about the Prediction resource you created:", "You can copy the value that is behind the field ID, it looks like this:", "When you have the resource ID, paste it in the variable below and call the \u2018publish_iteration\u2019 method.", "Now you have successfully trained and published your model!", "A small recap of what have we done:", "Using the model in an application is as easy as calling an API. You could do just a json post to the endpoint, but you can also use the methods in the Custom Vision Python SDK, which will make things a lot easier.", "Create a new file called \u2018predict.py\u2019", "Start with importing the dependencies you need to do a prediction.", "The next thing you need is the prediction key. This is the key from the resource where you have published the model to. You can use this az command to list the keys.", "When you have your prediction key you can create a prediction client. For this client you also need the endpoint. You can run the az command below and copy the url behind the field \u201cendpoint\u201d.", "Now you have the prediction key and the endpoint you can create the PredictionClient.", "You have multiple options to classify an image. You can send a URL or you can send the binary image to the endpoint. By default the Azure Custom Vision service keeps a history of all the images posted to the endpoint. The images and their predictions can be reviewed in the portal and used to retrain your model. But sometimes you don\u2019t want the images to be kept in history and therefore it is possible to disable this feature.", "I have uploaded 2 images you can use for testing, but feel free to use a search engine to find other images of Marge and Homer.", "To classify an image using a URL and keep the history you call the \u2018classify_image_url\u2019 method. You give it the project id and iteration name from a few steps above and provide the URL to the image.", "To show the score for the different classes on the screen you can use the code below to loop through the results and display the tag name and confidence score for the image.", "Now you are all done and have your own classification model running in the cloud! Here is a recap of what you have achieved:", "In the rest of this series of articles we will use this model for different solutions! Stay tuned!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Cloud Advocate \ud83e\udd51 at @azureadvocates | #Microsoft | Former #AI MVP | #Umbraco MVP | #AzureThursday, #GlobalAIBootcamp #GlobalAINight"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7bc5caed82c4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@hnky?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hnky?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Henk Boelman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F396f3f02cec9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&user=Henk+Boelman&userId=396f3f02cec9&source=post_page-396f3f02cec9----7bc5caed82c4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service/?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure Custom Vision"}, {"url": "https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Python SDK"}, {"url": "https://www.python.org/downloads/", "anchor_text": "Python 3.6"}, {"url": "https://azure.microsoft.com/free/?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure subscription"}, {"url": "https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure CLI"}, {"url": "https://pypi.org/project/azure-cli/?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Azure cli"}, {"url": "https://www.henkboelman.com/media/45lkxosc/ai4dev01-dataset.zip", "anchor_text": "Download the dataset here"}, {"url": "https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Custom Vision Service Python SDK"}, {"url": "https://github.com/hnky/AI4DEV01-CustomVision/blob/master/train.py", "anchor_text": "View the full code here"}, {"url": "https://www.bing.com/images/search?q=marge+simpson+lego", "anchor_text": "Marge"}, {"url": "https://www.bing.com/images/search?q=homer+simpson+lego", "anchor_text": "Homer"}, {"url": "https://github.com/hnky/AI4DEV01-CustomVision/blob/master/predict.py", "anchor_text": "View the full code here"}, {"url": "https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "How to install the Azure CLI"}, {"url": "https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account-cli?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Creating cognitive services through the CLI"}, {"url": "https://docs.microsoft.com/en-us/python/api/overview/azure/cognitiveservices/customvision?view=azure-python&WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Python SDK"}, {"url": "https://docs.microsoft.com/en-us/azure/cognitive-services/custom-vision-service?WT.mc_id=AI4DEV01-blog-heboelma", "anchor_text": "Custom Vision Documentation"}, {"url": "https://medium.com/tag/python?source=post_page-----7bc5caed82c4---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/azure?source=post_page-----7bc5caed82c4---------------azure-----------------", "anchor_text": "Azure"}, {"url": "https://medium.com/tag/custom-vision?source=post_page-----7bc5caed82c4---------------custom_vision-----------------", "anchor_text": "Custom Vision"}, {"url": "https://medium.com/tag/ai?source=post_page-----7bc5caed82c4---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----7bc5caed82c4---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&user=Henk+Boelman&userId=396f3f02cec9&source=-----7bc5caed82c4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&user=Henk+Boelman&userId=396f3f02cec9&source=-----7bc5caed82c4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7bc5caed82c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7bc5caed82c4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7bc5caed82c4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hnky?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hnky?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Henk Boelman"}, {"url": "https://medium.com/@hnky/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "45 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F396f3f02cec9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&user=Henk+Boelman&userId=396f3f02cec9&source=post_page-396f3f02cec9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F396f3f02cec9%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-model-with-azure-custom-vision-and-python-7bc5caed82c4&user=Henk+Boelman&userId=396f3f02cec9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}