{"url": "https://towardsdatascience.com/data-modeling-for-a-music-streaming-app-db46a4595e4e", "time": 1682992971.966031, "path": "towardsdatascience.com/data-modeling-for-a-music-streaming-app-db46a4595e4e/", "webpage": {"metadata": {"title": "Data Modeling for a Music Streaming App | by Joshua Yeung | Towards Data Science", "h1": "Data Modeling for a Music Streaming App", "description": "I have joined Udacity Data Engineer Nanodegree. The program consists of many real-world projects. In the project, I have the role of a Data Engineer at a fabricated data streaming company called\u2026"}, "outgoing_paragraph_urls": [{"url": "https://labrosa.ee.columbia.edu/millionsong/", "anchor_text": "Million Song Dataset", "paragraph_index": 3}, {"url": "https://github.com/Interana/eventsim", "anchor_text": "event simulator", "paragraph_index": 5}, {"url": "https://www.youtube.com/watch?v=iiADhChRriM", "anchor_text": "here is a helpful video", "paragraph_index": 9}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App", "anchor_text": "GitHub repository", "paragraph_index": 37}, {"url": "https://medium.com/@joshua.chyeung/membership", "anchor_text": "https://medium.com/@joshua.chyeung/membership", "paragraph_index": 39}], "all_paragraphs": ["I have joined Udacity Data Engineer Nanodegree. The program consists of many real-world projects. In the project, I have the role of a Data Engineer at a fabricated data streaming company called \u201cSparkify\u201d. It is a startup and wants to analyze the data they\u2019ve been collecting on songs and user activity on their new music streaming app. The analytics team is particularly interested in understanding what songs users are listening to. Currently, they don\u2019t have an easy way to query their data, which resides in a directory of JSON logs on user activity on the app, as well as a directory with JSON metadata on the songs in their app.", "They\u2019d like a data engineer to create a Postgres database with tables designed to optimize queries on song play analysis and bring me on the project. My role is to create a database schema and ETL pipeline for this analysis. I\u2019ve tested my database and ETL pipeline by running queries given to me by the analytics team from Sparkify and compare my results with their expected results.", "In this project, I\u2019ve applied what I\u2019ve learned on data modeling with Postgres and build an ETL pipeline using Python. I\u2019ve defined fact and dimension tables for a star schema for a particular analytic focus and written an ETL pipeline that transfers data from files in two local directories into these tables in Postgres using Python and SQL.", "The first dataset is a subset of real data from the Million Song Dataset. Each file is in JSON format and contains metadata about a song and the artist of that song. The files are partitioned by the first three letters of each song\u2019s track ID. For example, here are file paths to two files in this dataset.", "And below is an example of what a single song file, TRAABJL12903CDCF1A.json, looks like.", "The second dataset consists of log files in JSON format generated by this event simulator based on the songs in the dataset above. These simulate activity logs from a music streaming app based on specified configurations.", "The log files in the dataset you\u2019ll be working with are partitioned by year and month. For example, here are file paths to two files in this dataset.", "And below is an example of what the data in a log file, 2018\u201311\u201312-events.json, looks like.", "If you would like to look at the JSON data within log_data files, you will need to create a pandas DataFrame to read the data. Remember to first import JSON and pandas libraries.", "In case you need a refresher on JSON file formats, here is a helpful video.", "Using the song and log datasets, I\u2019ve created a star schema optimized for queries on song play analysis. This includes the following tables.", "songplays \u2014 records in log data associated with song plays i.e. records with page NextSongsongplay_id, start_time, user_id, level, song_id, artist_id, session_id, location, user_agent", "users \u2014 users in the appuser_id, first_name, last_name, gender, level", "songs \u2014 songs in the music databasesong_id, title, artist_id, year, duration", "artists \u2014 artists in the music databaseartist_id, name, location, latitude, longitude", "time \u2014 timestamps of records in songplays broken down into the specific unitstart_time, hour, day, week, month, year, weekday", "The conditions like Primary key and NOT NULL in columns are important while dealing with relational database systems. Again, as a data engineer, it's a must to specify primary key columns and not null depending on the business requirements. For instance, user_id and start_time should be considered as not null.", "In addition to the data files, the project workspace includes six files:", "To create all the tables I needed, I have done the following four steps:", "Inside create_tables.py, there is a function create_tables to execute all the queries listed in create_table_queries list.", "You can see the tables have been created with the columns defined from test.ipynb.", "It\u2019s time to develop ETL processes for each table. In etl.py, there is a function called process_data. You can pass the file path and the process function you need to process your data. It gets all files matching extension (.json) from the directory. And then it iterates over files and processes using your function passed into.", "First, let us handle song_data and create the songs and artists dimensional tables. I\u2019ve builtprocess_song_file function to perform the following tasks:", "To extract data for Songs table, the following tasks are done:", "Write the song_table_insert query in sql_queries.py and insert a record for this song into the songs table.", "Data Extraction for Artists table is similar to that for Songs table, but this time I selected columns artist ID, name, location, latitude, and longitude.", "Second, I\u2019ve performed ETL on the second dataset, log_data, to create the time and users dimensional tables, as well as the songplays fact table.", "I\u2019ve filtered records by NextSong action", "and converted the ts timestamp column to DateTime.", "Note: the current timestamp is in milliseconds", "I used pandas\u2019 dt attribute to access easily datetime-like properties such as hour, day, week of year, month, year, and weekday from the ts column and set time_data to a list containing these values in order. I\u2019ve also specified labels for these columns and set to column_labels. I created a DataFrame, time_df, containing the time data for this file by combining column_labels and time_data into a dictionary and converting this into a DataFrame. Finally, I inserted records for the timestamps in the log files into the time table.", "Data extraction for users table is easy, just select columns for user ID, first name, last name, gender, and level and set to user_df and insert records for the users in this log file into the users table.", "INSERT statements needs to be modified for each table to handle existing records where appropriate. As a data engineer, I need to give careful thought to how the tables will handle existing records when new data are being inserted into the tables.", "For instance, use on conflict update for the user table since the level can change from free to paid.", "This one is a little more complicated since the information from the songs table, artists table and original log file are all needed for the songplays table. Since the log file does not specify an ID for either the song or the artist, I needed to get the song ID and artist ID by querying the songs and artists tables to find matches based on the song title, artist name, and the song\u2019s duration time.", "Since this is a subset of the much larger dataset, the solution dataset will only have 1 row with values containing ID for both songid and artistid in the fact table. Those are the only 2 values that the query in the sql_queries.py will return that is not-NONE. The rest of the rows will have NONE values for those two variables.", "That\u2019s it. I\u2019ve created a Postgres database with tables designed to optimize queries on song play analysis. The analytics team has now an easy to query their data and analyze understanding what songs users are listening to.", "For more details, you can visit my GitHub repository.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Engineer building highly available and scalable applications | Become a Medium Member by Clicking here: https://medium.com/@joshua.chyeung/membership"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdb46a4595e4e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@joshua.chyeung?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joshua.chyeung?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Joshua Yeung"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3162e66330d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&user=Joshua+Yeung&userId=3162e66330d1&source=post_page-3162e66330d1----db46a4595e4e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@pankajpatel?utm_source=medium&utm_medium=referral", "anchor_text": "Pankaj Patel"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://labrosa.ee.columbia.edu/millionsong/", "anchor_text": "Million Song Dataset"}, {"url": "https://github.com/Interana/eventsim", "anchor_text": "event simulator"}, {"url": "https://www.youtube.com/watch?v=iiADhChRriM", "anchor_text": "here is a helpful video"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/test.ipynb", "anchor_text": "test.ipynb"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/create_tables.py", "anchor_text": "create_tables.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/etl.ipynb", "anchor_text": "etl.ipynb"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/etl.py", "anchor_text": "etl.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/sql_queries.py", "anchor_text": "sql_queries.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/sql_queries.py", "anchor_text": "sql_queries.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/sql_queries.py", "anchor_text": "sql_queries.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/create_tables.py", "anchor_text": "create_tables.py"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App/blob/master/test.ipynb", "anchor_text": "test.ipynb"}, {"url": "https://github.com/joshuayeung/Data-Modeling-for-a-Music-Streaming-App", "anchor_text": "GitHub repository"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----db46a4595e4e---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/programming?source=post_page-----db46a4595e4e---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/udacity?source=post_page-----db46a4595e4e---------------udacity-----------------", "anchor_text": "Udacity"}, {"url": "https://medium.com/tag/postgres?source=post_page-----db46a4595e4e---------------postgres-----------------", "anchor_text": "Postgres"}, {"url": "https://medium.com/tag/data-science?source=post_page-----db46a4595e4e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&user=Joshua+Yeung&userId=3162e66330d1&source=-----db46a4595e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&user=Joshua+Yeung&userId=3162e66330d1&source=-----db46a4595e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdb46a4595e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----db46a4595e4e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----db46a4595e4e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----db46a4595e4e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----db46a4595e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joshua.chyeung?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joshua.chyeung?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Joshua Yeung"}, {"url": "https://medium.com/@joshua.chyeung/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "324 Followers"}, {"url": "https://medium.com/@joshua.chyeung/membership", "anchor_text": "https://medium.com/@joshua.chyeung/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3162e66330d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&user=Joshua+Yeung&userId=3162e66330d1&source=post_page-3162e66330d1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6a9abcf4141e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-modeling-for-a-music-streaming-app-db46a4595e4e&newsletterV3=3162e66330d1&newsletterV3Id=6a9abcf4141e&user=Joshua+Yeung&userId=3162e66330d1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}