{"url": "https://towardsdatascience.com/deep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed", "time": 1682996804.998852, "path": "towardsdatascience.com/deep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed/", "webpage": {"metadata": {"title": "Deep Dive into Catboost Functionalities for Model Interpretation | by Alvira Swalin | Towards Data Science", "h1": "Deep Dive into Catboost Functionalities for Model Interpretation", "description": "In my previous blog, we saw a comparative study of XGBoost, LightGBM & Catboost. With that analysis, we were able to conclude that catboost outperformed the other two in terms of both speed and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db", "anchor_text": "previous blog", "paragraph_index": 0}, {"url": "https://catboost.ai/", "anchor_text": "catboost", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Yandex", "anchor_text": "Yandex", "paragraph_index": 1}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP", "paragraph_index": 10}, {"url": "https://www.kaggle.com/dansbecker/shap-values", "anchor_text": "kernel", "paragraph_index": 13}, {"url": "https://christophm.github.io/interpretable-ml-book/feature-importance.html", "anchor_text": "Permutation based feature importance", "paragraph_index": 14}, {"url": "http://This mode is an implementation of the approach described in the Finding Influential Training Samples for Gradient Boosted Decision Trees paper", "anchor_text": "this paper", "paragraph_index": 22}, {"url": "https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db", "anchor_text": "CatBoost vs. Light GBM vs. XGBoost", "paragraph_index": 28}, {"url": "http://www.linkedin.com/in/alvira-swalin", "anchor_text": "LinkedIn", "paragraph_index": 29}, {"url": "https://medium.com/@aswalin", "anchor_text": "here", "paragraph_index": 29}, {"url": "http://www.linkedin.com/in/alvira-swalin", "anchor_text": "www.linkedin.com/in/alvira-swalin", "paragraph_index": 31}], "all_paragraphs": ["In my previous blog, we saw a comparative study of XGBoost, LightGBM & Catboost. With that analysis, we were able to conclude that catboost outperformed the other two in terms of both speed and accuracy. In this part, we will dig further into the catboost, exploring the new features that catboost provides for efficient modeling and understanding the hyperparameters.", "For new readers, catboost is an open-source gradient boosting algorithm developed by Yandex team in 2017. It is a machine learning algorithm which allows users to quickly handle categorical features for a large data set and this differentiates it from XGBoost & LightGBM. Catboost can be used to solve regression, classification and ranking problems.", "As Data Scientists, we can easily train models and make predictions, but, we often fail to understand what\u2019s happening inside those fancy algorithms. This is one of the reasons why we see a huge difference in model performance between offline evaluation and final production. It is high time we stop treating ML as a \u201cblack box\u201d and give importance to model interpretation while improving model accuracy. This will also help us in identifying data biases. In this part, we will see how catboost helps us to analyze models and improve visibility with the following functionalities:", "Why should you know it?- Remove unnecessary features to simplify the model and reduce training/prediction time- Get the most influential feature for your target value and manipulate them for business gains (eg: healthcare providers want to identify what factors are driving each patient\u2019s risk of some disease so they can directly address those risk factors with targeted medicines)", "Apart from choosing the type of feature importance, we should also know which data we want to use for finding feature importance \u2014 train or test or complete dataset. There are pros and cons of choosing one over the other but in the end, you need to decide whether you want to know how much the model relies on each feature for making predictions (use training data) or how much the feature contributes to the performance of the model on unseen data (use test data). We will see later in this blog that only some methods can be used to find feature importance on data not used for training model.", "If you care for the second and assuming you have all the time and resources, the crudest and most reliable way to find feature importance is to train multiple models leaving one feature at a time and compare the performance on the test set. If the performance changes a lot with respect to the baseline (performance when we use all the features) that means that the feature was important. But since we live in a practical world where we need to optimize both accuracy and computation time, this method is unnecessary. Here are a few smart ways in which catboost lets you find the best feature for your model:", "For each feature, PredictionValuesChange shows how much on average the prediction changes if the feature value changes. The bigger the value of the importance the bigger on average is the change to the prediction value if this feature is changed.", "Pros: It is cheap to compute as you don\u2019t have to do multiple training or testing and you will not be storing any extra information. You will get normalized values as the ouput (all the importances will add up to 100).Cons: It may give misleading results for ranking objectives, it might put groupwise features into the top, even though they have a little influence on the resulting loss value.", "To get this feature importance, catboost simply takes the difference between the metric (Loss function) obtained using the model in normal scenario (when we include the feature) and model without this feature (model is built approximately using the original model with this feature removed from all the trees in the ensemble). Higher the difference, the more important the feature is. It is not clearly mentioned in catboost docs how we find the model without feature.", "Pros & Cons: This works well for most type of problems unlike predictionvalueschange where you can get misleading results for ranking problems, at the same time, it is computationally heavy .", "SHAP value breaks a prediction value into contributions from each feature. It measures the impact of a feature on a single prediction value in comparison to the baseline prediction (mean of the target value for the training dataset).", "Two major use cases for shap values:", "2. Summary for the whole dataset (overall feature importance)", "Though we can get accurate feature importances through shap, they are computationally more expensive than catboost inbuilt feature importance. For more details on SHAP values, please read this kernel .", "BonusAnother feature importance based on the same concept but different implementation is\u2014 Permutation based feature importance. Though catboost does not use this, this is purely model-agnostic and easy to calculate.", "Though bothPredictionValuesChange & LossFunctionChange can be used for all types of metrics, it is recommended to use LossFunctionChangefor ranking metrics. Except for PredictionValuesChange , all other methods can use test data to find feature importance using models trained on train data.", "To understand the differences better, here are the results for all the methods we discussed:", "From the above plots, we can see that most of the methods are agreeing on top features. it looks like LossFunctionChange is closest to shap(which is more reliable). However, it is not fair to compare these methods directly because predictionvalueschange is based on train data whereas all others are based on test data.", "We should also see the time it takes to run all of them:", "With this parameter, you can find the strength of a pair of features (importance of two features together).", "In the output, you will get a list for each pair of features. The list will have 3 values, the first value is the index of the first feature in the pair, the second value is the index of the second feature in the pair and the third value is the feature importance score for that pair. For implementation details, please check the embedded notebook.", "It is interesting to note that the top two features in the single feature importance don\u2019t necessarily make the strongest pair.", "With this functionality, you can calculate the impact of each object on the optimized metric for test data. Positive values reflect that the optimized metric increases and negative values reflect that the optimized metric decreases. This method is an implementation of the approach described in this paper. Details of these algorithms are beyond the scope of this blog.", "There are three types of update_method available in cb.get_object_importance :", "For example, the following value sets the method to TopKLeaves and limits the number of leaves to 3:", "Catboost has recently launched this functionality in its latest update. With this feature, we will be able to visualize how the algorithm is splitting the data for each feature and look at feature-specific statistics. More specifically we will be able to see:", "This plot will give us information like how uniform our splitting is (we don\u2019t want all the objects to go in one bin), whether our predictions are close to target (blue and orange line), the red line will tell us how sensitive our predictions are wrt a feature.", "Thank you for reading this. Hopefully, next time you will be able to make use of these tools to understand your models better.", "After the positive reception from the machine learning community to my previous blog on CatBoost vs. Light GBM vs. XGBoost, the CatBoost team reached out to see if I was interested in covering more in-depth topics on the library. Thanks to the CatBoost team for helping answer my questions for this post!", "About Me: I am currently working as a Data Scientist in Maps team at Uber. If you are interested in solving challenging problems at Uber, please reach out to me at LinkedIn. You can read my other blogs here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist @Uber, MSDS @USF, IIT Bombay Alumnus, www.linkedin.com/in/alvira-swalin"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7cdef669aeed&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aswalin?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aswalin?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Alvira Swalin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F185ec3b29f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&user=Alvira+Swalin&userId=185ec3b29f78&source=post_page-185ec3b29f78----7cdef669aeed---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db", "anchor_text": "previous blog"}, {"url": "https://catboost.ai/", "anchor_text": "catboost"}, {"url": "https://en.wikipedia.org/wiki/Yandex", "anchor_text": "Yandex"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "https://github.com/slundberg/shap"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "https://github.com/slundberg/shap"}, {"url": "https://www.kaggle.com/dansbecker/shap-values", "anchor_text": "kernel"}, {"url": "https://christophm.github.io/interpretable-ml-book/feature-importance.html", "anchor_text": "Permutation based feature importance"}, {"url": "https://archive.ics.uci.edu/ml/datasets/adult", "anchor_text": "\u201cadult\u201d census dataset"}, {"url": "https://archive.ics.uci.edu/ml/datasets/adult", "anchor_text": "Dataset used in the notebook"}, {"url": "http://This mode is an implementation of the approach described in the Finding Influential Training Samples for Gradient Boosted Decision Trees paper", "anchor_text": "this paper"}, {"url": "https://github.com/catboost/tutorials/blob/master/model_analysis/object_importance_tutorial.ipynb", "anchor_text": "catboost/tutorialsCatBoost tutorials repository. Contribute to catboost/tutorials development by creating an account on GitHub.github.com"}, {"url": "https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db", "anchor_text": "CatBoost vs. Light GBM vs. XGBoost"}, {"url": "http://www.linkedin.com/in/alvira-swalin", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/@aswalin", "anchor_text": "here"}, {"url": "https://tech.yandex.com/catboost/doc/dg/concepts/about-docpage/", "anchor_text": "Catboost Documentation"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP Values"}, {"url": "https://catboost.ai/", "anchor_text": "Catboost official website"}, {"url": "https://arxiv.org/abs/1706.09516", "anchor_text": "CatBoost Paper"}, {"url": "https://gist.github.com/aswalin/595ac73f91c6268f9ca449a4ee05dee1", "anchor_text": "Notebook"}, {"url": "https://arxiv.org/pdf/1802.06640.pdf", "anchor_text": "Paper on Finding Influential Training Samples"}, {"url": "https://github.com/catboost/tutorials/tree/master/model_analysis", "anchor_text": "Catboost Tutorials"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7cdef669aeed---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/catboost?source=post_page-----7cdef669aeed---------------catboost-----------------", "anchor_text": "Catboost"}, {"url": "https://medium.com/tag/feature-importance?source=post_page-----7cdef669aeed---------------feature_importance-----------------", "anchor_text": "Feature Importance"}, {"url": "https://medium.com/tag/analysis?source=post_page-----7cdef669aeed---------------analysis-----------------", "anchor_text": "Analysis"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----7cdef669aeed---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&user=Alvira+Swalin&userId=185ec3b29f78&source=-----7cdef669aeed---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&user=Alvira+Swalin&userId=185ec3b29f78&source=-----7cdef669aeed---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7cdef669aeed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7cdef669aeed---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7cdef669aeed--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7cdef669aeed--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7cdef669aeed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aswalin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aswalin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alvira Swalin"}, {"url": "https://medium.com/@aswalin/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4.5K Followers"}, {"url": "http://www.linkedin.com/in/alvira-swalin", "anchor_text": "www.linkedin.com/in/alvira-swalin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F185ec3b29f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&user=Alvira+Swalin&userId=185ec3b29f78&source=post_page-185ec3b29f78--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F86e2ac872216&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-dive-into-catboost-functionalities-for-model-interpretation-7cdef669aeed&newsletterV3=185ec3b29f78&newsletterV3Id=86e2ac872216&user=Alvira+Swalin&userId=185ec3b29f78&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}