{"url": "https://towardsdatascience.com/how-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7", "time": 1683009983.272094, "path": "towardsdatascience.com/how-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7/", "webpage": {"metadata": {"title": "How data prep packages can introduce risk to your ML modeling | by Alex Shoop | Towards Data Science", "h1": "How data prep packages can introduce risk to your ML modeling", "description": "Real-world data is often \u201cdirty\u201d or \u201cmessy.\u201d Data scientists building machine learning (ML) models will frequently encounter data quality problems such as \u201cbad\u201d numeric values (e.g. None, NaN, or\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Real-world data is often \u201cdirty\u201d or \u201cmessy.\u201d Data scientists building machine learning (ML) models will frequently encounter data quality problems such as \u201cbad\u201d numeric values (e.g. None, NaN, or NA), missing values, and high-cardinality categorical features (e.g. ZIP code).", "Any data scientist with such a dirty and messy dataset wanting to leverage their arsenal of ML packages like scikit-learn or xgboost to build the most performant model would have to tediously clean the dataset and impute missing values to get it in the ideal format needed by those powerful packages.", "Fortunately, there are convenient data preparation (a.k.a. data prep) packages to automate and simplify the data cleansing and data quality handling. These packages provide nice APIs for a smooth UX for data science workflows. However, while certain packages seem to provide nice \u201cone-liner\u201d solutions to the problem of data prep, as the saying goes, there\u2019s no such thing as a free lunch. In certain edge cases of data prep, you may, in fact, be introducing new risks to your model, such as overfitting or target leakage (a.k.a. data leakage).", "The following is a brief case study on one such data prep package known as vtreat [1], created by Dr. John Mount and Dr. Nina Zumel from Win Vector LLC [2]. vtreat is available in R and Python in addition to having a research publication [3]. This article will focus on the Python package [4].", "As the authors describe, vtreat is a \u201cdataframe processor/conditioner that prepares real-world data for predictive modeling in a statistically sound manner.\u201d The high-level goal of vtreat is to \u201cfaithfully and reliably convert data into a ready-for-ML dataframe that is entirely numeric and without missing values.\u201d The specific data quality handling methods that vtreat includes are:", "The last method of \u201cimpact coding\u201d (Kagglers may know this as \u201ctarget coding\u201d) can be particularly helpful since it converts a categorical variable with many levels into an informative numeric feature. In short, it\u2019s calculated by first getting the global average value of the target variable (hence \u201ctarget coding\u201d) across all rows, then the value of the target for a given categorical variable is checked against this global average, thus resulting in a \u201cnumerical impact value\u201d for the categorical variable. This preserves a good amount of predictive information from the original variable while being computationally efficient. So let\u2019s walk through how to properly use \u201cimpact coding\u201d.", "A data scientist who is familiar with .fit() and .transform() methods from related ML packages may use vtreat in the following manner to create a prepared dataframe to then be used in modeling:", "Careful! This is a naive use of vtreat, since impact coding requires knowing what the outcome is in order to generate the \u201cimpact value\u201d. The resulting model fitted to this prepared dataframe could lead to undesirable model bias, basically where the model overfits to the impact coded variable.", "In order to circumvent this, as the authors of vtreat carefully described in their documentation, it\u2019s very important to set aside a partition of the full dataset (i.e. holdout/calibration set) to be used for impact coding, then run the \u201ccalibrated impact coder\u201d on the training partition to prepare data, followed by fitting a model to the resulting prepared dataframe. The following illustrates how to correctly use vtreat with holdout/calibration set:", "Furthermore, the authors have ensured correct cross-validation methods are used by leveraging a novel technique they call a \u201ccross-frame\u201d [5] (i.e. cross validated training frame). In the end, the authors recommend the following calling pattern by using the built-in guardrail method .fit_transform() when using vtreat to prepare data for ML modeling:", "The resulting dataframe is completely numeric, while preserving as much relevant modeling information from the training variables as possible. This allows a data scientist to use any off-the-shelf ML package and rapidly build potentially more accurate models than if using only the raw dataset.", "After all is said and done, vtreat helps save a lot of time and effort for data scientists by automatically preparing a structured numeric-only dataframe for modeling. Let\u2019s put this to the test on an example dataset where the target variable to predict is the sale price of a manufacturer\u2019s machine.", "The original dataset of already-curated informative features has 57 columns. After running the dataset through vtreat and specifying the NumericOutcomeTreatment() method, the prepared dataframe ended up having over 230 columns. I built two AutoML projects, one using the original dataset and the other the vtreat-prepped dataset; the former resulted in an R2 holdout score of ~0.91 while the latter resulted in an R2 holdout score of ~0.86. That is, for this particular example dataset, the prepared dataset gave a poorer model fit score.", "Acknowledgement: the AutoML tool used was the DataRobot Platform, which comes with built-in preprocessing and feature engineering.", "Some reasons why the prepared dataset ended up with worse model fit scores could be due to some possible overfitting to the impact-coded variables (despite using the built-in .fit_transform() method), newly introduced target leakage from existing leaks, or redundant generated features.", "In summary, both the authors and myself strongly advise data scientists to still get their hands dirty and investigate not just the underlying raw data but also the prepared data from data prep packages. You must always pay attention to the context of the data, both in terms of data provenance and how the predicted data will be applied, especially if the models will be used for real-world considerations.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F66024b39bba7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----66024b39bba7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@AShoop?source=post_page-----66024b39bba7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AShoop?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Alex Shoop"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F903ba1e14de1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&user=Alex+Shoop&userId=903ba1e14de1&source=post_page-903ba1e14de1----66024b39bba7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@stephanieharvey?utm_source=medium&utm_medium=referral", "anchor_text": "Stephanie Harvey"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://raw.githubusercontent.com/WinVector/vtreat/master/tools/vtreat.png", "anchor_text": "vtreat logo"}, {"url": "https://win-vector.com/", "anchor_text": "Win Vector LLC"}, {"url": "https://github.com/WinVector/vtreat", "anchor_text": "https://github.com/WinVector/vtreat"}, {"url": "https://win-vector.com/", "anchor_text": "https://win-vector.com/"}, {"url": "https://arxiv.org/abs/1611.09477", "anchor_text": "https://arxiv.org/abs/1611.09477"}, {"url": "https://pypi.org/project/vtreat/", "anchor_text": "https://pypi.org/project/vtreat/"}, {"url": "https://cran.r-project.org/web/packages/vtreat/vignettes/vtreatCrossFrames.html", "anchor_text": "https://cran.r-project.org/web/packages/vtreat/vignettes/vtreatCrossFrames.html"}, {"url": "https://medium.com/tag/data-preparation?source=post_page-----66024b39bba7---------------data_preparation-----------------", "anchor_text": "Data Preparation"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----66024b39bba7---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----66024b39bba7---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&user=Alex+Shoop&userId=903ba1e14de1&source=-----66024b39bba7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&user=Alex+Shoop&userId=903ba1e14de1&source=-----66024b39bba7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F66024b39bba7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----66024b39bba7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----66024b39bba7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----66024b39bba7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----66024b39bba7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----66024b39bba7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----66024b39bba7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AShoop?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AShoop?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alex Shoop"}, {"url": "https://medium.com/@AShoop/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13 Followers"}, {"url": "https://www.datarobot.com/", "anchor_text": "https://www.datarobot.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F903ba1e14de1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&user=Alex+Shoop&userId=903ba1e14de1&source=post_page-903ba1e14de1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F903ba1e14de1%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-data-prep-packages-can-introduce-risk-to-your-ml-modeling-66024b39bba7&user=Alex+Shoop&userId=903ba1e14de1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}