{"url": "https://towardsdatascience.com/yield-curve-building-in-python-8d7974a6e7e3", "time": 1683003667.053057, "path": "towardsdatascience.com/yield-curve-building-in-python-8d7974a6e7e3/", "webpage": {"metadata": {"title": "Yield Curve Building In Python. Using swap rates & B-spline functions\u2026 | by Neil Chandarana | Towards Data Science", "h1": "Yield Curve Building In Python", "description": "Conceptually, it\u2019s easy to decompose the term structure of interest rates into these three components. In reality, drivers are dynamic in time and can never be directly observed. This makes\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.theice.com/marketdata/reports/180", "anchor_text": "Ice swap rates", "paragraph_index": 13}, {"url": "https://www.global-rates.com/interest-rates/libor/british-pound-sterling/gbp-libor-interest-rate-3-months.aspx", "anchor_text": "Libor rates", "paragraph_index": 13}, {"url": "https://github.com/93tilinfinity/Yield-Curve-Fitting", "anchor_text": "myself", "paragraph_index": 20}, {"url": "https://github.com/93tilinfinity/Yield-Curve-Fitting", "anchor_text": "GitHub", "paragraph_index": 57}, {"url": "https://www.linkedin.com/in/neil-chandarana-369b3957/", "anchor_text": "LinkedIn", "paragraph_index": 60}, {"url": "https://towardsdatascience.com/machine-learning-cycling-300w-ftp-part-1-2abb04b30036", "anchor_text": "handful", "paragraph_index": 60}, {"url": "https://towardsdatascience.com/svd-where-model-tuning-goes-wrong-61c269402919", "anchor_text": "articles", "paragraph_index": 60}, {"url": "https://towardsdatascience.com/4-ways-to-supercharge-your-recommendation-system-aeac34678ce9", "anchor_text": "topics", "paragraph_index": 60}], "all_paragraphs": ["Conceptually, it\u2019s easy to decompose the term structure of interest rates into these three components.", "In reality, drivers are dynamic in time and can never be directly observed. This makes real-world curve shapes much harder to interpret and can turn even the best production models stale.", "A precursor to any useful analysis is knowing where the curve is.", "In liquid markets, few parameters are required to build a suitable curve. The heavy lifting is taken care of via interpolation between continuously updated rates observable from two-way prices from dealers.", "In illiquid markets, price streaming dries up. Observable market prices become scarce, reduce in size and widen in bid-offer. These times of low certainty can make or break dealers, fund managers and trading algorithms. Potential benefits of having a good yield curve model are especially great in this scenario.", "Stepping aside for one second. Underpinning inferential statistics and data mining (machine learning included) is the idea that meaningful conclusions of an underlying process can be drawn from sample data. A neglected but important sub-problem is extracting inference given small samples.", "Combining this statistical sub-problem with a lucrative financial modelling task, this article presents the following results:", "On the 30th January 2020, the Bank of England\u2019s Monetary Policy Committee voted (7\u20132) to leave UK rates unchanged. The very next day, the UK ceased membership of the European Union.", "Far from a normal market environment, this made sterling rates an interesting asset class to analyse. Notice, yield curve inversion in the front of the curve.", "Given GBP swap rate data sampled on 30th Jan 2020 (via ICE fixing), the objective was to construct the full swap rate term structure. That is, to construct a swap rate for any tenor between 3-month and 30y.", "Swap rate data from ICE generally start at 1y tenor however due to lack of liquidity on 1y swaps, there was no publication. Therefore, I enriched the dataset by adding 3-month and 6-month Libor rates. Units were in percentages.", "Since I used Libor and compounded rates (from swaps), at this point zero rates should be bootstrapped. However, the goal is to explore B-Spline regression so I chose not to normalise conventions. It made for a more interesting set of points to fit.", "To clarify, I did NOT predict interest rates. Predicting rates using economic/social/other cross-market indicators is a different beast. The objective was to build a picture of where the market pitches the curve rather than where the curve should be (skipping the efficient market hypothesis).", "Sources: Ice swap rates, Libor rates", "A spline function of order M is a piecewise polynomial of degree M-1 in the input variable. The values of the input space where the pieces of polynomials meet are known as knots. Knots are sorted in non-decreasing order and when distinct, the first M-2 derivatives of the polynomial pieces are continuous across each knot.", "Any spline function can be expressed as a unique linear combination of basis splines (B-splines) of the same degree over the same partition. I used regression by least squares to fit a model to the swap rate dataset on the augmented input space. Here were the B-spline settings:", "Not very many settings at all.", "An order 4 spline function corresponds to polynomials up to the power 3. Order 4 splines are commonly known as cubic splines. Cubic-splines are the lowest-order splines for which the knot-discontinuity is not visible to the human eye. Smooth functions can be achieved with higher powers of local polynomials but there is seldom any reason to go beyond cubic splines.", "I selected cubic splines with Open Uniform knots. That\u2019s a knot sequence where interior knots were equally spaced over the input domain and are padded with additional M repeated knots at the boundaries of the domain over which splines were evaluated.", "Here\u2019s how the first curve construction turned out.", "The SciPy python library offers useful functions to implement and evaluate an array of spline functions. However, I implemented de Boor\u2019s divided difference algorithm myself.", "Conforming to the structure of other ML model objects, I built a .fit() function that used least squares regression on the splines described by the matrix returned from .build_spline_mat().", "The final step was the .predict() function that filled in the interpolated values given the x values in original input space, swap tenors.", "Given UK interest rate data, the global shape appeared relatively well described. However, the variability of rates in the short end of the curve caused this spline setup some local problems.", "While simple to fit, this is far from the finished construction. I now present the key criteria on which a good model must stack up against and potential extensions for stability under different market conditions.", "Criteria for judging the quality of a construction method was short.", "1) Could I reproduce input market rates as outputs of the constructed curve?", "2) How stable was the curve?", "The first attempt didn\u2019t cut it.", "Curve construction starts with a set of observed market prices and must recover these prices as an output. In other instances of regression, this would be a major overfitting issue. But overfitting by definition assumes data exhibit random error which is contra to the efficient market hypothesis \u2014 that prices are always fair given current information. Either way, this scenario demands a descriptive model, not a predictive one.", "In this scenario, splines are a perfect choice. They allow flexible interpolation between inputs. That flexibility is governed by the order of the spline, the domain knot vector and smoothing.", "Smoothing is a regularisation technique that, like any other, sacrifices training accuracy in favour of a lower variance of coefficients. Here, regularisation opposes our objective so I didn\u2019t implement any smoothing.", "Recall, a cubic b-spline has order 4. I didn\u2019t change that. That left me with knot selection.", "Since the knot vector is padded, knot selection reduced to picking interior knots. Some research papers delve into optimal knot selection but that\u2019s largely domain agnostic. For this analysis, I wanted to motivate the choice of interior knots by domain knowledge.", "Swap trading is commonly split by driver of each part of the curve. That split might look like the following:", "Note, kv2 splits the domain to ensure even distribution of inputs within each interval.", "As you can see \u2014 no better. I threw knot vectors kv1-kv3 away. Since the difficulty in fitting was in the short end of the curve, I thought perhaps that the knot sequence should be determined by increasing degrees of freedom in known areas of interest rate volatility. I added more knots in this region and produced sequences k4 \u2014 k6.", "However, with a little more iteration I arrived at an additional sequence k7 (with just 4 interior knots) and I dropped k4.", "All three models satisfied the first criteria. The differences were seen in the turning point of the inverted front end of the yield curve.", "It was difficult to say which particular construction was best at this stage. In the absence of any prices between the 6m \u2014 2y tenor period, the choice became a function of a macroeconomic view. In particular, the expectation of the Bank of England\u2019s (BoE) base rate throughout 2020. The base rate currently sits at 0.75%. kv7 was the only curve not to factor in any hike in rate. I chose kv7. Recall, these data points were published before the January BoE meeting.", "This was a simplified model that did not use Short Sterling futures. In reality, exchange traded products are used in conjunction with over-the-counter (OTC) products to remedy exactly this type of uncertainty.", "Given the long, medium and short end of the curve have related but fundamentally different sources of volatility, local changes in the input space should translate only to local changes in the constructed curve.", "Using knot sequence k7, I presented four perturbation scenarios that represented different market scenarios. I wasn\u2019t so interested in differences local to the perturbed changes but instead in differences in the unchanged segments of the curve.", "The 4 sets of bumps applied to the input rates were as shown in the table.", "The good news was that the shape of the curve remained as before.", "It was interesting to see a non-uniform translation of the constructed curve after a uniform +1 basis point (bp) shift in inputs. This suggested a change in curvature between knots and therefore a change in coefficients of higher order polynomials rather than a change in just the constant term.", "This does have risk management implications but the simplest of arguments \u2014 if 7y and 8y swap rates sold off 1bp, why should the 7.5y point move by anything other than 1bp?", "It shouldn\u2019t. However, every model is a trade-off. Here it was behaviour in important parts of the curve against higher order discrepancies.", "A front-end rate rally. The 2y+ part of the curve didn\u2019t move. Promising.", "This was a red herring scenario. If a curve input was erroneously entered, how would the curve respond? Here, the 10y rate was shifted 5bps lower than the mark.", "I was in two thoughts about the results.", "1) I was pleased to see that the error didn\u2019t totally butcher the curve.", "2) It was almost too resilient to input errors. Without double-checking inputs, I\u2019d have no idea there was an error. I guess that depends on your style. Aggressive vs paranoid \u2014 your choice.", "A long end sell off. The short end of the curve didn\u2019t move. Some minor curvature adjustment in the 10y-15y region. All in all, solid.", "What started as a small project on B-Splines developed into a deeper dive into knot selection as a function of market drivers and stress testing curve stability in varying market conditions.", "I found a B-Spline representation that when passed an array of inputs and domain-inspired partitions of the input space returned a construction that was flexible enough to both hit market prices and locally adapt to bumps in the input market rates.", "Unfortunately, the knot selection process was inefficient. There is little time for iterating knot sequences. I\u2019d be interested to see the accuracy of a single fixed knot sequence over a full day of market movements. The second extension would be to explore optimal knot selection. I\u2019d also like to explore standard error bands as a proxy for bid-offer spreads and compare MLE and Bootstrapped methods in doing so.", "My code is up on GitHub, you\u2019re welcome to give those ideas a crack.", "The reality is that this but one of many ways to build a yield curve. I\u2019ve left a reading section below for alternative methodologies and extensions.", "While my academic background is mathematics & statistics, my employment background is trading interest rate options. In October \u201819, I left trading to explore the intersection of entrepreneurship and data science. I\u2019m interested in recommender systems, fitness data, financial markets, human memory and automation.", "If you share interests or just want to get in touch, drop me a message below or on LinkedIn. I\u2019ve also written a handful of articles on a range of statistical topics over the past 9 months!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Social Enterprise | Machine Learning | Recommendation systems | Ex-Options Trader \u2014 London"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8d7974a6e7e3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@neil.chandarana18?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@neil.chandarana18?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Neil Chandarana"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29e317e109b3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&user=Neil+Chandarana&userId=29e317e109b3&source=post_page-29e317e109b3----8d7974a6e7e3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/PublicDomainPictures-14/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=69522", "anchor_text": "PublicDomainPictures"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=69522", "anchor_text": "Pixabay"}, {"url": "https://www.theice.com/marketdata/reports/180", "anchor_text": "Ice swap rates"}, {"url": "https://www.global-rates.com/interest-rates/libor/british-pound-sterling/gbp-libor-interest-rate-3-months.aspx", "anchor_text": "Libor rates"}, {"url": "https://github.com/93tilinfinity/Yield-Curve-Fitting", "anchor_text": "myself"}, {"url": "https://github.com/93tilinfinity/Yield-Curve-Fitting", "anchor_text": "GitHub"}, {"url": "https://www.linkedin.com/in/neil-chandarana-369b3957/", "anchor_text": "LinkedIn"}, {"url": "https://towardsdatascience.com/machine-learning-cycling-300w-ftp-part-1-2abb04b30036", "anchor_text": "handful"}, {"url": "https://towardsdatascience.com/svd-where-model-tuning-goes-wrong-61c269402919", "anchor_text": "articles"}, {"url": "https://towardsdatascience.com/4-ways-to-supercharge-your-recommendation-system-aeac34678ce9", "anchor_text": "topics"}, {"url": "https://www.duo.uio.no/bitstream/handle/10852/61162/thesisDouzette.pdf?sequence=1&isAllowed=y", "anchor_text": "B-Splines in machine learning, Andre S. Douzette"}, {"url": "http://web.math.ku.dk/~rolf/HaganWest.pdf", "anchor_text": "Methods for Constructing a Yield Curve, Hagan, West"}, {"url": "https://www.stat.cmu.edu/~cshalizi/402/lectures/11-splines/lecture-11.pdf", "anchor_text": "Course Notes, Advanced Data Analysis, Carnegie Mellon University"}, {"url": "https://www.factset.com/hubfs/Resources%20Section/White%20Papers/swapcurvebuilding.pdf", "anchor_text": "Swap Curve Building at Factset, Davis, Liu"}, {"url": "https://www.mathworks.com/help/curvefit/examples/how-to-choose-knots.html", "anchor_text": "How to Choose Knots, MathWorks"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8d7974a6e7e3---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/interest-rates?source=post_page-----8d7974a6e7e3---------------interest_rates-----------------", "anchor_text": "Interest Rates"}, {"url": "https://medium.com/tag/python?source=post_page-----8d7974a6e7e3---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/programming?source=post_page-----8d7974a6e7e3---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/finance?source=post_page-----8d7974a6e7e3---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&user=Neil+Chandarana&userId=29e317e109b3&source=-----8d7974a6e7e3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&user=Neil+Chandarana&userId=29e317e109b3&source=-----8d7974a6e7e3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8d7974a6e7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8d7974a6e7e3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8d7974a6e7e3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@neil.chandarana18?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@neil.chandarana18?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neil Chandarana"}, {"url": "https://medium.com/@neil.chandarana18/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "169 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29e317e109b3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&user=Neil+Chandarana&userId=29e317e109b3&source=post_page-29e317e109b3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F141b6af603af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyield-curve-building-in-python-8d7974a6e7e3&newsletterV3=29e317e109b3&newsletterV3Id=141b6af603af&user=Neil+Chandarana&userId=29e317e109b3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}