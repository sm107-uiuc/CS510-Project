{"url": "https://towardsdatascience.com/deep-learning-image-classification-with-fast-ai-fc4dc9052106", "time": 1683012269.473502, "path": "towardsdatascience.com/deep-learning-image-classification-with-fast-ai-fc4dc9052106/", "webpage": {"metadata": {"title": "Deep Learning Image Classification with Fastai | by Blake Samaha | Towards Data Science", "h1": "Deep Learning Image Classification with Fastai", "description": "If you are beginning to feel burnt out on learning a subject it is often beneficial to take a step out of the weeds. I like to build something fun and easy to regain positive momentum on my learning\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/bsamaha/Chest-Xray-FastAI", "anchor_text": "GitHub repository", "paragraph_index": 0}, {"url": "https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia", "anchor_text": "Kaggle data set", "paragraph_index": 0}, {"url": "https://course.fast.ai/", "anchor_text": "Jeremy Howard at Fast.ai", "paragraph_index": 8}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colab", "paragraph_index": 10}, {"url": "https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia", "anchor_text": "found here on Kaggle", "paragraph_index": 12}, {"url": "https://machinelearningmastery.com/data-leakage-machine-learning/", "anchor_text": "so there is no data leakage", "paragraph_index": 21}, {"url": "https://www.w3schools.com/python/ref_func_slice.asp", "anchor_text": "the slice() function", "paragraph_index": 30}], "all_paragraphs": ["If you are beginning to feel burnt out on learning a subject it is often beneficial to take a step out of the weeds. I like to build something fun and easy to regain positive momentum on my learning journey. This is one project that helped get my creative juices flowing again. Load my notebook from my GitHub repository into Google Colab and upload the Kaggle data set to learn how to build an image classifier using the fastai software! Don\u2019t forget to set the hardware accelerator to GPU!", "P.S. Directly upload notebook to Colab by going to File \u2192Upload Notebook \u2192 GitHub Tab\u2192BSamaha/Chest-Xray-FastAI", "You have set a goal such as wanting to be a data scientist or data engineer. Your passion and energy are through the roof as you rifle through all the material on the subject you can find. Perhaps you even started a coding boot camp or a Coursera class to be your guide on your path to data mastery. Your brain becomes saturated with dopamine as you quickly rack up quick wins. First, it was basic python programming. Then you made your first linear regression with sci-kit learn \u2014 machine learning isn\u2019t so bad after all! You quickly absorbed all information thrown at you. Nothing can stop you.", "I\u2019ve been there, and I still go there. I am human after all. I\u2019m referring to the peak of \u201cMt. Stupid\u201d in The Dunning-Kruger Effect. Linear regression was easy with a perfectly curated data set, but that\u2019s not reality. Finally, after about a month or two of flying through the material with ease, you hit a wall named statistics. You grind through it and barely make it out \u2014 except you feel like you haven\u2019t retained anything. Do people remember all this distribution stuff? Spoiler Alert: yes, and you will be questioned about them. As you pursue on you realize your python skills are nowhere near where they should be. You decide to look at a couple of job postings and then it hits you. You don\u2019t have an advanced graduate degree in computer science, and you don\u2019t know how to pronounce some requirements of the job much less know what they are \u2014 Hadoop? Welcome to the Valley of Despair. You want to quit and move on with your life.", "My drill instructor, Staff Sergeant Rivera, at Marine Corps Recruit Depot Parris Island \u2014 real boot camp \u2014 once said,", "\u201cMotivation is like caffeine, it eventually wears off. What you are truly looking for is inspiration.\u201d", "I remember this quote every time I find myself heading towards the Valley of Despair on whatever new learning journey I am on. The best cure to get back on your game is to remember what made you excited in the first place. Find yourself a quick win to get some positive momentum again.", "This project was my quick win. It re-opened my eyes to the amazing power of machine learning and how simple it could be. My imagination began running wild with ideas of all the tools I could build to help others in the world. I found my inspiration again and my passion was relit. I hope it does the same for you.", "The goal of this blog post isn\u2019t to be highly technical and teach you everything about deep learning. I want you to go learn from the master himself, Jeremy Howard at Fast.ai. I am currently going through the course myself and I can\u2019t recommend it enough. I love his top-down teaching philosophy and his aim to make deep learning accessible and usable for everyone. Best of all its free!", "The goal of this post is to get you inspired by quickly building a deep learning model that has a very obvious use case. This project will take about 10 minutes to code. However, the training of our convolutional neural network (CNN) learner may take 30 minutes due to the large data set and your hardware.", "I highly recommend Google Colab for all tasks where you need a GPU \u2014 this is one of those instances. If you are familiar with Jupyter notebooks then you will quickly realize it is almost a replica. If you aren\u2019t familiar with any of these then please do the tutorial for Google Colab.", "In Colab, make sure you go to Runtime \u2192 Change Runtime Type \u2192 Set hardware accelerator to GPU.", "The data set I used in this project is found here on Kaggle. It is a little over 1 GB so I downloaded it to my local drive and then uploaded it to my Google Drive. This allowed me to delete the file from my local hard drive.", "The data set is over 5,800 JPGs of chest x-rays. The photos are labeled by the folder they are in \u2018Pneumonia\u2019 and \u2018Normal\u2019 respectively. This will prove beneficial later on.", "This data set is a bit unique. Usually, for Kaggle competitions a validation data set measures your model\u2019s performance throughout training. When you are ready you would use the test data set to make your predictions to submit for competition scoring. For this special case, we will use our test data set as our validation data set to measure how our model is performing. There is no competition for this data set and the validation set is only 16 images which is much too small.", "First, you may need to install the fastai software in the Google Colab notebook. Run the following code in the first cell, if it says it is already installed we are ready to begin.", "Now we will need to import all the necessary libraries with some additional functionality. The code below will import all of the libraries necessary to run the code. The last two lines are optional.", "Only run the last two lines if you have uploaded the data set into a Google drive folder, which I recommend. You will have to perform an authentication action to finish mounting your Google Drive to Colab.", "The data set should be a set of parent and children folders like the images below. It is very important your file structure mirrors mine. The hardest part of this whole project is organizing your data. I\u2019m going to assume from here on out you have uploaded the data to Google Colab.", "Once you have all your data organized the fun can begin. We will set the root directory of where your data is stored. This is the path of the folder where your test, train, and val folders reside. When we save our trained models later they will be saved in this directory.", "Then we must create an \u201cImageDataBunch\u201d object which is special to the fastai software. This object pulls together all our train data, test data, and validation data and performs the necessary transformations to the images. The ds_tfms is specifying the transforms which are outside the scope of this blog and to learn more about it I recommend completing the Fast.ai course.", "Now you can see why it is important to structure the folders as we did earlier. This allows us to use the from_folder method to correctly label all of the images while keeping our data sets separated so there is no data leakage. All images are normalized to a size of 224 pixels by 224 pixels. The \u201cbs\u201d stands for batch size which is how many images are shown to the model at the same time. You may need to reduce \u201cbs\u201d if your GPU does not have enough memory \u2014 try 32 or 16.", "Use the block of code below to view the images and see how they have been changed by the ImageDataBunch.", "The output of the above code should look similar to my output below.", "Now we will build our neural network. In fastai, the model being trained is called a \u201clearner\u201d. A learner is a general concept that can learn to fit a model. We are using the cnn_learner which will use the ResNet34 architecture. If you are curious here is a good article describing ResNet34.", "The code to create our learner is a simple one-liner. Once we create the learner we will use the fit_one_cycle method to train the model on our data set. The ResNet34 model is a pre-trained model in which we are fine-tuning on our data. This is called transfer learning and it is the premise of what fastai is built upon.", "Since we substituted our validation data set with our test data set we can see exactly how accurate our model is at the end of every epoch. The results show that we probably could have stopped training after 2 epochs. After the 2nd epoch, you can see the valid_loss increase and the accuracy decrease. However, the train_loss decreased at every epoch. This is a good example of what overfitting your training data looks like. Our results show an accuracy of 87.6%! What is even more amazing is how simple the coding was to get here!", "Don\u2019t forget to save your model. This way if you make corrections down the road that does not affect this \u2018stage-1\u2019 part of the model you can reload it without wasting time retraining it. When you reload your model you will see a long output detailing the inner workings of the CNN, this is normal.", "Right now all the layers except the very last layer are frozen. When we called fit_one_cycle on these frozen layers we only trained the final layer which is the part that classifies the x-ray image as \u201cnormal\u201d or \u201cpneumonia\u201d.", "Now we will unfreeze all the layers in the CNN and retrain it a bit more. This will change how the model evaluates the image and not only how it classifies images. Before we train a bit more, let\u2019s find what a good learning rate to train on is.", "This plot shows how the learning rate can affect the model\u2019s accuracy. We can see as the learning rate increases, so does the loss of our model. Now that we have unfrozen all of the layers in our learner we will retrain with these optimal learning rates. We enter the learning rates using the slice() function. Choosing a good learning rate seems to be more of an art than science and the Fastai course helps you learn the rules of thumb.", "Now that we have an idea of our learning rate let\u2019s train all the layers of our learner again on our data.", "We have now increased our accuracy to 89.1%. In other terms, we only predict 1 incorrect x-ray for every 10 we inspect. It\u2019s not perfect, but it\u2019s pretty good for the amount of work we put in! Let\u2019s train a couple more times to see if we can squeeze out a few more percentage points.", "Great! We squeezed another 2% points of accuracy out of our model! Now, let\u2019s explore what the model got wrong. In many cases this allows you to understand your data a bit better which may lead to different preprocessing techniques or architecture used.", "First, we need to create an interpreter object. From this \u201cinterp\u201d object, we can call methods such as plot_confusion_matrix and plot_top_losses.", "The confusion matrix above shows we incorrectly predicted a total of 53 images. 50 images we predicted incorrectly as pneumonia, and 3 images we predicted normal had pneumonia. This plot also works for multilabel classifications. If you have a lot of classes confusion matrices are often hard to interpret. Lucky for us, fastai has a text version of confusion matrices that can be accessed using the most_confused method.", "Another very helpful method is plot_top_losses. This allows you to examine the images your model was most confident it predicted correctly, but the model was wrong. This can often show errors in the data set. For example, if an image was incorrectly mislabeled you should go correctly label the image.", "Now you have the framework of how to build an image classifier using the powerful fastai software! I hope this model inspired you to create all sorts of tools using these techniques. The Fast.ai group is putting together a great program and I highly encourage you to check it out!", "Now go deploy this model as a web application that allows people to upload an x-ray for your model to predict a diagnosis! If you do, of course, please don\u2019t use this model in place of consulting a doctor. If you are interested in seeing how to deploy this model as a web app let me know! If there is interest in a follow-up post on deployment I will give it a go!", "Thank you for taking the time to read my blog. If you have any questions or have constructive criticism, please feel free to reach out to me!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a data junkie working to kick my addiction to MS Excel with Python."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffc4dc9052106&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://buh-lah-kay.medium.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": ""}, {"url": "https://buh-lah-kay.medium.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Blake Samaha"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8301b2223791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&user=Blake+Samaha&userId=8301b2223791&source=post_page-8301b2223791----fc4dc9052106---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@vadimsadovski?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Vadim Sadovski"}, {"url": "https://unsplash.com/s/photos/flame?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/bsamaha/Chest-Xray-FastAI", "anchor_text": "GitHub repository"}, {"url": "https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia", "anchor_text": "Kaggle data set"}, {"url": "https://course.fast.ai/", "anchor_text": "Jeremy Howard at Fast.ai"}, {"url": "https://course.fast.ai/", "anchor_text": "Practical Deep Learning for Coders, v3Welcome! If you\u2019re new to all this deep learning stuff, then don\u2019t worry-we\u2019ll take you through it all step by step\u2026course.fast.ai"}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colab"}, {"url": "https://colab.research.google.com/notebooks/welcome.ipynb", "anchor_text": "Google ColaboratoryEdit descriptioncolab.research.google.com"}, {"url": "https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia", "anchor_text": "found here on Kaggle"}, {"url": "https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia", "anchor_text": "Chest X-Ray Images (Pneumonia)5,863 images, 2 categorieswww.kaggle.com"}, {"url": "https://machinelearningmastery.com/data-leakage-machine-learning/", "anchor_text": "so there is no data leakage"}, {"url": "https://towardsdatascience.com/understanding-and-visualizing-resnets-442284831be8", "anchor_text": "Understanding and visualizing ResNetsThis post be found in PDF here.towardsdatascience.com"}, {"url": "https://www.w3schools.com/python/ref_func_slice.asp", "anchor_text": "the slice() function"}, {"url": "http://www.linkedin.com/in/blakesamaha", "anchor_text": "www.linkedin.com/in/blakesamaha"}, {"url": "http://www.aggressiontothemean.com", "anchor_text": "aggressiontothemean.com"}, {"url": "https://twitter.com/Mean_Agression", "anchor_text": "@Mean_Agression"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----fc4dc9052106---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----fc4dc9052106---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----fc4dc9052106---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----fc4dc9052106---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&user=Blake+Samaha&userId=8301b2223791&source=-----fc4dc9052106---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&user=Blake+Samaha&userId=8301b2223791&source=-----fc4dc9052106---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffc4dc9052106&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fc4dc9052106---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fc4dc9052106--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fc4dc9052106--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fc4dc9052106--------------------------------", "anchor_text": ""}, {"url": "https://buh-lah-kay.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://buh-lah-kay.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blake Samaha"}, {"url": "https://buh-lah-kay.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "104 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8301b2223791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&user=Blake+Samaha&userId=8301b2223791&source=post_page-8301b2223791--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbe63cc83975&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-image-classification-with-fast-ai-fc4dc9052106&newsletterV3=8301b2223791&newsletterV3Id=be63cc83975&user=Blake+Samaha&userId=8301b2223791&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}