{"url": "https://towardsdatascience.com/transformations-of-stack-melt-pivot-table-901292196d9e", "time": 1682994174.51597, "path": "towardsdatascience.com/transformations-of-stack-melt-pivot-table-901292196d9e/", "webpage": {"metadata": {"title": "Transformations of Stack, Melt, Pivot Table in pandas | by Han Qi | Towards Data Science", "h1": "Transformations of Stack, Melt, Pivot Table in pandas", "description": "Full notebook at https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3 Alternatively, click \u201cview raw\u201d at the bottom right of this scrollable frame and save the json as an .ipynb file In\u2026"}, "outgoing_paragraph_urls": [{"url": "https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3", "anchor_text": "https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3", "paragraph_index": 0}, {"url": "https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html", "anchor_text": "https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html", "paragraph_index": 3}, {"url": "https://github.com/pandas-dev/pandas/issues/17440", "anchor_text": "https://github.com/pandas-dev/pandas/issues/17440", "paragraph_index": 10}, {"url": "http://pbpython.com/pandas-pivot-table-explained.html", "anchor_text": "http://pbpython.com/pandas-pivot-table-explained.html", "paragraph_index": 13}, {"url": "https://hanqi01.medium.com/membership", "anchor_text": "https://hanqi01.medium.com/membership", "paragraph_index": 15}], "all_paragraphs": ["Full notebook at https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3Alternatively, click \u201cview raw\u201d at the bottom right of this scrollable frame and save the json as an .ipynb file", "In this article i will explore how dataframe.stack(), dataframe.melt(), dataframe.pivot_table from pandas data manipulation library of python interact with each other in a transformation pipeline to reshape dataframes and recover the original dataframe, along with numerous caveats along the way by following along the code.", "By default, jupyter notebooks only display the last line of every cell. The first two lines make jupyter display the outputs of all variables as a convenience to avoid wrapping print() around every single variable I wish to see. Next, we import the pandas library where we call the dataframe reshaping functions from.", "Here, we create the dataframe. Then df.stack() turns our single-level column df into a dataseries with a multi-index index by fitting the columns into a new inner index (index level 1) for each value in the old outer index (index level 0). The outer level looks like it has only 2 values [cat,dog], but it is only for neat display and is really 4 values [cat,cat,dog,dog]. Something useful to note from: https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.htmlif the columns have multiple levels, the new index level(s) is (are) taken from the prescribed level(s) and the output is a DataFrame. So it\u2019s good to keep in mind whether the transformation output is a dataseries or dataframe.", "The values are aligned accordingly to the indexes, turning the dataframe from a wide format to a long format dataseries. Because pivot_table is a dataframe method and does not apply to dataseries, we can extract level 1 of the multi-index using reset_index(level = 1) to prepare for pivoting back. Specifying level = 0 would have extracted the outer index into a column. Note that \u2018level_1\u2019 is automatically added as a column name after reset_index(). This will be extra information that can be used or cleaned and ignored later. The 0 column above values is added automatically too.", "It does not matter if you extracted level 0 or level 1 at this stage. You can simply switch the inputs to index and columns parameters of pivot_table later to achieve the same output (barring the tiny df.columns.name difference) and recover the original dataframe.", "Finally, we specify index and columns parameters in pivot_table by selecting from the current column names to describe how the final pivoted dataframe should look like. The values parameter is optional, but not specifying it will add column names not yet specified in index or columns parameters to the outerlevel of current columns to create multi-indexed columns that look ugly and make data access unnecessarily difficult.", "Remember that pivot_table is a dataframe method and does not apply to dataseries, so rather than reset_index as in part1, we can directly construct a dataframe from the series using pd.DataFrame(df.stack()) to create a multi-indexed dataframe to make the pivot_table method available and work harder in specifying its parameters correctly.", "index.get_level_values(0) is a way to get the index values of the specified muti-index level (in this case, 0) as a pandas.core.indexes.base.Index object which can be conveniently used by functions accepting sequences/lists. In part 2, we match the correct index information from each level into the index and columns parameters of pivot table to recover the original dataframe. Part 2 is cleaner than part 1 because there was no reset_index to create an extra \u2018level_0\u2019 or \u2018level_1\u2019 in df.columns.name that we set to None in part 1.", "Similar to stacking, melt turns wide format data to long format data by putting compressing columns into a single list. The difference is that stack inserted this list into the inner index, while melt inserts this list as a new column called \u2018variable\u2019 (can be renamed).", "Note that melt has made the cat dog information in the index disappear. This makes it impossible to recover the original dataframe. Until this issue (https://github.com/pandas-dev/pandas/issues/17440) is fixed, we have to manually add back the index.", "Finally, pivot_table with the right parameters will recover our original dataframe. Like in part 1, \u2018variable\u2019 is removed from df.columns.name for exact recovery.", "I hope these transformations have given beginners to these functions a better understanding of how flexible pandas is. The same information can be placed in Index or Columns using set_index and reset_index depending on where they serve the greatest purpose. For example, instead of df.loc[df.col == value] to filter when the information is in a column, setting col to the index, and doing df.loc[value] is much simpler. Whether information is in the index or column will also greatly affect how pd.merge, pd.concat, dataframe.join work on such dataseries/dataframes, but that would be another whole article by itself.", "Stack allows information from columns to swing to indexes and vice versa (with unstack()). Melt combines columns to a standard 3-column format of id_vars, variable, value to allow columnar processing of variable before pivoting back with edited column values. Pivot_table is the most powerful among the 3 with other parameters such as aggfunc (aggregation) that allows custom functions so possibilities there are limitless. Finally, here is a practical example that helped me a lot: http://pbpython.com/pandas-pivot-table-explained.html", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Shares ideas that I can\u2019t find online. You can support my writing by joining Medium through https://hanqi01.medium.com/membership (affiliate link)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F901292196d9e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://hanqi01.medium.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": ""}, {"url": "https://hanqi01.medium.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Han Qi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ffa63536714&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&user=Han+Qi&userId=5ffa63536714&source=post_page-5ffa63536714----901292196d9e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@weareouterdigit?utm_source=medium&utm_medium=referral", "anchor_text": "Outer Digit"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3", "anchor_text": "https://gist.github.com/gitgithan/0ba595e3ef9cf8fab7deeb7b8b533ba3"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html", "anchor_text": "https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.stack.html"}, {"url": "https://github.com/pandas-dev/pandas/issues/17440", "anchor_text": "https://github.com/pandas-dev/pandas/issues/17440"}, {"url": "https://github.com/pandas-dev/pandas/issues/17440", "anchor_text": "https://github.com/pandas-dev/pandas/issues/17440"}, {"url": "http://pbpython.com/pandas-pivot-table-explained.html", "anchor_text": "http://pbpython.com/pandas-pivot-table-explained.html"}, {"url": "https://medium.com/tag/pandas?source=post_page-----901292196d9e---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&user=Han+Qi&userId=5ffa63536714&source=-----901292196d9e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&user=Han+Qi&userId=5ffa63536714&source=-----901292196d9e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F901292196d9e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----901292196d9e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----901292196d9e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----901292196d9e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----901292196d9e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----901292196d9e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----901292196d9e--------------------------------", "anchor_text": ""}, {"url": "https://hanqi01.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://hanqi01.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Han Qi"}, {"url": "https://hanqi01.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "134 Followers"}, {"url": "https://hanqi01.medium.com/membership", "anchor_text": "https://hanqi01.medium.com/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ffa63536714&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&user=Han+Qi&userId=5ffa63536714&source=post_page-5ffa63536714--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F94c3fdd45e96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformations-of-stack-melt-pivot-table-901292196d9e&newsletterV3=5ffa63536714&newsletterV3Id=94c3fdd45e96&user=Han+Qi&userId=5ffa63536714&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}