{"url": "https://towardsdatascience.com/how-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5", "time": 1683011189.420802, "path": "towardsdatascience.com/how-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5/", "webpage": {"metadata": {"title": "How to use the Microsoft identity platform in your Azure web app | by Ren\u00e9 Bremer | Towards Data Science", "h1": "How to use the Microsoft identity platform in your Azure web app", "description": "The Microsoft identity platform is key to secure access to web apps. Authenticate and authorizate users in your app with Azure AD or their social accounts."}, "outgoing_paragraph_urls": [{"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview", "anchor_text": "Microsoft identity platform", "paragraph_index": 0}, {"url": "https://github.com/rebremer/ms-identity-python-webapp-backend", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview", "anchor_text": "blog", "paragraph_index": 3}, {"url": "https://docs.microsoft.com/en-us/azure/app-service/containers/quickstart-python?tabs=bash#deploy-the-sample", "anchor_text": "this", "paragraph_index": 11}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps", "anchor_text": "this", "paragraph_index": 17}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps#assign-users-and-groups-to-roles", "anchor_text": "link", "paragraph_index": 18}, {"url": "https://docs.microsoft.com/en-us/graph/azuread-users-concept-overview?view=graph-rest-1.0", "anchor_text": "Users", "paragraph_index": 21}], "all_paragraphs": ["The Microsoft identity platform is key to secure access to your web app. Users can authenticate to your app using their Azure AD identity or social accounts. The authorization model can be used to grant permissions to your backend app or standard APIs like Microsoft Graph. In this blog, a web application is discussed that does the following:", "The code of the project can be found here, architecture can be found below.", "The focus is to provide a working example using Microsoft identity platform and to \u201cget your hands dirty\u201d. The focus is less on explaining the internal workings of OAuth 2.0 and Azure AD. In the remaining of this blog, the following is discussed.", "To learn how to access Azure SQL database using delegated or application permissions, see my previous blog. Notice that both blogs share the same git repo, so this project can be configured to access Azure SQL rather than a backend app.", "This sample shows how to build a Python frontend web app using Flask and MSAL Python and backend app using an Azure Function. In this step, the following sub steps are executed:", "To run this sample, you\u2019ll need to install this locally:", "Create and configure an app registration as follows:", "In this part, the Azure Function will be deployed. This is done as follows:", "You will need to install dependencies using pip as follows:", "Run app.py from shell or command line using the following command:", "When the app is run locally, it can be visited by localhost:5000 (not 127.0.0.1:5000). After step 1, users can login using their Azure AD credentials and retrieve data from the backend.", "Finally, see this link how to deploy your frontend flask app in an Azure web app. Simplest way to deploy your code is running following command from the directory where app.py is placed:", "Make sure that https://<<your uniquewebapp>>.azurewebsites.net/getAToken is added as reply URL. When you login and click on link to retrieve data from backed, the following screen shall be shown:", "However, to be able to execute the remaining steps of this tutorial, localhost can be used as well.", "In this step, a role is assigned to the user to indicate whether it is a basic user or premium user. The following sub steps are executed:", "Step 1 focusses on the follow part of the architecture.", "Claim verification is an optional step and can be enabled using the following setting in app_config.py file: AAD_ROLE_CHECK = True .", "Follow the steps in this tutorial to add roles to app registration created in step 1.2. As manifest, the following appRoles shall be used:", "The assignment of users is explained in this link. As a test, two users can be created. User 1 is assigned the basic_user_access, whereas user 2 gets the premium_user_access role, see also screenshot below in which admin, student2 has an premium role assigned and student 1 only has basic.", "In case student clicks on the customer link, access to the backend is denied by the frontend, see also message below.", "In the next step, user data is retrieved using the Microsoft Graph API.", "Users are the representation of an Azure AD work or school user account or a Microsoft account in Microsoft Graph. In this step, the delegated permissions of the signed-in user are used to retrieve its own data using scope users.read. The following sub steps are executed:", "Step 2 focusses on the follow part of the architecture.", "The app registration either needs to have consent to read the user data from the Microsoft Graph. Depending on Azure AD configuration, the following types of consent are possible:", "In this case, admin consent is used that is done on beforehand. See below the users.read permission is granted in app registration:", "Subsequently, verify in the adhering Enterprise Application of App registration that app can read user\u2019s data on behalf of the user.", "Notice that User.Read only allows a user to retrieve his own data and not data of others (that can only be done with permission User.Read.All)", "Once the app has either user consent of admin consent to retrieve data, just log in and click on the link Call Microsoft Graph API and user\u2019s own data is returned, see also below.", "In step 1, data was already retrieved from the backend. However, not only the frontend can retrieve data from the backend, but all identities within the same Azure AD tenant can retrieve data. Using application permissions and user assigment, it is made sure that only the frontend can access the backend.", "The following sub steps are executed:", "Step 3 focusses on the follow part of the architecture.", "Go to the manifest of your backend app registration and add the following app role to the manifest.", "Subsequently, go to the app registration of the frontend, click API permissions and grant these permissions to your frontend app, see also below.", "Subsequently, grant admin permissions such that frontend can access backend with application role front_end_access. To verify whether frontend has application role front_end_access, go to your backend app registration, Enterprise Application and look for users/groups, see also below.", "Notice that role front_end_access is not explicitely shown, but it will be shown in 3.2 that role is there.", "Go to your backend app registration, Enterprise Application and look for Properties and enable user assignement, see also below.", "When this property is enabled, the frontend is the only application that can retrieve data from the backend, see also below where role is displayed", "The git repo belonging to this project has additional configuration options that are discusssed below:", "The Microsoft identity platform can help you to secure access to your applications. In this blog, a concrete example is provided that uses Azure AD to login users with either user role \u201cbasic\u201d or \u201cpremium\u201d. Subsequently, delegated permissions of signed-in users are used to retrieve Microsoft Graph data and application permissions are used to access the backend, see also architecture below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Solution Architect @ Microsoft, working with Azure services as ADFv2, ADLSgen2, Azure DevOps, Databricks, Function Apps and SQL. Opinions here are mine."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffcb3839a44e5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rebremer.medium.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771----fcb3839a44e5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview", "anchor_text": "Microsoft identity platform"}, {"url": "https://github.com/rebremer/ms-identity-python-webapp-backend", "anchor_text": "here"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview", "anchor_text": "blog"}, {"url": "https://www.python.org/downloads/release/python-2713/", "anchor_text": "Python 2.7+"}, {"url": "https://www.python.org/downloads/release/python-364/", "anchor_text": "Python 3+"}, {"url": "https://docs.microsoft.com/azure/active-directory/develop/quickstart-create-new-tenant", "anchor_text": "how to get an Azure AD tenant."}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app", "anchor_text": "link"}, {"url": "https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/azure-functions/functions-create-first-function-python.md", "anchor_text": "quickstart"}, {"url": "https://github.com/rebremer/ms-identity-python-webapp-backend/tree/master/blog-webappaad-backend", "anchor_text": "git repo"}, {"url": "https://docs.microsoft.com/en-us/azure/app-service/configure-authentication-provider-aad#-configure-with-express-settings", "anchor_text": "quickstart"}, {"url": "https://docs.microsoft.com/en-us/azure/app-service/containers/quickstart-python?tabs=bash#deploy-the-sample", "anchor_text": "this"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps", "anchor_text": "this"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps#assign-users-and-groups-to-roles", "anchor_text": "link"}, {"url": "https://docs.microsoft.com/en-us/graph/azuread-users-concept-overview?view=graph-rest-1.0", "anchor_text": "Users"}, {"url": "https://towardsdatascience.com/how-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22", "anchor_text": "this"}, {"url": "https://github.com/rebremer/managed_identity_authentication/blob/master/AAD_auth_ADFv2_MI_to_Azure_Function.ps1", "anchor_text": "git repo"}, {"url": "https://medium.com/tag/azure?source=post_page-----fcb3839a44e5---------------azure-----------------", "anchor_text": "Azure"}, {"url": "https://medium.com/tag/programming?source=post_page-----fcb3839a44e5---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----fcb3839a44e5---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/identity?source=post_page-----fcb3839a44e5---------------identity-----------------", "anchor_text": "Identity"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----fcb3839a44e5---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----fcb3839a44e5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----fcb3839a44e5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffcb3839a44e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fcb3839a44e5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fcb3839a44e5--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://rebremer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "731 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fed36bca8eb16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5&newsletterV3=11e5e7fb3771&newsletterV3Id=ed36bca8eb16&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}