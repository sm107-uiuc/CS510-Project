{"url": "https://towardsdatascience.com/training-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9", "time": 1683006167.5246642, "path": "towardsdatascience.com/training-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9/", "webpage": {"metadata": {"title": "Training a recommendation model for Google Analytics data using BigQuery ML | by Lak Lakshmanan | Towards Data Science", "h1": "Training a recommendation model for Google Analytics data using BigQuery ML", "description": "This article demonstrates how to implement a WALS (matrix factorization) model to do collaborative filtering. For collaborative filtering, we don\u2019t need to know anything about either the users or the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/google-cloud/using-bigquery-flex-slots-to-run-machine-learning-workloads-more-efficiently-7fc7f400f7a7", "anchor_text": "set up flex slots", "paragraph_index": 10}], "all_paragraphs": ["This article demonstrates how to implement a WALS (matrix factorization) model to do collaborative filtering. For collaborative filtering, we don\u2019t need to know anything about either the users or the content. Essentially, all we need to know is userId, itemId, and rating that the particular user gave the particular item.", "In this case, we are working with newspaper articles. The company doesn\u2019t ask their users to rate the articles. However, we can use the time-spent on the page as a proxy for rating.", "Here\u2019s the query to get the duration that each user spends on each newspaper article (normally, we would also add a time filter to this (\u201clatest 7 days\u201d), but our dataset is itself limited to a few days.):", "We expect that visitors who spent more time looking at an article like it more. However, the session durations can be a little ridiculous. Notice the 55440 seconds (15 hours) that row #3 shows. We can plot the histogram of session durations in the dataset:", "So, let\u2019s scale and clip it the values by the median session duration (average duration will be dramatically affected by the outliers):", "where CLIP is defined as follows:", "Now, the session duration is scaled and in the right range:", "Putting every thing together and materializing it into a table:", "The table data now looks like this:", "We can train the model as follows:", "Note: If you are on an on-demand pricing plan, you will get an error message \u201cTraining Matrix Factorization models is not available for on-demand usage. Totrain, please set up a reservation (flex or regular) based on instructions in BigQuery public docs.\u201d. This is because matrix factorization tends to become expensive when priced based on data. Flex slots are priced based on compute and are much cheaper. So, set up flex slots \u2014 you can use them for as little as 60 seconds.", "You will have play with the value of l2_reg that yields reasonable errors for your dataset. How do you know it\u2019s reasonable? Check the evaluation tab:", "You want the mean and median absolute errors to be similar, and much smaller than 0.5 (random chance will be 0.5).", "Here is how to get to top 3 recommendations for each user:", "Huge thanks to Luka Cempre and Evan Jones for help with figuring out the Google Analytics data.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2327f9a2e8e9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----2327f9a2e8e9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/illustrations/news-newspaper-globe-read-paper-1074604/", "anchor_text": "geralt"}, {"url": "https://support.google.com/analytics/answer/3437719?hl=en", "anchor_text": "https://support.google.com/analytics/answer/3437719?hl=en"}, {"url": "https://support.google.com/analytics/answer/3437719?hl=en", "anchor_text": "https://support.google.com/analytics/answer/3437719?hl=en"}, {"url": "https://medium.com/google-cloud/using-bigquery-flex-slots-to-run-machine-learning-workloads-more-efficiently-7fc7f400f7a7", "anchor_text": "set up flex slots"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----2327f9a2e8e9---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/bigquery-ml?source=post_page-----2327f9a2e8e9---------------bigquery_ml-----------------", "anchor_text": "Bigquery Ml"}, {"url": "https://medium.com/tag/sql?source=post_page-----2327f9a2e8e9---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2327f9a2e8e9---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/recommendations?source=post_page-----2327f9a2e8e9---------------recommendations-----------------", "anchor_text": "Recommendations"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----2327f9a2e8e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----2327f9a2e8e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2327f9a2e8e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2327f9a2e8e9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2327f9a2e8e9--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-recommendation-model-for-google-analytics-data-using-bigquery-ml-2327f9a2e8e9&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}