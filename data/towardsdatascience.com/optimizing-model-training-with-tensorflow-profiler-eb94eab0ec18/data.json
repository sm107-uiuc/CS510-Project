{"url": "https://towardsdatascience.com/optimizing-model-training-with-tensorflow-profiler-eb94eab0ec18", "time": 1683016401.525459, "path": "towardsdatascience.com/optimizing-model-training-with-tensorflow-profiler-eb94eab0ec18/", "webpage": {"metadata": {"title": "Optimizing Model Training with TensorFlow Profiler | by Rohan Jagtap | Towards Data Science", "h1": "Optimizing Model Training with TensorFlow Profiler", "description": "We want our models to train real fast. We use GPUs to make operations execute faster. However, it is possible that even after speeding up the computations, the model may have inefficiencies in the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/a-quickstart-guide-to-tensorboard-fb1ade69bbcf", "anchor_text": "refer to my article on Tensorboard", "paragraph_index": 2}, {"url": "https://www.tensorflow.org/datasets", "anchor_text": "tensorflow-datasets", "paragraph_index": 7}, {"url": "https://www.tensorflow.org/xla", "anchor_text": "XLA", "paragraph_index": 34}, {"url": "https://www.tensorflow.org/guide/mixed_precision", "anchor_text": "fp16 Mixed Precision", "paragraph_index": 34}], "all_paragraphs": ["We want our models to train real fast. We use GPUs to make operations execute faster. However, it is possible that even after speeding up the computations, the model may have inefficiencies in the pipeline itself, and thus, may train slower. In such cases, it becomes really difficult to debug the code, or as a matter of fact, even tell what is slow.", "This can be addressed by using the TensorFlow Profiler. The Profiler \u2018profiles\u2019 the TensorFlow code execution. We\u2019ll be discussing the Profiler, how to use it, best practices, and how to optimize the GPU performance in this article.", "Note that this article expects basic knowledge of training TensorFlow models and using Tensorboard. You can refer to my article on Tensorboard if you\u2019re unaware of it.", "First things first, even before optimizing anything, let\u2019s talk about what the profiler is and what it offers.", "Profiling helps you understand the hardware resource consumption (time and memory) of the various TensorFlow operations (ops) in your model and resolve performance bottlenecks and ultimately, make the model execute faster.", "Basically, the profiler monitors the model training. It notes down the time required for the ops to execute, the time required for complete steps to execute, collects insights on resource utilization in terms of time and memory and provides visualizations for understanding these insights.", "In the upcoming sections, we\u2019ll see how to work with the profiler:", "To understand how to use the profiler, let\u2019s first train a model! We\u2019ll use the famous mnist dataset from tensorflow-datasets:", "Note that Profiler requires the latest versions of TensorFlow and TensorBoard installed.", "Now, load and preprocess the dataset:", "Now, enabling the profiler is super easy. You simply need to add an extra argument to the tensorboard callback:", "The profile_batch argument tells TensorFlow to capture the execution performance and profile it. \u2018500,520\u2019 specifies the batches you wish to profile, i.e., the model\u2019s performance from batch 500 through 520 will be captured.", "Now, we\u2019ll train the model as usual with the above callback:", "Now that we have trained the model, let\u2019s see how we did with the help of the profiler:", "This section gives a high-level summary of the model performance. Here are a few things to look for:", "In an ideal case, your program should have high GPU utilization, minimal CPU (host) to GPU (device) communication, and no overhead from the input pipeline.", "So before this tool gets anymore intimidating, let\u2019s break it down:", "Typically, the host executes input operations, preprocesses training data and transfers it to the device, while the device executes the actual model training.", "Exploring this tool will give you a better idea of these durations (Use W and S to zoom in or out, respectively). For starters, take a look at this:", "Ideally, the GPU compute timeline must be crowded (i.e., GPU busy). Host to device and device to host copies should be minimal.", "Using the Steps timeline, you can see the different phases of the model like the forward pass (sequential and dense), loss calculation (sparse_categorical_crossentropy), and backward pass (gradient_tape and Adam). These ops should be crowded with minimal space between steps. The spaces indicate GPU idle time, and crowding indicates utilization.", "The rest of the tools give comprehensive insights on specific categories or ops covered in the Overview Page and Trace Viewer. Let\u2019s quickly glance through them:", "In the previous sections, we trained our model and saw how the profiler helps in identifying potential inefficiencies in the pipeline and resource utilization. This section will try and address those inefficiencies and see if our model does any better\u2026", "Now, we\u2019ve seen that our model is highly \u2018input bound,\u2019 i.e., most of its training time was spent in input operations (e.g., preprocessing). If you observe tf_data_iterator_get_next from the trace viewer, we can see that tf.data operations account for a lot of time. This is because our tf.data.Dataset fetches the batches in real-time during training.", "One thing we can do to optimize this is use caching and prefetching.", "So without prefetch, at a given step s, first the data is fetched (and preprocessed) in time t1. Then, the model is trained on this data in time t2. Now the total step time for step s becomes (t1 + t2).", "But with prefetch, a background thread fetches the data for step (s + 1) while the model is being trained on the data for step s. Hence, if the time required to fetch the data for step (s + 1) is t1, and the time required for training the model for step s is t2, then the step time will be max(t1, t2).", "Let\u2019s add caching and prefetching to our previous code:", "And then, train the model in the exact same way like before.", "Now that we have optimized our training, let\u2019s take a look at the profiler:", "In the previous section, we saw how optimization can result in better model performance. There I made just one optimization change for the sake of demonstration. But there\u2019s a lot more to optimization than that.", "In this section, we\u2019ll glance through some optimizations to look out for:", "In this rather very exhaustive article, we discussed a very useful TensorFlow tool, which can be used to debug a model. We saw what the tool offers, the basics of using it, and finally, ways to optimize a TensorFlow model\u2019s performance on GPU.", "There\u2019s a lot more to the profiler and optimization, and I encourage you to read the docs (link in references) for more!", "One important optimization technique that I didn\u2019t touch in this article was using XLA and fp16 Mixed Precision. This can actually take a while to cover, and best be explained in a separate article!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Immensely interested in AI Research | I read papers and post my notes on Medium"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Feb94eab0ec18&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rojagtap.medium.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": ""}, {"url": "https://rojagtap.medium.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Rohan Jagtap"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F39646f947a4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&user=Rohan+Jagtap&userId=39646f947a4c&source=post_page-39646f947a4c----eb94eab0ec18---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/a-quickstart-guide-to-tensorboard-fb1ade69bbcf", "anchor_text": "refer to my article on Tensorboard"}, {"url": "https://www.tensorflow.org/guide/profiler", "anchor_text": "TensorFlow Docs"}, {"url": "https://www.tensorflow.org/datasets", "anchor_text": "tensorflow-datasets"}, {"url": "https://www.tensorflow.org/guide/gpu_performance_analysis", "anchor_text": "TensorFlow Docs"}, {"url": "https://www.tensorflow.org/guide/profiler#trace_viewer", "anchor_text": "TensorFlow Docs"}, {"url": "https://www.tensorflow.org/guide/data_performance#caching", "anchor_text": "tf.data.Dataset.cache"}, {"url": "https://www.tensorflow.org/guide/data_performance#prefetching", "anchor_text": "tf.data.Dataset.prefetch"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/while_loop", "anchor_text": "tf.while_loop"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/distribute/OneDeviceStrategy", "anchor_text": "tf.distribute.OneDeviceStrategy"}, {"url": "https://www.tensorflow.org/xla", "anchor_text": "XLA"}, {"url": "https://www.tensorflow.org/guide/mixed_precision", "anchor_text": "fp16 Mixed Precision"}, {"url": "https://www.tensorflow.org/guide/profiler", "anchor_text": "Optimize TensorFlow performance using the Profiler | TensorFlow CoreUse the tools available with the Profiler to track the performance of your TensorFlow models. See how your model\u2026www.tensorflow.org"}, {"url": "https://www.tensorflow.org/tensorboard/tensorboard_profiling_keras", "anchor_text": "TensorFlow Profiler: Profile model performance | TensorBoardMachine learning algorithms are typically computationally expensive. It is thus vital to quantify the performance of\u2026www.tensorflow.org"}, {"url": "https://www.tensorflow.org/guide/gpu_performance_analysis", "anchor_text": "Optimize TensorFlow GPU Performance with the TensorFlow ProfilerThis guide is for TensorFlow users utilizing GPUs to improve model performance. Using the TensorFlow Profiler as the\u2026www.tensorflow.org"}, {"url": "https://www.tensorflow.org/guide/data_performance", "anchor_text": "Better performance with the tf.data API | TensorFlow CoreGPUs and TPUs can radically reduce the time required to execute a single training step. Achieving peak performance\u2026www.tensorflow.org"}, {"url": "https://towardsdatascience.com/10-tensorflow-tricks-every-ml-practitioner-must-know-96b860e53c1", "anchor_text": "10 TensorFlow Tricks Every ML Practitioner Must KnowWhy TensorFlow is the complete ML packagetowardsdatascience.com"}, {"url": "https://towardsdatascience.com/a-quickstart-guide-to-tensorboard-fb1ade69bbcf", "anchor_text": "A Quickstart Guide to TensorBoardHow to Visualize ML Experimentations using TensorBoardtowardsdatascience.com"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----eb94eab0ec18---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----eb94eab0ec18---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----eb94eab0ec18---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----eb94eab0ec18---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----eb94eab0ec18---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&user=Rohan+Jagtap&userId=39646f947a4c&source=-----eb94eab0ec18---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&user=Rohan+Jagtap&userId=39646f947a4c&source=-----eb94eab0ec18---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Feb94eab0ec18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----eb94eab0ec18---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----eb94eab0ec18--------------------------------", "anchor_text": ""}, {"url": "https://rojagtap.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rojagtap.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rohan Jagtap"}, {"url": "https://rojagtap.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "465 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F39646f947a4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&user=Rohan+Jagtap&userId=39646f947a4c&source=post_page-39646f947a4c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe51e2b6202c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimizing-model-training-with-tensorflow-profiler-eb94eab0ec18&newsletterV3=39646f947a4c&newsletterV3Id=e51e2b6202c5&user=Rohan+Jagtap&userId=39646f947a4c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}