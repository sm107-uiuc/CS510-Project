{"url": "https://towardsdatascience.com/defining-user-restrictions-for-gpus-6971a658a9ce", "time": 1683001894.555763, "path": "towardsdatascience.com/defining-user-restrictions-for-gpus-6971a658a9ce/", "webpage": {"metadata": {"title": "Defining User Restrictions for GPUs | by Erfan Eshratifar | Towards Data Science", "h1": "Defining User Restrictions for GPUs", "description": "We are using Lambda Lab\u2019s 4-GPU workstations at the University of Southern California. As multiple users can be simultaneously running jobs on the server, handling Out of Memory (OOM) errors and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://lambdalabs.com/deep-learning/workstations/4-gpu", "anchor_text": "Lambda Lab\u2019s 4-GPU", "paragraph_index": 0}, {"url": "https://amirerfan.com", "anchor_text": "https://amirerfan.com", "paragraph_index": 14}], "all_paragraphs": ["We are using Lambda Lab\u2019s 4-GPU workstations at the University of Southern California. As multiple users can be simultaneously running jobs on the server, handling Out of Memory (OOM) errors and fairness is a bit challenging. The solutions that we could find online are as the following:", "2. Slurm is an open-source and highly scalable job scheduling system for large and small Linux clusters. It supports GPU resource scheduling. It seems a very suitable choice for large teams. It also supports per-GPU memory allocation which enables multiple processes to run on a single GPU if there is enough memory and under-utilized compute units.", "In the rest of the article, we explain what we have done for sharing multiple GPUs between users. In a multi-GPU workstation, creating user groups for each GPU driver file allows us to grant permission for using a specific GPU to a specific user. Now, only the specified GPUs will be visible to the users. We explain the commands necessary to create user restrictions on GPUs on a 4-GPU workstation.", "Step 1: Create the groups and add the users to the groups. We need to create 4 groups as we have 4 GPUs:", "Step 2: Create a config file at /etc/modprob.d/nvidia.conf with the following content:", "This config file will load 4 NVIDIA\u2019s driver parameters into the Linux\u2019s kernel. One issue with NVIDIA\u2019s driver file is that they get regenerated after every session which destroys the user access restrictions we are going to set on the driver files. NVreg_ModifyDeviceFiles ensures that driver files are generated once and will not change in the future. The other parameters are setting a default user- and group-IDs with 777 access permission. If there is already an NVIDIA config file at /etc/modprob.d/, you can keep a backup of it and replace its content with our provided script.", "Step 3: Create a script to load the NVIDIA\u2019s driver at /etc/init.d/gpu-restriction.", "Then, enter the following command which will tell the Linux to load the script after re-boots:", "Now, we have a Linux service which we can start by the following command:", "Reboot the machine. You are all set now!", "The core part of the script which loads the NVIDIA\u2019s driver is:", "The above script first will load the NVIDIA modules nvidia and nvidia_uvm. For setting the user access restriction, in a loop over all the PCI express devices, we find if their vendor and class IDs match an NVIDIA GPU card. Afterward, we create the driver file of each GPU, then we set the groups and access restrictions (660) on them. The driver files are located at /dev/nvidia0, \u2026, /dev/nvidia3 are set.", "We recommend to first run the above script in an executable file to test if it works fine. I would appreciate letting me know if you find any issues in the tutorial.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Computer Scientist \ud83d\udcbb LA \ud83c\udfdd more at: https://amirerfan.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6971a658a9ce&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://amirerfan.medium.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": ""}, {"url": "https://amirerfan.medium.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Erfan Eshratifar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd0cfdf63c7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&user=Erfan+Eshratifar&userId=d0cfdf63c7e3&source=post_page-d0cfdf63c7e3----6971a658a9ce---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://lambdalabs.com/deep-learning/workstations/4-gpu", "anchor_text": "Lambda Lab\u2019s 4-GPU"}, {"url": "https://docs.nvidia.com/grid/latest/grid-vgpu-user-guide/index.html", "anchor_text": "NVIDIA\u2019s GPU virtualization software"}, {"url": "https://www.nvidia.com/en-us/design-visualization/technologies/turing-architecture/", "anchor_text": "NVIDIA Turing\u2122"}, {"url": "https://www.nvidia.com/en-us/data-center/volta-gpu-architecture/", "anchor_text": "Volta\u2122"}, {"url": "https://www.nvidia.com/en-us/data-center/pascal-gpu-architecture/", "anchor_text": "Pascal\u2122"}, {"url": "https://developer.nvidia.com/maxwell-compute-architecture", "anchor_text": "Maxwell\u2122"}, {"url": "https://blogs.nvidia.com/blog/2018/06/11/what-is-a-virtual-gpu/", "anchor_text": "Source"}, {"url": "https://en.wikipedia.org/wiki/Slurm_Workload_Manager", "anchor_text": "Source"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----6971a658a9ce---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/linux?source=post_page-----6971a658a9ce---------------linux-----------------", "anchor_text": "Linux"}, {"url": "https://medium.com/tag/servers?source=post_page-----6971a658a9ce---------------servers-----------------", "anchor_text": "Servers"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----6971a658a9ce---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/gpu-computing?source=post_page-----6971a658a9ce---------------gpu_computing-----------------", "anchor_text": "Gpu Computing"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&user=Erfan+Eshratifar&userId=d0cfdf63c7e3&source=-----6971a658a9ce---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&user=Erfan+Eshratifar&userId=d0cfdf63c7e3&source=-----6971a658a9ce---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6971a658a9ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6971a658a9ce---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6971a658a9ce--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6971a658a9ce--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6971a658a9ce--------------------------------", "anchor_text": ""}, {"url": "https://amirerfan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://amirerfan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Erfan Eshratifar"}, {"url": "https://amirerfan.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "27 Followers"}, {"url": "https://amirerfan.com", "anchor_text": "https://amirerfan.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd0cfdf63c7e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&user=Erfan+Eshratifar&userId=d0cfdf63c7e3&source=post_page-d0cfdf63c7e3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc68d83c415a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefining-user-restrictions-for-gpus-6971a658a9ce&newsletterV3=d0cfdf63c7e3&newsletterV3Id=c68d83c415a&user=Erfan+Eshratifar&userId=d0cfdf63c7e3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}