{"url": "https://towardsdatascience.com/automate-your-ml-model-retraining-with-kubeflow-316f35afe19f", "time": 1683017886.134848, "path": "towardsdatascience.com/automate-your-ml-model-retraining-with-kubeflow-316f35afe19f/", "webpage": {"metadata": {"title": "Automate your ML model retraining with Kubeflow | by Marc Djohossou | Towards Data Science", "h1": "Automate your ML model retraining with Kubeflow", "description": "This is the first part of a 3 parts series where I explain how you can build a cost-efficient and automated ML retraining system with Kubeflow. Along the way, we\u2019ll also pick some best practices\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/google-cloud/easily-improve-your-company-machine-learning-system-with-cost-efficient-automated-model-retraining-57511b780083", "anchor_text": "this article", "paragraph_index": 2}, {"url": "https://www.kubeflow.org/docs/started/getting-started/", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://cloud.google.com/sql", "anchor_text": "Google Cloud SQL instance", "paragraph_index": 10}, {"url": "https://towardsdatascience.com/automate-your-cloud-sql-data-synchronization-to-bigquery-with-airflow-7f9d992da18f", "anchor_text": "this article", "paragraph_index": 10}, {"url": "https://cloud.google.com/ai-platform", "anchor_text": "AI Platform", "paragraph_index": 14}, {"url": "https://cloud.google.com/storage?hl=fr", "anchor_text": "Google Cloud Storage", "paragraph_index": 16}, {"url": "https://gitlab.com/marcdjoh/tensorflow-taxi-fare-predictor-kubeflow", "anchor_text": "gitlab repository", "paragraph_index": 25}, {"url": "https://gitlab.com/marcdjoh/tensorflow-taxi-fare-predictor-kubeflow/-/blob/master/README.md", "anchor_text": "readme", "paragraph_index": 25}], "all_paragraphs": ["This is the first part of a 3 parts series where I explain how you can build a cost-efficient and automated ML retraining system with Kubeflow. Along the way, we\u2019ll also pick some best practices around building pipelines.", "While Kubeflow Pipelines isn\u2019t yet the most popular batch jobs orchestrator, a growing number of companies is adopting it to handle their data and ML jobs orchestration and monitoring. Actually, Kubeflow is designed to benefit from Kubernetes strengths and that\u2019s what makes it very attractive.", "In this article, I\u2019ll show you how you can build an automated and cost-efficient ML model retraining pipeline using Kubeflow Pipelines. As you might already know, retraining ML models is necessary to keep them accurate and cure the model drift curse. In case you are familiar with Airflow or planning to use it, make sure to have a look at this article where I demo how to build the exact retraining system using Airflow.", "Now, let\u2019s say you have created a nice ML model to predict the taxi fare of a car drive and serve a first version of the model. The retraining system you\u2019ll be building is made of 2 pipelines:", "To make things look real, you\u2019ll also create two additional pipelines to send predictions to the live version of the model, one of which sends inputs that are purposely far from the inputs from the training set. The goal here is to simulate a model drift and have our retraining-checker pipeline triggers the taxi-fare-predictor pipeline. Please, bear with me till the end to build the solution pictured below.", "There are three ways to build a Kubeflow pipeline component:", "By the end of this article, you will get", "The steps you take to build the concept drift mitigation solution include:", "Sounds great? Then let\u2019s jump right into it!", "Kubeflow is an open source framework and can be installed wherever there is a Kubernetes cluster up and running. You\u2019ll find here useful guidance toward installing Kubeflow the way that best suits you. You can also install Kubeflow Pipelines only, which is the component of Kubeflow that this article is about.", "To be able to detect and handle model drift, our system uses a Postgres database hosted in a Google Cloud SQL instance to store training jobs metrics and prediction results. A Cloud SQL proxy is deployed in the Kubeflow cluster as a service to provide an encrypted connection to the Postgres database. To learn more about connecting securely to Cloud SQL from Kubernetes, check this article.", "It\u2019s perfectly fine to choose another database as long as you plan for a secure way to allow any pod running on your Kubeflow cluster to connect to the database.", "The database shall contain the following tables:", "Model drift mitigation is achieved simply by retraining the model with newer data. Here, we assume that there is another process responsible for fetching new data and storing it in the same repository where we read our training and evaluation data from.", "This retraining happens in the first step of the taxi-fare-predictor pipeline in the component named \u2018Submitting a Cloud ML training job as a pipeline step\u2019. An ML training job is then submitted to AI Platform which is the AI service of Google Cloud Platform.", "The \u2018Submitting a Cloud ML training job as a pipeline step\u2019 is defined as a yaml file following the Pipelines Component specification. All you have to do is to load that yaml file into a component and then use it in your pipeline.", "When the model is trained, it exports its metrics in a csv file in Google Cloud Storage. Which is why you need to download and store those metrics in the Postgres database hosted in Google Cloud SQL. To accomplish that, firstly, a python self contained function is used for the file download.", "Secondly, the code to store metrics in Cloud SQL is packaged in a docker image, which is used to create a pipeline component.", "Remember, the goal here is not only to retrain a model, but also to serve it for predictions if that newly retrained model is better than the live one. That\u2019s why there are three additional components to get the model location, check if the new model is superior to the current one (check-deploy) and launch the new model serving if it happens to be better. The whole model drift mitigation pipeline is pictured below.", "You now have the retraining pipeline but you are left with one question. How do you automate the execution of the retraining pipeline?", "The easiest answer is to schedule a recurrent run for it. For instance, you specify that it should run every hour, day or month, depending on how quickly you expect the model to drift. This solution comes with a major drawback though: Unnecessary model retraining can be costly.", "A better approach is to check whether the model has already drifted or not and launch the retraining pipeline accordingly. In a nutshell, we consider that the model has drifted if there is a huge gap between the training set label mean and the model predictions mean. This is achieved via the retraining-checker pipeline pictured below. You want to schedule it so that it runs as often as needed so that a model drift is cured very fast.", "The trigger-model-training component thus runs conditionally to the is-retraining-needed component.", "Being able to trigger externally a pipeline is a really useful feature. This is the only purpose of the trigger-model-training component. The component submits input for the retraining pipeline and triggers a run. Depending on where your Kubeflow Pipeline runs, you might need to provide the Kubeflow endpoint (host) as an input to the component.", "Hopefully, I was able to share how I managed to build a ML model retraining system using Kubeflow Pipelines and Cloud SQL. The key differentiator of the system is that it is automated and economical. As for the best practices around writing Kubeflow pipelines, the main takeaway I think, is that the best approach for building pipeline components is to define them as yaml files that can be shared and reused between pipelines and teams.", "The complete code I used is readily available in this gitlab repository. Feel free to check it out as well as the readme.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer/ Data Engineer/ Google Cloud Certified"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F316f35afe19f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://marcgeremie.medium.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": ""}, {"url": "https://marcgeremie.medium.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Marc Djohossou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd99fd7fe99ef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&user=Marc+Djohossou&userId=d99fd7fe99ef&source=post_page-d99fd7fe99ef----316f35afe19f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@heytowner?utm_source=medium&utm_medium=referral", "anchor_text": "JOHN TOWNER"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/google-cloud/easily-improve-your-company-machine-learning-system-with-cost-efficient-automated-model-retraining-57511b780083", "anchor_text": "this article"}, {"url": "https://www.kubeflow.org/docs/pipelines/reference/component-spec/", "anchor_text": "Kubeflow Pipelines component specification"}, {"url": "https://www.kubeflow.org/docs/started/getting-started/", "anchor_text": "here"}, {"url": "https://cloud.google.com/sql", "anchor_text": "Google Cloud SQL instance"}, {"url": "https://towardsdatascience.com/automate-your-cloud-sql-data-synchronization-to-bigquery-with-airflow-7f9d992da18f", "anchor_text": "this article"}, {"url": "https://cloud.google.com/ai-platform", "anchor_text": "AI Platform"}, {"url": "https://cloud.google.com/storage?hl=fr", "anchor_text": "Google Cloud Storage"}, {"url": "https://gitlab.com/marcdjoh/tensorflow-taxi-fare-predictor-kubeflow", "anchor_text": "gitlab repository"}, {"url": "https://gitlab.com/marcdjoh/tensorflow-taxi-fare-predictor-kubeflow/-/blob/master/README.md", "anchor_text": "readme"}, {"url": "https://medium.com/tag/kubeflow-pipelines?source=post_page-----316f35afe19f---------------kubeflow_pipelines-----------------", "anchor_text": "Kubeflow Pipelines"}, {"url": "https://medium.com/tag/python-programming?source=post_page-----316f35afe19f---------------python_programming-----------------", "anchor_text": "Python Programming"}, {"url": "https://medium.com/tag/postgres?source=post_page-----316f35afe19f---------------postgres-----------------", "anchor_text": "Postgres"}, {"url": "https://medium.com/tag/ai-platform?source=post_page-----316f35afe19f---------------ai_platform-----------------", "anchor_text": "Ai Platform"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----316f35afe19f---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&user=Marc+Djohossou&userId=d99fd7fe99ef&source=-----316f35afe19f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&user=Marc+Djohossou&userId=d99fd7fe99ef&source=-----316f35afe19f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F316f35afe19f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----316f35afe19f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----316f35afe19f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----316f35afe19f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----316f35afe19f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----316f35afe19f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----316f35afe19f--------------------------------", "anchor_text": ""}, {"url": "https://marcgeremie.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://marcgeremie.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Marc Djohossou"}, {"url": "https://marcgeremie.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "134 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd99fd7fe99ef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&user=Marc+Djohossou&userId=d99fd7fe99ef&source=post_page-d99fd7fe99ef--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc370774609f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomate-your-ml-model-retraining-with-kubeflow-316f35afe19f&newsletterV3=d99fd7fe99ef&newsletterV3Id=c370774609f8&user=Marc+Djohossou&userId=d99fd7fe99ef&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}