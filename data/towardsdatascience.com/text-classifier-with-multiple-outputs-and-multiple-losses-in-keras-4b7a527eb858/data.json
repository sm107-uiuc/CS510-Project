{"url": "https://towardsdatascience.com/text-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858", "time": 1683007099.372842, "path": "towardsdatascience.com/text-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858/", "webpage": {"metadata": {"title": "Text Classifier with Multiple Outputs and Multiple Losses in Keras | by Daniel Da Costa | Towards Data Science", "h1": "Text Classifier with Multiple Outputs and Multiple Losses in Keras", "description": "In this post, we'll go through the definition of a multi-label classifier, multiple losses, text preprocessing and a step-by-step explanation on how to build a multi-output RNN-LSTM in Keras. The\u2026"}, "outgoing_paragraph_urls": [{"url": "https://appen.com/", "anchor_text": "Figure Eight", "paragraph_index": 1}, {"url": "https://keras.io/models/model/", "anchor_text": "Keras documentation", "paragraph_index": 7}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "Keras functional API", "paragraph_index": 13}, {"url": "https://keras.io/models/sequential/", "anchor_text": "Sequential API", "paragraph_index": 13}, {"url": "https://www.aclweb.org/anthology/C16-1229.pdf", "anchor_text": "this article", "paragraph_index": 17}, {"url": "https://github.com/keras-team/keras/issues/8011", "anchor_text": "open issue", "paragraph_index": 24}, {"url": "https://github.com/DanielDaCosta/RNN-Keras", "anchor_text": "Here", "paragraph_index": 26}, {"url": "https://nlp.stanford.edu/projects/glove/", "anchor_text": "Pre-trained GloVe vectors", "paragraph_index": 26}], "all_paragraphs": ["In this post, we'll go through the definition of a multi-label classifier, multiple losses, text preprocessing and a step-by-step explanation on how to build a multi-output RNN-LSTM in Keras.", "The dataset that we'll be working on consists of natural disaster messages that are classified into 36 different classes. The dataset was provided by Figure Eight. Example of input messages:", "Before explaining what it is, let's first go through the definition of a more common classification type: Multiclass. In a multiclass, the classes are mutually exclusive, i.e, you can only classify one class at a time. For example, if you have the classes: {Car, Person, Motorcycle}, your model will have to output: Car OR Person OR Motorcycle. For this kind of problem, a Softmax function is used for classification:", "For the multi-label classification, a data sample can belong to multiple classes. From the example above, your model can classify, for the same sample, the classes: Car AND Person (imagining that each sample is an image that may contain these 3 classes).", "In the studied dataset, there are 36 different classes where 35 of them have a binary output: 0 or 1; and 1 of them has 3 possible classes (a multiclass case): 0, 1 or 2.", "Using multiple loss functions in the same model means that you are doing different tasks and sharing part of your model between these tasks. Sometimes, you may think that maybe it's better to build different models for each different type of output, but in some situations sharing some layers of your Neural Network helps the models generalize better.", "How does Keras handle multiple losses?", "From the Keras documentation, \"\u2026the loss value that will be minimized by the model will then be the weighted sum of all individual losses, weighted by the loss_weightscoefficients.\". Therefore, the final loss is a weighted sum of each loss, passed to the loss parameter.", "In the studied case, two different losses will be used:", "Just like any other NLP problem, before applying the text input data into the model, we have to preprocess it. In this dataset, punctuations, url links and '@' mentions were removed. Even though '@' mentions adds some information to the message, it doesn't add value to the classification model. Hashtags ('#') may contain useful information since they are usually related to events. Therefore, they were kept, removing only the '#' character.", "Stop words (most common words in a language) removal and lemmatization were also applied to the dataset.", "The text samples are formatted into tensors that can be fed into a neural network using Keras utilities:", "The above procedure includes mainly 3 steps :", "For building this model we'll be using Keras functional API and not the Sequential API since the first allows us to build more complex models, such as multiple outputs and inputs problems.", "In order to summarize what we have until now:", "In this section, we\u2019ll be training our own embeddings using Keras Embedding Layer.", "The Embedding layer takes as input:", "A Convolutional layer was added before the LSTM in order to speed-up the training time. CNN are more likely to extract local and deep features from sentences. You can read more about the CNN and RNN combination in this article.", "The majority of the output classes are binary, but one of them is a multiclass output. As explained in the Multiple Losses section, the losses used are: binary_crossentropy and sparse_categorical_crossentropy .", "Since the dataset is highly imbalanced, the class_weight parameter was added in order to reduce the imbalanced distributions. A Dense layer will be created for each output. The outputs will be stored into an array, while the metrics and losses, for each output, will be stored into corresponding dictionaries.", "The above code iterates through each of the output binary columns and creates a dense layer, saving the corresponding metric and loss into a dictionary.", "The code below applies the same process to the single multiclass output column.", "For each output we then define the weight for each class in a dictionary format:", "We then can instantiate a Model class and train our model:", "Apparently, Keras has an open issue with class_weights and binary_crossentropy for multi label outputs. The solution proposed above, adding one dense layer per output, is a valid solution.", "In this post, we\u2019ve built a RNN text classifier using Keras functional API with multiple outputs and losses. We walked through an explanation about multiple losses and also the difference between a multi-label and multiclass classification problem.", "You can check the full code, with extra analysis, in Here! In this post, we trained our own embeddings, in the GitHub Repo you can check the same model retrained using Pre-trained GloVe vectors.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Graduate at University of Southern California | MS \u00c9cole CentraleSup\u00e9lec | BSc PUC-Rio | Data Scientist with 2+ years of industrial experience"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4b7a527eb858&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://danielpdacosta.medium.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": ""}, {"url": "https://danielpdacosta.medium.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Daniel Da Costa"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F258c9a19b29f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&user=Daniel+Da+Costa&userId=258c9a19b29f&source=post_page-258c9a19b29f----4b7a527eb858---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://appen.com/", "anchor_text": "Figure Eight"}, {"url": "https://keras.io/models/model/", "anchor_text": "Keras documentation"}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "Keras functional API"}, {"url": "https://keras.io/models/sequential/", "anchor_text": "Sequential API"}, {"url": "https://www.aclweb.org/anthology/C16-1229.pdf", "anchor_text": "this article"}, {"url": "https://github.com/keras-team/keras/issues/8011", "anchor_text": "open issue"}, {"url": "https://github.com/DanielDaCosta/RNN-Keras", "anchor_text": "Here"}, {"url": "https://nlp.stanford.edu/projects/glove/", "anchor_text": "Pre-trained GloVe vectors"}, {"url": "https://medium.com/towards-artificial-intelligence/keras-for-multi-label-text-classification-86d194311d0e", "anchor_text": "Keras for Multi-label Text ClassificationCNNs and LSTMs architectures for Multi-Label Text Classification using Kerasmedium.com"}, {"url": "https://stats.stackexchange.com/questions/323961/how-to-define-multiple-losses-in-machine-learning", "anchor_text": "How to define multiple losses in machine learning?begingroup$ Using two losses means that you are interested in optimizing both of them. It may come from that you are\u2026stats.stackexchange.com"}, {"url": "https://stackoverflow.com/questions/49404309/how-does-keras-handle-multiple-losses", "anchor_text": "How does keras handle multiple losses?From model documentation: loss: String (name of objective function) or objective function. See losses. If the model has\u2026stackoverflow.com"}, {"url": "https://cwiki.apache.org/confluence/display/MXNET/Multi-hot+Sparse+Categorical+Cross-entropy", "anchor_text": "Multi-hot Sparse Categorical Cross-entropyWhen doing multi-class classification, categorical cross entropy loss is used a lot. It compares the predicted label\u2026cwiki.apache.org"}, {"url": "https://www.kaggle.com/rajmehra03/a-detailed-explanation-of-keras-embedding-layer", "anchor_text": "A Detailed Explanation of Keras Embedding LayerExplore and run machine learning code with Kaggle Notebooks | Using data from multiple data sourceswww.kaggle.com"}, {"url": "https://medium.com/tag/keras?source=post_page-----4b7a527eb858---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/nlp?source=post_page-----4b7a527eb858---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----4b7a527eb858---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4b7a527eb858---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/word-embeddings?source=post_page-----4b7a527eb858---------------word_embeddings-----------------", "anchor_text": "Word Embeddings"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&user=Daniel+Da+Costa&userId=258c9a19b29f&source=-----4b7a527eb858---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&user=Daniel+Da+Costa&userId=258c9a19b29f&source=-----4b7a527eb858---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4b7a527eb858&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4b7a527eb858---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4b7a527eb858--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4b7a527eb858--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4b7a527eb858--------------------------------", "anchor_text": ""}, {"url": "https://danielpdacosta.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://danielpdacosta.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Daniel Da Costa"}, {"url": "https://danielpdacosta.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "85 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F258c9a19b29f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&user=Daniel+Da+Costa&userId=258c9a19b29f&source=post_page-258c9a19b29f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F97829d5eb00e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftext-classifier-with-multiple-outputs-and-multiple-losses-in-keras-4b7a527eb858&newsletterV3=258c9a19b29f&newsletterV3Id=97829d5eb00e&user=Daniel+Da+Costa&userId=258c9a19b29f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}