{"url": "https://towardsdatascience.com/how-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5", "time": 1682993965.6581151, "path": "towardsdatascience.com/how-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5/", "webpage": {"metadata": {"title": "How to Train an Image Classifier in PyTorch and use it to Perform Basic Inference on Single Images | by Chris Fotache | Towards Data Science", "h1": "How to Train an Image Classifier in PyTorch and use it to Perform Basic Inference on Single Images", "description": "If you\u2019re just getting started with PyTorch and want to learn how to do some basic image classification, you can follow this tutorial. It will go through how to organize your training data, use a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/cfotache/pytorch_imageclassifier", "anchor_text": "download the notebooks", "paragraph_index": 2}, {"url": "https://medium.com/@chrisfotache/how-to-connect-to-your-cloud-hosted-ipython-jupyter-notebook-from-your-local-windows-machine-1426f1dafec2", "anchor_text": "my tutorial", "paragraph_index": 2}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch models", "paragraph_index": 9}, {"url": "https://github.com/cfotache/pytorch_imageclassifier", "anchor_text": "our repository", "paragraph_index": 16}, {"url": "http://www.cynet.ai", "anchor_text": "CYNET.ai", "paragraph_index": 23}, {"url": "http://CYNET.ai", "anchor_text": "CYNET.ai", "paragraph_index": 25}], "all_paragraphs": ["If you\u2019re just getting started with PyTorch and want to learn how to do some basic image classification, you can follow this tutorial. It will go through how to organize your training data, use a pretrained neural network to train your model, and then predict other images.", "For this purpose, I\u2019ll be using a dataset consisting of map tiles from Google Maps, and classifying them according to the land features they contain. I\u2019ll write another story about how I use it (in brief: in order to identify safe areas for a drone to fly over or to land). But for now, I just want to use some training data in order to classify these map tiles.", "The code snippets below are from a Jupyter Notebook. You can stitch them together to build your own Python script, or download the notebooks from GitHub. The notebooks are originally based on the PyTorch course from Udacity. And if you use a cloud VM for your deep learning development and don\u2019t know how to open a notebook remotely, check out my tutorial.", "PyTorch expects the data to be organized by folders with one folder for each class. Most of the other PyTorch tutorials and examples expect you to further organize it with a training and validation folder at the top, and then the class folders inside them. But I think this is very cumbersome, to have to pick a certain number of images from each class and move them from the training to the validation folder. And since most people would do that by selecting a contiguous group of files, there might be a lot of bias in that selection.", "So here\u2019s a better way of splitting the dataset into a training and test set on the fly, like Python developers are used to from SKLearn. But first, let\u2019s import the modules:", "Next we\u2019ll define the train / validation dataset loader, using the SubsetRandomSampler for the split:", "Next we\u2019ll determine whether we have GPU or not. I assume that if you\u2019re doing this you have a GPU-powered machine, otherwise the code will be at least 10 times slower. But it\u2019s a good idea to generalize and check for the GPU availability.", "We\u2019ll also load a pretrained model. For this case, I chose ResNet 50:", "Printing the model will show you the layer architecture of the ResNet model. It\u2019s probably beyond mine or your comprehension but it\u2019s still interesting to see what\u2019s inside those deep hidden layers.", "It\u2019s up to you what model you choose, and it might be a different one based on your particular dataset. Here is a list of all the PyTorch models.", "Now we\u2019re getting into the interesting part of the deep neural network. First, we have to freeze the pre-trained layers, so we don\u2019t backprop through them during training. Then, we re-define the final fully-connected the layer, the one that we\u2019ll train with our images. We also create the criterion (the loss function) and pick an optimizer (Adam in this case) and learning rate.", "And now finally, let\u2019s train our model! There\u2019s just one epoch in this example but in most cases you\u2019ll need more. The basic process is quite intuitive from the code: You load the batches of images and do the feed forward loop. Then calculate the loss function, and use the optimizer to apply gradient descent in back-propagation.", "It\u2019s that simple with PyTorch. Most of the code below deals with displaying the losses and calculate accuracy every 10 batches, so you get an update while training is running. During validation, don\u2019t forget to set the model to eval() mode, and then back to train() once you\u2019re finished.", "And\u2026 after you wait a few minutes (or more, depending on the size of your dataset and the number of epochs), training is done and the model is saved for later predictions!", "There is one more thing you can do now, which is to plot the training and validation losses:", "As you can see, in my particular example with one epoch, the validation loss (which is what we\u2019re interested in) flatlines towards the end of the first epoch and even starts an upward trend, so probably 1 epoch is enough. The training loss, as expected, is very low.", "Now on to the second part. So you trained your model, saved it, and need to use it in an application. For that, you\u2019ll need to be able to perform simple inference on an image. You can find this demo notebook as well in our repository. We import the same modules as in the training notebook and then define again the transforms. I only declare the image folder again so I can use some examples from there:", "Then again we check for GPU availability, load the model and put it into evaluation mode (so parameters are not altered):", "The function that predicts the class of a specific image is very simple. Note that it requires a Pillow image, not a file path.", "Now for easier testing, I also created a function that will pick a number of random images from the dataset folders:", "Finally, to demo the prediction function, I get the random image sample, predict them and display the results:", "Here\u2019s one example of such predictions on Google Map tiles. The label is the predicted class, and I\u2019m also displaying whether it was a correct prediction or not.", "And this is pretty much it. Go ahead and try it on your datasets. As long as you organize your images properly, this code should work as is. Soon I\u2019ll have more stories about other cool stuff you can do with neural networks and PyTorch.", "Chris Fotache is an AI researcher with CYNET.ai based in New Jersey. He covers topics related to artificial intelligence in our life, Python programming, machine learning, computer vision, natural language processing and more.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AI researcher at CYNET.ai, writing about artificial intelligence, Python programming, machine learning, computer vision, robotics, natural language processing"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F99465a1e9bf5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://chrisfotache.medium.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": ""}, {"url": "https://chrisfotache.medium.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Chris Fotache"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F66c5402b8ebc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&user=Chris+Fotache&userId=66c5402b8ebc&source=post_page-66c5402b8ebc----99465a1e9bf5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/cfotache/pytorch_imageclassifier", "anchor_text": "download the notebooks"}, {"url": "https://medium.com/@chrisfotache/how-to-connect-to-your-cloud-hosted-ipython-jupyter-notebook-from-your-local-windows-machine-1426f1dafec2", "anchor_text": "my tutorial"}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch models"}, {"url": "https://github.com/cfotache/pytorch_imageclassifier", "anchor_text": "our repository"}, {"url": "http://www.cynet.ai", "anchor_text": "CYNET.ai"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----99465a1e9bf5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----99465a1e9bf5---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----99465a1e9bf5---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----99465a1e9bf5---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/python?source=post_page-----99465a1e9bf5---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&user=Chris+Fotache&userId=66c5402b8ebc&source=-----99465a1e9bf5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&user=Chris+Fotache&userId=66c5402b8ebc&source=-----99465a1e9bf5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F99465a1e9bf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----99465a1e9bf5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----99465a1e9bf5--------------------------------", "anchor_text": ""}, {"url": "https://chrisfotache.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://chrisfotache.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Chris Fotache"}, {"url": "https://chrisfotache.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "524 Followers"}, {"url": "http://CYNET.ai", "anchor_text": "CYNET.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F66c5402b8ebc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&user=Chris+Fotache&userId=66c5402b8ebc&source=post_page-66c5402b8ebc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8aead7a76a4f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-an-image-classifier-in-pytorch-and-use-it-to-perform-basic-inference-on-single-images-99465a1e9bf5&newsletterV3=66c5402b8ebc&newsletterV3Id=8aead7a76a4f&user=Chris+Fotache&userId=66c5402b8ebc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}