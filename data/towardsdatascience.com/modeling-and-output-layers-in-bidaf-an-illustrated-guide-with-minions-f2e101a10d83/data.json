{"url": "https://towardsdatascience.com/modeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83", "time": 1683000207.099297, "path": "towardsdatascience.com/modeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83/", "webpage": {"metadata": {"title": "Modeling and Output Layers in BiDAF \u2014 an Illustrated Guide with Minions | by Meraldo Antonio | Towards Data Science", "h1": "Modeling and Output Layers in BiDAF \u2014 an Illustrated Guide with Minions", "description": "BiDAF is a popular NLP model. With the help of some cute Minions, this article will explain the modeling layer of BiDAF."}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1611.01603", "anchor_text": "Bi-Directional Attention Flow (BiDAF)", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/meraldo/", "anchor_text": "LinkedIn", "paragraph_index": 50}, {"url": "https://arxiv.org/abs/1611.01603", "anchor_text": "Bi-Directional Attention Flow for Machine Comprehension (Minjoon Seo et. al, 2017)", "paragraph_index": 51}, {"url": "https://www.linkedin.com/in/meraldo/", "anchor_text": "LinkedIn", "paragraph_index": 52}, {"url": "https://medium.com/@meraldo.antonio/membership", "anchor_text": "my referral link", "paragraph_index": 52}], "all_paragraphs": ["This article is the last in a series of four articles that aim to illustrate the working of Bi-Directional Attention Flow (BiDAF), a popular machine learning model for question and answering (Q&A).", "To recap, BiDAF is an closed-domain, extractive Q&A model. This means that to be able to answer a Query, BiDAF needs to consult an accompanying text that contains the information needed to answer the Query. This accompanying text is called the Context. BiDAF works by extracting a substring of the Context that best answers the query \u2014 this is what what we refer to as the Answer to the Query. I intentionally capitalize the words Query, Context and Answer to signal that I am using them in their specialized technical capacities.", "A quick summary of the three preceding articles are as follows:", "The output of the aforementioned attention step is a giant matrix called G. G is a 8d-by-T matrix that encodes the Query-aware representations of Context words. G is the input to the modeling layer, which will be the focus of this article.", "Ok, so I know we\u2019ve been through a lot of steps in the past three articles. It is extremely easy to get lost in the myriad of symbols and equations, especially considering that the choices of symbols in the BiDAF paper aren\u2019t that \u201cuser friendly.\u201d I mean, do you even remember what each of H, U, \u0124 and \u0168 represents?", "Hence, let\u2019s now step back and try to get the intuition behind all these matrix operations we have been doing so far.", "Practically, all the previous steps can be broken down to two collection of steps: the embedding steps and the attention steps. As I mentioned above, the result of all these steps is an 8d-by-T matrix called G.", "An example of G can be seen below. Each column of G is an 8d-by-1 vector representation of a word in the Context.", "Let\u2019s now play a little game that (hopefully) can help you understand all the mathematical mumbo-jumbo in the previously articles. Specifically, let\u2019s think of the words in the Context as an ordered bunch of Minions.", "Each of our Minions has a brain in which he can store some information. Right now, our Minions\u2019 brains are already pretty cramped. The current brain content of each Minion is equivalent to the 8d-by-1 column vector of the Context word that the Minion represents. Here I present the brain scan of the \u201cSingapore\u201d Minion:", "The Minions\u2019 brains haven\u2019t always been this full! In fact, when they came into being, their brains were pretty much empty. Let\u2019s now go back in time and think about what were the \u201clessons\u201d that the Minions went through to acquire their current state of knowledge.", "The first two lessons the Minions had were \u201cWord Embedding\u201d and \u201cCharacter Embedding.\u201d During these lessons, the Minions learned about their own identities. The teacher in the \u201cWord Embedding\u201d class, Prof. GloVe, teaches the Minions basic information about their identities. On the other hand, the \u201cCharacter Embedding\u201d class is an anatomy class in which the Minions gained an understanding of their body structure through repeated scans.", "Here is the brain scan of the \u201cSingapore\u201d Minion after these two lessons.", "Right after, the Minions moved on and attended the \u201cContextual Embedding\u201d lesson. This lesson is a conversational lesson during which the Minions had to talk to one another through a messenger app called bi-LS\u2122. The bi-LS\u2122-facilitated convo allows the Minions to learn each other\u2019s identities \u2014which they learned in the previous two lessons. Pretty neat, huh?", "I took another MRI scan of the \u201cSingapore\u201d Minion right after the \u201cContextual Embedding\u201d class. As you can see, now our little guy knows a bit more stuff!", "Our Minions were happily studying when suddenly a man barged into their school\ud83d\ude31 It turns out that his name is Mr. Query and he is a journalist. Here he is:", "Mr. Query urgently needs to collect some information for an article he is writing. Specifically, he wants to know \u201cwhere is Singapore situated.\u201d Mr. Query knows that some of our Minions hold this information in their brains.", "Our Minions, helpful as they are, want to help Mr. Query out. To do so, they will need to select several members of their team to meet with Mr. Query and deliver the information he\u2019s seeking. This bunch of Minions that have relevant information for Mr. Query and will be dispatched to him is known as the Answer Gang.", "Now, our Minions have a task to do \u2014 they need to collectively decide who should and shouldn\u2019t join the Answer Gang. They need to be careful when doing so! If they leave out from the Answer Gang too many Minions that should\u2019ve been included, Mr. Query won\u2019t get all the information he needs. This situation is called Low Recall and Mr. Query hates that.", "On the other hand, if too many unnecessary Minions join the Answer Gang, Mr. Query will be inundated with superfluous information. He calls such situation Low Precision and he doesn\u2019t like that either! Mr. Query is known to have some anger management issues \ud83d\udc7a so it\u2019s in our Minions\u2019 best interest to supply Mr. Query with just the right amount of information.", "So how do the Minions know which of them should join the Answer Gang?", "The answer to this is by organizing several meet-up sessions that are collectively called \u201cAttention.\u201d During these sessions, each Minion gets to talk to Mr. Query separately and understand his needs. In other words, the Attention sessions allow the Minions to measure their importance to Mr. Query\u2019s question.", "This is the MRI scan of the \u201cSingapore\u201d Minion\u2019s brain as he saunters away from the Attention sessions. This is equivalent to the first brain scan image I showed.", "As we can see, our Minions\u2019 brain are now pretty full. With the Minions\u2019 current state of knowledge, are they now in position to start choosing the members of the Answer Gang? Nope, not quite! They are still missing one key piece of information. Each of our Minions knows his importance to Mr. Query. However, before making this important decision, they will also need to be aware of each other\u2019s importance to Mr. Query.", "As you might\u2019ve guessed, this implies that the Minions have to talk to each other for the second time! And now you know that this conversation is done through the bi-LS\u2122 app.", "This bi-LS\u2122-facilitated conversation is also known as the \u2018modeling step\u2019 and is the focus of our current article. Let\u2019s now learn this step in detail!", "Okay, let\u2019s leave our Minions for a while and get back to symbols and equations, shall we? It\u2019s not that complicated, I promise!", "The modeling layer is relatively simple. It consists of two layers of bi-LSTM. As mentioned above, the input to the modeling layer is G. The first bi-LSTM layer converts G into 2d-by-T matrix called M1.", "M1 then acts as an input to the second bi-LSTM layer, which converts it to another 2d-by-T matrix called M2.", "The formation of M1 and M2 from G is illustrated below.", "M1 and M2 are yet another matrix representation of Context words. The difference between M1 and M2 and the previous representations of Context words are that M1 and M2 have embedded in them information about the entire Context paragraph as well as the Query.", "In Minion-speak, this means that our Minions now have all the information they need to make the decision about who should be in the Answer Gang.", "Okay, now we\u2019ve reached the finale! Just one more step and then we\u2019re done!", "For each word in the Context, we have in our disposal two numeric vectors that encode the word\u2019s relevance to the Query. That\u2019s awesome! The very last thing we need is to convert these numeric vectors to two probability values so that we can compare the Query-relevance of all Context words. And this is exactly what the output layer does.", "In the output layer, M1 and M2 are first vertically concatenated with G to form [G; M1] and [G; M2]. Both [G; M1] and [G; M2] have a dimension of 10d-by-T.", "We then obtain p1, the probability distribution of the start index over the entire Context, by the following steps:", "Similarly, we obtain p2, the probability distribution of the end index, by the following steps:", "The steps to get p1 and p2 are depicted in the diagram below:", "p1 and p2 are then used to find the best Answer span. The best Answer span is simply a substring of the Context with the highest span score. The span score, in turn, is simply the product of the p1 score of the first word in that span and the p2 score of the last word in the span. We then return the span with the highest span score as our Answer.", "An example will make this clear. As you know, we are currently dealing with the following Query/Context pair:", "After running this Query/Context pair through BiDAF, we obtain two probability vectors \u2014 p1 and p2 .", "Each word in the Context is associated with one p1 value and one p2 value. p1 values indicate the probability of the words being the start word of the answer span. Below are the the p1 values for our example:", "We see that the model thinks that the most probable start word for our Answer span is \u201cSoutheast.\u201d", "p2 values indicate the probability of the words being the last word of the Answer span. Below are the the p2 values for our example:", "We see that our model is very sure, with almost 100% certainty, that the most probable end word for our Answer span is \u201cAsia.\u201d", "If in the original Context the word with the highest p1 comes before the word with the highest p2, then we have our best Answer span already \u2014 it will simply one that begins with the former and ends with the later. This is the case in our example. As such, the Answer returned by the model will simply be \u201cSoutheast Asia.\u201d", "That\u2019s it, ladies and gentlemen \u2014 finally after 11 long steps we obtain the Answer to our Query!", "Okay, one caveat before we end this series. In the hypothetical case that the Context word with the highest p1 comes after the Context word with the highest p2, we still have a bit of work to do. In this case, we\u2019d need to generate all possible answer spans and calculate the span score for each of them. Here are some examples of possible answer spans for our Query/Context pair:", "We then take the span with the highest span score to be our Answer.", "So that was it \u2014 a detailed illustration of each step in BiDAF, from start to finish (sprinkled with a healthy dose of Minion-joy). I hope that this series has helped you in understanding this fascinating NLP model!", "If you have any questions/comments about the article or would like to reach out to me, feel free to do so either through LinkedIn or via email at meraldo.antonio AT gmail DOT com.", "[1] Bi-Directional Attention Flow for Machine Comprehension (Minjoon Seo et. al, 2017)", "If you have any comments about the article or would like to reach out to me, feel free to send me a connection through LinkedIn. Also, I\u2019d be very grateful if you could support me by becoming a Medium member through my referral link. As a member, you\u2019ll be able to read all my writings on data science and personal development and have full access to all stories on Medium.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist @ DBS \ud83c\uddf8\ud83c\uddec. Enthusiast of quantitative finance, operations research, MLOps, and Cloud Computing."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff2e101a10d83&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@meraldo.antonio?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@meraldo.antonio?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Meraldo Antonio"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65b4354e2ed8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&user=Meraldo+Antonio&userId=65b4354e2ed8&source=post_page-65b4354e2ed8----f2e101a10d83---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/ltR0yi_YwFI", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/abs/1611.01603", "anchor_text": "Bi-Directional Attention Flow (BiDAF)"}, {"url": "https://medium.com/@meraldo.antonio/the-definitive-guide-to-bi-directional-attention-flow-d0e96e9e666b", "anchor_text": "Part 1"}, {"url": "https://towardsdatascience.com/the-definitive-guide-to-bidaf-part-2-word-embedding-character-embedding-and-contextual-c151fc4f05bb", "anchor_text": "Part 2"}, {"url": "https://towardsdatascience.com/the-definitive-guide-to-bidaf-part-3-attention-92352bbdcb07", "anchor_text": "Part 3"}, {"url": "https://www.freepnglogos.com/images/minions-9701.html", "anchor_text": "Free PNG Logo"}, {"url": "https://giphy.com/gifs/minions-iUOzkJmvnFfqM", "anchor_text": "Giphy"}, {"url": "https://www.linkedin.com/in/meraldo/", "anchor_text": "LinkedIn"}, {"url": "https://arxiv.org/abs/1611.01603", "anchor_text": "Bi-Directional Attention Flow for Machine Comprehension (Minjoon Seo et. al, 2017)"}, {"url": "https://www.linkedin.com/in/meraldo/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/@meraldo.antonio/membership", "anchor_text": "my referral link"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f2e101a10d83---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f2e101a10d83---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/nlp?source=post_page-----f2e101a10d83---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f2e101a10d83---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----f2e101a10d83---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&user=Meraldo+Antonio&userId=65b4354e2ed8&source=-----f2e101a10d83---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&user=Meraldo+Antonio&userId=65b4354e2ed8&source=-----f2e101a10d83---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff2e101a10d83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f2e101a10d83---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f2e101a10d83--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f2e101a10d83--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f2e101a10d83--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@meraldo.antonio?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@meraldo.antonio?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Meraldo Antonio"}, {"url": "https://medium.com/@meraldo.antonio/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "367 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65b4354e2ed8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&user=Meraldo+Antonio&userId=65b4354e2ed8&source=post_page-65b4354e2ed8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff1745664aa6d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmodeling-and-output-layers-in-bidaf-an-illustrated-guide-with-minions-f2e101a10d83&newsletterV3=65b4354e2ed8&newsletterV3Id=f1745664aa6d&user=Meraldo+Antonio&userId=65b4354e2ed8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}