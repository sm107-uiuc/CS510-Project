{"url": "https://towardsdatascience.com/design-patterns-for-mongodb-894767315905", "time": 1683003898.387756, "path": "towardsdatascience.com/design-patterns-for-mongodb-894767315905/", "webpage": {"metadata": {"title": "Design Patterns for MongoDB. Design decisions every full stack\u2026 | by Semi Koen | Towards Data Science", "h1": "Design Patterns for MongoDB", "description": "Design decisions every full stack developer needs to make when architecting a MongoDB database. Deep dive into Polymorphic Schema and Aggregate Data Model..."}, "outgoing_paragraph_urls": [{"url": "https://www.gartner.com/reviews/customers-choice/operational-dbms", "anchor_text": "dominant in terms of popularity", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/5-key-principles-of-software-architecture-e5379cb10fd5", "anchor_text": "software architecture and patterns", "paragraph_index": 1}, {"url": "https://www.amazon.co.uk/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/", "anchor_text": "Domain Driven Design", "paragraph_index": 12}, {"url": "https://en.wikipedia.org/wiki/ACID", "anchor_text": "ACID operation", "paragraph_index": 13}, {"url": "https://docs.mongodb.com/manual/core/write-operations-atomicity/", "anchor_text": "the MongoDB manual", "paragraph_index": 13}, {"url": "https://docs.mongodb.com/manual/aggregation/", "anchor_text": "aggregation pipeline", "paragraph_index": 13}, {"url": "https://en.wikipedia.org/wiki/OLAP_cube", "anchor_text": "OLAP cubes", "paragraph_index": 21}, {"url": "https://medium.com/@semika", "anchor_text": "\u2018Follow\u2019 me", "paragraph_index": 26}], "all_paragraphs": ["Since the dawn of computing, data is ever growing \u2014 this has a direct impact on the needs for storage, processing and analytics technologies. The past decade, developers have moved from SQL to NoSQL databases, with MongoDB being dominant in terms of popularity, as an operational data store in the world of enterprise applications.", "If you have read any of my recent articles or know me in person you may realise how much I value software architecture and patterns. Most people think that they are only applicable on the server side. I truly believe though that the backend design should not be an afterthought, but a key part of the architecture. Bad design choices are explicitly affecting the solution\u2019s scalability and performance.", "As such today I will introduce you to a few practical MongoDB design patterns that any full stack developer should aim to understand, when using the MERN/MEAN collection of technologies:", "Often, we think about MongoDB as a schema-less database, but this is not quite true! It does have schema, but it is dynamic i.e. the schema is not enforced on documents of the same collection, but contrary it has the ability to change and morph; that is why it is called polymorphic schema. What it means is that diverse datasets can be stored together, which is a competitive advantage for the booming unstructured big data.", "Especially when it comes to Object Oriented Programming (OOP) and inheritance, the polymorphic capability of MongoDB becomes very handy, as developers can serialise instances of varying classes of the same hierarchy (parent-child) to the same collection, and then deserialise them back to objects.", "This is not very straight forward in relational databases as tables have fixed schemas. For example, consider a trading system: A Security base class can be derived as Stock, Equity, Option etc.", "While in MongoDB we can store the derived types in a single collection called Security and add on each document a discriminator (_t), in a relational database we have these modelling choices:", "As you can see there is a lot more code involved than in a polymorphic MongoDb collection!", "The only thing constant in life is change \u2014 this certainly holds true to a database schema and it often poses challenges and a few headaches when it comes to traditional relational database systems. The Achilles heel of a tabular schema that has been carefully engineered to be normalised by eliminating redundancy is that a small change to one table can cause a ripple of changes across the database and can spill into the server-side application code too.", "A typical approach is to stop the application, take a backup, run complex migration scripts to support the new schema, release the new version of the application to support the new schema and restart the application. With continuous deployment (CD) taking care of the application side of the release, the most time consuming task, requiring lengthy downtime, is pinned down to the database migration. Some ALTER commands executed on large tables can even take days to complete\u2026", "In MongoDB however, backwards compatibility comes out of the box, so developers account for these changes in the server-side code itself. Once the application is updated to handle the absence of a field, we can migrate the collection in question in the background while the application is still running (assuming there is more than a single node involved). When the entire collection is migrated, we can replace our application code to truly forget the old field.", "Database design is not something that is written in stone and schema changes can be vexing (if not paralysing) in legacy tabular databases, so the polymorphic feature of MongoDB is very powerful indeed.", "If you have any OOP experience, you must have come across in your career, Eric Evan\u2019s classic book Domain Driven Design that introduces the aggregate models. An aggregate is a collection of data that we interact with as a unit, and normally has more complex structure than a traditional row/record i.e. it can hold nested lists, dictionaries or other composite types.", "Atomicity is only supported within the contents of a single aggregate; in other words the aggregate forms the boundary of an ACID operation (read more on the MongoDB manual). Handling inter-aggregate relationships is more difficult than intra-aggregate ones: joins are not supported directly inside the kernel, but are managed in the application code or with the somewhat complex aggregation pipeline framework.", "In essence there is a fine balance on whether to embed related objects within one another or reference them by ID, and as most things in modelling there is not a one-stop solution on how to make this decision. It is very much context specific as it depends on how the application interacts with the data.", "Before we proceed, we need to understand what the advantages of embedding are:", "Now let\u2019s explore some points to ponder when designing our MongoDB schema, based on the type of relationship that two entities have:", "A One-to-One relationship is a type of cardinality that describes the relationship between two entities where one record from entity A is associated with one record in entity B. It can be modelled in two ways: either embedding the relationship as a sub-document, or linking to a document in a separate collection (no foreign key constraints are enforced so the relation only exists in the application level schema). It all depends upon how the data is being accessed by the application, how frequently and also the lifecycle of the dataset (i.e. if entity A is deleted, does entity B still have to exist?)", "A One-to-Many relationship refers to the relationship between two entities A and B, where one side can have one or more links to the other, while the reverse is single sided. Like a 1:1 relationship, it can also be modelled by leveraging embedding or referencing.Here are the main considerations to take into account:", "If a nested array of objects is to increase uncontrollably, embedding is not recommended as:", "In this case referencing is preferred and entities A and B are modelled as stand-alone collections. However one trade off is that we will need to perform a second query to get the details of entity B, so read performance might be impacted. An application-level join comes to the rescue: with the correct indexing (for memory optimisation) and the usage of projections (for network bandwidth reduction) the server-side joins are slightly more expensive than the ones pushed to the DB engine. The $lookup operator should be required infrequently. If we need it a lot, there is a schema-smell!", "Another option is to use pre-aggregated collections (acting as OLAP cubes) to simplify some of these joins.", "\u2757\ufe0fDenormalisation: Two contributing factors to denormalise our documents are:", "A Many-to-Many relationship refers to the relationship between two entities A and B, where both sides can have one or more links to the other. In relational databases, these cases are modelled with a junction-table, however in MongoDB we can use bi-directional embedding, so we query A to search for the embedded references of the B objects, and then query B with an$in operator to find these returned references (the reverse is also possible). And vice versa.", "Here the complexity arises from establishing an even balance between A and B, as the 16MB threshold can also be broken. In these instances, one-way embedding is recommended.", "The upshot of all of this is that MongoDB gives us the ability to design our schema to match the needs of our applications so we can get the most out of them. This flexibility is incredibly powerful but that power needs to be harnessed in terms of patterns we use in the application. \u2014 We need to remember that performance issues are frequently traced to poor schema design, as such it is essential to get it right, first time round.", "I regularly write about Leadership, Technology & Data on Medium \u2014 if you would like to read my future posts then please \u2018Follow\u2019 me!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Passionate about creating elegant software. Fuelled by iced coffees & witty words. Currently in Japan. Opinions are my own; often flawed"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F894767315905&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----894767315905--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----894767315905--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://semika.medium.com/?source=post_page-----894767315905--------------------------------", "anchor_text": ""}, {"url": "https://semika.medium.com/?source=post_page-----894767315905--------------------------------", "anchor_text": "Semi Koen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Faabf98f9b9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&user=Semi+Koen&userId=aabf98f9b9a&source=post_page-aabf98f9b9a----894767315905---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.gartner.com/reviews/customers-choice/operational-dbms", "anchor_text": "dominant in terms of popularity"}, {"url": "https://towardsdatascience.com/5-key-principles-of-software-architecture-e5379cb10fd5", "anchor_text": "software architecture and patterns"}, {"url": "https://www.amazon.co.uk/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/", "anchor_text": "Domain Driven Design"}, {"url": "https://en.wikipedia.org/wiki/ACID", "anchor_text": "ACID operation"}, {"url": "https://docs.mongodb.com/manual/core/write-operations-atomicity/", "anchor_text": "the MongoDB manual"}, {"url": "https://docs.mongodb.com/manual/aggregation/", "anchor_text": "aggregation pipeline"}, {"url": "https://en.wikipedia.org/wiki/OLAP_cube", "anchor_text": "OLAP cubes"}, {"url": "https://www.amazon.co.uk/NoSQL-Distilled-Emerging-Polyglot-Persistence/dp/0321826620", "anchor_text": "NoSQL Distilled"}, {"url": "https://www.mongodb.com/blog/post/building-with-patterns-a-summary", "anchor_text": "MongoDB University: Building with Patterns"}, {"url": "https://www.slideshare.net/mongodb/mongodb-world-2019-raiders-of-the-antipatterns-a-journey-towards-fixing-schema-mistakes-in-mongodb", "anchor_text": "MongoDB Antipatterns (MongoDb World 2019)"}, {"url": "https://dddcommunity.org", "anchor_text": "Domain Driven Design"}, {"url": "https://medium.com/@semika", "anchor_text": "\u2018Follow\u2019 me"}, {"url": "https://medium.com/tag/programming?source=post_page-----894767315905---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/database?source=post_page-----894767315905---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/software-development?source=post_page-----894767315905---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/mongodb?source=post_page-----894767315905---------------mongodb-----------------", "anchor_text": "Mongodb"}, {"url": "https://medium.com/tag/women-in-tech?source=post_page-----894767315905---------------women_in_tech-----------------", "anchor_text": "Women In Tech"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&user=Semi+Koen&userId=aabf98f9b9a&source=-----894767315905---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&user=Semi+Koen&userId=aabf98f9b9a&source=-----894767315905---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----894767315905--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F894767315905&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----894767315905---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----894767315905--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----894767315905--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----894767315905--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----894767315905--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----894767315905--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----894767315905--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----894767315905--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----894767315905--------------------------------", "anchor_text": ""}, {"url": "https://semika.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://semika.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Semi Koen"}, {"url": "https://semika.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7.7K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Faabf98f9b9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&user=Semi+Koen&userId=aabf98f9b9a&source=post_page-aabf98f9b9a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F31f7468ed9ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesign-patterns-for-mongodb-894767315905&newsletterV3=aabf98f9b9a&newsletterV3Id=31f7468ed9ff&user=Semi+Koen&userId=aabf98f9b9a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}