{"url": "https://towardsdatascience.com/beautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be", "time": 1683014638.500575, "path": "towardsdatascience.com/beautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be/", "webpage": {"metadata": {"title": "Beautiful correlation plots in R \u2014 a new approach | by Stefan Haring | Towards Data Science", "h1": "Beautiful correlation plots in R \u2014 a new approach", "description": "Everyone working with data knows that beautiful and explanatory visualization is key. After all, it's much easier to tell a story with a chart than it is with a plain table. This is especially\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/addiversitas/correally", "anchor_text": "correally", "paragraph_index": 30}, {"url": "https://towardsdatascience.com/3-easy-tricks-for-beginners-to-improve-your-plotly-charts-in-r-86d65772a701", "anchor_text": "my post", "paragraph_index": 31}], "all_paragraphs": ["Everyone working with data knows that beautiful and explanatory visualization is key. After all, it's much easier to tell a story with a chart than it is with a plain table. This is especially important when you\u2019re creating reports and dashboards whose aim it is to give your users and clients a quick overview over sometimes very complex and big datasets.", "One type of data that is not trivial to visualize in an explanatory way is a correlation matrix. In this post, we are going to take a look at transforming a correlation matrix into a beautiful, interactive and very descriptive chart using R and the plotly library.", "Update (2020\u201310\u201304): I had to replace some of the plotly linked charts with static images because they were not displayed properly on mobile.", "In our example, we are going to use the mtcars dataset to calculate the correlation between 6 variables.", "This gives us the correlation matrix that we are going to work with.", "Now while all the information is there, it is not particularly easy to digest all the information in one go. Enter charts, specifically heatmaps.", "As a starting point, base R provides us with the heatmap() function that lets us visualize the data at least a little bit better.", "While this is a first step in the right direction, this chart is still not very descriptive and, on top of that, it is not interactive! Ideally, we want to include our final product in a nice Shiny dashboard and enable our users and clients to interact with it.", "Plotly.js is a JavaScript Graphing Library that is built on top of d3.js and stack.gl that allows users to easily create interactive charts. It is free and open source, and luckily for us, an R implementation exists!", "This is again an improvement. Our correlation matrix is now displayed as an interactive chart and we have a colorbar indicating the strength of the correlation.", "However, when taking just a quick glance at the chart, what jumps out? Are you able to identify the strongest and weakest correlations immediately? Probably not! And there is also lots of unnecessary data displayed. By definition, a correlation matrix is symmetric and therefore contains each correlation twice. Additionally, the correlation of a variable with itself is always 1 so there is no need to have that in our chart.", "Now take a look at the following chart and try to answer the same questions.", "Much better! The chart is clean, we can immediately spot the strongest and weakest correlations, all the unnecessary data has been removed and it is still interactive and ready to be displayed as part of a beautiful dashboard!", "To achieve this we\u2019ve used a scatter plot and made the size of the squares dependant on the absolute value of the correlations.", "How can you create such a chart (with a little effort) yourself? Let\u2019s take a look!", "The first thing we need to do is to transform our data. In order to create a scatter plot suitable for our needs, all we need is a grid. For the correlation matrix, the x and y values would correspond to the variable names, but all we really need are equally spaced numeric values to create the grid. Our transformation converts our correlation matrix into a data frame with 3 columns: the x and y coordinates of the grid as well as the relevant correlations.", "You might wonder why the numeric values for the rownames are reversed in the code above. This is to ensure that the resulting plot has the main diagonal of the correlation plot going from the top left to the bottom right corner (unlike in our base R and base plotly examples above).", "As a result, we get a data frame looking like this:", "We can plot it with the following code:", "This is a good start, we have our grid set up correctly and our markers are coloured according to the correlations of our data. Admittedly, we can\u2019t really see them properly and they all have the same size. We will tackle this next.", "First, we define a size variable to be the absolute value of the correlations. To properly size the squares we need to scale them up otherwise we would just have little dots that won\u2019t tell us much. Afterwards, we can add the size to the markers.", "One step closer! The base functionality is now there, our squares are scaled correctly with the correlation and together with the colouring enable us to identify high/low correlation pairs at a glimpse.", "We will perform some cleanup next. We will correctly name our variables, remove all gridlines and remove the axis titles. To achieve this, we will set up custom axis lists. We will also center the colorbar.", "We\u2019ve already mentioned before that there is a lot of duplicated and unnecessary data displayed in a correlation matrix, due to it being symmetric. We can therefore remove all entries above and including the main diagonal (since all entries in the main diagonal are 1 by definition) in our plot. The easiest way to do this is to just set these values to NA in the original correlation matrix before we apply the transformation. Since this will lead to the first row and last column of our chart being empty, we can remove those as well.", "Plotting our chart again yields the following:", "Almost there! The last step is to add the gridlines back in, give our plot a nice background and fix info that is displayed when hovering over the squares.", "To add the grid, we will add a second trace to our plot so that we are able to have a second set of x and y axes. We will make this trace invisible so that nothing interferes with our correlation squares. Since we used unit values for placing our initial grid, we need to shift those by 0.5 to create the gridlines. We also need to make sure that our axes are plotted on the same range, otherwise everything gets shifted and messy. It sounds complicated but it is really straightforward.", "Since we have covered quite a lot to get this far, below is the full code to produce our final plot.", "After this quite lengthy description on how to create prettier charts displaying correlations we have finally arrived at our desired output. Hopefully, this post will allow you to create amazing, interactive plots that deliver insights into correlations quickly.", "Please make sure to let me know if you have any feedback or suggestions for improving what I have described in this post!", "For those interested, I have made the full code including more features available as an R package called correally.", "Also, make sure to check out my post about 3 easy tricks to improve your plotly charts to further enhance what we\u2019ve covered here!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Quant/Data Scientist/Retail Investor. Risk/Data Management/Analytics for Investment Banks, Hedge Funds & Asset Managers"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd3b93d9c77be&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@harings?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287----d3b93d9c77be---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@clintadair?utm_source=medium&utm_medium=referral", "anchor_text": "Clint Adair"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/addiversitas/correally", "anchor_text": "correally"}, {"url": "https://towardsdatascience.com/3-easy-tricks-for-beginners-to-improve-your-plotly-charts-in-r-86d65772a701", "anchor_text": "my post"}, {"url": "https://medium.com/tag/r?source=post_page-----d3b93d9c77be---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/plotly?source=post_page-----d3b93d9c77be---------------plotly-----------------", "anchor_text": "Plotly"}, {"url": "https://medium.com/tag/correlation?source=post_page-----d3b93d9c77be---------------correlation-----------------", "anchor_text": "Correlation"}, {"url": "https://medium.com/tag/charts?source=post_page-----d3b93d9c77be---------------charts-----------------", "anchor_text": "Charts"}, {"url": "https://medium.com/tag/visualization?source=post_page-----d3b93d9c77be---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&user=Stefan+Haring&userId=6c41f5dc3287&source=-----d3b93d9c77be---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&user=Stefan+Haring&userId=6c41f5dc3287&source=-----d3b93d9c77be---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd3b93d9c77be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d3b93d9c77be---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d3b93d9c77be--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/@harings/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "152 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4a0969693648&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeautiful-correlation-plots-in-r-a-new-approach-d3b93d9c77be&newsletterV3=6c41f5dc3287&newsletterV3Id=4a0969693648&user=Stefan+Haring&userId=6c41f5dc3287&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}