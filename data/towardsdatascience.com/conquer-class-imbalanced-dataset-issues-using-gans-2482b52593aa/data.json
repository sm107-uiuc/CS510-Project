{"url": "https://towardsdatascience.com/conquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa", "time": 1683001731.436866, "path": "towardsdatascience.com/conquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa/", "webpage": {"metadata": {"title": "Conquer Class Imbalanced Dataset Issues using GANs | by Swanand Mhalagi | Towards Data Science", "h1": "Conquer Class Imbalanced Dataset Issues using GANs", "description": "DC-GAN to generate images for imbalanced dataset to improve image classification using Keras. Learn tips and tricks to make GANs work for production datasets."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "Diabetic Retinopathy Detection", "paragraph_index": 10}, {"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "database", "paragraph_index": 13}, {"url": "https://arxiv.org/pdf/1612.03242v1.pdf", "anchor_text": "Text to image", "paragraph_index": 39}, {"url": "https://swanandm.github.io/IamSwan/", "anchor_text": "https://swanandm.github.io/IamSwan/", "paragraph_index": 42}], "all_paragraphs": ["A common problem in real life deep learning applications is that some classes have a significantly higher number of examples in the training set than other classes. Let\u2019s consider a manufacturer is building a visual inspection system to detect damaged products. No manufacturer will have as many damaged product images as good product images. This difference is referred to as class imbalance. Class imbalanced datasets are common across different domains such as health, banking, security and others. With such datasets, the learning algorithms are often biased towards the majority classes and therefore there is a higher miss-classification rate for the minority class instances.", "There are different strategies such as oversampling, under sampling, two phase training and cost sensitive learning to address this problem. Methods that generate artificial data for the minority class constitute a more general approach compared to algorithmic improvements. This article is all about reducing this gap in datasets using Deep Convolution Generative Adversarial Networks (DC-GAN) to improve classification performance.", "GANs are like Rubik's cube. Once you know the trick to solve the cube, there are multiple ways to get to the perfect cube. It can be as fast as 3.47 sec (current world record for 3x3 Rubik\u2019s cube) and it's easy to discover if you have messed up. But if you don\u2019t know the trick to solve the cube it can take forever. The time & cost to failure for GAN is pretty high (considering training time and dollar value of resources), especially when you have limited resources and you might still wonder what went wrong. Once you know GAN dependencies, it will be relatively easy to get to a perfect solution.", "Throughout this article we will tackle the following topics -", "Tips and tricks to make GANs work/stable -", "Developing a GAN for generating images requires a discriminator convolutional neural network model for classifying whether a given image is real or generated and a generator model that uses inverse convolutional layers to transform an input to a full two-dimensional image of pixel values.", "These generator and discriminator models compete in a zero-sum game. It means that improvements to one model come at the cost of degrading of performance in the other model. The result is a very unstable training process that can often lead to failure.", "While research in GANs continues to improve fundamental stability of these models, there are bunch of tricks to train them and make them stable.", "All such tricks we need to put together to create a perfect GAN.", "How to define GAN? How to shape GAN for real world datasets of Kaggle competitions? -", "Researchers have developed multiple flavor GANs and there are multiple solutions out there on web to address class imbalance issue but all of these are mainly on toy datasets such as MNIST, CIFAR-10 and ImageNet. I have been working on a medical image classification (Diabetic Retinopathy Detection) dataset from Kaggle competitions. This dataset has 4 classes where class 1 has 13k samples whereas class 4 has only 600. One of the recent methodology used by Kaggle competition winners to address class imbalance issue is nothing but use of DC-GAN. We will use DC-GAN to create artificial samples for class 4 of Diabetic Retinopathy Detection database.", "Let's begin the coding exercise and implement these tricks to generate new images. All the experiments are done on NVIDIA Quadro M400 GPU. This GPU has a 8 GB RAM. GPU is configured with CUDA 9.0, cuDNN 7.4, TF for GPU 1.8.0 on Ubuntu 16.04 instance.", "Import all the necessary environments. This code expects all the packages are installed beforehand.", "I have already downloaded the database from Kaggle. The images in this database are hard to distinguish by naked eyes hence this dataset is very different from all toy datasets. The database has several zip files, we need to unzip them into train/test folders containing respective images. All the labels for train images are provided in a separate csv file.", "In the code below we will read a csv file containing labels and name of the images. We need to do some sanity checks (adding .jpeg extension, delete all the images of size 0 KB, remove entries of deleted images from the data frame) before we move forward.", "In this dataset class 3 and 4 are minority classes since they have very low representation in entire dataset. We will train GAN to generate images for class 4.", "Below section defines discriminator and generator. The discriminator uses convolution layer with 2 x 2 strides to down sample the input image (Trick #1 & 2). The output layer use Sigmoid activation function to predict whether the input sample is real or fake. The model is trained to minimize binary cross entropy loss function with the use of Adam optimizer (Trick #4).", "The generator is defined with Conv2DTranspose with 2 x 2 strides to up-sample the images up-to 128 pixels. The output layer uses Tanh activation function to ensure output values are in desired range of [-1, 1] (Trick #4). We have intentionally used different learning rates for discriminator and generator (Trick #6).", "The define_gan() function uses already defined generator and discriminator models and create a new logical model.", "The function load_real_samples() below will read actual data from the dataset and normalize the images (Trick #5) before feeding them to generate_real_samples() while invoking train().", "The generate_fake_samples() function generates images with random pixel values and a fake label 0.", "There are no metrics to evaluate GAN performance, the images generated must be evaluated for quality by human operator. This makes hard to decide where to stop the training.", "Due to adversarial nature, the generator properties are changing after every epoch. Once an acceptable quality of image is generated, the generator may not improve the performance, in many cases even degrade with subsequent epochs.", "This problem is handled using 3 options", "All this action will be performed by summarize_performance() function to evaluate discriminator model. Training GAN for multiple epochs will generate snapshots of model every 10th epoch simultaneously save_plat() will keep saving images. This will be helpful to back track the progress of GAN image generation.", "The train() function is defined below, the number of batches within each epoch is defined by how many times the batch size divides into the training dataset.", "Train discriminator model is updated twice (with fake and real samples each time) and generator once for each batch iteration (Trick #7).", "It is critical to observe the loss while training the GAN, sudden drop in discriminator loss indicates that the generator model has started generating bad samples that discriminator can easily discriminate (Trick #8).", "In order to visualize the models we can plot the them using plot_model() function.", "The summary() function can also be used to see the model layout and number of trainable parameters. Call the train() function to begin the discriminator and generator training.", "The training processes will look like below snippet", "After 320 epochs, below is the quality of images I was able to produce. Training for this GAN took ~ 30 minutes. More complex generator and discriminator model could have produced better quality images.", "Progression of the GAN towards a perfect cube", "Now these newly generated minority class images can be added to the original imbalanced dataset. This will help convert imbalanced multi class data into a balanced dataset. This will improve the classification performance of the model.", "An image classification algorithm for this imbalanced dataset can be found here", "GAN has made impressive progress in its first few years. In 2017, GAN was able to create a 1024 x 1024 size images which were able to fool almost everyone. Although this kind of technology can create serious social trustworthiness issue considering the amount of fake news getting publish these days. Engineers have to be careful before developing any such application that will generate social unrest.", "Creating animation for games as well as for movies takes tremendous efforts. GAN can auto-generate these animation characters without any professional skills. Besides this, a professional animation creator can take inspiration from these designs.", "CycleGAN can transform images from one domain to another domain.", "PixelDTGAN is used to generate marketing images based on celebrity pictures. This is also used as a suggestion tool based on images.", "Text to image is one of the application of domain transfer GAN. This has tremendous applications including photo editing and computer aided design.", "Creating emoji from pictures is one of the well-known application already been used in platforms such as Snap chat and Instagram.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Investment and AI Enthusiast | Cloud Software Engineer at Intel | https://swanandm.github.io/IamSwan/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2482b52593aa&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2482b52593aa--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@swan1991m?source=post_page-----2482b52593aa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Swanand Mhalagi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9424d18458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&user=Swanand+Mhalagi&userId=fd9424d18458&source=post_page-fd9424d18458----2482b52593aa---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "Diabetic Retinopathy Detection"}, {"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "database"}, {"url": "https://towardsdatascience.com/the-quest-of-higher-accuracy-for-cnn-models-42df5d731faf", "anchor_text": "The Quest of Higher Accuracy for CNN ModelsIn this post, we will learn techniques to improve accuracy using data redesigning, hyper-parameter tuning and model\u2026towardsdatascience.com"}, {"url": "https://github.com/swanandM/DC-GAN-RetinopathyImages", "anchor_text": "https://github.com/swanandM/DC-GAN-RetinopathyImages"}, {"url": "https://github.com/swanandM/Diabetic-Retinopathy-Detection-with-TF", "anchor_text": "https://github.com/swanandM/Diabetic-Retinopathy-Detection-with-TF"}, {"url": "https://arxiv.org/pdf/1708.05509.pdf", "anchor_text": "Towards the automatic Anime characters creation with Generative Adversarial Networks"}, {"url": "https://github.com/junyanz/CycleGAN", "anchor_text": "CycleGAN"}, {"url": "https://github.com/fxia22/PixelDTGAN", "anchor_text": "PixelDTGAN"}, {"url": "https://github.com/hanzhanggit/StackGAN", "anchor_text": "StackGAN"}, {"url": "https://arxiv.org/pdf/1612.03242v1.pdf", "anchor_text": "Text to image"}, {"url": "https://arxiv.org/pdf/1611.02200.pdf", "anchor_text": "DTN"}, {"url": "https://www.sciencedirect.com/science/article/pii/S0957417417306346", "anchor_text": "Effective data generation for imbalanced learning using conditional generative adversarial networks"}, {"url": "https://machinelearningmastery.com/how-to-develop-a-generative-adversarial-network-for-a-cifar-10-small-object-photographs-from-scratch/", "anchor_text": "How to Develop a GAN to Generate CIFAR10 Small Color Photographs"}, {"url": "https://medium.com/@jonathan_hui/gan-some-cool-applications-of-gans-4c9ecca35900", "anchor_text": "Some cool applications of GAN"}, {"url": "https://github.com/soumith/ganhacks#authors", "anchor_text": "How to train a GAN?"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----2482b52593aa---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/imbalanced-data?source=post_page-----2482b52593aa---------------imbalanced_data-----------------", "anchor_text": "Imbalanced Data"}, {"url": "https://medium.com/tag/gan?source=post_page-----2482b52593aa---------------gan-----------------", "anchor_text": "Gan"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----2482b52593aa---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----2482b52593aa---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&user=Swanand+Mhalagi&userId=fd9424d18458&source=-----2482b52593aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&user=Swanand+Mhalagi&userId=fd9424d18458&source=-----2482b52593aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2482b52593aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2482b52593aa---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2482b52593aa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2482b52593aa--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2482b52593aa--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2482b52593aa--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2482b52593aa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Swanand Mhalagi"}, {"url": "https://medium.com/@swan1991m/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "67 Followers"}, {"url": "https://swanandm.github.io/IamSwan/", "anchor_text": "https://swanandm.github.io/IamSwan/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9424d18458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&user=Swanand+Mhalagi&userId=fd9424d18458&source=post_page-fd9424d18458--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F38b2eefc6408&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconquer-class-imbalanced-dataset-issues-using-gans-2482b52593aa&newsletterV3=fd9424d18458&newsletterV3Id=38b2eefc6408&user=Swanand+Mhalagi&userId=fd9424d18458&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}