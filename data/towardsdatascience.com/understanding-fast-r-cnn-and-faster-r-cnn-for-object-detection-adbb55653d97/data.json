{"url": "https://towardsdatascience.com/understanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97", "time": 1683010821.827439, "path": "towardsdatascience.com/understanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97/", "webpage": {"metadata": {"title": "Understanding Fast R-CNN and Faster R-CNN for Object Detection. | by Aakarsh Yelisetty | Towards Data Science", "h1": "Understanding Fast R-CNN and Faster R-CNN for Object Detection.", "description": "I\u2019ve discussed Object Detection and R-CNN in detail in my previous article. You can read it here to get a better intuition. One needs to know about these state-of-the-art models for Object Detection\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/understanding-object-detection-and-r-cnn-e39c16f37600", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/aakarsh-yelisetty-6b691b171/", "anchor_text": "LinkedIn", "paragraph_index": 42}, {"url": "https://towardsdatascience.com/entropy-cross-entropy-and-kl-divergence-explained-b09cdae917a", "anchor_text": "here", "paragraph_index": 43}], "all_paragraphs": ["I\u2019ve discussed Object Detection and R-CNN in detail in my previous article. You can read it here to get a better intuition.", "One needs to know about these state-of-the-art models for Object Detection which were evolved over time and are now considered as a strong foundation to much more powerful networks existing today.", "So, there are some drawbacks to using the R-CNN version for Object Detection. They are:", "Fast R-CNN, which was developed a year later after R-CNN, solves these issues very efficiently and is about 146 times faster than the R-CNN during the test time.", "The Selective Search used in R-CNN generates around 2000 region proposals for each image and each region proposal is fed to the underlying network architecture. This means, for a single image, there\u2019d be 2000 forward passes. Consider training the network with a dataset of 1000 images. That would be a total of 2M(2000 * 1000) forward passes which is huge!", "So, Fast R-CNN was based on an idea that,", "Why not consider running the CNN just once per image and then find a way to share that computation across the ~2000 proposals?", "In Fast R-CNN, the image is fed to the underlying CNN just once and the selective search is run on the other hand as usual. These region proposals generated by Selective Search are then projected on to the feature maps generated by the CNN. This process is called ROI Projection(Region Of Interest).", "Before starting with ROI Projection, one needs to know about the Sub-Sampling Ratio. It is the ratio of the feature map size to the original size of the image. For example,", "The idea of ROI projection is that we get the coordinates of the bounding box from the ROI proposal and we need to project them onto the feature maps by projecting the ROI proposal with respect to the subsampling ratio.", "The above diagram looks a bit complex but it isn\u2019t as it looks. Consider an image of size 688 x 920 is fed to a CNN whose subsampling ratio is 1/16. The resulting feature map\u2019s size then leads to 43 x 58 (688/16 x 920/16). Similarly, the size of the ROI Proposal 320 x 128, after subsampling leads to 20 x 8. Generally, the coordinates of bounding boxes are represented in 2 ways.", "Here, we consider the first notation. From the diagram, the mid-point of the ROI Proposal is (340,450) which leads to (21,28) in the feature map. In this way, the ROI Proposal is projected on to the feature map.", "The main reason behind the usage of fixed size images for the network is because of the Fully Connected Layers. These expect fixed size vectors as there are fixed weights allocated. This is the main reason why variable sized images aren\u2019t accepted by the network. To solve this, the authors of Fast R-CNN came up with an idea of ROI Pooling where the ROI Projection on the feature map is divided into fixed dimensions.", "As shown above, consider the red box as the ROI Projection onto the 8 x 8 feature map. Let\u2019s assume that we need a 2 x 2 dimensioned output. Then dividing them equally may not be possible if there is an odd-numbered dimension. In such cases, we\u2019ll round off to the nearest value. As shown, assume we get a 5 x 4 sized proposal. To convert it into a fixed dimensional box, we divide the height and width to that of the required ones i.e., 5/2 x 4/2 = 2.5 x 2. Rounding it on them, either way gives 2 x 2 and 3 x 2. Then each block is max-pooled and the output is calculated. In this way, we get a fixed dimensional output for any variable-sized region proposal. So now, there\u2019s no restriction on the size of the input.", "As there\u2019s also the third dimension involved which is depth in the feature maps, you can imagine in this way like poking a hole through a deck of cards. You have to apply ROI Pool in the same way to every slice as discussed above.", "In Fast R-CNN we use a 7 x 7 grid for pooling. We also get rid of the last pooling layer. ROI Pooling is applied to the feature maps of the last convolution layer. The above example is for AlexNet architecture.", "The changes from RCNN is that they\u2019ve got rid of the SVM classifier and used Softmax instead. The loss function used for Bbox is a smooth L1 loss. The result of Fast RCNN is an exponential increase in terms of speed. In terms of accuracy, there\u2019s not much improvement. Accuracy with this architecture on PASCAL VOC 07 dataset was 66.9%. The total loss here is the summation of the classification loss and the regression loss and the network is backpropagated with a single loss by which we can get rid of the multi-stage training problem.", "Even with all these advancements, there was still one remaining bottleneck in the Fast R-CNN process which is the region proposer. As we know, the first step in detecting the objects is to generate a set of potential bounding boxes around the object. In Fast R-CNN, the region proposals are created using Selective Search, a pretty slow process is found to be the bottleneck of the overall object detection process.", "So, we need a better technique where it gives less than 2000 region proposals, faster than selective search, as accurate as selective search or better, and should be able to propose overlapping ROIs with different aspect ratios and scales.", "From Fast R-CNN, we know that region proposals depend on features of the image that were already calculated with the forward pass of the CNN.", "So why don\u2019t we reuse those same CNN results for region proposals instead of running a separate selective search algorithm?", "First, let\u2019s understand the concept of overlapping ROIs with different aspect ratios and scales.", "From the image, we see a lot of objects overlapping each other. We see a car, a bicycle, a person holding a television, and a dog inside this television. The selective search could solve this problem but we end up with a huge number of ROIs. We need to think of an idea that efficiently solves this.", "If we draw the bounding boxes around the different objects, it looks in this way.", "It\u2019s a bit complicated to achieve this but the idea of Anchor Boxes makes it simple. Let\u2019s understand what these anchor boxes mean.", "In general, objects can fit either in a squared box, or rectangular and wide, or rectangular and tall. Broadly, they can be said to be either big, small, or of medium size. So, experimentally it is found out that any object in the image can be detected using boxes of 3 different scales and 3 different aspect ratios.", "If we consider the above overlapping image it is highly possible that combining all these boxes, as shown above, will give you all the overlapping proposals, but not very accurately. A major part of the object will be covered. This could be a technique that can be used to solve our purpose of replacing the region proposer. We can think of some alternatives such as:", "1. Removing Selective Search and applying a sliding window on top of the Feature Maps. But with this, we end detecting mostly objects of a single scale.", "2. To take care of multiple scales, we have to use Image Pyramids at the input. But using images of 5 different scales (by which almost every object can be detected) makes the network 4 times slower.", "3. Another option is to use sliding windows of different sizes (9, as shown above) on the Feature Map. This concept is called the Feature Pyramid. This involves the use of sliding windows of 9 different sizes on top of the feature maps.", "But for an image of say 600x1000, we would have had a Feature Map of size ~40x60. And using 9 different sliding windows at each position, for all the 40x60 values in the Feature Map, we end up having,40x60x9 =~20,000 proposals. Compared to Selective Search which gives just 2000 proposals, we have almost 10 times more proposals. This would be computationally more expensive and also would have more False Positives.", "4. Consider using a simple CNN BBox regressor in place of Selective Search to get the approximate region proposals of the image which could further be fed to the underlying Fast R-CNN architecture. This is the core idea behind Faster R-CNN. Let\u2019s dig a bit deeper.", "This network which gives us the approximate ROIs is termed to be the Region Proposal Network(RPN). So how do we design this RPN such that it gives us the approximate ROIs which can be further processed?", "The idea here is we make use of the 9 boxes as discussed above. These are termed as the Anchor Boxes or Reference Boxes. At any point on the image, we get around 9 different bounding boxes of different scales and aspect ratios.", "A sliding window of size 3x3 is used upon the feature maps and on the top of each sliding window, we place these 9 boxes at the center to detect any objects present in the respective window. Let\u2019s zoom into the RPN.", "This is how we get different region proposals from all the regions of the image. The 9x represents, that part is repeated 9 times for 9 different anchors. From this, we get the required ROIs. But the problem here is again we end up with a huge number of proposals.", "Considering the same example of 40x60 feature maps, we again get around 20K proposals (40 x 60 x 9). A maximum of boxes in these doesn\u2019t have any object and such boxes should be eliminated. For that, we use a binary classifier that predicts if the box contains a foreground or any background. With this, all the boxes containing background gets eliminated. Let\u2019s assume there are about 15K background boxes. We are left with 5K more boxes yet. As the classification includes a Softmax layer at the end, we get the confidence scores for each box indicating the probability of an object present inside that box. In this way, we can rank the boxes according to the confidence scores and use top-n proposals as ROIs. The n can be tweaked accordingly.", "Also, note that as we don\u2019t use the ROI Pooling layer in the RPN, we use a convolution operation there, which acts like a sliding window and the FC layers here are replaced by the convolution operations similar to that of the Overfeat which was a predecessor to the R-CNN.", "So the feature maps are first convolved with a 3x3 window or filter which gives us the required anchors, followed by 1x1 convolutions one for each classification and regression parts.", "On the whole, this is the architecture of Faster R-CNN.", "The Faster R-CNN is jointly trained with 4 losses:", "I hope this clears your understanding of Fast and Faster R-CNNs. In December 2015, Faster RCNN along with the backbone network as ResNet -101 won the COCO Object Detection Contest and is considered as a state-of-the-art model for object detection till date. Hope you learned something new today! I\u2019ll discuss more on Mask R-CNN and Detectron2 in my upcoming articles.", "If you\u2019d like to get in touch, connect with me on LinkedIn.", "If you\u2019d like to know more about Cross-Entropy, you can read my previous article on it here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "An ardent learner in the field of AI, blockchain and loves to explore new tech."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fadbb55653d97&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----adbb55653d97--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aakarsh0705?source=post_page-----adbb55653d97--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Aakarsh Yelisetty"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ed920938e13&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=post_page-4ed920938e13----adbb55653d97---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/understanding-object-detection-and-r-cnn-e39c16f37600", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/aakarsh-yelisetty-6b691b171/", "anchor_text": "LinkedIn"}, {"url": "https://towardsdatascience.com/entropy-cross-entropy-and-kl-divergence-explained-b09cdae917a", "anchor_text": "here"}, {"url": "https://arxiv.org/pdf/1506.01497.pdf", "anchor_text": "https://arxiv.org/pdf/1506.01497.pdf"}, {"url": "https://arxiv.org/pdf/1504.08083.pdf", "anchor_text": "https://arxiv.org/pdf/1504.08083.pdf"}, {"url": "http://cs231n.stanford.edu/slides/2017/cs231n_2017_lecture11.pdf", "anchor_text": "http://cs231n.stanford.edu/slides/2017/cs231n_2017_lecture11.pdf"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----adbb55653d97---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----adbb55653d97---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----adbb55653d97---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----adbb55653d97---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----adbb55653d97---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=-----adbb55653d97---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=-----adbb55653d97---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fadbb55653d97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----adbb55653d97---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----adbb55653d97--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----adbb55653d97--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----adbb55653d97--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----adbb55653d97--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----adbb55653d97--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Aakarsh Yelisetty"}, {"url": "https://medium.com/@aakarsh0705/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "141 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ed920938e13&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=post_page-4ed920938e13--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe011017c9cea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97&newsletterV3=4ed920938e13&newsletterV3Id=e011017c9cea&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}