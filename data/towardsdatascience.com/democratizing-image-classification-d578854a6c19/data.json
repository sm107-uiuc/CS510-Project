{"url": "https://towardsdatascience.com/democratizing-image-classification-d578854a6c19", "time": 1683007449.8379369, "path": "towardsdatascience.com/democratizing-image-classification-d578854a6c19/", "webpage": {"metadata": {"title": "Democratizing image classification | by Martina Pillay | Towards Data Science", "h1": "Democratizing image classification", "description": "Creating customized image classification models requires detailed knowledge about TensorFlow or other similar deep learning frameworks. It also requires a significant amount of CPU. While\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/jeffchenhr/", "anchor_text": "Jeff Chen", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/ajrharris/", "anchor_text": "Andy Harris", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/martinaapillay/", "anchor_text": "Martina A. Pillay", "paragraph_index": 0}, {"url": "https://developer.apple.com/machine-learning/create-ml/", "anchor_text": "CreateML", "paragraph_index": 1}, {"url": "https://cloud.google.com", "anchor_text": "Google Cloud", "paragraph_index": 6}, {"url": "https://console.cloud.google.com/kubernetes/add", "anchor_text": "to spin up a new Kubernetes cluster", "paragraph_index": 6}, {"url": "https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes", "anchor_text": "Access Modes", "paragraph_index": 7}, {"url": "https://cloud.google.com/filestore/", "anchor_text": "Filestore", "paragraph_index": 8}, {"url": "https://console.cloud.google.com/filestore/locations/-/instances/new", "anchor_text": "created a new instance", "paragraph_index": 8}, {"url": "https://github.com/features/actions", "anchor_text": "GitHub Actions", "paragraph_index": 11}, {"url": "https://console.cloud.google.com/iam-admin/serviceaccounts/create", "anchor_text": "Service Account in Google Cloud", "paragraph_index": 11}, {"url": "https://github.com/actions/starter-workflows/blob/master/ci/google.yml", "anchor_text": "Build and Deploy to GKE", "paragraph_index": 13}, {"url": "https://github.com/GoogleCloudPlatform/github-actions/tree/docs/service-account-key/setup-gcloud#inputs", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator#flow_from_directory", "anchor_text": "keras.preprocessing.images.ImageDataGenerator.flow_from_directory", "paragraph_index": 17}, {"url": "https://github.com/kubernetes-client/python", "anchor_text": "Kubernetes Python package", "paragraph_index": 18}, {"url": "https://docs.python.org/3/library/uuid.html#uuid.uuid4", "anchor_text": "UUID generator", "paragraph_index": 18}, {"url": "https://towardsdatascience.com/transfer-learning-using-mobilenet-and-keras-c75daf7ff299", "anchor_text": "Transfer Learning using Mobilenet and Keras", "paragraph_index": 20}, {"url": "https://harvard-iacs.github.io/2020-AC295/", "anchor_text": "Harvard\u2019s Applied Computation 295 course", "paragraph_index": 30}], "all_paragraphs": ["Authors: Jeff Chen, Andy Harris, Martina A. Pillay", "Creating customized image classification models requires detailed knowledge about TensorFlow or other similar deep learning frameworks. It also requires a significant amount of CPU. While higher-level tools exist, such as Apple\u2019s desktop app, CreateML, they require you to run software on your local machine, which can be slow and inefficient.", "Our project aims to democratize machine learning and make building an image classification model accessible to any software engineer, regardless of their ML knowledge.", "We built on top of several existing resources to develop a web service that can seamlessly intake images and output a customized image classification model.", "Our product contains three distinct components: a deployment and service for managing user uploads, a job definition that manages model training, and persistent storage for storing data during training. The components are connected, as shown below.", "Deploying to Kubernetes on Google Cloud", "For this project, we needed dynamic computational power that could respond to spikes in demand. Kubernetes, which automatically manages scaling containerized applications, was the perfect fit. Google Cloud makes it easy to spin up a new Kubernetes cluster quickly.", "Next, we needed to set up persistent storage where images could be uploaded and then used by the training jobs. Kubernetes Pods can share files using Persistent Volumes. Persistent Volumes have three Access Modes: ReadWriteOnce, ReadOnlyMany, and ReadWriteMany (the names indicate how each volume type can be used). For this project, we needed the frontend to be able to write files to storage; then, the corresponding training job needed to be able to read those files. Therefore, we needed a Volume that supports ReadWriteMany.", "We chose to use Filestore, a managed Google service that works similar to a NAS server. Filestore requires a minimum disk space of 1Tb and is somewhat expensive, so it might not be an ideal choice for a long-term project, unless you plan on storing a LOT of data. But for a short-term project (and with credits), it was easy to set up and made sense for our use case. To set up a Filestore instance, created a new instance, and kept track of the File share name and IP address.", "Next, we created a Persistent Volume using that Filestore information.", "Finally, we created a Persistent Volume Claim that can be shared by the frontend and various jobs.", "This project took place during COVID-19, so we had to remotely collaborate due to shelter-in-place orders. Therefore, using source control and collaboration tools were even more critical. We stored our code in GitHub and managed all of our deploys using GitHub Actions. Setting up autodeploy requires first creating a Service Account in Google Cloud.", "The Service Account Role needs to be set to Editor so that GitHub can send commands to Google Cloud. At the last stage, we generated and downloaded a key for the Service Account.", "Next, we added the Build and Deploy to GKE workflow to our GitHub project. The default template uses Github secrets for the GKE_EMAIL, GKE_KEY, and GKE_PROJECT environment variables. GKE_EMAIL and GKE_PROJECT correspond to the Service Account email address and Project ID, respectively. GitHub provides instructions here to generate GKE_KEY (using the Service Account Key JSON file you downloaded above).", "Finally, we made a couple of changes to our action file. First, to avoid having to cut a new release for each deployment, we trigger the workflow every time there is a new commit to the master branch.", "Second, we build two Docker containers instead of one \u2014 one for the main service and one for the job (more on that below).", "We set up the front end using Flask and Bootstrap. The front end service was packaged as a container and deployed in the Kubernetes cluster.", "To help users through the process, we designed a 3 step form as seen below (although you can customize however you like!). In the first step, we collect a .zip file containing pictures of different new classes that the user would like the model to learn. The contents of the .zip file must match the structure used by keras.preprocessing.images.ImageDataGenerator.flow_from_directory. Then, we ask the user to input the email they would like to receive the trained model. Finally, we provide a summary and notification to the user to check whether all the details are correct.", "After a .zip file is uploaded, we create a job using the Kubernetes Python package. We give each job a unique UUID using the UUID generator package and pass the .zip file path as an environment variable. Note that the Persistent Volume Claim is appended when creating a job.", "The frontend needs special permissions to create jobs. For this project, we give the default role Admin access. In a production environment, the frontend\u2019s access should be restricted only to have necessary permissions.", "To create customized image classification models, we used the technique of transfer learning on a pre-trained neural network. The article Transfer Learning using Mobilenet and Keras is extremely helpful and was used as a framework for this piece of work.", "In the context of image classification, the theory of transfer learning is that a pre-trained model that has already been trained on a large set of images can effectively serve as a generic model for most images. We can leverage most layers of the neural net and only retrain the last few layers on the new images. This allows us to reduce the amount of time and computing resources we would need to develop a customized image classification model. It also reduces the number of new images we needed to add new classes.", "In this project, we use the base model from the MobileNet v2 developed by Google. This network is pre-trained on the ImageNet dataset (consisting of 1.4M images and 1000 classes). We freeze most of the first pre-trained layers and only retrain the last few dense layers. We then unpack the zip file of classified images and retrain the model. The model is saved as an .h5 file and saved to a dropbox file where it is emailed back to the user.", "The first step to productizing our machine learning model was putting it within a Docker container so that we could deploy it as a microservice. Docker was utilized so that we could maintain a uniform environment, library requirements, and scale the model within the cloud using Kubernetes.", "The Dockerfile is essentially a command document stored within a text file that launches a container image. Within our Dockerfile, we install python and all packages defined in requirements.txt. We also instantiate several environment variables that we can pass into our main.py file: the zip file location of the images, the user email, and the dropbox key and token.", "Once the Dockerfile was created, we built the image and tested to ensure that the inputs and outputs worked locally. Finally, we pushed the image to Google Cloud Platform where it could be deployed by our Kubernetes cluster.", "Sharing the model and Notifying the User", "Since Google Drive Storage is expensive, we decided to use the Dropbox API to store retrained models temporarily. After the training is done, the model is uploaded to the Dropbox and generates a sharable link.", "The link is later then passed to the SendGrid API to generate a notification email to the user to retrieve from. A sample of this beautiful email can be seen below!", "The service we have created is only a starting point to where this product could go. To better serve the needs of those hoping to utilize classification models, the following features can be incorporated:", "We would like to thank Pavlos Protopapas and the rest of the teaching staff at Harvard\u2019s Applied Computation 295 course for their guidance and support.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Aspiring to make healthcare better through tech and data. Harvard MS/MBA."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd578854a6c19&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d578854a6c19--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@martinapillay?source=post_page-----d578854a6c19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinapillay?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Martina Pillay"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3e5411b621e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&user=Martina+Pillay&userId=3e5411b621e9&source=post_page-3e5411b621e9----d578854a6c19---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.linkedin.com/in/jeffchenhr/", "anchor_text": "Jeff Chen"}, {"url": "https://www.linkedin.com/in/ajrharris/", "anchor_text": "Andy Harris"}, {"url": "https://www.linkedin.com/in/martinaapillay/", "anchor_text": "Martina A. Pillay"}, {"url": "https://developer.apple.com/machine-learning/create-ml/", "anchor_text": "CreateML"}, {"url": "https://cloud.google.com", "anchor_text": "Google Cloud"}, {"url": "https://console.cloud.google.com/kubernetes/add", "anchor_text": "to spin up a new Kubernetes cluster"}, {"url": "https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes", "anchor_text": "Access Modes"}, {"url": "https://cloud.google.com/filestore/", "anchor_text": "Filestore"}, {"url": "https://console.cloud.google.com/filestore/locations/-/instances/new", "anchor_text": "created a new instance"}, {"url": "https://github.com/features/actions", "anchor_text": "GitHub Actions"}, {"url": "https://console.cloud.google.com/iam-admin/serviceaccounts/create", "anchor_text": "Service Account in Google Cloud"}, {"url": "https://github.com/actions/starter-workflows/blob/master/ci/google.yml", "anchor_text": "Build and Deploy to GKE"}, {"url": "https://github.com/GoogleCloudPlatform/github-actions/tree/docs/service-account-key/setup-gcloud#inputs", "anchor_text": "here"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator#flow_from_directory", "anchor_text": "keras.preprocessing.images.ImageDataGenerator.flow_from_directory"}, {"url": "https://github.com/kubernetes-client/python", "anchor_text": "Kubernetes Python package"}, {"url": "https://docs.python.org/3/library/uuid.html#uuid.uuid4", "anchor_text": "UUID generator"}, {"url": "https://towardsdatascience.com/transfer-learning-using-mobilenet-and-keras-c75daf7ff299", "anchor_text": "Transfer Learning using Mobilenet and Keras"}, {"url": "https://harvard-iacs.github.io/2020-AC295/", "anchor_text": "Harvard\u2019s Applied Computation 295 course"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d578854a6c19---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----d578854a6c19---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----d578854a6c19---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/docker?source=post_page-----d578854a6c19---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----d578854a6c19---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&user=Martina+Pillay&userId=3e5411b621e9&source=-----d578854a6c19---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&user=Martina+Pillay&userId=3e5411b621e9&source=-----d578854a6c19---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd578854a6c19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d578854a6c19---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d578854a6c19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d578854a6c19--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d578854a6c19--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d578854a6c19--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d578854a6c19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinapillay?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinapillay?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Martina Pillay"}, {"url": "https://medium.com/@martinapillay/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3e5411b621e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&user=Martina+Pillay&userId=3e5411b621e9&source=post_page-3e5411b621e9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F3e5411b621e9%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemocratizing-image-classification-d578854a6c19&user=Martina+Pillay&userId=3e5411b621e9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}