{"url": "https://towardsdatascience.com/how-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5", "time": 1683015736.412789, "path": "towardsdatascience.com/how-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5/", "webpage": {"metadata": {"title": "How to Make Inserts Into SQL Server 100x faster with Pyodbc | by Anna Geller | Towards Data Science", "h1": "How to Make Inserts Into SQL Server 100x faster with Pyodbc", "description": "I\u2019ve been recently trying to load large datasets to a SQL Server database with Python. Usually, to speed up the inserts with pyodbc, I tend to use the feature cursor.fast_executemany = True which\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.annageller.com", "anchor_text": "www.annageller.com", "paragraph_index": 18}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe", "paragraph_index": 18}], "all_paragraphs": ["I\u2019ve been recently trying to load large datasets to a SQL Server database with Python. Usually, to speed up the inserts with pyodbc, I tend to use the feature cursor.fast_executemany = True which significantly speeds up the inserts. However, today I experienced a weird bug and started digging deeper into how fast_executemany really works.", "When I was trying to load my data into SQL Server, I got the error: \u201cError converting data type varchar to numeric.\u201d", "This error was extremely confusing to me since the data types of my Pandas dataframe matched perfectly with those defined in the SQL Server table. In particular, the data that I was trying to load was a time series with a timestamp and measurement columns + some metadata columns.", "The SQL Server table has a schema similar to this:", "If you look at the data types, they are matching perfectly.", "In order to load this data to the SQL Server database fast, I converted the Pandas dataframe to a list of lists by using df.values.tolist(). To ingest my data into the database instance, I created:", "Note that on line 14, we make use of the cursor.fast_executemany = True feature. Executing the script gave me the following error (with the version: pyodbc==4.0.23):", "Why is pyodbc trying to convert something from varchar to numeric?! When I commented out line 14 in order to use cursor.executemany() without the fast_executemany feature, the script worked just fine! I was able to insert my data without any issues.", "The only problem is that without fast_executemany, it\u2019s slow.", "According to the Pyodbc Wiki [1]:", "fast_executemany can boost the performance of executemany operations by greatly reducing the number of round-trips to the server.", "This is the primary reason why I wanted to fix this. According to the Github issue from the pyodbc repository [2], pyodbc internally passes all decimal values as strings because of some discrepancies and bugs related to decimal points used by various database drivers. This means that when my data has a value of 0.021527 or 0.02, both of those values may not be accepted because my SQL Server data type was specified as NUMERIC(18,3). Also, pyodbc needs strings rather than floats, so the correct value would be '0.021' i.e. a string (not float!) with exactly three numbers after the comma.", "So my solution boiled down to adding this single line:", "This line is just converting floats to strings representing numbers with exactly three decimal points:", "After fixing the issue, the script ran 100 times faster as compared to running it without line 14 (cursor.fast_executemany = True). Note that it\u2019s so fast because it loads the entire data into memory before loading it to SQL Server, so take loading in chunks into consideration, if you come across out of memory errors.", "In summary, I was able to fix the \u201cError converting data type varchar to numeric\u201d by converting my float column to string with exactly the same decimal point number as defined in the SQL Server table. It was quite surprising to me that pyodbc doesn\u2019t handle that under the hood (or maybe is it fixed in more recent Pyodbc versions?).", "If you found it useful, follow me to not miss my next articles.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "DevRel, Data Professional, Cloud & .py fan. www.annageller.com. Get my articles via email: https://annageller.medium.com/subscribe"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5a0b5afdba5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://annageller.medium.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd----5a0b5afdba5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@nextvoyage?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Nextvoyage"}, {"url": "https://www.pexels.com/photo/twisted-building-during-nighttime-1470405/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://github.com/mkleehammer/pyodbc/wiki/Features-beyond-the-DB-API", "anchor_text": "https://github.com/mkleehammer/pyodbc/wiki/Features-beyond-the-DB-API"}, {"url": "https://github.com/mkleehammer/pyodbc/issues/388", "anchor_text": "https://github.com/mkleehammer/pyodbc/issues/388"}, {"url": "https://medium.com/tag/programming?source=post_page-----5a0b5afdba5---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----5a0b5afdba5---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/python?source=post_page-----5a0b5afdba5---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----5a0b5afdba5---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/big-data?source=post_page-----5a0b5afdba5---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&user=Anna+Geller&userId=5bdf5a3385cd&source=-----5a0b5afdba5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&user=Anna+Geller&userId=5bdf5a3385cd&source=-----5a0b5afdba5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5a0b5afdba5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5a0b5afdba5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5a0b5afdba5--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://annageller.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5.4K Followers"}, {"url": "http://www.annageller.com", "anchor_text": "www.annageller.com"}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F908ff40c4340&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-made-inserts-into-sql-server-100x-faster-with-pyodbc-5a0b5afdba5&newsletterV3=5bdf5a3385cd&newsletterV3Id=908ff40c4340&user=Anna+Geller&userId=5bdf5a3385cd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}