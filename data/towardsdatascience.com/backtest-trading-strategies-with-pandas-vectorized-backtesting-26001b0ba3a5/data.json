{"url": "https://towardsdatascience.com/backtest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5", "time": 1683011484.8044531, "path": "towardsdatascience.com/backtest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5/", "webpage": {"metadata": {"title": "Backtest Trading Strategies with Pandas \u2014 Vectorized Backtesting | by Yao Lei Xu | Towards Data Science", "h1": "Backtest Trading Strategies with Pandas \u2014 Vectorized Backtesting", "description": "Aha! You found a pattern in the market that can potentially make you the next Warren Buffett\u2026 Now what? After designing a new trading strategy that can systematically profit from that pattern, it is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.yaoleixu.com/quant-finance", "anchor_text": "You can find the full code and additional resources here", "paragraph_index": 2}, {"url": "https://www.yaoleixu.com/quant-finance", "anchor_text": "my website", "paragraph_index": 33}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 34}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 34}], "all_paragraphs": ["Aha! You found a pattern in the market that can potentially make you the next Warren Buffett\u2026 Now what? After designing a new trading strategy that can systematically profit from that pattern, it is now the time to ask yourself: \u201cWhat if I had this strategy five years ago?\u201d.", "Today, I will discuss how vectorized backtesting can help you \u201canswer\u201d that question, how to implement it using Pandas, and what subtleties should you be aware of. For those who have some experience in this area, feel free to jump to section 5 directly.", "(You can find the full code and additional resources here)", "Backtesting is used to simulate the past performance of a trading strategy.", "The core concept of backtesting is to simulate a given trading strategy by going back in time and execute the trades as if you were in the past. The generated profits are often compared against a benchmark performance through some metrics (e.g. max drawdown, Sharpe ratio, annualized returns, etc.). Depending on the nature of the strategy, different benchmarks and metrics should be used, but that is a whole topic on its own so I won\u2019t be going into details here.", "Backtesting is not an exact indicator of past performance and should not be used as a research tool, especially in inexperienced hands.", "Funnily enough, backtesting is not a good indicator of how rich you would be today if you could travel back in time. Time-travelling aside, it is virtually impossible to replicate past performance exactly, since there are a number of factors that are just way too complicated to be modelled exactly (slippage, market impact of trades, etc.). In addition, in inexperienced hands, a backtest can be full of biases (e.g. look-ahead bias, survivor bias, etc.) which can make a strategy look much better than reality (see section 5.3).", "Finally, backtesting is not a research tool. Do not randomly change your strategy parameters just because it looks better in the backtest. You should consider the historical performance of the market as one of many possible realizations of a random variable. Fitting your parameters to the backtest without sound economic logic will inevitably lead to over-fitting.", "Vectorized backtesting is drastically faster than event-driven backtesting and should be used for the explorative stage of strategy research.", "There are two main methods for backtesting a strategy: (i) event-driven and (ii) vectorized. An event-driven backtest often involves the use of a loop that iterates over time, simulating an agent that sends orders depending on the market signals. This loop based approach can be extremely flexible, allowing you to simulate potential delays in orders execution, slippage costs, etc.", "A vectorized backtest instead gathers strategy related data and organizes them into vectors and matrices, which are then processed through linear algebra methods (the thing your computer is really good with) to simulate past performance.", "Due to the expressive power of linear algebra, vectorized backtests are DRASTICALLY FASTER than event-driven backtests, although it lacks in terms of flexibility. Usually, vectorized backtests are better suited for an initial explorative strategy analysis, whereas event-driven backtests are suited for a more in-depth analysis.", "Strategy performance can be computed using the cumulative sum of log-returns.", "Before diving into the python code, it is important to understand the concept of log-returns, which is defined as the difference in log-value of an asset during time interval (t-1, t):", "Log-returns are incredibly useful in quantitative finance for a number of reasons (stationarity, log-normality, etc.), but for the purpose of backtesting, we will use its time-additive property to compute cumulative returns (i.e. past performance).", "For instance, consider the log-returns of an asset over the days (t=3,2,1). To compute the total return of that asset over the entire period, we simply sum-up all daily returns (r[3]+r[2]+r[1]). This follows since the log price information gets cancelled out as shown below:", "Therefore, if I want to know how much the asset has grown, I just need to remove the final natural-log with the exponential function. In the above example, the asset value increased by a factor of (p[3]/p[0]).", "The above argument applies to your strategy too. For instance, if your strategy generated log-returns (r[0], r[1], \u2026, r[T]) over T days, then the backtest of the strategy can be computed through a simple cumulative sum of the log-returns followed by the exponential function.", "Let\u2019s say we want to backtest the performance of a price moving average crossover strategy, where you are long the underlying asset if the short-term price average is above the long-term price average and vice-versa. We can compute the strategy performance in 6 steps:", "(1) Compute the log-returns of the underlying asset. In this example, we are looking at the log-price differences of the AAPL stock, which is stored in a Pandas Series indexed by time.", "(3) Translate the signal to actual trading positions (long or short)", "(4) Compute the strategy returns by adjusting the log-returns of the underlying asset according to the positions (the calculation of the strategy returns is not exact, but is often a good enough approximation at a practical level). Also, notice that the positions have been shifted by 1 time-step, which is done to avoid look-ahead bias (see section 5.3.)", "(5) Compute the backtest by using the cumulative sum and applying the exponential function.", "Similarly to the single asset case, we can compute the backtest for a portfolio of assets using Pandas. The only difference here is that we are working with a Pandas DataFrame instead of a Pandas Series.", "Let\u2019s first compute the signals and the positions for each of the asset as shown in the code below. Notice that we have scaled the positions such at any given time, the total sum of the portfolio positions do not exceed 100% (i.e. assuming no leverage is used).", "We can look at how the strategy performed in terms of individual assets:", "We can also look at how the strategy performed overall at a portfolio level:", "In the above examples, the the position vector/matrix is always shifted by 1 time step. This is done to avoid look-ahead bias, which can make a strategy look much better than reality.", "The idea is that: at time t, you have a signal that contains information up to and including t, but you can only realistically trade that signal at t+1 (e.g. if your signal contains earnings information of a company released on Monday night, then you can only trade that information on Tuesday morning).", "As shown below, the look-ahead bias can make the strategy look way more promising than reality (especially for a \u201cmomentum\u201d strategy).", "With vectorized backtesting, it is much easier to evaluate a strategy\u2019s robustness to delays (i.e. opening your trades T time steps after the signal). This is however an analysis that is more useful at a high-frequency trading level, where the delays can severely impact the performance.", "Transaction costs are often quoted in fixed percentages. To incorporate these in the backtest, we can simply compute how much did the portfolio change between successive time steps, then subtract the related transaction costs directly from our strategy returns.", "I hope you enjoyed the article! Follow me if you would like to see more content like this.", "Also, check out my website for the full code and additional resources.", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. Researcher in Machine Learning @ Imperial College London"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F26001b0ba3a5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@yaoleixu1996?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yaoleixu1996?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Yao Lei Xu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F729179a4eefe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&user=Yao+Lei+Xu&userId=729179a4eefe&source=post_page-729179a4eefe----26001b0ba3a5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.yaoleixu.com/quant-finance", "anchor_text": "You can find the full code and additional resources here"}, {"url": "https://www.yaoleixu.com/quant-finance", "anchor_text": "my website"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/trading?source=post_page-----26001b0ba3a5---------------trading-----------------", "anchor_text": "Trading"}, {"url": "https://medium.com/tag/python?source=post_page-----26001b0ba3a5---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/money?source=post_page-----26001b0ba3a5---------------money-----------------", "anchor_text": "Money"}, {"url": "https://medium.com/tag/finance?source=post_page-----26001b0ba3a5---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/data-science?source=post_page-----26001b0ba3a5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&user=Yao+Lei+Xu&userId=729179a4eefe&source=-----26001b0ba3a5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&user=Yao+Lei+Xu&userId=729179a4eefe&source=-----26001b0ba3a5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F26001b0ba3a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----26001b0ba3a5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----26001b0ba3a5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yaoleixu1996?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yaoleixu1996?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yao Lei Xu"}, {"url": "https://medium.com/@yaoleixu1996/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "884 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F729179a4eefe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&user=Yao+Lei+Xu&userId=729179a4eefe&source=post_page-729179a4eefe--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4010033bb05b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbacktest-trading-strategies-with-pandas-vectorized-backtesting-26001b0ba3a5&newsletterV3=729179a4eefe&newsletterV3Id=4010033bb05b&user=Yao+Lei+Xu&userId=729179a4eefe&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}