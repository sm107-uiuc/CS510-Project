{"url": "https://towardsdatascience.com/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e", "time": 1682995672.2708852, "path": "towardsdatascience.com/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e/", "webpage": {"metadata": {"title": "How to build a Recommendation Engine quick and simple | by Jan Teichmann | Towards Data Science", "h1": "How to build a Recommendation Engine quick and simple", "description": "a light introduction to the topic and the first steps to get you into production with a recommendation engine in a week"}, "outgoing_paragraph_urls": [{"url": "https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html", "anchor_text": "link", "paragraph_index": 16}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-significantterms-aggregation.html", "anchor_text": "documentation", "paragraph_index": 23}, {"url": "https://towardsdatascience.com/location-location-location-ec2cc8a223b1", "anchor_text": "geographic area embedding", "paragraph_index": 34}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/", "paragraph_index": 42}], "all_paragraphs": ["This article is meant to be a light introduction to the topic and provide the first steps to get you into production with a recommendation engine in a week. I will also tell you what the steps are to go from basics to fairly advanced.", "We won\u2019t tab into the cutting edge yet but we won\u2019t be far off either.", "Read part 2 for the more advanced use-cases when quick and simple is no longer good enough:", "Recommendation systems are everywhere and for many online platforms their recommendation engines are the actual business. That\u2019s what made Amazon big: they were very good at recommending you which books to read. There are many other companies which are all build around recommendation systems: YouTube, Netflix, Spotify, Social Media platforms. In parallel, consumers came to expect a personalised experience and sophisticated recommendation systems to find relevant products and content, all to save consumers time and money.", "But how do you build a recommendation engine?", "Recommendation engines have been around for a while and there have been some key learnings to leverage:", "Recommendation systems generally look for overlap or co-occurrence to make a recommendation. Like in the following example where we recommend Ethan a puppy based on a similarity of Ethan with Sophia:", "In practise, a recommendation engine computes a co-occurrence matrix from a history matrix of events and actions. This is simple enough but there are challenges to overcome in real world scenarios. What if everyone wants a unicorn? Does the high co-occurrence of unicorns in the following example make a good recommendation?", "After the recommendation system has computed the co-occurrence matrix we have to apply statistics to filter out the sufficiently anomalous signals to be interesting as a recommendation.", "The algorithms and statistics which can extract relevant indicators from the co-occurrence matrix are what makes a good recommendation system. The path of creating an item-to-item indicator matrix is called an item-item model. There is obviously also an user-item model:", "To create a user-item model we could apply a simple matrix factorisation or train a neural network to predict the scores of a user-item input. Usually, item-item models are more robust and produce better results when we do not invest more into feature engineering and model tuning etc.", "However, there are a few more challenges a good recommendation system has to overcome. Recommending the same things over and over is boring. Even worse, recommending the same things produces bad data and causes content fatigue.", "Two simple and intuitive strategies to improve the value of recommendations are", "These steps ensure an interesting user experience and new data on alternative recommendations.", "Recommendation systems work best with unbiased explicit user feedback like the purchase of products, watching a video or listening to a song. If you\u2019re lucky and you have such a data set even a simple approach will work very well. However, in many use cases you have mainly implicit feedback like page views, clicks or search queries. Unfortunately, that data is also heavily biased e.g. the click through rate is heavily dependent on the position of content on a page. Implicit feedback also tends to perform less well, e.g. a click on a search result might just teaching you about how clickbaity a headline or CTA was rather than the relevance of the actual content. This results in high bounce rates after initially high click through rates (a very common case!)", "A simple approach like collaborative filtering requires co-occurrence between items. This means collaborative filtering is suitable and will lead to great results if", "One option would be to use Spark and the alternating least squares (ALS) algorithm (link) which is a simple solution for model training but does not provide an immediate solution for deployment and scoring. I recommend a different approach to get started:", "As it turns out the maths of search and recommendation problems are strikingly similar. Most importantly, a good user experience in search and recommendations are almost indistinguishable. Basically, search results are recommendations if we can formulate recommendations as search queries. It\u2019s an ideal solution as many websites and businesses already operate search engines in their backends and we can leverage existing infrastructure to build our recommendation system. Elasticsearch scales well and exists as fully managed deployments e.g. on AWS. There is no safer bet if you want to deploy your recommendation engine into production fast!", "How do you create a recommendation with a search engine?", "The good news: Elasticsearch implements all 5 steps for us in a single query!", "If we store our user-item interactions in elastic search as follows", "with a document mapping like this:", "then all what\u2019s needed to produce some recommendations is the following query e.g. using Python:", "Elasticsearch will return the recommendations with a JLH score by default but there is a range of scores available (documentation).", "In our example, the search for apple returned a foreground population of 12,200 users with a background population of 130,000 users who did not have any apples in their products. Puppy co-occurred 250 times in the foreground and 320 times in the background. The JLH score is a simple magnitude of change between the background collection to the local search results given by (fg_percentage - bg_percentage) * (fg_percentage / bg_percentage) which gives a score of 0.15", "As the JLH score is a magnitude change it\u2019s important to remember that fleas jump higher than elephants and the JLH score is very volatile for small data sets. You can adjust the min_doc_count parameter in the query to quality assure your recommendation results.", "This is it, a simple but powerful first iteration of a recommendation engine which can be live within a week or less! Importantly, any version 1 shouldn\u2019t be more complex than this. Time to production is much more important in the early stages. Commonly, your first recommendation engine needs a few iterations to optimise the UI and UX rather than the maths.", "Elasticsearch is not just a very powerful backend for recommendations, it is also highly flexible! There\u2019re many options to improve our recommendation system while keeping the elasticsearch backend. Win!", "Read part 2 for the more advanced use-cases when quick and simple is no longer good enough:", "We can use more sophisticated algorithms such as ALS to create the indicators for our recommendations and we put these indicators into elasticsearch. This simplifies the recommendation scoring to a simple look-up as we do the heavy lifting in the training phase e.g. using Spark. This way elasticsearch is just a performant presentation layer of our ahead-of-time computed indicators for relevant recommendations. You can add this easily to an existing product catalogue as new metadata.", "At the moment we use a binary flag in the products array which means each product in the product array contributes to the JLH score equally. Without many changes we could use some metric to score the product occurrence itself to capture a richer signal. We could use a click count. Or even better we could use a click score by normalising a click by the average expected click through rate of the page location generating the click. E.g. in a list of search results we can calculate an expected CTR for items in first position, second etc. We can then calculate the JLH magnitude change from the sum of item metric scores instead of their simple counts.", "Users usually generate a series of events relevant for recommendations, e.g. clicking on multiple items or adding multiple products to a basket. It\u2019s worth adding a user interaction cache to your recommendation engine (1) to create more complex search queries using a series of events and (2) create a delta between the batch ETL process which updates your elasticsearch index and the user interactions which occurred since the last refresh of your recommendation engine.", "Using the event sequence to produce recommendations can help with (1) creating more relevant results and (2) increase the foreground population to generate a bigger number of co-occurrences in case of low traffic volumes or very big catalogues. It only needs a minor change to the elasticsearch query to switch to a should query:", "The minimum_should_match parameter allows you to optimise between increasing the foreground population size or making the results more relevant by matching users with increasing similarity.", "Currently, our search is a precise lookup of items. This has some consequences: everything we learn from user interactions in terms of co-occurrence is bound to their specific items. When an item is taken off the product catalogue we lose everything we learned from it. We also cannot generalise anything to similar items, e.g. red apples and green apples are distinctive items and co-occurrence is limited to precise matches of red apples or green apples. To overcome this we need to describe items mathematically to compute a similarity between items. This is called an embedding. Read my previous blog post were I create a geographic area embedding. Other options to create embeddings are auto-encoders or the matrix factorisation in the user-item model as described above. After we turned a simple product_id into an embedding we can use probabilistic or fuzzy search to find our foreground population and/or co-occurrences.", "This should get you started with recommendations. It also gives you ample opportunity to build on your first iteration as you learn from production feedback.", "The early steps into recommendations stand or fall much more often by UI and UX rather than the simplicity of the maths.", "Usually, products have a wealth of metadata we should use, e.g. price, descriptions, images, review ratings, seasonality, tags and categories. After we turn a rich metadata set into an embedding describing our products we can train a Neural Network to map the input embeddings into a recommendations embedding which has (1) lower dimensionality and (2) a desired behaviour of the cosine similarity of suitable recommendations being high. One great solution for this are Siamese Neural Networks.", "The input is a high dimensional vector of concatenated embeddings of a product\u2019s metadata. The output of the Neural Network is a much more compact recommendation embedding vector. The error function is given by the cosine similarity of the output vectors. We can use the collaborative filtering data to create our supervised learning labels for combinations which should be similar or not. Importantly, in siamese neural networks the weights of both networks are always identical which gives them their name. Such a recommendation engine would have no more cold start issue! Finally, producing a recommendation can be done with a k-nearest-neighbour search of the output recommendation embeddings.", "You can read more on next steps in the follow up:", "Jan is a successful thought leader and consultant in the data transformation of companies and has a track record of bringing data science into commercial production usage at scale. He has recently been recognised by dataIQ as one of the 100 most influential data and analytics practitioners in the UK.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019m a Data Scientist by Profession; Techie, Geek and Innovator with Passion. https://www.linkedin.com/in/janteichmann/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Faec8c71a823e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jan.teichmann?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Jan Teichmann"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F941c2fa7cfd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&user=Jan+Teichmann&userId=941c2fa7cfd&source=post_page-941c2fa7cfd----aec8c71a823e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/advanced-use-cases-for-recommendation-engines-4a420b14ab4e", "anchor_text": "Advanced Use-Cases for Recommendation EnginesPart 2: How to build your next recommendation engine when quick and simple is no longer good enough.towardsdatascience.com"}, {"url": "http://www.zoopla.co.uk", "anchor_text": "Zoopla.co.uk"}, {"url": "https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html", "anchor_text": "link"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-significantterms-aggregation.html", "anchor_text": "documentation"}, {"url": "https://towardsdatascience.com/advanced-use-cases-for-recommendation-engines-4a420b14ab4e", "anchor_text": "Advanced Use-Cases for Recommendation EnginesPart 2: How to build your next recommendation engine when quick and simple is no longer good enough.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/location-location-location-ec2cc8a223b1", "anchor_text": "geographic area embedding"}, {"url": "https://towardsdatascience.com/advanced-use-cases-for-recommendation-engines-4a420b14ab4e", "anchor_text": "Advanced Use-Cases for Recommendation EnginesPart 2: How to build your next recommendation engine when quick and simple is no longer good enough.towardsdatascience.com"}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/"}, {"url": "https://medium.com/@jan.teichmann", "anchor_text": "https://medium.com/@jan.teichmann"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----aec8c71a823e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----aec8c71a823e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/recommendations?source=post_page-----aec8c71a823e---------------recommendations-----------------", "anchor_text": "Recommendations"}, {"url": "https://medium.com/tag/elasticsearch?source=post_page-----aec8c71a823e---------------elasticsearch-----------------", "anchor_text": "Elasticsearch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&user=Jan+Teichmann&userId=941c2fa7cfd&source=-----aec8c71a823e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&user=Jan+Teichmann&userId=941c2fa7cfd&source=-----aec8c71a823e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Faec8c71a823e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----aec8c71a823e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----aec8c71a823e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----aec8c71a823e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----aec8c71a823e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jan Teichmann"}, {"url": "https://medium.com/@jan.teichmann/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F941c2fa7cfd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&user=Jan+Teichmann&userId=941c2fa7cfd&source=post_page-941c2fa7cfd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F463734a42bc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e&newsletterV3=941c2fa7cfd&newsletterV3Id=463734a42bc7&user=Jan+Teichmann&userId=941c2fa7cfd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}