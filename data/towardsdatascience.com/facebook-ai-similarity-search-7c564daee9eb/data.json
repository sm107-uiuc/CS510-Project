{"url": "https://towardsdatascience.com/facebook-ai-similarity-search-7c564daee9eb", "time": 1683018774.351331, "path": "towardsdatascience.com/facebook-ai-similarity-search-7c564daee9eb/", "webpage": {"metadata": {"title": "Why FAISS Works | Towards Data Science", "h1": "Facebook AI Similarity Search", "description": "Accurate, fast, and memory-efficient similarity search is a hard thing to do \u2014 but something that FAISS has figured out. And this is how it works."}, "outgoing_paragraph_urls": [{"url": "https://ai.facebook.com/tools/faiss/", "anchor_text": "here", "paragraph_index": 34}, {"url": "https://github.com/facebookresearch/faiss", "anchor_text": "FAISS repo here", "paragraph_index": 34}, {"url": "https://github.com/jamescalam/transformers/blob/main/course/question_answering/11_faiss_in_haystack.ipynb", "anchor_text": "this notebook", "paragraph_index": 35}, {"url": "https://twitter.com/jamescalam", "anchor_text": "Twitter", "paragraph_index": 36}, {"url": "https://www.youtube.com/c/jamesbriggs", "anchor_text": "YouTube", "paragraph_index": 36}, {"url": "https://www.youtube.com/c/jamesbriggs", "anchor_text": "https://www.youtube.com/c/jamesbriggs", "paragraph_index": 39}], "all_paragraphs": ["Accurate, fast, and memory-efficient similarity search is a hard thing to do \u2014 but something that, if done well, lends itself very well to our huge repositories of endless (and exponentially growing) data.", "The reason that similarity search is so good is that it enables us to search for images, text, videos, or any other form of data \u2014 without getting too specific in our search queries \u2014 which is something that we humans are not so great at.", "I will use the example of image similarity search. We can take a picture, and search for similar images. This works by first converting every image into a set of automatically generated features \u2014 which are represented as a numerical vector.", "When we then compare the vectors of two similar images \u2014 we will find that they are very similar.", "Now, if we took our picture, and searched for other similar images \u2014 we don\u2019t really want to compare our query vector to every single vector in the database. Imagine trying to do that with a Google Image search \u2014 you could be waiting some time.", "Instead, we want to find a more efficient approach \u2014 and that is exactly what Facebook AI Similarity Search (FAISS) offers.", "Our story of efficient similarity search begins with vectors \u2014 many of them in fact.", "If we were to take three vectors:", "We can say quite confidently that vectors a and b are closer to each other than c. And this can be visualized with a simple 3-dimensional chart:", "In our case, our vectors have many more dimensions \u2014 too many to visualize. But we can still use the same distance metrics to calculate the proximity and/or similarity between two highly-dimensional vectors. A few of those are:", "FAISS makes use of both Euclidean distance and dot product for comparing vectors.", "Given our vectors a, and b. We calculate the Euclidean distance as:", "Given our Euclidean distance metric, we can move onto creating the nearest neighbors (NN) graph using a set of vectors.", "NN is an essential component of FAISS, it is how we build the core \u2018distance\u2019 property in our index. However, NN-search is computationally heavy due to the curse of dimensionality.", "The process consists of calculating the Euclidean distance between two vectors, and then another two, and so on \u2014 the nearest neighbors are those with the shortest distance between them.", "The most basic approach to NN-search is the brute-force, exhaustive search \u2014 where we calculate the distance between all elements.", "Now, if we have a few million vectors indexed \u2014 or a billion (as is the number that FAISS is built for) \u2014 this can become a heavy operation where we sacrifice speed and memory efficiency, for accuracy:", "So, we can instead perform a non-exhaustive search that does not search all elements in our index and/or transforms the vectors to make them smaller (and therefore faster to compare against).", "Because this non-exhaustive (approximate) NN-search uses slightly modified vectors or a restricted search area \u2014 it returns an approximate best result, which is not necessarily the absolute best result.", "This degradation in accuracy however is very slight and viewed as a fair trade-off for the performance benefits.", "First, FAISS uses all of the intelligent ANN graph-building logic that we\u2019ve already learned about. But there\u2019s more to FAISS.", "The first of those efficiency savings comes from efficient usage of the GPU, so the search can process calculations in parallel rather than in series \u2014 offering a big speed-up.", "Additionally, FAISS implements three additional steps in the indexing process. A preprocessing step, followed by two quantization operations \u2014 the coarse quantizer for inverted file indexing (IVF), and the fine quantizer for vector encoding.", "For many of us, that last paragraph is nonsensical gibberish \u2014 so let\u2019s break each step down and understand what each means.", "We enter this process with the vectors that we would like FAISS to index. The very first step is to transform these vectors into a more friendly/efficient format. FAISS offers several options here.", "This operation means that when we do get around to comparing our query vector against already embedded vectors, each comparison will require less computation \u2014 making things faster.", "The next step is our inverted file (IVF) indexing process. Again, there are multiple options \u2014 but each one is aiming to partition data into similar clusters.", "This means that when we query FAISS, and our query is converted into a vector \u2014 it will be compared against these partition/cluster centroids.", "We compare similarity metrics against our query vector and each of these centroids \u2014 and once we find the nearest centroid, we then access all of the full vectors within that centroid (and ignore all others).", "Immediately, we have significantly reduced the required search area \u2014 reducing complexity and speeding up the search.", "This is also called the \u2018non-exhaustive\u2019 search component \u2014 eg the component that allows us to avoid an \u2018exhaustive\u2019 (compare everything) search.", "The final step is a final encoding step for each vector before it is indexed. This encoding process is carried out by our fine quantizer. The goal here is to reduce index memory size and increase search speed.", "It\u2019s worth noting that even with the Flat encoding, FAISS is still going to be very fast.", "All of these steps and improvements combine to create an incredibly fast similarity search engine \u2014 which on GPU is still unbeaten.", "That\u2019s all for this article on FAISS! FAISS is an incredibly cool tool, and you can read more about it here, and the FAISS repo here.", "You can find Python implementations of FAISS in this notebook.", "I hope you\u2019ve enjoyed the article. Let me know if you have any questions or suggestions via Twitter or in the comments below. If you\u2019re interested in more content like this, I post on YouTube too.", "*All images are by the author except where stated otherwise", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Freelance ML engineer learning and writing about everything. I post a lot on YT https://www.youtube.com/c/jamesbriggs"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7c564daee9eb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jamescalam.medium.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": ""}, {"url": "https://jamescalam.medium.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "James Briggs"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb9d77a4ca1d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&user=James+Briggs&userId=b9d77a4ca1d1&source=post_page-b9d77a4ca1d1----7c564daee9eb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@neonbrand?utm_source=medium&utm_medium=referral", "anchor_text": "NeONBRAND"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://kaiminghe.com/cvpr13/index.html#:~:text=Product%20quantization%20(PQ)%20is%20an,then%20quantize%20these%20subspaces%20separately.", "anchor_text": "product quantization"}, {"url": "http://people.ece.umn.edu/~arya/EE5585/lecture13.pdf", "anchor_text": "scalar quantization"}, {"url": "https://ai.facebook.com/tools/faiss/", "anchor_text": "here"}, {"url": "https://github.com/facebookresearch/faiss", "anchor_text": "FAISS repo here"}, {"url": "https://github.com/jamescalam/transformers/blob/main/course/question_answering/11_faiss_in_haystack.ipynb", "anchor_text": "this notebook"}, {"url": "https://twitter.com/jamescalam", "anchor_text": "Twitter"}, {"url": "https://www.youtube.com/c/jamesbriggs", "anchor_text": "YouTube"}, {"url": "https://bit.ly/nlp-transformers", "anchor_text": "\ud83e\udd16 NLP With Transformers Course"}, {"url": "https://medium.com/tag/nlp?source=post_page-----7c564daee9eb---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7c564daee9eb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7c564daee9eb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----7c564daee9eb---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/technology?source=post_page-----7c564daee9eb---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&user=James+Briggs&userId=b9d77a4ca1d1&source=-----7c564daee9eb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&user=James+Briggs&userId=b9d77a4ca1d1&source=-----7c564daee9eb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7c564daee9eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7c564daee9eb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7c564daee9eb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7c564daee9eb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7c564daee9eb--------------------------------", "anchor_text": ""}, {"url": "https://jamescalam.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jamescalam.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "James Briggs"}, {"url": "https://jamescalam.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.6K Followers"}, {"url": "https://www.youtube.com/c/jamesbriggs", "anchor_text": "https://www.youtube.com/c/jamesbriggs"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb9d77a4ca1d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&user=James+Briggs&userId=b9d77a4ca1d1&source=post_page-b9d77a4ca1d1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F75e31c56d187&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffacebook-ai-similarity-search-7c564daee9eb&newsletterV3=b9d77a4ca1d1&newsletterV3Id=75e31c56d187&user=James+Briggs&userId=b9d77a4ca1d1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}