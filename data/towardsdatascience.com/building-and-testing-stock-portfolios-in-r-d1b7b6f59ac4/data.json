{"url": "https://towardsdatascience.com/building-and-testing-stock-portfolios-in-r-d1b7b6f59ac4", "time": 1683009812.3586009, "path": "towardsdatascience.com/building-and-testing-stock-portfolios-in-r-d1b7b6f59ac4/", "webpage": {"metadata": {"title": "Building and Testing Stock Portfolios in R | by Christian Kincaid | Towards Data Science", "h1": "Building and Testing Stock Portfolios in R", "description": "In this article, we\u2019ll examine how to get stock data, analyze it to make investment decisions, and visualize the results. With the recent surge in retail investors entering the market, it\u2019s more\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.investopedia.com/retail-faves-are-beating-hedge-fund-mutual-fund-picks-5024920", "anchor_text": "surge in retail investors", "paragraph_index": 1}, {"url": "https://rpubs.com/ckincaid/631071", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://rpubs.com/ckincaid/631071", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://www.investopedia.com/terms/r/rebalancing.asp#:~:text=Rebalancing%20is%20the%20process%20of,%25%20stocks%20and%2050%25%20bonds.", "anchor_text": "re-balancing", "paragraph_index": 10}, {"url": "https://medium.com/@christiantkincaid", "anchor_text": "following me", "paragraph_index": 12}], "all_paragraphs": ["In this article, we\u2019ll examine how to get stock data, analyze it to make investment decisions, and visualize the results.", "With the recent surge in retail investors entering the market, it\u2019s more important than ever that new traders are armed with the tools they need to compare stocks by analyzing their performance over time. In this post, we\u2019ll use the stock data of three familiar companies \u2014 Starbucks, Carnival, and Apple \u2014 to construct a portfolio, examine its historical performance, and compare it to the S&P 500.", "Three very useful packages for financial analysis in R are quantmod , to pull stock data from Yahoo Finance; PerformanceAnalytics , to construct and test portfolios; and dygraphs , to produce interactive and informative visualizations of our data. If you don\u2019t have these packages installed, you can install and load them into your R environment using the code below.", "Once we have the packages installed and loaded, we can write a function to get monthly return data for our individual stocks. Our function takes two arguments: ticker , the stock\u2019s symbol, and base_year , the year that we want to start analyzing the data.", "This function can appear a bit complicated if you are unfamiliar with R and its packages. Here\u2019s an explanation of each line:", "After writing our function, it\u2019s now available for us to calculate monthly returns for our three stocks. We need to call our function four times \u2014 once for each stock we want to analyze and once for the S&P 500 \u2014 so that we have a benchmark against which to judge each stock\u2019s monthly performance. We can then merge all our monthly returns into one time series object and look at the last several years\u2019 performance for each using the dygraphs package (check out the interactive version here). The last line prints the last five months of return data and its output is reproduced below.", "From our returns data set, we can get a sense of how well each stock has performed relative to the S&P 500 over the last several years. For example, when news of the spread of COVID-19 was roiling financial markets in March 2020, the S&P 500 recorded a loss of about 12.5% while Carnival lost more than 60% of its value for that month. Apple, by contrast, experienced a loss of only about 7%. Using corrplot::corrplot(cor(returns), method = number) generates a correlation matrix to indicate how these stocks\u2019 returns are related to each other.", "A fundamental principle of portfolio management is that you should select stocks with low correlations to each other. You wouldn\u2019t want all the stocks in your portfolio to always rise and fall together \u2014 that could expose you to excess volatility that you may want to avoid, especially if this is a retirement account where preservation of principle is your main concern. A portfolio made up of highly correlated stocks is subject to unsystematic risk stemming from the firm-specific risks inherent to each stock.", "From our correlation matrix, we observe that all of our stocks are positively correlated, albeit in varying degrees. Apple is only weakly correlated with Starbucks (0.27), but Carnival and the S&P 500 have a high correlation (0.71) with each other. Importantly, all of our stocks have a fairly high positive correlation with the market, meaning they tend to move with the market most months.", "We can use the PerformanceAnalytics package to assign weights to our stocks and build a hypothetical portfolio from them. In the following code, we assume that we are investing one-third of our money in Starbucks, one-third in Carnival, and one-third in Apple, excluding the S&P 500 for the moment. The Return.portfolio() function allows us to pass in our individual stock data from the returns object along with their weights. We can set the wealth.index argument equal to TRUE to show how $1 invested in our portfolio in 2015 would have grown over time. Then, we can follow the same process for the S&P 500, excluding the weights argument. After merging our data into one xts object, we can contrast our portfolio with the S&P 500 using another graph (interactive version here):", "If we had invested $1 into our Starbucks-Carnival-Apple portfolio at the beginning of 2015 and didn\u2019t touch it (i.e., no re-balancing), our portfolio\u2019s value would have almost doubled (92.31%). This beat the performance of the S&P 500, which still yielded an impressive return of about 73% over the same time horizon. Of course, we could make some minor tweaks to our code to change portfolio weights, add additional stocks (or other assets like government bonds and precious metals), and experiment with re-balancing. With R and its libraries, our ability to construct and test portfolios is virtually unlimited.", "I hope I\u2019ve made the process of getting and analyzing stock data a little less intimidating. With the code above, we were able to import a large amount of financial information, construct a portfolio, examine its composition, and analyze historical performance relative to a benchmark. In future posts, I\u2019ll explore some other ways we can use R and its libraries to analyze financial data.", "My name is Christian Kincaid and I\u2019m studying finance and economics at the University of Maryland, College Park. If you enjoyed this post, consider following me on Medium!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd1b7b6f59ac4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@christiantkincaid?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christiantkincaid?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Christian Kincaid"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa36fe98cc238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&user=Christian+Kincaid&userId=a36fe98cc238&source=post_page-a36fe98cc238----d1b7b6f59ac4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/6Ih4UoqzaAs", "anchor_text": "Aditya Vyas"}, {"url": "https://towardsdatascience.com/s/photos/stock-market?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.investopedia.com/retail-faves-are-beating-hedge-fund-mutual-fund-picks-5024920", "anchor_text": "surge in retail investors"}, {"url": "https://www.investopedia.com/terms/a/adjusted_closing_price.asp", "anchor_text": "here"}, {"url": "https://rpubs.com/ckincaid/631071", "anchor_text": "here"}, {"url": "https://rpubs.com/ckincaid/631071", "anchor_text": "here"}, {"url": "https://www.investopedia.com/terms/r/rebalancing.asp#:~:text=Rebalancing%20is%20the%20process%20of,%25%20stocks%20and%2050%25%20bonds.", "anchor_text": "re-balancing"}, {"url": "https://medium.com/@christiantkincaid", "anchor_text": "following me"}, {"url": "https://medium.com/tag/r?source=post_page-----d1b7b6f59ac4---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----d1b7b6f59ac4---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/quantitative-finance?source=post_page-----d1b7b6f59ac4---------------quantitative_finance-----------------", "anchor_text": "Quantitative Finance"}, {"url": "https://medium.com/tag/investing?source=post_page-----d1b7b6f59ac4---------------investing-----------------", "anchor_text": "Investing"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----d1b7b6f59ac4---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&user=Christian+Kincaid&userId=a36fe98cc238&source=-----d1b7b6f59ac4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&user=Christian+Kincaid&userId=a36fe98cc238&source=-----d1b7b6f59ac4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd1b7b6f59ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d1b7b6f59ac4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d1b7b6f59ac4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christiantkincaid?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christiantkincaid?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Christian Kincaid"}, {"url": "https://medium.com/@christiantkincaid/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "69 Followers"}, {"url": "https://www.linkedin.com/in/christian-kincaid/", "anchor_text": "https://www.linkedin.com/in/christian-kincaid/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa36fe98cc238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&user=Christian+Kincaid&userId=a36fe98cc238&source=post_page-a36fe98cc238--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f3110afaed6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-and-testing-stock-portfolios-in-r-d1b7b6f59ac4&newsletterV3=a36fe98cc238&newsletterV3Id=1f3110afaed6&user=Christian+Kincaid&userId=a36fe98cc238&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}