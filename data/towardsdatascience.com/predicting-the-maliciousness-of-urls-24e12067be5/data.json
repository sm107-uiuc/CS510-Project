{"url": "https://towardsdatascience.com/predicting-the-maliciousness-of-urls-24e12067be5", "time": 1683006904.414783, "path": "towardsdatascience.com/predicting-the-maliciousness-of-urls-24e12067be5/", "webpage": {"metadata": {"title": "Predicting the Maliciousness of URLs | by Ruth Eneyi Ikwu | Towards Data Science", "h1": "Predicting the Maliciousness of URLs", "description": "In this article, we walk through developing a simple feature set representation for identifying malicious URLs. We will create feature vectors for URLs and use these to develop a classification model\u2026"}, "outgoing_paragraph_urls": [{"url": "http://phishtank.com", "anchor_text": "phishtank.com", "paragraph_index": 4}, {"url": "https://eneyi.github.io/2020/04/01/virustotal.com", "anchor_text": "virustotal", "paragraph_index": 4}, {"url": "https://github.com/eneyi/dataarchive/tree/master/pmurls/data/featurized", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://free-proxy-list.net/", "anchor_text": "https://free-proxy-list.net/", "paragraph_index": 5}, {"url": "https://github.com/eneyi/dataarchive/blob/master/pmurls/data/scanned_data.csv", "anchor_text": "dataset", "paragraph_index": 7}, {"url": "https://eneyi.github.io/2020/04/01/predicting-the-maliciousness-of-urls.html", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://github.com/eneyi/dataarchive/blob/master/pmurls/data/scanned_data.csv", "anchor_text": "the following", "paragraph_index": 16}], "all_paragraphs": ["In this article, we walk through developing a simple feature set representation for identifying malicious URLs. We will create feature vectors for URLs and use these to develop a classification model for identifying malicious URLs. To evaluate how good the features are in separating malicious URLs from benign URLs, we build a Decision-Tree based machine learning model to predict the maliciousness of a given URL.", "Malicious websites are well-known threats in cybersecurity. They act as an efficient tool for propagating viruses, worms, and other types of malicious codes online and are responsible for over 60% of most cyber attacks. Malicious URLs can be delivered via email links, text messages, browser pop-ups, page advertisements, etc. These URLs may be links to dodgy websites or most likely have embedded \u2018downloadables\u2019. These embedded downloads can be spy-wares, key-loggers, viruses, worms, etc. As such it has become a priority for cyber defenders to detect and mitigate the spread of malicious codes within their networks promptly. Various techniques for malicious URL detectors have previously relied mainly on URL blacklisting or signature blacklisting. Most of these techniques offer \u2018after-the-fact\u2019 solutions. To improve the timeliness and abstraction of malicious URL detection methods, machine learning techniques are increasingly being accepted.", "To develop a machine learning model, we need a feature extraction framework for featurizing URLs or converting URLs into feature vectors. In this article, We will collect samples of known malicious URLs and known benign URLs. We then develop a fingerprinting framework and extract a given set of M features for all URLs in the sample. We test the usefulness of these features in separating malicious URLs from benign URLs by developing a simple predictive model with these features. Finally, we measure the model\u2019s ability to predict the maliciousness of URLs as the effectiveness of the features in separating malicious URLs from benign URLs.", "The image below is an overview of the methodological process in this article.", "We collected data from two sources: Alexa Top 1000 sites and phishtank.com. 1000 assumed benign URLs were crawled from Alexa top 1000 websites and 1000 suspected malicious URLs were crawled from phishtank.com. Due to virustotal API limit rates, we randomly sample 500 assumed benign URLs and 500 assumed malicious URLs. The URLs were then scanned through virustotal. URLs with 0 malicious detections were labeled as benign (b_urlX) and URLs with at least 8 detections were labeled as malicious (m_urlX). we dumped the JSON results of each scan in corresponding files \u2018b_urlX.json\u2019, \u2018m_urlX.json\u2019. You can find these files here.", "To confirm that malicious URLs in the sample are malicious, we need to send multiple requests to VirusTotal. VirustTotal provides aggregated results from multiple virus scan engines. Also, we pass URLs through (Shodan)[shodan.io]. Shodan is a search engine for all devices connected to the internet providing service-based features of the URL\u2019s server. VirusTotal and Shodan currently have API rate limits of 4 requests per minute and at least 10,000 requests per month respectively per API key. While the number of URL requests for the data fell within the Shodan API request limits, VirusTotal proved a little more difficult. This is addressed by creating several VT API Keys (be kind, 4 at most) and randomly sampling them in each request. In addition to limits on the number of API requests, sending multiple requests within a short period will lead to IP blocking from VT and Shodan servers. We write a small crawler to get the latest set of elite IP addresses from https://free-proxy-list.net/ and create a new proxy-list on each request given the very short lifespan of free proxies. In addition to IP pooling, we use Python\u2019s FakeUserAgent library to switch User-Agents on each request.", "Finally, For each request, we can send 16 requests per minute as opposed to the previous 4, with a new proxy and user agent. Each request has the following request parameters:", "The scanning from Shodan and VT produced the following dataset. From shodan, we extract the following features:", "The final dataset after scanning is available here. You can download this data and run your analysis.", "The goal is to extract URL characteristics that are important in separating malicious URLs from good URLs. First, let\u2019s look at the relevant parts in the structure of a URL.", "A URL (short for Uniform Resource Locator) is a reference that specifies the location of a web resource on a computer network and a mechanism for retrieving it. The URL is made up of different components as shown in the figure below. The protocol or scheme specifies how (or what is needed for) information is to be transferred. The hostname is a human-readable unique reference of the computer\u2019s IP address on the computer network. The Domain Name Service (DNS) naming hierarchy maps an IP address to a hostname. Compromised URLs are used to perpetrate cyber-attacks online. These attacks may be in any or more forms of phishing emails, spam emails, and drive-by downloads.", "Regarding domains, owners buy domains that people find easier to remember. Owners would normally want names that are specific to a brand, product, or service which they are delivering. This part (the domain)of the URL cannot be changed once set. Malicious domain owners may opt for multiple cheap domain names for example \u2018xsertyh.com\u2019.", "The free URL parameters are parts of a URL that can be changed to create new URLs. These include directory names, file paths, and URL parameters. These free URL parameters are usually manipulated by attackers to create new URLs, embed malicious codes and propagate them.", "There are many techniques for malicious URL detection, two main techniques being a) Blacklisting Techniques, and b) Machine Learning Techniques. Blacklisting involves maintaining a database of known malicious domains and comparing the hostname of a new URL to hostnames in that database. This has an \u2018after-the-fact\u2019 problem. It will be unable to detect new and unseen malicious URL, which will only be added to the blacklist after it has been observed as malicious from a victim. Machine learning approaches, on the other hand, provide a predictive approach that is generalizable across platforms and independent of prior knowledge of known signatures. Given a sample of malicious and benign malware samples, ML techniques will extract features of known good and bad URLs and generalize these features to identify new and unseen good or bad URLs.", "The URL fingerprinting process targets 3 types of URL features:", "A summary of all features extracted are shown in the table below:", "Running the script above produces the following data with 23 features. We will separate integers, booleans, and object column names into separate lists for easier data access.", "The most linear analysis assumes non-multicollinearity between predictor variables i.e pairs of predictor features must not be correlated. The intuition behind this assumption is that there is no additional information added to a model with multiple correlated features as the same information is captured by one of the features.", "Multi-correlated features are also indicative of redundant features in the data and dropping them is a good first step for data dimension reduction. By removing correlated features (and only keeping, one of the groups of observed correlated features), we can address the issues of feature redundancy and collinearity between predictors.", "Let\u2019s create a simple correlation grid to observe the correlation between the derived features for malicious and benign URL and remove one or more of highly correlated features.", "However, we do not want to remove all correlated variables-only those with a very strong correlation that do not add extra information to the model. For this, we define a certain \u2018threshold\u2019 (0.7) for positive and negative correlation observed.", "We see that most of the highly correlated features are negatively correlated. For example, there is a 0.56 negative correlation coefficient between the number of characters in a URL and the entropy of the URL which suggests that shorter URLs have", "Here we will create a function to identify and drop one of multiple correlated features.", "Modeling builds a blueprint for explaining data, from previously observed patterns in the data. Modeling is often predictive in that it tries to use this developed \u2018blueprint\u2019 in predicting the values of future or new observations based on what it has observed in the past.", "Based on the extracted features, we want the best predictive model that tells us if an unseen URL is malicious or benign. Therefore, we seek a unique combination of useful features to accurately separate malicious from benign URLs. We will go through two stages, feature selection, where we select only features useful in predicting the target variable and modeling with decision trees to develop a predictive model for malicious and benign URLs.", "What variables are most useful in identifying a URL as \u2018malicious\u2019 or \u2018benign\u2019? Computationally, we can automatically select what variables are most useful by testing which ones \u2018improves\u2019 or \u2018fails to improve\u2019 the overall performance of the prediction model. This process is called \u2018Feature Selection\u2019. Feature selection also serves the purpose of reducing the dimension of data, addressing issues of computational complexity and model performance. The goal of feature selection is to obtain a useful subset of the original data that is predictive of the target feature in such a way that useful information is not lost (considering all predictors together). Although feature selection goes beyond simple correlation elimination, for this article, we limit our feature selection method simply retaining these features. Let\u2019s create a subset of the original data that contain only uncorrelated features.", "We keep only features that are unique in their contribution to the model. We can now start developing the model with 70% of the original sample and these 14 features. We will keep 30% of the sample to evaluate the model\u2019s performance on new data.", "There are multiple machine learning algorithms (classification) algorithms that can be applied to identifying malicious URLs. After converting URLs to a representative feature vector, we model the \u2018malicious URL identification problem\u2019 as a binary classification problem. A binary classification model trains a predictive model for a class with only two outcomes \u2018Malicious\u2019 and \u2018Benign\u2019. Batch learning algorithms are machine learning algorithms that work under the following assumptions:", "- the entire training data is available before model development and", "- the target variable is known before the model training task.", "Batch algorithms are ideal and effective in that they are explainable discriminative learning models that use simple loss minimization between training data points. Decision trees are one such batch learning algorithms in machine learning.", "In decision analysis, a decision tree is a visual representation of a model\u2019s decision-making process to arrive at certain conclusions. The basic idea behind decision trees is an attempt to understand what factors influence class membership or why a data point belongs to a class label. A decision tree explicitly shows the conditions on which class members are made. Therefore they are a visual representation of the decision-making process.", "Decision tree builds predictive models by breaking down the data set into smaller and smaller parts. The decision to split a subset is based on maximizing the information gain or minimizing information loss from splitting. Starting with the root node (the purest feature with no uncertainty), the tree is formed by creating various leaf nodes based on the purity of the subset.", "In this case, the decision tree will explain class boundaries for each feature to classify a URL as malicious or benign. There are two main factors to consider when building a decision tree:", "- a) What criteria to use in splitting or creating leaf nodes and- b) tree pruning to control how long a tree is allowed to grow to control the risk of over-fitting.", "The criterion parameter of the decision tree algorithm specifies what criteria (Gini or entropy) to control for while the max_depth parameter controls how far the tree is allowed to grow. Gini measurement is the probability of a random sample being classified incorrectly if we randomly pick a label according to the distribution in a branch. Entropy is a measurement of information (or rather lack thereof).", "Unfortunately, since there is no prior knowledge of the right combination of criteria and tree depth, we would have to iteratively test for the optimal values of these two parameters. We test a max_depth for 50 iterations for both criteria and visualize the model accuracy scores.", "It seems the best model is the simplest one with the Gini index and a max depth of 4 with 84% out of sample accuracy. Also, maximizing the entropy does not seem to produce good results suggesting that new parameters added to the model do not necessarily give new information but may produce improved node probability purity. So we can fit and visualize the tree with max_depth = 4 and Gini criteria to identify which features are most important in separating malicious and benign URLs.", "The accuracy of prediction models is very sensitive to parameter tuning of the max_depth (tree pruning) and split quality criteria (node splitting). This also helps in achieving the simplest parsimonious model that prevents over-fitting and performs just as well on unseen data. These parameters are specific to different data problems and it is good practice to test a combination of different parameter values.", "The model shows that malicious URLs have a lower script to special character ratio (sscr) and URL characters that are relatively more \u2018ordered\u2019 or more monotonous. Additionally, malicious URLs may have domains that have expired somewhere between 5\u20139 months ago. We also know of issues of \u2018malvertising\u2019 where scammers take ownership of expired legitimate domains to distribute downloadable malicious codes. Finally, probably the most distinguishing feature of benign URLs is longevity. They seem to moderate script to special character ratio in HTML body content with longer domain lifetime of 4\u20138 years.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Keep Swimming Little Fish \u2014 \u2014 Keep Swimming"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F24e12067be5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rutheneyiikwu.medium.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": ""}, {"url": "https://rutheneyiikwu.medium.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Ruth Eneyi Ikwu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3abbfbfa9c59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&user=Ruth+Eneyi+Ikwu&userId=3abbfbfa9c59&source=post_page-3abbfbfa9c59----24e12067be5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://phishtank.com", "anchor_text": "phishtank.com"}, {"url": "https://eneyi.github.io/2020/04/01/virustotal.com", "anchor_text": "virustotal"}, {"url": "https://github.com/eneyi/dataarchive/tree/master/pmurls/data/featurized", "anchor_text": "here"}, {"url": "https://free-proxy-list.net/", "anchor_text": "https://free-proxy-list.net/"}, {"url": "https://free-proxy-list.net/", "anchor_text": "https://free-proxy-list.net/"}, {"url": "https://github.com/eneyi/dataarchive/blob/master/pmurls/data/scanned_data.csv", "anchor_text": "dataset"}, {"url": "https://eneyi.github.io/2020/04/01/predicting-the-maliciousness-of-urls.html", "anchor_text": "here"}, {"url": "https://github.com/eneyi/dataarchive/blob/master/pmurls/data/scanned_data.csv", "anchor_text": "the following"}, {"url": "https://medium.com/tag/cyber-security?source=post_page-----24e12067be5---------------cyber_security-----------------", "anchor_text": "Cyber Security"}, {"url": "https://medium.com/tag/data-science?source=post_page-----24e12067be5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&user=Ruth+Eneyi+Ikwu&userId=3abbfbfa9c59&source=-----24e12067be5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&user=Ruth+Eneyi+Ikwu&userId=3abbfbfa9c59&source=-----24e12067be5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F24e12067be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----24e12067be5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----24e12067be5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----24e12067be5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----24e12067be5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----24e12067be5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----24e12067be5--------------------------------", "anchor_text": ""}, {"url": "https://rutheneyiikwu.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rutheneyiikwu.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ruth Eneyi Ikwu"}, {"url": "https://rutheneyiikwu.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "69 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3abbfbfa9c59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&user=Ruth+Eneyi+Ikwu&userId=3abbfbfa9c59&source=post_page-3abbfbfa9c59--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1fa8ef68954b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-maliciousness-of-urls-24e12067be5&newsletterV3=3abbfbfa9c59&newsletterV3Id=1fa8ef68954b&user=Ruth+Eneyi+Ikwu&userId=3abbfbfa9c59&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}