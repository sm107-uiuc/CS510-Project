{"url": "https://towardsdatascience.com/the-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093", "time": 1683008216.339875, "path": "towardsdatascience.com/the-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093/", "webpage": {"metadata": {"title": "The Pros and Cons of Running Apache Spark on Kubernetes | by Jean Yves | Towards Data Science", "h1": "The Pros and Cons of Running Apache Spark on Kubernetes", "description": "Kubernetes support was only recently added for Apache Spark. How does it compare to other deployment modes (YARN, Mesos, Standalone)? Is it worth it?"}, "outgoing_paragraph_urls": [{"url": "https://www.datamechanics.co/apache-spark", "anchor_text": "Apache Spark", "paragraph_index": 0}, {"url": "https://kubernetes.io/docs/concepts/workloads/pods/pod/", "anchor_text": "Kubernetes pod", "paragraph_index": 4}, {"url": "https://github.com/apache/spark/blob/master/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/scheduler/cluster/k8s/KubernetesClusterSchedulerBackend.scala", "anchor_text": "KubernetesClusterSchedulerBackend", "paragraph_index": 5}, {"url": "https://www.datamechanics.co/blog-post/spark-and-docker-your-spark-development-cycle-just-got-ten-times-faster", "anchor_text": "bringing down their Spark dev workflow from 5 minutes or more to less than 30 seconds", "paragraph_index": 8}, {"url": "https://towardsdatascience.com/dockerImages", "anchor_text": "blog post", "paragraph_index": 10}, {"url": "https://hub.docker.com/r/datamechanics/spark", "anchor_text": "Dockerhub", "paragraph_index": 10}, {"url": "https://www.datamechanics.co/blog-post/apache-spark-performance-benchmarks-show-kubernetes-has-caught-up-with-yarn", "anchor_text": "Apache Spark Performance Benchmarks show Kubernetes has caught up with YARN", "paragraph_index": 18}, {"url": "https://www.datamechanics.co/blog-post/migrating-from-emr-to-spark-on-kubernetes-with-data-mechanics", "anchor_text": "Read the story", "paragraph_index": 19}, {"url": "https://www.datamechanics.co/blog-post/spark-on-kubernetes-made-easy-how-data-mechanics-improves-on-spark-on-k8s-open-source", "anchor_text": "How Data Mechanics Improves on Spark on Kubernetes open-source", "paragraph_index": 21}, {"url": "https://www.datamechanics.co", "anchor_text": "Data Mechanics", "paragraph_index": 24}, {"url": "https://www.datamechanics.co/blog-post/spark-on-kubernetes-made-easy-how-data-mechanics-improves-on-spark-on-k8s-open-source", "anchor_text": "on top of the open-source version", "paragraph_index": 25}, {"url": "https://www.datamechanics.co", "anchor_text": "website", "paragraph_index": 26}, {"url": "https://calendly.com/datamechanics/demo", "anchor_text": "book a demo", "paragraph_index": 26}, {"url": "https://www.datamechanics.co/blog-post/setting-up-managing-monitoring-spark-on-kubernetes", "anchor_text": "Set up, Manage & Monitor Spark on Kubernetes", "paragraph_index": 27}, {"url": "http://Spot.io", "anchor_text": "Spot.io", "paragraph_index": 29}], "all_paragraphs": ["Apache Spark is an open-source distributed computing framework. In a few lines of code (in Scala, Python, SQL, or R), data scientists or engineers define applications that can process large amounts of data, Spark taking care of parallelizing the work across a cluster of machines.", "Spark itself doesn\u2019t manage these machines. It needs a cluster manager (also sometimes called scheduler). The main cluster-managers are:", "As the new kid on the block, there\u2019s a lot of hype around Kubernetes. In this article, we\u2019ll explain the core concepts of Spark-on-k8s and evaluate the benefits and drawbacks of this new deployment model.", "You can submit Spark apps using spark-submit or the using the spark-operator \u2014 the latter is our preference, but we\u2019ll talk about it in a future tutorial post. This request contains your full application configuration including the code and dependencies to run (packaged as a docker image or specified via URIs), the infrastructure parameters, (e.g. the memory, CPU, and storage volume specs to allocate to each Spark executor), and the Spark configuration.", "Kubernetes takes this request and starts the Spark driver in a Kubernetes pod (a k8s abstraction, just a docker container in this case). The Spark driver can then directly talk back to the Kubernetes master to request executor pods, scaling them up and down at runtime according to the load if dynamic allocation is enabled. Kubernetes takes care of the bin-packing of the pods onto Kubernetes nodes (the physical VMs), and will dynamically scale the various node pools to meet the requirements.", "To go a little deeper, the Kubernetes support of Spark relies mostly on the KubernetesClusterSchedulerBackend which lives in the Spark driver.", "This class keeps track of the current number of registered executors, and the desired total number of executors (from a fixed-size configuration or from dynamic allocation). At periodic intervals (configured by spark.kubernetes.allocation.batch.delay), it will request the creation or deletion of executor pods, and wait for that request to complete before making other requests. Hence this class implements the \u201cdesired state principle\u201d which is dear to Kubernetes fans, favoring declarative over imperative statements.", "The move to containers (Docker containers) is the reason why Kubernetes is so popular in the first place. The benefits of containerization in the software engineering world apply to the big data world and Spark as well. They make your applications more portable, they simplify the packaging of dependencies, they enable repeatable and reliable build workflows.", "The top 3 benefits of using Docker containers for Spark:1) Build your dependencies once, run everywhere (locally or at scale)2) Make Spark more reliable and cost-efficient.3) Speed up your iteration cycle by 10X (at Data Mechanics, our users regularly report bringing down their Spark dev workflow from 5 minutes or more to less than 30 seconds)", "My favorite benefit is dependency management since it\u2019s notoriously painful with Spark. You can choose to build a new docker image for each app or to use a smaller set of docker images that package most of your needed libraries, and dynamically add your application-specific code on top. Say goodbye to long and flaky init scripts compiling C-libraries on each application launch.", "Update (April 2021): We\u2019ve made our optimized Docker images publicly available for anyone to use. They contain connectors to most commonly used data sources \u2014 we hope they\u2019ll just work for you out of the box! Check out our blog post and our Dockerhub page for more details?", "On other cluster-managers (YARN, Standalone, Mesos) if you want to reuse the same cluster for concurrent Spark apps (for cost reasons), you\u2019ll have to compromise on isolation:", "As a consequence, many platforms (Databricks, EMR, Dataproc, \u2026) recommend running transient clusters for production jobs. Start a cluster, run the job, terminate the cluster. The problem with this approach is that you pay for the setup/tear down costs (often about 10 minutes, because it takes a lot of time to setup YARN properly), and you don\u2019t get any resource sharing. It\u2019s very easy to make mistakes and waste a lot of compute resources with this approach.", "Spark on Kubernetes gives you the best of both worlds. You can run all your apps on a single Kubernetes cluster, and each app can choose its own Spark version, python version, dependencies \u2014 you control the Docker image. In 10 seconds, Kubernetes can tear down containers for one app, and re-allocate the ressources to another app. This is very efficient \u2014 at Data Mechanics, we typically achieve 50 to 75% cost savings for our customers as they migrate from other platforms.", "It is also very convenient. With cluster autoscaling (entirely managed for you on the Data Mechanics platform), you can stop having to think about clusters and VMs, and just use Spark in a serverless way. Say goodbye to complex cluster management, queues, and multitenancy tradeoffs of YARN deployments!", "Deploying Spark on Kubernetes gives you powerful features for free such as the use of namespaces and quotas for multitenancy control, and role-based access control (optionally integrated with your cloud provider IAM) for fine-grained security and data access.", "If you have a need outside the k8s scope, the community is very active and it\u2019s likely you\u2019ll find a tool to answer this need. This point is particularly strong if you already use Kubernetes for the rest of your stack as you may re-use your existing toolings, such as the k8s dashboard for basic logging and administration, and Prometheus + Grafana for monitoring.", "We ran benchmarks that prove that there is no performance difference between running Spark on Kubernetes and running Spark on YARN.", "In our blog post \u2014 Apache Spark Performance Benchmarks show Kubernetes has caught up with YARN \u2014 we go over the setup of the benchmark, the results, as well as critical tips to maximize shuffle performance when running Spark on Kubernetes.", "Despite the raw performance of Spark being the same, you can generate significant cost savings by migrating to Spark on Kubernetes as we mentioned earlier. Read the story of a customer who reduced their costs by 65% by migrating from YARN (EMR) to Spark-on-Kubernetes (Data Mechanics).The Cons \u2014 Drawbacks of Spark on Kubernetes", "If you\u2019re new to Kubernetes, the new language, abstractions, and tools it introduces can be frightening and take you away from your core mission. And even if you already have expertise on Kubernetes, there\u2019s just a lot to build:", "This is why we built Data Mechanics \u2014 to take care of all the setup and make Spark on Kubernetes easy-to-use and cost-effective. See How Data Mechanics Improves on Spark on Kubernetes open-source to learn more about what our platform offers on top of open-source.", "Initial support for Spark on Kubernetes started with Spark 2.3 in February 2018, but this version was lacking critical features. At Data Mechanics, we only support Spark 2.4 and above. We highly recommend using:", "Traditional software engineering has shifted towards cloud-native containerization over the past few years, and it\u2019s undeniable a similar shift is happening for big data workloads. In fact, with the upcoming version of Spark (3.1, to be released in December 2020), Spark on Kubernetes will be marked as Generally Available and production ready in the official docs.", "Does it mean that every data team should become Kubernetes experts? No. This is the reason we built Data Mechanics, a managed Spark platform deployed on a Kubernetes inside our customers cloud account (AWS, GCP and Azure).", "We\u2019ve helped many customers run Spark on Kubernetes, both for new Spark projects or as part of a migration from a YARN-based infrastructure. We take care of all the setup and maintenance, and our platform adds intuitive user interfaces, notebook and scheduler integrations, and dynamic optimizations on top of the open-source version to make Spark on Kubernetes more easy-to-use and more cost-effective.", "Curious to learn more? Visit our website and book a demo with us to get started.", "Prefer to build this yourself in an open-source way? Check out our advanced guide on how to Set up, Manage & Monitor Spark on Kubernetes.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Co-Founder @Data Mechanics, The Cloud-Native Spark Platform Senior Product Manager @ Spot.io \u2014 Building Ocean for Spark Former software eng @Databricks."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F13b0e1b17093&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jydatamechanics.medium.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": ""}, {"url": "https://jydatamechanics.medium.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Jean Yves"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa2b0e26e9b8e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&user=Jean+Yves&userId=a2b0e26e9b8e&source=post_page-a2b0e26e9b8e----13b0e1b17093---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@fabioha", "anchor_text": "Fabio"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://www.datamechanics.co/apache-spark", "anchor_text": "Apache Spark"}, {"url": "https://kubernetes.io/docs/concepts/workloads/pods/pod/", "anchor_text": "Kubernetes pod"}, {"url": "https://github.com/apache/spark/blob/master/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/scheduler/cluster/k8s/KubernetesClusterSchedulerBackend.scala", "anchor_text": "KubernetesClusterSchedulerBackend"}, {"url": "https://www.datamechanics.co/blog-post/spark-and-docker-your-spark-development-cycle-just-got-ten-times-faster", "anchor_text": "bringing down their Spark dev workflow from 5 minutes or more to less than 30 seconds"}, {"url": "https://towardsdatascience.com/dockerImages", "anchor_text": "blog post"}, {"url": "https://hub.docker.com/r/datamechanics/spark", "anchor_text": "Dockerhub"}, {"url": "https://spot.io/", "anchor_text": "Spotinst"}, {"url": "https://www.datamechanics.co/blog-post/apache-spark-performance-benchmarks-show-kubernetes-has-caught-up-with-yarn", "anchor_text": "Apache Spark Performance Benchmarks show Kubernetes has caught up with YARN"}, {"url": "https://www.datamechanics.co/blog-post/migrating-from-emr-to-spark-on-kubernetes-with-data-mechanics", "anchor_text": "Read the story"}, {"url": "https://www.datamechanics.co/delight", "anchor_text": "Data Mechanics Delight"}, {"url": "https://www.datamechanics.co/blog-post/spark-on-kubernetes-made-easy-how-data-mechanics-improves-on-spark-on-k8s-open-source", "anchor_text": "How Data Mechanics Improves on Spark on Kubernetes open-source"}, {"url": "https://datamechanics.co/blog-post/apache-spark-3-1-release-spark-on-kubernetes-is-now-ga", "anchor_text": "read our article"}, {"url": "https://www.datamechanics.co", "anchor_text": "Data Mechanics"}, {"url": "https://www.datamechanics.co/blog-post/spark-on-kubernetes-made-easy-how-data-mechanics-improves-on-spark-on-k8s-open-source", "anchor_text": "on top of the open-source version"}, {"url": "https://www.datamechanics.co", "anchor_text": "website"}, {"url": "https://calendly.com/datamechanics/demo", "anchor_text": "book a demo"}, {"url": "https://www.datamechanics.co/blog-post/setting-up-managing-monitoring-spark-on-kubernetes", "anchor_text": "Set up, Manage & Monitor Spark on Kubernetes"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----13b0e1b17093---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----13b0e1b17093---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----13b0e1b17093---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/big-data?source=post_page-----13b0e1b17093---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----13b0e1b17093---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&user=Jean+Yves&userId=a2b0e26e9b8e&source=-----13b0e1b17093---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&user=Jean+Yves&userId=a2b0e26e9b8e&source=-----13b0e1b17093---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F13b0e1b17093&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----13b0e1b17093---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----13b0e1b17093--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----13b0e1b17093--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----13b0e1b17093--------------------------------", "anchor_text": ""}, {"url": "https://jydatamechanics.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jydatamechanics.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jean Yves"}, {"url": "https://jydatamechanics.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "653 Followers"}, {"url": "http://Spot.io", "anchor_text": "Spot.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa2b0e26e9b8e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&user=Jean+Yves&userId=a2b0e26e9b8e&source=post_page-a2b0e26e9b8e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fce4b4cecdaeb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-pros-and-cons-of-running-apache-spark-on-kubernetes-13b0e1b17093&newsletterV3=a2b0e26e9b8e&newsletterV3Id=ce4b4cecdaeb&user=Jean+Yves&userId=a2b0e26e9b8e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}