{"url": "https://towardsdatascience.com/how-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93", "time": 1683007565.925077, "path": "towardsdatascience.com/how-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93/", "webpage": {"metadata": {"title": "How to export a BigQuery ML model and deploy it for online prediction | by Lak Lakshmanan | Towards Data Science", "h1": "How to export a BigQuery ML model and deploy it for online prediction", "description": "In this article, I will show you to export a BigQuery ML model into TensorFlow\u2019s SavedModel format. This will allow you to deploy the model into any environment that supports TensorFlow Serving. I\u2019ll\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.amazon.com/Google-BigQuery-Definitive-Warehousing-Analytics/dp/1492044466", "anchor_text": "BigQuery: The Definitive Guide", "paragraph_index": 1}, {"url": "https://github.com/GoogleCloudPlatform/bigquery-oreilly-book/blob/master/blogs/bqml_model_export/deploy.sh", "anchor_text": "download deploy.sh from the GitHub", "paragraph_index": 12}, {"url": "https://console.cloud.google.com/ai-platform/models/$MODEL_NAME/versions", "anchor_text": "https://console.cloud.google.com/ai-platform/models/london_bicycles/versions", "paragraph_index": 14}], "all_paragraphs": ["In this article, I will show you to export a BigQuery ML model into TensorFlow\u2019s SavedModel format. This will allow you to deploy the model into any environment that supports TensorFlow Serving. I\u2019ll demonstrate this using Cloud AI Platform Predictions, and show you how to invoke the online prediction.", "First, of course, we need a BigQuery ML model. For simplicity, I\u2019ll use a simple linear model on the same London Bicycles dataset used in our book \u201cBigQuery: The Definitive Guide\u201d.", "First, create a dataset in the EU location to hold the trained model (you can run this command in CloudShell, or you can do this from the BigQuery console; just make sure to select EU as the location):", "Next, run this query in the BigQuery console:", "This creates a model called bicycle_model_linear which takes 3 inputs (start_station_name, dayofweek, hourofday) to predict the duration in seconds.", "Let\u2019s try invoking the model in BigQuery itself. To do that, run this query:", "As you can see, the predicted duration for a ride that starts in Vauxhall at 5pm on a weekend is 1329 seconds.", "Let\u2019s download the model from BigQuery as a TensorFlow SavedModel. To do that, run these commands from CloudShell:", "What the command does is to create a bucket named xyz-eu where xyz is your project name. Then, we invoke bq extract to export the model to GCS.", "When the command finishes, check what files have been exported:", "When I did it, I got:", "This is the TensorFlow SavedModel format. You can deploy it to any TF Serving environment for online prediction. On GCP, the fully managed serving environment for TensorFlow/xgboost/PyTorch/etc. models is Cloud AI Platform (CAIP) Predictions.", "To deploy the model, download deploy.sh from the GitHub repository for the book and run it:", "What deploy.sh does is to create a model and model version in CAIP Predictions and then deploy to it.", "Deploying the model can take 4\u20135 minutes, so monitor https://console.cloud.google.com/ai-platform/models/london_bicycles/versions to make sure that the model is deployed before going to the next step.", "Create a file named input.json with the input we want to send the model. You can do this from CloudShell by typing in:", "Then, at the prompt, type in:", "Finally, hit Ctrl-D to get back to the prompt.", "Send input.json to CAIP Predictions using:", "When I did this, I got back:", "This is the same duration that we got when we did batch prediction in BigQuery ML.", "CAIP Predictions exposes a REST API that takes JSON and so it can be invoked from any language that can make a web service call.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa7e4d44c4c93&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----a7e4d44c4c93---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.amazon.com/Google-BigQuery-Definitive-Warehousing-Analytics/dp/1492044466", "anchor_text": "BigQuery: The Definitive Guide"}, {"url": "https://github.com/GoogleCloudPlatform/bigquery-oreilly-book/blob/master/blogs/bqml_model_export/deploy.sh", "anchor_text": "download deploy.sh from the GitHub"}, {"url": "https://console.cloud.google.com/ai-platform/models/$MODEL_NAME/versions", "anchor_text": "https://console.cloud.google.com/ai-platform/models/london_bicycles/versions"}, {"url": "https://github.com/GoogleCloudPlatform/bigquery-oreilly-book/tree/master/blogs/bqml_model_export", "anchor_text": "queries and code"}, {"url": "https://www.amazon.com/Google-BigQuery-Definitive-Warehousing-Analytics/dp/1492044466", "anchor_text": "book on BigQuery"}, {"url": "https://cloud.google.com/bigquery-ml/docs/exporting-models", "anchor_text": "documentation"}, {"url": "https://cloud.google.com/bigquery-ml/docs/export-model-tutorial", "anchor_text": "tutorial"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----a7e4d44c4c93---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----a7e4d44c4c93---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/cloud-ai-platform?source=post_page-----a7e4d44c4c93---------------cloud_ai_platform-----------------", "anchor_text": "Cloud Ai Platform"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a7e4d44c4c93---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----a7e4d44c4c93---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----a7e4d44c4c93---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa7e4d44c4c93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a7e4d44c4c93---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a7e4d44c4c93--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-export-a-bigquery-ml-model-and-deploy-it-for-online-prediction-a7e4d44c4c93&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}