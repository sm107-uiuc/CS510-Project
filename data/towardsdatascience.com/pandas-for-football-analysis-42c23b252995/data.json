{"url": "https://towardsdatascience.com/pandas-for-football-analysis-42c23b252995", "time": 1682996365.468404, "path": "towardsdatascience.com/pandas-for-football-analysis-42c23b252995/", "webpage": {"metadata": {"title": "Pandas for Football Analysis. A Merging and Scraping DataFrame\u2026 | by Stephen Fordham | Towards Data Science", "h1": "Pandas for Football Analysis", "description": "This tutorial will centre on how to merge DataFrames scraped from different online sources. To begin, I will merge the Premier League Table, available from, Wikipedia, with statistics relating to the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/2018%E2%80%9319_Premier_League", "anchor_text": "Wikipedia", "paragraph_index": 0}, {"url": "https://www.soccerstats.com/table.asp?league=england&tid=t", "anchor_text": "soccerstats", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/pandas-in-the-premier-league-78f1d0c21b4f", "anchor_text": "Pandas in the Premier League", "paragraph_index": 4}, {"url": "https://github.com/StephenFordham", "anchor_text": "https://github.com/StephenFordham", "paragraph_index": 31}], "all_paragraphs": ["This tutorial will centre on how to merge DataFrames scraped from different online sources. To begin, I will merge the Premier League Table, available from, Wikipedia, with statistics relating to the average time a team spends leading, level or trailing over the course of a season. This information will be scraped from a separate source, soccerstats.", "The 2018\u201319 Premier League season has just wrapped up. Whilst the race for the title, and the relegation battle have made most of the headlines, it would be intriguing to know how many minutes on average a team needs to be leading in a Premier League match throughout the season to secure European Football.", "When each Premier League campaign finishes, prize money is distributed amongst the teams depending on their league finish position. Through scraping data, and tabularising it into a DataFrame, you can clearly see the impact of Tottenham Hotspur\u2019s draw with Everton on the final day of the season which cost them a third-place finish.", "I import the Pandas module as its alias pd following convention. Pandas has a built in function, read_html which uses libraries like lxml and BeautifulSoup to automatically parse tables out of html files as DataFrame objects. By default, the pandas.read_html function searches for and attempts to parse all tabular data contained within <table> tags. The result is a list of DataFrame objects.", "I use the pandas function pd.read_html() to scrap the Premier League Table from Wikipedia and the leading_level_trailing table form soccerstats. For a quick review how to do this and basic clean-up (it\u2019s simple), please see my article; Pandas in the Premier League.", "This results in the following two DataFrames depicted below. To save space, I have only printed their first 5 rows using the .head() method.", "The \u2018Premier_league\u2019 Table and the \u2018leading_level_trailing\u2019 tables can now be merged. In this case, to merge, I create a new column that is shared between both DataFrames. I could have chosen to use the existing team name column, but many of the entries actually have slightly different names and padding.", "For example, \u2018Manchester City (C)\u2019 is the column value in the premier_league table, but \u2018Manchester City\u2019 is listed in the leading_level_trailing table. As there are many instances of different names, I chose to insert a new column with a simple three letter abbreviation for each team. This saved renaming each team so the corresponding rows would match between the two DataFrames, but there are many ways to do this.", "N.B: When I created the new column, with the team shorthand, the entries have to marry up to their team, for example the first team in the \u2018leading_level_trailing\u2019 table is Arsenal, therefore the first element in my Team_shorthand list is \u2018ARS\u2019 and so forth.", "I create the same Team_abbreviation in the Premier_league table. I can now merge the two DataFrames.", "I decide a new variable name for the merged Table, and use the pd.merge function to merge. I list both tables in parentheses, using the on= parameter to select which column to match on and the how= parameter to keep all the rows in the left, Premier_league table.", "After organizing the DataFrame a bit more thoroughly, for example removing duplicated column names (e.g. Team_y), I check the datatypes of the columns from the merged table \u2018leading_level_trailing_stats\u2019, and convert the columns of type \u2018object\u2019 (a python string) into a numeric datatype that we can apply numeric filter conditions on.", "To answer the original question, we apply filter criteria to the table. This tells us, that a team need to be leading on average for 31.7 minutes to secure European football!", "A prize money column added to this newly formed \u2018Merged_premier_league_table\u2019 would make it even more informative. We could start to draw relationships between the average minutes leading in a Premier League game, and Prize money received.", "However, in this case, when I go to a website, for example RadioTimes, the data I need is not in a table format I can scrape using pd.read_html.", "This means I have two objectives. Firstly, to scrape the data, and secondly I need and turn it into a DataFrame that I can merge with the newly formed \u2018Merged_premier_league_table\u2019.", "I first find the data I need from RadioTimes.", "When I right-click and select inspect I can see the underlying HTML source code. The information I required is nested within the HTML <li> tags which represents list items. These li tags sit within a HTML <ol> Tag.", "To begin scraping this data, I import the requests module, and place the URL of interest in parentheses within the requests.get method. I next import BeautifulSoup to parse this HTML code, and set the parser parameter to \u2018html.parser\u2019. I then use the soup object\u2019s findall method to find all occurrences of \u2018ol\u2019. This returns a results set object which acts like a python list with a list length of 2. I check both lists to find where my information resides. I index the second list under the variable name prize_money_scrape. To see the contents of this list, I use the contents attribute.", "Whilst this list gives me the information I require, each list item is separated by a newline character. As this follows a regular pattern, I can use index notation to provide a step to skip out these newline characters. I start my new earnings list at element 2 (python\u2019s list 1), and increment with a step size of 2, [1::2].", "Now that the newline characters have been eliminated from the list, I need to extract the data from within the <li> tags. To do this, I create a new empty list called records, iterate over the elements in my earnings list, and extract the text\u00a0from\u00a0the\u00a0result\u00a0set\u00a0object, before appending to my new list. To confirm this are working as intended I print the new records list.", "One of the things I really like about Pandas, is that you can turn a list into a DataFrame. It is very simple to do so. I can now turn my records list into a DataFrame by passing it to the pd.DataFrame method. I create a new column title within curly brackets in quotations, separate by a semi-colon, then pass in my list, before closing the curly bracket. When I visualise my one-column DataFrame, I can see it has worked as intended.", "The new DataFrame has one column, will all the information dumped inside. What would be ideal, is if the \u2018Earnings\u2019 and \u2018Team\u2019 were in separate columns. To do this, I split the string on the common hypen\u00a0(-), and use the get method to extract the first element for Earnings and the second element for Team as shown below.", "To merge, with the existing Premier League table, I create a new common column that will be shared between the newly scraped Premier_league_prize_money DataFrame, and the \u2018Merged_premier_league_table. I also remove the prefix \u2018\u00a3\u2019 sign and the suffix \u2018m\u2019 character to convert the \u2018Earnings\u2019 columns into a numeric datatype.", "To finally clean things up I change the name of the Team_x column to team, and change the \u2018Earnings\u2019 column to \u2018Prize_money_millions\u2019 so it is explicitly clear what the numeric value in that column represents.", "To finish, it would be useful to construct a relationship between the continuous variables, \u2018Prize_money_millions\u2019 and \u2018Average_Mins_leading\u2019. It would be reasonable to expect a strong correlation between average minutes leading in a Premier League match and prize money achieved, but to be unambiguously clear, I can draw a scatter plot with a regression line using the regplot function from the seaborne library using the code snippet shown below (here, make sure seaborn and matplotlib are install via the pip command and imported into your python script).", "To determine the correlation, I use the DataFrame.corr method. I have set the optional method parameter to \u2018pearson\u2019, but kendall\u2019, and \u2018spearman\u2019 can also be supplied as optional arguments to override the default, \u2018pearson\u2019.", "As expected the correlation is strong between these two variables. As can be reasonably expected, more time you spend leading, equates to higher Prize money received.", "Finally, to conclude, lets see the impact that the final day draw had on Tottenham\u2019s Prize money.", "Football really is a results business!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Articles on Data Science and Programming https://github.com/StephenFordham"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F42c23b252995&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----42c23b252995--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@stephenfordham?source=post_page-----42c23b252995--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stephenfordham?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Stephen Fordham"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5d3f46276e7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&user=Stephen+Fordham&userId=5d3f46276e7e&source=post_page-5d3f46276e7e----42c23b252995---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@donnycocacola", "anchor_text": "Donnycocacola"}, {"url": "https://en.wikipedia.org/wiki/2018%E2%80%9319_Premier_League", "anchor_text": "Wikipedia"}, {"url": "https://www.soccerstats.com/table.asp?league=england&tid=t", "anchor_text": "soccerstats"}, {"url": "https://towardsdatascience.com/pandas-in-the-premier-league-78f1d0c21b4f", "anchor_text": "Pandas in the Premier League"}, {"url": "https://www.radiotimes.com/news/sport/2019-05-12/premier-league-prize-money-2018-2019/", "anchor_text": "Sourced from RadioTimes"}, {"url": "https://medium.com/tag/data-science?source=post_page-----42c23b252995---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----42c23b252995---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----42c23b252995---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/sports?source=post_page-----42c23b252995---------------sports-----------------", "anchor_text": "Sports"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----42c23b252995---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&user=Stephen+Fordham&userId=5d3f46276e7e&source=-----42c23b252995---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&user=Stephen+Fordham&userId=5d3f46276e7e&source=-----42c23b252995---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----42c23b252995--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F42c23b252995&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----42c23b252995---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----42c23b252995--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----42c23b252995--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----42c23b252995--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----42c23b252995--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----42c23b252995--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stephenfordham?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stephenfordham?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stephen Fordham"}, {"url": "https://medium.com/@stephenfordham/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "977 Followers"}, {"url": "https://github.com/StephenFordham", "anchor_text": "https://github.com/StephenFordham"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5d3f46276e7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&user=Stephen+Fordham&userId=5d3f46276e7e&source=post_page-5d3f46276e7e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbd4ed43cae00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-for-football-analysis-42c23b252995&newsletterV3=5d3f46276e7e&newsletterV3Id=bd4ed43cae00&user=Stephen+Fordham&userId=5d3f46276e7e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}