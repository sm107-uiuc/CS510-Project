{"url": "https://towardsdatascience.com/behavior-trees-with-automated-planning-capability-ad2a9ff9b28e", "time": 1683018124.932634, "path": "towardsdatascience.com/behavior-trees-with-automated-planning-capability-ad2a9ff9b28e/", "webpage": {"metadata": {"title": "Behavior Trees with Automated Planning Capability | by Debby Nirwan | Towards Data Science", "h1": "Behavior Trees with Automated Planning Capability", "description": "Behavior Tree is a powerful alternative to Hierarchical FSMs, which is commonly used in video game and robotics industry. It is hierarchical, modular, and reactive, making it suitable for designing and implementing scalable complex systems. To make behavior tree more scalable, we incorporate automated planning."}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Backward_chaining", "anchor_text": "backward chaining", "paragraph_index": 13}], "all_paragraphs": ["We have seen how powerful the behavior tree is, in the previous post.", "It is hierarchical, modular, and more importantly reactive to changes that happen in the agent\u2019s environment.", "It can be used to replace Hierarchical Finite State Machines (HFSMs), to make the systems more scalable and understandable to humans.", "However, as you may have noticed behavior trees can become very complex if we want the agent to select between many methods to achieve a goal or a task.", "When we plan a trip to a city in another country, we usually start with a higher-level plan and refine it to be more detailed plans.", "We start by planning the main transport between the two countries. There are different options depending on our needs and budget:", "After we have decided the main transport, we can now plan for how we go to the airport or seaport from our house with the money left in our budget and the time constraints that we have, and perhaps the distance between the house and the port. It could be:", "We can create a similar behavior tree to the one above (Main Transport Selection).", "Now we can see that the Trees became more complex even for this rather simple system if we have multiple methods that we want to choose from to achieve our task.", "Here are the full behavior trees:", "If you replace each abstract action with the trees we designed above, you can see that they become quite complex. The trees would become enormously complex in the systems that have lots of behaviors and methods to choose from.", "To simplify the trees \u2014 to only add nodes that will be used \u2014 which would help us greatly in analyzing and debugging the issues that we may encounter, we can incorporate automated planning into behavior trees \u2014 the topic that we have been discussing in all previous posts. We look at the details and implement them on Pacman in the sections below.", "In a paper titled \u201cTowards Blended Reactive Planning and Acting using Behavior Trees\u201d, Michele, Diogo, and Petter show how a planning algorithm can be used to automatically create and update a Behavior Tree.", "The planning is based on the idea of backward chaining, that is we work backward from the goal to create our plans. We set the goal as preconditions and iteratively run the behavior tree and expand the tree when preconditions of a branch return a failure status.", "Expanding the tree means replacing the failed condition node with action node(s) and their condition node(s), as depicted in the illustration below.", "In this article based on the idea published in the paper, we use a modified version of the algorithm, instead of following the pattern of adding fallback, effect condition, sequence, preconditions, and actions nodes, we make it more flexible by preparing a new behavior tree in any patterns and any sizes that we want as shown in the picture below.", "Another difference that we make is that we use Refinement Methods instead of Action Templates to help our planning process.", "Action Templates are used in classical planning approaches where the planner searches the state space to synthesize a plan \u2014 a sequence of actions.", "Refinement Methods are commonly used in HTN (Hierarchical Task Networks) Planning where a Task \u2014 an abstract action, may have multiple methods that can be used to achieve it.", "The primary advantage of using Refinement Methods is the speed of planning because by specifying which methods can be used to achieve a task, we basically limit the options in the search algorithm\u2019s search space.", "Now, let\u2019s see the representation of our methods.", "An example of a method is shown above, it is described as follows:", "We will look at the step-by-step example while implementing it on Pacman to see how it works in detail.", "To illustrate how the algorithm works, we set a task for Pacman, which we call \u201cEat Food\u201d. The goal for this task is \u201cFood is not Available\u201d, so we start with this node as our initial node.", "To simplify the example, let\u2019s assume that there is only one method available for the task \u201cEat food\u201d. The method has one precondition, which is \u201cFood is Available\u201d. It has one effect, \u201cFood is not Available\u201d.", "The associated tree is shown below:", "When \u201cFoodNotAvailable\u201d is ticked it returns FAILURE status which will trigger the planning by searching through the collection of methods. Since we only have one applicable method, we\u2019ll use it.", "The initial tree which only contains a single node is expanded with the Behavior Tree for the Eat Food task.", "Expanding the tree follows these steps:", "Now after the first iteration of planning, we have our first version of the behavior tree.", "When this behavior tree is ticked, it checks whether or not food is available, it then checks whether ghosts are far and execute the primitive actions sequentially, with memory:", "This behavior tree is sufficient if there are no ghosts in Pacman\u2019s world. Like in the Maze Problem below:", "The Pacman execute primitive actions repeatedly until there are no more foods in its world.", "As can be seen in the video, the simple behavior tree above is sufficient to solve this maze problem.", "From the debugging console, we can see that the behavior tree is refined during runtime.", "This behavior tree won\u2019t be sufficient if we added ghosts to the problem because when the ghosts are close, the GhostsAreFar condition node returns failure, which will trigger planning, again.", "The following is the behavior tree for \u201cAvoid Ghosts\u201d:", "The behavior tree is quite simple because the details are abstracted in the \u201cAvoid Ghosts\u201d primitive action.", "The action will be executed only when there are active ghosts (not edible).", "Combining this tree with the existing tree, we get:", "With these combined behavior trees the Pacman can avoid ghosts to eat all foods in its world.", "When it senses dangers, by detecting that ghosts are not far enough, it will check whether all of them are scared, if they are, Pacman won\u2019t try to avoid them. If there are one or more active ghosts, Pacman tries to avoid them before trying to eat the remaining foods again.", "This is the problem that we give to our agent, Pacman. It has to eat all four foods while avoiding ghosts. If on its way to eat food it eats a pill, it will ignore the ghosts as long as they are scared (they turn white when scared). We can see how the Pacman behaves in the video below.", "We can see from the debugging console below how the Behavior Trees evolve during runtime.", "There are two iterations before we get the final Behavior Trees that the Pacman can use in the video above.", "To recap, we know that Behavior Tree is very powerful \u2014 hierarchical, modular, and reactive, which are the properties that we need for designing and implementing complex software systems.", "In this post, we incorporate Automated Planning into Behavior Tree, to make it even more powerful for AI Agent\u2019s Decision-making implementation.", "As shown in Pacman\u2019s Implementation, the Agent \u2014 Pacman is capable of building and updating Behavior Trees during run-time.", "I hope this post gives some insights into what we can do with the Behavior Trees.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software Engineering Manager who loves reading, writing, and coding."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fad2a9ff9b28e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://debby-nirwan.medium.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": ""}, {"url": "https://debby-nirwan.medium.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Debby Nirwan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcfe9f4cd0e8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&user=Debby+Nirwan&userId=cfe9f4cd0e8f&source=post_page-cfe9f4cd0e8f----ad2a9ff9b28e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/designing-ai-agents-behaviors-with-behavior-trees-b28aa1c3cf8a", "anchor_text": "Designing AI Agents\u2019 Behaviors with Behavior TreesDesigning and Implementing Behaviors for AI Agentstowardsdatascience.com"}, {"url": "https://en.wikipedia.org/wiki/Backward_chaining", "anchor_text": "backward chaining"}, {"url": "https://medium.com/tag/behavior-trees?source=post_page-----ad2a9ff9b28e---------------behavior_trees-----------------", "anchor_text": "Behavior Trees"}, {"url": "https://medium.com/tag/behaviour-tree?source=post_page-----ad2a9ff9b28e---------------behaviour_tree-----------------", "anchor_text": "Behaviour Tree"}, {"url": "https://medium.com/tag/automated-planning?source=post_page-----ad2a9ff9b28e---------------automated_planning-----------------", "anchor_text": "Automated Planning"}, {"url": "https://medium.com/tag/ai-planning?source=post_page-----ad2a9ff9b28e---------------ai_planning-----------------", "anchor_text": "Ai Planning"}, {"url": "https://medium.com/tag/robotics?source=post_page-----ad2a9ff9b28e---------------robotics-----------------", "anchor_text": "Robotics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&user=Debby+Nirwan&userId=cfe9f4cd0e8f&source=-----ad2a9ff9b28e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&user=Debby+Nirwan&userId=cfe9f4cd0e8f&source=-----ad2a9ff9b28e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fad2a9ff9b28e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ad2a9ff9b28e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ad2a9ff9b28e--------------------------------", "anchor_text": ""}, {"url": "https://debby-nirwan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://debby-nirwan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Debby Nirwan"}, {"url": "https://debby-nirwan.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "773 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcfe9f4cd0e8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&user=Debby+Nirwan&userId=cfe9f4cd0e8f&source=post_page-cfe9f4cd0e8f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5abacf9d5119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbehavior-trees-with-automated-planning-capability-ad2a9ff9b28e&newsletterV3=cfe9f4cd0e8f&newsletterV3Id=5abacf9d5119&user=Debby+Nirwan&userId=cfe9f4cd0e8f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}