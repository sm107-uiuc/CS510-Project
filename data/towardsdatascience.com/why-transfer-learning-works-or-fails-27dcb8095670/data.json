{"url": "https://towardsdatascience.com/why-transfer-learning-works-or-fails-27dcb8095670", "time": 1683007301.140725, "path": "towardsdatascience.com/why-transfer-learning-works-or-fails-27dcb8095670/", "webpage": {"metadata": {"title": "Why transfer learning works or fails? | by Ievgen Redko | Towards Data Science", "h1": "Why transfer learning works or fails?", "description": "Transfer learning and domain adaptation fail and does not work in practice, and in this article I explain the intuition behind it."}, "outgoing_paragraph_urls": [{"url": "https://research.fb.com/wp-content/uploads/2016/11/deepface-closing-the-gap-to-human-level-performance-in-face-verification.pdf", "anchor_text": "Facebook\u2019s DeepFace", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Vapnik%E2%80%93Chervonenkis_dimension#In_statistical_learning_theory", "anchor_text": "all the latest work", "paragraph_index": 4}, {"url": "https://arxiv.org/pdf/1611.03530.pdf", "anchor_text": "learn well from any rubbish", "paragraph_index": 5}, {"url": "https://www.aliexpress.com/item/32582734205.html", "anchor_text": "Aliexpress", "paragraph_index": 11}, {"url": "https://www.amazon.co.uk/1-5kg-Fresh-Salmon-Fillet-Boned/dp/B0747NCFJB", "anchor_text": "Amazon", "paragraph_index": 11}, {"url": "http://www.alexkulesza.com/pubs/adapt_mlj10.pdf", "anchor_text": "the seminal paper on transfer learning theory", "paragraph_index": 13}, {"url": "https://arxiv.org/pdf/2004.11829v1.pdf", "anchor_text": "those numerous papers", "paragraph_index": 14}, {"url": "https://towardsdatascience.com/search?q=transfer%20learning", "anchor_text": "transfer learning algorithms that were discussed on Medium before", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/deep-domain-adaptation-in-computer-vision-8da398d3167f", "anchor_text": "kernel-based, moment matching, or adversarial approaches", "paragraph_index": 18}, {"url": "http://proceedings.mlr.press/v9/david10a/david10a.pdf", "anchor_text": "this paper", "paragraph_index": 19}], "all_paragraphs": ["During the NIPS tutorial talk given in 2016, Andrew Ng said that transfer learning \u2014 a subarea of machine learning where the model is learned and then deployed in related, yet different, areas \u2014 will be the next driver of machine learning commercial success in the years to come. This statement would be hard to contest as avoiding learning large-scale models from scratch would significantly reduce the high computational and annotation efforts required for it and save data science practitioners lots of time, energy, and, ultimately, money.", "As an illustration of these latter words, consider Facebook\u2019s DeepFace algorithm that was the first to achieve a near-human performance in face verification back in 2014. The neural network behind it was trained on 4.4 million labeled faces \u2014 an overwhelming amount of data that had to be collected, annotated, and then trained on for 3 full days without taking into account the time needed for fine-tuning. It won\u2019t be an exaggeration to say that most of the companies and research teams without Facebook\u2019s resources and deep learning engineers would have to put in months or even years of work to complete such a feat, with most of this time spent on collecting an annotated sample large enough to build such an accurate classifier.", "This is where transfer learning magically steps in by allowing us to use the same model across related datasets just as we would have done it if they were to come from the same source. Despite being quite efficient and helpful for such challenging tasks as computer vision and natural language processing, transfer learning algorithms also fail badly in practice, and explaining why it may or may not happen is what I will attempt to do below.", "To start my brief and painless introduction to transfer learning theory, let me introduce Homer, a guy in his late 30s who got all excited because of the hype around machine learning and decided to automatically classify all the weird stuff he buys on Aliexpress for his online shop. The main motivation of Homer stemmed from his laziness, the fact that translated English descriptions on Aliexpress were usually quite confusing, to say the least, meaning that only photos of what Homer buys were providing any information about the actual item.", "And so, Homer downloaded a huge annotated dataset of items sold on Amazon, hoping that a classifier learned on them was going to work well on his images from Aliexpress too. \u201cWhat made him think so?\u201d you may ask. Well, first of all, Homer assumed that with that many images from Amazon, he can learn a low-error classifier for them using a state-of-the-art deep neural network with 1 trillion layers. Also, during all summer vacations spent at his grandmother\u2019s house near the sea, Homer had a chance to read all the latest work of Mr. Vapnik and Mr. Chervonenkis who, (very) broadly speaking, had suggested the following inequality:", "Homer knew that the first term on the right-hand side can be made as small as desired due to neural networks\u2019 capacity to learn well from any rubbish fed into them. Also, Homer supposed that the high complexity of the neural network in the numerator of the second term was going to be compensated by the large sample size at his disposal, thus bringing it close to 0 too. The last piece of the puzzle that bothered Homer is the left-hand side, as he was not sure whether the classification error on unseen items from Amazon was going to be close to that achieved on items from Aliexpress. To deal with this, he made the following simple assumption:", "\u201cWhat kind of distance?\u201d a curious reader will ask and will be right to do so. But Homer didn\u2019t not care about such details and, being now quite happy with himself, proceeded to the following ultimate inequality:", "\u201cNow I know what to do,\u201d said Homer to himself, meaning transfer learning and not his unsettled life in general. \u201cFirst, I need to find a way to transform images from Amazon so that they will look as similar as possible to those from Aliexpress, thus reducing the distance between them. Then, I will learn a low-error classifier on the transformed images, as I still have ground-truth labels for them, and will apply this classifier further on my images from Aliexpress.\u201d", "After some moments of thinking, he became uncertain about his idea. \u201cIs there is something I am missing here?\u201d he asked himself, while ordering a laser saber umbrella from Aliexpress\u2019 website, and as it happens, he did.", "While Homer\u2019s intuition about transfer learning formalized in the last inequality was generally right, he still lacked a well-defined notion of a distance that he could have used as a measure of transferability between two datasets.", "\u201cRoughly speaking,\u201d Homer reasoned with himself, \u201c there are two possible ways of comparing datasets: an unsupervised and a supervised one. If I go with the supervised one, it means that I take into account both images and their labels to measure the distance; if I opt for the unsupervised one, I consider images only.\u201d", "Both these approaches bothered Homer, but for different reasons. For the supervised approach, he had to have labels for Aliexpress images, which was something that he was trying to obtain with transfer learning in the first place. As for the unsupervised one, he thought that it was not accurate enough as two images can seem similar even when they belong to different categories. \u201cHow\u2019s that can be?\u201d you may wonder. Well, just take a look at the following two items sold on Aliexpress and Amazon websites and tell me to which category each of them belongs.", "Obviously, the one on the left is a sleeping pillow (it was obvious, wasn\u2019t it?!), while that on the right is a salmon fillet. To avoid this sort of confusion, Homer decided to put forward the following assumption:", "Homer thought that putting the labeling functions into the equation\u2014 functions that output the category of any possible item from their respective online platform \u2014 is the most straightforward way to account for both the annotations of the datasets and the actual similarity of their images. Surprisingly, this is how he (almost) came up with a result extremely close to Theorem 1 from the seminal paper on transfer learning theory.", "You may be quite surprised if I tell you that most of the papers on transfer learning theory boil down to the inequality derived by Homer from his very basic understanding of machine learning principles. The only difference between those numerous papers and Homer\u2019s down-to-earth reasoning is that Homer had to get through by making the assumptions and not by actually proving the desired result contrary to the published works.", "I will now show you a slightly reformulated inequality that captures the essence of both Theorem 1 and Homer\u2019s reasoning, and then we will see how it can be used to justify all those transfer learning algorithms that were discussed on Medium before. My reformulation writes as follows:", "Here, my target domain is any dataset that I may want to categorize without manually annotating it; in Homer\u2019s example, it consists of images of the items sold on Aliexpress. My source domain, abundant Amazon images in that same example, is any annotated dataset for which I can produce a low-error model used in the target domain afterwords. The second term on the right-hand side is an unsupervised distance between the two domains that we can usually calculate without knowing the labels of instances in any of them. Researchers working on transfer learning proposed many different candidates for this term, and most of them took the form a certain divergence between the (marginal) distributions of the two domains. Finally, the third term represents what is usually called the a priori adaptability: a non-estimable quantity that we can compute only when the true target domain\u2019s labeling function is known. This latter observation brings us to the following important conclusion.", "While a transfer learning algorithm can explicitly minimize the first two terms of our inequality, the a priori adaptability term remains uncontrollable, potentially leading to a failure of transfer learning.", "If you wait for a magic solution at this point, then I will have to disappoint you by saying that there is no such solution. You can use kernel-based, moment matching, or adversarial approaches, but it won\u2019t change anything: in the end you will be left at the mercy of the non-estimable term that may ultimately impact the final performance of your model in the target domain with its invisible hand. The good news, however, is that in most cases, it will still work better than doing no transfer at all.", "I will now present a simple example provided in this paper that highlights one of the pitfalls of transfer learning approach following the philosophy described above. In this example, we will consider two 1-dimensional datasets, representing the source and target domains, and generated using the code given below.", "Executing this piece of code produces two sets of points in the interval [0,1], as in the figure below.", "For instance, when \u03be = 0.1, it will return the following two lists:", "I will further attribute label 1 to all points from the source domain and label 0 to those from the target domain. My final learning samples will thus become:", "Is it easy to find a perfect classifier for each of these samples? Yes, it is, as, in case of the source domain, it can be done using a threshold function that outputs 1 for points whose coordinate is smaller than 0.8, and 0, otherwise. The same holds for the target domain, but this time the classifier will output 0 for all points whose coordinate is smaller than 0.9, and 1, otherwise. Finally, we will now make sure that the distance between these two domains depends on \u03be and thus can be made arbitrarily small by reducing it. To do this, we will use the 1-Wasserstein distance that is exactly equal to \u03be in our case. Let\u2019s verify it using the following code:", "To summarize, we now have a source domain for which we can learn a perfect classifier and a target domain that can be made arbitrary close to it and for which there exists a perfect classifier too. Now, the question we ask is: Can transfer learning succeed in this seemingly very favorable case?! Well, as you may have already guessed, no, it can\u2019t, and the reason for this hides in the non-estimable term that I have mentioned before. Indeed, in this setup, a classifier that would be good for both domains simultaneously does not exist, whatever you may do. Actually, its lowest possible error will be exactly equal to 1-\u03be which, once again, can be made arbitrary close to 1 by manipulating \u03be accordingly. As put by the authors of the paper establishing the foundation of the transfer learning theory,", "\u201cWhen there is no classifier that performs well on both the source and target domains, we cannot hope to find a good target model by training only on the source domain.\u201d", "Sadly enough, this is true for all transfer learning approaches that do not have access to labels in the target domain.", "While this article may seem a little pessimistic, its main goal, however, is to provide a general understanding of transfer learning theory to the interested reader and not to deceive him or her from using transfer learning methods. Indeed, transfer learning algorithms are usually quite efficient in practice as they are often applied to datasets that have a strong semantic connection between them. In this case, assuming that the non-estimable term is small is reasonable as, most likely, there exists a good classifier that will work well for both domains. However, as it often happens in life, you will never know if this is the case unless you try it, and that\u2019s what makes the beauty of it.", "P.S. Let me know in the comments if you want a more in-depth discussion of the technical details behind any paper on transfer learning theory that you may be interested in.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F27dcb8095670&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ievred.medium.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": ""}, {"url": "https://ievred.medium.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Ievgen Redko"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffde5e3dd8903&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&user=Ievgen+Redko&userId=fde5e3dd8903&source=post_page-fde5e3dd8903----27dcb8095670---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.slideshare.net/SebastianRuder/transfer-learning-the-next-frontier-for-machine-learning", "anchor_text": "slideshare"}, {"url": "https://research.fb.com/wp-content/uploads/2016/11/deepface-closing-the-gap-to-human-level-performance-in-face-verification.pdf", "anchor_text": "Facebook\u2019s DeepFace"}, {"url": "https://en.wikipedia.org/wiki/Vapnik%E2%80%93Chervonenkis_dimension#In_statistical_learning_theory", "anchor_text": "all the latest work"}, {"url": "https://arxiv.org/pdf/1611.03530.pdf", "anchor_text": "learn well from any rubbish"}, {"url": "https://www.aliexpress.com/item/32582734205.html", "anchor_text": "Aliexpress"}, {"url": "https://www.amazon.co.uk/1-5kg-Fresh-Salmon-Fillet-Boned/dp/B0747NCFJB", "anchor_text": "Amazon"}, {"url": "http://www.alexkulesza.com/pubs/adapt_mlj10.pdf", "anchor_text": "the seminal paper on transfer learning theory"}, {"url": "https://arxiv.org/pdf/2004.11829v1.pdf", "anchor_text": "those numerous papers"}, {"url": "https://towardsdatascience.com/search?q=transfer%20learning", "anchor_text": "transfer learning algorithms that were discussed on Medium before"}, {"url": "https://towardsdatascience.com/deep-domain-adaptation-in-computer-vision-8da398d3167f", "anchor_text": "kernel-based, moment matching, or adversarial approaches"}, {"url": "http://proceedings.mlr.press/v9/david10a/david10a.pdf", "anchor_text": "this paper"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----27dcb8095670---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----27dcb8095670---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/domain-adaptation?source=post_page-----27dcb8095670---------------domain_adaptation-----------------", "anchor_text": "Domain Adaptation"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----27dcb8095670---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----27dcb8095670---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&user=Ievgen+Redko&userId=fde5e3dd8903&source=-----27dcb8095670---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&user=Ievgen+Redko&userId=fde5e3dd8903&source=-----27dcb8095670---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F27dcb8095670&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----27dcb8095670---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----27dcb8095670--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----27dcb8095670--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----27dcb8095670--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----27dcb8095670--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----27dcb8095670--------------------------------", "anchor_text": ""}, {"url": "https://ievred.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ievred.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ievgen Redko"}, {"url": "https://ievred.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "94 Followers"}, {"url": "http://ievred.github.io/", "anchor_text": "ievred.github.io/"}, {"url": "http://twitter.com/IevgenRedko", "anchor_text": "twitter.com/IevgenRedko"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffde5e3dd8903&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&user=Ievgen+Redko&userId=fde5e3dd8903&source=post_page-fde5e3dd8903--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F98cb622434ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-transfer-learning-works-or-fails-27dcb8095670&newsletterV3=fde5e3dd8903&newsletterV3Id=98cb622434ea&user=Ievgen+Redko&userId=fde5e3dd8903&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}