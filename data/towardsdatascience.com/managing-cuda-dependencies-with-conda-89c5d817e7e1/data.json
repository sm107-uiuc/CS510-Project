{"url": "https://towardsdatascience.com/managing-cuda-dependencies-with-conda-89c5d817e7e1", "time": 1683007339.3917282, "path": "towardsdatascience.com/managing-cuda-dependencies-with-conda-89c5d817e7e1/", "webpage": {"metadata": {"title": "Managing CUDA dependencies with Conda | by David R. Pugh | Towards Data Science", "h1": "Managing CUDA dependencies with Conda", "description": "Transitioning your data science projects from CPU to GPU can seem like a daunting task. In particular, there is quite a bit of unfamiliar additional software, such as NVIDIA CUDA Toolkit, NVIDIA\u2026"}, "outgoing_paragraph_urls": [{"url": "https://developer.nvidia.com/cuda-toolkit", "anchor_text": "NVIDIA CUDA Toolkit", "paragraph_index": 0}, {"url": "https://developer.nvidia.com/nccl", "anchor_text": "NVIDIA Collective Communications Library (NCCL)", "paragraph_index": 0}, {"url": "https://developer.nvidia.com/cudnn", "anchor_text": "NVIDIA Deep Neural Network Library (cuDNN", "paragraph_index": 0}, {"url": "https://docs.conda.io/en/latest/", "anchor_text": "Conda", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-b8b50aa8be0e", "anchor_text": "Getting started with Conda", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-406365a539ab", "anchor_text": "Managing your data science projects with Conda", "paragraph_index": 2}, {"url": "https://stackoverflow.com/questions/56470424/nvcc-missing-when-installing-cudatoolkit", "anchor_text": "do not include the NVIDIA CUDA Compiler (NVCC)", "paragraph_index": 5}, {"url": "https://conda-forge.org/", "anchor_text": "Conda Forge", "paragraph_index": 8}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 10}, {"url": "https://pytorch.org/get-started/locally/", "anchor_text": "recommended way", "paragraph_index": 10}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow", "paragraph_index": 12}, {"url": "https://rapids.ai/index.html", "anchor_text": "NVIDIA RAPIDS", "paragraph_index": 15}, {"url": "https://pandas.pydata.org/", "anchor_text": "Pandas", "paragraph_index": 16}, {"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "Scikit-learn", "paragraph_index": 16}, {"url": "https://www.blazingsql.com/", "anchor_text": "BlazingSQL", "paragraph_index": 17}, {"url": "https://datashader.org/", "anchor_text": "Datashader", "paragraph_index": 18}, {"url": "https://github.com/rusty1s/pytorch_cluster", "anchor_text": "PyTorch Cluster", "paragraph_index": 24}, {"url": "http://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 24}, {"url": "https://pytorch-geometric.readthedocs.io/en/latest/", "anchor_text": "PyTorch Geometric", "paragraph_index": 25}, {"url": "https://anaconda.org/nvidia/nvcc_linux-64", "anchor_text": "nvcc_linux-64", "paragraph_index": 27}, {"url": "https://towardsdatascience.com/building-a-conda-environment-for-horovod-773bd036bf64", "anchor_text": "Building a Conda environment for Horovod", "paragraph_index": 28}], "all_paragraphs": ["Transitioning your data science projects from CPU to GPU can seem like a daunting task. In particular, there is quite a bit of unfamiliar additional software, such as NVIDIA CUDA Toolkit, NVIDIA Collective Communications Library (NCCL), and NVIDIA Deep Neural Network Library (cuDNN) to download and install.", "If you go to the NVIDIA developer website you will find loads of documentation and instructions for how to install these libraries system wide. But then what do you do if you need different versions of these new libraries for different projects? You could install a bunch of different versions of NVIDIA CUDA Toolkit, NCCL, and cuDNN system wide and then use environment variables to control the \u201cactive\u201d versions for each project but this is cumbersome and error prone. Fortunately there are better ways!", "In this post I am going to show you how to manage project specific versions of the NVIDIA CUDA Toolkit, NCCL, and cuDNN using Conda. I will assume a basic familiarity with Conda so if you haven\u2019t hear of Conda or are just getting started I would encourage you to read my other articles Getting started with Conda, and Managing your data science projects with Conda.", "Yep! You can use the conda search command to see what versions of the NVIDIA CUDA Toolkit are available from the default channels.", "NVIDIA actually maintains their own Conda channel and the versions of CUDA Toolkit available from the default channels are the same as those you will find on the NVIDIA channel. If you are interested in confirming this you can run the commandconda search --channel nvidia cudatoolkit and then compare the build numbers with those listed above from the default channels.", "An important limitation of the versions of the NVIDIA CUDA Toolkit that are available from the either the default or NVIDIA Conda channels is that they do not include the NVIDIA CUDA Compiler (NVCC).", "You will also find various versions of cuDNN available from the default channels.", "There are some older versions of NCCL available from the default channels but these versions will not be useful (unless you are forced to use very old versions of TensorFlow or similar).", "Not to worry! Conda Forge to the rescue. Conda Forge is a community-led collection of recipes, build infrastructure and distributions for the Conda package manager. I always check the conda-forge channel when I can\u2019t find something I need available on the default channels.", "Now that you know how to figure out which versions of the various NVIDIA CUDA libraries are available on which channels you are ready to write your environment.yml file. In this section I will provide some example Conda environment files for PyTorch, TensorFlow, and NVIDIA RAPIDS to help get you started on your next GPU data science project.", "PyTorch is an open source machine learning library based on the Torch library, used for applications such as computer vision and natural language processing. It is primarily developed by Facebook\u2019s AI Research lab. Conda is actually the recommended way to install PyTorch.", "The official PyTorch binary ships with NCCL and cuDNN so it is not necessary to include these libraries in your environment.yml file (unless some other package also needs these libraries!). Also take note of the channel priorities: the official pytorch channel must be given priority over conda-forge in order to insure that the official PyTorch binaries (the ones that include NCCL and cuDNN) will be installed (otherwise you will get some unofficial version of PyTorch available on conda-forge).", "TensorFlow is a free, open-source software library for dataflow and differentiable programming across a range of tasks. It is a symbolic math library, and is also used for machine learning applications such as neural networks.", "There are lots of versions and builds of TensorFlow available via Conda (the output of conda search tensorflow is too long to share here!). How do you decide which version is the \u201ccorrect\u201d version? How to make sure that you get a build that includes GPU support?", "Use the tensorflow-gpu meta-package to select the appropriate version and build of TensorFlow for your OS.", "As a final example I want to show you how to get started with NVIDIA RAPIDS (and friends!).", "NVIDIA RAPIDS is a suite of open source software libraries and APIs gives you the ability to execute end-to-end data science and analytics pipelines entirely on GPUs (think Pandas + Scikit-learn but for GPUs instead of CPUs).", "I have also included BlazingSQL in this example environment file. BlazingSQL is an open-source SQL interface to extract-transform-load (ETL) massive datasets directly into GPU memory for analysis using NVIDIA RAPIDS. Installing BlazingSQL so that it works properly with NVIDIA RAPIDS was a bit trickier than most Conda package installs so I decided to include a working example here.", "Finally, the environment above also includes Datashader, a graphics pipeline system for creating meaningful representations of large datasets quickly and flexibly, that can be accelerated with GPUs. If you are going to do all of your data analysis on the GPU you might as well do your data visualization on the GPU too.", "Way up at the beginning of this article I mention that the versions of the NVIDIA CUDA Toolkit available via the default channels did not include the NVIDIA CUDA Compiler (NVCC). However, if your data science project has dependencies that require compiling custom CUDA extensions then you will almost surely need the NVIDIA CUDA Compiler (NVCC).", "How do you know that your project dependencies need NVCC? Most likely you will try the standard approaches above and Conda will fail to successfully create the environment and perhaps throw a bunch of compiler errors. Once you know that you need NVCC, there are a couple of ways to get the NVCC compiler installed.", "The cudatoolkit-dev package available from the conda-forge channel includes GPU-accelerated libraries, debugging and optimization tools, a C/C++ compiler and a runtime library. This package consists of a post-install script that downloads and installs the full CUDA toolkit (NVCC compiler and libraries, but not the exception of CUDA drivers).", "While the cudatoolkit-dev packages available from conda-forge do include NVCC, I have had difficult getting these packages to consistently install properly.", "That said, it is always worth trying the cudatoolkit-dev approach first. Maybe it will work for your use case.", "Here is an example that uses NVCC installed via the cudatoolkit-dev package to compile custom extensions from PyTorch Cluster, a small extension library of highly optimized graph cluster algorithms for the use with PyTorch.", "The requirements.txt file referenced above contains PyTorch Cluster and related packages such as PyTorch Geometric. Here is what that file looks like.", "The use of the --no-binary option here insures that the packages with custom extensions will be re-built whenever the environment is re-built which helps increase the reproducibility of the environment build process when porting from workstations to remote clusters that might have different OS.", "The most robust approach to obtain NVCC and still use Conda to manage all the other dependencies is to install the NVIDIA CUDA Toolkit on your system and then install a meta-package nvcc_linux-64 from conda-forge which configures your Conda environment to use the NVCC installed on your system together with the other CUDA Toolkit components installed inside the Conda environment. While I have found this approach to be more robust then relying on cudatoolkit-dev, this approach is more involved as it requires installing a particular version of the NVIDIA CUDA Toolkit on your system first.", "To see a fully worked out example of this approach take a look at my recent article Building a Conda environment for Horovod.", "I covered a lot of ground in this post. I showed you how to use conda search to see which versions of the NVIDIA CUDA Toolkit and related libraries such as NCCL and cuDNN were available via Conda. Then I walked you through example Conda environment files for several popular data science frameworks that can use GPUs. Hopefully these ideas will help you make the jump from CPUs to GPUs on your next data science project!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Staff Scientist, KAUST; Certified Instructor, Software Carpentry; Associate, INET, University of Oxford."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F89c5d817e7e1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://davidrpugh.medium.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "David R. Pugh"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69235b698a4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&user=David+R.+Pugh&userId=69235b698a4b&source=post_page-69235b698a4b----89c5d817e7e1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://developer.nvidia.com/cuda-toolkit", "anchor_text": "NVIDIA CUDA Toolkit"}, {"url": "https://developer.nvidia.com/nccl", "anchor_text": "NVIDIA Collective Communications Library (NCCL)"}, {"url": "https://developer.nvidia.com/cudnn", "anchor_text": "NVIDIA Deep Neural Network Library (cuDNN"}, {"url": "https://docs.conda.io/en/latest/", "anchor_text": "Conda"}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-b8b50aa8be0e", "anchor_text": "Getting started with Conda"}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-406365a539ab", "anchor_text": "Managing your data science projects with Conda"}, {"url": "https://stackoverflow.com/questions/56470424/nvcc-missing-when-installing-cudatoolkit", "anchor_text": "do not include the NVIDIA CUDA Compiler (NVCC)"}, {"url": "https://conda-forge.org/", "anchor_text": "Conda Forge"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://pytorch.org/get-started/locally/", "anchor_text": "recommended way"}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow"}, {"url": "https://rapids.ai/index.html", "anchor_text": "NVIDIA RAPIDS"}, {"url": "https://pandas.pydata.org/", "anchor_text": "Pandas"}, {"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "Scikit-learn"}, {"url": "https://www.blazingsql.com/", "anchor_text": "BlazingSQL"}, {"url": "https://datashader.org/", "anchor_text": "Datashader"}, {"url": "https://github.com/rusty1s/pytorch_cluster", "anchor_text": "PyTorch Cluster"}, {"url": "http://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://pytorch-geometric.readthedocs.io/en/latest/", "anchor_text": "PyTorch Geometric"}, {"url": "https://anaconda.org/nvidia/nvcc_linux-64", "anchor_text": "nvcc_linux-64"}, {"url": "https://towardsdatascience.com/building-a-conda-environment-for-horovod-773bd036bf64", "anchor_text": "Building a Conda environment for Horovod"}, {"url": "https://medium.com/tag/conda?source=post_page-----89c5d817e7e1---------------conda-----------------", "anchor_text": "Conda"}, {"url": "https://medium.com/tag/nvidia?source=post_page-----89c5d817e7e1---------------nvidia-----------------", "anchor_text": "Nvidia"}, {"url": "https://medium.com/tag/data-science?source=post_page-----89c5d817e7e1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----89c5d817e7e1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----89c5d817e7e1---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&user=David+R.+Pugh&userId=69235b698a4b&source=-----89c5d817e7e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&user=David+R.+Pugh&userId=69235b698a4b&source=-----89c5d817e7e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F89c5d817e7e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----89c5d817e7e1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----89c5d817e7e1--------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David R. Pugh"}, {"url": "https://davidrpugh.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "197 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69235b698a4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&user=David+R.+Pugh&userId=69235b698a4b&source=post_page-69235b698a4b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa553329a5b76&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-cuda-dependencies-with-conda-89c5d817e7e1&newsletterV3=69235b698a4b&newsletterV3Id=a553329a5b76&user=David+R.+Pugh&userId=69235b698a4b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}