{"url": "https://towardsdatascience.com/how-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd", "time": 1683013607.324896, "path": "towardsdatascience.com/how-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd/", "webpage": {"metadata": {"title": "Custom Object Detection Using Keras and OpenCV | by Samuel Mohebban | Towards Data Science", "h1": "Custom Object Detection Using Keras and OpenCV", "description": "Tutorial on how to build your very own weapon detection system using Keras and OpenCV. This approach utilizes a sliding window, region of interest, and selective search segmentation."}, "outgoing_paragraph_urls": [{"url": "https://www.pyimagesearch.com/", "anchor_text": "PyImageSearch", "paragraph_index": 0}, {"url": "http://www.imfdb.org/wiki/Main_Page", "anchor_text": "IMFDB.com", "paragraph_index": 1}, {"url": "https://drive.google.com/file/d/1EZZKhCk0DK3S9zB53o3nWhKrZUbmN2Up/view?usp=sharing", "anchor_text": "Google Drive", "paragraph_index": 1}, {"url": "https://scaleops.ai/", "anchor_text": "ScaleOps.AI", "paragraph_index": 1}, {"url": "https://www.pyimagesearch.com/2020/07/13/r-cnn-object-detection-with-keras-tensorflow-and-deep-learning/", "anchor_text": "this", "paragraph_index": 2}, {"url": "https://github.com/HeeebsInc/WeaponDetection", "anchor_text": "GitHub Repo", "paragraph_index": 4}, {"url": "https://www.youtube.com/watch?v=e6tFxT-BpFg&t=1s&ab_channel=SamuelMohebban", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://github.com/marcotcr/lime", "anchor_text": "LIME", "paragraph_index": 22}, {"url": "https://github.com/HeeebsInc/NN_Weapon_Detection", "anchor_text": "GitHub Repo", "paragraph_index": 25}, {"url": "https://github.com/HeeebsInc/WeaponDetection", "anchor_text": "GitHub", "paragraph_index": 26}], "all_paragraphs": ["I recently completed a project I am very proud of and figured I should share it in case anyone else is interested in implementing something similar to their specific needs. Before I get started in the tutorial, I want to give a HEFTY thanks to Adrian Rosebrock, PhD, creator of PyImageSearch. I am a self-taught programmer, so without his resources, much of this project would not be possible. He is the epitome of a mensch- I could not be more appreciative of the resources he puts on his website. If you want to learn advanced deep learning techniques but find textbooks and research papers dull, I highly recommend visiting his website linked above.", "In most projects related to weapon classification, I was only able to find a dataset of 100\u2013200 images maximum. This posed an issue because, from my experience, it is hard to get a working model with so little images. To gather images, I rigged my raspberry pi to scrape IMFDB.com- a website where gun enthusiasts post pictures where a model gun is featured in a frame or clip from a movie. If you visit the website, this will be more clear. To access the images that I used, you can visit my Google Drive. In this zip file, you will find all the images that were used in this project and the corresponding .xml files for the bounding boxes. If you are in need of bounding boxes for a large dataset, I highly recommend ScaleOps.AI, a company that specializes in data labeling for machine learning algorithms. Currently, I have 120,000 images from the IMFDB website, but for this project, I only used ~5000 due to time and money constraints.", "Now, let\u2019s get to the logic. The architecture of this project follows the logic shown on this website. Although we implement the logic here, there are many areas for which it is different so that it can be useful for our specific problem \u2014 detecting weapons. The project uses 6 basic steps:", "Below is a gif showing how the algorithm works. For a given image, each square will be fed into the neural network. If a square is predicted as positive (handgun or rifle), we will mark the area that we fed onto the original image.", "If you want to see the entire code for the project, visit my GitHub Repo where I explain the steps in greater depth.", "The data I linked above contains a lot of folders that I need to explain in order to understand whats going on. After unzipping the folder, these are the files & folders that are important for the project: AR, FinalImages, Labels, Pistol, Stock_AR, and Stock_Pistol, and PATHS.csv. Inside the folders, you will find the corresponding images pertaining to the folder name. So for the AR folder, you will find images of Assault rifles inside. Inside the Labels folder, you will see the .xml labels for all the images inside the class folders. Lastly, the PATHS.csv will point to every single image that will be used in the algorithm. For the purpose of this tutorial these are the only folders/files you need to worry about:", "The way the images within these folders were made is the following.", "After gathering the dataset (which can be found inside Separated/FinalImages), we need to use these files for our algorithm, we need to prepare it in such a way where we have a list of RGB values and the corresponding label (0= No Weapon, 1 = Pistol, 2 = Rifle)", "If you run the code above with the Separated folder outside of the current directory, you will see a tqdm window that shows it is loading the images. After the process is finished, you should see this:", "Now its time for the neural network. In the code below, the function will return a model given a dimension size. If you noticed in the code above, the dimensions for the photos were resized to (150, 150, 3). If you wish to use different dimensions just make sure you change the variable DIM above, as well as the dim in the function below", "The model returned above will have the architecture shown below:", "Once we have our train and test sets, all we need to do is fit it onto our model. Running the code below will start the training process.", "If you run the code without any errors, you should see a window like this:", "I want to note that I have the epochs set to 1000, but the EarlyStopping will prevent the algorithm from overfitting so it should not run for longer than 30\u201350 epochs. After the model is finished, you should see a .h5 file in your directory called ModelWeights.h5. This file is the weights that the model produced, so loading these into a model will load the model before it started to overfit.", "The accuracy was pretty good considering a balanced data set. Looking at the ROC curve, we can also assume pretty good classification given that the area under each class is very close to 1.", "Now time for object detection! The following logic is used to create the bounding boxes:", "Before you run the code above, create a folder Tests, and download any image from the internet and name the image the class for which you want to predict. Running the code above will search through every image inside the Tests folder and run that image through our object detection algorithm using the CNN we build above.", "The images I tested on were the following:", "After running the code above, these are the predictions the algorithm gave as an output.", "As you can see above, Non-maxima suppression is not perfect, but it does work in some sense. The issue I have here is that there are multiple bounding boxes with 100% confidence so it is hard to pick which one is the best. Also, the algorithm is unable to detect non-weapon when there is no weapon in the frame (sheep image).", "Using the logic implemented above, here is a cool visual of where I apply the code to a video.", "Based on the examples above, we see that the algorithm is faaaar from perfect. This is okay because we still created a pretty cool model that only used 5000 images. Like I said earlier, I have a total of 120,000 images that I scraped from IMFDB.com, so this can only get better with more images we pass in during training.", "One of the difficult parts of building and testing a neural network is that the way it works is basically a black box, meaning that you don't understand why the weights are what they are or what within the image the algorithm is using to make its predictions. Using LIME, we can better understand how our algorithm is performing and what within the picture is important for predictions.", "Running the code above will create an image that looks like this:", "The areas that are green are those that the algorithm deems \u201cimportant\u201d, while the opposite is true for the areas that are red. What we are seeing above is good considering we want the algorithm to detect features of the gun and not the hands or other portions of an image.", "Now that we can say we created our very own sentient being\u2026 it is time to get real for a second. The model we made is nothing compared to the tools that are already out there. This leads me to Transfer Learning\u2026. where we see some really cool results. For the sake of this tutorial, I will not post the code here but you can find it on my GitHub Repo", "**NOTE** If you want to follow along with the full project, visit my GitHub **", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Senior Machine Learning Engineer | BA George Washington University | MS Stevens Institute of Technology"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F67b19234e3dd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@HeeebsInc?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Samuel Mohebban"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf4b32fe258&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&user=Samuel+Mohebban&userId=caf4b32fe258&source=post_page-caf4b32fe258----67b19234e3dd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pxfuel.com/en/free-photo-ovfsz", "anchor_text": "Original Photo"}, {"url": "https://www.pyimagesearch.com/", "anchor_text": "PyImageSearch"}, {"url": "http://www.imfdb.org/wiki/Main_Page", "anchor_text": "IMFDB.com"}, {"url": "https://drive.google.com/file/d/1EZZKhCk0DK3S9zB53o3nWhKrZUbmN2Up/view?usp=sharing", "anchor_text": "Google Drive"}, {"url": "https://scaleops.ai/", "anchor_text": "ScaleOps.AI"}, {"url": "https://www.pyimagesearch.com/2020/07/13/r-cnn-object-detection-with-keras-tensorflow-and-deep-learning/", "anchor_text": "this"}, {"url": "https://github.com/HeeebsInc/WeaponDetection", "anchor_text": "GitHub Repo"}, {"url": "https://github.com/HeeebsInc/NN_Weapon_Detection/blob/master/Figures/ModelComparisons/Normal/Normal.png", "anchor_text": "here"}, {"url": "https://www.youtube.com/watch?v=e6tFxT-BpFg&t=1s&ab_channel=SamuelMohebban", "anchor_text": "here"}, {"url": "https://github.com/marcotcr/lime", "anchor_text": "LIME"}, {"url": "https://github.com/HeeebsInc/NN_Weapon_Detection", "anchor_text": "GitHub Repo"}, {"url": "https://github.com/HeeebsInc/NN_Weapon_Detection/blob/master/Figures/ModelComparisons/Mobilenet/Mobilenet.png", "anchor_text": "here"}, {"url": "https://github.com/HeeebsInc/NN_Weapon_Detection/blob/master/Figures/ModelComparisons/VGG16/VGG16.png", "anchor_text": "here"}, {"url": "https://github.com/HeeebsInc/WeaponDetection", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----67b19234e3dd---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----67b19234e3dd---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----67b19234e3dd---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/python?source=post_page-----67b19234e3dd---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----67b19234e3dd---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "http://creativecommons.org/licenses/by/4.0/", "anchor_text": "Some rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&user=Samuel+Mohebban&userId=caf4b32fe258&source=-----67b19234e3dd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&user=Samuel+Mohebban&userId=caf4b32fe258&source=-----67b19234e3dd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F67b19234e3dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----67b19234e3dd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----67b19234e3dd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----67b19234e3dd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----67b19234e3dd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Samuel Mohebban"}, {"url": "https://medium.com/@HeeebsInc/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "63 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf4b32fe258&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&user=Samuel+Mohebban&userId=caf4b32fe258&source=post_page-caf4b32fe258--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe57400756dca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-weapon-detection-system-using-keras-and-opencv-67b19234e3dd&newsletterV3=caf4b32fe258&newsletterV3Id=e57400756dca&user=Samuel+Mohebban&userId=caf4b32fe258&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}