{"url": "https://towardsdatascience.com/using-fcnn-receptive-fields-for-object-detection-8101d7acecff", "time": 1683012306.456237, "path": "towardsdatascience.com/using-fcnn-receptive-fields-for-object-detection-8101d7acecff/", "webpage": {"metadata": {"title": "Using FCNN Receptive Fields for Object Detection | by Debal B | Towards Data Science", "h1": "Using FCNN Receptive Fields for Object Detection", "description": "The task of Object Detection is to detect and spatially identify (using bounding boxes etc.) various objects in an image, whereas Image Classification tells whether or not an image contains certain\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.learnopencv.com/fully-convolutional-image-classification-on-arbitrary-sized-image/", "anchor_text": "Fully Convolutional Image Classification on Arbitrary Sized Image", "paragraph_index": 5}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "CNN Receptive Field Computation Using Backprop", "paragraph_index": 6}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "this blog", "paragraph_index": 18}, {"url": "https://github.com/DebalB/Python_public/tree/master/fcnn_object_detector_pytorch", "anchor_text": "from here", "paragraph_index": 26}, {"url": "https://github.com/jrosebr1/imutils", "anchor_text": "imutils", "paragraph_index": 29}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "this blog", "paragraph_index": 33}, {"url": "https://github.com/DebalB/Python_public/tree/master/fcnn_object_detector_pytorch", "anchor_text": "from here", "paragraph_index": 48}], "all_paragraphs": ["The task of Object Detection is to detect and spatially identify (using bounding boxes etc.) various objects in an image, whereas Image Classification tells whether or not an image contains certain objects without any notion of where exactly they are located.", "In this post, I describe an approach to creating an Object Detection model from a pretrained Image Classification model in PyTorch.", "Even though the Object Detection and Image Classification are two distinct categories of Computer Vision and their methods of training are fundamentally different, we will see in this post that there is some overlap in their functionality which we can exploit for our purpose.", "The idea and the implementation presented in this post are built using concepts of CNN Receptive Fields, Backpropagation and Fully Convolutional Networks.", "In case you are unsure about some of the above terms, I recommend you to go through the following blogs on LearnOpenCV.com which introduce these concepts very well.", "\u00b7 Fully Convolutional Image Classification on Arbitrary Sized Image", "\u00b7 CNN Receptive Field Computation Using Backprop", "In fact, even if you are already quite familiar with these terms, I would still urge you to go through the above posts since the implementation that I am presenting extends upon the above references and for the sake of brevity, I have not captured details where a better explanation is already available.", "Although you may find that the results using this approach do not quite match the performance of popular object detectors like YOLO, nevertheless, the purpose of this exercise is to describe an approach where a pretrained Image Classifier can be used to create an Object Detector without any explicit training on annotated bounding boxes.", "Having set the expectations, let\u2019s get started.", "For this exercise, I have used a slightly modified version of the pretrained Resnet-18 model provided in PyTorch.", "Specifically, the model used is a variant of Resnet-18, in which the final (and only) Fully Connected (or Linear) layer of the model is replaced by a 2D Convolution layer, thus converting the model into a Fully Convolutional Neural Network (FCNN).", "The Fully Convolutional Resnet18 model architecture looks like this:", "As a quick recap of the concepts presented in the blogs mentioned previously, an FCNN takes an image of arbitrary size as input and gives as output an activation/response map containing the model\u2019s prediction of objects detected in the image.", "Using the Backpropagation algorithm, we compute the Receptive Field of this response map and find out the location of the detected objects in the original image.", "As you may know by now, Receptive Field of a pixel in a feature map (or layer) in a Neural Network represents all the pixels from the previous feature maps that affected its value. It is a useful debugging tool to understand what the network really saw in the input image when it gave a certain prediction.", "The following figure illustrates this concept", "Whereas in the previous posts, we focused only on the result category with maximum score/probability (we just wanted an Image Classifier after all), this time we are going deeper to extract all of the model\u2019s predictions and compute each of the respective receptive fields which would give us our bounding boxes.", "Our procedure starts after we have obtained the response map predicted by the FCNN Resnet-18 model on the input image using the steps captured in this blog which I referenced at the beginning of this post. I am not repeating the steps in this post as that would be duplicate effort and needlessly make this post a lot lengthier.", "As you will recall, the response map from the FCNN is of shape [1 x 1000 x n x m] where n and m depend on the width and height of the input image and the network itself. The 1000 corresponds to the 1000 classes of ImageNet database on which the Resnet18 is trained.", "Using a max operation on this response map, we get the top [n x m] predictions or score map from the model which can be interpreted as the inference performed on [n x m] locations on the image obtained by sliding window of size 224\u00d7224 (input image size for the original network).", "For each of these predictions in the score map, we have the probabilities (given by Softmax layer) and the category (from ImageNet).", "Following is an example score map of shape [3 x 8] with the top prediction highlighted:", "We will now go through each of these [n x m] predictions and, if its probability is above a predefined threshold, calculate its receptive field using backpropagation.", "On each of these receptive fields, we will then apply OpenCV Image Threshold and Contour operations to obtain the bounding boxes.", "The entire pipeline is summarized as illustrated below:", "Following is a snippet of the implementation. Download the full code from here.", "Following is a sample of the results that we achieve:", "An important thing to note is that the network might detect the same object multiple times (with varying probabilities). This leads to the problem of overlapped bounding boxes which is typical even in standard object detection algorithms.", "In order to fix this problem, we use Non-Maxima Suppression method. I have used the function object_detection.non_max_suppression() provided by the imutils package. However, any other method may be used which achieves the same purpose.", "Now here is an interesting design choice that I would like to talk about.", "For any detected object category, its corresponding receptive field can be computed using either of the following:", "Needless to say, the resulting bounding boxes will vary a lot depending on the choice that we make above.", "Again, the corresponding details are well explained this blog.", "However, I will summarize them briefly and give a comparison of the two methods with respect to the results that they produce.", "Option-1: Receptive Field computed for the Max Activated pixel of a category, looks at only one pixel in the response map and provides the bounding box of the region in the original image which maximized that pixel.", "On some images (e.g. low-resolution images), this option nicely segregates each individual instance of a category, as illustrated below:", "However, in certain images (e.g. high-resolution images), this may return a bounding box that encloses only a part of the object rather than the object in entirety, e.g. see the image below:", "Option-2: Receptive Field computed for the Net Prediction, takes into account each of the [n x m] pixels in the corresponding response map of a category and provides the bounding box of the region in the original image which maximized the net prediction of that category.", "As before, the results of this approach vary with the image being used.", "For some images it returns bounding box neatly enclosing the entire object as illustrated below:", "On some images, however, the obtained bounding box may enclose together several instances of a category as shown below:", "As you can see, there is no clear verdict as to which of the two options yields a better result.", "I recommend readers to experiment further using their own image datasets, and get a broader idea as to what does and does not work for them.", "As I initially mentioned, the objective of this post was not to present a robust method for object detection, but rather to explore how a specific model can be used to serve an alternate purpose.", "It is not uncommon in machine learning that creators of a model discover that their creation performs well even at tasks it was never trained to do.", "With that thought, I would like to end this blog.", "I hope that you have enjoyed it and I would be delighted to hear any further ideas and findings that you may come across.", "Download the full code from here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Passionate about Computer Vision and Machine Learning"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8101d7acecff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8101d7acecff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@debalb?source=post_page-----8101d7acecff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debalb?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Debal B"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff73afc239981&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&user=Debal+B&userId=f73afc239981&source=post_page-f73afc239981----8101d7acecff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.learnopencv.com/fully-convolutional-image-classification-on-arbitrary-sized-image/", "anchor_text": "Fully Convolutional Image Classification on Arbitrary Sized Image"}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "CNN Receptive Field Computation Using Backprop"}, {"url": "https://lutzroeder.github.io/netron/", "anchor_text": "Netron"}, {"url": "https://www.researchgate.net/profile/Shihong_Du", "anchor_text": "Shihong Du"}, {"url": "https://www.researchgate.net/figure/Conventional-CNN-framework-interspersed-with-convolutional-layers-and-max-pooling-layers_fig3_300081672", "anchor_text": "this paper"}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "this blog"}, {"url": "https://github.com/DebalB/Python_public/tree/master/fcnn_object_detector_pytorch", "anchor_text": "from here"}, {"url": "https://unsplash.com/@sidekix?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Sidekix Media"}, {"url": "https://unsplash.com/s/photos/kitchen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/jrosebr1/imutils", "anchor_text": "imutils"}, {"url": "https://www.learnopencv.com/cnn-receptive-field-computation-using-backprop/", "anchor_text": "this blog"}, {"url": "https://unsplash.com/@dallimonti?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Andr\u00e9s Dallimonti"}, {"url": "https://unsplash.com/s/photos/pyramids-and-camel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@dallimonti?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Andr\u00e9s Dallimonti"}, {"url": "https://unsplash.com/s/photos/pyramids-and-camel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/DebalB/Python_public/tree/master/fcnn_object_detector_pytorch", "anchor_text": "from here"}, {"url": "https://medium.com/tag/opencv-python?source=post_page-----8101d7acecff---------------opencv_python-----------------", "anchor_text": "Opencv Python"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----8101d7acecff---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----8101d7acecff---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8101d7acecff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&user=Debal+B&userId=f73afc239981&source=-----8101d7acecff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&user=Debal+B&userId=f73afc239981&source=-----8101d7acecff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8101d7acecff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8101d7acecff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8101d7acecff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8101d7acecff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8101d7acecff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8101d7acecff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8101d7acecff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debalb?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debalb?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Debal B"}, {"url": "https://medium.com/@debalb/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "45 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff73afc239981&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&user=Debal+B&userId=f73afc239981&source=post_page-f73afc239981--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6cdec652f3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fcnn-receptive-fields-for-object-detection-8101d7acecff&newsletterV3=f73afc239981&newsletterV3Id=6cdec652f3e&user=Debal+B&userId=f73afc239981&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}