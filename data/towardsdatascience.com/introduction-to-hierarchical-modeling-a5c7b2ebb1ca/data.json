{"url": "https://towardsdatascience.com/introduction-to-hierarchical-modeling-a5c7b2ebb1ca", "time": 1683011882.475168, "path": "towardsdatascience.com/introduction-to-hierarchical-modeling-a5c7b2ebb1ca/", "webpage": {"metadata": {"title": "Introduction to hierarchical modeling | by Surya Krishnamurthy | Towards Data Science", "h1": "Introduction to hierarchical modeling", "description": "It is not uncommon to find samples in our datasets that are not completely independent. Samples in datasets often form clusters or groups within which some properties are shared. This often requires\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/SuryaThiru/hierarchical-model-blog", "anchor_text": "GitHub", "paragraph_index": 3}, {"url": "https://stats.idre.ucla.edu/stat/examples/imm/imm10.dta", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://github.com/SuryaThiru/hierarchical-model-blog/blob/master/mlmldata.csv", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://www.linkedin.com/in/surya-krishnamurthy/", "anchor_text": "Linkedin", "paragraph_index": 20}, {"url": "https://github.com/SuryaThiru", "anchor_text": "GitHub", "paragraph_index": 20}], "all_paragraphs": ["It is not uncommon to find samples in our datasets that are not completely independent. Samples in datasets often form clusters or groups within which some properties are shared. This often requires some special attention while modeling to build reliable models for two major reasons. First, the independence of samples is an important assumption for several statistical analysis procedures like maximum likelihood estimation. Second, we want to capture the variation of the influence of the predictors across groups in our model called contextual effect.", "A commonly used example, that I find sufficient to understand the scenario is that of the performance of students in a school. In a school with students in multiple classes, the academic performance of a student is influenced by their individual capabilities (called fixed effects) and the class they\u2019re a part of (called random effects). Maybe the teacher assigned to a particular class teaches better than the others, or a higher proportion of intelligent students in a class creates a competitive environment for the students to perform better.", "One approach to handle the case is to build multiple models for each class, referred to as pooling. But such an approach might not always produce reliable results. For example, the model corresponding to a class with very few students will be very misleading. A single unpooled model might not be able to fit sufficiently on the data. We want to find a middle ground that finds a compromise between these extremes \u2014 partial pooling. This brings us to Bayesian hierarchical modeling, also known as multilevel modeling.", "In this method, parameters are nested within one another at different levels of groups. Roughly, it gives us the weighted average of the unpooled and pooled model estimates. Hierarchical modeling is one of the most powerful, yet simple, techniques in Bayesian inference and possibly in statistical modeling. In this post, I will introduce the idea with a practical example. Note that this post does not cover the fundamentals of Bayesian analysis. The source code for the example is available as a notebook in GitHub.", "The dataset used for illustration is similar to the students example above except we\u2019re trying to find the math scores of students from different schools. We use the homework completion as a predictor for our example. You can find the original data here and it\u2019s csv version here.", "Plotting the math scores of the students against homework along with the unpooled OLS regression fit gives us this:", "Visualizing the data at the school level reveals some interesting patterns. We also plot the pooled regression lines fit on each school and the unpooled regression fit for reference. For simplicity, we use OLS regression.", "The plot shows the variation of the relationship across groups. We also notice that the estimates are highly influenced by the few data points (possible outliers) with high homework completions in some of the groups.", "We will construct our Bayesian hierarchical model using PyMC3. We will construct hyperpriors on our group-level parameters to allow the model to share the individual properties of the student among the groups.", "For this model, we will use a random slope \u03b2 and intercept \u03b1. This means that they will vary with each group instead of a constant slope and intercept for the entire data. The graphical representation of the probabilistic model is shown below.", "While I choose my priors here by eyeballing the general distribution of the samples, using uninformative priors will lead to similar results. The code snippet below defines the PyMC3 model used.", "We will use the NUTS sampler for drawing samples from the posterior distribution.", "The trace plot and the posterior distribution of the slope and intercept corresponding to each school is visualized below.", "We can see the variation in the estimates of our coefficients across different schools. We can also clearly interpret the uncertainty associated with our estimates from the distributions. The posterior predictive regression (gray) lines below, sampled from the posterior distribution of the estimates of each group, gives a better picture of the model with respect to the data.", "Note the general higher uncertainty around groups that show a negative slope. The model finds a compromise between sensitivity to noise at the group level and the global estimates at the student level (apparent in IDs 7472, 7930, 25456, 25642). This implies that we must be a little warier of the decisions derived from the model on these groups. We also observe that with more data and lesser deviation, the Bayesian model converges to the OLS model of the group (ID 62821) as expected. We can also check the student level relationship by plotting the regression lines from mu_a and mu_b (which I omit here).", "Cross-validation with the different models will show the superiority of the hierarchical modeling approach. Cross-validation can be performed at 2 levels:", "I do not perform validation here as the frequentist and Bayesian models used here don\u2019t make for a fair (or easy) comparison. But the CV can be performed by replacing the OLS regression with Bayesian linear regression and comparing their Root Mean Squared Deviation (RMSD) of the models.", "Bayesian hierarchical modeling can produce robust models with naturally clustered data. They often allow us to build simple and interpretable models as opposed to the frequentist techniques like ensembling or neural networks that are commonly used for such complex data. They also prevent overfitting despite the increase in the number of parameters in the model. The post is merely an introduction to hierarchical modeling and its inherent simplicity allows us to implement different variations of the model specific to our data (eg: adding sub-groups, using more group-level predictors) and conduct different types of analysis (eg: find correlation among levels).", "A. Gelman et al, Bayesian Data Analysis (2013), Chapter 5, CRC press", "Thank you for reading! I would appreciate any feedback on the post.", "You can connect with me on Linkedin and follow me on GitHub.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa5c7b2ebb1ca&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@surya.thiru001?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@surya.thiru001?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Surya Krishnamurthy"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5b0fb3debbbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&user=Surya+Krishnamurthy&userId=5b0fb3debbbe&source=post_page-5b0fb3debbbe----a5c7b2ebb1ca---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/SuryaThiru/hierarchical-model-blog", "anchor_text": "GitHub"}, {"url": "https://stats.idre.ucla.edu/stat/examples/imm/imm10.dta", "anchor_text": "here"}, {"url": "https://github.com/SuryaThiru/hierarchical-model-blog/blob/master/mlmldata.csv", "anchor_text": "here"}, {"url": "https://docs.pymc.io/notebooks/GLM-hierarchical.html", "anchor_text": "GLM: Hierarchical Linear Regression - PyMC3 3.8 documentationThis tutorial is adapted from a blog post by Danne Elbers and Thomas Wiecki called \"The Best Of Both Worlds\u2026docs.pymc.io"}, {"url": "https://docs.pymc.io/notebooks/GLM.html", "anchor_text": "(Generalized) Linear and Hierarchical Linear Models in PyMC3 - PyMC3 3.8 documentationLets generate some data with known slope and intercept and fit a simple linear GLM. The glm.linear_component() function\u2026docs.pymc.io"}, {"url": "https://mc-stan.org/docs/2_24/stan-users-guide/hierarchical-logistic-regression.html", "anchor_text": "1.9 Hierarchical Logistic Regression | Stan User's GuideThe simplest multilevel model is a hierarchical model in which the data are grouped into \\(L\\) distinct categories (or\u2026mc-stan.org"}, {"url": "https://www.linkedin.com/in/surya-krishnamurthy/", "anchor_text": "Linkedin"}, {"url": "https://github.com/SuryaThiru", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/bayesian-machine-learning?source=post_page-----a5c7b2ebb1ca---------------bayesian_machine_learning-----------------", "anchor_text": "Bayesian Machine Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a5c7b2ebb1ca---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a5c7b2ebb1ca---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/multilevel-modeling?source=post_page-----a5c7b2ebb1ca---------------multilevel_modeling-----------------", "anchor_text": "Multilevel Modeling"}, {"url": "https://medium.com/tag/hierarchical-modeling?source=post_page-----a5c7b2ebb1ca---------------hierarchical_modeling-----------------", "anchor_text": "Hierarchical Modeling"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&user=Surya+Krishnamurthy&userId=5b0fb3debbbe&source=-----a5c7b2ebb1ca---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&user=Surya+Krishnamurthy&userId=5b0fb3debbbe&source=-----a5c7b2ebb1ca---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa5c7b2ebb1ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a5c7b2ebb1ca---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a5c7b2ebb1ca--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@surya.thiru001?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@surya.thiru001?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Surya Krishnamurthy"}, {"url": "https://medium.com/@surya.thiru001/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "38 Followers"}, {"url": "https://www.linkedin.com/in/surya-krishnamurthy/", "anchor_text": "https://www.linkedin.com/in/surya-krishnamurthy/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5b0fb3debbbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&user=Surya+Krishnamurthy&userId=5b0fb3debbbe&source=post_page-5b0fb3debbbe--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F5b0fb3debbbe%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-hierarchical-modeling-a5c7b2ebb1ca&user=Surya+Krishnamurthy&userId=5b0fb3debbbe&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}