{"url": "https://towardsdatascience.com/advanced-streamlit-caching-6f528a0f9993", "time": 1683005229.336904, "path": "towardsdatascience.com/advanced-streamlit-caching-6f528a0f9993/", "webpage": {"metadata": {"title": "Advanced Streamlit Caching. Caching = Better User Experience | by Rahul Agarwal | Towards Data Science", "h1": "Advanced Streamlit Caching", "description": "It is straightforward now how to create a web app using Streamlit, but there are a lot of things that it doesn\u2019t allow you to do yet. One of the major issues I faced recently was around caching when\u2026"}, "outgoing_paragraph_urls": [{"url": "https://discuss.streamlit.io/t/version-0-57-0/2301", "anchor_text": "0.57.0", "paragraph_index": 6}, {"url": "https://docs.streamlit.io/api.html?highlight=cache#streamlit.cache", "anchor_text": "documentation", "paragraph_index": 6}, {"url": "https://docs.streamlit.io/api.html#streamlit.cache", "anchor_text": "@st.cache", "paragraph_index": 14}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/caching_stream", "anchor_text": "here", "paragraph_index": 29}, {"url": "https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "Data Visualization and applied plotting", "paragraph_index": 30}, {"url": "https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "Data Science Specialization with Python", "paragraph_index": 30}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium", "paragraph_index": 31}, {"url": "http://eepurl.com/dbQnuX", "anchor_text": "blog", "paragraph_index": 31}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz", "paragraph_index": 31}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 34}], "all_paragraphs": ["It is straightforward now how to create a web app using Streamlit, but there are a lot of things that it doesn\u2019t allow you to do yet. One of the major issues I faced recently was around caching when I was trying to use a News API to create an analytical news dashboard in Streamlit.", "The problem was that I was hitting the News API regularly and was reaching the free API limits. Also, running the news API every time the user refreshed the app was getting pretty slow.", "A solution to that would have been caching the API data. But when I used @st.cache decorator, the page never refreshed as the parameters to the API call remained the same.", "And that is where I came to understand the limitations of Streamlit when it comes to caching.", "So, in a nutshell, What I wanted was a way not to hit the API every time the page refreshes. At the same time, since I was getting the News data, I also wanted to hit the API at every 5-minute interval.", "And, here is the hacky way I accomplished that.", "In the new release notes for 0.57.0 which just came out yesterday, streamlit has made updates to st.cache. One notable change to this release is the \u201cability to set expiration options for cached functions by setting the max_entries and ttl arguments\u201d. From the documentation:", "Two use cases where this might help would be:", "So now what you need to do is just:", "It is really unbelievable how fast things change.", "Before I begin, Here is a tutorial for streamlit if you are not able to follow this post.", "When we mark a function with Streamlit\u2019s cache decorator @st.cache, whenever the function is called streamlit checks the input parameters that you called the function with. What happens in the backend is when a function is decorated with @st.cache streamlit keeps all the states of a function in the memory.", "For example, if we have a simple streamlit app like below:", "When we refresh the app, we will notice that expensive_computation(a, b) is re-executed every time the app runs. This isn\u2019t a great experience for the user.", "Now if we add the @st.cache decorator:", "Since the results are now cached for the parameters a and b the expensive_computation doesn\u2019t run again every time the user refreshes the page. And that results in a far better user experience.", "So what if I wanted to execute a function if the page refreshes after a set time period? i.e., it has been some time since the cached function was last run, and the results need to be updated.", "To understand this, let us create a basic example. In this example, our function takes a parameter n and a parameter country and returns the top n news item from that country.", "In this minimal example, it is akin to returning a list of n random numbers. We want to keep showing this list to our users till the next 5 minutes. If the user refreshes the page after 5 minutes, we want the list to be refreshed. This is quite similar to hitting a news API.", "So our basic app code looks like:", "Now every time, I refresh the page, the function hit_news_api gets called again, and that means we will hit our API limits as our number of users increase. So how do we solve this problem?", "We can use caching. Right. So let us see what happens if we cache the hit_news_api function.", "The problem now is that our dashboard never calls the news API after hitting it once if the API parameters remain the same. And we see static results for an eternity for the same set of params. What should we do?", "We can use this hack \u2014 Pass a time-dependent dummy parameter to the hit_news_api function call that changes value every five minutes/ten minutes. The code to do this is:", "This is all well and good, but can you spot a problem with this approach? The cache size is going to grow over time. And that means we need to clear the cache at fixed intervals manually. How do we automate the cache clearing process?", "It is a pretty simple hack. We can use this below code at the top of our code to clear the whole cache at a period of 1 day.", "This is how the whole app looks with all the above functions.", "Streamlit has democratized the whole process to create apps, and I couldn\u2019t recommend it more.", "Yet, there are some things for which we need to go about in a roundabout way. And there are still a lot of things that I will love to have in this awesome platform. I have been in talks with the Streamlit team over the new functionality that they are going to introduce, and I will try to keep you updated on the same.", "You can find the full code for the final app here at my Github repo.", "If you want to learn about the best strategies for creating Visualizations, I would like to call out an excellent course about Data Visualization and applied plotting from the University of Michigan, which is a part of a pretty good Data Science Specialization with Python in itself. Do check it out.", "Thanks for the read. I am going to be writing more beginner-friendly posts in the future too. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Also, a small disclaimer \u2014 There might be some affiliate links in this post to relevant resources, as sharing knowledge is never a bad idea.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6f528a0f9993&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----6f528a0f9993---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/sasint-3639875/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1822459", "anchor_text": "Sasin Tipchai"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1822459", "anchor_text": "Pixabay"}, {"url": "https://discuss.streamlit.io/t/version-0-57-0/2301", "anchor_text": "0.57.0"}, {"url": "https://docs.streamlit.io/api.html?highlight=cache#streamlit.cache", "anchor_text": "documentation"}, {"url": "http://twitter.com/st", "anchor_text": "@st"}, {"url": "https://towardsdatascience.com/how-to-write-web-apps-using-simple-python-for-data-scientists-a227a1a01582", "anchor_text": "How to write Web apps using simple Python for Data Scientists?Convert your Data Science Projects into cool apps easily without knowing any web frameworkstowardsdatascience.com"}, {"url": "https://docs.streamlit.io/api.html#streamlit.cache", "anchor_text": "@st.cache"}, {"url": "https://unsplash.com/@romankraft?utm_source=medium&utm_medium=referral", "anchor_text": "Roman Kraft"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://twitter.com/st", "anchor_text": "@st"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/caching_stream", "anchor_text": "here"}, {"url": "https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "Data Visualization and applied plotting"}, {"url": "https://www.coursera.org/specializations/data-science-python?ranMID=40328&ranEAID=lVarvwc5BD0&ranSiteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&siteID=lVarvwc5BD0-SAQTYQNKSERwaOgd07RrHg&utm_content=3&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "Data Science Specialization with Python"}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium"}, {"url": "http://eepurl.com/dbQnuX", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/programming?source=post_page-----6f528a0f9993---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6f528a0f9993---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6f528a0f9993---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----6f528a0f9993---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/python?source=post_page-----6f528a0f9993---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----6f528a0f9993---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----6f528a0f9993---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6f528a0f9993&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6f528a0f9993---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6f528a0f9993--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6f528a0f9993--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6f528a0f9993--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-streamlit-caching-6f528a0f9993&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}