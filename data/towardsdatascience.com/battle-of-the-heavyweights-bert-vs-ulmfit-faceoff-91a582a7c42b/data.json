{"url": "https://towardsdatascience.com/battle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b", "time": 1682997526.733438, "path": "towardsdatascience.com/battle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b/", "webpage": {"metadata": {"title": "BERT vs ULMFiT Faceoff. A simple web-app for real-time\u2026 | by Nikhil Utane | Towards Data Science", "h1": "BERT vs ULMFiT Faceoff", "description": "This post is in continuation to the earlier one on where I spoke about running Hugging Face\u2019s pytorch-transformers library on custom datasets. When pytorch-transfomers was released, I wanted to try\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/dsnet/running-pytorch-transformers-on-custom-datasets-717fd9e10fe2", "anchor_text": "earlier", "paragraph_index": 0}, {"url": "https://github.com/huggingface/pytorch-transformers", "anchor_text": "pytorch-transfomers", "paragraph_index": 1}, {"url": "https://github.com/nikhilno1/nlp_projects/tree/master/deployment/imdb-google-app-engine", "anchor_text": "repo", "paragraph_index": 3}, {"url": "https://medium.com/dsnet/running-pytorch-transformers-on-custom-datasets-717fd9e10fe2", "anchor_text": "post", "paragraph_index": 6}, {"url": "https://flask.palletsprojects.com/en/1.1.x/", "anchor_text": "FLASK", "paragraph_index": 12}, {"url": "https://docs.pylonsproject.org/projects/waitress/en/stable/", "anchor_text": "waitress", "paragraph_index": 15}, {"url": "https://www.sqlalchemy.org/", "anchor_text": "SQLAlchemy", "paragraph_index": 18}, {"url": "https://cloud.google.com/sql/docs/mysql/", "anchor_text": "Cloud SQL", "paragraph_index": 18}, {"url": "https://cloud.google.com/sql/docs/mysql/", "anchor_text": "official", "paragraph_index": 18}], "all_paragraphs": ["This post is in continuation to the earlier one on where I spoke about running Hugging Face\u2019s pytorch-transformers library on custom datasets.", "When pytorch-transfomers was released, I wanted to try it out to see how well it performs and how convenient it is to use. So I got rolling and built a BERT (base) model fine-tuned on IMDB movie reviews dataset. I wrapped it around a web app for anyone to play with it. Then I figured it would be interesting to compare it with some other model so I included ULMFiT in my app. ULMFiT was chosen since I have been a FastAI student for a long time and had a fine-tuned model with me. Finally I decided to make it real-time by getting predictions on every word which provides a cool way to see how the models work internally.", "This is how the current version looks:", "All the code is present in the repo here. [Note: The README will be updated with more details soon along with cleanup/minor restructuring of the code]", "Here\u2019s a quick look at the directory structure.", "While pytorch-transformers make it easy to run pretrained models and even fine-tune them, I found it difficult to run inferencing on it. Hence I copied the relevant functions and modified them to suit my needs.", "All the details for fine-tuning BERT on IMDB movie review dataset can be found in my earlier post.", "On the other hand, running inferencing on ULMFiT is pretty straight-forward as can be seen in the code.", "Inferencing is exposed via the \u2018/analyze\u2019 API endpoint in the backend which then invokes the relevant functions to get the predictions and return it in the response.", "The frontend is developed using HTML, CSS & Javascript. It uses additional jQuery packages to incorporate the gauge, loading button and thumb up/down functionality. To provide real-time interaction, prediction is triggered automatically after every word (with a slight delay to prevent unwanted triggers when typing a sentence) using an AJAX call to update only the gauge without reloading the entire page.", "The UI also has an option to vote on the performance of the models for any review. This information is getting saved in a SQL database so that we can later analyze which model works better on which reviews.", "My UI skills are fairly limited so the code is definitely not the most elegant one but it gets the job done.", "The backend uses the FLASK WSGI web application framework. It exposes 3 API endpoints:", "\u2018/model-feedback\u2019: For submitting the feedback on the performance of the models.", "The backend can be invoked to run in debug or production mode. This is controlled by a \u2018.debug\u2019 file in the main apps folder. (i.e. to run in debug mode create a .debug file inside the apps folder).", "waitress is used to serve the production version. Note that the production version needs to run on port 8080 as dictated by Google App Engine.", "The backend uses aiohttp & asyncio modules to download the model files asynchronously.", "We are also saving the client IP address to distinguish how many distinct IP addresses accessed the app. Since in GAE, the application is sitting behind an nginx proxy, we have to use request.access_route[0] retrieve the same.", "The backend uses SQLAlchemy to interact with Google\u2019s Cloud SQL instance to save the model performance data in a MySQL database. The cloud SQL instance has to be provisioned separately. The Google App Engine instance has direct access to the cloud SQL instance (via the Cloud SQL Connection Name field). Refer the official documentation for provisioning of the instance.", "Since I have free credits from Google, I decided to host the app on it\u2019s infrastructure. At first i thought of deploying a VM instance but then I came across GAE which sounded just perfect.", "Let\u2019s look at the app.yaml file that controls how the app is hosted on GAE", "If you are deploying a docker container then one needs to use the flexible environment (as opposed to standard). Since I started with docker I have deployed the same but I would like to move to standard environment since there instances can scale down to 0 if there is no usage.", "I increased the configuration of the default instance and chose a 2-CPU instance with 4 GB of memory and 20 GB of disk size. I had to increase the disk size after the \u2018google cloud deploy\u2019 command would fail and logs threw up \u201cno space left on device\u201d errors.", "I increased the app starting timeout from default 300 secs to 900 secs after I received \u201cgoogle cloud deploy\u201d command failures.", "These settings are need to pass the database credentials to the backend python script. Ideally we should be using the \u201cCloud Key Management\u201d solution (or equivalent)", "This setting is needed to provide connectivity between the GAE and the cloud SQL instances.", "In this section, we\u2019ll look at some of the interesting observations that I found:", "In general, it appears that ULMFiT struggles with short sentences (3\u20134 words).", "Adding a \u2018.\u2019 at the end changes the confidence %.", "Just adding an extra word \u2018It\u2019 changed the prediction for ULMFiT.", "I suppose this can go either way.", "BERT is doing a better job here since I\u2019d think \u2018above average\u2019 is positive.", "Both got it right in this case but we know ULMFiT is biased towards negative for shorter sentences.", "Nice to see the confidence getting stronger here.", "Good to see BERT able to get this one right. But we know ULMFiT things \u2018above average\u2019 is negative.", "But it gets even this as negative. Perhaps due to smaller sentence.", "But what\u2019s this? BERT toggled its prediction just by removing the word \u2018was\u2019. What\u2019s happening?", "Now this one you\u2019d think is negative which BERT gets it wrong and ULMFiT gets it right.", "But if you remove the word \u2018Dark\u2019, BERT changes its prediction. Again, not sure how that works.", "Finally, I tested against 50+ real reviews on IMDB and I can say both the models pretty much agreed with each other except this one time where ULMFiT seems to made a better judgment call.", "While above examples do suggest BERT is better at understanding the semantics of the language, however in real-world cases, where there are multiple sentences, there isn\u2019t much to choose between the two.", "If more users can try this app and provide their feedback for the cases where one model works better than the other, perhaps then we can pick a winner.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F91a582a7c42b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nikhil.utane?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Nikhil Utane"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd1e2f333b7b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&user=Nikhil+Utane&userId=d1e2f333b7b7&source=post_page-d1e2f333b7b7----91a582a7c42b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://deployment-247905.appspot.com/", "anchor_text": "simple web-app"}, {"url": "https://unsplash.com/@1walter2?utm_source=medium&utm_medium=referral", "anchor_text": "Johann Walter Bantz"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/dsnet/running-pytorch-transformers-on-custom-datasets-717fd9e10fe2", "anchor_text": "earlier"}, {"url": "https://deployment-247905.appspot.com/", "anchor_text": "Production deployment"}, {"url": "https://github.com/huggingface/pytorch-transformers", "anchor_text": "pytorch-transfomers"}, {"url": "https://deployment-247905.appspot.com/", "anchor_text": "https://deployment-247905.appspot.com/"}, {"url": "https://github.com/nikhilno1/nlp_projects/tree/master/deployment/imdb-google-app-engine", "anchor_text": "repo"}, {"url": "https://medium.com/dsnet/running-pytorch-transformers-on-custom-datasets-717fd9e10fe2", "anchor_text": "post"}, {"url": "https://flask.palletsprojects.com/en/1.1.x/", "anchor_text": "FLASK"}, {"url": "https://docs.pylonsproject.org/projects/waitress/en/stable/", "anchor_text": "waitress"}, {"url": "https://www.sqlalchemy.org/", "anchor_text": "SQLAlchemy"}, {"url": "https://cloud.google.com/sql/docs/mysql/", "anchor_text": "Cloud SQL"}, {"url": "https://cloud.google.com/sql/docs/mysql/", "anchor_text": "official"}, {"url": "https://deployment-247905.appspot.com/", "anchor_text": "https://deployment-247905.appspot.com/"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----91a582a7c42b---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/bert?source=post_page-----91a582a7c42b---------------bert-----------------", "anchor_text": "Bert"}, {"url": "https://medium.com/tag/fastai?source=post_page-----91a582a7c42b---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&user=Nikhil+Utane&userId=d1e2f333b7b7&source=-----91a582a7c42b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&user=Nikhil+Utane&userId=d1e2f333b7b7&source=-----91a582a7c42b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F91a582a7c42b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----91a582a7c42b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----91a582a7c42b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----91a582a7c42b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----91a582a7c42b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nikhil Utane"}, {"url": "https://medium.com/@nikhil.utane/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "58 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd1e2f333b7b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&user=Nikhil+Utane&userId=d1e2f333b7b7&source=post_page-d1e2f333b7b7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fd1e2f333b7b7%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbattle-of-the-heavyweights-bert-vs-ulmfit-faceoff-91a582a7c42b&user=Nikhil+Utane&userId=d1e2f333b7b7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}