{"url": "https://towardsdatascience.com/everything-about-fasterrcnn-6d758f5a6d79", "time": 1683010356.357314, "path": "towardsdatascience.com/everything-about-fasterrcnn-6d758f5a6d79/", "webpage": {"metadata": {"title": "Everything about Fasterrcnn in PyTorch | by Dipam Vasani | Towards Data Science", "h1": "Everything about Fasterrcnn in PyTorch", "description": "Object detection is a task in computer vision where instead of classifying an image, we try to classify the objects present in the image. It has various applications like detecting empty parking\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1612.03144", "anchor_text": "Feature Pyramid Network", "paragraph_index": 4}, {"url": "https://www.linkedin.com/posts/dvasani_python-oneabrssabrpython-activity-6673000959301455872-R0Ny", "anchor_text": "This error is really common and can be solved using", "paragraph_index": 11}, {"url": "https://www.linkedin.com/posts/dvasani_python-oneabrssabrpython-activity-6673000959301455872-R0Ny", "anchor_text": "ast.literal_eval().", "paragraph_index": 11}, {"url": "https://www.kaggle.com/dipam7/wheat-head-classification", "anchor_text": "If you want to extract the feature map as well, you can do so using hooks. Check out the kernel for the same.", "paragraph_index": 27}], "all_paragraphs": ["Object detection is a task in computer vision where instead of classifying an image, we try to classify the objects present in the image. It has various applications like detecting empty parking space, tracking objects in CCTV footage, and monitoring crops, which is the one we\u2019ll be looking at.", "There are many ways to perform object detection; Fasterrcnn is just one of them. Many of the other techniques, like YOLO and SSD, work equally well. The reason you should learn about Fasterrcnn is that it has given state-of-the-art results in many competitions and is used in real applications like the Pinterest app.", "This article gives a brief overview of Fasterrcnn, the concepts related to it and its implemetation in PyTorch.", "The architecture of Fasterrcnn looks as follows:", "The network starts by extracting features from an image. This part of the architecture is called the backbone of the network. Any standard image classification architecture can be used. We will be using ResNet50 with Feature Pyramid Network as our backbone.", "In the second step, the Region Proposal Network is used to generate regions that potentially contain an object. This network is a real boost over past approaches like sliding a window over the full image to find potential regions, which, as you can imagine, is a really slow and computationally expensive process.", "Another improvement over past approaches in this network is the use of anchor boxes to detect images at various scales and aspect ratios.", "Finally, as you can see from the architecture, the same feature map is used for detecting regions and classification. This idea of reusing feature maps is super smart, and you will see lots of architectures doing this. Take the feature map and attach multiple heads to it for multiple tasks.", "Let\u2019s now implement a Fasterrcnn in PyTorch and understand some more terms along the way.", "Kaggle recently hosted a competition for identifying wheat heads. I\u2019ve used the data from this competition to train a model.", "The data is available in the form of a csv and its corresponding images. We have the bottom left coordinate and also the width and height of each box.", "If we print the type of the bounding boxes, we see that they are of type string and not list as we would expect. This error is really common and can be solved using ast.literal_eval(). We also split the bounding boxes into four columns for ease of use.", "We now create a custom WheatDataset. Fasterrcnn expects our data in the form of an image and a dictionary corresponding to it. The dictionary should include bounding boxes and labels at the very least.", "We initialize our dataset with our data frame, and the folder we have our images in. We do the rest of the computation in the __getitem__() function.", "We convert our boxes from the (x0, y0, w, h) format to the (x0, y0, x1, y1) format. We assign our labels to all 1s since we have only one class in this problem (we use 1 as our label because in PyTorch, 0 is for background.). Finally, we convert everything to PyTorch tensors.", "We also define a __len__() function because it is used by the PyTorch DataLoader to iterate over our dataset.", "Pro tip: If your data is on a cloud, instead of downloading it locally, you can directly pull images for training (considering this process is not super slow). In this way, when you update your dataset online (add more entries or make changes to the existing one), you won\u2019t have to update your local copy. You will only have a training script that you\u2019ll run, and your model will train on the new data.", "We can now retrieve a batch from our dataloader and visualize one of the input images.", "Next, let\u2019s define our model. We are using a ResNet50 backbone with a feature pyramid network for our Fasterrcnn. The backbone is easily customizable. The only parameter we need to pass is the number of classes in our dataset.", "In train mode, the model takes images and target dictionary as input and produces a loss_dict as output.", "We train our model for 5 epochs. We then evaluate it by passing our images and getting back a dictionary of bounding boxes, labels, and their respective scores. This is not the final result, though. If we look at one of the outputs,", "we see that our model generates a lot of boxes for the same object. It is up to us to filter out the unwanted boxes. One technique to do so is called non-maximum suppression.", "To use NMS in PyTorch, we can simply do", "This line of code gives us the indexes of all the bounding boxes we should keep. Let\u2019s take a look at the same image after applying NMS.", "Looks much better right? So how does NMS work?", "To understand NMS, we first need to understand IoU (Intersection over Union). IoU is a measure of how similar two boxes are. The closer IoU is to 1, the more similar the boxes are. Keeping this in mind, let\u2019s take a look at the NMS algorithm:", "Doing this gives us a really good output. We can try various thresholds but 0.3 works well.", "If you want to extract the feature map as well, you can do so using hooks. Check out the kernel for the same.", "That will be it for this article. If you would like to learn more about Deep learning, check out my series of articles on the same.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6d758f5a6d79&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dipam44.medium.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Dipam Vasani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdb5934347fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&user=Dipam+Vasani&userId=db5934347fa&source=post_page-db5934347fa----6d758f5a6d79---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@r3dmax?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Jonatan Pie"}, {"url": "https://unsplash.com/s/photos/scenery?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/abs/1506.01497", "anchor_text": "https://arxiv.org/abs/1506.01497"}, {"url": "https://arxiv.org/abs/1612.03144", "anchor_text": "Feature Pyramid Network"}, {"url": "https://arxiv.org/abs/1506.01497", "anchor_text": "https://arxiv.org/abs/1506.01497"}, {"url": "https://www.linkedin.com/posts/dvasani_python-oneabrssabrpython-activity-6673000959301455872-R0Ny", "anchor_text": "This error is really common and can be solved using"}, {"url": "https://www.linkedin.com/posts/dvasani_python-oneabrssabrpython-activity-6673000959301455872-R0Ny", "anchor_text": "ast.literal_eval()."}, {"url": "https://www.kaggle.com/dipam7/wheat-head-classification", "anchor_text": "If you want to extract the feature map as well, you can do so using hooks. Check out the kernel for the same."}, {"url": "https://medium.com/@dipam44/deep-learning-series-30ad108fbe2b", "anchor_text": "Deep learning seriesA systematic list of all my articles on deep learningmedium.com"}, {"url": "https://arxiv.org/abs/1506.01497", "anchor_text": "Fasterrcnn paper"}, {"url": "https://arxiv.org/abs/1612.03144", "anchor_text": "Feature Pyramid network paper"}, {"url": "https://www.kaggle.com/pestipeti/pytorch-starter-fasterrcnn-train", "anchor_text": "PyTorch Starter \u2014 Fasterrcnn"}, {"url": "https://towardsdatascience.com/non-maximum-suppression-nms-93ce178e177c", "anchor_text": "Non-maximum supression"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----6d758f5a6d79---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6d758f5a6d79---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6d758f5a6d79---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----6d758f5a6d79---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/python?source=post_page-----6d758f5a6d79---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&user=Dipam+Vasani&userId=db5934347fa&source=-----6d758f5a6d79---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&user=Dipam+Vasani&userId=db5934347fa&source=-----6d758f5a6d79---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6d758f5a6d79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6d758f5a6d79---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6d758f5a6d79--------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dipam Vasani"}, {"url": "https://dipam44.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "698 Followers"}, {"url": "https://github.com/dipam7/", "anchor_text": "https://github.com/dipam7/"}, {"url": "https://www.linkedin.com/in/dipam-vasani-734932104/", "anchor_text": "https://www.linkedin.com/in/dipam-vasani-734932104/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdb5934347fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&user=Dipam+Vasani&userId=db5934347fa&source=post_page-db5934347fa--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe16e216bc3bf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feverything-about-fasterrcnn-6d758f5a6d79&newsletterV3=db5934347fa&newsletterV3Id=e16e216bc3bf&user=Dipam+Vasani&userId=db5934347fa&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}