{"url": "https://towardsdatascience.com/water-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16", "time": 1683016985.8115158, "path": "towardsdatascience.com/water-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16/", "webpage": {"metadata": {"title": "Water Detection in High Resolution Satellite Images using the waterdetect python package | by Maur\u00edcio Cordeiro | Towards Data Science", "h1": "Water Detection in High Resolution Satellite Images using the waterdetect python package", "description": "This story is divided in two parts: Methodology and the waterdetect package. In the methodology, the main concepts of the algorithm are given, in order to provide the reader a better understanding of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://youtu.be/oQaoj6LE5E4", "anchor_text": "available on YouTube", "paragraph_index": 1}, {"url": "http://cordmaur.carrd.co/", "anchor_text": "cordmaur.carrd.co", "paragraph_index": 1}, {"url": "https://github.com/isikdogan/deepwatermap", "anchor_text": "DeepWaterMap 2.0", "paragraph_index": 3}, {"url": "https://medium.com/analytics-vidhya/leveraging-the-performance-of-agglomerative-clustering-for-high-resolution-satellite-images-part-f5d54a816f3d", "anchor_text": "\u201cLeveraging the Performance of Agglomerative Clustering for High-Resolution Satellite Images\u201d", "paragraph_index": 12}, {"url": "https://github.com/cordmaur/WaterDetect", "anchor_text": "https://github.com/cordmaur/WaterDetect", "paragraph_index": 13}, {"url": "https://github.com/cordmaur/WaterDetect", "anchor_text": "https://github.com/cordmaur/WaterDetect", "paragraph_index": 30}, {"url": "https://www.linkedin.com/in/cordmaur/", "anchor_text": "https://www.linkedin.com/in/cordmaur/", "paragraph_index": 32}], "all_paragraphs": ["This story is divided in two parts: Methodology and the waterdetect package. In the methodology, the main concepts of the algorithm are given, in order to provide the reader a better understanding of the package and how to tune it. The second part is a tutorial on the waterdetect package with sample codes to run it.", "For information about the course Introduction to Python for Scientists (available on YouTube) and other articles like this, please visit my website cordmaur.carrd.co.", "The use of deep learning techniques for remote sensing applications has been increasing in recent years. The recently published review paper \u201cObject Detection and Image Segmentation with Deep Learning on Earth Observation Data: A Review-Part I: Evolution and Recent Trends\u201d (Hoeser and Kuenzer 2020)[1] presents the evolution of Convolutional Neural Networks (CNN) in satellite applications, notably Object Detection and Image Segmentation, where it achieves state-of-the-art results.", "One drawback of this approach is the need to train the neural network for every possible condition (water type, atmospheric condition, etc.) and there are few pretrained models ready to be used anywhere on the globe (DeepWaterMap 2.0 being one of them)(Isikdogan et al., 2017; Isikdogan et al., 2019)[2, 3]. Besides that, there are moments where we just want a quick unsupervised tool to do the task, without the complexities of model training. In such cases, I believe there is still room for a more traditional approach and that\u2019s what is proposed in waterdetect package.", "To fill this gap we have recently proposed the methodology that is implmented in the waterdetect package through the following paper: \u201cAutomatic Water Detection from Multidimensional Hierarchical Clustering for Sentinel-2 Images and a Comparison with Level 2A Processors\u201d(Cordeiro et. al., 2020)[4].", "The method combines a multidimensional agglomerative clustering with a machine learning classifier to make the detection effective and fast at the same time. It\u2019s not the objective of this post to enter in the details of the algorithm, as it is already described in the paper. However, some knowledge on the rational behind it is needed to make proper use of the package.", "The main idea of the algorithm is to combine water indexes (NDWI, MNDWI, etc.) with reflectance bands (NIR, SWIR, etc.) into an automated clustering process. Water indexes tend to have high values in water surfaces, however, as shown in the literature, just a single index associated with a threshold suffer from false positives or false negatives and the optimal threshold value is hard to find, depending on the scene. In the multidimensional clustering we can take advantage of water reflectance properties like the high absorption on SWIR and combine it with indexes for a better pixel discrimination. Figure 2 shows an example of water pixels (blue dots) separated through a multidimensional clustering and what would be the single threshold (red line).", "This is important because the algorithm let\u2019s the user choose the best combination for the water detection in the desired area in the WaterDetect.ini configuration file. Currently, the supported indexes are:", "The combinations that provides better balance between robustness and accuracy are [MNDWI, NDWI, Mir2] and [NDWI, Mir2], where Mir2 is the second SWIR band present on Sentinel 2 and Landsat 8 images.", "The algorithm will look for the best number of clusters (K) by testing different possibilities and deciding for the best according to the Calinsk Harabasz index. The maximum and minimum values for K are also configurable in the WaterDetect.ini.", "To identify among all the clusters, the one that contains the water pixels, the algorithm implements the following methods:", "The clustering algorithm used is agglomerative because the usual K-means don\u2019t provide good results when the clusters have different sizes. The problem is that a single Sentinel 2 scene has 120 million pixels in full resolution (10m) and the agglomerative clustering has time complexity (O\u00b2) and space complexity of (O\u00b3) making it unfeasible for processing this kind of image.", "To overcome this limitation we subsample the pixels randomly and apply the clustering in this subsample. Afterwards, a machine learning classifier (we chose n\u00e4ive bayes) is applied to generalize from the subsampled pixels to reconstruct the whole scene. With this solution, the full resolution Sentinel 2 image can be processed in less than 3 minutes. I have already written a full story about the k-means problem and the this upsampling procedure in \u201cLeveraging the Performance of Agglomerative Clustering for High-Resolution Satellite Images\u201d. Figure 3 has an overview of how the algorithm works.", "The algorithm proposed in [4] is available as a python package called waterdetect. The source code can be found in the git repository https://github.com/cordmaur/WaterDetect.", "The easiest way to install waterdetect package is through thecommand pip install waterdetect .", "Alternatively, you can clone the repository and install from its root throught the following commands:", "Alternatively, you can clone the repository and install from its root throught the following commands:", "Once installed, a waterdetect entry point is created in the path of the environment. The waterdetect can be run from this entry point (refer to the git repository for more information). Typing waterdetect -h displays the help.", "A configuration file specifying the clustering bands, water cluster detection method and other parameters is necessary for the algorithm to run. The command waterdetect -GC will copy the default configuration file to current directory. You can create other variants of this file and pass them as an argument using the -c option. If it is not explicitly specified, a WaterDetect.ini in the current directory is searched for. The input_folder argument should point to a directory that contains uncompressed images of the same product type (an example of the structure is shown in Figure 4), so the algorithm can loop through all the images and process them at once.", "During running, one folder for each image will be created in the output directory. The final water mask, as well as the clustering results, will be available inside the folder with the name corresponding to the bands used for clustering. If more than one combination of bands is specified in the config file, they all will be processed and saved. In the config it is also possible to specify pdf_reports=True and plot_graphs=True. With these options the algorithm will save a .PDF file with the results in low resolution and include any graphs that you have specified in the configuration. For the above directory configuration, the commands to run are:", "A full Sentinel 2 tile has approximately 120million pixels and it takes about 3\u20135 min depending on the processor and operating system. At the end of each image\u2019s processing, a message indicating a probability of sun glint is displayed. An example of the PDF report is shown in Figure 5.", "Instead of calling the waterdetect from script, it is also possible to import the package into a console or jupyter notebook to launch it. This way, two options are available. There is the run_batch, that is pretty similar to the script call and also the run_single, that runs the algorithm for one image only and returns the result in memory.", "When you execute import waterdetect it initializes and declares the most important classes.", "The DWWaterDetect class is responsible for orchestrating the full chain, since the opening of the satellite images, to the contstruction of reports. For that, it will use the other modules. The DWWaterDetect allows two main modes:", "The following code shows an example on how to launch both modes from a jupyter notebook.", "If GDAL is not installed on the environment, the waterdetect will display a message and none of the above methods will work as GDAL is needed to open the satellite images. However, if you want to feed the algorithm with your own arrays in the case you use other library (such as rasterio) or the satellite you are using is not supported it is still possible to use the waterdetect package.", "In such case, the bands should be passed to the DWImageClustering object as a dicionary. To work with multiple satellites (Sentinel 2 and Landsat at the moment) the waterdetect uses the following convention for the bands names", "The minimum required bands will depend on the bands combination that has been chosen and the method for detecting the water cluster. The following code shows an example on using the waterdetect with bands loaded manually using the rasterio.", "As you can see, the attributes water_mask and clustering_matrix store numpy arrays with the resulting mask and the intermediate clustering result. The resulting values are:", "As seen throughout this story, the waterdetect package is a good solution for extracting water masks from high resolution satellite images without any prior knowledge about the scene or arbitrary thresholds. Important to notice that for tasks other than water detection, it can still be used as a high performance clustering algorithm that delivers much better results than the most common K-means that would not be feasible due to memory and time to process.", "The package is still under development, so if you find any trouble or have suggestions on how to improve this tutorial feel free to leave a message or open an issue in the github repository (https://github.com/cordmaur/WaterDetect).", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. Geospatial Data Scientist and water specialist at Brazilian National Water and Sanitation Agency. To get in touch: https://www.linkedin.com/in/cordmaur/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7c5a031e3d16&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://cordmaur.medium.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Maur\u00edcio Cordeiro"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8878c77fe1a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=post_page-8878c77fe1a3----7c5a031e3d16---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://youtu.be/oQaoj6LE5E4", "anchor_text": "available on YouTube"}, {"url": "http://cordmaur.carrd.co/", "anchor_text": "cordmaur.carrd.co"}, {"url": "https://github.com/isikdogan/deepwatermap", "anchor_text": "DeepWaterMap 2.0"}, {"url": "https://medium.com/analytics-vidhya/leveraging-the-performance-of-agglomerative-clustering-for-high-resolution-satellite-images-part-f5d54a816f3d", "anchor_text": "\u201cLeveraging the Performance of Agglomerative Clustering for High-Resolution Satellite Images\u201d"}, {"url": "https://github.com/cordmaur/WaterDetect", "anchor_text": "https://github.com/cordmaur/WaterDetect"}, {"url": "https://github.com/cordmaur/WaterDetect.git", "anchor_text": "https://github.com/cordmaur/WaterDetect.git"}, {"url": "https://github.com/cordmaur/WaterDetect", "anchor_text": "https://github.com/cordmaur/WaterDetect"}, {"url": "https://doi.org/10.3390/rs12101667.", "anchor_text": "https://doi.org/10.3390/rs12101667."}, {"url": "https://doi.org/10.1109/JSTARS.2017.2735443", "anchor_text": "https://doi.org/10.1109/JSTARS.2017.2735443"}, {"url": "https://doi.org/10.1109/LGRS.2019.2953261", "anchor_text": "https://doi.org/10.1109/LGRS.2019.2953261"}, {"url": "https://doi.org/10.1016/j.rse.2020.112209", "anchor_text": "https://doi.org/10.1016/j.rse.2020.112209"}, {"url": "https://medium.com/tag/remote-sensing?source=post_page-----7c5a031e3d16---------------remote_sensing-----------------", "anchor_text": "Remote Sensing"}, {"url": "https://medium.com/tag/water-detection?source=post_page-----7c5a031e3d16---------------water_detection-----------------", "anchor_text": "Water Detection"}, {"url": "https://medium.com/tag/sentinel-2?source=post_page-----7c5a031e3d16---------------sentinel_2-----------------", "anchor_text": "Sentinel 2"}, {"url": "https://medium.com/tag/clustering?source=post_page-----7c5a031e3d16---------------clustering-----------------", "anchor_text": "Clustering"}, {"url": "https://medium.com/tag/python-packages?source=post_page-----7c5a031e3d16---------------python_packages-----------------", "anchor_text": "Python Packages"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=-----7c5a031e3d16---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=-----7c5a031e3d16---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7c5a031e3d16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7c5a031e3d16---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7c5a031e3d16--------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maur\u00edcio Cordeiro"}, {"url": "https://cordmaur.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.7K Followers"}, {"url": "https://www.linkedin.com/in/cordmaur/", "anchor_text": "https://www.linkedin.com/in/cordmaur/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8878c77fe1a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=post_page-8878c77fe1a3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa9b1761194a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwater-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16&newsletterV3=8878c77fe1a3&newsletterV3Id=a9b1761194a9&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}