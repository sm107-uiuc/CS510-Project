{"url": "https://towardsdatascience.com/measuring-ny-population-mobility-using-twitter-ce72109e03de", "time": 1683017130.899765, "path": "towardsdatascience.com/measuring-ny-population-mobility-using-twitter-ce72109e03de/", "webpage": {"metadata": {"title": "Estimating NY Population Mobility Using Twitter | by Tim Hintz | Towards Data Science", "h1": "Estimating NY Population Mobility Using Twitter", "description": "Understanding population mobility patterns is important to policy makers, marketers, business owners and now in particular, epidemiologists. I was particularly interested in the effect of mobility\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.cdc.gov/pcd/issues/2020/20_0241.htm#:~:text=A%20decrease%20in%20visits%20to,can%20mitigate%20COVID%2D19%20transmission.", "anchor_text": "others has linked population mobility to disease", "paragraph_index": 2}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "linked here", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/Mean_squared_displacement", "anchor_text": "Mean Squared Displacement (MSD)", "paragraph_index": 2}, {"url": "https://www.tweepy.org/", "anchor_text": "Tweepy", "paragraph_index": 3}, {"url": "https://developer.twitter.com/en/docs/getting-started", "anchor_text": "twitter API key.", "paragraph_index": 3}, {"url": "https://developer.twitter.com/en/docs/twitter-api/v1/rate-limits#:~:text=Standard%20API%20v1.&text=You%20can%20only%20post%20300,id%20endpoint%20during%20that%20period.", "anchor_text": "not designed for whole sale scraping", "paragraph_index": 3}, {"url": "http://docs.tweepy.org/en/latest/streaming_how_to.html", "anchor_text": "Tweepy allows you to establish a stream listener.", "paragraph_index": 3}, {"url": "https://developer.twitter.com/en/docs/tutorials/tweet-geo-metadata", "anchor_text": "approximately 1\u20132% of all tweets were geotagged", "paragraph_index": 7}, {"url": "https://account.mapbox.com/", "anchor_text": "mapbox API", "paragraph_index": 11}, {"url": "https://developer.twitter.com/en/docs/tutorials/tweet-geo-metadata", "anchor_text": "point data can not be synthesized by a user", "paragraph_index": 17}, {"url": "http://www.casos.cs.cmu.edu/publications/papers/Twitter_geo_asonam_final.pdf", "anchor_text": "New York is a matter of debate", "paragraph_index": 18}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "good accuracy", "paragraph_index": 19}, {"url": "https://en.wikipedia.org/wiki/Haversine_formula#:~:text=The%20haversine%20formula%20determines%20the,and%20angles%20of%20spherical%20triangles.", "anchor_text": "Haversine Formula", "paragraph_index": 21}, {"url": "https://pypi.org/project/haversine/", "anchor_text": "python has a library for that", "paragraph_index": 21}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "previous work related to population mobility", "paragraph_index": 25}], "all_paragraphs": ["Disclaimer: All data was obtained from the official twitter API and is for my own educational purposes.", "Understanding population mobility patterns is important to policy makers, marketers, business owners and now in particular, epidemiologists. I was particularly interested in the effect of mobility patterns on case load of Covid-19 in New York. In the US, population mobility is estimated using the Census Bureau Current Population Survey in addition to anonymized cell phone tower data. The issue with CPS is that it is a once per month survey and mobility is measured as a change of address which is too low a resolution to analyze something as rapid as covid spread. Cell phone tower data provides a granular view of mobility at the zip-code level but anonymized cell tower data is not available publicly in real time.", "I wanted to establish a metric for human mobility patterns using geotagged tweets. Using the official Twitter API, I was able to capture 300,000 tweets. Prior work by others has linked population mobility to disease spread and a fantastic paper linked here used geotagged tweets in Australia to accurately proxy human mobility. I want to create an early warning model for neighborhoods that are soon to receive a spike in covid levels by aggregating population mobility. From some research in the field, I decided on aggregated Mean Squared Displacement (MSD) of NY twitter users as my measure for population mobility.", "Tweepy is a wrapper class for the Twitter API and as such requires you to have a twitter API key. Unlike the popular web scraper, Twint which allows practically unlimited search queries over the past 7 days, Tweepy forces the user to access their REST API for queries which is frustratingly slow as the hourly rates are definitely not designed for whole sale scraping but rather private use. However, Tweepy allows you to establish a stream listener. The only downside to the stream listener is that you you can\u2019t access any historical data, but you can capture what seemed to be unlimited tweets, 24 hours a day, 7 days a week which more than makes up for loss.", "Here is a simple example of a Tweepy stream listener that captures a tweet object and appends it to a json file.", "Everything here is fairly straight forward and mostly from Tweepy\u2019s getting started tutorial but I would bring your attention to:", "I left this running for 7 days. Notice that on each new day, a new json will be created and saved so I don\u2019t have to have to manipulate anything in terms of data storage. Finally, the locations parameter in the filter method at the bottom is to ensure only tweets from the New York City area are included in my stream.", "Previous work indicated that approximately 1\u20132% of all tweets were geotagged and about 20% of those had those precious point locations that would allow me to measure MSD. But by filtering by location, I only received tweets that were geotagged in the first place. I was able to save approximately 50k tweets a day, of those around 15% had the point locations.", "Now that know the relative proportions of tweets with and without geotags, I wanted to look at the frequency of the tweets coming in over time. The reason being that if the shape of the point data time series and non point data time series looked significantly different, point data may not be such a good representative sample. I resampled the time series into 1 hour increments, took the 3 hour rolling mean of that and log transformed the series\u2019 so we could compare them on the same y axis.", "In blue, the tweets with point data, in orange, the tweets without point data. Apart from the scale, this I took this to be preliminary evidence that point data tweets follow the same time series distribution as non-point data tweets.", "However, this data came from all of New York and some parts of New Jersey. I subsetted my data to only include data from the 5 New York Boroughs and looked at the ratio between tweets including point data and those that do not.", "After I had gained good understanding of my data, I wanted to visualize it on a map. Rather than using a shapefile, I signed up for the free version of mapbox API and used it with plotly express:", "This is great but it didn\u2019t tell me very much. Specifically, since I don\u2019t know who sent which tweet, it is possible that all of these tweets came from different people. In order to calculate MSD I reasoned that I need at least 3 tweets per user in order to calculate MSD, a centroid tweet and the two others relative to it.", "I subsetted my data such that only tweets from people who had sent more than 2 tweets in he past week. Once I did that and focused in on only Manhattan, Brooklyn and Queens, my data distribution looked like this:", "We can see that the density of tweets is located primarily in Manhattan and north western Brooklyn. While the remainder of Brooklyn and Queens is very spread out. We will look into how that effects MSD later on.", "This gave me over 1600 twitter users producing just over 16000 tweets (weirdly coincidental 1:10 ratio). which is such a small proportion of the three boroughs total population. It works out to be about 0.02% of the total population of the three boroughs. But we have come this far so let\u2019s try and understand the data that we have.", "The stream API provides you with a tweet object. There is a lot of information contained within the tweet object. Importantly, the user\u2019s name is included alongside their location in real time. As such, when using this data being ethical about how you anonymize the user information is very important. That is why I have chosen not to post this data set anywhere and the use of this twitter data is completely for my own educational purposes.", "The beauty of twitter point data is that, unlike place or boundary data in the twitter object, point data can not be synthesized by a user. That is, if a tag has a point, there was someone there that sent it with time stamp.", "However, as I stated in the previous segment, the proportion of users per weeks that send 3 or more geotagged tweets is only 0.02% of the total population. More over, I don\u2019t know the exact demographic makeup of people who choose to geotag their tweets. There has been some study done on the demographic breakdown of such users but since I was not able to apply any stratified sampling methods to my collection methods, whether or not that study is applicable to New York is a matter of debate. For now, I will simply focus on developing MSD and leave the demographic analysis for another article.", "Mean Squared displacement is a way to measure random motion from a reference point. It is used widely used in fields of study where the random and or directional movement of particles must be measured. But social scientists have used it as a metric of human mobility with good accuracy. Therefore, I decided to measure human mobility for all of my users using MSD.", "Its a little bit to take in, but this is simply the sum of all positions (xi(0)) relative to a reference position (x(t)) for each given position of that person. The \u201cconf\u201d just means configurations.", "Translating the MSD equation into code was actually really fun, remembering that coordinates are points on a globe and therefore euclidean geometry gives way to the Haversine Formula. Thankfully, python has a library for that. The most difficult part about this equation was deciding on a reference position for each user. Unfortunately, there was no prior research done on how to decide this. The paper that I read offered little explanation outside of a \u201ccentroid\u201d that they calculated. However, if I were to calculate a centroid there is a fair chance that the it will fall into an uninhabitable region like the east river or central park. Since I eventually would like to aggregate users movement into zip-codes, what I really wanted was each users home node.", "My hypothesis was that people would mostly be at home between 6pm and midnight on a weeknight. It\u2019s a leap, but as I continue to gather data I will revise how I determine individual centroids. Using pandas time series methods pulled out a list of users who had sent 3 or more messages during the past week and also had one of those tweets occur between 6-midnight on a weekday. Finally, I took the mode location that they tweeted from and aggregated that into a median MSD per Borough.", "As we would expect, Queens, being the most spread out of the three Burroughs and the least access to public transportation, had the highest mean squared displacement. In a similar vein, Brooklyn had a higher mean displacement than Manhattan which is inline with what we observed previously when we mapped out our data.", "For each Borough I wondered if there was a unique distribution of user\u2019s MSD. For this, I decided to use a violin plot. A violin plot combines kernel density estimation with a conventional box and whisker graph in order to show the distribution of data.", "The mixed gaussian distribution seen here has been observed in previous work related to population mobility which is encouraging for a preliminary result. However their paper, they had just over 4 million tweets to work with where as in the present study I had a little over 13 thousand.", "Unfortunately, since I am collecting data in real time, I do not have enough data to look at population mobility at the level of zip-codes right now. However, I have really enjoyed working on this project so far and am looking forward to where it ends up. I hope to release another article when I have sufficient data to run a model.", "Until then, thank you for reading and stay safe.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Analytic Consultant | Data Science | Lifelong Leaner"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fce72109e03de&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tjhintz.medium.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": ""}, {"url": "https://tjhintz.medium.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Tim Hintz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa831ff54934b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&user=Tim+Hintz&userId=a831ff54934b&source=post_page-a831ff54934b----ce72109e03de---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kaip?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Kai Pilger"}, {"url": "https://unsplash.com/s/photos/movement?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.cdc.gov/pcd/issues/2020/20_0241.htm#:~:text=A%20decrease%20in%20visits%20to,can%20mitigate%20COVID%2D19%20transmission.", "anchor_text": "others has linked population mobility to disease"}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "linked here"}, {"url": "https://en.wikipedia.org/wiki/Mean_squared_displacement", "anchor_text": "Mean Squared Displacement (MSD)"}, {"url": "https://www.tweepy.org/", "anchor_text": "Tweepy"}, {"url": "https://developer.twitter.com/en/docs/getting-started", "anchor_text": "twitter API key."}, {"url": "https://developer.twitter.com/en/docs/twitter-api/v1/rate-limits#:~:text=Standard%20API%20v1.&text=You%20can%20only%20post%20300,id%20endpoint%20during%20that%20period.", "anchor_text": "not designed for whole sale scraping"}, {"url": "http://docs.tweepy.org/en/latest/streaming_how_to.html", "anchor_text": "Tweepy allows you to establish a stream listener."}, {"url": "https://developer.twitter.com/en/docs/tutorials/tweet-geo-metadata", "anchor_text": "approximately 1\u20132% of all tweets were geotagged"}, {"url": "https://account.mapbox.com/", "anchor_text": "mapbox API"}, {"url": "https://unsplash.com/@olloweb?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Agence Olloweb"}, {"url": "https://unsplash.com/s/photos/magnifying-glass?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://developer.twitter.com/en/docs/tutorials/tweet-geo-metadata", "anchor_text": "point data can not be synthesized by a user"}, {"url": "http://www.casos.cs.cmu.edu/publications/papers/Twitter_geo_asonam_final.pdf", "anchor_text": "New York is a matter of debate"}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "good accuracy"}, {"url": "https://en.wikipedia.org/wiki/Haversine_formula#:~:text=The%20haversine%20formula%20determines%20the,and%20angles%20of%20spherical%20triangles.", "anchor_text": "Haversine Formula"}, {"url": "https://pypi.org/project/haversine/", "anchor_text": "python has a library for that"}, {"url": "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4496063/", "anchor_text": "previous work related to population mobility"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ce72109e03de---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/twitter?source=post_page-----ce72109e03de---------------twitter-----------------", "anchor_text": "Twitter"}, {"url": "https://medium.com/tag/covid19?source=post_page-----ce72109e03de---------------covid19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/python?source=post_page-----ce72109e03de---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&user=Tim+Hintz&userId=a831ff54934b&source=-----ce72109e03de---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&user=Tim+Hintz&userId=a831ff54934b&source=-----ce72109e03de---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fce72109e03de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ce72109e03de---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ce72109e03de--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ce72109e03de--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ce72109e03de--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ce72109e03de--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ce72109e03de--------------------------------", "anchor_text": ""}, {"url": "https://tjhintz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tjhintz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tim Hintz"}, {"url": "https://tjhintz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "30 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa831ff54934b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&user=Tim+Hintz&userId=a831ff54934b&source=post_page-a831ff54934b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa831ff54934b%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-ny-population-mobility-using-twitter-ce72109e03de&user=Tim+Hintz&userId=a831ff54934b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}