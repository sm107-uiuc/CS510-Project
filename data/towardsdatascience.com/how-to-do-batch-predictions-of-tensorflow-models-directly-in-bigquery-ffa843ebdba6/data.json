{"url": "https://towardsdatascience.com/how-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6", "time": 1682995741.270877, "path": "towardsdatascience.com/how-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6/", "webpage": {"metadata": {"title": "How to do batch predictions of TensorFlow models directly in BigQuery | by Lak Lakshmanan | Towards Data Science", "h1": "How to do batch predictions of TensorFlow models directly in BigQuery", "description": "If you have trained a model in TensorFlow and exported it as a SavedModel, you can now use the ML.PREDICT SQL function in BigQuery to make predictions. This is very useful if you want to make batch\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/how-to-do-text-classification-using-tensorflow-word-embeddings-and-cnn-edae13b3e575", "anchor_text": "text classification model", "paragraph_index": 2}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/tree/master/courses/machine_learning/deepdive/09_sequence/txtclsmodel", "anchor_text": "GitHub", "paragraph_index": 2}], "all_paragraphs": ["If you have trained a model in TensorFlow and exported it as a SavedModel, you can now use the ML.PREDICT SQL function in BigQuery to make predictions. This is very useful if you want to make batch predictions (e.g., to make predictions for all the data collected in the past hour), since any SQL query can be scheduled in BigQuery.", "Note: this feature is currently in public alpha. Contact your GCP representative to get whitelisted.", "I\u2019ll demonstrate using the text classification model that I describe in this blog post and for which the Keras code is on GitHub. I trained the model on Cloud ML Engine, but you can train it wherever and however you want. The important bit is the line to export the model as a Saved Model into Google Cloud Storage:", "Creating the model in BigQuery is simply a matter of specifying a different model_type and pointing it at the model_path where the SavedModel was exported (note the wildcard at the end to pick up the assets, vocabulary, etc.):", "I\u2019ve made the bucket above public, so you can try out the query above as-is (create a dataset named advdata first). This creates a model in BigQuery that works like any built-in model:", "In particular, the schema indicates that the required input to the model is called \u201cinput\u201d and is a string.", "Predicting with model is quite straightforward. For example, we can pull some data from our BigQuery table and make sure that in our select, we name our columns depending on what the TensorFlow requires. In this case, my TensorFlow model\u2019s serving_input_fn specifies that the model expects a single input string called \u201cinput\u201d.", "Given that, we can now do a prediction:", "Knowing the actual labels, we can make the actual query better:", "Note that this one provides the values directly in the SQL. The result:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fffa843ebdba6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----ffa843ebdba6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/how-to-do-text-classification-using-tensorflow-word-embeddings-and-cnn-edae13b3e575", "anchor_text": "text classification model"}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/tree/master/courses/machine_learning/deepdive/09_sequence/txtclsmodel", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----ffa843ebdba6---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----ffa843ebdba6---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/keras?source=post_page-----ffa843ebdba6---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ffa843ebdba6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----ffa843ebdba6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----ffa843ebdba6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fffa843ebdba6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ffa843ebdba6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ffa843ebdba6--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-batch-predictions-of-tensorflow-models-directly-in-bigquery-ffa843ebdba6&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}