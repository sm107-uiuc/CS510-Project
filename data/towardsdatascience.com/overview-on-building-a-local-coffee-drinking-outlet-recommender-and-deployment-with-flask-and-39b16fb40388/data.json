{"url": "https://towardsdatascience.com/overview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388", "time": 1683007217.5309591, "path": "towardsdatascience.com/overview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388/", "webpage": {"metadata": {"title": "Building and Deploying a Recommender with Flask and Heroku | by Jason Chia | Towards Data Science", "h1": "Building and Deploying a Recommender with Flask and Heroku", "description": "In this post, I illustrate one way of building a hybrid recommender and deploying a bare-bones, model-based content-filtering system with Flask and Heroku. This is the culmination of my capstone\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/jasonchia89/GA_Capstone", "anchor_text": "GA_Capstone", "paragraph_index": 0}, {"url": "https://github.com/jasonchia89/GA_Capstone_Flask", "anchor_text": "GA_Capstone_Flask_Heroku_deployment", "paragraph_index": 0}, {"url": "https://pypi.org/project/beautifulsoup4/", "anchor_text": "BeautifulSoup", "paragraph_index": 5}, {"url": "https://datascience.stackexchange.com/questions/15989/micro-average-vs-macro-average-performance-in-a-multiclass-classification-settin", "anchor_text": "micro-averaged F1 score", "paragraph_index": 8}, {"url": "https://devcenter.heroku.com/articles/request-timeout", "anchor_text": "30 seconds", "paragraph_index": 17}, {"url": "http://sg-coffee-recommender.herokuapp.com", "anchor_text": "here", "paragraph_index": 19}], "all_paragraphs": ["In this post, I illustrate one way of building a hybrid recommender and deploying a bare-bones, model-based content-filtering system with Flask and Heroku. This is the culmination of my capstone project from a Data Science Immersive program under General Assembly (GA) Singapore. More details can be found in these GitHub repo links: GA_Capstone, GA_Capstone_Flask_Heroku_deployment.", "For this project, I have chosen coffee as the topic of interest, as I am surrounded by coffee-loving social cliques (even though I don\u2019t drink coffee!) and am well aware of the existence of practically endless choices when it comes to finding a good venue to grab a cuppa. Therefore, I reckon the building of a recommender that could address the problem of being inundated with choices, and that does away with needing to filter choices based on a plethora of attributes such as location, service standards etc., might come in handy here.", "A paradigm of Content-based Filtering which is framed in the context of a supervised machine learning algorithm (defined by feature X and target y), in which various features (feature matrix, X) of the items (coffee outlets in this case) (and hence Content-based) are used to predict user ratings (target y). The predicted user ratings are then ranked in descending order and the top 5 or any arbitrary number, n, one deems fit are presented as the top 5 or top-n recommendations for the user to check out.", "A paradigm of Collaborative Filtering based on a machine learning algorithm that learns user-item interactions from existing data to predict a user\u2019s item rating (or a user\u2019s coffee outlet rating in our context), by taking into account the item ratings of other users with similar rating patterns \u2014 this is why Collaborative Filtering RecSys often runs into the cold-start problem where it is impossible to find users with rating patterns similar to a new user who has not rated anything \u2014 and then recommending items that are most-liked by those similar users to the user of interest (hence Collaborative in nature).", "A hybrid RecSys combines Content-based Filtering and Collaborative Filtering in an attempt to mitigate the shortcomings of either to produce a more holistic and comprehensive system (best of both worlds, so-to-speak)\u2014 Eg. Content-based Filtering falls short of producing cross-recommendations, i.e. it tends to only recommend items of the same type as items once liked by user. Collaborative Filtering addresses this with its collaborative trait \u2014 can potentially recommend items that fall outside of categories of items once liked by user as long as those items are most liked by other users with similar rating patterns. On the other hand, for datasets involving only explicit feedback such as user ratings (Eg. this Yelp dataset), Collaborative Filtering only takes into account the user-item interaction matrix that comprises userids, ratings, and itemids. In this case, Content-based Filtering can enrich the item-feature dataset of the RecSys by providing more granular, item-wise features (i.e. category, review_count, avg_store_rating etc. of coffee outlets) and thus make the RecSys more all-encompassing and robust.", "The dataset consists of about 987 local coffee-drinking outlets and associated features, 6,292 user reviews, and 7,076 user ratings scraped from Yelp using a combination of BeautifulSoup and Yelp\u2019s API token.", "As there was a large proportion of users in the scraped dataset that only rated 1\u20132 outlets, training a model on all of these users will inevitably run into errors in the train_test_split() and cross validation stages of the model evaluation phase later on, when the dataset is split into training and validation sets stratified by userids (especially if the test_size is less than 0.5 and number of cross validation folds is more than 2). As such, I have only incorporated users who have rated at least 10 different outlets into the content-based filtering model (this resulted in 110 /2552 users being included in the model-training). The number 10 was arbitrarily chosen, although there might be a connection between this and how 10 ratings are supposed to be provided by a user to generate the top 5 recommendations in the deployed model which we will see later on.", "Looking at the training data, our target, y (user ratings), was evidently imbalanced:", "Due to the imbalanced nature of the target classes, and the fact that we wouldn\u2019t want poor recommendations to be recommended (false positives) nor do we want good recommendations to be missed out (false negatives), a micro-averaged F1 score, which is essentially a metric defined as a micro-averaged balance between precision and recall, was used to evaluate the performance of the respective models later on.", "The item (or coffee outlet)-wise features to be incorporated into the Content-based Filtering model are:", "Reviews were broken down into word term frequencies using a naive Tf-idf vectorizer, which serves to show the discriminating strength of each review word term and their association with the various coffee outlets prior to model-training.", "I have tuned and experimented with various supervised machine learning algorithms such as logistic regression, decision tree classifier, and ensemble methods such as extreme gradient-boosting classifier (XGB). XGB performed the best (micro-averaged F1 score: 0.97) and was chosen for deployment. XGB is an extreme gradient-boosting regression tree (GBRT) algorithm that:", "Alternating Least Squares (ALS) algorithm was used and tuned using Pyspark\u2019s CrossValidator (micro-averaged F1 score: 1.0). ALS is a matrix factorization technique that decomposes user-item interaction matrix (such as user-item ratings matrix for datasets with explicit feedback) into user and item latent factors where their dot product will predict users\u2019 item ratings (or users\u2019 ratings of the various coffee outlets in this context). It alternates between fixing user or item latent factors to solve for the other via gradient descent at each iteration in the process of minimizing loss (error between actual and predicted user ratings):", "Content-based and Collaborative Filtering were combined by taking the weighted sum of rating predictions from both filtering systems. Eg. If the predicted user rating from Content-based Filtering is 3 while that from Collaborative Filtering is 4, the final predicted user rating would be:", "The hybrid RecSys yielded a micro-averaged F1 score of 1.0.", "The hybrid RecSys was successfully implemented in a local virtual environment using a Flask python script and some html templates.", "Basically, users are supposed to select and rate 10 local coffee-drinking outlets they have been to before or are familiar with (preferably 2 different outlets per rating class so as to allow the machine learning models working at the back end to get a more comprehensive sense of the user\u2019s \u201cpreferences\u201d, which will in turn generate more reliable recommendations) and click \u201cSubmit\u201d to churn out the top 5 recommendations for said user to check out.", "However, unlike most deployed machine learning models which only simply predict outcomes based on unseen features (i.e. X_test) provided as user input, this hybrid RecSys relies on a manually combined pair of machine learning models to train new unseen ratings (i.e. target, y_train) and rated coffee outlets (i.e. features, X_train) and predict user\u2019s ratings for the other coffee outlets that were not rated. As such, it takes on average 15\u201320+ minutes upon clicking \u201cSubmit\u201d to churn out the top 5 recommendations on the Flask app\u2026 This duration is unacceptable for formal deployment platforms like Heroku, which kills any web application\u2019s process as long as the wait time exceeds a mere 30 seconds, and outputs a \u201cRequest timeout\u201d message and an H12 error in the error logs\u2026", "Given the above, I could only attempt to deploy \u201chalf\u201d of the RecSys, specifically, the XGB component: As ALS could only be imported from Pyspark \u2014 pyspark.ml.recommendation library \u2014 and I have yet to find an online resource that details deploying Pyspark code with Heroku. Most resources found are on Scala and Spark applications which require compilation with Scala Build Tool (sbt) and jar assembly which in turn seem a little too complex for my Flask app which uses minimal Pyspark code \u2014 not even SparkContext or spark-submit, just the SparkSession and ALS components.", "With the RecSys cut down to just the XGB component, \u201cRequest Timeout\u201d was still an issue. After trimming the XGB component of the code down and keeping tabs of the runtime for each code cell in Jupyter Notebook with %%time, I was able to shorten the runtime sufficiently for the XGB component to be deployed formally with Heroku over here.", "Some limitations of the hybrid RecSys include:", "Keep a lookout online for updates on the various deployment platforms, stackoverflow, and Pyspark deployment to see if the Pyspark ALS component can be incorporated into Heroku deployment so that the full hybrid RecSys can be deployed online.", "If the above pans out well, can potentially incorporate user-design/user-experience concepts to better design the html user interfaces in preparation for A/B testing to gauge the effectiveness of the hybrid RecSys built.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I aim to marry my interest in programming and edge in math to make a difference in society with data science and business analytics"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F39b16fb40388&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----39b16fb40388--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jasonchia36?source=post_page-----39b16fb40388--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jasonchia36?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Jason Chia"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2f26d8209073&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&user=Jason+Chia&userId=2f26d8209073&source=post_page-2f26d8209073----39b16fb40388---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/jasonchia89/GA_Capstone", "anchor_text": "GA_Capstone"}, {"url": "https://github.com/jasonchia89/GA_Capstone_Flask", "anchor_text": "GA_Capstone_Flask_Heroku_deployment"}, {"url": "https://pypi.org/project/beautifulsoup4/", "anchor_text": "BeautifulSoup"}, {"url": "https://datascience.stackexchange.com/questions/15989/micro-average-vs-macro-average-performance-in-a-multiclass-classification-settin", "anchor_text": "micro-averaged F1 score"}, {"url": "https://datascience.stackexchange.com/questions/16904/gbm-vs-xgboost-key-differences", "anchor_text": "Controls over-fitting"}, {"url": "https://blog.quantinsti.com/xgboost-python/", "anchor_text": "https://blog.quantinsti.com/xgboost-python/"}, {"url": "https://devcenter.heroku.com/articles/request-timeout", "anchor_text": "30 seconds"}, {"url": "http://sg-coffee-recommender.herokuapp.com", "anchor_text": "here"}, {"url": "https://medium.com/tag/recommendation-system?source=post_page-----39b16fb40388---------------recommendation_system-----------------", "anchor_text": "Recommendation System"}, {"url": "https://medium.com/tag/content-based-filtering?source=post_page-----39b16fb40388---------------content_based_filtering-----------------", "anchor_text": "Content Based Filtering"}, {"url": "https://medium.com/tag/collaborative-filtering?source=post_page-----39b16fb40388---------------collaborative_filtering-----------------", "anchor_text": "Collaborative Filtering"}, {"url": "https://medium.com/tag/coffee?source=post_page-----39b16fb40388---------------coffee-----------------", "anchor_text": "Coffee"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&user=Jason+Chia&userId=2f26d8209073&source=-----39b16fb40388---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&user=Jason+Chia&userId=2f26d8209073&source=-----39b16fb40388---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F39b16fb40388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----39b16fb40388---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----39b16fb40388--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----39b16fb40388--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----39b16fb40388--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----39b16fb40388--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----39b16fb40388--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jasonchia36?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jasonchia36?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jason Chia"}, {"url": "https://medium.com/@jasonchia36/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "8 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2f26d8209073&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&user=Jason+Chia&userId=2f26d8209073&source=post_page-2f26d8209073--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F80c76593373&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foverview-on-building-a-local-coffee-drinking-outlet-recommender-and-deployment-with-flask-and-39b16fb40388&newsletterV3=2f26d8209073&newsletterV3Id=80c76593373&user=Jason+Chia&userId=2f26d8209073&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}