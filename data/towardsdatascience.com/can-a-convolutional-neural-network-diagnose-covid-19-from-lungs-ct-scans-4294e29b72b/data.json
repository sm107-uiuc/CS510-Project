{"url": "https://towardsdatascience.com/can-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b", "time": 1683006638.68759, "path": "towardsdatascience.com/can-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b/", "webpage": {"metadata": {"title": "Can a Convolutional Neural Network diagnose COVID-19 from lungs CT scans? | by Ihor Markevych | Towards Data Science", "h1": "Can a Convolutional Neural Network diagnose COVID-19 from lungs CT scans?", "description": "Convolutional neural networks tutorial of using computer tomography lungs scans for COVID-19 diagnosis."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/luisblanche/covidct", "anchor_text": "next dataset", "paragraph_index": 0}, {"url": "https://www.kaggle.com/dergel/cnn-on-covid-19-ct-lungs-scans", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://www.statnews.com/2020/04/16/ct-scans-alternative-to-inaccurate-coronavirus-tests/", "anchor_text": "this source", "paragraph_index": 2}, {"url": "https://github.com/UCSD-AI4H/COVID-CT", "anchor_text": "repository", "paragraph_index": 2}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/Adam", "anchor_text": "Adam optimizer", "paragraph_index": 6}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "following generator", "paragraph_index": 7}, {"url": "https://fairyonice.github.io/Learn-about-ImageDataGenerator.html", "anchor_text": "here", "paragraph_index": 10}, {"url": "https://www.kaggle.com/dergel/cnn-on-covid-19-ct-lungs-scans/", "anchor_text": "here", "paragraph_index": 26}, {"url": "https://www.kaggle.com/luisblanche/covidct", "anchor_text": "here", "paragraph_index": 26}], "all_paragraphs": ["The current situation exposed humanity to new challenges and opportunities. In this unstable today, we would revert to science and go through the complete process of creating an image classification model for diagnosing novel coronavirus from lungs computed tomography (CT) scans using some openly available data. We will be using the next dataset, Keras, and Tensorflow for this exercise. The link to the full code is here.", "Disclaimer: this is an exercise/tutorial of building a convolutional neural network for image classification from scratch, applied to the hot topic of COVID-19 diagnosis. We do not make any conclusions regarding the current situation. The only conclusions that we make are how good our model is in the scope of available data.", "To start with, it\u2019s good to get an idea of how easy it\u2019s to differentiate two classes \u2014 this can give us some estimation of Bayes classifier error rate. As per this source, human-level precision can be estimated as 0.97 (found virus cases) and recall as 0.7 (out of 100 negatively diagnosed people 30 are actually infected). Additionally, in the dataset description, there is a link to the repository with a model with a 0.85 F1 score.", "As we are designing this model, we should take into account all seriousness of missing a COVID-19 case. Therefore, we should pay close attention to recall metric and type II errors. To say simpler, it is better to say \u201csorry, you are actually healthy\u201d when our model predicts false positive than to let infected person carry on as usual.", "We have 349 positive samples and 397 negatives. Luckily, this dataset is not skewed toward any of the classes. All images are of different shapes, which implies the necessity of reshaping. Since we have a small dataset, we will be using a validation set as a test set. However, we won\u2019t be setting seed, which will allow us to have a different subset of data each time we rerun the notebook and therefore it will give a more robust evaluation of performance together with saving data for training. In this case, firstly hyperparameters will be tuned on the validation set, but after that we resplit data, retrain the model on a newly split train and evaluate on unseen (in this run) validation set. In such a way our validation set will not formally be a test set, because our model has somehow (in a minor way) been exposed to it beforehand in a different run. But probably that\u2019s best what we can do with such amount of data.", "Let\u2019s start with defining hyperparameters, which we will tune later:", "Our images are stored in two folders, one for each class. We will be processing data in chunks of 64 images and we will be reshaping our images into dimensions of 248x248px, as all of them have different shapes. We will use Adam optimizer with a learning rate of 0.01. The number of epochs will be changed during our experiments.", "Firstly, we will need to build a way of feeding the data into the model. To do so, we will use the following generator. Since we don\u2019t have separate folders for training and for validation, we will let Keras handle this:", "Now, let\u2019s define and fit some basic model \u2014 three convolutional layers, each followed by max-pooling, with dense layers after them for generating the diagnosis. As it\u2019s a binary classification problem, we will use sigmoid as the activation function for the output.", "We can see that even the basic model has reached quite good performance in only a few epochs. However, in such an important area as healthcare, this performance is definitely not enough. Additionally, since we don\u2019t have a test set, we want to have a robust model that would give close performance after each rerun \u2014 otherwise, we can assume overfit to the validation set.", "We can see overfitting is happening very soon \u2014 after epoch 5. To overcome it, let\u2019s add some data augmentation (you can learn more about what each parameter does here):", "Using even slight data augmentation may significantly increase model generalizability!", "Initially, we had 598 images for training and 148 images for validation. After introducing data augmentation we now have a formally infinite number of samples (since each image can be infinitely augmented, e.g. rotated for 1,2,3 degrees), but what we are actually interested here is to get a more robust model that would be able to make correct diagnosis despite an image being slightly rotated or shifted.", "Unfortunately, we have not got significant improvement, our model still overfits after 10\u201315 epochs \u2014 we can see that train loss is starting to decrease, while validation loss is starting to increase. Another problem is that since our validation loss is low from the start, we can assume that we simply got nice initial parameters and so, our model is not robust (remember that since we don\u2019t have a test set, we want to re-evaluate our model with new split). If we check the model summary, we will see that our model has 4,987,361 parameters \u2014 a huge number for such a small dataset. Let\u2019s try to reduce them by adding more convolutional layers with max-pooling (we will also add several dense layers to see whether this improves performance):", "Now our model has 671,185 parameters, significantly smaller numbers.", "However, if we try to train our model, we will see next. Our model started to be too \u201cpessimistic\u201d and is predicting COVID for all patients. It appears that we made our model too simple.", "Let\u2019s reduce the structure to the following:", "This model has 2,010,513 parameters \u2014 several times more than \u201cnot complex enough\u201d model, but several times less than \u201ctoo complex\u201d model. It is therefore computationally cheaper and easier for the model to be trained.", "Now we start seeing quite good results. During training, the model is going through \u201cpredict positive for everyone\u201d stage, but overcomes it and gets back to proper predicting. It still starts to overfit after around 40 epochs (and we see the same picture with every resplit of our data), so, we will let our model train for 40 epochs and evaluate it after.", "Note the gap between validation and train set metrics \u2014 this is normal and is happening because we are not applying dropout during prediction, which gives model full potential.", "We observe that model is not overfitting, as validation loss is better than training. However, if we add additional neurons, layers, or filters, the model will start performing badly, therefore we can make a conclusion that we don\u2019t have a removable bias in the model.", "We can generate the final report with the next script:", "Since we are not setting seed, performance may slightly vary, but accuracy is in a range between 70\u201380%. Our model is far from being perfect \u2014 it tends to have False Negatives problem (which is opposite of acceptable error \u2014 False Positive, as we defined at the start).", "Such a model can be used as a helper for pre-diagnosis and prioritizing patients. We should remember that our model is giving both false positives and false negatives, therefore we should not base our decisions on it only. We can, however, prioritize conducting doctor investigation for the patient for whom model predicted the virus.", "We were able to achieve quite good results by training model from scratch. The generalizability of the model is limited since the train set size is only around 600 images. Additionally, it is possible to include images of other pneumonia-like illnesses and see if it is possible to build a model that would distinguish them correctly. It may be that this task would be significantly harder and we would need to go with just two classes \u2014 healthy person and coronavirus/other illness, as differentiating of pneumonia/coronavirus may be incredibly hard from just CT scans.", "How to make a better model \u2014 we can take a pre-trained model (or pre-train it by ourselves) that is capable of diagnosing similar illnesses and apply transfer learning with the COVID-19 dataset. As per the expertise of several doctors, who I have contacted, CT lungs scans of a person with pneumonia can be quite close to CT scans of a person with coronavirus, so, such data/model can be used. We can also add an auxiliary input, like temperature if such data would be available.", "Full code can be found here. Dataset can be found here.", "Stay safe and thanks for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Graduate Computational Data Science Student at Carnegie Mellon University."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4294e29b72b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4294e29b72b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ih.markevych?source=post_page-----4294e29b72b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ih.markevych?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Ihor Markevych"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57ce781f98fc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&user=Ihor+Markevych&userId=57ce781f98fc&source=post_page-57ce781f98fc----4294e29b72b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/luisblanche/covidct", "anchor_text": "next dataset"}, {"url": "https://www.kaggle.com/dergel/cnn-on-covid-19-ct-lungs-scans", "anchor_text": "here"}, {"url": "https://www.kaggle.com/luisblanche/covidct", "anchor_text": "Kaggle"}, {"url": "https://www.statnews.com/2020/04/16/ct-scans-alternative-to-inaccurate-coronavirus-tests/", "anchor_text": "this source"}, {"url": "https://github.com/UCSD-AI4H/COVID-CT", "anchor_text": "repository"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/Adam", "anchor_text": "Adam optimizer"}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "following generator"}, {"url": "https://fairyonice.github.io/Learn-about-ImageDataGenerator.html", "anchor_text": "here"}, {"url": "https://www.kaggle.com/dergel/cnn-on-covid-19-ct-lungs-scans/", "anchor_text": "here"}, {"url": "https://www.kaggle.com/luisblanche/covidct", "anchor_text": "here"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----4294e29b72b---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----4294e29b72b---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/coronavirus?source=post_page-----4294e29b72b---------------coronavirus-----------------", "anchor_text": "Coronavirus"}, {"url": "https://medium.com/tag/image-classification?source=post_page-----4294e29b72b---------------image_classification-----------------", "anchor_text": "Image Classification"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4294e29b72b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "http://creativecommons.org/licenses/by/4.0/", "anchor_text": "Some rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&user=Ihor+Markevych&userId=57ce781f98fc&source=-----4294e29b72b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&user=Ihor+Markevych&userId=57ce781f98fc&source=-----4294e29b72b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4294e29b72b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4294e29b72b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4294e29b72b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4294e29b72b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4294e29b72b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4294e29b72b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4294e29b72b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ih.markevych?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ih.markevych?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ihor Markevych"}, {"url": "https://medium.com/@ih.markevych/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57ce781f98fc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&user=Ihor+Markevych&userId=57ce781f98fc&source=post_page-57ce781f98fc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F57ce781f98fc%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-a-convolutional-neural-network-diagnose-covid-19-from-lungs-ct-scans-4294e29b72b&user=Ihor+Markevych&userId=57ce781f98fc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}