{"url": "https://towardsdatascience.com/conv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148", "time": 1683006646.6567419, "path": "towardsdatascience.com/conv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148/", "webpage": {"metadata": {"title": "Conv2d: Finally Understand What Happens in the Forward Pass | by \u2b50Axel Thevenot | Towards Data Science", "h1": "Conv2d: Finally Understand What Happens in the Forward Pass", "description": "What is a 2D convolution (Conv2D)? Deep Learning\u2019s libraries and platforms such as Tensorflow, Keras, Pytorch, Caffe or Theano help us with the arguments..."}, "outgoing_paragraph_urls": [{"url": "https://github.com/AxelThevenot/GIF_convolutions", "anchor_text": "scripts pushed on my Github", "paragraph_index": 2}, {"url": "https://axel-thevenot.medium.com/membership", "anchor_text": "one click here", "paragraph_index": 32}, {"url": "https://github.com/AxelThevenot/GIF_convolutions", "anchor_text": "available on this GitHub repository", "paragraph_index": 33}], "all_paragraphs": ["Deep Learning\u2019s libraries and platforms such as Tensorflow, Keras, Pytorch, Caffe or Theano help us in our daily lives so that every day new applications make us think \u201cWow!\u201d. We all have our favorite framework, but what they all have in common is that they make things easy for us with functions that are easy to use that can be configured as needed. But we still need to understand what the arguments available are to take advantage of all the power these frameworks give us.", "In this post, I will try to list all these arguments. This post is for you if you want to see their impact on the computation time, the number of trainable parameters and the size of the convolved output channels.", "All GIFs are made with python. You will be able to test each of these arguments and visualize by yourself their impact with the scripts pushed on my Github (or to make your GIFs).", "The parts of this post will be divided according to the following arguments. These arguments can be found in the Pytorch documentation of the Conv2d module :", "Finally, we will have all the keys to calculate the size of the output channels according to the arguments and the size of the input channels.", "Let me introduce what a kernel is (or convolution matrix). A kernel describes a filter that we are going to pass over an input image. To make it simple, the kernel will move over the whole image, from left to right, from top to bottom by applying a convolution product. The output of this operation is called a filtered image.", "To take a very basic example, let\u2019s imagine a 3 by 3 convolution kernel filtering a 9 by 9 image. Then this kernel moves all over the image to capture in the image all squares of the same size (3 by 3). The convolution product is an element-wise (or point-wise) multiplication. The sum of this result is the resulting pixel on the output (or filtered) image.", "If you are not already familiar with filters and convolution matrices, then I strongly advise you to take a little more time to understand the convolution kernels. They are the core of the 2D convolution layer.", "The trainable parameters, which are also simply called \u201cparameters\u201d, are all the parameters that will be updated when the network is trained. In a Conv2d, the trainable elements are the values that compose the kernels. So for our 3 by 3 convolution kernel, we have 3*3=9 trainable parameters.", "To be more complete. We can include bias or not. The role of bias is to be added to the sum of the convolution product. This bias is also a trainable parameter which makes the number of trainable parameters for our 3 by 3 kernel rise to 10.", "The benefit of using a layer is to be able to perform similar operations at the same time. In other words, if we want to apply 4 different filters of the same size to an input channel, then we will have 4 output channels. These channels are the result of 4 different filters. So resulting from 4 distinct kernels.", "In the previous section, we saw that the trainable parameters are what make up the convolution kernels. So the number of parameters increases linearly with the number of convolution kernels. Hence linearly with the number of desired output channels. Note also that the computing time also varies proportionally with the size of the input channel and proportionally with the number of kernels.", "The same principle applies to the number of input channels. Let\u2019s consider the situation of an RGB encoded image. This image has 3 channels: red, blue and green. We can decide to extract information with filters of the same size on each of these 3 channels to obtain four new channels. The operation is thus 3 times the same, for 4 output channels.", "Each output channel is the sum of the filtered input channels. For 4 output channels and 3 input channels, each output channel is the sum of 3 filtered input channels. In other words, the convolution layer is composed of 4*3=12 convolution kernels.", "As a reminder, the number of parameters and the computation time changes proportionally to the number of output channels. This is because each output channel is linked to kernels distinct from the other channels. The same is true for the number of input channels. The calculation time and the number of parameters grows proportionally.", "So far, all examples have been given with 3 by 3 size kernels. In fact, the choice of its size is entirely up to you. It is possible to create a convolution layer with a core size 1*1 or 19*19.", "But it is also absolutely possible not to have square kernels. It is a possibility to decide to have kernels with different heights and widths. This is often the case in signal image analysis. If we know that we want to scan the image of a signal, of a sound, then we may want to prefer a 5*1 size kernel for example.", "Finally, you will have noticed that all sizes are defined by an odd number. It is just as acceptable to define an even kernel size. In practice, this is rarely done. Usually, an odd size kernel is chosen because there is symmetry around a central pixel.", "Since all the (classical) trainable parameters of a convolution layer are in the kernels, the number of parameters grows linearly with the size of the kernels. The computation time also varies proportionally.", "The kernels, by default, move from left to right, from top to bottom shifting it pixel by pixel. But this shift can also be changed. Often used to downsample the output channel. For example with strides of (1, 3), the filter is shifted from 3 to 3 horizontally and from 1 to 1 vertically. This produces output channels downsampled by 3 horizontally.", "The strides have no impact on the number of parameters but the calculation time, logically, decreases linearly with the strides.", "The padding defines the number of pixels added to the sides of the input channels before their convolution filtering. Usually, the padding pixels are set to zero. The input channel is extended.", "This is very useful when you want the size of the output channels to be equal to the size of the input channels. To make it simple, when the kernel is 3*3 then the output channel size decreases by one on each side. To overcome this problem we can use padding of 1.", "The padding, therefore, has no impact on the number of parameters but generates an additional calculation time proportional to the size of the padding. But generally speaking, the padding is often small enough in comparison to the size of the input channel to consider there is no impact on the computation time.", "The dilation is, in a way, the width of the core. By default equal to 1, it corresponds to the offset between each pixel of the kernel on the input channel during convolution.", "I exaggerated a bit on my GIF, but if we take the example of a dilation of (4, 2) then the receptive field of the kernel on the input channel is widened by 4 * ( 3 -1)=8 vertically and 2 * (3\u20131)=4 horizontally (for a kernel of 3 by 3).", "Just like padding, dilation has no impact on the number of parameters and very limited impact on the calculation time.", "Groups can be very useful in specific cases. For example, if we have several concatenated data sources. When it is not necessary to treat them dependent on each other. Input channels can be grouped and processed independently. Finally, the output channels are concatenated at the end.", "If there are 2 input channels and 4 output channels with 2 groups. Then this is like dividing the input channels into two groups (so 1 input channel in each group) and making it go through a convolution layer with half as many output channels. The output channels are then concatenated.", "It is important to note the number of groups must perfectly divide the number of input channels and the number of output channels (common divisor).", "The number of parameters is therefore divided by the number of groups. Concerning the computation time with Pytorch, the algorithm is optimized for groups and therefore should reduce the computation time. However, it should also be taken into account that must sum up with the calculation time for group formation and concatenation of the output channels.", "With the knowledge of all the arguments, the size of the output channels can be calculated from the size of the input channels.", "Knowledge is all about sharing.Support me and get access of all my articles in one click here.", "All computation time tests were performed with Pytorch, on my GPU (GeForce GTX 960M) and are available on this GitHub repository if you want to run them yourself or perform alternative tests.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1bbaafb0b148&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://axel-thevenot.medium.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": ""}, {"url": "https://axel-thevenot.medium.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "\u2b50Axel Thevenot"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa8fcc1458e87&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&user=%E2%AD%90Axel+Thevenot&userId=a8fcc1458e87&source=post_page-a8fcc1458e87----1bbaafb0b148---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/AxelThevenot/GIF_convolutions", "anchor_text": "scripts pushed on my Github"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/stdtypes.html#tuple", "anchor_text": "tuple"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/stdtypes.html#tuple", "anchor_text": "tuple"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/stdtypes.html#tuple", "anchor_text": "tuple"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/stdtypes.html#tuple", "anchor_text": "tuple"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://docs.python.org/3/library/functions.html#bool", "anchor_text": "bool"}, {"url": "https://axel-thevenot.medium.com/membership", "anchor_text": "one click here"}, {"url": "https://cs.nyu.edu/~yann/talks/lecun-ranzato-icml2013.pdf", "anchor_text": "Deep Learning Tutorial"}, {"url": "https://pytorch.org/docs/stable/nn.html", "anchor_text": "Documentation torch.nn"}, {"url": "https://cs231n.github.io/convolutional-networks/", "anchor_text": "Convolutional Neural Networks"}, {"url": "https://keras.io/layers/convolutional/", "anchor_text": "Convolutional Layers"}, {"url": "https://github.com/AxelThevenot/GIF_convolutions", "anchor_text": "available on this GitHub repository"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----1bbaafb0b148---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1bbaafb0b148---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/visualization?source=post_page-----1bbaafb0b148---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/tag/programming?source=post_page-----1bbaafb0b148---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----1bbaafb0b148---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://creativecommons.org/publicdomain/mark/1.0/", "anchor_text": "Public domain."}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&user=%E2%AD%90Axel+Thevenot&userId=a8fcc1458e87&source=-----1bbaafb0b148---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&user=%E2%AD%90Axel+Thevenot&userId=a8fcc1458e87&source=-----1bbaafb0b148---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1bbaafb0b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1bbaafb0b148---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1bbaafb0b148--------------------------------", "anchor_text": ""}, {"url": "https://axel-thevenot.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://axel-thevenot.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "\u2b50Axel Thevenot"}, {"url": "https://axel-thevenot.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "733 Followers"}, {"url": "http://www.linkedin.com/in/axel-thevenot", "anchor_text": "www.linkedin.com/in/axel-thevenot"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa8fcc1458e87&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&user=%E2%AD%90Axel+Thevenot&userId=a8fcc1458e87&source=post_page-a8fcc1458e87--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbb1ccd160e04&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconv2d-to-finally-understand-what-happens-in-the-forward-pass-1bbaafb0b148&newsletterV3=a8fcc1458e87&newsletterV3Id=bb1ccd160e04&user=%E2%AD%90Axel+Thevenot&userId=a8fcc1458e87&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}