{"url": "https://towardsdatascience.com/how-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc", "time": 1683008920.102037, "path": "towardsdatascience.com/how-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc/", "webpage": {"metadata": {"title": "How to write an advanced trend following strategy to algotrade Bitcoin | by Saleh | Towards Data Science", "h1": "How to write an advanced trend following strategy to algotrade Bitcoin", "description": "Trend following is often the easiest in a matter of both getting started with algo-trading and being profitable. In the previous article, I wrote a trend following strategy and even boosted its\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/how-to-use-multiple-timeframes-in-your-algotrading-strategy-8be026a890e2?source=friends_link&sk=a35c562268ca6c7c6c3d1df1cec1d7d1", "anchor_text": "previous article", "paragraph_index": 0}, {"url": "https://docs.jesse-ai.com/docs/strategies/events.html#on-reduced-position", "anchor_text": "on_reduced_position", "paragraph_index": 15}, {"url": "https://docs.jesse-ai.com/docs/strategies/events.html#on-cancel", "anchor_text": "documentation", "paragraph_index": 17}, {"url": "https://docs.jesse-ai.com/docs/strategies/api.html#is-reduced", "anchor_text": "is_reduced", "paragraph_index": 20}, {"url": "https://docs.jesse-ai.com/docs/strategies/api.html#liquidate", "anchor_text": "liquidate()", "paragraph_index": 20}, {"url": "https://jesse-ai.com/", "anchor_text": "newsletter", "paragraph_index": 33}, {"url": "https://forum.jesse-ai.com/", "anchor_text": "forum", "paragraph_index": 33}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 34}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 34}], "all_paragraphs": ["Trend following is often the easiest in a matter of both getting started with algo-trading and being profitable. In the previous article, I wrote a trend following strategy and even boosted its performance by using a bigger timeframe for determining the trend. But it was a simple enter-at-once and exit-at-once strategy.", "The point of this tutorial is to get you started with a few of Jesse\u2019s features that help you write most of the trend following strategies you\u2019ll find. Few of such features are:", "First I create a new strategy with the make-strategy command:", "And I edit my routes.py file to use this strategy, and I set the timeframe to 4h:", "Then I open the newly created strategy file and it looks like this:", "I want to go long when:", "They say an image is worth a 1000 words, so here\u2019s an image showing what I count as an uptrend in this case:", "And here is what I mean by the current candle touching the 50 EMA (the orange line is the 50 EMA):", "Now let\u2019s write the code for current_candle_touches_long_ema and trend:", "I used three EMA lines to determine the trend direction. I return 1 for an uptrend, and -1 for a downtrend. current_candle_touches_long_ema is pretty simple, I just have to make sure the current candle's high price is bigger than the long_ema line (which is an EMA with the period of 50) and that the current candle's low price is lower than the long_ema line.", "The entry price is going to be the high of the current candle for long trades. The stop-loss price will be 3 times the current ATR away from my entry price.", "In this strategy, I want to enter trades all at once, but exit at two points. I will exit first half of my position at the previous high of the trend. Here is what I mean by the high of the uptrend (the blue line is my target):", "To code this, I first select the high prices of the last 20 candle bars. And then simply return the maximum of them.", "For position sizing, I want to risk 5% of my total capital per each trade. To calculate the qty I use the risk_to_qty utility.", "And of course, the opposite goes for short trades. Here\u2019s the code:", "As you can see, I\u2019m only exiting half of my position size at the take-profit price. In other words, after my position is reduced, I want to move my stop price to break-even. To write the code for it in Jesse, I\u2019ll use the pre builtin on_reduced_position method.", "Updating the self.stop_loss is all I needed to do to tell jesse update my stop-loss order. Jesse automatically picks up on it, cancels the previous stop order, and submits a new one. It couldn't get any easier!", "To learn more about events and see a list of all available event methods in Jesse, make sure to read its documentation.", "For this strategy, I intend to exit the second half of my position in a dynamic situation. The idea behind this situation is to exit when the price is highly overbought and about to take a serious correction. To say it in quant\u2019s language, I want to exit when the RSI indicator reaches above 80.", "First I\u2019ll use the builtin update_position() method to write my logic in. This method gets executed after every new candle only if we have an open position. Hence, it is used to update a position. Which means we don't need to check if the position is open or not.", "The next thing to consider here is that I want to exit only the second half of my position. In other words, I want to liquidate the open position if it has been reduced. The easiest way to check if my position has been reduced is by using the builtin is_reduced property and the liquidate() method.", "My strategy looks good so far, let\u2019s run a backtest and see how it goes:", "After around 4% percent of the backtest I get an error:", "The error is trying to tell us at some point our strategy\u2019s take-profit and entry prices are equal ($3601.6) which isn\u2019t acceptable. This is a tricky issue to debug, but you\u2019ll get good at debugging with Jesse after writing your first few strategies.", "To explain why this issue is happening, we need to take another look at the take-profit and entry:", "The error told us that the entry and the take-profit are the same at some points. This means, at that point, the current candle\u2019s high is the highest of the last 20 bars. Which isn\u2019t the type of trade we had in mind for this strategy.", "We could prevent this from happening with a few dirty if-else statements in our should_long method, or by using a filter which is designed specificity for these kinds of cases.", "A filter is just a function that returns a boolean value. A filter is passed by returning a True value, and vice versa. I define a filter and name it reward_to_risk_filter. The name could be anything, but it is a generally good practice to either start or end the name of a filter method with the word filter. This filter's job is to make sure that the trade we're trying to enter is worth it.", "At this point, Jesse still doesn\u2019t know that reward_to_risk_filter() is a filter. To make it recognize my filter, I need to add it to the filters() method which is a pre builtin method that returns a Python list:", "Now I\u2019m going to add reward_to_risk_filter inside the returning list as a variable. What that means is that no parentheses must be present at the end of it:", "Now let\u2019s execute the backtest one more time:", "The simpler you can keep your strategies, the easier it will be to debug them and even improve them over time.", "Writing strategies with Jesse is as simple as trading your strategies manually. So next time you find a strategy introduced in a trading book, or by a trading guru, just write the code for it, and backtest it.", "To get my future writings and products, make sure to subscribe to Jesse\u2019s newsletter, and also check out the forum to discuss algotrading with quants like you and I.", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I write about algotrading. I do my best to publish practical tutorials."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa38e47443ddc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://salehmir.medium.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": ""}, {"url": "https://salehmir.medium.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Saleh"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F55d415401bbd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&user=Saleh&userId=55d415401bbd&source=post_page-55d415401bbd----a38e47443ddc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://undraw.co/", "anchor_text": "Katerina Limpitsouni"}, {"url": "https://towardsdatascience.com/how-to-use-multiple-timeframes-in-your-algotrading-strategy-8be026a890e2?source=friends_link&sk=a35c562268ca6c7c6c3d1df1cec1d7d1", "anchor_text": "previous article"}, {"url": "https://docs.jesse-ai.com/docs/strategies/events.html#on-reduced-position", "anchor_text": "on_reduced_position"}, {"url": "https://docs.jesse-ai.com/docs/strategies/events.html#on-cancel", "anchor_text": "documentation"}, {"url": "https://docs.jesse-ai.com/docs/strategies/api.html#is-reduced", "anchor_text": "is_reduced"}, {"url": "https://docs.jesse-ai.com/docs/strategies/api.html#liquidate", "anchor_text": "liquidate()"}, {"url": "https://jesse-ai.com/", "anchor_text": "newsletter"}, {"url": "https://forum.jesse-ai.com/", "anchor_text": "forum"}, {"url": "https://jesse-ai.com/blog/tutorials/how-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin", "anchor_text": "https://jesse-ai.com"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/algorithmic-trading?source=post_page-----a38e47443ddc---------------algorithmic_trading-----------------", "anchor_text": "Algorithmic Trading"}, {"url": "https://medium.com/tag/cryptocurrency?source=post_page-----a38e47443ddc---------------cryptocurrency-----------------", "anchor_text": "Cryptocurrency"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a38e47443ddc---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bitcoin?source=post_page-----a38e47443ddc---------------bitcoin-----------------", "anchor_text": "Bitcoin"}, {"url": "https://medium.com/tag/python?source=post_page-----a38e47443ddc---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&user=Saleh&userId=55d415401bbd&source=-----a38e47443ddc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&user=Saleh&userId=55d415401bbd&source=-----a38e47443ddc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa38e47443ddc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a38e47443ddc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a38e47443ddc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a38e47443ddc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a38e47443ddc--------------------------------", "anchor_text": ""}, {"url": "https://salehmir.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://salehmir.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Saleh"}, {"url": "https://salehmir.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "331 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F55d415401bbd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&user=Saleh&userId=55d415401bbd&source=post_page-55d415401bbd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbd5185e70331&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-write-an-advanced-trend-following-strategy-to-algotrade-bitcoin-a38e47443ddc&newsletterV3=55d415401bbd&newsletterV3Id=bd5185e70331&user=Saleh&userId=55d415401bbd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}