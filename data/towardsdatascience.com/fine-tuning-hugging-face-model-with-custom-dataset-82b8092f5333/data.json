{"url": "https://towardsdatascience.com/fine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333", "time": 1683013766.196685, "path": "towardsdatascience.com/fine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333/", "webpage": {"metadata": {"title": "Fine-Tuning Hugging Face Model with Custom Dataset | by Andrej Baranovskij | Towards Data Science", "h1": "Fine-Tuning Hugging Face Model with Custom Dataset", "description": "There are many articles about Hugging Face fine-tuning with your own dataset. Many of the articles are using PyTorch, some are with TensorFlow. I had a task to implement sentiment classification\u2026"}, "outgoing_paragraph_urls": [{"url": "https://huggingface.co/transformers/master/custom_datasets.html", "anchor_text": "Fine-tuning with custom datasets", "paragraph_index": 1}, {"url": "https://huggingface.co/transformers/model_doc/distilbert.html#tfdistilbertforsequenceclassification", "anchor_text": "TFDistilBertForSequenceClassification", "paragraph_index": 2}, {"url": "https://huggingface.co/transformers/model_doc/distilbert.html#", "anchor_text": "DistilBERT", "paragraph_index": 2}, {"url": "https://www.coursera.org/professional-certificates/tensorflow-in-practice", "anchor_text": "Coursera", "paragraph_index": 3}, {"url": "https://github.com/lmoroney/dlaicourse/blob/master/TensorFlow%20In%20Practice/Course%203%20-%20NLP/Course%203%20-%20Week%203%20-%20Lesson%202c.ipynb", "anchor_text": "GitHub", "paragraph_index": 3}], "all_paragraphs": ["There are many articles about Hugging Face fine-tuning with your own dataset. Many of the articles are using PyTorch, some are with TensorFlow. I had a task to implement sentiment classification based on a custom complaints dataset. I decided to go with Hugging Face transformers, as results were not great with LSTM. Despite a large number of available articles, it took me significant time to bring all bits together and implement my own model with Hugging Face trained with TensorFlow. It seems like most, if not all, articles stop when training is explained. I thought it would be useful to share a complete scenario and explain how to save/load the trained model and execute inference. This post is based on Hugging Face API for TensorFlow.", "Your starting point should be Hugging Face documentation. There is a very helpful section \u2014 Fine-tuning with custom datasets. To understand how to fine-tune Hugging Face model with your own data for sentence classification, I would recommend studying code under this section \u2014 Sequence Classification with IMDb Reviews. Hugging Face documentation provides examples for both PyTorch and TensorFlow, which is very convenient.", "I\u2019m using TFDistilBertForSequenceClassification class to run sentence classification. About DistilBERT \u2014 DistilBERT is a small, fast, cheap and light Transformer model trained by distilling Bert base. It has 40% fewer parameters than bert-base-uncased, runs 60% faster while preserving over 95% of Bert\u2019s performances as measured on the GLUE language understanding benchmark.", "An example is based on sarcasm classification using newspaper headlines. Data was prepared by Laurence Moroney, as part of his Coursera training (source code available on GitHub). I\u2019m fetching data directly from Laurence blog:", "Then it goes data processing step, reading data, splitting it into training/validation steps, and extracting an array of labels:", "There are 20000 entries for training and 6709 for validation.", "2. Setup BERT and run training", "Next, we would load the tokenizer:", "Create TensorFlow datasets we can feed to TensorFlow fit function for training. Here we map sentences with labels, there is no need to pass label into fit function separately:", "We need to get a pre-trained Hugging Face model, we are going to fine-tune it with our data:", "Fine-tune the model with our data by calling TensorFlow fit function. It comes out of the box from TFDistilBertForSequenceClassification model. You can play and experiment with parameters, but the selected options are producing quite good results already:", "Save fine-tuned model with Hugging Face save_pretrained function. It does work to save using Keras save function model.save, but such model doesn't load. That\u2019s why I\u2019m using save_pretrained:", "To save a model is the essential step, it takes time to run model fine-tuning and you should save the result when training completes. Another option \u2014 you may run fine-runing on cloud GPU and want to save the model, to run it locally for the inference.", "3. Load saved model and run predict function", "I\u2019m using TFDistilBertForSequenceClassification class to load the saved model, by calling Hugging Face function from_pretrained (point it to the folder, where the model was saved):", "Now we want to run the predict function and classify input using fine-tuned model. To be able to execute inference, we need to tokenize the input sentence the same way as it was done for training/validation data. In order to be able to read inference probabilities, pass return_tensors=\u201dtf\u201d flag into tokenizer. Then call predict using the saved model:", "Predict function running on top of Hugging Face model returns logits (scores before SoftMax). We need to apply SoftMax function to get result probabilities:", "The goal of this post was to show a complete scenario for fine-tuning Hugging Face model with custom data \u2014 from data processing, training to model save/load, and inference execution.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F82b8092f5333&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://andrejusb.medium.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Andrej Baranovskij"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbbd1211c851b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&user=Andrej+Baranovskij&userId=bbd1211c851b&source=post_page-bbd1211c851b----82b8092f5333---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://huggingface.co/transformers/master/custom_datasets.html", "anchor_text": "Fine-tuning with custom datasets"}, {"url": "https://huggingface.co/transformers/model_doc/distilbert.html#tfdistilbertforsequenceclassification", "anchor_text": "TFDistilBertForSequenceClassification"}, {"url": "https://huggingface.co/transformers/model_doc/distilbert.html#", "anchor_text": "DistilBERT"}, {"url": "https://www.coursera.org/professional-certificates/tensorflow-in-practice", "anchor_text": "Coursera"}, {"url": "https://github.com/lmoroney/dlaicourse/blob/master/TensorFlow%20In%20Practice/Course%203%20-%20NLP/Course%203%20-%20Week%203%20-%20Lesson%202c.ipynb", "anchor_text": "GitHub"}, {"url": "https://storage.googleapis.com/laurencemoroney-blog.appspot.com/sarcasm.json", "anchor_text": "https://storage.googleapis.com/laurencemoroney-blog.appspot.com/sarcasm.json"}, {"url": "https://github.com/katanaml/sample-apps/tree/master/02", "anchor_text": "GitHub"}, {"url": "https://colab.research.google.com/drive/1yi9N-ZnQHtYfR3QDiwsPxYCYU6WyjwlQ", "anchor_text": "Colab"}, {"url": "https://medium.com/tag/hugging-face?source=post_page-----82b8092f5333---------------hugging_face-----------------", "anchor_text": "Hugging Face"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----82b8092f5333---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/python?source=post_page-----82b8092f5333---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/nlp?source=post_page-----82b8092f5333---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/programming?source=post_page-----82b8092f5333---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&user=Andrej+Baranovskij&userId=bbd1211c851b&source=-----82b8092f5333---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&user=Andrej+Baranovskij&userId=bbd1211c851b&source=-----82b8092f5333---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F82b8092f5333&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----82b8092f5333---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----82b8092f5333--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----82b8092f5333--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----82b8092f5333--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----82b8092f5333--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----82b8092f5333--------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrej Baranovskij"}, {"url": "https://andrejusb.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://github.com/katanaml", "anchor_text": "https://github.com/katanaml"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbbd1211c851b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&user=Andrej+Baranovskij&userId=bbd1211c851b&source=post_page-bbd1211c851b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd22cc5338107&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-hugging-face-model-with-custom-dataset-82b8092f5333&newsletterV3=bbd1211c851b&newsletterV3Id=d22cc5338107&user=Andrej+Baranovskij&userId=bbd1211c851b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}