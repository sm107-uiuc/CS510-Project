{"url": "https://towardsdatascience.com/intuitively-understanding-variational-autoencoders-1bfe67eb5daf", "time": 1682993223.3864992, "path": "towardsdatascience.com/intuitively-understanding-variational-autoencoders-1bfe67eb5daf/", "webpage": {"metadata": {"title": "Intuitively Understanding Variational Autoencoders | by Irhum Shafkat | Towards Data Science", "h1": "Intuitively Understanding Variational Autoencoders", "description": "In contrast to the more standard uses of neural networks as regressors or classifiers, Variational Autoencoders (VAEs) are powerful generative models, now having applications as diverse as from\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.countbayesie.com/blog/2017/5/9/kullback-leibler-divergence-explained", "anchor_text": "[2]", "paragraph_index": 22}, {"url": "https://stats.stackexchange.com/questions/7440/kl-divergence-between-two-univariate-gaussians", "anchor_text": "[3]", "paragraph_index": 23}, {"url": "https://github.com/yzwxx/vae-celebA", "anchor_text": "[4]", "paragraph_index": 31}, {"url": "https://nips2017creativity.github.io/doc/Hierarchical_Variational_Autoencoders_for_Music.pdf", "anchor_text": "[5]", "paragraph_index": 32}, {"url": "https://twitter.com/irhumshafkat", "anchor_text": "here", "paragraph_index": 34}, {"url": "https://colab.research.google.com/notebook#fileId=/v2/external/notebooks/latent_constraints/latentconstraints.ipynb", "anchor_text": "Latent Constraints: Conditional Generation from Unconditional Generative Models", "paragraph_index": 35}, {"url": "https://stats.stackexchange.com/questions/7440/kl-divergence-between-two-univariate-gaussians", "anchor_text": "KL divergence between two univariate Gaussians", "paragraph_index": 36}], "all_paragraphs": ["In contrast to the more standard uses of neural networks as regressors or classifiers, Variational Autoencoders (VAEs) are powerful generative models, now having applications as diverse as from generating fake human faces, to producing purely synthetic music.", "This post will explore what a VAE is, the intuition behind why it works so well, and its uses as a powerful generative tool for all kinds of media.", "When using generative models, you could simply want to generate a random, new output, that looks similar to the training data, and you can certainly do that too with VAEs. But more often, you\u2019d like to alter, or explore variations on data you already have, and not just in a random way either, but in a desired, specific direction. This is where VAEs work better than any other method currently available.", "An autoencoder network is actually a pair of two connected networks, an encoder and a decoder. An encoder network takes in an input, and converts it into a smaller, dense representation, which the decoder network can use to convert it back to the original input.", "If you\u2019re unfamiliar with encoder networks, but familiar with Convolutional Neural Networks (CNNs), chances are, you already know what an encoder does.", "The convolutional layers of any CNN take in a large image (eg. rank 3 tensor of size 299x299x3), and convert it to a much more compact, dense representation (eg. rank 1 tensor of size 1000). This dense representation is then used by the fully connected classifier network to classify the image.", "The encoder is similar, it is simply is a network that takes in an input and produces a much smaller representation (the encoding), that contains enough information for the next part of the network to process it into the desired output format. Typically, the encoder is trained together with the other parts of the network, optimized via back-propagation, to produce encodings specifically useful for the task at hand. In CNNs, the 1000-dimensional encodings produced are such that they\u2019re specifically useful for classification.", "Autoencoders take this idea, and slightly flip it on its head, by making the encoder generate encodings specifically useful for reconstructing its own input.", "The entire network is usually trained as a whole. The loss function is usually either the mean-squared error or cross-entropy between the output and the input, known as the reconstruction loss, which penalizes the network for creating outputs different from the input.", "As the encoding (which is simply the output of the hidden layer in the middle) has far less units than the input, the encoder must choose to discard information. The encoder learns to preserve as much of the relevant information as possible in the limited encoding, and intelligently discard irrelevant parts. The decoder learns to take the encoding and properly reconstruct it into a full image. Together, they form an autoencoder.", "Standard autoencoders learn to generate compact representations and reconstruct their inputs well, but asides from a few applications like denoising autoencoders, they are fairly limited.", "The fundamental problem with autoencoders, for generation, is that the latent space they convert their inputs to and where their encoded vectors lie, may not be continuous, or allow easy interpolation.", "For example, training an autoencoder on the MNIST dataset, and visualizing the encodings from a 2D latent space reveals the formation of distinct clusters. This makes sense, as distinct encodings for each image type makes it far easier for the decoder to decode them. This is fine if you\u2019re just replicating the same images.", "But when you\u2019re building a generative model, you don\u2019t want to prepare to replicate the same image you put in. You want to randomly sample from the latent space, or generate variations on an input image, from a continuous latent space.", "If the space has discontinuities (eg. gaps between clusters) and you sample/generate a variation from there, the decoder will simply generate an unrealistic output, because the decoder has no idea how to deal with that region of the latent space. During training, it never saw encoded vectors coming from that region of latent space.", "Variational Autoencoders (VAEs) have one fundamentally unique property that separates them from vanilla autoencoders, and it is this property that makes them so useful for generative modeling: their latent spaces are, by design, continuous, allowing easy random sampling and interpolation.", "It achieves this by doing something that seems rather surprising at first: making its encoder not output an encoding vector of size n, rather, outputting two vectors of size n: a vector of means, \u03bc, and another vector of standard deviations, \u03c3.", "They form the parameters of a vector of random variables of length n, with the i th element of \u03bc and \u03c3 being the mean and standard deviation of the i th random variable, X i, from which we sample, to obtain the sampled encoding which we pass onward to the decoder:", "This stochastic generation means, that even for the same input, while the mean and standard deviations remain the same, the actual encoding will somewhat vary on every single pass simply due to sampling.", "Intuitively, the mean vector controls where the encoding of an input should be centered around, while the standard deviation controls the \u201carea\u201d, how much from the mean the encoding can vary. As encodings are generated at random from anywhere inside the \u201ccircle\u201d (the distribution), the decoder learns that not only is a single point in latent space referring to a sample of that class, but all nearby points refer to the same as well. This allows the decoder to not just decode single, specific encodings in the latent space (leaving the decodable latent space discontinuous), but ones that slightly vary too, as the decoder is exposed to a range of variations of the encoding of the same input during training. In code:", "The model is now exposed to a certain degree of local variation by varying the encoding of one sample, resulting in smooth latent spaces on a local scale, that is, for similar samples. Ideally, we want overlap between samples that are not very similar too, in order to interpolate between classes. However, since there are no limits on what values vectors \u03bc and \u03c3 can take on, the encoder can learn to generate very different \u03bc for different classes, clustering them apart, and minimize \u03c3, making sure the encodings themselves don\u2019t vary much for the same sample (that is, less uncertainty for the decoder). This allows the decoder to efficiently reconstruct the training data.", "What we ideally want are encodings, all of which are as close as possible to each other while still being distinct, allowing smooth interpolation, and enabling the construction of new samples.", "In order to force this, we introduce the Kullback\u2013Leibler divergence (KL divergence[2]) into the loss function. The KL divergence between two probability distributions simply measures how much they diverge from each other. Minimizing the KL divergence here means optimizing the probability distribution parameters (\u03bc and \u03c3) to closely resemble that of the target distribution.", "For VAEs, the KL loss is equivalent to the sum of all the KL divergences between the component Xi~N(\u03bci, \u03c3i\u00b2) in X, and the standard normal[3]. It\u2019s minimized when \u03bci = 0, \u03c3i = 1.", "Intuitively, this loss encourages the encoder to distribute all encodings (for all types of inputs, eg. all MNIST numbers), evenly around the center of the latent space. If it tries to \u201ccheat\u201d by clustering them apart into specific regions, away from the origin, it will be penalized.", "Now, using purely KL loss results in a latent space results in encodings densely placed randomly, near the center of the latent space, with little regard for similarity among nearby encodings. The decoder finds it impossible to decode anything meaningful from this space, simply because there really isn\u2019t any meaning.", "Optimizing the two together, however, results in the generation of a latent space which maintains the similarity of nearby encodings on the local scale via clustering, yet globally, is very densely packed near the latent space origin (compare the axes with the original).", "Intuitively, this is the equilibrium reached by the cluster-forming nature of the reconstruction loss, and the dense packing nature of the KL loss, forming distinct clusters the decoder can decode. This is great, as it means when randomly generating, if you sample a vector from the same prior distribution of the encoded vectors, N(0, I), the decoder will successfully decode it. And if you\u2019re interpolating, there are no sudden gaps between clusters, but a smooth mix of features a decoder can understand.", "So how do we actually produce these smooth interpolations we speak of? From here on out, it\u2019s simple vector arithmetic in the latent space.", "For example, if you wish to generate a new sample halfway between two samples, just find the difference between their mean (\u03bc) vectors, and add half the difference to the original, and then simply decode it.", "What about generating specific features, such as generating glasses on a face? Find two samples, one with glasses, one without, obtain their encoded vectors from the encoder, and save the difference. Add this new \u201cglasses\u201d vector to any other face image, and decode it.", "There are plenty of further improvements that can be made over the variational autoencoder. You could indeed, replace the standard fully-connected dense encoder-decoder with a convolutional-deconvolutional encoder-decoder pair, such as this project[4], to produce great synthetic human face photos.", "You could even train an autoencoder using LSTM encoder-decoder pairs (using a modified version of the seq2seq architecture) for sequential, discrete data (something not possible with methods such as GANs), to produce synthetic text, or even interpolate between MIDI samples such as Google Brain\u2019s Magenta\u2019s MusicVAE[5]:", "VAEs work with remarkably diverse types of data, sequential or non-sequential, continuous or discrete, even labelled or completely unlabelled, making them highly powerful generative tools. I hope you now understand how VAEs work, and that you will be able to use them on your own generative endeavors as well.", "If you found this article useful and believe others would too, leave a clap! If you\u2019d like to stay connected, you\u2019ll find me on Twitter here.", "[1]Latent Constraints: Conditional Generation from Unconditional Generative Models", "[3]KL divergence between two univariate Gaussians", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Curious programmer, tinkers around in Python and deep learning."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1bfe67eb5daf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@irhumshafkat?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@irhumshafkat?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Irhum Shafkat"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcb2327c63f48&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&user=Irhum+Shafkat&userId=cb2327c63f48&source=post_page-cb2327c63f48----1bfe67eb5daf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://colab.research.google.com/notebook#fileId=/v2/external/notebooks/latent_constraints/latentconstraints.ipynb", "anchor_text": "[1]"}, {"url": "https://commons.wikimedia.org/wiki/File:Typical_cnn.png", "anchor_text": "[a]"}, {"url": "https://www.countbayesie.com/blog/2017/5/9/kullback-leibler-divergence-explained", "anchor_text": "[2]"}, {"url": "https://stats.stackexchange.com/questions/7440/kl-divergence-between-two-univariate-gaussians", "anchor_text": "[3]"}, {"url": "https://github.com/yzwxx/vae-celebA", "anchor_text": "[4]"}, {"url": "https://nips2017creativity.github.io/doc/Hierarchical_Variational_Autoencoders_for_Music.pdf", "anchor_text": "[5]"}, {"url": "https://twitter.com/irhumshafkat", "anchor_text": "here"}, {"url": "https://colab.research.google.com/notebook#fileId=/v2/external/notebooks/latent_constraints/latentconstraints.ipynb", "anchor_text": "Latent Constraints: Conditional Generation from Unconditional Generative Models"}, {"url": "https://www.countbayesie.com/blog/2017/5/9/kullback-leibler-divergence-explained", "anchor_text": "Kullback-Leibler Divergence Explained"}, {"url": "https://stats.stackexchange.com/questions/7440/kl-divergence-between-two-univariate-gaussians", "anchor_text": "KL divergence between two univariate Gaussians"}, {"url": "https://github.com/yzwxx/vae-celebA", "anchor_text": "Deep Feature Consistent Variational Autoencoder"}, {"url": "https://nips2017creativity.github.io/doc/Hierarchical_Variational_Autoencoders_for_Music.pdf", "anchor_text": "Hierarchical Variational Autoencoders for Music"}, {"url": "https://www.jeremyjordan.me/variational-autoencoders/", "anchor_text": "Variational Autoencoders"}, {"url": "https://jaan.io/what-is-variational-autoencoder-vae-tutorial/", "anchor_text": "Tutorial \u2014 What is a variational autoencoder?"}, {"url": "https://arxiv.org/pdf/1606.05908.pdf", "anchor_text": "Tutorial on Variational Autoencoders"}, {"url": "https://blog.keras.io/building-autoencoders-in-keras.html", "anchor_text": "Building Autoencoders in Keras"}, {"url": "https://github.com/keras-team/keras/blob/master/examples/variational_autoencoder_deconv.py", "anchor_text": "Convolutional-deconvolutional autoencoder in Keras"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1bfe67eb5daf---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----1bfe67eb5daf---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----1bfe67eb5daf---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/art?source=post_page-----1bfe67eb5daf---------------art-----------------", "anchor_text": "Art"}, {"url": "https://medium.com/tag/design?source=post_page-----1bfe67eb5daf---------------design-----------------", "anchor_text": "Design"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&user=Irhum+Shafkat&userId=cb2327c63f48&source=-----1bfe67eb5daf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&user=Irhum+Shafkat&userId=cb2327c63f48&source=-----1bfe67eb5daf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1bfe67eb5daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1bfe67eb5daf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1bfe67eb5daf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@irhumshafkat?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@irhumshafkat?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Irhum Shafkat"}, {"url": "https://medium.com/@irhumshafkat/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.98K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcb2327c63f48&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&user=Irhum+Shafkat&userId=cb2327c63f48&source=post_page-cb2327c63f48--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd747d0ac846d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintuitively-understanding-variational-autoencoders-1bfe67eb5daf&newsletterV3=cb2327c63f48&newsletterV3Id=d747d0ac846d&user=Irhum+Shafkat&userId=cb2327c63f48&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}