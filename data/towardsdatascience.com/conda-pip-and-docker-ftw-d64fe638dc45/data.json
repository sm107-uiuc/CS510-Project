{"url": "https://towardsdatascience.com/conda-pip-and-docker-ftw-d64fe638dc45", "time": 1683006550.6169012, "path": "towardsdatascience.com/conda-pip-and-docker-ftw-d64fe638dc45/", "webpage": {"metadata": {"title": "Conda (+pip) and Docker FTW! | Towards Data Science", "h1": "Conda (+ pip) and Docker FTW!", "description": "Already using Conda (+pip) to solve your data science package and environment management problems? This post will show you how to level-up your data science project management workflow using Docker."}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@davidrpugh/managing-project-specific-environments-with-conda-b8b50aa8be0e", "anchor_text": "Getting started with Conda", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-406365a539ab", "anchor_text": "Managing project-specific environments with Conda", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/learn-enough-docker-to-be-useful-b7ba70caeb4b", "anchor_text": "series of articles", "paragraph_index": 1}, {"url": "https://medium.com/u/451599b1142a?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Jeff Hale", "paragraph_index": 1}, {"url": "https://www.docker.com/", "anchor_text": "Docker", "paragraph_index": 2}, {"url": "https://github.com/kaust-vislab/python-data-science-project", "anchor_text": "Python data science project template", "paragraph_index": 6}, {"url": "http://releases.ubuntu.com/16.04/", "anchor_text": "Ubuntu 16.04", "paragraph_index": 7}, {"url": "https://docs.docker.com/engine/reference/builder/#shell", "anchor_text": "SHELL", "paragraph_index": 8}, {"url": "https://snyk.io/blog/10-docker-image-security-best-practices/", "anchor_text": "Docker security \u201cbest practice\u201d", "paragraph_index": 10}, {"url": "https://en.wikipedia.org/wiki/Muhammad_ibn_Musa_al-Khwarizmi", "anchor_text": "al-khawarizmi", "paragraph_index": 10}, {"url": "https://docs.docker.com/docker-hub/builds/", "anchor_text": "automated builds", "paragraph_index": 12}, {"url": "https://docs.conda.io/en/latest/miniconda.html", "anchor_text": "Miniconda", "paragraph_index": 13}, {"url": "https://docs.docker.com/engine/reference/builder/#entrypoint", "anchor_text": "ENTRYPOINT", "paragraph_index": 16}, {"url": "https://docs.docker.com/engine/reference/builder/#cmd", "anchor_text": "CMD", "paragraph_index": 18}, {"url": "https://jupyterlab.readthedocs.io/en/stable/", "anchor_text": "JupyerLab", "paragraph_index": 18}, {"url": "https://docs.docker.com/compose/", "anchor_text": "Docker Compose", "paragraph_index": 21}, {"url": "https://docs.docker.com/compose/environment-variables/#the-env-file", "anchor_text": "variable substitution", "paragraph_index": 22}, {"url": "https://repo2docker.readthedocs.io/en/latest/", "anchor_text": "jupyter-repo2docker", "paragraph_index": 28}], "all_paragraphs": ["As this post focuses on incorporating Docker into an existing Conda (+ pip) workflow, I assume that you are already using Conda (+ pip) to manage environments for your data science projects. If you are unfamiliar with the basics of Conda or are not already using Conda to manage project-specific environments, then I suggest you check out my recent articles Getting started with Conda and Managing project-specific environments with Conda.", "I also assume that you have an understanding of the basics ideas behind Docker. If not then I recommend you take a look at this excellent series of articles covering the basics of Docker by Jeff Hale", "While Conda (+ pip) solves most of my day-to-day data science environment and package management issues, incorporating Docker into my Conda (+ pip) development workflow has made it much easier to port my data science workflows from my laptop/workstation to remote cloud computing resources. Incorporating Docker into my development workflow has also made my work more reproducible by removing non-obvious OS-level dependencies (particularly when moving from local laptops/workstations running Mac OSX and Windows to remote servers running Linux).", "However, getting Conda (+ pip) to work as expected inside Docker containers turned out to be much more challenging than I anticipated. Most of the difficulties I encountered involved getting the environment to activate properly inside the image so that the UX when using Conda (+ pip) inside a container was identical to the UX when using Conda (+ pip) outside a container.", "All these difficulties could be solved by getting the Dockerfile \u201cjust right\u201d. In the next section I will walk you step-by-step through the Dockerfile that I developed.", "The trick to getting Conda (+ pip) and Docker to work smoothly together is to write a good Dockerfile. In this section I will take you step by step through the various pieces of the Dockerfile that I developed. Hopefully you can use this Dockerfile without modification on you next data science project.", "From here onwards, I assume that you have organized your project directory similar to my Python data science project template. In particular, I will assume that you store all Docker related files, in particular, the Dockerfile inside a docker sub-directory within your project root directory.", "Every Dockefile has a base or parent image. For the parent image I use Ubuntu 16.04 which is one of the most commonly used flavor of Linux in the data science community (and also happens to be the same OS installed on my workstation).", "The default shell used to run Dockerfile commands when building Docker images is /bin/sh. Unfortunately /bin/sh is currently not one of the shells supported by the conda init command. Fortunately it is possible to change the default shell used to run Dockerfile commands using the SHELL instruction.", "Note the use of the --login flag which ensures that both ~/.profile and ~/.bashrc are sourced properly. Properly sourcing both ~/.profile and ~/.bashrc is necessary in order to use various conda commands to build the Conda environment inside the Docker image.", "It is a Docker security \u201cbest practice\u201d to create a non-root user inside your Docker images. My preferred approach to creating a non-root user uses build arguments to customize the username, uid, and gid of the non-root user. I use standard defaults for the uid and gid; the default username is set to al-khawarizmi (in honor of the famous Persian polymath whose name is on the building where I work)", "After creating the non-root user I copy over all of the config files that I will need to create the Conda environment (i.e., environment.yml, requirements.txt, postBuild). I also copy over a Bash script that I will use as the Docker ENTRYPOINT (more on this below).", "Newer versions of Docker support copying files as a non-root user, however the version of Docker available on DockerHub does not yet support copying as a non-root user so if you want to set up automated builds for your Git repositories you will need to copy everything as root.", "After copying over the config files as root, I switch over to the non-root user and install Miniconda.", "Next I create a project directory inside the non-root user home directory. The Conda environment will be created in a env sub-directory inside the project directory and all other project files and directories can then be mounted into this directory.", "Now I am ready to build the Conda environment. Note that I can use nearly the same sequence of conda commands that I would use to build a Conda environment for a project on my laptop or workstation.", "Almost finished! Second to last step is to use an ENTRYPOINT script to ensure that the Conda environment is properly activated at runtime.", "Here is the /usr/local/bin/entrypoint.sh script for reference.", "Finally, I use the CMD instruction to specify a default command to run when a Docker container is launched. Since I install JupyerLab in all of my Conda environments I tend to launch a JupyterLab server by default when executing containers.", "The following command (which should be run from within the docker sub-directory containing the Dockefile) builds a new image for your project with a custom $USER (and associated $UID and $GID) as well as a particular $IMAGE_NAME and $IMAGE_TAG. This command should be run within the docker sub-directory of the project as the Docker build context is set to ../ which should be the project root directory.", "Once the image is built, the following command will run a container based on the image $IMAGE_NAME:$IMAGE_TAG. This command should be run from within the project's root directory.", "It is quite easy to make typos whilst writing the above docker commands by hand. A less error-prone approach is to use Docker Compose. The above docker commands can be encapsulated into the docker-compose.yml configuration file as follows.", "The above docker-compose.yml file relies on variable substitution. to obtain the values for $USER, $UID, and $GID. These values can be stored in an a file called .env as follows.", "You can test your docker-compose.yml file by running the following command in the docker sub-directory of the project.", "This command takes the docker-compose.yml file and substitutes the values provided in the .env file and then returns the result.", "Once you are confident that values in the .env file are being substituted properly into the docker-compose.yml file, the following command can be used to bring up a container based on your project's Docker image and launch the JupyterLab server. This command should also be run from within the docker sub-directory of the project.", "When you are done developing and have shut down the JupyterLab server, the following command tears down the networking infrastructure for the running container.", "In this post, I walked through a Dockerfile that injects a Conda (+ pip) environment into a Docker image. I also detailed how to build the resulting image and launch containers using Docker Compose.", "If you are looking for a production-quality solution that generalizes the approach outlined above, then I would encourage you to check out jupyter-repo2docker.", "jupyter-repo2docker is a tool to build, run, and push Docker images from source code repositories. repo2docker fetches a repository (from GitHub, GitLab, Zenodo, Figshare, Dataverse installations, a Git repository or a local directory) and builds a container image in which the code can be executed. The image build process is based on the configuration files found in the repository.", "The Conda (+ pip) and Docker combination has significantly increased my data science development velocity while at the same time increasing the portability and reproducibility of my data science workflows.", "Hopefully this post can help you combine these three great tools together on your next data science project!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Staff Scientist, KAUST; Certified Instructor, Software Carpentry; Associate, INET, University of Oxford."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd64fe638dc45&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://davidrpugh.medium.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "David R. Pugh"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69235b698a4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&user=David+R.+Pugh&userId=69235b698a4b&source=post_page-69235b698a4b----d64fe638dc45---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.anaconda.com/", "anchor_text": "Source"}, {"url": "https://medium.com/@davidrpugh/managing-project-specific-environments-with-conda-b8b50aa8be0e", "anchor_text": "Getting started with Conda"}, {"url": "https://towardsdatascience.com/managing-project-specific-environments-with-conda-406365a539ab", "anchor_text": "Managing project-specific environments with Conda"}, {"url": "https://towardsdatascience.com/learn-enough-docker-to-be-useful-b7ba70caeb4b", "anchor_text": "series of articles"}, {"url": "https://medium.com/u/451599b1142a?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Jeff Hale"}, {"url": "https://www.docker.com/", "anchor_text": "Docker"}, {"url": "https://github.com/kaust-vislab/python-data-science-project", "anchor_text": "Python data science project template"}, {"url": "http://releases.ubuntu.com/16.04/", "anchor_text": "Ubuntu 16.04"}, {"url": "https://docs.docker.com/engine/reference/builder/#shell", "anchor_text": "SHELL"}, {"url": "https://snyk.io/blog/10-docker-image-security-best-practices/", "anchor_text": "Docker security \u201cbest practice\u201d"}, {"url": "https://en.wikipedia.org/wiki/Muhammad_ibn_Musa_al-Khwarizmi", "anchor_text": "al-khawarizmi"}, {"url": "https://docs.docker.com/docker-hub/builds/", "anchor_text": "automated builds"}, {"url": "https://docs.conda.io/en/latest/miniconda.html", "anchor_text": "Miniconda"}, {"url": "https://docs.docker.com/engine/reference/builder/#entrypoint", "anchor_text": "ENTRYPOINT"}, {"url": "https://docs.docker.com/engine/reference/builder/#cmd", "anchor_text": "CMD"}, {"url": "https://jupyterlab.readthedocs.io/en/stable/", "anchor_text": "JupyerLab"}, {"url": "https://docs.docker.com/compose/", "anchor_text": "Docker Compose"}, {"url": "https://docs.docker.com/compose/environment-variables/#the-env-file", "anchor_text": "variable substitution"}, {"url": "https://repo2docker.readthedocs.io/en/latest/", "anchor_text": "jupyter-repo2docker"}, {"url": "https://medium.com/tag/conda?source=post_page-----d64fe638dc45---------------conda-----------------", "anchor_text": "Conda"}, {"url": "https://medium.com/tag/docker?source=post_page-----d64fe638dc45---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d64fe638dc45---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/docker-compose?source=post_page-----d64fe638dc45---------------docker_compose-----------------", "anchor_text": "Docker Compose"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----d64fe638dc45---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&user=David+R.+Pugh&userId=69235b698a4b&source=-----d64fe638dc45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&user=David+R.+Pugh&userId=69235b698a4b&source=-----d64fe638dc45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd64fe638dc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d64fe638dc45---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d64fe638dc45--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d64fe638dc45--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d64fe638dc45--------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://davidrpugh.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David R. Pugh"}, {"url": "https://davidrpugh.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "197 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69235b698a4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&user=David+R.+Pugh&userId=69235b698a4b&source=post_page-69235b698a4b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa553329a5b76&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconda-pip-and-docker-ftw-d64fe638dc45&newsletterV3=69235b698a4b&newsletterV3Id=a553329a5b76&user=David+R.+Pugh&userId=69235b698a4b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}