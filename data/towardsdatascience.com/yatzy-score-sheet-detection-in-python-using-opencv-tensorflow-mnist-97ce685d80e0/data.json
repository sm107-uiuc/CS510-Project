{"url": "https://towardsdatascience.com/yatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0", "time": 1683004652.222296, "path": "towardsdatascience.com/yatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0/", "webpage": {"metadata": {"title": "Yatzy score sheet detection in Python using OpenCV, TensorFlow, MNIST | by Oskar Ankarberg | Towards Data Science", "h1": "Yatzy score sheet detection in Python using OpenCV, TensorFlow, MNIST", "description": "Ever since I started playing Yatzy (for real, a small addiction) a couple of years ago, I\u2019ve wished we had the opportunity to play yatzy without the need of a physical score sheet. I found some apps\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Machine_learning", "anchor_text": "Machine Learning", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets#Test_dataset", "anchor_text": "test", "paragraph_index": 0}, {"url": "https://docs.opencv.org/3.4/d4/d73/tutorial_py_contours_begin.html", "anchor_text": "contours", "paragraph_index": 1}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow", "paragraph_index": 1}, {"url": "https://docs.opencv.org/3.4/d4/d73/tutorial_py_contours_begin.html", "anchor_text": "contour", "paragraph_index": 3}, {"url": "https://docs.opencv.org/3.4/d3/dc0/group__imgproc__shape.html#ga3d476a3417130ae5154aea421ca7ead9", "anchor_text": "minimum area that can be represented by a rectangle", "paragraph_index": 4}, {"url": "http://homepages.inf.ed.ac.uk/rbf/HIPR2/morops.htm", "anchor_text": "morphology", "paragraph_index": 6}, {"url": "https://github.com/oankarberg/yatzy-score-sheet-detection", "anchor_text": "here", "paragraph_index": 10}, {"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST", "paragraph_index": 11}, {"url": "https://i.stack.imgur.com/pA7uy.png", "anchor_text": "anti-aliasing", "paragraph_index": 12}, {"url": "http://cs231n.github.io/convolutional-networks/", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://apps.apple.com/se/app/yatzy-score-sheets/id1462576084", "anchor_text": "Yatzy Score Sheets", "paragraph_index": 20}, {"url": "https://github.com/oankarberg/yatzy-score-sheet-detection", "anchor_text": "this Github repo", "paragraph_index": 21}], "all_paragraphs": ["Ever since I started playing Yatzy (for real, a small addiction) a couple of years ago, I\u2019ve wished we had the opportunity to play yatzy without the need of a physical score sheet. I found some apps but none that were working any good nor fun to use really. After releasing a simple yatzy score tracking app, my engineering mind started playing with the thought of scanning a yatzy score sheet. I realised it might be a good task within reasonable scale for a deployed Computer Vision task. It would also include Machine Learning where you have to consider more things than just getting the best accuracy on a test set. You would have to deploy your model, have your production data to conform with the model and so on. In this post I will go through the steps from the project that involves identifying the yatzy score sheet from an RGB image and classifying digits from handwritten input. The code is written in Python using OpenCV and TensorFlow.", "One (brute force) approach to this classification/detection task would be to pass all our contours to a TensorFlow CNN model for prediction, and train it to be able separate noise from handwritten digits. However, it would mean that we would potentially have to pass a lot of noise for preprocessing and prediction to our model. This is not a trivial task for our model since we don\u2019t know anything about how big these digits should be in terms of relation to the image. Nor would we know what yatzy cell (point) these contours belong to? That is why we start with identifying the yatzy sheet, and \u201csubtract\u201d the grid in order to ensure we only (hopefully) send digits to the classifier. In order to identify the yatzy sheet, we need to define the rules for what defines a yatzy sheet. The rules I used for a regular sheet:", "The steps to identify the grid:", "2. Identify the biggest contour (connected points with similar intensities)", "3. Apply rotation on the image contour based on minimum area that can be represented by a rectangle.", "Code for step 2 and 3", "4. Do morphology operations on the binary image in order to draw vertical and horizontal lines on a new binary image, representing the yatzy grid. See image below for drawn lines.", "Code for step 4, identify yatzy grid", "5. Identify every Yatzy cell in the yatzy grid and sort them column wise (x, y) by most upper left position. We do this by using findContours on binary image from step 4 which only contains the horizontal / vertical lines.", "See the full generate_yatzy_sheet function invoking the code above.", "Full source code for above gists are available here", "MNIST is a dataset containing of 70 000 28x28 images with handwritten digits. 35 000 from high school students and 35 000 from Census Bureau employees divided into 60k for training images and 10k for testing from respective group.", "The MNIST images have a size of 28x28 pixels and are black/white with some gray level as a result from anti-aliasing techniques used by the normalization algorithm (Gaussian etc). The handwritten digit is contained within a 20x20 bounding box with preserved aspect ratios. The 20x20 box is then transformed to a 28x28 container by introducing padding of 4 pixels on every side image. The digit is then centered in the 28x28 pixel image by computing the center of mass and translating it so this CoM point. Center of mass is essentially the white pixels mean across x- and y-axis. (We will mimic these steps for production prediction later)", "For training, we use a CNN architecture. If you are new to CNN, I recommend reading more about it here.", "The following code is used to train the model. Notice how we remove the gaussian anti-aliasing and turn the image into a binary image. We do this since we don\u2019t know the exact algorithm used in MNIST to create the anti-alias effect. Otherwise our production data would not match the training setup. We could perform a new gaussian anti-aliasing affect after we turned it to binary, however after testing this I didn\u2019t notice any performance improvements with gaussian filter.", "Full code for training our convolutional neural network.", "At the end we print the train/val loss and train/val accuracy to measure how well our model is doing through out the different epochs. Looks OK with reasonable validation metrics that follows the training fairly well.", "Now when we have the yatzy grid in an array format and the CNN model, we can start mapping digit contours locations with yatzy cells and pass the region of interest(ROI) for prediction.", "5. Pass the ROI for prediction", "Final results containing respective classified digit attached to each contour. (Notice how our model (intuitively) interprets A and B as 4 and 8)", "This was all for this python implementation. The code that runs in Yatzy Score Sheets is ported to Objective C++ and optimized (e.g skipping some duplicated operations in order to keep the different image versions throughout the python program). Since we know what yatzy cell these digits belongs to we can use this to present the sheet in the application screen \u201cPreview Sheet\u201d and an option to save the sheet. Notice that some cells have a level of red background color, an indication of how confident (between 0\u20131.0) our CNN model is that the predicted digit is correct. The user is then able to manually validate and update those digits with wrong prediction.", "The full source code for this post can be found in this Github repo", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F97ce685d80e0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@oankarberg?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oankarberg?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Oskar Ankarberg"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F73d4e3e36094&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&user=Oskar+Ankarberg&userId=73d4e3e36094&source=post_page-73d4e3e36094----97ce685d80e0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://apps.apple.com/se/app/yatzy-score-sheets/id1462576084", "anchor_text": "Yatzy Score Sheets"}, {"url": "https://en.wikipedia.org/wiki/Machine_learning", "anchor_text": "Machine Learning"}, {"url": "https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets#Test_dataset", "anchor_text": "test"}, {"url": "https://docs.opencv.org/3.4/d4/d73/tutorial_py_contours_begin.html", "anchor_text": "contours"}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow"}, {"url": "https://docs.opencv.org/3.4/d4/d73/tutorial_py_contours_begin.html", "anchor_text": "contour"}, {"url": "https://docs.opencv.org/3.4/d3/dc0/group__imgproc__shape.html#ga3d476a3417130ae5154aea421ca7ead9", "anchor_text": "minimum area that can be represented by a rectangle"}, {"url": "http://homepages.inf.ed.ac.uk/rbf/HIPR2/morops.htm", "anchor_text": "morphology"}, {"url": "https://github.com/oankarberg/yatzy-score-sheet-detection", "anchor_text": "here"}, {"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST"}, {"url": "https://i.stack.imgur.com/pA7uy.png", "anchor_text": "anti-aliasing"}, {"url": "http://cs231n.github.io/convolutional-networks/", "anchor_text": "here"}, {"url": "https://apps.apple.com/se/app/yatzy-score-sheets/id1462576084", "anchor_text": "Yatzy Score Sheets"}, {"url": "https://github.com/oankarberg/yatzy-score-sheet-detection", "anchor_text": "this Github repo"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----97ce685d80e0---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/python?source=post_page-----97ce685d80e0---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----97ce685d80e0---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/opencv?source=post_page-----97ce685d80e0---------------opencv-----------------", "anchor_text": "Opencv"}, {"url": "https://medium.com/tag/mnist?source=post_page-----97ce685d80e0---------------mnist-----------------", "anchor_text": "Mnist"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&user=Oskar+Ankarberg&userId=73d4e3e36094&source=-----97ce685d80e0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&user=Oskar+Ankarberg&userId=73d4e3e36094&source=-----97ce685d80e0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F97ce685d80e0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----97ce685d80e0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----97ce685d80e0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----97ce685d80e0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----97ce685d80e0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oankarberg?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oankarberg?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Oskar Ankarberg"}, {"url": "https://medium.com/@oankarberg/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "8 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F73d4e3e36094&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&user=Oskar+Ankarberg&userId=73d4e3e36094&source=post_page-73d4e3e36094--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F73d4e3e36094%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyatzy-score-sheet-detection-in-python-using-opencv-tensorflow-mnist-97ce685d80e0&user=Oskar+Ankarberg&userId=73d4e3e36094&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}