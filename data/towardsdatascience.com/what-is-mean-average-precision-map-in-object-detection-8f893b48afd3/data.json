{"url": "https://towardsdatascience.com/what-is-mean-average-precision-map-in-object-detection-8f893b48afd3", "time": 1683007271.906799, "path": "towardsdatascience.com/what-is-mean-average-precision-map-in-object-detection-8f893b48afd3/", "webpage": {"metadata": {"title": "What is Mean Average Precision (mAP) in Object Detection? | by Jacob Solawetz | Towards Data Science", "h1": "What is Mean Average Precision (mAP) in Object Detection?", "description": "The computer vision community has converged on the metric mAP to compare the performance of object detection systems. In this post, we will dive into the intuition behind how mean Average Precision\u2026"}, "outgoing_paragraph_urls": [{"url": "https://blog.roboflow.com/the-ultimate-guide-to-object-detection/", "anchor_text": "object detection systems", "paragraph_index": 0}, {"url": "https://blog.roboflow.com/the-ultimate-guide-to-object-detection/", "anchor_text": "object detection", "paragraph_index": 0}, {"url": "https://colab.research.google.com/drive/1pLvZpz0_Ob0yOQ7hxPhVRT04Cb3FGARb#scrollTo=dFSgxwD9Igo6", "anchor_text": "Colab notebook to compare EfficientDet and YOLOv3", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/Cow_shark", "anchor_text": "cow sharks", "paragraph_index": 10}, {"url": "https://blog.roboflow.com/object-detection/", "anchor_text": "Object detection systems", "paragraph_index": 15}, {"url": "https://blog.roboflow.ai/yolov3-versus-efficientdet-for-state-of-the-art-object-detection/", "anchor_text": "comparing state of the art detection models", "paragraph_index": 23}, {"url": "https://colab.research.google.com/drive/1pLvZpz0_Ob0yOQ7hxPhVRT04Cb3FGARb#scrollTo=dFSgxwD9Igo6", "anchor_text": "calculate mAP in my Colab notebook", "paragraph_index": 24}, {"url": "https://blog.roboflow.com/boosting-image-detection-performance-with-data-augmentation/", "anchor_text": "getting started with some data augmentation techniques", "paragraph_index": 30}], "all_paragraphs": ["The computer vision community has converged on the metric mAP to compare the performance of object detection systems. In this post, we will dive into the intuition behind how mean Average Precision (mAP) is calculated and why mAP has become the preferred metric for object detection.", "Before we consider how to calculate a mean average precision, we will first define the task it is measuring.", "Object detection models seek to identify the presence of relevant objects in images and classify those objects into relevant classes. For example, in medical images, we might want to be able to count the number of red blood cells (RBC), white blood cells (WBC), and platelets in the bloodstream. In order to do this automatically, we need to train an object detection model to recognize each one of those objects and classify them correctly. (I did this in a Colab notebook to compare EfficientDet and YOLOv3, two state-of-the-art models for image detection.)", "The models both predict bounding boxes which surround the cells in the picture. They then assign a class to each one of those boxes. For each assignment, the network models a sense of confidence in its prediction. You can see here that we have a total of three classes (RBC, WBC, and Platelets).", "How should we decide which model is better? Looking at the image, it looks like EfficientDet (green) has drawn a few too many RBC boxes and missed some cells on the edge of the picture. That is certainly how it feels based on the looks of things \u2014 but can we trust an image and intuition? If so, by how much is it better? (Hint: it\u2019s not \u2014 skip to the bottom if you don\u2019t believe.)", "It would be nice if we could directly quantify how each model does across images in our test set, across classes, and at different confidence thresholds. Enter mAP!", "To understand mean average precision, we must spend some meaningful time with the precision-recall curve.", "Precision is a measure of, \u201cwhen your model guesses how often does it guess correctly?\u201d Recall is a measure of \u201chas your model guessed every time that it should have guessed?\u201d Consider an image that has 10 red blood cells. A model that finds only one of these ten but correctly labels is as \u201cRBC\u201d has perfect precision (as every guess it makes \u2014 one \u2014 is correct) but imperfect recall (only one of ten RBC cells has been found).", "Models that involve an element of confidence can tradeoff precision for recall by adjusting the level of confidence they need to make a prediction. In other words, if the model is in a situation where avoiding false positives (stating a RBC is present when the cell was a WBC) is more important than avoiding false negatives, it can set its confidence threshold higher to encourage the model to only produce high precision predictions at the expense of lowering its amount of coverage (recall).", "The process of plotting the models precision and recall as a function of the model\u2019s confidence threshold is the precision recall curve. It is downward sloping because as confidence is decreased, more predictions are made (helping recall) and less precise predictions are made (hurting precision).", "Think about it like this: if I said, \u201cName every type of shark,\u201d you\u2019d start with obvious ones (high precision), but you\u2019d become less confident with every additional type of shark you could name (approaching full recall with lesser precision). By the way, did you know there are cow sharks?", "As the model is getting less confident, the curve is sloping downwards. If the model has an upward sloping precision and recall curve, the model likely has problems with its confidence estimation.", "AI researchers love metrics and the whole precision-recall curve can be captured in single metrics. The first and most common is F1, which combines precision and recall measures to find the optimal confidence threshold where precision and recall produce the highest F1 value. Next, there is AUC (Area Under the Curve) which integrates the amount of the plot that falls underneath the precision and recall curve.", "The final precision-recall curve metric is average precision (AP) and of most interest to us here. It is calculated as the weighted mean of precisions achieved at each threshold, with the increase in recall from the previous threshold used as the weight.", "Both AUC and AP capture the whole shape of the precision recall curve. To choose one or the other for object detection is a matter of choice and the research community has converged on AP for interpretability.", "Object detection systems make predictions in terms of a bounding box and a class label.", "In practice, the bounding boxes predicted in the X1, X2, Y1, Y2 coordinates are sure to be off (even if slightly) from the ground truth label. We know that we should count a bounding box prediction as incorrect if it is the wrong class, but where should we draw the line on bounding box overlap?", "The Intersection over Union (IoU) provides a metric to set this boundary at, measured as the amount of predicted bounding box that overlaps with the ground truth bounding box divided by the total area of both bounding boxes.", "Picking the right single threshold for the IoU metric seems arbitrary. One researcher might justify a 60 percent overlap, and another is convinced that 75 percent seems more reasonable. So why not have all of the thresholds considered in a single metric? Enter mAP.", "In order to calculate mAP, we draw a series of precision recall curves with the IoU threshold set at varying levels of difficulty.", "In my sketch, red is drawn with the highest requirement for IoU (perhaps 90 percent) and the orange line is drawn with the most lenient requirement for IoU (perhaps 10 percent). The number of lines to draw is typically set by challenge. The COCO challenge, for example, sets ten different IoU thresholds starting at 0.5 and increasing to 0.95 in steps of .05.", "Finally, we draw these precision-recall curves for the dataset split out by class type.", "The metric calculates the average precision (AP) for each class individually across all of the IoU thresholds. Then the metric averages the mAP for all classes to arrive at the final estimate. \ud83e\udd2f", "I recently used mAP in a post comparing state of the art detection models, EfficientDet and YOLOv3. I wanted to see which model did better on the tasks of identifying cells in the bloodstream and identifying chess pieces.", "After I had run inference over each image in my test set, I imported a python package to calculate mAP in my Colab notebook. And here were the results!", "Evaluation of EfficientDet on cell object detection:", "Evaluation of YOLOv3 on cell object detection:", "So contrary to the single inference picture at the beginning of this post, it turns out that EfficientDet did a better job of modeling cell object detection! You will also notice that the metric is broken out by object class. This tells us that WBC are much easier to detect than Platelets and RBC, which makes sense since they are much larger and distinct than the other cells.", "mAP is also often broken out into small, medium, and large objects which helps identify where models (and/or datasets) may be going awry.", "Now you know how to calculate mAP and more importantly, what it means!", "To improve your model\u2019s mAP, take a look at getting started with some data augmentation techniques.", "Thanks for reading and may your mean average precisions reach ever skyward \ud83d\ude80", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning @ Roboflow \u2014 building tools and artifacts like this one to help practitioners solve computer vision."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8f893b48afd3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jacobsolawetz.medium.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Jacob Solawetz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5f06d25ec2e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=post_page-5f06d25ec2e8----8f893b48afd3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://blog.roboflow.ai/yolov4-data-augmentation/", "anchor_text": "What is mAP"}, {"url": "https://blog.roboflow.com/the-ultimate-guide-to-object-detection/", "anchor_text": "object detection systems"}, {"url": "https://blog.roboflow.com/the-ultimate-guide-to-object-detection/", "anchor_text": "object detection"}, {"url": "https://www.youtube.com/channel/UCUlRrGpNRT5jbiV8h5Q_4Fg?sub_confirmation=1", "anchor_text": "subscribe to our YouTube channel"}, {"url": "https://blog.roboflow.com/the-ultimate-guide-to-object-detection/", "anchor_text": "Object Detection"}, {"url": "https://colab.research.google.com/drive/1pLvZpz0_Ob0yOQ7hxPhVRT04Cb3FGARb#scrollTo=dFSgxwD9Igo6", "anchor_text": "Colab notebook to compare EfficientDet and YOLOv3"}, {"url": "https://en.wikipedia.org/wiki/Cow_shark", "anchor_text": "cow sharks"}, {"url": "https://blog.roboflow.com/object-detection/", "anchor_text": "Object detection systems"}, {"url": "https://blog.roboflow.ai/yolov3-versus-efficientdet-for-state-of-the-art-object-detection/", "anchor_text": "comparing state of the art detection models"}, {"url": "https://colab.research.google.com/drive/1pLvZpz0_Ob0yOQ7hxPhVRT04Cb3FGARb#scrollTo=dFSgxwD9Igo6", "anchor_text": "calculate mAP in my Colab notebook"}, {"url": "https://blog.roboflow.com/boosting-image-detection-performance-with-data-augmentation/", "anchor_text": "getting started with some data augmentation techniques"}, {"url": "https://medium.com/tag/evaluation?source=post_page-----8f893b48afd3---------------evaluation-----------------", "anchor_text": "Evaluation"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----8f893b48afd3---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----8f893b48afd3---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----8f893b48afd3---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/research?source=post_page-----8f893b48afd3---------------research-----------------", "anchor_text": "Research"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=-----8f893b48afd3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=-----8f893b48afd3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8f893b48afd3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8f893b48afd3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8f893b48afd3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8f893b48afd3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8f893b48afd3--------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jacob Solawetz"}, {"url": "https://jacobsolawetz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "513 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5f06d25ec2e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=post_page-5f06d25ec2e8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbdaf42b583ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-mean-average-precision-map-in-object-detection-8f893b48afd3&newsletterV3=5f06d25ec2e8&newsletterV3Id=bdaf42b583ae&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}