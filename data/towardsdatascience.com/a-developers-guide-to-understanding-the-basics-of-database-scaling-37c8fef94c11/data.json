{"url": "https://towardsdatascience.com/a-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11", "time": 1683011513.4849238, "path": "towardsdatascience.com/a-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11/", "webpage": {"metadata": {"title": "A developer\u2019s guide to understand the basics of database scaling | by Anurag Sidana | Jul, 2020 | Towards Data Science | Towards Data Science", "h1": "A developer\u2019s guide to understand the basics of database scaling", "description": "Let's look at how Database sharding and replication can provide a highly reliable and performant database system that can withstand a scale of millions."}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Let\u2019s imagine we have a service which is dealing with a scale of a few thousand requests per month with a single DB server which serves all the read/write request coming from the application servers.", "Things have been working fine till this point but with the time you start observing the spike in the incoming traffic and you are not able to reduce the latencies and database failures even after trying the following things:", "So now you need to solve for your DB infrastructure so that it can withstand the incoming traffic.", "Let\u2019s look at how Database sharding and replication can provide a highly reliable and performant database system that can withstand a scale of millions.", "Data replication is the process of storing the same data on more than one database server that leads to reduced latencies, read scalability, easier data recovery, and higher availability of data.", "Generally, the copy of the data is stored in a separate hardware component because if that hardware crashes then you don\u2019t want your replica to crash.", "The most commonly used replication strategy is Single Leader Replication.", "In this kind of replication, there is a leader node that takes all the writes and handles replication of data on all the other nodes. The leader node is generally termed as the master and the other dependent nodes are termed as the slaves.", "Both Reads and Writes are enabled only on the master and slaves can serve the read queries only.", "Now to update the data on slaves we can either opt for either synchronous or asynchronous replication. Both of these have their own pros and cons.", "1. SYNCHRONOUS REPLICATION: Whenever a write comes to master it sends the same request to all of the slaves and waits for the acknowledgment from all of them. Once it receives the acknowledgment it completes the write and notifies the client.", "2. ASYNCHRONOUS REPLICATION:Whenever a write comes to master it sends the same request to all of the slaves and doesn\u2019t wait for an acknowledgment and completes the transaction.", "This way master can continue to take writes even if all of the slave nodes fail.", "Hence a read-scale to the database can be achieved via replication. But how to add a write-scale? The answer is Sharding.", "Let\u2019s say you have a pizza and you can\u2019t have the entire thing by yourself so you break it into slices and call your friends.", "Now each of these friends is going to get one slice of pizza what you have done effectively is partitioned the pizza according to each friend share just like that we can have multiple database servers which are going to be taking the load of the requests which are being sent into it.", "So technically we are going to divide the complete DB load to N database servers in Sharding.", "And each subset of incoming requests is going to be served by an individual server. Now each partition sits on an entirely different physical machine, and under the control of a separate database instance with the same database schema.", "This is termed as sharding. It can also be termed as horizontal partitioning because sharding is basically horizontal partitioning across different physical machines/nodes.", "Sharding provides Higher Availability, reduces read/write DB latencies, and can handle a high DB load efficiently.", "There are multiple things that need to be considered while enabling sharding for your database. Two main things to be considered are as follows:", "We need some identifier to decide from which database server a particular request should be served. i.e. there should be key based on which we should be deciding on which shard a request should go. We call this a shard_key or partition_key. Generally, we choose any column of the table as a shard_key.", "Hashing is the process of converting an input of any length into a fixed-sized string of text using a mathematical function.This means that any text no matter how long it is can be converted into an array of numbers and letters.", "This mathematical function used to generate a hash-value is termed as the hash function.", "So using the hash function we calculate the hash value for the shard_key and then map the hash value to a DB server.", "In the below diagram, the hash function takes the shard_key (row-id) as input and returns the value by which we can identify to which shard it should go.", "Now, NoSQL Dbs like Mongo DB provides an inbuilt standard implementation for sharding. More databases that provide sharding at the database level are Cassandra, Hadoop, and Apache H-Base e.t.c.", "Whereas in relational DB\u2019s like MySQL there is no standard implementation of sharding. Hence, the common practice is to have application-level sharding for the Relational Databases.", "If in a database cluster one of the database servers goes down or you are adding a new database shard to the cluster then you might need to do the redistribution or rehashing of the data.", "This overhead is directly dependent upon the hash function we are using to distribute data between different shards.", "If the hash function is a simple modulo function that takes the modulo of the row-id with the number of shards to decide the shard to which a request should go then, in that case, it will lead to the complete rehashing of the data as shown below:", "In the above image, with 4 shards we can see the mapping of data is based out of the id modulo 4 (no of shards)", "With 5 shards the mapping of data is based out of the id modulo 5(no of shards)", "So here we observed that all the rows need to be remapped when we add a DB shard to an existing four shard cluster.", "And this kind of redistribution generally requires a system downtime that could be risky to your system.", "With a single database server queries that require joins can easily be done but as we know in the case of distributed architecture, the data is spanned across multiple regions. Hence a join over the tables which resides over multiple regions will require lots of processing and would be significantly latent.", "Hence you might need to do data denormalization to avoid joins as much as you can.", "To achieve this we choose the column on which we can have joins as the shard_key. Hence rows from different tables having the same value of the shard_key column will end up lying in the same shard.", "In the above example of a hospital database, we choose patient-id as a shard key. Hence all the entries of different tables with the same patient-id will lie in the same shard.", "Excessive access to a particular key or keys that lies in the same shard, can cause node exhaustion.", "i.e. Most of the requests are being served by a small subset of shards and other shards remain ideal most of the time. This can lead to node failure or overload and hence a resulting spike in latencies and failures.", "In the above diagram, we can see that most of the requests are being served by shard-1 hence it\u2019s heavily loaded. Whereas shard-2 and shard-3 are almost ideal.", "This can result in increased latencies and failures for all the requests which are being served by shard-1.", "A real-word example would be let\u2019s say Facebook chooses user_name as the shard_key for its user table. And all of the most accessed profiles like Cristiano Ronaldo\u2019s, Lady Gaga\u2019s, and Justin Bieber\u2019s end up being in the same shard. Then that particular shard would be a hotspot of requests as compared to other shards.", "Sharding is an excellent way to withstand the incoming traffic in a smart way.But you need to identify that when is the exact requirement of sharding because as you can see data partitioning and sharding can bring a bunch of extra complexities.", "So before making the decision to shard the database you should consider other options to make your database more performance such as indexing or caching.", "But if you still decide on designing a distributed database system there are other trade-offs also that you will have to consider.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Specialized expertise in agile and structured test-driven software development using Java. Living a life based out of open-closed principal. ;-)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F37c8fef94c11&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@anuragsidana22?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@anuragsidana22?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Anurag Sidana"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbc862586048&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&user=Anurag+Sidana&userId=bc862586048&source=post_page-bc862586048----37c8fef94c11---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@fifernando?utm_source=medium&utm_medium=referral", "anchor_text": "Fidel Fernando"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@mahyarmotebassem?utm_source=medium&utm_medium=referral", "anchor_text": "mahyar motebassem"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Consistent_hashing", "anchor_text": "consistent hashing"}, {"url": "https://medium.com/tag/programming?source=post_page-----37c8fef94c11---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/database?source=post_page-----37c8fef94c11---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/technology?source=post_page-----37c8fef94c11---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/replication?source=post_page-----37c8fef94c11---------------replication-----------------", "anchor_text": "Replication"}, {"url": "https://medium.com/tag/sharding?source=post_page-----37c8fef94c11---------------sharding-----------------", "anchor_text": "Sharding"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&user=Anurag+Sidana&userId=bc862586048&source=-----37c8fef94c11---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&user=Anurag+Sidana&userId=bc862586048&source=-----37c8fef94c11---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F37c8fef94c11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----37c8fef94c11---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----37c8fef94c11--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----37c8fef94c11--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----37c8fef94c11--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@anuragsidana22?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@anuragsidana22?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anurag Sidana"}, {"url": "https://medium.com/@anuragsidana22/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "183 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbc862586048&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&user=Anurag+Sidana&userId=bc862586048&source=post_page-bc862586048--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F54291607d13d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-developers-guide-to-understanding-the-basics-of-database-scaling-37c8fef94c11&newsletterV3=bc862586048&newsletterV3Id=54291607d13d&user=Anurag+Sidana&userId=bc862586048&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}