{"url": "https://towardsdatascience.com/belief-propagation-in-bayesian-networks-29f51fdc839c", "time": 1682996408.014765, "path": "towardsdatascience.com/belief-propagation-in-bayesian-networks-29f51fdc839c/", "webpage": {"metadata": {"title": "Belief Propagation in Bayesian Networks | by Phillip Wenig | Towards Data Science", "h1": "Belief Propagation in Bayesian Networks", "description": "In this article, I\u2019ll be using Belief Propagation (BP) with some example data. I presume that you already know about Bayesian Networks (BN). This post explains how to calculate beliefs of different\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/wenig/belief_propagation", "anchor_text": "GitHub", "paragraph_index": 1}], "all_paragraphs": ["In this article, I\u2019ll be using Belief Propagation (BP) with some example data. I presume that you already know about Bayesian Networks (BN). This post explains how to calculate beliefs of different variables in a BN which help reason.", "I created a repository with the code for BP on GitHub which I\u2019ll be using to explain the algorithm.", "To start right off, imagine we have a poly-tree which is a graph without loops. For instance, a graph depicted in the following illustration. We have 4 variables \u201cRain\u201d, \u201cSprinkler\u201d, \u201cHolmes\u201d and \u201cWatson\u201d with directed edges \u201cRain\u201d to \u201cHolmes\u201d, \u201cRain\u201d to \u201cWatson\u201d and \u201cSprinkler\u201d to \u201cHolmes\u201d. The Bayesian Network models the story of Holmes and Watson being neighbors. One morning Holmes goes outside his house and recognizes that the grass is wet. Either it rained or he forgot to turn off the sprinkler. So he goes to his neighbor Watson to see whether his grass is wet, too. As he sees that it is indeed wet he is quite sure that he didn\u2019t forget the sprinkler but that it rained. So the information flowed from Watson to the sprinkler. This flow of information is modeled with BP in BNs.", "In BP, we let the variables talk with each other to exchange their beliefs about each other. There are 2 kinds of messages: message from parents to children and messages from children to parents. In total, we only have to use 5 formulas to do BP. In my explanations, I will use different names for certain formulas and variables as I found some sources quite misleading.", "Likelihood holds information about observations of children, e.g. the likelihood for Holmes\u2019 grass without observing is 1 for wet and 1 for not wet. If wet grass is observed, the likelihood changes to 1 for wet and 0 for not wet. These unit vectors are not normalized.", "The likelihood function is basically a product of all the incoming messages sent by a variable\u2019s children. It returns a likelihood vector containing the likelihood values for each possible value of a variable. In case of \u201crain\u201d it has a cardinality of two, for the two states \u201cyes\u201d and \u201cno\u201d.", "If a variable does not have children as it is a leaf node in a graph and is not observed, its likelihood vector will be a unit vector, all ones for all its possible values, e.g. as we haven\u2019t observed Holmes\u2019 grass in the beginning we set its likelihood vector to [1, 1] for \u201cnot wet\u201d and \u201cwet\u201d, respectively.", "In Python (numpy) code it looks like that.", "Priors are the probabilities of certain events which are already known in the beginning, e.g. it rains with a probability of 20%. If the priors are unknown, the following formula is calculating it. It\u2019s a bit more complicated but I\u2019ll try. The prior is giving you the unconditional probability of the respective variable. Hence, we need to include the conditional one as well.", "The conditional probabilities are also given in our example. In the formula, \u201cP(X|W)\u201d corresponds to that. Moreover, we need to use the incoming messages from all parents, which is the \u201c\u03d5\u201d in the formula. The index is showing the message direction \u2014 from parent \u201cK\u201d to current variable \u201cX\u201d. These two parts (conditional probability and message from parents) are used as they both give information about the variables probability. On the one hand, we see the probability given some parents\u2019 values, on the other hand we see the messages of those parents. Without observation, those messages correspond to the parents priors. Hence, here, are calculating the marginals of \u201cX\u201d and get rid of the conditional variables.", "For each parent\u2019s message there exists a corresponding part in the conditional probability. Hence, we can perform the dot product for each message with the conditional probabilities table, which is self.m in this snippet.", "The belief is the posterior probability after we observed certain events. It is basically the normalized product of likelihood and priors.", "We take the probabilities we knew beforehand and introduce new knowledge received from the children. This way, we generate a new belief about our variable. If a variable has both, parents and children, the belief is the updated probability (posterior) incorporating information from below and above. So each incoming message is taken into account. The \u201c\u03b1\u201d is a normalizing constant, as the product of likelihood and prior can be in sum greater than 1. This is a shorthand form for a division with the sum of all possible states of the variables.", "In this Python snippet the normalizing part gets clearer.", "In order to calculate the likelihood of a variable, we need to consider all incoming messages from a variable\u2019s children, which are represented by the lambda in the likelihood function.", "This formula is pretty messed up, but better to understand when looking at some Python code. In general we are marginalizing out K from P(X|U) whereas X is the sender (children), K is the receiver (parent) and U is all parents of X including K. If we imagine a conditional probability table for X, for each entry we take the corresponding activations of the parents and multiply the respective incoming messages \u03d5 without K itself. Then, we multiply that value with X\u2019s likelihood. In the end we sum over all values with the same value for K and are left with a vector being the message from X to K.", "So a message to a parent takes into account all incoming messages, no matter if they were sent by children or parents (except for the parent receiving the message), and considers the probabilities given certain parents\u2019 values. Hence, a variable setting with high probability forwards incoming messages easier than low probabilities. An incoming message is rated by the conditional probability of that message\u2019s setting.", "I hope that the Python code clarifies it a bit further.", "To calculate the message by parents sent to their children two ways exist. Either all messages received from the other children multiplied with the current node\u2019s prior are multiplied together or the current node\u2019s belief is getting divided by the corresponding child\u2019s message to the parent.", "We consider this formula to be called Kappa with the index telling us the direction of the message (from X to K).", "If we look at the formula for the belief, we see that this formula is the product of the likelihood and the prior. The likelihood, however, is the product of all incoming messages. Hence, the belief divided by the incoming message from K results in the product of all incoming messages \u2014 except for the one we divided by \u2014 and the prior. That way, we can explain the equality between the two ways calculating Kappa. The intuition behind the message to the children is similar to the message to a parent. You take into account all incoming messages (so consider all information you can get) and send the aggregation to the next node.", "The alpha is again a normalizing constant. If a parent node has only one child, it cannot gather messages from other children as there are none. Hence, it will only return its prior.", "Using my repository which I mentioned in the beginning, we can now use the Holmes example and calculate the beliefs of different situations.", "In order to use the library, we need to import it together with the NumPy library.", "We imported the Node class of the repository which represents a single node in a BN. In the next step, we actually create nodes which represent the single probability variables: \u201cHolmes\u2019 grass is wet\u201d, \u201cRained\u201d, \u201cForgot sprinkler\u201d and \u201cWatson\u2019s grass is wet\u201d. When creating a node, you have to provide a name. Afterwards you need to set some properties like the cardinality and priors or likelihood if exists.", "For nodes without children, this is straight forward. For other nodes, which do have parents and no priors already available, we need to define a conditional probability table (CPT) which defines the probability of the variable given all possible inputs from the parents. This CPT is called \u201cm\u201d in the code.", "As you can see, \u201cm\u201d takes the values of the parents in the first dimensions of the matrix and the value of the actual variable in the last, e.g. (\u201chere\u201d in code comment) the probability of the grass being wet (1) if it didn\u2019t rain (0) and the sprinkler was forgotten (1) is 0.9. The likelihood of the grass being wet is 1, 1 which means that both states have the same likelihood.", "Next, we have to connect the nodes to define the causalities. The Node class has a method called \u201cadd_parent\u201d which can connect a variable to a parent variable.", "In the next steps, we are pretending Holmes\u2019 grass is wet (hence, likelihood [0,1]). Then, we want to know whether Watson\u2019s grass is also wet (or how likely it is to be wet).", "We see that the belief of Watson\u2019s grass being wet is indeed tending towards being wet (0.21 vs 0.79). Hence, the BN expects Watson\u2019s grass to be wet as there is the connection over the rain node through which the belief was propagated.", "The toolset of BNs can be really helpful in reasoning cases as the following. I am really excited about the whole research field of causal inference and think that a lot of progress will be made also regarding deep learning and general artificial intelligence.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a Data Scientist and PhD student drinking coffee and philosophizing about AI, algorithms, concepts, etc. and their effects on our world and society."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F29f51fdc839c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pw33392?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pw33392?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Phillip Wenig"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9dbc010b40c6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&user=Phillip+Wenig&userId=9dbc010b40c6&source=post_page-9dbc010b40c6----29f51fdc839c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@clintadair?utm_source=medium&utm_medium=referral", "anchor_text": "Clint Adair"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/wenig/belief_propagation", "anchor_text": "GitHub"}, {"url": "http://www.cse.unsw.edu.au/~cs9417ml/Bayes/Pages/PearlPropagation.html", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----29f51fdc839c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/causality?source=post_page-----29f51fdc839c---------------causality-----------------", "anchor_text": "Causality"}, {"url": "https://medium.com/tag/data-science?source=post_page-----29f51fdc839c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/algorithms?source=post_page-----29f51fdc839c---------------algorithms-----------------", "anchor_text": "Algorithms"}, {"url": "https://medium.com/tag/graph?source=post_page-----29f51fdc839c---------------graph-----------------", "anchor_text": "Graph"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&user=Phillip+Wenig&userId=9dbc010b40c6&source=-----29f51fdc839c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&user=Phillip+Wenig&userId=9dbc010b40c6&source=-----29f51fdc839c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F29f51fdc839c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----29f51fdc839c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----29f51fdc839c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----29f51fdc839c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----29f51fdc839c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pw33392?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pw33392?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Phillip Wenig"}, {"url": "https://medium.com/@pw33392/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "306 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9dbc010b40c6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&user=Phillip+Wenig&userId=9dbc010b40c6&source=post_page-9dbc010b40c6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc0c7c976a038&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbelief-propagation-in-bayesian-networks-29f51fdc839c&newsletterV3=9dbc010b40c6&newsletterV3Id=c0c7c976a038&user=Phillip+Wenig&userId=9dbc010b40c6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}