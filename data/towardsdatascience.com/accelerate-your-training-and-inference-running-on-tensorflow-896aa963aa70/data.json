{"url": "https://towardsdatascience.com/accelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70", "time": 1683002599.645117, "path": "towardsdatascience.com/accelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70/", "webpage": {"metadata": {"title": "Accelerate your training and inference running on Tensorflow | by Ranjeet Singh | Towards Data Science", "h1": "Accelerate your training and inference running on Tensorflow", "description": "Tensorflow comes with default settings to be compatible with as many CPUs/GPUs as it can. You can easily optimize it to use the full capabilities of your CPU such as AVX or of your GPU such as Tensor\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/install/source", "anchor_text": "build TensorFlow from the source", "paragraph_index": 6}, {"url": "https://www.tensorflow.org/xla/tutorials/xla_compile", "anchor_text": "here", "paragraph_index": 11}, {"url": "https://arxiv.org/abs/1710.03740", "anchor_text": "Mixed precision", "paragraph_index": 12}, {"url": "https://www.tensorflow.org/guide/keras/mixed_precision", "anchor_text": "The mixed precision API", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/pruning-deep-neural-network-56cae1ec5505", "anchor_text": "blogs", "paragraph_index": 18}, {"url": "https://github.com/tensorflow/model-optimization", "anchor_text": "Model Optimization Toolkit", "paragraph_index": 20}, {"url": "http://ranjeetthakur.github.io", "anchor_text": "ranjeetthakur.github.io", "paragraph_index": 35}], "all_paragraphs": ["Tensorflow comes with default settings to be compatible with as many CPUs/GPUs as it can. You can easily optimize it to use the full capabilities of your CPU such as AVX or of your GPU such as Tensor Cores leading to up to a 3x accelerated code.", "Similarily If you are a startup, you might not have unlimited access to GPUs or the case might be to deploy a model on CPU, you can still optimize your Tensorflow code to reduce its size for faster inference on any device. Below I\u2019m going to discuss several ways to accelerate your Training or Inference or both.", "The most popular way to install Tensorflow in via pip but such an installation is pretty slow. Why?", "The default builds from pip install tensorflow are intended to be compatible with as many CPUs as possible. If you ever have seen logs in your console while running your Tensorflow program, you must have seen such a warning- \u201cYour CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\u201d", "What does this warning mean? Modern CPUs provide a lot of extensions to low-level instruction set such as SSE2, SSE4, AVX, etc", "If you have a GPU, you shouldn\u2019t care about AVX support, because most expensive ops will be dispatched on a GPU device (unless explicitly set not to)", "Building it from the source itself might speed up your Tensorflow program significantly. TensorFlow actually warns you about doing just. You should build TensorFlow from the source optimized for your CPU with AVX, AVX2, and FMA enabled whichever your CPU supports.", "Accelerated Linear Algebra, XLA is a domain-specific compiler for matrix operations. It can accelerate TensorFlow models with no changes in the source code.", "When a TensorFlow program is run, all of the operations are executed individually by the TensorFlow executor. Each TensorFlow operation has a pre-compiled GPU kernel implementation that the executor dispatches to.", "XLA provides an alternative mode of running models: it compiles the TensorFlow graph into a sequence of computation kernels generated specifically for the given model. Because these kernels are unique to the model, they can exploit model-specific information for optimization. Along with many others, Fusion is XLA\u2019s single most important optimization which I will discuss later in this post in detail.", "The results are improvements in speed and memory usage: most internal benchmarks run ~1.15x faster after XLA is enabled.", "Try XLA example in Colab here", "Mixed precision training offers significant computational speedup by performing operations in the half-precision format while storing minimal information in single-precision to retain as much information as possible in critical parts of the network.", "There are numerous benefits to using numerical formats with lower precision than 32-bit floating-point. First, they require less memory, enabling the training and deployment of larger neural networks. Second, they require less memory bandwidth, thereby speeding up data transfer operations. Third, math operations run much faster in reduced precision, especially on GPUs with Tensor Core support for that precision. It does so by identifying the steps that require full precision and using 32-bit floating-point for only those steps while using 16-bit floating-point everywhere else.", "Among NVIDIA GPUs, those with compute capability 7.0 or higher will see the greatest performance benefit from mixed-precision because they have special hardware units, called Tensor Cores, to accelerate float16 matrix multiplications and convolutions.", "The mixed precision API is available in TensorFlow 2.1 with Keras interface. To use mixed precision in Keras, you need to create, typically referred to as a dtype policy. Dtype policies specify the dtypes layers will run in. This will cause subsequently created layers to use mixed precision with a mix of float16 and float32.", "Imp. note- Tensor Cores which provide mix precision, requires certain dimensions of tensors such as dimensions of your dense layer, number of filters in Conv layers, number of units in RNN layer to be a multiple of 8.", "To compare the performance of mixed-precision with float32, change the policy from mixed_float16 to float32. The Expected performance improvement is up to 3x.", "I already have covered this concept in one of my previous blogs. In very brief how pruning works-", "If you could rank the neurons or the connection in between them according to how much they contribute, you could then remove the low ranking neurons or connections from the network, resulting in a smaller and faster network.", "Tensorflow provides Model Optimization Toolkit for pruning and other post-training optimizations. To use it in your code, here is a simple example-", "Normally when you run a TensorFlow graph, all of the operations are executed individually by the TensorFlow graph executor. Each op has a pre-compiled GPU kernel implementation. Fused Ops combine operations into a single kernel for improved performance.", "Without fusion, without XLA, the graph launches three kernels: one for the multiplication, one for the addition and one for the reduction.", "With op fusion, you can compute the result in a single kernel launch. It does this by \u201cfusing\u201d the addition, multiplication, and reduction into a single GPU kernel.", "Newer Tensorflow versions come with XLA which does fusion along with other optimizations for us.", "\u25a0 Conv2D + FusedBatchNorm + <Activation>", "\u25a0 Conv2D + Squeeze + BiasAdd", "\u25a0 MatMul + BiasAdd + <Activation>", "Fusing ops together provides several performance advantages:", "\u25cb Completely eliminates Op scheduling overhead (big win for cheap ops)", "\u25cb Increases opportunities for ILP, vectorization etc.", "\u25cb Improves temporal and spatial locality of data access", "E.g. MatMul is computed block-wise and bias and activation function can be applied while data is still \u201chot\u201d in cache.", "In Tf 1.x, layers compatible with fused ops have \u2018fused\u2019 argument which needs to be set to True to use fusion for faster implementation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Researcher | ranjeetthakur.github.io"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F896aa963aa70&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----896aa963aa70--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ranjeet_thakur?source=post_page-----896aa963aa70--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ranjeet_thakur?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Ranjeet Singh"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F25c454d759c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&user=Ranjeet+Singh&userId=25c454d759c&source=post_page-25c454d759c----896aa963aa70---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.tensorflow.org/install/source", "anchor_text": "build TensorFlow from the source"}, {"url": "https://www.tensorflow.org/xla", "anchor_text": "https://www.tensorflow.org/xla"}, {"url": "https://www.tensorflow.org/xla/tutorials/xla_compile", "anchor_text": "here"}, {"url": "https://arxiv.org/abs/1710.03740", "anchor_text": "Mixed precision"}, {"url": "https://developer.nvidia.com/tensor-cores", "anchor_text": "Tensor Cores."}, {"url": "https://www.tensorflow.org/guide/keras/mixed_precision", "anchor_text": "The mixed precision API"}, {"url": "https://towardsdatascience.com/pruning-deep-neural-network-56cae1ec5505", "anchor_text": "blogs"}, {"url": "https://github.com/tensorflow/model-optimization", "anchor_text": "Model Optimization Toolkit"}, {"url": "https://medium.com/tensorflow/introducing-the-model-optimization-toolkit-for-tensorflow-254aca1ba0a3", "anchor_text": "https://medium.com/tensorflow/introducing-the-model-optimization-toolkit-for-tensorflow-254aca1ba0a3"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----896aa963aa70---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----896aa963aa70---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----896aa963aa70---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&user=Ranjeet+Singh&userId=25c454d759c&source=-----896aa963aa70---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&user=Ranjeet+Singh&userId=25c454d759c&source=-----896aa963aa70---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F896aa963aa70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----896aa963aa70---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----896aa963aa70--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----896aa963aa70--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----896aa963aa70--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----896aa963aa70--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----896aa963aa70--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ranjeet_thakur?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ranjeet_thakur?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ranjeet Singh"}, {"url": "https://medium.com/@ranjeet_thakur/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "283 Followers"}, {"url": "http://ranjeetthakur.github.io", "anchor_text": "ranjeetthakur.github.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F25c454d759c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&user=Ranjeet+Singh&userId=25c454d759c&source=post_page-25c454d759c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F27c34552a104&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-your-training-and-inference-running-on-tensorflow-896aa963aa70&newsletterV3=25c454d759c&newsletterV3Id=27c34552a104&user=Ranjeet+Singh&userId=25c454d759c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}