{"url": "https://towardsdatascience.com/put-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791", "time": 1683004300.577487, "path": "towardsdatascience.com/put-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791/", "webpage": {"metadata": {"title": "Put your Data Analysis in an R Package \u2014 Even if You Don\u2019t Publish it | by Denis Gontcharov | Towards Data Science", "h1": "Put your Data Analysis in an R Package \u2014 Even if You Don\u2019t Publish it", "description": "A data analysis project consists of many different files: raw data, R scripts, R Markdown reports and Shiny apps. We need a sensible project folder structure to stay organized. Why not take advantage\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/gontcharovd/WineReviews.git", "anchor_text": "GitHub", "paragraph_index": 4}, {"url": "http://r-pkgs.had.co.nz/", "anchor_text": "recommended", "paragraph_index": 5}, {"url": "https://www.kaggle.com/zynicide/wine-reviews", "anchor_text": "Kaggle", "paragraph_index": 13}, {"url": "https://stackoverflow.com/questions/13463103/inst-and-extdata-folders-in-r-packaging", "anchor_text": "installed", "paragraph_index": 13}, {"url": "https://cran.r-project.org/", "anchor_text": "CRAN", "paragraph_index": 27}, {"url": "http://adv-r.had.co.nz/Functional-programming.html#fp-motivation", "anchor_text": "functional programming", "paragraph_index": 33}], "all_paragraphs": ["A data analysis project consists of many different files: raw data, R scripts, R Markdown reports and Shiny apps. We need a sensible project folder structure to stay organized. Why not take advantage of R\u2019s established package development workflow?", "Working on our analysis inside an R package offers four benefits:", "In this article we will work out a data analysis example inside an R package step-by-step. We will see that these benefits require nearly no overhead.", "For the data analysis example we will:", "The final result can be found on GitHub.", "I assume you use RStudio. Experience with R package development is recommended but not required. We\u2019ll need the following R packages:", "In RStudio navigate to a folder on your computer where you want to create the package. The following command will open a new RStudio session and create a bare-bone package named \u201cWineReviews\u201d.", "Notice how an additional tab Build becomes available.", "If you have version control configured in RStudio navigate to Tools, Version control, Project setup and select your version control software from the drop-down menu. We will select Git which initializes a local Git repository with a .gitignore file.", "We will use the R package roxygen2 to automatically generate documentation for our functions and data. Navigate to Tools, Project Options, Build Tools and tick the checkbox before \u201cGenerate documentation with Roxygen\u201d. We will use the following configuration:", "In the DESCRIPTION file we write basic information about the project:", "Our initial package structure looks like this:", "Let\u2019s run a check on our package build to see if everything is okay. We will do this regularly to ensure the project integrity throughout our work.", "In this example we use two csv files from the Wine Reviews dataset on Kaggle. We create a folder inst/ with a sub folder extdata/ in which we save the two csv files. (Subfolders of inst/ are installed when the package is built.)", "To make these files available we have to clean and rebuild the package. This will install the R package on your computer.", "To retrieve the path to a file in inst/ we use system.file() as follows:", "We will now process this raw data into a useful form. The wine reviews are split over the two csv files. Let\u2019s assume that we want to merge these two files into one data frame with four variables: \u201ccountry\u201d, \u201cpoints\u201d, \u201cprice\u201d and \u201cwinery\". Let\u2019s call this data frame \u201cwine_data\u201d.", "The code below creates the data_raw/ folder with a script wine_data.R", "The code below creates our desired data frame. Let\u2019s add it to the wine_data.R script and run it.", "The final line creates the data/ folder with the data frame stored as wine_data.rda. After we Clean and Rebuild again this data can be loaded into the global environment like any other R data:", "It\u2019s good practice to document your created data. All documentation for data should be stored in a a single R script saved in the R/ folder. Let\u2019s create this script with the following content and name it data.R:", "To create documentation based on this script we run:", "Roxygen transforms the code above into a a wine_data.Rd file and adds it to the man/ folder. We can view this documentation in the help pane by typing?winedata in the R console.", "Our package structure now looks like this:", "It\u2019s good practice to regularly check the integrity of our package by running:", "We get one warning and one note.", "The warning about R version dependence is introduced after calling usethis::use_data(wine_data, overwrite = TRUE) and is resolved by adding Depends: R (>= 2.10) to the DESCRIPTION file.", "The note warns us about the package size because the data in inst/extdata exceeds 1 MB. We don\u2019t want to publish this R package on CRAN so we can ignore this. However, we will resolve this note by adding the inst/extdata/ folder to .Rbuildignore.", "Now devtools::check() shows everything is fine:", "Now we can explore the processed data. I like to write reports in R package vignettes because they have a clean layout with whom R users are familiar. If you prefer not to use vignettes you can do the steps in a standard R Markdown document instead of a vignette, as shown in chapter 7.", "The function below creates a vignettes/ folder with a wine_eda.Rmd vignette that we will use for our exploratory data analysis.", "We will use the popular dplyr R package to manipulate data. It\u2019s important to declare each R package we use in the DESCRIPTION file. Don\u2019t worry: if you forget this devtools::check() will throw a note. Declare the package with:", "Let\u2019s add some code to the vignette to load the data and show a summary:", "There are 22691 missing values for the wine price. Let\u2019s transform our data to fill these missing values. R is a functional programming language: we should transform our data by applying functions.", "\u201cTo understand computations in R, two slogans are helpful: Everything that exists is an object. Everything that happens is a function call.\u201d", "This is the part where our decision to put our analysis in an R package will pay its dividends: package development makes the process of writing, documenting and testing functions incredibly smooth.", "Let\u2019s replace a missing price with the mean price of that country\u2019s wines. This is not necessarily a good idea statistically speaking, but it will serve to drive the point home.", "The replacement will be done by a function called \u201cfill_na_mean\u201d. We create a new R script variable_calculation.R and save it in the R/ folder. Notice how we can conveniently write the function\u2019s documentation above its code. (Leave the @export tag otherwise the @examples won\u2019t work.)", "To create the documentation we again run:", "As was the case with documenting data, Roxygen will transform this documentation in a file fill_na_mean.Rd and save it in the man/ folder. We can view this documentation in the help pane by typing?fill_na_mean in the R console.", "If you wish to resume work after closing or restarting your R session, run the following command to load your functions as well as the packages declared in the DESCIPTION file:", "Next we will write two tests for our newly created function:", "The R package assertive offers functions for run-time testing.", "Our simple test consisting of one line checks if the input is a numeric vector and throw an error when it\u2019s not. Note that run-time tests don\u2019t rely on our package development environment because they are a part of the function.", "Contrary to run-time testing, development-time testing with the testthat R package requires an active package development environment. Let\u2019s write a unit test for our function that tests if fill_na_mean(c(2, 2, NA, 5, 3, NA)) returns the vector c(2, 2, 3, 5, 3, 3).", "First we set up the testthat framework:", "The following command creates the script test-variable_calculations.R that contains the unit tests for the functions defined in variable_calculations.R:", "We modify the code in test-variable_calculations.R to represent our test:", "The following command runs all your tests and returns a pretty report:", "Now we can fill the missing values in our data analysis wine_eda.Rmd. But what if we wanted to do the same thing in other reports or applications? Should we repeat this procedure in each file?", "In fact, this function deals with data processing rather than exploratory analysis. It therefore belongs in the winedata.R file that generates the wine_data.rda. Putting this code in winedata.R instead of wine_eda.Rmd has the two advantages:", "After filling the missing values six observations still have no wine price so we choose to remove them. This is what the final script looks like:", "Because we changed how the raw data is processed we have to document these changes in the data.R file in the data-raw/ folder:", "Let\u2019s knit our vignette. Notice that there are no more missing values even though we didn\u2019t changed the code in the vignette. The missing values are removed in the wine_data.R script. In the vignette we just load the processed wine_data.rda.", "We can add any R Markdown file to our package. Analogously to raw data, we create a sub folder rmd/ in the inst/ folder. Let\u2019s create a simple dashboard to view the wine price distribution per country. We create an R Markdown file wine_dashboard.Rmd in rmd/ with the following content:", "Let\u2019s view the dashboard with Run Document:", "Our data analysis example is now finished. This is what our final project structure looks like:", "This structure is suitable version control. Files with code are tracked whereas raw data in inst/extdata and processed data in data/ are not tracked. We can generate the processed data from the (re)downloaded raw data using the R scripts in data-raw/. I recommend adding the following entries to .gitignore:", "Here is how we made use of the R package components:", "I hope you have enjoyed the article. Would you consider using R packages to store your work? How do you like to organize your projects? Let me know in the comments!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F64f2bb8fd791&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@gontcharovd?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gontcharovd?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Denis Gontcharov"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F577238ea7b62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&user=Denis+Gontcharov&userId=577238ea7b62&source=post_page-577238ea7b62----64f2bb8fd791---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://rmarkdown.rstudio.com/flexdashboard/", "anchor_text": "flexdashboard"}, {"url": "https://github.com/gontcharovd/WineReviews.git", "anchor_text": "GitHub"}, {"url": "http://r-pkgs.had.co.nz/", "anchor_text": "recommended"}, {"url": "https://www.kaggle.com/zynicide/wine-reviews", "anchor_text": "Kaggle"}, {"url": "https://stackoverflow.com/questions/13463103/inst-and-extdata-folders-in-r-packaging", "anchor_text": "installed"}, {"url": "http://twitter.com/format", "anchor_text": "@format"}, {"url": "http://twitter.com/source", "anchor_text": "@source"}, {"url": "https://www.kaggle.com/zynicide/wine-reviews", "anchor_text": "https://www.kaggle.com/zynicide/wine-reviews"}, {"url": "https://cran.r-project.org/", "anchor_text": "CRAN"}, {"url": "http://adv-r.had.co.nz/Functional-programming.html#fp-motivation", "anchor_text": "functional programming"}, {"url": "http://twitter.com/format", "anchor_text": "@format"}, {"url": "http://twitter.com/source", "anchor_text": "@source"}, {"url": "https://www.kaggle.com/zynicide/wine-reviews", "anchor_text": "https://www.kaggle.com/zynicide/wine-reviews"}, {"url": "https://medium.com/tag/r?source=post_page-----64f2bb8fd791---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/code?source=post_page-----64f2bb8fd791---------------code-----------------", "anchor_text": "Code"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----64f2bb8fd791---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&user=Denis+Gontcharov&userId=577238ea7b62&source=-----64f2bb8fd791---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&user=Denis+Gontcharov&userId=577238ea7b62&source=-----64f2bb8fd791---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F64f2bb8fd791&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----64f2bb8fd791---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----64f2bb8fd791--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gontcharovd?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gontcharovd?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Denis Gontcharov"}, {"url": "https://medium.com/@gontcharovd/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "67 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F577238ea7b62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&user=Denis+Gontcharov&userId=577238ea7b62&source=post_page-577238ea7b62--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb3c22a48a72c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fput-your-data-analysis-in-an-r-package-even-if-you-dont-publish-it-64f2bb8fd791&newsletterV3=577238ea7b62&newsletterV3Id=b3c22a48a72c&user=Denis+Gontcharov&userId=577238ea7b62&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}