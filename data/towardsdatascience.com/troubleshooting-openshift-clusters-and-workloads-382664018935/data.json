{"url": "https://towardsdatascience.com/troubleshooting-openshift-clusters-and-workloads-382664018935", "time": 1683010163.851875, "path": "towardsdatascience.com/troubleshooting-openshift-clusters-and-workloads-382664018935/", "webpage": {"metadata": {"title": "Troubleshooting OpenShift Clusters and Workloads | by Martin Heinz | Towards Data Science", "h1": "Troubleshooting OpenShift Clusters and Workloads", "description": "There's a lot of things that can go wrong with your OpenShift cluster and this collection of troubleshooting commands might help you deal with them."}, "outgoing_paragraph_urls": [{"url": "https://martinheinz.dev/blog/26?utm_source=tds&utm_medium=referral&utm_campaign=blog_post_26", "anchor_text": "martinheinz.dev", "paragraph_index": 39}, {"url": "https://martinheinz.dev/", "anchor_text": "https://martinheinz.dev/", "paragraph_index": 41}, {"url": "https://ko-fi.com/martinheinz", "anchor_text": "https://ko-fi.com/martinheinz", "paragraph_index": 41}], "all_paragraphs": ["If you are cluster admin, cluster operator or the only developer in the team that actually knows what\u2019s going on in your OpenShift cluster, then you will know, that some terrible things happen from time to time. It\u2019s inevitable and it\u2019s better to be prepared for the moment when shit hits the fan. So, this is the collection of commands that should be part of your arsenal, when it comes to debugging broken deployments, resource consumption, missing privileges, unreachable workloads and more\u2026", "Yea, it looks nice, it\u2019s easy to navigate, it makes it easy to perform some tasks\u2026 and it will also become unreachable if there\u2019s problem with router, or deployment loses its Endpoint or if operator has some issues\u2026", "If you get little too used to doing everything using web console, you might end up not being able to solve problems with CLI at the moment when every minute matters. Therefore my recommendation is to get comfortable with the oc tool and at least for the duration of this article forget that the web console even exists.", "It\u2019s good to check memory and CPU available on your worker nodes from time to time and especially if your pods are stuck in Pending state or are being OOMKilled. You can do that with:", "Which displays CPU and Memory stats of nodes. In case you want to filter out master nodes and see only workers, then you can use -l node-role.kubenetes.io/worker, like so:", "If you are running bare metal cluster, then there is a good chance, that you will eventually run into problems related to things running on nodes themselves. To see what\u2019s happening with specific systemd units (e.g. crio or kubelet) running on worker nodes, you can use:", "This command retrieves logs from specific unit. So, running with -u crio gives us the following:", "When logs are not good enough and you need to actually poke around inside the worker node, you can run oc debug nodes/node-name. This would give you shell inside this specific node, by creating privileged pod on the node. Example of this kind of a interactive session:", "In the session above we use crictl to inspect containers running directly on the worker node. This is the place where we could start/restart/delete some containers or system services if needed. Needless to say, be very careful when touching things running on the nodes themselves.", "As a side note, if you are running your cluster on some managed public cloud, then most likely you will not have permission for direct access to nodes, as that would be security issues, so the last command might fail on you.", "When you decide, that it\u2019s time to update you cluster to the newer version you will probably want to monitor the progress. Alternatively, if some operators are breaking without any clear reason, you might also want to check up on your clusterversion operator to see whether it's progressing towards newer version, which might be reason for temporary service degradation:", "Both commands above retrieve version and information on whether the cluster is currently upgrading or what\u2019s the state of cluster operators in general.", "The thing that\u2019s going to break most often is of course pod and/or deployment ( DeploymentConfig). There\u2019s quite a few commands that can give you insight into what is wrong with you application, so starting from the most high-level ones:", "oc status is the easiest way to get overview of resources deployed in project including their relationships and state as shown above.", "Next one, you already know \u2014 oc describe. The reason I mention it is Events: section at the bottom, which shown only events related to this specific resource, which is much nicer then trying to find anything useful in output of oc events.", "Another common command is oc logs. One thing you might not know about it though, is that it can target specific container of the pod, using -c argument. For example:", "This might come in handy if you are debugging single container in multi-container pod and want filter only the relevant logs.", "Now, for the little less known command(s). oc debug was already shown in the section about debugging nodes, but it can be used to debug deployments or pods too:", "Unlike the example with nodes, this won\u2019t give you shell to the running pod, but rather create exact replica of the existing pod in debug mode. Meaning, that labels will be stripped and the command changed to /bin/sh.", "One reason you might need to debug pod in OpenShift is issue with security policies. In that case you can add --as-root to the command, to stop it from crashing during startup.", "Nice thing about this command is that it can be used with any OpenShift resource that creates pod, for example Deployment, Job, ImageStreamTag, etc.", "Even though creating debugging pods can be very convenient, sometimes you just need to poke around in the actual pods. You can use oc exec for that. These are the variants you could take advantage of:", "First of the commands above runs one-off command inside podname with extra options if necessary. The second one will get you shell into specific container in the pod, though you should probably use shorthand for that - oc rsh.", "One command that you use could use for troubleshooting, but should never use in production environments is oc cp, which copies files to or from pod. This command can be useful if you need to get some file out of container so you can analyze it further. Another use case would be to copy files into the pod (container) to quickly fix some issue during testing, before fixing it properly in Docker image ( Dockerfile) or source code.", "I think that was enough for debugging pods and containers, but what about debugging application images? For that you should turn to skopeo:", "First command can inspect image repository, which can be useful for example in case image can\u2019t be pulled, which might happen if the tag doesn\u2019t exist or the image name got misspelled. Second one just gives you list of available tags without you needing to open the registry website, which is pretty convenient.", "When everything else fails, you might try running oc adm must-gather to get all the information available from the cluster, that could be useful for debugging. The file produced by this command can be used for your own debugging or can be sent to Red Hat support in case you need assistance.", "It\u2019s not uncommon (at least for me), that applications/deployments seem to work fine but they cannot reach each other. There are couple of reasons why that might be. Let\u2019s take following scenario \u2014 you have an application and database. Both are running just fine, but for some reason your application can\u2019t communicate with database. Here\u2019s one way you could go about troubleshooting this:", "Snippet above assumes that we already have the application and database running, as well as their respective Services. We can start debugging by trying to access the database from the application. First thing we need for that though, is IP of database, which we lok up using the first command. Next, we create carbon copy of the application using oc debug and try reaching the database pod with curl, which is successful.", "After that we repeat the test other way around and we can see curl times out, meaning that database cannot reach application IP. We then check previously created Services, nothing weird there. Finally, we check Endpoints and we can see that application pod doesn't have one. This is most likely caused by misconfiguration of respective Service, as shown by last command, where we clearly have wrong selector. After fixing this mistake (with oc edit svc/...), Endpoint gets automatically created and application is reachable.", "If your pod is failing for any kind of issue related to copying/accessing files, running binaries, modifying resources on node, etc, then it\u2019s most likely problem with Security Context Constraints. Based on the specific error you are getting, you should be able to determine the right SCC for your pod. If it\u2019s not clear though, then there are a few pointers that might help you decide:", "If your pod can\u2019t run because of UID/GID it\u2019s using, then you can check UID and GID range for each SCC:", "If these fields are set to <none> though, you should go look at project annotations:", "These annotations tell you that effective UID of your pod will be in range 1001490000 +/- 10000. if that doesn\u2019t satisfy your needs, you would have to set spec.securityContext.runAsUser: SOME_UID to force specific UID. If your pod fails after these changes, then you got to switch SCC or modify it to have different UID range.", "One neat trick to determine which SCC is needed by Service Account to be able to run a pod, is to use oc adm policy scc-subject-review command:", "What this command does, is check whether user or Service Account can create pod passed in using YAML representation. When output of this commands shows <none>, then it means that resource is not allowed. If any name of SCC is displayed instead, like for example anyuid above, then it means that this resource can be created thanks to this SCC.", "To use this command with some Service Account instead of user, add -z parameter, e.g - oc adm policy scc-subject-review -z builder.", "When output of this commands shows anything but <none>, then you know that you are good to go.", "Biggest takeaway from this article should be for you, that if something doesn\u2019t work in your OpenShift cluster, then it\u2019s probably RBAC, if not, then it\u2019s SCC. If that\u2019s also not the case, then it\u2019s networking (DNS). In all seriousness, I hope at least some of these command will save you some time next time you need to troubleshoot something in OpenShift. Also it\u2019s good to know the more common ones by heart, because you never know when you\u2019re really gonna need it. \ud83d\ude09", "This article was originally posted at martinheinz.dev", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "CKA | RHCE | DevOps Engineer at IBM | Working with Python, Kubernetes, Linux and more | https://martinheinz.dev/ | https://ko-fi.com/martinheinz"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F382664018935&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----382664018935--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----382664018935--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@martin.heinz?source=post_page-----382664018935--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=post_page-----382664018935--------------------------------", "anchor_text": "Martin Heinz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4cbd6b36e62a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&user=Martin+Heinz&userId=4cbd6b36e62a&source=post_page-4cbd6b36e62a----382664018935---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@nathananderson?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Nathan Anderson"}, {"url": "https://unsplash.com/s/photos/forest?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://martinheinz.dev/blog/26?utm_source=tds&utm_medium=referral&utm_campaign=blog_post_26", "anchor_text": "martinheinz.dev"}, {"url": "https://towardsdatascience.com/deploy-any-python-project-to-kubernetes-2c6ad4d41f14", "anchor_text": "Deploy Any Python Project to KubernetesIt\u2019s time to dive into Kubernetes and bring your Python project to Cloud with this fully-fledged project template!towardsdatascience.com"}, {"url": "https://medium.com/better-programming/save-your-linux-machine-from-certain-death-24ced335d969", "anchor_text": "Save Your Linux Machine From Certain DeathRecovering your root password and moremedium.com"}, {"url": "https://towardsdatascience.com/analyzing-docker-image-security-ed5cf7e93751", "anchor_text": "Analyzing Docker Image SecurityDocker containers are far less secure then you might think\u2026towardsdatascience.com"}, {"url": "https://medium.com/tag/devops?source=post_page-----382664018935---------------devops-----------------", "anchor_text": "DevOps"}, {"url": "https://medium.com/tag/programming?source=post_page-----382664018935---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----382664018935---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----382664018935---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/technology?source=post_page-----382664018935---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&user=Martin+Heinz&userId=4cbd6b36e62a&source=-----382664018935---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&user=Martin+Heinz&userId=4cbd6b36e62a&source=-----382664018935---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----382664018935--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F382664018935&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----382664018935---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----382664018935--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----382664018935--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----382664018935--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----382664018935--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----382664018935--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----382664018935--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----382664018935--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----382664018935--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Martin Heinz"}, {"url": "https://medium.com/@martin.heinz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5.4K Followers"}, {"url": "https://martinheinz.dev/", "anchor_text": "https://martinheinz.dev/"}, {"url": "https://ko-fi.com/martinheinz", "anchor_text": "https://ko-fi.com/martinheinz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4cbd6b36e62a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&user=Martin+Heinz&userId=4cbd6b36e62a&source=post_page-4cbd6b36e62a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff723091181e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftroubleshooting-openshift-clusters-and-workloads-382664018935&newsletterV3=4cbd6b36e62a&newsletterV3Id=f723091181e3&user=Martin+Heinz&userId=4cbd6b36e62a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}