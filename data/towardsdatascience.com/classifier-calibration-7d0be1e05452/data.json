{"url": "https://towardsdatascience.com/classifier-calibration-7d0be1e05452", "time": 1683004608.447977, "path": "towardsdatascience.com/classifier-calibration-7d0be1e05452/", "webpage": {"metadata": {"title": "Classifier calibration. The why, when and how of model\u2026 | by Dimitris Poulopoulos | Towards Data Science", "h1": "Classifier calibration", "description": "Model A is 85% accurate and 0.86 confident for each prediction. Model B is also 85% accurate but it is 0.99 confident for each prediction. Which model is better?"}, "outgoing_paragraph_urls": [{"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate", "paragraph_index": 1}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html", "anchor_text": "here", "paragraph_index": 25}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack", "paragraph_index": 29}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium", "paragraph_index": 29}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn", "paragraph_index": 29}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl", "paragraph_index": 29}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me", "paragraph_index": 31}], "all_paragraphs": ["When dealing with a classification problem, collecting only the predictions on a test set is hardly enough; more often than not we would like to compliment them with some level of confidence. To that end, we make use of the associated probability, meaning the likelihood calculated by the classifier, which specifies the class for each sample. But does this always reflect reality? And if not, how can we tell?", "Learning Rate is my weekly newsletter for those who are curious about the world of AI and MLOps. You\u2019ll hear from me every Friday with updates and thoughts on the latest AI news, research, repos and books. Subscribe here!", "Imagine we have two binary classifiers; model A and model B. Model A is 85% accurate and 0.86 confident for each prediction it makes. On the other hand, model B is also 85% accurate but 0.99 confident for each of its predictions. Which model do you think is better?", "In this story, I will try to convince you that model A is better. Model A considers itself precise 86% of the time and indeed, that's almost the case. To the contrary, model B is overconfident about its predictions. This toy example demonstrates the intuition behind probability and model calibration.", "Model calibration refers to the process where we take a model that is already trained and apply a post-processing operation, which improves its probability estimation. Thus, if we were to inspect the samples that were estimated to be positive with a probability of 0.85, we would expect that 85% of them are in fact positive.", "Formally, a model is perfectly calibrated if, for any probability value p, a prediction of a class with confidence p is correct 100*p per cent of the time.", "Now, because an image is worth a thousand words if you try to visualize it and plot every value of p, in the interval from 0 to 1, we would expect to get a perfect linear relationship between the computed probability and the fraction of positives.", "In the following sections, we see the why, when and how to calibrate your classifiers.", "Model calibration is important only if you care about the probabilities your model computes. For instance, let us say that you are building a recommender engine, that ranks products according to user preferences. If your model estimates that user u will buy product a with probability 0.9, and item b with probability 0.7, you can go ahead and serve product a first. No need to calibrate that model.", "However, if you are building a mission-critical application, which computes the probability of a person being sick, the actual probability value is significant. If, for example, your model is not that confident for a specific patient, a human doctor should certainly know about it and act accordingly.", "There are also other cases where model calibration is useful:", "So far we have seen what is model calibration and why it is important in some cases. But how can we check if our classifier is calibrated?", "The best way is to see it with our own eyes. For this experiment, we create a random dataset for classification, using the `make_classification` helper method that scikit-learn provides.", "Next, we instantiate two classifiers to compare; a simple logistic regression model and an implementation of Support Vector Machines provided by scikit-learn.", "Finally, we fit the classifiers to our training data and compute our predictions on the test data set. Specifically for the SVM, to get the probabilities for the positive class we need to know how the decision function separates the test samples, and normalize the results to be between `0` and `1`.", "Let us now plot the Kernel Density Estimation for the two classifiers.", "As we expected, the results we get from logistic regression is spread from 0 to 1, while the SVM predictions are exactly 0 or 1. Following, let us check the AUC-ROC curve for the two binary classifiers, but this time using the probabilities we calculated for the SVM.", "We can see that the SVM is almost perfect on this data set. But the accuracy is a totally different conversation than calibration. We can have a perfectly accurate model that is not calibrated at all and, on the other hand, a model that is no better than random, which is perfectly calibrated nonetheless. So, how can we check?", "The first step is to take all predictions and group them into bins. We are going to group them by the probability estimation that the model made. Next, we calculate the fraction of positives per bin and finally the average confidence per bin, which is just the average of the probability estimates of the samples that belong to that bin. If we plot that average against the fraction of positives per bin we get the reliability plot. We want that plot to resemble the linear plot we saw at the beginning.", "To plot the calibration curve of each classifier we define a utility function like the one below.", "We are now ready to plot the calibration curve for each model. Let us start with logistic regression.", "It seems pretty decent. We do the same for the SVM.", "It is evident that the SVM model is far from calibrated. We can say that is under-confident when it predicts that the sample does not belong to the positive class and overconfident otherwise. So, how can we fix this?", "The two most popular methods of calibrating a machine learning model are the isotonic and Platt's method.", "Scikit-learn provides a base estimator for calibrating models through the CalibratedClassifierCV class. For this example, we will use the Platt's method, which is equivalent to setting the method argument in the constructor of the class to sigmoid. If you want to use the isotonic method you can pass that instead.", "The outcome for the SVM classifier is impressively different. Now we have a calibrated SVM classifier. Please note that if you call the predict_proba method on the SVM classifier, the results are already calibrated via Platt's method (see here). You can try it yourself.", "Also, keep in mind that the accuracy of the model might be lower after calibration. For example, the AUC-ROC curve is now 0.963. Thus, we can see that in some case we might have a trade-off between accuracy and calibration to consider. You can always check other metrics as well (e.g. precision, recall, F1 score etc.).", "In this story, we examined what is model calibration, why and when to use it, how to check if your classifier is calibrated and how to potentially fix it if not.", "Finally, I want to give a rule of thumb, as to whether to use isotonic regression of Platt\u2019s scaling. Isotonic regression does not make the sigmoid assumption, thus, it may be a better fit for a broad amount of cases. On the other hand, it is more prone to overfit. Thus, if we have a small data set, Platt\u2019s scaling might work better.", "My name is Dimitris Poulopoulos and I\u2019m a machine learning researcher at BigDataStack and PhD(c) at the University of Piraeus, Greece. I have worked on designing and implementing AI and software solutions for major clients such as the European Commission, Eurostat, IMF, the European Central Bank, OECD, and IKEA. If you are interested in reading more posts about Machine Learning, Deep Learning and Data Science, follow me on Medium, LinkedIn or @james2pl on twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer. I talk about AI, MLOps, and Python programming. More about me: www.dimpo.me"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7d0be1e05452&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1----7d0be1e05452---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@hautier?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Christophe Hautier"}, {"url": "https://unsplash.com/s/photos/balance?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html", "anchor_text": "here"}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack"}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium"}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7d0be1e05452---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/supervised-learning?source=post_page-----7d0be1e05452---------------supervised_learning-----------------", "anchor_text": "Supervised Learning"}, {"url": "https://medium.com/tag/classification?source=post_page-----7d0be1e05452---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/tag/scikit-learn?source=post_page-----7d0be1e05452---------------scikit_learn-----------------", "anchor_text": "Scikit Learn"}, {"url": "https://medium.com/tag/programming?source=post_page-----7d0be1e05452---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----7d0be1e05452---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----7d0be1e05452---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7d0be1e05452&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7d0be1e05452---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7d0be1e05452--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7d0be1e05452--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7d0be1e05452--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://dpoulopoulos.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12.5K Followers"}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb5ab149102ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifier-calibration-7d0be1e05452&newsletterV3=7cc87df5b1&newsletterV3Id=b5ab149102ea&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}