{"url": "https://towardsdatascience.com/covid-19-and-pneumonia-detection-with-transfer-learning-400a8150268", "time": 1683015958.230928, "path": "towardsdatascience.com/covid-19-and-pneumonia-detection-with-transfer-learning-400a8150268/", "webpage": {"metadata": {"title": "Covid-19 and Pneumonia Detection with Transfer Learning | by Luke Sun | Towards Data Science", "h1": "Covid-19 and Pneumonia Detection with Transfer Learning", "description": "In previous posts, we created several CNN networks for business problems ranging from fashion design, cancer detection, and animal detection etc. In this post, we will revisit the CNN topic. But\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "Deep Residual Learning for Image Recognition", "paragraph_index": 4}, {"url": "https://github.com/luke4u/CNN-Image-Classification", "anchor_text": "repos", "paragraph_index": 30}], "all_paragraphs": ["In previous posts, we created several CNN networks for business problems ranging from fashion design, cancer detection, and animal detection etc. In this post, we will revisit the CNN topic. But instead of creating a model from scratch, we will use transfer learning and build the network on the top of a famous CNN architecture: ResNet50.", "\u201cIf I have seen further, it is by standing on the shoulders of giants.\u201d Isaac Newton in 1675", "AI and ML have been revolutionizing healthcare and medicine industry. According to a study published on Nature, artificial intelligence is more accurate than doctors in diagnosing breast cancer from mammograms. Recently, researchers from Google Health and Imperial College London trained a model on X-ray images from nearly 29,000 women. The algorithm outperformed six radiologists in reading mammograms \ud83d\udc4f\ud83d\udc4f.", "Here our goal is to automate the process of detecting and classifying chest disease and reduce the cost and time of detection.", "ResNet50 is a 50-layer deep residual network introduced by He et al. in their 2015 paper, Deep Residual Learning for Image Recognition. It is based on residual learning, the same architecture used by its fellows like ResNet101 and ResNet152.", "So, what is residual learning? Generally, \u201cdeeper is better\u201d when creating neural networks. With more layers, the network tends to learn more features with better generalization. However, there is a limit. As the model goes deeper, the training of the neural network becomes difficult, and the model performance starts to saturate and even degrade. This is largely caused by the notorious vanishing gradient problem. When the gradient is backpropagated to earlier layers, repeated multiplications of derivatives make the gradient infinitely small, which makes it impossible to update the weights of earlier layers. Residual learning is one of the breakthroughs to solve this problem.", "In contrast to CNN which learns features of input images, residual learning learns the \u2018residual\u2019 (isn\u2019t that obvious?\ud83e\udd2d\ud83e\udd2d). Well, if not, residual can be understood as the subtraction of features from the input images. ResNet does this by introducing a so-called \u201cidentity shortcut connection\u201d which skips one or more intermediate layers. In other words, the output of an early layer is provided to a deeper layer without any transformation as shown in Fig.1.", "With the short-cut connection, the desired mapping is F(X) + X. So, the residual block only needs to focus on the residual learning F(X), because it can at least learn X by forcing F(X) to zero. The intuition behind the skip connection is that it is easier to learn the residual than any other direct mapping. This drives the deeper layers to learn something different from what the input has already encoded. Meanwhile, it allows training very deep networks without worrying about the degradation problem.", "ResNet architecture contains 2 kinds of residual blocks: Identity block and Conv block. Fig.2 shows the identity block. The main branch has a convolution layer, followed by batch normalization and an activation layer which typically uses ReLu. After this, another unit of a convolution layer, batch normalization and an activation layer. Then we add a 3rd convolution layer and batch normalization. The output from the batch norm is added together with the original input before activation. Identity blocks work well when the shape of input X is the same as the output from the main branch.", "The 2nd type is Conv block as shown in Fig.3. The only difference is adding a convolution layer and batch normalization in the shortcut path to match the output shape of the main branch.", "In total, ResNet50 architecture consists of 4 Conv blocks and 12 Identity blocks, and 1 normal convolution layer and 1 dense layer.", "We are given 133 images for each class: Healthy; Covid-19; Bacterial Pneumonia; Viral Pneumonia. The images are saved in a local drive, so we will use flow_from_directory() method from Keras to read the images. Specifically,", "Let\u2019s have a touch on the images of each class. Fig.4 shows the grayscale images. People like me cannot tell a bit about their difference \ud83d\ude2d\ud83d\ude2d. But no worries \ud83d\ude0e\ud83d\ude0e! That is a job for the model.", "As mentioned earlier, we will make transfer learning from a pre-trained ResNet50 model. It is trained on ImageNet dataset which contains 11 million images and 11,000 categories, enormous compared to the dataset we got here.", "First, let\u2019s load the model, and specify how to use it for our purpose.", "Note, we did not include the top classification layer, because we will create our own classifier head. We defined the input tensor shape to the same as in the image generator.", "Generally, there are different strategies for transfer learning. We can freeze the early layers and train the rest layers if the pre-training dataset and the new dataset are similar and the size of your dataset is small. If you are tasked with a large dataset, you may need to retrain the whole model with the weights initialized from the pre-trained model.", "In our case, our dataset is quite small, allowing us to freeze the early layers. So,", "I think this section is the fun part, as you will see how to \u201cstanding on the shoulders of giants\u201d.", "Look at below architecture carefully. We take the ResNet50 model output as input for its following layers. We stacked 3 Dense layers with dropout before adding the final Dense layer for the output.", "The parameters including the number of neurons and dropout rate are experimented with grid search to show the best results, though not elaborated here.", "Also notice we use 2 metrics to assess the training: F1 score and accuracy. Based on my extensive experimentations, the model tends to misclassify Bacterial Pneumonia greatly somehow. So, using the F1 score will allow us to have a balanced model performance.", "In addition, we use early stopping to monitor the progress and checkpoints to save the weight file.", "Great. The number of epochs (20) and batch size (8) are optimized to produce the best results. So to train the model,", "Fig.5 show the model accuracy gradually increases to around 0.75, and the loss reduces to about 0.65. Another point is that the training process is stable without abrupt peaks or valleys.", "Fig.6 shows the model accuracy during validation. The model reached a validation accuracy of about 0.65 to 0.7, indicating minor overfitting.", "Finally, let\u2019s look at the model performance on the test dataset.", "Fig.7 shows the predicted and actual classes for 15 images. The model has done very well to predict Covid-19 correctly. The classification report, as shown in Fig.8, indicates that for Covid-19, the model got 100% recall \u2728\u2728. It means out of 10 Covid-19 images, it managed to predict all correctly. For Pneumonia, recall is not ideal, with about 50% to 60% predicted correctly. Certainly, the model has space to improve.", "We demonstrated how to use transfer learning to create a customized model for Covid-19/ Pneumonia prediction. With only about 500 images, we managed to achieve a decent result, particularly on Covid-19 detection.", "What is interesting to do next, if you want to get your hands dirty, is to refit the model only on the normal and Covid-19 images. Creating a Covid-19 detection model would be a wonderful little thing we can contribute to fighting against it.", "Great! That\u2019s all of the journeys. Hope you have enjoyed it. If you need the code, please visit my Github repos \ud83d\udc95\ud83d\udc95.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Enthusiast, Data Scientist, Python Developer. Love to share articles about technology."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F400a8150268&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lukesun.medium.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": ""}, {"url": "https://lukesun.medium.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": "Luke Sun"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7b5b79d21508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&user=Luke+Sun&userId=7b5b79d21508&source=post_page-7b5b79d21508----400a8150268---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/photos/easter-eggs-virus-covid-19-4978337/", "anchor_text": "link"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "Deep Residual Learning for Image Recognition"}, {"url": "https://github.com/luke4u/CNN-Image-Classification", "anchor_text": "repos"}, {"url": "https://medium.com/tag/cnn?source=post_page-----400a8150268---------------cnn-----------------", "anchor_text": "Cnn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----400a8150268---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----400a8150268---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----400a8150268---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/resnet50?source=post_page-----400a8150268---------------resnet50-----------------", "anchor_text": "Resnet50"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&user=Luke+Sun&userId=7b5b79d21508&source=-----400a8150268---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&user=Luke+Sun&userId=7b5b79d21508&source=-----400a8150268---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F400a8150268&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----400a8150268---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----400a8150268--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----400a8150268--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----400a8150268--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----400a8150268--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----400a8150268--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----400a8150268--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----400a8150268--------------------------------", "anchor_text": ""}, {"url": "https://lukesun.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lukesun.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Luke Sun"}, {"url": "https://lukesun.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "141 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7b5b79d21508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&user=Luke+Sun&userId=7b5b79d21508&source=post_page-7b5b79d21508--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F38f46069f6d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcovid-19-and-pneumonia-detection-with-transfer-learning-400a8150268&newsletterV3=7b5b79d21508&newsletterV3Id=38f46069f6d3&user=Luke+Sun&userId=7b5b79d21508&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}