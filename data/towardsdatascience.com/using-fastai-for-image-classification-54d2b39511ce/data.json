{"url": "https://towardsdatascience.com/using-fastai-for-image-classification-54d2b39511ce", "time": 1682996663.995557, "path": "towardsdatascience.com/using-fastai-for-image-classification-54d2b39511ce/", "webpage": {"metadata": {"title": "Using Fastai for Image Classification | by Pascal Schr\u00f6der | Towards Data Science", "h1": "Using Fastai for Image Classification", "description": "Learn how to build a state-of-the-art image classifier in no time using the fastai library"}, "outgoing_paragraph_urls": [{"url": "https://course.fast.ai/", "anchor_text": "2019 course on deep learning", "paragraph_index": 0}, {"url": "https://www.kaggle.com/c/plant-seedlings-classification", "anchor_text": "plant seedling dataset from Kaggle", "paragraph_index": 1}, {"url": "https://www.fast.ai/", "anchor_text": "homepage", "paragraph_index": 2}, {"url": "https://www.fast.ai/2017/09/08/introducing-pytorch-for-fastai/", "anchor_text": "(Source)", "paragraph_index": 2}, {"url": "https://www.youtube.com/watch?v=-P28LKWTzrI", "anchor_text": "video", "paragraph_index": 3}, {"url": "https://paperspace.com", "anchor_text": "Paperspace", "paragraph_index": 4}, {"url": "https://enterprise.braincradle.com/", "anchor_text": "Cradle", "paragraph_index": 4}, {"url": "https://aws.amazon.com/deep-learning/", "anchor_text": "AWS", "paragraph_index": 4}, {"url": "https://towardsdatascience.com/fast-ai-lesson-1-on-google-colab-free-gpu-d2af89f53604", "anchor_text": "Medium post", "paragraph_index": 5}, {"url": "https://towardsdatascience.com/@manikantayadunanda", "anchor_text": "Manikanta Yadunanda", "paragraph_index": 5}, {"url": "http://localhost:8888/files/kaggle.com", "anchor_text": "Kaggle", "paragraph_index": 7}, {"url": "https://docs.fast.ai/vision.data.html#ImageDataBunch", "anchor_text": "ImageDataBunch", "paragraph_index": 14}, {"url": "https://docs.fast.ai/vision.learner.html#create_cnn", "anchor_text": "create_cnn()", "paragraph_index": 22}, {"url": "https://docs.fast.ai/metrics.html", "anchor_text": "docs", "paragraph_index": 23}, {"url": "https://course.fast.ai/", "anchor_text": "Fastai MOOC", "paragraph_index": 34}, {"url": "https://docs.fast.ai/", "anchor_text": "Fastai library", "paragraph_index": 34}, {"url": "https://www.kaggle.com/c/plant-seedlings-classification", "anchor_text": "Plant Seedling Dataset", "paragraph_index": 34}], "all_paragraphs": ["I recently took a peek into Jeremy Howard\u2019s 2019 course on deep learning. I never used the Fastai library before so I was pretty amazed by its level of abstraction that allows you to create stage-of-the-art neural networks in minutes, with a ridiculously tiny amount of code. In the following I will offer a short tutorial on building a CNN image classifier with Fastai that is supposed to act simultaneously as a helpful summary of the key concepts for myself and a clear overview for newcomers.", "I chose the plant seedling dataset from Kaggle as an examplary dataset.", "If you haven\u2019t heard of Fastai yet I recommend taking a look at their homepage. In their mission statement it is stated that not only do they want to accelerate and help deep learning research, they also want to decrease the entry barriers for everyone. This line is from their introduction of PyTorch for Fastai back in September 2017 (Source):", "You can feel this ambition even if you watch Fastai's 2019 course, and it's something that gives me a good feeling about the direction the field is headed. As it often happens in research, knowledge and tools are only accessible to a certain minority. This is even more pronounced in deep learning research, where you need huge amounts of RAM in powerful GPUs to solve a lot of problems (check this unrelated video on GPU vs CPU).", "In addition, support for Fastai is now offered on a lot of cloud computing platforms, like Paperspace, Cradle and AWS, just to name a few. But since these services all cost money, I will stick to Google's just recently announced Colaboratory, that let's you use Google's GPUs for free. Yes, zero cost! Ain't that incredible times to be alive?", "To avoid redundancy online, please check this Medium post by Manikanta Yadunanda for a quick introduction on how to use the Google Colaboratory (Colab) with Fastai. Since this introduction was written, Google has included official Fastai and PyTorch support in Colab, so you probably don't even need to install it after connecting to a runtime. You can check with the following line of code if all of the important pip packages are installed. If not, uncomment the last line and use it to install Fastai and PyTorch for Python 3.6.x and CUDA 9.x.", "To access this notebook and run the computations yourself, you can simply import it directly from my GitHub repository. Just go to File\u2026 Open Notebook\u2026, select the GitHub tab and enter \u2018verrannt/Tutorials\u2019 in the search bar. Select the \u2018fastai-plant-seedlings-classification.ipynb\u2019 and you\u2019re done. Simple as that. After you checked that Colab is configured for Fastai support, you can continue with the data preperation part.", "Since we are using Kaggle as our dataset supply, you need a Kaggle account to download the dataset. If you got one, head over to your account settings and get a new API key which you can use for the Kaggle CLI.", "The following code installs the CLI and registers a new API key. We then download the plant seedling dataset and unzip it. Make sure that you are in the /content folder of the fastai directory.", "Let\u2019s inspect the data. The folder we downloaded and extracted from Kaggle has 12 subfolders, each of which corresponds to one type of seedling with its respective images inside. These will be our labels for the classification task.", "If we print the lengths of the contents of these folders we can see that every folder contains a different amount of images. The differences are great, see e.g. that the \u2018Loose Silky-bent\u2019 has the most images (762) while the \u2018Common Wheat\u2019 the fewest (253). We will see later if this amounts to differences in the prediction accuracy.", "Let\u2019s have a look at those images. For each of the 12 labels, we will print one random seedling.", "Alright, they look good and quite distinguishable, except for \u2018Loose Silky-bent\u2019 and \u2018Black-grass\u2019. These might be harder for the network to recognize, but we will see. Let\u2019s get to it!", "We can now create the CNN model using the Fastai library. Since its major update to v1, it got a lot clearer and consistent, so we only need to import the vision module and accuracy for our metric.", "Fastai has a really nice class for handling everything related to the input images for vision tasks. It is called ImageDataBunch and has different functions, respective of the different ways data can be presented to the network. Since our images are placed in folders whose names correspond to the image labels, we will use the ImageDataBunch.from_folder() function to create an object that contains our image data. This is super useful and makes it incredibly easy to read the data into our model, as you will see in a bit.", "What\u2019s even more handy is that Fastai can automatically split our data into train and validation sets, so we don't even need to create these on our own.", "The only hyperparameters we need now are the path-variable pointing to our data set, the size of the inputs and the batch size for each gradient descent iteration. To make matters simple, the ImageDataBunch object will scale all images to a size*size squared image unless otherwise instructed.", "A quick note on image size: the bigger an image, the more details the CNN will be able to pick out of it. At the same time, a bigger image means longer computation times. On the same note it might be that your GPU runs out of memory for a too large batch size. You can half the batch size if this is the case.", "We will create a variable called data in which we place the ImageDataBunch object. We create this object with the from_folder() function that we discussed above. Among the path to our data, the image and batch size, it also takes:", "To normalize the data in our object, we simply call normalize() on the object. It is possible to use ImageNet, CIFAR or MNIST stats as templates here, and if left empty this function will simply grab a batch of data from our object and compute the stats on it (mean and standard-deviation) and normalize the data accordingly. Since we will be using a ResNet architecture for our model which was trained on ImageNet, we will be using the ImageNet stats.", "That\u2019s it, two lines of code for optimizing our dataset for training, adding different kinds of transformations and normalization! I would kindly ask you to stop here for a moment and just take a second to appreciate the beauty of this. The beauty of high-level libraries; just two lines of code and we have increased the diversity of our dataset tremendously. I can already hear my ugly batchnorm code crying in the trashbin.", "All that is left now is to create the actual network and train it, which could not be more simple.", "Fastai supplies us with a function called create_cnn() from its vision module. This function creates what is called a learner object, which we'll put into a properly named variable. See here that we specify the ResNet architecture as our base model for transfer learning. Upon call, the trained architecture will be downloaded via the Fastai API and stored locally.", "We will use accuracy for our metric. If you check the docs you can see a list of other metrics which are availabe. Defining the callback function ShowGraph simply tells the learner that it should return a graph for whatever it does, which seems very useful to me for seeing whether the model is still improving.", "The learner object we create comes with a build-in function to find the optimal learning rate, or range of learning rates, for training. It achieves this by fitting the model for a few epochs and saving for which learning rates the loss decreases the most.", "We want to choose a learning rate, for which the loss is still decreasing, i.e. we do not want the learning rate with the minimum loss, but with the steepest slope.", "In the following plot, which is stored in the recorder object of our learner, we can see that this is the case for learning rates between 0.001 and 0.01.", "Now let\u2019s fit our model for 8 epochs, with a learning rate between 0.001 and 0.01", "That already looks good! The loss is decreasing a lot in the first few 1/5th of iterations, and less but continously afterwards.", "Let\u2019s see where the algorithm is making the most mistakes:", "This shows us that the algorithm confuses the classes \u2018black-grass\u2019 and \u2018loose silky-bent\u2019 most often. We already saw on the sample images we displayed earlier that these look the most alike, so this makes sense.", "Before we unfreeze the layers and learn again, we save the weights so that we can go back in case we mess up.", "We will stick to this, because the validation error is getting worse than the testing error, and it looks like this tendency will only increase. The model would start to overfit the training data if we continue training from this point onwards!", "Good job, we successfully trained a state-of-the-art image classifier for a custom dataset, achieving 96.5% accuracy in just a handful of lines of code!", "Sources[1] Fastai MOOC[2] Fastai library[3] Plant Seedling Dataset", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Cognitive Science Student at the University of Osnabr\u00fcck | Cognitive Science & A.I., Body & Mind, Humans & Transistors"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F54d2b39511ce&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@psclschrdr?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@psclschrdr?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Pascal Schr\u00f6der"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7084b3a7bd28&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&user=Pascal+Schr%C3%B6der&userId=7084b3a7bd28&source=post_page-7084b3a7bd28----54d2b39511ce---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://course.fast.ai/", "anchor_text": "2019 course on deep learning"}, {"url": "https://www.kaggle.com/c/plant-seedlings-classification", "anchor_text": "plant seedling dataset from Kaggle"}, {"url": "https://www.fast.ai/", "anchor_text": "homepage"}, {"url": "https://www.fast.ai/2017/09/08/introducing-pytorch-for-fastai/", "anchor_text": "(Source)"}, {"url": "https://www.youtube.com/watch?v=-P28LKWTzrI", "anchor_text": "video"}, {"url": "https://paperspace.com", "anchor_text": "Paperspace"}, {"url": "https://enterprise.braincradle.com/", "anchor_text": "Cradle"}, {"url": "https://aws.amazon.com/deep-learning/", "anchor_text": "AWS"}, {"url": "https://towardsdatascience.com/fast-ai-lesson-1-on-google-colab-free-gpu-d2af89f53604", "anchor_text": "Medium post"}, {"url": "https://towardsdatascience.com/@manikantayadunanda", "anchor_text": "Manikanta Yadunanda"}, {"url": "http://localhost:8888/files/kaggle.com", "anchor_text": "Kaggle"}, {"url": "https://docs.fast.ai/vision.data.html#ImageDataBunch", "anchor_text": "ImageDataBunch"}, {"url": "https://docs.fast.ai/vision.learner.html#create_cnn", "anchor_text": "create_cnn()"}, {"url": "https://docs.fast.ai/metrics.html", "anchor_text": "docs"}, {"url": "https://course.fast.ai/", "anchor_text": "Fastai MOOC"}, {"url": "https://docs.fast.ai/", "anchor_text": "Fastai library"}, {"url": "https://www.kaggle.com/c/plant-seedlings-classification", "anchor_text": "Plant Seedling Dataset"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----54d2b39511ce---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----54d2b39511ce---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/convolution-neural-net?source=post_page-----54d2b39511ce---------------convolution_neural_net-----------------", "anchor_text": "Convolution Neural Net"}, {"url": "https://medium.com/tag/fastai?source=post_page-----54d2b39511ce---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/image-classification?source=post_page-----54d2b39511ce---------------image_classification-----------------", "anchor_text": "Image Classification"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&user=Pascal+Schr%C3%B6der&userId=7084b3a7bd28&source=-----54d2b39511ce---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&user=Pascal+Schr%C3%B6der&userId=7084b3a7bd28&source=-----54d2b39511ce---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F54d2b39511ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----54d2b39511ce---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----54d2b39511ce--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----54d2b39511ce--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----54d2b39511ce--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@psclschrdr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@psclschrdr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Pascal Schr\u00f6der"}, {"url": "https://medium.com/@psclschrdr/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "21 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7084b3a7bd28&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&user=Pascal+Schr%C3%B6der&userId=7084b3a7bd28&source=post_page-7084b3a7bd28--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F7084b3a7bd28%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-fastai-for-image-classification-54d2b39511ce&user=Pascal+Schr%C3%B6der&userId=7084b3a7bd28&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}