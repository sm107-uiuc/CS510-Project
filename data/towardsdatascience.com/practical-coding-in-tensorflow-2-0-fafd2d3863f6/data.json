{"url": "https://towardsdatascience.com/practical-coding-in-tensorflow-2-0-fafd2d3863f6", "time": 1683000956.699699, "path": "towardsdatascience.com/practical-coding-in-tensorflow-2-0-fafd2d3863f6/", "webpage": {"metadata": {"title": "Practical Coding in TensorFlow 2.0 | by Dmitry Grebenyuk | Towards Data Science", "h1": "Practical Coding in TensorFlow 2.0", "description": "A coding guide for making a dataset from a numpy array (from_tensor_slices) and writing/reading images and arrays into/from TFRecord files."}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/install", "anchor_text": "page", "paragraph_index": 1}], "all_paragraphs": ["In this blog post, I will show how to use tf.dataset in TF 2. Also, we make a dataset from a numpy array and learn how to write/read images and arrays into/from TFRecord files.", "To install TF 2.x, please visit this page.", "The easiest and the most efficient way to feed data to a network is to use tf.dataset. The class has undergone significant changes in TF 2. The dataset itself is an iterator now and can be itarated with a for-loop.", "Let\u2019s make a dataset first. For a small amount of data that can be stored in memory, we can make a dataset from a numpy array:", "By convention, the first dimension is the number of training examples. The iterator can yield any batch size. By default, it yields individual training examples, i.e. the batch size of 1.", "The for-loop stops at the end of the dataset. To iterate over the dataset several times, use .repeat().", "We can enumerate each batch by using either Python\u2019s enumerator or a build-in method. The former produces a tensor, which is recommended.", "If you do not need a whole dataset, you can take a desired number of batches from it:", "To iterate over batches bigger than 1, you have to specify the batch size.", "We also can shuffle the data before feeding it to a network. This fills a buffer with buffer_size elements, then randomly samples elements from this buffer, replacing the selected elements with new elements. For perfect shuffling, a buffer size should be equal to the full size of the dataset. There is an example with buffer_size 5. In practice, we use buffer size equals to several batch sizes.", "You can see that the result is not uniform but good enough.", "However, if you apply the methods in a different order, you will get an unexpected result. It shuffles batches, not elements.", "You also can prepare your data while reading it from the dataset by using .map(). The function order is essential here. For example, now transform is applied to each batch.", "Reading and processing a dataset often becomes timeconsuming. To make a constant stream of data for training hence to keep your GPU busy, you can prefetch several batches. To do so, you have to apply .prefetch(buffer_size=tf.data.experimental.AUTOTUNE) as the last method. By using autotune, you allow TF to find the optimal buffer size.", "You can make a dataset from a numpy array only when the array is reasonably small and can be stored in memory. For bigger datasets, such as images, I suggest using TF homegrown data format tfrecord.", "Note: I have tried to use h5, but its support is minimal, and the data reading is slower. Thus, we stuck withtfrecord for now.", "Suppose you want to store an image and an array with actions as one record: a single training example.", "First, we have to define a helper function:", "To make a byte string from an image and action.", "tf.train.Example is a misleading name for a record.", "Now we can write all the examples into a file:", "To read from a file, we have to perform our actions in the opposite order. We need two helper functions: first for parsing from byte strings to tensors, second for decoding images.", "Now we can read from a file.", "Further, you can apply any desired shuffling or mapping if needed.", "Note: I tried to use h5 but its support is very limited and its reading speed is slower. Thus, we stuck to tfrecord for now.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "MPhil student in AI at the University of Melbourne"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffafd2d3863f6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@rendok?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rendok?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Dmitry Grebenyuk"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9c49b8440b2e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&user=Dmitry+Grebenyuk&userId=9c49b8440b2e&source=post_page-9c49b8440b2e----fafd2d3863f6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@thefredyjacob?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Fredy Jacob"}, {"url": "https://unsplash.com/s/photos/data?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.tensorflow.org/install", "anchor_text": "page"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----fafd2d3863f6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/programming?source=post_page-----fafd2d3863f6---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----fafd2d3863f6---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&user=Dmitry+Grebenyuk&userId=9c49b8440b2e&source=-----fafd2d3863f6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&user=Dmitry+Grebenyuk&userId=9c49b8440b2e&source=-----fafd2d3863f6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffafd2d3863f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fafd2d3863f6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fafd2d3863f6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rendok?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rendok?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dmitry Grebenyuk"}, {"url": "https://medium.com/@rendok/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "38 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9c49b8440b2e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&user=Dmitry+Grebenyuk&userId=9c49b8440b2e&source=post_page-9c49b8440b2e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F76b60eac0dfd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpractical-coding-in-tensorflow-2-0-fafd2d3863f6&newsletterV3=9c49b8440b2e&newsletterV3Id=76b60eac0dfd&user=Dmitry+Grebenyuk&userId=9c49b8440b2e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}