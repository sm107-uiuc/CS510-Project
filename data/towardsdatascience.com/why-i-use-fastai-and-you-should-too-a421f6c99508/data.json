{"url": "https://towardsdatascience.com/why-i-use-fastai-and-you-should-too-a421f6c99508", "time": 1683016259.06191, "path": "towardsdatascience.com/why-i-use-fastai-and-you-should-too-a421f6c99508/", "webpage": {"metadata": {"title": "Why I use Fastai and you should too. | by Akash Shastri | Towards Data Science", "h1": "Why I use Fastai and you should too.", "description": "The general consensus on finding the best LR was usually to train a model fully, until the desired metric was achieved, with different optimizers at different LRs. The optimal LR and optimizer are\u2026"}, "outgoing_paragraph_urls": [{"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://fastai1.fast.ai/callbacks.one_cycle.html#The-1cycle-policy", "anchor_text": "here", "paragraph_index": 15}, {"url": "https://github.com/akash-shastri", "anchor_text": "https://github.com/akash-shastri", "paragraph_index": 24}, {"url": "https://www.linkedin.com/in", "anchor_text": "https://www.linkedin.com/in", "paragraph_index": 24}], "all_paragraphs": ["The general consensus on finding the best LR was usually to train a model fully, until the desired metric was achieved, with different optimizers at different LRs. The optimal LR and optimizer are picked depending on what combination of them worked best in the picking phase. This is an ok technique, although computationally expensive.", "Note: As I was introduced early in my deep learning career to fastai, I do not know a lot about how things are done without/before fastai, so please let me know if this was a bit inaccurate, also take this section with a grain of salt.", "The fastai way to LRs is influenced by Leslie Smith\u2019s Paper [1]. There are mainly 3 components to finding the best LR, find an optimal LR for training (explained in LR find section), As training progresses, reduce the LR (explained in LR annealing section), and a few caveats for transfer learning (explained in discriminative LR) and one cycle training (part of LR annealing).", "What should our learning rate be?This is an important question to ask, as the learning rate is what drives the parameters of our model to optimal solutions. Too low and the learning will take too long. Too high and the model will NOT EVEN learn. We need a learning rate in a range of values that drives parameters to convergence while doing so at a reasonable pace.", "LR find is fastai\u2019s approach to finding a good learning rate. They do this by selecting a very low LR at first, training one mini-batch at this LR, and calculate the loss. The next mini-batch is trained at an incrementally higher LR, and this process continues till we reach an LR where the model clearly diverges.", "LR is plotted against loss, and we can see our graph below. There is a certain LR where loss is minimum, after which increasing LR any more will worsen loss.", "Picking the LR where loss is lowest is erroneous. We need the LR for which loss decreases the fastest. This is also the steepest part of the graph. Fastai implements a function to find both the steepest and the minimum LR divided by 10 (which is also a good LR to train on)", "This method is computationally cheaper and faster, as we need only 1 epoch (not even that) to find the optimal LR, whereas traditionally we would train 1 epoch for each logical range of LR (definitely more than 1 epoch in total).", "The next step of the puzzle is LR annealing. Initially, our parameters are imperfect. They are very far from optimal parameters. But as we train, the parameters get closer to the optimal values.", "When our parameters are very far from optima (beginning) we want to take larger, more imprecise steps, in the general direction of optima. But as we get closer, we don\u2019t want to take large steps and accidentally overshoot optima, we want to take smaller steps to get a precise perfect parameter set.", "This is analagous to golf. You don\u2019t attempt a hole in one, (you could but that\u2019s more luck than skill) you simply try to lob the ball as far as possible in the general direction of the hole. And as you get closer, you change your clubs to gain more precision and control, and look for smaller steps, each inching you closer to the hole.", "This is why at the beginning of training, we want large learning rates, that push us hard and fast towards optimal parameters, but as we get closer, we want to lower the learning rate. As our loss decreases, we want to take smaller steps, and hence use a smaller LR.", "This process of altering LR during training is called LR decay/ LR annealing. The figure below shows the large initial steps contrasted with the smaller final steps.", "The current general consensus on the difficulty of GD (gradient-descent) based training is that the optimizer can get stuck in saddle points. This is different from what we used to think was the main issue ( local minima). Leslie Smith shows in [3] that increasing the LR helps escape saddle points and get to a good region of the loss function, after this, we once again reduce the LR for reasons explained in LR annealing. However, there\u2019s one final step to the fit one cycle approach as explained by Sylvain Gugger here, which is to reduce the LR to one-hundredth of the minimum LR for the last few iterations. Also known as annihilation.", "The steps are simple, pick an LR as explained in the LR find section of this article. That is the maximum acceptable LR. We also choose a minimum LR which is, as suggested by Sylvain, to be one-tenth the maximum LR. Now we cycle between this range, where the cycle length is slightly lesser than the total number of epochs. And in the last part, we reduce LR to one-hundredth of the minimum LR.", "There are 2 main parameters to use when scheduling LR, which is what we\u2019re doing during the one cycle policy. And these are momentum and step size. For more information and further reading on how LR is scheduled, check here.", "Transfer learning is the process of using a neural network trained for one task, to do a different task after minimal training. This is extremely useful for reasons I will explain now.", "Zeiler and Fergus published an amazing paper called Visualizing and Understanding Convolutional Networks [2], In which they show what different layers of a neural network learn, and they visualize what is learned by different layers. From the image below, we can see the first layer recognizes basic lines, colours, and colour gradients. The second layer recognizes more complex shapes like edges and circles, and then by the third layer, the network starts recognizing patterns.", "Now consider you have a cat detector, which can recognize a cat. And you want to make a bear detector. A cat is much more similar to a bear than random noise, and most layers have of a cat detector have already learned very useful parameters. So we only need to fine-tune the model and change the last few layers.", "And fastai is perfect for doing this. The fastai approach to transfer learning is basically 2 steps.", "The 4 lines of code to do transfer learning with fast ai are", "The graph below is a graph of LR plotted against loss after the model is unfrozen. As we can see, there\u2019s no steep descent of loss, this is in line with our idea that initial layers have learned useful information. Hence the low loss even at the start, and gradual decline.", "The method for selecting LR remains same, minima/10 or point of steepest descent", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I love anything that makes me think. Check out my github here: https://github.com/akash-shastri. Get in touch with me on LinkedIn at https://www.linkedin.com/in"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa421f6c99508&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://akashgshastri.medium.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": ""}, {"url": "https://akashgshastri.medium.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Akash Shastri"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F567a94bbd3d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&user=Akash+Shastri&userId=567a94bbd3d8&source=post_page-567a94bbd3d8----a421f6c99508---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.fast.ai/callback.schedule#Learner.lr_find", "anchor_text": "[docs]"}, {"url": "https://github.com/fastai/fastbook", "anchor_text": "fastiai\u2019s fastbook"}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "here"}, {"url": "https://commons.wikimedia.org/w/index.php?curid=20570051", "anchor_text": "https://commons.wikimedia.org/w/index.php?curid=20570051"}, {"url": "https://fastai1.fast.ai/basic_train.html#Learner", "anchor_text": "Learner"}, {"url": "https://fastai1.fast.ai/callback.html#Callback", "anchor_text": "Callback"}, {"url": "https://fastai1.fast.ai/train.html#fit_one_cycle", "anchor_text": "docs"}, {"url": "https://fastai1.fast.ai/callbacks.one_cycle.html#The-1cycle-policy", "anchor_text": "here"}, {"url": "https://arxiv.org/pdf/1311.2901.pdf", "anchor_text": "Visualizing and Understanding Convolutional Networks"}, {"url": "https://github.com/fastai/fastbook", "anchor_text": "fastiai\u2019s fastbook"}, {"url": "https://arxiv.org/search/cs?searchtype=author&query=Smith%2C+L+N", "anchor_text": "Leslie N. Smith"}, {"url": "https://arxiv.org/abs/1803.09820", "anchor_text": "arXiv:1803.09820"}, {"url": "https://arxiv.org/search/cs?searchtype=author&query=Zeiler%2C+M+D", "anchor_text": "Matthew D Zeiler"}, {"url": "https://arxiv.org/search/cs?searchtype=author&query=Fergus%2C+R", "anchor_text": "Rob Fergus"}, {"url": "https://arxiv.org/abs/1311.2901", "anchor_text": "arXiv:1311.2901"}, {"url": "https://arxiv.org/search/cs?searchtype=author&query=Smith%2C+L+N", "anchor_text": "Leslie N. Smith"}, {"url": "https://arxiv.org/abs/1506.01186", "anchor_text": "arXiv:1506.01186"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a421f6c99508---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/ai?source=post_page-----a421f6c99508---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a421f6c99508---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/fastai?source=post_page-----a421f6c99508---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----a421f6c99508---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&user=Akash+Shastri&userId=567a94bbd3d8&source=-----a421f6c99508---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&user=Akash+Shastri&userId=567a94bbd3d8&source=-----a421f6c99508---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa421f6c99508&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a421f6c99508---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a421f6c99508--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a421f6c99508--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a421f6c99508--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a421f6c99508--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a421f6c99508--------------------------------", "anchor_text": ""}, {"url": "https://akashgshastri.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://akashgshastri.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Akash Shastri"}, {"url": "https://akashgshastri.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "63 Followers"}, {"url": "https://github.com/akash-shastri", "anchor_text": "https://github.com/akash-shastri"}, {"url": "https://www.linkedin.com/in", "anchor_text": "https://www.linkedin.com/in"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F567a94bbd3d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&user=Akash+Shastri&userId=567a94bbd3d8&source=post_page-567a94bbd3d8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdbc934e1d566&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-i-use-fastai-and-you-should-too-a421f6c99508&newsletterV3=567a94bbd3d8&newsletterV3Id=dbc934e1d566&user=Akash+Shastri&userId=567a94bbd3d8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}