{"url": "https://towardsdatascience.com/dont-repeat-these-5-mistakes-with-sql-9f61d6f5324f", "time": 1683016294.28442, "path": "towardsdatascience.com/dont-repeat-these-5-mistakes-with-sql-9f61d6f5324f/", "webpage": {"metadata": {"title": "Don\u2019t Make These 5 Mistakes with SQL | by Roman Orac | Towards Data Science", "h1": "Don\u2019t Make These 5 Mistakes with SQL", "description": "SQL and Machine Learning have a few things in common. It\u2019s easy to start with one as it doesn\u2019t require a lot of coding. Also, code rarely crashes. I would argue that the fact that the SQL queries\u2026"}, "outgoing_paragraph_urls": [{"url": "http://sqlfiddle.com/#!15/9eecb7db59d16c80417c72d1e1f4fbf1/35342", "anchor_text": "SQL Fiddle", "paragraph_index": 19}, {"url": "https://twitter.com/romanorac", "anchor_text": "Twitter", "paragraph_index": 37}, {"url": "https://twitter.com/romanorac/status/1328952374447267843", "anchor_text": "tweet", "paragraph_index": 37}], "all_paragraphs": ["SQL and Machine Learning have a few things in common. It\u2019s easy to start with one as it doesn\u2019t require a lot of coding. Also, code rarely crashes.", "I would argue that the fact that the SQL queries don\u2019t crash makes the Data Analysis even harder. How many datasets I\u2019ve extracted from the database, that turned out to have wrong or missing data? Many!", "If the code would simply crash, I\u2019d know I screw it up. Data Scientists need to spend a considerable amount of time on data validation because an SQL query always returns something.", "These are the 5 mistakes you should avoid when writing SQL queries.", "Here are few links that might interest you:", "Would you like to read more such articles? If so, you can support me by clicking on any links above. Some of them are affiliate links, but you don\u2019t need to buy anything.", "SQL has a low barrier to entry. You start writing queries \u2014 use a JOIN here and there, do some grouping and you\u2019re already an expert (at least some people think so).", "But does the so-called expert even know in what order do SQL queries execute?", "SQL queries don\u2019t start with SELECT \u2014 they do in the editor when we write them, but the database doesn\u2019t start with SELECT.", "The database starts executing queries with FROM and JOIN. That\u2019s why we can use fields from JOINed tables in WHERE.", "Why can\u2019t we filter the result of GROUP BY in WHERE? Because GROUP BY executes after WHERE. Hence, the reason for HAVING.", "At last, we come to SELECT. It selects which columns to include and defines which aggregations to calculate. Also, Window Functions execute here.", "This explains why we get an error when we try to filter with the output of a Window Function in WHERE.", "Note, databases use a query optimizer to optimize the execution of a query. The optimizer might change the order of some operations so that the query runs faster. This diagram is a high-level overview of what is happening behind the scenes.", "Window Functions seemed cryptic to me when I first encountered them. Why use Window Functions as GROUP BY can aggregate the data?", "Well, a Window Function (WF) simplifies many operations when designing queries:", "The WF above would calculate the cumulative sum from the first record to the current record.", "Where did I do a mistake with Window Functions?", "I didn\u2019t take the time for a tutorial that would explain the basics and the power of Window Functions. Consequently, I avoided them and the queries became overcomplicated. Then bugs creep in.", "I got many requests from readers that would like to play with the example above. Now, you can run the example online in SQL Fiddle.", "Here is the code, if you\u2019d like to try it in your local database (it should work with PostgreSQL 9.3):", "CASE WHEN is like an IF statement in a programming language. It is useful when we need to calculate a statistic on a certain subset of the data.", "In the image above, I calculate an average price for products sold in the US. I wasn\u2019t careful with the ELSE in the CASE WHEN.", "In the first example, I use 0 for all products that are not from the US, which lowers the overall average price. If there would be many non-US products, the average could get close to 0.", "In the second example, I calculate the average price only with products that are sold in the US, which is usually what we want. Note, you don\u2019t need to include ELSE when using CASE WHEN as it defaults to NULL.", "The key takeaway is that you should be careful with \u201celse 0\u201d when using CASE WHEN. It doesn\u2019t have any effect with SUM, but it has a huge effect on AVG.", "There are 4 different JOINs in SQL: Inner, Outer, Left and Right. When we use JOIN in a query, it defaults to an INNER join.", "Luckily for me, I took the time and read a few tutorials about JOINs. But I still made a rookie mistake.", "I wrote a query similar at its core to the query in the image above. When I was performing data validation, many records were missing. How is this possible? It is such a simple JOIN!", "It turned out that many entries in the table 1 and table 2 had string_field column with NULL values. I thought that JOIN would keep records with NULL values because NULL is equal to NULL, isn\u2019t it?", "The solution to getting all entries was to wrap string_field in COALESCE, which converts NULL to an empty string.", "But be careful as this JOINs each entry with the empty string from table1 with each entry with the empty string in table2.", "One way to remove those duplicates is to use ROW_NUMBER() window function:", "SQL would be great if only we could debug queries. What if I told you can debug them!", "You can breakdown a complex query and create multiple temporary tables. Then you can run \u201csanity check\u201d queries against those tables to make sure they contain correct entries. I highly recommend this approach when designing a new non-trivial query or report.", "The only downside of temporary tables is that the query optimizer in the database cannot optimize the query.", "When performance is needed I rewrite the queries defined with temporary tables to a query defined with WITH statement.", "Follow me on Twitter, where I regularly tweet about Data Science and Machine Learning.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9f61d6f5324f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://romanorac.medium.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": ""}, {"url": "https://romanorac.medium.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Roman Orac"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68bf0657a0cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&user=Roman+Orac&userId=68bf0657a0cd&source=post_page-68bf0657a0cd----9f61d6f5324f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@krakenimages?utm_source=medium&utm_medium=referral", "anchor_text": "krakenimages"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://trymito.io/", "anchor_text": "Complete your Python analyses 10x faster with Mito"}, {"url": "https://aigents.co/skills", "anchor_text": "Free skill tests for Data Scientists & ML Engineers"}, {"url": "https://imp.i115008.net/c/2402645/1116216/11298", "anchor_text": "All New Self-Driving Car Engineer Nanodegree"}, {"url": "http://SQL Fiddle", "anchor_text": "Fiddle"}, {"url": "http://sqlfiddle.com/#!15/9eecb7db59d16c80417c72d1e1f4fbf1/35342", "anchor_text": "SQL Fiddle"}, {"url": "https://twitter.com/romanorac", "anchor_text": "Twitter"}, {"url": "https://twitter.com/romanorac/status/1328952374447267843", "anchor_text": "tweet"}, {"url": "https://unsplash.com/@cmhedger?utm_source=medium&utm_medium=referral", "anchor_text": "Courtney Hedger"}, {"url": "https://unsplash.com/?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/data-science?source=post_page-----9f61d6f5324f---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----9f61d6f5324f---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/tag/sql?source=post_page-----9f61d6f5324f---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/analytics?source=post_page-----9f61d6f5324f---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/programming?source=post_page-----9f61d6f5324f---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&user=Roman+Orac&userId=68bf0657a0cd&source=-----9f61d6f5324f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&user=Roman+Orac&userId=68bf0657a0cd&source=-----9f61d6f5324f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9f61d6f5324f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9f61d6f5324f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9f61d6f5324f--------------------------------", "anchor_text": ""}, {"url": "https://romanorac.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://romanorac.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Roman Orac"}, {"url": "https://romanorac.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7.7K Followers"}, {"url": "https://romanorac.medium.com/membership", "anchor_text": "https://romanorac.medium.com/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68bf0657a0cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&user=Roman+Orac&userId=68bf0657a0cd&source=post_page-68bf0657a0cd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa69c18dd3c04&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-repeat-these-5-mistakes-with-sql-9f61d6f5324f&newsletterV3=68bf0657a0cd&newsletterV3Id=a69c18dd3c04&user=Roman+Orac&userId=68bf0657a0cd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}