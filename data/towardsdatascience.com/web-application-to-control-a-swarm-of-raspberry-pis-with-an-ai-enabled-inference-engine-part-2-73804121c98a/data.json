{"url": "https://towardsdatascience.com/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a", "time": 1683012451.831397, "path": "towardsdatascience.com/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a/", "webpage": {"metadata": {"title": "SorterBot \u2014 Part 2. Featuring a robotic arm, a real-time\u2026 | by Simon Szalai | Towards Data Science", "h1": "SorterBot \u2014 Part 2", "description": "I recently completed an AI mentorship program at SharpestMinds, of which the central element was to build a project, or even better, a complete product. I choose the latter, and in this article, I\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.aliexpress.com/item/32959456853.html?spm=a2g0s.9042311.0.0.71384c4dhp0oP1", "anchor_text": "robot arm", "paragraph_index": 2}, {"url": "http://wiki.seeedstudio.com/Grove-Electromagnet/", "anchor_text": "magnet", "paragraph_index": 2}, {"url": "https://www.raspberrypi.org/products/pi-noir-camera-v2/", "anchor_text": "Pi NoIR Camera V2", "paragraph_index": 2}, {"url": "https://pypi.org/project/RPi.GPIO/", "anchor_text": "RPi.GPIO", "paragraph_index": 7}, {"url": "http://abyz.me.uk/rpi/pigpio/", "anchor_text": "PiGPIO", "paragraph_index": 7}, {"url": "https://medium.com/swlh/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-3-77836f9fc4c2", "anchor_text": "To be continued in Part 3\u2026", "paragraph_index": 21}, {"url": "http://szalai.dev", "anchor_text": "szalai.dev", "paragraph_index": 23}], "all_paragraphs": ["I recently completed an AI mentorship program at SharpestMinds, of which the central element was to build a project, or even better, a complete product. I choose the latter, and in this article, I write about what I built, how I built it, and what I learned along the way.", "This is the second article of the three-part SorterBot series.", "The robot arm arrived from AliExpress, it was without a specific brand, advertised as a DIY toy, which made it an affordable option, costing me only $118 (+$40 in tariffs). Since gripping objects with a robot arm requires a lot of precision, which I could not possibly expect from an arm in this price category, I decided to use a magnet to move the objects to the containers. I ordered one from Grove for $11, specifically designed for Raspberry Pi. It came with its own control electronics, so a GPIO (General Purpose Input/Output) pin could be used to turn it off and on. For the camera, I purchased a Pi NoIR Camera V2 for $45, which was also pretty easy to set up. To run my software and control all the above devices, I bought the latest version of the Raspberry Pi, which is the Raspberry Pi 4 Model B with 4 GB of RAM. I ordered it in a package, together with an SD card, housing, heat sinks, and power adapter, for $130. The hardware cost me $344 in total.", "The arm arrived in pieces that I had to assemble myself. I thought that would not be a problem, but it was a bit more challenging than I expected. First of all, the instructions were in Chinese, but they included pictures. I completed the first few steps without any problems, then pictures of parts started to show up in the instructions that I did not have. First I thought that my kit was not complete, but then I noticed that I had similar parts, but with different sizes, bores in different places, and so on. I looked around at the website where the manual was, and there were a few other models, some of them had the exact same parts that I had. I tried to figure out if I might have received a different model, but unfortunately not: I had a mixture of parts from different arms. From that point, the instructions were totally useless. Since it took almost a month for the arm to arrive, ordering a different one was not really an option, I had to work from what I had. After 8 hours of struggle, drilling bores in different places, bending the metal pieces a bit here and there, I managed to put together a functioning arm. It was not perfect but did the job well enough.", "This robotic arm has 6 degrees of freedom, meaning there were 6 servos shipped with it. I needed only 4 of them, which was fortunate, because one of the servos broke immediately as I tried to turn it with my hand, and another one was simply not working.", "Precisely controlling servos is not a straightforward task. When they receive a signal, they move to the desired position as fast as they can and then hold there until another signal arrives. This behavior is more suitable for applications like RC planes, where servos are used to control the plane\u2019s fins. On the contrary, in robotics applications, this can cause very sudden and shaky movements, but with software-based movement smoothing, this can be mitigated.", "The servos are controlled with PWM, which stands for Pulse Width Modulation. PWM has a cycle time (T), which is usually 50 Hz in the case of analog servos. This frequency means that the desired servo position is updated 50 times a second (once every 20 ms). To set the shaft angle, an electrical pulse has to be applied to the servo, its width ranging between 0.5 and 2.5 ms, which is called the duty cycle. If a pulse width of 0.5 ms is applied, the servo will move to the most counter-clockwise position, at 1.5 ms it will move to the middle (neutral) position, and at 2.5 ms, it will move to the most clockwise position. Usually, a servo can move 180 degrees, but it can vary depending on the model. The pulse has to be repeated in every cycle to instruct the servo to hold that position if no pulse is applied, the servo turns off and the shaft can be moved freely.", "After I connected my servos to the Pi and SSH\u2019d into it, I installed the default library for controlling the GPIO pins: RPi.GPIO. It is very easy to use, I just set up a pin as a PWM output, set a pulse width and the servo is already moving. It moves at full speed immediately and stops very abruptly. Since a robot arm weighs much more than an RC plane\u2019s fin, I was afraid that these abrupt movements eventually will damage the small gears in the servos, especially the bottom ones that carry the most weight. Another problem that I came across is that RPi.GPIO provides software-timed PWM, which means that the pulses are generated by the CPU of the Pi. If the Pi is doing some other work at the same time, the pulses might be significantly delayed or even distorted. This might not be a problem if it is used to blink a LED, but in my case, I needed all the accuracy I could squeeze out from the system. The solution was to go with another library that provides hardware-timed PWM, which is much more accurate (to a few microseconds) and independent of the CPU load. One popular library that provides this feature is PiGPIO.", "Each command that the arm receives from the inference engine is a pair of absolute polar coordinates. The first coordinate is always the item, the second one is the container. In order to move the item to the container, the arm has to move to the item, turn on the magnet, move above the container, then turn off the magnet. To achieve this, two tasks had to be solved:", "Controlling the servo the naive way, just immediately sending the target pulse width results in an unacceptably fast and sudden movement. The only way of slowing down this movement is to generate intermediate points and send them to the servo in small intervals, effectively slowing down the movement.", "To further smooth the movement, instead of a linear profile, sine smoothing can be applied.", "To produce the red line from the x values, the following equation can be used:", "This technique slows down the movement just after starting and just before stopping, which helps to achieve a smooth movement.", "To move the arm to a specific location, all the servos have to move synchronized. Generally, it is faster if all of the servos move at the same time (parallel control), but in some cases, for example, immediately after picking up an object, it is better to first move the arm upwards (serial control), otherwise the magnet would bump into nearby objects. Since moving an arm includes sending commands to a servo in small intervals, and sleep while the servo executes them, controlling multiple servos in parallel requires a multi-threaded approach.", "The last part of controlling the arm is figuring out which servo angles belong to the coordinates received from the inference engine. The position received is an absolute polar coordinate: the first part is the angle of the arm\u2019s base servo expressed in pulse width (\u03b3), the second part is the distance between the arm\u2019s base axis and the image\u2019s center point expressed in pixels (d).", "Since \u03b3 is expressed in pulse width, it can be directly sent to the servo. Figuring out which servo angles belong to the required distance, d is a harder task. In the optimal case, when the exact dimensions of the robot arm are known and the joints are essentially without backlash, the servo angles could be calculated using basic trigonometry. In my case, not knowing the dimensions and also lacking proper tools to measure them, I decided to take an experimental approach: I moved the arm manually to 7 positions evenly distributed within the operating range and recorded the servo angles for each position.", "Since d depends mostly on the angle of servo1, I plotted the angles of servo2 and servo3 as a function of servo1 position, corresponding to the 7 points recorded.", "As shown on the figure above, a cubic polynomial gives a pretty good fit, and yields the equations that can be used in the code to calculate positions of servo2 and servo3, given servo1. The angle of servo1 can be calculated from arm-specific constants, namely the distance between the center of the camera\u2019s field of view and the arm\u2019s base axis measured in pixels, and the pulse width values of servo1 corresponding to the minimum and maximum distances in the polar coordinates. These values can be estimated by rough measurements, like using a ruler, then fine-tuned by trial and error.", "Having completed all the above, the arm is able to move directly to any coordinate. The only adjustment needed is to handle drop-offs above containers, where the arm needs to stop in a higher position. Simply offsetting servo1 with a negative value can achieve that.", "Thank you for reading, and if you have any questions, comments, or suggestions, please let me know!", "In the third and last part, I will write about how I used transfer learning, and how I deployed the solution to AWS.", "To be continued in Part 3\u2026", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Former startup founder with 3 years\u2019 experience in Full-Stack Engineering, Machine Learning, and DevOps. | szalai.dev"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F73804121c98a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----73804121c98a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@simon.szalai?source=post_page-----73804121c98a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@simon.szalai?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Simon Szalai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46df0b2a42b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&user=Simon+Szalai&userId=46df0b2a42b2&source=post_page-46df0b2a42b2----73804121c98a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/swlh/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-b3cb4b4c9fd", "anchor_text": "Continued from Part 1\u2026"}, {"url": "https://medium.com/swlh/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-b3cb4b4c9fd", "anchor_text": "Part 1 \u2014 General project description and the Web Application"}, {"url": "https://medium.com/@simon.szalai/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-3-77836f9fc4c2", "anchor_text": "Part 3 \u2014 Transfer Learning and Cloud Deployment"}, {"url": "https://github.com/simonszalai/sorterbot_control", "anchor_text": "Control Panel"}, {"url": "https://github.com/simonszalai/sorterbot_cloud", "anchor_text": "Inference Engine"}, {"url": "https://github.com/simonszalai/sorterbot_raspberry", "anchor_text": "Raspberry"}, {"url": "https://github.com/simonszalai/sorterbot_installer", "anchor_text": "Installer"}, {"url": "https://github.com/simonszalai/sorterbot_labeltool", "anchor_text": "LabelTools"}, {"url": "https://www.aliexpress.com/item/32959456853.html?spm=a2g0s.9042311.0.0.71384c4dhp0oP1", "anchor_text": "robot arm"}, {"url": "http://wiki.seeedstudio.com/Grove-Electromagnet/", "anchor_text": "magnet"}, {"url": "https://www.raspberrypi.org/products/pi-noir-camera-v2/", "anchor_text": "Pi NoIR Camera V2"}, {"url": "https://pypi.org/project/RPi.GPIO/", "anchor_text": "RPi.GPIO"}, {"url": "http://abyz.me.uk/rpi/pigpio/", "anchor_text": "PiGPIO"}, {"url": "https://medium.com/swlh/web-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-3-77836f9fc4c2", "anchor_text": "To be continued in Part 3\u2026"}, {"url": "https://medium.com/tag/robotics?source=post_page-----73804121c98a---------------robotics-----------------", "anchor_text": "Robotics"}, {"url": "https://medium.com/tag/raspberry-pi?source=post_page-----73804121c98a---------------raspberry_pi-----------------", "anchor_text": "Raspberry Pi"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----73804121c98a---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----73804121c98a---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/aws?source=post_page-----73804121c98a---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&user=Simon+Szalai&userId=46df0b2a42b2&source=-----73804121c98a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&user=Simon+Szalai&userId=46df0b2a42b2&source=-----73804121c98a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----73804121c98a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F73804121c98a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----73804121c98a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----73804121c98a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----73804121c98a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----73804121c98a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----73804121c98a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----73804121c98a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@simon.szalai?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@simon.szalai?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Simon Szalai"}, {"url": "https://medium.com/@simon.szalai/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "17 Followers"}, {"url": "http://szalai.dev", "anchor_text": "szalai.dev"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46df0b2a42b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&user=Simon+Szalai&userId=46df0b2a42b2&source=post_page-46df0b2a42b2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3207570235e7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-application-to-control-a-swarm-of-raspberry-pis-with-an-ai-enabled-inference-engine-part-2-73804121c98a&newsletterV3=46df0b2a42b2&newsletterV3Id=3207570235e7&user=Simon+Szalai&userId=46df0b2a42b2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}