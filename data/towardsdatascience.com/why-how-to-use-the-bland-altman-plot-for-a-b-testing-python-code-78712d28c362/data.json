{"url": "https://towardsdatascience.com/why-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362", "time": 1683014171.7218041, "path": "towardsdatascience.com/why-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362/", "webpage": {"metadata": {"title": "Bland-Altman plot for A/B Testing | Towards Data Science", "h1": "Why & How to use the Bland-Altman plot for A/B testing | Python + code", "description": "Use the Bland-Altman plot for A/B Testing is a good way to analyze the result of an A/B test. Study on pyCompare's function blandAltman."}, "outgoing_paragraph_urls": [], "all_paragraphs": ["The Bland-Altman plot comes from the medical industry in order to compare the measure for two instruments. The first objective of John Martin Bland & Douglas Altman was to answer this question :", "Do the two methods of measurement agree sufficiently closely ? \u2014 D. G. ALTMAN and J. M. BLAND [1]", "If it is the case, it means that if you have two instruments where one is the state of the art at a high cost and the second is 10 times cheaper, do the results obtained by the cheapest method are comparable to the reference and could it be replaced with a sufficient accuracy? For example, does the heart rate provided by a $20 connected watch is sufficiently accurate as the result of an electrocardiogram ? The second objective was to produce a method where the results are easily understandable to non-statisticians.", "In analytics, A/B testing (as well known as Champion-Challenger) is a common methodology of test to compare the results of a new action / a new treatment / a new design / \u2026 on population_A to population_B having the current action. Once we have the test\u2019s results, they have to be analysed and presented to a decisional team mostly composed of non-statisticians. That is why the Bland-Altman plot is relevant because it will compare the results of the A/B test on one plot with all of the statistical measures displayed in an understandable way.", "In their paper, they also showed why the correlation coefficient, the statistical test of mean comparison and the regression are inappropriate to decide on the agreement of two measures which would be in our A/B testing case to decide on the power of the challenger compared to the one of the champion.", "For this article I will use a dataset available on Kaggle (coming from a DataCamp project) called \u201cMobile Games A/B Testing with Cookie Cats\u201d. The link are in the references part [2].", "Cookie Cats is a popular mobile puzzle game where as a player progress the levels, he will encounter \u201cgates\u201d that will force him to wait for some time before continuing to play or to make a purchase. In such an industry the retention is one of the key metrics and the team in charge of the game would see the impact if the first gate was moved from level 30 to level 40 on the retention at 7 days. To see the behavior of such a move they did an A/B test and they provided us the dataset of these results. We will see how the Bland-Altman plot will answer the following question : \u201cHow to analyze the A/B results on the level of retention at 7 days when the waiting time passes from the level 30 to the level 40 ?\u201d", "The dataset is composed of 90.189 rows where we have the player\u2019s unique id, the A/B test\u2019s version (waiting time at gate_30 / gate_40), the game rounds\u2019 sum, retention_1 is a boolean saying if the player came back on the next day and retention_7 is a boolean saying if the player came back after 7 days. In order to have the relevant data to answer our question, it is necessary to do some cleaning. I will only keep the client having a retention_1 = True (because if retention_1=False, retention_7 is False as well), a number of game rounds \u2265 30 (because if they don\u2019t go until 30, they will not be impacted by the gate) and a number of game rounds < 170 (because if we consider the duration of a game = 5 minutes, if a player plays 2 hours per day during 7 day he will play 120*7/5 = 168 games. A higher number would be considered as an anormal usage). After this filter, the dataset is composed of 20.471 rows as Figure1 below. Moreover, the dataset is equally balanced between gate_30 & gate_40.", "We will see on this section how to adapt the original Bland-Altman plot in order to apply it to an A/B test. First of all I am going to explain how is the plot built in its original version [1], [2] and then, I will explain how to build it with our A/B tests\u2019 data.", "Due that the original Bland-Altman plot compare the measurement of 2 instruments, they have the same length by design. For example, with the heart rate measurement between the $20 connect watch and the electrocardiogram, the measure are taken on the same time with the same conditions which lead to have the same number of measurement for the 2 methods. So we can represent each dataset\u2019s row as an experience like on the example in the Figure2 below.", "This is where we encounter the first \u201cpain point\u201d. An A/B test is considered as an unique experience while as we see above, we need several experiences in order to build the plot. To bypass this limitation we will create from the A/B test several bootstrapped samples having both the same & different length.", "We generate 300 non-unique random integers between 200 and 1.000. These integers will represent the length of each bootstrapped sample and in order to benefit the bootstrap\u2019s statistical properties, each non-unique random integer is duplicated 50 times. These numbers are used in order to have a sample diversity but it is arbitrary and the length depends from the size of the original dataset. These 15.000 (300*50) bootstrapped samples having a length between 200 and 2.000 are obtained by a random sampling with a replacement from the original dataset and they are concatenated together. It can be represented as the Figure3.", "Then, we group by n_sample (the id of each 15.000 bootstrapped sample), n_sample_2 (the length of each bootstrapped sample) and version in order to have the sum of player\u2019s retention at 7 days per gates as in Figure 4.", "We can read this output as: the bootstrapped sample n\u00b00/14.999 is composed of 564 rows where 98 players are still playing at 7 days with a waiting time at gate_30 while 105 players are still playing at 7 days with a waiting time at gate_40.", "Then, we use a statistical property of the boostrap saying that the mean of a bootstrap sample is a good estimator of the true mean of a distribution. We make a group by n_sample_2 and version in order to have for each unique sample\u2019s length the average number of player\u2019s retention at 7 days per gates as in Figure 5.", "We can read this output as: when the sample has 200 rows there are in average 34.60 players who are still playing at 7 days with a waiting time at gate_30 while 34.38 players who are still playing at 7 days with a waiting time at gate_40.", "Then we unstack the database in order to have the dataset in a clearer format as the Figure6.", "At this stage we have all the necessary information in order to build the Bland-Altman plot and the representation of the dataset is the same as in the Figure2 above.", "The Bland-Altman plot is composed of 2 axis. The x axis is the average of the two methods to compare. So it is for each row: (gate_30i + gate_40i) / 2 ||| The y axis is the difference between method A and method B. So it is for each row: (gate_30i - gate_40i) ||| And here is the second \u201cpain point\u201d we have. By keeping the y axis as it is, the increase of the samples\u2019 size will increase the differences\u2019 variability. As a result, the statistical measure we will obtain later will be over-weighted by the biggest samples. To bypass this limitation, we will represent the y axis in percentage [3]. To do it, the calculation of y is for each row: ((gate_30i - gate_40i)*100 / (( gate_30i + gate_40i)/2) ||| The dataset looks like Figure7.", "We have to check that the y axis is normally distributed in order to trust the confidence interval who will be displayed. You can assess it by using the shapiro-wilk test or at least with an histogram. If the distribution is not Normal then you can do a transformation such as logarithmic transformation. In our case, I consider the distribution as Normal.", "The Bland-Altman is composed of 3 lines (see Figure9):", "We put all together, the package pyCompare allows to draw the Bland-Altman plot on a very easy way without having to build db[\u2018y\u2019]:", "It takes first the method A (the champion) and then the method B (the challenger). Then, if percentage = True, it will automatically do the calculus we made above. There are some other parameters we will discuss later.", "Here we are ! Here is the figure of the Bland-Altman plot for the A/B testing generated by the code above:", "First of all, the mean and the mean\u2019s confidence interval (light blue stripe) are different than 0 (higher in our case). Which means that the level of retention (named bias in the original paper) of gate_30 and gate_40 are significantly different. Due that 2.93 > 0 it means that A > B < \u2014 > Champion > Challenger and as a result that a waiting period on gate_30 provides a bigger retention than a waiting period on gate_40.", "The two salmon bars represent the confidence interval at 95% (named limit of agreement in the original paper) saying that we are convinced that 95% of the values will be between [-0.78% ; 6.63%]. In our exemple, this is very powerful because we can say that the retention of gate_30 will be almost always bigger than the one of gate_40.", "As you can see, there are 2 values above the upper salmon stripe and 4 below the lower one, which is 6/300 = 0.02 < 0.05 so due that we are certain that 95% of the values are within the 2 boundaries, 5% can be above or below and in our case it represents 2% then it is perfectly normal ;)", "In the pyCompare package there is the parameter limitOfAgreement who aims to change the boundaries of confidence. Here, a relevant question would be : \u201cAt which percentage can I be sure that the retention of gate_30 will be always bigger than the one of gate_40 ?\u201d To answer this question, the lowest boundary has to be equal to 0, so we have to find the right value in order to have 0 as we can see in the code below which provide the Figure11:", "A last point to add is that whatever the average value of the sample, they are uniformly represented on the plot which means that the interpretation we are making are generalized whatever the size of the sample is. Indeed if we had seen a kind of conic representation of the values we could have conclude that the size of the sample has an impact on the results so we cannot have a valid interpretation.", "We saw why it can be relevant to use the Bland-Altman plot in order to have one view about the results of an A/B test on a simple plot, how to create the plot from an A/B test and how to interpret it. This only works in case of normality of the difference however it will be necessary to transform the data.", "Moreover, I checked the App and the gates appears to be on gate_40 while we proved that the retention at 7 days was better at 30. In this case, it shows that the retention is maybe not the best metric to follow compared to the profitability !", "[3] D. G. Altman and J. M. Bland, Statistical Methods for Assessing Agreement between Two Methods of Clinical Measurement, The Lancet 327 (1986) 307\u2013310", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F78712d28c362&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----78712d28c362--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@guillaume.j.clement?source=post_page-----78712d28c362--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@guillaume.j.clement?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Guillaume J. CLEMENT"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc3730acc2ff1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&user=Guillaume+J.+CLEMENT&userId=c3730acc2ff1&source=post_page-c3730acc2ff1----78712d28c362---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@alexblock?utm_source=medium&utm_medium=referral", "anchor_text": "Alex Block"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://projects.datacamp.com/projects/184", "anchor_text": "https://projects.datacamp.com/projects/184"}, {"url": "https://www.kaggle.com/yufengsui/mobile-games-ab-testing", "anchor_text": "https://www.kaggle.com/yufengsui/mobile-games-ab-testing"}, {"url": "https://medium.com/tag/a-b-testing?source=post_page-----78712d28c362---------------a_b_testing-----------------", "anchor_text": "A B Testing"}, {"url": "https://medium.com/tag/bland-altman-plot?source=post_page-----78712d28c362---------------bland_altman_plot-----------------", "anchor_text": "Bland Altman Plot"}, {"url": "https://medium.com/tag/pycompare?source=post_page-----78712d28c362---------------pycompare-----------------", "anchor_text": "Pycompare"}, {"url": "https://medium.com/tag/bootstrapping?source=post_page-----78712d28c362---------------bootstrapping-----------------", "anchor_text": "Bootstrapping"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----78712d28c362---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&user=Guillaume+J.+CLEMENT&userId=c3730acc2ff1&source=-----78712d28c362---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&user=Guillaume+J.+CLEMENT&userId=c3730acc2ff1&source=-----78712d28c362---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----78712d28c362--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F78712d28c362&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----78712d28c362---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----78712d28c362--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----78712d28c362--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----78712d28c362--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----78712d28c362--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----78712d28c362--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@guillaume.j.clement?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@guillaume.j.clement?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Guillaume J. CLEMENT"}, {"url": "https://medium.com/@guillaume.j.clement/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "71 Followers"}, {"url": "https://www.linkedin.com/in/guillaume-clement543922a9/", "anchor_text": "https://www.linkedin.com/in/guillaume-clement543922a9/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc3730acc2ff1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&user=Guillaume+J.+CLEMENT&userId=c3730acc2ff1&source=post_page-c3730acc2ff1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd749548d74dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-how-to-use-the-bland-altman-plot-for-a-b-testing-python-code-78712d28c362&newsletterV3=c3730acc2ff1&newsletterV3Id=d749548d74dd&user=Guillaume+J.+CLEMENT&userId=c3730acc2ff1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}