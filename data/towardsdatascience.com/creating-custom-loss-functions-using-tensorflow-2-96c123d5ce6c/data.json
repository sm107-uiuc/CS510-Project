{"url": "https://towardsdatascience.com/creating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c", "time": 1683017711.244385, "path": "towardsdatascience.com/creating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c/", "webpage": {"metadata": {"title": "Creating custom Loss functions using TensorFlow 2 | by Arjun Sarkar | Towards Data Science", "h1": "Creating custom Loss functions using TensorFlow 2", "description": "A neural network learns to map a set of inputs to a set of outputs from training data. It does so by using some form of optimization algorithm such as gradient descent, stochastic gradient descent\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "anchor_text": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "paragraph_index": 33}], "all_paragraphs": ["A neural network learns to map a set of inputs to a set of outputs from training data. It does so by using some form of optimization algorithm such as gradient descent, stochastic gradient descent, AdaGrad, AdaDelta or some recent algorithms such as Adam, Nadam or RMSProp. The \u2018gradient\u2019 in gradient descent refers to error gradient. After each iteration the network compares its predicted output to the real outputs, and then calculates the \u2018error\u2019. Typically, with neural networks, we seek to minimize the error. As such, the objective function used to minimize the error is often referred to as a cost function or a loss function and the value calculated by the \u2018loss function\u2019 is referred to as simply \u2018loss\u2019. Typical loss functions used in various problems \u2013", "In Tensorflow, these loss functions are already included, and we can just call them as shown below.", "2. Loss function as an object", "The advantage of calling a loss function as an object is that we can pass parameters alongside the loss function, such as threshold.", "For creating loss using function, we need to first name the loss function, and it will accept two parameters, y_true (true label/output) and y_pred (predicted label/output).", "Aim is to return the root mean square error between target (y_true) and prediction (y_pred).", "a is the error ( we will calculate a , difference between label and prediction )", "First we define a function \u2014 my huber loss, which takes in y_true and y_pred", "Next we set the threshold = 1.", "Next we calculate the error a = y_true-y_pred", "Next we check if the absolute value of the error is less than or equal to the threshold. is_small_error returns a boolean (True or False).", "We know that, when, |a| \u2264\u03b4, loss = 1/2*(a)\u00b2, so we calculate the small_error_loss as the square of the error divided by 2.", "Finally, in the return statement, we first check if is_small_error is true or false, if it is true, the function returns the small_error_loss, or else it returns the big_error_loss. This is done using tf.where.", "We can then compile the model using the code below,", "In the previous code, we always use threshold as 1.", "But what if, we want to tune the hyperparameter (threshold) and add a new threshold value during compilation. Then we have to use fuction wrapping, that is, wrapping the loss function around another external function. We need a wrapper function as any loss functions can accept only y_true and y_pred values by default, and we can not add any other parameters to the original loss function.", "This is what the wrapper function code looks like:", "In this case, the threshold value is not hardcoded. Rather we can pass the threshold value during model compilation.", "MyHuberLoss is the class name. After the class name, we inherit the parent class \u2018Loss\u2019 from tensorflow.keras.losses. So MyHuberLoss inherits as Loss. This allows us to use MyHuberLoss as a loss function.", "__init__ initialises the object from the class.", "call function that gets executed when an object is instantiated from the class", "The init function gets the threshold and the call function gets the y_true and y_pred parameters that we sell previously. So we will declare threshold as a class variable, which allows us to give it an initial value.", "Within __init__ function we set threshold to self.threshold.", "In call function, all threshold class variable will then be referred by self.threshold.", "Here is how we can use this loss function in model.compile.", "Siamese networks compare if two images are similar or not. Contrastive loss is the loss function used in siamese networks.", "Y_true is the tensor of details about image similarities. They are one if the images are similar and they are zero if they\u2019re not.", "D is the tensor of Euclidean distances between the pairs of images.", "Margin is a constant that we can use to enforce a minimum distance between them in order to consider them similar or different.", "If Y_true =1, the first part of the equation becomes D\u00b2, and the second part becomes zero. So, the D\u00b2 term has more weight when Y_true is close to 1.", "If Y_true = 0, then the first part of the equation becomes zero, and the second part yields some result. This gives much more weight to the max term and less weight to the D squared term, so the max term dominates the calculation of the loss.", "Any loss functions not available in Tensorflow can be created using functions, wrapper functions or by using classes in a similar way.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. student \u2014 Deep Learning on Biomedical Images at the Leibniz Institute-HKI, Germany. LinkedIn-https://www.linkedin.com/in/arjun-sarkar-9a051777/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F96c123d5ce6c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://arjun-sarkar786.medium.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Arjun Sarkar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa31366b2eda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&user=Arjun+Sarkar&userId=fa31366b2eda&source=post_page-fa31366b2eda----96c123d5ce6c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/w/index.php?curid=521422", "anchor_text": "https://commons.wikimedia.org/w/index.php?curid=521422"}, {"url": "https://commons.wikimedia.org/w/index.php?curid=34836380", "anchor_text": "https://commons.wikimedia.org/w/index.php?curid=34836380"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----96c123d5ce6c---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----96c123d5ce6c---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----96c123d5ce6c---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----96c123d5ce6c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----96c123d5ce6c---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&user=Arjun+Sarkar&userId=fa31366b2eda&source=-----96c123d5ce6c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&user=Arjun+Sarkar&userId=fa31366b2eda&source=-----96c123d5ce6c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F96c123d5ce6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----96c123d5ce6c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----96c123d5ce6c--------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Arjun Sarkar"}, {"url": "https://arjun-sarkar786.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "518 Followers"}, {"url": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "anchor_text": "https://www.linkedin.com/in/arjun-sarkar-9a051777/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa31366b2eda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&user=Arjun+Sarkar&userId=fa31366b2eda&source=post_page-fa31366b2eda--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F25711c8db9ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-loss-functions-using-tensorflow-2-96c123d5ce6c&newsletterV3=fa31366b2eda&newsletterV3Id=25711c8db9ff&user=Arjun+Sarkar&userId=fa31366b2eda&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}