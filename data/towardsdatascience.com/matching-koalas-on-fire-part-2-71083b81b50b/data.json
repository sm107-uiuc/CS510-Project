{"url": "https://towardsdatascience.com/matching-koalas-on-fire-part-2-71083b81b50b", "time": 1683010301.291434, "path": "towardsdatascience.com/matching-koalas-on-fire-part-2-71083b81b50b/", "webpage": {"metadata": {"title": "Matching: Koalas On Fire \u2014 Part 2 | by Magali de Bruyn | Towards Data Science", "h1": "Matching: Koalas On Fire \u2014 Part 2", "description": "As of now, the norm in the field is to use one-to-one matching (M=1) as a default and a starting point for matching. This foregoes using a multiple matching ratio, under the assumption that 1:1\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@svitlana_78975/matching-koalas-on-fire-part-1-17691bb85c23", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://github.com/magamax/Optimal-Matching-Ratio", "anchor_text": "Link to the code", "paragraph_index": 28}, {"url": "https://medium.com/u/1b7d6e4d8fbd?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Vin\u00edcius Miranda", "paragraph_index": 31}], "all_paragraphs": ["Check out Part 1 here. There, we tell you all about the tool called (multiple) matching and introduce our example dataset \u2014 koalas!", "TL;DR: Matching is supposedly a gold-nugget tool for causal inference. We agree it\u2019s wonderful, but most of us set the matching ratio parameter to be 1:1 by default. Each treated data unit then gets paired with one and only one control unit, not multiple control units. Could we be missing out on some extra power here by relying on an unquestioned default? We think we might\u2026 and we try to figure that out with quantitative exploration. The results? It really depends \u2014 especially on the distribution of the dataset. Find out about all the nitty-gritty wonderfulness of matching and causal inference below.", "As of now, the norm in the field is to use one-to-one matching (M=1) as a default and a starting point for matching. This foregoes using a multiple matching ratio, under the assumption that 1:1 usually provides the best balance on covariates. However, we just exemplified in our previous post how this may not be the case. So how do we know which matching ratio to use for our dataset? We explore this below with some examples.", "Let\u2019s break this down. We can start to get at an answer through a quantitative exploration. For now, let\u2019s think of multiple-to-one matching as two-to-one matching. We\u2019ll stick with matching on one dimension too \u2014 on the covariate: kilograms of eucalyptus eaten by a koala.", "In short, we want to use multiple matching when the average value of the multiple chosen control units is closer \u2014 than the one closest control \u2014 to the value of the treated unit.", "Ideally, the control units are (almost) equidistant \u2014 in opposing directions \u2014 from the treated unit being matched on; if this is the case, we get an (almost) perfect match (Figure 1).", "In practice, the \u201csynthetic\u201d control will be a closer match on the covariate if the control units\u2019 mean distance from the treated unit is smaller than the difference between the one closest control\u2019s covariate value and the treated unit\u2019s covariate value. (Phew, that\u2019s a mouthful!) In simpler words, the deviations of the control units from the treated unit (almost) \u201ccancel\u201d each other out. Mathematically, we can express the distance of the selected closest control(s)\u2019 value(s) to the treated unit\u2019s value like this:", "And we just came up with a quantitative way to measure what the best type of matching is!\u00b9", "By comparing this \u201cdistance value\u201d obtained through one-to-one matching with the value from multiple-to-one matching, we can conclude which matching type will give us the closest match for the treated unit(s) (see below). This can make our decision much less arbitrary.", "We could also code this (and potentially incorporate it as a function in the Matching library). Here\u2019s a pseudocode start:", "One-to-one matching guarantees a great balance if we have exact matches for the treated units on the covariate. If there are \u201csafe\u201d koalas, who eat 200 and 250 kg, the same as our two treated koalas, then we will obtain the p-value of 1, or \u201cperfect\u201d balance (Figure 3). The background characteristics for the control group and treated group are absolutely identical.", "Two-to-one matching will perform worse when the other control units, besides the exact matches, are distributed scarcely and either only to the left or to the right of the treated unit(s). For instance, if all the potential control \u201ccandidates\u201d for a certain treated koala weigh more than it, then their average is going to be larger than a single closer control unit (as is the case in Figure 3 when we do multiple-to-one matching for the 200 kg koala).", "If we have two control koalas that are exact matches, then, of course, two-to-one matching will also achieve perfect balance, like one-to-one matching (Figure 4).", "On the flip-side, one-to-one matching can take the form of two-to-one matching and produce equally good results. When we have two equidistant controls for a certain unit and we are matching with ties, the match function will take an average of these controls for one-to-one matching. This is technically the same thing as if we did two-to-one matching.", "In these cases, we would want to prioritize multiple matching because it incorporates more observations and creates a bigger and more representative sample size.", "It\u2019s very unlikely that there\u2019s an exact match in the control group for every treated unit. Given this, in our ideal world, our treated units would be surrounded by close-by control units on both sides and \u201csit\u201d at their center; there would be an equal distribution of control units around treated units. Multiple matching would work great here by involving many control units and generating a \u201csynthetic\u201d one whose characteristics closely resemble that of our treated unit(s).", "However, if the covariate values of the control units all lie far away \u2014 in one direction \u2014 from the covariate values of a treated unit, matching the treated unit to multiple distant controls will make things worse (Figure 3). Here, we just want to match the \u201cfiery\u201d koala to the closest \u201csafe\u201d koala (or discard the datapoint). We do not want to create a composite control that incorporates a covariate value that is even further away from that of the treated.", "So, how can we consolidate these two opposing courses of action? We can use common support (literally and figuratively) to assign matching ratios. We prioritize multiple-matching for all the treated units that fall within the common support \u2014 the overlapping range between the treated and the control units. This assumes there is a balanced distribution of control units within the common support. We know these \u201cfiery\u201d koalas will be surrounded on both sides by some \u201csafe\u201d koalas (in terms of their eucalyptus consumption).", "Meanwhile, we want to use one-to-one matching for the treated units whose covariate values lie on the boundaries or outside the common support of the control units\u2019 values. That way the \u201cfiery\u201d koalas whose eating patterns differ significantly from any \u201csafe\u201d koala will only be paired with the closest eater (rather than 2+ very different ones).", "What would this look like in practice? We\u2019d have to code for it, of course. It could be something like the genetic matching function. We could run the ideal matching ratio classification on the dataset and assign the treated units outside the common support to one-to-one matching (M=1) and those inside to multiple-to-one matching (M=2). The resulting vector could then be passed into the Match function.", "Cool beans, now that we investigated and developed some quantitative ways to decide on which matching ratio to use, let\u2019s sum things up.", "Is the better performance of multiple matching an anomaly or rather a regular occurrence? We hope that the above examples demonstrated that the current default to one-to-one matching might not be as grounded as we presume. More research with larger (non-simulated) datasets will help establish whether this challenge of the norm holds in practice.", "Such investigation will help generalize when it is more likely that multiple-matching will perform better (or worse). Areas of worthwhile exploration include figuring out what happens when we match on multiple covariates. If we try to find \u201csafe\u201d koalas who eat the same but also who weigh the same or are the same age, how does multiple-matching fare? Does adding dimensions favor a certain matching ratio? (A close consideration of how to approach the curse of dimensionality would be valuable.) What about the scarcity of the data? How does it impact the performance of our matching choice? Or does the optimization of the balance depend on specific distribution moments of the data?", "As you can see, despite the length of this blog, there\u2019s still a lot of room for exploration\u2026 Matching is a wonderful tool and its recent development means there\u2019s still much to figure out.", "If you haven\u2019t had enough, here\u2019s some more:", "Though multiple matching allows us to utilize a higher number of control units, we want to make sure to avoid overuse of specific control units. If we allow matching with replacement \u2014 the same \u201csafe\u201d koala can be used as (part of) a match for multiple \u201cfiery\u201d koalas, we might end up using the same control unit over and over. This can lead us to an unrepresentative sample of the control population and skew our ultimate analysis. We could mitigate this by putting a limit on the maximum use of a single control unit as a match for the treated units (in practice, we would modify the library Matching and add an extra parameter).", "Also, it would be unfair to create a control from two (or more) matches that are significantly different from the treated unit. Take for example our \u201cfiery\u201d koala Koko who eats 200 kilograms of eucalyptus per year. If we match it with a \u201csafe\u201d baby koala that eats 50 kilograms a year and an abnormally hungry one that eats 350 kg per year, we\u2019ll get a \u201csynthetic\u201d koala that eats exactly the same as our treated koala. But we can\u2019t just say that Koko is the same as our baby koala and our very hungry koala combined in terms of other characteristics. That could be unfair \u2014 or in CS terms, create huge bias \u2014 if there\u2019s unmeasured characteristics that would be affected by this selection. For such cases, we could set a limit on how far the matches can be (through an extension of the caliper parameter) so that very dissimilar units are not matched.", "Caliper, replace, dimensions, common support, distributions\u2026 there\u2019s much that can impact our preference for a one-to-one matching over multiple-to-one matching ratio; perhaps the choice is the most dependent on the dataset itself. One thing we know for sure, though, is that our koalas would rather have one (or less) forest fire than multiple ones\u2026!", "Link to the code used for the examples above.", "\u00b9 If we make the crucial assumption that the distance metric is the best way to maximize balance on covariates (as is currently common practice).", "* Depending on the distance tolerance enforced and the number of matches requested, this might lead us to drop treated units and have different treated sample sizes. We would then need to normalize the \u201cdistance value\u201d \u2014 the final value for the difference of matches for all treated units (\u201ctotal treated difference\u201d) \u2014 by dividing them by the amount of treated units matched (T).", "Thank you to Vin\u00edcius Miranda for working through our thoughts with us and sharing his nuanced knowledge on causal inference and matching, notably on the topic of common support. We also thank Prof. Alexis Diamond for encouraging us to blog about our analysis of multiple-to-one matching versus one-to-one matching!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Computational Sciences & Cognitive Neurosciences student. I value learning, thoughtfulness, and nature."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F71083b81b50b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----71083b81b50b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@debruynmagali?source=post_page-----71083b81b50b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debruynmagali?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Magali de Bruyn"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcbf0012f471c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&user=Magali+de+Bruyn&userId=cbf0012f471c&source=post_page-cbf0012f471c----71083b81b50b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/u/4f904fbe39bd?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Svitlana Midianko"}, {"url": "https://medium.com/@svitlana_78975/matching-koalas-on-fire-part-1-17691bb85c23", "anchor_text": "here"}, {"url": "https://unsplash.com/@davidclode", "anchor_text": "David Clode"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://github.com/magamax/Optimal-Matching-Ratio", "anchor_text": "Link to the code"}, {"url": "https://medium.com/u/1b7d6e4d8fbd?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Vin\u00edcius Miranda"}, {"url": "https://medium.com/tag/data-science?source=post_page-----71083b81b50b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/research?source=post_page-----71083b81b50b---------------research-----------------", "anchor_text": "Research"}, {"url": "https://medium.com/tag/r?source=post_page-----71083b81b50b---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/statistics?source=post_page-----71083b81b50b---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----71083b81b50b---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&user=Magali+de+Bruyn&userId=cbf0012f471c&source=-----71083b81b50b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&user=Magali+de+Bruyn&userId=cbf0012f471c&source=-----71083b81b50b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F71083b81b50b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----71083b81b50b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----71083b81b50b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----71083b81b50b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----71083b81b50b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----71083b81b50b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----71083b81b50b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debruynmagali?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@debruynmagali?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Magali de Bruyn"}, {"url": "https://medium.com/@debruynmagali/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "17 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcbf0012f471c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&user=Magali+de+Bruyn&userId=cbf0012f471c&source=post_page-cbf0012f471c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe9ca5d91dc79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmatching-koalas-on-fire-part-2-71083b81b50b&newsletterV3=cbf0012f471c&newsletterV3Id=e9ca5d91dc79&user=Magali+de+Bruyn&userId=cbf0012f471c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}