{"url": "https://towardsdatascience.com/weather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201", "time": 1683015136.126386, "path": "towardsdatascience.com/weather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201/", "webpage": {"metadata": {"title": "Weather Model Processing With FOSS4G and JavaScript: Best Practices | by Thomas Horner | Towards Data Science", "h1": "Weather Model Processing With FOSS4G and JavaScript: Best Practices", "description": "A year ago I wrote Automated Weather Model Processing With FOSS4G: Lessons Learned, which outlined my journey in creating a system that automatically retrieved, processed, and managed weather model\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/swlh/automated-weather-model-processing-with-foss4g-lessons-learned-8aaaeda1e3bc", "anchor_text": "Automated Weather Model Processing With FOSS4G: Lessons Learned", "paragraph_index": 0}, {"url": "https://highpointwx.com", "anchor_text": "cutting-edge weather forecasting website for the state of Colorado", "paragraph_index": 0}, {"url": "https://gdal.org/", "anchor_text": "GDAL", "paragraph_index": 2}, {"url": "http://cola.gmu.edu/grads/", "anchor_text": "the industry standard for working with weather model and other scientific data \u2014 GRaDS", "paragraph_index": 5}, {"url": "https://geotiffjs.github.io/", "anchor_text": "Geotiff.js", "paragraph_index": 7}, {"url": "http://proj4js.org/", "anchor_text": "proj4js", "paragraph_index": 7}, {"url": "https://www.npmjs.com/package/gdal-js", "anchor_text": "gdal-js", "paragraph_index": 8}, {"url": "https://postgis.net/", "anchor_text": "PostGIS for PostgreSQL", "paragraph_index": 9}, {"url": "https://postgis.net/docs/RT_reference.html#outdb", "anchor_text": "out-db raster.", "paragraph_index": 9}, {"url": "https://pypi.org/project/GDAL/", "anchor_text": "with its GDAL bindings", "paragraph_index": 10}, {"url": "https://towardsdatascience.com/geotiff-coordinate-querying-with-javascript-5e6caaaf88cf", "anchor_text": "I wrote an article that covers specifics here.", "paragraph_index": 10}, {"url": "https://www.lstsrv.ncep.noaa.gov/mailman/listinfo/ncep.list.nomads-ftpprd", "anchor_text": "the listserv.", "paragraph_index": 14}], "all_paragraphs": ["A year ago I wrote Automated Weather Model Processing With FOSS4G: Lessons Learned, which outlined my journey in creating a system that automatically retrieved, processed, and managed weather model data using open source geography software. I have now worked extensively with this system for a year, including the release of a cutting-edge weather forecasting website for the state of Colorado, and had the opportunity to learn from key players in the commercial and academic weather forecasting fields.", "The findings in the original article are still useful as an introduction to common paradigms of distributing and using raw weather model data. This follow-up expands upon that and covers best practices and techniques for dealing with this data, using only free and open source software for geography (FOSS4G). There is also some tips and tricks for working with this data using JavaScript, which is becoming a more ubiquitous language, including in the field of Geographic Information Systems (GIS).", "This article assumes you have GDAL installed, and you are already aware of where to download the weather model files and how they are generally structured. \u201cIndex files\u201d will be referenced often, which are the .idx files you will often see accompanying grib2 files:", "These files are incredibly useful for managing huge rasters and variable band ordering, and you should utilize them as much as possible.", "The reason this isn\u2019t recommended outright is it gets away from the point of the article \u2014 there is already a large field of people doing incredible things with GIS and geospatial rasters, and the goal is to help make weather model data more easily accessible in this field and leverage that existing talent.", "However, if your focus is purely on meteorology or a more scientific discipline, you may want to just use the industry standard for working with weather model and other scientific data \u2014 GRaDS. This software has its own scripting language, and it requires a lot of work to make maps that look anything like that quality you can easily produce in common desktop GIS applications, so it represents a use case that may be outside of the discipline of GIS.", "Weather models have a variety of projections (usually some form of Lambert Conformal Conic) that don\u2019t easily reproject to EPSG:4326 or Web Mercator without losing data or forcing interpolation. If you query reprojected data, you will likely get a forecast that is inaccurate when compared to the raw model data.", "If you\u2019re using Node.js to query geospatial rasters (with something like Geotiff.js) and you want to keep them in their original projection when querying a latitude/longitude coordinate, the Proj4 and WKT strings provided from GDAL can be passed to proj4js \u2014 but you\u2019ll notice some pretty serious spatial inaccuracies after the reprojection (many miles, not a few feet). There are certain kinds of transformations that proj4js cannot do and it seems like most weather model projections fall into this category.", "You\u2019ll need to either use the GDAL bindings (gdal-js \u2014 not ideal, as they require an old version of GDAL) or invoke a shell to call GDAL\u2019s gdaltransform for a more accurate reprojection \u2014 or another reprojection library, outside of JavaScript. To keep things easy, you can load a grib2 file into QGIS and use the \u201cExtract Projection\u201d tool to export a .prj file which can be passed to gdaltransform.", "If you process weather model data with any degree of regularity, you will have a massive amount of geospatial rasters that have dozens of bands in them. PostGIS for PostgreSQL is a good tool to keep this data organized, but is too slow at reading/writing the data itself \u2014 however, you can just keep the raster as a GeoTIFF (or whatever) on the filesystem and reference it from PostGIS as an out-db raster.", "There advantages to using other languages for your backend or API (such as python, with its GDAL bindings), but Node.js is becoming more popular, and it is a viable choice for working with this data. If you\u2019re using Postgres and GeoTIFF files, this is an acceptable solution, though if you expect to have huge concurrent demand, you\u2019ll probably want to go with a different approach using raw binary files or extreme caching techniques. For the JS-based approach, you can load weather model GeoTIFF files using Geotiff.js and query them with decent performance. I wrote an article that covers specifics here.", "NOAA\u2019s NCEP (the U.S. agency that is generally responsible for development and dissemination of weather models) has not been entirely consistent with the usage of the GRIB2 format, which trips up a variety of GRIB decoders including some created by NOAA themselves! At the time of writing, the NBMv4 model shows unknown bands, even in NCEP\u2019s own index lookup files:", "GDAL, however, generally seems to struggle with band identification more than some other libraries, so you may have a number of \u201cunknown\u201d bands in your raster. Here\u2019s the workflow for trying to figure out what a band pertains to, if the metadata cannot seem to describe the weather model parameter and/or level:", "Grib2 files have been historically a little neglected by the hard working GDAL contributors, but they have been great at fixing some recent errors I discovered with newer weather models, such as the NBMv4. These models should work completely in the GDAL >3.1, but older versions such as the current upstream version in some Linux distributions (3.0.4) choke when processing some parameters (like snow accumulation). If you notice other issues, reach out to the gdal listserv!", "The primary distribution server for weather models \u2014 NCEP NOMADS \u2014 tends to experience outages at a fairly alarming frequency, but are usually precluded or shortly followed by an outage announcement on the listserv. Other important notifications include changes to models and additions or deletions of them, which may break your scripts.", "In general, if you\u2019re just performing basic transformation of weather model data and simple analysis or querying of it, you\u2019ll be limited by your ability to read/write data on the disk and load large raster files into RAM, while your CPU sits mostly idle. You should definitely be using SSD drives. If you\u2019re doing a lot of reprojection of raster files, CPU will be more important. If you\u2019re going to be storing global weather models or some of the more advanced ones (like the NAM or HRRR) back a large number of runs, you are going to need a few terabytes of hard drive space.", "Comparing two values at the surface (such as temperature) between models of different spatial resolutions is not a fair comparison, especially in rugged terrain. Each model has an underlying DEM, which you can generally extract from the \u201canalysis\u201d forecast hour (aka zero). For instance, this data is available in the NAM model at fh00/ analysis, according to the corresponding index file:", "You\u2019ll likely encounter this with the ugrd and vgrd components of wind.", "You can only get both of these variables at the same time, which means if your retrieval/processing script is entirely dependent on one variable per row in the index file, things will break. What happens when you retrieve this byte range is that you will get a two band raster, with the first band pertaining to ugrd and the second pertaining to vgrd.", "This generally seems to be the global models like the GFS and GEFS. When you start working with this projection, weird things can happen. You may want to call gdalwarp with --config CENTER_LONG 0 (or config=[\"CENTER_LONG 0\"] in the Python bindings) before working with this data.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd583e6dde201&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d583e6dde201--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@potion_cellar?source=post_page-----d583e6dde201--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Thomas Horner"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9e4260fa5487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&user=Thomas+Horner&userId=9e4260fa5487&source=post_page-9e4260fa5487----d583e6dde201---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/swlh/automated-weather-model-processing-with-foss4g-lessons-learned-8aaaeda1e3bc", "anchor_text": "Automated Weather Model Processing With FOSS4G: Lessons Learned"}, {"url": "https://highpointwx.com", "anchor_text": "cutting-edge weather forecasting website for the state of Colorado"}, {"url": "https://gdal.org/", "anchor_text": "GDAL"}, {"url": "http://cola.gmu.edu/grads/", "anchor_text": "the industry standard for working with weather model and other scientific data \u2014 GRaDS"}, {"url": "https://geotiffjs.github.io/", "anchor_text": "Geotiff.js"}, {"url": "http://proj4js.org/", "anchor_text": "proj4js"}, {"url": "https://www.npmjs.com/package/gdal-js", "anchor_text": "gdal-js"}, {"url": "https://postgis.net/", "anchor_text": "PostGIS for PostgreSQL"}, {"url": "https://postgis.net/docs/RT_reference.html#outdb", "anchor_text": "out-db raster."}, {"url": "https://pypi.org/project/GDAL/", "anchor_text": "with its GDAL bindings"}, {"url": "https://towardsdatascience.com/geotiff-coordinate-querying-with-javascript-5e6caaaf88cf", "anchor_text": "I wrote an article that covers specifics here."}, {"url": "https://www.giss.nasa.gov/tools/panoply/", "anchor_text": "Panoply Data Viewer"}, {"url": "https://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/", "anchor_text": "wgrib2"}, {"url": "https://www.lstsrv.ncep.noaa.gov/mailman/listinfo/ncep.list.nomads-ftpprd", "anchor_text": "the listserv."}, {"url": "https://medium.com/tag/foss4g?source=post_page-----d583e6dde201---------------foss4g-----------------", "anchor_text": "Foss4g"}, {"url": "https://medium.com/tag/gis?source=post_page-----d583e6dde201---------------gis-----------------", "anchor_text": "GIS"}, {"url": "https://medium.com/tag/weather?source=post_page-----d583e6dde201---------------weather-----------------", "anchor_text": "Weather"}, {"url": "https://medium.com/tag/weather-data?source=post_page-----d583e6dde201---------------weather_data-----------------", "anchor_text": "Weather Data"}, {"url": "https://medium.com/tag/javascript?source=post_page-----d583e6dde201---------------javascript-----------------", "anchor_text": "JavaScript"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&user=Thomas+Horner&userId=9e4260fa5487&source=-----d583e6dde201---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&user=Thomas+Horner&userId=9e4260fa5487&source=-----d583e6dde201---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd583e6dde201&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d583e6dde201---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d583e6dde201--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d583e6dde201--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d583e6dde201--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d583e6dde201--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d583e6dde201--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thomas Horner"}, {"url": "https://medium.com/@potion_cellar/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "73 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9e4260fa5487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&user=Thomas+Horner&userId=9e4260fa5487&source=post_page-9e4260fa5487--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3a6cac31d7db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweather-model-processing-with-foss4g-and-javascript-best-practices-d583e6dde201&newsletterV3=9e4260fa5487&newsletterV3Id=3a6cac31d7db&user=Thomas+Horner&userId=9e4260fa5487&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}