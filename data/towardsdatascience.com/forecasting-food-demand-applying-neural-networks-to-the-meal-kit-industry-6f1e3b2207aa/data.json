{"url": "https://towardsdatascience.com/forecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa", "time": 1683010124.182076, "path": "towardsdatascience.com/forecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa/", "webpage": {"metadata": {"title": "Forecasting Food Demand. Applying Neural Networks to the Meal\u2026 | by Neel Iyer | Towards Data Science", "h1": "Forecasting Food Demand", "description": "Time series problems usually struggle with overfitting. This entire exercise became more of a challenge to see how I could prevent overfitting in time series forecasting. I added weight decay and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.fast.ai/2018/07/02/adam-weight-decay/", "anchor_text": "weight decay", "paragraph_index": 2}, {"url": "https://www.cs.toronto.edu/~hinton/absps/JMLRdropout.pdf", "anchor_text": "dropout", "paragraph_index": 2}, {"url": "https://arxiv.org/abs/1502.03167", "anchor_text": "batch normalisation", "paragraph_index": 2}, {"url": "https://medium.com/@lankinen/fast-ai-lesson-6-notes-part-1-v3-646edf916c04", "anchor_text": "this article", "paragraph_index": 3}, {"url": "https://datahack.analyticsvidhya.com/contest/genpact-machine-learning-hackathon-1/#ProblemStatement", "anchor_text": "meal kit company", "paragraph_index": 4}, {"url": "https://smerity.com/articles/2016/architectures_are_the_new_feature_engineering.html", "anchor_text": "\u2018new\u2019 feature engineering", "paragraph_index": 10}, {"url": "https://arxiv.org/abs/1803.09820", "anchor_text": "This paper", "paragraph_index": 11}, {"url": "https://scholar.google.com/citations?user=pwh7Pw4AAAAJ&hl=en", "anchor_text": "Leslie Smith", "paragraph_index": 11}, {"url": "https://www.kaggle.com/qitvision/a-complete-ml-pipeline-fast-ai", "anchor_text": "this kaggle kernel", "paragraph_index": 11}, {"url": "https://github.com/fastai/fastai/blob/master/courses/dl1/lesson3-rossman.ipynb", "anchor_text": "This model", "paragraph_index": 13}, {"url": "https://sgugger.github.io/how-do-you-find-a-good-learning-rate.html", "anchor_text": "shown", "paragraph_index": 18}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "shown to work well", "paragraph_index": 19}, {"url": "https://www.martinalarcon.org/2018-12-31-b-water-pumps/", "anchor_text": "article", "paragraph_index": 22}, {"url": "https://forums.fast.ai/t/fastai-v2-code-walk-thru-8/55068", "anchor_text": "are swapped", "paragraph_index": 25}, {"url": "https://www.kaggle.com/c/rossmann-store-sales/discussion/17974", "anchor_text": "Kaggle", "paragraph_index": 29}, {"url": "https://scholarworks.uark.edu/cgi/viewcontent.cgi?referer=https://www.google.com/&httpsredir=1&article=1028&context=csceuht", "anchor_text": "This paper", "paragraph_index": 34}, {"url": "https://skorch.readthedocs.io/en/stable/user/quickstart.html#grid-search", "anchor_text": "skorch", "paragraph_index": 35}, {"url": "https://www.kaggle.com/fl2ooo/nn-wo-pseudo-1-fold-seed", "anchor_text": "kaggle", "paragraph_index": 37}, {"url": "https://github.com/spiyer99/spiyer99.github.io/blob/master/nbs/medium_food_demand_prediction_mealkit.ipynb", "anchor_text": "Github", "paragraph_index": 38}], "all_paragraphs": ["So this is going to overfit.", "Time series problems usually struggle with overfitting. This entire exercise became more of a challenge to see how I could prevent overfitting in time series forecasting.", "I added weight decay and dropout. This should work to prevent overfitting. The network has embedding layers for categorical variables (which I vary in size) followed by dropout and batch normalisation (for continuous variables).", "According to this article ideally, you want lower amounts of dropout and larger amounts of weight decay.", "The data is given by a meal kit company. As food is perishable, planning and demand prediction is extremely important.", "Getting this wrong can spell disaster for a meal kit company. Replenishment is typically done on a weekly basis. We need to forecast demand for the next 10 weeks.", "Thanks to Fastai, normalising, filling missing values and encoding categorical variables is now a relatively simple process.", "Next, we\u2019ll create embeddings for each categorical variable. The question is though, how large should each categorical embedding be? Fastai has a good rule of thumb where the categorical embedding is given by the following:", "This means the size of the embedding would be either the number of unique values in the categorical variable, divided by 2 and rounded down. Or it could be 50. Whichever one is smallest.", "Our final embedding size dictionary looks like this", "We\u2019ll need to adjust our model architecture. This is always the hardest part. Several articles highlight the importance of getting the model architecture right. In many ways, this could be seen as the \u2018new\u2019 feature engineering.", "This paper by Leslie Smith poses an interesting way to approach to select hyperparameters in a more disciplined way. I\u2019ll be modelling the implementation from this kaggle kernel.", "We need to find the optimal learning rate, weight decay and embedding dropout. According to Leslie Smith, to select the optimal hyperparameters we need to run a learning rate finder for a few different values of weight decay and dropout. Then we select the largest combination that has the lowest loss, highest learning rate (before rapidly increasing) and highest weight decay.", "That\u2019s a lot to consider. What\u2019s more, there are a few other hyperparameters we haven\u2019t considered. For those, I\u2019ll be borrowing a model architecture with relatively large layers. This model was used to rank 3rd place in the Rossman Kaggle competition.", "Finally, I\u2019ll need to consider batch size. According to Leslie, this should be set as high as possible to fit onto all available memory. I\u2019m only too happy to do that. That reduces my training time significantly.", "I used the learning rate finder in Fastai to visualise the loss as we change the model architecture. From there, I created a rudimentary gridsearch. I don\u2019t want to implement a crazy in depth grid search- that would be computationally expensive. A more manual approach is best I think.", "Once we plot out all different combinations of model architectures, things become a little clearer.", "Loss spikes earlier if we choose a model architecture with 0 weight decay. From the options a weight decay of `0.6` allows us to train a reasonably high learning rate with the lowest loss.", "While the learning rate that corresponds with the lowest level of loss is in the 1e-1 region, I won\u2019t be using that learning rate. Instead, I\u2019ll be choosing the 1e-2 value for the learning rate. That\u2019s a value on the safe side of the explosion. This has been shown to help in training.", "I\u2019ll be using learning rate annealing here. That\u2019s shown to work well.", "I\u2019ll keep fitting more cycles until validation starts to increase. I\u2019ll save the model after fitting for a few epochs. That way I get to use the best model later for inference.", "The best I was able to get was a validation loss of about 0.29 (rounding up).", "In a similar fashion to Martin Alacron\u2019s article. I\u2019d like to compare the performance of the neural network to more traditional approaches.", "XGBoost, Random Forest Regressor and LightGBM. How do they perform relative to a neural network?", "I will be using more or less the same data that the neural network used. Fastai has excellent pre-processing methods already built in.", "However, Fastai\u2019s categorical encoding is slightly odd. Fastai creates a dictionary from the categorical values to their encoding values. At inference time the categorical values are swapped for the encoding values.", "This is very smart and very useful. But it makes it slightly difficult to use Fastai pre-processed data with models outside of the Fastai ecosystem.", "To fix this, I created a simple script to convert the Fastai Tabular Data Bunch to data that we can feed to another model.", "Now we\u2019ll throw a bunch of regressors at the data. Each using the default values. I\u2019d like to know how the neural network performs relative to the standard approach of regression. Is it better? Worse?", "On this occasion, it seems that the other models outperformed the neural network. Despite this, deep learning models with category embeddings are very popular on Kaggle. I may need to vary the amount of dropout and weight decay that I\u2019m using. But for now, RandomForestRegressor is the best model in terms of RMSPE.", "1. Model Architecture. I\u2019d like to vary more hyperparamters, while avoiding a costly grid search. This could be the single most useful thing in improving the model further.", "Fastai explicitly warns you to not reduce parameters to avoid overfitting. Instead, use dropout and weight decay liberally.", "I\u2019ve tried to do that here. But I still ended up overfitting slightly. Varying hyperparameters could probably assist in reducing overfitting further still.", "Specifically, I could probably benefit from varying dropout. I\u2019d like to vary the dropout for the embedding layer and more importantly the probability of dropout.", "This paper speaks to the effectiveness of dropout in large *deep* neural networks. Perhaps making the network deeper and applying dropout more liberally could improve the performance?", "Gridsearch could be implemented randomly. This is called random search. I could do this using skorch potentially.", "2. I\u2019d also like to try Prophet from Facebook. It\u2019s an open source tool for time series forecasting. I\u2019d like to see how that performs relative to this neural network.", "3. Blending. A first place solution on kaggle used a neural network blended with a lightGBM model. This could be promising for future research.", "The full code is available on my Github", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6f1e3b2207aa&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://neel-iyer.medium.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1----6f1e3b2207aa---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@lvnatikk", "anchor_text": "Lily Banse"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://www.fast.ai/2018/07/02/adam-weight-decay/", "anchor_text": "weight decay"}, {"url": "https://www.cs.toronto.edu/~hinton/absps/JMLRdropout.pdf", "anchor_text": "dropout"}, {"url": "https://arxiv.org/abs/1502.03167", "anchor_text": "batch normalisation"}, {"url": "https://medium.com/@lankinen/fast-ai-lesson-6-notes-part-1-v3-646edf916c04", "anchor_text": "this article"}, {"url": "https://datahack.analyticsvidhya.com/contest/genpact-machine-learning-hackathon-1/#ProblemStatement", "anchor_text": "meal kit company"}, {"url": "https://smerity.com/articles/2016/architectures_are_the_new_feature_engineering.html", "anchor_text": "\u2018new\u2019 feature engineering"}, {"url": "https://arxiv.org/abs/1803.09820", "anchor_text": "This paper"}, {"url": "https://scholar.google.com/citations?user=pwh7Pw4AAAAJ&hl=en", "anchor_text": "Leslie Smith"}, {"url": "https://www.kaggle.com/qitvision/a-complete-ml-pipeline-fast-ai", "anchor_text": "this kaggle kernel"}, {"url": "https://github.com/fastai/fastai/blob/master/courses/dl1/lesson3-rossman.ipynb", "anchor_text": "This model"}, {"url": "https://sgugger.github.io/how-do-you-find-a-good-learning-rate.html", "anchor_text": "shown"}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "shown to work well"}, {"url": "https://www.martinalarcon.org/2018-12-31-b-water-pumps/", "anchor_text": "article"}, {"url": "https://forums.fast.ai/t/fastai-v2-code-walk-thru-8/55068", "anchor_text": "are swapped"}, {"url": "https://www.martinalarcon.org/2018-12-31-b-water-pumps/", "anchor_text": "https://www.martinalarcon.org/2018-12-31-b-water-pumps/"}, {"url": "https://www.kaggle.com/c/rossmann-store-sales/discussion/17974", "anchor_text": "Kaggle"}, {"url": "https://scholarworks.uark.edu/cgi/viewcontent.cgi?referer=https://www.google.com/&httpsredir=1&article=1028&context=csceuht", "anchor_text": "This paper"}, {"url": "https://skorch.readthedocs.io/en/stable/user/quickstart.html#grid-search", "anchor_text": "skorch"}, {"url": "https://www.kaggle.com/fl2ooo/nn-wo-pseudo-1-fold-seed", "anchor_text": "kaggle"}, {"url": "https://github.com/spiyer99/spiyer99.github.io/blob/master/nbs/medium_food_demand_prediction_mealkit.ipynb", "anchor_text": "Github"}, {"url": "https://spiyer99.github.io/Mealkit-Food-Demand-Forecasting/", "anchor_text": "spiyer99.github.io"}, {"url": "https://medium.com/tag/meal-kit?source=post_page-----6f1e3b2207aa---------------meal_kit-----------------", "anchor_text": "Meal Kit"}, {"url": "https://medium.com/tag/time-series-forecasting?source=post_page-----6f1e3b2207aa---------------time_series_forecasting-----------------", "anchor_text": "Time Series Forecasting"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----6f1e3b2207aa---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----6f1e3b2207aa---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----6f1e3b2207aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----6f1e3b2207aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6f1e3b2207aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6f1e3b2207aa---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6f1e3b2207aa--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://neel-iyer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "418 Followers"}, {"url": "https://www.linkedin.com/in/neel-iyer/", "anchor_text": "https://www.linkedin.com/in/neel-iyer/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa4687e9ccf6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-food-demand-applying-neural-networks-to-the-meal-kit-industry-6f1e3b2207aa&newsletterV3=e7c5e1c9cae1&newsletterV3Id=a4687e9ccf6&user=Neel+Iyer&userId=e7c5e1c9cae1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}