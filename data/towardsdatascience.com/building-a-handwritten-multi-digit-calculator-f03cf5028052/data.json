{"url": "https://towardsdatascience.com/building-a-handwritten-multi-digit-calculator-f03cf5028052", "time": 1683017609.6607811, "path": "towardsdatascience.com/building-a-handwritten-multi-digit-calculator-f03cf5028052/", "webpage": {"metadata": {"title": "Building a Handwritten Multi-Digit Calculator | by Neerav Gala | Towards Data Science", "h1": "Building a Handwritten Multi-Digit Calculator", "description": "In order to easily follow this article, I recommend understanding the basics of the following topics first: Convolutional Neural Networks are a subclass of Deep Learning algorithms mainly used for\u2026"}, "outgoing_paragraph_urls": [{"url": "https://drive.google.com/drive/folders/1Sky2lWnEuSsW4UizwLZkh6e__cY7UjSl?usp=sharing", "anchor_text": "here", "paragraph_index": 10}, {"url": "https://www.kaggle.com/yassineghouzam/introduction-to-cnn-keras-0-997-top-6", "anchor_text": "Kaggle Notebook.", "paragraph_index": 25}, {"url": "https://github.com/neeravgala1994/Handwritten_Multi-Digit_Calculator.git", "anchor_text": "GitHub repository.", "paragraph_index": 26}], "all_paragraphs": ["The aim of this article is to :", "In order to easily follow this article, I recommend understanding the basics of the following topics first:", "If you are familiar with these topics, then lets dive right into it!", "Convolutional Neural Networks are a subclass of Deep Learning algorithms mainly used for analyzing visual imagery. High amounts of training data, increasing computational powers and advanced deep learning techniques have paved the way for CNNs to perform complex visual tasks [1].", "It all started in 1958 when David H. Hubel and Torsten Wiesel performed a series of experiements to understand the structure of the visual cortex (for which the won the Nobel Prize in 1981). The authors found that some neurons had larger receptive fields and would react to complex patterns that were a combination of lower-level patterns detected by other neurons. These observations led to the idea that the higher level neurons are based on the outputs of neighboring lower-level neurons[2].", "This powerful visual architecture evolved over the years until, a paper by Yann LeCun et al. in 1998, formulated the famous LeNet-5 architecture. In this paper, the concept of convolutional and pooling layers was introduced[2].", "Today, many companies employ CNN for analyzing visual imagery. The following are a few examples:", "The objective of this article is to show you how to build a CNN model that can do the following:", "The model is build with keras API (Tensorflow backend) using Python.", "From the next section onwards, I request you to first copy the section\u2019s code into your IDE before reading the section.", "The dataset used for this project can be found in here (file name is dataset.csv). It is an extension of the MNIST dataset and contains 85,709 images of Arabic numerals (0 to 9) and mathematical operators (+, - , * and /). Each image is of size 28 X 28 pixels. In order to be easily encoded, the mathematical operators are numerically labelled as follows:", "In the first code snippet, the downloaded datase is loaded as a Pandas dataframe of size (85709 X 785). The labels (y) are separated from the dataset (X).", "To reduce the effect of illumination, the dataset is gray scale normalized by dividing the dataset by 255. Next the dataset is reshaped to fit the standards of a 4D Tensor ([mini-batch size, height = 28px, width = 28px, channels = 1 due to grayscale]).", "Next, the labels are converted from class vectors (14 class vectors) to binary class matrices (necessary for train Keras models).", "Lastly, the data is split into training(90%) and validation(10%). The dataset is now ready to be used to train the model.", "The CNN model is build using Keras\u2019 Sequential model class. The table below shows the list of layers (and hyperparameters) passed to create the model.", "Once the layers are added, the training parameters (loss function, score function and optimzation function) are defined.", "The loss function measures the error rate between the observed and predicted labels. For this model, categorical_crossentropy is used as th loss function.", "Next, the famous RMSprop is used as the optimizer algorithm to iteratively improves various model parameters. RMSprop is also one of the fastest optimizers.", "The metric function \u201caccuracy\u201d is used as the score function to evaluate the performance our model.", "In order to make the optimizer converge faster and closest to the global minimum of the loss function, the ReduceLROnPlateau function from Keras.callbacks is used as an annealing method of the learning rate (LR).", "To avoid overfitting, the dataset is expanded by artificially altering the existing dataset (zooming, shifting, etc). This process is called Data Augmentation and is executed using Keras\u2019 ImageDataGenerator.", "Finally the model is trained on the dataset with 5 epoches and a batch size of 86.", "The model took about 35 mins to train and reached a validation accuracy of 99.17 % after the 5th epoch.", "The trained model is now ready to make some predictions! The model (with its trained structure and weights) can also be saved your computer.", "Note: Section 1 & 2 of the article was inspired from this Kaggle Notebook.", "Now it is time to use the trained model to analyze the image of a handwritten mathematical expression. The image (file name is testing.png) used in this artciel is available in my GitHub repository.", "To analyze the mathematical expression, it first needs to broken down into individual elements which can be then identified by the model.", "To do that, the image file (3066 pixels * 208 pixels) is first loaded in grayscale using Pillow (PIL).", "Then the image is resized to a height of 28 px (model input requirement). Keeping the same aspect ratio, the width is adjusted as well.", "Next, the image is converted from PIL.Image to a Numpy array. The background is changed to black by subtracting 255 and the image is gray scale normalized by dividing by 255. The image looks something like this.", "Note: Use matplotlib.pyplot.imshow to display arrays as an image", "Now the image array is split into individual element arrays. This is done by searching the image array for successive non zero columns and grouping them to form one element array. These element arrays are all stored in one list. Since there are 14 elements in the mathematical expression, the size of the list is 14.", "In order to identify the element using the model, it is important to have the image size of 28px*28px. The height is already 28px. However, due to the splitting process, the width of each element is not exactly 28px.", "Therefore, after the splitting, the width of each element is adjusted to 28 px. by adding zero value columns (filler columns) to the element arrays.", "This process is repeated for all elements until all are 28px *28px.", "Finally, the elements list is converted back into an array of shape (14, 28, 28, 1) to fit the model input requirements of a 4D Tensor [mini_batch_size, height, width, channels].", "Now these elements array is ready to for the model!", "The elements array is passed through the model for prediction. The model returns the probabilities of all the number classes (Softmax function). The class with the highest probability is chosen.", "As you can see, the model was able to predict all the elements properly!", "The next step is to build the mathematical expression out of these elements and calculate it. Lets get right into it.", "Once all the individual elements are identified, it is time to create the mathematical expression and calculate it.", "In order to create the mathematical expression, the number classes (0 to 9) are regrouped to form the multi digit numbers. While 10, 11, 12 and 13 classes are converted to \u201c/\u201d, \u201c+\u201d, \u201c-\u201d and \u201c*\u201d operators respectively.", "[1 0] \u2192 Elements of class 1 and 0 are regrouped to form the number 10", "[10] \u2192 Elements of class 10 are converted to the \u201c/\u201d operator", "Finally, the numbers and operators are joined together to form a string respresenting the mathematical expression.", "The eval() method is then used on the string to calculate the answer.", "Sometimes, due to wrong predictions like \u201c4++4\u201d the mathematical expressions are incorrect and hence, the eval() method will prompt a Syntax error. Hence, Error Handling method is used.", "That\u2019s it. The Multi Digit Handwritten Calculator is ready!", "But wait, what to do about wrong prediction? The next section is all about that.", "What makes Machine learning algorithms so powerful is its ability to learn from its mistakes. In order to do that the model needs to be retrained with correct information.", "When there is a false prediction, the above code asks for the correct mathematical expression from the user. It then compares the predicted with the correct expression and identifies the elements that are wrongly predicted.", "The code then trains the model from its second hidden layer till its output layer using the correct data (first hidden layer is not trained).", "The updated model is saved and can be used later to make improved predictions.", "The article aims to teach you the basics of how CNN models can be used to make simple tools like the calculator. In the future, these basic concepts can help you perform complex visualization analysis and build sophisticated models.", "I hope you found this article helpful. If you have any questions or feedback, just leave a comment. Cheers!", "[2] A. G\u00e9ron, Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow: Concepts, Tools, and Techniques to Build Intelligent Systems. O\u2019Reilly Media, Inc., 2019.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff03cf5028052&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f03cf5028052--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pymycode?source=post_page-----f03cf5028052--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pymycode?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Neerav Gala"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc08ab031c5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&user=Neerav+Gala&userId=c08ab031c5d6&source=post_page-c08ab031c5d6----f03cf5028052---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markusspiske", "anchor_text": "Markus Spiske"}, {"url": "https://unsplash.com/?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://youtu.be/iaSUYvmCekI", "anchor_text": "this youtube video"}, {"url": "https://drive.google.com/drive/folders/1Sky2lWnEuSsW4UizwLZkh6e__cY7UjSl?usp=sharing", "anchor_text": "here"}, {"url": "https://www.kaggle.com/yassineghouzam/introduction-to-cnn-keras-0-997-top-6", "anchor_text": "Kaggle Notebook."}, {"url": "https://github.com/neeravgala1994/Handwritten_Multi-Digit_Calculator.git", "anchor_text": "GitHub repository."}, {"url": "https://drive.google.com/drive/folders/1Sky2lWnEuSsW4UizwLZkh6e__cY7UjSl?usp=sharing", "anchor_text": "here"}, {"url": "https://github.com/neeravgala1994/Handwritten_Multi-Digit_Calculator.git", "anchor_text": "here."}, {"url": "https://en.wikipedia.org/w/index.php?title=Convolutional_neural_network&oldid=992073762.", "anchor_text": "https://en.wikipedia.org/w/index.php?title=Convolutional_neural_network&oldid=992073762."}, {"url": "https://www.tesla.com/autopilotAI", "anchor_text": "https://www.tesla.com/autopilotAI"}, {"url": "https://developers.google.com/machine-learning/practica/image-classification", "anchor_text": "https://developers.google.com/machine-learning/practica/image-classification"}, {"url": "https://engineering.fb.com/2017/05/09/ml-applications/a-novel-approach-to-neural-machine-translation/", "anchor_text": "https://engineering.fb.com/2017/05/09/ml-applications/a-novel-approach-to-neural-machine-translation/"}, {"url": "https://kaggle.com/yassineghouzam/introduction-to-cnn-keras-0-997-top-6", "anchor_text": "https://kaggle.com/yassineghouzam/introduction-to-cnn-keras-0-997-top-6"}, {"url": "http://introtodeeplearning.com", "anchor_text": "http://introtodeeplearning.com"}, {"url": "https://medium.com/tag/convolutional-neural?source=post_page-----f03cf5028052---------------convolutional_neural-----------------", "anchor_text": "Convolutional Neural"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f03cf5028052---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----f03cf5028052---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----f03cf5028052---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&user=Neerav+Gala&userId=c08ab031c5d6&source=-----f03cf5028052---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&user=Neerav+Gala&userId=c08ab031c5d6&source=-----f03cf5028052---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff03cf5028052&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f03cf5028052---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f03cf5028052--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f03cf5028052--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f03cf5028052--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f03cf5028052--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f03cf5028052--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pymycode?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pymycode?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neerav Gala"}, {"url": "https://medium.com/@pymycode/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "16 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc08ab031c5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&user=Neerav+Gala&userId=c08ab031c5d6&source=post_page-c08ab031c5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdc09b94200dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-handwritten-multi-digit-calculator-f03cf5028052&newsletterV3=c08ab031c5d6&newsletterV3Id=dc09b94200dd&user=Neerav+Gala&userId=c08ab031c5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}