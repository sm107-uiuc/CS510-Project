{"url": "https://towardsdatascience.com/key-driver-analysis-in-python-788beb9b8a7d", "time": 1683016034.726263, "path": "towardsdatascience.com/key-driver-analysis-in-python-788beb9b8a7d/", "webpage": {"metadata": {"title": "Doing key-driver analysis in python | by B macher | Towards Data Science", "h1": "Doing key-driver analysis in python", "description": "In a Data Science interview a few years ago, I was challenged to use a small data set from our friends at FiveThirtyEight to suggest how best to design a good-selling candy. \u201cBased on \u2018market\u2026"}, "outgoing_paragraph_urls": [{"url": "https://fivethirtyeight.com/", "anchor_text": "FiveThirtyEight", "paragraph_index": 0}, {"url": "https://fivethirtyeight.com/videos/the-ultimate-halloween-candy-power-ranking/", "anchor_text": "FiveThirtyEight made a grave statistical error", "paragraph_index": 2}, {"url": "https://public.tableau.com/profile/bryce.macher#!/vizhome/CandyIntelligenceDashboard/Candiesresearch", "anchor_text": "my candy dashboard", "paragraph_index": 3}], "all_paragraphs": ["In a Data Science interview a few years ago, I was challenged to use a small data set from our friends at FiveThirtyEight to suggest how best to design a good-selling candy. \u201cBased on \u2018market research\u2019 you see here,\u201d the prompt gestured, \u201cadvise the product design team on the best features of a candy that we can sell alongside brand-name candies.\u201d", "As a data scientist in the applied, commercial world, the word best is always a weasel word intended to test your business awareness. One of the tell-tale signs of a greener data scientist is whether they\u2019re thinking about the best business outcome vs. the best machine learning model. \u2018Best\u2019 is a balance of \u2018what candy elements drive the highest satisfaction/enjoyment?\u2019 and \u2018what candy elements drive the highest price?\u2019 We\u2019re basically trying to find a balance between", "Our friends at FiveThirtyEight made a grave statistical error (or two) when trying to solve for #1.", "This tutorial walks through doing \u2018key driver\u2019 analysis in python using the proper statistical tools, breaking away from the FiveThirtyEight methodology. Along the way, I explain 1) why data scientists and product strategists should trust my numbers more, and 2) how to communicate those results in a way that gains that trust (see my candy dashboard).", "Here\u2019s the roadmap of this article:", "Let\u2019s set out for our statistical methodology by way of understanding why linear regression is not the right answer\u2026 or at least not really the right answer.", "FiveThirtyEight builds a multiple regression, including all possible features of a candy captured in their data set. Importance is abstracted from the coefficients of the linear regression, using the P-value of the dimension to define whether we can take it as reliable.", "However, looking at the equation for a linear regression, we see a pretty significant problem. Remember: an OLS regression coefficient tells us whether an increase in the independent variable correlates to an increase in the mean of the dependent variable (and vice versa for negative). But it\u2019s measure of magnitude.", "In our candy problem, if we build an OLS regression to predict the winning-ness of a candy-bar, and we change the units from grams to pounds, we would get a much higher coefficient. The volume didn\u2019t change anything besides units. The argument here might be made that you can standardize your variables, such as normalizing to 0 mean and unit variance. Still yet, with normalization, you may have an issue of collinearity \u2014 if predictors are linearly dependent or highly correlated, the OLS becomes unstable, which will be true even when the independent variables are standardized.", "So we need another tool in our toolbelt. Something that can help us get around the bad assumptions about coefficients. While ML may not have the answer, statistics does.", "Here, we\u2019ll implement code that will tell us how much each feature/independent variable contributes to criterion variance (R2). In its raw form, Relative Weight Analysis returns raw importance scores whose sum equals to the overall R2 of a model; it\u2019s normalized form allows us to say \u201cFeature X accounts for Z% of variance in target variable Y.\u201d Or, more concretely,", "\u201cAssuming that a key driver of what makes a candy popular is captured here, Chocolates with nuts is the winning-est flavor combination.\u201d", "Relative weight analysis relies on the decomposition of R2 to assign importance to each predictor. Where intercorrelations between independent variables make it near impossible to take standardized regression weights as measure of importance, RWA solves this problem by creating predictors that are orthogonal to one another and regressing on these without the effects of multicollinearity. They are then transformed back to the metric of the original predictors.", "We have multiple steps involved, and rather than demonstrate in notation, I\u2019ll walk through a python script that you\u2019ll be able to use (please credit this post if you use this verbatim or spin-off your own version!) I\u2019m assuming that at this point you\u2019ve done your EDA and manipulations necessary to build a logically and mathematically sound model.", "Step 1: Get a correlation between all of the dependent and independent variables.", "Step 2: Create orthogonal predictors using eigenvectors and eigenvalues on the correlation matrix, creating a diagonal matrix of the square root of eigenvalues. This gets around the issue of multi-collinearity. Note the python tricks for getting the diagonal indices.", "Step 3: Multiply the eigenvector matrix and its transposition (in python, we can use @ as an operator, called __matmul__). This allows us to treat X as the set of dependent variables, regressing X onto matrix Z \u2014 itself the orthogonal counterpart of X having the least squared error. To get the partial effect of each independent variable, we apply matrix multiplication to the inverse and correlation matricies.", "NOTE: As mentioned, the sum of the squares of coef_yz above should add up to the total R2! This will be important in the next step!", "Step 4: We then calculate the relative weight as the multiplication of the matrix in Step 2 and step 3. The normalized version is then the percentage of r2 that these account for!", "Now, you can just zip up your features and these two lists to get the relative weight of each one as it \u2018drives\u2019 (or, more mathematically, accounts for variance in relation to increases in) the percentage of wins in the candy duals.", "Chocolate and nuts wins flavors, but we\u2019re not done. We have to also make money by generating value from the candy we create, measured by revenue minus costs. Using price percentiles in our table, we can also look at what drives the prices of candy.", "We have two responsibilities here: make recommendations, and make stakeholders comfortable with acting on them.", "Recommendation 1: Chocolate accounts for 38% of what makes a candy a winner, while peanuts account for 15% when we look at key drivers of win percentage. We can confirm this by looking at the relative win percentage of candys that are both chocolate and peanutty in our sample.", "Recommendation 2: Pluribus candies account for the lowest driver of cost (3% relative weight) relative to other forms, which helps offset our chocolate and nut costs.", "Recommendation 3: According to our data, savory pluribus chocolatey peanutyalmondy candies are not readily available despite higher performance. There were only 2 captured in our dataset.", "These recommendations can be further backed up by analyzing candy in the amazon grocery data, which has 2.9M candy reviews.", "While fruit out-ranks nuts in flavor/review score in the Amazon data, it remains in the top 3.", "Further, a topic model built form high selling (>50th percentile), highly-ranked (>3 star) Amazon chocolate and nut reviews further suggest that our flavor profile is a winning decision.", "Indeed, we might think of Key-Driver analysis as somewhat of a hunt for the holy grail, in that there are so many different possible confounding variables that knowing what lever to pull to drive our target variable is a shot in the dark. But we can get better confidence by abandoning the traditional (albeit mistaken) use of linear regression coefficients, and moving to relative weight analysis. And, to be sure, this version has some improvements \u2014 if you\u2019re paying attention to that R2 total in flavor profiles, and try it yourself with pricing, you\u2019ll see that there is room for improvement to be had through various mathematical optimizations.", "Hidden here is a story about how data scientists must be well-versed in the statistics and math behind reducing business risk and maximizing the potential of decisions. Otherwise, we\u2019re just low rent software devs/engineers solving input/output problems that could cost the business significantly.", "For those DS leaders and managers reading, this example shows how building data science teams that don\u2019t have a mix of both statistics-forward and technology-forward data scientists is a recipe for disaster. Why? Well, in this case, \u2018how do we make the best candy?\u2019, is at once a statistics problem and business domain question, and isn\u2019t readily solvable with an sklearn API call.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data leader for a decade+. Driving ML & Applied Personalization Science @ NBCU (ex- WarnerMedia, Discovery, Snowflake, BAH, Hilton, Prof). Motorcycle guy, too."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F788beb9b8a7d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://brycemacher.medium.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": ""}, {"url": "https://brycemacher.medium.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "B macher"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa0c2dfa79e32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&user=B+macher&userId=a0c2dfa79e32&source=post_page-a0c2dfa79e32----788beb9b8a7d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/hands-on-tutorials", "anchor_text": "Hands-on Tutorials"}, {"url": "https://public.tableau.com/profile/bryce.macher#!/vizhome/CandyIntelligenceDashboard/Candiesresearch", "anchor_text": "here"}, {"url": "https://fivethirtyeight.com/", "anchor_text": "FiveThirtyEight"}, {"url": "https://datahub.io/five-thirty-eight/candy-power-ranking", "anchor_text": "here"}, {"url": "https://fivethirtyeight.com/videos/the-ultimate-halloween-candy-power-ranking/", "anchor_text": "FiveThirtyEight made a grave statistical error"}, {"url": "https://public.tableau.com/profile/bryce.macher#!/vizhome/CandyIntelligenceDashboard/Candiesresearch", "anchor_text": "my candy dashboard"}, {"url": "https://www.researchgate.net/profile/Nicola_Di_Girolamo2/post/Which_is_the_Best_Effect-Size_for_Predictors_in_Multivariate_Logistic_Regression/attachment/59d632e0c49f478072ea1d4a/AS%3A273637431545864%401442251655932/download/Relative+Importance+Analysis%3A+A+Useful+Supplement+to+Regression+Analysis.pdf", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----788beb9b8a7d---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----788beb9b8a7d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/marketing?source=post_page-----788beb9b8a7d---------------marketing-----------------", "anchor_text": "Marketing"}, {"url": "https://medium.com/tag/product?source=post_page-----788beb9b8a7d---------------product-----------------", "anchor_text": "Product"}, {"url": "https://medium.com/tag/hands-on-tutorials?source=post_page-----788beb9b8a7d---------------hands_on_tutorials-----------------", "anchor_text": "Hands On Tutorials"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&user=B+macher&userId=a0c2dfa79e32&source=-----788beb9b8a7d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&user=B+macher&userId=a0c2dfa79e32&source=-----788beb9b8a7d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F788beb9b8a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----788beb9b8a7d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----788beb9b8a7d--------------------------------", "anchor_text": ""}, {"url": "https://brycemacher.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://brycemacher.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "B macher"}, {"url": "https://brycemacher.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "246 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa0c2dfa79e32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&user=B+macher&userId=a0c2dfa79e32&source=post_page-a0c2dfa79e32--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F80da3c0ddaeb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkey-driver-analysis-in-python-788beb9b8a7d&newsletterV3=a0c2dfa79e32&newsletterV3Id=80da3c0ddaeb&user=B+macher&userId=a0c2dfa79e32&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}