{"url": "https://towardsdatascience.com/rendezvous-architecture-for-data-science-in-production-79c4d48f12b", "time": 1682995245.745208, "path": "towardsdatascience.com/rendezvous-architecture-for-data-science-in-production-79c4d48f12b/", "webpage": {"metadata": {"title": "Rendezvous Architecture for Data Science in Production | by Jan Teichmann | Towards Data Science", "h1": "Rendezvous Architecture for Data Science in Production", "description": "How to build a cutting edge data science platform to solve the real challenge in Data Science: Productionisation. An Introduction to the Rendezvous Architecture."}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/teddunning/", "anchor_text": "Ted Dunning", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/ellen-friedman-a93743/", "anchor_text": "Ellen Friedman", "paragraph_index": 13}, {"url": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "anchor_text": "free ebook", "paragraph_index": 13}, {"url": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "anchor_text": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "paragraph_index": 17}, {"url": "https://pulsar.apache.org/en/", "anchor_text": "link", "paragraph_index": 28}, {"url": "https://pulsar.apache.org/docs/latest/getting-started/ConceptsAndArchitecture/#Topiccompaction-050li", "anchor_text": "link", "paragraph_index": 28}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/", "paragraph_index": 37}], "all_paragraphs": ["It is impossible to miss how the data field gained some new buzzwords. It used to be \u2018big data\u2019 but, as of late, it is dominated by data lakes, machine learning, AI, blockchains and data science unicorns. With the data science hype there is an expanding ecosystem around it with an ever growing number of big data platforms promising to make data science easy and commercially successful for the masses.", "But what is so different about data science that it needs new approaches and all these new platforms and products?", "A survey in 2016 concluded that 80% of data science is preparing and cleaning data (the 80/20 rule). That survey of data scientists caught on and developed into the widely recognised problem statement for data science. Unfortunately. Because if you take one thing away from this blog post then", "\u201c Productionisation of models is the TOUGHEST problem in data science\u201d (Schutt, R & O\u2019Neill C. Doing data science straight from the front line, O\u2019Reilly Press. California, 2014)", "and not the preparation of data.", "To understand why data science is different I still start with that infamous 80/20 rule and the cross industrial standard process for data mining (CRISP-DM). Even though CRISP-DM predates today\u2019s data science discipline it perfectly describes a big part of a data scientists daily work. The aspect which seems to have changed since 1996 is the amount of badly integrated data sources and the growing emphasis of the data preparation step. It\u2019s therefore no surprise how popular the 80/20 rule became.", "But in data science CRISP-DM is just half of the picture! Models are not ordinary software and one does not just deploy data science (insert meme here!). Models have a unique lifecycle management, and unique integration, automation and operational requirements.", "Models in production are dynamic and have a complex life cycle. Unfortunately, model management in production is rarely discussed or addressed. The focus remains on data preparation and the importance of the 80/20 rule.", "However, managing a single model is not the full picture either and the complexities in data science continue. At some point there will be a challenger model:", "A way to address this could be with a traditional A/B test scenario and traffic split. But you would only see a single model response in isolation. Imagine you are trying to test a recommendation model which is heavily dependent on the context of the users being scored. Would it not be so much better to score requests with all models in parallel to simply compare their scores like for like? Additionally, your challenger model might not work so well after all. Unfortunately, you would have to expose 10% of users to an inferior experience just to find out. This clearly needs a better approach.", "But we are still not done. In a successful data science endeavour, the boundaries of development and production are increasingly blurry. A single business objective will see many different incumbent and challenger models, and a requirement to retrain these models in a constantly changing environment with their continuous benchmarking, monitoring and production hand-over. The actual real world scenario will quickly look much more like this:", "These are requirements giving any IT department a good run for its money. The challenge becomes to address the increasing heterogeneity of the data science toolkits, the required elasticity and flexibility of the data infrastructure, and the end-to-end automation of the complex data science model life cycle.", "Summarising the previous introduction to the problem statement, we are looking for some architecture to", "The solution to this very real data science problem came from Ted Dunning and Ellen Friedman named Rendezvous Architecture in their book Machine Learning Logistics(O\u2019Reilly 2017)(free ebook). At the core of the architecture stands Input Data as a Stream and models subscribing to the data using a pub-sub messaging pattern. Receiving scoring requests via a stream allows us to easily distribute a request and evaluate a big number of models in parallel.", "But it does not solve how to return a response robustly from a big number of models while upholding enterprise requirements.", "To return a response the architecture also treats model scores as a stream in combination with the name lending Rendezvous service. Conceptually, the rendezvous service subscribes to the original scoring requests to combine them with model scores from the model response stream.", "Subscribing to scoring requests in the rendezvous services decouples the ability to return a response from the models successfully returning scoring outputs. It also allows the rendezvous service to implement an SLA: in a scenario where the models are failing or are delayed and no scoring output reaches the rendezvous service within the SLA the rendezvous service can, for example, send a meaningful default response. This is possible because the rendezvous service was aware of the scoring request in the first place. The rendezvous service implements a race condition of model scoring outputs versus configurable SLAs and timeout policies.", "For a much more detailed introduction of the rendezvous architecture you should read Ted Dunning\u2019s and Ellen Friedman\u2019s great book: https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "Taking this conceptual architecture and applying it to the requirements we set out we get the following data science platform:", "We split the architecture as desired into a hierarchy of a business objective which implements enterprise requirements and the modelling objectives of the data science team.", "The entire platform is built with containerised stateless services which provides the desired decoupling and scalability. Even stateful models can be implemented on the platform with the help of the Model Data Enricher as discussed below in step 3.", "Most of the platform is fairly straightforward as it is composed of stateless containerised services and a simple pub/sub messaging pattern. In production this can be deployed easily on Kubernetes using helm charts and the horizontal pod autoscaler and round-robin load balancing. Actually, every grouped entity in the platform diagram within the business and modelling objectives are pods which are horizontally scaled.", "The main challenge is the implementation of the Rendezvous Service which is stateful. Conceptually, it\u2019s best to describe the rendezvous service as a mailbox. Each active scoring request has an active mailbox waiting for model scoring responses. These mailboxes receive the model scores for their corresponding scoring request and execute the attached score evaluation policies.", "As model scores are published to a stream, each mailbox could subscribe to that stream and filter out their relevant model scores for evaluation (fan-out pattern). This would duplicate the messages for each subscribed mailbox. At the scale of 50+k requests per minute and a big number of incumbent and challenger models returning scores in parallel this would be impractical. To achieve scale we have to keep each running policy instance as lightweight as possible.", "We implemented the Score Evaluation Service in Python using the asyncio library to implement an async event driven policy evaluation. The following code is a simplified version of the service:", "As shown in the code snippet the model score evaluation policy starts an async unix socket server. The path of the socket is given by the uuid of the policy instance. This is all what\u2019s needed to receive model scores. Alongside the evaluation service a sidecar Score Collection Service subscribes to the model response stream.", "It sends the messages to the unix socket of the corresponding score evaluation policy instances based on the policy instance ID. We attached that ID to the extended scoring request before publishing it to the data stream for that business objective in the Score Evaluation Service.", "To create connectivity between the Score Collection sidecar and the Score Evaluation Service I use a shared volume between the two containers for the unix sockets. This implementation pattern scales much better than the naive fan-out and a single Rendezvous Service instance can host a big number of concurrent score evaluation policies.", "I use Apache Pulsar (link) as a distributed pub-sub messaging system. Pulsar is not just a very performant messaging system, it scales easily to a very big number of topics and was built with highly scalable persistent storage of messages as a primary objective. Topic Compaction and Tiered Persistent Storage (link) allows the rendezvous platform in the future to persist messages indefinitely and replay scoring requests e.g. to test and validate a new challenger model or warm-up a model which maintains an internal state.", "The following picture shows an example from the minikube development environment:", "The request runs through all elements of the Rendezvous platform with a Total Time of 51ms. The test topic fetches a random number via the model data enricher and the model objective test-0 runs a simplistic model which returns the sum of all numeric values from the scoring request. I use that setup to test the elements of the rendezvous platform. Actual models are containerised and decoupled which allows us to test them independently. This means that the overhead for the rendezvous architecture is between 40\u201350ms. A pretty small cost for the wide range of benefits the architecture provides and leaving ample time to fetch external data points and evaluate complex models.", "The cost of doing it right is 40ms", "A load test of the minikube development environment shows that 100 requests per second are no big sweat either:", "The reference implementation demonstrated the benefits of the rendezvous architecture and showed very promising performance. I am currently working on the Kubernetes productionisation looking at helm and operators. I will follow up this blog post with the results of our production load testing as soon as we have deployed our platform on the production Kubernetes cluster.", "We are standing on the shoulders of giants. Credit where credit is due:", "Jan is a successful thought leader and consultant in the data transformation of companies and has a track record of bringing data science into commercial production usage at scale. He has recently been recognised by dataIQ as one of the 100 most influential data and analytics practitioners in the UK.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019m a Data Scientist by Profession; Techie, Geek and Innovator with Passion. https://www.linkedin.com/in/janteichmann/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F79c4d48f12b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jan.teichmann?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Jan Teichmann"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F941c2fa7cfd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&user=Jan+Teichmann&userId=941c2fa7cfd&source=post_page-941c2fa7cfd----79c4d48f12b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/wiki/File:CRISP-DM_Process_Diagram.png", "anchor_text": "wikimedia"}, {"url": "https://www.linkedin.com/in/teddunning/", "anchor_text": "Ted Dunning"}, {"url": "https://www.linkedin.com/in/ellen-friedman-a93743/", "anchor_text": "Ellen Friedman"}, {"url": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "anchor_text": "free ebook"}, {"url": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html", "anchor_text": "https://mapr.com/ebooks/machine-learning-logistics/ch03.html"}, {"url": "https://pulsar.apache.org/en/", "anchor_text": "link"}, {"url": "https://pulsar.apache.org/docs/latest/getting-started/ConceptsAndArchitecture/#Topiccompaction-050li", "anchor_text": "link"}, {"url": "https://www.linkedin.com/in/teddunning/", "anchor_text": "Ted Dunning"}, {"url": "https://www.linkedin.com/in/ellen-friedman-a93743/", "anchor_text": "Ellen Friedman"}, {"url": "https://www.linkedin.com/in/tpmccann/", "anchor_text": "Terry McCann"}, {"url": "http://www.advancinganalytics.co.uk/", "anchor_text": "www.advancinganalytics.co.uk"}, {"url": "https://www.linkedin.com/in/christopher-conroy-2aaa4566/", "anchor_text": "Christopher Conroy"}, {"url": "http://www.datasciencefestival.com", "anchor_text": "www.datasciencefestival.com"}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/"}, {"url": "https://medium.com/@jan.teichmann", "anchor_text": "https://medium.com/@jan.teichmann"}, {"url": "https://medium.com/tag/data-science?source=post_page-----79c4d48f12b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----79c4d48f12b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/big-data?source=post_page-----79c4d48f12b---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----79c4d48f12b---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&user=Jan+Teichmann&userId=941c2fa7cfd&source=-----79c4d48f12b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&user=Jan+Teichmann&userId=941c2fa7cfd&source=-----79c4d48f12b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F79c4d48f12b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----79c4d48f12b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----79c4d48f12b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----79c4d48f12b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----79c4d48f12b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jan.teichmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jan Teichmann"}, {"url": "https://medium.com/@jan.teichmann/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://www.linkedin.com/in/janteichmann/", "anchor_text": "https://www.linkedin.com/in/janteichmann/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F941c2fa7cfd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&user=Jan+Teichmann&userId=941c2fa7cfd&source=post_page-941c2fa7cfd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F463734a42bc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frendezvous-architecture-for-data-science-in-production-79c4d48f12b&newsletterV3=941c2fa7cfd&newsletterV3Id=463734a42bc7&user=Jan+Teichmann&userId=941c2fa7cfd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}