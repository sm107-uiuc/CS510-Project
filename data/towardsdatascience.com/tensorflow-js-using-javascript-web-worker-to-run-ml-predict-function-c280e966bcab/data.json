{"url": "https://towardsdatascience.com/tensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab", "time": 1683000285.087013, "path": "towardsdatascience.com/tensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab/", "webpage": {"metadata": {"title": "TensorFlow.JS \u2014 Using JavaScript Web Worker to Run ML Predict Function | by Andrej Baranovskij | Towards Data Science", "h1": "TensorFlow.JS \u2014 Using JavaScript Web Worker to Run ML Predict Function", "description": "Cool thing about TensorFlow.js it allows to run ML model trained with Python and converted to TensorFlow.js format. This post explains how to use JavaScript Web Worker to speed up Predict function."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/jiashenliu/515k-hotel-reviews-data-in-europe", "anchor_text": "515K Hotel Reviews Data in Europe", "paragraph_index": 1}, {"url": "http://www.booking.com", "anchor_text": "Booking.com", "paragraph_index": 1}, {"url": "https://sentiment-tfjs-node.herokuapp.com/", "anchor_text": "https://sentiment-tfjs-node.herokuapp.com/", "paragraph_index": 1}, {"url": "https://medium.com/@alyafey22/sentiment-classification-from-keras-to-the-browser-7eda0d87cdc6", "anchor_text": "Sentiment Classification from Keras to the Browser", "paragraph_index": 5}, {"url": "https://www.tensorflow.org/js/tutorials/conversion/import_keras", "anchor_text": "Importing a Keras model into TensorFlow.js", "paragraph_index": 13}, {"url": "https://www.oracle.com/webfolder/technetwork/jet/globalGetStarted.html", "anchor_text": "Oracle JET", "paragraph_index": 16}], "all_paragraphs": ["I\u2019m JavaScript developer and I feel great when the Machine Learning model runs on client-side (in the browser). I will cover several topics in this post, I believe you will find them useful, if you will decide to run ML model in the browser:", "I\u2019m using ML model to predict sentiment for a hotel review. I found this excellent dataset on Kaggle \u2014 515K Hotel Reviews Data in Europe. It provides 515K records for hotel reviews taken from Booking.com. Using this dataset I trained Keras model, converted it to be compatible with TensorFlow.js and then included into the client-side JS app. You can check how it works yourself, the app is deployed on Heroku \u2014 https://sentiment-tfjs-node.herokuapp.com/:", "Try typing Bed was comfy, you will get very low negativity score:", "Then add \u2014 Very noisy outside, negativity score will increase to neutral sentiment:", "How ML model was trained in Python", "Text sentiment classification is implemented using approach explained in Zaid Alyafeai post \u2014 Sentiment Classification from Keras to the Browser. I will not go deep into an explanation of how to build text sentiment classification, you can read it in Zaid post.", "To be able to train the model, I processed Hotel review dataset and extracted out of all attributes hotel review text and sentiment (0 \u2014 positive, 1 \u2014 negative). I was using a subset of data to train the model, to reduce training time. First 100k reviews were used by me:", "The model was trained in 5 epochs, using batch size = 128 (larger batch size allows faster training). The validation set was assigned with 20% of training data:", "Model training was successful with high validation accuracy of 94%:", "When the model is trained \u2014 there are two more things to do. Create a dictionary file, it will be used to encode user sentences to be processed by client-side predict function. Save model with the optimizer, to be able to convert it to TensorFlow.js friendly representation.", "Make sure when saving model, the training process was done once (you was not running training multiple times, before saving it \u2014 or shutdown Python notebook and do new training from scratch) \u2014 otherwise something gets overloaded with the model in the saved file and model could not be reused by TensorFlow.js.", "How ML model was converted to be compatible with TensorFlow.js", "Once the model is saved, convert it to TensorFlow.js format \u2014 as result two new files will be created (model bin file and JSON file with metadata):", "Read more here \u2014 Importing a Keras model into TensorFlow.js to get info on how to convert existing Keras model to TensorFlow.js and then load it into TensorFlow.js.", "JavaScript Web Worker to run TensorFlow.js predict function", "Why do we need to use Web Worker for TensorFlow.js predict function call? Predict function call is not asynchronous, this means it blocks main JavaScript thread and user screen will be frozen until prediction completes. Sentiment analysis prediction takes several seconds and UI freezing would annoy users. Web Worker allows delegating a long-running task to separate JavaScript thread, without blocking the main thread.", "JavaScript application is based on Oracle JET toolkit (collection of open source libraries \u2014 knockout.js, require.js, etc.). To run the sample app on your computer, execute these commands:", "There is a function in appController.js, which is being called each time when the user stops typing text \u2014 call to predict sentiment is invoked. This function creates Web Worker (if such doesn\u2019t exist) and sends user input to Web Worker (input is sent encoded and ready to be used for Tensor creation):", "The event listener is registered to handle return message (prediction) \u2014 it is pushed to UI through the knockout observable variable.", "Web Worker is implemented in worker.js file. This file runs in its own context and you should reference TensorFlow.js library here implicitly. Make sure to set CPU backend, TensorFlow.js in Web Worker works only with CPU backend:", "This is the main code (message listener in Web Worker) \u2014 where TensorFlow.js predict function is called (with user input converted to tensor) and the result is being returned back to the main thread through message:", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc280e966bcab&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://andrejusb.medium.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Andrej Baranovskij"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbbd1211c851b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&user=Andrej+Baranovskij&userId=bbd1211c851b&source=post_page-bbd1211c851b----c280e966bcab---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/jiashenliu/515k-hotel-reviews-data-in-europe", "anchor_text": "515K Hotel Reviews Data in Europe"}, {"url": "http://www.booking.com", "anchor_text": "Booking.com"}, {"url": "https://sentiment-tfjs-node.herokuapp.com/", "anchor_text": "https://sentiment-tfjs-node.herokuapp.com/"}, {"url": "https://sentiment-tfjs-node.herokuapp.com/", "anchor_text": ""}, {"url": "https://medium.com/@alyafey22/sentiment-classification-from-keras-to-the-browser-7eda0d87cdc6", "anchor_text": "Sentiment Classification from Keras to the Browser"}, {"url": "https://www.tensorflow.org/js/tutorials/conversion/import_keras", "anchor_text": "Importing a Keras model into TensorFlow.js"}, {"url": "https://www.oracle.com/webfolder/technetwork/jet/globalGetStarted.html", "anchor_text": "Oracle JET"}, {"url": "https://github.com/abaranovskis-redsamurai/automation-repo/tree/master/tfjs-sentiment", "anchor_text": "GitHub"}, {"url": "https://sentiment-tfjs-node.herokuapp.com/", "anchor_text": "https://sentiment-tfjs-node.herokuapp.com/"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c280e966bcab---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/javascript?source=post_page-----c280e966bcab---------------javascript-----------------", "anchor_text": "JavaScript"}, {"url": "https://medium.com/tag/python?source=post_page-----c280e966bcab---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/web-development?source=post_page-----c280e966bcab---------------web_development-----------------", "anchor_text": "Web Development"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----c280e966bcab---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&user=Andrej+Baranovskij&userId=bbd1211c851b&source=-----c280e966bcab---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&user=Andrej+Baranovskij&userId=bbd1211c851b&source=-----c280e966bcab---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc280e966bcab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c280e966bcab---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c280e966bcab--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c280e966bcab--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c280e966bcab--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c280e966bcab--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c280e966bcab--------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://andrejusb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrej Baranovskij"}, {"url": "https://andrejusb.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://github.com/katanaml", "anchor_text": "https://github.com/katanaml"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbbd1211c851b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&user=Andrej+Baranovskij&userId=bbd1211c851b&source=post_page-bbd1211c851b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd22cc5338107&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-js-using-javascript-web-worker-to-run-ml-predict-function-c280e966bcab&newsletterV3=bbd1211c851b&newsletterV3Id=d22cc5338107&user=Andrej+Baranovskij&userId=bbd1211c851b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}