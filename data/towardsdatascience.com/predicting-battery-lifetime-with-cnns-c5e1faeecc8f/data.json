{"url": "https://towardsdatascience.com/predicting-battery-lifetime-with-cnns-c5e1faeecc8f", "time": 1683000449.808061, "path": "towardsdatascience.com/predicting-battery-lifetime-with-cnns-c5e1faeecc8f/", "webpage": {"metadata": {"title": "Predicting Battery Lifetime with CNNs | by Hannes Knobloch | Towards Data Science", "h1": "Predicting Battery Lifetime with CNNs", "description": "This article was written by Hannes Knobloch, Adem Frenk, and Wendy Chang. You can find the source code of this project on GitHub: Lithium-ion batteries power almost every electronic device in our\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.nature.com/articles/s41560-019-0356-8", "anchor_text": "Data-driven prediction of battery cycle life before capacity degradation", "paragraph_index": 2}, {"url": "https://data.matr.io/1/", "anchor_text": "publicly available", "paragraph_index": 3}, {"url": "http://www.ion-age.org/example", "anchor_text": "www.ion-age.org/example", "paragraph_index": 3}, {"url": "https://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.signal.savgol_filter.html", "anchor_text": "savitzky golay filter", "paragraph_index": 14}, {"url": "https://www.tensorflow.org/guide/summaries_and_tensorboard", "anchor_text": "tensorboard", "paragraph_index": 19}, {"url": "https://www.tensorflow.org/beta/guide/data", "anchor_text": "dataset API", "paragraph_index": 19}, {"url": "https://www.tensorflow.org/tensorboard/r2/hyperparameter_tuning_with_hparams", "anchor_text": "hyperparameter tuning", "paragraph_index": 19}, {"url": "https://cloud.google.com/ml-engine/docs/tensorflow/getting-started-training-prediction", "anchor_text": "setup", "paragraph_index": 21}, {"url": "https://www.tensorflow.org/beta/guide/keras/functional", "anchor_text": "functional API", "paragraph_index": 23}, {"url": "https://www.tensorflow.org/tensorboard/r2/hyperparameter_tuning_with_hparams", "anchor_text": "hparams module", "paragraph_index": 30}, {"url": "https://www.tensorflow.org/beta/guide/checkpoints", "anchor_text": "checkpoints", "paragraph_index": 34}, {"url": "http://www.ion-age.org/example", "anchor_text": "www.ion-age.org/example", "paragraph_index": 36}, {"url": "https://datascienceretreat.com/", "anchor_text": "Data Science Retreat", "paragraph_index": 40}], "all_paragraphs": ["This article was written by Hannes Knobloch, Adem Frenk, and Wendy Chang.You can find the source code of this project on GitHub:", "Lithium-ion batteries power almost every electronic device in our lives, including phones and laptops. They\u2019re at the heart of renewable energy and e-mobility. For years companies have tried to predict how many charging cycles a battery will last before it dies. Better predictions would enable more accurate quality assessment and improve long-term planning.", "But that\u2019s difficult, because every battery ages differently, depending on its usage and conditions during manufacturing. A recent paper, called Data-driven prediction of battery cycle life before capacity degradation, by Kristen A. Severson et al., claims to have found the key to solve this problem by \u201ccombining comprehensive experimental data and artificial intelligence\u201d. Even though their results are ahead of traditional methods, the team focused more on their domain knowledge in electrical engineering than on the machine learning part.", "The good news: The researchers have made the dataset, the largest of its kind, publicly available! Although the dataset is limited to measurements from new batteries in a lab setting, it is still the most comprehensive of its kind. We used a more sophisticated machine learning approach to build a more versatile and accurate model for predicting battery lifetime (under these circumstances). Here you can see it in action: www.ion-age.org/example . To understand fully what the model does, read on!", "This article describes our research process from start to finish. Additionally, we describe our workflow and tools to give beginner data scientists inspiration for their own projects.", "The authors of the paper focused on brand-new batteries and predicted their lifetime. That\u2019s impressive, but if you want to diagnose a battery that\u2019s already been in use, you\u2019re out of luck. Instead we want to predict the remaining cycle life of any battery, used and new.", "Another caveat is the amount of data needed for a prediction. The researchers used data from the first and the hundredth charging cycle for the prediction. Our goal is to get accurate results with measurements from only 20 consecutive charging cycles, making the model much more applicable in the real world. On top of that, it would be useful to know the current age of a battery.", "This leads us to the following problem definition:", "Given measurements during a limited amount of charging cycles, how many cycles has a battery cell lived through and how many cycles will it last before it breaks?", "Let\u2019s walk through the steps to build a model and predict this!", "The authors of the original paper assembled 124 lithium-ion battery cells to measure data from. Each cell is charged and discharged according to one of many predetermined policies, until the battery reaches 80 percent of its original capacity (meaning the battery has become too unreliable for normal use and is considered \u201cbroken\u201d). The number of cycles (charging fully, then discharging fully) until this state is reached is called the battery cycle life, one of our targets. Within our dataset this number varies wildly from 150 to 2,300.", "The data for each cell is presented in a nested structure, with some features only measured once per cycle and others multiple times. Over a full cycle, we have more than a thousand measurements for capacity, temperature, voltage, and current, but only one scalar measurement for other metrics such as internal resistance of the cell or the total cycle time.", "Since a big chunk of the measurements is taken during the experimentally controlled charging policy (which varies from cell to cell), we crop the data to the discharging period (which is comparable across all cells). This brings us to the next step\u2026", "Raw measurement data can be extremely noisy. Distances between measurements are not always equal, data that\u2019s supposed to decrease monotonically increases unexpectedly and sometimes the hardware just shuts off and continues measuring at a random point in time. So we took special care that the data was clean and in the correct format before feeding it to a model.", "We remove cycles that had time gaps, small outliers, or other inconsistencies. One particular useful thing we found for smoothing out noise is the savitzky golay filter. This helped us recover some data samples that had measuring issues during the experiments.", "Another problem in the data was time. The different charging policies meant that some cycles were finished quicker than others and the time measurements of charge and temperature couldn\u2019t be compared as they were. Instead we resampled the data in a similar fashion as the original paper did:", "Done! All measurements now had the same length for every cell and cycle, but we still had some features with 1000 steps and others only as scalars. How do we avoid a shape mismatch when feeding array features and scalar features into our model at the same time? One solution is to feed the data into the model at different entry points and bring everything together later. This trick will become clearer when we talk about the model in detail. There wasjust one more thing we needed to do.", "To be able to detect a trend, we took multiple consecutive charging cycles as input. These groups of cycles we call windows. There should always be just one target for the whole window, but every cycle has a \u201ccurrent cycle\u201d and \u201cremaining cycles\u201d value. Which is why we defined the values from the last cycle to be the targets for the whole window.", "Let\u2019s finally move to the (more) fun part!", "Before we could dive into the data and create cool models, we needed to think about our setup. We wanted to use TensorFlow 2.0 from start to finish to profit from integrated functionality like tensorboard, the dataset API, and hyperparameter tuning.", "After choosing the framework, we decided what platform we should run our training jobs on. Instead of overheating our own laptops, we went with AI Platform from Google Cloud. AI Platform allowed us to run several training jobs at the same time, label them easily and monitor the process.", "This requires some setup. This can take quite some time to do it right the first time, so we won\u2019t go into all the details in this article. Here\u2019s a summary:", "Now we were able start a training job from the command line with the option to modify almost everything on the fly. We could adjust things like number of epochs, batch size, shuffling, checkpoint saving and even switch between model architectures easily, by adding a flag after the command. This allowed us to iterate fast, test different theories, and burn through a lot of (free) credits.", "We\u2019 built our model with tf.Keras using the functional API. We feed the array and scalar features into the model at separate entry points, so we can do different things to them before bringing them back together.", "The array features in each window we concatenate along their short side to make them a 3D matrix with shape (window size, length, number of features). We can then pass this matrix through three Conv2D layers with MaxPooling to extract relevant information from it while keeping the sequential nature of the window. The Conv2D acts on the \u201cnumber of features\u201d dimension as if these were the number of color channels in an image. This works because the array features all share the same voltage range and thus are highly correlated (just like RGB channels in an image). After the convolutions we flatten the data to a 1D array.", "We concatenate the scalar features in a similar fashion in the window direction to produce an array with shape (window size, number of features), before passing it through two Conv1D layers with one MaxPooling and flatten it in the end.", "We now have two flat arrays with feature mappings which we can easily put together and feed it into a fully connected dense network to produce our result.", "After we had built our model, it was time to train it. We wrote a script to call the GCP API in a simple command-line interface, so while you\u2019re in the project\u2019s main directory, starting a training job in the cloud becomes super easy:", "If, for example, we wanted to modify the number of training epochs and the number of samples per window, our script would allow us to do this with simple flags:", "During training we tracked three metrics across both train (orange) and validation (blue) set: The loss and mean absolute error (MAE) of current cycle, as well as remaining cycles. After a few minutes we can look at the results in TensorBoard. Let\u2019s see what the loss looks like:", "It\u2019s going in the right direction, but we were not happy with the gap between train and validation loss. To decrease that gap, dropout is a popular tool, so we added it to the model. We also needed to tune our hyperparameters, that\u2019s why we used gridsearch over different setups. To keep track of these setups, we used the hparams module which from TensorFlow 2.0 on you can find in tensorboard.plugins. Now we were able to compare different runs and pick the parameters that work best.", "Since the correct predictions for \u201ccurrent\u201d and \u201cremaining cycles\u201d should always be bigger than zero, we tried ReLU as an activation function for the output layer to reduce the search space for our model during the training process. Additionally our model heavily relies on CNNs, so we also tried different kernel sizes. Finally, we tested two different learning rates, and we measured the MAE of current cycles and remaining cycles of the setups.", "With the best model setup we obtained from hyperparameter tuning, and by setting the number of training epochs to 1000, we ended up with a model that\u2019s at 90 MAE for the current and 115 MAE for the remaining cycles:", "It\u2019s still not perfect, but we were pretty happy with the results for the application we had in mind (and we finally got some food to celebrate!).", "When we looked at the training curve for our best setup, we could see that the lowest loss wasn\u2019t at the end of training, but somewhere around three quarters through training. How do we use the model as it was at that point for our predictions? We had to implement checkpoints that allow us to restore a saved model at certain times during training.", "Once we have a model, we can serve it with TensorFlow Serving or a web-framework such as Flask. At the time Google Cloud Platform didn\u2019t support TF2 Serving, so we decided to build the app completely in Flask and host it on an AWS EC2 instance.", "You can see the results again here: www.ion-age.org/example", "After loading a random sample file, you can preview the data that we\u2019re going to predict on and you\u2019ll find our two linear and three scalar features. Hitting the predict button produces a graph that shows you our two targets: current and remaining cycles.", "That\u2019s it! That\u2019s all you need for an algorithm that can accurately predict the age and expected lifetime of any lithium-ion battery, given the proper measurement data.", "If you have any suggestions or questions or you found a bug, feel free to leave a comment. We are happy to answer questions!", "We created this project during Data Science Retreat, a three-month Data Science bootcamp in Berlin.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc5e1faeecc8f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@hk_83743?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hk_83743?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Hannes Knobloch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb44c6770cc4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&user=Hannes+Knobloch&userId=b44c6770cc4b&source=post_page-b44c6770cc4b----c5e1faeecc8f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://fancycrave.com/lithium-ion-batteries-for-sale-in-an-electronics-shop/", "anchor_text": "Fancycrave"}, {"url": "https://github.com/dsr-18/long-live-the-battery", "anchor_text": "dsr-18/long-live-the-batteryPredicting total battery cycle life time with TensorFlow 2. We're going to publish a blog post describing the project\u2026github.com"}, {"url": "https://www.nature.com/articles/s41560-019-0356-8", "anchor_text": "Data-driven prediction of battery cycle life before capacity degradation"}, {"url": "https://data.matr.io/1/", "anchor_text": "publicly available"}, {"url": "http://www.ion-age.org/example", "anchor_text": "www.ion-age.org/example"}, {"url": "https://docs.scipy.org/doc/scipy-0.16.1/reference/generated/scipy.signal.savgol_filter.html", "anchor_text": "savitzky golay filter"}, {"url": "https://www.tensorflow.org/guide/summaries_and_tensorboard", "anchor_text": "tensorboard"}, {"url": "https://www.tensorflow.org/beta/guide/data", "anchor_text": "dataset API"}, {"url": "https://www.tensorflow.org/tensorboard/r2/hyperparameter_tuning_with_hparams", "anchor_text": "hyperparameter tuning"}, {"url": "https://cloud.google.com/ml-engine/docs/tensorflow/getting-started-training-prediction", "anchor_text": "setup"}, {"url": "https://www.tensorflow.org/beta/guide/keras/functional", "anchor_text": "functional API"}, {"url": "https://www.tensorflow.org/tensorboard/r2/hyperparameter_tuning_with_hparams", "anchor_text": "hparams module"}, {"url": "https://www.tensorflow.org/beta/guide/checkpoints", "anchor_text": "checkpoints"}, {"url": "http://www.ion-age.org/example", "anchor_text": "www.ion-age.org/example"}, {"url": "http://www.ion-age.org", "anchor_text": "www.ion-age.org"}, {"url": "https://datascienceretreat.com/", "anchor_text": "Data Science Retreat"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----c5e1faeecc8f---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----c5e1faeecc8f---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/battery-life?source=post_page-----c5e1faeecc8f---------------battery_life-----------------", "anchor_text": "Battery Life"}, {"url": "https://medium.com/tag/renewable-energy?source=post_page-----c5e1faeecc8f---------------renewable_energy-----------------", "anchor_text": "Renewable Energy"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----c5e1faeecc8f---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&user=Hannes+Knobloch&userId=b44c6770cc4b&source=-----c5e1faeecc8f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&user=Hannes+Knobloch&userId=b44c6770cc4b&source=-----c5e1faeecc8f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc5e1faeecc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c5e1faeecc8f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c5e1faeecc8f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hk_83743?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@hk_83743?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Hannes Knobloch"}, {"url": "https://medium.com/@hk_83743/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "38 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb44c6770cc4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&user=Hannes+Knobloch&userId=b44c6770cc4b&source=post_page-b44c6770cc4b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa08524605d17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-battery-lifetime-with-cnns-c5e1faeecc8f&newsletterV3=b44c6770cc4b&newsletterV3Id=a08524605d17&user=Hannes+Knobloch&userId=b44c6770cc4b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}