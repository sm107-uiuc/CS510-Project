{"url": "https://towardsdatascience.com/customer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa", "time": 1683012834.767126, "path": "towardsdatascience.com/customer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa/", "webpage": {"metadata": {"title": "Customer Behavior Modeling: The Problem with Aggregate Statistics | by Adam Brownell | Towards Data Science", "h1": "Customer Behavior Modeling: The Problem with Aggregate Statistics", "description": "As a Data Scientist, I spend quite a bit of time thinking about Customer Lifetime Value (CLV) and how to model it. A strong CLV model is really a strong customer behavior model \u2014 the better you can\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.jstor.org/stable/2631608?seq=1", "anchor_text": "[Link]", "paragraph_index": 30}, {"url": "https://towardsdatascience.com/customer-behavior-modeling-buy-til-you-die-models-6f9580e38cf4", "anchor_text": "my article on BTYD Models", "paragraph_index": 32}], "all_paragraphs": ["As a Data Scientist, I spend quite a bit of time thinking about Customer Lifetime Value (CLV) and how to model it. A strong CLV model is really a strong customer behavior model \u2014 the better you can predict next actions, the better you can quantify CLV.", "In this post, I hope to demonstrate, through both a toy and real-world example, why using aggregate statistics to judge the strength of a customer behavior model is a bad idea.", "Instead, the best CLV Model is the one that has the strongest predictions on the individual level. Data Scientists exploring Customer Lifetime Value should primarily, and perhaps only, use individual level metrics to fully understand the strengths and weaknesses of a CLV model.", "While this is intended for Data Scientists, I wanted to address the business ramifications of this article, since understanding the business need will inform both why I hold certain opinions and why it is important for all of us to grasp the added benefit of a good CLV model.", "CLV: How much a customer will spend in the future", "CLV is a business KPI that has exploded in popularity over the past few years. The reason is obvious: if your company can accurately predict how much a customer will spend over the next couple months or years, you can tailor their experience to fit that budget. This has dramatic applications from marketing to customer service to overall business strategy.", "Here a quick list of business applications that accurate CLV can help empower:", "There\u2019s plenty more, these are just the ones that come to my mind the fastest.", "With so much business planning at stake, tech-savvy companies are busy scrambling to find which model can best capture CLV of their customer base. The most popular and commonly used customer lifetime value models benchmark their strength on aggregate metrics, using statistics like aggregate revenue percent error (ARPE). I know this because first hand many of my clients have compared their internal CLV models to mine using aggregate statistics.", "I would argue that is a serious mistake.", "The following 2 examples, one toy and one real, will hopefully demonstrate how aggregate statistics can both lead us astray and hide model shortcomings that are glaringly apparent at the individual level. This is especially prescient because most business use cases require a strong CLV model at the individual level, not just at the aggregate.", "When you rely on aggregate metrics and ignore the individual-level inaccuracies, you are missing a large part of the technical narrative. Consider the following example of 4 customers and their 1 year CLV:", "This example includes high, low, and medium CLV customers, as well as a churned customer, creating a nice distribution for a smart model to capture.", "Now, consider the following validation metrics:", "3. ARPE: Aggregate revenue percent error (The overall difference between total revenue and predicted revenue)", "MAE and is on the customer level, while ARPE and is an aggregate statistic. The lower the value for these validation metrics, the better.", "This example will demonstrate how an aggregate statistic can bury the shortcomings of low-quality models.", "To do so, compare a dummy guessing the mean to a CLV model off by 20% across the board.", "The dummy model will only guess $40 for every customer.", "This model tries to make an accurate model prediction at the customer level.", "We can use these numbers to calculate the three validation metrics.", "This example illustrates that a model that is considerably worse in the aggregate (the CLV model is worse by over 20%) is actually better at the individual level.", "To make this example even better, let\u2019s add some noise to the predictions.", "The results above indicate that even if an individual stat is a higher percentage than you would hope, the distribution of those CLV numbers is more in line with what we are looking for: a model that distinguishes high CLV customers from low CLV customers. If you only look at the aggregate metrics for a CLV model, you are missing a major part of the story, and you may end up choosing the wrong model for your business.", "But even rolling up an error metric calculated at the individual level, such as MAE or alternatives like MAPE, can hide critical information about the strengths and weaknesses of your model. Mainly, its capacity to create an accurate distribution of CLV scores.", "To explore this further, let\u2019s move to a more realistic example", "Congratulations! You, the Reader, have been hired as a Data Scientist by BottleRocket Brewing Co, an eCommerce company I just made up. (The data we will use is based on a real eCommerce company that I scrubbed for this post)", "Your first task as a Data Scientist: Choose the best CLV model for BottleRocket\u2019s business\u2026", "Undeterred, you run an experiment with the following models:", "The Pareto/NBD model is a very popular choice, and is the model under the hood of most data-driven CLV predictions today. To quote the documentation:", "The Pareto/NBD model, introduced in 1987, combines the [Negative Binomial Distribution] for transactions of active customers with a heterogeneous dropout process, and to this date can still be considered a gold standard for buy-till-you-die models [Link]", "But another way, the model learns two distributions, one for churn probability and the other for inter transaction-time (ITT) and makes CLV predictions by sampling from these distributions.", "** Describing BTYD models in more technical detail is a bit out of scope of this article, which is focused on error metrics. Please drop a comment if you are interested in a more in-depth write-up about BTYD models and I\u2019m happy to write a follow-on article! Update: Check out my article on BTYD Models **", "Gradient Boosted Machines models are a popular machine learning model in which weak trees are trained and assembled together to make a strong overall classifier.", "** As with BTYD models, I won\u2019t go into detail about how GBMs work but once again comment below if you\u2019d like me to write up something on method/models", "This model is defined as simply:", "4. Very Dumb Dummy Model (Avg Dummy)", "This model only guesses the average spend over 1yr for all customers. Included as a baseline for model performance", "We can consolidate all of these models\u2019 predictions into a nice little Pandas DataFrame `combined_result_pdf` that looks like:", "Given this customer table, we can calculate error metrics using the following code:", "With these four models, we tried to predict 1yr CLV for BottleRocket customers, ranked by MAE score:", "Here are some interesting insights from this table:", "Point #3 especially has some interesting ramifications if the Data Scientist/Client accepts it. If the interpreter of these results actually believes that a simple if/else model can capture nearly all the complexity a GBM could capture, and better than the commonly used PNBD model, then obviously the \u201cbest\u201d model would be the Dummy CLV once cost, speed of training, and interpretability are all factored in.", "This brings us back to the original claim \u2014 that aggregate error metrics, even ones calculated on the individual level, hide some shortcomings of models. To demonstrate this, let\u2019s rework our DataFrame into Confusion Matrices.", "Mini Chapter: What is a Confusion Matrix?", "From its name alone, understanding a confusion matrix sounds confusing & challenging. But it is crucial to understand the points being made in this post, as well as a powerful tool to add to your Data Science toolkit.", "A Confusion Matrix is a table that outlines the accuracy of classification, and what misclassifications are common by the model. A simple confusion matrix may look like this:", "The diagonal on the above confusion matrix, highlighted Green, reflects correct predictions \u2014 predicting Cat when the it was actually a Cat etc. The rows will add up to 100%, allowing us to get a nice snapshot of how well our model captures Recall behavior, or the probability our model guesses correctly given a specific label.", "What we can also tell from the above confusion matrix is..", "With this in mind, let\u2019s explore how well our CLV models capture customer behavior using Confusion Matrices. A strong model would be able to correctly classify low value customers and high value customers as such. I prefer this method of visualization as opposed to something like a histogram of CLV scores because it reveals what elements of modelling the distribution are the strong and weak.", "To achieve this, we will convert our monetary value predictions into quantiled CLV predictions of Low Medium High and Best. These will be drawn from the quantiles generated by each model\u2019s predictions.", "The best model will correctly categorize customers into these 4 buckets of low/medium/high/best. Therefore each model we will make a confusion matrix of the following structure:", "And the best model will have the most amount of predictions that fall within this diagonal.", "These confusion matrices can be generated from our Pandas DF with the following code snippet:", "The coloring of the chart is how concentrated a certain prediction/actual classification is \u2014 the darker green, the more examples that fall within that square.", "As with the example confusion matrix discussed above, the diagonal (highlighted with black lines) indicates appropriate classification of customers.", "Dummy1, which is only predicting the average every time, has a distribution of ONLY the mean. It makes no distinction between high or low value customers.", "Only slightly better, Dummy2 predicts either $0 or the average. This means it can make some claim about distribution, and in fact, capture 81% and 98% of the lowest and highest value customers respectively.", "But the major issue with these models, which was not apparent when looking at MAE (but obvious if you know how their labels were generated), is that these models have very little sophistication when it comes to distinguishing between customer segments. For all of our business applications listed in Ch.1, which is the entire point of building a strong CLV model, distinguishing between customer types is essential to success", "First, don\u2019t let the overall accuracy scare you. In the same way that we can hide the truth through aggregate statistics, we can hide the strength of distribution modelling through a rolled-out accuracy metric.", "Second, it is pretty clear from this visual, as opposed to the previous table, that there is a reason the dummy models are named as such \u2014 these second row models are actually capturing a distribution. Even with Dummy2 capturing a much higher percentage of low value customers \u2014 this can just be an artifact of having a long-tail CLV distribution. Clearly, these are the models you want to be choosing between.", "Looking at the diagonal, we can see that GBM has major improvements in predicting most categories across the board. Major mislabellings \u2014 missing by two squares \u2014 is down considerably. The biggest increase on the GBM side is on recognizing medium level customers, which is a nice sign that the distribution is healthy and our predictions are realistic.", "If you just skimmed this article, you may want to conclude that GBM is a better CLV model. And that may be true, but model selection is more complicated. Some questions you would want to ask:", "Are of these questions, while not related to the thesis of this article, would need to be answered before you swap out your model for a GBM.", "First underlying variable to consider when choosing the model is the company\u2019s data you are working with. Often BTYD models work well, and are comparable to ML alternatives. But BTYD models make some strong assumptions about customer behavior, so if these assumptions are broken, they perform sub-optimally. Running a model comparison is crucial to making the right model decision.", "While the issues at the individual level are apparent for the dummy models, often companies will fall prey to these issues by running a \u201cnaive\u201d/\u201dsimple\u201d/\u201dexcel-based\u201d model to do this exact thing \u2014 attempt to apply an aggregate number across your entire customer base. At some companies, CLV can be as simply defined by dividing revenue equally among all customers. This may work for a board report or two, but in reality, this is not an adequate way to calculate such a complex number. Truth is, not all customers are created equal, and the sooner your company shifts their attention away from aggregate customer metrics to strong individual-level predictions, the more effectively you can market, strategize and ultimately find your best customers.", "Hope this was as enjoyable and informative to read about as it was to write about.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbe369d95bcaa&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://adam1brownell.medium.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": ""}, {"url": "https://adam1brownell.medium.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Adam Brownell"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2479b1fc8999&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&user=Adam+Brownell&userId=2479b1fc8999&source=post_page-2479b1fc8999----be369d95bcaa---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@rupixen?utm_source=medium&utm_medium=referral", "anchor_text": "rupixen.com"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@campaign_creators?utm_source=medium&utm_medium=referral", "anchor_text": "Campaign Creators"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@wildlittlethingsphoto?utm_source=medium&utm_medium=referral", "anchor_text": "Helena Lopes"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.jstor.org/stable/2631608?seq=1", "anchor_text": "[Link]"}, {"url": "https://towardsdatascience.com/customer-behavior-modeling-buy-til-you-die-models-6f9580e38cf4", "anchor_text": "my article on BTYD Models"}, {"url": "https://unsplash.com/@nate_dumlao?utm_source=medium&utm_medium=referral", "anchor_text": "Nathan Dumlao"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@brett_jordan?utm_source=medium&utm_medium=referral", "anchor_text": "Brett Jordan"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/customer-lifetime-value?source=post_page-----be369d95bcaa---------------customer_lifetime_value-----------------", "anchor_text": "Customer Lifetime Value"}, {"url": "https://medium.com/tag/data-science?source=post_page-----be369d95bcaa---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/statistics?source=post_page-----be369d95bcaa---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/marketing?source=post_page-----be369d95bcaa---------------marketing-----------------", "anchor_text": "Marketing"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----be369d95bcaa---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&user=Adam+Brownell&userId=2479b1fc8999&source=-----be369d95bcaa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&user=Adam+Brownell&userId=2479b1fc8999&source=-----be369d95bcaa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbe369d95bcaa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----be369d95bcaa---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----be369d95bcaa--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----be369d95bcaa--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----be369d95bcaa--------------------------------", "anchor_text": ""}, {"url": "https://adam1brownell.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://adam1brownell.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Adam Brownell"}, {"url": "https://adam1brownell.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "320 Followers"}, {"url": "http://www.thewizard.ai", "anchor_text": "www.thewizard.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2479b1fc8999&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&user=Adam+Brownell&userId=2479b1fc8999&source=post_page-2479b1fc8999--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff1faa9503b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustomer-behavior-modeling-the-problem-with-aggregate-statistics-be369d95bcaa&newsletterV3=2479b1fc8999&newsletterV3Id=f1faa9503b08&user=Adam+Brownell&userId=2479b1fc8999&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}