{"url": "https://towardsdatascience.com/airflow-and-superquery-9acc87c0398d", "time": 1682995377.381214, "path": "towardsdatascience.com/airflow-and-superquery-9acc87c0398d/", "webpage": {"metadata": {"title": "Airflow and superQuery. Monitoring your BigQuery costs in\u2026 | by Eben du Toit | Towards Data Science", "h1": "Airflow and superQuery", "description": "\u201cWhat is the cost?\u201d A question asked so frequently in the tech world that every person at a small start-up shudders slightly when it is asked. The answer of which invariably is: \u201cWe\u2019re not sure\u201d. One\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/apache/airflow", "anchor_text": "Apache Airflow", "paragraph_index": 1}, {"url": "https://cloud.google.com/bigquery/", "anchor_text": "Google BigQuery", "paragraph_index": 3}, {"url": "http://superquery.io", "anchor_text": "superQuery", "paragraph_index": 5}], "all_paragraphs": ["\u201cWhat is the cost?\u201d A question asked so frequently in the tech world that every person at a small start-up shudders slightly when it is asked. The answer of which invariably is: \u201cWe\u2019re not sure\u201d.", "One of the best tools for scheduling workflows in the data engineering world is Apache Airflow. This tool has taken many a business out of the inflexible cron scheduling doldrums into riding the big data waves on the high seas of Directed Acyclic Graphs (DAGs).", "Of course this means that large globs of data are being moved into and out of databases and with this glorious movement often comes unavoidable costs.", "One such database, a supercomputer if you will, is called Google BigQuery. It is the flagship of the Google Cloud offering and allows data processing at the Petabyte scale. It is very good at making you worry less about the power of the database infrastructure and more about the quality of your analysis and data flow problems in need of solving.", "One key factor to consider with BigQuery is how open any individual or organisation is to driving up costs spent on scanning data on this platform. Even the most savvy of data engineers will tell you in angst about their errors in scanning across data they didn\u2019t really want to and pushing their business\u2019 monthly analysis bill over the budget.", "In steps superQuery. The philosophy offered by superQuery is that you don\u2019t have to worry about your costs because you have all the information you need and some safeguards that give you the opportunity to make an informed decision.", "While your Airflow DAGs are churning away happily and pushing data to your processing systems of choice, a heap of logging happens in the background. Airflows logs are easily accessible, simple to read and give you a good overview of what your DAG is doing. Wouldn\u2019t it be great if the log files could also show you information on your query execution plan and specifically what the cost and total data scanned was? For sure it would! Something like so:", "This chunk of log tells you that your BigQuery operator in Airflow scanned across 24Gb of data and it cost you $0.12. Simple. You can also go ahead and parse the log files in a 3rd party tool or a bash script and create a summary of the costs originating from DAGs that scan data from BigQuery.", "SuperQuery uses a MySql proxy in order to make connectivity universal and offer a SQL interface to get information.", "There are the steps involved in order to get the same functionality described above:", "This is the interface for the SuperQuery operator:", "Here is the code for the operator which you should copy into the plugins folder in Airflow:", "Here is some code to test your connection to SuperQuery with:", "This post describes how you can get a view of your Airflow costs when you connect and implement Airflow tasks to and from BigQuery. The use of the SuperQuery proxy can be extended to include a wide variety of detailed execution plan information and draw on the benefits the system provides.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Storyteller. Child of the Internet. PhD. Data Science Principal at DoiT International. Ghibli fan. Asking good questions near you."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9acc87c0398d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@eebsidian?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eebsidian?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Eben du Toit"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc07350664fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&user=Eben+du+Toit&userId=c07350664fb&source=post_page-c07350664fb----9acc87c0398d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/W04aGUFOxf0?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Soheb Zaidi"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/apache/airflow", "anchor_text": "Apache Airflow"}, {"url": "https://cloud.google.com/bigquery/", "anchor_text": "Google BigQuery"}, {"url": "http://superquery.io", "anchor_text": "superQuery"}, {"url": "https://medium.com/tag/big-data?source=post_page-----9acc87c0398d---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----9acc87c0398d---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data-science?source=post_page-----9acc87c0398d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/apache-airflow?source=post_page-----9acc87c0398d---------------apache_airflow-----------------", "anchor_text": "Apache Airflow"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----9acc87c0398d---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&user=Eben+du+Toit&userId=c07350664fb&source=-----9acc87c0398d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&user=Eben+du+Toit&userId=c07350664fb&source=-----9acc87c0398d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9acc87c0398d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9acc87c0398d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9acc87c0398d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9acc87c0398d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9acc87c0398d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eebsidian?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eebsidian?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Eben du Toit"}, {"url": "https://medium.com/@eebsidian/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "78 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc07350664fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&user=Eben+du+Toit&userId=c07350664fb&source=post_page-c07350664fb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F948fb5d2cc52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-and-superquery-9acc87c0398d&newsletterV3=c07350664fb&newsletterV3Id=948fb5d2cc52&user=Eben+du+Toit&userId=c07350664fb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}