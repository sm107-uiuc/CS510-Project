{"url": "https://towardsdatascience.com/solving-dependency-management-in-python-with-poetry-165b92069e9d", "time": 1683003958.743417, "path": "towardsdatascience.com/solving-dependency-management-in-python-with-poetry-165b92069e9d/", "webpage": {"metadata": {"title": "Solving dependency management in Python with Poetry | by Christopher Sidebottom | Towards Data Science", "h1": "Solving dependency management in Python with Poetry", "description": "My team has recently opted to add another piece of tooling to our tech stack, Poetry. As with every technical decision, this one was made carefully so as to avoid unnecessary complexity. So why did\u2026"}, "outgoing_paragraph_urls": [{"url": "https://python-poetry.org/", "anchor_text": "Poetry", "paragraph_index": 0}, {"url": "https://medium.com/bbc-design-engineering/server-timing-in-the-wild-bfb34816322e", "anchor_text": "a world of building websites", "paragraph_index": 1}, {"url": "https://www.npmjs.com/", "anchor_text": "npm", "paragraph_index": 1}, {"url": "https://medium.com/sainsburys-data-analytics/the-case-for-switching-from-conda-to-virtual-environments-in-python-de3211d8f6f", "anchor_text": "one of my colleagues wrote a great post about why we use virtual environments in Data Science", "paragraph_index": 17}, {"url": "https://www.python.org/dev/peps/pep-0508/", "anchor_text": "PEP-508", "paragraph_index": 20}, {"url": "https://www.python.org/dev/peps/pep-0517/", "anchor_text": "PEP-517", "paragraph_index": 20}, {"url": "https://www.python.org/dev/peps/pep-0518/", "anchor_text": "PEP-518", "paragraph_index": 20}, {"url": "https://hackingandslacking.com/package-python-projects-the-proper-way-with-poetry-ca1e94a1727b", "anchor_text": "Package Python Projects the Proper Way by Todd Birchard", "paragraph_index": 21}, {"url": "https://towardsdatascience.com/how-to-setup-an-awesome-python-environment-for-data-science-or-anything-else-35d358cc95d5", "anchor_text": "How to Setup an Awesome Python Environment for Data Science or Anything Else by Simon Hawe", "paragraph_index": 21}], "all_paragraphs": ["My team has recently opted to add another piece of tooling to our tech stack, Poetry. As with every technical decision, this one was made carefully so as to avoid unnecessary complexity. So why did we decide to use Poetry?", "Coming from a world of building websites, I was used to npm. With npm, the JavaScript world sees dependency management as a solved problem. In our Python projects, we were just using pip and there are two fundamental workflows we could follow:", "In this approach, you create a requirements file which looks like:", "This has the advantage of being simpler to understand, because you\u2019re only directly using pandas. You then use pip to install these dependencies and their dependencies:", "Which means you can create a separate file for any development dependencies:", "This allows you to split out your production requirements from your development requirements. Installing only your production requirements helps reduce the size of the production build. Reducing the number of packages in production also improves security by reducing the attack surface.", "Unfortunately, you have to maintain this file, and you have little control over the dependencies. Each time you run pip install your dependencies dependencies are at risk of being installed with a different version.", "A different approach is to use more of pip\u2019s functionality to freeze your dependencies. Running pip install and then pip freeze will give you a list of all packages installed. For instance, running pip install pandas will result in a pip freeze output of:", "This is great as it lets you keep your dependencies locked to specific versions, creating a repeatable environment. Unfortunately, if you install anything in the environment pip is running in, it\u2019ll be added to this list. As an example, you decide to install numba to see if it speeds up your processing. This results in the following frozen dependencies:", "But unfortunately, numba didn\u2019t have the performance improvement you wanted. When you then run pip uninstall numba, it does remove numba, but not necessarily all dependencies installed by numba:", "Notice how you now have that extra llvmlite package which you may never get rid of?", "It\u2019s worth noting that there are tools to work around this and remove all dependencies. But there\u2019s one more caveat to consider; if you install development dependencies, they will also contribute to this issue.", "Poetry is capable of doing both of the above, with a simple interface. When you call poetry add it adds the package to a pyproject.toml file to keep track of the top level dependencies (including Python itself):", "This is paired with a poetry.lock file which includes all of the installed packages, locked to a specific version. Embedding the lock-file in this article would take up a lot of space, because it includes hashes by default to ensure package integrity. Here\u2019s a snippet instead:", "To repeat our experiment with numba, we use poetry add numba and poetry remove numba. These commands also remove llvmlite from the environment and dependency locking file. By removing the dependencies and cleaning up, Poetry enables us to try more packages with an easy way to clean our virtual environment.", "Finally, Poetry splits out production dependencies and development dependencies. If we want to write some tests, we can use poetry add -D pytest , which results in:", "When creating a production bundle you can then use poetry install --no-dev to ignore anything used for development.", "Last year one of my colleagues wrote a great post about why we use virtual environments in Data Science. Poetry has something to add here as well, automatic management of them for your projects. So instead of having to run:", "Poetry creates a virtual environment for your project, which matches your specified Python version. This is kept outside your project root by default so as not to create clutter. My team did opt to put the virtual environment back in the project directory for other reasons though, which was as easy as:", "Which creates the virtual environment in fairly standard .venv folder. This has the slight annoyance it creates another poetry.toml, file rather than using the main pyproject.toml .", "There are other tools that have existed before Poetry that can meet these requirements. Poetry also leverages a lot of Python\u2019s own enhancement proposals such as PEP-508, PEP-517 and PEP-518. These PEP\u2019s work towards using the pyproject.toml as the primary place to configure a project. When considering the longevity of Poetry, following the PEPs gives us confidence in the future support for the features we\u2019re using.", "Hopefully this explains why I was confident in my team choosing to use Poetry instead of the alternatives that came before it. If you\u2019re looking for a more detailed introduction to the history and more specific poetry commands I\u2019d suggest Package Python Projects the Proper Way by Todd Birchard. And for other tools to combine with Poetry, take a look at How to Setup an Awesome Python Environment for Data Science or Anything Else by Simon Hawe.", "It\u2019s been a really simple transition with Engineers and Data Scientists collaborating on translating projects. Building new projects has also become much simpler, enabling us to experiment with different packages and get a specific deterministic build when we go to production.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Currently building ML things at Arm, but content is all my own. Interested in coffee and building things that make coffee."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F165b92069e9d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----165b92069e9d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mousius?source=post_page-----165b92069e9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mousius?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Christopher Sidebottom"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3158d616f1ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&user=Christopher+Sidebottom&userId=3158d616f1ba&source=post_page-3158d616f1ba----165b92069e9d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/data-science-in-the-real-world/home", "anchor_text": "Data Science in the Real World"}, {"url": "https://python-poetry.org/", "anchor_text": "Poetry"}, {"url": "https://medium.com/bbc-design-engineering/server-timing-in-the-wild-bfb34816322e", "anchor_text": "a world of building websites"}, {"url": "https://www.npmjs.com/", "anchor_text": "npm"}, {"url": "https://medium.com/sainsburys-data-analytics/the-case-for-switching-from-conda-to-virtual-environments-in-python-de3211d8f6f", "anchor_text": "one of my colleagues wrote a great post about why we use virtual environments in Data Science"}, {"url": "https://www.python.org/dev/peps/pep-0508/", "anchor_text": "PEP-508"}, {"url": "https://www.python.org/dev/peps/pep-0517/", "anchor_text": "PEP-517"}, {"url": "https://www.python.org/dev/peps/pep-0518/", "anchor_text": "PEP-518"}, {"url": "https://hackingandslacking.com/package-python-projects-the-proper-way-with-poetry-ca1e94a1727b", "anchor_text": "Package Python Projects the Proper Way by Todd Birchard"}, {"url": "https://towardsdatascience.com/how-to-setup-an-awesome-python-environment-for-data-science-or-anything-else-35d358cc95d5", "anchor_text": "How to Setup an Awesome Python Environment for Data Science or Anything Else by Simon Hawe"}, {"url": "https://medium.com/tag/ds-in-the-real-world?source=post_page-----165b92069e9d---------------ds_in_the_real_world-----------------", "anchor_text": "Ds In The Real World"}, {"url": "https://medium.com/tag/python?source=post_page-----165b92069e9d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----165b92069e9d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----165b92069e9d---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software?source=post_page-----165b92069e9d---------------software-----------------", "anchor_text": "Software"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&user=Christopher+Sidebottom&userId=3158d616f1ba&source=-----165b92069e9d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&user=Christopher+Sidebottom&userId=3158d616f1ba&source=-----165b92069e9d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F165b92069e9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----165b92069e9d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----165b92069e9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----165b92069e9d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----165b92069e9d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----165b92069e9d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----165b92069e9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mousius?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mousius?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Christopher Sidebottom"}, {"url": "https://medium.com/@mousius/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "64 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3158d616f1ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&user=Christopher+Sidebottom&userId=3158d616f1ba&source=post_page-3158d616f1ba--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F3158d616f1ba%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsolving-dependency-management-in-python-with-poetry-165b92069e9d&user=Christopher+Sidebottom&userId=3158d616f1ba&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}