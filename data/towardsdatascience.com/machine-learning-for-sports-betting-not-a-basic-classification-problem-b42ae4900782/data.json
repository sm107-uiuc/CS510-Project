{"url": "https://towardsdatascience.com/machine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782", "time": 1682994806.849422, "path": "towardsdatascience.com/machine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782/", "webpage": {"metadata": {"title": "Machine Learning for Sports Betting: It\u2019s Not a Basic Classification Problem. | by Charles Malafosse | Towards Data Science", "h1": "Machine Learning for Sports Betting: It\u2019s Not a Basic Classification Problem.", "description": "We present a way to include bets p&l into a neural network classifier using a custom loss function. We believe this is useful for anyone looking to use machine learning in betting."}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@timanglade/how-hbos-silicon-valley-built-not-hotdog-with-mobile-tensorflow-keras-react-native-ef03260747f3", "anchor_text": "Hotdog, not Hotdog", "paragraph_index": 8}, {"url": "https://betsentiment.com/aboutus", "anchor_text": "Sentiment Analysis", "paragraph_index": 8}, {"url": "https://github.com/charlesmalafosse/sports-betting-customloss", "anchor_text": "github page", "paragraph_index": 19}, {"url": "https://lucyinthecloud.com/", "anchor_text": "https://lucyinthecloud.com/", "paragraph_index": 29}], "all_paragraphs": ["Sports betting is one of these perfect problems for machine learning algorithms and specifically classification neural networks. Tons of data available and a clear objective of picking the winner! Nonetheless, classic classification models are not well suited for betting strategies, and one needs to use a custom loss function in his neural network to achieve better profitability. We explain why below.", "Let\u2019s implement basic betting strategies based on odds from betting exchanges. Decimal odds are the ratio of the full payout to the stake. For instance, odds of 2, means that for a 1$ bet you could win 2$ (including your stake). Note that odds inverse gives the implied probability of being right. Odds of 2 means a 50% chance of winning (1/odds). Hence you want to bet on teams with the lowest odds, i.e., the highest probability of winning.", "For the sake of illustration, we design two basics strategies:", "Assume that we have odds 5.5\u20131.61 for the game Bournemouth vs. Chelsea. Chelsea has odds of 1.61. Hence we bet on Chelsea\u2019s victory for the \u201cWin\u201d strategy, and a victory and draw for the \u201cWin or Draw\u201d strategy.", "Now let\u2019s compare the two betting strategies, \u201cWin\u201d vs. \u201cWin or Draw.\u201dFor the data, we used the Betfair API. Betfair is one of the biggest betting exchange, and its API contains exchange markets navigation, odds retrieval, and bet placement operations.", "The bar charts above represent the accuracy and profit achieved by both betting systems. Accuracy means the number of times our bets were correct, divided by the total number of bets (200 in that case). Profit represents the amount you could have earned by investing 1\u00a3 in each bet.The first chart on the left shows an accuracy ratio of 61% for the \u201cWin\u201d strategy vs. 80% for the \u201cWin or Draw.\u201d In that case, the \u201cWin or Draw\u201d seems a lot better. However, the second chart shows that the profit it generates is far less than the \u201cWin\u201d strategies. 1\u00a3 vs. 12.", "Therefore we shouldn\u2019t aim at better accuracy in predicting games outcomes, but instead, we should focus on maximizing our overall profit.", "Much data is involved when deciding on which team to put our money. For this reason, betting is an ideal subject to apply one of the most popular machine learning techniques, Neural Networks.", "In particular, we could use a classification neural network. A classification NN is ideal when applied to problems for which there is a discrete outcome, or said otherwise when identifying for which category belongs a particular observation. As examples, think of the funny \u201cHotdog, not Hotdog\u201d or Sentiment Analysis that attempts to classify text into positive or negative sentiment.", "Applied to sports betting, we could devise a neural network with three simple categories. Below is the architecture of such a network.", "However, from our previous example with two simple betting strategies, it is clear that we are not trying to predict the outcome of the game, but rather what bet would be the most profitable. Applied to a classification neural network, this would result in the following architecture. Note that in this case we even allow a \u201cno bet\u201d category.", "We end up with a multi-label classification problem (not to be confused with multi-class classification) as the outcome of a game could result in one or two predictions being correct. For instance, a win by the home team would result in two winnings bets: \u201cWin Home\u201d and \u201cWin Home or Draw\u201d.", "Not all bets provide the same reward. A bet with odds of 2 can generate 1\u00a3 of profit, while odds of 1.1 generates a lower profit of 0.1\u00a3. Both bets, however, exposed to the same loss of 1\u00a3 if not successful. Therefore they are not equal; risking 1\u00a3 to make 1\u00a3 is not the same as risking 1\u00a3 to make 0.1\u00a3.", "To take this into account in our neural network, we need to use a custom loss function. A loss function (or objective function) is a measure of \u201chow good\u201d a neural network does, given its training sample and the expected output. In standard classification neural network, we use loss functions such as the categorical cross-entropy. However, this kind of functions would give similar weights to all bets, ignoring the profitability discrepancies.", "In our case we want the model to maximize the overall gain of the strategy. Thus the input of our custom loss function must incorporate the potential profit of each bet.", "We set up our custom loss function with Keras on top of TensorFlow.", "In Keras, a loss function takes two arguments:", "Because we cannot pass the game\u2019s odds in the loss function due to Keras limitations, we have to pass them as additional items of the y_true vector.", "Below is our custom loss function written in Python and Keras.In a nutshell, it measures the profit/loss average over the input for a unit stake. Steps are the following for each observation (each game) :", "For our data we take a list of 200 games from the English Premier League, season 2018\u20132019, August to December 2018. It contains descriptive game data such as team names, odds from Betfair, and a sentiment score (representing the percentage of positive tweets over the positive and negative tweets). Data and Jupyter notebook available on my github page.", "Our data contain the outcome of each game in the form of 1, 2 ot 3:", "This needs to be converted to a one-hot encoding vector representing the output layer of our neural network. Plus we add the odds of each team as elements of this vector. This is exactly what we do below.", "Before training the model, we need first to define it. We use a fully connected neural network, with two hidden layers. We use BatchNormalization to normalize weights and eliminate the vanishing gradient problem.", "Then we train the model using a set of arbitrary parameters.", "Once the training has completed, we look at the performance of our model with the following print command:", "As we can see, we end up with a training loss of -0.05. Keep in mind that we\u2019re trying to minimize our loss function, which is the opposite of our P&L. This number tells us that, on average, each bet would generate a profit of 0.05 for each stake of 1\u00a3. Our validation dataset, shows an average profit of 0.08 for each pound. Not bad considering we just provided basic data to our neural network. Over 200 games, our theoretical NN betting strategy would have generated 10 to 16.6\u00a3, assuming we bet 1\u00a3 on each game.", "We presented a way to include bets p&l into a neural network classifier using a custom loss function. It goes beyond the accuracy ratio that can be misleading when designing betting systems. We believe this is useful for anyone looking to use machine learning for sports.", "Feel free to contact me for more information or questions. Also, note that we\u2019ll be happy to share our data if you find any interest in them.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A Quant in the Cloud. Expert in the field of AWS, ML & Big data. Director at https://lucyinthecloud.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb42ae4900782&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://charlesmalafosse.medium.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Charles Malafosse"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd97a784141f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&user=Charles+Malafosse&userId=dd97a784141f&source=post_page-dd97a784141f----b42ae4900782---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/f4cqfNQOBkA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Christin Noelle"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://medium.com/@timanglade/how-hbos-silicon-valley-built-not-hotdog-with-mobile-tensorflow-keras-react-native-ef03260747f3", "anchor_text": "Hotdog, not Hotdog"}, {"url": "https://betsentiment.com/aboutus", "anchor_text": "Sentiment Analysis"}, {"url": "https://github.com/charlesmalafosse/sports-betting-customloss", "anchor_text": "github page"}, {"url": "https://medium.com/@charlesmalafosse/membership", "anchor_text": "https://medium.com/@charlesmalafosse/membership"}, {"url": "https://github.com/charlesmalafosse/sports-betting-customloss", "anchor_text": "Github"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://en.wikipedia.org/wiki/Multi-label_classification", "anchor_text": "Multi-label classification"}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/API+Overview", "anchor_text": "Betfair API"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----b42ae4900782---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/sports?source=post_page-----b42ae4900782---------------sports-----------------", "anchor_text": "Sports"}, {"url": "https://medium.com/tag/betting?source=post_page-----b42ae4900782---------------betting-----------------", "anchor_text": "Betting"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----b42ae4900782---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/loss-function?source=post_page-----b42ae4900782---------------loss_function-----------------", "anchor_text": "Loss Function"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&user=Charles+Malafosse&userId=dd97a784141f&source=-----b42ae4900782---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&user=Charles+Malafosse&userId=dd97a784141f&source=-----b42ae4900782---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb42ae4900782&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b42ae4900782---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b42ae4900782--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b42ae4900782--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b42ae4900782--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b42ae4900782--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b42ae4900782--------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Charles Malafosse"}, {"url": "https://charlesmalafosse.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "312 Followers"}, {"url": "https://lucyinthecloud.com/", "anchor_text": "https://lucyinthecloud.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd97a784141f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&user=Charles+Malafosse&userId=dd97a784141f&source=post_page-dd97a784141f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6fc3c69b59a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-for-sports-betting-not-a-basic-classification-problem-b42ae4900782&newsletterV3=dd97a784141f&newsletterV3Id=6fc3c69b59a6&user=Charles+Malafosse&userId=dd97a784141f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}