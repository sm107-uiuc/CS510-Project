{"url": "https://towardsdatascience.com/deploy-any-python-project-to-kubernetes-2c6ad4d41f14", "time": 1683005867.517099, "path": "towardsdatascience.com/deploy-any-python-project-to-kubernetes-2c6ad4d41f14/", "webpage": {"metadata": {"title": "Deploy Any Python Project to Kubernetes | by Martin Heinz | Towards Data Science", "h1": "Deploy Any Python Project to Kubernetes", "description": "It's time to dive into Kubernetes and bring your Python project to Cloud with this fully-fledged project template and KinD (Kubernetes in Docker)!"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/automating-every-aspect-of-your-python-project-6517336af9da", "anchor_text": "Automating Every Aspect of Your Python Project", "paragraph_index": 1}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "https://github.com/MartinHeinz/python-project-blueprint", "paragraph_index": 2}, {"url": "https://github.com/kubernetes-sigs/kind#installation-and-usage", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://kubernetes.io/docs/concepts/services-networking/ingress/", "anchor_text": "ingress", "paragraph_index": 11}, {"url": "https://github.com/MartinHeinz/python-project-blueprint/blob/master/k8s/app.yaml", "anchor_text": "here", "paragraph_index": 19}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "repository", "paragraph_index": 37}, {"url": "https://martinheinz.dev/blog/20", "anchor_text": "martinheinz.dev", "paragraph_index": 38}, {"url": "https://martinheinz.dev/", "anchor_text": "https://martinheinz.dev/", "paragraph_index": 40}, {"url": "https://ko-fi.com/martinheinz", "anchor_text": "https://ko-fi.com/martinheinz", "paragraph_index": 40}], "all_paragraphs": ["As your project grows, it might get to the point that it becomes too hard to handle with just single VM or some simple SaaS solution. You can solve that by switching to more robust solution like Kubernetes. That might however, be little too complex if you are not familiar with it\u2019s concepts or if just never used it before. So, to help you out \u2014 in this article \u2014 we will go over all you need to get yourself started and have your Python project deployed on cluster \u2014 including cluster setup, all the Kubernetes manifests and some extra automation to make your life easier down the road!", "This is a follow up to previous article(s) about Automating Every Aspect of Your Python Project, so you might want check that out before reading this one.", "TL;DR: Here is my repository with full source code and docs: https://github.com/MartinHeinz/python-project-blueprint", "To be productive in your development process, you need to have comfy local development setup. Which in this case means having simple to use Kubernetes on local, closely mirroring your real, production cluster and for that, we will use KinD:", "KinD (Kubernetes-in-Docker), as the name implies, runs Kubernetes clusters in Docker containers. It is the official tool used by Kubernetes maintainers for Kubernetes v1.11+ conformance testing. It supports multi-node clusters as well as HA clusters. Because it runs K8s in Docker, KinD can run on Windows, Mac, and Linux. So, you can run it anywhere, you just need Docker installed.", "So, let\u2019s install KinD (on Linux \u2014 if you are on Windows, see installation info here):", "With that, we are ready to setup our cluster. For that we will need following YAML file:", "This manifest describes our cluster. It will have 3 nodes \u2014 control plane ( role: control-plane) and 2 workers role: worker. We are also giving it a few more settings and arguments to make it possible to setup ingress controller later, so that we can have HTTPS on this cluster. All you need to know about those settings, is that extraPortMappings tells cluster to forward ports from the host to an ingress controller running on a node.", "Note: All the manifests for both cluster and Python application are available in my repository here in k8s directory.", "Now, we need to run few commands to bring it up:", "To create cluster, we just need to run the first command. After that we can check whether it\u2019s good to go by running cluster-info and get nodes commands. Typing out these commands gets annoying after some time, so we will it simpler later, but with that we have cluster up and running.", "Next, we want to setup ingress for our cluster. For that we have to run a few kubectl commands to make it work with KinD:", "First we deploy mandatory ingress-nginx components. On top of that we expose the nginx service using NodePort, which is what the second command does. Last command applies some KinD specific patches for ingress controller.", "With cluster ready, it\u2019s time to setup and deploy our application. For that we will use very simple Flask application \u2014 echo server:", "I chose Flask application instead of some CLI tool (or Python package), as we need the application that won\u2019t terminate instantaneously, as some Python package would. Also, notice host parameter being set to 0.0.0.0, without this it would not be possible to reach the application when we expose it through Kubernetes service and ingress.", "Next thing we need is YAML manifests for this application, let\u2019s break it up into separate objects:", "Nothing to really talk about here. We generally don\u2019t want to deploy applications in default namespace, so this is the one will use instead.", "This is where we can define variables for the application. These vars from data section will be injected into application container as environment variables. As an example, I included FLASK_ENV and FLASK_DEBUG, which will be picked up by Flask automatically when the application starts.", "The same way as we specified plaintext vars, we can use Secret to add things like credential and keys to our application. This object should however, not be pushed to your repository as it contains sensitive data. We can create it dynamically with following command:", "Note: This and other commands, needed to deploy the application are listed in README in repository as well as at the bottom manifests file here.", "Now for the most important part \u2014 the Deployment. The relevant part here is the spec section which specifies image, ports and environment variables. For image we specify image from Docker Hub. In case we wanted to use some private registry like Artifactory, we would have to add imagePullSecret which gives the cluster credential for pulling the image. This secret can be created using following command:", "This shows how you would allow pulling of your images from GitHub Package Registry, which unfortunately doesn\u2019t work with KinD right now, because of issues listed in the above YAML, but it would work just fine with your production cluster in Cloud (assuming it\u2019s not using KinD).", "If you want to avoid pushing image to remote registry every time you redeploy your application, then you can load your image into cluster using kind load docker-image martinheinz/python-project-blueprint:flask.", "After image, we also specify ports. These are ports on which our application is listening on, in this case 5000, because our app starts using app.run(host='0.0.0.0', port=5000).", "Last part, the envFrom section is used to inject plaintext variables and secrets from ConfigMap and Secret shown above, by specifying their names in the respective Ref fields.", "Now, that we have application listening on a port, we need Service that will expose it. All this objects defines is that application listening on port 5000 should be exposed on cluster node on port 443.", "Last big piece of puzzle \u2014 the Ingress \u2014 an object that manages external access to the Services in a cluster. Let\u2019s first look at the rules section - in this case we define that our host is localhost. We also set path to / meaning that any request sent to localhost/ belongs to associated backend defined by name of the previously shown Service and its port.", "The other section here is tls. This section provides HTTPS for listed hosts by specifying Secret that includes tls.crt and tls.key. Let's create this Secret:", "Above snippet first sets a few variables which are then used to generate certificate and key files for TLS using openssl. Last command creates Secret containing these 2 files.", "With all the manifests ready, we can finally deploy our application:", "Most of the commands above we\u2019ve already seen in sections before. What\u2019s new is kubectl apply -f app.yaml which creates all the necessary object in our cluster. After it's created we can check presence of those objects using kubectl get all. Finally we can check whether the application is accessible using cURL and it is! So, with that, we have our application running on the cluster!", "If you don\u2019t feel fully comfortable with all the kind and kubectl commands yet or you are just lazy like me and you don't want to type it all out, then I have couple of Make targets for you - to make your life easier:", "The make cluster command will setup the cluster for you if it's not yet ready and if it is, it will give you all the info about it. This is nice if you need to check status of nodes and switch to your development namespace.", "This one is very simple \u2014 all it does is roll out new deployment \u2014 so in case there is new image, it will deploy it, otherwise it will just restart your application.", "In case you need to debug your application, you will probably want to see recent events related to the application pod as well as recent (last hour) logs. That\u2019s exactly what make cluster-debug does for you.", "If logs are not enough to solve some issues you might be having and you decide that you need to poke around inside the container, then you can run make cluster-rsh to get remote shell.", "We\u2019ve seen this command before. It just re-applies YAML manifests, which is handy when you are tweaking some properties of Kubernetes objects.", "This article wasn\u2019t meant to be Kubernetes tutorial, but I think it shows enough to get you started and have your application up and running pretty quickly. To learn more about Kubernetes, I recommend just playing, tweaking and changing things around in manifests and seeing what happens. That\u2019s in my opinion good way to find out how things work and to get comfortable with kubectl commands. If you have any questions, suggestions or issues feel free to reach out to me or create issue in my repository. In this repo, you can also find docs and all the manifests shown in this post.", "This article was originally posted at martinheinz.dev", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "CKA | RHCE | DevOps Engineer at IBM | Working with Python, Kubernetes, Linux and more | https://martinheinz.dev/ | https://ko-fi.com/martinheinz"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2c6ad4d41f14&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@martin.heinz?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Martin Heinz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4cbd6b36e62a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&user=Martin+Heinz&userId=4cbd6b36e62a&source=post_page-4cbd6b36e62a----2c6ad4d41f14---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@arstyy?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Austin Neill"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/automating-every-aspect-of-your-python-project-6517336af9da", "anchor_text": "Automating Every Aspect of Your Python Project"}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "https://github.com/MartinHeinz/python-project-blueprint"}, {"url": "https://github.com/kubernetes-sigs/kind#installation-and-usage", "anchor_text": "here"}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "here"}, {"url": "https://kubernetes.io/docs/concepts/services-networking/ingress/", "anchor_text": "ingress"}, {"url": "https://github.com/MartinHeinz/python-project-blueprint/blob/master/k8s/app.yaml", "anchor_text": "here"}, {"url": "https://github.com/MartinHeinz/python-project-blueprint", "anchor_text": "repository"}, {"url": "https://banzaicloud.com/blog/kind-ingress/", "anchor_text": "Kubernetes ingress on kind (Kubernetes IN Docker)"}, {"url": "https://kind.sigs.k8s.io/docs/user/ingress/", "anchor_text": "Kind Docs for Ingress Setup"}, {"url": "https://martinheinz.dev/blog/20", "anchor_text": "martinheinz.dev"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----2c6ad4d41f14---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/programming?source=post_page-----2c6ad4d41f14---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/devops?source=post_page-----2c6ad4d41f14---------------devops-----------------", "anchor_text": "DevOps"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2c6ad4d41f14---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----2c6ad4d41f14---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&user=Martin+Heinz&userId=4cbd6b36e62a&source=-----2c6ad4d41f14---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&user=Martin+Heinz&userId=4cbd6b36e62a&source=-----2c6ad4d41f14---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2c6ad4d41f14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2c6ad4d41f14---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2c6ad4d41f14--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martin.heinz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Martin Heinz"}, {"url": "https://medium.com/@martin.heinz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5.4K Followers"}, {"url": "https://martinheinz.dev/", "anchor_text": "https://martinheinz.dev/"}, {"url": "https://ko-fi.com/martinheinz", "anchor_text": "https://ko-fi.com/martinheinz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4cbd6b36e62a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&user=Martin+Heinz&userId=4cbd6b36e62a&source=post_page-4cbd6b36e62a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff723091181e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-any-python-project-to-kubernetes-2c6ad4d41f14&newsletterV3=4cbd6b36e62a&newsletterV3Id=f723091181e3&user=Martin+Heinz&userId=4cbd6b36e62a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}