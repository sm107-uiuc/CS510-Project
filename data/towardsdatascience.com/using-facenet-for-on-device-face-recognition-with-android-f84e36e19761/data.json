{"url": "https://towardsdatascience.com/using-facenet-for-on-device-face-recognition-with-android-f84e36e19761", "time": 1683009664.897805, "path": "towardsdatascience.com/using-facenet-for-on-device-face-recognition-with-android-f84e36e19761/", "webpage": {"metadata": {"title": "Using FaceNet For On-Device Face Recognition With Android | by Shubham Panchal | Towards Data Science", "h1": "Using FaceNet For On-Device Face Recognition With Android", "description": "Face Recognition system | Android | Keras | FaceNet | TensorFlow | Kotlin | On Device"}, "outgoing_paragraph_urls": [{"url": "https://github.com/nyoki-mtl/keras-facenet", "anchor_text": "nyoki-mtl/keras-facenet", "paragraph_index": 6}, {"url": "https://codelabs.developers.google.com/codelabs/camerax-getting-started/#0", "anchor_text": "official docs", "paragraph_index": 7}], "all_paragraphs": ["The demand for face recognition systems is increasing day-by-day, as the need for recognizing, classifying many people instantly, increases. Be it your office\u2019s attendance system or a simple face detector in your mobile\u2019s camera, face detection systems are all there. In the case of edge devices, this demand is even more as they serve many purposes like surveillance of a crowd, passengers at an airport, bus stand, and so on.", "Today, we are going to create a similar face recognition app, totally from scratch. But wait there\u2019s something special!", "Imagine, you are using a face detection system in your office. For the 10 employees, in your office, the system works perfectly fine. But, now you have a friend of yours joining you in your office. The system could fail in recognizing your friend as it is not programmed to do so. So, for every new employee, you need to modify the system and reprogramme it.", "You don\u2019t need to retrain the system! Why can\u2019t you just save the images of the 10 employees as well as of your friend and the app would instantly recognize your friend as well? No need to reprogramme the app or any other system, everything runs on Android! As you have new employees, keep adding their images in separate folders and the app is ready to recognize them.", "Till it the end of the story, we\u2019ll be creating such an app!", "In our app, we\u2019ll be using CameraX, Firebase MLKit, and TensorFlow Lite. If you haven\u2019t worked with these libraries before, make sure you have a look at them.", "The FaceNet Keras model is available on nyoki-mtl/keras-facenet repo. After downloading the .h5 model, we\u2019ll use the tf.lite.TFLiteConverter API to convert our Keras model to a TFLite model.", "To implement a live Camera feed, we use CameraX. I have used the code available in the official docs. Next, we create a FrameAnalyser class which implements ImageAnalysis class, which will help us retrieve camera frames and run inference on them.", "All our classification code will come in the analyze method. First, using Firebase MLKit, we\u2019ll get bounding boxes for all faces present in the camera frame (an Bitmap object ). We\u2019ll create a FirebaseVisionFaceDetector which runs the face detection model on an FirebaseVisionInputImage object.", "First, we\u2019ll produce face embeddings using our FaceNet model. Before, we\u2019ll create a helper class for handling the FaceNet model. This helper class will,", "In the snippet below, see the getFaceEmbedding() method which encapsulates all the above steps.", "Now, we have a class that would return us the 128-dimensional embedding for all faces present in the given image. We come back to a FrameAnalyser \u2018s analyze() method. Using the helper class which just created, we\u2019ll produce face embeddings and compare each of them with a set of embeddings that we already have.", "Before that, we need to get the set of predefined embeddings, right? These embeddings will refer to the people whom we need to recognize. So, the app will read the images folder present in the internal storage of the user\u2019s device. If the user wants to recognize, two users, namely Rahul and Neeta, then he/she needs to create two separate directories within the images folder. Then he/she has to place an image of Rahul and Neeta in their respective sub-directories.", "Our aim to read these images and produce an HashMap<String,FloatArray> object where the key ( String)will the subject\u2019s name like Rahul or Neeta and the value ( FloatArray ) will the corresponding face embedding. You\u2019ll get an idea of the process by looking at the code below.", "Next step is to compare the embeddings with a suitable metric. We can use either the L2 norm or the cosine similarity metric. Use the metricToBeUsed variable for choosing L2 norm or cosine similarity. We compute the score for each image. Then we compute the average score of each user. The user with the best average score is our output.", "The predictions array is then supplied to the boundingBoxOverlay class which draws the bounding boxes and also displays the label. In the BoundingBoxOverlay.kt class. Here, we are using two Matrix to transform the output and display it on the screen. For the front camera, we have to flip the coordinates of the bounding boxes, else we\u2019ll see a mirror image of the boxes on the overlay.", "Using the app, I have tried to recognize the faces of Jeff Bezos and Elon Musk,", "Also, I had stored in the images in my internal storage as such,", "I hope you liked the story. Thanks for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "\ud83d\ude07 Loves Android and ML, \ud83d\udca1 answering your thought-provoking questions in ML intuitively, \ud83d\udc68\u200d\ud83c\udf93 aspiring ML researcher"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff84e36e19761&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://equipintelligence.medium.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": ""}, {"url": "https://equipintelligence.medium.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Shubham Panchal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd45a9465f044&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&user=Shubham+Panchal&userId=d45a9465f044&source=post_page-d45a9465f044----f84e36e19761---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://equipintelligence.medium.com/list/stories-on-mobile-ml-with-kotlin-and-tf-lite-3ebee822c87b", "anchor_text": "Mobile Machine Learning"}, {"url": "https://unsplash.com/@harrycunnningham1?utm_source=medium&utm_medium=referral", "anchor_text": "Harry Cunningham"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/shubham0204/FaceRecognition_With_FaceNet_Android", "anchor_text": "shubham0204/FaceRecognition_With_FaceNet_AndroidStore images of people who you would like to recognize and the app, using these images, will classify those people. We\u2026github.com"}, {"url": "https://codelabs.developers.google.com/codelabs/camerax-getting-started", "anchor_text": "CameraX : Official Codelab"}, {"url": "https://firebase.google.com/docs/ml-kit/android/detect-faces", "anchor_text": "Firebase MLKit : Detect Faces with ML Kit on Android"}, {"url": "https://blog.tensorflow.org/2018/03/using-tensorflow-lite-on-android.html", "anchor_text": "TensorFlow Lite on Android"}, {"url": "https://arxiv.org/abs/1503.03832", "anchor_text": "FaceNet: A Unified Embedding for Face Recognition and Clustering"}, {"url": "https://www.geeksforgeeks.org/facenet-using-facial-recognition-system/", "anchor_text": "FaceNet \u2014 Using Facial Recognition System"}, {"url": "https://github.com/nyoki-mtl/keras-facenet", "anchor_text": "nyoki-mtl/keras-facenet"}, {"url": "https://codelabs.developers.google.com/codelabs/camerax-getting-started/#0", "anchor_text": "official docs"}, {"url": "https://github.com/shubham0204/FaceRecognition_With_FaceNet_Android/blob/master/README.md", "anchor_text": "README.md"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f84e36e19761---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f84e36e19761---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/android?source=post_page-----f84e36e19761---------------android-----------------", "anchor_text": "Android"}, {"url": "https://medium.com/tag/android-app-development?source=post_page-----f84e36e19761---------------android_app_development-----------------", "anchor_text": "Android App Development"}, {"url": "https://medium.com/tag/programming?source=post_page-----f84e36e19761---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&user=Shubham+Panchal&userId=d45a9465f044&source=-----f84e36e19761---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&user=Shubham+Panchal&userId=d45a9465f044&source=-----f84e36e19761---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff84e36e19761&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f84e36e19761---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f84e36e19761--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f84e36e19761--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f84e36e19761--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f84e36e19761--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f84e36e19761--------------------------------", "anchor_text": ""}, {"url": "https://equipintelligence.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://equipintelligence.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Shubham Panchal"}, {"url": "https://equipintelligence.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.1K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd45a9465f044&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&user=Shubham+Panchal&userId=d45a9465f044&source=post_page-d45a9465f044--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F55bcc27ba160&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-facenet-for-on-device-face-recognition-with-android-f84e36e19761&newsletterV3=d45a9465f044&newsletterV3Id=55bcc27ba160&user=Shubham+Panchal&userId=d45a9465f044&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}