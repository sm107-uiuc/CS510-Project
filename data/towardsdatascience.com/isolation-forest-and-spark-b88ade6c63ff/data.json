{"url": "https://towardsdatascience.com/isolation-forest-and-spark-b88ade6c63ff", "time": 1683001232.73565, "path": "towardsdatascience.com/isolation-forest-and-spark-b88ade6c63ff/", "webpage": {"metadata": {"title": "Isolation Forest and Spark. Main characteristics and ways to use\u2026 | by Maria Karanasou | Towards Data Science", "h1": "Isolation Forest and Spark", "description": "Isolation Forest is an algorithm for anomaly / novelty detection. See the ways to use it in PySpark."}, "outgoing_paragraph_urls": [{"url": "https://github.com/linkedin/isolation-forest", "anchor_text": "LinkedIn", "paragraph_index": 15}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "Fangzhou Yang", "paragraph_index": 15}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "spark-iforest", "paragraph_index": 16}, {"url": "http://buymeacoffee.com/mkaranasou", "anchor_text": "buymeacoffee.com/mkaranasou", "paragraph_index": 31}], "all_paragraphs": ["Isolation Forest is an algorithm for anomaly / outlier detection, basically a way to spot the odd one out. We go through the main characteristics and explore two ways to use Isolation Forest with Pyspark.", "Most existing model-based approaches to anomaly detection construct a profile of normal instances, then identify instances that do not conform to the normal profile as anomalies. [\u2026] [Isolation Forest] explicitly isolates anomalies instead of profiles normal points", "Isolation means separating an instance from the rest of the instances", "*low memory requirements come from the fact that each tree in the forest does not have to be constructed the wholly, since the anomalies should have a lot shorter paths than the normal instances, so a max depth can be used to cut off the tree construction.", "Isolation Forest takes advantage of the two characteristics of anomalies: that they are few and distinct / different", "One way to detect anomalies is to sort data points according to their path lengths or anomaly scores; and anomalies are points that are ranked at the top of the list", "Path length: the number of edges until we reach an external node", "This is basically the output of the algorithm, which is \u22641 and \u22650. This is where the path length come in the picture. With the estimation of the average path length in the whole forest, we can deduce whether a point is anomalous or not.", "If the anomaly score for an instance is very close to 1 then it is safe to say that this instance is an anomaly, if it is < 0.5 then it is probably a normal instance and if it is ~= 0.5 then the entire sample does not have any distinct anomalies.", "The algorithm learns what normal looks like to be able to distinguish the abnormal", "The Scikit-learn way will need us to create a udf to be able to predict upon a dataframe. This is the usual way in general to utilize a Scikit-learn model. Note that we cannot parallelize the training part using spark \u2014 but we can use the parameter n_jobs=-1 to utilize all cores on our machine. Another important thing to remember is to set the random_seed to something specific so that the results are reproducible.", "All we need to do is install scikit-learn and its dependenciespip install sklearn numpy scipy", "Then we can start with a simple example, a dataframe with four samples.", "There is more than one way to go about this udf, for example you can load the model within the udf from a file (which can potentially cause errors because of the parallelization), or you could pass the serialized model as a column (which will increase your memory consumption by a lot), but I\u2019ve found that the use of broadcast variables works best in terms of time and memory performance.", "Let me know if there\u2019s a better way to do this :)", "There is no official package for iForest in the Spark ML library currently. However, I\u2019ve found two implementations, one by LinkedIn which only has the Scala implementation and one by Fangzhou Yang that can be used with Spark and PySpark. We\u2019ll explore the second one.", "Steps to use spark-iforest by Fangzhou Yang:", "3. And either copy it to $SPARK_HOME/jars/ or provide it as extra jar in your spark configuration (I prefer the latter for more flexibility):", "4. Install the python version of spark-iforest:", "And we\u2019re ready to use it! Again, it is important to set the random seed to something specific for reproducibility.", "In both examples we use a very small and simple dataset, just to demonstrate the process.", "Both implementations of the algorithm conclude that the first sample looks anomalous in comparison to the other three samples, which makes sense if we take a look at the features.", "It seems that IForest can handle currently only DenseVector input, while VectorAssembler outputs both Dense and Sparse vectors. So, unfortunately, we need to convert the vectors to Dense using a udf.", "Isolation Forest, in my opinion, is a very interesting algorithm, light, scalable, with many applications. It is definitely worth exploring.", "For the Pyspark integration:I\u2019ve used the Scikit-learn model quite extensively and while it works well, I\u2019ve found that as the model size increases, so does the time it takes to broadcast the model and complete a prediction cycle. As expected.", "I haven\u2019t tested the PySpark ML way enough to be certain that both implementations give the same results, but in the small, meaningless dataset I used in the examples, they seem to agree. I will definitely experiment more with this to investigate how well it scales and how good the outcome is.", "I hope this was helpful and that knowing about how to use Isolation Forest in combination with PySpark will save you some time and trouble. Any thoughts, questions, corrections and suggestions are very welcome :)", "If you want to know more about how Spark works, take a look at:", "And if you are coming from the Pandas world and want to get hands on quickly with Spark, check out Koalas:", "Understanding Isolation Forest\u2019s predictions using Shapley Values \u2014 Estimating feature importance at scale:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A mom and a Software Engineer who loves to learn new things & all about ML & Big Data. Buy me a coffee to help me keep going buymeacoffee.com/mkaranasou"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb88ade6c63ff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@karanasou", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://karanasou.medium.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Maria Karanasou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1570cd236e2d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&user=Maria+Karanasou&userId=1570cd236e2d&source=post_page-1570cd236e2d----b88ade6c63ff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf", "anchor_text": "https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf"}, {"url": "https://github.com/linkedin/isolation-forest", "anchor_text": "LinkedIn"}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "Fangzhou Yang"}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "spark-iforest"}, {"url": "https://maven.apache.org/install.html", "anchor_text": "Maven"}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "spark-iforest"}, {"url": "https://towardsdatascience.com/explaining-technical-stuff-in-a-non-techincal-way-apache-spark-274d6c9f70e9", "anchor_text": "Explaining technical stuff in a non-technical way \u2014 Apache SparkWhat is Spark and PySpark and what can I do with it?towardsdatascience.com"}, {"url": "https://towardsdatascience.com/adding-sequential-ids-to-a-spark-dataframe-fa0df5566ff6", "anchor_text": "Adding sequential IDs to a Spark DataframeHow to do it and is it a good idea?towardsdatascience.com"}, {"url": "https://towardsdatascience.com/from-pandas-to-pyspark-with-koalas-e40f293be7c8", "anchor_text": "From Pandas to PySpark with KoalasThe Koalas project makes data scientists more productive when interacting with big data, by implementing the pandas\u2026towardsdatascience.com"}, {"url": "https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf", "anchor_text": "https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html", "anchor_text": "sklearn.ensemble.IsolationForest - scikit-learn 0.21.3 documentationclass sklearn.ensemble. IsolationForest( n_estimators=100, max_samples='auto', contamination='legacy'\u2026scikit-learn.org"}, {"url": "https://medium.com/@hyunsukim_9320/isolation-forest-step-by-step-341b82923168", "anchor_text": "Isolation Forest Step by StepOverviewmedium.com"}, {"url": "https://github.com/titicaca/spark-iforest", "anchor_text": "titicaca/spark-iforestIsolation Forest (iForest) is an effective model that focuses on anomaly isolation. iForest uses tree structure for\u2026github.com"}, {"url": "https://github.com/linkedin/isolation-forest", "anchor_text": "linkedin/isolation-forestThis is a Scala/Spark implementation of the Isolation Forest unsupervised outlier detection algorithm. This library was\u2026github.com"}, {"url": "https://medium.com/mlearning-ai/machine-learning-interpretability-shapley-values-with-pyspark-16ffd87227e3", "anchor_text": "Machine Learning Interpretability \u2014 Shapley Values with PySparkInterpreting Isolation Forest\u2019s predictions \u2014 and not onlymedium.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----b88ade6c63ff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----b88ade6c63ff---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----b88ade6c63ff---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b88ade6c63ff---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----b88ade6c63ff---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&user=Maria+Karanasou&userId=1570cd236e2d&source=-----b88ade6c63ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&user=Maria+Karanasou&userId=1570cd236e2d&source=-----b88ade6c63ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb88ade6c63ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b88ade6c63ff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b88ade6c63ff--------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maria Karanasou"}, {"url": "https://karanasou.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.4K Followers"}, {"url": "http://buymeacoffee.com/mkaranasou", "anchor_text": "buymeacoffee.com/mkaranasou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1570cd236e2d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&user=Maria+Karanasou&userId=1570cd236e2d&source=post_page-1570cd236e2d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F399ab963554c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fisolation-forest-and-spark-b88ade6c63ff&newsletterV3=1570cd236e2d&newsletterV3Id=399ab963554c&user=Maria+Karanasou&userId=1570cd236e2d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}