{"url": "https://towardsdatascience.com/intro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4", "time": 1683017237.011859, "path": "towardsdatascience.com/intro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4/", "webpage": {"metadata": {"title": "Intro to Recommender Systems with TensorFlow and TFRS | by Dimitris Poulopoulos | Towards Data Science", "h1": "Intro to Recommender Systems with TensorFlow and TFRS", "description": "In his 2004 article entitled \u201cThe Long Tail,\u201d Chris Anderson said that we are leaving the information age and entering the age of recommendation. Unless we can filter the information overload we\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate", "paragraph_index": 5}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://dl.acm.org/doi/pdf/10.1145/2959100.2959190?casa_token=Zy--mKHH0wQAAAAA%3ALH0JUCJptvF218iAcDNHiFJ9pktNg_EzFZD7KSxtbIBP-C6y2lPvvn4S1OEqXuRGk5RTo49tUmFv", "anchor_text": "publication", "paragraph_index": 12}, {"url": "https://www.tensorflow.org/datasets", "anchor_text": "Tensorflow Datasets", "paragraph_index": 18}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate", "paragraph_index": 38}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here", "paragraph_index": 38}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "Dimitris Poulopoulos", "paragraph_index": 39}, {"url": "https://www.arrikto.com/", "anchor_text": "Arrikto", "paragraph_index": 39}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn", "paragraph_index": 40}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl", "paragraph_index": 40}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me", "paragraph_index": 43}], "all_paragraphs": ["In his 2004 article entitled \u201cThe Long Tail,\u201d Chris Anderson said that we are leaving the information age and entering the age of recommendation. Unless we can filter the information overload we absorb every day and retain only what is important to us, everything reduces to noise.", "A recommender system aims to predict the user\u2019s behavioral patterns, preferences, or dislikes, and provide personalized recommendations on items users are likely to interact with.", "Moreover, we seem to diverge from the notion of search and embrace that of discovery. The difference is that when searching, a user is actively looking for something. Discovery suggests that something the user did not know existed, or did not know how to ask for, finds him.", "A recommender system aims to predict the user's behavioral patterns, preferences, or dislikes and provide personalized recommendations on items users are likely to interact with.", "So, are you curious about how such systems work? This story examines how to formulate a recommendation problem, the difference between implicit and explicit feedback, and how to build a movie recommender system with TensorFlow and TFRS.", "Learning Rate is my weekly newsletter for those who are curious about the world of AI and MLOps. You\u2019ll hear from me every Friday with updates and thoughts on the latest AI news, research, repos and books. Subscribe here!", "The recommendation problem can be conceptually structured as a two-dimensional matrix, where rows correspond to users and columns correspond to items. Then, each cell\u2019s value represents a user's preference for an item.", "A recommender system algorithm tries to predict the missing values in that matrix, and recommend the items that it predicts with a big score to an active user.", "Sometimes we have the user's explicit opinion for an item in the form of a rating score; we know what the user liked and what they could go without. When explicit feedback from the users is available, the system tries to solve a surrogate problem, where ratings are viewed as a proxy to preference. This is usually solved as a regression problem; thus, the algorithm tries to predict a real-valued rating to complete the user-item matrix's missing values.", "However, most of the time, we do not have access to explicit user feedback. In such cases, the system works passively in the background, trying to collect meaningful features. Those features can be used to implicitly discover user habits, preferences, and behavior, with some level of confidence. In binary implicit feedback, the user-item matrix is simplified to a Boolean matrix, where true values correspond to positive user-item interaction, and false values indicate no interaction. In any case, implicit feedback has consequences to both algorithmic design and evaluation measures.", "For this example, we use the well-known movielens dataset. However, we won\u2019t consider the ratings given by users, but we will treat a user-movie interaction (i.e., a user u has seen movie m) as positive implicit feedback. On the other hand, we do not have any information about the void interactions; if a user has not seen a movie, we cannot be sure if this is because she doesn\u2019t like the movie or hasn\u2019t stumbled upon it yet.", "Although we could directly predict a user's recommendations, we will split the process into two parts: candidate extraction and candidate ranking. This is closer to what a real-world recommender, looking through millions of items, would do:", "This is actually what YouTube also does for generating video recommendations. You can read more in their relevant publication.", "In this article, we implement the first part of this process, the candidate extraction. In subsequent stories, we will see how to deploy this efficiently and how to rank those candidates.", "To generate valid candidates for our users, we build a retrieval model. Retrieval models are often composed of two sub-models:", "The two models' outputs are then multiplied together to give a query-candidate affinity score. This is the dot product between the user embedding vector and the corresponding item embedding vector; a higher score indicates a better match between the user and the item, or, in other words, the query and the candidate.", "In this tutorial, we see how to:", "First, let\u2019s install the project\u2019s dependencies and import the necessary libraries. We will install tensorflow-recommenders, tensorflow-datasets, and snann an optional dependency of TFRS, which will make our inference service orders of magnitude faster. We will see this last part in the next article, where we will talk about efficient deployment.", "Let\u2019s now turn our attention to the data set. In this example, we use the MovieLens dataset from Tensorflow Datasets. Loading movielens/100k_ratings yields a tf.data.Dataset object containing the \u201cratings\u201d data and loading movielens/100k_movies yields a tf.data.Dataset object containing only the \u201cmovies\u201d data.", "The MovieLens data set does not have predefined splits, so we will load the train split.", "The ratings dataset holds a lot of info, such as the movie\u2019s genre and the user\u2019s age. Although you can use everything to build a more accurate model. Let\u2019s simplify our problem a bit and keep only the user\u2019s ID and the movie\u2019s title. In the same way, let\u2019s keep only the movie\u2019s title from the movie dataset.", "Since we don\u2019t have a train and test split predefined, let\u2019s create one ourselves. First, we shuffle the examples and then take 80% for the training set and the remaining 20% for the validation set.", "Finally, we need to extract the unique user and movie IDs. This helps create our vocabularies, the list of users, and items we will embed.", "Choosing the architecture of our model is key in Deep Learning. In this case, our model consists of two parts:", "We can build each tower separately and then combine them in the final model. Also, we should add an additional embedding to account for unknown tokens, and let\u2019s agree on an embedding size of 32. Usually, more dimensions for the embedding layer will correspond to models that may be more accurate but will also be slower to fit and more prone to overfitting.", "We are now ready to combine the two towers in a single model:", "Instead of a forward method, we have a compute_loss method. This method will take the user and movie embeddings, compute the loss, update the weights, and evaluate the metrics, in one package. Under the hood, it\u2019s still a plain Keras model.", "You could achieve the same functionality by inheriting from tf.keras.Model and overriding the train_step and test_step functions. But this is where TFRS shines!", "Next, let\u2019s see how to define our loss and metric, and what those values mean.", "Using implicit feedback as our signal means that we only have info about the positive user-item interactions. Thus, to figure out how good our model is, we compare the score that the model calculates for a specific pair to the scores of all the other possible candidates; if the score for the positive pair is higher than for all other candidates, our model is highly accurate.", "To do this, we can use the tfrs.metrics.FactorizedTopK metric. The metric has one required argument: the dataset of candidates that are used as implicit negatives for evaluation.", "As for the loss, TFRS makes it easy, as it provides a wrapper called task. We are building a retrieval model, so we can use the Retrieval task object. A task object bundles together the loss function and metric computation. So, let\u2019s specify the metric and the task:", "Finally, we are ready to train and evaluate the model. As we said, our recommender is nothing more than a Keras model, so we should compile it and fit it to the data.", "During training, and also after evaluation, you can monitor the performance of your model. We have this weird looking metric that says:", "It\u2019s actually quite simple: all it\u2019s saying is that the movie that a user watched is in the top-10 recommended ones 2.2% of the time. This might look a bit low, but it\u2019s actually a good result. To the best of my knowledge, the state of the art is around 5\u20136%.", "Moreover, the model is re-recommending some movies that the users have already watched. These known-positive watches can push test movies out of top K recommendations. This can be tackled by simply excluding previously seen movies from test recommendations.", "This story describes what a recommender is, how it works, and what\u2019s the difference between implicit and explicit feedback. Next, we saw how to design modern, real-world recommenders by splitting the problem into a retrieval and a ranking challenge. Finally, we implemented a retrieval model using TensorFlow and TFRS.", "In the next articles, we will see how to efficiently deploy such a retrieval model and conclude our example by coding the ranking algorithm.", "Learning Rate is my weekly newsletter for those who are curious about the world of AI and MLOps. You\u2019ll hear from me every Friday with updates and thoughts on the latest AI news, research, repos and books. Subscribe here!", "My name is Dimitris Poulopoulos, and I\u2019m a machine learning engineer working for Arrikto. I have designed and implemented AI and software solutions for major clients such as the European Commission, Eurostat, IMF, the European Central Bank, OECD, and IKEA.", "If you are interested in reading more posts about Machine Learning, Deep Learning, Data Science, and DataOps, follow me on Medium, LinkedIn, or @james2pl on Twitter.", "Opinions expressed are solely my own and do not express the views or opinions of my employer.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer. I talk about AI, MLOps, and Python programming. More about me: www.dimpo.me"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc4d7fdacd0a4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1----c4d7fdacd0a4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@christianw?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Christian Wiediger"}, {"url": "https://unsplash.com/s/photos/youtube?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here"}, {"url": "https://dl.acm.org/doi/pdf/10.1145/2959100.2959190?casa_token=Zy--mKHH0wQAAAAA%3ALH0JUCJptvF218iAcDNHiFJ9pktNg_EzFZD7KSxtbIBP-C6y2lPvvn4S1OEqXuRGk5RTo49tUmFv", "anchor_text": "publication"}, {"url": "https://www.tensorflow.org/datasets", "anchor_text": "Tensorflow Datasets"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "Learning Rate"}, {"url": "https://www.dimpo.me/newsletter", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://www.arrikto.com/", "anchor_text": "Arrikto"}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c4d7fdacd0a4---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/technology?source=post_page-----c4d7fdacd0a4---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----c4d7fdacd0a4---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/recommender-systems?source=post_page-----c4d7fdacd0a4---------------recommender_systems-----------------", "anchor_text": "Recommender Systems"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----c4d7fdacd0a4---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----c4d7fdacd0a4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----c4d7fdacd0a4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc4d7fdacd0a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c4d7fdacd0a4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c4d7fdacd0a4--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://dpoulopoulos.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12.5K Followers"}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb5ab149102ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintro-to-recommender-systems-with-tensorflow-and-tfrs-c4d7fdacd0a4&newsletterV3=7cc87df5b1&newsletterV3Id=b5ab149102ea&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}