{"url": "https://towardsdatascience.com/a-short-introduction-to-model-selection-bb1bb9c73376", "time": 1682994145.1889448, "path": "towardsdatascience.com/a-short-introduction-to-model-selection-bb1bb9c73376/", "webpage": {"metadata": {"title": "A \u201cshort\u201d introduction to model selection | by David Sch\u00f6nleber | Towards Data Science", "h1": "A \u201cshort\u201d introduction to model selection", "description": "In this post I will discuss a topic central to the process of building good (supervised) machine learning models: model selection. This is not to say that model selection is the centerpiece of the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/esentri/datascience_blog_resources/blob/master/model_selection.ipynb", "anchor_text": "here", "paragraph_index": 21}, {"url": "https://sebastianraschka.com/pdf/manuscripts/model-eval.pdf", "anchor_text": "Model evaluation, model selection, and algorithm selection in machine learning", "paragraph_index": 23}, {"url": "https://neptune.ai/blog/the-ultimate-guide-to-evaluation-and-selection-of-models-in-machine-learning", "anchor_text": "The Ultimate Guide to Evaluation and Selection of Models in Machine Learning", "paragraph_index": 25}, {"url": "https://stats.stackexchange.com/questions/65128/nested-cross-validation-for-model-selection", "anchor_text": "here", "paragraph_index": 26}, {"url": "https://stats.stackexchange.com/questions/251752/model-selection-problem-using-nested-cross-validation-in-presence-of-several-alt", "anchor_text": "here", "paragraph_index": 26}, {"url": "https://stats.stackexchange.com/questions/232897/how-to-build-the-final-model-and-tune-probability-threshold-after-nested-cross-v", "anchor_text": "here", "paragraph_index": 26}], "all_paragraphs": ["In this post I will discuss a topic central to the process of building good (supervised) machine learning models: model selection. This is not to say that model selection is the centerpiece of the data science workflow \u2014 without high-quality data, model building is vanity. Nevertheless, model selection plays a crucial role in building good machine learning models.", "So, what is model selection all about? Model selection in the context of machine learning can have different meanings, corresponding to different levels of abstraction.", "For one thing, we might be interested in selecting the best hyperparameters for a selected machine learning method. Hyperparameters are the parameters of the learning method itself which we have to specify a priori, i.e., before model fitting. In contrast, model parameters are parameters which arise as a result of the fit [1]. In a logistic regression model, for example, the regularization strength (as well as the regularization type, if any) is a hyperparameter which has to be specified prior to the fitting, while the coefficients of the fitted model are model parameters. Finding the right hyperparameters for a model can be crucial for the model performance on given data.", "For another thing, we might want to select the best learning method (and their corresponding \u201coptimal\u201d hyperparameters) from a set of eligible machine learning methods. In the following, we will refer to this as algorithm selection. With a classification problem at hand, we might wonder, for instance, whether a logistic regression model or a random forest classifier yields the best classification performance on the given task.", "Before diving into the details of different approaches to model selection, and when to use them, there is \u201cone more thing\u201d we need to discuss: model evaluation. Model evaluation aims at estimating the generalization error of the selected model, i.e., how well the selected model performs on unseen data. Obviously, a good machine learning model is a model that not only performs well on data seen during training (else a machine learning model could simply memorize the training data), but also on unseen data. Hence, before shipping a model to production we should be fairly certain that the model\u2019s performance will not degrade when it is confronted with new data.", "But why do we need the distinction between model selection and model evaluation? The reason is overfitting. If we estimate the generalization error of our selected model on the same data which we have used to select our winning model, we will get an overly optimistic estimate. Why? Let\u2019s do a thought experiment. Assume you are given a set of black-box classifiers with the instruction to select the best-performing classifier. All classifiers are useless \u2014 they output a (fixed) sequence of zeros and ones. You evaluate all classifiers on your data and find that they get, on average, 50% of the cases right. By chance, one classifier performs better than the others on the data, say, by a margin of 8%. You take this performance as an estimate of the performance of your classifier on unseen data (i.e., as an estimate of the generalization error). You report that you have found a classifier which does better than random guessing. If you had, however, used a completely independent test set for estimating the generalization error, you would have quickly discovered the fraud! To avoid such issues, we need completely independent data for estimating the generalization error of a model. We will come back to this point in the context of cross validation.", "The recommended strategy for model selection depends on the amount of data available. If plenty of data is available, we may split the data into several parts, each serving a special purpose. For instance, for hyperparameter tuning we may split the data into three sets: train / validation / test. The training set is used to train as many models as there are different combinations of model hyperparameters. These models are then evaluated on the validation set, and the model with the best performance on this validation set is selected as the winning model. Subsequently, the model is retrained on training + validation data using the chosen set of hyperparameters and the generalization performance is estimated using the test set. If this generalization error is similar to the validation error, we have reason to believe that the model will perform well on unseen data. Lastly, we retrain the model on the full data (train, validation & test set) before using it in \u201cproduction\u201d.Since not all data is created equal, there is no general rule as to how the data should be split. A typical split is e.g. 50%/25%/25%. In any case, the validation set should be big enough to measure the difference in performance we want to be able to measure: If we care about a 0.1% difference between models, our validation set must not be smaller than 1000 samples, but 10000 samples would suffice.", "For algorithm selection, following the above reasoning, we can use several train/validation/test sets, one triple per algorithm. Since this method is quite data-demanding, we will discuss an alternative method below.", "But why should we retrain the model after model selection / model evaluation? The answer is best illustrated using learning curves. In a learning curve, the performance of a model both on the training and validation set is plotted as a function of the training set size. Fig. 1 shows a typical learning curve: The training score (performance on the training set) decreases with increasing training set size while the validation score increases at the same time. High training score and low validation score at the same time indicates that the model has overfit the data, i.e., has adapted too well to the specific training set samples. As the training set increases, overfitting decreases, and the validation score increases.Especially for data-hungry machine learning models, the learning curve might not yet have reached a plateau at the given training set size, which means the generalization error might still decrease when providing more data to the model. Hence, it seems reasonable to increase the training set (by adding the validation set) before estimating the generalization error on the test set, and to further take advantage of the test set data for model fitting before shipping the model. Whether or not this strategy is needed depends strongly on the slope of the learning curve at the initial training set size.", "Learning curves further allow to easily illustrate the concept of (statistical) bias and variance. Bias in this context refers to erroneous (e.g. simplifying) model assumptions, which can cause the model to underfit the data. A high-bias model does not adequately capture the structure present in the data. Variance on the other hand quantifies how much the model varies as we change the training data. A high-variance model is very sensitive to small fluctuations in the training data, which can cause the model to overfit. The amount of bias and variance can be estimated using learning curves: A model exhibits high variance, but low bias if the training score plateaus at a high level while the validation score at a low level, i.e., if there is a large gap between training and validation score. A model with low variance but high bias, in contrast, is a model where both training and validation score are low, but similar. Very simple models are high-bias, low-variance while with increasing model complexity they become low-bias, high-variance.", "The concept of model complexity can be used to create measures aiding in model selection. There are a few measures which explicitly deal with this trade-off between goodness of fit and model simplicity, for instance the Akaike information criterion (AIC) and the Bayesian information criterion (BIC). Both penalize the number of model parameters but reward goodness of fit on the training set, hence the best model is the one with lowest AIC/BIC. BIC penalizes model complexity stronger and hence favors models which are \u201cmore wrong\u201d but simpler. While this allows to do model selection without a validation set, it can be strictly applied only for models which are linear in their parameters, even though it typically also works in more general cases, e.g. for general linear models such as logistic regression. For a more detailed discussion, see e.g. Ref. [2,3].", "What we have implicitly assumed throughout the above discussion is that training, validation, and test set are sampled from the same distribution. If this is not the case, all estimates will be plain wrong. This is why it is essential to ensure before model building that the distribution of the data is not affected by partitioning your data. Imagine, for example, that you are dealing with imbalanced data, e.g. a data set with a binary target which is positive only 10% of the cases. Randomly splitting the data into train/validation/test set according to a 50%/25%/25% split could e.g. lead to a distribution of 5% positive cases in training and 15% in validation & test set, which could seriously screw algorithm performance estimates. In such a case, you may want to use stratified sampling (potentially combined with over- respectively undersampling techniques if your learning method requires it) to make the partitions.", "A final word of caution: when dealing with time series data where the task is to make forecasts, train, validation and test sets have to be selected by splitting the data along the temporal axis. That is, the \u201coldest\u201d data is used for training, the more recent one for validation, and the most recent one for testing. Random sampling does not make sense in this case.", "But what if small data is all we have? How do we do model selection and evaluation in this case? Model evaluation does not change. We still need a test set on which we can estimate the generalization error of the final selected model. Hence, we split the data into two sets, a training and a test set. What changes compared to the previous procedure is the way we use the training set.", "For hyperparameter selection, we can use K-fold cross-validation (CV). Cross-validation works as follows:", "Subsequently, we train the model with the chosen hyperparameter set on the full training set and estimate the generalization error using the test set. Lastly, we retrain the model using the combined data of training and test set.", "How many splits should we make, i.e., how should we choose K? Unfortunately, there is no free lunch, i.e., no single answer that always works best. If we choose K=N where N is the number of training examples, we are dealing with a method called leave-one-out cross-validation (LOOCV). The advantage here is that since we always use almost the entire data for training, the estimated prediction performance is approximately unbiased, meaning that the difference between expected value of the prediction error and \u201ctrue\u201d prediction error is very low. The disadvantage, however, is that LOOCV is computationally expensive and the variance can be high, meaning that our prediction performance estimate can fluctuate strongly around its \u201ctrue\u201d value. In contrast, if we choose K=5 or K=10, the variance of our prediction performance estimate is low, but our estimate might be overly pessimistic since we use only 80\u201390% of the available data for training (cf. discussion of the learning curve above). Nevertheless, 10-fold (or 5-fold) CV is recommended as a rule of thumb [2].", "For algorithm selection we need a more elaborate method. Here, nested cross-validation comes to the rescue, which is illustrated in Fig. 3 and works as follows:", "Lastly, we retrain the model using the combined data of training and test set.", "Why do we do hyperparameter selection at all if we do not use the \u201cbest\u201d hyperparameters found in the inner loop of the nested CV procedure? The reason is that in algorithm selection we are not really interested in finding the best algorithm & corresponding hyperparameter set for a specific data sample (our training set). We rather want an algorithm which generalizes well, and which does not fundamentally change if we use slightly different data for training [4]. We want a stable algorithm, since if our algorithm is not stable, generalization estimates are futile since we do not know what would happen if the algorithm had encountered a different data point in the training set. Hence, we are fine if the hyperparameters found in the inner loop are different, provided that the corresponding performance estimates on the hold-out sets are similar. If they are, it seems very likely that the different hyperparameters resulted in similar models, and that training the algorithm on the full training data will again produce a similar (though hopefully slightly improved) model.", "What about preprocessing such as feature selection? As a rule of thumb, supervised preprocessing (involving the data labels) should be done inside the (inner) CV loop [2]. In contrast, unsupervised preprocessing such as scaling can be done prior to cross-validation. If we ignore this advice, we might get an overly optimistic performance estimate, since setting aside data for validation purposes after relevant features have been selected on the basis of all training data introduces a dependence between training and validation folds. This contradicts the assumption of independence, which is implied when we use data for validation. By doing preprocessing such as feature selection in the inner CV loop, however, we might get a pessimistic performance estimate because the preprocessing procedure might improve when using more data.", "In case you wondered how this slightly cumbersome procedure of nested cross-validation can be implemented using code, you can find an example (python jupyter notebook with scikit-learn) here.", "While by far not comprehensive, this post covers many important concepts and \u201cbest practices\u201d concerning model selection. There is more to say about this topic, particularly about statistical tests for model selection and sampling-based methods (e.g. bootstrapping) for estimating the uncertainty of the performance estimates. If this post just got you started, please refer to Refs. [1-3] for further reading.", "[1] Model evaluation, model selection, and algorithm selection in machine learning by Sebastian Raschka.", "[2] Hastie T., Tibshirani R., and Friedman J., The Elements of Statistical Learning, New York, NY, USA: Springer New York Inc. (2008).", "[3] The Ultimate Guide to Evaluation and Selection of Models in Machine Learning on the neptune.ai blog.", "[4] See Stackexchange discussions here, here and here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Consultant at esentri AG | Physicist | @dwschoenleber"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbb1bb9c73376&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@d.schoenleber?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@d.schoenleber?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "David Sch\u00f6nleber"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F479c329bd713&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&user=David+Sch%C3%B6nleber&userId=479c329bd713&source=post_page-479c329bd713----bb1bb9c73376---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/esentri/datascience_blog_resources/blob/master/model_selection.ipynb", "anchor_text": "here"}, {"url": "https://sebastianraschka.com/pdf/manuscripts/model-eval.pdf", "anchor_text": "Model evaluation, model selection, and algorithm selection in machine learning"}, {"url": "https://neptune.ai/blog/the-ultimate-guide-to-evaluation-and-selection-of-models-in-machine-learning", "anchor_text": "The Ultimate Guide to Evaluation and Selection of Models in Machine Learning"}, {"url": "https://stats.stackexchange.com/questions/65128/nested-cross-validation-for-model-selection", "anchor_text": "here"}, {"url": "https://stats.stackexchange.com/questions/251752/model-selection-problem-using-nested-cross-validation-in-presence-of-several-alt", "anchor_text": "here"}, {"url": "https://stats.stackexchange.com/questions/232897/how-to-build-the-final-model-and-tune-probability-threshold-after-nested-cross-v", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----bb1bb9c73376---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/model-selection?source=post_page-----bb1bb9c73376---------------model_selection-----------------", "anchor_text": "Model Selection"}, {"url": "https://medium.com/tag/hyperparameter-tuning?source=post_page-----bb1bb9c73376---------------hyperparameter_tuning-----------------", "anchor_text": "Hyperparameter Tuning"}, {"url": "https://medium.com/tag/learning-curve?source=post_page-----bb1bb9c73376---------------learning_curve-----------------", "anchor_text": "Learning Curve"}, {"url": "https://medium.com/tag/cross-validation?source=post_page-----bb1bb9c73376---------------cross_validation-----------------", "anchor_text": "Cross Validation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&user=David+Sch%C3%B6nleber&userId=479c329bd713&source=-----bb1bb9c73376---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&user=David+Sch%C3%B6nleber&userId=479c329bd713&source=-----bb1bb9c73376---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbb1bb9c73376&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bb1bb9c73376---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bb1bb9c73376--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@d.schoenleber?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@d.schoenleber?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David Sch\u00f6nleber"}, {"url": "https://medium.com/@d.schoenleber/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "75 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F479c329bd713&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&user=David+Sch%C3%B6nleber&userId=479c329bd713&source=post_page-479c329bd713--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F88bccbb2f0b9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-short-introduction-to-model-selection-bb1bb9c73376&newsletterV3=479c329bd713&newsletterV3Id=88bccbb2f0b9&user=David+Sch%C3%B6nleber&userId=479c329bd713&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}