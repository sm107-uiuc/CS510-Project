{"url": "https://towardsdatascience.com/atrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed", "time": 1683006808.193161, "path": "towardsdatascience.com/atrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed/", "webpage": {"metadata": {"title": "Atrial fibrillation classification using machine learning | by Anan Methasate | Towards Data Science", "h1": "Atrial fibrillation classification using machine learning", "description": "Atrial fibrillation is the most common type of irregular heartbeat, occurring in 1\u20132% of the population (for elders, the number rise up to 5\u201315%) [1]. The cause of the disease generally comes from\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.bumrungrad.com/en/conditions/atrial-fibrillation?gclid=Cj0KCQjw17n1BRDEARIsAFDHFez2BVHK1ej-did7f1l4j4e0aFLc9cBYtddbwkcKBfQkDTvcB3XUO0YaAhlFEALw_wcB", "anchor_text": "[1]", "paragraph_index": 0}, {"url": "https://www.ncbi.nlm.nih.gov/pubmed/16253649", "anchor_text": "[2]", "paragraph_index": 0}, {"url": "https://www.stopafib.org/progresses.cfm", "anchor_text": "[3]", "paragraph_index": 1}, {"url": "https://physionet.org/", "anchor_text": "PhysioNet", "paragraph_index": 4}, {"url": "https://doi.org/10.1016/S0140-6736(19)31721-0", "anchor_text": "\u2018An artificial intelligence-enabled ECG algorithm for the identification of patients with atrial fibrillation during sinus rhythm: a retrospective analysis of outcome prediction [4]\u2019", "paragraph_index": 7}], "all_paragraphs": ["Atrial fibrillation is the most common type of irregular heartbeat, occurring in 1\u20132% of the population (for elders, the number rise up to 5\u201315%) [1]. The cause of the disease generally comes from side effects of other diseases such as heart attack, or high blood pressure. Symptoms include chest pain, palpitations, shortness of breath, and fatigue, and in fatal cases even causing strokes. For those who have AF but with no apparent symptoms yet, will be called as silent AF or asymptomatic AF [2].", "After positive AF diagnosis, there are generally 4-5 stages in AF which are categorized by the length and severity of the disease, classified by the 2014 AHA/ACC/HRS Guidelines for the Management of Patients with Atrial Fibrillation [3]. As I\u2019m not a physiologist, I won\u2019t be diving into details but the stages that I am focusing on is called \u2018paroxysmal stage\u2019 which the symptoms are best described as:", "This stage is interesting because symptoms are usually hard to detect (even by humans), the signals are temporary, and failure of detection at an early stage could result in patient returning again at a much worse state. For most people, unless they experience aforementioned symptoms, they wouldn\u2019t come to the clinic which in some cases could be too late when the symptoms arrives. So if we were able to improve the screening process of silent AF using paroxysmal to find patterns in the data (since we don\u2019t have silent AF data), patients with silent AF would be diagnosed at a much faster stage before their health worsens.", "Also if patients wear a smart watch, the service could also be provided that could monitor the patient for a longer duration of time and have a better chance at detecting AF since the symptoms only appear for a short period.", "Most of the popular datasets in physiology can be found in PhysioNet. For this problem, I will be using the following datasets:", "Note that for the first 2 datasets, it did not contain any non-AF data, so I have added normal sinus rhythm dataset to represent normal people\u2019s ECG. Each datasets consist of many hrs of continuous recording of 2-lead ECG with sampling rate of 125 Hz (except for MIT-BIH AF which is 250 Hz and has to be downsampled to 125 Hz). To download the datasets, you need to install their program.", "After you finished installing, you will be able to use command such as rdsamp -r afdb/05091 -c -H -f 300 -t 330 -v -ps > samples.csv to download datasets from the website. I didn\u2019t use datasets from the most beginning because it mostly contained noisy data (possibly due to setting up equipment).", "I will try to implement using the similar methods and models as the paper named \u2018An artificial intelligence-enabled ECG algorithm for the identification of patients with atrial fibrillation during sinus rhythm: a retrospective analysis of outcome prediction [4]\u2019 by", "First, we observe that the authors\u2019 data and ours are completely different. The author\u2019s data has a lot more patients (~200,000) with each patient having multiple 10 seconds of 12-lead ECG recordings. But for PhysioNet\u2019s, it has very few patients (~50 people when combined together, assuming each datasets have different patients) with each patient having a single recording with multiple hours of duration. For AF patients, the author used ECG recordings that were dated back to a month before being diagnosed as AF. Their hypothesis is that paroxysmal AF usually exhibits some earlier symptoms that humans are not able to detect, so they used data prior to the AF diagnosis but also not too far away.", "So I will split the long pieces of data into 10 seconds each and then will partition them into training set and testing set using ratio of 80:20. Sampling will be done in such a way that the class ratio are evenly balanced. In total there are 244,359 of 2 lead ECGs.", "For model architecture, the authors used CNN residual network or ResNet in which the signals of 10 seconds of all leads are inserted into the model, but we only have 2 leads ECG so some hyperparameters must be changed in order to be able to fit our data dimension.", "The model will first run convolution on the temporal axis and then followed by lead axis. This was done so that the model would be able to merge feature across each lead so that it could generalize better, and for the Conv2D to be able to run in both dimensions (like an image), I had to insert an extra dimension from (1250,2) to (1250,1,2).", "For training, I will use a learning rate of 1e-5 and use Tensorflow\u2019s learning rate decreasing callback to decrease learning rate until 1e-6. My batch size was 1024 and I used the test set as a validation set to monitor validation loss. (In reality, it should be train/val/test and test shouldn\u2019t be touched until final iteration but I was playing with it so I didn\u2019t care much about convention) In the end, I usually stop the training prematurely due to the fast overfitting.", "For the final model, I used the point at which it has the lowest validation loss. I hypothesize that each patient\u2019s ECG mostly contains repetitive data, and so further feature extraction should help prevent overfitting.", "After training for a while, I evaluated the results using ROC curve and this is what happened.", "For some reason, the model appeared to classify every data point correctly even with zero false positives. I was looking for the cause and later found out that there was a flaw with the method that I used during dataset partitioning. It turns out that you shouldn\u2019t mix the same patient\u2019s data into both train/test set because the model would be able to match a patient\u2019s ECG instead of finding useful features. Since our datasets have a small number of patients, it was not hard for the model to overfit every patient and just remember who has the disease! (Turns out that authors do not put the same patient into different sets so this problem did not occur.)", "So I\u2019ve tried to repartition the dataset by another method. I will divide patients into 2 groups and each patient will belong in only one set. I initially didn\u2019t want to divide patient\u2019s into 80: 20 because I believe that by splitting patient 50:50 I will be able to see better on how well the model would generalize with many ECG characteristics (as each patient has different ECG varies by heart rate, blood pressure, age, gender, etc). By using this method we can guarantee that for test set the model will never have seen the same person\u2019s ECG before.", "Seems that the model is able to distinguish AF better now. However, one should be careful that the ROC represents each piece of ECG data NOT each patient! In order to classify a patient, one must run the model through every piece of ECG and use some heuristics to determine whether the patient has the disease or not. I have not done this part yet, and it would be interesting to see which part of the long ECG did the model classified as AF or not. This requires further analysis. For the author, they used max and mean of the probability of every considered ECG for each patient to determine the likelihood.", "How do we determine which feature signify the AF disease while the other does not? In this semester, I have been learning many interesting subjects, one including ASR (Auto Speech Recognition). The field has been dealing with the problem of huge data for many decades so they have various methods of analyzing time-series data (such as audio) and extracting their useful features. One technique I will be using is to convert ECG into spectrogram. A spectrogram is the visualization of multiple slices of the spectrum (frequency domain) instead of the time domain. This should also give us a new perspective into examining the data.", "A spectrogram is created by moving sliding windows and perform FFT (Fast Fourier Transform) to each window frame. This would result in multiple spectrums for each time frame and this will later be stacked together into one heat map image. This will tell you information about frequency distribution in each time frame.", "Note that the work is not done yet and further study is required.", "Here are some random ECG that I turned it into a spectrogram.", "There are multiple patterns found in those ECGs. First, you will be able to see the repeating rhythm like the heartbeat. (It probably is heartbeat) The other pattern could be contributed from other factors, one hopefully including AF disease. Next, I will run each frame into T-SNE clustering algorithm to see how they are clustered in each setting. Below is a sample of my experiment logs.", "T-SNE embedding plot (above is lead-1 and below is lead-2 for every image)", "*0\u201362 is a chronological order of the spectrogram\u2019s time frame", "In summary, we can see that all of them have aligned in some linear orientation which make sense because the closer frames have similar characteristics. The next thing we should do is to look at each cluster and see what same characteristics do they commonly share, and how they differ to each different clusters. But that is for another chapter! My final goal is not only for the model to be able to classify each patient but to also highlight the parts or features where the model think that it is an important part which helped in its decision making. By doing that way, we would have a better understanding of how it came to the conclusion and also to further our understanding of paroxysmal AF symptoms. Thank you for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F11a3dd75b3ed&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@daianan?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@daianan?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Anan Methasate"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2939101c5ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&user=Anan+Methasate&userId=2939101c5ff5&source=post_page-2939101c5ff5----11a3dd75b3ed---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://www.bumrungrad.com/en/conditions/atrial-fibrillation?gclid=Cj0KCQjw17n1BRDEARIsAFDHFez2BVHK1ej-did7f1l4j4e0aFLc9cBYtddbwkcKBfQkDTvcB3XUO0YaAhlFEALw_wcB", "anchor_text": "[1]"}, {"url": "https://www.ncbi.nlm.nih.gov/pubmed/16253649", "anchor_text": "[2]"}, {"url": "https://www.stopafib.org/progresses.cfm", "anchor_text": "[3]"}, {"url": "https://physionet.org/", "anchor_text": "PhysioNet"}, {"url": "https://physionet.org/content/afdb/1.0.0/", "anchor_text": "MIT-BIH Atrial Fibrillation Database"}, {"url": "https://physionet.org/content/ltafdb/1.0.0/", "anchor_text": "Long-Term AF Database"}, {"url": "https://physionet.org/content/nsrdb/1.0.0/", "anchor_text": "MIT-BIH Normal Sinus Rhythm Database"}, {"url": "https://physionet.org/lightwave/?db=ltafdb/1.0.0", "anchor_text": "PhysioNet\u2019s website"}, {"url": "https://doi.org/10.1016/S0140-6736(19)31721-0", "anchor_text": "\u2018An artificial intelligence-enabled ECG algorithm for the identification of patients with atrial fibrillation during sinus rhythm: a retrospective analysis of outcome prediction [4]\u2019"}, {"url": "https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(19)31721-0/fulltext", "anchor_text": "(see original version)"}, {"url": "https://physionet.org/lightwave/?db=ltafdb/1.0.0", "anchor_text": "ref1"}, {"url": "https://en.wikipedia.org/wiki/Fast_Fourier_transform#/media/File:FFT_of_Cosine_Summation_Function.svg", "anchor_text": "ref2"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----11a3dd75b3ed---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----11a3dd75b3ed---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/physiology?source=post_page-----11a3dd75b3ed---------------physiology-----------------", "anchor_text": "Physiology"}, {"url": "https://medium.com/tag/medical?source=post_page-----11a3dd75b3ed---------------medical-----------------", "anchor_text": "Medical"}, {"url": "https://medium.com/tag/heart-disease?source=post_page-----11a3dd75b3ed---------------heart_disease-----------------", "anchor_text": "Heart Disease"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F11a3dd75b3ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&user=Anan+Methasate&userId=2939101c5ff5&source=-----11a3dd75b3ed---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F11a3dd75b3ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&user=Anan+Methasate&userId=2939101c5ff5&source=-----11a3dd75b3ed---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F11a3dd75b3ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----11a3dd75b3ed---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----11a3dd75b3ed--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@daianan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@daianan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anan Methasate"}, {"url": "https://medium.com/@daianan/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "56 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2939101c5ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&user=Anan+Methasate&userId=2939101c5ff5&source=post_page-2939101c5ff5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc4fc988a78a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fatrial-fibrillation-classification-using-machine-learning-11a3dd75b3ed&newsletterV3=2939101c5ff5&newsletterV3Id=c4fc988a78a1&user=Anan+Methasate&userId=2939101c5ff5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}