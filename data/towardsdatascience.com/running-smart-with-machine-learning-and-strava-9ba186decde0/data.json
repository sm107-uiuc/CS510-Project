{"url": "https://towardsdatascience.com/running-smart-with-machine-learning-and-strava-9ba186decde0", "time": 1683003136.18693, "path": "towardsdatascience.com/running-smart-with-machine-learning-and-strava-9ba186decde0/", "webpage": {"metadata": {"title": "Running Smart with Machine Learning and Strava | by Ryan Anderson | Towards Data Science", "h1": "Running Smart with Machine Learning and Strava", "description": "As a runner always looking to improve my Personal Bests (PBs), I often wonder how I can optimise my time spent running to achieve the best gains whilst being as lazy as possible. Sometimes I run\u2026"}, "outgoing_paragraph_urls": [{"url": "http://howeffectiveismyrunningplan.appspot.com/", "anchor_text": "simple website", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Jack_Daniels_(coach)", "anchor_text": "\u201cvdot,\u201d a constant and formula developed by legendary running coach Jack Daniels", "paragraph_index": 8}, {"url": "https://www.trainingpeaks.com/blog/the-science-of-the-performance-manager/", "anchor_text": "Impulse-Response model", "paragraph_index": 11}, {"url": "https://www.frontiersin.org/articles/10.3389/fphys.2015.00295/full", "anchor_text": "science has shown that our body makes the most efficient performance gains in the aerobic heart rate zone", "paragraph_index": 11}, {"url": "https://www.theguardian.com/sport/2015/dec/04/team-sky-chris-froome-cycling", "anchor_text": "Chris Froome\u2019s max heart rate is 161", "paragraph_index": 12}, {"url": "https://www.runnersworld.com/uk/training/motivation/a27718661/what-is-80-20-running/", "anchor_text": "general advice", "paragraph_index": 13}, {"url": "https://www.podiumrunner.com/a-smarter-way-to-increase-running-mileage_132282", "anchor_text": "how much to increase your mileage per week", "paragraph_index": 15}, {"url": "https://www.trainingpeaks.com/blog/what-is-the-performance-management-chart/", "anchor_text": "TrainingPeaks\u2019 performance manager", "paragraph_index": 17}, {"url": "https://www.google.com/search?q=heart+rate+data+inaccurate+garmin&oq=heart+rate+data+inaccurate+garmin", "anchor_text": "inaccurate daily heart rate data", "paragraph_index": 17}, {"url": "https://developers.strava.com/", "anchor_text": "API", "paragraph_index": 20}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP plot", "paragraph_index": 28}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP plot", "paragraph_index": 32}, {"url": "https://howeffectiveismyrunningplan.appspot.com/about", "anchor_text": "here", "paragraph_index": 35}], "all_paragraphs": ["As a runner always looking to improve my Personal Bests (PBs), I often wonder how I can optimise my time spent running to achieve the best gains whilst being as lazy as possible. Sometimes I run seven times a week, but don\u2019t improve my speeds over a few months. Other times, after weeks spent hiking, drinking and only running once or twice a week, I have run really good PBs. This goes against wisdom from running forums and training plans. Fortunately, I\u2019ve recorded my training for over five years on Strava, and so have many others. There must be a pattern in all this data.", "So I built a service to pull data from Strava, the athlete\u2019s social network, with the permission of other athletes. A machine learning algorithm determines, from all athletes\u2019 data, which factors are most important to improve their running. From this algorithm, it is possible to give athletes an ordered list of training improvements they can make in order to get faster.", "The problem is not an easy one to solve, and the solution not easy to explain in short, as the overlap between running coaches and machine learning engineers is probably fairly small. For that reason, I\u2019ve put a summary section at the top, and kept each technical section fairly self-contained for those looking into the details. I have explained the entire process, from start to finish, including productionising the \u2018product.\u2019", "After obtaining data from multiple runners, I built two models:", "The entire system is now available in a simple website [update: I have taken the website down as the system ran through my hosting budget very quickly], where athletes can sign up and gain insights into their training plan.", "A prototype visualisation for the system output from the first model is shown below. Here, the blue markers show how the athlete trains, relative to the top 10% and bottom 10% of athletes. The list is ordered in order of the most important factors in that athlete\u2019s training, a product of the importance of each factor and the athlete\u2019s shortcoming in it.", "Here, it is quite obvious that the athlete needs to run more times per week, and more distance. While doing this, they should spend a lot more time in heart rate zone 2. However, there are some things that they did really well even relative to the best athletes. For instance, for the three months before their PB, they reduced their time spent on non-run activities as they focused harder on running, and they increased the proportion of long runs.", "From here on, things get more technical:", "The problem I\u2019m solving for here is for distance running: between 5km and 42km. While these are still very different races, the dynamic is similar to the extent that there is a formula and constant variable governing the mapping between an athlete\u2019s speed in any distance in this range. Assuming I regularly run fast (tempo or threshold) runs and long runs around 25km to 30km, it is fairly simple to extrapolate my marathon time from my 5k time. This is done through \u201cvdot,\u201d a constant and formula developed by legendary running coach Jack Daniels. Throughout my model, the assumption is that vdot is an accurate representation of your overall running fitness and that we are dealing with fitness in the 5\u201342km distance range.", "However, vdot is not a perfect synonym of fitness, so much as it is a measure of speed. For a holistic measure of fitness, one would have to look at OBLA, V02max, muscle efficiency, and muscle power output versus foot stroke duration. We can\u2019t measure those with wrist watch data. But we can measure what helps people improve the end goal \u2014 speed.", "Most runners use Strava, a social network for athletes, to upload their data, which is where I am acquiring data from. Strava DOES estimate your fitness (vdot or their own measure) in their own models, but doesn\u2019t make this available through their API. For that reason, the model I built can only extrapolate your fitness when you run a Personal Best (PB), which Strava does make available as \u201cEstimated best efforts.\u201d There were options available, such as estimating fitness from your relation between heart rate and speed, but this would have added too much noise in the model for a Minimum Viable Product (MVP).", "To achieve these best efforts, it is generally accepted that you have to follow a finely-tuned balance between training hard and recovering, as well as keeping your machine oiled through lots of easy runs. The former is defined by what trainingpeaks calls the Impulse-Response model \u2014 you put your body under stress, and it responds to this stress by getting stronger. The latter is simply because science has shown that our body makes the most efficient performance gains in the aerobic heart rate zone, which corresponds to a relatively easy running pace in \u201cZone 2\u201d.", "Which brings us to heart rate zones: Coaches and athletes have simplified things for us by defining, based on each athlete\u2019s maximum heart rate, a set of zones or ranges that give us target regions to train in based on our heart rate data. These zones range from Z1 to Z5, from minimum to maximum effort. Many professional athletes train entirely by heart rate zone, rather than by pace, because our hearts are the best indicator of our body\u2019s response to training. The image below gives an indication of zones. Please note that it is relatively bad practice to estimate your heart rate zones based on your age, as this varies greatly based on genetics, rather than fitness. For instance, Chris Froome\u2019s max heart rate is 161, and should be 186 based on this model. Fortunately, Strava does not make this assumption, but determines this over time.", "We are capable of spending less time training in higher heart rate zones, but benefit greatly from a bit of time in the higher zones. Different coaches see it differently, general advice is to spend 80% of your time in the \u201ceasy\u201d zones Z1-Z3 and 20% in the \u201chard\u201d zones, Z4 and Z5. However, this also differs depending on whether you are early into your training season, preparing to \u201cpeak\u201d for a race, or \u201ctapering\u201d your efforts to be rested for a race.", "To manage your time these zones, and further simplify training, coaches advise several types of runs:", "And if that isn\u2019t enough, there also exists science on how much to increase your mileage per week, a macro-type impulse response model, where your body slowly adapts to more efforts, hence becoming fitter. The price to pay for increasing this too much is of course injury or burnout.", "Given all of the above, for each athlete, there exists an optimal but fucking difficult to find balance of training between", "Without great knowledge of yourself or a coach, it is hard to find this balance, even as a seasoned runner. There are tools available, such as TrainingPeaks\u2019 performance manager and Strava\u2019s premium offering. They are great, especially in how they tell you that you are training too hard and need to rest. However, I find that they all focus on trying to estimate what your current training load is, hence relying on a lot of inaccurate daily heart rate data. I needed something to advise me what I could do differently over a period of months, as opposed to on a day to day basis.", "So, as a runner, I built this analysis as a supplementary tool: to tell me what I could do differently over longer periods of months, relative to other athletes.", "There are several parts to a system like this, that needs to harvest data, train a model, run the model, and produce insights to users in the front end. One could see them as a system interacting as follows, with green lines indicating synchronous flows and orange lines representing asynchronous flows, due to the time required for API access or processing:", "Strava has heavy limitations on their API usage. It cannot be queried without an athlete\u2019s permission, and then is rate limited to allow more or less only 10 runners\u2019 data to be pulled per day. This slows down data harvesting.", "Amongst other things, the Strava API provides, per athlete:", "20 of my friends were kind enough to provide me with all of their data, via Strava. Given that they had an average of 10 PBs in their data each, this provided almost 200 inputs to my models, enough to build an accurate model to estimate vdot, but not enough to build a model to estimate improvement in vdot \u2014 a problem that I will explain later.", "All the above features are stored in the database per PB, per athlete. They are all used to train the final machine learning models. It is important to note that pace is NOT a feature, as this would be quite silly to use to predict, well.. pace.", "This section will be rather underwhelming for machine learning experts. Based on features chosen, the best performing model was a decision tree, closely followed by a vanilla XGBoost. Tweaking these models showed little gains relative to improving the data with some feature engineering, such as extrapolating heart rate from pace where heart rate data wasn\u2019t present.", "Intuitively, and based on model performance, the problem is near-linear.", "The model is split into two, as mentioned very early on in the article:", "The features of each (based on my small dataset of n=200) are below. I will update this as the database grows:", "Here, we have a fairly healthy SHAP plot. Health of this plot in a simple system is usually indicated by a clear separation between red and blue dots.", "Keep in mind that these features are deemed as important for a non-linear model: a random forest regression algorithm, so we can\u2019t read this as a checklist of important features for runners. I would take some features like \u201cr_proportion_yoga\u201d with a pinch of salt. For instance, the model might have determined that if the athlete doesn\u2019t do much easy running, then their time spent doing yoga is exceptionally important. But since the R\u00b2 of this model is fairly good, and given that we have an almost linear problem, it is safe to look at the features this way, or alternatively run a linear XGBoost feature analysis.", "There are several fairly safe conclusions we can make about how fast runners behave before their PBs:", "As a quick recap, rather than looking at what fit athletes do, I trained a model on what athletes, in general, did to improve the most in terms of vdot. This could be an exceptionally powerful analysis with enough data, as it would bring correlation out of the equation. We would see what the average Joe did to get better.", "Here, we the SHAP plot is not as healthy. There are many outlying features with high impact on the model.", "The best R\u00b2 for this model was 0.5. Therefore, with the current dataset size, even for the most explicable athlete performance, it only explains up to 50% of the factors involved in getting faster.", "Equally importantly, this model is less linear than the model predicting purely vdot. Some athletes might run PBs by being new to the sport, so the model may decide \u201cThose who run less than 30km per week on average need to have run more than usual to achieve their PB, but those who run more than 120km per week need to run relatively less but run faster.\u201d However, let\u2019s take a look at what an intentional selection of the features say:", "So how does this come in useful for an individual? With the above models, it is possible to compare a particular athlete\u2019s training to the ideal. This is shown below, with an explanation on reading the diagram here.", "The features are ordered by potential gain: the power of the feature in the model, multiplied by how relatively bad your training was in that aspect. Apart from the obvious \u201crun more\u201d and \u201crun more often,\u201d this model clearly instructs the athlete to \u201crun more in heart rate Z2,\u201d \u201crun more hills\u201d and \u201cswim less.\u201d", "Productionising at this small scale was fairly straightforward, and I went with an entirely Google Cloud setup. The result is that everything is blazing fast, apart from the Strava API queries which are rate limited at around 1 per second.", "There are many improvements that can be made, especially to the visualisations an explanations thereof. However, first, I would like to acquire more data in order to build a better model explaining what it takes to get faster. This more causal model will be infinitely more useful to individual athletes.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | MBA \u2014 I work as a Data Scientist in a big tech firm. My passion is to use DS/ML/AI/IA to help us be better humans. ryanandersonDS@gmail.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9ba186decde0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ryan-anderson-ds.medium.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": ""}, {"url": "https://ryan-anderson-ds.medium.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Ryan Anderson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb42bc4aaecb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&user=Ryan+Anderson&userId=b42bc4aaecb9&source=post_page-b42bc4aaecb9----9ba186decde0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://howeffectiveismyrunningplan.appspot.com/", "anchor_text": "simple website"}, {"url": "https://en.wikipedia.org/wiki/Jack_Daniels_(coach)", "anchor_text": "\u201cvdot,\u201d a constant and formula developed by legendary running coach Jack Daniels"}, {"url": "https://www.trainingpeaks.com/blog/the-science-of-the-performance-manager/", "anchor_text": "Impulse-Response model"}, {"url": "https://www.frontiersin.org/articles/10.3389/fphys.2015.00295/full", "anchor_text": "science has shown that our body makes the most efficient performance gains in the aerobic heart rate zone"}, {"url": "https://www.theguardian.com/sport/2015/dec/04/team-sky-chris-froome-cycling", "anchor_text": "Chris Froome\u2019s max heart rate is 161"}, {"url": "https://www.runnersworld.com/uk/training/motivation/a27718661/what-is-80-20-running/", "anchor_text": "general advice"}, {"url": "https://www.podiumrunner.com/a-smarter-way-to-increase-running-mileage_132282", "anchor_text": "how much to increase your mileage per week"}, {"url": "https://www.trainingpeaks.com/blog/what-is-the-performance-management-chart/", "anchor_text": "TrainingPeaks\u2019 performance manager"}, {"url": "https://www.google.com/search?q=heart+rate+data+inaccurate+garmin&oq=heart+rate+data+inaccurate+garmin", "anchor_text": "inaccurate daily heart rate data"}, {"url": "https://developers.strava.com/", "anchor_text": "API"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP plot"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP plot"}, {"url": "https://howeffectiveismyrunningplan.appspot.com/about", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9ba186decde0---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/running?source=post_page-----9ba186decde0---------------running-----------------", "anchor_text": "Running"}, {"url": "https://medium.com/tag/data-science?source=post_page-----9ba186decde0---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&user=Ryan+Anderson&userId=b42bc4aaecb9&source=-----9ba186decde0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&user=Ryan+Anderson&userId=b42bc4aaecb9&source=-----9ba186decde0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9ba186decde0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9ba186decde0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9ba186decde0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9ba186decde0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9ba186decde0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9ba186decde0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9ba186decde0--------------------------------", "anchor_text": ""}, {"url": "https://ryan-anderson-ds.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ryan-anderson-ds.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ryan Anderson"}, {"url": "https://ryan-anderson-ds.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "216 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb42bc4aaecb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&user=Ryan+Anderson&userId=b42bc4aaecb9&source=post_page-b42bc4aaecb9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdd88ecb78fe1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frunning-smart-with-machine-learning-and-strava-9ba186decde0&newsletterV3=b42bc4aaecb9&newsletterV3Id=dd88ecb78fe1&user=Ryan+Anderson&userId=b42bc4aaecb9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}