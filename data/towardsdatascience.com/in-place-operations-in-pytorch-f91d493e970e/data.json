{"url": "https://towardsdatascience.com/in-place-operations-in-pytorch-f91d493e970e", "time": 1682997097.2866611, "path": "towardsdatascience.com/in-place-operations-in-pytorch-f91d493e970e/", "webpage": {"metadata": {"title": "In-place Operations in PyTorch. What are they and why avoid them | by Alexandra Deis | Towards Data Science", "h1": "In-place Operations in PyTorch", "description": "Today\u2019s advanced deep neural networks have millions of trainable parameters (for example, see the comparison in this paper) and trying to train them on free GPU\u2019s like Kaggle or Google Colab often\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "this paper", "paragraph_index": 0}, {"url": "https://www.tutorialspoint.com/inplace-operator-in-python", "anchor_text": "this Python tutorial", "paragraph_index": 3}, {"url": "https://pytorch.org/docs/stable/nn.html#relu", "anchor_text": "out-of-place ReLU and in-place ReLU from PyTorch", "paragraph_index": 5}, {"url": "https://pytorch.org/docs/stable/notes/autograd.html#in-place-operations-with-autograd", "anchor_text": "the official PyTorch autograd documentation", "paragraph_index": 11}, {"url": "https://arxiv.org/pdf/1606.08415.pdf", "anchor_text": "SiLU", "paragraph_index": 17}, {"url": "https://en.wikipedia.org/wiki/Sigmoid_function", "anchor_text": "sigmoid", "paragraph_index": 18}, {"url": "https://www.linkedin.com/in/aleksandra-deis-0912/", "anchor_text": "https://www.linkedin.com/in/aleksandra-deis-0912/", "paragraph_index": 22}], "all_paragraphs": ["Today\u2019s advanced deep neural networks have millions of trainable parameters (for example, see the comparison in this paper) and trying to train them on free GPU\u2019s like Kaggle or Google Colab often leads to running out of memory on GPU. There are several simple ways to reduce the GPU memory occupied by the model, for example:", "Using in-place operations in neural networks may help to avoid the downsides of approaches mentioned above while saving some GPU memory. However, it is not recommended to use in-place operations for several reasons.", "In this article I would like to:", "\u201cIn-place operation is an operation that directly changes the content of a given linear algebra, vector, matrices (Tensor) without making a copy.\u201d \u2014 The definition is taken from this Python tutorial.", "According to the definition, in-place operations don\u2019t make a copy of the input. That is why they can help to reduce memory usage when operating with high-dimensional data.", "I want to demonstrate how in-place operations help to consume less GPU memory. To do this, I am going to measure allocated memory for both out-of-place ReLU and in-place ReLU from PyTorch, with this simple function:", "Call the function to measure the allocated memory for the out-of-place ReLU:", "I receive the output like this:", "Then call the in-place ReLU as follows:", "The output I receive is like:", "Looks like using in-place operations helps us to save some GPU memory. However, we should be extremely cautious when using in-place operations and check twice. In the next section, I am going to tell you why.", "The major downside of in-place operations is the fact that they might overwrite values required to compute gradients, which means breaking the training procedure of the model. That is what the official PyTorch autograd documentation says:", "Supporting in-place operations in autograd is a hard matter, and we discourage their use in most cases. Autograd\u2019s aggressive buffer freeing and reuse makes it very efficient and there are very few occasions when in-place operations actually lower memory usage by any significant amount. Unless you\u2019re operating under heavy memory pressure, you might never need to use them.", "There are two main reasons that limit the applicability of in-place operations:", "1. In-place operations can potentially overwrite values required to compute gradients.", "2. Every in-place operation actually requires the implementation to rewrite the computational graph. Out-of-place versions simply allocate new objects and keep references to the old graph, while in-place operations, require changing the creator of all inputs to the Function representing this operation.", "The other reason for being careful with in-place operations is that their implementation is exceptionally tricky. That is why I would recommend using PyTorch standard in-place operations (like in-place ReLU above) instead of implementing one manually.", "Let\u2019s see an example of SiLU (or Swish-1) activation function. This is the out-of-place implementation of SiLU:", "Let\u2019s try to implement in-place SiLU using torch.sigmoid_ in-place function:", "The code above incorrectly implements the in-place SiLU. We can make sure of that bu merely comparing the values returned by both functions. Actually, the function silu_inplace_1 returns sigmoid(input) * sigmoid(input)! The working example of the in-place implementation of SiLU using torch.sigmoid_ would be:", "This small example demonstrates why we should be cautious and check twice when using in-place operations.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A business analyst turned data scientist passionate about solving business problems with data. Connect me: https://www.linkedin.com/in/aleksandra-deis-0912/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff91d493e970e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f91d493e970e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@astakhova.aleksandra?source=post_page-----f91d493e970e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@astakhova.aleksandra?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Alexandra Deis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9f0981e41a86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&user=Alexandra+Deis&userId=9f0981e41a86&source=post_page-9f0981e41a86----f91d493e970e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@fancycrave?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Fancycrave.com"}, {"url": "https://www.pexels.com/photo/green-ram-card-collection-825262/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "this paper"}, {"url": "https://arxiv.org/pdf/1608.06993.pdf", "anchor_text": "DenseNet-121 over DenseNet-169"}, {"url": "https://www.tutorialspoint.com/inplace-operator-in-python", "anchor_text": "this Python tutorial"}, {"url": "https://pytorch.org/docs/stable/nn.html#relu", "anchor_text": "out-of-place ReLU and in-place ReLU from PyTorch"}, {"url": "https://pytorch.org/docs/stable/notes/autograd.html#in-place-operations-with-autograd", "anchor_text": "the official PyTorch autograd documentation"}, {"url": "https://arxiv.org/pdf/1606.08415.pdf", "anchor_text": "SiLU"}, {"url": "https://en.wikipedia.org/wiki/Sigmoid_function", "anchor_text": "sigmoid"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f91d493e970e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----f91d493e970e---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----f91d493e970e---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&user=Alexandra+Deis&userId=9f0981e41a86&source=-----f91d493e970e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&user=Alexandra+Deis&userId=9f0981e41a86&source=-----f91d493e970e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff91d493e970e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f91d493e970e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f91d493e970e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f91d493e970e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f91d493e970e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f91d493e970e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f91d493e970e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@astakhova.aleksandra?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@astakhova.aleksandra?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alexandra Deis"}, {"url": "https://medium.com/@astakhova.aleksandra/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "131 Followers"}, {"url": "https://www.linkedin.com/in/aleksandra-deis-0912/", "anchor_text": "https://www.linkedin.com/in/aleksandra-deis-0912/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9f0981e41a86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&user=Alexandra+Deis&userId=9f0981e41a86&source=post_page-9f0981e41a86--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2500290b436e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-place-operations-in-pytorch-f91d493e970e&newsletterV3=9f0981e41a86&newsletterV3Id=2500290b436e&user=Alexandra+Deis&userId=9f0981e41a86&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}