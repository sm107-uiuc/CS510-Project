{"url": "https://towardsdatascience.com/can-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4", "time": 1683013230.640165, "path": "towardsdatascience.com/can-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4/", "webpage": {"metadata": {"title": "Can a Machine Learning Model Read Stock Charts and Predict Prices? | by Viraf | Towards Data Science", "h1": "Can a Machine Learning Model Read Stock Charts and Predict Prices?", "description": "Stocks and Machine Learning - a combination you cannot resist. What if your ML model could literally read the price charts like a human? Using yfinance in python, and CNN models in TensorFlow Keras, let's look at a very innovative approach to predict stock prices!"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 0}, {"url": "https://www.investopedia.com/trading/candlestick-charting-what-is-it/", "anchor_text": "candlestick charts", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/how-not-to-predict-stock-prices-with-lstms-a51f564ccbca", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://pypi.org/project/yfinance/", "anchor_text": "yfinance", "paragraph_index": 8}, {"url": "https://sg.finance.yahoo.com/", "anchor_text": "yahoo finance", "paragraph_index": 8}, {"url": "https://github.com/virafpatrawala/StocksPredict-ImageCNN", "anchor_text": "GitHub repository", "paragraph_index": 31}], "all_paragraphs": ["Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Most of the ML models out there are trying to predict stock prices (or the changes in stock prices) using historical price data and other technical indicators \u2014 i.e., NUMERIC INPUTS. But, I asked myself, why can\u2019t an ML model replicate precisely how a human trades in the stock markets?", "Any average person would open up the stock price charts (candlestick charts), and try to find some patterns in the price data. Maybe next, apply some technical indicators, peek a look at the company fundamentals, and finally make a decision on the next movement of the stock price as a combined output of all the charted and numeric inputs. What if an ML model could also make these conclusions from visual information?", "So let\u2019s pass the price history time series as visual information to a CNN model as input. Will the model recognize the patterns in the visual data like a human does? Will this model perform better than a model that takes numeric data as input? Well, let\u2019s find out!", "Before we start, in my last article, we explore why using LSTMs blindly to predict stock prices is going to land you in trouble. You can read that here. Already read that? Good, now we can proceed.", "And next, a disclaimer. None of this is financial advice, nor should you implement it directly in practice. Consider this as an experiment and nothing more. Cool, now this aside, we can get on with our experimenting!", "Instead of predicting stock prices, we shall predict the direction of price movement for the next day, i.e., whether the stock price will go up or down or sideways. Let\u2019s get started!", "The flow of this article is as follows:", "There are multiple options to get access to historical stock prices in python, but one of the most straightforward libraries is yfinance. Quite convenient and free, it gets the job done by scraping data from yahoo finance.", "For this article, I will take up the stock prices of \u2018Reliance,\u2019 the largest corporation in the Indian stock markets, but feel free to try this out for any other instrument as well.", "The following piece of code downloads stock price data for Reliance a period of around 18 years (I am intentionally avoiding the COVID period) with a resolution of 1 day and stores it in a pandas dataframe. You can vary these parameters as you deem fit for your experiments.", "Printing out the head of the pandas dataframe, you can see the various parameters like \u2018Open\u2019, \u2018Close\u2019, \u2018High\u2019, \u2018Low\u2019, \u2018Volume\u2019 available for the stock data.", "Plotting out the \u2018Close\u2019 price to visualize the data, see how nicely the stock has risen in the last few years.", "Now we shall add some additional features to our data. First, calculate the percentage change from the previous day close. Next based this change, generate a signal which is:", "Now, this is completely arbitrary, you can vary it as you please. You can break the change into an even more/lesser number of parts (adjust the last layer of the model accordingly).", "Now, this step is very important, since it will decide what the model sees. For this article, I want to keep the images as close as possible to the candlestick charts a human trader sees. A constraint is that every input image has to be of the same dimensions and must contain sufficient information for the model to make conclusions from.", "We shall have a lookback period, for example, the past 50 days (10 trading weeks), which shall be represented. For simplicity, for each of these 50 days, the open and close, and the direction of the price movement will be encoded.", "Since images of the same dimension will be fed to the neural network, it might not understand where this image stands in the entirety of the 15 years. For example, in 2002, the prices are at ~80\u201390 whereas they slowly rise with time to ~1800. Although price patterns may (or may not) be independent of the absolute stock prices, I wanted to encode some of this information as well in the images. So, to give the image some context to the past prices and their absolute price levels, the 50-day price representations will be scaled in a bigger time window which considers additional previous price values.", "The code for generating this visual representation is:", "Note: This is a visual representation very close to what we see on the candlestick charts (that was the whole point). However, you can use your imagination (and some discretion) to create a completely different visual representation with other encoded parameters as well. Because the way a CNN model sees and learns from an image might (or might not) be very different from how we do!", "Next, let\u2019s create a data generator that will iterate through the 15 years of data and create pairs of images and the corresponding next-day-predictions.", "This data generates image-prediction batches like", "Since we have inputs as images and require outputs as one of three classes (up, down, no movement), our model will have a few convolutional layers, followed by a few dense layers and finally a softmax function.", "Let\u2019s initiate the generator objects and start the training.", "Post-training, the losses can be plotted as:", "Let\u2019s now see the accuracy on the test data.", "Well, given 5 possible outcomes, the accuracy of randomly guessing one would be 0.2. So this model seems to have performed quite well comparatively. Or has it?", "Plotting out the predicted outputs, it\u2019s clear what has happened. The model has not learned anything useful yet, so it ends up predicting \u201c2\u201d as every output resulting in relatively high accuracy.", "Let\u2019s train the model some more then. But now, the validation loss increases greatly. Plus, testing gives an accuracy of less than 0.3. Not very encouraging, the model has probably overfitted on the training data. A very clear reason for this is the small size of training data compared to the model size.", "Although the performance was not extremely encouraging, this was quite an innovative approach of looking at the age-old problem of predicting stock prices. A few more ideas on these lines are giving multi-timeframe inputs (say, weekly data as inputs as well), or additionally providing technical indicators as numeric data (in parallel with visual charts), or transform the price data into other visual domains (doesn\u2019t have to be the charts as we see them), etc. What else do you think we can do to improve this model? Do you have any other interesting ideas?", "After trying out all these ideas, the question remains \u2014 is feeding visual data providing any edge that numeric data cannot? What do you think?", "You can find the entire code in my GitHub repository.", "Finally, I am not saying I am an expert in these fields \u2014 I am just putting forward my explorations on this topic, so feel free to point out my errors or add anything I missed. I would love to hear your feedback.", "Do you want to be rich overnight using ML in stocks? This article is (NOT) for you!", "Or check out some of my other machine learning articles. I\u2019m sure you\u2019ll find them useful\u2026", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffb73c551c7a4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@virafpatrawala?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@virafpatrawala?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Viraf"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F31356c339457&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&user=Viraf&userId=31356c339457&source=post_page-31356c339457----fb73c551c7a4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@agk42?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Alex Knight"}, {"url": "https://www.pexels.com/photo/high-angle-photo-of-robot-2599244/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://unsplash.com/@adamaszczos?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Adam Nowakowski"}, {"url": "https://unsplash.com/s/photos/stock-market?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://www.investopedia.com/trading/candlestick-charting-what-is-it/", "anchor_text": "candlestick charts"}, {"url": "https://towardsdatascience.com/how-not-to-predict-stock-prices-with-lstms-a51f564ccbca", "anchor_text": "here"}, {"url": "https://pypi.org/project/yfinance/", "anchor_text": "yfinance"}, {"url": "https://sg.finance.yahoo.com/", "anchor_text": "yahoo finance"}, {"url": "https://github.com/virafpatrawala/StocksPredict-ImageCNN", "anchor_text": "GitHub repository"}, {"url": "https://towardsdatascience.com/how-not-to-predict-stock-prices-with-lstms-a51f564ccbca", "anchor_text": "How (NOT) To Predict Stock Prices With LSTMsStocks and Machine Learning \u2014 a combination made in heaven. But are things as easy as they appear to be?towardsdatascience.com"}, {"url": "https://towardsdatascience.com/master-the-coco-dataset-for-semantic-image-segmentation-part-1-of-2-732712631047", "anchor_text": "Master the COCO Dataset for Semantic Image SegmentationExplore and manipulate the COCO image dataset for Semantic Image Segmentation with PyCoco, Tensorflow Keras Python\u2026towardsdatascience.com"}, {"url": "https://towardsdatascience.com/create-a-synthetic-image-dataset-the-what-the-why-and-the-how-f820e6b6f718", "anchor_text": "Create A Synthetic Image Dataset \u2014 The \u201cWhat\u201d, The \u201cWhy\u201d and The \u201cHow\u201dRunning short on images to train your model? Here\u2019s how to increase your dataset size multi-fold with synthetic images\u2026towardsdatascience.com"}, {"url": "https://medium.com/tag/stocks?source=post_page-----fb73c551c7a4---------------stocks-----------------", "anchor_text": "Stocks"}, {"url": "https://medium.com/tag/python?source=post_page-----fb73c551c7a4---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----fb73c551c7a4---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/coding?source=post_page-----fb73c551c7a4---------------coding-----------------", "anchor_text": "Coding"}, {"url": "https://medium.com/tag/money?source=post_page-----fb73c551c7a4---------------money-----------------", "anchor_text": "Money"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&user=Viraf&userId=31356c339457&source=-----fb73c551c7a4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&user=Viraf&userId=31356c339457&source=-----fb73c551c7a4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffb73c551c7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fb73c551c7a4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fb73c551c7a4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@virafpatrawala?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@virafpatrawala?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Viraf"}, {"url": "https://medium.com/@virafpatrawala/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "179 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F31356c339457&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&user=Viraf&userId=31356c339457&source=post_page-31356c339457--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4d42ab23ec8e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcan-an-ml-model-read-stock-charts-and-predict-prices-fb73c551c7a4&newsletterV3=31356c339457&newsletterV3Id=4d42ab23ec8e&user=Viraf&userId=31356c339457&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}