{"url": "https://towardsdatascience.com/build-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5", "time": 1682994998.1901162, "path": "towardsdatascience.com/build-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5/", "webpage": {"metadata": {"title": "Build an end-to-end Machine Learning Model with MLlib in pySpark. | by Nasir Safdari | Towards Data Science", "h1": "Build an end-to-end Machine Learning Model with MLlib in pySpark.", "description": "In-Memory computation and Parallel-Processing are some of the major reasons that Apache Spark has become very popular in the big data industry to deal with data products at large scale and perform\u2026"}, "outgoing_paragraph_urls": [{"url": "https://spark.apache.org/", "anchor_text": "Apache Spark", "paragraph_index": 0}, {"url": "https://www.kaggle.com/c/home-credit-default-risk", "anchor_text": "Home Credit Default Risk", "paragraph_index": 1}, {"url": "https://github.com/nxs5899/end-to-end-Machine-Learning-model-with-MLlib-in-pySpark", "anchor_text": "Github", "paragraph_index": 23}], "all_paragraphs": ["In-Memory computation and Parallel-Processing are some of the major reasons that Apache Spark has become very popular in the big data industry to deal with data products at large scale and perform faster analysis. built on top of Spark, MLlib is a scalable Machine Learning library that delivers both high-quality algorithms and blazing speed. having great APIs for Java, Python, and Scala, it makes a top choice for Data Analysts, Data Engineers, and Data Scientists. MLlib consists of common learning algorithms and utilities, including classification, regression, clustering, collaborative filtering (matrix factorization), dimensionality reduction and etc.", "In this article, we are going to build an end-to-end machine learning model using MLlib in pySpark. we are going to use a real world dataset from Home Credit Default Risk competition on kaggle. the objective of this competition was to identify if loan applicants are capable of repaying their loans based on the data that was collected from each applicant. the target variable is either 0 (applicants who were able to pay back their loans)or 1 (applicants who were NOT able to pay back their loans). it is a binary classification problem with a highly imbalanced target label. the distribution ratio is close to 0.91 to 0.09, with 0.91 being the ratio of the applicants who were able to pay back their loans and 0.09 being the ratio of the applicants who were not able to pay back their loans.", "Let\u2019s start by looking at the structure of our dataset:", "printSchema() only shows us the column names and its data type. we are going to drop the SK_ID_CURR column, rename the \u201cTARGET\u201d column to \u201clabel\u201d and see the distribution of our target variable:", "we can visualize the distribution of the labels with matplotlib:", "and here is how the data looks like in a Pandas dataframe format:", "now that we have some ideas about the general structure of our dataset, let\u2019s continue with some data wrangling. first we check how many Categorical and Numerical features do we have. next we build a function that outputs essential information about the missing values in our dataset:", "here is how we get the table for missing info:", "there are 67 columns out of 121 that has missing values in them. and it doesn't show all of them in the image, but overall, most of these 67 columns have more than 50 percent missing values. so we are dealing with a lot of missing values. we are going to fill the numerical missing values with the average of each column and the categorical missing values with the most frequent category of each column. but first, let\u2019s count the missing values in each column:", "we separate categorical and numerical columns with missing values:", "next we fill the missing values:", "now that we don\u2019t have missing values anymore in our dataset, let\u2019s work on how to deal with the imbalanced classes. there are different methods to mitigate this problem. one way is to under sample the majority class or over sample the minority class to make a more balanced results. another way is to assign weights for each class to penalize the majority class by assigning less weight and boost the minority class by assigning bigger weight. we are going to create a new column in the dataset named \u201cweights\u201d and assign the inverse ratio of each class as weights. here is how it\u2019s done:", "and here is how it looks after adding the weight column:", "the next step is Feature Engineering. pySpark has made it so easy that we do not need to do much for extracting features. here are the steps:", "now let\u2019s put everything into a pipeline. here we are performing a sequence of transformations so we do all of them at once using a pipeline:", "here is how our new dataset looks like after feature engineering:", "for training, we first split the dataset into training and testing sets. then we start training using Logistic Regression because it performs well for binary classification problems.", "we are going to plot the ROC curve for the training data to see how Logistic Regression performed and then we will use Area Under ROC curve, which is a standard metric for evaluating binary classification, as the metric to evaluate the models:", "checking model\u2019s performance on the testing set:", "0.711 is not a very bad result for Logistic Regression. next we try another model, Gradient Boosting Trees (GBT). it\u2019s a very popular classification and regression method that uses ensembles of decision trees.", "we were able to achieve a much better result, 0.732, using GBT. as a final strategy here, we will implement hyper-parameter tuning using grid search and after that we run cross validation to better improve the performance of GBT.", "the result was improved a little bit which means that we still can play around with hyper-parameter tuning to see if we can further improve the result.", "in this project, we built an End-to-End Machine Learning model (binary classification with imbalanced classes). and we showed the power of Apache Spark\u2019s MLlib and how it can be applied for end-to-end ML projects.", "like always, the code and jupyter notebook is available on my Github.", "Questions and Comments are highly appreciated.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Open Source is the solution\u2026 Software Engineer, Data Scientist and Machine Learning Researcher"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4917bdf289c5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nasir.ahmad.safdari?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasir.ahmad.safdari?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Nasir Safdari"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb875ac73beb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&user=Nasir+Safdari&userId=b875ac73beb&source=post_page-b875ac73beb----4917bdf289c5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://spark.apache.org/", "anchor_text": "Apache Spark"}, {"url": "https://www.kaggle.com/c/home-credit-default-risk", "anchor_text": "Home Credit Default Risk"}, {"url": "https://github.com/nxs5899/end-to-end-Machine-Learning-model-with-MLlib-in-pySpark", "anchor_text": "Github"}, {"url": "https://github.com/elsyifa/Classification-Pyspark", "anchor_text": "https://github.com/elsyifa/Classification-Pyspark"}, {"url": "https://spark.apache.org/docs/2.3.0/ml-classification-regression.html", "anchor_text": "https://spark.apache.org/docs/2.3.0/ml-classification-regression.html"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4917bdf289c5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----4917bdf289c5---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----4917bdf289c5---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/imbalanced-class?source=post_page-----4917bdf289c5---------------imbalanced_class-----------------", "anchor_text": "Imbalanced Class"}, {"url": "https://medium.com/tag/spark-mllib?source=post_page-----4917bdf289c5---------------spark_mllib-----------------", "anchor_text": "Spark Mllib"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&user=Nasir+Safdari&userId=b875ac73beb&source=-----4917bdf289c5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&user=Nasir+Safdari&userId=b875ac73beb&source=-----4917bdf289c5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4917bdf289c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4917bdf289c5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4917bdf289c5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4917bdf289c5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4917bdf289c5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasir.ahmad.safdari?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasir.ahmad.safdari?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nasir Safdari"}, {"url": "https://medium.com/@nasir.ahmad.safdari/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "305 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb875ac73beb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&user=Nasir+Safdari&userId=b875ac73beb&source=post_page-b875ac73beb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdde46cf682&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-an-end-to-end-machine-learning-model-with-mllib-in-pyspark-4917bdf289c5&newsletterV3=b875ac73beb&newsletterV3Id=dde46cf682&user=Nasir+Safdari&userId=b875ac73beb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}