{"url": "https://towardsdatascience.com/having-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd", "time": 1683010008.082447, "path": "towardsdatascience.com/having-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd/", "webpage": {"metadata": {"title": "Having issues with under-powered A/B tests? Try controlling your variability. | by Stas Sajin | Towards Data Science", "h1": "Having issues with under-powered A/B tests? Try controlling your variability.", "description": "In graduate school, I attended a session on reinforcement learning behavior, specifically on topics related to laboratory rats and experimentation. One thing that struck me about the results of the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf", "anchor_text": "Deng et. al (2013)", "paragraph_index": 10}], "all_paragraphs": ["In graduate school, I attended a session on reinforcement learning behavior, specifically on topics related to laboratory rats and experimentation. One thing that struck me about the results of the talks is that there was almost no variability in experimental conditions. The rats in these experiments were inbred to have identical genetic makeup, so any variability would be an anomaly caused by not controlling the environment correctly (e.g., exposing rats to a stimulus accidentally during transportation to the lab) or by the actual experimental treatment. Hence, given that the researchers had control over the genetic makeup and the environment in which the lab rats grew, they were able to carry out experiments where the concept of confidence intervals and error bars was meaningless. This is an extreme example of controlling your variability when running experiments, one that most of us can\u2019t afford in practice.", "If you take a basic statistics course, the topic of controlling variance is likely to show up several times. For example, you might learn that it is better to design a within-subjects rather than a between-subjects experiment. You might also learn that a lot of longitudinal studies that want to explore the effects of gene-environment interactions pay particular attention to twin studies. In more advanced classes you might learn about Linear Mixed Effect models and how to model some of the variance caused by random effects in your experiments, or how to model the hierarchical nature of the experimental designs when performing stratified sampling. All of these topics focus on the same problem: how to model and control your variability so that you can be sure that your study is able to detect a real effect when it is there.", "When doing power analyses, you\u2019ll quickly learn that the power of your experiment scales with the inverse of the square root of N subjects you have in the study, which means that it does not scale well at all! Because experiments involve testing conditions that might be worse than the status quo, it becomes very impractical to rely on group size as a parameter to increase your power. Instead, you have two other options in order to increase your power: 1) come up with better experiments that have larger effect sizes or 2) figure out a way to decrease the variance in your experiment without increasing the number of users. This post will focus on specific techniques related to the latter and will showcase how you could double the available traffic or even triple it for the purposes of running experiments.", "The most common option for controlling your variance is to specify the non-treatment effects as covariates in a linear model (If you\u2019re using LMM model variants, you can also specify these as random effects). For example, let\u2019s assume that I\u2019m trying to estimate how quickly users can complete their taxes. Moreover, let\u2019s assume that we have two application formats, and we think that the new format we developed is better than the old one. When we design our experiments, we randomly assign our users to two groups: new vs old. Moreover, let\u2019s assume that we collect for each user information about their income and that we expect individuals with higher income to take longer to file their taxes. This is how the structure of the data looks like:", "In our example, the application type is the treatment effect, minutes is the outcome, and income is a covariate that we were lucky enough to measure. Note that here we assume that all users who start the tax filing application, end up finishing it. If that is not the case, you would have to collect covariates that are present before the experimental assignment is performed. The general form of our equation then becomes like this:", "Let\u2019s assume that we have the following conditions:", "If we run a simple OLS only on the treatment effect, we get the following results (note that these results are identical to having a between-samples t-test).", "These results are from a single run, so they are not very informative. If we bootstrap our experiments, we should expect the shape of our effect to look like this:", "We can immediately notice that in a lot of our bootstrapped experiments, we failed to detect an effect when it is there. What happens when we add income as a covariate to the model? The figure below shows that having income as a covariate helped reduce the variance and thus increase the power of your experiment.", "Although this might be good news, in practice I find that linear models are very challenging to build correctly due to the many assumptions you are required to fulfill. For example, if your outcome data is not linear, the covariate might not reduce the variance uniformly across the range of the output variable. For example, the actual relationship between income and minutes that I modeled is not linear, but the formula specified in the OLS models does not know this. This will cause the variance in some places to be underestimated and in other places to be overestimated making it more challenging to draw relevant conclusions.", "Another option for controlling variance is described in a paper by Deng et. al (2013) and is referred to as CUPED. They borrow this idea from control covariate used in Monte Carlo simulations. In this method, we can notice the following relationship:", "Y_hat represents an unbiased estimator for E(Y). \u2212\u03b8E(X) + \u03b8E(X) should cancel each other out given an appropriate theta, because we assume that before experimental treatment the effect of a covariate between groups is the same. The equation basically says that this new control variate outcome has the same expected value as the actual outcome. Next, we compute the variance of the control variate.", "The variance equation allows us to see that the variance of this unbiased control variate will be minimized when \u03b8 is the following:", "All this can be codified in a few very simple lines of code:", "In our experimental setup, CUPED performs about the same as the linear covariate method. This method is very elegant though it is not entirely clear how it performs when you have multiple covariates. If we have multiple correlated covariates, we would have to generate a one-dimensional summary of those covariates, which might result in loss of information. Moreover, the assumption of linearity between the outcome and covariate still needs to be maintained.", "This technique is somewhat a continuation of Technique 1. This is not a technique I fully explored and seen elsewhere, so suggestions are welcome. You can notice that all we did so far is engage in an exercise of measuring variance using different methods and then performing an adjustment to the total variance. The natural question is why should we use parametric models to do that given that in the real world we have the following scenarios:", "We know that non-parametric models will be much better at reducing the bias in the data, so one technique I experimented with is replacing the OLS models with a RandomForest model. The only change I made to get unbiased predictions is to use out of bag scores from my model. See the code snippet below.", "The output of bootstrapped experiments can be found below:", "Using the random forest model to remove the variance caused by covariates does seem to work, though the effect is slightly smaller than other methods. My intuition suggests that this might be because OOB estimates contain a lot of variance because the sample size is very small (200 observations in total from two groups), so it is hard to build non-parametric models that generalize well in their OOB score.", "My experiment setup is a bit trivial since I picked a covariate that has a high correlation with the outcome. Because of that, we will see a lot of variance reduction. Specifically, I\u2019m seeing the following in variance reduction and subject requirements for power of 0.8 (I\u2019m using the average of bootstrapped variance for power calculations).", "In a data-driven organization, performing experiments in a way that minimizes traffic requirements is critical. Any of the methods I described above can be used to effectively double or triple the number of experiments that can be run while having the same amount of traffic. Nonetheless, each method does require knowing how your covariates behave with respect to the outcome of your experiment, and some methods might not work when the available experimental data is just too small and a model can\u2019t be used to correctly eliminate the variance.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F903748f0aefd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://stassajin.medium.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": ""}, {"url": "https://stassajin.medium.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Stas Sajin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd9a8a91ee988&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&user=Stas+Sajin&userId=d9a8a91ee988&source=post_page-d9a8a91ee988----903748f0aefd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf", "anchor_text": "Deng et. al (2013)"}, {"url": "https://medium.com/tag/ab-testing?source=post_page-----903748f0aefd---------------ab_testing-----------------", "anchor_text": "Ab Testing"}, {"url": "https://medium.com/tag/experiment?source=post_page-----903748f0aefd---------------experiment-----------------", "anchor_text": "Experiment"}, {"url": "https://medium.com/tag/data-science?source=post_page-----903748f0aefd---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----903748f0aefd---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&user=Stas+Sajin&userId=d9a8a91ee988&source=-----903748f0aefd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&user=Stas+Sajin&userId=d9a8a91ee988&source=-----903748f0aefd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F903748f0aefd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----903748f0aefd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----903748f0aefd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----903748f0aefd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----903748f0aefd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----903748f0aefd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----903748f0aefd--------------------------------", "anchor_text": ""}, {"url": "https://stassajin.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://stassajin.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stas Sajin"}, {"url": "https://stassajin.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "426 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd9a8a91ee988&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&user=Stas+Sajin&userId=d9a8a91ee988&source=post_page-d9a8a91ee988--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1599156ecda3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhaving-issues-with-under-powered-a-b-tests-try-controlling-your-variability-903748f0aefd&newsletterV3=d9a8a91ee988&newsletterV3Id=1599156ecda3&user=Stas+Sajin&userId=d9a8a91ee988&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}