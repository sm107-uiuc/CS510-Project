{"url": "https://towardsdatascience.com/personalised-restaurant-recommendations-using-funksvd-3beff200b01c", "time": 1683009784.6726348, "path": "towardsdatascience.com/personalised-restaurant-recommendations-using-funksvd-3beff200b01c/", "webpage": {"metadata": {"title": "Personalised restaurant recommendations using FunkSVD | by Paul Stubley | Towards Data Science", "h1": "Personalised restaurant recommendations using FunkSVD", "description": "Can I use machine learning to do better than just recommending the top restaurants in each city? I'm using FunkSVD to find out!"}, "outgoing_paragraph_urls": [{"url": "https://netflixprize.com/", "anchor_text": "awarded", "paragraph_index": 0}, {"url": "https://sifter.org/~simon/journal/20061211.html", "anchor_text": "Simon Funk", "paragraph_index": 0}, {"url": "https://www.kaggle.com/yelp-dataset/yelp-dataset?select=yelp_academic_dataset_business.json", "anchor_text": "Yelp data", "paragraph_index": 6}, {"url": "http://numba.pydata.org/", "anchor_text": "Numba", "paragraph_index": 30}, {"url": "https://www.linkedin.com/in/paul-stubley", "anchor_text": "LinkedIn", "paragraph_index": 31}, {"url": "https://github.com/paul-stubley/Udacity/tree/master/Capstone_Project", "anchor_text": "GitHub", "paragraph_index": 31}, {"url": "https://www.kaggle.com/yelp-dataset/yelp-dataset?select=yelp_academic_dataset_business.json", "anchor_text": "Yelp review data", "paragraph_index": 31}], "all_paragraphs": ["In September 2009, Netflix awarded a $1,000,000 prize to a team who had developed an algorithm that improved their rating-predictions by over 10%. Coming in 3rd place was an individual entry by Simon Funk \u2014 FunkSVD.", "In this post, I describe my attempt to use FunkSVD to recommend restaurants based on users\u2019 previews reviews.", "My goal\u2014 Can I provide more-personalised recommendations to users than simply always suggesting the top restaurants in a city?", "Recommendation engines are used extensively by companies around the world: AirBnB, Netflix & Spotify spring to mind as examples. The success of entire companies like these depend on their ability to make accurate and pertinent recommendations to their users (how often would you go back to Spotify if it kept recommending your least favourite type of music?)", "These recommendation engines often learn from user-input, for example, user-ratings, but a key issue in this field is:", "How do you predict ratings for every item, when a user has only rated a handful?", "To investigate this problem, I use Yelp data for restaurant reviews. Taking Toronto as an example, there are over a thousand restaurants, but the vast majority of Yelp users have rated fewer than 10 of them. How can we fill in the gaps \u2014 predicting all of their reviews so that we can recommend new restaurants which they will like? This is where FunkSVD comes in.", "FunkSVD (where SVD stands for Singular Value Decomposition), is a method to fill-in-the-gaps in a matrix of User-Item ratings. Consider the matrix of user ratings for different restaurants below (blue), the end goal is to fill in the unknown ratings with predictions, such that we can take the highest of those predictions as our recommendations. Another way to think about what\u2019s happening is with the following example:", "Most users who like Top Burgers also like Wings \u2018n\u2019 Things, but don\u2019t like La Parisienne.", "If we know Kate likes Top Burgers, she is more likely to also like Wings \u2019n\u2019 Things than La Parisienne.", "The way we do this is by introducing a set of intermediary entities know as latent-factors. To give these substance, we can think of them as properties of the restaurants which users may like or dislike \u2014 each latent factor is a new scale to rate the restaurant on. For example, a restaurant may be more or less costly, more or less likely to use white-tablecloths, etc. Each of these may have a bearing on a user\u2019s rating, and we want to understand two things:", "Given these pieces of information, we can reconstruct the full user-restaurant ratings matrix using matrix multiplication:", "So we have a plan of attack, calculate the values for each of the latent factors for each of the restaurants and users, then multiply the matrices to get predicted ratings for every user-restaurant pair. But how do we go about that?", "This is where the FunkSVD method comes into play. First off, we guess. We fill the two matrices with random numbers. Then one by one we go through our known ratings (in blue) and nudge the green and orange guesses up or down as necessary to be closer to the true number. We do this for every known rating, and iterate the process many times to approach a stable solution for the user and restaurant matrices. This is an example of gradient descent.", "Below we show one step of the iteration:", "We calculate the predicted rating (which for now won\u2019t be very good at all, as it\u2019s random).", "We nudge each value in the red-highlighted cells accordingly. The amount we nudge it is related to the gradient of the error \u2014 that is to say, we want to nudge it in the direction which minimises the difference between the prediction and the actual value.", "Once these six values are updated, the algorithm moves onto the next known rating, here Emily\u2019s rating of Wings \u2018n\u2019 Things and repeats the step above. The learning rate, \ud835\udefc, determines how quickly the algorithm heads down-hill, and is important to allow timely, yet controlled, convergence of the fitting.", "Once we have completed a full loop for each known rating, we repeat until a suitable fit to the training data has been achieved.", "Above, I suggested that the latent factors would be easily understandable properties of both the user and the restaurant. Unfortunately, this was an oversimplification. In reality, they may be a completely arbitrary concept that just happens to describe relationships between users and restaurants. The number of latent variables that the model uses is up to you, but too many latent variables will mean the model overfits to the training data, which will reduce the ability of the model to predict on unseen data.", "To quantify how well the model is performing I split the review data into train and test subsets. For ratings data such as this, it\u2019s important that split is done with time-ordered data (so that the model doesn\u2019t end up predicting past-ratings having already learnt from the future). To achieve this, reviews from 2014\u20132018 are used as the training set, while 2019 is used as the test set.", "Below I plot the confusion matrix of predicted values vs actual values, as well as their distributions for a representative fit of the model (a perfect model would show a confusion matrix with only diagonal entries).", "The key score-metric used is Sum of Square Errors (SSE) between the predictions and actuals for 2019. To calculate this, for all predictions with an associated actual value (i.e. a user-restaurant pair with a review in 2019) we calculate the square of the difference between the prediction and the actual. The sum of these values is our SSE.", "This metric works well to compare different versions of the model to each other, but is really only a relative measure. What we really want to know is \u2014 how good does the model need to be so that it\u2019s useful?", "To answer this, I compared the SSE from the model with the SSE calculated from simply recommending each user the top restaurants in the city (or more precisely, each user\u2019s predicted rating for a restaurant was simply that restaurants average historic rating, with no user-restaurant interactions considered).", "After the model was optimised a little, by adjusting the number of latent-factors, the learning rate and the number of iterations, I arrived at a model which did slightly better than naively suggesting top reviews restaurants for every user (with a SSE 4% lower).", "The output of the recommender is a map of the recommender restaurants with the predicted rating for each and a link to a google search as the tooltip. You can see an example recommendation by running the code pen below.", "For users who haven\u2019t made a sufficient number of reviews to benefit from the FunkSVD method, the recommender falls-back on recommending the top restaurants in the city. It also allows an end-user to enter a certain restaurant and receive recommendations for similar restaurants (defined by similar ratings from similar users).", "This initial foray into FunkSVD for restaurant recommendations has shown that without too much optimisation, it is possible to predict ratings which are better than the naive approach of predicting the average for each restaurant.", "For further functionality, it would be useful to allow the end-user to filter results by other contextual factors (thus building in knowledge-based methods too). Two obvious such factors are the restaurant\u2019s location (\u201cFind me restaurants I\u2019ll like within 2 miles\u201d) and cuisine (\u201cFind me Chinese restaurants I\u2019ll like\u201d).", "One final shout-out goes to Numba, by using this python library, with limited changes to my existing functions, I was able to increase the execution speed of the model fitting by a factor of over 400! If you have any functions/loops that you are running which use mainly numpy core functions, check it out and see how much it could speed up your code too.", "If you would like to contact me, you can do so on LinkedIn. If you\u2019d like to see the code and analysis, check it out on GitHub. The data used was the Yelp review data.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data and Decision Scientist, PhD, seeking next opportunity in Vancouver, BC"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3beff200b01c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3beff200b01c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@paulgstubley?source=post_page-----3beff200b01c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@paulgstubley?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Paul Stubley"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Feac5ae7ecac5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&user=Paul+Stubley&userId=eac5ae7ecac5&source=post_page-eac5ae7ecac5----3beff200b01c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/wiki/File:Toronto_Skyline_May_2013.jpg", "anchor_text": "Wikimedia Commons"}, {"url": "https://netflixprize.com/", "anchor_text": "awarded"}, {"url": "https://sifter.org/~simon/journal/20061211.html", "anchor_text": "Simon Funk"}, {"url": "https://www.yelp.co.uk/toronto", "anchor_text": "Yelp"}, {"url": "https://www.kaggle.com/yelp-dataset/yelp-dataset?select=yelp_academic_dataset_business.json", "anchor_text": "Yelp data"}, {"url": "http://numba.pydata.org/", "anchor_text": "Numba"}, {"url": "https://www.linkedin.com/in/paul-stubley-32b134100/", "anchor_text": "Paul Stubley - Freelance Data & Decision Scientist - LinkedInI am an experienced Data Scientist with a demonstrated history of high-impact work, both individually and managing a team.www.linkedin.com"}, {"url": "https://www.linkedin.com/in/paul-stubley", "anchor_text": "LinkedIn"}, {"url": "https://github.com/paul-stubley/Udacity/tree/master/Capstone_Project", "anchor_text": "GitHub"}, {"url": "https://www.kaggle.com/yelp-dataset/yelp-dataset?select=yelp_academic_dataset_business.json", "anchor_text": "Yelp review data"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3beff200b01c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3beff200b01c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/personalization?source=post_page-----3beff200b01c---------------personalization-----------------", "anchor_text": "Personalization"}, {"url": "https://medium.com/tag/recommendations?source=post_page-----3beff200b01c---------------recommendations-----------------", "anchor_text": "Recommendations"}, {"url": "https://medium.com/tag/restaurant?source=post_page-----3beff200b01c---------------restaurant-----------------", "anchor_text": "Restaurant"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&user=Paul+Stubley&userId=eac5ae7ecac5&source=-----3beff200b01c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&user=Paul+Stubley&userId=eac5ae7ecac5&source=-----3beff200b01c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3beff200b01c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3beff200b01c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3beff200b01c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3beff200b01c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3beff200b01c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3beff200b01c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3beff200b01c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@paulgstubley?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@paulgstubley?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Paul Stubley"}, {"url": "https://medium.com/@paulgstubley/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "46 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Feac5ae7ecac5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&user=Paul+Stubley&userId=eac5ae7ecac5&source=post_page-eac5ae7ecac5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Feac5ae7ecac5%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersonalised-restaurant-recommendations-using-funksvd-3beff200b01c&user=Paul+Stubley&userId=eac5ae7ecac5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}