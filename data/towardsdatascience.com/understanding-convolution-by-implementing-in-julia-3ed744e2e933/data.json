{"url": "https://towardsdatascience.com/understanding-convolution-by-implementing-in-julia-3ed744e2e933", "time": 1683004137.820122, "path": "towardsdatascience.com/understanding-convolution-by-implementing-in-julia-3ed744e2e933/", "webpage": {"metadata": {"title": "Understanding Convolution by Implementing in Julia | by Yosi Pramajaya | Towards Data Science", "h1": "Understanding Convolution by Implementing in Julia", "description": "In part 2 of Fast.ai Deep Learning Course, I learned that it\u2019s important to not only be able to use Deep Learning library such as Tensorflow / PyTorch, but to really understand the idea and what\u2019s\u2026"}, "outgoing_paragraph_urls": [{"url": "https://course.fast.ai/part2", "anchor_text": "part 2 of Fast.ai Deep Learning Course", "paragraph_index": 0}, {"url": "https://www.coursera.org/learn/machine-learning", "anchor_text": "Andrew Ng\u2019s course in Machine Learning", "paragraph_index": 2}, {"url": "https://www.youtube.com/playlist?list=PLkDaE6sCZn6Gl29AoE31iwdVwSG-KnDzF", "anchor_text": "Youtube playlist by Andrew Ng", "paragraph_index": 4}, {"url": "https://github.com/JuliaCI/BenchmarkTools.jl", "anchor_text": "BenchmarkTools", "paragraph_index": 9}, {"url": "https://www.youtube.com/watch?v=smHa2442Ah4", "anchor_text": "C4W1L04", "paragraph_index": 19}, {"url": "http://ucidatascienceinitiative.github.io/IntroToJulia/Html/WhyJulia", "anchor_text": "This type-stability feature is one main reason why Julia is super fast!", "paragraph_index": 22}, {"url": "https://www.youtube.com/watch?v=tQYZaDn_kSg", "anchor_text": "C4W1L05", "paragraph_index": 26}, {"url": "https://github.com/yos1p/ml-julia", "anchor_text": "link to the repository on GitHub", "paragraph_index": 36}], "all_paragraphs": ["In part 2 of Fast.ai Deep Learning Course, I learned that it\u2019s important to not only be able to use Deep Learning library such as Tensorflow / PyTorch, but to really understand the idea and what\u2019s actually happening behind it. And there\u2019s no better way to understand it than to try and implement it ourselves.", "In Machine Learning practice, convolution is something we\u2019re all very familiar with. So I thought, why not give it a try? Here\u2019s the result of my experiments in implementing Convolution in Julia.", "When I took Andrew Ng\u2019s course in Machine Learning, I mostly use MATLAB to understand machine learning algorithms. But MATLAB is a commercial product and can be very expensive.", "Julia is very fast, and specifically designed to be very good at numerical and scientific computing, which is what we need in implementing Machine Learning algorithms. It\u2019s also very easy to learn. Most importantly, it\u2019s free and open-source.", "Alright, now it\u2019s time to start working on it. You see, there\u2019re so many articles about CNN already, so I\u2019m not going to explain it more. If you\u2019re looking into basic concept of CNN, I recommend this Youtube playlist by Andrew Ng.", "It\u2019s always good to start on simple things first. So for my experiments, I will use 6x6 matrix as input, 3x3 matrix as filter, and expected output of 4x4 matrix. I start with small matrix so that I can check the accuracy of my function.", "I define the input, the filter, and the expected output through Julia CLI. The input will be 6x6 matrix, the filter will be 3x3 matrix, and expected output will be 4x4 matrix with the same value like the picture above.", "Since we already know the input (6x6) and the filter (3x3), the output should be a 4x4. In the first iteration, if we do the computation manually, and assume the filter is 3x3, the code will be like this:", "We can copy the whole function in the CLI and see the result.", "And it works! Another awesome feature from Julia is that we can benchmark our function. We can do that by using BenchmarkTools.", "And as you can see, Julia is amazingly fast! But what if we have more than 3x3 filters?", "In the second iteration, let\u2019s try to do that by looping through a filter matrix. The code will look like this:", "The code is working, and now it can accept any size of Filter. What about it\u2019s performance?", "It\u2019s still very fast! But can I make it faster? Maybe if I find another way instead of looping through Filters that will make it faster and more concise to read.", "In Julia, we can do this with dot syntax. So instead of looping through Filters, we can do this:", "The third iteration is now more concise. Let\u2019s give it a try:", "I was surprised that instead of getting faster, it\u2019s actually getting slower, and with a significant difference!! Why is that? This is what the documentation says:", "In other languages vectorization is also often required for performance: if loops are slow, the \u201cvectorized\u201d version of a function can call fast library code written in a low-level language. In Julia, vectorised functions are not required for performance, and indeed it is often beneficial to write your own loops.", "So the second iteration is the best implementation of convolution so far. But it\u2019s way too basic. What if I take it further?", "Another concept that\u2019s commonly used in Convolution is padding. If we have 6x6 input matrix with 3x3 filter matrix, instead of having 4x4 matrix as the output, with padding we can expect 6x6 matrix. This approach is usually called the \u201csame\u201d convolution. If you want to know more about the concept of Padding, try to watch video C4W1L04 from Andrew Ng.", "How to implement padding in our convolution function? One way is to re-create our input matrix with padding around the real values. The formula to know how much padding we need is:", "The formula above is with the assumption that the size of the filter matrix is odd. And it\u2019s mostly, if not always, odd. So in my implementation, I assume the size of filter matrix are odd and I will fill the padding with 0.", "You probably notice the \u00f7 operator when I try to calculate the padding value. This is because of Julia\u2019s type-stability feature. Basically, all / operator will return Float, and all \u00f7 will return Integer. This type-stability feature is one main reason why Julia is super fast!", "Let\u2019s try this function to get \u201csame\u201d convolution with the input and filter matrices that we have. Notice that the values from [2,2] to [5,5] is the same with \u201cvalid\u201d convolution done with the previous function.", "The performance of our padding_conv function is also not bad.", "Although quite slower compared to \u201cvalid\u201d convolution, which is expected, but the memory allocation is still very low.", "Again, I want to improve my convolution by trying to implement \u201cStrided\u201d convolution. Usually, stride=1. If you want to know more about the concept, watch video C4W1L05 from Andrew Ng.", "Implementing Strided Convolution is a bit tricky. First, I need to find the size of the output matrix based on input, filter, and the stride. The formula of the size is:", "So if we have 7x7 input matrix, with 3x3 filter matrix, and stride=2, we will have 3x3 (instead of 5x5 with stride=1). The tricky part is iterating over the input matrix. In our simple convolution, the ratio of change between Input and Output matrix are the same, that is 1. That\u2019s why we can use variable i and j when iterating through input matrix.", "But when the stride is not 1, we need an additional variable to iterate through the input matrix. Here\u2019s the code:", "Let\u2019s see the performance result. For this check, I use 7x7 input matrix with 3x3 filter. This is so that I can try with stride=1 (expecting 5x5 filter) and stride=2 (3x3 filter).", "Having more stride actually increase the speed! This makes sense because we iterate less than before.", "We have seen how we can do simple convolution, with padding, and with stride > 1. Let\u2019s see if we can put them together in a function.", "And we can try it out on the CLI.", "What I did was just a very basic 2 dimensional convolution algorithm. In practice, we usually use 3 dimensional convolution with multiple layers and usually paired with Pooling algorithm. But for me, it\u2019s already very exciting to learn and implement a very basic Convolution in Julia.", "I\u2019m still learning Julia too. Feel free to let me know how I can improve on my code. Thanks for reading.", "If you\u2019re interested with the code, here\u2019s the link to the repository on GitHub.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Tech Lead, Cloud Architect, Machine Learning Practicioner"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3ed744e2e933&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yosi-pramajaya.medium.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": ""}, {"url": "https://yosi-pramajaya.medium.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Yosi Pramajaya"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbda84d870968&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&user=Yosi+Pramajaya&userId=bda84d870968&source=post_page-bda84d870968----3ed744e2e933---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@roman_lazygeek?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Roman Mager"}, {"url": "https://unsplash.com/s/photos/math?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://course.fast.ai/part2", "anchor_text": "part 2 of Fast.ai Deep Learning Course"}, {"url": "https://www.coursera.org/learn/machine-learning", "anchor_text": "Andrew Ng\u2019s course in Machine Learning"}, {"url": "https://julialang.org/benchmarks/", "anchor_text": "Source"}, {"url": "https://www.youtube.com/playlist?list=PLkDaE6sCZn6Gl29AoE31iwdVwSG-KnDzF", "anchor_text": "Youtube playlist by Andrew Ng"}, {"url": "https://github.com/JuliaCI/BenchmarkTools.jl", "anchor_text": "BenchmarkTools"}, {"url": "https://www.youtube.com/watch?v=smHa2442Ah4", "anchor_text": "C4W1L04"}, {"url": "http://ucidatascienceinitiative.github.io/IntroToJulia/Html/WhyJulia", "anchor_text": "This type-stability feature is one main reason why Julia is super fast!"}, {"url": "https://www.youtube.com/watch?v=tQYZaDn_kSg", "anchor_text": "C4W1L05"}, {"url": "https://github.com/yos1p/ml-julia", "anchor_text": "link to the repository on GitHub"}, {"url": "https://medium.com/tag/julia?source=post_page-----3ed744e2e933---------------julia-----------------", "anchor_text": "Julia"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----3ed744e2e933---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3ed744e2e933---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3ed744e2e933---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----3ed744e2e933---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&user=Yosi+Pramajaya&userId=bda84d870968&source=-----3ed744e2e933---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&user=Yosi+Pramajaya&userId=bda84d870968&source=-----3ed744e2e933---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3ed744e2e933&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3ed744e2e933---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3ed744e2e933--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3ed744e2e933--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3ed744e2e933--------------------------------", "anchor_text": ""}, {"url": "https://yosi-pramajaya.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yosi-pramajaya.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yosi Pramajaya"}, {"url": "https://yosi-pramajaya.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "23 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbda84d870968&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&user=Yosi+Pramajaya&userId=bda84d870968&source=post_page-bda84d870968--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7707765e5944&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-convolution-by-implementing-in-julia-3ed744e2e933&newsletterV3=bda84d870968&newsletterV3Id=7707765e5944&user=Yosi+Pramajaya&userId=bda84d870968&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}