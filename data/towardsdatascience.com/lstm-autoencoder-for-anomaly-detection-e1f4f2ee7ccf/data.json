{"url": "https://towardsdatascience.com/lstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf", "time": 1683000594.616732, "path": "towardsdatascience.com/lstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf/", "webpage": {"metadata": {"title": "LSTM Autoencoder for Anomaly Detection | by Brent Larzalere | Towards Data Science", "h1": "LSTM Autoencoder for Anomaly Detection", "description": "The goal of this post is to walk you through the steps to create and train an AI deep learning neural network for anomaly detection using Python, Keras and TensorFlow. I will not delve too much in to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/BLarzalere/LSTM-Autoencoder-for-Anomaly-Detection", "anchor_text": "GitHub repo", "paragraph_index": 0}, {"url": "https://github.com/BLarzalere/LSTM-Autoencoder-for-Anomaly-Detection", "anchor_text": "here", "paragraph_index": 2}, {"url": "http://colah.github.io/posts/2015-08-Understanding-LSTMs/", "anchor_text": "article on LSTM networks", "paragraph_index": 6}, {"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "Andrej Karpathy\u2019s blog", "paragraph_index": 6}, {"url": "https://medium.com/swlh/containerized-ai-for-anomaly-detection-eb3e08225235", "anchor_text": "article", "paragraph_index": 29}], "all_paragraphs": ["The goal of this post is to walk you through the steps to create and train an AI deep learning neural network for anomaly detection using Python, Keras and TensorFlow. I will not delve too much in to the underlying theory and assume the reader has some basic knowledge of the underlying technologies. However, I will provide links to more detailed information as we go and you can find the source code for this study in my GitHub repo.", "We will use vibration sensor readings from the NASA Acoustics and Vibration Database as our dataset for this study. In the NASA study, sensor readings were taken on four bearings that were run to failure under constant load over multiple days. Our dataset consists of individual files that are 1-second vibration signal snapshots recorded at 10 minute intervals. Each file contains 20,480 sensor data points per bearing that were obtained by reading the bearing sensors at a sampling rate of 20 kHz.", "You can download the sensor data here. Due to GitHub size limitations, the bearing sensor data is split between two zip files (Bearing_Sensor_Data_pt1 and 2). You will need to unzip them and combine them into a single data directory.", "Anomaly detection is the task of determining when something has gone astray from the \u201cnorm\u201d. Anomaly detection using neural networks is modeled in an unsupervised / self-supervised manner; as opposed to supervised learning, where there is a one-to-one correspondence between input feature samples and their corresponding output labels. The presumption is that normal behavior, and hence the quantity of available \u201cnormal\u201d data, is the norm and that anomalies are the exception to the norm to the point where the modeling of \u201cnormalcy\u201d is possible.", "We will use an autoencoder deep learning neural network model to identify vibrational anomalies from the sensor readings. The goal is to predict future bearing failures before they happen.", "The concept for this study was taken in part from an excellent article by Dr. Vegard Flovik \u201cMachine learning for anomaly detection and condition monitoring\u201d. In that article, the author used dense neural network cells in the autoencoder model. Here, we will use Long Short-Term Memory (LSTM) neural network cells in our autoencoder model. LSTM networks are a sub-type of the more general recurrent neural networks (RNN). A key attribute of recurrent neural networks is their ability to persist information, or cell state, for use later in the network. This makes them particularly well suited for analysis of temporal data that evolves over time. LSTM networks are used in tasks such as speech recognition, text translation and here, in the analysis of sequential sensor readings for anomaly detection.", "There are numerous excellent articles by individuals far better qualified than I to discuss the fine details of LSTM networks. So if you\u2019re curious, here is a link to an excellent article on LSTM networks. There is also the defacto place for all things LSTM \u2014 Andrej Karpathy\u2019s blog. Enough with the theory, let\u2019s get on with the code\u2026", "I will be using an Anaconda distribution Python 3 Jupyter notebook for creating and training our neural network model. We will use TensorFlow as our backend and Keras as our core model development library. The first task is to load our Python libraries. We then set our random seed in order to create reproducible results.", "The assumption is that the mechanical degradation in the bearings occurs gradually over time; therefore, we will use one datapoint every 10 minutes in our analysis. Each 10 minute data file sensor reading is aggregated by using the mean absolute value of the vibration recordings over the 20,480 datapoints. We then merge everything together into a single Pandas dataframe.", "Next, we define the datasets for training and testing our neural network. To do this, we perform a simple split where we train on the first part of the dataset, which represents normal operating conditions. We then test on the remaining part of the dataset that contains the sensor readings leading up to the bearing failure.", "Now that we\u2019ve loaded, aggregated and defined our training and test data, let\u2019s review the trending pattern of the sensor data over time. First, we plot the training set sensor readings which represent normal operating conditions for the bearings.", "Next, we take a look at the test dataset sensor readings over time.", "Midway through the test set timeframe, the sensor patterns begin to change. Near the failure point, the bearing vibration readings become much stronger and oscillate wildly. To gain a slightly different perspective of the data, we will transform the signal from the time domain to the frequency domain using a Fourier transform.", "Let\u2019s first look at the training data in the frequency domain.", "There is nothing notable about the normal operational sensor readings. Now, let\u2019s look at the sensor frequency readings leading up to the bearing failure.", "We can clearly see an increase in the frequency amplitude and energy in the system leading up to the bearing failures.", "To complete the pre-processing of our data, we will first normalize it to a range between 0 and 1. Then we reshape our data into a format suitable for input into an LSTM network. LSTM cells expect a 3 dimensional tensor of the form [data samples, time steps, features]. Here, each sample input into the LSTM network represents one step in time and contains 4 features \u2014 the sensor readings for the four bearings at that time step.", "One of the advantages of using LSTM cells is the ability to include multivariate features in your analysis. Here, it\u2019s the four sensor readings per time step. However, in an online fraud anomaly detection analysis, it could be features such as the time of day, dollar amount, item purchased, internet IP per time step.", "We will use an autoencoder neural network architecture for our anomaly detection model. The autoencoder architecture essentially learns an \u201cidentity\u201d function. It will take the input data, create a compressed representation of the core / primary driving features of that data and then learn to reconstruct it again. For instance, input an image of a dog, it will compress that data down to the core constituents that make up the dog picture and then learn to recreate the original picture from the compressed version of the data.", "The rationale for using this architecture for anomaly detection is that we train the model on the \u201cnormal\u201d data and determine the resulting reconstruction error. Then, when the model encounters data that is outside the norm and attempts to reconstruct it, we will see an increase in the reconstruction error as the model was never trained to accurately recreate items from outside the norm.", "We create our autoencoder neural network model as a Python function using the Keras library.", "In the LSTM autoencoder network architecture, the first couple of neural network layers create the compressed representation of the input data, the encoder. We then use a repeat vector layer to distribute the compressed representational vector across the time steps of the decoder. The final output layer of the decoder provides us the reconstructed input data.", "We then instantiate the model and compile it using Adam as our neural network optimizer and mean absolute error for calculating our loss function.", "Finally, we fit the model to our training data and train it for 100 epochs. We then plot the training losses to evaluate our model\u2019s performance.", "By plotting the distribution of the calculated loss in the training set, we can determine a suitable threshold value for identifying an anomaly. In doing this, one can make sure that this threshold is set above the \u201cnoise level\u201d so that false positives are not triggered.", "Based on the above loss distribution, let\u2019s try a threshold value of 0.275 for flagging an anomaly. We then calculate the reconstruction loss in the training and test sets to determine when the sensor readings cross the anomaly threshold.", "Note that we\u2019ve merged everything into one dataframe to visualize the results over time. The red line indicates our threshold value of 0.275.", "Our neural network anomaly analysis is able to flag the upcoming bearing malfunction well in advance of the actual physical bearing failure by detecting when the sensor readings begin to diverge from normal operational values.", "Finally, we save both the neural network model architecture and its learned weights in the h5 format. The trained model can then be deployed for anomaly detection.", "In the next article, we\u2019ll deploy our trained AI model as a REST API using Docker and Kubernetes for exposing it as a service.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Innovating artificial intelligence for building a better tomorrow, one neural network at a time. Senior Technical Product Manager at T-Mobile."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe1f4f2ee7ccf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@brent.larzalere?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brent.larzalere?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Brent Larzalere"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8d1e1ec90e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&user=Brent+Larzalere&userId=c8d1e1ec90e5&source=post_page-c8d1e1ec90e5----e1f4f2ee7ccf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@ellenqin?utm_source=medium&utm_medium=referral", "anchor_text": "Ellen Qin"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/BLarzalere/LSTM-Autoencoder-for-Anomaly-Detection", "anchor_text": "GitHub repo"}, {"url": "https://github.com/BLarzalere/LSTM-Autoencoder-for-Anomaly-Detection", "anchor_text": "here"}, {"url": "http://colah.github.io/posts/2015-08-Understanding-LSTMs/", "anchor_text": "article on LSTM networks"}, {"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "Andrej Karpathy\u2019s blog"}, {"url": "https://medium.com/swlh/containerized-ai-for-anomaly-detection-eb3e08225235", "anchor_text": "article"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e1f4f2ee7ccf---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e1f4f2ee7ccf---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&user=Brent+Larzalere&userId=c8d1e1ec90e5&source=-----e1f4f2ee7ccf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&user=Brent+Larzalere&userId=c8d1e1ec90e5&source=-----e1f4f2ee7ccf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe1f4f2ee7ccf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e1f4f2ee7ccf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e1f4f2ee7ccf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brent.larzalere?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brent.larzalere?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Brent Larzalere"}, {"url": "https://medium.com/@brent.larzalere/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "258 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8d1e1ec90e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&user=Brent+Larzalere&userId=c8d1e1ec90e5&source=post_page-c8d1e1ec90e5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe0bddcbdd81&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flstm-autoencoder-for-anomaly-detection-e1f4f2ee7ccf&newsletterV3=c8d1e1ec90e5&newsletterV3Id=e0bddcbdd81&user=Brent+Larzalere&userId=c8d1e1ec90e5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}