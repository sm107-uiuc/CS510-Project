{"url": "https://towardsdatascience.com/extending-target-encoding-443aa9414cae", "time": 1683015498.5423229, "path": "towardsdatascience.com/extending-target-encoding-443aa9414cae/", "webpage": {"metadata": {"title": "Extending Target Encoding. How to better leverage target encoding\u2026 | by Daniele Micci-Barreca | Towards Data Science", "h1": "Extending Target Encoding", "description": "At the very beginning of this millennium, when my hair was a lot darker, I wrote a little article with a pretty long name, entitled \u201cA preprocessing scheme for high-cardinality categorical attributes\u2026"}, "outgoing_paragraph_urls": [{"url": "https://dl.acm.org/doi/abs/10.1145/507533.507538", "anchor_text": "A preprocessing scheme for high-cardinality categorical attributes in classification and prediction problems", "paragraph_index": 0}, {"url": "https://www.kaggle.com/dansbecker/using-categorical-data-with-one-hot-encoding", "anchor_text": "one-hot encoding", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/C4.5_algorithm", "anchor_text": "C5.0 algorithm", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Ross_Quinlan", "anchor_text": "R. Quinlan", "paragraph_index": 0}, {"url": "https://dl.acm.org/newsletter/sigkdd", "anchor_text": "ACM SIGKDD Explorations Newsletter", "paragraph_index": 4}, {"url": "https://scholar.google.com/", "anchor_text": "Google Scholar", "paragraph_index": 4}, {"url": "https://contrib.scikit-learn.org/category_encoders/targetencoder.html", "anchor_text": "Python", "paragraph_index": 5}, {"url": "http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-munging/target-encoding.html", "anchor_text": "H20", "paragraph_index": 5}], "all_paragraphs": ["At the very beginning of this millennium, when my hair was a lot darker, I wrote a little article with a pretty long name, entitled \u201cA preprocessing scheme for high-cardinality categorical attributes in classification and prediction problems\u201d. It was a straightforward article, which I decided to write, driven by a very practical need for a method to deal with data types that were hard to plug into Machine Learning (ML) models. At the time, I was working on ML models to detect fraudulent e-commerce transactions. Therefore I was dealing with very \u201csparse\u201d categorical variables, like ZIP codes, IP addresses, or SKUs. I could not find an easy way to \u201cpreprocess\u201d such variables, except for the traditional one-hot encoding, which didn\u2019t scale well to situations where one deals with hundreds or even thousands of unique values. A decision tree method popular at the time, the C5.0 algorithm by R. Quinlan, provided the capability to group together individual sets of values as part of the tree generation process. However, C5.0 was a proprietary algorithm, and therefore the methods used to come up with that they called \u201cdiscrete values subsets\u201d were not disclosed.", "Thus, I came up with my own, very pragmatic method. I replaced the original categorical value with the target\u2019s expected value, given the variable\u2019s value. That\u2019s a fancy way to say that I used, for binary classification problems, the proportion of true targets Y observed in the training data when the input variable X assumed value, Xi. However, the method extends well to regression problems and multi-class classification problems as well. Just replace the input with the average of the target when X=Xi, for regression models, or use N-1 probability encodings for N-class classification problems. That was it, or almost it, and your intractable categorical variable easily becomes a much more mellow and informative, continuous variable.", "What complicates things is that when dealing with very high cardinality input variables, many values may have a relatively small sample size. Therefore, simply trusting the statistics of the target could mean trouble (namely overfitting trouble). For this reason, I looked up some literature and adopted a smoothing approach whereby the estimate of the target given X=Xi gets blended with the prior probability of the target (or the baseline). The blending is controlled by a parameter that depends on the sample size. The larger the sample, the more the estimate is weighted toward the value of the target given X=Xi; the smaller the sample, the more the estimate is weighted toward the overall baseline for the target.", "The formula above describes a way of implementing the \u201cblending,\u201d where Ni is the sample size for X=Xi, and the Lambda function is some monotonically increasing function of the sample size.", "The article appeared in a secondary publication, the ACM SIGKDD Explorations Newsletter, which gratified me a lot. Still, after that, nobody seemed to notice it much besides the author (the destiny of the long tail of peer-reviewed articles). But as years passed, and Data Science reached its third wave of interest in the past 5 years, I noted that a few people reach out to me for questions about the article. Then, thanks to Google Scholar, I realized that all of a sudden, the article was being recently cited by other authors in the ML literature \u2014 not a ton of citations, of course. Still, somehow a few people were reading it, almost 20 years after its publication!", "Digging a little more, I discovered that people had implemented the algorithm in Python packages and that even H20 seems to support this type of transformation. People even gave a name to it, or a couple actually, \u201cTarget Encoding,\u201d or \u201cImpact Encoding\u201d \u2014 it sure sounds better than \u201cA preprocessing scheme for\u2026.\u201d.", "Anyhow, I am glad that ultimately what I wrote turned out helpful to some people. In the meantime, I have been using this method myself in various use cases and sharing it with my peers and colleagues. I also reviewed some of the work that cites my 2001 article to understand in what context this prior work was referenced, discovering that:", "As much as I was amazed to find so many references to the use of target-dependent encoding, I noticed that none of the papers I was able to read, nor the various open-source implementation seem to leverage one important suggestion made in the paper: the application to categorical variables with an implicit hierarchical structure. That\u2019s yet another fancy name to describe something straightforward, namely that a high-cardinality categorical variable has a natural way to group values \u201cup\u201d in a logical way. There are many examples of such variables in ML applications:", "There are many other examples of categorical variables that can be easily \u201crolled up\u201d to a lower level of granularity and used in a model. However, the point here is not to simply reduce cardinality by \u201clowering\u201d the number of unique values using the hierarchical structure; using target encoding things gets somewhat more interesting\u2026", "Earlier, I referred to the \u2018blending\u2019 formula, which controls the weighting between the \u201cvalue statistics\u201d (namely the target statistics when X=Xi) and the target\u2019s prior probability. We use the unconditional prior probability of the target simply because we assume there is no better alternative when P(Y|X=Xi) is unreliable because of the small sample size. However, when we have a hierarchical structure we can leverage, we can look at the target statistics for the \u201cparent group.\u201d Thus, if the sample size for ZIP code 94089 is too small, we can factor in the target statistics for all records with ZIP code 9409x, which will hopefully provide a more reliable estimate, and if not\u2026what about considering 940xx? This hierarchical version of the Target Encoding method provides a couple of advantages:", "In the fast-moving world of Data Science, where superlatively complex and powerful new algorithms, devouring massive amounts of computing power, seem to be the dominant trend, the art and science of inventive and creative Feature Engineering seem to be less and less relevant. I often run into online material or ML models I see built by passionate yet junior Data Scientist where minimal effort is spent creating \u201cbetter predictors\u201d \u2014 the algorithm will figure it out, is the common thinking. Don\u2019t worry about creating sophisticated, domain-driven predictors for your model \u2014 give the raw data to the algorithm, and the ideal internal representation will be created via learning. Indeed, Deep Learning has shown that this is very true when the input data has a Spatio-temporal structure \u2014 neural network models do indeed create very \u201cdeep\u201d spatial features and abstraction. But unfortunately, not all data is made up of images, sounds, videos. Or, not always, we have a zillion data points available to train these types of models. Thus, in many cases, I still believe that a model\u2019s performance can be heavily dependent on its creator\u2019s savviness in crafting \u201cgood predictors\u201d from raw data. But, I have been proven wrong before.", "Thus, in conclusion, thanks to all of those who discovered my little paper with the long title from 2001, and do not forget to check out Section 4, where the hierarchical version of target encoding is explained \u2014 definitively worth it, in some use cases.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F443aa9414cae&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dmicci.medium.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": ""}, {"url": "https://dmicci.medium.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Daniele Micci-Barreca"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F23e201687b66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&user=Daniele+Micci-Barreca&userId=23e201687b66&source=post_page-23e201687b66----443aa9414cae---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/getting-started", "anchor_text": "Getting Started"}, {"url": "https://unsplash.com/@maurogigliphoto?utm_source=medium&utm_medium=referral", "anchor_text": "Mauro Gigli"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://dl.acm.org/doi/abs/10.1145/507533.507538", "anchor_text": "A preprocessing scheme for high-cardinality categorical attributes in classification and prediction problems"}, {"url": "https://www.kaggle.com/dansbecker/using-categorical-data-with-one-hot-encoding", "anchor_text": "one-hot encoding"}, {"url": "https://en.wikipedia.org/wiki/C4.5_algorithm", "anchor_text": "C5.0 algorithm"}, {"url": "https://en.wikipedia.org/wiki/Ross_Quinlan", "anchor_text": "R. Quinlan"}, {"url": "https://dl.acm.org/newsletter/sigkdd", "anchor_text": "ACM SIGKDD Explorations Newsletter"}, {"url": "https://scholar.google.com/", "anchor_text": "Google Scholar"}, {"url": "https://scholar.google.com/", "anchor_text": "Google Scholar"}, {"url": "https://contrib.scikit-learn.org/category_encoders/targetencoder.html", "anchor_text": "Python"}, {"url": "http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-munging/target-encoding.html", "anchor_text": "H20"}, {"url": "https://catboost.ai/", "anchor_text": "CATBOOST"}, {"url": "https://yandex.com/", "anchor_text": "Yandex"}, {"url": "http://www.feat.engineering/#", "anchor_text": "Feature Engineering and Selection"}, {"url": "http://www.gidas.at/publications/Ming%20et%20al%202016%20A%20contextualized%20and%20personalized%20model.pdf", "anchor_text": "social media"}, {"url": "https://arxiv.org/pdf/1907.09844.pdf", "anchor_text": "e-commerce"}, {"url": "https://www.researchgate.net/profile/Marcin_Chlebus/publication/340924091_NOVEL_MULTILAYER_STACKING_FRAMEWORK_WITH_WEIGHTED_ENSEMBLE_APPROACH_FOR_MULTICLASS_CREDIT_SCORING_PROBLEM_APPLICATION_Novel_multilayer_stacking_framework_with_weighted_ensemble_approach_for_multiclass/links/5ea4670945851553faaece08/NOVEL-MULTILAYER-STACKING-FRAMEWORK-WITH-WEIGHTED-ENSEMBLE-APPROACH-FOR-MULTICLASS-CREDIT-SCORING-PROBLEM-APPLICATION-Novel-multilayer-stacking-framework-with-weighted-ensemble-approach-for-multiclass.pdf", "anchor_text": "credit scoring"}, {"url": "https://www.census.gov/eos/www/naics/", "anchor_text": "NAICS system"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----443aa9414cae---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----443aa9414cae---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-transformation?source=post_page-----443aa9414cae---------------data_transformation-----------------", "anchor_text": "Data Transformation"}, {"url": "https://medium.com/tag/classification-algorithms?source=post_page-----443aa9414cae---------------classification_algorithms-----------------", "anchor_text": "Classification Algorithms"}, {"url": "https://medium.com/tag/getting-started?source=post_page-----443aa9414cae---------------getting_started-----------------", "anchor_text": "Getting Started"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&user=Daniele+Micci-Barreca&userId=23e201687b66&source=-----443aa9414cae---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&user=Daniele+Micci-Barreca&userId=23e201687b66&source=-----443aa9414cae---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F443aa9414cae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----443aa9414cae---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----443aa9414cae--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----443aa9414cae--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----443aa9414cae--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----443aa9414cae--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----443aa9414cae--------------------------------", "anchor_text": ""}, {"url": "https://dmicci.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dmicci.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Daniele Micci-Barreca"}, {"url": "https://dmicci.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "48 Followers"}, {"url": "https://www.linkedin.com/in/miccibarreca/", "anchor_text": "https://www.linkedin.com/in/miccibarreca/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F23e201687b66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&user=Daniele+Micci-Barreca&userId=23e201687b66&source=post_page-23e201687b66--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9e48b555e39&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextending-target-encoding-443aa9414cae&newsletterV3=23e201687b66&newsletterV3Id=9e48b555e39&user=Daniele+Micci-Barreca&userId=23e201687b66&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}