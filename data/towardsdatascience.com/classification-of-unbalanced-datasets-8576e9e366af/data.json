{"url": "https://towardsdatascience.com/classification-of-unbalanced-datasets-8576e9e366af", "time": 1682997394.792541, "path": "towardsdatascience.com/classification-of-unbalanced-datasets-8576e9e366af/", "webpage": {"metadata": {"title": "Classification of unbalanced datasets | by Michael Kareev | Towards Data Science", "h1": "Classification of unbalanced datasets", "description": "Let\u2019s imagine you have a dataset with a dozen features and need to classify each observation. It can be either a two-class problem (your output is either 1 or 0; true or false) or a multi-class\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/nastyh/Unbalanced-Dataset", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://www.kaggle.com/amanajmera1/framingham-heart-study-dataset", "anchor_text": "Framingham Heart Study data set", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/10-simple-hacks-to-speed-up-your-data-analysis-in-python-ec18c6396e6b", "anchor_text": "article", "paragraph_index": 4}, {"url": "https://medium.com/u/7053de462a28?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Parul Pandey", "paragraph_index": 4}, {"url": "https://github.com/pandas-profiling/pandas-profiling", "anchor_text": "Profiling", "paragraph_index": 4}, {"url": "https://www.google.com/search?q=ordinal+variables+in+logistic+regression&rlz=1C1CHBF_enUS841US841&oq=ordinal+varables+in+&aqs=chrome.4.69i57j0l5.6763j0j7&sourceid=chrome&ie=UTF-8", "anchor_text": "\u201cOrdinal values in logistic regression\u201d", "paragraph_index": 28}, {"url": "https://www3.nd.edu/~rwilliam/stats3/OrdinalIndependent.pdf", "anchor_text": "this paper", "paragraph_index": 28}, {"url": "https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-parameter", "anchor_text": "here", "paragraph_index": 46}, {"url": "https://xgboost.readthedocs.io/en/latest/parameter.html#", "anchor_text": "official documentation", "paragraph_index": 57}], "all_paragraphs": ["Let\u2019s imagine you have a dataset with a dozen features and need to classify each observation. It can be either a two-class problem (your output is either 1 or 0; true or false) or a multi-class problem (more than two alternatives are possible). In this case, however, there is a twist. The data is unbalanced. Think about patients who may or may not have cancer (the majority probably won\u2019t) or a decision to extend a credit line (the majority of bank clients get an extension). Your machine learning algorithm will be \u201coverexposed\u201d to one class, and \u201cunderexposed\u201d to another. There are numerous articles online about this problem with different approaches. Here I will combine a few of them to get a robust solution.", "We\u2019ll start with more straight-forward linear models, then add a couple of tweaks, move to boosted trees, and finally to neural networks.", "You can download the data set and workbooks from here.", "We\u2019ll use the Framingham Heart Study data set from Kaggle for this exercise. It presents a binary classification problem in which we need to predict a value of the variable \u201cTenYearCHD\u201d (zero or one) that shows whether a patient will develop a heart disease.", "Let\u2019s make the preliminary data exploration a little bit more convenient. I recently came across an article called \u201c10 Simple hacks to speed up your Data Analysis in Python\u201d written by Parul Pandey and installed a Profiling package.", "With just one command, it does some really handy stuff:", "As you can see, the data is fairly clean: we have missing values here and there but we will handle those soon.", "Correlations between features in the chart below don\u2019t say much either:", "Two red rectangles around smoking and diastolic/systolic blood pressures are fairly evident: usually smoking and high blood pressure are related", "Most of the features\u2019 names give a good understanding of what every variable means but a few of them are less obvious:", "1 \u2014 for some high school", "2 \u2014 for high school of GED", "3 \u2014 some college or vocational school", "BPMeds is a binary variable where", "0 \u2014 means that a patient doesn\u2019t take any blood pressure medications", "Let\u2019s examine the target variable manually:", "And if you\u2019re a visual person:", "It\u2019s not a severely unbalanced set but might skew both linear and non-linear algorithms.", "I can think of a few immediate issues here:", "\u201cBPMeds\u201d has some missing values but ~96% of the columns is zero (no blood pressure medications taken). So, it should be fair to fill NaNs with zeroes.", "\u201cglucose\u201d and \u201ctotChol\u201d are both continuous variables and we will use an average column\u2019s value to fill out empty cells.", "\u201cBMI\u201d and \u201cheartRate\u201d seem to work fine with an average, as well.", "\u201ccigsPerDay\u201d requires a two-step approach. It has 29 missing values. You may think that using an average is fine. However, \u201ccigsPerDay\u201d is linked to another binary feature \u201ccurrentSmoker.\u201d So, you could have NaN for a non-smoker and assign some average number of cigarettes to this person. We want to avoid this scenario. Let\u2019s see how that can be done.", "Most of the people are non-smokers, we don\u2019t want to assign them any cigarettes.", "This command returns zero, so it seems that we don\u2019t have NaNs for any non-smokers. But using .mean() is still bad, as it will be skewed towards zero. We want to apply the fillna() command only to smokers:", "As a result, the average number of cigarettes smoked now is just above 18:", "If we decided to go an easier way, without excluding non-smokers, this value would be around nine.", "You can be certain that non-smokers are not assigned any values:", "\u201ceducation\u201d is an interesting one. While it\u2019s a categorical variable per se, it\u2019s already encoded for us, and a higher level of education corresponds to a bigger number. A potential problem here is that an \u201cinterval\u201d between \u201ccollege\u201d and \u201csome college or vocational school\u201d likely isn\u2019t the same as between \u201chigh school or GED\u201d and \u201csome college or vocational school.\u201d However, the numbers say the opposite: the distance between four and three is exactly the same as between two and three. You can read about this problem by Googling \u201cOrdinal values in logistic regression\u201d or by just going through this paper. Let\u2019s assume for now that the distances are similar. That said, we will just get rid of NaNs in \u201ceducation\u201d so that a regression can work with the column.", "It seems fair to substitute NaNs with \u201c1\u201d here.", "Making all the changes that are due at once:", "Let\u2019s check that it went through:", "We will start with a random forest and will also look at the importance metrics of our features.", "Don\u2019t forget to separate features from the target variable:", "Features\u2019 importance (sometimes, for the sake of speed, you want to build a model using fewer features):", "If you want it as a list:", "We want to avoid because the model incorrectly states that a patient doesn\u2019t have a problem while in reality he or she does! We will address the problem shortly but for now, let\u2019s rebuild the model using only important features.", "I selected features with the importance more than 0.12 and rebuilt the random forest using only these columns. The results came in pretty similar but we were able to save some computational power.", "Results are very similar to random forest\u2019s:", "It did slightly better on false negatives. But it\u2019s still not enough.", "The LogisticRegression has a parameter class_weight that should help more accurate. Let\u2019s see:", "It\u2019s not really helpful: we decrease the number of Type II errors at some expense of the overall accuracy. It seems we need to move on to something different.", "We can also implement class_weight manually by passing a breakdown of zero and one values that you can quickly get using value_counts:", "Good job on Type I errors, actually:", "You can try different combinations. By trial and error (or with the help of GridSearch), you can find one that serves your purpose, for example:", "If you decide to go with GridSearch to find proper weights, this is how it can be implemented:", "In the code above, we test different combinations of zeroes and ones for the variable TenYearCHD going from a 3-97% breakdown to a 97-3% breakdown. GridSearchCV can evaluate different estimators, and they are chosen and controlled in the field scoring. Usually, you would use something like accuracy for classification and R-squared for regression, but in our case accuracy won\u2019t be very informative, so I decided to go with the area under the AUC curve. All available scoring parameters are described here.", "Then we can just print out the best parameters and pass it back to the model:", "One of the most popular methods is up(down)sampling. The problem with our data set, as you may remember, is that algorithms see drastically more negative (zero) cases than positive during the training stage, and it makes the models less accurate. The next logical thing to do is to train a model on the same number of positive (1) and negative (0) cases.", "In the code above, we separate the existing dataset into two: observations that have developed a heart disease and the rest.", "As you see now, df_upsampled has the same number of zero and one observations.", "Now we will normalize it and throw into a model again:", "In our case, results have deteriorated. Why so? We will explore it next time. Usually it helps, though.", "We have already mentioned that Errors II are more critical in this case than Errors I. Another way to account for that is to move the threshold (that is now set up to 0.5).", "We wrote a loop here to go from a threshold of 10% to the threshold of 70% and then show the results. I\u2019m fitting the basic logistic regression model here for the sake of this exercise.", "So far we have made only limited progress. It\u2019s probably time to turn to XGBoost \u2014 a weapon of choice for the most Kaggle competitions.", "Unlike other methods, XGBoost can report and evaluate the performance of the test set during the fit stage. I\u2019ve created and eval_set, passed it to the fit method and set up verbose = True to see verbosity in the real time.", "Out of the box, it returns a root mean square error (RMSE) of 0.3678. Let\u2019s work on lowering it. To do so, we need to tweak some of the numerous parameters that are passed in the algorithm. You really need to read about them in the official documentation because it\u2019s the key to achieving the superb performance of your model. Today I will focus at three of the available parameters. And again, GridSearchCV will do it for us.", "We are going to test various inputs of these parameters:", "We do cross-validation here using StratifiedKFold and GridSearchCV to iterate over parameters. The more parameters you want to test, the more permutations your computer has run, and the more time it will take. Be cautious if you are doing it on your laptop.", "Once the process is completed, let\u2019s see what the best parameters are:", "Then you can rerun the model using what you\u2019ve gotten above:", "We can see an improvement: RMSE went down to 0.3384.", "XGBoost returns probabilities, not actual predictions. We will need actual predictions for building a confusion matrix, though.", "We have tried using some traditional and more specific methods to build an accurate prediction model. Depending on the nature of your data, it might be already enough for improving model\u2019s performance. In the second part of the article, we will continue our journey by building a learning curve, an ensemble of a few models, and finally rerunning the analysis using Keras.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Basketball \u2192 Finance \u2192 Data Science"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8576e9e366af&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8576e9e366af--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nasty_haterz?source=post_page-----8576e9e366af--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasty_haterz?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Michael Kareev"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbe9b59afcc29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&user=Michael+Kareev&userId=be9b59afcc29&source=post_page-be9b59afcc29----8576e9e366af---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@brett_jordan?utm_source=medium&utm_medium=referral", "anchor_text": "Brett Jordan"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/nastyh/Unbalanced-Dataset", "anchor_text": "here"}, {"url": "https://www.kaggle.com/amanajmera1/framingham-heart-study-dataset", "anchor_text": "Framingham Heart Study data set"}, {"url": "https://towardsdatascience.com/10-simple-hacks-to-speed-up-your-data-analysis-in-python-ec18c6396e6b", "anchor_text": "article"}, {"url": "https://medium.com/u/7053de462a28?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Parul Pandey"}, {"url": "https://github.com/pandas-profiling/pandas-profiling", "anchor_text": "Profiling"}, {"url": "https://www.google.com/search?q=ordinal+variables+in+logistic+regression&rlz=1C1CHBF_enUS841US841&oq=ordinal+varables+in+&aqs=chrome.4.69i57j0l5.6763j0j7&sourceid=chrome&ie=UTF-8", "anchor_text": "\u201cOrdinal values in logistic regression\u201d"}, {"url": "https://www3.nd.edu/~rwilliam/stats3/OrdinalIndependent.pdf", "anchor_text": "this paper"}, {"url": "https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-parameter", "anchor_text": "here"}, {"url": "https://xgboost.readthedocs.io/en/latest/parameter.html#", "anchor_text": "official documentation"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8576e9e366af---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----8576e9e366af---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/classification?source=post_page-----8576e9e366af---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/tag/big-data?source=post_page-----8576e9e366af---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/algorithms?source=post_page-----8576e9e366af---------------algorithms-----------------", "anchor_text": "Algorithms"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&user=Michael+Kareev&userId=be9b59afcc29&source=-----8576e9e366af---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&user=Michael+Kareev&userId=be9b59afcc29&source=-----8576e9e366af---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8576e9e366af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8576e9e366af---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8576e9e366af--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8576e9e366af--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8576e9e366af--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8576e9e366af--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8576e9e366af--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasty_haterz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nasty_haterz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Michael Kareev"}, {"url": "https://medium.com/@nasty_haterz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "150 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbe9b59afcc29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&user=Michael+Kareev&userId=be9b59afcc29&source=post_page-be9b59afcc29--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F99ef10ff6a10&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassification-of-unbalanced-datasets-8576e9e366af&newsletterV3=be9b59afcc29&newsletterV3Id=99ef10ff6a10&user=Michael+Kareev&userId=be9b59afcc29&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}