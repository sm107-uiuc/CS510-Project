{"url": "https://towardsdatascience.com/recommending-similar-images-using-pytorch-da019282770c", "time": 1683010707.535081, "path": "towardsdatascience.com/recommending-similar-images-using-pytorch-da019282770c/", "webpage": {"metadata": {"title": "Recommending Similar Images Using PyTorch | by Maciej D. Korzec | Towards Data Science", "h1": "Recommending Similar Images Using PyTorch", "description": "In my last article we introduced the simple logic to create recommendations for similar images within large sets based on the image content by employing transfer learning. Now let us create a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/effortlessly-recommending-similar-images-b65aff6aabfb", "anchor_text": "In my last article", "paragraph_index": 0}, {"url": "https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch homepage", "paragraph_index": 13}, {"url": "https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18", "anchor_text": "download", "paragraph_index": 25}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch website", "paragraph_index": 26}, {"url": "https://medium.com/@maciek.korzec/a-flask-app-for-image-recommendations-a865e1496a0d", "anchor_text": "my follow-up article", "paragraph_index": 27}], "all_paragraphs": ["In my last article we introduced the simple logic to create recommendations for similar images within large sets based on the image content by employing transfer learning.", "Now let us create a prototypical implementation in Python using the pretrained Resnet18 convolutional neural network in PyTorch. It will take the content of an image folder and create top-k lists with k most similar images to the input.", "The basic implementation for a simple recommender that uses the Resnet18 net for a fixed set of images will be derived in the following steps", "0. Theory rewind: Image recommender logic", "2. Use the pretrained Resnet18 network as feature vector generator", "3. Use the feature arrays to calculate similarity by evaluating cosines of these vectors", "5. Use top-k lists and visualize recommendations", "If you already read my previous article, feel free to skip step 0.", "If you are mainly interested in the prototypical implementation, you can find the Jupyter notebook here. It covers all steps including a sample set of images and a simple visualization for recommended images", "We want to recommend similar images to a reference input e.g. for a recommender in an online shop. The similarity is based on the information that are encoded within the pixels, and not its metadata.", "It is assumed that you have gathered data in a folder with jpg images. Then we preprocess the images to fit the input requirements of the selected net (e.g. resize to 224x224 RGB images for Resnet18), we calculate feature vectors for the resized images with the selected net, we calculate similarities based on cosine similarity and store top-k lists to be used for recommendations. Finally, we use the lists for recommendations.", "The overall steps are summarized in the following schematic", "The core steps will be carried out with PyTorch, an open source machine learning framework in Python. It comes along with various convolutional networks and weights from pretraining on huge datasets.", "The image folder shall be located in the working directory. To fulfill the input requirements from PyTorch\u2019s convolutional networks, independently of the net, we learn from the PyTorch homepage that for all models we need to normalize the input images in the same way to use the pretrained weights properly. The input needs to", "To rescale the images, we can proceed as follows: Define the transformation, iterate through all image names from the input directory, load the image, apply the transformation, store the transformed image together with the information on its orientation", "The normalization is carried out within the constructor of the conversion class following next.", "To generate features from the rescaled images, we set-up a class containing the relevant information for the network in the constructor", "The public method getVec(self, img) creates the feature vector from the image input. It uses the defined device (cpu). A function is hooked to the forward call of the network to copy the data from the relevant layer. Therefore the embedding tensor that eventually contains the relevant information needs to have the format of the layer.", "There is everything at hand to create the feature vectors for all images now. They are collected in the allVectors set.", "After we calculated all the feature vectors, it is time to calculate the cosines between these. As we calculate the similarity value just by an inner product and normalization, this is one function call employing basic NumPy (numerical linear algebra library) functionality. The matrix is stored as Pandas DataFrame (two-dimensional tabular data structure)", "Have in mind that storing the whole similarity matrix is a bottleneck for large scale usage \u2014 some more elaborated approach would be needed.", "For the top-k (k most similar image) lists Pandas DataFrames are created from the similarity matrix that contain the similar names to an input and the corresponding similarity values.", "tqdm is used to get a progress bar, which is useful when you want to work with many images.", "In a last step you should be able to see the similar images to a requested input.", "Let us use this for some of the images provided within the repository", "With the explanations and code above, you should have all the needed basics at hand to work with PyTorch\u2019s pretrained convolutional networks to create a recommender system for similar images. The complete code is available for download.", "If you want to use different models, they are described on the PyTorch website. When you want to create more experiments, modularize the code and treat the network and its layers only as parameters. When creating experiments with larger sets it is advised to store the intermediate results, e.g. as pickle files.", "If you ask yourself how to run a website that includes such a recommender, you may want to have a look into my follow-up article.", "If you found the read interesting, you might want to catch up on my other articles on the topic:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Enthusiast, Product Management Devotee and Mathematician at Heart"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fda019282770c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://korzec.medium.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": ""}, {"url": "https://korzec.medium.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": "Maciej D. Korzec"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F661e2473471a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&user=Maciej+D.+Korzec&userId=661e2473471a&source=post_page-661e2473471a----da019282770c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/effortlessly-recommending-similar-images-b65aff6aabfb", "anchor_text": "In my last article"}, {"url": "https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18", "anchor_text": "here"}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch homepage"}, {"url": "https://github.com/MathMagicx/JupyterNotebooks/tree/master/ImageRecommenderResnet18", "anchor_text": "download"}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html", "anchor_text": "PyTorch website"}, {"url": "https://medium.com/@maciek.korzec/a-flask-app-for-image-recommendations-a865e1496a0d", "anchor_text": "my follow-up article"}, {"url": "https://towardsdatascience.com/effortlessly-recommending-similar-images-b65aff6aabfb", "anchor_text": "Effortlessly Recommending Similar ImagesUsing features from trained convolutional neural networks to generate comparabilitytowardsdatascience.com"}, {"url": "https://medium.com/@maciek.korzec/a-flask-app-for-image-recommendations-a865e1496a0d", "anchor_text": "A Flask App for Image RecommendationsWebsite prototype for similar image recommendations based convolutional neural networks in PyTorchmedium.com"}, {"url": "https://towardsdatascience.com/image-recommendations-with-pytorch-flask-postgresql-heroku-deployment-206682d06c6b", "anchor_text": "Image Recommendations with PyTorch + Flask + PostgreSQL + Heroku deploymentPackaging a PostgreSQL/ PyTorch based image recommender system with Flask, importing data and running it on the Heroku\u2026towardsdatascience.com"}, {"url": "https://medium.com/tag/recommender-systems?source=post_page-----da019282770c---------------recommender_systems-----------------", "anchor_text": "Recommender Systems"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----da019282770c---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/jupyter-notebook?source=post_page-----da019282770c---------------jupyter_notebook-----------------", "anchor_text": "Jupyter Notebook"}, {"url": "https://medium.com/tag/image-processing?source=post_page-----da019282770c---------------image_processing-----------------", "anchor_text": "Image Processing"}, {"url": "https://medium.com/tag/python?source=post_page-----da019282770c---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&user=Maciej+D.+Korzec&userId=661e2473471a&source=-----da019282770c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&user=Maciej+D.+Korzec&userId=661e2473471a&source=-----da019282770c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fda019282770c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----da019282770c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----da019282770c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----da019282770c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----da019282770c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----da019282770c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----da019282770c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----da019282770c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----da019282770c--------------------------------", "anchor_text": ""}, {"url": "https://korzec.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://korzec.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maciej D. Korzec"}, {"url": "https://korzec.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "46 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F661e2473471a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&user=Maciej+D.+Korzec&userId=661e2473471a&source=post_page-661e2473471a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc6b44dc1fe3d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecommending-similar-images-using-pytorch-da019282770c&newsletterV3=661e2473471a&newsletterV3Id=c6b44dc1fe3d&user=Maciej+D.+Korzec&userId=661e2473471a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}