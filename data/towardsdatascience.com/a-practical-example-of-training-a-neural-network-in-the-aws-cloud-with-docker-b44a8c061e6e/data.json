{"url": "https://towardsdatascience.com/a-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e", "time": 1682995929.660653, "path": "towardsdatascience.com/a-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e/", "webpage": {"metadata": {"title": "A practical example of Training a Neural Network in the AWS cloud with Docker | by Jens Laufer | Towards Data Science", "h1": "A practical example of Training a Neural Network in the AWS cloud with Docker", "description": "My last article Example Use Cases of Docker in the Data Science Process was about Docker in Data Science in general. This time I want to get my hands dirty with a practical example. In this case\u2026"}, "outgoing_paragraph_urls": [{"url": "https://jenslaufer.com/data/science/use-cases-of-docker-in-the-data-science-process.html", "anchor_text": "Example Use Cases of Docker in the Data Science Process", "paragraph_index": 0}, {"url": "https://github.com/jenslaufer/neural-network-training-with-docker", "anchor_text": "source code for this project", "paragraph_index": 1}, {"url": "https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Home:", "anchor_text": "AWS Web Console", "paragraph_index": 4}, {"url": "https://github.com/aws/aws-cli", "anchor_text": "AWS Command Line Client", "paragraph_index": 4}, {"url": "https://developer.nvidia.com/cuda-zone", "anchor_text": "CUDA 10.1", "paragraph_index": 6}, {"url": "https://github.com/NVIDIA/nvidia-docker", "anchor_text": "nvidia-docker", "paragraph_index": 6}, {"url": "https://console.aws.amazon.com/vpc/home?region=us-east-1#vpcs:sort=VpcId", "anchor_text": "AWS Web Console", "paragraph_index": 9}, {"url": "https://docs.docker.com/machine/drivers/aws/", "anchor_text": "Docker Machine with AWS", "paragraph_index": 10}, {"url": "https://github.com/jenslaufer/neural-network-training-with-docker/blob/c045323c372bb46535f563c456117a8befa4b05f/src/cnn/cifar10.py", "anchor_text": "src/cnn/cifar10.py", "paragraph_index": 17}, {"url": "https://hub.docker.com/r/jenslaufer/neural-network-training-with-docker/tags", "anchor_text": "Docker image on Docker Hub", "paragraph_index": 26}, {"url": "http://jenslaufer.com", "anchor_text": "http://jenslaufer.com", "paragraph_index": 57}], "all_paragraphs": ["My last article Example Use Cases of Docker in the Data Science Process was about Docker in Data Science in general. This time I want to get my hands dirty with a practical example.", "In this case study, I want to show you how to train a shallow neural network on top of a deep InceptionV3 model on CIFAR-10 images within a Docker container on AWS. I am using a standard technology stack for this project with Python, Tensorflow and Keras. The source code for this project is available on Github.", "What you will learn in this case study:", "Let\u2019s define the requirements for this little project:", "To train the neural network on AWS you first need to set up an instance there. You can do this from the AWS Web Console or from the command line with the AWS Command Line Client.", "I show you a convenient third way with the docker-machine command. The command wraps the drivers for different cloud and local providers. You get a unique interface for the Google Compute Cloud, Microsoft Azure and Amazon AWS this way, which makes it easy to setup instances on the platforms. Keep in mind that once you have set up the instance, you can reuse for other purposes.", "I am creating an AWS instance with Ubuntu 18.04 Linux (ami-0891f5dcc59fc5285) which has CUDA 10.1 and nvidia-docker already installed. The components are needed to enable the GPU for the training. The basis for the AMI is a standard AWS Ubuntu 18.04 Linux instance (ami-0a313d6098716f372), which I extended with these components. I shared the image to the public to make life easier.", "I am using the p2.xlarge instance type, which is cheapest GPU instance on AWS. The p2.xlarge instance type equips you with the GPU power of a Tesla K80.", "You need a VPC-ID for the setup. You can use the AWS command to get it:", "You can get the VPC-ID as well from the AWS Web Console", "For more information check the Docker Machine with AWS Documentation.", "WARNING: The p2.xlarge costs $0.90 per HOUR. Please don\u2019t forget to stop the instance after completing your training sessions", "You want to train the neural network with different training parameters to find the best set up. After the training, you test the model quality on the test set. It\u2019s a classification problem; I suggest to use the accuracy metric for simplicity. In the end, you persist the training log, model weights and architecture for further usage. Everything is reproducible and traceable this way.", "You can do transfer learning by replacing the top layers of the base model with your shallow network, then you freeze the weights of the base model and perform the training on the whole network.", "I am doing it differently in this case study. I am removing the top layers of the base model, then I feed the images into the base model and persist the resulting features in the MongoDB. Predictions need less computing power than training, and I can reuse the bottleneck features once they are extracted. You train the shallow network on the bottleneck features.", "The input and output requirements for the training script:", "The Docker container is parameterised from a MongoDB collection with all parameters for a training session.", "I put the whole training pipeline into one script src/cnn/cifar10.py It consists of one class for the whole training pipeline:", "Everything you need to train the neural network I put into the Dockerfile, which defines the runtime environment for the training.", "Line 1: Definition of the base image. The setup and configuration are inherited from this image. An official tensorflow image with python3 and GPU support is used.", "Line 3: Everything in the local directory src, like the training script and entry point, is copied into the Docker image.", "Line 5: Container is started in src directory", "Line 7: Installation of python requirements", "Line 9: src directory is added to PYTHONPATH to tell python to look for modules in this directory", "Line 11: Definition of the entry point for the image. This entry point script is executed when the container is started. This script starts our python training script.", "The entry point shell script is pretty self-explaining: It starts the python module with no parameters. The module fetches then the training parameter from the MongoDB on startup.", "First, I need to build a Docker image. You can skip this step as I shared the ready-built Docker image on Docker Hub. The image is automatically downloaded when it is referenced the first time.", "I have two docker containers in my setup: The Docker container for training and a MongoDB for persisting meta-data and as a file server.", "You use docker-compose for this scenario. You define the containers that make your application in a docker-compose.yml", "Line 4\u20135: Definition of the training container which uses the jenslaufer/neural-network-training-with-docker image with tag 0.1.0-GPU. This image is automatically downloaded from the public Docker Hub repository", "Line 7: The runtime environment for tensorflow", "Line 9: The training container needs the trainingdb container for execution. In the code, you use mongodb://trainingdb as Mongo URI", "Line 11\u201312: Definition of the MongoDB database. An official mongo image from Docker Hub is used with version 3.6.12", "Line 16: Mongo daemon is started", "You can see that it\u2019s straightforward to set up a multi-application with docker compose \u2014 you just set up a database with a few lines of code without complicated installation routines.", "You need to execute this command to ensure that the docker commands are going against our AWS instance:", "Afterwards, you can list your machines", "Ensure that you see the star for the active environment. It\u2019s the environment against all docker commands are executed. Keep in mind that you execute the commands in your local shell. It\u2019s very convenient.", "You can now start the containers the first time.", "Docker downloads all images to the AWS instance. The MongoDB started and keep running until you stop the containers. The neural-network-training-with-docker executes the training module. The module fetches the training sessions from the MongoDB, which is empty on the first start. The container stops after finishing the training sessions.", "You log into the MongoDB container for this (everything from your local shell):", "You open the mongo client. Then you are selecting the DB \u2018trainings\u2019 with the use command. You can add then a training session with only 5% of the images, a rmsprop optimizer with a batch size of 50 and 20 epochs. It\u2019s a quick test if everything works smoothly.", "You leave the MongoDB and restart the containers:", "The problem is now that you don\u2019t see what\u2019s going. You can get the logs of a docker container with the docker log command.", "You can now follow the training session on the remote docker container on your local machine this way.", "You can compare the results from the different training sessions quickly with the MongoDB, as I persisted all parameters and the accuracy metric on the test set. The advantage of a database is that you can execute queries against it, which is much better than saving results in CSV or JSON.", "Let\u2019s list the three model with the highest accuracy.", "You can also query the database for the model files for a specific training session. You can see that you have hdf5 files for the model architecture and weights. There is also a JSON file with the training history you can use to analyse the training itself. It can be used to visualise the training process.", "You can load the best model automatically from the MongoDB and ship it in Flask, Spring Boot or Tensorflow Application.", "You can download the files to the local filesystem with the mongofiles command:", "You set up in this case study a GPU-empowered cloud instance on AWS from the command line with docker-machine. The goal was to train a neural network faster with additional computing power. The instance is reusable for other training containers.", "In the next step, you implemented a script with all steps needed to train a shallow fully connected neural network on top of InceptionV3 model with transfer learning. The script uses a MongoDB instance as a persistence layer to store training metadata and model files. You created a Dockerfile with the infrastructure needed to train the network with Tensorflow on a GPU cloud instance. You defined then a multi-container setup with training container and MongoDB container in a docker-compose file.", "You trained the neural network on the AWS cloud within Docker. You started the training from the local command line. You logged from the local command line into the MongoDB to add training sessions and to get insights on the training sessions afterwards.", "Next steps to improve the process:", "Do you need advice with your Data Science setup?", "Please let me know. Send me a mail", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Fascinated about Data Science, Software Development, Entrepreneurship, Sports and Traveling, http://jenslaufer.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb44a8c061e6e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jens-laufer.medium.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": ""}, {"url": "https://jens-laufer.medium.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Jens Laufer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F75f7938940fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&user=Jens+Laufer&userId=75f7938940fe&source=post_page-75f7938940fe----b44a8c061e6e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://jenslaufer.com/data/science/use-cases-of-docker-in-the-data-science-process.html", "anchor_text": "Example Use Cases of Docker in the Data Science Process"}, {"url": "https://github.com/jenslaufer/neural-network-training-with-docker", "anchor_text": "source code for this project"}, {"url": "https://docs.docker.com/install/", "anchor_text": "Docker"}, {"url": "https://docs.docker.com/machine/", "anchor_text": "Docker Machine"}, {"url": "https://docs.docker.com/compose/", "anchor_text": "Docker Compose"}, {"url": "https://aws.amazon.com", "anchor_text": "AWS"}, {"url": "https://github.com/aws/aws-cli", "anchor_text": "AWS Command Line Client"}, {"url": "https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Home:", "anchor_text": "AWS Web Console"}, {"url": "https://github.com/aws/aws-cli", "anchor_text": "AWS Command Line Client"}, {"url": "https://developer.nvidia.com/cuda-zone", "anchor_text": "CUDA 10.1"}, {"url": "https://github.com/NVIDIA/nvidia-docker", "anchor_text": "nvidia-docker"}, {"url": "https://console.aws.amazon.com/vpc/home?region=us-east-1#vpcs:sort=VpcId", "anchor_text": "AWS Web Console"}, {"url": "https://docs.docker.com/machine/drivers/aws/", "anchor_text": "Docker Machine with AWS"}, {"url": "https://github.com/jenslaufer/neural-network-training-with-docker/blob/c045323c372bb46535f563c456117a8befa4b05f/src/cnn/cifar10.py", "anchor_text": "src/cnn/cifar10.py"}, {"url": "https://hub.docker.com/r/jenslaufer/neural-network-training-with-docker/tags", "anchor_text": "Docker image on Docker Hub"}, {"url": "https://jenslaufer.com/data/science/practical-example-of-deep-learning-in-docker.html", "anchor_text": "https://jenslaufer.com"}, {"url": "https://medium.com/tag/docker?source=post_page-----b44a8c061e6e---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----b44a8c061e6e---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----b44a8c061e6e---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b44a8c061e6e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/aws?source=post_page-----b44a8c061e6e---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&user=Jens+Laufer&userId=75f7938940fe&source=-----b44a8c061e6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&user=Jens+Laufer&userId=75f7938940fe&source=-----b44a8c061e6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb44a8c061e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b44a8c061e6e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b44a8c061e6e--------------------------------", "anchor_text": ""}, {"url": "https://jens-laufer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jens-laufer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jens Laufer"}, {"url": "https://jens-laufer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "550 Followers"}, {"url": "http://jenslaufer.com", "anchor_text": "http://jenslaufer.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F75f7938940fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&user=Jens+Laufer&userId=75f7938940fe&source=post_page-75f7938940fe--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3a8943ecf426&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-practical-example-of-training-a-neural-network-in-the-aws-cloud-with-docker-b44a8c061e6e&newsletterV3=75f7938940fe&newsletterV3Id=3a8943ecf426&user=Jens+Laufer&userId=75f7938940fe&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}