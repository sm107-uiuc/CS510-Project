{"url": "https://towardsdatascience.com/looping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb", "time": 1683014482.07842, "path": "towardsdatascience.com/looping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb/", "webpage": {"metadata": {"title": "Looping through the Fantasy Premier League API \u201cElement-Summary\u201d Endpoint to Download Player History with Python and Pandas | by David Allen | Towards Data Science", "h1": "Looping through the Fantasy Premier League API \u201cElement-Summary\u201d Endpoint to Download Player History with Python and Pandas", "description": "Howdy folks. Seems my first FPL API tutorial was a hit, so I\u2019m back with another Python/Pandas Fantasy Premier League API tutorial for you all. This time, we\u2019ll be creating two different DataFrames\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/fantasy-premier-league-value-analysis-python-tutorial-using-the-fpl-api-8031edfe9910", "anchor_text": "first FPL API tutorial", "paragraph_index": 0}, {"url": "https://www.w3schools.com/python/ref_requests_response.asp", "anchor_text": "here", "paragraph_index": 14}, {"url": "https://www.datacamp.com/community/tutorials/f-string-formatting-in-python?utm_source=adwords_ppc&utm_campaignid=898687156&utm_adgroupid=48947256715&utm_device=c&utm_keyword=&utm_matchtype=b&utm_network=g&utm_adpostion=&utm_creative=332602034352&utm_targetid=aud-392016246653:dsa-429603003980&utm_loc_interest_ms=&utm_loc_physical_ms=2784&gclid=EAIaIQobChMIkMrorcmE7AIVQeDICh07xAVAEAAYASAAEgLDavD_BwE", "anchor_text": "f-string formatting", "paragraph_index": 37}, {"url": "https://deallen7.medium.com/membership", "anchor_text": "my link", "paragraph_index": 63}], "all_paragraphs": ["Howdy folks. Seems my first FPL API tutorial was a hit, so I\u2019m back with another Python/Pandas Fantasy Premier League API tutorial for you all.", "This time, we\u2019ll be creating two different DataFrames: (1) a DataFrame that contains the current season\u2019s gameweek histories for each player and (2) a DataFrame that contains all past season histories for each player.", "This will be an excellent introduction into using the Requests package to hit an API endpoint and build a DataFrame, and an equally excellent introduction into using a Python \u201cFor Loop\u201d to iterate over a sequence of player id\u2019s and hit the /api/element-summary/{element_id} for each player.", "At the end of the season, you\u2019ll be able to save this first DataFrame \u2014 the same data available in the \u201cThis Season\u201d section of each player\u2019s FPL profile \u2014 as a CSV or Pickle, allowing you to build your own library of FPL data that won\u2019t be available next year through the FPL API.", "The second DataFrame will allow for transformation and analysis of the very same data that is available in the \u201cPrevious Seasons\u201d section of each player\u2019s FPL profile. It will be fun, and possibly enlightening, to group this data together with other players to compare side-by-side.", "If you\u2019re new to Python, Pandas, and Jupyter Notebooks in general, head over to my \u201cGetting Started with Python, Pandas, and Jupyter Notebooks\u201d article below, and then come right back here to work through this tutorial.", "For this task, we\u2019ll need pandas and requests. Launch a new Jupyter Notebook , and then in the first cell, import your packages:", "If you\u2019re into keyboard shortcuts, you\u2019ll enjoy holding down \u201cshift\u201d while you hit \u201center\u201d to run each cell.", "I also like to update the settings in my notebook so that I can scroll left/right and see all the columns in any given DataFrame. If you\u2019ve played around in a Jupyter Notebook before, you might have experienced that annoying moment when parts of your DataFrame are invisible to you because the DataFrame contained \u201ctoo many\u201d columns. Run this next cell to update the display settings:", "p.s. if you\u2019re wondering how I\u2019m creating these section headers in these screenshots, try selecting a cell and transforming the cell from \u201cCode\u201d to \u201cMarkdown\u201d, either by selecting the cell and tapping the \u201cm\u201d key, or selecting the cell and then selecting \u201cMarkdown\u201d from the dropdown in the menu. The cell highlight should be blue, not green, when you use the keyboard shortcut, \u201cm\u201d:", "Next, we\u2019ll set our target url to the FPL API\u2019s main endpoint:", "Then, we need to use the GET method to create a response object with the Requests package:", "Next, we\u2019ll use the json() method to parse the body text of the response object into JSON.", "If you try running the response object, r, in a cell, all you will see is the response: <Response [200]> .", "The response object has all sorts of different properties and methods! Check out a list of them here.", "For our current purposes, we really only care about using the json() method, but it\u2019s good to know these other methods are available.", "Let\u2019s go ahead and transform the response body to a JSON object now:", "Next, we\u2019ll use the keys() method to see what kind of keys are available in this JSON dictionary:", "This returns a list of keys:", "Because I\u2019ve already explored what each of these keys has to offer, I already know exactly what key I want to build my first DataFrame from:", "After creating the new DataFrame, I\u2019ll just examine the top 4 rows with the head() method:", "This DataFrame will be necessary for looping through all of the player elements in the game in the next section.", "Now that we have our list of elements to iterate through, we can build our For Loop and hit the element-summary endpoint, injecting the player\u2019s element_id with each iteration:", "While we work through this, keep in mind that I\u2019m not necessarily sharing \u201cbest practices\u201d on how to do a For Loop. I\u2019m sure there are more efficient ways of doing things. This is just the way I do it.", "With that warning out of the way, let\u2019s start by building a micro-example of the For Loop and making sure our iterator will work for us:", "Notice a couple of things here. First, the for x in elements_df.index[:5]: piece of this puzzle.", "I\u2019ve asked the computer to loop through the first 5 elements of the elements_df DataFrame, using the DataFrame index as the iterator.", "The [:x] syntax here helps limit the loop to the first 5 elements.", "The [:x] syntax is a very common Pandas operation for slicing a DataFrame by it\u2019s rows. For example, elements_df[:5] is effectively the same thing as elements_df.head().", "We can use this slicing operation to help test out our For Loop because we definitely don\u2019t want to loop through the entire DataFrame to test out our loop.", "The x variable here represents the index of each row we are looping through. If you examine elements_df.head() , you\u2019ll see the index of the DataFrame to the far left of the DataFrame in an unnamed column:", "We can access any value in the DataFrame using the index. For example, let\u2019s get the first_name of the first row, using the index:", "This will return \u2018Mesut\u2019 , the first name of the first element in our DataFrame.", "We can do this operation in bulk, using a list of indices to individually loop through each row and assign a value to a variable. Let\u2019s do that again now, but get the first 10 elements this time:", "Great! Our For Loop is working perfectly.", "You\u2019ll notice that one of the variables we are setting above is the element_df.id . This id is critical to our next API call.", "We\u2019ll use the id to pass into the /api/element-summary/{element_id} endpoint to grab the element-summary for each player.", "This is accomplished with f-string formatting. Let\u2019s quickly go over f-string formatting with an example with f-string formatting and without:", "Hmm, not really what we were going for.", "Now, let\u2019s try to pass the variable your_name into my string statement:", "Ah, yes! f-string allows us to inject a variable of our own into a string. This is important because the /api/element-summary/{element_id} endpoint will be set as a string, but we need to inject the element_id into the url each time we hit it. Like so:", "This returns the keys to the JSON blob:", "As before, we\u2019ll use these keys to create our DataFrames:", "Then, let\u2019s look at each dataframe, using the head() method:", "After looking through these DataFrames, I\u2019m interested in saving the json_history_df and the json_history_past_df for all players, but I\u2019m not super interested in the json_fixtures_df right now.", "We have all the parts, let\u2019s go ahead and put them all together in our For Loop:", "print(x) will just help me understand where the operation is by looking at the screen. It serves as a kind of \u201cprogress bar.\u201d", "The rest of these operations we\u2019ve been through already.", "This isn\u2019t quite good enough, though, because every single time we loop through a new element_id , we\u2019ll be overwriting the data saved in our json_history_df and json_history_past_df DataFrames.", "We need another DataFrame to store all of this data in!", "We\u2019ll handle this by creating two new DataFrames called all_history_df and all_history_past_df , and then appending each new json_history_df DataFrame and each new json_history_past_df DataFrame into these master all_history_df and all_history_past_df DataFrames:", "If this is the very first time we are running through this loop \u2014 which we know by the index number ,x==0,\u2014 copy the json_history_df and json_history_past_df DataFrames as all_history_df and all_history_past_df .", "But if this is anything after the first index, append the new DataFrame to the Master DataFrame. This will just stack each player\u2019s individual history DataFrames on top of each other, one after the other, into one core DataFrame that will contain ALL the players.", "Let\u2019s test this out with just the first 5 elements:", "Looking at the first 10 rows of the all_history_df DataFrame, we can see our loop worked!", "Now, let\u2019s let her rip for the entire database of FPL players by removing the [:5] slice:", "This step is optional, but when the end of the 2020/21 season arrives, you\u2019ll want to save the all_history_df DataFrame to your local computer to make sure you can still access that glorious data. You can save this DataFrame as a CSV, or as a Pickle file.", "Not sure what a Pickle is in Python?", "Python pickle module is used for serializing and de-serializing a Python object structure. Any object in Python can be pickled so that it can be saved on disk. What pickle does is that it \u201cserializes\u201d the object first before writing it to file. Pickling is a way to convert a python object (list, dict, etc.) into a character stream. The idea is that this character stream contains all the information necessary to reconstruct the object in another python script.", "A Pickle is a better format for storing Python object, because it \u201ccontains all the information necessary to reconstruct the object in another python script.\u201d", "A CSV is usually a reliable way, too, but a Pickle is a safer and more efficient bet.", "We\u2019ll run through both methods below:", "When you want to read your pickle or CSV, all you\u2019ll need to do is assign the file to a variable like so:", "If you enjoy reading stories like these and want to support me as a writer, consider signing up to become a Medium member. It\u2019s $5 a month, giving you unlimited access to thousands of Python guides and Data science articles. If you sign up using my link, I\u2019ll earn a small commission with no extra cost to you.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Documentation and tutorials on Python, Pandas, Jupyter Notebook, and Data Analysis."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdf4ab5151fcb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://deallen7.medium.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": ""}, {"url": "https://deallen7.medium.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "David Allen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8ad9b3b5ef74&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&user=David+Allen&userId=8ad9b3b5ef74&source=post_page-8ad9b3b5ef74----df4ab5151fcb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/photos/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=918830", "anchor_text": "Free-Photos"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=918830", "anchor_text": "Pixabay"}, {"url": "https://towardsdatascience.com/fantasy-premier-league-value-analysis-python-tutorial-using-the-fpl-api-8031edfe9910", "anchor_text": "first FPL API tutorial"}, {"url": "https://medium.com/dev-genius/getting-started-with-python-pandas-and-jupyter-notebooks-bd08c963914", "anchor_text": "Getting Started with Python, Pandas, and Jupyter NotebooksDocumentation for everything you need to set up your machine with Jupyter Notebooks and start programming in Python\u2026medium.com"}, {"url": "https://fantasy.premierleague.com/api/bootstrap-static/'", "anchor_text": "https://fantasy.premierleague.com/api/bootstrap-static/'"}, {"url": "https://www.w3schools.com/python/ref_requests_response.asp", "anchor_text": "here"}, {"url": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'"}, {"url": "https://www.datacamp.com/community/tutorials/f-string-formatting-in-python?utm_source=adwords_ppc&utm_campaignid=898687156&utm_adgroupid=48947256715&utm_device=c&utm_keyword=&utm_matchtype=b&utm_network=g&utm_adpostion=&utm_creative=332602034352&utm_targetid=aud-392016246653:dsa-429603003980&utm_loc_interest_ms=&utm_loc_physical_ms=2784&gclid=EAIaIQobChMIkMrorcmE7AIVQeDICh07xAVAEAAYASAAEgLDavD_BwE", "anchor_text": "f-string formatting"}, {"url": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'"}, {"url": "https://fantasy.premierleague.com/api/element-summary/1/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/1/'"}, {"url": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'"}, {"url": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'"}, {"url": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'", "anchor_text": "https://fantasy.premierleague.com/api/element-summary/{element_id}/'"}, {"url": "https://www.geeksforgeeks.org/understanding-python-pickling-example/#:~:text=Python%20pickle%20module%20is%20used,list%2C%20dict%2C%20etc.)", "anchor_text": "geeksforgeeks.org"}, {"url": "https://deallen7.medium.com/membership", "anchor_text": "my link"}, {"url": "https://deallen7.medium.com/membership", "anchor_text": "Join Medium with my referral link - David AllenRead every story from David Allen (and thousands of other writers on Medium). Your membership fee directly supports\u2026deallen7.medium.com"}, {"url": "https://medium.com/tag/python?source=post_page-----df4ab5151fcb---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pandas?source=post_page-----df4ab5151fcb---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----df4ab5151fcb---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/tag/data-science?source=post_page-----df4ab5151fcb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&user=David+Allen&userId=8ad9b3b5ef74&source=-----df4ab5151fcb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&user=David+Allen&userId=8ad9b3b5ef74&source=-----df4ab5151fcb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdf4ab5151fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----df4ab5151fcb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----df4ab5151fcb--------------------------------", "anchor_text": ""}, {"url": "https://deallen7.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://deallen7.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David Allen"}, {"url": "https://deallen7.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "721 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8ad9b3b5ef74&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&user=David+Allen&userId=8ad9b3b5ef74&source=post_page-8ad9b3b5ef74--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb3ab0e36e387&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooping-through-the-fantasy-premier-league-api-element-summary-endpoint-to-download-player-df4ab5151fcb&newsletterV3=8ad9b3b5ef74&newsletterV3Id=b3ab0e36e387&user=David+Allen&userId=8ad9b3b5ef74&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}