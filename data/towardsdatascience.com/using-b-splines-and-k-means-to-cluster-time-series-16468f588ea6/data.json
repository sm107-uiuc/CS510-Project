{"url": "https://towardsdatascience.com/using-b-splines-and-k-means-to-cluster-time-series-16468f588ea6", "time": 1683009755.936329, "path": "towardsdatascience.com/using-b-splines-and-k-means-to-cluster-time-series-16468f588ea6/", "webpage": {"metadata": {"title": "Using B-Splines and K-means to Cluster Time Series | by Rory Michelen | Towards Data Science", "h1": "Using B-Splines and K-means to Cluster Time Series", "description": "Data scientists in e-commerce constantly find themselves looking at time series data. In some cases, we analyze a single time series and develop a forecasting model. But in other cases we are\u2026"}, "outgoing_paragraph_urls": [{"url": "https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly", "anchor_text": "this one on the UCI Repository", "paragraph_index": 2}], "all_paragraphs": ["Data scientists in e-commerce constantly find themselves looking at time series data. In some cases, we analyze a single time series and develop a forecasting model. But in other cases we are reviewing a collection of thousands or millions of time series and trying to identify interesting patterns.", "Working with a collection of time series can be awkward. They are difficult to aggregate in a meaningful way. However, using B-Splines, we can simplify our time series and more easily perform exploratory data analysis.", "Imagine you are a data scientist at a large online retailer and you are tasked with identifying trends in product sales. You may be given a data set similar to this one on the UCI Repository. It contains the 52-week sales volumes of 811 different products. Let\u2019s take a look at a random sample of products and their normalized sales volumes:", "One trend is obvious. Most products experience relatively consistent sales whereas 3 of the products experience sporadic spikes. There may be other trends hidden in these time series, but trying to find them through manual inspection would be incredibly time consuming and boring.", "We could run this data as-is through unsupervised machine learning algorithms such as k-means, but our results will likely be over-fit. Besides, it is not just the value of the time series at each week that is important, it is also the relative up and down movement, which will not be captured by this representation.", "So, we need a method of representing our time series in a concise way that not only captures the absolute value of the series at each week but also the shape. This is where B-Splines come in.", "B-Splines are a way to approximate non-linear functions by using a piece-wise combination of polynomials. Before diving into b-splines, let\u2019s take a look at a single time series from our data-set and try fitting a linear regression model to it:", "While the linear regression captures the overall downward trend, it oversimplifies the patterns in the series. Imagine if instead of one linear regression, we fit 2 regression models, one for the first half of the series, another for the second half. That may help a bit. Now imagine if we fit 52 different regression models, each one for a specific week in the series. While this model would certainly be over-fit, it would do an excellent job of describing the original series.", "There may be a middle ground between fitting one model and fitting 52 models. This is the idea behind b-splines- fit a series of local models.", "B-Splines have two components, a basis and coefficients. The basis determines the hyperparameters: how many local models to use (called knots) and what degree of polynomial to use in each model. The coefficients are then multiplied by this basis to approximate the original data.", "The b-spline basis is a diagonal matrix that has 52 rows- one for each time period in the series and one column for each local model. We can create a b-spline basis that uses 6 local models, or knots, and uses cubic polynomials using the code below:", "If we plot the the values of this matrix using a heatmap, we\u2019d get something like this:", "Each column in the matrix has an unique interval of non-zero values and collectively, these intervals cover the entire matrix. So by multiplying a different coefficient by each column in this matrix, we will be able to control the shape of our approximation on local intervals. Below is another representation of our B-Spline basis.", "By combining these six polynomials using different weights, or coefficients, we can get a non-linear estimate of our original time series. We can use least squares estimate to get the best fitting coefficients.", "This is a far better approximation than our original linear regression. Next, let\u2019s see how we can use b-splines to perform unsupervised learning.", "The above b-spline can be represented using the 6 coefficients. Imagine if we created a b-spline approximation for all 811 time series in our original data-set. We would have a 811x6 matrix, much lower dimension than our original 811x52 dataset.", "By running K-means with different values of K, we see that there are a couple of good options for K, but let\u2019s stick with K=2 for simplicity", "Now, lets take a random sample of our original time series and see how they were clustered with K=2", "As we had originally spotted by eye, K-means distinguished between the products with consistent sales and products with large, sporadic spikes. By selecting different values of K, we could also identify different trends in the time series. Let\u2019s take a look at K=5", "Further, we can multiply the centroids of our clusters by the basis to see the average time series of each cluster.", "B-splines provide an efficient way to represent time series with only a few data points. This comes in handy when we are trying to aggregate a collection of hundreds, thousands, or millions of time series.", "In this example, we used b-splines to perform segmentation. We found interesting similarities and segments of time series that could be used to inform product decisions. But the same b-spline approximation could have been used for classification or regression.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F16468f588ea6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----16468f588ea6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@roryjmichelen?source=post_page-----16468f588ea6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@roryjmichelen?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Rory Michelen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd404005cf9ab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&user=Rory+Michelen&userId=d404005cf9ab&source=post_page-d404005cf9ab----16468f588ea6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@srd844?utm_source=medium&utm_medium=referral", "anchor_text": "Stephen Dawson"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly", "anchor_text": "this one on the UCI Repository"}, {"url": "https://github.com/RoryMichelen/Medium-Articles/blob/master/Clustering_w_B_Splines.rmd#L42-L56", "anchor_text": "https://github.com/RoryMichelen/Medium-Articles/blob/master/Clustering_w_B_Splines.rmd#L42-L56"}, {"url": "https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly", "anchor_text": "https://archive.ics.uci.edu/ml/datasets/Sales_Transactions_Dataset_Weekly"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----16468f588ea6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/clustering?source=post_page-----16468f588ea6---------------clustering-----------------", "anchor_text": "Clustering"}, {"url": "https://medium.com/tag/data-science?source=post_page-----16468f588ea6---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----16468f588ea6---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&user=Rory+Michelen&userId=d404005cf9ab&source=-----16468f588ea6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&user=Rory+Michelen&userId=d404005cf9ab&source=-----16468f588ea6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F16468f588ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----16468f588ea6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----16468f588ea6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----16468f588ea6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----16468f588ea6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----16468f588ea6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----16468f588ea6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@roryjmichelen?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@roryjmichelen?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rory Michelen"}, {"url": "https://medium.com/@roryjmichelen/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "15 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd404005cf9ab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&user=Rory+Michelen&userId=d404005cf9ab&source=post_page-d404005cf9ab--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fce1a7c6bb81a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-b-splines-and-k-means-to-cluster-time-series-16468f588ea6&newsletterV3=d404005cf9ab&newsletterV3Id=ce1a7c6bb81a&user=Rory+Michelen&userId=d404005cf9ab&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}