{"url": "https://towardsdatascience.com/load-a-large-spacy-model-on-aws-lambda-e1999e5e24b5", "time": 1683010272.863426, "path": "towardsdatascience.com/load-a-large-spacy-model-on-aws-lambda-e1999e5e24b5/", "webpage": {"metadata": {"title": "Load a Large spaCy model on AWS Lambda | by Hiroki Nakayama | Towards Data Science", "h1": "Load a Large spaCy model on AWS Lambda", "description": "spaCy is a useful tool that allows us to perform many natural language processing tasks. When integrating spaCy into an existing application, it is convenient to provide it as an API using AWS Lambda\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "Lambda\u2019s limitations", "paragraph_index": 0}, {"url": "https://aws.amazon.com/jp/blogs/aws/new-a-shared-file-system-for-your-lambda-functions/", "anchor_text": "recently released feature to mount Elastic File System (EFS) on AWS Lambda", "paragraph_index": 1}, {"url": "https://github.com/Hironsan", "anchor_text": "https://github.com/Hironsan", "paragraph_index": 24}], "all_paragraphs": ["spaCy is a useful tool that allows us to perform many natural language processing tasks. When integrating spaCy into an existing application, it is convenient to provide it as an API using AWS Lambda and API Gateway. However, due to Lambda\u2019s limitations, it is hard to deploy large models.", "In this article, I will show you how to deploy spaCy using the recently released feature to mount Elastic File System (EFS) on AWS Lambda. By using this feature, we can store a large size model to EFS and load it from Lambda functions. Specifically, it is possible to load data larger than the space available in Lambda\u2019s/tmp (512MB).", "The overall architecture is as follows. Lambda loads the spaCy package on Lambda Layers. EFS stores the spaCy models. Lambda then loads the models from EFS. For redundancy, four subnets are placed on two different availability zones.", "First of all, we must configure VPC that can reach the EFS mount targets. Here, we create a VPC, an internet gateway, two NAT gateway, and four subnets(two public, two private).", "In the VPC console, I select Create VPC and set a Name tag and IPv4 CIDR block as follows:", "In the next step, I create an internet gateway to connect the Internet from the VPC with the following settings. After that, I attach it to the created VPC.", "In the next step, I create four subnets(public-spacy-1, public-spacy-2, private-spacy-1, private-spacy-2) with the following settings. Notice that public-spacy-1 and private-spacy-1 have the same availability zone.", "Then, I create two NAT gateways and attach it to public subnets to access the Internet from a lambda function in the private subnet. I gave NAT gateways names: NAT spaCy 1 and NAT spaCy 2.", "Finally, I create route tables. For public subnets, I add a destination 0.0.0.0/0 and a target Internet Gateway to access the Internet. For private subnets, I add a destination 0.0.0.0/0 and a target NAT spaCy 1 for private-spacy-1 and NAT spaCy 2 for private-spacy-2.", "In the EFS console, I select Create file system and make sure that the default VPC and its subnets are selected. For all subnets, I use a security group that allows network access to other resources in the VPC. For simplicity, I set up a security group that allows all traffic.", "In the next step, I give the file system a Name tag and select the Next Step.", "Then, I select Add access point. I use 1001 for the User ID, Group ID, Owner User ID and Owner Group ID and 750 for the permissions. Also, I limit access to the /models path.", "EFS creation is complete. Let\u2019s go to the next step.", "In the next step, we publish spaCy as Lambda Layers. We must do the following things:", "For simplicity, I prepared the following shell script:", "You have only to execute it like sh publish_spacy_as_lambda_layer.sh.", "Next, we create a Lambda function. In the Lambda console, create a function and select Python 3.7 as the runtime. For permissions, select a role that is attached policiesAWSLambdaVPCAccessExecutionRole and AmazonElasticFileSystemClientReadWriteAccess.", "After creating a function, we set up the VPC configuration. Here, we need to specify the same security group and VPC we specified for the EFS mount points and select the private subnets.", "Then, we select the Add file system. We select the ESF and access point that has been created before. Here, we set /mnt/models as the local mount point. This is the path where the access point is mounted and corresponds to the /models directory in the EFS.", "In the layer section, we select Add a layer to add spaCy.", "In the function editor, copy and paste the following code.", "Finally, we should increase the memory allocation and timeout values. If the memory allocation is not large enough, the following error will occur.", "As a test, when I test with the data {\"text\": \"He works at Google.\"}, the following response will be returned.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Open source developer. Interested in machine learning and natural language processing. GitHub: https://github.com/Hironsan"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe1999e5e24b5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@Hironsan?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Hironsan?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Hiroki Nakayama"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb4f20f71312b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&user=Hiroki+Nakayama&userId=b4f20f71312b&source=post_page-b4f20f71312b----e1999e5e24b5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/wiki/File:Paul_Cezanne_Apples_and_Oranges.jpg", "anchor_text": "Wikimedia"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "Lambda\u2019s limitations"}, {"url": "https://aws.amazon.com/jp/blogs/aws/new-a-shared-file-system-for-your-lambda-functions/", "anchor_text": "recently released feature to mount Elastic File System (EFS) on AWS Lambda"}, {"url": "https://aws.amazon.com/jp/blogs/aws/new-a-shared-file-system-for-your-lambda-functions/", "anchor_text": "New \u2014 A Shared File System for Your Lambda Functions"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "AWS Lambda limits"}, {"url": "https://blog.scottlogic.com/2019/05/11/spacy-ner.html", "anchor_text": "Natural Language Processing in Cloud"}, {"url": "http://geoffpg.com/spacy-and-lambda/", "anchor_text": "Creating a Serverless NLP API using Spacy and AWS Lambda"}, {"url": "https://medium.com/tag/natural-language-process?source=post_page-----e1999e5e24b5---------------natural_language_process-----------------", "anchor_text": "Natural Language Process"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e1999e5e24b5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/spacy?source=post_page-----e1999e5e24b5---------------spacy-----------------", "anchor_text": "Spacy"}, {"url": "https://medium.com/tag/aws?source=post_page-----e1999e5e24b5---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----e1999e5e24b5---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&user=Hiroki+Nakayama&userId=b4f20f71312b&source=-----e1999e5e24b5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&user=Hiroki+Nakayama&userId=b4f20f71312b&source=-----e1999e5e24b5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe1999e5e24b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e1999e5e24b5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e1999e5e24b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Hironsan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Hironsan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Hiroki Nakayama"}, {"url": "https://medium.com/@Hironsan/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "288 Followers"}, {"url": "https://github.com/Hironsan", "anchor_text": "https://github.com/Hironsan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb4f20f71312b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&user=Hiroki+Nakayama&userId=b4f20f71312b&source=post_page-b4f20f71312b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F40554091ebf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-a-large-spacy-model-on-aws-lambda-e1999e5e24b5&newsletterV3=b4f20f71312b&newsletterV3Id=40554091ebf&user=Hiroki+Nakayama&userId=b4f20f71312b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}