{"url": "https://towardsdatascience.com/how-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5", "time": 1682994772.4295502, "path": "towardsdatascience.com/how-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5/", "webpage": {"metadata": {"title": "How to Beat Google\u2019s AutoML - Hyperparameter Optimisation with Flair | by Tadej Magajna | Towards Data Science", "h1": "How to Beat Google\u2019s AutoML - Hyperparameter Optimisation with Flair", "description": "This is a follow-up to our previous post about State of the Art Text Classification. We explain how to do hyperparameter optimisation using Flair Python NLP library to achieve optimal results in text\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "State of the Art Text Classification", "paragraph_index": 0}, {"url": "https://papers.nips.cc/paper/4443-algorithms-for-hyper-parameter-optimization.pdf", "anchor_text": "Tree-structured Parzen Estimator", "paragraph_index": 6}, {"url": "https://towardsdatascience.com/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "State of the Art Text Classification", "paragraph_index": 9}, {"url": "https://github.com/zalandoresearch/flair/blob/master/flair/hyperparameter/parameter.py", "anchor_text": "here", "paragraph_index": 14}, {"url": "https://medium.com/@tadejmagajna/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "just like we did in part 1", "paragraph_index": 28}], "all_paragraphs": ["This is a follow-up to our previous post about State of the Art Text Classification. We explain how to do hyperparameter optimisation using Flair Python NLP library to achieve optimal results in text classification outperforming Google\u2019s AutoML Natural Language.", "Hyperparameter optimisation (or tuning) is the process of choosing a set of optimal parameters for a machine learning algorithm. Data preprocessors, optimisers and ML algorithms all receive a set of parameters that guide their behaviour. To achieve optimal performance they need to be tuned to fit the statistical properties, type of features and size of the dataset used. The most typical hyperparameters in deep learning include learning rate, number of hidden layers in a deep neural network, batch size, dropout\u2026", "In NLP we also encounter a number of other hyperparameters often to do with preprocessing and text embedding such as type of embedding, embedding dimension, number of RNN layers\u2026", "Typically, if we\u2019re lucky enough to have a problem simple enough to only require one or two hyperparameters with a few discrete values (like k in k-means for example), we can simply try all possible options. But with increasing number of parameters the trial and error approach becomes difficult.", "Our search space grows exponentially with the number of parameters tuned.", "Assuming discrete options, this means that if we have 8 parameters where each parameter has 10 discrete options we end up with 10\u2078 possible combinations of hyperparameters. This makes hand-picking parameters unfeasible assuming training a model usually requires a considerable amount of time and resources.", "There are many hyperparameter optimisation techniques such as grid search, random search, bayesian optimisation, gradient methods and finally TPE. Tree-structured Parzen Estimator (TPE) is the method we used in Flair\u2019s wrapper around Hyperopt - a popular Python hyperparameter optimisation library.", "Flair provides a simple API to tune your text classifier parameters. We need to, however, tell it what kinds of hyperparameters it needs to tune and what values it should consider for them.Running the optimiser is not harder than training the classifier itself, but it requires significantly more time and resources as it essentially executes training a large number of times. Therefore it\u2019s advisable to run this on GPU accelerated hardware.", "We will perform hyperparameter optimisation of a text classifier model trained on Kaggle SMS Spam Collection Dataset learning to differentiate between spam and not-spam messages.", "To prepare the dataset please refer to the \u201cPreprocessing \u2014 Building the Dataset\u201d section of State of the Art Text Classification where we obtain train.csv, test.csv and dev.csv. Make sure datasets are stored in same directory as the script running Flair.", "You can check whether you have a GPU available for training by running:", "It returns a boolean indicating whether CUDA is available for PyTorch (on top of which Flair is written).", "The first step of hyperparameter optimisation will most likely include defining the search space. This means defining all the hyperparameters we want to tune and whether the optimiser should only consider a set of discrete values for them or search in a bounded continuous space.", "And for uniform continuous parameters use:", "A list of all possible parameters can be seen here.", "Next you will need to specify some parameters referring to the type of text classifier we want to use and how many training_runs and epochs to run.", "Note that DEV_SCORE is set as our optimisation value. This is extremely important because we don\u2019t want to optimise our hyperparameters based on the test set as that would cause overfitting.", "Finally, we run param_selector.optimize(search_space, max_evals=100) which will execute 100 evaluations of the optimiser and save our results to resources/results/param_selection.txt", "Full source code to run the whole process is as follows:", "Our search space includes learning rate, document embedding hidden size, number of document embedding RNN layers, dropout value and batch size. Note that despite using only one type of word embedding (a stack of news-forward, news-backward, and GloVe) we still had to pass it to search space as it is a required parameter.", "The optimiser ran for about 6 hours on a GPU and executed 100 evaluations. The final results were written to resources/results/param_selection.txt.", "The last few lines display the best parameter combination as shown below:", "Based ontest_score from the tuning results confirmed by a few further evaluations we achieved a test f1-score of 0.9923 (99.23%)!", "This means we outperformed Google\u2019s AutoML by a tiny margin.", "hint: if precision = recall thenf-score = precision =recall", "Does this mean I will always be able to achieve state-of-the art results following this guide?", "Short answer: no. The guide should give you a good idea about how to use Flair\u2019s hyperparameter optimiser and is not a comprehensive comparison of NLP text classification frameworks. Using the approaches described will certainly yield results comparable to other state-of-the art frameworks but they will vary depending on the dataset, what preprocessing methods are used and what hyperparameter search space is defined.", "Note that when choosing the best parameter combination, Flair takes into account both loss and variance of results obtained. Therefore, the model with the lowest loss and highest f1-score will not necessarily be selected as best.", "To use the best performing parameters on an actual model you need to read the optimal parameters from param_selection.txt and manually copy them one by one to the code that will train our model just like we did in part 1.", "While we are extremely happy with the library, it would be much nicer to be able to have the optimal parameters available in a more code-friendly format, or even better, have an option to simply export the optimal model during optimisation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3b2f5092d9f5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tadejmagajna?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tadejmagajna?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Tadej Magajna"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F43246c2d9cb0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&user=Tadej+Magajna&userId=43246c2d9cb0&source=post_page-43246c2d9cb0----3b2f5092d9f5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "State of the Art Text Classification"}, {"url": "https://papers.nips.cc/paper/4443-algorithms-for-hyper-parameter-optimization.pdf", "anchor_text": "Tree-structured Parzen Estimator"}, {"url": "https://towardsdatascience.com/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "State of the Art Text Classification"}, {"url": "https://github.com/zalandoresearch/flair/blob/master/flair/hyperparameter/parameter.py", "anchor_text": "here"}, {"url": "https://medium.com/@tadejmagajna/text-classification-with-state-of-the-art-nlp-library-flair-b541d7add21f", "anchor_text": "just like we did in part 1"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3b2f5092d9f5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/nlp?source=post_page-----3b2f5092d9f5---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----3b2f5092d9f5---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/python?source=post_page-----3b2f5092d9f5---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----3b2f5092d9f5---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "http://creativecommons.org/publicdomain/zero/1.0/", "anchor_text": "No rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&user=Tadej+Magajna&userId=43246c2d9cb0&source=-----3b2f5092d9f5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&user=Tadej+Magajna&userId=43246c2d9cb0&source=-----3b2f5092d9f5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3b2f5092d9f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3b2f5092d9f5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3b2f5092d9f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tadejmagajna?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tadejmagajna?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tadej Magajna"}, {"url": "https://medium.com/@tadejmagajna/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "710 Followers"}, {"url": "https://www.linkedin.com/in/tadej-magajna/", "anchor_text": "https://www.linkedin.com/in/tadej-magajna/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F43246c2d9cb0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&user=Tadej+Magajna&userId=43246c2d9cb0&source=post_page-43246c2d9cb0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd9d767fc72fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-beat-automl-hyperparameter-optimisation-with-flair-3b2f5092d9f5&newsletterV3=43246c2d9cb0&newsletterV3Id=d9d767fc72fb&user=Tadej+Magajna&userId=43246c2d9cb0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}