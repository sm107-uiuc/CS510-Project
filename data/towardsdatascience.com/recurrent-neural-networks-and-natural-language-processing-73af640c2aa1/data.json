{"url": "https://towardsdatascience.com/recurrent-neural-networks-and-natural-language-processing-73af640c2aa1", "time": 1682996573.4936352, "path": "towardsdatascience.com/recurrent-neural-networks-and-natural-language-processing-73af640c2aa1/", "webpage": {"metadata": {"title": "Recurrent Neural Networks and Natural Language Processing. | by Christopher Thomas BSc Hons. MIAP | Towards Data Science", "h1": "Recurrent Neural Networks and Natural Language Processing.", "description": "RNNs are ideal for solving problems where the sequence is more important than the individual items themselves. An RNNs is essentially a fully connected neural network that contains a refactoring of\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["RNNs are ideal for solving problems where the sequence is more important than the individual items themselves.", "An RNNs is essentially a fully connected neural network that contains a refactoring of some of its layers into a loop. That loop is typically an iteration over the addition or concatenation of two inputs, a matrix multiplication and a non-linear function.", "Among the text usages, the following tasks are among those RNNs perform well at:", "Other tasks that RNNs are effective at solving are time series predictions or other sequence predictions that aren\u2019t image or tabular based.", "There has been several highlighted and controversial reports in the media over the advances in text generation, in particular OpenAI\u2019s GPT-2 algorithm. In many cases the generated text is often indistinguishable from text written by humans.", "I found learning how RNNs function and how to construct them and their varients has been among the most difficult topics I have had to learn. I would like to thank the Fastai team and Jeremy Howard for their courses explaining the concepts in amore understandable order, which I\u2019ve followed in this article\u2019s\u00a0explanation.", "RNNs effectively have an internal memory that allows the previous inputs to affect the subsequent predictions. It\u2019s much easier to predict the next word in a sentence with more accuracy, if you know what the previous words were.", "Often with tasks well suited to RNNs, the sequence of the items is as or more important than the previous item in the sequence.", "As I\u2019m typing the draft for this on my smart phone, the next word suggested by my phone\u2019s keyboard will be predicted by an RNN. For example, the swift key keyboard software uses RNNs to predict what you are typing.", "Natural Language Processing (NLP) is a sub-field of computer science and artificial intelligence, dealing with processing and generating natural language data. Although there is still research that is outside of the machine learning, most NLP is now based on language models produced by machine learning.", "NLP is a good use case for RNNs and is used in the article to explain how RNNs can be constructed.", "The aim for a language model is to minimise how confused the model is having seen a given sequence of text.", "It is only necessary to train one language model per domain, as the language model encoder can be used for different purposes such as text generation and multiple different classifiers within that domain.", "As the longest part of training is usually creating the language model encoder, reusing the encoder can save significant training time.", "If we take a sequence of three words of text and a network that predicts the fourth word.", "The network has three hidden layers, each of which are an affine function (for example a matrix dot product multiplication), followed by a non-linear function then the last hidden layer is followed by an output from the last layer activation function.", "The input vectors representing each word in the sequence are lookups in a word embedding matrix, based on a one hot encoded vector representing the word in the vocabulary. Note that all inputted words use the same word embedding. In this context a word is actually a token that could represent a word or a punctuation mark.", "The output will be a one hot encoded vector representing the predicted fourth word in the sequence.", "The first hidden layer takes a vector representing the first word in the sequence as an input and the output activations serve as one of the inputs into the second hidden layer.", "The second hidden layer takes the input from the activations of the first hidden layer and also an input of the second word represented as a vector. These two inputs could be either added or concatenated together.", "The third hidden layer follows the same structure as the second hidden layer, taking the activation from the second hidden layer combined with the vector representing the third word in the sequence. Again, these inputs are added or concatenated together.", "The output from the last hidden layer goes through an activation function that produces an output representing a word from the vocabulary, as a one hot encoded vector.", "This second and third hidden layer could both use the same weight matrix, opening the opportunity of refactoring this into a loop to become recurrent.", "The vocabulary is a vector of numbers, called tokens where each token represents one of the unique words or punctuation symbols in our corpus.", "Usually words that don\u2019t occur at least twice in the texts making up the corpus usually aren\u2019t included, otherwise the vocabulary would be too large. I wonder if this could be used as a factor for detecting generating text, looking for the presence of words not common in the given domain.", "A word embedding is a matrix of weights, with a row for each word/token in the vocabulary", "Matrix dot product multiplication with a one hot encoded vector outputs a row of the matrix representing activations from that word. It is essentially a row lookup in the matrix and is computationally more efficient to do that, this is called an embedding lookup.", "Using the vector from the word embedding helps prevent the resulting activations being very sparse. As if the input was the one hot encoded vector, which is all zeros apart from one element, the majority of the activations would also be zero. This would then be difficult to train.", "For the network to be recurrent, a loop needs to be factored into the network\u2019s model. It makes sense to use the same embedded weight matrix for every word input. This means we can replace the second and third layers with iterations within a loop.", "Each iteration of the loop takes an input of a vector representing the next word in the sequence with the output activations from the last iteration. These inputs are added or concatenated together.", "The output from the last iteration is a representation of the next word in the sentence being put through the last layer activation function which converts it to a one hot encoded vector representing a word in the vocabulary.", "This allows the network to predict a word at the end of a sequence of any arbitrary length.", "Once at the end of the sequence of words, the predicted output of the next word could be stored, appended to an array, to be used as additional information in the next iteration. Each iteration then has access to the previous predictions.", "For a given number of inputs there are the same number of outputs created.", "In theory the sequence of predicted text could be infinite in length, with a predicted word following the last predicted word in the loop.", "With each new batch the history of the previous batch\u2019s sequence, the state, is often lost. Assuming the sentences are related, this may lose important insights.", "To aid the prediction when we start each batch, it is helpful to know the history of the last batch rather than reset it. This retains the state and hence the context, this results in an understanding of the words that is a better approximation.", "Note with some datasets such as one-billion-words each sentence isn\u2019t related to the previous one, in this case this may not help as there is no context between sentences.", "Back propagation through time (BPTT) is the sequence length\u00a0used\u00a0during\u00a0training. If we were trying to train on sequences of 50 words, the BPTT would be 50.", "Usually the document is split into 64 equal sections. In this case the BPTT is the document length in words divided by 64. If the document length in words is 3200 then that divided by 64 gives a BPTT of 50.", "It\u2019s beneficial to slightly randomise the BPTT value for each sequence to help improve the model.", "To get more layers of computation to be able to solve or approximate more complex tasks, the output of the RNN could be fed into another RNN, or any number of layers of RNNs. The next section explains how this can be done.", "As the number of layers of RNNs increases the loss landscape and can become impossible to train, this is the vanishing gradient problem. To solve this problem a Gated Recurrent Unit (GRU) or a Long Term Short Term Memory (LSTM) network can be used.", "LSTMs and GRUs take the current input and previous hidden state, then compute the next hidden state.", "As part of this computation, the sigmoid function squashes the values of these vectors between 0 and 1, and by multiplying them elementwise with another vector you define how much of that other vector you want to \u201clet through\u201d", "An RNN has short term memory. When used in combination with Long Short Term Memory (LSTM) Gates, the network can have long term memory.", "Instead of the recurring section of an RNN, an LTSM is a small neural network consisting of four neural network layers. These are the recurring layer from the RNN with three networks acting as gates.", "An LSTM also has a cell state as well, along side the hidden state. This cell state is the long term memory. Rather than just returning the hidden state at each iteration, a tuple of hidden states are returned comprised of the cell state and hidden state.", "Long Short Term Memory (LSTM) has three gates.", "A gated recurrent unit is sometimes referred to as a gated recurrent network.", "At the output of each iteration there is a small neural network with three neural networks layers implemented, consisting of the recurring layer from the RNN, a reset gate and an update gate. The update gate acts as a forget and input gate. The coupling of these two gates performs a similar function as the three gates forget, input and output in an LSTM.", "Compared to an LSTM, a GRU has a merged cell state and hidden state, whereas in an LSTM these are separate.", "The reset gate takes the input activations from last layer, these are multiplied by a reset factor between 0 and 1. The reset factor is calculated by a neural network with no hidden layer (like a logistic regression), this performs a dot product matrix multiplication between a weight matrix and the addition/concatenation of the previous hidden state and our new input. This is then all put through the sigmoid function e^x / (1 + e^x).", "This can learn to do different things in different situations, for example to forget more information if there\u2019s a full stop token.", "The update gate controls how much of the new input to take and how much of the hidden state to take. This is a linear interpolation. This is 1 \u2014 Z multiplied by the previous hidden state plus Z multiplied by the new hidden state. This controls to what degree we keep information from the previous states and to what degree we use information from the new state.", "The update gate is often represented as a switch in diagrams, although the gate can be in any position to create a linear interpolation between the two hidden states.", "This depends entirely on the task in question, it is often worth trying both to see which can perform better.", "In text classification the prediction of the network is to classify which group or groups the text belongs to. A common use is classifying if the sentiment of a piece of text is positive or negative.", "If an RNN is trained to predict text from a corpus within a given domain as in the RNN explanation earlier in this article, it is close to ideal to be re-purposed for text classification within that domain. The generation \u2018head\u2019 of the network is removed leaving the \u2018backbone\u2019 of the network. The weights within the backbone can then be frozen. A new classification head can then be attached to the backbone and trained to predict the required classifications.", "It can be a very effective method to speed up training to gradually unfreeze the weights within the layers. Starting with the weights of the last two layers, then the weights of the last three layers, and finally all unfreeze all of the layers\u2019 weights.", "The wikitext 103 dataset contains over 103 million tokens from good or featured tokens from Wikipedia.", "A pretrained model is available trained on the wikitext 103 dataset, this can be used for transfer learning for almost any language processing task. It is much closer to any written text than any random initialisation ever could be. It\u2019s one of those contradictions to the no free lunch theory. Most of the time it gets the algorithm close to the solution before you\u2019ve even started training.", "I would like to thank the Fastai team whose courses have helped cement my deep learning and RNN knowledge providing an excellent base for further learning and understanding.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F73af640c2aa1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@christopher-thomas?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christopher-thomas?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Christopher Thomas BSc Hons. MIAP"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36b521478fa9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&user=Christopher+Thomas+BSc+Hons.+MIAP&userId=36b521478fa9&source=post_page-36b521478fa9----73af640c2aa1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/lxujDxNigL4", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----73af640c2aa1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----73af640c2aa1---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----73af640c2aa1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&user=Christopher+Thomas+BSc+Hons.+MIAP&userId=36b521478fa9&source=-----73af640c2aa1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&user=Christopher+Thomas+BSc+Hons.+MIAP&userId=36b521478fa9&source=-----73af640c2aa1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F73af640c2aa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----73af640c2aa1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----73af640c2aa1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----73af640c2aa1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----73af640c2aa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christopher-thomas?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@christopher-thomas?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Christopher Thomas BSc Hons. MIAP"}, {"url": "https://medium.com/@christopher-thomas/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "569 Followers"}, {"url": "https://uk.linkedin.com/in/christhomasuk", "anchor_text": "https://uk.linkedin.com/in/christhomasuk"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36b521478fa9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&user=Christopher+Thomas+BSc+Hons.+MIAP&userId=36b521478fa9&source=post_page-36b521478fa9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd1857471e6d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-networks-and-natural-language-processing-73af640c2aa1&newsletterV3=36b521478fa9&newsletterV3Id=d1857471e6d&user=Christopher+Thomas+BSc+Hons.+MIAP&userId=36b521478fa9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}