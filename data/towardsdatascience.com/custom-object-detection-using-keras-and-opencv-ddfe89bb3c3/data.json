{"url": "https://towardsdatascience.com/custom-object-detection-using-keras-and-opencv-ddfe89bb3c3", "time": 1683015178.511116, "path": "towardsdatascience.com/custom-object-detection-using-keras-and-opencv-ddfe89bb3c3/", "webpage": {"metadata": {"title": "Object Detection: Stopping Karens Before They Can Strike With Keras and OpenCV | by Samuel Mohebban | Towards Data Science", "h1": "Object Detection: Stopping Karens Before They Can Strike With Keras and OpenCV", "description": "I will show you how to create a neural network that can detect whether someone is wearing a mask, or if they are indeed a Karen ready to strike. This project uses Python, Keras, and OpenCV."}, "outgoing_paragraph_urls": [{"url": "https://github.com/HeeebsInc/FaceMaskEmotionDetection", "anchor_text": "GitHub", "paragraph_index": 1}, {"url": "https://www.linkedin.com/in/samuel-mohebban-b50732139/", "anchor_text": "LinkedIn", "paragraph_index": 21}, {"url": "https://github.com/HeeebsInc/FaceMaskEmotionDetection", "anchor_text": "GitHub", "paragraph_index": 22}], "all_paragraphs": ["In the age of COVID-19, we have seen that wearing masks can substantially decrease the spread of the virus. However, as we sometimes see online, there are a lot of people that strongly disagree with this statement. Videos online show people becoming very disgruntled when they are asked to follow this protocol. In this project, I will show you how to create a neural network that can detect whether someone is wearing a mask, and if they are not, we will detect the facial expression on their face. With more scale, this can be applied to local businesses so that managers can detect whether someone is wearing a mask and whether they are indeed a Karen ready to strike.", "**The code for this tutorial can be found on my GitHub**", "The first step to this project is to build a neural network that can detect whether a person is wearing a mask. For this portion, we will use Mobilenet.", "Before we build the model, we need to extract each image and preprocess it so that it can be fed into Mobilenet. In the dataset above, we see that there are three directories in the outermost layer: (1) Train, (2) Test, and (3) Validation. Below is the code for how to extract each image, preprocess them for mobilenet, and save them to a NumPy array.", "After running the cell above, you should see a window like this.", "In the later sections, we will reuse the function get_image_value, which is why we pass a parameter stating which model type it should retrieve the image for.", "Now that we have the image values, it is time to build the neural network that will be used to detect the mask. Make sure you have a folder called ModelWeights inside the current directory. In this folder, we will save the weights for each model that we train.", "Above, we specified that the model should train for 2000 epochs. Because the model likely does not need 2000 epochs, we included an early stopping parameter to prevent the model from overfitting after 5 consecutive iterations with no change in the loss. After running the cell above, you should see a window like this:", "After the training is complete, you should see a .h5 file within the ModelWeights folder named Mobilenet_Masks.h5. In this file, the weights for the model are stored and will be used later on when we apply this neural network to live video.", "Above, we see the ROC score, confusion matrix, and loss/accuracy for the mobilenet training. Considering the amount of data we used, these metrics are pretty good. For the validation set, only 13 images were incorrectly classified. As for the loss and accuracy, the loss was able to go below .1 and the accuracy was well above 94%. Finally, the ROC score shows great success as each class had a perfect score of 1.0, while F1 scores for each class were greater than .98.", "Like the last model, we must first start by extracting the image values and placing them into a NumPy array. Like I mentioned earlier, we will reuse the get_image_value function within a new function designed to extract only the emotion images. The dataset contains 7 classes: angry, happy, neutral, sad, disgust, fear, and surprise. For this project, we will only be focusing on the first 3 classes: angry, happy, and neutral. Also, the model that we will use for training will take an input image with size (48,48,3), which is much smaller than mobilenet dimensions of (224,224,3).", "As you can see above, we limited each class to include only a maximum of 4000 images. This was performed so that training would be faster and so that we could properly track the performance with equal class balance.", "After running the code above, you should see a similar window as before that looks like this:", "Now that we have the train test split arrays, we will build the neural network that will detect the emotion on a person\u2019s face. Below is the code for how to build this neural network. Unlike mobilenet, we will not apply augmentation to the dataset.", "After running the code above, you should see a window like this:", "Once the training is complete, you should find a .h5 file called Normal_Emotions.h5 which will contain the weights for the model. Like the previous model we trained, this will be used for the live video portion below.", "Above, we see the ROC score, confusion matrix, and loss/accuracy for the emotion model. Considering the amount of data we used, these metrics are pretty good, but not as good as mobilenet. For the training set, only 1,786 images were incorrectly classified out of the ~12,000. As for the loss and accuracy, the loss was able to go below .7 and the accuracy stayed between 70\u201375%. Finally, the ROC score shows pretty good success as each class maintained a score greater than .9, while F1 scores for each class were between .7 and .9.", "Now that we have each model trained, we will apply them both to live video using OpenCV. For this portion, you must have a webcam set up on you local machine.", "Before we get into the code, let me first explain the steps for how this work.", "Below is the code for how it would work. At first glance, it seems like there are a lot of conditions within the for loop, but just read it slowly and it will make sense.", "Once you run the code above, a window should pop up like the one below. To Stop this process, press the \u2018q\u2019 button on your keyboard.", "Also, I am currently looking for a job in Data Science so if you have any advice on that front please reach out to me via LinkedIn!", "*The code for this tutorial can be found on my GitHub**", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Senior Machine Learning Engineer | BA George Washington University | MS Stevens Institute of Technology"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fddfe89bb3c3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@HeeebsInc?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Samuel Mohebban"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf4b32fe258&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&user=Samuel+Mohebban&userId=caf4b32fe258&source=post_page-caf4b32fe258----ddfe89bb3c3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://media.giphy.com/media/j1svspDN51FBUeQpFz/giphy.gif", "anchor_text": "Giphy"}, {"url": "https://github.com/HeeebsInc/FaceMaskEmotionDetection", "anchor_text": "GitHub"}, {"url": "https://www.kaggle.com/ashishjangra27/face-mask-12k-images-dataset?select=Face+Mask+Dataset", "anchor_text": "Kaggle"}, {"url": "https://www.kaggle.com/msambare/fer2013", "anchor_text": "Kaggle"}, {"url": "https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_objdetect/py_face_detection/py_face_detection.html", "anchor_text": "haar cascade classifier"}, {"url": "https://github.com/HeeebsInc/FaceMaskEmotionDetection/blob/master/ModelWeights/haarcascade_frontalface_default.xml", "anchor_text": "download link"}, {"url": "https://www.linkedin.com/in/samuel-mohebban-b50732139/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/HeeebsInc/FaceMaskEmotionDetection", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ddfe89bb3c3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----ddfe89bb3c3---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----ddfe89bb3c3---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/keras?source=post_page-----ddfe89bb3c3---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----ddfe89bb3c3---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&user=Samuel+Mohebban&userId=caf4b32fe258&source=-----ddfe89bb3c3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&user=Samuel+Mohebban&userId=caf4b32fe258&source=-----ddfe89bb3c3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fddfe89bb3c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ddfe89bb3c3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ddfe89bb3c3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@HeeebsInc?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Samuel Mohebban"}, {"url": "https://medium.com/@HeeebsInc/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "63 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf4b32fe258&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&user=Samuel+Mohebban&userId=caf4b32fe258&source=post_page-caf4b32fe258--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe57400756dca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-keras-and-opencv-ddfe89bb3c3&newsletterV3=caf4b32fe258&newsletterV3Id=e57400756dca&user=Samuel+Mohebban&userId=caf4b32fe258&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}