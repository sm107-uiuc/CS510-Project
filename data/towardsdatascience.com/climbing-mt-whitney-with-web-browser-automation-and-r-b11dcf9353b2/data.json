{"url": "https://towardsdatascience.com/climbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2", "time": 1683000787.584485, "path": "towardsdatascience.com/climbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2/", "webpage": {"metadata": {"title": "Climbing Mt. Whitney with web browser automation and R | by Sebastian Wolf | Towards Data Science", "h1": "Climbing Mt. Whitney with web browser automation and R", "description": "A friend of mine had a time window of two weeks to get a permit for Mt Whitney. I did not really know about this mountain until he came up with the trip. Mt. Whitney is located in California and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.recreation.gov/permits/233260", "anchor_text": "website", "paragraph_index": 0}, {"url": "https://earlconf.com/#speakers", "anchor_text": "EARLconf", "paragraph_index": 1}, {"url": "https://github.com/ropensci/RSelenium/blob/master/vignettes/docker.Rmd", "anchor_text": "vignette approach", "paragraph_index": 2}, {"url": "https://github.com/zappingseb/mtwhitney", "anchor_text": "GitHub repository (zappingseb/mtwhitney)", "paragraph_index": 23}, {"url": "https://github.com/ropensci/RSelenium", "anchor_text": "RSelenium", "paragraph_index": 29}, {"url": "https://blog.rstudio.com/2018/10/18/shinytest-automated-testing-for-shiny-apps/", "anchor_text": "shinytest", "paragraph_index": 29}, {"url": "https://www.mail-wolf.de", "anchor_text": "https://www.mail-wolf.de", "paragraph_index": 32}], "all_paragraphs": ["A friend of mine had a time window of two weeks to get a permit for Mt Whitney. I did not really know about this mountain until he came up with the trip. Mt. Whitney is located in California and 14,505 ft (4,421 m) above sea level. As a lot of people want to go there every year. The USDA Forest Service decided to limit the number of permits to hike the mountain. To get a permit, you simply go to this website and check if your date with the # of hikers is available.", "You will notice pretty fast, that if you are not an early bird, all permits for your desired date are gone. Now you have three choices. One, resign and don\u2019t hike the mountain. Two, check the website by yourself every day, to see if new or returned permits are available. Three, get a bot or browser automation to work that checks the permits for you. My friend decided to ask me for the third option. And as I have some experience with RSelenium (just recently presented at EARLconf), I wanted to try this approach.", "First I wanted to run my bot on the cloud. Moreover, I wanted to get a reproducible environment. So I decided to follow the vignette approach of RSelenium. This means using a docker container for Selenium. So my first task was to spin up two docker containers. The first one should run Selenium, the second one should run R and python to access it.", "Spinning up the Selenium container is simple:", "I used a shared network between the docker containers called mynet . This allows the two docker containers to find each other in the network, even by names.", "The second docker container must consist of three files.", "The Dockerfile needs to look like this:", "I used tidyverse docker container and installed the RSelenium package. Additionally, I installed python secure-smtplib and email . I also already added a cronjob to my docker container. This cronjob will run the web crawler every twelve hours by:", "Now I would like to spin up the docker container. But my sendmail.py and run_tests.R files were missing. Let\u2019s create them", "To use RSelenium you first need to connect to the Selenium server. It runs in the other docker container. To connect to it run:", "The name seleniumcontainer will be automatically identified as long as the container runs inside mynet. Two steps will lead to the Mt. Whitney permit website. Opening a browser and navigating to the website:", "The much harder part is to find the elements to click on. So first I noticed, that I need to click on the option \u201cAll Routes\u201d, which was the third one from the dropdown menu:", "This option can be accessed by its id . This id is division-selection . By clicking on the element with the id , the dropdown will open. After the dropdown is open, you need to click on the 3rd option element available on the website. With these 4 lines of code you can realize it using RSelenium:", "As you can see findElements returns a list of webElements with the desired attributes. clickElement is a method of such a webElement and will basically click the element.", "This was the easiest part of browser automation steps. The much harder part is entering the number of hikers. The safest way to change them is not only to type into the text field but also to use javascript to change its value. The field number-input- will be used for this.", "To change the value I used the following code:", "You can clearly see that I wanted one single permit for the mountain. The javascript piece ran on the webElement itself, which was stored in el_3[[1]] . For RSelenium I prefer finding elements with the remDr$findElements method. Afterward, I take the first piece if I am sure that there is just a single element. The methods clearElement and sendKeysToElement remove old values and enter the value needed. The API of sendKeysToElement is a bit weird, as it requires a list of keys, instead of a string. But once used, it is easy to keep your code.", "After these steps, the calendar with permits gets activated. I wanted to get a permit in October 2019. So I needed to click on \u201cNEXT\u201d until October shows up.", "I build a loop to perform this task using the while command", "The element containing the month was had the tag class=\"CalendarMonth_caption\"><strong>...</ . I accessed this with a CSS selector. Upon clicking the next button, which had a specific CSS class, a new calendar name shows up. It took me a while to find out that the old calendar month is not gone. Now the second element has to be checked for the name. So I overwrite the month variable with the newly shown up heading of the calendar.", "Finding an available day as a human is simple. Just look at the calendar and search for blue boxes with an A inside:", "For a computer, it is not that easy. In my case, I just had one question to answer. What is the first date in October 2019 to climb Mt. Whitney?", "Thus I searched for any entry with the class rec-available-day . In case any entry was there, I got the text of the first one and took all characters before a line-break. This extracted the number of the date. Now, wrap this up and send an email with the date:", "Once the script was finished I wrapped up all files in my GitHub repository (zappingseb/mtwhitney). They will help me by sending an email every 12 hours. From there I went back to my docker server and git cloned the repository. I could then spin up my docker container by running:", "and test the script one time by connecting to the docker container:", "I got an email. After receiving the email I was sure the script will run and disconnected using Ctrl + p and Ctrl + q .", "Scripting this piece really got me an email with a free slot and a permit to climb Mt Whitney:", "Browser automation can be helpful for use cases like this one. It helped me to get a permit. I did not overengineer it by scraping the website every few seconds or checking for specific dates. It was more of a fun project. You can think of a lot of ways to make it better. For example, it could send an email, if a date is available. But I wanted to get the log files every 12 hours, to see if something went wrong.", "During the scraping, the website got updated once. So I received an error message from my scraper. I changed the script to the one presented in this blog post. The script may not work if you want to scrape Mt.Whitney pages tomorrow. Recreation.gov might have changed the website already.", "I use browser tests to make my R-shiny apps safer. I work in a regulated environment and there these tests safe me a lot of time. This time I would have spent click-testing without such great tools as RSelenium or shinytest. Try it out and enjoy your browser doing the job for you.", "Note from the author: You could have done all this in pure python code as well. I am just more familiar with RSelenium and the tidyverse docker container. It made my life easier.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "software developer, data enthusiast, traveler and biostatistician \u2014 posting to https://www.mail-wolf.de"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb11dcf9353b2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@zappingseb?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zappingseb?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Sebastian Wolf"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdbc9f652035a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&user=Sebastian+Wolf&userId=dbc9f652035a&source=post_page-dbc9f652035a----b11dcf9353b2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.flickr.com/photos/cloudchaser32000/26630353105", "anchor_text": "Dan Eckert"}, {"url": "https://www.recreation.gov/permits/233260", "anchor_text": "website"}, {"url": "https://earlconf.com/#speakers", "anchor_text": "EARLconf"}, {"url": "https://docs.docker.com/engine/reference/commandline/build/", "anchor_text": "How to start a docker container"}, {"url": "https://docs.ropensci.org/RSelenium/articles/docker.html", "anchor_text": "Some basics in RSelenium"}, {"url": "https://developers.google.com/web/tools/chrome-devtools", "anchor_text": "How to use Chrome or Firefox Developer Tools"}, {"url": "https://github.com/ropensci/RSelenium/blob/master/vignettes/docker.Rmd", "anchor_text": "vignette approach"}, {"url": "https://gist.github.com/zappingseb/6d65f7d27ce85185c785613f83a8036f", "anchor_text": "https://gist.github.com/zappingseb/6d65f7d27ce85185c785613f83a8036f"}, {"url": "https://github.com/zappingseb/mtwhitney", "anchor_text": "GitHub repository (zappingseb/mtwhitney)"}, {"url": "https://github.com/ropensci/RSelenium", "anchor_text": "RSelenium"}, {"url": "https://blog.rstudio.com/2018/10/18/shinytest-automated-testing-for-shiny-apps/", "anchor_text": "shinytest"}, {"url": "https://towardsdatascience.com/travis-ci-for-r-advanced-guide-719cb2d9e0e5", "anchor_text": "Travis CI for R \u2014 Advanced guide"}, {"url": "https://towardsdatascience.com/rtest-pretty-testing-of-r-packages-50f50b135650?source=---------9------------------", "anchor_text": "Pretty testing of R packages"}, {"url": "https://medium.com/datadriveninvestor/how-to-get-people-r-ready-in-an-hour-thors-hammer-d8c853abaf0b?source=---------16------------------", "anchor_text": "How to get people R ready in an hour"}, {"url": "https://medium.com/tag/hiking?source=post_page-----b11dcf9353b2---------------hiking-----------------", "anchor_text": "Hiking"}, {"url": "https://medium.com/tag/r?source=post_page-----b11dcf9353b2---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/selenium?source=post_page-----b11dcf9353b2---------------selenium-----------------", "anchor_text": "Selenium"}, {"url": "https://medium.com/tag/browser-automation?source=post_page-----b11dcf9353b2---------------browser_automation-----------------", "anchor_text": "Browser Automation"}, {"url": "https://medium.com/tag/national-park-tour?source=post_page-----b11dcf9353b2---------------national_park_tour-----------------", "anchor_text": "National Park Tour"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&user=Sebastian+Wolf&userId=dbc9f652035a&source=-----b11dcf9353b2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&user=Sebastian+Wolf&userId=dbc9f652035a&source=-----b11dcf9353b2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb11dcf9353b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b11dcf9353b2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b11dcf9353b2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zappingseb?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zappingseb?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sebastian Wolf"}, {"url": "https://medium.com/@zappingseb/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "108 Followers"}, {"url": "https://www.mail-wolf.de", "anchor_text": "https://www.mail-wolf.de"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdbc9f652035a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&user=Sebastian+Wolf&userId=dbc9f652035a&source=post_page-dbc9f652035a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc4ab8fb694f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclimbing-mt-whitney-with-web-browser-automation-and-r-b11dcf9353b2&newsletterV3=dbc9f652035a&newsletterV3Id=c4ab8fb694f1&user=Sebastian+Wolf&userId=dbc9f652035a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}