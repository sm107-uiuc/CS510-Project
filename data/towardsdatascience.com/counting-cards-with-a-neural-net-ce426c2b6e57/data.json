{"url": "https://towardsdatascience.com/counting-cards-with-a-neural-net-ce426c2b6e57", "time": 1683014145.144705, "path": "towardsdatascience.com/counting-cards-with-a-neural-net-ce426c2b6e57/", "webpage": {"metadata": {"title": "Counting Cards With A Neural Net. Can Machine Learning Successfully Bring\u2026 | by Tony Yiu | Towards Data Science", "h1": "Counting Cards With A Neural Net", "description": "Here are the links to my previous posts on blackjack. I used a modified version of my old blackjack simulator (discussed in detail in the linked posts). If you want to know more about how I coded it\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/yiuhyuk/blackjack", "anchor_text": "You can find my code on my Github here.", "paragraph_index": 0}, {"url": "https://tonester524.medium.com/membership", "anchor_text": "https://tonester524.medium.com/membership", "paragraph_index": 22}], "all_paragraphs": ["You can find my code on my Github here.", "Here are the links to my previous posts on blackjack. I used a modified version of my old blackjack simulator (discussed in detail in the linked posts). If you want to know more about how I coded it up or just need a refresher on basic blackjack strategy, you can read these first:", "One thing that perplexed me last year when I trained a neural net to play blackjack was why my neural net didn\u2019t do better when I provided card counting information to it. Doesn\u2019t card counting confer a significant advantage to the player?", "For those unfamiliar with the concept, counting cards is a way of tracking the number of high cards (10, Jack, Queen, King, Ace) left in the deck. The idea is that when there are a lot of face cards left in the deck, it\u2019s advantageous to players (because we are more likely to be dealt high cards and the dealer is also more likely to bust). So if our card counting tips us off that the remaining cards are more likely to be high, we should take advantage by making larger than normal bets.", "When I tried to integrate card counting into my blackjack code last year, it failed to add anything because I did it incorrectly. The model that I built previously took in information like the cards in the player\u2019s hand and the card that the dealer is showing and decided whether to keep hitting or stay.", "I attempted to augment my model by providing it with a detailed count of all the cards that had been seen thus far as part of its training data (the count is refreshed every time that the deck is reshuffled). I figured that the count would allow the neural net to predict when the dealer was likely to bust \u2014 and this additional information would improve its hit/stay decision making.", "Surprisingly, this was not what happened. The performance actually got worse! The win probability dropped from 42% without card counting data to 38% with it. The tie probability also drops from 9% to 5% hinting at a more aggressive playing style.", "As you can see below, when given card count data, the neural net is able to do ever so slightly better in terms of probability of a win or tie when the dealer is showing a low card but significantly underperforms its simpler (no card count data) predecessor when the dealer is showing a 10 or an ace (11 denotes ace). The probabilities in the following plots were generated by simulating approximately 250,000 blackjack games with trained neural nets deciding whether to hit or stay.", "If we isolate out just the games where the dealer is showing a 10, face card, or an ace we can see the cause of the underperformance. Our supposedly smarter neural net (the one with the card count data) is doing some pretty dumb things. Looking at the blue bars in the plot below, we can see that it chooses to hit frequently even when it already holds a high hand total of 17 or more (it even hits occasionally when it\u2019s already at 20). Contrast that to our simpler model \u2014 it correctly knows to stay for hands totaling 17 or more.", "It\u2019s not all bad. Earlier we saw that adding card count data improves the winning probability when the dealer is showing a low card (6 or less). Intuitively, the reason for this is that when the dealer is showing a low card, the dealer will definitely have to hit until his hand totals at least 17 (or he or she busts). So having knowledge of when the dealer is more likely to bust should prove somewhat helpful in these situations. And as we can see, the behavior of our card counting neural net is different. It is much more likely to stay for hands totaling 13, 14, and 15 \u2014 and based on the higher win probabilities, it seems to be on average making the right decision in these cases.", "Still, the overall decline in win probability is disappointing. Choosing to hit when our hand is already at 19 or 20 is a big facepalm. Based on our examination of how the neural net\u2019s behavior changed once we added in card count data, it looks like while the additional data embeds some signal, it also caused our model to become overfit and make some foolish decisions. So let\u2019s attempt to fix this.", "When I went back and reviewed how counting cards actually worked, I realized I was thinking about it wrong. The additional features offer limited assistance in terms of helping our model know whether to hit or stay. In fact, as we saw, the added features were more likely to confuse the model than help it. But where the card count data might be able to help us is in deciding how much to bet. If we know that there are a lot of high cards left in the deck, we should bet more because the probability of blackjack (two card hand consisting of an ace and a 10 or a face card) is higher. Conversely, if we know that the remaining cards consist primarily of low cards, we should just make the minimum bet.", "In order to do this, instead of shoving everything into a single model, we can split up the responsibilities. We could have our old model that already worked pretty well handle the hit or stay decision and build a new model which uses the card count data to decide how much to bet. It would look something like what\u2019s pictured below. A note on the card count features \u2014 I keep a count of how many of each card type I\u2019ve seen thus far and when the dealer reshuffles the deck (or stack) I reset all the counts to 0.", "Of course all this depends on whether the card count data truly does help us predict blackjacks. Let\u2019s check. We can use a ROC curve to check the efficacy of neural net 2 (if you need a refresher on what ROC curves are, check out the following link).", "Judging by the higher area under its ROC curve (blue line), neural net 2 does seem to add value (relative to deciding randomly):", "So let\u2019s use it to size our bets and see if our performance improves. I simulated 100 blackjack decks (like a long night at the casino) 100 times and compared the average results and distributions between the following two betting strategies:", "Here\u2019s how I decided to size the bets (full disclosure \u2014 I didn\u2019t think super hard about this decision rule):", "Basically if the predicted probability of getting a blackjack is higher than average, I bet more \u2014 and the excess amount that I bet is determined by how much higher than average the predicted probability is.", "Cool, let\u2019s see if we can actually improve our gambling results. The following plot compares gambling performance with and without neural net 2. While it looks like we still aren\u2019t able to consistently make money, the dynamic bet sizing does improve our performance. The mean ending bankroll with dynamic bet sizing is 12% higher than without it.", "Finally, let\u2019s compare the distributions of our ending bankrolls to make sure our dynamic (and larger) bets is not causing excessive volatility in our betting results. The shape of the distributions seem reasonably similar with the dynamic bet sizing one (blue) slightly shifted to the right, which is good.", "I was hoping for a bigger boost, but oh well. It looks like more tinkering is necessary, but at least it looks like we are onto something. It also goes to show that as cool and versatile as deep learning models can be, it still pays to be thoughtful about and to sanity check (as much as we can) the way our model works. Finally, winning when the odds are stacked against you is hard! Cheers!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist. Founder Alpha Beta Blog. Doing my best to explain the complex in plain English. Support my writing: https://tonester524.medium.com/membership"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fce426c2b6e57&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tonester524.medium.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": ""}, {"url": "https://tonester524.medium.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Tony Yiu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F840a3210fbe7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&user=Tony+Yiu&userId=840a3210fbe7&source=post_page-840a3210fbe7----ce426c2b6e57---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@exxteban?utm_source=medium&utm_medium=referral", "anchor_text": "Esteban Lopez"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/yiuhyuk/blackjack", "anchor_text": "You can find my code on my Github here."}, {"url": "https://towardsdatascience.com/lets-play-blackjack-with-python-913ec66c732f", "anchor_text": "Let\u2019s Play Blackjack (with Python)We Implement a Blackjack Simulator in Python to Better Understand the Risks of Going to Vegastowardsdatascience.com"}, {"url": "https://towardsdatascience.com/teaching-a-neural-net-to-play-blackjack-8ec5f39809e2", "anchor_text": "Teaching A Neural Net To Play BlackjackWe Train a Neural Net to See Whether Applying Deep Learning Can Improve Our Blackjack Strategytowardsdatascience.com"}, {"url": "https://towardsdatascience.com/roc-curves-and-the-efficient-frontier-7bfa1daf1d9c", "anchor_text": "ROC Curves and the Efficient FrontierExplaining how to interpret ROC Curves using a pinch of financetowardsdatascience.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ce426c2b6e57---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ce426c2b6e57---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----ce426c2b6e57---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/technology?source=post_page-----ce426c2b6e57---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ce426c2b6e57---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&user=Tony+Yiu&userId=840a3210fbe7&source=-----ce426c2b6e57---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&user=Tony+Yiu&userId=840a3210fbe7&source=-----ce426c2b6e57---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fce426c2b6e57&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ce426c2b6e57---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ce426c2b6e57--------------------------------", "anchor_text": ""}, {"url": "https://tonester524.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tonester524.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tony Yiu"}, {"url": "https://tonester524.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "102K Followers"}, {"url": "https://tonester524.medium.com/membership", "anchor_text": "https://tonester524.medium.com/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F840a3210fbe7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&user=Tony+Yiu&userId=840a3210fbe7&source=post_page-840a3210fbe7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F78d3e392d884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcounting-cards-with-a-neural-net-ce426c2b6e57&newsletterV3=840a3210fbe7&newsletterV3Id=78d3e392d884&user=Tony+Yiu&userId=840a3210fbe7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}