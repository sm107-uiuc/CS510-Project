{"url": "https://towardsdatascience.com/from-0-to-continuously-delivered-machine-learning-971a707345cf", "time": 1683001186.3610098, "path": "towardsdatascience.com/from-0-to-continuously-delivered-machine-learning-971a707345cf/", "webpage": {"metadata": {"title": "From 0 to Continuously Delivered Machine Learning | by Massimo Belloni | Towards Data Science", "h1": "From 0 to Continuously Delivered Machine Learning", "description": "I am probably a Machine Learning Engineer. This field is quite new and all the job titles are pretty much a joke to me. The boundaries between a Data Scientist, an AI Specialist or a ML Engineer are\u2026"}, "outgoing_paragraph_urls": [{"url": "https://housinganywhere.com/", "anchor_text": "my company\u2019s", "paragraph_index": 0}, {"url": "https://medium.com/data-science-housinganywhere/how-to-do-data-science-on-an-evolving-website-5fdec1c995da", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/detecting-scams-using-ai-for-real-6c96e712cf09", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/random-thoughts-on-my-first-ml-deployment-8e8c89df047f", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://www.linkedin.com/in/duc-anh-bui-b58521171/", "anchor_text": "Duc Anh Bui", "paragraph_index": 21}], "all_paragraphs": ["I am probably a Machine Learning Engineer. This field is quite new and all the job titles are pretty much a joke to me. The boundaries between a Data Scientist, an AI Specialist or a ML Engineer are quite blurred, and the one that you choose to put on your LinkedIn really follows personal preferences or the personal preferences of who hired you. Whatever you say you are when you first introduce yourself to people, doesn\u2019t much change your day to day job in the vast majority of the companies: you collect data, train models, test their performances and eventually, if you are lucky \u2014 yes, more than good \u2014 you deploy them, probably on the cloud. In the last couple of months though, I have been focusing more and more on the technical aspects of my company\u2019s Machine Learning products than on their task-specific performances. My team and I have put a lot of effort in getting them in a good shape, very often without real impact on their final users or on our business (directly, at least).", "If I look back to when this whole journey started, it is really impressive where we currently are, considering both the impact that we have as a team in our operations and the technical maturity of our products and people. It didn\u2019t start like this though and to get to this point we went through a very linear progression that allowed us to gain traction, support and knowledge. This post won\u2019t cover all the preliminary steps needed to have something ready to be deployed, I already did that here, here and somehow also here, but rather would try to shed some light on what happens next and what worked fine for us in getting to the stage where we happily are now.", "Getting off the ground as soon as possible is key. The goal of this first stage should be allowing the stakeholders to evaluate the model\u2019s impact, and the deployment doesn\u2019t need to be fancy to achieve so. The only thing that cannot be overlooked is a solid process for collecting and comparing business metrics once the model is live. Even the best model of the history of Machine Learning won\u2019t have any success in the industry if there doesn\u2019t exist a way to prove that it is useful. Very often these metrics are not even technical but are more likely to be related to the efficiency of a team or a department. In our case, for example, we allowed our CS (Customer Solution) department to spend 50% less time on a task and increased their effectiveness of 80%. And the classifier F1 was quite poor at that time, to be honest. Ideally, we wish to have a perfectly deployed model in a completely controllable and measurable environment, but this is never the case, especially in the early stages of a data team. In this bargaining scenario, it is better to trade off on the former than on the latter.", "Ideally, we wish to have a perfectly deployed model in a completely controllable and measurable environment, but this is never the case, especially in the early stages of a data team.", "The amount of good engineering practices you can ignore is very dependent on the engineering culture of your company. I mean, a Machine Learning model is a Python function. You need theoretically 30 seconds to expose it as a Flask API on a local machine by enabling port forwarding on your router. Luckily, our Ops Team is very strong and did a great job in allowing us to employ some cutting edge cloud technologies quite easily.", "Our first deployment consisted of a single pod on Kubernetes. The pod contained three different containers: the API, an async task queue (Celery) and a Redis database to allow communication between the two.", "The model used in the prediction tasks was stored in one of the Docker images. We didn\u2019t have any solid process in place to retrain it and, in the case, we needed to build and push the whole image again. We were not collecting any technical metric (number of executed jobs, prediction job latency, etc) and we didn\u2019t have any staging environment releasing directly in production. I am not proud of it. But honestly we never felt the need of having more. If we tried to fix all these possible issues before the first deployment we would have never probably had the impact we had and we would have lost motivation and traction along the way.", "If all went well and all your hypotheses of having deployed something actually useful were true, it is very likely that your model (now product \u2014 fancier) will become business critical. Also, business critical is quite a buzzword. The easiest way to understand if it is already the case is by trying to think about what happens if your product, for some reasons, messes up. If it is bad, you are somehow business critical. We crossed that line as soon as we integrated our technology with our core platform. If you break something on the platform, users can feel it.", "The easiest way to understand if your product is business critical is by trying to think about what happens if it messes up for some reason.", "First thing we did was that of starting to release on a staging environment. Testing machine learning products is tricky and it is probably impossible to have a full coverage of the use cases before safely releasing in production, but being sure that all the technical components and the basic flows work fine is crucial to avoid serious issues. If something breaks no one will notice it. Sounds obvious, of course, and it is, but it would have been useless to engineer something like this, when we weren\u2019t even sure if our deployment would have survived the month. It is interesting that the engineering best practices developed in the last 30 years not only fit perfectly in this new domain, but that we actually felt the need for them along the process. We didn\u2019t employ them just because someone asked us to do so.", "It is interesting that the engineering best practices developed in the last 30 years not only fit perfectly in this new domain, but that we actually felt the need for them along the process.", "On the same line is monitoring. We already had in place a very robust strategy to assess business-related performances, as said, but we were completely unaware of the state of our deployment engineering-wise. How long does it take to complete a prediction job? Do we need to add more resources to the pod? How many jobs are executed per day? Is the percentage of the predicted labels somehow constant? For a classical API these metrics are collected from the beginning, and it is a really bad practice to release anything without them. We felt the urgency along the process, and we got to the same final result.", "In our company we were already using Prometheus and Grafana for monitoring and it made sense of course to use those tools also for our projects. The ephemeral nature of the jobs required a little bit of engineering effort though, having to deploy and take ownership over a Prometheus Pushgateway to store these metrics and expose them to the shared Prometheus server. With the help of the QA team we then defined alerts and created some nice graphs. We are now employing the best strategies in order not to mess up, but if it happens we are the first to know, at least.", "The biggest asset of a data product is the model that is powering it. After a couple of different ML deployments we realised that apart from a small custom part mainly related to the sample creation process, the vast majority of the code needed for setting up the server and the prediction process is pretty much the same. On another level, deploying the models with Docker was also causing a lot of useless work, having to build big images defined in complex Dockerfile just to change a very small subset of the resources that is not strictly dependent on the actual way in which it is used. The model and the prediction logic can be decoupled and their release process should be different and not synchronised.", "The model and the prediction logic can be decoupled and their release process should be different and not synchronised.", "Therefore, we decided to split the API and task queue from the model and related files. We improved our code in order to retrieve these resources asynchronously when the prediction process starts, fetching them from a cloud object storage (GCS, in our case). Of course, this improvement also needed a new image for the processing logic, but we didn\u2019t release any new version since then. Serving a new model is now indeed a matter of storing it in the bucket and raising a PR in our configuration repository, employing the same GitOps approach we used during the whole evolution of this project.", "This step has empowered us to retrain the models as often as we wanted with very little effort. The task of releasing a model\u2019s version though is the very difference that a deployment in this domain has from the classical engineering deployments. It is quite straightforward (even if complex and somehow boring) to describe flows and write tests. If a release candidate passes them, it is good to go. For data products is very different. It\u2019s of course possible to check if the job scheduling logic is behaving as expected, but telling if a listing is a scam is a completely different matter.", "What we needed at this point was a way to be sure (enough) that a retrained model would have performed on live data as good as the currently deployed, ideally better. Of course, serving the models in parallel for a couple of days and monitoring their performances worked fine, but the time and effort needed to perform the task frequently started to be a bottleneck for our team. In the majority of our settings a simple offline performances estimation is not enough to validate the model, being the data sent for prediction possibly different from the one that can be retrieved from our data sources some days after. We designed a task-specific testing framework that exposes the retrained model to the same data that the deployed model used. Employing a smart strategy in defining the training dates we can simulate the model\u2019s release and measure a very reliable estimation of the actual performances of the retrained version in 10 seconds, not 2 days. A very granular logging policy has been crucial to achieve this goal: all the stages and results of the prediction process are stored and can be accessed when needed.", "We scheduled a bi-weekly cronjob that creates a pod and retrains the model, possibly saving it if the release simulation goes well and notifying the team about the results. The new model is then released (staging first, production later) editing the configuration file on Kubernetes. The pod containing the prediction logic is restarted and fetches the retrained version from the bucket, completely agnostic about its content.", "Our current setting allows us to fully focus on improving the actual machine learning engine with a very clear separation of responsibilities. This whole process took roughly 8 months and we managed to keep serving our users fine without any downtime or delay. How much of all this has been noticed by them? Zero, probably. Machine Learning engineering, if exists, is probably this: doing stuff on data products that end users don\u2019t notice but that make the world a better place to live in.", "Machine Learning engineering, if exists, is probably this: doing stuff on data products that end users don\u2019t notice but that make the world a better place to live in.", "A lot of this stuff wouldn\u2019t have been possible without the help of Duc Anh Bui.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F971a707345cf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://massibelloni.medium.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": ""}, {"url": "https://massibelloni.medium.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Massimo Belloni"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4e623cf1c796&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&user=Massimo+Belloni&userId=4e623cf1c796&source=post_page-4e623cf1c796----971a707345cf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@rxcroes?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Raoul Croes"}, {"url": "https://unsplash.com/s/photos/rotterdam?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://housinganywhere.com/", "anchor_text": "my company\u2019s"}, {"url": "https://medium.com/data-science-housinganywhere/how-to-do-data-science-on-an-evolving-website-5fdec1c995da", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/detecting-scams-using-ai-for-real-6c96e712cf09", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/random-thoughts-on-my-first-ml-deployment-8e8c89df047f", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/duc-anh-bui-b58521171/", "anchor_text": "Duc Anh Bui"}, {"url": "https://medium.com/tag/data-science?source=post_page-----971a707345cf---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----971a707345cf---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/engineering?source=post_page-----971a707345cf---------------engineering-----------------", "anchor_text": "Engineering"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----971a707345cf---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----971a707345cf---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&user=Massimo+Belloni&userId=4e623cf1c796&source=-----971a707345cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&user=Massimo+Belloni&userId=4e623cf1c796&source=-----971a707345cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F971a707345cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----971a707345cf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----971a707345cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----971a707345cf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----971a707345cf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----971a707345cf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----971a707345cf--------------------------------", "anchor_text": ""}, {"url": "https://massibelloni.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://massibelloni.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Massimo Belloni"}, {"url": "https://massibelloni.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "443 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4e623cf1c796&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&user=Massimo+Belloni&userId=4e623cf1c796&source=post_page-4e623cf1c796--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd607a9e5bd7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-0-to-continuously-delivered-machine-learning-971a707345cf&newsletterV3=4e623cf1c796&newsletterV3Id=d607a9e5bd7d&user=Massimo+Belloni&userId=4e623cf1c796&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}