{"url": "https://towardsdatascience.com/deploying-a-python-sql-engine-to-your-cluster-76a590940977", "time": 1683017483.0598989, "path": "towardsdatascience.com/deploying-a-python-sql-engine-to-your-cluster-76a590940977/", "webpage": {"metadata": {"title": "Mix SQL and Machine Learning and leverage your computation cluster | by Nils Braun | Towards Data Science", "h1": "Mix SQL and Machine Learning and leverage your computation cluster", "description": "Even the best data does not matter if no one can access it. Therefore, it is crucial to make data accessible to everyone, without the need for them to learn complicated programming languages. This is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://nils-braun.medium.com/query-your-big-data-with-the-power-of-python-dask-and-sql-f1c5bb7dcdbe", "anchor_text": "SQL query engines", "paragraph_index": 0}, {"url": "https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page", "anchor_text": "NYC taxi data", "paragraph_index": 3}, {"url": "https://docs.dask.org/en/latest/setup.html", "anchor_text": "variety of computation systems", "paragraph_index": 3}, {"url": "https://twitter.com/sambit19/status/1336436070469275655", "anchor_text": "kernelcorn", "paragraph_index": 5}, {"url": "https://console.cloud.google.com/apis/api/container.googleapis.com/overview", "anchor_text": "Kubernetes Engine API", "paragraph_index": 6}, {"url": "https://cloud.google.com/sdk/install", "anchor_text": "gcloud", "paragraph_index": 6}, {"url": "https://cloud.google.com/compute/docs/regions-zones/#available", "anchor_text": "near you", "paragraph_index": 7}, {"url": "https://helm.sh/docs/intro/install/", "anchor_text": "helm", "paragraph_index": 8}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment", "anchor_text": "git repository", "paragraph_index": 9}, {"url": "http://localhost:8888.", "anchor_text": "http://localhost:8888.", "paragraph_index": 13}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment", "anchor_text": "repository", "paragraph_index": 14}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment/blob/main/dask-sql/files/run.py#L25", "anchor_text": "take a look", "paragraph_index": 17}, {"url": "https://xgboost.readthedocs.io/en/latest/", "anchor_text": "xgboost", "paragraph_index": 18}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment/blob/main/dask-sql/files/run.py#L46", "anchor_text": "file", "paragraph_index": 18}], "all_paragraphs": ["Even the best data does not matter if no one can access it. Therefore, it is crucial to make data accessible to everyone, without the need for them to learn complicated programming languages. This is a problem, that SQL query engines try to solve. They allow everyone with some SQL knowledge to get access to data stored in typical big data systems.", "Problem solved? Maybe not. Because in many cases, your data does not live in a nice-to-access data lake like S3. And the computations you want to apply to it are machine learning algorithms or other (typically Python-based) complex operations. That does not play well will the (typically) very strict and often Java-based SQL query engines, such as presto, Apache Impala or Apache Hive.", "dask-sql (disclaimer: I am the author) is a young SQL query engine built on top of dask, a distributed computation framework written purely in Python and playing very well with the Python ecosystem, such as the ML frameworks you love. It allows you to use normal SQL, e.g. from your favorite BI tool, and query data living in the Python space. In the background, your calculations are distributed on a cluster of machines \u2014 but this complexity is carefully hidden from you.", "In this blog post, we will deploy dask-sql to a Kubernetes (k8s) cluster and use it to query parts of the NYC taxi data and apply some Machine Learning to it. Additional to dask-sql and the Dask cluster (to run the calculations), we will deploy Apache Hue as an example for a BI tool. Dask plays well with a variety of computation systems (YARN, batch systems, k8s, etc.). We are using k8s, as it allows us to create a cluster in a public cloud provider very quickly for testing.", "For this blog post, we are going to deploy a k8s cluster on the Google Cloud. However, you can use any k8s cluster you want (on AWS, Azure, your own infrastructure).", "Update: As correctly mentioned by kernelcorn, you should take into account where your data lives to find a suitable location for your k8s cluster (otherwise you might pay both in performance and real money). We are querying data on AWS from GCP \u2014 which is fine for this example use case, but for any larger-scale use case you want to move your computation as closely as possible to your data.", "To follow along, log into your Google Cloud console (or register for a new account) and enable the Kubernetes Engine API. After that, create a reasonable-sized k8s cluster, e.g. by running the following in the cloud console (or your local computer after having installed and configured the gcloud utility and kubectl):", "Make sure to choose a compute zone near you and a reasonable cluster name (e.g. \u201cdask-sql\u201d). After the deployment, you should be able to see four running nodes in your cluster with", "Also, install helm (it is already installed on the Google Cloud console). If you don\u2019t know about helm, make sure to also check out its project page (but in short: it is for k8s, what pip is for python)", "Now we are ready to deploy our Dask cluster, dask-sql and Apache Hue as a frontend. To simplify the deployment, I have packaged up everything into a git repository. Clone it and deploy it using helm to the cluster", "The deployment will take some time (as it needs to download some data from S3). You can check with", "if all pods are already in \u201cready\u201d state. Once this is the case, access the Apache Hue BI tool by accessing the external IP printed on", "on port 8888 or \u2014 if you are deploying from your local computer \u2014 by making a port forwarding", "and accessing http://localhost:8888. The first username and password you type in will be used as the admin account. Now, wait for the database to show up in the \u201cPrestoSQL\u201d view on the left and start querying it! For example, you could run", "Let\u2019s take a step back to actually understand, what is going on here. We have deployed a small cluster of 6 Dask workers, a scheduler to control them, a dask-sql server, and Apache Hue. If you are interested, have a look into the repository to find out more.", "When you now enter a SQL query into Hue, it gets forwarded to the dask-sql server (which happens to speaks the presto wire protocol, even though it is not a presto server). dask-sql will parse the query and send it to the Dask cluster for computation, which will eventually fetch the data.", "Well, fine. But why is this so cool? Because you were using SQL, to not only trigger a complex distributed computation happening on a cluster of machines (which, by itself, is already cool) \u2014 you were even triggering a python computation. That is important because this opens up the possibility to (re)use your favorite python packages and functions.", "Take a closer look at the SQL example from above. Do you see the predict_price function? That does not look like a standard SQL function! And yes, if you take a look into the dask-sql/files/run.py file in the repository, you will see, it is a python function!", "It is using an already trained xgboost model, which is evaluated on the data, which is read from S3 (the data is preregistered, as you can see in the same file). And all of this is controlled from SQL \u2014 nice and clean without you even noticing it.", "What can you do with it? Imagine, all your data engineers need to do is to define the data samples and databases, which are registered in dask-sql. After that, everyone in your organization can start querying the data, if they just know a bit of SQL. No matter if your data lives on S3 or hdfs (which can also be done using e.g. Impala or presto), but also from any system and in any format \u2014 as long as you can read it with Python (which is true for basically everything). Additionally, you can trigger arbitrary, preregistered Python computations on this data from SQL: machine learning, custom computations you share between your Data Science and BI team, complex operations which are too complicated to be implemented in SQL directly, you name it. With this, you can close the gap between Business Analysts, Data Scientists, and Data Engineers and get important business insights on your (big) data even faster.", "This blog post described how you can get up and running with dask-sql on a kubernetes cluster and start querying your data with SQL. If you are interested in more details, here are some links to help start your journey:", "Make sure to delete your cluster after you are finished.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F76a590940977&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://nils-braun.medium.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": ""}, {"url": "https://nils-braun.medium.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": "Nils Braun"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3b92b7d7556c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&user=Nils+Braun&userId=3b92b7d7556c&source=post_page-3b92b7d7556c----76a590940977---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@daseine?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Fitore F"}, {"url": "https://unsplash.com/s/photos/library?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://nils-braun.medium.com/query-your-big-data-with-the-power-of-python-dask-and-sql-f1c5bb7dcdbe", "anchor_text": "SQL query engines"}, {"url": "https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page", "anchor_text": "NYC taxi data"}, {"url": "https://docs.dask.org/en/latest/setup.html", "anchor_text": "variety of computation systems"}, {"url": "https://twitter.com/sambit19/status/1336436070469275655", "anchor_text": "kernelcorn"}, {"url": "https://console.cloud.google.com/apis/api/container.googleapis.com/overview", "anchor_text": "Kubernetes Engine API"}, {"url": "https://cloud.google.com/sdk/install", "anchor_text": "gcloud"}, {"url": "https://cloud.google.com/compute/docs/regions-zones/#available", "anchor_text": "near you"}, {"url": "https://helm.sh/docs/intro/install/", "anchor_text": "helm"}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment", "anchor_text": "git repository"}, {"url": "http://localhost:8888.", "anchor_text": "http://localhost:8888."}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment", "anchor_text": "repository"}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment/blob/main/dask-sql/files/run.py#L25", "anchor_text": "take a look"}, {"url": "https://xgboost.readthedocs.io/en/latest/", "anchor_text": "xgboost"}, {"url": "https://github.com/nils-braun/dask-sql-k8s-deployment/blob/main/dask-sql/files/run.py#L46", "anchor_text": "file"}, {"url": "https://dask.org/", "anchor_text": "dask.org"}, {"url": "https://nils-braun.github.io/dask-sql/", "anchor_text": "https://nils-braun.github.io/dask-sql/"}, {"url": "https://dask-sql.readthedocs.io/", "anchor_text": "dask-sql.readthedocs.io"}, {"url": "https://medium.com/tag/dask?source=post_page-----76a590940977---------------dask-----------------", "anchor_text": "Dask"}, {"url": "https://medium.com/tag/python?source=post_page-----76a590940977---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/sql?source=post_page-----76a590940977---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----76a590940977---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&user=Nils+Braun&userId=3b92b7d7556c&source=-----76a590940977---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&user=Nils+Braun&userId=3b92b7d7556c&source=-----76a590940977---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F76a590940977&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----76a590940977---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----76a590940977--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----76a590940977--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----76a590940977--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----76a590940977--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----76a590940977--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----76a590940977--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----76a590940977--------------------------------", "anchor_text": ""}, {"url": "https://nils-braun.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://nils-braun.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nils Braun"}, {"url": "https://nils-braun.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "98 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3b92b7d7556c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&user=Nils+Braun&userId=3b92b7d7556c&source=post_page-3b92b7d7556c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7f5298962150&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-python-sql-engine-to-your-cluster-76a590940977&newsletterV3=3b92b7d7556c&newsletterV3Id=7f5298962150&user=Nils+Braun&userId=3b92b7d7556c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}