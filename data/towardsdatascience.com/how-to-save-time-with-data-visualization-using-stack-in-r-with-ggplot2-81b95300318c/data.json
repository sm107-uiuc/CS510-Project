{"url": "https://towardsdatascience.com/how-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c", "time": 1683018255.15627, "path": "towardsdatascience.com/how-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c/", "webpage": {"metadata": {"title": "How to Save Time with Data Visualization using Stack in R with ggplot2 | by Tyler Harris | Towards Data Science", "h1": "How to Save Time with Data Visualization using Stack in R with ggplot2", "description": "Use real European economic indicator data in R with stack, grep, ggplot, unique, and facet_wrap for data analysis and visualization"}, "outgoing_paragraph_urls": [{"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "my GitHub at this link", "paragraph_index": 2}, {"url": "https://ec.europa.eu/info/business-economy-euro/indicators-statistics/economic-databases/business-and-consumer-surveys/download-business-and-consumer-survey-data/time-series_en", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "RMD file from my GitHub", "paragraph_index": 6}, {"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "RMD file on my GitHub,", "paragraph_index": 32}, {"url": "http://arimasecurityresearch.com", "anchor_text": "arimasecurityresearch.com", "paragraph_index": 35}], "all_paragraphs": ["Have you ever had a data set with hundreds of columns that repeat and just need a simple way to get some useful plots of the data? Well, you are in the right place!", "In this project, I will show you the simplest and most effective tips and tricks that I have discovered to get ggplot to cooperate in R. Realistically, about 80% of the time spent on data analysis is just on getting the data and cleaning it up enough to be usable for what we need to do [1]. This means that the other 20% of the time is where the fun and (potentially) glorious part of the job occurs where we get to make some pretty graphs and interpret the results. Nobody really likes spending 80% of their time cleaning and finding data, so hopefully this project can help you cut down on the amount of time you spend mashing those buttons.", "For your convenience, I have made an R Markdown file (.rmd) available on my GitHub at this link if you would rather take a look through the notated code and run it cell by cell or clone it to your machine.", "To get started, make a new R Markdown file in your RStudio, use a regular .R file, or use a cloud version of R. We\u2019re not going to be too fancy here, so you should not have any issues. I am assuming that you can get an R environment working either in RStudio or in the cloud. Let me know if you are having problems in the responses at the end, and I will do what I can to help you troubleshoot the problem!", "First, we need to load tidyverse, lubridate, and readxl into our R environment. If you get an error about the packages not being recognized, uncomment (remove the #) before the install.packages() line(s) that you need.", "It would also benefit you to set your working directory into a folder that contains your file and has room to download a ~3MB .xlsx file. That can be done with the setwd() command or using RStudio to navigate the Files menu to the folder location and setting the working directory with the More drop down menu as shown below:", "Now we need to download the data. We are using some economic indicator data from the European Commission that has monthly data for each European country going back as far as 1985, which is over 480+ rows and 280+ columns. The link to the web page can be found here [2] or in the RMD file from my GitHub if you want to explore the EC\u2019s website a bit more to learn about the data.", "What we want is the \u201cSeasonally Adjusted Data (total sector)\u201d ZIP file. In R, we need to assign the link to the file to the url variable, create a temporary file, download the excel sheet, and unzip the data so we can use it.", "Note that the red text is not an error; it is just telling you that R is doing its thing.", "With the data unzipped and downloaded, we need to get it into our session in a way that makes R happy. Feel free to open the file in Excel (do not use Numbers on Mac or OpenOffice because of encoding issues!) on your computer if you like. We only need the MONTHLY sheet which can be defined in our import code.", "Again, the red text is normal. R is mad that some of the columns are completely empty. In the excel sheet, the formatting has blank columns separating some data for readability. We\u2019ll deal with that soon in the cleaning process.", "If we take a look at the newly created EuroData object in RStudio, we can see several formatting issues.", "One nice property of this data set is that the first column is the date to which every subsequent column is indexed. Before we do anything crazy, let\u2019s quickly change the column name to be more useful to us.", "To make our data a little easier to process, let\u2019s change it to a tibble for a bit.", "Next, let\u2019s fix the date column using the lubriate packages to format our column as a consistent year-month-day system while also making that column the right data type.", "Now, let\u2019s get into the nitty gritty details of cleaning. There are several columns that still have the \u201c\u2026#\u201d format, which is not helpful to us. We can use the grep() function to look for a pattern in some data. What I did here is make the remove_columns object be a vector of the results where grep() looks for any column name in the EuroData object where it is true that the name contains one or more numbers.", "Here\u2019s the output (type \u201cremove_columns\u201d into the Console):", "Since we have a vector of 35 column names that are just numbers with no data, let\u2019s remove them from the EuroData object. The code below takes the original EuroData object then looks for all the columns not in the remove_columns vector, which gives us a EuroData object with only the columns we want. Sure, it\u2019s a double negative, but it\u2019s simple and efficient.", "We now have to deal with a quirk of the data. It turns out that all those numbers in the other 245 columns are actually characters rather than numbers, which means that we cannot do any calculations until we fix that. Thankfully, we can use the mutate_if() function to find any columns that are characters and convert them to numeric data types.", "Again, don\u2019t worry about the red text. R is upset about introducing NA\u2019s. It doesn\u2019t actually matter because these are warning messages rather than error messages. You can just close them by clicking the little x on the right side. Everything is fine, I promise!", "The next step is a bit of preemptive preparation. We need to get the country abbreviations for reasons that will be clear in the next couple steps. To do this, I use the substr() function to get the first two characters in the column names from columns 2\u2013246 of the EuroData object then wrap that in the unique() function to remove duplicate data. All of that work goes inside a the c() function to make the results a vector.", "Here\u2019s the output (type \u201ccountry_abbvs\u201d into the Console):", "Now it is finally time to stack the data and change its structure. I am converting back to a data frame, explicitly naming the Date column, and using the stack() function on all but the Date column to reshape our data in a way that will make our lives much easier when plotting the data with ggplot() down the line. Let\u2019s take a look at the data now.", "Notice that we went from having 246 columns down to 3. All we have is a long, skinny table of values and identifiers indexed to dates. At first, this probably seems a little strange why we would do this. I did it because of how ggplot() takes data. When we make the plots, you will see how easy it is to automatically generate the right plots with stacked data. If you want to try to do this with the original data set, have fun but be prepared for a lot of frustration and wasted time", "When used judiciously, custom functions in R can save a ton of time. I made one called country_plot() that uses ggplot() to automatically subset the data to remove NA values, get the aesthetics (the aes() function) right, make the plot a line chart, create a linear model that draws a best-fit line through each plot while removing the standard error shading for readability, and using the facet_wrap() function to make all the sub plots on a single plot. I will show you how to use it soon after the last couple steps. Feel free to modify it if you want.", "There are a lot of countries in Europe. Let\u2019s us a for loop to filter, subset, and create data objects for each country.", "I know for loops in R get a bad rap, but it works and can easily be read, so we\u2019re using it here for simplicity\u2019s sake. We start with setting the loop to go from 1 to the length of the vector of country_abbvs because we will be looping through all 35 of them. The data_filter goes through the country abbreviations one at a time and gets only the data for that particular country. The country_subset_data object filters the entire EuroData object to only include the current country abbreviation. We finally assign(), using the paste0() function, the country abbreviation to its corresponding data.", "Here\u2019s the output (look at \u201cEnvironment\u201d in RStudio):", "Here\u2019s the output (click on one of the objects to see its structure):", "Notice here that there are a few with more data than there should be. It\u2019s a result of how the filtering process works. All but 4 came out right, so all we need to do is remove excess data from those before we start plotting.", "Finally! We can enjoy the fruits of our labor. Plotting the data for any country is super easy. We can use out custom country_plot() function with any of the country data objects to plot all seven indicators contained in the data set. Let\u2019s take a look a few of them.", "Here\u2019s the output (EU as a whole, Germany, and UK):", "In the RMD file on my GitHub, I have all the countries read to plot with the click of a button.", "If you care about European economic indicators, go ahead and read into what these numbers mean. The purpose of this project was to show a method that has saved me a ton of time to take large and complex sets of data then quickly plot that data in a way that makes sense. I hope this helps you save some time and generate more effective data visualizations!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Owner at arimasecurityresearch.com. I do consulting in and write about technology, IT certifications, programming, and business. Working on a PhD in IT."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F81b95300318c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tylerharris294.medium.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": ""}, {"url": "https://tylerharris294.medium.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Tyler Harris"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8d00211b0a6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&user=Tyler+Harris&userId=8d00211b0a6c&source=post_page-8d00211b0a6c----81b95300318c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@adamaszczos?utm_source=medium&utm_medium=referral", "anchor_text": "Adam Nowakowski"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "my GitHub at this link"}, {"url": "https://ec.europa.eu/info/business-economy-euro/indicators-statistics/economic-databases/business-and-consumer-surveys/download-business-and-consumer-survey-data/time-series_en", "anchor_text": "here"}, {"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "RMD file from my GitHub"}, {"url": "https://ec.europa.eu/economy_finance/db_indicators/surveys/documents/series/nace2_ecfin_2011/main_indicators_sa_nace2.zip'", "anchor_text": "https://ec.europa.eu/economy_finance/db_indicators/surveys/documents/series/nace2_ecfin_2011/main_indicators_sa_nace2.zip'"}, {"url": "https://github.com/ARIMA-Consulting/Stack_Wrap_Plot", "anchor_text": "RMD file on my GitHub,"}, {"url": "https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/?sh=2074b16c6f63", "anchor_text": "https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/?sh=2074b16c6f63"}, {"url": "https://ec.europa.eu/info/business-economy-euro/indicators-statistics/economic-databases/business-and-consumer-surveys/download-business-and-consumer-survey-data/time-series_en", "anchor_text": "https://ec.europa.eu/info/business-economy-euro/indicators-statistics/economic-databases/business-and-consumer-surveys/download-business-and-consumer-survey-data/time-series_en"}, {"url": "https://medium.com/tag/data-science?source=post_page-----81b95300318c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/r?source=post_page-----81b95300318c---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----81b95300318c---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/technology?source=post_page-----81b95300318c---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/education?source=post_page-----81b95300318c---------------education-----------------", "anchor_text": "Education"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&user=Tyler+Harris&userId=8d00211b0a6c&source=-----81b95300318c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&user=Tyler+Harris&userId=8d00211b0a6c&source=-----81b95300318c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F81b95300318c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----81b95300318c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----81b95300318c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----81b95300318c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----81b95300318c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----81b95300318c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----81b95300318c--------------------------------", "anchor_text": ""}, {"url": "https://tylerharris294.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tylerharris294.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tyler Harris"}, {"url": "https://tylerharris294.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "140 Followers"}, {"url": "http://arimasecurityresearch.com", "anchor_text": "arimasecurityresearch.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8d00211b0a6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&user=Tyler+Harris&userId=8d00211b0a6c&source=post_page-8d00211b0a6c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6b598c3ee8d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-save-time-with-data-visualization-using-stack-in-r-with-ggplot2-81b95300318c&newsletterV3=8d00211b0a6c&newsletterV3Id=6b598c3ee8d9&user=Tyler+Harris&userId=8d00211b0a6c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}