{"url": "https://towardsdatascience.com/using-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66", "time": 1682993410.700754, "path": "towardsdatascience.com/using-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66/", "webpage": {"metadata": {"title": "Using Deep Q-Learning in FIFA 18 to perfect the art of free-kicks | by Chintan Trivedi | Towards Data Science", "h1": "Using Deep Q-Learning in FIFA 18 to perfect the art of free-kicks", "description": "In my previous article, I presented an AI bot trained to play the game of FIFA using Supervised Learning technique. With this approach, the bot quickly learnt the basics of the game like passing and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/building-a-deep-neural-network-to-play-fifa-18-dce54d45e675", "anchor_text": "previous article", "paragraph_index": 0}, {"url": "http://youtube.com/c/DeepGamingAI", "anchor_text": "YouTube channel,", "paragraph_index": 8}, {"url": "https://medium.freecodecamp.org/deep-reinforcement-learning-where-to-start-291fb0058c01", "anchor_text": "this", "paragraph_index": 18}, {"url": "https://github.com/Sentdex/pygta5", "anchor_text": "this", "paragraph_index": 18}, {"url": "https://medium.com/@chintan.t93", "anchor_text": "medium", "paragraph_index": 19}, {"url": "https://github.com/ChintanTrivedi", "anchor_text": "github", "paragraph_index": 19}, {"url": "http://youtube.com/c/DeepGamingAI", "anchor_text": "YouTube channel", "paragraph_index": 19}, {"url": "http://medium.com/deepgamingai", "anchor_text": "medium.com/deepgamingai", "paragraph_index": 21}], "all_paragraphs": ["In my previous article, I presented an AI bot trained to play the game of FIFA using Supervised Learning technique. With this approach, the bot quickly learnt the basics of the game like passing and shooting. However, the training data required to improve it further quickly became cumbersome to gather and provided little-to-no improvements, making this approach very time consuming. For this sake, I decided to switch to Reinforcement Learning, as suggested by almost everyone who commented on that article!", "In this article, I\u2019ll provide a short description of what Reinforcement Learning is and how I applied it to this game. A big challenge in implementing this is that we do not have access to the game\u2019s code, so we can only make use of what we see on the game screen. Due to this reason, I was unable to train the AI on the full game, but could find a work-around to implement it for skill games in practice mode. For this tutorial, I will be trying to teach the bot to take 30-yard free kicks, but you can modify it to play other skill games as well. Let\u2019s start with understanding the Reinforcement Learning technique and how we can formulate our free kick problem to fit this technique.", "Contrary to Supervised Learning, we do not need to manually label the training data in Reinforcement Learning. Instead, we interact with our environment and observe the outcome of our interaction. We repeat this process multiple times gaining examples of positive and negative experiences, which acts as our training data. Thus, we learn by experimentation and not imitation.", "Let\u2019s say our environment is in a particular state s, and upon taking an action a, it changes to state s\u2019. For this particular action, the immediate reward you observe in the environment is r. Any set of actions that follow this action will have their own immediate rewards, until you stop interacting due to a positive or a negative experience. These are called future rewards. Thus, for the current state s, we will try to estimate out of all actions possible which action will fetch us the maximum immediate + future reward, denoted by Q(s,a) called the Q-function. This gives us Q(s,a) = r + \u03b3 * Q(s\u2019,a\u2019) which denotes the expected final reward by taking action a in state s. Here, \u03b3 is a discount factor to account for uncertainty in predicting the future, thus we want to trust the present a bit more than the future.", "Deep Q-learning is a special type of Reinforcement Learning technique where the Q-function is learnt by a deep neural network. Given the environment\u2019s state as an image input to this network, it tries to predict the expected final reward for all possible actions like a regression problem. The action with the maximum predicted Q-value is chosen as our action to be taken in the environment. Hence the name Deep Q-Learning.", "Note: If we had a performance meter in kick-off mode of FIFA like there is in the practice mode, we might have been able to formulate this problem for playing the entire game and not restrict ourselves to just taking free-kicks. That, or we need access to game\u2019s internal code which we don\u2019t have. Anyways, let\u2019s make the most of what we do have.", "While the bot has not mastered all different kinds of free kicks, it has learnt some situations very well. It almost always hits the target in absence of wall of players but struggles in its presence. Also, when it hasn\u2019t encountered a situation frequently in training like not facing the goal, it behaves bonkers. However, with every training epoch, this behavior was noticed to decrease on an average.", "As shown in the figure above, the average goal scoring rate grows from 30% to 50% on an average after training for 1000 epochs. This means the current bot scores about half of the free kicks it attempts (for reference, a human would average around 75\u201380%). Do consider that FIFA tends to behave non-deterministically which makes learning very difficult.", "More results in video format can be found on my YouTube channel, with the video embedded below. Please subscribe to my channel if you wish to keep track of all my projects.", "We shall implement this in python using tools like Tensorflow (Keras) for Deep Learning and pytesseract for OCR. The git link is provided below with the requirements setup instructions in the repository description.", "I would recommend below gists of code only for the purpose of understanding this tutorial since some lines have been removed for brevity. Please use the full code from git while running it. Let\u2019s go over the 4 main parts of the code.", "We do not have any readymade API available that gives us access to the code. So, let\u2019s make our own API instead! We\u2019ll use game\u2019s screenshots to observe the state, simulated key-presses to take action in the game environment and Optical Character Recognition to read our reward in the game. We have three main methods in our FIFA class: observe(), act(), _get_reward() and an additional method is_over() to check if the free kick has been taken or not.", "Throughout the training process, we want to store all our experiences and observed rewards. We will use this as the training data for our Q-Learning model. So, for every action we take, we store the experience <s, a, r, s\u2019> along with a game_over flag. The target label that our model will try to learn is the final reward for each action which is a real number for our regression problem.", "Now that we can interact with the game and store our interactions in memory, let\u2019s start training our Q-Learning model. For this, we will attain a balance between exploration (taking a random action in the game) and exploitation (taking action predicted by our model). This way we can perform trial-and-error to obtain different experiences in the game. The parameter epsilon is used for this purpose, which is an exponentially decreasing factor that balances exploration and exploitation. In the beginning, when we know nothing, we want to do more exploration but as number of epochs increases and we learn more, we want to do more exploitation and less exploration. Hence. the decaying value of the epsilon parameter.", "For this tutorial I have only trained the model for 1000 epochs due to time and performance constraints, but in the future I would like to push it to at least 5000 epochs.", "At the heart of the Q-Learning process is a 2-layered Dense/Fully Connected Network with ReLU activation. It takes the 128-dimensional feature map as input state and outputs 4 Q-values for each possible action. The action with the maximum predicted Q-value is the desired action to be taken as per the network\u2019s policy for the given state.", "This is the starting point of execution of this code, but you\u2019ll have to make sure the game FIFA 18 is running in windowed mode on a second display and you load up the free kick practice mode under skill games: shooting menu. Make sure the game controls are in sync with the keys you have hard-coded in the FIFA.py script.", "Overall, I think the results are quite satisfactory even though it fails to reach human level of performance. Switching from Supervised to Reinforcement technique for learning helps ease the pain of collecting training data. Given enough time to explore, it performs very well in problems like learning how to play simple games. However, Reinforcement setting seems to fail when it encounters unfamiliar situations, which makes me believe formulating it as a regression problem cannot extrapolate information as well as formulating it as a classification problem in supervised setting. Perhaps a combination of the two could address the weaknesses of both these approaches. Maybe that\u2019s where we\u2019ll see the best results in building AI for games. Something for me to try in the future!", "I would like to acknowledge this tutorial of Deep Q-Learning and this git repository of gaming with python for providing majority of the code. With the exception of the FIFA \u201ccustom-API\u201d, most of the code\u2019s backbone has come from these sources. Thanks to these guys!", "Thank you for reading! If you liked this tutorial, please follow me on medium, github or subscribe to my YouTube channel.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AI, ML for Digital Games Researcher. Founder at DG AI Research Lab, India. Visit our publication homepage medium.com/deepgamingai for weekly AI & Games content!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff2e4e979ee66&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@chintan.t93?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chintan.t93?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Chintan Trivedi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcba121ffc3f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&user=Chintan+Trivedi&userId=cba121ffc3f5&source=post_page-cba121ffc3f5----f2e4e979ee66---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/building-a-deep-neural-network-to-play-fifa-18-dce54d45e675", "anchor_text": "previous article"}, {"url": "https://towardsdatascience.com/building-a-deep-neural-network-to-play-fifa-18-dce54d45e675", "anchor_text": "Previous article: Building a Deep Neural Network to play FIFA 18"}, {"url": "http://people.csail.mit.edu/hongzi/content/publications/DeepRM-HotNets16.pdf", "anchor_text": "Image Source"}, {"url": "http://youtube.com/c/DeepGamingAI", "anchor_text": "YouTube channel,"}, {"url": "https://github.com/ChintanTrivedi/DeepGamingAI_FIFARL", "anchor_text": "ChintanTrivedi/DeepGamingAI_FIFARLDeepGamingAI_FIFARL - Using Reinforcement Learning to play FIFAgithub.com"}, {"url": "https://medium.freecodecamp.org/deep-reinforcement-learning-where-to-start-291fb0058c01", "anchor_text": "this"}, {"url": "https://github.com/Sentdex/pygta5", "anchor_text": "this"}, {"url": "https://medium.com/@chintan.t93", "anchor_text": "medium"}, {"url": "https://github.com/ChintanTrivedi", "anchor_text": "github"}, {"url": "http://youtube.com/c/DeepGamingAI", "anchor_text": "YouTube channel"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f2e4e979ee66---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f2e4e979ee66---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----f2e4e979ee66---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/reinforcement-learning?source=post_page-----f2e4e979ee66---------------reinforcement_learning-----------------", "anchor_text": "Reinforcement Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----f2e4e979ee66---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&user=Chintan+Trivedi&userId=cba121ffc3f5&source=-----f2e4e979ee66---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&user=Chintan+Trivedi&userId=cba121ffc3f5&source=-----f2e4e979ee66---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff2e4e979ee66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f2e4e979ee66---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f2e4e979ee66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chintan.t93?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chintan.t93?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Chintan Trivedi"}, {"url": "https://medium.com/@chintan.t93/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3.4K Followers"}, {"url": "http://medium.com/deepgamingai", "anchor_text": "medium.com/deepgamingai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcba121ffc3f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&user=Chintan+Trivedi&userId=cba121ffc3f5&source=post_page-cba121ffc3f5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff8a6ddbb7d3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-deep-q-learning-in-fifa-18-to-perfect-the-art-of-free-kicks-f2e4e979ee66&newsletterV3=cba121ffc3f5&newsletterV3Id=f8a6ddbb7d3e&user=Chintan+Trivedi&userId=cba121ffc3f5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}