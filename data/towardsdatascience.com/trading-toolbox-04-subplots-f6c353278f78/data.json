{"url": "https://towardsdatascience.com/trading-toolbox-04-subplots-f6c353278f78", "time": 1683012378.343068, "path": "towardsdatascience.com/trading-toolbox-04-subplots-f6c353278f78/", "webpage": {"metadata": {"title": "Python Trading Toolbox: step up your charts with indicator subplots | by Stefano Basurto | Towards Data Science", "h1": "Python Trading Toolbox: step up your charts with indicator subplots", "description": "After a several months-long hiatus, I can finally resume posting to the Trading Toolbox Series. We started this series by learning how to plot indicators (specifically: moving averages) on the top of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://uk.finance.yahoo.com/chart/QQQ", "anchor_text": "Yahoo! Finance", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/trading-toolbox-01-sma-7b8e16bd9388", "anchor_text": "moving averages", "paragraph_index": 6}, {"url": "https://towardsdatascience.com/trading-toolbox-02-wma-ema-62c22205e2a9", "anchor_text": "weighted and exponential moving averages", "paragraph_index": 6}, {"url": "https://finance.yahoo.com/quote/QQQ", "anchor_text": "Invesco QQQ Trust", "paragraph_index": 16}, {"url": "https://raw.githubusercontent.com/stebas101/TradingToolbox/master/data/QQQ.csv", "anchor_text": "here the CSV file that I am using", "paragraph_index": 16}, {"url": "https://towardsdatascience.com/trading-toolbox-01-sma-7b8e16bd9388", "anchor_text": "first article of this series", "paragraph_index": 25}, {"url": "https://matplotlib.org/3.1.1/tutorials/intermediate/gridspec.html", "anchor_text": "GridSpec", "paragraph_index": 26}, {"url": "https://matplotlib.org/3.1.1/tutorials/intermediate/gridspec.html", "anchor_text": "function", "paragraph_index": 26}, {"url": "https://towardsdatascience.com/trading-toolbox-03-ohlc-charts-95b48bb9d748", "anchor_text": "previous post of this series", "paragraph_index": 30}, {"url": "https://plotly.com/", "anchor_text": "plotly", "paragraph_index": 35}, {"url": "https://seaborn.pydata.org/", "anchor_text": "seaborn", "paragraph_index": 35}], "all_paragraphs": ["After a several months-long hiatus, I can finally resume posting to the Trading Toolbox Series. We started this series by learning how to plot indicators (specifically: moving averages) on the top of a price chart. Moving averages belong to a wide group of indicators, called overlay indicators, that share the same scale as the price and can, therefore, be plotted on the same chart. Other technical indicators, however, do not have this advantage and we need to plot them on a separate area, sometimes called a subplot.", "Here is an example of a stock chart with an indicator on a separate pane taken from Yahoo! Finance:", "With this post, we want to explore how to create similar charts using Matplotlib. We also want to explore how to harness Matplotlib\u2019s potential for customization and create original, publication-quality charts. To start with, we will learn how we can obtain that kind of subplot using Matplotlib. Then, we will apply that to plot our first technical indicator below the price, the Rate of Change (or ROC). We will then have a look at how to do that on an OHLC bar or Candlestick chart instead of a line chart.", "At this stage we need to delve into some technical aspects of how Matplotlib works: That is how we can harness its multiple plots capabilities and craft publishing quality charts. All the code provided assumes that you are using Jupyter Notebook. If instead, you are using a more conventional text editor or the command line, you will need to add:", "each time a chart is created in order to make it visible.", "In the first two posts of this series we created our first financial price plots using the format:", "You can see the first article on moving averages or the second on weighted and exponential moving averages.", "When calling that method, matplotlib does a few things behind the scenes in order to create charts:", "Within any figure, we can have multiple subplots (axes) arranged in a matrix:", "When it comes to charts with multiple subplots, there are enough ways and methods available to make our head spin. We are going to pick just one: the .subplot() method will serve our purposes well. Through other tutorials, you may come across a method called .add_subplot(): the .subplot() method is a wrapper for .add_subplots() (that means it should make its use simpler). With the exception of a few details, their use is actually very similar.", "Whenever we add a subplot to a figure we need to supply three parameters:", "Let us try to build a practical example of a generic 2x2 multiple plot chart:", "Which gives us the following chart:", "Now that we know how to create charts with multiple plots, we can apply our skills to plot an indicator at the bottom of a price chart. For this task, we are going to use an indicator known as Rate of Change (ROC). There are actually a few different definitions of ROC, and the one that we are going to employ for our example is based on the formula:", "where lag can be any whole number greater than zero and represents the number of periods (on a daily chart: days) we are looking back to compare our price. E.g., when we compute the ROC of the daily price with a 9-day lag, we are simply looking at how much, in percentage, the price has gone up (or down) compared to 9 days ago. In this article we are not going to discuss how to interpret the ROC chart and use it for investment decisions: that should better have a dedicated article and we are going to do that in a future post.", "We start by preparing our environment:", "For this exercise, I downloaded from Yahoo! Finance daily prices for the Invesco QQQ Trust, an ETF that tracks the performance of the Nasdaq 100 Index. You can find here the CSV file that I am using. We can load our data and have a glimpse at it:", "We can then compute a ROC series with a 9-day lag and add it as a column to our data frame:", "To make our example charts easier to read, we use only a selection of our available data. Here is how we select the last 100 rows, corresponding to the 100 most recent trading days:", "We are now ready to create our first multiple plot chart, with the price at the top and the ROC indicator at the bottom. We can note that, compared to a generic chart with subplots, our indicator has the same date and time (the horizontal axis) as the price chart:", "We have just plotted our first chart with price and ROC in separate areas: this chart does its job in the sense that it makes both price and indicator visible. It does not, however, do it in a very visually appealing way. To start with, price and ROC share the same time axis: there is no need to apply the date labels again on both charts. We can remove them from the top chart by using:", "We can also remove the gap between the two subplots with:", "It is also a good idea to add a horizontal line at the zero level of the ROC to make it more readable, as well as to add labels to both vertical axes.", "This chart looks already better. However, Matplotlib offers a much greater potential when it comes to creating professional-looking charts. Here are some examples of what we can do:", "That is quite a long list of improvements. Without getting lost too much in the details, the following code should provide a good example:", "This chart provides a taster of what we can achieve by manipulating the default Matplotlib parameters. Of course, we can always achieve some visual improvements by applying an existing style sheet as we have done in the first article of this series, e.g. with:", "When using indicator subplots, most of the time we want the price section to take a larger area than the indicator section in the chart. To achieve this we need to manipulate the invisible grid that Matplotlib uses to place the subplots. We can do so using the GridSpec function. This is another very powerful feature of Matplotlib. I will just provide a brief example of how it can be used to control the height ratio between our two subplots:", "As a side note, you may notice how this chart retained 14 as the font size set from the previous chart\u2019s code. This happens because any changes to the rcParams Matplotlib parameters are permanent (until we restart the system). If we need to reset them we can use:", "and add %matplotlib inline if we are using Jupyter Notebook.", "In all of the previous examples, we charted the price as a line plot. Line plots are a good way to visualize prices when we have only one data point (in this case, the closing price) for each period of trading. Quite often, with financial price series, we want to use OHLC bar charts or Candlestick charts: those charts can show all the prices that summarize the daily trading activity (Open, High, Low, Close) instead of just Close.", "To plot OHLC bar charts and candlestick charts in Matplotlib we need to use the mplfinance library. As I mentioned in the previous post of this series, mplfinance development has gathered new momentum and things are rapidly evolving. Therefore, we will deal only cursorily on how to use it to create our charts.", "Mplfinance offers two methods to create subplots within charts and add an indicator:", "The External Axes Method was released less than a week ago from the time I am writing this. I am still looking forward to making use of it to find out what potential it can offer.", "As a taster of what we can do using the mplfinance Panel Method, we can plot a candlestick chart with the volume in a separate pane:", "We can add our ROC indicator in a separate subplot too:", "There are several packages out there that make it possible to create financial charts using Python and pandas. In particular, plotly stands out for its capability to create good looking interactive charts. Matplotlib, on the other hand, may not produce the best charts straight out of the box (look at seaborn if you need that) however, it has a huge customization potential that makes it possible to create static charts that can stand out in a professional publication.", "That is why I believe it is well worth to get the grips on tweaking the properties of matplotlib. The future developments of mplfinance will make those possibilities even more appealing.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Passionate about exploring new ways to apply data science techniques to make better investment decisions and develop insights in markets."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff6c353278f78&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f6c353278f78--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@stebas101?source=post_page-----f6c353278f78--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stebas101?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Stefano Basurto"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Faf1de1bdf68d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&user=Stefano+Basurto&userId=af1de1bdf68d&source=post_page-af1de1bdf68d----f6c353278f78---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/trading-toolbox", "anchor_text": "trading-toolbox"}, {"url": "https://unsplash.com/@chrisliverani?utm_source=medium&utm_medium=referral", "anchor_text": "Chris Liverani"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://uk.finance.yahoo.com/chart/QQQ", "anchor_text": "Yahoo! Finance"}, {"url": "https://towardsdatascience.com/trading-toolbox-01-sma-7b8e16bd9388", "anchor_text": "moving averages"}, {"url": "https://towardsdatascience.com/trading-toolbox-02-wma-ema-62c22205e2a9", "anchor_text": "weighted and exponential moving averages"}, {"url": "https://finance.yahoo.com/quote/QQQ", "anchor_text": "Invesco QQQ Trust"}, {"url": "https://raw.githubusercontent.com/stebas101/TradingToolbox/master/data/QQQ.csv", "anchor_text": "here the CSV file that I am using"}, {"url": "https://infovis-wiki.net/wiki/Data-Ink_Ratio", "anchor_text": "Data-Ink Ratio"}, {"url": "https://towardsdatascience.com/trading-toolbox-01-sma-7b8e16bd9388", "anchor_text": "first article of this series"}, {"url": "https://matplotlib.org/3.1.1/tutorials/intermediate/gridspec.html", "anchor_text": "GridSpec"}, {"url": "https://matplotlib.org/3.1.1/tutorials/intermediate/gridspec.html", "anchor_text": "function"}, {"url": "https://towardsdatascience.com/trading-toolbox-03-ohlc-charts-95b48bb9d748", "anchor_text": "previous post of this series"}, {"url": "https://plotly.com/", "anchor_text": "plotly"}, {"url": "https://seaborn.pydata.org/", "anchor_text": "seaborn"}, {"url": "https://medium.com/tag/python?source=post_page-----f6c353278f78---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-vizualization?source=post_page-----f6c353278f78---------------data_vizualization-----------------", "anchor_text": "Data Vizualization"}, {"url": "https://medium.com/tag/matplotlib?source=post_page-----f6c353278f78---------------matplotlib-----------------", "anchor_text": "Matplotlib"}, {"url": "https://medium.com/tag/trading-system?source=post_page-----f6c353278f78---------------trading_system-----------------", "anchor_text": "Trading System"}, {"url": "https://medium.com/tag/trading-toolbox?source=post_page-----f6c353278f78---------------trading_toolbox-----------------", "anchor_text": "Trading Toolbox"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&user=Stefano+Basurto&userId=af1de1bdf68d&source=-----f6c353278f78---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&user=Stefano+Basurto&userId=af1de1bdf68d&source=-----f6c353278f78---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff6c353278f78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f6c353278f78---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f6c353278f78--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f6c353278f78--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f6c353278f78--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f6c353278f78--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f6c353278f78--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stebas101?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@stebas101?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stefano Basurto"}, {"url": "https://medium.com/@stebas101/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "411 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Faf1de1bdf68d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&user=Stefano+Basurto&userId=af1de1bdf68d&source=post_page-af1de1bdf68d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F95600df64f18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrading-toolbox-04-subplots-f6c353278f78&newsletterV3=af1de1bdf68d&newsletterV3Id=95600df64f18&user=Stefano+Basurto&userId=af1de1bdf68d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}