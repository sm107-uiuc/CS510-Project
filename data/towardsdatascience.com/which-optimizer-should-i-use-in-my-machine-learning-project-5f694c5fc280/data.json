{"url": "https://towardsdatascience.com/which-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280", "time": 1683013938.9545789, "path": "towardsdatascience.com/which-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280/", "webpage": {"metadata": {"title": "Which Optimizer Should I Use in my Machine Learning Project? | by Philipp Wirth | Towards Data Science", "h1": "Which Optimizer Should I Use in my Machine Learning Project?", "description": "This article provides a summary of popular optimizers used in computer vision, natural language processing, and machine learning in general."}, "outgoing_paragraph_urls": [{"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 2}, {"url": "http://tensorflow.org", "anchor_text": "TensorFLow", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/No_free_lunch_theorem", "anchor_text": "no-free-lunch theorem", "paragraph_index": 3}, {"url": "https://medium.com/@karpathy/a-peek-at-trends-in-machine-learning-ab8a1085a106", "anchor_text": "has been used excessively in the last years", "paragraph_index": 12}], "all_paragraphs": ["This article provides a summary of popular optimizers used in computer vision, natural language processing, and machine learning in general. Additionally, you will find a guideline based on three questions to help you pick the right optimizer for your next machine learning project.", "TL;DR: 1) Find a related research paper and start with using the same optimizer. 2) Consult Table 1 and compare properties of your dataset to the strengths and weaknesses of the different optimizers. 3) Adapt your choice to the available resources.", "Choosing a good optimizer for your machine learning project can be overwhelming. Popular deep learning libraries such as PyTorch or TensorFLow offer a broad selection of different optimizers \u2014 each with its own strengths and weaknesses. However, picking the wrong optimizer can have a substantial negative impact on the performance of your machine learning model [1][2]. This makes optimizers a critical design choice in the process of building, testing, and deploying your machine learning model.", "The problem with choosing an optimizer is that, due to the no-free-lunch theorem, there is no single optimizer to rule them all; as a matter of fact, the performance of an optimizer is highly dependent on the setting. So, the central question that arises is:", "Which optimizer suits the characteristics of my project the best?", "The following article is meant as a guide to answering the question above. It is structured into two main paragraphs: In the first part, I will present to you a quick introduction to the most frequently used optimizers. In the second part, I will provide you with a three-step plan to pick the best optimizer for your project.", "Almost all popular optimizers in deep learning are based on gradient descent. This means that they repeatedly estimate the slope of a given loss function L and move the parameters in the opposite direction (hence climbing down towards a supposed global minimum). The most simple example for such an optimizer is probably stochastic gradient descent (or SGD) which has been used since the 1950s [3]. In the 2010s the use of adaptive gradient methods such as AdaGrad or Adam [4][1] has become increasingly popular. However, recent trends show that parts of the research community move back towards using SGD over adaptive gradient methods, see for example [2] and [5]. Furthermore, current challenges in deep learning bring rise to new variants of SGD like LARS or LAMB [6][7]. For example, Google Research use LARS to train a powerful self-supervised model in one of their latest papers [8].", "The section below will be an introduction to the most popular optimizers. Head to section How to Choose the Right Optimizer if you are already familiar with the concepts.", "We will use the following notation: Denote by w the parameters and by g the gradients of the model. Furthermore, let \u03b1 be the global learning rate of each optimizer and t the time step.", "In SGD, the optimizer estimates the direction of steepest descent based on a mini-batch and takes a step in this direction. Because the step size is fixed, SGD can quickly get stuck on plateaus or in local minima.", "Where \u03b2 < 1. With momentum, SGD accelerates in directions of constant descent (that\u2019s why it\u2019s also called the \u201cheavy ball method\u201d). This acceleration helps the model escape plateaus and makes it less susceptible to getting stuck in local minima.", "AdaGrad is one of the first successful methods which makes use of adaptive learning rates (hence the name). AdaGrad scales the learning rate for each parameter based on the square root of the inverse of the sum of the squared gradients. This procedure scales sparse gradient directions up which in turn allows for larger steps in these directions. The consequence: AdaGrad can converge faster in scenarios with sparse features.", "RMSprop is a non-published optimizer which has been used excessively in the last years. The idea is similar to AdaGrad but the rescaling of the gradient is less aggressive: The sum of squared gradients is replaced by a moving average of the squared gradients. RMSprop is often used with momentum and can be understood as an adaption of Rprop to the mini-batch setting.", "Adam combines AdaGrad, RMSprop and momentum methods into one. The direction of the step is determined by a moving average of the gradients and the step size is approximately upper bounded by the global step size . Furthermore, each dimension of the gradient is rescaled similar to RMSprop. One key difference between Adam and RMSprop (or AdaGrad) is the fact that the moment estimates m and v are corrected for their bias towards zero. Adam is well-known for achieving good performance with little hyper-parameter tuning.", "Loshchilov and Hutter [17] identified the inequivalence of L2 regularization and weight-drop in adaptive gradient methods and hypothesized that this inequivalence limits Adams performance. They then proposed to decouple the weight decay from the learning rate. The empirical results show that AdamW can have better generalization performance than Adam (closing the gap to SGD with momentum) and that the basin of optimal hyperparameters is broader for AdamW.", "LARS is an extension of SGD with momentum which adapts a learning rate per layer. It has recently caught attention in the research community. The reason is that due to the steadily growing amount of available data, distributed training of machine learning models has gained popularity. The consequence is that batch sizes begin growing. However, this leads to instabilities during training. Yang et al. [6] argue that these instabilities stem from an imbalance between the gradient norm and the weight norm for certain layers. They therefore came up with an optimizer which rescales the learning rate for each layer based on a \u201ctrust\u201d parameter \u03b7 < 1 and the inverse norm of the gradient for that layer.", "As mentioned above, choosing the right optimizer for your machine learning problem can be hard. More specifically, there is no one-fits-all solution and the optimizer has to be carefully chosen based on the particular problem at hand. In the following section I will propose three questions you should ask yourself before deciding to use a certain optimizer.", "What are the state-of-the-art results on datasets and tasks similar to yours? Which optimizers were used and why?", "If you are working with novel machine learning methods, odds are there exist one or more reliable papers which cover a similar problem or handle similar data. Oftentimes the authors of the paper have done extensive cross-validation and report only the most successful configurations. Try to understand the reasoning for their choice of optimizer.", "Example: Say you want to train a Generative Adversarial Network (GAN) to perform super-resolution on a set of images. After some research you stumble upon this [12] paper in which the researchers used the Adam optimizer to solve the exact same problem. Wilson et al. [2] argue that training GANs does not correspond to solving optimization problems and that Adam may be well-suited for such scenarios. Hence, in this case, Adam is a good choice for an optimizer.", "Are there characteristics to your dataset which play to the strengths of certain optimizers? If so, which ones and how?", "Table 1 shows an overview of the different optimizers with their strengths and weaknesses. Try to find an optimizer which matches the characteristics of your dataset, training setup, and goal of the project.", "Certain optimizers perform extraordinarily well on data with sparse features [13] and others may perform better when the model is applied to previously unseen data [14]. Some optimizers work very well with large batch sizes [6] while others will converge to sharp minima with poor generalization [15].", "Example: For a project at your current job you have to classify written user responses into positive and negative feedback. You consider to use bag-of-words as input features for your machine learning model. Since these features can be very sparse you decide to go for an adaptive gradient method. But which one do you want to use? Consulting Table 1, you see that AdaGrad has the fewest tunable parameters of the adaptive gradient methods. Seeing the limited time frame of your project you choose AdaGrad as an optimizer.", "What are your resources for the project?", "The resources which are available for a project also have an effect on which optimizer to pick. Computational limits or memory constraints, as well as the time frame of the project can narrow down the set of feasible choices. Looking again at Table 1, you can see the different memory requirements and number of tunable parameters for each optimizer. This information can help you estimate whether or not the required resources of an optimizer can be supported by your setup.", "Example: You are working on a project in your free-time in which you want to train a self-supervised model (e.g. SimCLR [16]) on an image dataset on your home computer. For models like SimCLR, the performance increases with an increased batch size. Therefore, you want to save as much memory as possible so that you can do training in large batches. You choose a simple stochastic gradient descent without momentum as your optimizer because, in comparison to the other optimizers, it requires the least amount of additional memory to store the state.", "Trying out all possible optimizers to find the best one for a project is not always possible. In this blog post I provided an overview over the update rules, strengths, weaknesses, and requirements of the most popular optimizers. Furthermore, I listed three questions to guide you towards making an informed decision about which optimizer to use for your machine learning project.", "As a rule of thumb: If you have the resources to find a good learning rate schedule, SGD with momentum is a solid choice. If you are in need of quick results without extensive hypertuning, tend towards adaptive gradient methods.", "I hope that this blog post will serve as a helpful orientation and that I could assist one or the other in making the right optimizer choice.", "I am open for feedback, let me know if you have any suggestions in the comments!", "[10]: David E. Rumelhart, Geoffrey E. Hinton, and Ronald J. Williams. 1988. Learning representations by back-propagating errors. Neurocomputing: foundations of research. MIT Press, Cambridge, MA, USA, 696\u2013699.", "[14]: Moritz Hardt, Benjamin Recht, and Yoram Singer. 2016. Train faster, generalize better: stability of stochastic gradient descent. In Proceedings of the 33rd International Conference on International Conference on Machine Learning \u2014 Volume 48(ICML\u201916). JMLR.org, 1225\u20131234.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "\u2014 Machine Learning Engineer at Lightly \u2014"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5f694c5fc280&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@philipp_74619?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@philipp_74619?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Philipp Wirth"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F297b71d663f3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&user=Philipp+Wirth&userId=297b71d663f3&source=post_page-297b71d663f3----5f694c5fc280---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/photo/coding-computer-data-depth-of-field-577585/", "anchor_text": "pexels.com"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "http://tensorflow.org", "anchor_text": "TensorFLow"}, {"url": "https://papers.nips.cc/paper/7003-the-marginal-value-of-adaptive-gradient-methods-in-machine-learning", "anchor_text": "link"}, {"url": "https://en.wikipedia.org/wiki/No_free_lunch_theorem", "anchor_text": "no-free-lunch theorem"}, {"url": "https://pytorch.org/docs/stable/optim.html", "anchor_text": "PyTorch"}, {"url": "https://medium.com/@karpathy/a-peek-at-trends-in-machine-learning-ab8a1085a106", "anchor_text": "has been used excessively in the last years"}, {"url": "https://projecteuclid.org/euclid.aoms/1177729586", "anchor_text": "https://projecteuclid.org/euclid.aoms/1177729586"}, {"url": "https://doi.org/10.1007/BF02823149", "anchor_text": "https://doi.org/10.1007/BF02823149"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5f694c5fc280---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/optimizer?source=post_page-----5f694c5fc280---------------optimizer-----------------", "anchor_text": "Optimizer"}, {"url": "https://medium.com/tag/gradient-descent?source=post_page-----5f694c5fc280---------------gradient_descent-----------------", "anchor_text": "Gradient Descent"}, {"url": "https://medium.com/tag/guides-and-tutorials?source=post_page-----5f694c5fc280---------------guides_and_tutorials-----------------", "anchor_text": "Guides And Tutorials"}, {"url": "https://medium.com/tag/how-to?source=post_page-----5f694c5fc280---------------how_to-----------------", "anchor_text": "How To"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&user=Philipp+Wirth&userId=297b71d663f3&source=-----5f694c5fc280---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&user=Philipp+Wirth&userId=297b71d663f3&source=-----5f694c5fc280---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5f694c5fc280&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5f694c5fc280---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5f694c5fc280--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5f694c5fc280--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5f694c5fc280--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@philipp_74619?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@philipp_74619?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Philipp Wirth"}, {"url": "https://medium.com/@philipp_74619/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "41 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F297b71d663f3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&user=Philipp+Wirth&userId=297b71d663f3&source=post_page-297b71d663f3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa5f330b7fbc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhich-optimizer-should-i-use-in-my-machine-learning-project-5f694c5fc280&newsletterV3=297b71d663f3&newsletterV3Id=a5f330b7fbc6&user=Philipp+Wirth&userId=297b71d663f3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}