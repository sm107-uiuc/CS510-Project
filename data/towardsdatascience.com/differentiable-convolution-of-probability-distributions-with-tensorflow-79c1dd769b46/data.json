{"url": "https://towardsdatascience.com/differentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46", "time": 1682993353.241098, "path": "towardsdatascience.com/differentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46/", "webpage": {"metadata": {"title": "Differentiable convolution of probability distributions with Tensorflow | by Andre Holzner | Towards Data Science", "h1": "Differentiable convolution of probability distributions with Tensorflow", "description": "Convolution operations in Tensorflow are designed for tensors but can also be used to convolute differentiable functions"}, "outgoing_paragraph_urls": [{"url": "https://gist.github.com/andreh7/bd76330507675e6010bddea5005a7a37", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://www.tensorflow.org/api_docs/python/tf/distributions/Uniform", "anchor_text": "uniform distribution", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/Cross-correlation", "anchor_text": "cross-correlation", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Convolution#Discrete_convolution", "anchor_text": "convolution", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Broyden%E2%80%93Fletcher%E2%80%93Goldfarb%E2%80%93Shanno_algorithm", "anchor_text": "BFGS method", "paragraph_index": 16}, {"url": "https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize", "anchor_text": "scipy\u2019s minimization toolbox", "paragraph_index": 16}, {"url": "https://en.wikipedia.org/wiki/Convolution#Fast_convolution_algorithms", "anchor_text": "fast convolution algorithm", "paragraph_index": 20}, {"url": "https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#cudnnConvolutionFwdAlgo_t", "anchor_text": "several different algorithms", "paragraph_index": 20}, {"url": "https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#cudnnConvolutionForward", "anchor_text": "convolutions", "paragraph_index": 20}], "all_paragraphs": ["In this article I describe an example of a convolution of a uniform and a Gaussian probability distribution, compare them to data and fit for the width parameter of the Gaussian. Such scenarios arise in practice if we have data for which assume an underlying model (the uniform distribution in this example) but each data point is randomly \u2018smeared\u2019 by some amount (e.g. a measurement uncertainty) which is modelled by the Gaussian. We assume we do not know the resolution and want to determine it from the observed data. A Jupyter notebook with a Tensorflow implementation of the example discussed in this article is available here.", "We start by defining a grid on the function argument which we will use throughout this article. Although for this simple example presented here we can get a closed form expression of the convolution integral, this is often not the case in practical applications. We therefore discretise our functions on this grid, effectively making them piecewise constant. However we can choose the number of bins to be very large such that the piecewise approximation is good enough for our purposes:", "Then we define a uniform distribution on this grid:", "We can now draw a sample of random numbers from the uniform distribution:", "and \u2018smear\u2019 each point with a random number drawn from a Gaussian distribution of known width:", "which gives us the following distribution:", "Now we define the Gaussian distribution. Note that we make the width parameter sigma a tf.Variable rather than a tensor or placeholder because we want to determine it later using a maximum likelihood fit and therefore take derivatives with respect to it:", "Some thought has to be given to get the domain of the convolution output right. In this example we use padding='SAME' for the convolution operation and the second tensor has an odd number of bins. If we then choose the second tensor to be one in its middle bin and zero elsewhere (a \u2018centered Dirac pulse\u2019) the convolution output will be equal to the first tensor. We therefore place our Gaussian kernel such that it is centered at the center of the middle bin of the second tensor. The domain of the convolution product is then the same as the domain of the function projected into the first tensor.", "It also turns out that Tensorflow\u2019s 1D convolution is actually a cross-correlation rather than a convolution. These essentially differ in the direction the second function is \u2018traversed\u2019. We can have a genuine convolution by mirroring the second input to the convolution operation around the vertical axis or \u2014 equivalently \u2014 flip the sign of the function argument.", "As a quick check of the convolution operation we convolute our uniform distribution with itself:", "which (ignoring normalization) corresponds to what one obtains from a fully analytical calculation.", "Going back to our original problem, we define the convolution between the uniform distribution and the Gaussian:", "which (for the original value of the sigma parameter) looks like:", "Let\u2019s define the negative log likelihood of the sample data generated above with respect to the convolution product. Since we had to discretise the convolution operation we also need to bin the data with the same binning:", "The definition of the negative log likelihood function is then:", "In the next step we plot the negative log likelihood function for which we expect to see a minimum at the \u2018true\u2019 value of sigma which was used to draw the sample before. Tensorflow can calculate the derivative of the negative log likelihood function with respect to sigma (shown by the arrows in the following plot):", "Now that we have the negative log likelihood function and its derivative, we can use it with a minimiser. Since we have only one parameter to optimize, we use a BFGS method rather than stochastic gradient descent. Tensorflow has an interface to scipy\u2019s minimization toolbox:", "In order to monitor progress we define a callback function:", "This converges typically after about 23 iterations and should give a value for sigma close to the original value 0.1 used to smear the points drawn from the uniform distribution.", "We have shown in this article that in frameworks like Tensorflow we can take derivatives with respect to parameters of probability distributions even when we use such distributions in (discrete versions) of convolution operations.", "As a side note, when using a large number of bins it may be computationally more efficient to use a fast convolution algorithm . In fact, Tensorflow relies on cuDNN which supports several different algorithms for performing convolutions, including methods based on discrete Fourier transforms.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F79c1dd769b46&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@andre.holzner?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.holzner?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Andre Holzner"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd864987d769d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&user=Andre+Holzner&userId=d864987d769d&source=post_page-d864987d769d----79c1dd769b46---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://gist.github.com/andreh7/bd76330507675e6010bddea5005a7a37", "anchor_text": "here"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/distributions/Uniform", "anchor_text": "uniform distribution"}, {"url": "https://en.wikipedia.org/wiki/Cross-correlation", "anchor_text": "cross-correlation"}, {"url": "https://en.wikipedia.org/wiki/Convolution#Discrete_convolution", "anchor_text": "convolution"}, {"url": "https://en.wikipedia.org/wiki/Broyden%E2%80%93Fletcher%E2%80%93Goldfarb%E2%80%93Shanno_algorithm", "anchor_text": "BFGS method"}, {"url": "https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize", "anchor_text": "scipy\u2019s minimization toolbox"}, {"url": "https://en.wikipedia.org/wiki/Convolution#Fast_convolution_algorithms", "anchor_text": "fast convolution algorithm"}, {"url": "https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#cudnnConvolutionFwdAlgo_t", "anchor_text": "several different algorithms"}, {"url": "https://docs.nvidia.com/deeplearning/sdk/cudnn-developer-guide/index.html#cudnnConvolutionForward", "anchor_text": "convolutions"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----79c1dd769b46---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----79c1dd769b46---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/convolution?source=post_page-----79c1dd769b46---------------convolution-----------------", "anchor_text": "Convolution"}, {"url": "https://medium.com/tag/optimization?source=post_page-----79c1dd769b46---------------optimization-----------------", "anchor_text": "Optimization"}, {"url": "https://medium.com/tag/mle?source=post_page-----79c1dd769b46---------------mle-----------------", "anchor_text": "Mle"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&user=Andre+Holzner&userId=d864987d769d&source=-----79c1dd769b46---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&user=Andre+Holzner&userId=d864987d769d&source=-----79c1dd769b46---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F79c1dd769b46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----79c1dd769b46---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----79c1dd769b46--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----79c1dd769b46--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----79c1dd769b46--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.holzner?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.holzner?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andre Holzner"}, {"url": "https://medium.com/@andre.holzner/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "53 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd864987d769d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&user=Andre+Holzner&userId=d864987d769d&source=post_page-d864987d769d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4bab9285017e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdifferentiable-convolution-of-probability-distributions-with-tensorflow-79c1dd769b46&newsletterV3=d864987d769d&newsletterV3Id=4bab9285017e&user=Andre+Holzner&userId=d864987d769d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}