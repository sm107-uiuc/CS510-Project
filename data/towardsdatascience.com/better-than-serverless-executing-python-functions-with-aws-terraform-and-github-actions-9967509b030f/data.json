{"url": "https://towardsdatascience.com/better-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f", "time": 1683014102.9149408, "path": "towardsdatascience.com/better-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f/", "webpage": {"metadata": {"title": "Serverless Alternative: Executing Python Functions using AWS, Terraform, and Github Actions | by Arshya Sharifian | Towards Data Science", "h1": "Serverless Alternative: Executing Python Functions using AWS, Terraform, and Github Actions", "description": "What\u2019s better than Serverless? Serverless is all the buzz these days and for good reason. Serverless is a simple, yet powerful cloud resource to execute function calls without worrying about the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.terraform.io/downloads.html", "anchor_text": "use this link to install Terraform", "paragraph_index": 12}, {"url": "https://www.linkedin.com/learning-login/share?forceAccount=false&redirect=https%3A%2F%2Fwww.linkedin.com%2Flearning%2Flearning-terraform-2%3Ftrk%3Dshare_ent_url&account=42751868", "anchor_text": "this LinkedIn Learning Course", "paragraph_index": 13}, {"url": "https://www.terraform.io/docs/cloud/users-teams-organizations/api-tokens.html", "anchor_text": "this link", "paragraph_index": 16}, {"url": "https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions", "anchor_text": "Github Actions", "paragraph_index": 19}, {"url": "https://www.linkedin.com/learning-login/share?forceAccount=false&redirect=https%3A%2F%2Fwww.linkedin.com%2Flearning%2Flearning-github-actions-2%3Ftrk%3Dshare_ent_url&account=42751868", "anchor_text": "this Github Actions course on LinkedIn Learning", "paragraph_index": 19}, {"url": "https://towardsdatascience.com/modern-ci-cd-pipeline-git-actions-with-aws-lambda-serverless-python-functions-and-api-gateway-9ef20b3ef64a", "anchor_text": "my previous article", "paragraph_index": 23}, {"url": "https://arysharifian.substack.com/", "anchor_text": "substack", "paragraph_index": 28}], "all_paragraphs": ["What\u2019s better than Serverless? Serverless is all the buzz these days and for good reason. Serverless is a simple, yet powerful cloud resource to execute function calls without worrying about the underlying infrastructure. But every superhero has their kryptonite and recently, I\u2019ve ran into a few issues with AWS Lambda Serverless Functions:", "The obvious alternative is provisioning an EC2 instance to install the dependencies and execute the function, but I don\u2019t want the server to be on all the time. Time is money, and EC2 instances running 24/7 cost money. I don\u2019t want to manage the deployment, manually turning on and off the instance and executing the function. I also want to have function portability in case I want to deploy this function in a different cloud.", "Ultimately, I want to automate the process of provisioning an EC2 instance, executing the Python function, then destroying the EC2 instance and all underlying infrastructure. (If you simply turn-off the EC2 instance, you will continue to pay for the volume). Enter Terraform and Github Workflow.", "Terraform and Github Workflow are tools any modern DevOps or Cloud engineer need to build and deploy applications. Terraform quickly provisions cloud infrastructure to execute the function. Terraform scripts are also easily portable to other cloud vendors with changes to the services used. Github Workflow manages the deployment. We are also using a Github repository to hold all the Terraform and Python code used by Github Workflow.", "Here is a video of me running the Github Actions showing how the function is executed and Terraform makes changes in the the AWS console:", "The first step is to setup AWS so we have the right user permissions and key pairs to use for the Terraform scripting later. I won\u2019t delve too deeply into user permissions here. For this tutorial, I simply created a new user in IAM and gave my user administrative access (I don\u2019t recommend this; you should always provide a user the least amount of access required for the user to accomplish tasks). Copy the access and secret key somewhere to be used later in this tutorial.", "Next, you want to create a PEM key to use in the terraform scripting and for Github Workflow to access AWS. While on the AWS services homepage, select \u201cEC2\u201d. On the left side of the console, select the \u201cKey Pairs\u201d. On the top right of the screen, there is a button which states \u201cCreate Key Pair\u201d. Enter the name of the key, and select \u201cPEM\u201d as the file format. Finally, hit the \u201cCreate Key Pair\u201d button to create the PEM key. Your browser should automatically download the private key. Place this key somewhere accessible since it is integral to the entire process.", "You will also need the public key that corresponds to your private key. To get this, open terminal, change directory (cd) to the location of the private key, and run the following script:", "The result of this script should output the corresponding public key. You can copy this to your favorite code text editor. This public key will be important later.", "Note: I recommend testing the keys before running Terraform scripts by creating an EC2 instance and trying to SSH into the instance with the PEM key that we just created in AWS.", "Now that we have AWS properly configured, we can create Terraform scripts to provision the resources needed to execute the Python function:", "Notice that we included an S3 bucket which isn\u2019t really needed, but I wanted to provide some additional scripts just in case this resource is applicable for your project. Also notice that the public key we created in the previous step can be entered into \u201c<the rest of your public key>\u201d. The egress and ingress rules are not secure, they allow anyone with valid credentials to connect to the instance. But since the purpose of this tutorial is to provide an example, I haven\u2019t configured security properly. I selected a random AMI, but makes sure to find the right image for your workload.", "Note: I recommend test running terraform scripts on your local machine before creating Github Workflow. I created a folder on my Mac desktop and added the path to the Terraform executable in my Bash profile before successfully initializing Terraform. You can run the Terraform related Github Workflow actions defined later in this tutorial on your terminal. Please use this link to install Terraform.", "Note: if you are completely new to Terraform I recommend this LinkedIn Learning Course on Terraform.", "Before using the Github Workflow to run the terraform script, we need to setup Github secrets with a few keys related to AWS and Terraform. Here is a screenshot of my secrets:", "The \u201cSSH_KEY\u201d secret contains the private AWS Key automatically download when creating a key pair on the EC2 console. You can output the private key value by entering this command:", "The \u201cTF_API_TOKEN\u201d key needed is for the Terraform API that Github Workflow will use to execute the scripts. Use this link to gain access to the Hashicorp Terraform API token (you may need to create an account).", "Now that our Github secrets are properly configured, we can create the YAML file in Github Workflow:", "At a high level, when this YAML executes upon a new push to the Github Repository, a new \u201crunner\u201d is created, which is a newly created virtual environment on a Github host which \u201cruns-on\u201d the operating system you define. Then it seeks to complete all the \u201cjobs\u201d defined in parallel. In this case, I only have 1 job and thus all the \u201csteps\u201d (consisting of \u201cactions\u201d) are completed sequentially. Each \u201cstep\u201d builds upon one another which means that any changes made in previous steps is accessible to future steps. Now some of the \u201cactions\u201d completed in each \u201cstep\u201d \u201cuses\u201d pre-defined actions, these are actions created by others that can be imported. In this tutorial I am using 4 actions. The Github Workflow syntax is confusing. I recommend spending some understanding the key terms I put in quotes.", "Note: This is a pretty good introduction to Github Actions. I also recommend this Github Actions course on LinkedIn Learning.", "The YAML file commands are dense so I will focus on some of nuances and peculiarities of the code starting from the top and working down:", "Here is the Python Script which I call \u201ctf_parse.py\u201d in the YAML:", "Note: Use the functions above by entering the following command in the YAML file:", "The Python function is being executed on line 80 on the AWS EC2 instance. For this tutorial, I am executing a basic Python function, but the sky is the limit. If you want to install some dependencies before running the script, check out line 50 and beyond in the YAML file from my previous article on creating a CI/CD pipelines on AWS.", "Note that the dependencies need to be installed on the EC2 instance and not the Github Workflow \u201crunner\u201d.", "This tutorial showcases how to automate the deployment and execution of a Python function using AWS, Terraform, and Github Workflow. We highlighted some the problems with Serverless functions and how this workflow can be a reasonable substitute or replacement. However, its important to remember that we pay for the time that the Terraform initiated EC2 instance is running. It also takes much longer to use Terraform to provision the instances and run the function when compared to simply executing a Serverless function. Remember, we have to provision the underlying infrastructure every time we want to execute the function.", "Another reason I prefer Terraform and Github Worflow is because AWS Lambda functions lack portability. Once Lambda Functions are used, its difficult to transport that function elsewhere. This is due, in part, to the syntax restrictions for Lambda Function returns, Lambda Handlers, Layers, and other configurations. Also leveraging AWS API Gateway to invoke the function further prevents portability to another cloud vendor. Terraform makes it easier to find the corresponding services in another cloud vendor and deploying the workflow. Serverless functions remain powerful tools for creating scalable services in the cloud but there are significant flaws and disadvantages.", "What other possibilities are enabled by this structure of infrastructure creation and deployment? How about managing infrequent, time-insensitive services with this workflow? With some changes to this tutorial, we create and deploy the underlying infrastructure for the application servers, load balancers, S3 Bucket, and then destroy those instances when the services are completed. This might be crucial for any startup with large data-intensive applications seeking an effective way to mitigate costs for their DEV and TEST environments or even PROD.", "I recently created a substack to learn how to program and solve LeetCode questions in Python.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9967509b030f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://arshyasharifian.medium.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": ""}, {"url": "https://arshyasharifian.medium.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Arshya Sharifian"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F699fed23e2a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&user=Arshya+Sharifian&userId=699fed23e2a0&source=post_page-699fed23e2a0----9967509b030f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@agkdesign?utm_source=medium&utm_medium=referral", "anchor_text": "Alex Knight"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.terraform.io/downloads.html", "anchor_text": "use this link to install Terraform"}, {"url": "https://www.linkedin.com/learning-login/share?forceAccount=false&redirect=https%3A%2F%2Fwww.linkedin.com%2Flearning%2Flearning-terraform-2%3Ftrk%3Dshare_ent_url&account=42751868", "anchor_text": "this LinkedIn Learning Course"}, {"url": "https://www.terraform.io/docs/cloud/users-teams-organizations/api-tokens.html", "anchor_text": "this link"}, {"url": "https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions", "anchor_text": "Github Actions"}, {"url": "https://www.linkedin.com/learning-login/share?forceAccount=false&redirect=https%3A%2F%2Fwww.linkedin.com%2Flearning%2Flearning-github-actions-2%3Ftrk%3Dshare_ent_url&account=42751868", "anchor_text": "this Github Actions course on LinkedIn Learning"}, {"url": "https://stackoverflow.com/questions/55265203/terraform-delete-all-resources-except-one#:~:text=It%20doesn't%20destroy%20the,It%20will%20destroy%20the%20rest.", "anchor_text": "Here is a useful resource"}, {"url": "https://towardsdatascience.com/modern-ci-cd-pipeline-git-actions-with-aws-lambda-serverless-python-functions-and-api-gateway-9ef20b3ef64a", "anchor_text": "my previous article"}, {"url": "https://www.buymeacoffee.com/arshyasharifian", "anchor_text": ""}, {"url": "https://arysharifian.substack.com/", "anchor_text": "substack"}, {"url": "https://medium.com/tag/terraform?source=post_page-----9967509b030f---------------terraform-----------------", "anchor_text": "Terraform"}, {"url": "https://medium.com/tag/aws?source=post_page-----9967509b030f---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/github-actions?source=post_page-----9967509b030f---------------github_actions-----------------", "anchor_text": "Github Actions"}, {"url": "https://medium.com/tag/serverless?source=post_page-----9967509b030f---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/python?source=post_page-----9967509b030f---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&user=Arshya+Sharifian&userId=699fed23e2a0&source=-----9967509b030f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&user=Arshya+Sharifian&userId=699fed23e2a0&source=-----9967509b030f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9967509b030f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9967509b030f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9967509b030f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9967509b030f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9967509b030f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9967509b030f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9967509b030f--------------------------------", "anchor_text": ""}, {"url": "https://arshyasharifian.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://arshyasharifian.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Arshya Sharifian"}, {"url": "https://arshyasharifian.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "162 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F699fed23e2a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&user=Arshya+Sharifian&userId=699fed23e2a0&source=post_page-699fed23e2a0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd3cf9a164ae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbetter-than-serverless-executing-python-functions-with-aws-terraform-and-github-actions-9967509b030f&newsletterV3=699fed23e2a0&newsletterV3Id=d3cf9a164ae1&user=Arshya+Sharifian&userId=699fed23e2a0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}