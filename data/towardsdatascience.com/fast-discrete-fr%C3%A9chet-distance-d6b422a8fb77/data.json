{"url": "https://towardsdatascience.com/fast-discrete-fr%C3%A9chet-distance-d6b422a8fb77", "time": 1683013921.5654771, "path": "towardsdatascience.com/fast-discrete-fr%C3%A9chet-distance-d6b422a8fb77/", "webpage": {"metadata": {"title": "Fast Discrete Fr\u00e9chet Distance. How to improve the discrete Fr\u00e9chet\u2026 | by Jo\u00e3o Paulo Figueira | Towards Data Science", "h1": "Fast Discrete Fr\u00e9chet Distance", "description": "The above quote helps develop the intuition for the definition of the Fr\u00e9chet distance between two curves. Its discrete counterpart measures the similarity between two directed polygonal lines\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/tblx-insider/how-long-should-your-dog-leash-be-ba5a4e6891fc", "anchor_text": "another article", "paragraph_index": 2}, {"url": "http://numba.pydata.org/", "anchor_text": "Numba package", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm", "anchor_text": "Ramer-Douglas-Peucker algorithm", "paragraph_index": 5}, {"url": "https://en.wikipedia.org/wiki/Dynamic_time_warping", "anchor_text": "Dynamic Time Warping", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm", "anchor_text": "Bresenham\u2019s line drawing algorithm", "paragraph_index": 10}, {"url": "https://github.com/joaofig/discrete-frechet", "anchor_text": "GitHub repository", "paragraph_index": 17}, {"url": "https://hal.archives-ouvertes.fr/hal-02110055", "anchor_text": "Distance discre\u0300te de Fre\u0301chet optimise\u0301e.", "paragraph_index": 27}, {"url": "http://tblx.io", "anchor_text": "tblx.io", "paragraph_index": 29}], "all_paragraphs": ["A man is walking a dog on a leash: the man can move on one curve, the dog on the other; both may vary their speed, but backtracking is not allowed. What is the length of the shortest leash that is sufficient for traversing both curves? [1]", "The above quote helps develop the intuition for the definition of the Fr\u00e9chet distance between two curves. Its discrete counterpart measures the similarity between two directed polygonal lines, defined as sets of connected points in some metric space. In an oriented polygonal line, the sequence of vertices is of interest and describes a direction, like a vehicle\u2019s trajectory. Other similarity measures like the Hausdorff distance are oblivious of the line orientation and yield a high similarity for polygonal lines with close vertices, but with the reverse direction.", "I already described this similarity metric in another article, where I discussed the original implementation based on dynamic programming. I provided a speed-optimized version by linearizing the algorithm (by replacing recursion with two nested loops), which improved performance almost tenfold. Although the new upgraded algorithm runs faster, it still consumes the same amount of memory, which is undesirable for very large polylines.", "This article provides two alternative implementations of the same algorithm containing performance improvements according to a set of recent papers [2, 3]. The first implementation uses linear arrays to store the data while the second uses a sparse array based on a dictionary for very large polylines. All code is JIT-compiled using the Numba package for top performance.", "As I previously described, calculating the discrete Fr\u00e9chet distance (DFD) involves building up a rectangular matrix with dimensions corresponding to the number of points in each polyline. The original dynamic programming algorithm fills up the whole array by performing a distance calculation for each element. It then compares the distance to the recursively calculated values for its neighbors to the left and top. It is clear that the larger the polylines are, the longer the algorithm takes to compute the matrix.", "We can make the algorithm run faster by reducing the number of points in each polyline through a line simplification algorithm, like the famous Ramer-Douglas-Peucker algorithm. I have used this algorithm in the past to help me display very large trajectories on a map. It works by removing points from the polyline while keeping its overall shape. The user gets the same information while the map display software avoids handling useless vertices, thereby improving performance and responsiveness. I will not explore this optimization here and will do so in a future article.", "Another optimization lies buried deep in the DFD calculation mathematics and is similar to the \u201cwarping window\u201d concept associated with Dynamic Time Warping. We only need to calculate some of the matrix elements close to the main diagonal as it turns out. By not calculating all the other items, we gain not only speed but can also save memory on very large polylines. This optimization also implies that we must consider a different data structure to store the matrix, possibly a sparse array. Besides avoiding the calculation of unnecessary data, we also do not allocate unneeded memory.", "The optimization idea becomes evident if you look at a fully calculated matrix. To see this at work, let us look at an example. We will calculate the DFD for two polylines defined in a euclidean space.", "The polyline coordinates are as follows.", "Now, we can calculate the distance matrix between both polylines. Note that this step will not fully occur during algorithm execution. I use it here for illustrations purposes only, as it clearly illustrates how values tend to increase as you move further away from the diagonal. The improved algorithm explores this feature to reduce the number of calculations and required storage.", "We start by considering the diagonal cells only, but while it is quite simple to define on a square matrix, the diagonal of a rectangular matrix requires more work. Instead of the paper\u2019s approach, I decided to revisit an old friend, Bresenham\u2019s line drawing algorithm. If you think of a matrix as a raster display, the usefulness of the algorithm becomes obvious. Instead of using the algorithm to draw lines, I use it to generate pairs of matrix indices to connect the top left-hand corner with the lower right-hand corner.", "After calculating the diagonal, we take its maximum value as a top limit for the final distance. The algorithm proceeds by iterating through the diagonal left to right, and for each column, calculates the distances and stores them if they are smaller than the reference maximum. The same process applies to rows. The next figure depicts the result as pertains to this case. I have highlighted the diagonal with a light blue background for ease of reading.", "It is relatively easy to see how much memory we have saved. Instead of the expected 42 items, we have only stored 26 of them. Still, we calculated more distances than we have kept, and this is depicted in the next figure.", "We cannot resort to the traditional NumPy arrays to save RAM, as these will allocate unnecessary memory. Here we will use a dictionary-based sparse matrix, and I will discuss its implementation details below along with the code optimization.", "We are now ready to move on to the second step, where the final calculations take place. First, we must create a new matrix, the Fr\u00e9chet matrix, to store the final results. The process starts by copying the distance diagonal data into the Fr\u00e9chet matrix. Next, we iterate each distance matrix element starting at the diagonal and apply a simple algorithm that calculates the final Fr\u00e9chet cell value.", "The final calculation proceeds along with the distance matrix diagonal. Once finished, the Fr\u00e9chet matrix looks like the following image.", "Please note that one can do away with the second matrix (F) and perform all calculations using just the distance matrix (D) due to how computation proceeds. As always, the final distance value is in the lower right-hand corner cell.", "You can find all the code for this article in its GitHub repository. Besides the DFD\u2019s original implementations, the code now contains two additional ones based on the paper\u2019s insights. For smaller polylines, you can use the NumPy array-based version named FastDicreteFrechetMatrix. For larger polylines, you should probably use the sparse array version, called FastDiscreteFrechetSparse. This last version uses a dictionary to simulate a sparse array.", "Most of the code is now JIT-compiled using Numba for dramatically increased performance. This package targets scientific computing code and understands most of NumPy, making your code lightning fast. There are a couple of things to watch out for when using Numba.", "The first thing you will notice is the slow first-time execution of your compiled code. This delay occurs due to the JIT phase of compilation, where your Python code translates into machine code. All subsequent runs will be at full speed.", "The second issue with Numba is that it requires some getting used to because of compatibility issues with Python and NumPy. Not all your code will work, and when it does, it might not improve performance-wise. You should thoroughly read the package\u2019s documentation to get the most of it. When you understand how to use it, Numba is a joy.", "To get a sense of how these algorithms perform, I set up a Jupyter notebook that compares two sets of trajectories (please see the accompanying code). The first set is relatively small, with 91 and 107 points, and the second is a bit larger, with 263 and 477 points. The code exercises all four algorithms against these two sets, as you can see by going through the notebook.", "As you can expect, the original recursive algorithm is always the slowest by a large margin. Next up is its linear adaptation that runs considerably faster (an order of magnitude). Then we have mixed results from the sparse implementation of the improved algorithm. It runs faster than the previous two in the smaller set but slower on the larger. This performance difference is due to the sparse array implementation based on a dictionary \u2014 it does not scale well. A future revision of this code will focus on replacing this component with a more performant one, although it is still not clear what that might be. Finally, the array-based implementation of the improved algorithm is consistently faster.", "It seems that, with the current implementation, we will have to strike a compromise between speed and size. For very large polylines, we will have to use a slower-performing algorithm, unfortunately. Hopefully, this will improve in the future.", "This article reviewed a performance improvement to the discrete Fr\u00e9chet distance using a recent paper\u2019s results. Instead of having to calculate all the distance pairs, we can focus on a limited set of cells around the distance matrix diagonal. This approach not only saves space but also improves performance.", "In a future article, I will illustrate the use of the discrete Fr\u00e9chet distance in trajectory clustering. Each item to aggregate is a geospatial trajectory defined by a variable number of locations, and the DFD is the distance measure of choice for such a scenario. The performance improvements put forward in this article will no doubt be of use there.", "[1] Thomas Heiter and Heikki Manila. Computing Discrete Fr\u00e9chet Distance. Technical Report CD-TR 94/64, Christian Doppler Laboratory for Expert Systems, Technical University Vienna, Austria, 1994.", "[3] Thomas Devogele, Maxence Esnault, Laurent Etienne. Distance discre\u0300te de Fre\u0301chet optimise\u0301e. Spatial Analysis and Geomatics (SAGEO), Nov 2016, Nice, France.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Addicted to math and data, slightly off-centered. Data Scientist at tblx.io"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd6b422a8fb77&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@joao.figueira?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joao.figueira?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Jo\u00e3o Paulo Figueira"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64bc009cedeb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&user=Jo%C3%A3o+Paulo+Figueira&userId=64bc009cedeb&source=post_page-64bc009cedeb----d6b422a8fb77---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@yirage?utm_source=medium&utm_medium=referral", "anchor_text": "Andrii Podilnyk"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tblx-insider/how-long-should-your-dog-leash-be-ba5a4e6891fc", "anchor_text": "another article"}, {"url": "http://numba.pydata.org/", "anchor_text": "Numba package"}, {"url": "https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm", "anchor_text": "Ramer-Douglas-Peucker algorithm"}, {"url": "https://en.wikipedia.org/wiki/Dynamic_time_warping", "anchor_text": "Dynamic Time Warping"}, {"url": "https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm", "anchor_text": "Bresenham\u2019s line drawing algorithm"}, {"url": "https://github.com/joaofig/discrete-frechet", "anchor_text": "GitHub repository"}, {"url": "https://doi.org/10.1145/3150919.3150924", "anchor_text": "https://doi.org/10.1145/3150919.3150924"}, {"url": "https://hal.archives-ouvertes.fr/hal-02110055", "anchor_text": "Distance discre\u0300te de Fre\u0301chet optimise\u0301e."}, {"url": "https://doi.org/10.1145/2833157.2833162", "anchor_text": "https://doi.org/10.1145/2833157.2833162"}, {"url": "https://github.com/joaofig/discrete-frechet", "anchor_text": "GitHub repository"}, {"url": "https://medium.com/iotransportation/how-long-should-your-dog-leash-be-ba5a4e6891fc", "anchor_text": "How long should your dog leash be?Calculating the Discrete Fr\u00e9chet Distance between curves.medium.com"}, {"url": "https://www.linkedin.com/in/joao-paulo-figueira/", "anchor_text": "Jo\u00e3o Paulo Figueira \u2014 Data Scientist \u2014 tb.lx by Daimler Trucks & Buses | LinkedInView Jo\u00e3o Paulo Figueira\u2019s profile on LinkedIn, the world\u2019s largest professional community. Jo\u00e3o Paulo has 1 job listed\u2026www.linkedin.com"}, {"url": "https://medium.com/tag/distance?source=post_page-----d6b422a8fb77---------------distance-----------------", "anchor_text": "Distance"}, {"url": "https://medium.com/tag/frechet?source=post_page-----d6b422a8fb77---------------frechet-----------------", "anchor_text": "Frechet"}, {"url": "https://medium.com/tag/trajectory?source=post_page-----d6b422a8fb77---------------trajectory-----------------", "anchor_text": "Trajectory"}, {"url": "https://medium.com/tag/polyline?source=post_page-----d6b422a8fb77---------------polyline-----------------", "anchor_text": "Polyline"}, {"url": "https://medium.com/tag/similarity?source=post_page-----d6b422a8fb77---------------similarity-----------------", "anchor_text": "Similarity"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%25C3%25A9chet-distance-d6b422a8fb77&user=Jo%C3%A3o+Paulo+Figueira&userId=64bc009cedeb&source=-----d6b422a8fb77---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%25C3%25A9chet-distance-d6b422a8fb77&user=Jo%C3%A3o+Paulo+Figueira&userId=64bc009cedeb&source=-----d6b422a8fb77---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd6b422a8fb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d6b422a8fb77---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d6b422a8fb77--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joao.figueira?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@joao.figueira?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jo\u00e3o Paulo Figueira"}, {"url": "https://medium.com/@joao.figueira/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "491 Followers"}, {"url": "http://tblx.io", "anchor_text": "tblx.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64bc009cedeb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&user=Jo%C3%A3o+Paulo+Figueira&userId=64bc009cedeb&source=post_page-64bc009cedeb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F33fec95e18df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-discrete-fr%C3%A9chet-distance-d6b422a8fb77&newsletterV3=64bc009cedeb&newsletterV3Id=33fec95e18df&user=Jo%C3%A3o+Paulo+Figueira&userId=64bc009cedeb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}