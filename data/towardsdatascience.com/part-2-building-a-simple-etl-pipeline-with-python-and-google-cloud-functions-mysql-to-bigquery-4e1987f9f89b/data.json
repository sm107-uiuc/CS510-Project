{"url": "https://towardsdatascience.com/part-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b", "time": 1683011661.4442549, "path": "towardsdatascience.com/part-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b/", "webpage": {"metadata": {"title": "Part 2: Building a Simple ETL Pipeline with Python and Google Cloud Functions \u2014 MySQL to BigQuery (via SSH) | by Tobi Sam | Towards Data Science", "h1": "Part 2: Building a Simple ETL Pipeline with Python and Google Cloud Functions \u2014 MySQL to BigQuery (via SSH)", "description": "In Part 1, we looked at how to extract a csv file from an FTP server and how to load it into Google BigQuery using Cloud Functions. In this article, we will be doing the same thing but this time, we\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/building-a-simple-etl-pipeline-with-python-and-google-cloud-platform-6fde1fc683d5", "anchor_text": "Part 1", "paragraph_index": 0}, {"url": "https://cloud.google.com/functions/", "anchor_text": "Cloud Functions", "paragraph_index": 5}, {"url": "https://aws.amazon.com/lambda/", "anchor_text": "AWS Lambda", "paragraph_index": 5}, {"url": "https://azure.microsoft.com/en-us/services/functions/", "anchor_text": "Azure Functions", "paragraph_index": 5}, {"url": "https://cloud.google.com/functions/docs/locations", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://pypi.org/project/sshtunnel/", "anchor_text": "SSHTunnel", "paragraph_index": 10}, {"url": "https://medium.com/geekculture/secure-your-credentials-in-google-cloud-functions-with-secret-manager-22a4a1b3788a", "anchor_text": "guide", "paragraph_index": 11}, {"url": "https://cloud.google.com/bigquery/docs/tables", "anchor_text": "create your BigQuery table", "paragraph_index": 14}, {"url": "https://cloud.google.com/scheduler/docs/creating", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://crontab.guru/", "anchor_text": "site editor", "paragraph_index": 18}, {"url": "https://cloud.google.com/scheduler/docs/http-target-auth", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://medium.com/@tobisam/membership", "anchor_text": "become a Medium member", "paragraph_index": 22}, {"url": "https://github.com/togobingi/google_cloud_function", "anchor_text": "Github", "paragraph_index": 23}], "all_paragraphs": ["In Part 1, we looked at how to extract a csv file from an FTP server and how to load it into Google BigQuery using Cloud Functions. In this article, we will be doing the same thing but this time, we will be extracting data from a MySQL database instead.", "There are a lot of ETL tools out there and sometimes they can be overwhelming, especially when you simply want to copy a file from point A to B. So today, I am going to show you how to extract data from a MySQL database (Extract), modify it (Transform) and load it into a Google BigQuery table (Load) using python 3.6 and Google Cloud Functions.", "In this article, we will look to do the following:", "Extract, Transform, Load (ETL) is the general procedure of copying data from one or more sources into a destination system which represents the data differently from the source or in a different context than the source. \u2014 Wikipedia", "This is what our ETL pipeline will look like in the end:", "Google Cloud Functions: Cloud Functions (CF) is Google Cloud\u2019s Serverless platform set to execute scripts responding to specified events, such as a HTTP request or a database update. An alternative to CF is AWS Lambda or Azure Functions.", "Make sure your runtime is set to \u201cPython 3.7\u201d and under \u201cAdvanced options\u201d change the region to one closest to you. As at the writing of this post, CF isn\u2019t available in every Google data-centre region, so check here to see where Cloud Functions is enabled.", "When you complete these steps, your display should look like this:", "A Cloud Function has two files; a main.py and a requirements.txt file. The latter host all the file dependencies we need for our script to work, so click on the requirements.txt tab and make sure you have these dependencies included in the editor like so:", "Now in the main.py tab, you can start including the code below. We created a function called \u201chandler\u201d, which we will refer to in the future when accessing the Cloud Function with a HTTP request. We then login to the MySQL server with the necessary credentials, and on line 30, you write the SQL query you need to extract the data from the database.", "It\u2019s important to get the ssh tunnel details right, so you don\u2019t run into authentication issues. The SSHTunnel is a good Python library for this.", "Note: To secure your credentials with a secret manager, follow this guide.", "Since we now have a Pandas Dataframe called \u201cdf\u201d, we could do Pandas data manipulations like this one:", "This will take an aggregate sum of all orders from the \u201cOrders\u201d column and group that by every unique name in the \u201cName\u201d column of our Dataframe. I didn\u2019t include any transform in this particular example but you could do that after line 30 if need be.", "Now, make sure you create your BigQuery table. And then we simply use this code below to load the transformed CSV file into the BigQuery table you have created.", "When you finish writing the script you can deploy the Cloud Function by clicking \u201cCreate\u201d. When the function has deployed successfully, you should see a green check mark.", "Now all that is left to do is to create a cron job (Cloud Scheduler) that will automate the call to the CF at some predefined interval. The good news is, creating cron jobs on Google Cloud Platform is very straightforward and really the simplest part. You can follow the instructions here or replicate the image below.", "The \u201cfrequency\u201d field here will run our script every day at 1:59AM.", "You can use this cool site editor for simple cron schedule expressions.", "Now that our data is sitting snug in the data warehouse, we can connect it to any visualisation tool and perform analysis on it.", "If you don\u2019t want to allow unauthenticated invocations, setup authentication with HTTP Targets for Cloud Scheduler. Cloud Scheduler can call HTTP targets that require authentication if you have set up an associated service account that has the appropriate credentials. Read more here.", "That is it. Hope you found this helpful. This was a very simple approach to developing an ETL that anyone can build on.", "You can become a Medium member and enjoy more stories like this.", "You can find the link to the full script on Github.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4e1987f9f89b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tobisam?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tobisam?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Tobi Sam"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F92fab82e0c7a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&user=Tobi+Sam&userId=92fab82e0c7a&source=post_page-92fab82e0c7a----4e1987f9f89b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/building-a-simple-etl-pipeline-with-python-and-google-cloud-platform-6fde1fc683d5", "anchor_text": "Part 1"}, {"url": "https://www.lucidchart.com/pages/examples/uml_diagram_tool", "anchor_text": "Lucidchart"}, {"url": "https://cloud.google.com/functions/", "anchor_text": "Cloud Functions"}, {"url": "https://aws.amazon.com/lambda/", "anchor_text": "AWS Lambda"}, {"url": "https://azure.microsoft.com/en-us/services/functions/", "anchor_text": "Azure Functions"}, {"url": "https://console.cloud.google.com/functions/list", "anchor_text": "Go to the Cloud Functions Overview page"}, {"url": "https://cloud.google.com/functions/docs/reference/iam/roles", "anchor_text": "permission invoker"}, {"url": "https://cloud.google.com/functions/docs/locations", "anchor_text": "here"}, {"url": "https://cloud.google.com/", "anchor_text": "GCP console"}, {"url": "https://pypi.org/project/sshtunnel/", "anchor_text": "SSHTunnel"}, {"url": "https://medium.com/geekculture/secure-your-credentials-in-google-cloud-functions-with-secret-manager-22a4a1b3788a", "anchor_text": "guide"}, {"url": "https://cloud.google.com/bigquery/docs/tables", "anchor_text": "create your BigQuery table"}, {"url": "https://cloud.google.com/bigquery/docs/schema-detect", "anchor_text": "auto-detection"}, {"url": "https://googleapis.dev/python/bigquery/latest/generated/google.cloud.bigquery.table.Table.html#google.cloud.bigquery.table.Table", "anchor_text": "Table"}, {"url": "https://cloud.google.com/functions/docs/quickstart-console", "anchor_text": "source"}, {"url": "https://cloud.google.com/scheduler/docs/creating", "anchor_text": "here"}, {"url": "https://cloud.google.com/functions/docs/quickstart-console", "anchor_text": "source"}, {"url": "https://crontab.guru/", "anchor_text": "site editor"}, {"url": "https://cloud.google.com/scheduler/docs/http-target-auth", "anchor_text": "here"}, {"url": "https://medium.com/@tobisam/membership", "anchor_text": "become a Medium member"}, {"url": "https://github.com/togobingi/google_cloud_function", "anchor_text": "Github"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----4e1987f9f89b---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4e1987f9f89b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----4e1987f9f89b---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----4e1987f9f89b---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/sql?source=post_page-----4e1987f9f89b---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&user=Tobi+Sam&userId=92fab82e0c7a&source=-----4e1987f9f89b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&user=Tobi+Sam&userId=92fab82e0c7a&source=-----4e1987f9f89b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4e1987f9f89b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4e1987f9f89b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4e1987f9f89b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tobisam?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tobisam?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tobi Sam"}, {"url": "https://medium.com/@tobisam/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "307 Followers"}, {"url": "https://www.linkedin.com/in/tobiwf/", "anchor_text": "https://www.linkedin.com/in/tobiwf/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F92fab82e0c7a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&user=Tobi+Sam&userId=92fab82e0c7a&source=post_page-92fab82e0c7a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1c58a149f4ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpart-2-building-a-simple-etl-pipeline-with-python-and-google-cloud-functions-mysql-to-bigquery-4e1987f9f89b&newsletterV3=92fab82e0c7a&newsletterV3Id=1c58a149f4ec&user=Tobi+Sam&userId=92fab82e0c7a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}