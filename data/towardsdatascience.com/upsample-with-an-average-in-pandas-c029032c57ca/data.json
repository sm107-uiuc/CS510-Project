{"url": "https://towardsdatascience.com/upsample-with-an-average-in-pandas-c029032c57ca", "time": 1683014906.292022, "path": "towardsdatascience.com/upsample-with-an-average-in-pandas-c029032c57ca/", "webpage": {"metadata": {"title": "Upsample with an average in Pandas | by Vaclav Dekanovsky | Towards Data Science", "h1": "Upsample with an average in Pandas", "description": "Align cumulative variables over inconsistent time periods by upsampling to average using python and pandas."}, "outgoing_paragraph_urls": [{"url": "https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Pandas/Upsample/Upsample%20to%20average.ipynb", "anchor_text": "Upsample_to_average.ipynb", "paragraph_index": 2}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/resampling.html", "anchor_text": "Resampling", "paragraph_index": 3}, {"url": "https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases", "anchor_text": "resample options in pandas documentation", "paragraph_index": 4}, {"url": "https://towardsdatascience.com/stock-fundamental-analysis-eda-of-secs-quarterly-data-summary-455e62ff4817", "anchor_text": "companies\u2019 fundamental data in order to predict future stock prices", "paragraph_index": 9}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/resampling.html", "anchor_text": "resample", "paragraph_index": 16}, {"url": "https://towardsdatascience.com/stock-fundamental-analysis-eda-of-secs-quarterly-data-summary-455e62ff4817", "anchor_text": "performance of publicly traded companies", "paragraph_index": 23}, {"url": "https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Pandas/Upsample/Upsample%20to%20average.ipynb", "anchor_text": "Upsample_to_average.ipynb", "paragraph_index": 28}], "all_paragraphs": ["Many models input cumulative variables like rainfalls in a few hours or company revenue over some months. Unfortunately, the data sources are often not aligned in time. One sensor feeds the data every odd hour, another one in even hours. One company provides information in May and the other in June.", "If you don\u2019t want to wait for all your data sources to collect the inputs or when it doesn\u2019t suit to feed the model with data coming from different time frames, you have to spread your measurement to the same periods of time. Pandas can natively do part of the job, but in this article, we\u2019ll explore how to upsample with an average, which requires a little bit of extra coding.", "You can run all the example from this tutorial through the notebook shared on Github \u2014 Upsample_to_average.ipynb", "Resampling in python\u2019s Pandas allows you to turn more frequent values to less frequent \u2014 downsample, e.g. hourly data to daily sum, count and average, or daily to monthly values.", "It\u2019s called downsample because the number of data-rows decreases. You can apply sum, count, mean (for average), median, min, max, first or last. Based on daily inputs you can resample to weeks, months, quarters, years, but also to semi-months \u2014 see the complete list of resample options in pandas documentation. You can also resample to multiplies, e.g. 5H for groups of 5 hours.", "Resampling to more frequent timestamps is called upsampling. You can turn days into hours or months into days. When upsampling you must first set the DateTime column as an index of your data frame (.set_index), and only then you can upsample.", "Besides the functions above, the upsampling supports backfill/bfill, ffill/pad and nearest. Though if you think that applying mean would split the daily value to an average per hour, you would be wrong. All the added up-samples are filled with NaN.", "Let\u2019s say you have a portfolio of shops and try to estimate the sales. You input the revenue on Jan-1, Jan-2 and Jan-3 and perform a regression to guess the target value on Jan-4. You train on all your shops and use the model to predict future sales.", "But what if for some shops provide data only for Jan-2 and Jan-3. And others only onJan-1 and Jan-3. You can downsample and model using sum or average of these 3 days, but in such a case you lose valuable input information like Friday peeks or low Monday takings.", "Contrary to common belief, this scenario is typical. When analyzing companies\u2019 fundamental data in order to predict future stock prices, some companies report them quarterly, while others twice a year. Some do so in November, while others in August. If you would wait until everyone provides their data, you might come up with a precise prediction, but at that time all the lucrative stock would be sold out.", "Usually 80% of the inputs hold the same pattern and 20% including some imporant scenarios have unusual structure you have to recalculate.", "To work around these data leaks, you can upsample to average.", "I\u2019m talking about the option to smooth the inconsistently reported data, so that you can", "The example above is quite simple, but imagine you have thousands of categories. Some reported daily, others bi-daily in odd or even days, the rest every three days or irregularly.", "In order to calculate the average, you need two things \u2014 the sum divided by the count. You know the sum, because it was reported, but the number of days (months, weeks \u2026) since the last value is unknown. Luckily, pandas resampling contains a parameter .group which exposes, how many groups were created when upsampled.", "Unfortunately, it doesn\u2019t work natively with groupby so we\u2019ll look on a single category first.", "The resample method has two attributes:", "January first and second forms the first group, third to fifth are the second and the last data sample falls into the last group. Mostly the data are reported that the value on the reporting date is included \u2014 20 reported on Jan-3 covers Jan-2 and Jan-3. In that case, you use label parameter and set it to right.", "Alternatively you can turn the groups into a dataframe and shift the values", "Then you count the occurrences in each group.", "And join the counts with the dates and backfilled values. It results into a dataframe having a sum for the period and number of occurrences in this period which is all you need to calculate the average.", "If you shout with excitement now, hold on, we\u2019re not at the finish line yet. We have calculated the average for a single group, but in case we want to groupby multiple categories, e.g. when we have many stores, companies, or sensors to work with, we must calculate the average for each group separately.", "It\u2019s not complicated, but it can be time-consuming in case you have many inputs. See the code below:", "You have smoothed the data to average, but often you don\u2019t need each monthly average. You only needed to cover different reporting periods. For example in financial analysis reviewing the performance of publicly traded companies, most of them report the data at the end of the quarter. But some do it in different months, or even not quarterly. If you want to model the behavior of a whole bunch of companies, you first smooth to average those which doesn\u2019t report quarterly and the use rolling function limit the inputs to quarters only.", "More inputs mean more model parameters and longer computing time", "Let\u2019s look on the stock market analysis example:", "Once again the coding gets us surprised. When you apply .resample(\"D\", label=\"right\") resampling to days the results are the same as .resample(\"D\", label=\"right\", closed=\"left\"). If you do the same while resampling to months, the label=\"right\" matches label=\"right\", closed=\"right\". For this reason, you must specify label=\"right\", closed=\"left\" for the monthly calculation or use the workaround with shift mentioned above.", "I hope that you have learned something not only about resampling but how to use alternative approaches to align inconsistent data when feeding your machine learning models.", "Full Code available on Github \u2014Upsample_to_average.ipynb .", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist who loves to explore everything and write about the topics from multiple points of view."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc029032c57ca&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://vdekanovsky.medium.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": ""}, {"url": "https://vdekanovsky.medium.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Vaclav Dekanovsky"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fed473176733b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&user=Vaclav+Dekanovsky&userId=ed473176733b&source=post_page-ed473176733b----c029032c57ca---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/getting-started", "anchor_text": "Getting Started"}, {"url": "https://about.canva.com/license-agreements/onedesign/", "anchor_text": "license"}, {"url": "https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Pandas/Upsample/Upsample%20to%20average.ipynb", "anchor_text": "Upsample_to_average.ipynb"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/resampling.html", "anchor_text": "Resampling"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases", "anchor_text": "resample options in pandas documentation"}, {"url": "https://towardsdatascience.com/stock-fundamental-analysis-eda-of-secs-quarterly-data-summary-455e62ff4817", "anchor_text": "companies\u2019 fundamental data in order to predict future stock prices"}, {"url": "https://about.canva.com/license-agreements/onedesign/", "anchor_text": "license"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/resampling.html", "anchor_text": "resample"}, {"url": "https://towardsdatascience.com/stock-fundamental-analysis-eda-of-secs-quarterly-data-summary-455e62ff4817", "anchor_text": "performance of publicly traded companies"}, {"url": "https://partner.canva.com/vdek", "anchor_text": "canva.com"}, {"url": "https://towardsdatascience.com/complete-guide-to-pythons-cross-validation-with-examples-a9676b5cac12", "anchor_text": "Everything you wanted to know about Kfold train-test split"}, {"url": "https://towardsdatascience.com/stop-persisting-pandas-data-frames-in-csvs-f369a6440af5", "anchor_text": "Why it's worth considering another file types than csv"}, {"url": "https://towardsdatascience.com/pythons-geocoding-convert-a-list-of-addresses-into-a-map-f522ef513fd6", "anchor_text": "How to turn a list of addreses into a map"}, {"url": "https://towardsdatascience.com/", "anchor_text": "Towards data science"}, {"url": "https://github.com/vaclavdekanovsky/data-analysis-in-examples/blob/master/Pandas/Upsample/Upsample%20to%20average.ipynb", "anchor_text": "Upsample_to_average.ipynb"}, {"url": "https://medium.com/tag/python?source=post_page-----c029032c57ca---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pandas?source=post_page-----c029032c57ca---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c029032c57ca---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-preprocessing?source=post_page-----c029032c57ca---------------data_preprocessing-----------------", "anchor_text": "Data Preprocessing"}, {"url": "https://medium.com/tag/getting-started?source=post_page-----c029032c57ca---------------getting_started-----------------", "anchor_text": "Getting Started"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&user=Vaclav+Dekanovsky&userId=ed473176733b&source=-----c029032c57ca---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&user=Vaclav+Dekanovsky&userId=ed473176733b&source=-----c029032c57ca---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc029032c57ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c029032c57ca---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c029032c57ca--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c029032c57ca--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c029032c57ca--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c029032c57ca--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c029032c57ca--------------------------------", "anchor_text": ""}, {"url": "https://vdekanovsky.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://vdekanovsky.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Vaclav Dekanovsky"}, {"url": "https://vdekanovsky.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "623 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fed473176733b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&user=Vaclav+Dekanovsky&userId=ed473176733b&source=post_page-ed473176733b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F41f38caa0bb5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fupsample-with-an-average-in-pandas-c029032c57ca&newsletterV3=ed473176733b&newsletterV3Id=41f38caa0bb5&user=Vaclav+Dekanovsky&userId=ed473176733b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}