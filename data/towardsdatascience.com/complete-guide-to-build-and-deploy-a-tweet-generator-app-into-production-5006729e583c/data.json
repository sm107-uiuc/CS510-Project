{"url": "https://towardsdatascience.com/complete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c", "time": 1683005947.8590562, "path": "towardsdatascience.com/complete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c/", "webpage": {"metadata": {"title": "Complete Guide to Build and Deploy a Tweet Generator App into Production | by Nikhil Utane | Towards Data Science", "h1": "Complete Guide to Build and Deploy a Tweet Generator App into Production", "description": "- Background and Objective - The Big Picture - Building Dataset - Model Training - Deployment on AWS - Front-end - Analytics - Results - Challenges As an obsessive twitter user with a background in\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/MLOps", "anchor_text": "MLOps", "paragraph_index": 2}, {"url": "https://github.com/twintproject/twint", "anchor_text": "twint", "paragraph_index": 11}, {"url": "https://www.tweepy.org/", "anchor_text": "tweepy", "paragraph_index": 11}, {"url": "https://pypi.org/project/GetOldTweets3/", "anchor_text": "GetOldTweets3", "paragraph_index": 11}, {"url": "https://minimaxir.com/2020/01/twitter-gpt2-bot/", "anchor_text": "Max Woolf\u2019s notebook", "paragraph_index": 14}, {"url": "https://github.com/nikhilno1/bot-baby/blob/master/training/notebook/Train_a_GPT_2_Model_on_Tweets.ipynb", "anchor_text": "here", "paragraph_index": 15}, {"url": "https://cloud.google.com/ai-platform/pipelines/docs", "anchor_text": "AI Platform Pipelines", "paragraph_index": 17}, {"url": "https://francescopochetti.com/deploying-a-pretrained-gpt-2-model-on-aws/#Deploying_with_Lambda_EC2_and_DynamoDB", "anchor_text": "blog", "paragraph_index": 17}, {"url": "https://francescopochetti.com/deploying-a-pretrained-gpt-2-model-on-aws/#Why_not_going_entirely_serverless?", "anchor_text": "blog", "paragraph_index": 18}, {"url": "https://web-crunch.com/posts/lets-build-tailwind-css-tweet", "anchor_text": "Let\u2019s Build: With Tailwind CSS \u2014 Tweet", "paragraph_index": 29}, {"url": "https://github.com/manan2002", "anchor_text": "Manan", "paragraph_index": 29}], "all_paragraphs": ["- Background and Objective- The Big Picture- Building Dataset- Model Training- Deployment on AWS- Front-end- Analytics- Results- Challenges", "As an obsessive twitter user with a background in Data Analytics , I always wanted to build apps to analyze twitter data. I am concerned with the manner in which social media discourse is evolving, esp. on twitter. The proliferation of fake news, trolling, hate messages, fake trends, BOTs etc is alarming and I always had this urge to do something about it.", "I have also been looking to gain real-world MLOps experience, which I believe would help me in my next gig. I still had 3 months left in my one year mid-career break. Since it wasn\u2019t a lot of time (as I would also be searching for job) I wanted to pick a problem which isn\u2019t too focussed on the ML algorithm but would allow me to spend enough time in learning to deploy ML production models at scale.", "I decided to get going by building a tweet generator app for left-wing (LW) and right-wing (RW) Indian twitter. The idea behind the app is to highlight the polarization and the language used by both camps. The benefits of starting with this as I saw it were:", "With my objectives clearly defined, I started working on it and built the app in about 3 weeks.", "Let\u2019s look at all the details now.", "Here\u2019s a quick snapshot of all the building blocks that we\u2019ll be covering.", "To generate LW & RW tweets, I required two language models that are separately trained on its own dataset. The dataset in this case are the tweets from people who belong to the two camps.", "Now getting a list of LW & RW accounts can be a bit of a challenge because this information is not publicly present anywhere. More over everyone thinks of themselves as centrist. :)", "At first I thought of building some kind of social graph or clustering algorithm but then I found I don\u2019t need to do anything that complex. Here\u2019s what I ended up doing:", "Downloading data from twitter is a painful exercise because of the various rate-limits in place. I didn\u2019t want to risk my application getting blocked by creating a swarm of nodes and downloading. So I played it fair and used a single node to download the data.", "Unfortunately I didn\u2019t know about twint when I started building my dataset. I knew about tweepy and later found out about GetOldTweets3 library. Since these two together met my requirement I rolled with it. But If I were to do it again, I would most likely choose twint.", "Tweepy: 7 days, 18,000 tweets per a 15 minute window. 3,200 most recent tweets, extensive information for each tweet.", "GetOldTweets3: No authorization, Less information, fetches older tweets", "When I started working on this app I first began with training my own language model from scratch. I trained a GPT-2 model on TPU on Google Cloud. But the results weren\u2019t as close to fascinating as they were with Max Woolf\u2019s notebook. It worked right out of the box giving fantastic results so I stuck with it. To ease the training pain, I even signed up for Colab Pro subscription which is such a steal. For a day of training on TPU, I spent over a $100 but Colab Pro costs me $10 per month. I encourage everyone to make use of it. It gives you higher timeouts and RAM.", "My notebook for training is present here. It is quite identical to Max\u2019s original work. I use the 355M model of GPT-2. Depending on the size of my dataset, I trained for anywhere between 2000 to 6000 steps until I see the average loss coming down. For my training dataset of around 300 MB (each side), I trained for 6000 steps.", "Once the training completes, which takes about an hour, the model outputs a bunch of files, nicely packaged in an archive file which you can copy it to Google Drive for further distribution.", "My original plan was to do the production deployment on Google\u2019s newly released AI Platform Pipelines. It just seems like a comprehensive product for doing your MLOps. However when I came across this blog, which provided detailed instructions to deploy on AWS, I thought why don\u2019t I do this first. When you are working alone, it is important that you get your frequent doses of motivation. Nothing better for motivation than shipping your app as early as possible. So I decided to first deploy it on AWS and later worry about deploying it on scale with proper workflow on AI Platform Pipelines.", "As also explained in the blog, we cannot go completely serverless since each model is close to 1.5GB so I need at least 3 GB just for the models alone. Plus I need to do batch inferencing for which I need a GPU instance.", "Here\u2019s what the current deployment architecture looks like:", "The website is statically hosted on Amazon S3 which is really a cheap and fastest way to put your site out into the world.", "This creates an API endpoint that will receive incoming HTTP request from your front-end application and invoke the configured Lambda function.", "The default timeout for any integration is 3 seconds, so if you need to do any inferencing that will take longer then you need to increase this timeout accordingly.", "The Lambda function receives the HTTP GET request from API gateway and does the following:", "Like on the API Endpoint, we need to increase the timeout on the Lambda as well.", "Tip: Make use of TestEvent to test your Lambda function. You can configure the test event as below:", "To serialize the incoming HTTP requests, I am using SQS FIFO Queue. The Lambda function enqueues the incoming request into this queue and launches the EC2 GPU instance. The GPU instance upon starting reads from this queue and runs the inferencing one by one. This allows me to handle concurrent requests with a single EC2 instance in a highly cost-effective manner.", "For inferencing I am using recently launched and cost-effective G4 instance (g4dn.xlarge to be precise). G4 instances provide the latest generation NVIDIA T4 GPUs at a price of $0.58 per hour for on-demand hosts. The cost can be further reduced by using spot instances. You need to raise a service request to increase the vCPU limit before using a G4 instance.", "In the original code, the author launches a python script on the EC2 instance. However this meant an additional 15 seconds to load the model into memory for every inferencing. I modified this to run a web app instead (Starlette based). Below is everything that happens on the EC2 instance from start to finish.", "The front-end is developed using HTML, CSS & Javascript. To replicate twitter UI, Andy Leverenz\u2019s Let\u2019s Build: With Tailwind CSS \u2014 Tweet came as a godsend. It provided basic UI for displaying a single tweet which later I could extend (with some help from Manan) to show a side-by-side view of tweets.", "As mentioned earlier, the website is statically hosted on Amazon S3.", "Auto-completion:Considering that inferencing for new prompt takes anywhere between 30\u201360 seconds, whereas if user enters an existing prompt then results are obtained in about 250 ms, it made sense to encourage users to use existing prompts more. Therefore it became important to add an auto-completion feature so that user can select one from the list instead of entering his/her own.", "I considered a few complex solutions (using Elasticsearch or AWS Cloud Search) before implementing something extremely simple.", "Since my website is hosted on S3, I modified my front-end code to read a \u2018prompts\u2019 file from S3. This file contains a list of all the existing prompts. After the user does inferencing for a new prompt, whenever the instance gets shutdown, this prompts file on S3 gets updated. There is a small lag but otherwise this simple solution is working wonderfully.", "I wanted to get usage statistics and provide an option for users to give their feedback about the app.", "These are some of things I added for that:", "For both (3) & (4), you simply need to copy a few lines of code into your HTML that they provide.", "I played around with a few settings for temperature, top_p & top_n before settling down on these that gave the best result. These are also the recommended defaults.", "Where,temperature: The higher the temperature, the crazier the text top_k: Limits the generated guesses to the top k guesses top_p: Nucleus sampling: limits the generated guesses to a cumulative probability", "This section lists down some of the challenges I faced along the way. Hopefully it will help someone facing similar issues. (Note: I didn\u2019t do a good job of documenting all the issues/challenges I faced, so these are served from memory. I\u2019ll keep adding as I recollect.)", "This app was to get my feet wet in working with twitter data and learn MLOps. So I definitely want to move to Google\u2019s AI Platform Pipeline for a more complete ML workflow deployment. I also want to have an easy-to-use framework to download and store twitter data so I am going to explore twint. Once I have that in place, it will be easier to work on some of the other ideas. If you have any ideas/suggestions of your own involving twitter, please let me know by commenting below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5006729e583c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5006729e583c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nikhil.utane?source=post_page-----5006729e583c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Nikhil Utane"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd1e2f333b7b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&user=Nikhil+Utane&userId=d1e2f333b7b7&source=post_page-d1e2f333b7b7----5006729e583c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@purzlbaum?utm_source=medium&utm_medium=referral", "anchor_text": "\ud83c\udde8\ud83c\udded Claudio Schwarz | @purzlbaum"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://botbaby.in/", "anchor_text": "http://botbaby.in/"}, {"url": "https://github.com/nikhilno1/bot-baby", "anchor_text": "https://github.com/nikhilno1/bot-baby"}, {"url": "https://en.wikipedia.org/wiki/MLOps", "anchor_text": "MLOps"}, {"url": "https://github.com/twintproject/twint", "anchor_text": "twint"}, {"url": "https://www.tweepy.org/", "anchor_text": "tweepy"}, {"url": "https://pypi.org/project/GetOldTweets3/", "anchor_text": "GetOldTweets3"}, {"url": "https://pypi.org/project/GetOldTweets3/", "anchor_text": "GetOldTweets3"}, {"url": "https://pypi.org/project/GetOldTweets3/", "anchor_text": "GetOldTweets3"}, {"url": "https://minimaxir.com/2020/01/twitter-gpt2-bot/", "anchor_text": "Max Woolf\u2019s notebook"}, {"url": "https://github.com/nikhilno1/bot-baby/blob/master/training/notebook/Train_a_GPT_2_Model_on_Tweets.ipynb", "anchor_text": "here"}, {"url": "https://cloud.google.com/ai-platform/pipelines/docs", "anchor_text": "AI Platform Pipelines"}, {"url": "https://francescopochetti.com/deploying-a-pretrained-gpt-2-model-on-aws/#Deploying_with_Lambda_EC2_and_DynamoDB", "anchor_text": "blog"}, {"url": "https://francescopochetti.com/deploying-a-pretrained-gpt-2-model-on-aws/#Why_not_going_entirely_serverless?", "anchor_text": "blog"}, {"url": "https://aws.amazon.com/comprehend/", "anchor_text": "AWS Comprehend"}, {"url": "https://web-crunch.com/posts/lets-build-tailwind-css-tweet", "anchor_text": "Let\u2019s Build: With Tailwind CSS \u2014 Tweet"}, {"url": "https://github.com/manan2002", "anchor_text": "Manan"}, {"url": "https://mopinion.com/", "anchor_text": "mopinion"}, {"url": "https://github.com/minimaxir/gpt-2-cloud-run", "anchor_text": "gpt-2-cloud-run"}, {"url": "https://ap-south-1.console.aws.amazon.com/systems-manager/home", "anchor_text": "Systems Manager Quick Setup"}, {"url": "https://medium.com/tag/nlp?source=post_page-----5006729e583c---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5006729e583c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/aws?source=post_page-----5006729e583c---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/deployment?source=post_page-----5006729e583c---------------deployment-----------------", "anchor_text": "Deployment"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&user=Nikhil+Utane&userId=d1e2f333b7b7&source=-----5006729e583c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&user=Nikhil+Utane&userId=d1e2f333b7b7&source=-----5006729e583c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5006729e583c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5006729e583c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5006729e583c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5006729e583c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5006729e583c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5006729e583c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5006729e583c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5006729e583c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikhil.utane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nikhil Utane"}, {"url": "https://medium.com/@nikhil.utane/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "58 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd1e2f333b7b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&user=Nikhil+Utane&userId=d1e2f333b7b7&source=post_page-d1e2f333b7b7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fd1e2f333b7b7%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcomplete-guide-to-build-and-deploy-a-tweet-generator-app-into-production-5006729e583c&user=Nikhil+Utane&userId=d1e2f333b7b7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}