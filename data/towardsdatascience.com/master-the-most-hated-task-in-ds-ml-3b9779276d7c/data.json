{"url": "https://towardsdatascience.com/master-the-most-hated-task-in-ds-ml-3b9779276d7c", "time": 1683015750.6608021, "path": "towardsdatascience.com/master-the-most-hated-task-in-ds-ml-3b9779276d7c/", "webpage": {"metadata": {"title": "Cleaning Categorical Data: Intermediate Guide with Pandas | Towards Data Science", "h1": "Master the Most Hated Task in DS/ML", "description": "Learn how to clean categorical data based on membership constraints, value inconsistency. Also, master methods for collapsing categories into fewer ones and cut numerical data into groups."}, "outgoing_paragraph_urls": [{"url": "https://github.com/BexTuychiev/medium_stories/tree/master/cleaning_categorical_data", "anchor_text": "this", "paragraph_index": 5}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "first part", "paragraph_index": 14}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "first part", "paragraph_index": 32}, {"url": "https://www.linkedin.com/in/bextuychiev/", "anchor_text": "https://www.linkedin.com/in/bextuychiev/", "paragraph_index": 48}], "all_paragraphs": ["\u201cData scientists spend 60% of their time on cleaning and organizing data. Collecting data sets comes second at 19% of their time, meaning data scientists spend around 80% of their time on preparing and managing data for analysis. 57% of data scientists regard cleaning and organizing data as the least enjoyable part of their work and 19% say this about collecting data sets\u201d.", "Data cleaning is full of frustration, disgusting surprises that take hours to deal with, always new problems with new datasets, you name it. The process is never enjoyable and always considered as a dirty side of data science.", "Even though it is often hated, it might be the most important step before any data project. Without properly addressing issues with your data, you might compromise all the other stages in the data science workflow.", "Without much intro in this second part of my Data Cleaning Series, let\u2019s get right to the point. This post is about categorical data cleaning. I will be discussing common and uncommon methods to deal with some intermediate level categorical data problems. Here is the general overview:", "\u2218 Introduction \u2218 Setup \u2218 Categorical Data, Understanding, And Examples \u2218 Dealing With Categorical Data Problems \u2218 Membership Constraints \u2218 Value Inconsistency \u2218 Collapsing Data Into Categories \u2218 Reducing the Number of Categories", "You can get the notebook and the data used in this post on this GitHub repo.", "The formal definition of categorical data would be:", "A predefined set of possible categories or groups an observation can fall into.", "You can see examples of categorical data in almost all the datasets you have worked on. Nearly any type of data can be turned into categorical. For example:", "As we are learning data cleaning using panads library, it is important to understand that pandas will never import categorical data as categorical. It is mostly imported as strings or integers:", "You can see that cut, color and clarity are imported as strings rather than as categorical. We could have used the dtype parameter of read_csv like this:", "But with real-world datasets, you often do not have this luxury because the data you will be working on probably will have many categorical variables and often, you will be completely unfamiliar with the data at first.", "Right after you identify the categorical variables, there are some checks and cleaning to be done before you convert the columns to categorical.", "When you work with real-world data, it will be filled with cleaning problems.", "As I wrote in the first part of the series, people collecting data won\u2019t take into account the cleanliness of the data and do what it takes to record the necessary information in an easy manner as possible.", "Also, problems will arise because of free text during the collection process which leads to typos, many representations of the same value, etc. It is also possible that errors are introduced because of data parsing errors or bad database design.", "For example, consider this worst-case scenario: you are working on a survey data conducted across the USA and there is a state column for the state of each observation in the dataset. There are 50 states in the USA and imagine all the damn variations of state names people can come up with. You are in even bigger problem if data collectors decide to use abbreviations:", "Such columns will always be filled with typos, errors, inconsistencies. Never imagine that you will have a smooth one-to-one mapping of categories.", "Before moving on to analysis, you have to establish what is called membership constraints which clearly defines the number of categories and how they are represented in a single format.", "There are 3 ways you can treat categorical data problems:", "First, we will focus on isolating inconsistent observations and dropping them. I have created fake data to illustrate how it is done in code:", "It is often the case that you will have some background information about your data. For example, let\u2019s say you want to check for inconsistencies in the blood_type column of the above data frame. You find out beforehand that blood_type can only have these categories: [A+, A-, B+, B-, O+, O-, AB+, AB-]. So, you have to make sure that the column in the data source only includes these values.", "In our case, there are 10k rows and visual search for inconsistencies is not an option, which is also the case for many other real-world data. Here is how can implement the best solution for such problems:", "First, you should create a new data frame which holds all the possible values for a categorical column:", "PRO TIP: It is a good practice to create such data frames which hold category mappings for each categorical column in the main data.", "As we now have the correct categories in a separate data frame, we can use a basic set operation which gives us the difference of unique values in the two columns:", "To get the difference between the two sets, we use .difference function. It basically returns all the values from the left set that are not in the right set. Here is a very simple example:", "Attentive readers may have noticed that inside the set function, I also called .unique() on the blood_type. From what I have read from one StackOverflow thread, it seems that the time it takes to get the unique values will be much shorter if you use both set and unique for larger datasets.", "Now, we will filter our main data for the blood types \u2018C+\u2019 and \u2018D-\u2019:", "Using isin on blood_type will return a boolean series which we can use to index the data frame:", "So, there are 90 individuals with incorrect blood types. Since we don\u2019t have any clue of how these errors occurred (I did it\ud83d\ude01\ud83d\ude01\ud83d\ude01), we have to drop them. It can be done in two ways:", "As our column is clean now, it is safe to set it as a categorical variable:", "Definitely check out the first part of this series. There, I covered basic and common data problems. You will also familiarize yourself with some of the functions I will be using here.", "Just like we talked about in the second section, there may be many representations of the same category in the data set. These errors may occur just because of simple typos, random capitalization, you name it. Continuing cleaning our data, the turn has come to the marriage_status column:", "Using value_counts on a data frame column returns the count of unique values in that column. If you look at the result, you can immediately see the issues. The values should be either lower-case or upper-case. I prefer lower-case:", "Using .str on a data frame column enables us to use all the Python string functions on each value of the column. Here, we are using .lower() which converts strings to lowercase.", "value_counts is still returning 6 unique values, why? After paying close attention, you can see that one of the categories has extra leading whitespace. That's why it is being treated as an individual category. The same can be true for one of the unmarried, it might have trailing whitespace. We can use the string strip function to get rid of trailing whitespace from a string:", "Now the column is clean. All is left is to convert this column into a category data type too:", "Sometimes, you may want to take already existing data, often numerical, and generate categories from it. This can be useful in a number of cases.", "In our demographics dataset, we have an annual income column. It can be useful to cut this column into different income groups because doing so might give some extra insight into the data.", "pandas has a perfect function for this: cut. It enables us to cut numerical ranges like data frame columns into bins and give them custom labels. Let's see it in action:", "Now, we can use functions like value_counts to get more insight:", "You can also plot a count plot:", "Sometimes, there may be unnecessary categories. In such cases, you can collapse smaller categories into general and bigger categories which might suit your needs better. Consider the device column of our data:", "It is not much use to compare phone\u2019s operating system to computer\u2019s. What would be better is to reduce the categories into mobileOS and desktopOS. To do this, first, we need to create a dictionary which maps each category to the new one:", "Then, we use replace function of pandas which maps out the new categories dynamically:", "Read more articles related to the topic:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "BEXGBoost | DataCamp Instructor |\ud83e\udd47Top 10 AI/ML Writer on Medium | Kaggle Master | https://www.linkedin.com/in/bextuychiev/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3b9779276d7c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ibexorigin.medium.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": ""}, {"url": "https://ibexorigin.medium.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Bex T."}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F39db050c2ac2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&user=Bex+T.&userId=39db050c2ac2&source=post_page-39db050c2ac2----3b9779276d7c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pixabay"}, {"url": "https://www.pexels.com/photo/brown-wooden-floor-48889/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/#718bbc696f63", "anchor_text": "Forbes"}, {"url": "https://github.com/BexTuychiev/medium_stories/tree/master/cleaning_categorical_data", "anchor_text": "this"}, {"url": "https://www.kaggle.com/shivam2503/diamonds/download", "anchor_text": "link"}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "first part"}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "first part"}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "Master the Most Time-consuming task in DS/ML, #1Dealing with common data problemstowardsdatascience.com"}, {"url": "https://towardsdatascience.com/meet-the-hardest-functions-of-pandas-part-i-7d1f74597e92", "anchor_text": "Meet the hardest functions of Pandas, Part IMaster the when and how of pivot_table(), stack(), unstack()towardsdatascience.com"}, {"url": "https://towardsdatascience.com/meet-the-hardest-functions-of-pandas-part-ii-f8029a2b0c9b", "anchor_text": "Meet the hardest functions of Pandas, Part IIMaster the when and how of crosstab()towardsdatascience.com"}, {"url": "https://towardsdatascience.com/shape-tables-like-jelly-with-pandas-melt-and-pivot-f2e13e666d6", "anchor_text": "Meet the hardest functions of Pandas, Part IIIShape tables like JELLY with Pandas pivot() and melt()towardsdatascience.com"}, {"url": "https://towardsdatascience.com/how-i-customarily-bin-data-with-pandas-9303c9e4d946", "anchor_text": "How I customarily bin data with PandasYou might have been using only the defaultstowardsdatascience.com"}, {"url": "https://towardsdatascience.com/data-type-constraints-data-range-constraints-duplicate-data-with-pandas-44897a350b1e", "anchor_text": "Master the Most Time-consuming task in DS/ML, #1Dealing with common data problemstowardsdatascience.com"}, {"url": "https://towardsdatascience.com/from-kagglers-best-project-setup-for-ds-and-ml-ffb253485f98", "anchor_text": "From Kagglers: Best Project Setup for DS and MLA collection of best practices from top Kagglers for project successtowardsdatascience.com"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----3b9779276d7c---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3b9779276d7c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3b9779276d7c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----3b9779276d7c---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-development?source=post_page-----3b9779276d7c---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&user=Bex+T.&userId=39db050c2ac2&source=-----3b9779276d7c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&user=Bex+T.&userId=39db050c2ac2&source=-----3b9779276d7c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3b9779276d7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3b9779276d7c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3b9779276d7c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3b9779276d7c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3b9779276d7c--------------------------------", "anchor_text": ""}, {"url": "https://ibexorigin.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ibexorigin.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bex T."}, {"url": "https://ibexorigin.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "16.4K Followers"}, {"url": "https://www.linkedin.com/in/bextuychiev/", "anchor_text": "https://www.linkedin.com/in/bextuychiev/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F39db050c2ac2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&user=Bex+T.&userId=39db050c2ac2&source=post_page-39db050c2ac2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F22cea38b90f3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmaster-the-most-hated-task-in-ds-ml-3b9779276d7c&newsletterV3=39db050c2ac2&newsletterV3Id=22cea38b90f3&user=Bex+T.&userId=39db050c2ac2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}