{"url": "https://towardsdatascience.com/understand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500", "time": 1682995177.139452, "path": "towardsdatascience.com/understand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500/", "webpage": {"metadata": {"title": "Understand how your TensorFlow Model is Making Predictions | by Karl Weinmeister | Towards Data Science", "h1": "Understand how your TensorFlow Model is Making Predictions", "description": "Machine learning can answer questions more quickly and accurately than ever before. As machine learning is used in more mission-critical applications, it is increasingly important to understand how\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow", "paragraph_index": 1}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP", "paragraph_index": 1}, {"url": "https://collegescorecard.ed.gov/", "anchor_text": "College Scorecard", "paragraph_index": 2}, {"url": "https://collegescorecard.ed.gov/data/documentation/", "anchor_text": "data documentation", "paragraph_index": 3}, {"url": "https://colab.research.google.com/github/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "Colab", "paragraph_index": 8}, {"url": "https://github.com/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "Github", "paragraph_index": 8}, {"url": "http://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions", "anchor_text": "2017 NeurIPS paper", "paragraph_index": 14}, {"url": "https://twitter.com/kweinmeister", "anchor_text": "Twitter", "paragraph_index": 28}], "all_paragraphs": ["Machine learning can answer questions more quickly and accurately than ever before. As machine learning is used in more mission-critical applications, it is increasingly important to understand how these predictions are derived.", "In this blog post, we\u2019ll build a neural network model using the Keras API from TensorFlow, an open-source machine learning framework. One our model is trained, we\u2019ll integrate it with SHAP, an interpretability library. We\u2019ll use SHAP to learn which factors are correlated with the model predictions.", "Our model will be predicting the graduation debt of a university\u2019s graduates, relative to their future earnings. This debt-to-earnings ratio is intended to be a rough indicator of a university\u2019s return on investment (ROI). The data comes from the US Department of Education\u2019s College Scorecard, an interactive website that makes its data publicly available.", "The features in the model are listed in the table below. More details on the dataset can be found in the data documentation.", "We derive the target variable (debt-to-earnings ratio) from the debt and earnings data available in the dataset. Specifically, it is the median debt accumulated at graduation (MD_INC_DEBT_MDN), divided by the mean earnings 6 years after graduation (MN_EARN_WNE_INC2_P6).", "Scatter plots were created to visualize each feature\u2019s correlation with our target variable. Each chart below shows the feature on the X-axis and the debt/earnings ratio on the Y-axis.", "We\u2019ll use a Sequential model with 2 densely-connected hidden layers and a ReLU activation function:", "Below we see a plot of the training process. The widening gap between the training and validation error indicates some over-fitting. The over-fitting is most likely due to the limited number of samples (1,117) in the dataset with all of the required features. Nonetheless, given that the mean debt-to-earnings ratio is approximately 0.45, a mean absolute error of 0.1 demonstrates a meaningful prediction.", "To run the notebook directly in your browser, you can use Colab. It is also available in Github.", "The issue of college debt, which we are investigating in this blog post, has strong links to broader socio-economic issues. Any model and its training data should be carefully evaluated to ensure it is serving all of its users equitably. For example, if our training data included mostly schools where students attend from high-income households, the model\u2019s predictions would misrepresent schools whose students typically have many student loans.", "Where possible, data values have been filtered for middle-income students, to provide a consistent analysis across universities with students of varying household income levels. The College Scorecard data defines the middle-income segment as students with family household incomes between $30,000 and $75,000. Not all of the available data provides this filter, but it is available for key features such as the net price, earnings, debt, and completion rates.", "With this thought process in mind, the analysis can be further expanded to other facets in the dataset. It is also worth noting that interpretability reveals which features contribute most to a model\u2019s predictions. It does not indicate whether there is a causal relationship between the features and predictions.", "Interpretability is essentially the ability to understand what is happening in a model. There is often a tradeoff between a model\u2019s accuracy and its interpretability. Simple linear models can be straightforward to understand, as they directly expose the variables and coefficients. Non-linear models, including those derived by neural networks or gradient-boosted trees, can be much more difficult to interpret.", "Enter SHAP. SHAP, or SHapley Additive exPlanations, is a Python library created by Scott Lundberg that can explain the output of many machine learning frameworks. It can help explain an individual prediction or summarize predictions across a larger population.", "SHAP works by perturbing input data to assess the impact of each feature. Each feature\u2019s contribution is averaged across all possible feature interactions. This approach is based on the concept of Shapley values from game theory. It provides a robust approximation, which can be more computationally expensive relative to other approaches like LIME. More details on SHAP theory can be found in the library author\u2019s 2017 NeurIPS paper.", "SHAP provides several Explainer classes that use different implementations but all leverage the Shapley value based approach. In this blog post, we\u2019ll demonstrate how to use the KernelExplainer and DeepExplainer classes. KernelExplainer is model-agnostic, as it takes the model predictions and training data as input. DeepExplainer is optimized for deep-learning frameworks (TensorFlow / Keras).", "The SHAP DeepExplainer currently does not support eager execution mode or TensorFlow 2.0. However, KernelExplainer will work just fine, although it is significantly slower.", "Let\u2019s start with using the KernelExplainer to draw a summary plot of the model. We will first summarize the training data into n clusters. This is an optional but helpful step, because the time to generate Shapley values increases exponentially with the size of the dataset.", "The summary plot displays a distribution of Shapley values for each feature. The color of each point is on a spectrum where highest values for that feature are red, and lowest values are blue. The features are ranked by the sum of the absolute values of the Shapley values.", "Let\u2019s look at some relationships from the plot. The first three features with the highest contribution are the average SAT score, % of first-generation students, and % part-time enrollment. Note that each of these features have predominantly blue dots (low feature values) on the right-side where there are positive SHAP values. This tells us that low values for these features lead our model to predict a high DTE ratio. The fourth feature in the list, net price, has an opposite relationship, where a higher net price is associated with a higher DTE ratio.", "It is also possible to explain one particular instance, using the force_plot() function:", "In this particular example, the college\u2019s SAT average contributed most to its DTE prediction of 0.53, pushing its value higher. The completion rate (MD_INC_COMP_ORIG_YR4_RT) was the second most important feature, pushing the prediction lower. The values shown series of SHAP values can also be reviewed, across the whole data set, or a slice of n instances as shown here:", "SHAP will split the feature contribution across correlated variables. This is important to keep in mind when selecting features for a model, and when analyzing feature importances. Let\u2019s calculate the correlation matrix and see what we find:", "Let\u2019s cross-reference our top three features from the summary plot with the correlation matrix, to see which ones might be split:", "Several of the correlated features were grouped in the top of the summary plot list. It\u2019s worth keeping an eye on the completion rate and admission rate, which were lower in the list.", "SHAP has a dependence_plot() function which can help reveal more details. For example, let\u2019s look at the interaction between the first-generation ratio and the part-time ratio. As we observed in the summary plot, we can see that that the first-generation ratio is inversely correlated with its Shapley values. The dependency plot also shows us that the correlation is stronger when the university has a lower proportion of part-time students.", "In this blog post, we demonstrated how to interpret a tf.keras model with SHAP. We also reviewed how to use the SHAP APIs and several SHAP plot types. Finally, for a complete and accurate picture, we discussed considerations about fairness and correlated variables. You now have the tools to better understand what\u2019s happening in your TensorFlow Keras models!", "For more info on what I covered here, check out these resources:", "Let me know what you think on Twitter!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Cloud AI Advocacy Manager at Google"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd0b3c7e88500&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kweinmeister?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kweinmeister?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Karl Weinmeister"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56d387899b8b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&user=Karl+Weinmeister&userId=56d387899b8b&source=post_page-56d387899b8b----d0b3c7e88500---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP"}, {"url": "https://collegescorecard.ed.gov/", "anchor_text": "College Scorecard"}, {"url": "https://collegescorecard.ed.gov/data/documentation/", "anchor_text": "data documentation"}, {"url": "https://colab.research.google.com/github/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "Colab"}, {"url": "https://github.com/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "Github"}, {"url": "http://papers.nips.cc/paper/7062-a-unified-approach-to-interpreting-model-predictions", "anchor_text": "2017 NeurIPS paper"}, {"url": "https://colab.research.google.com/github/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "Colab notebook"}, {"url": "https://github.com/kweinmeister/notebooks/blob/master/tensorflow-shap-college-debt.ipynb", "anchor_text": "GitHub repository"}, {"url": "https://www.tensorflow.org/guide/keras", "anchor_text": "Getting started with tf.keras"}, {"url": "https://github.com/slundberg/shap", "anchor_text": "SHAP GitHub repository"}, {"url": "https://twitter.com/kweinmeister", "anchor_text": "Twitter"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d0b3c7e88500---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----d0b3c7e88500---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/interpretability?source=post_page-----d0b3c7e88500---------------interpretability-----------------", "anchor_text": "Interpretability"}, {"url": "https://medium.com/tag/student-loans?source=post_page-----d0b3c7e88500---------------student_loans-----------------", "anchor_text": "Student Loans"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----d0b3c7e88500---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&user=Karl+Weinmeister&userId=56d387899b8b&source=-----d0b3c7e88500---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&user=Karl+Weinmeister&userId=56d387899b8b&source=-----d0b3c7e88500---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd0b3c7e88500&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d0b3c7e88500---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d0b3c7e88500--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kweinmeister?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kweinmeister?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Karl Weinmeister"}, {"url": "https://medium.com/@kweinmeister/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "99 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56d387899b8b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&user=Karl+Weinmeister&userId=56d387899b8b&source=post_page-56d387899b8b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F56d387899b8b%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstand-how-your-tensorflow-model-is-making-predictions-d0b3c7e88500&user=Karl+Weinmeister&userId=56d387899b8b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}