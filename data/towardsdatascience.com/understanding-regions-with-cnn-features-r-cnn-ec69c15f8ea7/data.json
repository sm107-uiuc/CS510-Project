{"url": "https://towardsdatascience.com/understanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7", "time": 1683015708.3562229, "path": "towardsdatascience.com/understanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7/", "webpage": {"metadata": {"title": "Understanding Regions with CNN features (R-CNN) | by Parth Rajesh Dedhia | Towards Data Science", "h1": "Understanding Regions with CNN features (R-CNN)", "description": "Understanding Object Detection using Regions Proposed by Selective Search to Convolution Neural Network (R-CNN)"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/intersection-over-union-iou-calculation-for-evaluating-an-image-segmentation-model-8b22e2e84686", "anchor_text": "Intersection Over Union", "paragraph_index": 5}, {"url": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173", "anchor_text": "mean Average Precision", "paragraph_index": 7}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "OverFeat", "paragraph_index": 8}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "paper", "paragraph_index": 10}, {"url": "https://www.learnopencv.com/selective-search-for-object-detection-cpp-python/", "anchor_text": "Selective Search", "paragraph_index": 12}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "Rich feature hierarchies for accurate object detection and semantic segmentation,", "paragraph_index": 31}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "OverFeat:Integrated Recognition, Localization and Detectionusing Convolutional Networks", "paragraph_index": 32}], "all_paragraphs": ["In this blog post, I have explained the architectural details about the \u201cRich feature hierarchies for accurate object detection and semantic segmentation\u201d paper. Though this paper has been there for quite a while, there are still a lot of things to learn from the paper apart from the architecture. I have started with a brief overview of the OverFeat network and then proceeded with the RNN network. If you are unaware of the OverFeat network, then don\u2019t worry !! you still won\u2019t miss anything.", "Also, the structure of the blog is a bit different. It\u2019s more like a conversation between student and teacher (Trying to learn with the Feynman technique \ud83d\ude03). The questions from the student side are highlighted in bold (just in case you are in a rush).", "I am well versed with the famous Object Classification algorithms like VGG, AlexNet, ResNet, InceptionNet, MobileNet, (and all their variants) to name some. I was amazed by the architecture of such methods and would like to expand my knowledge in this domain further. However, I had one question in my mind, that these models are only able to tell whether an image contains an object or no. However, I would like to work on models that could also tell where that object is, in an image?", "The section of deep learning you wish to venture into has been also categorized as follows: Image Localisation, Object Detection, and Image Segmentation.", "Object Detection: Predicting bounding boxes of multiple objects of multiple classes. May contain many objects belonging to the same class as well.Image Localization: Predicting bounding box of only a single object, of a single class, in an imageImage Segmentation: To create a pixel-wise mask for each of the objects in an image.", "Among the three, we will be talking about Object Detection. Before diving into R-CNN architecture details, I would like you to know the concept of Intersection Over Union (IoU). The area of intersection between the two boxes, divided by the union of the area occupied by the two boxes, is defined as the Intersection Over Union. In the image below, the upper half shows a visual representation of the formula.", "Let the blue box, in the lower half of the above image, be the prediction of the object bounding box, and the yellow one be another prediction. So, the IoU is 1 when two boxes completely overlap, and the IoU is 0 when they don\u2019t overlap at all. All other cases fall between 0 and 1, and the exact value could be determined by using the bounding box coordinates. While training and evaluating the performance, one of the boxes can be labeled as ground truth, and if the IoU is below a particular threshold, then the prediction can be considered as false positive. Keep this explanation in mind, we will need it in a while.", "Also, the performance measurement used in the network is mean Average Precision (mAP). The mean Average Precision\u2019s nature is just like accuracy, the more the mAP, the better. Before jumping to R-CNN, we shall have a look at a model popular before\u00a0R-CNN.", "One of the first papers on object detection using Convolution Neural Network was OverFeat. They used a sliding window approach to detect objects present in different locations of an image. They also used an image pyramid so that smaller objects could be detected in enlarged images and larger objects can be detected in smaller images. The gif below will give you a visual idea about how the sliding window is used.", "The authors of OverFeat had used AlexNet as their base architecture and provided two networks, one fast and another, an accurate one. They had replaced the fully connected layers of CNN with a 1 x 1 Convolutional Layer (a nice idea) which reduce their computation and bumped the speed during training and testing. They also have a regression layer that takes input from the Pool5 layer and passes them through two dense layers and then the final output has 4 units that determine the bounding box.", "Note: I have over-simplified the explanation of OverFeat paper and there are many subtle details about the architecture and refer to the paper for those details", "I did not get time to look deep into the OverFeat paper, but based on the gif you showed, doesn\u2019t it look like many of the sub-section of images selected by the window won\u2019t be detecting any objects? Like these regions would be selected by the detector, send through the entire CNN architecture, and still not produce any objects and increase the computational cost? Won\u2019t it be better if we could somehow just give the model a hint that these places may have some object and the model will only tell me whether there is an object there or no at a particular location?", "The problem that you highlighted is indeed a caveat in OverFeat. The R-CNN paper does somewhat similar to what you intuitively felt should be done. It uses a Selective Search algorithm to detect possible locations of an object in an image and sends only those sections of images (around 2000 region proposals) to the AlexNet network. They replaced the last Softmax layer with an SVM layer and trained only the SVM layer for classification on Pascal VOC 2007(details about training will be explained later). Moreover, the Pascal VOC dataset has 20 classes, but they trained the SVM for 21 classes, where the extra class corresponds to the background class where there is no object. With this method, they were able to achieve an mAP of 44.7%. Have a look at the architecture!", "Those are really good results for object detection on the Pascal VOC, as they were much better than the contemporary models of that time. However, I had this one query, since the ImageNet dataset comes from a different distribution as compared to the Pascal VOC dataset, shouldn\u2019t the authors have fine-tuned the model? Based on the literature I am aware of, we generally fine-tune a model if the dataset distribution changes. And also, convolution networks take input of fixed size i.e., 227 x 227 in the case of AlexNet, so how did they apply that constrained on the regions proposed by the selective Search Algorithm?", "The authors first warped the images to 227 x 227 size and then passed them to the input and that\u2019s when they got an mAP of 44.7% after training the SVM. While warping the images the objects in the image may be stretched, elongated, squashed, etc and they may even hinder the performance. Hence the authors first fine-tuned the entire AlexNet network for classification. After that, the authors replaced the Softmax layer with the SVM layer and trained only this layer. Due to this fine-tuning, the mAP increased from 44.7% to 54.2%.", "There one more detail about the data used for fine-tuning\u00a0and\u00a0SVM\u00a0training. The pre-trained network is trained on the ImageNet dataset. While fine-tuning the model the authors used the Pascal VOC 2007 dataset. During fine-tuning i.e., with the softmax layer at the top, the images containing IoU \u2265 0.5 were used as ground-truth positive box and rest as a negative class (background, no object). However, for training the SVM, they used only images that are ground-truth as training and with an IoU < 0.3 as negative class. The remaining grey zone proposals were ignored. The authors also replaced the SVM with 21 way Softmax and the mAP dropped from 54.2% to 50.9%.", "Note: Details about selecting positive and negative samples for Softmax and SVM are provided in the Appendix-B of the paper", "This is the first time I came across such a method for fine-tuning. Are there any other peculiarities in the RCNN\u00a0paper?", "Yes, there are. The authors have done an exhaustive ablation study about their architecture. Most of the discussion lies around the necessity of the Dense Layers and fine-tuning the network. Let\u2019s look at it this way.", "Without Fine-tuningThe authors extracted features from the Pool5 layer of the Network, then from the fc6 layer, and then from the fc7 layer. For each of these extracted features, they trained the SVM layer separately and produced the mAP. Have a look at the image below.", "From the last column in the above image, we see that removing both the FC layers did not harm the performance much. Moreover, the features from fc6 layers are better predictors than the ones from the fc7 layer. Here\u2019s what the authors have said after this observation.", "This means that 29%, or about 16.8 million, of the CNN\u2019s parameters can be removed without degrading mAP. More surprising is that removing both fc7 and fc6 produces quite good result seven though pool5 features are computed using only 6% of the CNN\u2019s parameters.", "With Fine-tuningThe authors have now fine-tuned the network in various ways. First, when they used the features directly from Pool5 and sent it to SoftMax for fine-tuning the entire network. In this case, they saw a jump of 3% to the Pool5 features used without fine-tuning. Next, they also did the same for the fc6 and fc7 layers and saw an increase to 53% and 54.2% respectively.", "You can compare the mAP of the results obtained after tuning to those without tuning shared in the image above. Fine-tuning has considerably improved the results. However, there is something special about the 4th row, let\u2019s discuss that !!", "Using Bounding Box RegressorThe authors have added a bounding box regressor to the output of the pool 5 layers. After doing that they saw a considerable improvement in the performance of 58.5% mAP. This is an almost 14% hike in mAP to the model which wasn\u2019t fine-tuned. This bounding box regression was trained with l2 loss and was penalized the same with lambda = 1000.", "Note: Details about the bounding box regressor are in Appendix-C of the paper.", "The authors also tried replacing the AlexNet with VGG-16 and found a more 8% increase in mAP while using the bounding box regressor.", "I would now refer you to read the paper for a deeper dive into the paper and implementation details. They have also provided a detailed explanation of the ILSVRC2013 detection dataset and also compared their models with other models.", "That was a pretty exhaustive analysis done by the authors. This paper may be a bit old, but the way the analysis of model architecture is performed is noteworthy. These strategies, of experimentally verifying the contribution of a layer to the improvement in accuracy, could be used while designing any other types of models for even some other tasks.", "Yes, they have performed a detailed and comprehensive analysis of their model and also compared the same with the contemporary models. Just on a final note, and for definition sake, a model like R-CNN is called two-stage model. Such models have a separate algorithm/model (selective search) for detecting the possible location of the object and a separate model for detecting the presence of the object (AlexNet). And the training of this model (including the bounding box regressor) is a three-stage process, where the first stage, the model is fine-tuned, in the second stage, the SVM classifier is trained and in the third stage, the bounding box regressor is trained.", "Note: I have discussed the scores and analysis of the Pascal VOC 2007 dataset from the R-CNN paper. The paper has shown an in-depth analysis of other datasets as well.", "R. Girshick, J. Donahue, T. Darrell, J. Malik, Rich feature hierarchies for accurate object detection and semantic segmentation, Computer Vision and Pattern Recognition, 2014", "X. Zhang, M. Mathieu, R. Fergus, Y. LeCun, OverFeat:Integrated Recognition, Localization and Detectionusing Convolutional Networks, Computer Vision and Pattern Recognition, 2014", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I like reading and implementing the ideas researched in Computer Vision and Deep Learning papers. I post my notes on Medium."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fec69c15f8ea7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://parthdedhia.medium.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Parth Rajesh Dedhia"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69485e9d0ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=post_page-69485e9d0ea6----ec69c15f8ea7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@pietrozj?utm_source=medium&utm_medium=referral", "anchor_text": "Pietro Jeng"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/intersection-over-union-iou-calculation-for-evaluating-an-image-segmentation-model-8b22e2e84686", "anchor_text": "Intersection Over Union"}, {"url": "https://app.diagrams.net/", "anchor_text": "draw.io"}, {"url": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173", "anchor_text": "mean Average Precision"}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "OverFeat"}, {"url": "https://unsplash.com/@sonniehiles?utm_source=medium&utm_medium=referral", "anchor_text": "Sonnie Hiles"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "paper"}, {"url": "https://www.learnopencv.com/selective-search-for-object-detection-cpp-python/", "anchor_text": "Selective Search"}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1311.2524.pdf", "anchor_text": "Rich feature hierarchies for accurate object detection and semantic segmentation,"}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "OverFeat:Integrated Recognition, Localization and Detectionusing Convolutional Networks"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----ec69c15f8ea7---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ec69c15f8ea7---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/r-cnn?source=post_page-----ec69c15f8ea7---------------r_cnn-----------------", "anchor_text": "R Cnn"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----ec69c15f8ea7---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----ec69c15f8ea7---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=-----ec69c15f8ea7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=-----ec69c15f8ea7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fec69c15f8ea7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ec69c15f8ea7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ec69c15f8ea7--------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Parth Rajesh Dedhia"}, {"url": "https://parthdedhia.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "77 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69485e9d0ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=post_page-69485e9d0ea6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F21fd8c4a6fae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7&newsletterV3=69485e9d0ea6&newsletterV3Id=21fd8c4a6fae&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}