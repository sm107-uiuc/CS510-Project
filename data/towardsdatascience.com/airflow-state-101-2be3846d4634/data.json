{"url": "https://towardsdatascience.com/airflow-state-101-2be3846d4634", "time": 1683011884.670382, "path": "towardsdatascience.com/airflow-state-101-2be3846d4634/", "webpage": {"metadata": {"title": "Airflow State 101. An Overview of State in Airflow | Towards Data Science", "h1": "Airflow State 101", "description": "In this article, we discuss the fundamental of what is the Airflow State, what types are those states, how to use the Airflow State to test, and debug"}, "outgoing_paragraph_urls": [{"url": "https://godatadriven.com/blog/highlights-from-the-new-apache-airflow-1-10-2-release/", "anchor_text": "Highlights from the new Apache Airflow 1.10.2 release", "paragraph_index": 16}, {"url": "https://airflow.readthedocs.io/en/latest/howto/customize-state-colors-ui.html", "anchor_text": "Customizing state colors in UI", "paragraph_index": 20}, {"url": "https://chengzhizhao.medium.com/subscribe", "anchor_text": "subscribe to my new articles", "paragraph_index": 24}, {"url": "https://chengzhizhao.medium.com/membership", "anchor_text": "referred Medium member", "paragraph_index": 24}, {"url": "https://www.linkedin.com/in/chengzhizhao/", "anchor_text": "Linkedin", "paragraph_index": 25}, {"url": "https://twitter.com/ChengzhiZhao", "anchor_text": "Twitter", "paragraph_index": 25}, {"url": "http://chengzhizhao.com", "anchor_text": "chengzhizhao.com", "paragraph_index": 27}], "all_paragraphs": ["In Airflow, to describe the status of a DAG or a Task that is waiting to execute the next steps, we have defined State to share that information on the progress of the pipeline. Without the State, the execution of any DAG or task becomes a black box, and you might need to create additional external flag or resources to check status to help determine if a job finished or failed. Fortunately, Airflow provides the mechanism of State and stores each of the last recorded states in its backend DB. Not only this way is easy to watch the status of any job in Airflow UI or DB, but it\u2019s also a persistent layer to help rerun or backfill while confronting failure.", "In this article, we are going to discuss the fundamental of what is the Airflow State, what types are those states, how to use the Airflow State to test, and debug. There could be external service, and Airflow might track those states as well, but those states are out of scope for our discussion.", "A good example of states in real life is like the traffic light. You\u2019d have three states: RED, YELLOW, and GREEN. The RED light forbids any traffic from proceeding, whereas GREEN light allows traffic to proceed.", "The most basic usage of the Airflow state is to designate the current status and assign the Airflow scheduler to decide future actions. Although there are more states in Airflow, similar to the traffic light, there are some common characteristics.", "As for current version Airflow 1.10.11, the State in Airflow has two main categories: Task and Dagrun.", "DAG is a collection of tasks; the State of DAG is like the main power switch at your home. If it failed, even you keep its tasks to keep running, and the Airflow scheduler will disregard it since the State of the dagrun is failed.", "The State at Task level is at a more granular level since the tasks can have dependencies among each other. Some states could have multiple successive states, and that\u2019s the reason why you have more states at the task level to handle the more complicated situation. For example, upstream_failed indicates that the current task cannot be executed due to something failed upstream.", "Another way to view the State is to see whether the State is finished or unfinished. A finished state means that the Airflow scheduler won\u2019t monitor them any longer, so it is out of the scope of scheduling and monitoring. On the other hand, for the unfinished State, those are pending states, there will be upcoming changes for the current unfinished State, but the ultimate goal is to reach a finished state.", "As for now, the finished states are SUCCESS, FAILED, UPSTREAM_FAILED (Note this one is not mentioned in the list of finished State), and SKIPPED, all the rest are unfinished states.", "Let\u2019s go over each State in more detail and discuss it.", "SUCCESS (In both dagrun and task level | finished State): a success state shows that Airflow didn\u2019t face any error while running the job and finished successfully. In the Airflow, dagrun has a dark green circle, and the task level has a dark green square. Even for a dummy task, since there isn\u2019t any error, though the Airflow doesn\u2019t execute anything meaningful here, it would still consider the dummy task as SUCCESS as we tell the Airflow to run nothing, and Airflow should get SUCCESS back to us.", "RUNNING (In both dagrun and task level | unfinished StateState): a running state determines the Airflow scheduler already has assigned those dag or task to the executor. It is monitoring (via heartbeat) its State, and the executor is running the actual jobs. In the Airflow, dagrun has a light green circle, and the task level has a light green square. Since RUNNING is an unfinished state, at any given time, your dag or task could fail, then it leads to retry or failed State. Also, at the task level, while a given task is still running, if you rerun the task itself (by clearing its State), sometimes the Airflow scheduler will put a SHUTDOWN state, which is an external request to shut down and kill the task.", "FAILED (In both dagrun and task level | finished state): a failed state points to the users that something goes wrong during the execution period, and Airflow cannot schedule and execute it to the end. In Airflow, dagrun has a red circle, and the task level has a red square. Since there are no dual states in Airflow, for partial success, dagrun would still flag as failed to let users explore further. On the other hand, at the task level, Airflow marks the exact failed tasks, and all the downstream of that tasks are marked as UPSTREAM_FAILED (if trigger_rule default to all_success), which is nice to help users find out the initial cause of failures immediately.", "UPSTREAM_FAILED (task level only| finished State): an upstream failed state is a state that refers to some errors that happened upstream. You also could have multiple upstream, and in this case, you\u2019d consider the trigger_rule, which default to all_success. In this case, if any of the upstream tasks failed, you\u2019d get the UPSTREAM_FAILED. However, if you don\u2019t want to have this behavior, Airflow provides more options, for example, you could do one_success, which will continue the current task if only one of the upstream tasks is a success.", "SKIPPED (task level only| finished State): a skipped state is a task that has been ignored execution, and the scheduler bypasses the task and continues. Skipping a task is usually an expected behavior in branch operation, which you\u2019d have multiple conditions to choose from, once some of them are decided, the unchosen ones are marked as skipped. You can also mark a task skipped explicitly without using the branch operator, which involves setting up the Airflow state manually. Whenever you have a task skipped, all its downstream will also be skipped as well.", "UP_FOR_RETRY (task level only| unfinished State): a up_for_retry state means the previous attempts have failed since this task has retried multiple times, it is marked as ready for retry. But how long should a task wait for retry on the next iteration? The Airflow scheduler waits after the retry interval pass and picks it up when the next scheduler\u2019s heartbeat reaches.", "UP_FOR_RESCHEDULE (task level only| unfinished State): a up_for_reschedule is a newly introduced state since Airflow 1.10.2, more detail can be referred to Highlights from the new Apache Airflow 1.10.2 release. This State works mostly for sensors, and it helps to avoid consuming all the worker slots so that a deadlock condition can be resolved.", "QUEUED (task level only| unfinished State): a queue state is triggered when the task is waiting for a slot in an executor. A queue state is simply a waiting list for the executor to perform bookkeeping in the pipeline, the executor assigns tasks to the worker to run the actual task. Once a slot is available, a task is pulled from the queue (with priority), and the worker is going to run it.", "NONE (task level only| unfinished State): None state might be confusing as it represents unknown in some language. Here it is just a way to describe a new task created, and its initial state is unknown. You\u2019d observe the None state when a new dagrun starts, all of its tasks are None in the first place. Also, if you want to rerun some dags or tasks, once you clear the State, all of them become None states. In the backend, if it is the first time you start a dagrun, though all tasks are NONE state, you won\u2019t find any entry in the DB until the tasks are scheduled. However, rerun a task to clear its State is another story, you\u2019d find its previous State in DB before rerunning.", "SCHEDULED (task level only| unfinished State): the SCHEDULED State is for Airflow to send tasks to the executor to run. There are multiple conditions that the Airflow scheduler checks to see if tasks can be scheduled. For example, A task can be blocked to be scheduled due to the available slots across the entire Airflow, and the time between the wall clock time and scheduled time. Once all the conditions have been met for scheduling, the Airflow scheduler will move forward with the task to the SCHEDULED State.", "One exciting feature is to change the colors in Airflow UI. If you don\u2019t like the default one, this new feature introduced in Airflow 1.10.11 that you can Customizing state colors in UI", "The State is driven and controlled by the Airflow scheduler and executor. Airflow official GitHub has this lifecycle diagram that shows the state flowchart nicely. We have covered each State and the State for the sensor (UP_FOR_RESCHEDULE). This diagram also shows a list of possible states for each component. An alternative stage transition is an option for each Airflow operator that is controlled by the user to perform retry optionally. Still, all the other stages have to follow this transition flow.", "The State is an indispensable element in the Airflow ecosystem. States are like a seat belt in Airflow. it tracked for each dagrun and task, whenever there is a crash in the Airflow scheduler, executor, or worker, the State performs as a checkpoint, so we don\u2019t have to restart from the beginning. Also, with the State also shown in Airflow UI, everyone uses it as the central place to monitor the status. Finally, Airflow internally uses the State to track the progress of the tasks, and engineers can rely on the State to perform more customized tasks. I hope this article can give you a basic idea of the Airflow State and why it\u2019s essential to understand the difference between each State. Cheers!!", "I hope this story is helpful to you. This article is part of a series of my engineering & data science stories that currently consist of the following:", "You can also subscribe to my new articles or become a referred Medium member who gets unlimited access to all the stories on Medium.", "In case of questions/comments, do not hesitate to write in the comments of this story or reach me directly through Linkedin or Twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Engineer | Data Content Creator | Contributor of Airflow, Flink | Blog chengzhizhao.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2be3846d4634&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://chengzhizhao.medium.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": ""}, {"url": "https://chengzhizhao.medium.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Chengzhi Zhao"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff956c63a9571&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&user=Chengzhi+Zhao&userId=f956c63a9571&source=post_page-f956c63a9571----2be3846d4634---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@zburival?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Zbynek Burival"}, {"url": "https://unsplash.com/s/photos/windmill?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://giphy.com/gifs/MySPAR-spar-my-green-tag-sale-RK4gAjDOPT8Lys5TvG", "anchor_text": "SPAR"}, {"url": "https://github.com/apache/airflow/blob/main/docs/apache-airflow/img/task_lifecycle_diagram.png", "anchor_text": "lifecycle diagram"}, {"url": "https://godatadriven.com/blog/highlights-from-the-new-apache-airflow-1-10-2-release/", "anchor_text": "Highlights from the new Apache Airflow 1.10.2 release"}, {"url": "https://airflow.readthedocs.io/en/latest/howto/customize-state-colors-ui.html", "anchor_text": "Customizing state colors in UI"}, {"url": "https://github.com/apache/airflow/blob/master/docs/img/task_lifecycle_diagram.png", "anchor_text": "Apache Airflow"}, {"url": "https://unsplash.com/@hannahmorgan7?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Hannah Morgan"}, {"url": "https://unsplash.com/s/photos/ferris-wheel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://chengzhizhao.medium.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Chengzhi Zhao"}, {"url": "https://chengzhizhao.medium.com/list/data-engineering-data-science-stories-ddab37f718e7?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "View list"}, {"url": "https://chengzhizhao.medium.com/subscribe", "anchor_text": "subscribe to my new articles"}, {"url": "https://chengzhizhao.medium.com/membership", "anchor_text": "referred Medium member"}, {"url": "https://www.linkedin.com/in/chengzhizhao/", "anchor_text": "Linkedin"}, {"url": "https://twitter.com/ChengzhiZhao", "anchor_text": "Twitter"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2be3846d4634---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----2be3846d4634---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2be3846d4634---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/airflow?source=post_page-----2be3846d4634---------------airflow-----------------", "anchor_text": "Airflow"}, {"url": "https://medium.com/tag/tech?source=post_page-----2be3846d4634---------------tech-----------------", "anchor_text": "Tech"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&user=Chengzhi+Zhao&userId=f956c63a9571&source=-----2be3846d4634---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&user=Chengzhi+Zhao&userId=f956c63a9571&source=-----2be3846d4634---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2be3846d4634&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2be3846d4634---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2be3846d4634--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2be3846d4634--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2be3846d4634--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2be3846d4634--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2be3846d4634--------------------------------", "anchor_text": ""}, {"url": "https://chengzhizhao.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://chengzhizhao.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Chengzhi Zhao"}, {"url": "https://chengzhizhao.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "598 Followers"}, {"url": "http://chengzhizhao.com", "anchor_text": "chengzhizhao.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff956c63a9571&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&user=Chengzhi+Zhao&userId=f956c63a9571&source=post_page-f956c63a9571--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fad43d9b589c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-state-101-2be3846d4634&newsletterV3=f956c63a9571&newsletterV3Id=ad43d9b589c&user=Chengzhi+Zhao&userId=f956c63a9571&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}