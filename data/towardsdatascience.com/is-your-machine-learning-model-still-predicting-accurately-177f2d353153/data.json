{"url": "https://towardsdatascience.com/is-your-machine-learning-model-still-predicting-accurately-177f2d353153", "time": 1683006392.7904088, "path": "towardsdatascience.com/is-your-machine-learning-model-still-predicting-accurately-177f2d353153/", "webpage": {"metadata": {"title": "Is Your Machine Learning Model Still Predicting Accurately? | by Kyosuke Morita | Towards Data Science", "h1": "Is Your Machine Learning Model Still Predicting Accurately?", "description": "When we build a machine learning model, we validate and test its accuracies/performance in various ways. Although the accuracy is quite high in the test set, the prediction will eventually drift by\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/kyosek/change-point-detection-kl-divergence", "anchor_text": "GitHub repo", "paragraph_index": 1}, {"url": "https://bitcoin.org/en/faq#what-determines-bitcoins-price", "anchor_text": "bitcoin.org", "paragraph_index": 23}, {"url": "https://coinmarketcap.com/currencies/bitcoin/historical-data/?start=20130429&end=20200302", "anchor_text": "CoinMarketCap", "paragraph_index": 24}, {"url": "https://www.linkedin.com/in/kyosuke-morita-58329286/", "anchor_text": "LinkedIn page", "paragraph_index": 40}], "all_paragraphs": ["When we build a machine learning model, we validate and test its accuracies/performance in various ways. Although the accuracy is quite high in the test set, the prediction will eventually drift by time. This is often caused by the future data \u201cdrift\u201d to a different state from the training dataset. But how can we detect this drift effectively? This blogpost shows using direct ratio estimation to detect the change point with Bitcoin daily price data.", "The codes for this post is available on my GitHub repo.", "2. Direct ratio (KL Divergence and Relative unconstrained Least-Squares Importance Fitting) Estimations", "3. Example with Bitcoin Price Data", "3.1. Introduction of Bitcoin and the Data", "3.2. Applying the KL divergence estimation to detect the state change", "3.3. State change threshold by using Bolinger bands", "As I mentioned above, the change point detection (CPD) is basically trying to find the dissimilarity of time series sequences.", "Liu, et al. (2013) defined the CPD problem as measuring the difference between 2 consecutive subsequences y(t) and y(t+n). These subsequences have a certain time period of the window k to evaluate. Below visualises the PCD concept.", "Also this can be formalised by using a statistical hypothesis test (Harchaoui, et al., 2009).", "H_1: there exists 1 < k < n such that", "Above was a brief introduction of the CDP concept. Next section will go through how we will calculate direct ratio estimations.", "2. Direct ratios (KL Divergence and Relative unconstrained Least-Square Importance Fitting) Estimation", "Here we will go through those two direct ratio estimation methods. First, the famous KL divergence equation given probability distributions p(x) and p\u2019(x) can be expressed as below.", "The KL divergence is a non-negative and not normalised measure e.g. KL[p(x)||p\u2019(x)] in [0,inf+). The higher value shows that these probability distributions are further away.", "Before we go to Relative unconstrained Least-Squares Importance Fitting, let\u2019s have a look into unconstrained Least-Squares Importance Fitting (uLSIF). This uses Pearson (PE) divergence as below.", "However, the PE divergence value could be unbounded depending on the condition of p\u2019(x). To overcome this property, RuLSIF introduced the convex combination to the second given probability distribution, which can be expressed as below.", "As taking the convex combination, the calculated value of RuLSIF is always bounded.", "When we calculate the above values, the length of the window is also one of the key points for this method. When you set the window small, it is more sensitive to changes. It can detect even small change quickly however this also can capture false-positive cases \u2014 like just a temporal drift of the variables. On the other hand, when you set a bigger window, its estimation would be more stable and get less false-positive cases. Yet it would take some period of time to actually detect the state change. Therefore, it is critical to find the appropriate window to use this method. If even a small state change is crucial for your machine learning model predictions (e.g. min based stock price prediction), then it is more suitable to use a smaller window. If your machine learning model is not affected or can tolerate a small state change, it is better to apply a bigger window.", "As both of KL divergence and RuLSIF values are not normalised and there\u2019s no formal threshold, it is necessary to decide how we use these values to detect the change point. For example, we can apply a 95% confidence interval (Sebasti\u00e3o, et at., 2007), and also something more like financial technical analysis tools - let\u2019s say Bolinger bands and moving averages. It is quite important to use an appropriate decision making rule to find the state change.", "Next section will show the example of how to use those direct ratio estimation methods to detect the state change with the Bitcoin price data.", "3. Example with Bitcoin price data", "3.1 Introduction of Bitcoin and the Data", "So what is Bitcoin? Bitcoin is the most popular decentralised virtual currency at the moment. Its price is merely determined by supply and demand (from bitcoin.org). So simply when the demand for Bitcoin is high, the value of Bitcoin increases and then the demand is low, the value decreases. Also, there is a finite amount of Bitcoin and will be newly created at a predictable and decreasing rate, which means that to keep the Bitcoin price stable, it needs to be having slight inflation. At this moment, as the market volume is still relatively small compared to what it could be, the Bitcoin price is quite volatile - it is relatively easier to be influenced by the demand comparison to the stock market.", "Now we will look into the Bitcoin data. The data are retrieved from CoinMarketCap. It includes dates, open, high, low, close prices, volumes and market caps of the date (all the prices are in USD) from 2013\u201304\u201329 until 2020\u201303\u201328. We will use close prices in this post.", "Here is the day to day close prices of Bitcoin.", "We can see the Bitcoin price is quite volatile. As mentioned above, the price is determined by the supply and demand, when there\u2019s more demand the price goes up, for example, around at the end of 2013 because of the financial shock in Cyprus and at the beginning of 2020, the price went down because of the uncertainty caused by the coronavirus.", "3.2. Applying the KL divergence estimation to detect the state change", "Here we are trying to use the direct ratio estimation method to machine learning model drift. In order to fit the CPD problem to this setting, we need to modify the above formulation. Instead of using a moving window for the original probability distribution, we will use a fixed window in the train set. So that we can calculate how (not) train set and unseen data are similar.", "Here suppose we built a machine learning model that can predict the Bitcoin close price of the next day by using its data from 2013\u201304\u201329 until the end of 2018. So we will compare some subsequence from the train set and unseen future prices. Here we will try to see the model drift on a monthly level, thus set the window as 30.", "Let\u2019s calculate KL divergence on each date and plot those values.", "As we can observe there are quite a few spikes almost every month in 2019. Yet the spikes drop after some time so these might be just caused by seasonality. However, there is a massive spike in March 2020. This is obviously due to the coronavirus shock.", "Now we can compare the KL divergence plot and actual Bitcoin price distribution to see how they are related to each other.", "In Bitcoin price plot, the subsequence in the hypothetical \u201ctrain set\u201d is shown in red and rest are unseen price. So those direct ratio estimations were calculated red subsequence against blue subsequence with 30 days window.", "We notice that when the price sores a lot in a short time of period, the estimated value also spikes. It is interesting that even though the Bitcoin price is an upward trend since the beginning of 2019 until it hit its highest value around July 2019 and then became downtrend, the estimated KL divergence values show \u2018constant waves\u2019 until 2020. It might be because the distribution of the train set already takes into the volatility of Bitcoin price and the theoretical constant inflation account so that the estimated KL divergence values are not really responding to a gradual increase of the price but rather abrupt price change.", "3.3. State Change Threshold with Bolinger Bands", "Finally, we will explore the decision making threshold for a state change detection. Here we will try to see how Bolinger bands can be used for this purpose. Bolinger bands are often used for financial technical analysis. It is applying a simple moving average and moving standard deviation. Below is the code snippet for the calculation of Bolinger bands.", "Here we are using 21 days simple moving average and 2 days moving standard deviation and the \u2018bands\u2019 are calculated by using 2 standard deviations (95% interval) per definition. Also we are only interested in the upper bound of Bolinger bands as the characteristic of the problem (we just want to know when the distributions are getting far away), we only plot the upper bound.", "As we can see there are few periods of time the estimated KL divergence went above the upper bound of Bolinger band, which means the state change happened. By this method, we can tell the change point systematically and also by changing the window of moving average, we can modify the sensitivity of detection (smaller window is less sensitive to the change).", "This blog post went through the following points:", "Hope you find this post interesting. In case you would like to connect with me, here\u2019s my LinkedIn page.", "Sebasti\u00e3o, R., & Gama, J. (2007, December). Change detection in learning histograms from data streams. In Portuguese Conference on Artificial Intelligence (pp. 112\u2013123). Springer, Berlin, Heidelberg.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior data scientist at a bank in London."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F177f2d353153&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----177f2d353153--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kyosuke1029?source=post_page-----177f2d353153--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kyosuke1029?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Kyosuke Morita"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe98eeeb527fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&user=Kyosuke+Morita&userId=e98eeeb527fd&source=post_page-e98eeeb527fd----177f2d353153---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@sergiomar73?utm_source=medium&utm_medium=referral", "anchor_text": "Sergio Mart\u00ednez"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/kyosek/change-point-detection-kl-divergence", "anchor_text": "GitHub repo"}, {"url": "https://unsplash.com/@silverhousehd?utm_source=medium&utm_medium=referral", "anchor_text": "Andr\u00e9 Fran\u00e7ois McKenzie"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://bitcoin.org/en/faq#what-determines-bitcoins-price", "anchor_text": "bitcoin.org"}, {"url": "https://coinmarketcap.com/currencies/bitcoin/historical-data/?start=20130429&end=20200302", "anchor_text": "CoinMarketCap"}, {"url": "https://www.linkedin.com/in/kyosuke-morita-58329286/", "anchor_text": "LinkedIn page"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----177f2d353153---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----177f2d353153---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/kl-divergence?source=post_page-----177f2d353153---------------kl_divergence-----------------", "anchor_text": "Kl Divergence"}, {"url": "https://medium.com/tag/charge-point?source=post_page-----177f2d353153---------------charge_point-----------------", "anchor_text": "Charge Point"}, {"url": "https://medium.com/tag/bitcoin?source=post_page-----177f2d353153---------------bitcoin-----------------", "anchor_text": "Bitcoin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&user=Kyosuke+Morita&userId=e98eeeb527fd&source=-----177f2d353153---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&user=Kyosuke+Morita&userId=e98eeeb527fd&source=-----177f2d353153---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----177f2d353153--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F177f2d353153&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----177f2d353153---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----177f2d353153--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----177f2d353153--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----177f2d353153--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----177f2d353153--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----177f2d353153--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kyosuke1029?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kyosuke1029?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kyosuke Morita"}, {"url": "https://medium.com/@kyosuke1029/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "132 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe98eeeb527fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&user=Kyosuke+Morita&userId=e98eeeb527fd&source=post_page-e98eeeb527fd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F528af6cace3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fis-your-machine-learning-model-still-predicting-accurately-177f2d353153&newsletterV3=e98eeeb527fd&newsletterV3Id=528af6cace3c&user=Kyosuke+Morita&userId=e98eeeb527fd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}