{"url": "https://towardsdatascience.com/how-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1", "time": 1683004896.0140312, "path": "towardsdatascience.com/how-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1/", "webpage": {"metadata": {"title": "How to Pull Data from an API using Python Requests | by Cameron Warren | Towards Data Science", "h1": "How to Pull Data from an API using Python Requests", "description": "The thing that I\u2019m asked to do over and over again is automate pulling data from an API. Despite holding the title \u201cData Scientist\u201d I\u2019m on a small team, so I\u2019m not only responsible for building\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/generalists-vs-specialists-in-data-science-and-analytics-fe5d8b55f1e6?source=your_stories_page---------------------------", "anchor_text": "Many of you are probably in the same boat.", "paragraph_index": 0}, {"url": "https://www.postman.com/", "anchor_text": "Postman", "paragraph_index": 3}, {"url": "https://docs.microsoft.com/en-us/graph/api/resources/mail-api-overview?view=graph-rest-1.0", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://docs.microsoft.com/en-us/graph/auth-register-app-v2", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://docs.microsoft.com/en-us/graph/auth-v2-service", "anchor_text": "here", "paragraph_index": 11}, {"url": "https://requests.readthedocs.io/en/master/", "anchor_text": "Python Requests", "paragraph_index": 19}, {"url": "https://crontab.guru/#0_18_*_*_5", "anchor_text": "this site", "paragraph_index": 32}, {"url": "https://www.linkedin.com/in/cameronwarren/", "anchor_text": "https://www.linkedin.com/in/cameronwarren/", "paragraph_index": 36}, {"url": "http://stitcher.tech/", "anchor_text": "http://stitcher.tech/", "paragraph_index": 37}], "all_paragraphs": ["The thing that I\u2019m asked to do over and over again is automate pulling data from an API. Despite holding the title \u201cData Scientist\u201d I\u2019m on a small team, so I\u2019m not only responsible for building models, but also pulling data, cleaning it, and pushing and pulling it wherever it needs to go. Many of you are probably in the same boat.", "When I first began my journey for learning how to make HTTP requests, pull back a JSON string, parse it, and then push it into a database I had a very hard time finding clear, concise articles explaining how to actually do this very important task. If you\u2019ve ever gone down a Google black hole to resolve a technical problem, you\u2019ve probably discovered that very technical people like to use technical language in order to explain how to perform the given task. The problem with that is, if you\u2019re self-taught, as I am, you not only have to learn how to do the task you\u2019ve been asked to do but also learn a new technical language. This can be incredibly frustrating.", "If you want to avoid learning technical jargon and just get straight to the point, you\u2019ve come to the right place. In this article, I\u2019m going to show you how to pull data from an API and then automate the task to re-pull every 24 hours. For this example, I will utilize the Microsoft Graph API and demonstrate how to pull text from emails. I will refrain from using pre-prepared API packages and rely on HTTP requests using the Python Requests package \u2014 this way you can apply what you learn here to nearly any other RESTful API that you\u2019d need to work on.", "If you're having trouble with API requests in this tutorial, here\u2019s a tip: Use Postman. Postman is a fantastic app that allows you to set up and make API calls through a clean interface. The beauty of it is once you get the API call working, you can export the code in Python and then paste it right into your script. It\u2019s amazing.", "*Note: This tutorial is meant to be a simple and easy to understand method to access an API, that\u2019s it. It will likely not be robust to your exact situation or data needs, but should hopefully set you down the right path. I\u2019ve found the below method to be the simplest to understand to quickly get to pulling data. If you have suggestions to make things even easier, sound off in the comments.", "There\u2019s no way around navigating API documentation. For working with Outlook, you go here. If you are successful in following this tutorial and want to do more with the API, use that link for a reference.", "Most APIs, including the Microsoft Graph, require authorization before they\u2019ll give you an access token that will allow you to call the API. This is often the most difficult part for someone new to pulling data from APIs (it was for me).", "Follow the instructions here to register your app (these are pretty straightforward and use the Azure GUI) You\u2019ll need a school, work, or personal Microsoft account to register. If you use a work email, you\u2019ll need admin access to your Azure instance. If you\u2019re doing this for work, contact your IT department and they\u2019ll likely be able to register the app for you. Select \u2018web\u2019 as your app type and use a trusted URL for your redirect URI (one that only you have access to the underlying web data. I used franklinsports.com as only my team can access the web data for that site. If you were building an app, you would redirect to your app to a place where your app could pick up the code and authorize the user).", "Once your app is registered, go to the App Registration portal:", "Click where it displays the name of your app:", "On the following page, click on \u2018View API Permissions\u2019.", "Finally, select the Microsoft Graph and then check all the boxes under Messages for \u2018Delegated Permissions.\u2019 (Note for this example I\u2019ll only be pulling emails from a single signed-in user, to pull email data for an organization you\u2019ll need application permissions \u2014 follow the flow here).", "Ok \u2014 you\u2019re ready to start making API calls.", "Authorization Step 1: Get an access code", "You\u2019ll need an access code to get the access token that will allow you to make calls to the MS Graph API. To do this, enter the following URL into your browser, swapping the appropriate credentials with the information shown on your app page.", "Take the URL that outputs from the code snippet and paste it into your browser. Hit enter, and you\u2019ll be asked to authorize your Microsoft account for delegated access. Use the Microsoft account that you used to register your app.", "If the authorization doesn\u2019t work, there\u2019s something wrong with the redirect URL you\u2019ve chosen or with the app registration. I\u2019ve had trouble with this part before \u2014 so don\u2019t fret if it doesn\u2019t work on your first try. If the authorization is successful, you\u2019ll be redirected to the URL that you used in the App registration. Appended to the URL will be parameters that contain the code you\u2019ll use in our next step \u2014 it should look like this:", "Take the full code and save it in your python script.", "Authorization Step 2: Use your access code to get a refresh token.", "Before proceeding, make sure you have the latest version of the Python Requests package installed. The simplest way to do that is by using pip:", "In this step, you will take the code generated in step 1 and send a POST request to the MS Graph OAuth authorization endpoint in order to acquire a refresh token. (*Note: For security purposes, I recommend storing your client_secret on a different script than the one you use to call the API. You can store the secret in a variable and then import it (or by using pickle, which you\u2019ll see below).", "Swap the ####### in the code snippet with your own app information and the code you received in step 1, and then run it. (*Note: The redirect URI must be url encoded which means it\u2019ll look like this: \u201chttps%3A%2F%2Ffranklinsports.com\u201d)", "You should receive a JSON response that looks something like this:", "Authorization Step 3: Use your refresh token to get an access token", "At this point you already have an access token and could begin calling the API, however, that access token will expire after a set amount of time. Therefore we want to set up our script to acquire a fresh access token each time we run it so that our automation will not break. I like to store the new refresh_token from step 2 in a pickle object, and then load it in to get the fresh access_token when the script is run:", "With your access_token in tow, you\u2019re ready to call the API and start pulling data. The below code snippet will demonstrate how to retrieve the last 5 email messages with specific subject paramaters. Place the access_token (bolded below) in the headers and pass it in the get request to the email messages endpoint.", "The code above will return a json output that contains your data.", "If you want more than 5 emails, you\u2019ll need to paginate through the results. Most APIs have thier own methods for how to best paginate results (in english, most APIs will not give you all the data you want with just one API call, so they give you ways to make multiple calls that allow you to move through the results in chunks to get all or as much as you want). The MS Graph is nice in that it provides the exact endpoint you need to go to to get the next page of results, making pagination easy. In the below code snippet, I demonstrate how to use a while loop to make successive calls to the api and add the subject and text of each email message to a list of lists.", "Finally, I\u2019ll show an example of how put the JSON data into a CSV text file, which could then be analyzed with excel or pushed into a database. This code snippet will demonstrate how to write each row of our list of lists into a CSV file.", "Now that our script is written. We want to automate it so we can get new messages within our parameters as they come in daily.", "I\u2019ve done this in two ways, however, there are many ways to automate:", "This is quite simple. If your on Ubuntu, type into your console \u2018crontab -e\u2019 and it will open up your cronjobs in a text file. Go to a new line and type in:", "Assuming cron is set up correctly, the above would set the script to automatically run at 1 UTC every day (or whatever timezone your server is on). You can change that time to whatever you need it to by changing the 1 in the code. If you want to get complex with your cron timing, this site is a nice resource.", "This is a nice and easy way to automate in windows that uses the Task Scheduler App. Simply open Task Scheduler and click \u2018Create Task\u2019 on the right hand side. This app is quite straightforward and allows you to set the schedule and what program you want to run using the GUI.", "When your in the \u2018Actions\u2019 pain, select Python as the program and then in the Add Arguments tab (the one with \u2018(optional)\u2019 next to it), put the path to your .py file.", "In this walkthrough, I\u2019ve shown you how to pull your email data from the Microsoft Graph API. The principles demonstrated here can be used to work with nearly any RESTful API or to do much more complex tasks with the Microsoft Graph (I\u2019ve used the MS Graph API to push files in and out of our corporate sharepoint, push data from sharepoint folders into our database, and send automated emails and reports).", "Questions or comments? You can email me at cwarren@stitcher.tech. Or, follow me on Linkedin at https://www.linkedin.com/in/cameronwarren/", "I also provide Data services, which you can learn more about at http://stitcher.tech/.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Writing about how teams and individuals can more effectively use data. Follow me: @camwarrenm"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fedcc8d6441b1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://camwarrenm.medium.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": ""}, {"url": "https://camwarrenm.medium.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Cameron Warren"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc3718e9a78dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&user=Cameron+Warren&userId=c3718e9a78dd&source=post_page-c3718e9a78dd----edcc8d6441b1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/generalists-vs-specialists-in-data-science-and-analytics-fe5d8b55f1e6?source=your_stories_page---------------------------", "anchor_text": "Many of you are probably in the same boat."}, {"url": "https://www.postman.com/", "anchor_text": "Postman"}, {"url": "https://docs.microsoft.com/en-us/graph/api/resources/mail-api-overview?view=graph-rest-1.0", "anchor_text": "here"}, {"url": "https://docs.microsoft.com/en-us/graph/auth-register-app-v2", "anchor_text": "here"}, {"url": "https://docs.microsoft.com/en-us/graph/auth-v2-service", "anchor_text": "here"}, {"url": "https://requests.readthedocs.io/en/master/", "anchor_text": "Python Requests"}, {"url": "https://graph.microsoft.com/v1.0/me/messages?$search=", "anchor_text": "https://graph.microsoft.com/v1.0/me/messages$search="}, {"url": "http://twitter.com/odata", "anchor_text": "@odata"}, {"url": "https://crontab.guru/#0_18_*_*_5", "anchor_text": "this site"}, {"url": "https://www.linkedin.com/in/cameronwarren/", "anchor_text": "https://www.linkedin.com/in/cameronwarren/"}, {"url": "http://stitcher.tech/", "anchor_text": "http://stitcher.tech/"}, {"url": "https://medium.com/tag/api?source=post_page-----edcc8d6441b1---------------api-----------------", "anchor_text": "API"}, {"url": "https://medium.com/tag/python?source=post_page-----edcc8d6441b1---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----edcc8d6441b1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----edcc8d6441b1---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&user=Cameron+Warren&userId=c3718e9a78dd&source=-----edcc8d6441b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&user=Cameron+Warren&userId=c3718e9a78dd&source=-----edcc8d6441b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fedcc8d6441b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----edcc8d6441b1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----edcc8d6441b1--------------------------------", "anchor_text": ""}, {"url": "https://camwarrenm.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://camwarrenm.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Cameron Warren"}, {"url": "https://camwarrenm.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc3718e9a78dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&user=Cameron+Warren&userId=c3718e9a78dd&source=post_page-c3718e9a78dd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3e43fa182472&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-pull-data-from-an-api-using-python-requests-edcc8d6441b1&newsletterV3=c3718e9a78dd&newsletterV3Id=3e43fa182472&user=Cameron+Warren&userId=c3718e9a78dd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}