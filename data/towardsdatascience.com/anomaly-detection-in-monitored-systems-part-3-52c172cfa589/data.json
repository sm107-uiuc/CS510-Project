{"url": "https://towardsdatascience.com/anomaly-detection-in-monitored-systems-part-3-52c172cfa589", "time": 1683011047.0986362, "path": "towardsdatascience.com/anomaly-detection-in-monitored-systems-part-3-52c172cfa589/", "webpage": {"metadata": {"title": "Anomaly detection in monitored systems | Yonatan Alon | Towards Data Science", "h1": "Anomaly detection in monitored systems (part 3)", "description": "Learning how Gaussian distributions and the properties they have can help us perform anomaly detection on monitored data."}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@yonatanalon/anomaly-detection-in-monitored-systems-part-1-a6080da61c75", "anchor_text": "second article", "paragraph_index": 0}], "all_paragraphs": ["In the second article of this series, we learned a bit more about the Gaussian function, and we then built a working anomaly detection system using its properties. In this final part, we will be dealing with the multivariate case, as promised in part 1 of the series. Unlike parts 1 and 2, which didn\u2019t require any previous knowledge, this article will require at least basic knowledge of linear algebra (especially working with vectors and matrices).", "So what exactly is a multivariate distribution? The \u201cmultivariate\u201d part generalizes distributions in one dimension to any finite number of dimensions. This makes multivariate distributions incredibly useful in modeling data associated with many monitored parameters of a given device, all at once. The method by which we extend our definition to higher dimensions is by something called a \u201crandom vector\u201d. A vector X = (X1, X2,\u2026, Xn) is called a random vector if Xk is a random variable for every 1\u2264k\u2264n. A random vector is considered to be normally distributed if, in addition to the property above, any linear combination of its random variables is also a normally distributed random variable.", "How do we interpret such reading to give us a classification of anomalies in the behaviour of monitored devices? The simplest way is perhaps to multiply the random variables with each other. Because a random variable monitors output over time, we can treat our random variables as vectors whose values are just ordinary numbers from a given field. We can then multiply them element-wise to give us what is called a product distribution:", "We can the establish the mean and the standard deviation of our product distribution, and use them to calculate the probability of a sample being anomalous, with respect to the product distribution Z: Whenever we read a new group of values from our monitored device, we construct a vector z = (z1, z2,\u2026,zn) where zi denotes the latest value of the i-th monitored parameter. We then calculate the probability of z being an anomaly by multiplying the independent values with each other:", "The main benefit of using a product distribution is that calculating products between numbers is one of the cheapest computational calculations to perform. But using product distribution also has several drawbacks. Two such drawbacks that come to mind are that there is no guarantee Z will be normally distributed and that Z can fail to capture certain types of anomalies.", "Let\u2019s say we are monitoring a computer network and we are collecting data from one of our firewalls. We are interested in two operating parameters of this firewall: the number of concurrent connections and the amount of kilobytes/second transmitted. We start monitoring the firewall and assign X1 as the number of connected users and X2 ad the amount of kb/s transmitted.", "After a certain period, we get a reading z = (z1, z2) and we plot it as the red \u2018X\u2019 marker in the chart above. When we look at the chart, we can clearly see that z is an anomaly \u2014 it got plotted far away from the main \u201ccluster\u201d of readings. But if we follow the red dotted lines, we find out that z is a normal reading: z1 is quite close to the mean reading of connected users, and z2 is also close to the mean of kb/s transmitted. Therefore if we multiply p(z1)*p(z2) to check for anomalies, the results will show that z is not an anomaly.", "But it turns out there is another statistic method we can use, which can also capture these anomalies in our data. And that method uses what\u2019s called the multivariate Gaussian distribution, which is a multidimensional abstraction of the one-dimensional Gaussian function.", "Let\u2019s have a look at the formula, before explaining what it means:", "Since I\u2019m assuming you took my advice in the first paragraph, I hope you know your way around most of the symbols in this formula. If you were brave enough to proceed without such knowledge, you should at least know that in the same way a vector is like a row or column of numbers, a matrix is a grid of numbers (or a row of vectors). Vectors and matrices have their own special rules of addition and multiplication, while determinants, inverses and transpositions are more specialized operations we perform on matrices.", "However, the real gem in that formula is the covariance matrix: this very special matrix has a few useful properties in statistics, including being the foundation block for the multivariate Gaussian. The formula for the covariance matrix is given as follows:", "The covariance matrix we described here measures the relationship between a random vector and itself, as expressed by the scalar values in each cell of the matrix. One useful way of expressing this relationship is by a close relative of the covariance matrix, called the correlation matrix. The correlation matrix divides each value in the covariance matrix by the product of the standard deviations of the random variables Xi and Xj", "The practical result of this division is that the values of the covariance matrix are now bounded between -1 and +1. Rij = 1 indicates a positive linear relationship between Xi and Xj \u2014 measuring a large value of Xi dictates an increase to the same measurement of Xj. In contrast, Rij = 1 indicates a negative linear relationship between Xi and Xj \u2014 measuring a large value of Xi dictates a decrease to the same measurement of Xj.", "Values between -1 and 1 express non-linear relationships, with 0 meaning Xi and Xj are linearly independent. Due to the nature of such relationships, it immediately means that \u03a3 (and R) are symmetric matrices. That is \u2014 \u03a3ij = \u03a3ji for every 1\u2264i\u2264j\u2264n.", "These statistical, non-linear relationships are exactly what makes the covariance matrix so powerful. Because it can capture all these relationships between the random variables that make up the random vector X, the multivariate Gaussian can detect these undetected anomalies we had in our product distribution. They might be close to the mean value of every random variable, but because they lie outside the multivariate distribution they can be classified as anomalies.", "The technique we are going to use is similar to the one we used in the univariate case: Instead of a line, we are going to use a plane (or a higher dimensional analog) to \u201cslice\u201d through the distribution, then calculate the volume between the multivariate Gaussian and the coordinate plane.", "Because we are working in an n-dimensional space, we need to perform an integration exactly n times. This makes us calculate:", "But calculating n integrals analytically, especially when n can be quite large (in excess of 10,000 for example) is very computationally expensive. Which is why I\u2019m going to take a shortcut: the \u201cbell curve\u201d shape of the Gaussian implies that the lower the value returned (you might have noticed G(X,\u03bc,\u03a3) returns a scalar value regardless of the size of n), the smaller the area trapped underneath the \u201ctails\u201d of the Gaussian.", "Because of this relationship between the value returned by G and the probability of an observation being at a given distance from the mean of the distribution, I could compare p(x) to any arbitrary threshold, and classify any values smaller than the given threshold as anomalies. This might not be a direct calculation of the probability of observing a given value in our data, but perhaps one way you could justify this classification is by noting that because the Gaussian is a continuous function, every threshold \u03b5 \u2208 (0, max(G)) has a matching value t so that p(t) = \u03b5. Instead of classifying anomalies as any value for which p(x) < \u03b5, we can think of our classification as marking any x for which p(x) < p(t) as an anomaly.", "To recap, we have learned that:", "\u00b7 Product distributions are an easy way to classify multivariate anomalies, which is also computationally cheap.", "\u00b7 Their major drawback is that they fail to classify certain kinds of anomalies.", "\u00b7 The covariance matrix (and its close relative, the correlation matrix) can be used to measure the relationship between the random variables of a random vector X.", "\u00b7 These relationships allow the multivariate Gaussian function to classify all the anomalies that were missed by the product distribution.", "\u00b7 We can classify anomalies by comparing them to any arbitrary value \u03b5 \u2208 (0, max(G)), since performing a high-dimensional integration is computationally expensive.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist @ InfiniGrow; Independent ML researcher and aspiring writer in my free time"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F52c172cfa589&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yonatanalon.medium.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": ""}, {"url": "https://yonatanalon.medium.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Yonatan Alon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4cd28429f72&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&user=Yonatan+Alon&userId=e4cd28429f72&source=post_page-e4cd28429f72----52c172cfa589---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@yonatanalon/anomaly-detection-in-monitored-systems-part-1-a6080da61c75", "anchor_text": "second article"}, {"url": "https://en.wikipedia.org/wiki/Correlation_and_dependence#/media/File:Correlation_examples2.svg", "anchor_text": "wikimedia"}, {"url": "https://www.coursera.org/learn/machine-learning/", "anchor_text": "Coursera"}, {"url": "https://medium.com/tag/statistics?source=post_page-----52c172cfa589---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/probability?source=post_page-----52c172cfa589---------------probability-----------------", "anchor_text": "Probability"}, {"url": "https://medium.com/tag/data-science?source=post_page-----52c172cfa589---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----52c172cfa589---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/anomaly-detection?source=post_page-----52c172cfa589---------------anomaly_detection-----------------", "anchor_text": "Anomaly Detection"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&user=Yonatan+Alon&userId=e4cd28429f72&source=-----52c172cfa589---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&user=Yonatan+Alon&userId=e4cd28429f72&source=-----52c172cfa589---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F52c172cfa589&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----52c172cfa589---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----52c172cfa589--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----52c172cfa589--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----52c172cfa589--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----52c172cfa589--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----52c172cfa589--------------------------------", "anchor_text": ""}, {"url": "https://yonatanalon.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yonatanalon.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yonatan Alon"}, {"url": "https://yonatanalon.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "37 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4cd28429f72&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&user=Yonatan+Alon&userId=e4cd28429f72&source=post_page-e4cd28429f72--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5330ef2858ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-monitored-systems-part-3-52c172cfa589&newsletterV3=e4cd28429f72&newsletterV3Id=5330ef2858ba&user=Yonatan+Alon&userId=e4cd28429f72&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}