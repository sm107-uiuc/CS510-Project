{"url": "https://towardsdatascience.com/predicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf", "time": 1683015780.2570481, "path": "towardsdatascience.com/predicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf/", "webpage": {"metadata": {"title": "Predicting Churn with user log data from a digital music streaming app | by Lucas Correa | Towards Data Science", "h1": "Predicting Churn with user log data from a digital music streaming app", "description": "Predicting Churn is one of the most interesting things a company could do in order to better understand clients and anticipate changes in revenue. In this post, I will use the data from a digital\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9", "anchor_text": "post", "paragraph_index": 22}, {"url": "https://danvatterott.com/blog/2019/11/18/balancing-model-weights-in-pyspark/", "anchor_text": "post of Dan Vatterott", "paragraph_index": 28}, {"url": "https://www.analyticsvidhya.com/blog/2017/03/imbalanced-data-classification/#:~:text=Dealing%20with%20imbalanced%20datasets%20entails,as%20it%20has%20wider%20application.", "anchor_text": "post", "paragraph_index": 31}, {"url": "https://www.kdnuggets.com/2016/06/regularization-logistic-regression.html", "anchor_text": "generalize better to unseen data", "paragraph_index": 33}, {"url": "https://github.com/Lucas-Correa/Churn-in-Sparkfy", "anchor_text": "git repository", "paragraph_index": 39}], "all_paragraphs": ["Predicting Churn is one of the most interesting things a company could do in order to better understand clients and anticipate changes in revenue. In this post, I will use the data from a digital music streaming platform called Sparkfy to explain how to create a machine learning model that predicts the users churn.", "In this post we are going to discuss how this dataset is organized and what can we do in order to define churn for this problem. After having a business understanding, I will walk through ways to find features that help us better identifying churned users. Further, I will use these features to build some basic models that should predict whether a user is going to churn. Finally, I will use some evaluation metrics to help me pick the best model and parameters for predicting.", "At the end of these steps, we will have a machine learning model that receives information about user activity and says who are the ones more likely to leave the platform.", "First things first, it is important to explain how this company works. Sparkify is basically like Spotify, it has free and premium accounts. The free accounts show advertisements from time to time and the premiums one don't. The main goal here is to predict which users are going to stop using Sparkfy streaming services, regardless of its account type.", "The following database was provided by Udacity in its nano degree for Data Scientists and represent the logs of every interaction a user had within the platform. The full dataset has a 12GB size and that is why the code for this post was written in pyspark. This way I could write a basic code with a smaller subset of the data (124MB) and then scale up to a cluster. For this post, I will use the small subset as an example of each step.", "Getting the first line of the dataset provides us with a preview of what to expect in each field of a log. Columns like artist, firstname, gender are pretty straightforward to understand what it is. It also has some identifications fields like itemSession, sessionId, and userId that we should keep in mind when we operate some aggregation functions. For this id's, It is important to say that every user has its own Id and every time he login the user starts a session, where every interaction is an item in that session until he logs off.", "Other important columns are ts which stands for the timestamp of the log, registration that represents the timestamp of when the user registered his account, and page which is basically what is that interaction. Below are some of the possible pages in the platform.", "After understanding what each element of your database means, you can now start looking for some errors or unwanted registers. I started checking for rows with no Id's and end up finding that there are some registers from guests users, which is described in the auth column. This is not in our interest since we could not predict churn for non-clients.", "A second step that could help a lot in the future analyzes is to convert the ts and registration columns into date-time formats so we can read date and time information and perform some date operations.", "The log base doesn\u2019t seem too messy to demand a lot of cleaning and for that reason, these two steps may be enough for now. Usually, many of the cleaning steps appear after we put some effort into the next steps.", "Defining what is churn for the experiment is crucial. In this example, churn will be defined as the users who visited the page Cancellation Confirmation. This page appears when a user clicks on this cancellation option and finished the operation by confirming it. This page could be accessed by both paid and free accounts.", "The churn definition could suit your predictions goal. For instance, you may be interested in keep users in a paid account and for this, your churn definition would-be users that have access to the Submit Downgrade page. This definition should follow a clear change of behavior that you can measure and wants to avoid.", "After defining churn it is time to work on a preliminary hypothesis for the event. Exploring the data gives you the opportunity to find and test some patterns as well as discover some new uncleaned parts of the data. A good start is showing up some basic statistics about the base.", "The small subset has 225 unique users Id's where 52 of them are Canceled ones. Just with these basic stats, we can see that our data is imbalanced, that is, it has considerably more of one type of label. In this case, 23% of all users have churned users and 77% are not. This kind of data brings some problems in building the model that we are going to discuss further.", "Thinking a little bit about the problem, I come up with some hypothesis of what could influence user churn:", "To see if this is a good hypothesis, I started to get some simple aggregations around each label.", "The table above shows a small difference in items per session, distinct songs listened and total songs played. This gives a direction about the first three hypotheses, but one could say an active user has more time in the platform and therefore more time to increase all the numbers for these stats.", "Exploring user interactions, we could see that churned users have fewer friends added and pretty much less Thumbs Up in their songs. Despite Thumbs Down doesn't show too much difference, on average, the number of interactions a user has seems to have a strong difference in the user choice of churn.", "Finally as mentioned before, one could question the time that churned users stayed in the platform. For this reason, the next table considers the number of sessions in the last 30 days. Apparently, it doesn't show too much of a difference like before.", "After playing around with some ideas, you should pick the ones you have the most expectations based on the EDA. After some consideration, I end up with the following features:", "For some of the features is important to normalize the values. In this case, I only transform the gender categorical data into binary numerical data so it could be used in the model.", "You understood the dataset, made some assumptions, tested hypotheses and now it is the time to put it all together in a machine learning model! Before testing some models, let divide the dataset into random samples with 80% for training and 20% for testing the model.", "Before fitting any model, we should define how are we going to compare them. For this sake, accuracy is always a good starting point, after all, we want the model to predict as many as possible correct labels. However, usually, we give higher importance to a type of error in classifications models and for that reason, we are going to consider other evaluation metrics as Recall and Precision. If you want to have a better understanding of what each of the metrics is, I recommend the following post.", "In this specific problem, the whole point of finding possible churning users is to interact with them in order to avoid their accounts' cancellation. Maybe giving them discounts or offering new specially designed playlists to keep them active in the platform. So, worst-case scenario, if we predict a user is going to cancel its account when he is not, Sparkfy will keep an already active user more engaged in the platform.", "However, when the model predicts that a user is not likely to churn when in fact he is, this classification error is costing Sparkfy a client, which means that we are falling in the main goal of the classification problem. Therefore, in our evaluation, we should prioritize recall over precision.", "There are a number of possible models that we could apply in this case of binary classification. I will try 3 different models that are very mainstream for this kind of problem and compare their results. One of the best performances is going to be the one we are going to tune. The models chose for this first trial are the Logistic Regression, Gradient Boosted Decision Trees, and Supported Vector Machine Classifier.", "The Logistic Regression classifier is the simplest and therefore is going to be our baseline to compare the rest of the models. I created a basic function that takes the resulting data frames from our classifiers and displays the metrics we are going to compare.", "Despite the good accuracy, the precision and recall of this model are bellows acceptable. This happened because of the imbalanced data, as mentioned before. Since active users are more predominant over the churned ones, the model will classify most of the user as active and still get a good accuracy, which is the only metric the model is trying to improve.", "For this reason, I will consider a weight correction for this model in order to make it robust to the unbalancing of classes. This technique gives more importance to labels that appear less. I used the code below from this post of Dan Vatterott to create a column in my data frame that creates the desirable balancing.", "After creating the weights, we should put it on a column before the split:", "With the class balancing, the model greatly increased its precision and recall, with a minor penalty in the accuracy metric.", "For the Gradient Boost Tree Classifier, we don't need to use class weights. Boosting Classifiers works through a number of interactions that penalize wrong predictions. This makes them good statistical models to apply over imbalanced data because they naturally place more weight on those cases which were incorrectly classified in the last interactions. You could dive deeper into this subject in this post.", "The best base model among the three classifiers is the Logistic Regression. It predicts more corrected labels with a good recall value. Also, we didn't need to give up much precision in this classifier in order to get a good recall. The next step is going to be hyper tuning the model.", "For tuning a model you should get an intuition of what each of the available parameters does to the classifier. For Logistic Regression I chose 2 parameters that I think could improve the model. The first one is regParam that represents a regularization to the model or a modification in the model that helps it generalize better to unseen data. The second one is the number of iterations. The default is 100 but I tried to 150 and 50 so we can check if the classifier could do better with more iterations or if it is losing performance for too much of them.", "The results of the cross-validation were the same as the default linear regression model. However, the parameters of the best model are different from the default one. The number of iterations was set at 50 and the regularization rate, at 0.1. Since the training dataset contains only 191 observations, the hyper tuning couldn't get too much of a difference in results.", "In this post I walked through the basics steps to creating a machine learning model for predicting churn:", "As a result, we have a classification model that can predict on regular basis and with 79% accuracy what registered users are more likely to cancel their accounts. This way, Sparkify can act before it loses its clients most of the time.", "It is a great result so far, but there is a lot more it could be done to improve this model. For instance, we could train the classifier on a larger dataset. As mentioned before, these results are considering a small subset of the full data and can change drastically with the inclusion of new registers.", "Another improvement would be to not only predict churn for users who cancel their accounts but also for users that downgrade from paid accounts to free ones. This way Sparkfy could operate on their most important users which are the ones who keep the cash income.", "The details for the code of this post could be found at this git repository. Hope you enjoyed it!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am an economist who loves to study and discover new thing on the data science field."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7c30d7206daf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lukec-correa.medium.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": ""}, {"url": "https://lukec-correa.medium.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Lucas Correa"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff868b483e3a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&user=Lucas+Correa&userId=f868b483e3a2&source=post_page-f868b483e3a2----7c30d7206daf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@mantashesthaven", "anchor_text": "@mantashesthaven"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9", "anchor_text": "post"}, {"url": "https://danvatterott.com/blog/2019/11/18/balancing-model-weights-in-pyspark/", "anchor_text": "post of Dan Vatterott"}, {"url": "https://www.analyticsvidhya.com/blog/2017/03/imbalanced-data-classification/#:~:text=Dealing%20with%20imbalanced%20datasets%20entails,as%20it%20has%20wider%20application.", "anchor_text": "post"}, {"url": "https://www.kdnuggets.com/2016/06/regularization-logistic-regression.html", "anchor_text": "generalize better to unseen data"}, {"url": "https://github.com/Lucas-Correa/Churn-in-Sparkfy", "anchor_text": "git repository"}, {"url": "https://medium.com/tag/churn-prediction?source=post_page-----7c30d7206daf---------------churn_prediction-----------------", "anchor_text": "Churn Prediction"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7c30d7206daf---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&user=Lucas+Correa&userId=f868b483e3a2&source=-----7c30d7206daf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&user=Lucas+Correa&userId=f868b483e3a2&source=-----7c30d7206daf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7c30d7206daf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7c30d7206daf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7c30d7206daf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7c30d7206daf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7c30d7206daf--------------------------------", "anchor_text": ""}, {"url": "https://lukec-correa.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lukec-correa.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lucas Correa"}, {"url": "https://lukec-correa.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff868b483e3a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&user=Lucas+Correa&userId=f868b483e3a2&source=post_page-f868b483e3a2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Ff868b483e3a2%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-churn-with-user-log-data-from-a-digital-music-streaming-app-7c30d7206daf&user=Lucas+Correa&userId=f868b483e3a2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}