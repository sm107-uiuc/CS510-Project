{"url": "https://towardsdatascience.com/visualizing-time-series-survival-data-36029652a393", "time": 1683011139.438922, "path": "towardsdatascience.com/visualizing-time-series-survival-data-36029652a393/", "webpage": {"metadata": {"title": "Visualizing Time Series Survival Data | by Ravi Charan | Towards Data Science", "h1": "Visualizing Time Series Survival Data", "description": "Understand the mathematics behind the non-parametric Kaplan\u2013Meier (product\u2013limit) estimator for the survival function and the Greenwood confidence intervals."}, "outgoing_paragraph_urls": [{"url": "https://www.statsmodels.org/stable/generated/statsmodels.duration.survfunc.SurvfuncRight.html#statsmodels.duration.survfunc.SurvfuncRight", "anchor_text": "statsmodels", "paragraph_index": 15}, {"url": "https://lifelines.readthedocs.io/en/latest/", "anchor_text": "lifelines", "paragraph_index": 15}, {"url": "https://cran.r-project.org/web/packages/survival/index.html", "anchor_text": "survival", "paragraph_index": 15}, {"url": "https://en.wikipedia.org/wiki/Binomial_distribution", "anchor_text": "binomial distribution", "paragraph_index": 16}, {"url": "https://en.wikipedia.org/wiki/Delta_method#:~:text=In%20statistics%2C%20the%20delta%20method,limiting%20variance%20of%20that%20estimator.", "anchor_text": "Delta Method", "paragraph_index": 19}, {"url": "https://en.wikipedia.org/wiki/Mean_value_theorem", "anchor_text": "mean value theorem", "paragraph_index": 21}, {"url": "https://en.wikipedia.org/wiki/Martingale_(probability_theory)", "anchor_text": "Martingale", "paragraph_index": 29}, {"url": "https://en.wikipedia.org/wiki/Martingale_central_limit_theorem", "anchor_text": "Martingle central limit theorem", "paragraph_index": 29}, {"url": "https://towardsdatascience.com/understanding-logistic-regression-coefficients-7a719ebebd35", "anchor_text": "logistic regression coefficients", "paragraph_index": 39}, {"url": "https://towardsdatascience.com/the-relationship-between-perplexity-and-entropy-in-nlp-f81888775ccc", "anchor_text": "perplexity", "paragraph_index": 39}, {"url": "https://towardsdatascience.com/why-is-the-normal-distribution-so-normal-e644b0a50587", "anchor_text": "central limit theorem", "paragraph_index": 39}, {"url": "https://towardsdatascience.com/expectation-maximization-explained-c82f5ed438e5", "anchor_text": "expectation maximization", "paragraph_index": 39}, {"url": "https://medium.com/@rmcharan/regression-geometry-61fdd5515ab7", "anchor_text": "regression", "paragraph_index": 40}, {"url": "https://towardsdatascience.com/the-singular-value-decomposition-without-algebra-ae10147aab4c", "anchor_text": "singular value decomposition", "paragraph_index": 40}, {"url": "https://towardsdatascience.com/build-intuition-for-the-fourier-transform-b0bd338c6d4f", "anchor_text": "Fourier transform", "paragraph_index": 40}, {"url": "https://en.wikipedia.org/wiki/Delta_method#:~:text=In%20statistics%2C%20the%20delta%20method,limiting%20variance%20of%20that%20estimator.", "anchor_text": "Wikipedia", "paragraph_index": 41}], "all_paragraphs": ["Let\u2019s imagine you have data on how long subjects in your study \u201csurvived.\u201d Survival could be literal (as in a clinical trial) or figurative (if you are studying customer retention, when people stop reading an article, or when a machine breaks down). In order to visualize the data, we\u2019d like to plot a survival curve, called a Kaplan\u2013Meier curve like the one below.", "The curve at left (created using artificially generated data) purports to show the percentage of people still taking a medicine some number of days after they start taking it. In this context, they would stop because the medicine was no longer controlling the disease or because it was causing too many side-effects.", "Ideally, it would be easy to compute this curve by simply considering the percentage of people who are taking the medicine at a given number of days after they started it.", "However, some of the people (about 25% in this example) are still taking the medicine. They may have simply been taking it for a long time (close to 10 years in this case) with no problems or they may have just started it. Such observations are called \u201cright-censored\u201d because we don\u2019t get to observe them later in time (towards the right).", "The simplest solution to this is a Kaplan\u2013Meier curve, also called the product\u2013limit estimator. There are other solutions but they require making assumptions about the data and provide a model for it. On the other hand, our usual first step is to just look at the data, and the Kaplan\u2013Meier curve allows us to do that without making assumptions.", "In this article we\u2019ll discuss how to compute the Kaplan\u2013Meier curve and, crucially, the confidence intervals displayed. More importantly, we\u2019ll go into the differences between the two ways you could compute the confidence interval (sometimes called \u2018log\u2019 and \u2018log-log\u2019/exponential Greenwood confidence intervals ).", "If you haven\u2019t guessed, these sorts of survival curves started in the medical and actuarial worlds where the literal concern was whether someone would in fact die. Consequently, we will adopt the terminology that a given subject in the study (say a person) can either still be alive, in which case the observation is censored (we haven\u2019t observed an event), or they can have died at a particular point in time (we did observe the event).", "Note that when we say \u201ctime\u201d we don\u2019t mean the literal date, but rather the time relative to when a participant entered the study. In the life-insurance example, that is just when they were born. In the medicine example above, it is when someone starts taking the drug.", "The Kaplan\u2013Meier estimate, from the 1950s, is easier to state in words than it is with a formula. The rules are:", "For example, let\u2019s imagine we have records of three people. One is alive at age 92, one died at age 90, and one died at age 95. At age 90, 66.7% of the population survives. At age 92, 100% survives. At age 95, 100% (not 50) of the population dies. That\u2019s because the 92 year old doesn\u2019t count towards the population of 95 year olds.", "Notice that the times when someone is censored (92 in our example) don\u2019t affect the curve. And only the times when we observe someone to have died do in fact count.", "Now let\u2019s do it with equations.", "The Kaplan\u2013Meier estimator for the survival function is", "In other words, the product of the survival percentages with the product taken over all times before the current time t.", "The Kaplan\u2013Meier estimator is the maximum-likelihood estimator for the survival function, which makes it a natural go-to for a quick visualization.", "In general you can find this is most statistical packages that handle time series data. For python statsmodels or lifelines are some good options. For R,survival.", "The tricky part comes in computing the confidence intervals. First of all, we suppose there is a true \u201chazard rate\u201d at time i. In other words, we suppose d follows a binomial distribution with probability h and sample size n, each different at time i. That means it has mean and variance nh and nh(1-h).", "The next trick is that, since the estimator of S is a product, it will be easier to deal with the logarithm of S, which is a sum.", "Now we need to take a diversion and talk about a Taylor series approximation that is going to enable us to do a series of calculations.", "The Delta Method is a convenient and rigorous way to deal with transformations of random variables, like logarithms. Suppose we have a random variable X and a function f (which you should think about as being the logarithm). If we pretend that X is just a regular number (not random), then we can write down the first order Taylor expansion about a point c:", "The essential insight of the delta method is that, suppose X is a statistic like the sample mean or our estimate for S. If c is the expected value of X, E[X], then in the limit of a large sample size, X will be close to c and normally distributed (by the Central Limit Theorem), and the approximation will be very good. This lets us compute the expected value of f:", "Even better, we can apply the mean value theorem from Freshman calculus. Supposing we have measured a value of X, we can find a value d lying between c and X so that", "Again, in the limit of a large sample size, X gets closer to c, so d is squeezed between them and also gets closer to c. So, working informally in this limit of a large sample size, we can treat the approximate equality above as an equality.", "Now suppose we know the variance of X depending on the sample size n:", "Going back to our original Taylor expansion, rearranging terms and multiplying by the square root of n:", "Which means that we have computed the variance of f(X) as being the variance of X times f\u02b9(c) squared.\u00b9", "Please recall that, before our digression into the Delta method, we had said that", "Let\u2019s consider trying to compute the variance of each of these terms in the sum using the Delta Method. The expected value is 1\u2013h and the function in question is the logarithm log(x) with derivative 1/x. (We are only using natural logarithms, of course). Thus:", "And we can also compute the variance of each term. The log(1-h) term has no variance (it is a constant), and the subtraction of h in the second term also doesn\u2019t affect the variance.", "Now, a brief technicality. Normally, we could just add up the variance to compute the variance of the sum. However, the terms are technically not independent, since a death at time i affects the denominator n at later times. On the other hand, the term of interest (d/n\u2013h) has mean 0 conditional on knowing all the previous deaths, which makes the terms into a Martingale difference (or their sum a martingale). In turn, the Martingle central limit theorem tells us that the variance is in fact just the sum of the individual variances.", "So finally, we have the variance of the log of S", "Finally, we can apply the Delta method again", "which we can in turn estimate as:", "Which in turn lets us compute the Greenwood Confidence Interval by assuming our estimator for S is normally distributed (which will be the case if the sample size is large enough).", "Now, using the Greenwood confidence interval above leads to an issue, which is that your confidence intervals could fall outside the 0\u20131 boundary. It would be quite embarrassing to have a graph on which your confidence interval allowed that sometimes the survival rate would be negative.", "The solution here is to note that we used the log because it forces S to be positive. If we computed the confidence interval on the transformed log S, we would at least be guaranteed that the resulting confidence interval would be great than 0 (but it could be more than 1). The \u201cprice\u201d we would pay for this is to have an asymmetric confidence interval. But if we are going to do this, we might as well go all the way. If we instead use", "then we will get confidence intervals that are guaranteed to lie within the 0\u20131 interval because log(\u2013log(X)) only accepts arguments in the 0\u20131 range; the inverse transform will insure that we end up in that range.", "I will spare you the math; the resulting variance for the transformed S is", "Compute the confidence interval for the transformed S and then undo the transformation with x \u27fc exp(-exp(x)) to get an asymmetric confidence interval for S.", "I aim to write (relatively) accessible explanations of data science concepts without shying away from the sometimes complicated mathematics involved. If you liked this, you I have similarly styled explanations of logistic regression coefficients, perplexity, the central limit theorem, or expectation maximization.", "If you didn\u2019t like this, consider more geometric explanations of regression, the singular value decomposition, or the Fourier transform.", "[1] It should be apparent that things will go terribly wrong if f\u02b9(c) is 0, and so this is a good time to mention that this is an additional assumption. Consult the Wikipedia article for a fully rigorous treatment.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist, Mathematician. Formerly @MIT, @McKinsey, currently teaching computers to read"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F36029652a393&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----36029652a393--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----36029652a393--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@rmcharan?source=post_page-----36029652a393--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rmcharan?source=post_page-----36029652a393--------------------------------", "anchor_text": "Ravi Charan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F393ce2bbf82c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&user=Ravi+Charan&userId=393ce2bbf82c&source=post_page-393ce2bbf82c----36029652a393---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@gerandeklerk?utm_source=medium&utm_medium=referral", "anchor_text": "Geran de Klerk"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.statsmodels.org/stable/generated/statsmodels.duration.survfunc.SurvfuncRight.html#statsmodels.duration.survfunc.SurvfuncRight", "anchor_text": "statsmodels"}, {"url": "https://lifelines.readthedocs.io/en/latest/", "anchor_text": "lifelines"}, {"url": "https://cran.r-project.org/web/packages/survival/index.html", "anchor_text": "survival"}, {"url": "https://en.wikipedia.org/wiki/Binomial_distribution", "anchor_text": "binomial distribution"}, {"url": "https://en.wikipedia.org/wiki/Delta_method#:~:text=In%20statistics%2C%20the%20delta%20method,limiting%20variance%20of%20that%20estimator.", "anchor_text": "Delta Method"}, {"url": "https://en.wikipedia.org/wiki/Mean_value_theorem", "anchor_text": "mean value theorem"}, {"url": "https://en.wikipedia.org/wiki/Martingale_(probability_theory)", "anchor_text": "Martingale"}, {"url": "https://en.wikipedia.org/wiki/Martingale_central_limit_theorem", "anchor_text": "Martingle central limit theorem"}, {"url": "https://towardsdatascience.com/understanding-logistic-regression-coefficients-7a719ebebd35", "anchor_text": "logistic regression coefficients"}, {"url": "https://towardsdatascience.com/the-relationship-between-perplexity-and-entropy-in-nlp-f81888775ccc", "anchor_text": "perplexity"}, {"url": "https://towardsdatascience.com/why-is-the-normal-distribution-so-normal-e644b0a50587", "anchor_text": "central limit theorem"}, {"url": "https://towardsdatascience.com/expectation-maximization-explained-c82f5ed438e5", "anchor_text": "expectation maximization"}, {"url": "https://medium.com/@rmcharan/regression-geometry-61fdd5515ab7", "anchor_text": "regression"}, {"url": "https://towardsdatascience.com/the-singular-value-decomposition-without-algebra-ae10147aab4c", "anchor_text": "singular value decomposition"}, {"url": "https://towardsdatascience.com/build-intuition-for-the-fourier-transform-b0bd338c6d4f", "anchor_text": "Fourier transform"}, {"url": "https://en.wikipedia.org/wiki/Delta_method#:~:text=In%20statistics%2C%20the%20delta%20method,limiting%20variance%20of%20that%20estimator.", "anchor_text": "Wikipedia"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----36029652a393---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/mathematics?source=post_page-----36029652a393---------------mathematics-----------------", "anchor_text": "Mathematics"}, {"url": "https://medium.com/tag/statistics?source=post_page-----36029652a393---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/data-science?source=post_page-----36029652a393---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----36029652a393---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&user=Ravi+Charan&userId=393ce2bbf82c&source=-----36029652a393---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&user=Ravi+Charan&userId=393ce2bbf82c&source=-----36029652a393---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----36029652a393--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F36029652a393&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----36029652a393---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----36029652a393--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----36029652a393--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----36029652a393--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----36029652a393--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----36029652a393--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----36029652a393--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----36029652a393--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----36029652a393--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rmcharan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rmcharan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ravi Charan"}, {"url": "https://medium.com/@rmcharan/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "599 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F393ce2bbf82c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&user=Ravi+Charan&userId=393ce2bbf82c&source=post_page-393ce2bbf82c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6bca6dd641ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualizing-time-series-survival-data-36029652a393&newsletterV3=393ce2bbf82c&newsletterV3Id=6bca6dd641ca&user=Ravi+Charan&userId=393ce2bbf82c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}