{"url": "https://towardsdatascience.com/using-permutation-tests-to-proof-the-climate-change-2bc34d614eb7", "time": 1683018174.968138, "path": "towardsdatascience.com/using-permutation-tests-to-proof-the-climate-change-2bc34d614eb7/", "webpage": {"metadata": {"title": "Using Permutation Tests to proof the Climate Change | by Kaya Kupferschmidt | Towards Data Science", "h1": "Using Permutation Tests to proof the Climate Change", "description": "We are currently experiencing an increase of the average temperature from one year to the next. But is this really statistically significant? The average temperature is varying a lot over time, so it\u2026"}, "outgoing_paragraph_urls": [{"url": "https://seaborn.pydata.org/", "anchor_text": "Seaborn", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables", "anchor_text": "independent, identically distributed (IID)", "paragraph_index": 14}, {"url": "https://en.wikipedia.org/wiki/Random_permutation", "anchor_text": "random permutation", "paragraph_index": 21}, {"url": "https://www2.math.upenn.edu/~wilf/website/outstelmts.pdf", "anchor_text": "On the outstanding elements of permutations", "paragraph_index": 22}, {"url": "https://en.wikipedia.org/wiki/Stirling_numbers_of_the_first_kind", "anchor_text": "unsigned Stirling numbers of the first kind", "paragraph_index": 22}, {"url": "https://en.wikipedia.org/wiki/Monte_Carlo_method", "anchor_text": "Monte Carlo Sampling", "paragraph_index": 23}, {"url": "https://en.wikipedia.org/wiki/Law_of_large_numbers", "anchor_text": "law of large numbers", "paragraph_index": 23}, {"url": "https://en.wikipedia.org/wiki/Harmonic_series_(mathematics)", "anchor_text": "harmonic sum", "paragraph_index": 28}, {"url": "https://www.statsmodels.org/", "anchor_text": "statsmodels", "paragraph_index": 29}], "all_paragraphs": ["We are currently experiencing an increase of the average temperature from one year to the next. But is this really statistically significant? The average temperature is varying a lot over time, so it might well be the case that the current situation is just \u201cbad luck\u201d and that we will be experiencing colder years in the future. Of course nobody exactly knows how the weather and climate will develop in the future, although most scientific models indicate that we have to expect an ongoing global warming. But when looking to the past, we can ask ourselves if the historic weather did behave like we would expect if there was no climate change.", "The picture above shows the average temperature per year in Germany and it strongly indicates that there is a significant increase of the average temperature over time, especially during the last 30 years. This article will apply a very simple yet clever statistical test support this impression.", "We will build on the aggregated data from my small article series on \u201cInvestigating the Climate Change with Python and Spark\u201d:", "Specifically, you need the \u201cdaily weather per country\u201d aggregate which has been produced in the second installment of the series.", "Other than that we will continue to use PySpark to access the aggregated data and Pandas plus friends to conduct some simple statistical test.", "First we read in the aggregated data again using PySpark", "Although the data contains additional metrics like minimum/maximum temperature and information on wind speed, we focus only on the average temperature for now.", "Since we are only interested in the average temperature per year, but the data contains information on a daily basis, we first need to perform a simple aggregation as follows:", "Before conducting a deeper analysis, let\u2019s create a simple plot using Seaborn which will also include a regression.", "We can clearly see not only an increase of the average temperature over time, but as consequence the graph also reaches new maximum values over time and the minimum values also tend to be much higher than in the past. We will focus precisely on this effect now.", "First we create one more plot with the running maximum from left to right and the running minimum from right to left:", "Now the interesting question is: Do the maximum and minimum values behave like one would expect if there was no change of the underlying temperature distribution. More specifically we will ask: Assuming no change of the temperature distribution over all the years, how many distinct maximum and minimum values would we expect and what would be the probability of the number of maximum/minimum values that we are seeing here?", "One interesting aspect of this type of statistical question is that the actual temperature values themselves are not used at all. Only the relative ordering of the values is relevant. This property of the statistical test proves to be very useful in many other cases where you cannot really assign meaningful values to increasingly severe events, but you still want to be able to test for randomness. Of course the result then is of a purely qualitative nature (i.e. the temperature is increasing at a statistical significant level) but the test will not tell you by how much the temperature is increasing.", "In order to approach the question whether the number of new maximum/minimum values for the yearly average temperature behaves as one would expect, we need to formalize the problem a little bit.", "For the following examination, we generalize the problem to a vector of independent, identically distributed (IID) continuous random variables X(1)\u2026X(n). All of the three properties are important here: We assume that every random variable X(i) in this vector has the same probability distribution and we assume that all variables are independent from each other. Finally we also assume that all variables are continues, which implies that the probability of two random variables having the same value is zero.", "We are now interested in what I call a running record: We call position i a record whenever the value of the random variable X(i) is larger than all previous variables X(j) with j < i. With the weather data, we are interested in the number of records of the vector of average temperatures.", "Given a sequence of values X(1)\u2026X(n) we can now define a simple statistics as the number of observed records within that sequence and then we can ask if the value of that statistics looks plausible if we assume that all X(i) are IID. This assumption corresponds to the null hypothesis of \u201cno climate change\u201d in the temperature series.", "Translating the question into a mathematical language, we would like to calculate (or at least estimate) the probability of having k records in a sequence of n IID random variables. This question immediately brings us to random permutations.", "Instead of answering the original question let\u2019s transform it to an equivalent problem. To do so, we first assign the rank of the value to each random variable, i.e. the smallest random variable is assigned a rank of 1, the second smallest variable a rank of 2 and so on until the largest random variable is assigned the rank n. Let\u2019s denote the rank of X(i) with R(i).", "The following example gives us the ranks R(i) for the small sequence X(i) with 7 elements.", "Note that the ranks R(i) still have the same relative order as the original values X(i), which in turn implies that the number of records in the ranks vector is the same as the number of records in the original values.", "The set of all ranks R(1)\u2026R(n) contains all the number from 1 until n, but in a random order. Assuming that the original values X(i) are IID, the vector of ranks R(i) is a random permutation. Therefore the probability distribution of the number of records in a sequence of IID random variables is the same as of the number of records in a random permutation.", "Unfortunately, it turns out that the distribution we are looking for (the number of records in a random permutation) is not exactly simple to calculate. There are some formulas (see On the outstanding elements of permutations by Herbert Wilf), but these build on the unsigned Stirling numbers of the first kind which are not easy to calculate.", "Instead of trying to evaluate some mathematical formula for the probability distribution we chose a different route: We simply let the computer conduct a reasonable huge number of random experiments by sampling random permutations, and in each experiment we calculate the statistics we are interested in. The histogram (i.e. the relative frequency of each possible outcome) then gives us an estimation of the true probability. This approach is called Monte Carlo Sampling and by the law of large numbers, the results will always converge to the real values.", "Now we have gathered all the required theory for implementing the statistical test if the number of running maximums/minimums in the temperature chart below is plausible under the null hypothesis that the climate doesn\u2019t change (i.e. the probability distribution of the average temperature doesn\u2019t change over time).", "First we implement two small functions which actually count the number of running maximum/minimums for a given series. Note that we also count the first value of each series as the first maximum/minimum, therefore we add 1 to the sum in the last line of each function.", "In the next step we implement the Monte Carlo sampling for constructing the probability distribution. Numpy already provides a function to generate a random permutation, so we only need to use one of the functions above to count the number of running records. Please note that by symmetry the distribution of the number of maximum records is the same as of the number of minimum records.", "Using Seaborn we now visualize the collected samples as a histogram.", "We can clearly see that more than 10 records for a random permutation of length 92 (the number of years) is very unlikely. Actually, the expected number of records in a random permutation of length n is given as the harmonic sum 1+ 1/2 + 1/3 + 1/4 + \u2026 + 1/n, which would be just 5.12 for n=92.", "But of course we\u2019d like to provide a numerical estimation of the probabilities instead of the wording \u201cvery unlikely\u201d above. With the help of the venerable statsmodels package, this can be easily done from our Monte Carlo samples by constructing an empirical cumulative distribution function (ECDF) as follows:", "This function will estimate the following probability (as inferred from the samples):", "Finally, we can now use this empirical distribution to estimate the probability of the observed number of maximum/minimum records under the null hypothesis of no climate change. First we use the two helper functions to calculate the maximum/minimum record statistics:", "By incident this will give us 12 for both statistics. Now we can use the empirical cumulative distribution function (ECDF) from above to estimate the probability of seeing 12 or more records:", "This will give us a probability of 0.00129 \u2014 i.e. the null hypothesis of no climate change is very unlikely to be true, so we discard it in favor of \u201cYes, the Climate Change is real\u201d.", "In this follow up to the series of \u201cResearching the Climate Change with Python and Spark\u201d we applied a rather simple, yet powerful statistical test which allowed us to rigorously discard the null hypothesis of \u201cno significant temperature increase\u201d (at least in Germany).", "The chosen statistics (running maximum) might be surprising since it does not give us any quantitative information on how fast the temperature is increasing. But it provides a very strong indication that the effect is real. This type of test is typically used when the numeric values do not matter. For example, you might apply this test to the series of world records in a specific Olympic discipline to study if the performance of the top athletes is also increasing over time (which probably is the case), which would explain a higher number of new records than one would expect otherwise.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Freelance Big Data and Machine Learning expert at dimajix."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2bc34d614eb7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@kupferk", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://kupferk.medium.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": ""}, {"url": "https://kupferk.medium.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Kaya Kupferschmidt"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa1b1c406b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&user=Kaya+Kupferschmidt&userId=a1b1c406b9d0&source=post_page-a1b1c406b9d0----2bc34d614eb7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@nbb_photos?utm_source=medium&utm_medium=referral", "anchor_text": "Lacie Slezak"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/using-python-and-spark-to-research-the-climate-change-part-1-7616b71cefe8", "anchor_text": "Getting the data"}, {"url": "https://towardsdatascience.com/using-python-and-spark-to-research-the-climate-change-part-2-e2ac9faba821", "anchor_text": "Preparing the data"}, {"url": "https://towardsdatascience.com/investigating-the-climate-change-with-python-and-spark-part-3-bad5627ffb01", "anchor_text": "Generating insights"}, {"url": "https://seaborn.pydata.org/", "anchor_text": "Seaborn"}, {"url": "https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables", "anchor_text": "independent, identically distributed (IID)"}, {"url": "https://en.wikipedia.org/wiki/Random_permutation", "anchor_text": "random permutation"}, {"url": "https://www2.math.upenn.edu/~wilf/website/outstelmts.pdf", "anchor_text": "On the outstanding elements of permutations"}, {"url": "https://en.wikipedia.org/wiki/Stirling_numbers_of_the_first_kind", "anchor_text": "unsigned Stirling numbers of the first kind"}, {"url": "https://en.wikipedia.org/wiki/Monte_Carlo_method", "anchor_text": "Monte Carlo Sampling"}, {"url": "https://en.wikipedia.org/wiki/Law_of_large_numbers", "anchor_text": "law of large numbers"}, {"url": "https://en.wikipedia.org/wiki/Harmonic_series_(mathematics)", "anchor_text": "harmonic sum"}, {"url": "https://www.statsmodels.org/", "anchor_text": "statsmodels"}, {"url": "https://medium.com/tag/climate-change?source=post_page-----2bc34d614eb7---------------climate_change-----------------", "anchor_text": "Climate Change"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2bc34d614eb7---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/statistics?source=post_page-----2bc34d614eb7---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/weather?source=post_page-----2bc34d614eb7---------------weather-----------------", "anchor_text": "Weather"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&user=Kaya+Kupferschmidt&userId=a1b1c406b9d0&source=-----2bc34d614eb7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&user=Kaya+Kupferschmidt&userId=a1b1c406b9d0&source=-----2bc34d614eb7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2bc34d614eb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2bc34d614eb7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2bc34d614eb7--------------------------------", "anchor_text": ""}, {"url": "https://kupferk.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://kupferk.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kaya Kupferschmidt"}, {"url": "https://kupferk.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "223 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa1b1c406b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&user=Kaya+Kupferschmidt&userId=a1b1c406b9d0&source=post_page-a1b1c406b9d0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F874fa4e516b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-permutation-tests-to-proof-the-climate-change-2bc34d614eb7&newsletterV3=a1b1c406b9d0&newsletterV3Id=874fa4e516b6&user=Kaya+Kupferschmidt&userId=a1b1c406b9d0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}