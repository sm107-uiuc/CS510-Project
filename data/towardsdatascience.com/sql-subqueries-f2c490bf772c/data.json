{"url": "https://towardsdatascience.com/sql-subqueries-f2c490bf772c", "time": 1683008447.767622, "path": "towardsdatascience.com/sql-subqueries-f2c490bf772c/", "webpage": {"metadata": {"title": "Query Smarter, Not Harder. Using Subqueries in Sqlite3 | by Andrew Cole | Towards Data Science", "h1": "Query Smarter, Not Harder", "description": "Relational databases are one of the most common types of data storage regardless of industry. Using SQL (in any of its forms) to create queries is an extremely effective and accessible way to access\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Relational databases are one of the most common types of data storage regardless of industry. Using SQL (in any of its forms) to create queries is an extremely effective and accessible way to access data, but it can get a bit confusing sometimes. Queries can grow to become quite complex, requiring multiple methods to correctly obtain correct data. When queries begin to lengthen and grow in complexity, a subquery can be a very helpful method to segment the queries in a much more digestible manner.", "Our table schema above shows a somewhat complex, but definitely not uncommon, database.", "We will begin with a general query that will use to return all employees who work in the company\u2019s USA office.", "Our DataFrame is returned to look like above. We used a straightforward many-to-many join using officeCode as our key. This was a pretty straightforward query, but sometimes utilizing joins and primary/foreign keys can get confusing on large table schemas. Let\u2019s take a look at using a subquery now to write this query in a different and simpler way.", "A subquery is essentially just a query within a query. We will execute a query statement which has a condition dependent on a completely a separate query. Sounds a little confusing, so let\u2019s take a look at what we\u2019re talking about.", "Ta-da! This query will output the same DataFrame as in our previous code. Instead of joining to a new table, we are simply selecting features from an initial table created in the subquery. Let\u2019s try a bit more complicated of a problem.", "Write a query to return all employees from offices with greater than 5 employees.", "This is a particularly difficult query because it requires us to return a query based off of an aggregate condition, but we aren\u2019t actually returning the aggregate itself. We need to create a condition that only selects employees who match that condition. Normally, we use \u201cHAVING\u201d or \u201cGROUP BY\u201d statements to retrieve aggregate data but in this case we want to filter on the aggregate instead. This type of situation is where subqueries really shine.", "In this case, we first nested an initial query that contained our conditional statement: \u201cHAVING COUNT(employeeNumber) > 5\u201d. The cursor temporarily makes this newly executed internal query the new table, and we can then just select the necessary features for our answer. A little trick that helped me wrap my mind around this process when I was beginning with SQL is to start with the internal query first, containing our condition, and then go out from there.", "In the last query, we selected based on an aggregate condition, but what if we want to return an aggregate function result?", "Write a query to return the average payment of all the customers.", "In this case, we actually use our subquery to define the mathematical aggregate function. The aggregate function \u201cAVG(amount) AS customerAvgPayment\u201d is aliased and then executed initially in the nested statement. All that is left to do is to select that aggregate function as its own variable and voil\u00e0!", "As always with coding and SQL, there is never a singular way to arrive at an output. There are many methods for writing queries and subqueries were a great way for myself to get a handle on the flow of events in SQL.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Using Data Science to drive curiosity."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff2c490bf772c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@andrewcole.817?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrewcole.817?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Andrew Cole"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcb2c8eb9bc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&user=Andrew+Cole&userId=cb2c8eb9bc8&source=post_page-cb2c8eb9bc8----f2c490bf772c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/sql?source=post_page-----f2c490bf772c---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/database?source=post_page-----f2c490bf772c---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f2c490bf772c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----f2c490bf772c---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/business-data?source=post_page-----f2c490bf772c---------------business_data-----------------", "anchor_text": "Business Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&user=Andrew+Cole&userId=cb2c8eb9bc8&source=-----f2c490bf772c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&user=Andrew+Cole&userId=cb2c8eb9bc8&source=-----f2c490bf772c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff2c490bf772c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f2c490bf772c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f2c490bf772c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f2c490bf772c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f2c490bf772c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrewcole.817?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrewcole.817?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrew Cole"}, {"url": "https://medium.com/@andrewcole.817/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "233 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcb2c8eb9bc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&user=Andrew+Cole&userId=cb2c8eb9bc8&source=post_page-cb2c8eb9bc8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F39e7de80b84b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-subqueries-f2c490bf772c&newsletterV3=cb2c8eb9bc8&newsletterV3Id=39e7de80b84b&user=Andrew+Cole&userId=cb2c8eb9bc8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}