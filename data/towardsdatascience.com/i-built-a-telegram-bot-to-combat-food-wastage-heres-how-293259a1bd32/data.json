{"url": "https://towardsdatascience.com/i-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32", "time": 1683006846.141612, "path": "towardsdatascience.com/i-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32/", "webpage": {"metadata": {"title": "I Built a Telegram Bot to Combat Food Wastage \u2014 Here\u2019s How | by Haohui | Towards Data Science", "h1": "I Built a Telegram Bot to Combat Food Wastage \u2014 Here\u2019s How", "description": "Telegram bots are all the craze now \u2014 from bots that let you play games, find friends, find new bots, and even create new bots \u2014 the possibilities are endless. Today, I will be introducing how I\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/liuhh02/food-waste-bot", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2", "anchor_text": "here", "paragraph_index": 1}, {"url": "http://www.fao.org/food-loss-and-food-waste/en/", "anchor_text": "Food and Agriculture Organization", "paragraph_index": 2}, {"url": "https://t.me/botfather", "anchor_text": "BotFather", "paragraph_index": 10}, {"url": "https://core.telegram.org/bots#6-botfather", "anchor_text": "official Telegram documentation", "paragraph_index": 11}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot", "anchor_text": "python-telegram-bot", "paragraph_index": 12}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot/blob/master/examples/README.md", "anchor_text": "page", "paragraph_index": 12}, {"url": "https://console.cloud.google.com/", "anchor_text": "console", "paragraph_index": 23}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot/wiki/Introduction-to-the-API", "anchor_text": "Github wiki", "paragraph_index": 36}, {"url": "https://t.me/foodrescuerbot", "anchor_text": "@foodrescuerbot", "paragraph_index": 38}, {"url": "https://t.me/foodrescuers", "anchor_text": "https://t.me/foodrescuers", "paragraph_index": 38}, {"url": "https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2", "anchor_text": "here", "paragraph_index": 40}], "all_paragraphs": ["Telegram bots are all the craze now \u2014 from bots that let you play games, find friends, find new bots, and even create new bots \u2014 the possibilities are endless. Today, I will be introducing how I built a telegram bot to combat food wastage, providing a full tutorial starting from (1) how to create a telegram bot using BotFather, give it the abilities to (2) ask questions, (3) receive and store user responses and pictures, (4) post this information onto a public Telegram channel along with a (5) call to the Google Maps API to show the location of the food on a map.", "The code can be found at my Github repository here. The code goes a further step of deploying the bot on Heroku, and you can read my tutorial on how I deployed the bot here.", "According to the Food and Agriculture Organization (FAO) of the United Nations, an estimated 1.3 billion tonnes of food is wasted globally each year, amounting to one-third of all food produced for human consumption. Some common culprits include buffets, restaurants, and even households, for reasons including having purchased too much or even more absurdly, that the food doesn\u2019t look good.", "Yet, at the same time, 820 million people go hungry daily. This seems contradictory \u2014 how can we be wasting so much food and yet, simultaneously, let so many people in the world go hungry? This boils down to a lack of communication between those with leftovers and those who need food. Sure, there are charity organisations that accept food donations, but there is no direct communication between those who need the food and those with leftovers. Combined with the frustratingly convoluted regulatory processes, it is no surprise that there is a significant time lag between the food donations and when they actually benefit those who need it the most.", "Given this problem, why not facilitate the communication between those with leftovers and those who need food? This will help link those with leftovers directly to those who need food. In this way, the food can be quickly received by those who need it without any significant time delay.", "Sure, this sounds good and all, but how do we go about implementing this? This is where Telegram bots and channels provide a lightweight solution to link food providers with those who need food.", "Food providers can first chat with the Telegram bot to provide crucial information about the food, such as the location of the food, dietary specifications and so on. After this information has been collected, the bot will then post their food listings onto the Telegram channel which is accessible to the public. Once the food is posted on the channel, people in need can simply collect the food. All this can be accomplished without any significant time delay \u2014 in fact, the whole process of posting the food to the end-user receiving the information can take less than 10 seconds!", "To do so, the bot will ask the following questions from the food poster:", "The food poster will answer these questions and the bot will compile the responses into a single message. With this summarised message, the bot will then forward the information to the public channel after the poster has confirmed the details entered are correct.", "Now that we have an understanding of how the process works, let\u2019s get down to the nitty-gritty details!", "First off, we will create a bot. To do so, send the /newbot command to BotFather on telegram. It will prompt you for a name of the bot, followed by a username (which must end with bot). You can change the name of the bot easily with the /setname command, but it is not possible to change the username of the bot via BotFather, so if you\u2019re not sure, you can create a testing bot first with a random username and, once you\u2019ve tested all the functions and made sure your bot works, create a new bot with your desired username.", "After the bot is created, BotFather will send you the API key of the bot (under the line \u201cUse this token to access the HTTP API:\u201d). Keep this API key to yourself, because it can be misused by anyone with the API key to control your bot, which you don\u2019t want happening! There are a bunch of commands you can send to BotFather to customise your bot, including changing the description of the bot, its profile picture and so on, which are pretty self-explanatory so I will leave you to read it on the official Telegram documentation.", "Having created our bot, it is time to give it some additional functionality! Since the goal is to create a bot that interacts with the food poster, the bot must be able to send questions to the poster to prompt for the required information and then store the information before forwarding it to the public channel. In order to do so, we can use a very handy python wrapper, python-telegram-bot. The Github page provides many examples of bots written with the wrapper, so do check out the page to see if there are any examples satisfying your use case!", "Firstly, we will install the required packages. Since we are calling the Google Maps API to provide a map of the food location, we will also install the googlemaps python package. If you are not looking to use google maps, you can skip the installation of this package.", "In your terminal / command prompt, type in the following commands to install the two libraries:", "Now that we have installed the two libraries, let\u2019s dive into the code! Here is the code (in case you want to jump straight to it), which I will go through in detail below.", "Firstly, we import the relevant libraries:", "We are importing logging to show the log messages when in the terminal when a user interacts with the bot, as well as various modules under the python-telegram-bot. We are also importing googlemaps to show the location of the food on a map.", "Next, we configure the logging settings as such:", "Next, we define the six states which determine the questions the bot will be asking: location of the food, photo, dietary specifications, number of servings, time to collect the food by, as well as a confirmation with the poster.", "For the confirmation, there will be a reply keyboard where the user will be able to choose two options: to confirm the information is correct or to restart the whole process.", "So we specify the two options using the ReplyKeyboardMarkup module in the python-telegram-bot module using the following line of code:", "After that, we specify some variables, including the API of your Telegram bot (which you obtained from BotFather), as well as the API of Google Maps.", "In order to get a Google Maps API, you will need a Google Cloud Platform account. After creating an account (there will be free credits given so this should be free as long as you don\u2019t exceed the quota), go to the Google Cloud Platform console and do the following:", "An API key will be generated, so just copy the key. This will be your google maps API token. Again, keep this safe! The Geocoding API provides $200 free in credit so that should be enough for your purposes.", "Now that we have defined the variables, let\u2019s dig in to the actual part of the code! Firstly, we define a function to summarise the information provided by the food poster as shown below:", "When this function is called, it will return the information in the format of key-value (eg. Dietary Specifications - Halal).", "Next, we define what happens when the user starts the bot. This is done with the use of a command /start (it works in a similar way to how you used the command /newbot with BotFather to create your bot). When the poster starts the bot, we want to bot to greet the user and prompt him to send the location of the food, so we define start as follows:", "The previous function returns LOCATION, which is the next function because the bot will store the location the user has provided in order to create a summary at the end. In the function location, the code is doing several things: firstly, it is telling the bot that there is a new message from the user, and then it is storing the information provided by the user under the key \u2018Location\u2019 for easy reference later when printing the summary. Next, the logger is logging the information for debugging purposes, just in case anything goes wrong. Lastly, the bot responds with a message asking for a photo of the food. Then, the function returns PHOTO, which is the next function.", "In this next function, the user has two options: either to take a picture of the food and send it to the bot, or skip if they don\u2019t have an image ready.", "Again, the bot first receives the message from the user and then gets the photo file from the user which is then saved as user_photo.jpg. Then, the logger logs the information and the bot responds with the next question about the dietary specifications of the food.", "The following lines follow the same structure as before, as the bot asks for the dietary specifications, number of servings, time to collect the food by. You will notice the same structure: the bot first receives the message from the user, then the user response is stored inside user_data, followed by logging and then a response from the bot to prompt the user with the next question.", "Having obtained all the necessary information from the poster, it is time to summarise the information and confirm it with the poster. Firstly, the bot consolidates the information and then sends out a summary using the function facts_to_str(user_data) which we defined above.", "If the user selects \u201cConfirm\u201d, the bot will send forward the information over to the public channel. The chat_id parameter of bot.send_photo represents the link of the channel.", "In addition, we now call on the google maps to pinpoint the exact location provided by the poster. The location has been stored inside user_data[\u2018Location\u2019] earlier when the user answered the first question on the location, so now we will extract the latitude and the longitude of the location using google maps. With this information, the bot sends over the location, along with the map, to the channel specified by @nameofchannel.", "Here are some helper functions in case the user cancels the conversation with the bot or there\u2019s an error:", "We are at the last segment of the code! Here, the code defines what the bot should do for each of the six states. Finally, we start polling which basically enables us to fetch information from the posters. The Github wiki of the python-telegram-bot does a better job explaining the code here, so do check it out if you are unsure what each line does!", "To start your bot, simply go to terminal/command prompt and execute the python file. After executing the file, go ahead to the bot and type /start. Your bot should respond and ask you the questions as coded above! When you respond, you should also see the following logs appear:", "So that\u2019s it! If you would like to check out the bot I created, you can find it at @foodrescuerbot. The link of the public channel is https://t.me/foodrescuers.", "Give this a shot! I hope you have fun with it, and tell me how it goes! Feel free to pose questions if you need any clarifications. Let us all think twice about whether we can finish the food item before buying it, and work towards reducing food wastage~", "If you are looking to deploy the bot for free, head over here for a tutorial on how to deploy the bot onto Heroku after you have successfully ran the bot locally.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine learning enthusiast working on the next big project"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F293259a1bd32&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----293259a1bd32--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@liuhh02?source=post_page-----293259a1bd32--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuhh02?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Haohui"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F500dff1f8d3b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&user=Haohui&userId=500dff1f8d3b&source=post_page-500dff1f8d3b----293259a1bd32---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/liuhh02/food-waste-bot", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2", "anchor_text": "here"}, {"url": "http://www.fao.org/food-loss-and-food-waste/en/", "anchor_text": "Food and Agriculture Organization"}, {"url": "https://unsplash.com/@okikuy0930?utm_source=medium&utm_medium=referral", "anchor_text": "Yukiko Kanada"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://t.me/botfather", "anchor_text": "BotFather"}, {"url": "https://core.telegram.org/bots#6-botfather", "anchor_text": "official Telegram documentation"}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot", "anchor_text": "python-telegram-bot"}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot/blob/master/examples/README.md", "anchor_text": "page"}, {"url": "https://console.cloud.google.com/", "anchor_text": "console"}, {"url": "https://myfave.com/johor-bahru/v8-hotel-johor-bahru-v8-hotel-johor-bahru-dinner-buffet-for-1-adult-64925", "anchor_text": "https://myfave.com/johor-bahru/v8-hotel-johor-bahru-v8-hotel-johor-bahru-dinner-buffet-for-1-adult-64925"}, {"url": "https://github.com/python-telegram-bot/python-telegram-bot/wiki/Introduction-to-the-API", "anchor_text": "Github wiki"}, {"url": "https://t.me/foodrescuerbot", "anchor_text": "@foodrescuerbot"}, {"url": "https://t.me/foodrescuers", "anchor_text": "https://t.me/foodrescuers"}, {"url": "https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2", "anchor_text": "here"}, {"url": "https://medium.com/tag/telegram?source=post_page-----293259a1bd32---------------telegram-----------------", "anchor_text": "Telegram"}, {"url": "https://medium.com/tag/chatbot?source=post_page-----293259a1bd32---------------chatbot-----------------", "anchor_text": "Chatbot"}, {"url": "https://medium.com/tag/python?source=post_page-----293259a1bd32---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/api?source=post_page-----293259a1bd32---------------api-----------------", "anchor_text": "API"}, {"url": "https://medium.com/tag/programming?source=post_page-----293259a1bd32---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&user=Haohui&userId=500dff1f8d3b&source=-----293259a1bd32---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&user=Haohui&userId=500dff1f8d3b&source=-----293259a1bd32---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F293259a1bd32&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----293259a1bd32---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----293259a1bd32--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----293259a1bd32--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----293259a1bd32--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----293259a1bd32--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----293259a1bd32--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuhh02?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuhh02?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Haohui"}, {"url": "https://medium.com/@liuhh02/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "210 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F500dff1f8d3b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&user=Haohui&userId=500dff1f8d3b&source=post_page-500dff1f8d3b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F64817874ddcf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fi-built-a-telegram-bot-to-combat-food-wastage-heres-how-293259a1bd32&newsletterV3=500dff1f8d3b&newsletterV3Id=64817874ddcf&user=Haohui&userId=500dff1f8d3b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}