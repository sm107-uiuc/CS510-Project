{"url": "https://towardsdatascience.com/scalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff", "time": 1682995252.934129, "path": "towardsdatascience.com/scalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff/", "webpage": {"metadata": {"title": "Scalable approach to building Time Series forecasting Pipelines | by Andrii Cherednychenko | Towards Data Science", "h1": "Scalable approach to building Time Series forecasting Pipelines", "description": "Building Time Series forecasting Pipelines with less engineering burden"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Cross-validation_(statistics)#k-fold_cross-validation", "anchor_text": "k-folds", "paragraph_index": 34}, {"url": "https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables", "anchor_text": "identically distributed", "paragraph_index": 35}, {"url": "https://blog.statsbot.co/ensemble-learning-d1dcd548e936", "anchor_text": "Stacking", "paragraph_index": 37}, {"url": "https://github.com/facebook/prophet", "anchor_text": "Prophet", "paragraph_index": 43}, {"url": "https://airflow.apache.org", "anchor_text": "https://airflow.apache.org", "paragraph_index": 46}], "all_paragraphs": ["The motivation for writing this article is to share the view on how to build tools to help with defining ML pipelines for predicting outcomes of complex processes.", "This article is not about solving a concrete problem, but rather about approach (one of many) to increase the productivity of engineers and data scientists by introducing higher level abstractions over repetitive tasks like storing/retrieving features, training models and building pipelines from basic blocks.", "[Disclaimer] Open sourcing this framework is not planned at the moment, however, I hope that the view described below might be helpful to the community.", "To get a sense of the problem to be solved, we\u2019ll first look on domain problem example. Then define the wish list to our toolbox and take high-level solution overview. Further sections provide a deeper look at every aspect of the approach.", "Let\u2019s assume we want to forecast Net Income of publicly traded companies. While we might forecast the final value of Net Income using statistical and ML methods, let\u2019s check if accuracy might be improved by forecasting variables our target consists of. Here is a simplified breakdown of Net Income calculation:", "Other Features that might be useful:", "From past experience, we know that we would like to:", "With the number of Companies used in forecasting > 5000, it appears that would be nice to have a sort of framework to help us solve this problem.", "One of the possible solutions would be to express the problem as a computational graph (directed and acyclic), with nodes being processing steps, and edges \u2014 dependencies.", "Each computational step outputs the data, which is persisted into a shared repository, from where it is requested by other steps in case of need.", "Here is how the breakdown of Net Income calculation might look like:", "Would be good to have a framework that would simplify the construction of those graphs, perform the execution and allow usage results of one computation in another.", "Each step of computation might be abstracted as a function, which gets input parameters and outputs data. Different types of operations (Moving Average calculation or Difference calculation) are then different functions. Stateless and idempotency are also useful properties of computational steps.", "Node declaration is then a container for parameters that include:", "Here is an example of such node declaration that computes relative growth for all features in the feature group:", "Another example with linking 2 blocks together \u2014 let\u2019s say we want to compute the difference between past Earnings estimates and forecasted Earnings. To do that, we might shift Past Earnings estimates one step in time in the first block, then join and calculate relative difference in another:", "A computation that requires Machine Learning training is represented by a slightly different block, that requires a number of additional parameters:", "This processing step is handled a bit differently by the workflow engine, with cross-validation support and rolling training by time.", "Having graph declaration decoupled from execution context allows automated testing and configuration generation.", "With computational graph defined, it is enough to pass only features we want to compute to the processing engine, which would then unfold dependencies and re-compute only data that is missing in the repository.", "Data providers \u2014 inject different sorts of data into the system. Provider examples:", "Binary operations \u2014 join 2 features by time and key and perform math operation:", "By implementing such basic blocks and then combining into higher level structures, quite sophisticated logic might be defined. Each type of feature extractor is a class that implements a common interface, is registered within component responsible for computing features and referenced from Graph by name.", "It is also convenient to keep metadata associated with features \u2014 what are direct parents of this feature if it is a future prediction, feature type etc.", "Having this metadata, it is straightforward then to find all forecasts of some feature, calculate their accuracy metrics, select N best forecasts, calculate confidence intervals and create a new block of features to be used later", "Every computational step produces features that are grouped into a sort of feature block \u2014 FeatureStore.", "To support Time-series orientation \u2014 features might be indexed by Time, and to support relationships \u2014 grouped by Key.", "Daily changes of Stock price, for example, would be indexed by Day and Grouped by Ticker (Company identifier)", "When computed, feature block is put into the Repository with Key computed from Extractor name and Parameters, different Parameters then result in different block names.", "During the computation phase, Feature blocks are read from Repository if available or computed otherwise.", "To support Time Series problem nature in sequence invariant algorithms like Decision Trees or Regressions, regular Feature Stores (Flat) are converted into Sequential, with the number of time steps to include being a parameter to an extractor.", "Here is an example of Microsoft\u2019s Quarterly Revenue and Cost of Revenue converted from Flat:", "To prevent information about future events leaking into ML Model, all sequential features having Seq 0 in their metadata and not being forecasts are filtered out from Feature View, which is passed to Model.", "The framework is agnostic from specifics of different ML models, all is required is to implement a standard interface. The default mode of training is training and forecasting sliding in time, during which model is trained on past events {0:t-1} to predict future events {t}. After all predictions for period {t} are done, training data is extended to {0:t}, and trained again to forecast {t + 1}", "Training for every time step is split into k-folds, with holdout set used to detect early stopping point (for tree-based models) and select hyper-parameters:", "Although now Validation and Prediction sets are not identically distributed, this breakdown works well enough to detect overfitting.", "Another training mode which is often used to perform quick experiments is a simple k-fold split of all events. While the approach is not sound and leads to leakage of information about future events, it has proven to be a good approximation of default training mode.", "Stacking is achieved by sequencing different models one after another.", "There is a number of service feature extractors that when placed after ML model in a graph, assocAnsweriate predicted values with original data (labels) and produce different sorts of metrics and structures for further analysis:", "It might be time and energy consuming to manually iterate over possible configuration options. Next logical step would be to formulate graph construction as an optimization problem with constraints (e.g.Computation Time) and optimization objectives (e.g. Accuracy)", "Parts of the framework that look easily parallelizable:", "While this article is about the framework in general and not about solving concrete forecasting problem, still we\u2019d like to know if results are improved compared with simpler ML algorithms?", "The answer is yes, for all variables to be forecasted there is a quite significant boost in Accuracy.", "Here is a comparison of Earning forecast for random company (ROST in this case) between awesome library Prophet and one of Pipeline models predictions:", "Earnings forecast for another random company, EBAY", "While being a somewhat significant initial investment, having a framework similar to the one described lead to:", "This solution gradually evolved from automating and improving day to day activities. In case of need to implement such a framework from scratch, I\u2019d also consider building on top of existing open source technologies, for example \u2014 https://airflow.apache.org", "Thank you for reading this post, your feedback or request for more detailed dive into specific areas is very much welcomed.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Feadfd75b15ff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@acherednychenko?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@acherednychenko?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Andrii Cherednychenko"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46e68d15b467&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&user=Andrii+Cherednychenko&userId=46e68d15b467&source=post_page-46e68d15b467----eadfd75b15ff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/WY70Ay0WHRg", "anchor_text": "https://unsplash.com/photos/WY70Ay0WHRg"}, {"url": "https://en.wikipedia.org/wiki/Cross-validation_(statistics)#k-fold_cross-validation", "anchor_text": "k-folds"}, {"url": "https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables", "anchor_text": "identically distributed"}, {"url": "https://blog.statsbot.co/ensemble-learning-d1dcd548e936", "anchor_text": "Stacking"}, {"url": "https://github.com/facebook/prophet", "anchor_text": "Prophet"}, {"url": "https://airflow.apache.org", "anchor_text": "https://airflow.apache.org"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----eadfd75b15ff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/time-series-forecasting?source=post_page-----eadfd75b15ff---------------time_series_forecasting-----------------", "anchor_text": "Time Series Forecasting"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----eadfd75b15ff---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----eadfd75b15ff---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/ai?source=post_page-----eadfd75b15ff---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&user=Andrii+Cherednychenko&userId=46e68d15b467&source=-----eadfd75b15ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&user=Andrii+Cherednychenko&userId=46e68d15b467&source=-----eadfd75b15ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Feadfd75b15ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----eadfd75b15ff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----eadfd75b15ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@acherednychenko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@acherednychenko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrii Cherednychenko"}, {"url": "https://medium.com/@acherednychenko/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "35 Followers"}, {"url": "http://www.linkedin.com/in/andrewcherednychenko", "anchor_text": "www.linkedin.com/in/andrewcherednychenko"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46e68d15b467&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&user=Andrii+Cherednychenko&userId=46e68d15b467&source=post_page-46e68d15b467--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F46e68d15b467%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fscalable-approach-to-building-time-series-forecasting-pipelines-eadfd75b15ff&user=Andrii+Cherednychenko&userId=46e68d15b467&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}