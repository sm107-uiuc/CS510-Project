{"url": "https://towardsdatascience.com/how-i-taught-a-plane-to-fly-using-rl-c170a152b771", "time": 1683006424.5508091, "path": "towardsdatascience.com/how-i-taught-a-plane-to-fly-using-rl-c170a152b771/", "webpage": {"metadata": {"title": "AI learns to fly (Part 1) | Airplane simulation and Reinforcement Learning | by Yann Berthelot | Towards Data Science", "h1": "AI learns to fly (Part 1) | Airplane simulation and Reinforcement Learning", "description": "In this series of articles, I am going to write about my journey into using Artificial Intelligence to make a plane fly."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/ai-learns-to-fly-part-2-create-your-custom-rl-environment-and-train-an-agent-b56bbd334c76?source=post_stats_page---------------------------", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://gist.github.com/YannBerthelot/03638dd1049a079796073f845db1bb38", "anchor_text": "code", "paragraph_index": 59}, {"url": "https://www.translatorscafe.com/unit-converter/en-US/calculator/altitude/.", "anchor_text": "https://www.translatorscafe.com/unit-converter/en-US/calculator/altitude/.", "paragraph_index": 61}], "all_paragraphs": ["From Icarus burning his wings to the Wright brothers soaring through the sky, it took mankind thousands of years to learn how to fly, but how long will it take an AI to do the same?", "In this series of articles, I am going to write about my journey into using artificial intelligence to make a plane fly. Nowadays AI is used in all sorts of applications from biped robots to autonomous cars, but so far no AI Airplane has been seen, let\u2019s change that!", "Reinforcement Learning is the branch of machine Learning (making algorithms learn how to do things rather than telling them how to do it) that deals with the training of an artificial intelligence through an action-and-reward process. The agent will interact with the environment, selecting actions, and observing their results (new states and rewards) while trying to optimize its return (the sum of its rewards).", "In this first article, we\u2019ll define the transition function allowing the environment to compute the next state based on the previous state and the agent actions: in our case computing the airplane\u2019s next position, velocity, and acceleration based on its current position, velocity and acceleration and the pilot\u2019s action (thrust value and pitch angle). We will basically be creating a basic airplane simulation.", "In the second article (here), we\u2019ll talk about the rest of the environment (states, actions, and rewards) and the reinforcement learning agent (model selection, hyperparameters optimization, and agent training and testing).", "In order to create a flight model, let\u2019s first begin with a quick review of how airplanes fly. There are four forces that affects a plane", "\u00b7 Thrust: Force created by its propeller(s) or reactor(s) pushing the plane forward", "\u00b7 Drag: Force created by the air resistance and thus opposed to the plane\u2019s movement", "\u00b7 Weight: the weight of the plane", "\u00b7 Lift: The force allowing the plane to fly", "For the plane to gain speed horizontally we must have thrust > drag and for the plane to gain speed vertically we must have lift > weight.", "Let\u2019s create our airplane simulation, computing the airplane\u2019s next position, velocity, and acceleration based on its previous position, velocity, and acceleration of the plane.", "I have chosen to simulate an Airbus A320 because of its wide use across the world as well as the number of data available for this aircraft (The illustrations will still be made using my wooden toy plane but the figures will be based on the actual plane, such figures can be found in [1]).", "\u00b7 Thrust (Variations due to altitude and air rarefaction)", "\u00b7 Lift and drag coefficient (variations due to angle of attack, including stall and variations due to Mach number impact on lift and drag)", "\u00b7 Drag (due to air density variation with altitude and due to the angle of attack variations)", "\u00b7 Lift (Flap usage to increase lift)", "\u00b7 Fuel consumption (specific fuel consumption estimation and plane mass variation due to consumed fuel", "The aim of the plane model is to compute the acceleration, speed, and position (which I will be calling dynamics in the rest of the article) of the plane for any given timestep based on conditions of the previous timestep. Throughout this study, we will be using the ground frame of reference.", "So, let\u2019s dive into the modeling. To compute the dynamic of the plane at a given time step in the frame of reference of the ground we will use the following relations:", "We now have a way to calculate velocity and position based on acceleration. Let\u2019s now calculate the acceleration. To do this we will be using Newton\u2019s second law:", "In other words, the sum of the forces applied to an object is equal to its mass times its acceleration. So, to compute our plane\u2019s acceleration we have to compute the sum of the forces applied to it. As presented before we have weight, thrust, drag, and lift. Let\u2019s take a look at each one individually.", "That\u2019s the easy one! It\u2019s the force due to Earth\u2019s gravity reacting with the plane\u2019s mass.", "This one is a bit more complicated. It\u2019s the force created by the plane\u2019s turbojets. The turbojet basically sucks the air coming in front of the plane and expels it at greater speed thus pushing the plane forward.", "As the altitude increases, the efficiency of the turbojets decreases due to the rarefaction of the air (leading for less air being sucked in and accelerated). We will be using the following relation to account for this reduction (which I have approximated from graphs found online[2]).", "We will neglect the impact of temperature variations on the turbofans efficiency as we suppose air density variation already does account for this.", "Drag is basically the air resisting the plane\u2019s movement. Lift is the force created by the difference between speeds above and beneath the wing allowing to compensate for the weight and therefore gain altitude. Even though their impact on flight is totally different, they are both aerodynamic forces and are obtained through a similar formula:", "As we have seen when studying thrust, air density decreases with altitude. We thus have:", "Before going any further, we need to establish the difference between drag and lift. To do this we have to introduce the plane\u2019s referential and define a few angles:", "We shall calculate velocity later, but now that we have tackled air density, let\u2019s take a closer look at lift and drag coefficients, reference surfaces, and their relation to the angle of attack.", "Lift and drag coefficients, which are used to describe how easily the flow goes around the shape, are proportional to the angle of attack. We will be using the following approximations (considering stall above 20\u00b0) to compute them:", "Another important phenomenon is the impact of velocities close to the speed of sound on the drag and lift coefficient. As the plane gets closer to the speed of sound, turbulences start to appear on the wing and impact drag and lift. M, the Mach number represents the ratio of the velocity over the speed of sound. We will, once more, approximate this relation :", "The reference surfaces, needed to compute drag and lift, are the surfaces orthogonal to the direction of the force we are interested in. For drag the reference surface is the one opposed to the relative wind, whereas for lift the reference surface is the one parallel to the relative wind. The surfaces we are interested in are the one relative to the relative wind. We will, therefore, be using the relative wind\u2019s frame of reference (x\u2019z\u2019). It is obtained by rotating our initial frame of reference by the value of the slope.", "We must calculate the projection of the front and wings surfaces to the relative wind\u2019s frame of reference.", "We thus get those equations for the projected surfaces along our relative wind axes x\u2019 and z\u2019:", "During takeoff and landing, planes use flaps to increase the amount of lift at the expense of increased drag and therefore shorten the take-off and landing distance. The take-off distance is defined as the distance between the starting point on the runway and the point at which the plane reaches 25m of altitude above the runway. We will define the take-off angle as the pitch (angle between the ground and the plane) to be used once the plane has reached its take-off speed. Here are the take-off distances of our plane with no flaps (We will only be plotting the values of take-off distances inferior to 5km, i.e. length of the longest civil runway).", "The take-off distance for an A320 is supposed to be around 2km. At that point the plane is not generating enough lift, so we need to use flaps. We will assume that flaps increase the amount of lift by 70%. (value based on documentation and tweaked to achieve a realistic result). The flaps will be out at the plane\u2019s start and will automatically go back in at 400ft. With flaps out, we get the following take-off distances, much closer to a real A320:", "Now that we have the basic formulas for weight, thrust, lift, and drag, we need to talk about the impact of their orientations. Let\u2019s take another look at our angles graph again.", "Let\u2019s now project those forces on the x and z-axis:", "We thus get the equations to solve in order to get the sum of forces on the x and z-axis.", "To finish our model, we need to make it able to prevent the plane from going through the ground and to detect collisions. These collisions are prevented by setting back to 0 any negative vertical positions as well as setting the velocity back to 0 as well for those situations. To account for future crash detections, if the plane is to have a negative vertical position while also having a negative vertical velocity (before being set back to 0), we will compute the kinetic energy of the plane that will be used to check if colliding with the ground leads to a crash.", "If the kinetic energy at ground contact is inferior to a given value E_crash, then the plane will crash. Otherwise, it will be considered as a safe landing. This feature will be used later for the reinforcement learning part.", "For fuel consumption, we will be using a simple model based on thrust-specific fuel consumption (SFC) which links thrust and time to fuel consumption. To simplify the problem, we will always assume the cruise level SFC and neglect the sea-level SFC (since we will spend most of our time at cruise level).", "To estimate SFC, we will assume that the relation between sea-level thrust (the maximal available thrust for the reactor) and cruise SFC is linear. With this assumption, we can estimate the parameters of the relation between thrust and SFC based on the figures for the A320 engines, and we get an SFC of 17.5. As a consequence of fuel consumption, the mass of the plane will vary, we will take this variation into account for the dynamics. Moreover, if the variation of fuel exceeds the total capacity, the plane\u2019s reactors will stop functioning.", "In order to check our simulation, we will analyze and compare the results of our simulation of an A320 to reality.", "On these 3 graphs, we can see the evolution over time of acceleration, velocity, and position during the take-off phase. Acceleration is only horizontal at first, and then both horizontal and vertical when Vr (rotation velocity) has been reached (~25s) and the plane rotates. The phenomenon can be seen in similar ways for velocity, where vertical speed starts going up at 25s and the increase rate of horizontal speed (horizontal acceleration) lowers. Finally, the last graph allows us to estimate a take-off distance of around 1800m which is close to the one we expected (~1900m). Moreover the take-off time (time before leaving ground) of 25s also matches with reality (of ~30s). Additionally, we can also notice that the acceleration values stay well under displeasing values (reaching a max of 0.33g horizontally and 0.06g vertically).", "We want to assess that our plane does not exceed speeds dangerous for its structural integrity (getting too close to Mach 1 creates important turbulences and stress on the structure of the plane). In order to measure the max speed our aircraft can reach, we will set the thrust to its maximum value and observe the speed at which the plane stabilizes.", "The plane stabilizes at a max speed of 300m/s (Mach 0.87) which is well under the speed of sound and is safe for our plane to fly at. It is, however, higher than the max speed of a real A320 (of Mach 0.75), but we\u2019ll assume it\u2019s fair to neglect this difference as most flights will not reach that speed at all.", "To estimate our cruise speed, we will have to shift our reactors to a cruise setting, this usually means decreasing power to between 60% and 70%. We will switch our turbofans to 60% of their output, set a given theta angle (2.5\u00b0 obtained through heuristics) and observe the cruise speed we reach as well as the cruise altitude.", "We observe a cruise speed of 231m/s and a mean cruise altitude of 10500. Those two values match the reality of the 0.72 Mach (233m/s) economical cruise speed and 37000ft cruise altitude of an A320. This match was achieved by tweaking some parameters of the model (Thrust percentage and theta angle for the cruise phase).", "The range of an airplane is the maximum distance it may travel with a given amount of fuel and take-off mass. We are going to study the range of our plane with a full tank and maximum take-off mass (for a total of 73,5T). The range will be measured by flying the plane until it runs out of fuel at a given cruise thrust and cruise theta (defined through trial and error until reaching results close to reality).", "The policy I used is as follows:", "\u00b7 Until Vr use full thrust at a 0\u00b0 pitch angle with flaps out.", "\u00b7 Carry on until fuel runs out", "We observe a range of 4,580 km (over a 5h30 flight), which is a bit less than expected (around 6 000km). However, this is mostly due to inaccuracies in our model and the lack of flight optimization by the (absent) pilot. We will accept this value (which we\u2019ll try to improve in our next part).", "We have now validated our airplane simulation to be functional and somewhat realistic. It allows us to compute the impact of the agent\u2019s (the pilot) actions on our environment (the aircraft) based on its current state (the current aircraft position, velocity and acceleration) and returning a new state (the aircraft\u2019s new position, velocity and acceleration). We can now use this model as our transition function for our reinforcement learning environment.", "In the next article, we will be defining and coding the rest of the reinforcement learning parts : the actions, states and rewards, and of course the agent itself. With a complete framework we will then train the agent to fly !", "Hopefully, teaching an AI to fly will allow us to optimize the flight policy (which we have very basically approximated until now) and improve fuel consumption and range (or at least we will have fun watching an AI struggling to learn how to fly).", "Stay tuned for the next part where CaptAIn (our Reinforcement Learning Agent) will take commands of our plane!", "Here is the code for this model (transition function and graphs utilities).", "The full code (Python) I used for this project can be found on my Github :", "[2] \u201cAir Pressure, Density, and Temperature vs. Altitude in Standard Atmosphere Calculator \u2022 Thermodynamics \u2014 Heat \u2022 Online Unit Converters.\u201d [Online]. Available: https://www.translatorscafe.com/unit-converter/en-US/calculator/altitude/. [Accessed: 12-Apr-2020].", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Fond of Reinforcement Learning and Research"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc170a152b771&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c170a152b771--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@yannberthelot1?source=post_page-----c170a152b771--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yannberthelot1?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Yann Berthelot"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbe4a07da40d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&user=Yann+Berthelot&userId=be4a07da40d5&source=post_page-be4a07da40d5----c170a152b771---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/ai-learns-to-fly-part-2-create-your-custom-rl-environment-and-train-an-agent-b56bbd334c76?source=post_stats_page---------------------------", "anchor_text": "here"}, {"url": "https://gist.github.com/YannBerthelot/03638dd1049a079796073f845db1bb38", "anchor_text": "code"}, {"url": "https://github.com/YannBerthelot/PlaneModel", "anchor_text": "YannBerthelot/PlaneModelPlaneModel environment for RL. Contribute to YannBerthelot/PlaneModel development by creating an account on GitHub.github.com"}, {"url": "http://passion-aviation.html.pagesperso-orange.fr/Fiches", "anchor_text": "http://passion-aviation.html.pagesperso-orange.fr/Fiches"}, {"url": "https://www.translatorscafe.com/unit-converter/en-US/calculator/altitude/.", "anchor_text": "https://www.translatorscafe.com/unit-converter/en-US/calculator/altitude/."}, {"url": "https://www.lavionnaire.fr/AerodynFluxTrans.php#ProfilSuperCrit.", "anchor_text": "https://www.lavionnaire.fr/AerodynFluxTrans.php#ProfilSuperCrit."}, {"url": "https://medium.com/tag/simulation?source=post_page-----c170a152b771---------------simulation-----------------", "anchor_text": "Simulation"}, {"url": "https://medium.com/tag/python?source=post_page-----c170a152b771---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/reinforcement-learning?source=post_page-----c170a152b771---------------reinforcement_learning-----------------", "anchor_text": "Reinforcement Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c170a152b771---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----c170a152b771---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&user=Yann+Berthelot&userId=be4a07da40d5&source=-----c170a152b771---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&user=Yann+Berthelot&userId=be4a07da40d5&source=-----c170a152b771---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c170a152b771--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc170a152b771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c170a152b771---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c170a152b771--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c170a152b771--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c170a152b771--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c170a152b771--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c170a152b771--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yannberthelot1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@yannberthelot1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yann Berthelot"}, {"url": "https://medium.com/@yannberthelot1/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "94 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbe4a07da40d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&user=Yann+Berthelot&userId=be4a07da40d5&source=post_page-be4a07da40d5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F61a4bf566099&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-taught-a-plane-to-fly-using-rl-c170a152b771&newsletterV3=be4a07da40d5&newsletterV3Id=61a4bf566099&user=Yann+Berthelot&userId=be4a07da40d5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}