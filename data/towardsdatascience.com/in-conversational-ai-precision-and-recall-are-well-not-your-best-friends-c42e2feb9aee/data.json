{"url": "https://towardsdatascience.com/in-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee", "time": 1683011628.356662, "path": "towardsdatascience.com/in-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee/", "webpage": {"metadata": {"title": "In conversational AI, Precision and Recall are (well) not your best friends | by Patrick Meyer | Towards Data Science", "h1": "In conversational AI, Precision and Recall are (well) not your best friends", "description": "In order for a conversational assistant to respond to a user\u2019s request automatically, it is necessary to train the user to correctly recognize questions and thus trigger the right scenarios. For\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Precision_and_recall", "anchor_text": "this Wikipedia page", "paragraph_index": 32}], "all_paragraphs": ["In order for a conversational assistant to respond to a user\u2019s request automatically, it is necessary to train the user to correctly recognize questions and thus trigger the right scenarios. For this, industrial solutions (i.e. chatbot solutions) mostly use machine learning to perform this detection by creating a model (the result of the learning process) to classify requests by intent. The literature on learning recommends us to check the performance of the model via the Precision and Recall indicators. From experience, I have found that these indicators are actually irrelevant in conversational situations and lead to misinterpretation, overconfidence and, ultimately, are lures for the analyst. I recommend the use of the Critical Success Index (CSI), but as it is still not sufficient, to complete this indicator by an analysis of the unbiased coefficient of variation of our old friends and the new one.", "In conversational AI, systems must \u201cunderstand\u201d the user\u2019s request before they can perform the requested action (e.g. \u201cturn on the light\u201d, \u201corder me a pizza\u201d, \u201chow can I turn off the TV\u201d, etc.). To do this, these systems use one of the techniques of machine learning, which consists of automatically creating classification models from groupings of sentences that have the same meaning, which implicitly mean the same thing. For this, the dialoguer (i.e. the one who writes the dialogues of a conversational assistant) must supervise the training of a detector (the classifier) by providing him with a set of example sentences and grouping them by intent (by type of request).", "After learning, the system must be tested to ensure that it will be \u201csmart\u201d enough to understand all the requests. Especially since these systems are used for their ability to detect demand even if it varies from what was expected. For a description of the processing of user requests, you can refer to my previous article on Conversational AI for dialogers: the 4 complexity levels scale.", "To test his assistant, the dialoguer must ask questions that are not in the training and check that the system detects the intent despite variations that he will introduce in order to verify that the system is able to fetch different sentences. A training defect, for example as a result of undertraining, can lead to negative effects for the user since the system will trigger an action that does not correspond to his initial request.", "In automatic classification, Precision (also called Positive Predictive Value) is the proportion of relevant information among all the proposed items. Recall (sensitivity) is the proportion of relevant items proposed among all relevant items [1].", "When a conversational assistant answers correctly 20 times (also called True Positive or TP), executes an action when it is not the request 10 times (called False Positive or FP), does not execute the expected action 40 times (called False Negative or FN), its Precision is then 20/(20+10) = 0.667 (66.7%) and its Recall is equal to 20/(20+40) = 0.334 (33.4%). A system capable of detecting without error has an Precision equal to 1 (100%) and a Recall also equal to 1 (100%).", "In multi-class systems (in our case, multiple-intent systems and therefore it concerns all conversational assistants), the Overall System Precision is the average of the Precisions of all intents and the Recall is the average of the Recalls of all intents. These values are called the macro-average of Precision and the macro-average of Recall.", "Precision and Recall are calculated for each of the intents and the overall results are averaged. The True Positive result corresponds to the correct detection of the intent. The False Negative corresponds to the case where our intent test sentence gave another intent as a result (one of the other intents). False Positive corresponds to sentences of the other intents that gave that intent. And the True Negative corresponds to all other tests that did not give our intent as a result.", "There is another indicator which is the micro-average of the Precisions and which corresponds to the sum of the TPs of the different classes divided by the sum of TPs and FPs. This calculation consists in summing all the values in denominator which leads to the calculation of the success rate in the end.", "To test the system, the dialoguer prepares a set of test phrases (called the validation data set) consisting of phrases that are not part of the training (called the training data set). Each sentence is linked to one of the intents.", "It is also possible to use automatic testing techniques by separating the available data into training data and test data according to a rule depending on the type of cross-validation chosen. In non-cross separation, a ratio is chosen to separate the data into two sets. Often the ratios 50/50, 66/33 or 80/20 are used. However, separating the available data into two disjoint subsets can generate detection biases if the number of data is small. These biases may be underfitting or too large margin error.", "One solution to this problem is to use the cross-validation technique of separating sets by folds called the k-fold. The k-fold proposes to perform a separation of the data into k folds. One fold is kept for testing and the remaining folds (k-1) are used for training [2]. In systems where the dialoguer can intervene directly on the model, this test mode allows to adjust the hyper-parameters of the model and stop the training at the right time (i.e. before over-fitting).", "In systems with unbalanced intents (i.e. having different numbers of sentences per intent, which is also often the case in the conversational solutions), it is important to keep the block ratios in the intent. This technique is called stratified cross validation.", "In \u201coff-the-shelf\u201d conversational AI solutions (i.e. almost all commercial Chatbot solutions), it is not possible to select these hyper-parameters and the system sets itself \u201con its own\u201d. This black box side makes it difficult to know whether the system is factory preset or whether it automatically adapts using internal cross-validation and early shutdown features.", "Let\u2019s take as an example a 4-intent system with the constitution of a test set that has been specially created for validation. Suppose it is trained after a first business iteration, i.e. the subject matter experts have given the set of sentences that correspond, according to them, to the most common user requests for the domains that need to be automated. Let\u2019s assume that a first phase of testing gave the following results:", "The classifier is tested using the test sentences (20 sentences per intent) and the results of the detections are noted in a table called the confusion matrix, divided into rows for the intents to be tested and columns for the intents that are detected. The numbers at the intersections correspond to the numbers of detection occurrences for the tested intent.", "In the example TEST_1, the 20 test phrases of the first intent were correctly classified 16 times and 4 errors were found. Of the 80 test phrases, 59 phrases were globally correctly detected and 21 resulted in classification errors. The average Precision of this classifier is 74% and the Recall is also 74%. The success rate (correctly identified sentences / total number of sentences) gives a result of 74% (59/80) which is relatively correct for a first iteration.", "After a second iteration to complete the overall training, the system is tested again with the initial test sentences. This new test gives the following results:", "The new success rate is identical to the previous training, i.e. 59/80 = 74%. The Precision on the Intent 3 test is 100% and the Recall is 5%. The set of averages means that the overall Precision of this training is 80% and the Recall is 74%, i.e. a 6% increase in Precision and identical Recall, whereas the result has deteriorated sharply on the intent 3 test, which is practically no longer recognised. The analysis of the overall Precision therefore gives a positive result whereas there is a strong degradation of the user experience since the system will practically no longer be able to answer a category of questions. Only the fine analysis of each intent allows to check the evolution of the system after the new training.", "Suppose that the analyst performs additional work on intent 3 to correct the problem identified, increases learning about this intent, and performs a new set of tests.", "The new success rate is 74%, which is the same as the other 2 trials. The Precision is 87%, an increase of 7% compared to the previous test and the Recall is 74%, a value that remains unchanged on all the tests. For the analyst, the system shows a global progression of the Precision which suggests an improvement of the system! By analyzing the results in more detail, we can see that Intent 3 is now over-detected with almost a Precision for this intent of 20/41 = 49%, which is lower than the previous test. From the user\u2019s point of view, and this is what is most important in the end, the system gives the impression of systematically triggering the same action (50% of requests with 25% that are nevertheless justified).", "Analysis of the overall changes in Precision would therefore not have identified any misclassifications. Analysis of the Recall would also have been inconclusive in these cases since it did not vary over the 3 tests. From the tester\u2019s point of view, the distinction between a non-detection or a false detection is important for the analysis of the results and to determine the actions to be carried out on the trainings (create new intents, group them together, add sentences to intents\u2026).", "However, from the end-user\u2019s perspective, the important thing is that the system responds correctly most of the time and the overall analysis of these values would have missed errors that would have penalized the user experience. Of course, the performance of the classifier must be globally balanced. Nevertheless, a less good detection can be envisaged on less frequent requests. It is then necessary to correlate the results with the frequency of requests but this is another subject.", "When testing the performance of a classifier, it is important to consider the balance of test sets and to have the same number of test values in each intent if possible.", "To highlight this, let\u2019s try another example. We are performing a detection test but we do not have a balanced system since the number of test sentences varies according to the intent: intent 1 has only 10 test sentences, intent 2 has 20, intent 3 is the most complete with 45 sentences and intent 4 has only 5 sentences.", "The test gives the following results:", "We have the following indicators: Precision = 86%, Recall = 84% and Success Rate = 86%. To balance the results, it is necessary to introduce the notion of weighted indicator. The values of the respective indicators of the different classes must be multiplied by the ratio of the sentences used for the test. The ratio of intent 1 is 10/80 = 0.125. The weighted indicators are then Weighted Precision = 87% and Weighted Recall = 86%.", "We modify the training to try to improve our system.", "The indicators have the following values : Precision = 80%, Recall = 89% for a Success Rate of 90%. The weighted Precision is 93% and the weighted Recall is 90%. In the calculation without weighting, we would have seen a 6% decrease in Precision, whereas the system has improved overall, which is shown by the weighted value, since we see a 7% improvement in Precision. This very important difference comes from the fact that the weight of instance 4 is identical to the other classes while the number of tests is low for this instance. The low number of tests for instance 4 means that the impact of a bad result gives a lot of weight to the results of the test for this instance, which is highlighted here.", "We have seen that the Precision and Recall indicators do not highlight localized classification errors, which can penalize the entire system. In the case of TEST_3, the system detects a bad intent in a quarter of the requests, which will most certainly lead to the rejection of the conversational assistant. In addition, Precision and Recall focus on 2 different axes: the first one highlights False Positive problems when the second one highlights False Negative problems. For the user, this remains a wrong answer and therefore we need a new indicator that takes to group these two axes together.", "This indicator exists (although it is not too visible) and it is the Critical Success Index (CSI) rather used in weather forecasting elsewhere. It is also called Threat Score TS. The CSI is a performance verification measure for categorical detections. It is equal to the total number of correct event forecasts (TP) divided by the total number of false detections (FN + FP) to which TP is added to obtain a performance ratio.", "To finalize our tests before going into live, we are carrying out a new training that globally improves our model, placing it at a fully operational level with an Precision of 90%, a Recall of 89% and a Success Rate of 89%.", "We then calculate several indicators that you will find listed on this Wikipedia page.", "A study of the table shows that no indicator really highlights the problems of the TEST_2 and TEST_3 classifiers. Only the indicators CSI, F1-score, Matthews Correlation Coefficient (MCC) and the Fowlkes-Mallows index highlight a decrease in quality on the TEST_2 classifier. There is no indicator to detect the TEST_3 problem. The CSI indicator is the closest to an expectation of overall system performance, which makes it a more relevant indicator than Precision, Recall and even Accuracy.", "Since the indicators do not give any indication, we are obliged to look at the details of the tests of values for each intent in order to determine which intents are problematic.", "Since this work is tedious over a large number of tests and for many intents, I propose to use a dispersion indicator called coefficient of variation (or relative standard deviation). This indicator is defined as the ratio of the standard deviation to the mean [3]. This number without unit allows a comparison between several series which makes it interesting for automated tests. This value must nevertheless be adjusted to take into account the small number of samples. The formula for this indicator is then as follows:", "The calculation of this indicator for our 4 tests gives the following results for Precision, Recall and CSI:", "Exceeding a threshold (e.g. 20%) of one of these 3 values can thus be used to inform the analyst of a training quality problem. This indicator complements the classic analysis of performance indicators, i.e. low overall Precision for example. When the threshold is reached, it is then advisable to analyse the results more closely in order to determine the problematic intent(s) and thus see how to modify the training, or even reject the new training.", "In the area of conversational assistants, one of the causes of rejection of systems is when they do not correctly recognize requests. It is therefore important to test the performance of your assistant before publishing it and making it available to users. We have seen how to calculate Precision and Recall values for a multi-class system and how important it is to weight the values when the number of test sentences is unbalanced. Nevertheless, the Precision and Recall indicators, the most commonly used in machine learning, do not allow us to conclude whether a system does not contain an error on one or more intents since we are only studying a global value.", "I, therefore, invite you to complete your calculation by adding the CSI indicator, which is more relevant to user expectations, i.e. an assistant that responds correctly as often as possible (regardless of type I or II error). Complete this indicator by calculating the Adjusted Coefficient of Variation (unbiased) for Precision, Recall and CSI. Setting an alert threshold on the maximum of these 3 values allows you to highlight a learning problem without having to check the indicators one by one and thus save time in the analysis of your training iterations.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I work in the field of artificial intelligence, especially in knowledge processing and NLP. In particular, on virtual assistants since 2016."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc42e2feb9aee&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://pemey.medium.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": ""}, {"url": "https://pemey.medium.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Patrick Meyer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa0f34bc0d5ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&user=Patrick+Meyer&userId=a0f34bc0d5ba&source=post_page-a0f34bc0d5ba----c42e2feb9aee---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Precision_and_recall", "anchor_text": "this Wikipedia page"}, {"url": "https://en.wikipedia.org/wiki/Precision_and_recall", "anchor_text": "https://en.wikipedia.org/wiki/Precision_and_recall"}, {"url": "https://en.wikipedia.org/wiki/Cross-validation_(statistics)", "anchor_text": "https://en.wikipedia.org/wiki/Cross-validation_(statistics)"}, {"url": "https://en.wikipedia.org/wiki/Coefficient_of_variation", "anchor_text": "https://en.wikipedia.org/wiki/Coefficient_of_variation"}, {"url": "https://medium.com/tag/chatbots?source=post_page-----c42e2feb9aee---------------chatbots-----------------", "anchor_text": "Chatbots"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c42e2feb9aee---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c42e2feb9aee---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/precision-and-recall?source=post_page-----c42e2feb9aee---------------precision_and_recall-----------------", "anchor_text": "Precision And Recall"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&user=Patrick+Meyer&userId=a0f34bc0d5ba&source=-----c42e2feb9aee---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&user=Patrick+Meyer&userId=a0f34bc0d5ba&source=-----c42e2feb9aee---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc42e2feb9aee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c42e2feb9aee---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c42e2feb9aee--------------------------------", "anchor_text": ""}, {"url": "https://pemey.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://pemey.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Patrick Meyer"}, {"url": "https://pemey.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "366 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa0f34bc0d5ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&user=Patrick+Meyer&userId=a0f34bc0d5ba&source=post_page-a0f34bc0d5ba--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7c8b21c7e351&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fin-conversational-ai-precision-and-recall-are-well-not-your-best-friends-c42e2feb9aee&newsletterV3=a0f34bc0d5ba&newsletterV3Id=7c8b21c7e351&user=Patrick+Meyer&userId=a0f34bc0d5ba&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}