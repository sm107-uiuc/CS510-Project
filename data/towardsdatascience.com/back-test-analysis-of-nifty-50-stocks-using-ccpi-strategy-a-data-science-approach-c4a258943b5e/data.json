{"url": "https://towardsdatascience.com/back-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e", "time": 1683010435.048042, "path": "towardsdatascience.com/back-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e/", "webpage": {"metadata": {"title": "Back-test analysis of NIFTY 50 stocks using CPPI strategy: A Data Science Approach | by Mohammed Rafi Kaja | Towards Data Science", "h1": "Back-test analysis of NIFTY 50 stocks using CPPI strategy: A Data Science Approach", "description": "This article is an attempt to solve a real-world investment management problem by using a data science approach by analysing the impact of the Covid-19 pandemic on NIFTY-50 stocks. Pandemic events\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.investopedia.com/terms/c/cppi.asp", "anchor_text": "https://www.investopedia.com/terms/c/cppi.asp", "paragraph_index": 2}, {"url": "https://github.com/swapniljariwala/nsepy/tree/master/nsepy", "anchor_text": "https://github.com/swapniljariwala/nsepy/tree/master/nsepy", "paragraph_index": 3}], "all_paragraphs": ["This article is an attempt to solve a real-world investment management problem by using a data science approach by analysing the impact of the Covid-19 pandemic on NIFTY-50 stocks.", "Pandemic events such as Covid-19 are \u201cblack swan\u201d events as they cannot be predicted, and no diversification strategy can protect an investment from these kinds of systemic risks. As the pundits say, \u201cdiversification will fail you when you need the most\u201d. In events such as the financial crisis in 2008 or the Covid-19 pandemic which we are facing now, even a well-diversified portfolio will lose money. So how do you protect your wealth when the market crashes during such events but also participate in the upside and get the best of both worlds without losing out on your financial goals. The answer is to have an \u201cinsurance\u201d or \u201csafe net\u201d sort of strategy when building your portfolio. Once such \u201csafe net\u201d strategy is the Constant Proportion Portfolio Insurance (CPPI).", "Even though these kind of strategies are being used in the industry in many forms and techniques, here we attempt to look through a step-by-step, Data science methodology of Extracting adequate data from relevant sources, Cleaning, Transforming and Modelling them, implementing an on-the-fly CPPI algorithm, arriving at the back test results and interactively analyse the strategy using advanced data visualization methods. In the next few sections, we discuss more on the balance between user interactivity, intuitiveness and algorithmic complexity of the CPPI calculation rather than the nitty gritty of the CPPI as a Portfolio strategy. For more details on how CPPI works and a layman example of what it is, have a look at https://www.investopedia.com/terms/c/cppi.asp. We use Python/Anaconda for Data Engineering & Algorithms, Tableau for Data visualization and the analytics extension library- TabPy \u2014 as the technological tools for the solution.", "Primary data source for our study is the NSE India website and we attempted to use web crawling to extract historical prices of the NIFTY-50 stocks. Then we found a very useful Library/API \u2018NSEPY\u2019 which does it in a more graceful manner of extracting historical prices given a stock symbol. So, we first created a list of the 50 stocks and called the NSEpy library/api (https://github.com/swapniljariwala/nsepy/tree/master/nsepy) to extract data from Jan-2018 till Jun-2020.", "Raw data extracted from NSE will look like the following:", "These data points are basically various price points on a given day for an equity. Handling daily frequency data for a portfolio analysis may be an overkill and for the sake of simplicity we will aggregate the data at a weekly level. From the daily prices, we will find the weekly price points like open, close, high and low. We should also be careful about the column headings and make sure they look clean without any spaces or special characters in between. Once you convert to weekly time series data, the data frame should like like below:", "After this weekly grouping, calculate the weekly returns which is the percentage change of price from the previous week.", "A visual representation of the above data frame should look like the following figure in Tableau or for that matter any Data visualization tools. As we can see the weekly returns were very busy during the Feb-May 2020 time frame resulting in lot of volatility.", "In this section we will see a pseudo-code of how to implement the CPPI algorithm in Python. There are basically less than a handful of steps to implement it and not complicated to implement in python.", "For a given set of time-series data of weekly returns, we need to traverse as many steps to compute and store the various indicators for each point in time.", "Initialize and setup the CPPI Parameters", "# set up the CPPI parameters", "account_value = start (start value of your investment)", "floor_value = start*floor (floor is an input parameter, typically between 0.1\u20131.0)", "Then, for each step in the time series of weekly returns, calculate the following steps", "Step2: Calculate risky weight and safe weight:", "risky_weight = m * cushion (m is an input parameter, a multiplier which basically indicates the investor\u2019s risk profile and a value standardized to fall between 0\u20131)", "where risky_weekly_return is the time series weekly return of an equity received as input and safe_weekly_return is typically calculated with an assumed risk free interest rate of a safe net product like treasury bond.", "Step4: Compute the risky wealth using a cumulative product method as for each time slot the returns need to be compounded.", "Step5: Store all the indicators in a back-test container for each time period.", "Now that we have the CPPI algorithm in place, let us pick a few stocks which returned higher annual returns and a few stocks which were highly volatile and observe the back-test results of the CPPI strategy.", "We can easily observe that volatility is not good for performance, and it is evident that high performance stocks (high annual return) have low volatility and vice-versa.", "Nestle India the top performing stock between Jan-2018 and Jun-2020 returns a terminal wealth of 1522.36 for a 1000 rupees initial investment using the CPPI strategy. If we would have invested all the 1000 rupees without any strategy, we would have ended up with 2119 rupees. Obviously, we are losing out by following a CPPI strategy when the going is good.", "But the advantage of a CPPI strategy is when a black swan occurs and when the going is not good. When we observe GAIL, which is the poorest performing stock, we will be able to appreciate the benefits of the strategy.", "As we can see, if we didn\u2019t implement the CPPI strategy and invested all our money in the risky account, we would have ended up at a terminal value of 210.4 rupees for an initial investment of 1000 rupees. It would have shattered the financial goals of the investor, isn\u2019t it?. On the contrary, if we have followed the CPPI strategy, our loss would not go below the floor value which we have set up earlier and we would have ended up with 807.62 rupees thus protecting our financial goals reducing the losses to a great extent and protecting the capital.", "There are other limitations of the CPPI strategy because of the rebalancing we must do, which in turn can increase the transaction costs which has to be factored in.", "Tableau provides an analytic extension to Python called Tabpy which is useful tool to integrate the data engineering & algorithmic tasks in python with advanced visualization ability in Tableau. One can easily deploy the python CPPI algorithm as follows in Jupyter", "client.deploy(\u2018run_cppi\u2019, run_cppi, \u2018Run a back test of the CPPIstrategy, given a set of returns for the risky asset\u2019 ,override = True)", "In Tableau the endpoint\u2019s return values are received in the form of a calculated field, as follows:", "Even though Tableau and Python are used extensively in Financial services firms, the ability to integrate them and use them to their respective strengths, provides the \u201cspeed of thought\u201d analytical ability which is not possible only with either of these tools. The analytical extension has provided data scientists to design and implement solutions which could be very useful to advise on investment strategies such as CPPI. Even though the implementation of this solution is not without hacks and workarounds, we will save it for another time to discuss.", "Coursera and EDHEC Business School for the knowledge imparted as part of the Specialization course on Investment Management with Python and Machine Learning", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc4a258943b5e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mohd.bip.rafi?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mohd.bip.rafi?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Mohammed Rafi Kaja"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8ede81c1d1db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&user=Mohammed+Rafi+Kaja&userId=8ede81c1d1db&source=post_page-8ede81c1d1db----c4a258943b5e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.investopedia.com/terms/c/cppi.asp", "anchor_text": "https://www.investopedia.com/terms/c/cppi.asp"}, {"url": "https://github.com/swapniljariwala/nsepy/tree/master/nsepy", "anchor_text": "https://github.com/swapniljariwala/nsepy/tree/master/nsepy"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&user=Mohammed+Rafi+Kaja&userId=8ede81c1d1db&source=-----c4a258943b5e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&user=Mohammed+Rafi+Kaja&userId=8ede81c1d1db&source=-----c4a258943b5e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc4a258943b5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c4a258943b5e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c4a258943b5e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c4a258943b5e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c4a258943b5e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mohd.bip.rafi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mohd.bip.rafi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mohammed Rafi Kaja"}, {"url": "https://medium.com/@mohd.bip.rafi/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "20 Followers"}, {"url": "https://www.linkedin.com/in/mrafi123/", "anchor_text": "https://www.linkedin.com/in/mrafi123/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8ede81c1d1db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&user=Mohammed+Rafi+Kaja&userId=8ede81c1d1db&source=post_page-8ede81c1d1db--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F8ede81c1d1db%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fback-test-analysis-of-nifty-50-stocks-using-ccpi-strategy-a-data-science-approach-c4a258943b5e&user=Mohammed+Rafi+Kaja&userId=8ede81c1d1db&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}