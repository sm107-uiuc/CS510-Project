{"url": "https://towardsdatascience.com/predicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c", "time": 1683012858.100626, "path": "towardsdatascience.com/predicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c/", "webpage": {"metadata": {"title": "Predicting Future Stock Market Trends with Python & Machine Learning | by Lucas Rea | Towards Data Science", "h1": "Predicting Future Stock Market Trends with Python & Machine Learning", "description": "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 0}, {"url": "https://github.com/lucasrea", "anchor_text": "https://github.com/lucasrea", "paragraph_index": 39}], "all_paragraphs": ["Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "With the recent volatility of the stock market due to the COVID-19 pandemic, I thought it was a good idea to try and utilize machine learning to predict the near-future trends of the stock market. I\u2019m fairly new to machine learning, and this is my first Medium article so I thought this would be a good project to start off with and showcase.", "This article tackles different topics concerning data science, namely; data collection and cleaning, feature engineering, as well as the creation of machine learning models to make predictions.", "Note: I previously had the look-ahead bias in my code for this article, which produced some extremely good results (suspiciously good). However they were misleading, and I now aim to try and fix that with cross-validation.", "Author\u2019s disclaimer: This project is not financial or investment advice. It is not a guarantee that it will provide the correct results most of the time. Therefore you should be very careful and not use this as a primary source of trading insight.", "You can find all the code on a jupyter notebook on my github:", "To begin, we include all of the libraries used for this project. I used the yfinance API to gather all of the historical stock market data. It\u2019s taken directly from the yahoo finance website, so it\u2019s very reliable data.", "We then define some constants that used in data retrieval and data processing. The list with the indicator symbols is useful to help use produce more features for our model.", "Here\u2019s a link where you can find the actual names of some of these features.", "Now we pull our historical data from yfinance. We don\u2019t have many features to work with \u2014 not particularly useful unless we find a way to normalize them at least or derive more features from them.", "We see that our data above is rough and contains lots of spikes for a time series. It isn\u2019t very smooth and can be difficult for the model to extract trends from. To reduce the appearance of this we want to exponentially smooth our data before we compute the technical indicators.", "We can see that the data is much more smoothed. Having many peaks and troughs can make it hard to approximate, or be difficult to extract tends when computing the technical indicators. It can throw the model off.", "Now it\u2019s time to compute our technical indicators. As stated above, I use the finta library in combination with python\u2019s built in eval function to quickly compute all the indicators in the INDICATORS list. I also compute some ema\u2019s at different average lengths in addition to a normalized volume value.", "I remove the columns like \u2018Open\u2019, \u2018High\u2019, \u2018Low\u2019, and \u2018Adj Close\u2019 because we can get a good enough approximation with our ema\u2019s in addition to the indicators. Volume has been proven to have a correlation with price fluctuations, which is why I normalized it.", "Right before we gather our predictions, I decided to keep a small bit of data to predict future values with. This line captures 5 rows corresponding to the 5 days of the week on July 27th.", "Now comes one of the most important part of this project \u2014 computing the truth values. Without these, we wouldn\u2019t even be able to train a machine learning model to make predictions.", "How do we obtain truth value? Well it\u2019s quite intuitive. If we want to know when a stock will increase or decrease (to make a million dollars hopefully!) we would just need to look into the future and observe the price to determine if we should buy or sell right now. Well, with all this historical data, that\u2019s exactly what we can do.", "Going back to the table where we initially pulled our data, if we want to know the buy (1) or sell (0) decision on the day of 1993\u201303\u201329 (where the closing price was 11.4375), we just need to look X days ahead to see if the price is higher or lower than that on 1993\u201303\u201329. So if we look 1 day ahead, we see that the price increased to 11.5. So the truth value on 1993\u201303\u201329 would be a buy (1).", "Since this is also the last step of data processing, we remove all of the NaN value that our indicators and prediction generated, as well as removing the \u2018close\u2019 column.", "Because we used Pandas\u2019 shift() function, we lose about 15 rows from the end of the dataset (which is why I captured the week of July 27th before this step).", "Right before we train our model we must split up the data into a train set and test set. However, due to the nature of time-series\u2019, we need to handle this part carefully. If we randomize our train-test set, we could encounter a look-ahead bias which is not good for predicting the stock market. It\u2019s caused when you train your model on data it would\u2019ve already seen.", "To prevent this we are going to be training the model using a different technique called cross-validation. The image below illustrates how we are going to partition our data and test the accuracy of the model.", "First, we\u2019re going to use multiple classifiers to create an ensemble model. The goal here is to combine the predictions of several models to try and improve on predictability. For each sub-model, we\u2019re also going to use a feature from Sklearn, GridSearchCV, to optimize each model for the best possible results.", "First we create the random forest model.", "And now finally we create the voting classifier", "Once we set up our models, we can put it together with the cross-validation. We start by writing some code that will allow us to iterate over our data with many evenly sized chunks.", "Printing out the indices of our dataframe, we have successfully partitioned our data like in the sliding window image.", "Now we add in the code that will split the partitions into train and test sets. It\u2019s very important to set shuffle=False in the train_test_split function \u2014it\u2019s how you avoid the look-ahead bias.", "A sample run of this looks like\u2026 the results are exaggerated.", "And then the final results gives us", "We can see that we gain slightly more accuracy by using ensemble modelling. Compared to not using cross-validation, the resulting accuracy is much less. However this is a more correct way of going about this problem\u2026 and about a 70% accuracy isn\u2019t bad either!", "For the next step we\u2019re going to predict how the S&P500 will behave with our predictive model. I\u2019m writing this article on the weekend of August 17th. So to see if this model can produce accurate results, I\u2019m going to use the closing data from this week as the \u2018truth\u2019 values for the prediction. Since this model is tuned to have a 15 day window, we need to feed in the input data with the days in the week of July 27th.", "We saved the week we\u2019re going to use in live_pred_data.", "Here are the five main days we are going to generate a prediction for. Looks like the models predicts that the price will increase for each day.", "Lets validate our prediction with the actual results.", "As we can see from the actual results, we can confirm that the model was correct in all of its predictions. However there are many factors that go into determining the stock price, so to say that the model will produce similar results every time is naive. However, during relatively normal periods of time (without major panic that causes volatility in the stock market), the model should be able to produce good results.", "To summarize what we\u2019ve done in this project,", "I\u2019ve learned a lot about data science and machine learning through this project, and I hope you did too. Being my first article, I\u2019d love any form of feedback to help improve my skills as a programmer and data scientist.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "University of Toronto | Software Engineering | AMD lucas.rea1998@gmail.com | https://github.com/lucasrea"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2bf3f1633b3c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lucas.rea1998?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucas.rea1998?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Lucas Rea"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff72d44303427&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&user=Lucas+Rea&userId=f72d44303427&source=post_page-f72d44303427----2bf3f1633b3c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://github.com/lucasrea/StockForecast", "anchor_text": "lucasrea/StockForecastYou can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or\u2026github.com"}, {"url": "https://github.com/peerchemist/finta", "anchor_text": "peerchemist/fintaCommon financial technical indicators implemented in Pandas. This is work in progress, bugs are expected and results of\u2026github.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2bf3f1633b3c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2bf3f1633b3c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----2bf3f1633b3c---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/tag/python?source=post_page-----2bf3f1633b3c---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----2bf3f1633b3c---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&user=Lucas+Rea&userId=f72d44303427&source=-----2bf3f1633b3c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&user=Lucas+Rea&userId=f72d44303427&source=-----2bf3f1633b3c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2bf3f1633b3c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2bf3f1633b3c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2bf3f1633b3c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucas.rea1998?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucas.rea1998?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lucas Rea"}, {"url": "https://medium.com/@lucas.rea1998/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "122 Followers"}, {"url": "https://github.com/lucasrea", "anchor_text": "https://github.com/lucasrea"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff72d44303427&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&user=Lucas+Rea&userId=f72d44303427&source=post_page-f72d44303427--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F73b83511cc81&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-future-stock-market-trends-with-python-machine-learning-2bf3f1633b3c&newsletterV3=f72d44303427&newsletterV3Id=73b83511cc81&user=Lucas+Rea&userId=f72d44303427&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}