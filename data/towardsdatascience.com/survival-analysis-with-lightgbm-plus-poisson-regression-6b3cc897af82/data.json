{"url": "https://towardsdatascience.com/survival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82", "time": 1683003581.962126, "path": "towardsdatascience.com/survival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82/", "webpage": {"metadata": {"title": "Survival Analysis with LightGBM plus Poisson Regression | by Marco Cerliani | Towards Data Science", "h1": "Survival Analysis with LightGBM plus Poisson Regression", "description": "Survival Analysis is often applied to address questions such as \u2018how long would it be before a particular event occurs?\u2019. Events and Time are critical variables of this kind of approach. The events\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/marklvl/bike-sharing-dataset", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://data.princeton.edu/wws509/notes/c7.pdf", "anchor_text": "Generalized Linear Models, Chapter 7, Survival Models", "paragraph_index": 17}], "all_paragraphs": ["Survival Analysis is often applied to address questions such as \u2018how long would it be before a particular event occurs?\u2019. Events and Time are critical variables of this kind of approach. The events are considered extreme situations that may occur in every moment: classical examples are churns, deaths, faults and so on. The definition of time is simple but a little bit abstract. We consider time as durations; in this sense, it\u2019s obvious that not all the \u2018extreme events\u2019 have occurred yet. We can\u2019t view all the life history due to some external circumstances, this implies considering durations as relative, i.e. starts may occur at different times.", "Traditionally, survival analysis was developed to measure lifespans of individuals. The analysis can be further applied to not just traditional births and deaths, but any duration and more\u2026 It\u2019s amazing how we can approach a classification/regression problem with survival modeling. All we need to define is the Events and Time.", "In this post, we develop a solution to predict how many daily bike rentals are registered under some kind of temporal and weather conditions. The task is in the format of a regression problem where we have to predict a count, this can also remind us a Poisson regression problem where we have to model a discrete variable. Our added value is to change the point of view switching to a survival approach, considering that Time is the number of rentals progressively \u201creach so far\u201d and the Event is the final count registered at the end of the day. To model this phenomena we\u2019ll use an adapted LightGBM estimator.", "When Time and Event are defined (i.e. we have respectively observations and targets), we have to reason about how we can reach our final scope: estimate a Survival function.", "All strat quantifying Time; it is a non-negative continuous random variable which distribution is characterized by the Probability Density Function (PDF) or the Cumulative Distribution Function (CDF).", "The Survival function (S) is a function of the time which defines the probability the death event has not occurred yet at time t, or equivalently, gives us the proportion of the population with the time to event value more than t. Mathematically, it\u2019s 1-CDF. The Hazard function (H) is the rate at which the event is taking place. Given a fixed time interval, it is a measure of risk: the greater the hazard the greater the risk of failure. Mathematically, it\u2019s -log(S).", "There are various approaches to fit survival models. In detail, we are interested in the so-called semi-parametric approach, where we try to learn the hazard function with a very elegant and straightforward trick: we assume to may subdivide time into reasonably small intervals, i.e. we are considering our baseline hazard constant in each interval. In this format, a piece-wise proportional hazards model is equivalent to a certain Poisson regression model. The fact that Survival function can be derived from the Hazard function and vice versa, is particularly useful because permits us to switch easily our target according to our interests.", "The dataset we utilize is related to the two-year historical data corresponding to years 2011 and 2012 from the Capital Bikeshare system of Washington D.C., which is publicly available here in daily and hourly format. At the moment we consider the daily data focusing our attention in predicting the count of casual users reached at the end of the day. Various predictors are available to produce forecasts like temporal or weather regressors.", "Remember that we define our Time variable as the rentals \u201creach so far\u201d and the Event as the final count registered, so a good starting point consists of plotting CDFs of Time.", "With a fixed established amount of max count reachable (4000), it\u2019s obvious that the CDFs of our train-test partition is quite different.", "Learning a Hazard function applying the semi-parametric exponential approach is quite easy with a LGBM regressor. This is possible (as introduced above) because the negative log-likelihood of the survival problem is 1-to-1 mapped with the negative log-likelihood of a Poisson regression, which is by default initialized in the LGBM library.", "All we need to do is arrange our data for this purpose. Particularly, the dataset has first to be extended: each line is duplicated in multiple lines from 0 to casual count registered which is our death Event. Then two new columns are generated:", "With our expanded dataset we are ready to start training. The fit is computed as always: our target is represented by score (a 0\u20131 variable) and our regressors are all the available external variables plus count so far, previously generated by ourselves. All the magic is made by our assumptions and by the Poisson loss. In the phase of prediction, we have to manipulate our test data as made before, expanding the input data with the creation of the count so far variable (score is unknown). To have a uniform shape of our survival functions and facilitate score evaluation, it\u2019s a good practice to expand the count so far together with other predictors, until a prefixed limit, 4000 for us. Remember also that the LGBM predicts the Hazard function, to obtain the corresponding Survival function we have to operate this simple post-process transformation: 1-exp(cumsum(H)).", "As you can see, the predicted Survival function, derived from the Hazard function, tries to replicate the true CDF built from the total count of the casual users at the end of the day. We are predicting a cumulative probability distribution for the total users count. In other words, each value we predict indicates the probability that at the end of the day the final count is less or equal that number.", "The evaluation of our results is made with a standard score for this kind of task. Continuous Ranked Probability Score (CRPS) generalizes the MAE to the case of probabilistic forecasts.", "The CPRS is one of the most widely used accuracy metrics where probabilistic forecasts are involved. It requires to evaluate the whole probability function involved, so the estimation of the whole survival curve for each daily sample is needed. In the end, we can reach 0.283 CRPS on the test, which is better than a simple model based on a dummy estimation of the test survival functions with the CDF derived from the train (0.291 CRPS).", "In this post, we develop a survival LGBM that is able to estimate the survival function given some external predictors and under some simple assumption. We solve a not classical survival problem where we have not to estimate the probability of surviving past time, but we estimate the probability that a specific event occurs at the end of the day. This is a simple example but it shows how to applicate survival modeling techniques, with classical instruments, in a not common scenario where our duty is to estimate a probability density function.", "Princeton University: Generalized Linear Models, Chapter 7, Survival Models", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6b3cc897af82&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@cerlymarco?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Marco Cerliani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc843902314c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&user=Marco+Cerliani&userId=c843902314c7&source=post_page-c843902314c7----6b3cc897af82---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@filip42?utm_source=medium&utm_medium=referral", "anchor_text": "Philippe D."}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://lifelines.readthedocs.io/en/latest/Survival%20Analysis%20intro.html", "anchor_text": "Lifelines"}, {"url": "https://www.kaggle.com/marklvl/bike-sharing-dataset", "anchor_text": "here"}, {"url": "https://github.com/cerlymarco/MEDIUM_NoteBook", "anchor_text": "CHECK MY GITHUB REPO"}, {"url": "https://www.linkedin.com/in/marco-cerliani-b0bba714b/", "anchor_text": "Linkedin"}, {"url": "https://www.kaggle.com/c/nfl-big-data-bowl-2020/discussion/119433", "anchor_text": "NFL Big Data Bowl"}, {"url": "https://lifelines.readthedocs.io/en/latest/Survival%20Analysis%20intro.html#hazard-function", "anchor_text": "Introduction to survival analysis"}, {"url": "https://data.princeton.edu/wws509/notes/c7.pdf", "anchor_text": "Generalized Linear Models, Chapter 7, Survival Models"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6b3cc897af82---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6b3cc897af82---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/survival-analysis?source=post_page-----6b3cc897af82---------------survival_analysis-----------------", "anchor_text": "Survival Analysis"}, {"url": "https://medium.com/tag/lightgbm?source=post_page-----6b3cc897af82---------------lightgbm-----------------", "anchor_text": "Lightgbm"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----6b3cc897af82---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&user=Marco+Cerliani&userId=c843902314c7&source=-----6b3cc897af82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&user=Marco+Cerliani&userId=c843902314c7&source=-----6b3cc897af82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6b3cc897af82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6b3cc897af82---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6b3cc897af82--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6b3cc897af82--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6b3cc897af82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Marco Cerliani"}, {"url": "https://medium.com/@cerlymarco/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "6K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc843902314c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&user=Marco+Cerliani&userId=c843902314c7&source=post_page-c843902314c7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe2412974851a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-with-lightgbm-plus-poisson-regression-6b3cc897af82&newsletterV3=c843902314c7&newsletterV3Id=e2412974851a&user=Marco+Cerliani&userId=c843902314c7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}