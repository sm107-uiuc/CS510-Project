{"url": "https://towardsdatascience.com/anomaly-detection-with-lstm-in-keras-8d8d7e50ab1b", "time": 1682996677.0995011, "path": "towardsdatascience.com/anomaly-detection-with-lstm-in-keras-8d8d7e50ab1b/", "webpage": {"metadata": {"title": "Anomaly Detection with LSTM in Keras | by Marco Cerliani | Towards Data Science", "h1": "Anomaly Detection with LSTM in Keras", "description": "I read \u2018anomaly\u2019 definitions in every kind of contest, everywhere. In this chaos, the only truth is the variability of this definition, i.e. anomaly explanation is completely related to the domain of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://numenta.org/", "anchor_text": "Numenta", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/deep-quantile-regression-c85481548b5a", "anchor_text": "this post", "paragraph_index": 10}, {"url": "https://towardsdatascience.com/extreme-event-forecasting-with-lstm-autoencoders-297492485037", "anchor_text": "this post", "paragraph_index": 11}], "all_paragraphs": ["I read \u2018anomaly\u2019 definitions in every kind of contest, everywhere. In this chaos, the only truth is the variability of this definition, i.e. anomaly explanation is completely related to the domain of interest.", "Detection of this kind of behavior is useful in every business and the difficultness to detect these observations depends on the field of applications. If you are engaged in a problem of anomaly detection, which involves human activities (like a prediction of sales or demand), you can take advantage of fundamental assumptions of human behaviors and plan a more efficient solution.", "This is exactly what we are doing in this post. We try to predict the Taxi demand in NYC in a critical time period. We formulate easy and important assumptions about human behaviors, which will permit us to detect an easy solution to forecast anomalies. All the dirty job is made by a loyalty LSTM, developed in Keras, which makes predictions and detection of anomalies at the same time!", "I took the dataset for our analysis from the Numenta community. In particular, I chose the NYC Taxi Dataset. This dataset shows the NYC taxi demand from 2014\u201307\u201301 to 2015\u201301\u201331 with an observation every half hour.", "In this period 5 anomalies are present, in terms of deviation from normal behavior. They occur respectively during the NYC marathon, Thanksgiving, Christmas, New Year\u2019s day, and a snowstorm.", "Our purpose is to detect these abnormal observations in advance!", "The first consideration we noticed, looking at the data, is the presence of an obvious daily pattern (during the day the demand is higher than night hours). The taxi demand seems to be driven also by a weekly trend: on certain days of the week, the taxi demand is higher than the others. We simply prove this computing autocorrelation.", "What we can do now is to take note of these important behaviors for our further analysis. I compute and store the means for every day of the weeks at every hour. This will be useful when we\u2019ll standardize the data to build our model in order to reduce every kind of temporal dependency (I compute the means for the first 5000 observations that will become our future train set).", "We need a strategy to detect outliers in advance. To do this, we decided to care about taxi demand predictions. We want to develop a model which is able to forecast demand taking into account uncertainty. One way to do this is to develop quantile regression. We focus on predictions of extreme values: lower (10th quantile), upper (90th quantile) and the classical 50th quantile. Computing also the 90th and 10th quantile we cover the most likely values the reality can assume. The width of this range can be very depth; we know that it is small when our model is sure about the future and it can be huge when our model isn\u2019t able to see important changes in the domain of interest. We took advantage of this behavior and let our model says something about outliers detection in the field of taxi demand prediction. We are expecting to get a tiny interval (90\u201310 quantile range) when our model is sure about the future because it has all under control; on the other hand, we are expecting to get an anomaly when the interval becomes bigger. This is possible because our model isn\u2019t trained to handle this kind of scenario which can result in anomaly.", "We make all this magic reality building a simple LSTM Neural Network in Keras. Our model will receive as input the past observations. We resize our data for feeding our LSTM with daily window size (48 observations: one observation for every half hour). When we were generating data, as I cited above, we operated logarithmic transformation and standardization subtracting the mean daily hour values, in order to see observation as the logarithmic variation from its daily mean hour value. We build our target variables in the same way with half-hour shifting (we want to predict the demand values for the next thirty minutes).", "Operate quantile regression in Keras is very simple (I took inspiration from this post). We easily define the custom quantile loss function which penalizes errors based on the quantile and whether the error was positive (actual > predicted) or negative (actual < predicted). Our network has 3 outputs and 3 losses, one for every quantile we try to predict.", "When dealing with Neural Network in Keras, one of the tedious problems is the uncertainty of results due to the internal weights initialization. With its formulation, our problem seems to particularly suffer from this kind of problem; i.e. computing quantile predictions we can\u2019t permit quantiles overlapping, this not make sense! To avoid this pitfall I make use of bootstrapping in prediction phase: I reactivate dropout of my network (trainable: true in the model), iterate prediction for 100 times, store them and finally calculate the desired quantiles (I make use of this clever technique also in this post).", "This process is graphically explained below with a little focus on a subset of predictions. Given quantile bootstraps, we calculated summary measures (red lines) of them, avoiding crossover.", "As I previously cited, I used the first 5000 observations for training and the remaining (around 5000) for testing.", "Our model reaches a great performance forecasting taxi demand with the 50th quantile. Around 0.055 Mean Squared Log Error is a brilliant result! This means that the LSTM Network is able to understand the underlying rules that drive taxi demand. So our approach for anomaly detection sounds great\u2026 We computed the difference among the 90th quantile predictions and 10th quantile predictions and see what\u2019s happened.", "The quantile interval range (blue dots) is higher in a period of uncertainty. In other cases, the model tends to generalize well, as we expected. Going deeper, we start to investigate about these periods of high uncertainty. We noticed that these coincide with our initial assumptions. The orange circles plotted below are respectively: NYC marathon, Thanksgiving, Christmas, New Year\u2019s day, and a snowstorm.", "We can conclude that we reach our initial targets: achieve a great forecasting power and exploit the strength of our model to identification uncertainty. We also make use of this to say something about anomalies detection.", "In this post, I reproduce a good solution for anomaly detection and forecasting. We make use of a LSTM Network to learn the behavior of taxi demand in NYC. We utilized what we learned to make predictions and estimate uncertainty at the same time. We implicitly define an anomaly as an unpredictable observation \u2014 i.e. with a great amount of uncertainty. This simple assumption permits our LSTM to make all the work for us.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8d8d7e50ab1b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@cerlymarco?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Marco Cerliani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc843902314c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&user=Marco+Cerliani&userId=c843902314c7&source=post_page-c843902314c7----8d8d7e50ab1b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@scott_umstattd?utm_source=medium&utm_medium=referral", "anchor_text": "Scott Umstattd"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://numenta.org/", "anchor_text": "Numenta"}, {"url": "https://towardsdatascience.com/deep-quantile-regression-c85481548b5a", "anchor_text": "this post"}, {"url": "https://towardsdatascience.com/extreme-event-forecasting-with-lstm-autoencoders-297492485037", "anchor_text": "this post"}, {"url": "https://github.com/cerlymarco/MEDIUM_NoteBook", "anchor_text": "CHECK MY GITHUB REPO"}, {"url": "https://www.linkedin.com/in/marco-cerliani-b0bba714b/", "anchor_text": "Linkedin"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8d8d7e50ab1b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8d8d7e50ab1b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/anomaly-detection?source=post_page-----8d8d7e50ab1b---------------anomaly_detection-----------------", "anchor_text": "Anomaly Detection"}, {"url": "https://medium.com/tag/lstm?source=post_page-----8d8d7e50ab1b---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----8d8d7e50ab1b---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&user=Marco+Cerliani&userId=c843902314c7&source=-----8d8d7e50ab1b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&user=Marco+Cerliani&userId=c843902314c7&source=-----8d8d7e50ab1b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8d8d7e50ab1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8d8d7e50ab1b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8d8d7e50ab1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cerlymarco?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Marco Cerliani"}, {"url": "https://medium.com/@cerlymarco/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "6K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc843902314c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&user=Marco+Cerliani&userId=c843902314c7&source=post_page-c843902314c7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe2412974851a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-with-lstm-in-keras-8d8d7e50ab1b&newsletterV3=c843902314c7&newsletterV3Id=e2412974851a&user=Marco+Cerliani&userId=c843902314c7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}