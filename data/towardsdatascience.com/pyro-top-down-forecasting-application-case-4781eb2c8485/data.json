{"url": "https://towardsdatascience.com/pyro-top-down-forecasting-application-case-4781eb2c8485", "time": 1683008849.379221, "path": "towardsdatascience.com/pyro-top-down-forecasting-application-case-4781eb2c8485/", "webpage": {"metadata": {"title": "Pyro Top-Down Forecasting | Application-case | by Richard Michael | Towards Data Science", "h1": "Pyro Top-Down Forecasting | Application-case", "description": "Have you ever wondered how to account for uncertainties in time-series forecasts? Have you ever thought there should be a way to generate data-points from previously seen data and make judgement\u2026"}, "outgoing_paragraph_urls": [{"url": "https://pyro.ai/", "anchor_text": "Pyro", "paragraph_index": 0}, {"url": "http://laplaceml.com/ngboost-incremental-forecasting/", "anchor_text": "previous article", "paragraph_index": 0}, {"url": "https://www.kaggle.com/headsortails/back-to-predict-the-future-interactive-m5-eda", "anchor_text": "amazing notebook", "paragraph_index": 0}, {"url": "http://docs.pyro.ai/en/stable/contrib.forecast.html", "anchor_text": "ForecastingModel", "paragraph_index": 2}, {"url": "http://docs.pyro.ai/en/0.3.0-release/_modules/pyro/primitives.html#plate", "anchor_text": "the plate", "paragraph_index": 7}, {"url": "https://pyro.ai/examples/svi_part_ii.html", "anchor_text": "Pyro SVI tutorials", "paragraph_index": 7}, {"url": "http://pyro.ai/examples/forecasting_i.html", "anchor_text": "here", "paragraph_index": 10}, {"url": "http://docs.pyro.ai/en/0.2.1-release/inference_algos.html", "anchor_text": "SVI", "paragraph_index": 12}, {"url": "https://pyro.ai/examples/svi_part_iii.html", "anchor_text": "ELBO", "paragraph_index": 12}, {"url": "http://jmlr.org/papers/v14/hoffman13a.html", "anchor_text": "[3]", "paragraph_index": 12}, {"url": "https://github.com/pyro-ppl/Pyro-M5-Starter-Kit", "anchor_text": "M5 Starter Kit implementation found on github", "paragraph_index": 13}, {"url": "http://docs.pyro.ai/en/stable/optimization.html#pyro.optim.optim.DCTAdam", "anchor_text": "DCTAdam", "paragraph_index": 14}, {"url": "http://docs.pyro.ai/en/stable/contrib.forecast.html", "anchor_text": "[4]", "paragraph_index": 15}, {"url": "http://M.Sc", "anchor_text": "M.Sc", "paragraph_index": 21}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog", "paragraph_index": 21}], "all_paragraphs": ["Have you ever wondered how to account for uncertainties in time-series forecasts?Have you ever thought there should be a way to generate data-points from previously seen data and make judgement calls about certainties? I know I have.If you want to build models that capture probabilities and hold confidences we recommend using a probabilistic programming framework like Pyro.In a previous article we have looked at NGBoosting and have applied it to the M5 forecasting challenge on Kaggle. As a quick recap \u2014 the M5 forecasting challenge asks us to predict how the sales of Walmart items will develop over time. It provides around 4\u20135 years of data for items of different categories from different stores across different states and asks us to forecast 28 days that we have no information about. As an overview over the challenge and data-set we still recommend this amazing notebook. Last time we concluded, that we got better results with Pyro and here is a simple walk-through of how we got there.", "There are different approaches to modeling and forecasting data over time. There are top-down models, state-space models and hierarchical models \u2014 to name a selected few.In this article we see how a prediction can be done through a very rough and rudimentary top-down model. We make thorough use of the existing Forecaster object in Pyro. We just tell the model how to make an informed prediction. After that we dump all the data into it. That\u2019s it \u2014 simple enough! No fancy priors, no fancy underlying distribution-assumptions, just data and a probabilistic framework. Some assumptions we still have to make and we will walk you through this.", "In the end, we dump all our time-series information that we have into the model, which is sales over time, while preserving a sale as an independent random event. We don\u2019t use anything else. The Pyro programming framework, specifically the ForecastingModel, is the roaring engine to our model we also need a driver.The element that drives our model in the right direction is this:", "This simple line of code combines Pyro objects from which we sample over time. Now, lets look at what all those parts mean:", "The actual model part is captured by the regressor. This piece looks for proper model-weights and throws them against the features which come directly from the data-input. Each weight lies on a classical Gaussian curve. This means we sample from a normal distribution centered around zero with a standard deviation of 1 (\u03bc=0, \u03c3\u00b2=1).", "The second parameter is the trend. We consult our probabilistic looking-glass and then decide it should come from a Log-Normal distribution, such that l\u223cLN with \u03bc=-2 and \u03c3\u00b2=1. A key element is that we account for the time-feature that we provide the model with.", "Now what is a trend without a season? Trends come and go, but the seasons are what we can count on. We know that the underlying data describes purchases over time. We think that a change in sales is captured by what day it is during the week. Therefore we say", "Here we make use of another neat Pyro object: the plate. This construct is used to model independence of random events. By this we mean that we are making an observation of an instance occurring. This observation comes from each time-step of our data. A thorough explanation can be found in the Pyro SVI tutorials. For our simple purposes we break it down and say that we think that the data rises and falls within a seven day window. We translate this to independently sampled events. Last but not least there is not just one seven day interval, but we periodically repeat this over all of our given time-input aka. our duration is the size of our time-tensor.", "Lastly, every professional ML-model needs some trainable parameter that accounts for the fact that sometimes things are just not as nice as you expect them to be \u2014 we call this a bias. We decide for our bias (b) that it comes from a normal distribution, such that b\u223cN where \u03bc=0 and \u03c3\u00b2=10 or loc=0 and scale=10 if you want to talk Pyro.", "Let\u2019s take a look at the distributions of our parameters \u2013 before we continue.", "You, the attentive reader, might conclude at this point. You have everything you need and we agree. What we now have is sufficient to give us an estimate and make projections for a couple of days into the future.We can make it better though. What we are predicting so far, is a really stiff expression. The model is told to fit the input but we don\u2019t allow for leeway.Let\u2019s assume, for the sake of argument, that all people in California decide they rather go shopping on a Thursday afternoon instead of a Saturday; or a crisis occurs and everybody goes to prepare for the apocalypse. Our model might have correctly predicted all previous Saturdays, but that one Thursday really throws it off. To account for that we introduce something called reparameterization. For an extensive overview of this topic see [2].To make it even more robust we do a reparameterization through another reparameterization \u2014 why we do this is explained here.Packing everything together we get a drift which defines the motion of our model. This translates to Pyro as such:", "Now we have all we need for our model to work.", "For the actual model-fitting part we use Pyro\u2019s Stochastic Variational Inference engine or SVI . This algorithm allows us to efficiently compute our posterior distribution in a reasonable amount of time. In our case this is done to maximize the Evidence Lower Bound or ELBO. One simplified way to think about ELBO is to observe two different distributions, a current one and a previous one. If the distributions are wildly different we get a low ELBO value. On the other hand if I have fitted a good distribution my next one might be just as nice, aligns well with the already observed one and I get a high ELBO value. Some might even say that the divergence of both distributions is minimized . To read about it in detail we refer to the original paper for SVI (see [3]). For now lets assume this just works because smart researchers have implemented it sufficiently.", "Now that we have put together a working model, have selected our algorithm to compute our posterior distributions, we have to set the hyper-parameters, load the data and start training. For data-handling we extensively attend to the M5 Starter Kit implementation found on github, which the Pyro PPL team provides generously. This is an easy way to get the aggregates over e.g. the sales data. Feel free to implement this yourself. Its a sure way to learn your way around tensors. For our beginner model we only care about the sales data over time.We now set our parameters and instantiate the forecaster as follows:", "In the above code we fit the forecaster which under the hood uses a DCTAdam optimizer. We provide the covariates for the training and withhold 28 days, which we use for the actual forecast in the line below. The actual prediction is then the mean across the samples, but lets not get ahead of ourselves here. When we run the above codes and have implemented our model correctly we should get the following output \u2014 the actual training:", "We see that our loss decreases. This is good and tells us that the computed distributions from our prediction gets better over time. The loss here is a quotient of the negative ELBO with respect to the data and part of the Forecaster documentation (see [4]).", "We now hold a final model in our memory. We can compute losses with it, throw it against new data, poke it and see what it generates.For example, we can sample sales over time as you can see in the image below:", "To compute the confidence of the individual steps we ask our model for 100 samples and compute quantiles (0.1 and 0.9) for those samples. This is the red area that you can see in Fig. 2 . Since this model is at your disposal you can ask for more samples if you want to make it more exact. The sales in the figure are aggregated logged-values for better model-fitting. To get values in a more realistic range transform the values using numpy\u2019s exp.", "We have shown how you can build a Pyro model and use the Forecaster implementation. You can use the facts that you know about the problem to set the model parameters and find appropriate distributions. A lot of functionality comes with Pyro. One of which is SVI, an algorithm to compute the posterior, which makes the model-training possible in the first-place. After we have fitted our model we can sample from it, forecast data-points and compute confidence-intervals on our predictions.All in all, probabilistic programming and frameworks like Pyro offer a powerful tool-set to use when handling uncertainties and modeling real-world data.", "A big thanks to the Pyro documentation and the development team. The comprehensive writing on the topics and the implementations on GitHub really enable Pyro users to hit the ground running. Our model was a wild experimental mix-up of different models available and we tested what parts work well together.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a Data Scientist and M.Sc. student in Bioinformatics at the University of Copenhagen. You can find more content on my weekly blog http://laplaceml.com/blog"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4781eb2c8485&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rcml.medium.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59----4781eb2c8485---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pyro.ai/", "anchor_text": "Pyro"}, {"url": "http://laplaceml.com/ngboost-incremental-forecasting/", "anchor_text": "previous article"}, {"url": "https://www.kaggle.com/headsortails/back-to-predict-the-future-interactive-m5-eda", "anchor_text": "amazing notebook"}, {"url": "http://docs.pyro.ai/en/stable/contrib.forecast.html", "anchor_text": "ForecastingModel"}, {"url": "http://docs.pyro.ai/en/0.3.0-release/_modules/pyro/primitives.html#plate", "anchor_text": "the plate"}, {"url": "https://pyro.ai/examples/svi_part_ii.html", "anchor_text": "Pyro SVI tutorials"}, {"url": "http://pyro.ai/examples/forecasting_i.html", "anchor_text": "here"}, {"url": "http://docs.pyro.ai/en/0.2.1-release/inference_algos.html", "anchor_text": "SVI"}, {"url": "https://pyro.ai/examples/svi_part_iii.html", "anchor_text": "ELBO"}, {"url": "http://jmlr.org/papers/v14/hoffman13a.html", "anchor_text": "[3]"}, {"url": "https://github.com/pyro-ppl/Pyro-M5-Starter-Kit", "anchor_text": "M5 Starter Kit implementation found on github"}, {"url": "http://docs.pyro.ai/en/stable/optimization.html#pyro.optim.optim.DCTAdam", "anchor_text": "DCTAdam"}, {"url": "http://docs.pyro.ai/en/stable/contrib.forecast.html", "anchor_text": "[4]"}, {"url": "http://pyro.ai/examples/forecasting_i.html", "anchor_text": "I"}, {"url": "https://pyro.ai/examples/forecasting_ii.html", "anchor_text": "II"}, {"url": "http://pyro.ai/examples/forecasting_iii.html", "anchor_text": "III"}, {"url": "https://arxiv.org/pdf/1906.03028.pdf", "anchor_text": "ArXiv"}, {"url": "http://jmlr.org/papers/v14/hoffman13a.html", "anchor_text": "JMLR"}, {"url": "http://docs.pyro.ai/en/stable/contrib.forecast.html", "anchor_text": "Documentation"}, {"url": "https://medium.com/tag/pyro?source=post_page-----4781eb2c8485---------------pyro-----------------", "anchor_text": "Pyro"}, {"url": "https://medium.com/tag/forecasting?source=post_page-----4781eb2c8485---------------forecasting-----------------", "anchor_text": "Forecasting"}, {"url": "https://medium.com/tag/probabilistic-programming?source=post_page-----4781eb2c8485---------------probabilistic_programming-----------------", "anchor_text": "Probabilistic Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4781eb2c8485---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/timeseries?source=post_page-----4781eb2c8485---------------timeseries-----------------", "anchor_text": "Timeseries"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&user=Richard+Michael&userId=7229c4f1db59&source=-----4781eb2c8485---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&user=Richard+Michael&userId=7229c4f1db59&source=-----4781eb2c8485---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4781eb2c8485&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4781eb2c8485---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4781eb2c8485--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4781eb2c8485--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4781eb2c8485--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://rcml.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "72 Followers"}, {"url": "http://M.Sc", "anchor_text": "M.Sc"}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7c745d7317a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpyro-top-down-forecasting-application-case-4781eb2c8485&newsletterV3=7229c4f1db59&newsletterV3Id=7c745d7317a0&user=Richard+Michael&userId=7229c4f1db59&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}