{"url": "https://towardsdatascience.com/asyncio-is-not-parallelism-70bfed470489", "time": 1683009140.8336372, "path": "towardsdatascience.com/asyncio-is-not-parallelism-70bfed470489/", "webpage": {"metadata": {"title": "Asyncio Is Not Parallelism. You may have heard that Python asyncio\u2026 | by Peter Xie | Towards Data Science", "h1": "Asyncio Is Not Parallelism", "description": "Async function say_after is an example from Python official documentation. It prints something \u2018what\u2019 after sleeping \u2018delay\u2019 seconds. In the main function, we create two tasks of say_after, one says\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.python.org/3/library/asyncio-task.html#coroutine", "anchor_text": "coroutine", "paragraph_index": 5}, {"url": "https://docs.python.org/3/library/asyncio-eventloop.html", "anchor_text": "event loop", "paragraph_index": 7}, {"url": "https://gist.github.com/b201298268727826d39db2710e8d2e5e", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://docs.python.org/3/library/threading.html", "anchor_text": "Threading", "paragraph_index": 22}, {"url": "https://docs.python.org/3.7/library/multiprocessing.html", "anchor_text": "multiprocessing", "paragraph_index": 26}], "all_paragraphs": ["Let\u2019s start with a perfect concurrent example #1.", "Async function say_after is an example from Python official documentation. It prints something \u2018what\u2019 after sleeping \u2018delay\u2019 seconds.", "In the main function, we create two tasks of say_after, one says \u2018hello\u2019 after 1 second and the other say \u2018world\u2019 after 2 seconds. Run it and we see it takes 2 seconds in total because both tasks run concurrently. Perfect!", "But are they parallel? Let\u2019s play around with more examples to understand the difference between concurrency and parallelism.", "We replace the main function as follows.", "As you can see, we add a print after creating tasks to check if tasks start immediately after creation, and add an async sleep 0.5 seconds after that in the main function. Note that main itself is a task (coroutine exactly).", "First, it still takes 2 seconds in total, no change. It runs main and other two say_after tasks concurrently. The async sleep in the main is not blocking.", "Second, \u201cBefore delay \u2014 after creating tasks\u201d is printed before starting say_after tasks. Yes! Created tasks do not start immediately after creation, instead, it is scheduled to run in a so-called event loop. They start only when the main task is waiting, i.e. await asyncio.sleep(0.5) in this case. And to my understanding, you cannot control the sequence of execution, i.e. priorities, of the tasks.", "In this example, we replace the asyncio.sleep with time.sleep which waits with blocking in main, and see when say_after tasks start.", "See that the total is now 2.5 seconds. And task1 starts 0.5 second after it is created. It is clear that tasks are not parallel, i.e. execute at the same time.", "You may argue that asyncio.sleep should be used instead of time.sleep with asyncio programming. How about the main task is doing something and causes the delay?", "In this example we replace time.sleep with a loop to add about 1 second delay in the main task.", "You see that we got a similar result. say_after tasks are delayed to start and the total time becomes 3 seconds.", "If a task starts, does it guarantee it ends in expected time? No!Let\u2019s see this example below.", "We have asyncio.sleep(0.1) in line #7 to allow task1 and task2 to start, but add time.sleep(3) in line #8 to block for 3 seconds afterwards.Here is the output:", "You see both tasks start immediately in line #3 and #4, but do not \u2018say\u2019 after the expected 1 seconds or 2 seconds, instead \u2018say\u2019 (end) after 3 seconds.", "The reason is that when say_after is awaiting for 1 / 2 seconds, the event loop goes back to main task and blocks there for 3 seconds before it can loop back to say_after tasks to continue.", "You can find the full demo file here.", "Asynicio tries the best to be concurrent but it is not parallel.", "You cannot control the start nor the end of a task.", "You may control the start if you await the task immediately after it is created as follows, but it becomes synchronous programming then, which makes no sense for asynchronous purpose. Note even that is not 100 percent guaranteed and think yourself.", "So if you are developing a timing-sensitive app, avoid using asyncio (coroutine event loop broadly). The cause of this limitation is that the event loop uses only one thread to schedule multiple tasks.", "So what\u2019s the solution for parallelism? Threading.", "This is the equivalent code for example #5 which has 3 seconds blocking sleep in the main function.", "And the output is as follows.", "See that both task1 and task2 start immediately and ends in expected 1 and 2 seconds.", "You can use multiprocessing as well to make use of multiple CPU cores.", "Lastly, I am not saying you should not use the event loop, which is great in handling network volumes. But it depends on your need.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Code Simple | Python and AI Enthusiast | peter.jp.xie@gmail.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F70bfed470489&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://peter-jp-xie.medium.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": ""}, {"url": "https://peter-jp-xie.medium.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Peter Xie"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff2ed0f8e5472&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&user=Peter+Xie&userId=f2ed0f8e5472&source=post_page-f2ed0f8e5472----70bfed470489---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.python.org/3/library/asyncio.html", "anchor_text": "asyncio"}, {"url": "https://docs.python.org/3/library/asyncio-task.html#coroutine", "anchor_text": "coroutine"}, {"url": "https://docs.python.org/3/library/asyncio-eventloop.html", "anchor_text": "event loop"}, {"url": "https://gist.github.com/b201298268727826d39db2710e8d2e5e", "anchor_text": "here"}, {"url": "https://docs.python.org/3/library/threading.html", "anchor_text": "Threading"}, {"url": "https://docs.python.org/3.7/library/multiprocessing.html", "anchor_text": "multiprocessing"}, {"url": "https://www.linkedin.com/in/xiejiping/", "anchor_text": "Linkedin"}, {"url": "https://medium.com/tag/python?source=post_page-----70bfed470489---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/asyncio?source=post_page-----70bfed470489---------------asyncio-----------------", "anchor_text": "Asyncio"}, {"url": "https://medium.com/tag/asynchronous?source=post_page-----70bfed470489---------------asynchronous-----------------", "anchor_text": "Asynchronous"}, {"url": "https://medium.com/tag/programming?source=post_page-----70bfed470489---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----70bfed470489---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&user=Peter+Xie&userId=f2ed0f8e5472&source=-----70bfed470489---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&user=Peter+Xie&userId=f2ed0f8e5472&source=-----70bfed470489---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F70bfed470489&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----70bfed470489---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----70bfed470489--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----70bfed470489--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----70bfed470489--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----70bfed470489--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----70bfed470489--------------------------------", "anchor_text": ""}, {"url": "https://peter-jp-xie.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://peter-jp-xie.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Peter Xie"}, {"url": "https://peter-jp-xie.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "226 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff2ed0f8e5472&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&user=Peter+Xie&userId=f2ed0f8e5472&source=post_page-f2ed0f8e5472--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbb5ccaf525bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fasyncio-is-not-parallelism-70bfed470489&newsletterV3=f2ed0f8e5472&newsletterV3Id=bb5ccaf525bc&user=Peter+Xie&userId=f2ed0f8e5472&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}