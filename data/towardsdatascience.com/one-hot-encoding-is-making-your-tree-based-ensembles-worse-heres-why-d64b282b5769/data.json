{"url": "https://towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769", "time": 1682994603.518772, "path": "towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769/", "webpage": {"metadata": {"title": "One-Hot Encoding is making your Tree-Based Ensembles worse, here\u2019s why? | by Rakesh Ravi | Towards Data Science", "h1": "One-Hot Encoding is making your Tree-Based Ensembles worse, here\u2019s why?", "description": "Most real-world datasets are a mix of categorical and continuous variables. While continuous variables fit into all machine learning models quite easily, the implementation of categorical variables\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/kobe-bryant-shot-selection", "anchor_text": "shot selection data", "paragraph_index": 2}, {"url": "http://www.r2d3.us/visual-intro-to-machine-learning-part-1/", "anchor_text": "grasp", "paragraph_index": 5}], "all_paragraphs": ["I am a Master\u2019s Student in Data Science at the University of Virginia and I am working on lots of Machine Learning Projects. Every week, I will be addressing one problem that I faced when working on a project along with a practical solution.", "Most real-world datasets are a mix of categorical and continuous variables. While continuous variables fit into all machine learning models quite easily, the implementation of categorical variables is vastly different in different models and different programming languages. For instance, R deals with categories using a variable type called factor which elegantly fits all models without an issue and Python would require you to convert the categories into label encoding for the models to work. Python is my choice of programming language and I routinely perform some sort of encoding for categorical variables. In general, one hot encoding provides better resolution of the data for the model and most models end up performing better. It turns out this is not true for all models and to my surprise, random forest performed consistently worse for datasets with high cardinality categorical variables.", "Being a Kobe Bryant fan, I decided to use his shot selection data to build a model to predict whether a shot given the circumstances would land in or not. Based on feature importance analysis, it was clear that the two variables describing the type of shot were the most important in predicting the outcome of a given shot and both variables were categorical. I ran random forest on the dataset with label encoding (assuming that there was an order) and with one-hot encoding and the outcome was nearly the same thing. In fact, it didnt seem to matter whether there was any order.", "In addition to accuracy of prediction, I have also used the logarithmic loss of the model for comparison as that was the evaluation criteria for the Kaggle competition.", "We would normally expect one-hot encoding to improve the model but as the screenshot suggests, the model with one-hot encoding performing significantly worse than the model without it. One-hot encoding contributed to a decrease of 0.157 units of logarithmic loss. Kaggle competition winners are decided in slightest of margins and an offset of 0.05 could be the difference between being in the top 75% and top 25% on the leaderboard. Now that we have established one-hot encoding is making the models worse, let\u2019s examine the reasons behind why this happens.", "To understand this, let\u2019s get into the inner dynamics of tree-bases models. For every tree-based algorithm, there is a sub-algorithm that is used to split the dataset into two bins based on a feature and a value. The splitting algorithm considers all possible splits (based on all features and all possibles values for each feature) and finds the most optimum split based on a criterion. We will not get into details of the criterion (there are multiple ways to do this) but qualitatively speaking, the criterion helps the sub-algorithm select the split that minimizes the impurity of bins. Purity is a proxy for the number of positive or negative samples in a particular bin in a classification problem. I found a very useful visualization that can helped me grasp this concept.", "If a continuous variable is chosen for a split, then there would be a number of choices of values on which a tree can split and in most cases, the tree can grow in both directions. The resulting tree from a dataset containing a majority of continuous variables that would look like something in the figure to the left.", "Categorical variables are naturally disadvantaged in this case and have only a few options for splitting which results in very sparse decision trees. The situation gets worse in variables that have a small number of levels and one-hot encoding falls in this category with just two levels. The trees generally tend to grow in one direction because at every split of a categorical variable there are only two values (0 or 1). The tree grows in the direction of zeroes in the dummy variables. If that didn\u2019t make sense, follow the example below closely.", "For instance, consider the following dataset which contains dummy variables forcategorical variables that have levels A, B, C and D. If we were to fit a decision tree to this data just to understand the splits, it would resemble the following.", "In conclusion, if we have a categorical variable with q levels, the tree has to choose from ((2^q/2)-1) splits. For a dummy variable, there is only one possible split and this induces sparsity.", "Now that we have understood why the decision trees for datasets with dummy variable look like the above figure, we can delve into understanding how this affects prediction accuracy and other performance metrics.", "One way to verify this is to check the feature importance for both models and see which features come out on top.", "In spite of delivering better performance, the tree based models have a slightly tarnished reputation primarily because of its interpretability which arises due to the way in which the feature importance is calculated. Feature importance in most tree-ensembles is calculated based an importance score. The importance score is a measure of how often the feature was selected for splitting and how much gain in purity was achieved as a result of the selection.", "The most important feature is the action_type which is a high cardinality categorical variable and clearly much more important than the ones preceding it. To provide some context, I had one-hot encoded action_type and combined_shot_type which were both high cardinality categorical variable. Obviously, dummy variables increase the dimensionality of the dataset and the curse of dimensionality comes into play and produces the chart below for feature importance. This is clearly not interpretable.", "To take a magnified view, I decided to look at the top 15 features which seemed to influence the prediction the most.", "When we examine the chart above, it\u2019s clear that only one dummy variable is featured in the top 15 and that too in the 14th position which validates our hypothesis of variable selection for splitting. One-hot encoding has also obscured the order of importance of features that weren\u2019t involved in the encoding and this makes the model inefficient.", "TLDR One-hot encoding categorical variables with high cardinality can cause inefficiency in tree-based ensembles. Continuous variables will be given more importance than the dummy variables by the algorithm which will obscure the order of feature importance resulting in poorer performance.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Enthusiast, Tennis Player and Traveller"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd64b282b5769&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d64b282b5769--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@rakeshravi_14055?source=post_page-----d64b282b5769--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rakeshravi_14055?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Rakesh Ravi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F77f5576baa39&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&user=Rakesh+Ravi&userId=77f5576baa39&source=post_page-77f5576baa39----d64b282b5769---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@maritafox?utm_source=medium&utm_medium=referral", "anchor_text": "Marita Kavelashvili"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/c/kobe-bryant-shot-selection", "anchor_text": "shot selection data"}, {"url": "http://www.r2d3.us/visual-intro-to-machine-learning-part-1/", "anchor_text": "grasp"}, {"url": "https://github.com/rakeshravidata/Kobe-Shot-Selection-Prediction-", "anchor_text": "Link to Github"}, {"url": "http://www.r2d3.us/visual-intro-to-machine-learning-part-1/", "anchor_text": "http://www.r2d3.us/visual-intro-to-machine-learning-part-1/"}, {"url": "https://web.stanford.edu/~hastie/ElemStatLearn//", "anchor_text": "https://web.stanford.edu/~hastie/ElemStatLearn//"}, {"url": "https://www.kaggle.com/c/zillow-prize-1/discussion/38793", "anchor_text": "https://www.kaggle.com/c/zillow-prize-1/discussion/38793"}, {"url": "https://medium.com/data-design/visiting-categorical-features-and-encoding-in-decision-trees-53400fa65931", "anchor_text": "https://medium.com/data-design/visiting-categorical-features-and-encoding-in-decision-trees-53400fa65931"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d64b282b5769---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d64b282b5769---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/computer-science?source=post_page-----d64b282b5769---------------computer_science-----------------", "anchor_text": "Computer Science"}, {"url": "https://medium.com/tag/kaggle?source=post_page-----d64b282b5769---------------kaggle-----------------", "anchor_text": "Kaggle"}, {"url": "https://medium.com/tag/random-forest?source=post_page-----d64b282b5769---------------random_forest-----------------", "anchor_text": "Random Forest"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&user=Rakesh+Ravi&userId=77f5576baa39&source=-----d64b282b5769---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&user=Rakesh+Ravi&userId=77f5576baa39&source=-----d64b282b5769---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd64b282b5769&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d64b282b5769---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d64b282b5769--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d64b282b5769--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d64b282b5769--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d64b282b5769--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d64b282b5769--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rakeshravi_14055?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rakeshravi_14055?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rakesh Ravi"}, {"url": "https://medium.com/@rakeshravi_14055/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "290 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F77f5576baa39&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&user=Rakesh+Ravi&userId=77f5576baa39&source=post_page-77f5576baa39--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd30cecc44bdf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fone-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769&newsletterV3=77f5576baa39&newsletterV3Id=d30cecc44bdf&user=Rakesh+Ravi&userId=77f5576baa39&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}