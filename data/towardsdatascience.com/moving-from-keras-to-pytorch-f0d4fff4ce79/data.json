{"url": "https://towardsdatascience.com/moving-from-keras-to-pytorch-f0d4fff4ce79", "time": 1682996432.693353, "path": "towardsdatascience.com/moving-from-keras-to-pytorch-f0d4fff4ce79/", "webpage": {"metadata": {"title": "Moving from Keras to Pytorch. Why? How? It's not that difficult. | by Rahul Agarwal | Towards Data Science", "h1": "Moving from Keras to Pytorch", "description": "A while back, I was working with a competition on Kaggle on text classification, and as a part of the competition, I had to somehow move to Pytorch to get deterministic results. Results that don\u2019t\u2026"}, "outgoing_paragraph_urls": [{"url": "https://amzn.to/2LxRTe6", "anchor_text": "Pytorch", "paragraph_index": 3}, {"url": "https://coursera.pxf.io/7mKnnY", "anchor_text": "Sequence modelling", "paragraph_index": 4}, {"url": "https://coursera.pxf.io/7mKnnY", "anchor_text": "Deep Learning Specialization", "paragraph_index": 4}, {"url": "https://mlwhiz.com/blog/2018/12/17/text_classification/", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://www.kaggle.com/mlwhiz/third-place-model-for-toxic-comments-in-pytorch", "anchor_text": "Kaggle Kernel", "paragraph_index": 38}, {"url": "https://www.kaggle.com/mlwhiz/third-place-model-for-toxic-comments-in-pytorch", "anchor_text": "You can see the code here and include it in your projects.", "paragraph_index": 38}, {"url": "https://coursera.pxf.io/5bDx3b", "anchor_text": "Advanced Machine Learning on Google Cloud Specialization", "paragraph_index": 39}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium", "paragraph_index": 40}, {"url": "https://mlwhiz.ck.page/a9b8bda70c", "anchor_text": "blog", "paragraph_index": 40}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz", "paragraph_index": 40}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 42}], "all_paragraphs": ["Pytorch is great. But it doesn\u2019t make things easy for a beginner.", "A while back, I was working with a competition on Kaggle on text classification, and as a part of the competition, I had to somehow move to Pytorch to get deterministic results. Results that don\u2019t change with every run of the network to try out different models and have consistent results.", "Now I have always worked with Keras in the past and it has given me pretty good results, but somehow I got to know that the CuDNNGRU/CuDNNLSTM layers in keras are not deterministic, even after setting the seeds.", "So Pytorch did come to rescue. And I am glad that I considered moving.", "As a side note: if you want to know more about NLP, I would like to recommend this awesome course on Sequence modelling in the Deep Learning Specialization. This course covers a wide range of tasks in Natural Language Processing from basic to advanced: Sentiment Analysis, summarization, dialogue state tracking, to name a few.", "While Keras is great to start with deep learning, with time you are going to resent some of its limitations.", "I also thought about moving to Tensorflow. It seemed like a good transition as TF is the backend of Keras.", "With the whole session.run commands and tensorflow sessions, I was sort of confused. It was not Pythonic at all.", "Pytorch helps in that since it is much more Pythonic. You have things under your control and you are not losing anything on the performance front. Maybe gaining actually.", "In the words of Andrej Karpathy:", "I\u2019ve been using PyTorch a few months now and I\u2019ve never felt better. I have more energy. My skin is clearer. My eye sight has improved.", "So without further ado let me translate Keras to Pytorch for you.", "Let us create an example network in keras first which we will try to port into Pytorch.", "Here I would like to give a piece of advice too. When you try to move from Keras to Pytorch take any network you have and try porting it to Pytorch. It will make you understand Pytorch in a much better way.", "Here I am trying to write one of the networks that gave pretty good results in the Quora Insincere questions classification challenge for me.", "This model has all the bells and whistles which at least any Text Classification deep learning network could contain with its GRU, LSTM and embedding layers and also a meta input layer. And thus would serve as a good example.", "Also if you want to read up more on how the BiLSTM/GRU and Attention model work do visit my post here.", "So a model in pytorch is defined as a class(therefore a little more classy) which inherits from nn.module . Every class necessarily contains an __init__ procedure block and a block for the forward pass.", "I found it beneficial due to a these reasons:", "1) It gives you a lot of control over how your network is built.", "2) You understand a lot about the network when you are building it since you have to specify input and output dimensions. So fewer chances of error. (Although this one is really up to the skill level)", "3) Easy to debug networks. Any time you find any problem with the network just use something like print(\"avg_pool\", avg_pool.size()) in the forward pass to check the sizes of the layer and you will debug the network easily", "4) You can return multiple outputs from the forward layer. This is pretty helpful in the Encoder-Decoder architecture where you can return both the encoder and decoder output. Or in the case of autoencoder where you can return the output of the model and the hidden layer embedding for the data.", "5) Pytorch tensors work in a very similar manner to numpy arrays. For example, I could have used Pytorch Maxpool function to write the maxpool layer but max_pool, _ = torch.max(h_gru, 1) will also work.", "6) You can set up different layers with different initialization schemes. Something you won\u2019t be able to do in Keras. For example, in the below network I have changed the initialization scheme of my LSTM layer. The LSTM layer has different initializations for biases, input layer weights, and hidden layer weights.", "7) Wait until you see the training loop in Pytorch You will be amazed at the sort of control it provides.", "Now the same model in Pytorch will look like something like this. Do go through the code comments to understand more on how to port.", "Hope you are still there with me. One thing I would like to emphasize here is that you need to code something up in Pytorch to really understand how it works.", "And know that once you do that you would be glad that you put in the effort. On to the next section.", "In the above section, I wrote that you will be amazed once you saw the training loop. That was an exaggeration.", "On the first try, you will be a little baffled/confused.", "But as soon as you read through the loop more than once it will make a lot of intuitive sense. Once again read up the comments and the code to gain a better understanding.", "This training loop does k-fold cross-validation on your training data and outputs Out-of-fold train_preds and test_preds averaged over the runs on the test data.", "I apologize if the flow looks something straight out of a kaggle competition, but if you understand this you would be able to create a training loop for your own workflow. And that is the beauty of Pytorch.", "So a brief summary of this loop is as follows:", "Okay. I get it. That was probably a handful. What you could have done with a simple.fit in keras, takes a lot of code to accomplish in Pytorch.", "But understand that you get a lot of power too. Some use cases for you to understand:", "The code above will not run as is as there are some code artifacts which I have not shown here. I did this in favor of making the post more readable. Like you see the seed_everything, MyDataset and CyclicLR (From Jeremy Howard Course) functions and classes in the code above which are not really included with Pytorch. But fret not my friend.", "I have tried to write a Kaggle Kernel with the whole running code. You can see the code here and include it in your projects.", "Take a look at the Advanced Machine Learning on Google Cloud Specialization. This course talks about deploy and productionizing your models. Definitely recommended.", "I am going to be writing more of such posts in the future too. Let me know what you think about the series. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff0d4fff4ce79&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----f0d4fff4ce79---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@davidclode?utm_source=medium&utm_medium=referral", "anchor_text": "David Clode"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://amzn.to/2LxRTe6", "anchor_text": "Pytorch"}, {"url": "https://coursera.pxf.io/7mKnnY", "anchor_text": "Sequence modelling"}, {"url": "https://coursera.pxf.io/7mKnnY", "anchor_text": "Deep Learning Specialization"}, {"url": "https://twitter.com/karpathy/status/868178954032513024?ref_src=twsrc%5Etfw", "anchor_text": "May 26, 2017"}, {"url": "https://mlwhiz.com/blog/2018/12/17/text_classification/", "anchor_text": "here"}, {"url": "https://amzn.to/2LxRTe6", "anchor_text": "Keras"}, {"url": "https://www.kaggle.com/mlwhiz/third-place-model-for-toxic-comments-in-pytorch", "anchor_text": "Kaggle Kernel"}, {"url": "https://www.kaggle.com/mlwhiz/third-place-model-for-toxic-comments-in-pytorch", "anchor_text": "You can see the code here and include it in your projects."}, {"url": "https://coursera.pxf.io/5bDx3b", "anchor_text": "Advanced Machine Learning on Google Cloud Specialization"}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium"}, {"url": "https://mlwhiz.ck.page/a9b8bda70c", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f0d4fff4ce79---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f0d4fff4ce79---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----f0d4fff4ce79---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----f0d4fff4ce79---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f0d4fff4ce79---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----f0d4fff4ce79---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----f0d4fff4ce79---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff0d4fff4ce79&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f0d4fff4ce79---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f0d4fff4ce79--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmoving-from-keras-to-pytorch-f0d4fff4ce79&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}