{"url": "https://towardsdatascience.com/2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc", "time": 1683016962.7582579, "path": "towardsdatascience.com/2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc/", "webpage": {"metadata": {"title": "2. Understanding Apache Spark Resource And Task Management With Apache YARN | by Jiahui Wang | Towards Data Science", "h1": "2. Understanding Apache Spark Resource And Task Management With Apache YARN", "description": "Welcome back to the series of Exploration of Spark Performance Optimization! In Introduction To Apache Spark, I briefly introduced the core modules of Apache Spark. Although in the last post, I\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/1-introduction-to-apache-spark-299db7a4b68d", "anchor_text": "Introduction To Apache Spark", "paragraph_index": 0}, {"url": "https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/index.html", "anchor_text": "YARN", "paragraph_index": 1}, {"url": "https://spark.apache.org/docs/latest/rdd-programming-guide.html", "anchor_text": "transformation and action", "paragraph_index": 4}, {"url": "https://databricks.com/glossary/what-are-transformations", "anchor_text": "narrow dependencies and wide dependencies", "paragraph_index": 7}], "all_paragraphs": ["Welcome back to the series of Exploration of Spark Performance Optimization! In Introduction To Apache Spark, I briefly introduced the core modules of Apache Spark. Although in the last post, I mentioned that Spark enables distributed computing and the end users barely need to know about the resource and task management across machines, I do find a basic understanding of how Spark works helps to write performant applications. Apache Yarn, which provides APIs to submit and monitor Spark applications, is a helpful tool to learn how Spark works. In this post, I will continue to discuss Spark mechanisms and how we can monitor Spark resource and task management with Yarn.", "YARN stands for Yet Another Resource Negotiator. In the Hadoop ecosystem, it is a middle layer in between the applications and HDFS. It enables multiple applications to run simultaneously on the same cluster of machines by acquiring resources based on the need of each application.", "There are two main components in YARN: a single Resource Manager taking charge of the resource allocation and management over the entire cluster, and multiple Application Masters managing each application. While running an application, the Application Master sends the heartbeat and job progress information to the Resource Manager. Thus, the client can check the resource and application status from the Resource Manager. YARN provides a web UI that can easily keep track of the resource status and job status of various running applications.", "There are levels of task management in Yarn. These different levels of task management are defined due to Spark\u2019s lazy evaluation mechanism.", "RDD, as a fundamental abstraction in Spark, supports two kinds of operations: transformation and action. RDDs are immutable, which means the RDDs cannot be modified once created. Thus, the way that Spark supports complex computation operations is to create a series of new RDDs, which is also known as lineage. Lineage ensures the computation with fault-tolerance, as it is possible to recover a failed RDD from the chain of dependencies.", "In Spark, transformations are evaluated in a lazy way, which means the transformation operations won\u2019t be calculated until some action operation triggers the calculation. Transformation includes the filter, union, join, aggregation operations, while action includes collect, count and save operations.", "2.2 Narrow Dependencies and Wide Dependencies", "In Spark, computation is done by many executors in the cluster. Each executor executes computation on a small portion of the data, and this small portion of the data is called a partition. However, in the RDD lineage, the results coming from one partition might not necessarily end up in the same partition. Thus, the RDD transformations are divided into two types: narrow dependencies and wide dependencies.", "In a transformation that involves narrow dependencies, a parent partition corresponds to a child partition. While in a wide dependencies transformation, a parent partition corresponds to multiple children partitions.", "As compared to narrow dependency transformations, wide dependency transformations takes more network bandwidth and might compute slower, as they involve larger scale shuffling of the data residing on different executors.", "2.3 Application, Job, Stage, and Tasks", "In Yarn, we can monitor Spark task management on four different levels: application, job, stage, and task. But what are these different levels of task management?", "An application consists of a driver program which is executed on the cluster. One submission from the clients is an application. For example, counting the number of customers to a shop can be an application.", "An application involves multiple jobs which run in a sequence. Jobs are defined by action operations. An action operation will cause the separation of jobs.", "A job involves multiple stages which run in a sequence. A stage is generated upon wide dependency transformations.", "A stage involves multiple tasks that run in parallel. The number of tasks corresponds to the number of parallelly running executors. A larger number of tasks means better parallelism.", "Thus, by looking at the performance of different levels of tasks, we can have a rough idea of the performance bottleneck in the application.", "When we talk about resources in Spark, we generally refer to two things: cpu and memory of the drive node and executor nodes.", "When it comes to the drive node, cpu is usually not a big issue, as it only needs to run the driver program. However, driver memory can sometimes become the performance bottleneck. Some action operations, such as collect, involve pulling the result from the executor nodes back to the drive node for calculation. In such cases, an insufficient driver node memory might cause OOM problems.", "For the executor nodes, cores of the cpu determine the parallelism on an executor. The more cpu cores an executor provides, the higher level of parallelism can be achieved.", "Executor node memory configuration is important, as it ensures that Spark can run fast in-memory computing. The executor memory is divided into four parts: reserve memory, user memory, storage memory, and execution memory.", "Storage memory is used for caching, while execution memory is used for shuffling calculation. Storage memory and execution memory share the memory in a dynamic way. When there is free space in one memory, the other memory can borrow space from the less-occupied one. If storage memory occupies additional space from execution memory, execution memory can evict space when it needs to claim back the space. However, storage memory is not allowed to evict space from execution memory. In this sense, the dynamic sharing mechanism favors execution memory, as it has higher priority over storage memory. In addition, both storage memory and execution memory allows for spilling to disk to avoid causing OOM problems.", "If we cache or persist a dataframe during computation, the data will be stored in the storage memory. In Yarn web UI, we can check the persisted data in the storage tab.", "User memory stores the data structures and metadata required for RDD transformation. Reserved memory is the storage for running the executor. Unlike storage memory and execution memory, user memory and reserved memory do not support spilling to disk and will cause OOM issues when the data exceeds the allocated size.", "In this post, we covered Spark task and resource management in Yarn. Knowing how Yarn manages tasks and resources, we can probe the performance bottleneck when monitoring the Spark applications. Generally speaking, in terms of task, operations involving wide dependency shuffle should be carefully optimized. In terms of resource, the allocation and occupy sequence of storage and execution memory should be monitored.", "In the coming posts, I will provide some optimization examples. Please stay tuned!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbf9bc1de7cdc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jhwang1992m?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jhwang1992m?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Jiahui Wang"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4037e6e33535&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&user=Jiahui+Wang&userId=4037e6e33535&source=post_page-4037e6e33535----bf9bc1de7cdc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@nasa?utm_source=medium&utm_medium=referral", "anchor_text": "NASA"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/1-introduction-to-apache-spark-299db7a4b68d", "anchor_text": "Introduction To Apache Spark"}, {"url": "https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/index.html", "anchor_text": "YARN"}, {"url": "https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/YARN.html", "anchor_text": "YARN architecture"}, {"url": "https://spark.apache.org/docs/latest/rdd-programming-guide.html", "anchor_text": "transformation and action"}, {"url": "https://databricks.com/glossary/what-are-transformations", "anchor_text": "narrow dependencies and wide dependencies"}, {"url": "https://databricks.com/glossary/what-are-transformations", "anchor_text": "databricks"}, {"url": "https://aws.amazon.com/cn/blogs/big-data/best-practices-for-successfully-managing-memory-for-apache-spark-applications-on-amazon-emr/", "anchor_text": "Executor memory structure: execution memory, storage memory, user memory, and reserved memory"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----bf9bc1de7cdc---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/apache-yarn?source=post_page-----bf9bc1de7cdc---------------apache_yarn-----------------", "anchor_text": "Apache Yarn"}, {"url": "https://medium.com/tag/big-data?source=post_page-----bf9bc1de7cdc---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&user=Jiahui+Wang&userId=4037e6e33535&source=-----bf9bc1de7cdc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&user=Jiahui+Wang&userId=4037e6e33535&source=-----bf9bc1de7cdc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbf9bc1de7cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bf9bc1de7cdc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bf9bc1de7cdc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jhwang1992m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jhwang1992m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jiahui Wang"}, {"url": "https://medium.com/@jhwang1992m/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "873 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4037e6e33535&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&user=Jiahui+Wang&userId=4037e6e33535&source=post_page-4037e6e33535--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5bfa0b9f9a63&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F2-understanding-apache-spark-resource-and-task-management-with-apache-yarn-bf9bc1de7cdc&newsletterV3=4037e6e33535&newsletterV3Id=5bfa0b9f9a63&user=Jiahui+Wang&userId=4037e6e33535&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}