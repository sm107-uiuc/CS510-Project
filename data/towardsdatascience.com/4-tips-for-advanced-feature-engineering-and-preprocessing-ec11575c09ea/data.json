{"url": "https://towardsdatascience.com/4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea", "time": 1682997656.002856, "path": "towardsdatascience.com/4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea/", "webpage": {"metadata": {"title": "4 Tips for Advanced Feature Engineering and Preprocessing | by Maarten Grootendorst | Towards Data Science", "h1": "4 Tips for Advanced Feature Engineering and Preprocessing", "description": "Arguably, two of the most important steps in developing a machine learning model is feature engineering and preprocessing. Feature engineering consists of the creation of features whereas\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/MaartenGr/feature-engineering", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://jair.org/index.php/jair/article/view/10302", "anchor_text": "SMOTE", "paragraph_index": 7}, {"url": "https://imbalanced-learn.readthedocs.io/en/stable/index.html", "anchor_text": "imbalanced-learn", "paragraph_index": 9}, {"url": "https://imbalanced-learn.readthedocs.io/en/stable/index.html", "anchor_text": "imbalanced-learn", "paragraph_index": 13}, {"url": "https://www.kaggle.com/lnvardanyan/hr-analytics", "anchor_text": "HR analytics data", "paragraph_index": 17}, {"url": "https://github.com/Featuretools/featuretools", "anchor_text": "package", "paragraph_index": 19}, {"url": "https://docs.featuretools.com/loading_data/using_entitysets.html", "anchor_text": "link", "paragraph_index": 22}, {"url": "https://github.com/sahandha/eif", "anchor_text": "extended", "paragraph_index": 37}, {"url": "https://towardsdatascience.com/outlier-detection-with-extended-isolation-forest-1e248a3fe97b", "anchor_text": "mixed", "paragraph_index": 37}, {"url": "https://www.linkedin.com/in/mgrootendorst/", "anchor_text": "LinkedIn", "paragraph_index": 38}, {"url": "https://twitter.com/MaartenGr", "anchor_text": "Twitter", "paragraph_index": 38}, {"url": "https://github.com/MaartenGr/feature-engineering/blob/master/Engineering%20Tips.ipynb", "anchor_text": "here", "paragraph_index": 39}, {"url": "http://www.linkedin.com/in/mgrootendorst/", "anchor_text": "www.linkedin.com/in/mgrootendorst/", "paragraph_index": 42}], "all_paragraphs": ["Arguably, two of the most important steps in developing a machine learning model is feature engineering and preprocessing. Feature engineering consists of the creation of features whereas preprocessing involves cleaning the data.", "Torture the data, and it will confess to anything. \u2014 Ronald Coase", "We often spend a significant amount of time refining the data into something useful for modeling purposes. In order to make this work more efficient, I would like to share 4 Tips and Tricks that could help you with engineering and preprocessing those features.", "I should note that, how cliche it might be, domain knowledge might be one of the most important things to have when engineering features. It might help you in preventing under- and overfitting by having a better understanding of the features that you use.", "You can find the notebook with analyses here.", "In practice, you will encounter imbalanced data more often than not. This does not necessarily have to be a problem if your target only has a slight imbalance. You could then resolve it by using proper validation measures for the data such as Balanced Accuracy, Precision-Recall Curves or F1-score.", "Unfortunately, this is not always the case and your target variable might be highly imbalanced (e.g., 10:1). Instead, you can oversample the minority target in order to introduce balance using a technique called SMOTE.", "SMOTE stands for Synthetic Minority Oversampling Technique and is an oversampling technique used to increase the samples in a minority class.", "It generates new samples by looking at the feature space of the target and detecting nearest neighbors. Then, it simply selects similar samples and changes a column at a time randomly within the feature space of the neighboring samples.", "The module to implement SMOTE can be found within the imbalanced-learn package. You can simply import the package and apply a fit_transform:", "As you can see the model successfully oversampled the target variable. There are several strategies that you can take when oversampling using SMOTE:", "I chose to use a dictionary to specify the extent to which I wanted to oversample my data.", "Additional tip 1: If you have categorical variables in your dataset SMOTE is likely to create values for those variables that cannot happen. For example, if you have a variable called isMale, which could only take 0 or 1, then SMOTE might create 0.365 as a value.", "Instead, you can use SMOTENC which takes into account the nature of categorical variables. This version is also available in the imbalanced-learn package.", "Additional tip 2: Make sure to oversample after creating the train/test split so that you only oversample the train data. You typically do not want to test your model on synthetic data.", "To improve the quality and predictive power of our models, new features from existing variables are often created. We can create some interaction (e.g., multiply or divide) between each pair of variables hoping to find an interesting new feature. This, however, is a lengthy process and requires a significant amount of coding. Fortunately, this can be automated using Deep Feature Synthesis.", "Deep feature synthesis (DFS) is an algorithm which enables you to quickly create new variables with varying depth. For example, you can multiply pairs of columns but you can also choose to first multiply Column A with Column B and then add Column C.", "First, let me introduce the data I will be using for the example. I have chosen to use HR analytics data since the features are easily interpretable:", "Simply based on our intuition we could identifyaverage_monthly_hours divided bynumber_project as an interesting new variable. However, there might be much more relationships that we miss out on if we only follow intuition.", "The package does require an understanding of their use of Entities. However, if you use a single table you can simply follow the code below:", "The first step is to create an entity from which relationships can be created with other tables if necessary. Next, we can simply run ft.dfs in order to create new variables. We specify how variables are created with the parameter trans_primitives. We chose to either add numeric variables together or multiply.", "As you can see in the image above we have created an additional 668 features using only a few lines of code. A few examples of the features that were created:", "Additional tip 1: Note that the implementation here is relatively basic. The great thing about DFS is that it can create new variables from aggregations between tables (e.g., facts and dimensions). See this link for an example.", "Additional tip 2: Run ft.list_primitives()in order to see the full list of aggregation that you can do. It even handles timestamps, null values, and long/lat information.", "As always, there is no one best way of dealing with missing values. Depending on your data it might be sufficient to simply fill them with the mean or mode of certain groups. However, there are advanced techniques that use known parts of the data to impute the missing values.", "One such method is called IterativeImputer a new package in Scikit-Learn which is based on the popular R algorithm for imputing missing variables, MICE.", "Although python is a great language for developing machine learning models, there are still quite a few methods that work better in R. An example is the well-establish imputation packages in R: missForest, mi, mice, etc.", "The Iterative Imputer is developed by Scikit-Learn and models each feature with missing values as a function of other features. It uses that as an estimate for imputation. At each step, a feature is selected as output y and all other features are treated as inputs X. A regressor is then fitted on X and y and used to predict the missing values of y. This is done for each feature and repeated for several imputation rounds.", "Let us take a look at an example. The data that I use is the well known Titanic dataset. In this dataset, the column Age has missing values that we would like to fill. The code, as always, is straightforward:", "The great thing about this method is that it allows you to use an estimator of your choosing. I used a RandomForestRegressor to mimic the behavior of the frequently used missForest in R.", "Additional tip 1: If you have sufficient data, then it might be an attractive option to simply delete samples with missing data. However, keep in mind that it could create bias in your data. Perhaps the missing data follows a pattern that you miss out on.", "Additional tip 2: The Iterative Imputer allows for different estimators to be used. After some testing, I found out that you can even use Catboost as an estimator! Unfortunately, LightGBM and XGBoost do not work since their random state names differ.", "Outliers are difficult to detect without a good understanding of the data. If you know the data well you can more easily specify the thresholds at which your data still makes sense.", "At times this is not possible since a perfect understanding of the data is difficult to achieve. Instead, you can make use of Outlier Detection algorithms such as the popular Isolation Forest.", "In the Isolation Forest Algorithm, the keyword is Isolation. In essence, the algorithm checks how easily a sample can be isolated. This results in an isolation number which is calculated by the number of splits, in a Random Decision Tree, needed to isolate a sample. This isolation number is then averaged over all trees.", "If the algorithm only needs to do a few splits to find a sample, then it is more likely to be an outlier. The splits themselves are also randomly partitioned such that it produces shorter paths for anomalies. Thus, when the isolation number across all trees is low, then that sample is highly likely to be an anomaly.", "To show an example I again used the credit card dataset that we used before:", "Additional Tip 1: There is an extended version of the Isolation Forest available that improves on some shortcomings. However, there have been mixed reviews.", "If you are, like me, passionate about AI, Data Science, or Psychology, please feel free to add me on LinkedIn or follow me on Twitter.", "Notebook with code can be found here.", "Any feedback and comments are, as always, greatly appreciated!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Psychologist. Passionate about anything AI-related! Get in touch: www.linkedin.com/in/mgrootendorst/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fec11575c09ea&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@maartengrootendorst?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Maarten Grootendorst"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22405c3b2875&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&user=Maarten+Grootendorst&userId=22405c3b2875&source=post_page-22405c3b2875----ec11575c09ea---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.analyticsvidhya.com/blog/2018/11/data-engineer-comprehensive-list-resources-get-started/data-engineer/", "anchor_text": "https://www.analyticsvidhya.com/blog/2018/11/data-engineer-comprehensive-list-resources-get-started/"}, {"url": "https://github.com/MaartenGr/feature-engineering", "anchor_text": "here"}, {"url": "https://jair.org/index.php/jair/article/view/10302", "anchor_text": "SMOTE"}, {"url": "https://imbalanced-learn.readthedocs.io/en/stable/index.html", "anchor_text": "imbalanced-learn"}, {"url": "https://imbalanced-learn.readthedocs.io/en/stable/index.html", "anchor_text": "imbalanced-learn"}, {"url": "https://www.kaggle.com/lnvardanyan/hr-analytics", "anchor_text": "HR analytics data"}, {"url": "https://github.com/Featuretools/featuretools", "anchor_text": "package"}, {"url": "https://docs.featuretools.com/loading_data/using_entitysets.html", "anchor_text": "link"}, {"url": "https://donghwa-kim.github.io/iforest.html", "anchor_text": "https://donghwa-kim.github.io/iforest.html"}, {"url": "https://github.com/sahandha/eif", "anchor_text": "extended"}, {"url": "https://towardsdatascience.com/outlier-detection-with-extended-isolation-forest-1e248a3fe97b", "anchor_text": "mixed"}, {"url": "https://www.linkedin.com/in/mgrootendorst/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/MaartenGr", "anchor_text": "Twitter"}, {"url": "https://github.com/MaartenGr/feature-engineering/blob/master/Engineering%20Tips.ipynb", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ec11575c09ea---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ec11575c09ea---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----ec11575c09ea---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----ec11575c09ea---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----ec11575c09ea---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&user=Maarten+Grootendorst&userId=22405c3b2875&source=-----ec11575c09ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&user=Maarten+Grootendorst&userId=22405c3b2875&source=-----ec11575c09ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fec11575c09ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ec11575c09ea---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ec11575c09ea--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ec11575c09ea--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ec11575c09ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maarten Grootendorst"}, {"url": "https://medium.com/@maartengrootendorst/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4.5K Followers"}, {"url": "http://www.linkedin.com/in/mgrootendorst/", "anchor_text": "www.linkedin.com/in/mgrootendorst/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22405c3b2875&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&user=Maarten+Grootendorst&userId=22405c3b2875&source=post_page-22405c3b2875--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb052d90faf55&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-tips-for-advanced-feature-engineering-and-preprocessing-ec11575c09ea&newsletterV3=22405c3b2875&newsletterV3Id=b052d90faf55&user=Maarten+Grootendorst&userId=22405c3b2875&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}