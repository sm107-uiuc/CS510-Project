{"url": "https://towardsdatascience.com/deploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3", "time": 1683006876.8895712, "path": "towardsdatascience.com/deploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3/", "webpage": {"metadata": {"title": "Building a Deep Learning Model API for Tagging Trout Species | by Perry Johnson | Towards Data Science", "h1": "Building a Deep Learning Model API for Tagging Trout Species", "description": "I recently got into dry fly fishing in Montana. It\u2019s a technical sport and I\u2019m not very good (yet!) but it\u2019s a blast getting out on the river and learning more each time I\u2019m out there. One thing I\u2019ve\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.aqua-vision-research.com", "anchor_text": "Aqua Vision Deep Learning Research Project", "paragraph_index": 0}, {"url": "http://image-net.org/challenges/LSVRC/2013/", "anchor_text": "ImageNet", "paragraph_index": 11}, {"url": "https://www.paperspace.com", "anchor_text": "Paperspace", "paragraph_index": 14}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://github.com/perryrjohnson/aqua-vision/blob/master/simple_request.py", "anchor_text": "script", "paragraph_index": 21}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "Project\u2019s Website", "paragraph_index": 22}, {"url": "https://github.com/perryrjohnson/aqua-vision/issues", "anchor_text": "GitHub Issues", "paragraph_index": 22}, {"url": "https://github.com/perryrjohnson/aqua-vision", "anchor_text": "my GitHub", "paragraph_index": 24}, {"url": "https://www.linkedin.com/in/perryrjohnson/", "anchor_text": "LinkedIn", "paragraph_index": 25}], "all_paragraphs": ["This blog is in reference to on-going work for the Aqua Vision Deep Learning Research Project", "I recently got into dry fly fishing in Montana. It\u2019s a technical sport and I\u2019m not very good (yet!) but it\u2019s a blast getting out on the river and learning more each time I\u2019m out there.", "One thing I\u2019ve noticed when I\u2019m out fishing for trout is that I have little knowledge of the different types of trout species. When I catch trout (which is still not very often) I find myself Google-ing photos and comparing them to what I had caught. I can barely differentiate between the different species. It made me think, maybe there is a way to programmatically identify trout species with computer vision deep learning. I asked a few friends, who are professional fishing guides and die-hard amateurs about this idea, as I thought image recognition could be helpful, and this is what they said:", "\u201cTrout have ~30 species so it\u2019s hard to tell some of them apart.\u201d", "\u201cThis could be very interesting for all of the hybrid trout species like cut-bows\u201d (a cut-bow is a cutthroat and rainbow trout crossbreed)", "I set out to ask the following questions:", "There isn\u2019t a comprehensive labeled dataset available for trout images (let alone any other fish species) so I built my own dataset of 500+ images from scratch. I collected images using a few different methods outlined below.", "After collecting the images, I manually reviewed all of the photos to ensure that the images matched their respective trout species label and removed any miscellaneous images that didn\u2019t belong (fishing equipment, a river, tackle box, incorrectly labeled fish species, etc). The data collection and cleaning phase took about three weeks. Now equipped with 500+ images across a handful of trout species, I had an initial image dataset to start building a deep learning trout identification model.", "The Fastai deep learning library has some really nice built-in tools to scrape images from Google Image Search and then load the image files into an ImageDataBunch object. The ImageDatabunch can then apply data augmentation transformers, setting the size of image pixel resolution, loading in transfer learning and splitting the data into training, validation and testing sets.", "For data augmentation, I kept it pretty simple with default settings but I did randomly flip images horizontally to help normalize for images with fish facing in each direction.", "Data augmentation is really nice because it essentially helps normalize the existing dataset to train on more examples and the augmented images all look pretty different but we didn\u2019t have to do any extra manual labeling so they\u2019re like free extra data. I\u2019ve found that experimenting with data augmentation parameters coupled with domain expertise of the dataset is really the way to get the most out of augmenting the data.", "I took advantage of transfer learning by preloading the model weights from ImageNet instead of initializing deep learning model weights from scratch. ImageNet is a dataset of millions of labeled high-resolution images belonging roughly to 22k categories. The images were collected from the internet and labeled by humans using a crowd-sourcing tool. Transfer learning is a great way to leverage a previously trained model and reduce compute cost to then fine tune with domain specific data to perform a domain specific task.", "The ImageDataBunch is then loaded into a Learner object along with a neural network architecture and loss function to train a deep learning model.", "A little trick to improve model performance is to start training at a smaller image size (224) and then take this fitted model and fit it some more on a bigger image size (352). This really helps performance in almost all cases.", "I trained the model on 70% of the images and reserved the remaining 30% for testing. I like using Paperspace to train deep learning models as they have free GPU-backed Jupyter notebooks that are really easy to set up and load in deep learning libraries.", "After fitting the data to a deeper pixel resolution on a few runs through the data (epochs), the model peaked at 96% classification accuracy on test set data. This was good enough to ship as the first version deep learning trout identifier for the web-app and API.", "I exported the trained deep learning model to use in a production environment to make predictions. I wrapped the model in Python\u2019s web framework Flask to make predictions via a web-application and a REST API. The web-app and API documentation supporting this Aqua Vision Deep Learning Research Project can be found here.", "There are currently two API endpoints available: one to get the classes (species) currently supported by the deep learning model and one to make species predictions by posting an image file. You can test the API by making the following cURL commands from your command line.", "You can see which trout species the model currently supports at the endpoint:", "The -X flag and POST value indicates we're performing a POST request. We supply -F image=@brown_trout.jpg to indicate we're submitting form encoded data. The image key is then set to the contents of the brown_trout.jpg file. Supplying the @ prior to brown_trout.jpg implies we would like cURL to load the contents of the image and pass the data to the request.", "Accessing the API Programmatically via Python", "Here is a simple Python script using the requests library to submit data to the API and then consume the returned predictions.", "You can check out the on-going progress by visiting the Project\u2019s Website and the GitHub Issues.", "The continued goals of the project are to:", "The code for this project can be found on my GitHub", "If you\u2019d like to contribute to this project or if you have any comments or questions shoot me an email at: perryrjohnson7@gmail.com or reach out on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbff1b1f902a3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@perryrjohnson7?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perryrjohnson7?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Perry Johnson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F403f104415ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&user=Perry+Johnson&userId=403f104415ac&source=post_page-403f104415ac----bff1b1f902a3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "Aqua Vision Deep Learning Research Project"}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "Aqua Vision Deep Learning"}, {"url": "https://github.com/fastai/course-v3/blob/master/nbs/dl1/lesson2-download.ipynb", "anchor_text": "Ran a Javascript command"}, {"url": "https://github.com/rarcega/instagram-scraper", "anchor_text": "Instagram Scraper"}, {"url": "http://image-net.org/challenges/LSVRC/2013/", "anchor_text": "ImageNet"}, {"url": "https://www.paperspace.com", "anchor_text": "Paperspace"}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "here"}, {"url": "http://twitter.com/file_name", "anchor_text": "@b"}, {"url": "https://aqua-vision.herokuapp.com/api/predict", "anchor_text": "https://aqua-vision.herokuapp.com/api/predict"}, {"url": "https://github.com/perryrjohnson/aqua-vision/blob/master/simple_request.py", "anchor_text": "script"}, {"url": "http://www.aqua-vision-research.com", "anchor_text": "Project\u2019s Website"}, {"url": "https://github.com/perryrjohnson/aqua-vision/issues", "anchor_text": "GitHub Issues"}, {"url": "https://github.com/perryrjohnson/aqua-vision", "anchor_text": "my GitHub"}, {"url": "https://www.linkedin.com/in/perryrjohnson/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/data-science?source=post_page-----bff1b1f902a3---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----bff1b1f902a3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----bff1b1f902a3---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/technology?source=post_page-----bff1b1f902a3---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/software-development?source=post_page-----bff1b1f902a3---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&user=Perry+Johnson&userId=403f104415ac&source=-----bff1b1f902a3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&user=Perry+Johnson&userId=403f104415ac&source=-----bff1b1f902a3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbff1b1f902a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bff1b1f902a3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bff1b1f902a3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perryrjohnson7?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perryrjohnson7?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Perry Johnson"}, {"url": "https://medium.com/@perryrjohnson7/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "111 Followers"}, {"url": "http://perryrjohnson.com", "anchor_text": "http://perryrjohnson.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F403f104415ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&user=Perry+Johnson&userId=403f104415ac&source=post_page-403f104415ac--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff83e5d9cfb2d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-deep-learning-api-for-tagging-trout-species-bff1b1f902a3&newsletterV3=403f104415ac&newsletterV3Id=f83e5d9cfb2d&user=Perry+Johnson&userId=403f104415ac&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}