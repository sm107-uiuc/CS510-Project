{"url": "https://towardsdatascience.com/forensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097", "time": 1683009227.644796, "path": "towardsdatascience.com/forensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097/", "webpage": {"metadata": {"title": "ML for Anomaly Detection and Importance of Precision-Recall Curve | by Sarit Maitra | Towards Data Science", "h1": "ML for Anomaly Detection and Importance of Precision-Recall Curve", "description": "Fraudulent behavior can be seen across many different fields such as e-commerce, healthcare, payment and banking systems. Financial fraud has important implications for investors, regulators\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Fraudulent behavior can be seen across many different fields such as e-commerce, healthcare, payment and banking systems. Financial fraud has important implications for investors, regulators, auditors, and the general public. Data mining plays an imperative role in the detection of financial fraud in online transactions. However, data mining becomes challenging because the profiles of normal and fraudulent behaviors change constantly and fraud data sets are highly skewed.", "Here, we have the data set on Bank Payments as below. Target variable which shows if the transaction fraudulent(1) or valid(0).", "This data set is with information on the rising risk of digital financial fraud, emphasizing the difficulty in obtaining such data. The technical challenge it poses to predict fraud is the highly imbalanced distribution between positive and negative classes in 6 million rows of data. To develop a better understanding of the financial transactions data set, let\u2019s count the number of distinct values by feature.", "The data is imbalanced as we can see in the plot below and from the outlier_fraction.", "There are only one unique zipCode values so we will drop them.", "It can be noticed that, one-hot encoding is avoided here for computational easiness; however, it is usually better to turn these kind of categorical values into dummies because they have no relation in size(i.e. customer1 is not greater than customer2).", "Create the feature matrix X and the labels array y", "Let\u2019s re-scale the feature matrix in order to have a mean of zero and standard deviation of one.", "Now that the data is ready, let\u2019s prepare for the model. We need to split the data into a training and a test set, select a cost function.", "We need to apply a cost function which is the error rate to the algorithm before training. The algorithm will try to minimize this cost function by learning from the training examples. We shall use binary classification log loss, which will calculate the cross-entropy between the true labels and the model-based predictions.", "Here, n is the number of observations; m is the number of class labels ; log is the natural logarithm; is 1 if observation i is in class j and 0 otherwise; and is the predicted probability that observation i is in class j.", "The model will generate the fraud probability for each transaction. The closer the fraud probabilities are to the true labels, the lower the value of the log loss function. Objective of ML is to try to minimize the log loss.", "Sensitivity and specificity are typically considered characteristics of the confusion matrix.", "We see here, the formula doesn\u2019t contain FP and TN; thus sensitivity may lead to a biased result, especially for our use case with imbalanced classes.", "Thus, when classifier reports positive in 8 of 10 transactions with a probable fraud has a sensitivity of 0.8 (80%). It represents how well our classifier detects the fraud; classifier with low sensitivity does not identify many fraudulent transactions, and classifier with high sensitivity is useful to exclude transaction when results are negative. So, we see that, sensitivity is the complement of the false-negative rate (i.e. the false-negative rate plus the sensitivity = 100%).", "Thus, when classifier reports negative in 8 of 10 transactions without fraudulent has a specificity of 0.8 (80%). Specificity represents how well our classifier correctly identifies transactions with fraudulent because classifier with high specificity have a low false-positive rate. Classifier with low specificity signals many genuine transactions as fraudulent. It is the complement of the false-positive rate. However, here also, we see that, the formula does not contain FN and TP; specificity may also give us biased result, for imbalanced classes.", "Here too, the formula does not contain FN and TN and likewise precision may give biased result for our imbalanced classes. It gives us the % of correctly predicted frauds from the pool of total predicted frauds.", "The fraud percentage in our case studies 1.2% of total cases. Fraud detection may not be achievable by gaining a high accuracy rate. Therefore, we will consider other performance measures, specifically the sensitivity, Area Under the Precision-Recall Curve (AURPC) and the F1 score.", "The accuracy rate represents the percentage of correctly classified observations from both classes:", "The sensitivity i.e. True Positivity Rate (TPR) and recall, represents the proportion of positives correctly classified as positives. These parameters are critically important and we consider these as a performance measure along with accuracy.", "Sensitivity= T P / T P +F N", "However, sensitivity alone is also misleading because it allows to ignore a large number of false positives. Our aim to find a balance between those two parameters. We need to obtain a high fraud detection rate (sensitivity), with the highest possible accuracy. To handle this issue, we considered trade-off measures like the AUPRC and the F1 score.", "For our imbalanced data set, a better way to evaluate the results is to use precision and recall. The precision-recall curve shows the trade-off between precision, a measure of result relevancy, and recall, a measure of how many relevant results are returned. we already have discussed about precision, recall and F1 score.", "An optimal solution requires high precision and high recall. So, we see here is a trade-off between precision and recall. This is usually determined by the threshold set by the algorithm to separate the positive cases from the negative cases. To evaluate the precision-recall curve, we need to calculate the average precision, which is the weighted mean of the precision achieved at each threshold. The higher the average precision, the better the solution.", "Given that our financial transactions data set is highly imbalanced, using the confusion matrix would not be meaningful. The confusion matrix does a poor job of capturing this sub-optimal outcome given this imbalanced class problem.", "Stacked generalization provides a mechanism for harnessing the collective discriminatory power of an ensemble of heterogeneous classification method. This involves the use of a top level classification model which is capable of learning from the predictions (and classification biases) of base-level models in order to achieve greater classification power. Considering XGBoost and LightGBM are from the same family, we will choose LightGBM and Logistic Regression models for ensemble approach.", "This performance is little better than Logistic Regression but nowhere near to LightGBM than earlier two models. So, we will reject this.", "Using unsupervised LightGBM model, we achieved an average precision of 0.90. We shall try to fit Autoencoder to check if unsupervised model brings better accuracy.", "Here, we will adjust our training set by oversampling the number of fraudulent cases we have. We want to add more fraudulent cases to our data set so that the Autoencoder we train has an easier time separating the valid transactions from the fraudulent ones.", "The average precision on the test based on the precision-recall curve is 0.40 which is the worst representation of data. We can try combining supervised and unsupervised to create a semi-supervised model to check the performance. However, as our existing data is labeled, unsupervised algorithm likely to bring better results.", "The plot can further be tuned for optimal performance; however, here, the optimal F1 score annotated as a threshold of 0.74.", "Once we identify a model for production, let\u2019s design a simple pipeline that performs three simple steps on new, incoming data: load the data, scale the features, and generate predictions using the LightGBM model we have already trained and selected for use in production:", "A fraud detection system should have some of the below mentioned properties in order to make real world business sense.", "The solution will need to be retrained over time as the patterns of fraud always change. Also, we can experiment other ML algorithms which perform just as good as gradient boosting and may include them in an ensemble to improve fraud detection performance overall. With enough iterations, its often possible to find an appropriate machine learning model with the right balance of bias vs. variance and precision vs. recall. Moreover, interpretability is very important for real-world applications of machine learning. We will keep interpretability for another discussions.", "While financial fraud can never be confirmed without a full investigation, advances in fraud detection methods may provide red flags that warn stakeholders of the likelihood of fraud.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Analytics & Data Science Practice Lead"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fccd7bef58097&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sarit-maitra.medium.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Sarit Maitra"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc611876588a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&user=Sarit+Maitra&userId=c611876588a8&source=post_page-c611876588a8----ccd7bef58097---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://sarit-maitra.medium.com/membership", "anchor_text": "https://sarit-maitra.medium.com/membership"}, {"url": "https://www.linkedin.com/in/saritmaitra/", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ccd7bef58097---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/anomaly-detection?source=post_page-----ccd7bef58097---------------anomaly_detection-----------------", "anchor_text": "Anomaly Detection"}, {"url": "https://medium.com/tag/imbalanced-class?source=post_page-----ccd7bef58097---------------imbalanced_class-----------------", "anchor_text": "Imbalanced Class"}, {"url": "https://medium.com/tag/precision-recall-curve?source=post_page-----ccd7bef58097---------------precision_recall_curve-----------------", "anchor_text": "Precision Recall Curve"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&user=Sarit+Maitra&userId=c611876588a8&source=-----ccd7bef58097---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&user=Sarit+Maitra&userId=c611876588a8&source=-----ccd7bef58097---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fccd7bef58097&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ccd7bef58097---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ccd7bef58097--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ccd7bef58097--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ccd7bef58097--------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sarit Maitra"}, {"url": "https://sarit-maitra.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.8K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc611876588a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&user=Sarit+Maitra&userId=c611876588a8&source=post_page-c611876588a8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fba440ad8d04d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforensic-analytics-application-of-machine-learning-to-anomaly-detection-ccd7bef58097&newsletterV3=c611876588a8&newsletterV3Id=ba440ad8d04d&user=Sarit+Maitra&userId=c611876588a8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}