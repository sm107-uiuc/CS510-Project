{"url": "https://towardsdatascience.com/microscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9", "time": 1683009306.148127, "path": "towardsdatascience.com/microscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9/", "webpage": {"metadata": {"title": "Microscopy stain variations and how to estimate them | by Prof. Marc Aubreville | Towards Data Science", "h1": "Microscopy stain variations and how to estimate them", "description": "If you have seen a couple of microscopy images of tissue (histopathology images), you must have noticed that they come in all variants of colors. Even when the same dying chemicals (stains) are used\u2026"}, "outgoing_paragraph_urls": [{"url": "http://wwwx.cs.unc.edu/~mn/sites/default/files/macenko2009.pdf", "anchor_text": "Macenko", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Beer%E2%80%93Lambert_law", "anchor_text": "Beer-Lambert law", "paragraph_index": 9}, {"url": "https://ieeexplore.ieee.org/document/5193250", "anchor_text": "A method for normalizing histology slides for quantitative analysis", "paragraph_index": 19}], "all_paragraphs": ["If you have seen a couple of microscopy images of tissue (histopathology images), you must have noticed that they come in all variants of colors. Even when the same dying chemicals (stains) are used, the visual appearance is influenced by so many factors that it can easily become a big problem if you work with those images algorithmically.", "The default stain in histopathology is a combination of two chemicals: hematoxylin and eosin. The first is responsible for the dark violet (or blueish) color of all acid components (like, e.g., the DNA, residing in the cellular nucleus), while the second is responsible for the pinkish color that gives structure to the surrounding tissue. It looks for example like this:", "I\u2019ve already mentioned that the color of this varies widely across images. Let us briefly discuss why that is:", "One major role in this game is played by the staining chemicals themselves. Depending on the concentration, the duration of staining and even the temperature. To stabilize these conditions, automatic staining machines are used. To showcase the influence of duration the tissue resides in a stain, have a look at the next image:", "Both images represent slices of the exact same tumor, as can be seen in the overview thumbnail. However, the right image has a much stronger blue color component (caused by the much longer staining time in the hematoxylin solution).", "If we want to process these images, these variations often pose a problem. Especially when we have only a small number of cases, it is at times hard to get our recognition algorithms robust, especially if they have a high pattern recognition capacity, such as by using deep networks.", "To mitigate this, there are in principle two methods:", "For both, it helps to be able to estimate the stain intensity of the two standard colors in the digital microscopy slide and modify it to either represent a standardized staining (in the case of normalization) or to represent many different stains.", "Let us review the method of Macenko et al. [1] for this . While it might be a bit hard to understand at first, it is a very clever method that really deserves our attention.", "While images are commonly given in red, green and blue color channels, where brighter images represent higher numbers, a stain is essentially the exact inverse: The more stain was in the ray of light transversing to our CCD sensor, the darker the color. As you might know from radiology, light will also follow the Beer-Lambert law and be attenuated exponentially with the density of tissue. Macenko et al. thus convert each pixel in the image to a negative logarithmic representation (optical density, OD).", "After this step, we have thus a linear superposition of both staining components \u2014 which is really cool for separating them! Also, higher numbers now represent more stain (and thus darker colors).", "After removing too low values (which are only the bright background where no tissue ever was present), we can thus now try to estimate the staining components.", "For this, they first estimate the 2D plane in the 3D space that is spanned by the two stain vectors. The singular value decomposition they use for this generates a new coordinate system, where the first component spans the main variance (which is, however, not yet one of the stain colors we are looking for). Each OD value of each pixel is being projected into the new coordinate system.", "The beauty of this is that if we inherently removed noise by stripping away the third component (since we only used the first two eigenvectors). Why were we allowed to do so? Because we knew that the image is mainly just the colors by the hematoxylin and eosin (H&E) stain. Pretty cool.", "Let us have a look at the same image, but only in 2D, for the sake of simplicity:", "You may notice that I already added the two staining vectors in this image. They represent the maximum angle and the minimum angle in the coordinate system spanned by our eigenvectors. Why? Because they themselves span their own coordinate system \u2014 the actual H&E coordinate system.", "In this image you can really nicely see that the color values are in fact a linear superposition of those two components. I already told you that we can estimate these (indicated by the red arrows in the image above) very easily now by calculating a robust minimum and maximum of the angle. You might argue that minimum and maximum are rarely robust, if we have some noise. That\u2019s a very good point and the reason why Macenko et al. used quantiles for this (typically the 1% and 99%).", "But why is it exactly the minimum and maximum angles? Because in a noise-free world, you can not get lower than zero staining by the components, which is exactly what the area outside of these maximum angles would stand for.", "In the next post, we will discuss how to apply this practically using Python \u2014 and how to do this on big images like the whole slide images we use in microscopy nowadays.", "[1]: Macenko, Marc, et al. A method for normalizing histology slides for quantitative analysis\u201d (2009) IEEE International Symposium on Biomedical Imaging: From Nano to Macro.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I do teaching and research in medical image recognition at THI, Germany, primarily focused tumor diagnostics."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbaca29f57ee9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@marc.aubreville?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@marc.aubreville?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Prof. Marc Aubreville"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fec9d140d7259&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&user=Prof.+Marc+Aubreville&userId=ec9d140d7259&source=post_page-ec9d140d7259----baca29f57ee9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://towardsdatascience.com/tagged/MicroscopyStainEstimation", "anchor_text": "Microscopy Image Processing on Whole Slide Images"}, {"url": "http://wwwx.cs.unc.edu/~mn/sites/default/files/macenko2009.pdf", "anchor_text": "Macenko"}, {"url": "https://en.wikipedia.org/wiki/Beer%E2%80%93Lambert_law", "anchor_text": "Beer-Lambert law"}, {"url": "https://ieeexplore.ieee.org/document/5193250", "anchor_text": "A method for normalizing histology slides for quantitative analysis"}, {"url": "https://medium.com/tag/microscopy?source=post_page-----baca29f57ee9---------------microscopy-----------------", "anchor_text": "Microscopy"}, {"url": "https://medium.com/tag/data-science?source=post_page-----baca29f57ee9---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/pathology?source=post_page-----baca29f57ee9---------------pathology-----------------", "anchor_text": "Pathology"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----baca29f57ee9---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/microscopystainestimation?source=post_page-----baca29f57ee9---------------microscopystainestimation-----------------", "anchor_text": "Microscopystainestimation"}, {"url": "http://creativecommons.org/publicdomain/zero/1.0/", "anchor_text": "No rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&user=Prof.+Marc+Aubreville&userId=ec9d140d7259&source=-----baca29f57ee9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&user=Prof.+Marc+Aubreville&userId=ec9d140d7259&source=-----baca29f57ee9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbaca29f57ee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----baca29f57ee9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----baca29f57ee9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----baca29f57ee9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----baca29f57ee9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@marc.aubreville?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@marc.aubreville?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Prof. Marc Aubreville"}, {"url": "https://medium.com/@marc.aubreville/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "82 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fec9d140d7259&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&user=Prof.+Marc+Aubreville&userId=ec9d140d7259&source=post_page-ec9d140d7259--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F35435e275c37&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicroscopy-stain-variations-and-how-to-estimate-them-baca29f57ee9&newsletterV3=ec9d140d7259&newsletterV3Id=35435e275c37&user=Prof.+Marc+Aubreville&userId=ec9d140d7259&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}