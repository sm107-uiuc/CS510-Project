{"url": "https://towardsdatascience.com/survival-analysis-and-the-stratified-sample-2c2582aa9805", "time": 1682995854.181932, "path": "towardsdatascience.com/survival-analysis-and-the-stratified-sample-2c2582aa9805/", "webpage": {"metadata": {"title": "Survival analysis and the stratified sample | by Edward Wagner | Towards Data Science", "h1": "Survival analysis and the stratified sample", "description": "This article discusses the unique challenges faced when performing logistic regression on very large survival analysis data sets. When these data sets are too large for logistic regression, they must\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/edwagner07/survival_analysis/blob/master/survival_code_markdown.md", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://www.tandfonline.com/doi/abs/10.1080/01621459.1958.10501452", "anchor_text": "Nonparametric Estimation from Incomplete Observations", "paragraph_index": 4}, {"url": "https://www.jstor.org/stable/270718?casa_token=0vk-lNdwoe8AAAAA:-xVR-nQnDGuDdxr5VEtsERJW9tQ-6JCpU4FAtGlXLqBy3xwffLiodC9KNuA5Qqm-PWOOJjaFcCOFKSIehvjQz0I7ICaREaRkZ8lmsrrlfOq6gP83sl_KdQ&seq=1#metadata_info_tab_contents", "anchor_text": "Alison (1982)", "paragraph_index": 4}], "all_paragraphs": ["This article discusses the unique challenges faced when performing logistic regression on very large survival analysis data sets. When these data sets are too large for logistic regression, they must be sampled very carefully in order to preserve changes in event probability over time.", "Below, I analyze a large simulated data set and argue for the following analysis pipeline:", "[Code used to build simulations and plots can be found here]", "Often, it is not enough to simply predict whether an event will occur, but also when it will occur. How long is an individual likely to survive after beginning an experimental cancer treatment? When (and where) might we spot a rare cosmic event, like a supernova? And the focus of this study: if millions of people are contacted through the mail, who will respond \u2014 and when?", "All of these questions can be answered by a technique called survival analysis, pioneered by Kaplan and Meier in their seminal 1958 paper Nonparametric Estimation from Incomplete Observations. In it, they demonstrated how to adjust a longitudinal analysis for \u201ccensorship\u201d, their term for when some subjects are observed for longer than others. Survival analysis was later adjusted for discrete time, as summarized by Alison (1982). Here, instead of treating time as continuous, measurements are taken at specific intervals.", "The central question of survival analysis is: given that an event has not yet occurred, what is the probability that it will occur in the present interval? This is determined by the hazard rate, which is the proportion of events in a specific time interval (for example, deaths in the 5th year after beginning cancer treatment), relative to the size of the risk set at the beginning of that interval (for example, the number of people known to have survived 4 years of treatment).", "As an example of hazard rate: 10 deaths out of a million people (hazard rate 1/100,000) probably isn\u2019t a serious problem. But 10 deaths out of 20 people (hazard rate 1/2) will probably raise some eyebrows.", "The present study examines the timing of responses to a hypothetical mailing campaign. While the data are simulated, they are closely based on actual data, including data set size and response rates.", "The population-level data set contains 1 million \u201cpeople\u201d, each with between 1\u201320 weeks\u2019 worth of observations. The data are normalized such that all subjects receive their mail in Week 0. Subjects\u2019 probability of response depends on two variables, age and income, as well as a gamma function of time. Thus, the unit of analysis is not the person, but the person*week.", "And a quick check to see that our data adhere to the general shape we\u2019d predict:", "An individual has about a 1/10,000 chance of responding in each week, depending on their personal characteristics and how long ago they were contacted.", "Below is a snapshot of the data set. It zooms in on Hypothetical Subject #277, who responded 3 weeks after being mailed. As described above, they have a data point for each week they\u2019re observed. The probability values which generate the binomial response variable are also included; these probability values will be what a logistic regression tries to match.", "Due to resource constraints, it is unrealistic to perform logistic regression on data sets with millions of observations, and dozens (or even hundreds) of explanatory variables. Luckily, there are proven methods of data compression that allow for accurate, unbiased model generation.", "Case-control sampling is a method that builds a model based on random subsamples of \u201ccases\u201d (such as responses) and \u201ccontrols\u201d (such as non-responses). Regardless of subsample size, the effect of explanatory variables remains constant between the cases and controls, so long as the subsample is taken in a truly random fashion. For example, if women are twice as likely to respond as men, this relationship would be borne out just as accurately in the case-control data set as in the full population-level data set. Thus, we can get an accurate sense of what types of people are likely to respond, and what types of people will not respond.", "After the logistic model has been built on the compressed case-control data set, only the model\u2019s intercept needs to be adjusted. While relative probabilities do not change (for example male/female differences), absolute probabilities do change. For example, take\u200b\u200b\u200b a population with 5 million subjects, and 5,000 responses. If the case-control data set contains all 5,000 responses, plus 5,000 non-responses (for a total of 10,000 observations), the model would predict that response probability is 1/2, when in reality it is 1/1000. When all responses are used in the case-control set, the offset added to the logistic model\u2019s intercept is shown below:", "Here, N_0 is equal to the number of non-events in the population, while n_0 is equal to the non-events in the case-control set.", "As a reminder, in survival analysis we are dealing with a data set whose unit of analysis is not the individual, but the individual*week. The following very simple data set demonstrates the proper way to think about sampling:", "Survival analysis case-control and the stratified sample", "Things become more complicated when dealing with survival analysis data sets, specifically because of the hazard rate. For example, if an individual is twice as likely to respond in week 2 as they are in week 4, this information needs to be preserved in the case-control set. And the best way to preserve it is through a stratified sample.", "With stratified sampling, we hand-pick the number of cases and controls for each week, so that the relative response probabilities from week to week are fixed between the population-level data set and the case-control set. This way, we don\u2019t accidentally skew the hazard function when we build a logistic model.", "This can easily be done by taking a set number of non-responses from each week (for example 1,000).", "This method requires that a variable offset be used, instead of the fixed offset seen in the simple random sample. The offset value changes by week and is shown below:", "Again, the formula is the same as in the simple random sample, except that instead of looking at response and non-response counts across the whole data set, we look at the counts on a weekly level, and generate different offsets for each week j.", "Because the offset is different for each week, this technique guarantees that data from week j are calibrated to the hazard rate for week j.", "The following R code reflects what was used to generate the data (the only difference was the sampling method used to generate sampled_data_frame):", "Using factor(week) lets R fit a unique coefficient to each time period, an accurate and automatic way of defining a hazard function. It is possible to manually define a hazard function, but while this manual strategy would save a few degrees of freedom, it does so at the cost of significant effort and chance for operator error, so allowing R to automatically define each week\u2019s hazards is advised.", "By this point, you\u2019re probably wondering: why use a stratified sample? What\u2019s the point? And it\u2019s true: until now, this article has presented some long-winded, complicated concepts with very little justification.", "The point is that the stratified sample yields significantly more accurate results than a simple random sample.", "To prove this, I looped through 1,000 iterations of the process below:", "Below are the results of this iterated sampling:", "It can easily be seen (and is confirmed via multi-factorial ANOVA) that stratified samples have significantly lower root mean-squared error at every level of data compression. Again, this is specifically because the stratified sample preserves changes in the hazard rate over time, while the simple random sample does not.", "First, we looked at different ways to think about event occurrences in a population-level data set, showing that the hazard rate was the most accurate way to buffer against data sets with incomplete observations.", "Then, we discussed different sampling methods, arguing that stratified sampling yielded the most accurate predictions. This was demonstrated empirically with many iterations of sampling and model-building using both strategies.", "This strategy applies to any scenario with low-frequency events happening over time. In social science, stratified sampling could look at the recidivism probability of an individual over time. In medicine, one could study the time course of probability for a smoker going to the hospital for a respiratory problem, given certain risk factors. In engineering, such an analysis could be applied to rare failures of a piece of equipment.", "While these types of large longitudinal data sets are generally not publicly available, they certainly do exist \u2014 and analyzing them with stratified sampling and a controlled hazard rate is the most accurate way to draw conclusions about population-wide phenomena based on a small sample of events.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist, MS Candidate, cyclist, and below-average chess player. I strive to understand and explain complex mechanisms using accessible language."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2c2582aa9805&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@edwagnr?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@edwagnr?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Edward Wagner"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc80323e129a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&user=Edward+Wagner&userId=c80323e129a5&source=post_page-c80323e129a5----2c2582aa9805---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/edwagner07/survival_analysis/blob/master/survival_code_markdown.md", "anchor_text": "here"}, {"url": "https://www.tandfonline.com/doi/abs/10.1080/01621459.1958.10501452", "anchor_text": "Nonparametric Estimation from Incomplete Observations"}, {"url": "https://www.jstor.org/stable/270718?casa_token=0vk-lNdwoe8AAAAA:-xVR-nQnDGuDdxr5VEtsERJW9tQ-6JCpU4FAtGlXLqBy3xwffLiodC9KNuA5Qqm-PWOOJjaFcCOFKSIehvjQz0I7ICaREaRkZ8lmsrrlfOq6gP83sl_KdQ&seq=1#metadata_info_tab_contents", "anchor_text": "Alison (1982)"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2c2582aa9805---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/survival-analysis?source=post_page-----2c2582aa9805---------------survival_analysis-----------------", "anchor_text": "Survival Analysis"}, {"url": "https://medium.com/tag/logistic-regression?source=post_page-----2c2582aa9805---------------logistic_regression-----------------", "anchor_text": "Logistic Regression"}, {"url": "https://medium.com/tag/r?source=post_page-----2c2582aa9805---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&user=Edward+Wagner&userId=c80323e129a5&source=-----2c2582aa9805---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&user=Edward+Wagner&userId=c80323e129a5&source=-----2c2582aa9805---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2c2582aa9805&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2c2582aa9805---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2c2582aa9805--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2c2582aa9805--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2c2582aa9805--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@edwagnr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@edwagnr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Edward Wagner"}, {"url": "https://medium.com/@edwagnr/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc80323e129a5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&user=Edward+Wagner&userId=c80323e129a5&source=post_page-c80323e129a5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fc80323e129a5%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsurvival-analysis-and-the-stratified-sample-2c2582aa9805&user=Edward+Wagner&userId=c80323e129a5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}