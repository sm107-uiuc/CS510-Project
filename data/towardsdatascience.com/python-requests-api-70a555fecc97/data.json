{"url": "https://towardsdatascience.com/python-requests-api-70a555fecc97", "time": 1683004226.6528919, "path": "towardsdatascience.com/python-requests-api-70a555fecc97/", "webpage": {"metadata": {"title": "Python API example with threading, retry, and caching | Towards Data Science", "h1": "Working with API in Python.", "description": "Python API example with threading, retry, and caching"}, "outgoing_paragraph_urls": [{"url": "https://jsonplaceholder.typicode.com/", "anchor_text": "SON placeholder fake API", "paragraph_index": 1}], "all_paragraphs": ["With the advent of microservices, there are a lot of APIs for interacting with, whether for orchestrated systems or to extract data. Using Python for the dedicated APIS workload is appropriate because of its versatile nature.", "In this article, I share with you 3 code snippets that will help you better manage your APIS dependent workflows. I will use for demo purposes the JSON placeholder fake API.", "When you want to make several calls to the same resource with a changing parameter, you have to move towards a concurrent approach. Indeed, writing sequential code will produce inefficient code: your code will spend most of the time waiting for a response from the server.", "To solve this problem, there are two approaches either we use threads or since python 3.5 we can use asynchronism. Let\u2019s take a look at what the code looks like for these two approaches in order to retrieve comments individually. Let\u2019s begin with the Thread approach.", "I use a dataclass to encapsulate the logic of initializing the whole process. Threads are workers, each of them calls a URL concurrently. They pull a URL from a queue which is a data structure that supports concurrency. When they receive the answer, they put it in another queue. Finally when all the workers have finished we convert the queue into a list and we return it.", "Now let\u2019s look at the asynchronous version.", "In this version, we don\u2019t have to deal with concurrency and multiple threads, because there are no concurrent threads being spawn. Indeed, asynchronous code is based on the event loop and coroutines, to summarize, instead of waiting for IO code to resolve we are executing another piece of code and we return to the IO code when it is resolved.", "However, in order to be able to wait for code and delegating control, we have to work with asynchronous functions which implies a paradigm shift and work with new libraries.", "Because, as you can see, the disadvantage of the async version is not being able to use the usual libraries eg requests. Indeed it is necessary to use the library which supports asynchronism.", "On the other hand, the disadvantage of threads is that one must think about managing concurrent threads with dedicated data structures.", "When working with APIs, it is not uncommon for there to be throttling. It may be interesting to have a utility that allows you to retry a function when it fails. To implement this utility, I used a python feature that is really very useful for a lot of situations: decorators.", "This is a decorator who does not have the form of a function which traditionally the way of presenting them. Here it is a class.Decorators implemented in the form of a class are interesting when there is a need to keep a state in memory. Here we need to keep the number of attempts in memory.", "This decorator, therefore, allows us to specify the number of times that the decorated function must be retried but also to specify a waiting time between each attempt.", "When you have to make a large number of calls to an API which has for example a limit per day, and your script fails by mistake towards the end, you lose the results of the call to the API.", "In this situation, it may be interesting to implement a cache that saves our results as we go along like this the next time we launch our script, only non-cached requests will be executed. Below is an example of code that implements a local cache.", "This cache is implemented as a class. The local cache is nothing more than a dict where we save the data with the URL as a key. This cache is then saved locally in the form of a serialization pickle file. During the second execution of the script, the cache will be loaded and the results will be drawn from it.", "However, although it is suitable this cache does not allow working with threads. This will require implementing another cache and using for example something more robust like REDIS.", "Therefore, you can create an interface as done above, which will define the skeleton of all your cache. Now you can create a new cache implementation without changing your entire script.", "Another improvement to be made would be to manage the validity of the cache, indeed here the cache does not manage it, you will have to manually invalidate the cache, which is not done in this simple example.", "In this article, we saw how to use advanced python features and software engineering concepts to improve scripts interacting with APIS. Hope this was helpful to you.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F70a555fecc97&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://matgonzalez.medium.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": ""}, {"url": "https://matgonzalez.medium.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Matt"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f143ca0492c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&user=Matt&userId=1f143ca0492c&source=post_page-1f143ca0492c----70a555fecc97---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@goshua13?utm_source=medium&utm_medium=referral", "anchor_text": "Joshua Aragon"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://jsonplaceholder.typicode.com/", "anchor_text": "SON placeholder fake API"}, {"url": "https://medium.com/tag/data-science?source=post_page-----70a555fecc97---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----70a555fecc97---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/software-development?source=post_page-----70a555fecc97---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/programming?source=post_page-----70a555fecc97---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/technology?source=post_page-----70a555fecc97---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&user=Matt&userId=1f143ca0492c&source=-----70a555fecc97---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&user=Matt&userId=1f143ca0492c&source=-----70a555fecc97---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F70a555fecc97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----70a555fecc97---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----70a555fecc97--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----70a555fecc97--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----70a555fecc97--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----70a555fecc97--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----70a555fecc97--------------------------------", "anchor_text": ""}, {"url": "https://matgonzalez.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://matgonzalez.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matt"}, {"url": "https://matgonzalez.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "317 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f143ca0492c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&user=Matt&userId=1f143ca0492c&source=post_page-1f143ca0492c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc22ff882907b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-requests-api-70a555fecc97&newsletterV3=1f143ca0492c&newsletterV3Id=c22ff882907b&user=Matt&userId=1f143ca0492c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}