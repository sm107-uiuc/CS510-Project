{"url": "https://towardsdatascience.com/user-churn-prediction-using-spark-22ff8dafb5c", "time": 1683000983.951503, "path": "towardsdatascience.com/user-churn-prediction-using-spark-22ff8dafb5c/", "webpage": {"metadata": {"title": "User churn prediction using Spark | by Simone Rigoni | Towards Data Science", "h1": "User churn prediction using Spark", "description": "This project is the final project of the Udacity Data Scientist Nanodegree Program: Data Scientist Capstone. The goal is to predict if a user is going to churn from the fictional digital music\u2026"}, "outgoing_paragraph_urls": [{"url": "https://eu.udacity.com/", "anchor_text": "Udacity", "paragraph_index": 0}, {"url": "https://neilpatel.com/blog/improve-by-predicting-churn/", "anchor_text": "post", "paragraph_index": 1}, {"url": "http://www.davidsbatista.net/blog/2018/08/19/NLP_Metrics/", "anchor_text": "post", "paragraph_index": 10}, {"url": "https://aws.amazon.com", "anchor_text": "AWS", "paragraph_index": 38}, {"url": "https://aws.amazon.com/blogs/aws/aws-update-new-m3-features-reduced-ebs-prices-reduced-s3-prices/", "anchor_text": "here", "paragraph_index": 39}, {"url": "https://github.com/simonerigoni/data_scientist_capstone", "anchor_text": "repository", "paragraph_index": 44}, {"url": "https://simonerigoni01.blogspot.com/2023/01/previsione-dellabbandono-degli-utenti.html", "anchor_text": "post", "paragraph_index": 44}], "all_paragraphs": ["This project is the final project of the Udacity Data Scientist Nanodegree Program: Data Scientist Capstone. The goal is to predict if a user is going to churn from the fictional digital music service Sparkify", "Churn prediction is one of the most popular Big Data use cases in business. As better explained in this post its goal is to determine whether or not a customer is going to cancel his subscription to a service", "Let\u2019s start by using the CRISP-DM Process (Cross Industry Process for Data Mining):", "Sparkify is a digital music service which can be used for free by listening to some advertisement in between the songs or by paying a monthly subscription fee to have an ads free experience. In any time the users can decide to downgrade from premium to free, upgrade from free to premium or to cancel from the service.", "The dataset provided is basically composed by the log of each user action on the platform. Each action is marked with a timestamp ts", "From the small dataset we have 286500 records from 225 users:", "54% of the interaction are from free users and 46% from premium users", "The records have a time span from October 2018 to December 2018", "The first step was to delete all records with empty userId. The empty string userId most likely refers to users who have not signed up yet or who are signed out and are about to log in therefore we can remove these records.", "Then I have defined a new Churn column that will be used as label for the model. Basically if a user has ever visited the Cancellation Confirmation page we will mark it as churned. Of course this event can happen for both paying and free users.", "We obtain 23% churned and 77 % not churned users therefore the dataset is a pretty imbalanced. As explained in this awesome post we must keep this in mind when we will talk about metrics in the Evaluate the Results section", "Then I made a comparison of some features considering also the Churn value:", "All the categorical features that can be useful for our task has been one-hot encoded and aggregated by userId:- gender- level- page", "Then we added some interesting engineered features by asking this questions:- How long have users subscribed to the service? Is churn related to that?- Last month activity (for churned user the cancellation is the last month before cancellation) divided in weeks- How many artists did a user listen to?", "The final dataset ready for ML looks like this:", "It is important to not consider attributes like page_Cancellation_Confirmation or page_Cancel because they map exactly the label column so the Accuracy will be always 100% because we are basically learning the value we want to predict", "A Confusion Matrix is a table that is often used to describe the performance of a classification model on a set of test data for which the true values are known.", "Accuracy measures how often the classifier makes the correct prediction. It\u2019s the ratio of the number of correct predictions to the total number of predictions:", "Accuracy = (True Positives + True Negative) / (True Positives + False Positives + True Negatives + False Negatives)", "Precision tells us what proportion of the correct prediction actually were correct. It is a ratio of true positives to all positives:", "Precision = True Positives / (True Positives + False Positives)", "Recall (Sensitivity) tells us what proportion of prediction that actually were correct were classified by us as correct. It is a ratio of true positives to all predictions that were actually positive:", "Recall = True Positives / (True Positives + False Negative)", "F-beta score is a metric that considers both precision and recall:", "The purpose of generating a Naive Predictor is simply to show what a base model without any intelligence would look like. As already said, by looking at the distribution of the data, it is clear that most users do not churn. Therefore a model that always predicts '0' (i.e. the user do not visit page Cancellation Confirmation) will generally be right.", "The naive model which labels all users with churn = 0 does a good job on test set, with Accuracy of 81.2% and F1 score of 0.7284", "The fact that the dataset is imbalanced also means that Accuracy is not very helpful because even if we obtain high accuracy the actual predictions are not necessarily that good. It is usually recommended to use Precision and Recall in this cases", "Let\u2019s compare the results of 3 models:", "The first step was remove the unnecessary columns for the training", "then all the features has been vectorized (no conversion needed because all the feature were already numbers)", "the StandarScaler() was used to scale the data", "Then I have split data into train, test and validation dataset", "For all models I have used F1 score as metrics", "and ParamGridBuilder() and 3 folds CrossValidator() to determine the best hyperparameters for the models considering all the parameters", "GBT also allows to see the features importances:", "We can see that the registration_days and count_page_last_week have the highest importances", "Overall Logistic Regression has the best results with a F-1 Score of 0.8218 on test dataset and 0.7546 on validation dataset", "The first time I tried to tune manually some parameters for the models but the best results has been obtained by letting the ParamGridBuilder() and CrossValidator() search for all parameters", "As suggested from Cloud Deployment Instructions for DSND Capstone Project I have created a Cluster with AWS", "As explained better here the m3.xlarge is a Second Generation General-purpose EC2 instance equipped with high frequency Intel Xeon E5\u20132670 and 2 x 40 GB SSD-based instance storage", "Then I have created a Notebook and copy-pasted the necessary code", "21% of the interaction are from free users and 79% from premium users", "The small dataset was a good representation of the real dataset, meaning it seems it is not biased", "Our goal was to predict if a user is going to cancel from the service to enable the company to make him offers or discount in order to try to retain these users. After cleaning the data and modeling them into a dataset ready to be used for ML training we tested the performance of three different models. All the resulting models were successful in predicting if a user is going to leave the service or not far better than a Naive Predictor that is giving always answer '0' (users are not going to churn). Considering F-1 Score the best model is Logistic Regression. Despite the good results the model could be improved by crafting more engineered feature to capture some behaviour pattern that could be related to the user satisfaction of the service: is the recommendation engine good? Meaning the song recommended to users really meets their tastes. From the features importances of GBT the raw features page_Thumbs_Up and page_Thumbs_Down are pretty important so a new feature capturing users music tastes caan really improve the model", "The code for this project can be found in this github repository and on my Blogspot it is available a post in Italian.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F22ff8dafb5c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://simone-rigoni01.medium.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": ""}, {"url": "https://simone-rigoni01.medium.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Simone Rigoni"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3bb0955a9785&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&user=Simone+Rigoni&userId=3bb0955a9785&source=post_page-3bb0955a9785----22ff8dafb5c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://eu.udacity.com/", "anchor_text": "Udacity"}, {"url": "https://neilpatel.com/blog/improve-by-predicting-churn/", "anchor_text": "post"}, {"url": "https://www.udacity.com/course/data-scientist-nanodegree--nd025", "anchor_text": "https://www.udacity.com/course/data-scientist-nanodegree--nd025"}, {"url": "http://www.davidsbatista.net/blog/2018/08/19/NLP_Metrics/", "anchor_text": "post"}, {"url": "https://aws.amazon.com", "anchor_text": "AWS"}, {"url": "https://aws.amazon.com/blogs/aws/aws-update-new-m3-features-reduced-ebs-prices-reduced-s3-prices/", "anchor_text": "here"}, {"url": "https://github.com/simonerigoni/data_scientist_capstone", "anchor_text": "repository"}, {"url": "https://simonerigoni01.blogspot.com/2023/01/previsione-dellabbandono-degli-utenti.html", "anchor_text": "post"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----22ff8dafb5c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----22ff8dafb5c---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/udacity?source=post_page-----22ff8dafb5c---------------udacity-----------------", "anchor_text": "Udacity"}, {"url": "https://medium.com/tag/data-science?source=post_page-----22ff8dafb5c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&user=Simone+Rigoni&userId=3bb0955a9785&source=-----22ff8dafb5c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&user=Simone+Rigoni&userId=3bb0955a9785&source=-----22ff8dafb5c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F22ff8dafb5c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----22ff8dafb5c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----22ff8dafb5c--------------------------------", "anchor_text": ""}, {"url": "https://simone-rigoni01.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://simone-rigoni01.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Simone Rigoni"}, {"url": "https://simone-rigoni01.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "126 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3bb0955a9785&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&user=Simone+Rigoni&userId=3bb0955a9785&source=post_page-3bb0955a9785--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F540756b5a194&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuser-churn-prediction-using-spark-22ff8dafb5c&newsletterV3=3bb0955a9785&newsletterV3Id=540756b5a194&user=Simone+Rigoni&userId=3bb0955a9785&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}