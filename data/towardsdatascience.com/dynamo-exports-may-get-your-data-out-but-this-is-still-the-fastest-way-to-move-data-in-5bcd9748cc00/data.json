{"url": "https://towardsdatascience.com/dynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00", "time": 1683016540.6799738, "path": "towardsdatascience.com/dynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00/", "webpage": {"metadata": {"title": "Importing 100M+ Records into DynamoDB in Under 30 Minutes | by Paul Singman | Towards Data Science", "h1": "Importing 100M+ Records into DynamoDB in Under 30 Minutes", "description": "No longer will anyone suffer while setting up the process of doing a full export of a DynamoDB table to S3. The same cannot be said, however, for someone looking to import data into a Dynamo table\u2026"}, "outgoing_paragraph_urls": [{"url": "https://aws.amazon.com/about-aws/whats-new/2020/11/now-you-can-export-your-amazon-dynamodb-table-data-to-your-data-lake-in-amazon-s3-to-perform-analytics-at-any-scale/", "anchor_text": "full export", "paragraph_index": 0}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "to how many", "paragraph_index": 14}, {"url": "https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Limits.html", "anchor_text": "writes per second a single", "paragraph_index": 14}, {"url": "https://twitter.com/home", "anchor_text": "Twitter", "paragraph_index": 30}], "all_paragraphs": ["No longer will anyone suffer while setting up the process of doing a full export of a DynamoDB table to S3.", "The same cannot be said, however, for someone looking to import data into a Dynamo table. Particularly a large amount of data and fast.", "The need for quick bulk imports can occur when records in a table get corrupted, and the easiest way to fix them is do a full table drop-and-recreate. Or when streaming data into a table, it can be useful to run a nightly batch \u201ctrue-up\u201d job to correct any intra-day anomalies that may have occurred.", "Reducing the time to completion for these types of jobs from over an hour to under a minute gives you more confidence in the state of your data at any given point in time. And it provides a more stable foundation for low-latent applications to be built on top of your data.", "Say we have data in an S3 bucket at point A, and we want to move it into a Dynamo table at point B\u2026 how do we do this?", "Well, the simplest approach is to write a little script that reads the file into a DataFrame object, loops through that object\u2019s rows, and then does a dynamo.Table().batch_writer().put_item() operation to insert items into the table.", "Running this script on a 500k row DataFrame results in the following write performance:", "As you can see, the number of writes per second (w/s) to the table gets capped at about 650 w/s. Amazon indicates that the true limit of a single-process writing to Dynamo is 1,000 w/s, but due to network and other overhead, the observed value is lower (running locally from my laptop).", "For 500,000 records, it takes about 15 minutes to insert all the records into the table. Depending on your use case, this might be acceptable. But for bulk inserts of larger datasets \u2014 say 100 million rows(!) \u2014 it\u2019s clear that improving the write throughput rate would be helpful.", "To increase write performance it is clear there needs to be more than one process writing to the table. So how do we enable multiple processes to write in parallel?", "The most elegant way I\u2019ve found to achieve this is to invoke multiple Lambda Function writer instances simultaneously. Each one picks up a slice of the dataset and writes it to the Dynamo table in parallel.", "The way this works is by setting a Lambda function to trigger off an SQS queue. This means that if a message is placed on the queue, the Lambda function will invoke and execute its code \u2014 taking the SQS message value as a function input parameter.", "To go a step further \u2014 if such a Lambda were to contain code like in the simple_dynamo_write.py snippet above, and the message placed on the queue is an S3 filepath pointer to the data we want written, then it should be clear how this data will make it\u2019s way into Dynamo!", "Each Lambda instance will write to the table at 750-to-1000 w/s, so once we get multiple going at the same time, we can achieve write speeds much higher!", "The trick is to split up and organize the data in such a way that Lambda can process it efficiently without error. There are AWS-imposed limits to how many Lambdas can be invoked simultaneously (1,000), how long a single Lambda invocation can run before it shuts down (15 min), and how many writes per second a single Dynamo table can handle (40,000).", "It\u2019s always smart to know the relevant quotas when working with a service, and in general AWS does a good job of documenting and making this information available.", "With these limits in mind, it should be clear that with full parallelization we cannot distribute the dataset into more than 1000 SQS messages \u2014 otherwise we\u2019ll hit the limit of 1000 simultaneous Lambda invocations.", "Each file also can\u2019t be too big, otherwise it\u2019ll take more than 15 minutes for a Lambda to write it to the table (as a reminder, it took nearly 15 minutes to write a 500,000 row file earlier). It would not be good for a Lambda to shut down mid-file, since there would be no way to guarantee all rows get written without re-processing the entire file.", "The way to control for all of these factors is to create a maximum of 40 SQS messages composed of comma-separated strings of the data\u2019s S3 filepaths.", "For example, if we have 3 files in S3 to write into Dynamo, we could create an SQS message like:", "With this message as an input, what the Lambda does is:", "So after writing one file, the new SQS message created will look like the below, and crucially a new instance of the Lambda function will almost immediately invoke to start processing file2.", "And once file2 gets processed, a new SQS message gets placed on the queue:", "And after file1 gets written, no more queue messages are generated, no more Lambdas get invoked, and there\u2019s no more data not in the Dynamo table!", "To give a more tangible image of this recursive strategy, here\u2019s an example Lambda function code:", "Now, instead of the bounded write capacity metrics graph, you\u2019ll be seeing more exciting visuals like this!", "With this architecture, we can achieve writes per second speeds of up to 40k into Dynamo, since up to 40 processes can run in parallel, each writing at 1k rows per second.", "Whereas before a 100M row dataset would take 40 hours at 1,000 w/s, at the increased rate we can import the full dataset in just 40 minutes! (As an aside, the 40k max write speed limit on a Dynamo table is simply the AWS default, and can be increased upon request).", "In working with Dynamo as the backend for several data-intensive applications, I\u2019ve found it extremely useful to have the ability to refresh the full dataset quickly in this way. In situations where specific rows may have become corrupted or mis-processed, more surgical approaches to fixing the data can be error-prone and time consuming, and are not recommended.", "Lastly, there are a couple other factors I didn\u2019t get a chance to cover in the article, like ideal handling of the Dynamo Capacity mode, and how related processes like Dynamo streams are impacted.", "If curious about these, ask in the comments below or reach out on Twitter.", "Thank you to Ryan Kelly and Michael Petryszyn for inspiration for this article.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data @ Meta. Whisperer of data and productivity wisdom. Standing on the shoulders of giants."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5bcd9748cc00&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://psingman.medium.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b----5bcd9748cc00---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@jeremybishop?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Jeremy Bishop"}, {"url": "https://unsplash.com/s/photos/background?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://aws.amazon.com/about-aws/whats-new/2020/11/now-you-can-export-your-amazon-dynamodb-table-data-to-your-data-lake-in-amazon-s3-to-perform-analytics-at-any-scale/", "anchor_text": "full export"}, {"url": "https://unsplash.com/@kvedula?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Kamesh Vedula"}, {"url": "https://unsplash.com/s/photos/black-hole?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "to how many"}, {"url": "https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Limits.html", "anchor_text": "writes per second a single"}, {"url": "https://twitter.com/home", "anchor_text": "Twitter"}, {"url": "https://medium.com/whispering-data/transcribe-your-zoom-meetings-for-free-with-aws-963f39a2aa3f", "anchor_text": "Transcribe Your Zoom Meetings For Free with AWS!If you agree that \u201cthe faintest ink is more powerful than the strongest memory\u201d then you should know how to cheaply\u2026medium.com"}, {"url": "https://medium.com/whispering-data/tackling-fragmentation-in-serverless-data-pipelines-b4027f506ee5", "anchor_text": "Tackling Fragmentation in Serverless Data PipelinesHow to stay sane when managing tens-to-hundreds of lambda-backed repositories\u2026medium.com"}, {"url": "https://medium.com/tag/aws?source=post_page-----5bcd9748cc00---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/serverless?source=post_page-----5bcd9748cc00---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----5bcd9748cc00---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/python?source=post_page-----5bcd9748cc00---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/programming?source=post_page-----5bcd9748cc00---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&user=Paul+Singman&userId=d810baa7423b&source=-----5bcd9748cc00---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&user=Paul+Singman&userId=d810baa7423b&source=-----5bcd9748cc00---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5bcd9748cc00&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5bcd9748cc00---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5bcd9748cc00--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://psingman.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc7186ddb0db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdynamo-exports-may-get-your-data-out-but-this-is-still-the-fastest-way-to-move-data-in-5bcd9748cc00&newsletterV3=d810baa7423b&newsletterV3Id=c7186ddb0db1&user=Paul+Singman&userId=d810baa7423b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}