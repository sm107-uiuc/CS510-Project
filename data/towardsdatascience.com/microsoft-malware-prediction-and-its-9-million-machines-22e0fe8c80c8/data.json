{"url": "https://towardsdatascience.com/microsoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8", "time": 1682995462.3220422, "path": "towardsdatascience.com/microsoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8/", "webpage": {"metadata": {"title": "\u201cMicrosoft Malware Prediction\u201d and its 9 million machines | by James Dietle | Towards Data Science", "h1": "\u201cMicrosoft Malware Prediction\u201d and its 9 million machines", "description": "Kaggle recently finished the competition \u201cMicrosoft Malware\u201d which asks you to predict if a computer is infected. The competition states As a cybersecurity practitioner, this was a fantastic\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/microsoft-malware-prediction", "anchor_text": "Microsoft Malware", "paragraph_index": 0}, {"url": "https://github.com/jamesdietle/Kaggle2019/tree/master/microsoft-malware-kaggle", "anchor_text": "Github here", "paragraph_index": 5}, {"url": "https://www.kaggle.com/cdeotte/time-series-eda-malware-0-64", "anchor_text": "Chris Deotte\u2019s provides a great example above", "paragraph_index": 17}, {"url": "https://www.kaggle.com/gemartin/load-data-reduce-memory-usage", "anchor_text": "found here", "paragraph_index": 33}], "all_paragraphs": ["Kaggle recently finished the competition \u201cMicrosoft Malware\u201d which asks you to predict if a computer is infected. The competition states", "\u201cThe malware industry continues to be a well-organized, well-funded market dedicated to evading traditional security measures. Once a computer is infected by malware, criminals can hurt consumers and enterprises in many ways. With more than one billion enterprise and consumer customers, Microsoft takes this problem very seriously and is deeply invested in improving security.\u201d", "As a cybersecurity practitioner, this was a fantastic opportunity with a substantial amount of data to try and ask questions like:", "Unfortunately, the competition answers more questions around machine learning rather than malware prevention or patching best practices.", "This Kaggle competition provides tabular data for us to explore and my first jump back into a Kaggle competition after concentrating on business school, circuit board design, and moving into a new role at work.", "Here are the learning points during my 8 days of furious coding. (You can find my code for the competition on Github here and can run it at your leisure.)", "The dataset for this competition is rather large, and if you don\u2019t have enough RAM in your GPU, you can move to a cloud environment or reduce features or the set to make it work. I use a custom built computer with a graphics card that has 8gb of RAM.", "Before even looking at the data it is essential to realize the number of variables present. Over 9 million machine identifiers are in this dataset, and by the end of the competition, I had around 100 different categories for each computer.", "Yes, that\u2019s just shy of a billion data points trying to determine if the computer is infected.", "Looking at columns, we see how some features would be useful in determining if the computer would be infected. Items like:", "These 3 features are apparent candidates to explore to determine if the machine would be infected. After all, if you aren\u2019t updating your AV signature, not running AVProducts, or are running Windows XP, you are an easier target.", "Other values are a little more difficult and require a little bit of feature engineering:", "In these cases the feature significance is nuanced. That is the fun in these completions.", "Maybe it is all the compliance training. However, I kept wanting to turn this into a time series problem. After all, the issue isn\u2019t which AV is present but how long it have they been out of date.", "Security is told to keep patching up-to-date. If we don\u2019t know how out of date something is\u2026 how can we determine if it is more at risk for infection.", "However, the competition organizers explicitly states that this wasn\u2019t a time series problem. In a silly act of tunnel vision, that didn\u2019t stop me from trying to creating numbers predicting if the computer was out of date.", "I wasn\u2019t the only one, the competition ran into a big trap when people discovered that you if the computer has automatic updates and you compare the release date of the AVSigversion with to that date.", "Many people speculated that the competition still had time series elements hidden within the data and for good reason. Many Kaggle competitions have hidden data. Several users discussed AVSignatures from the training set and compared it to Public/Private you saw a significant leftward shift for those AVSignature time variables. Chris Deotte\u2019s provides a great example above. The training set looked like it had older data than Public/Private.", "There are several things I do differently chasing the false time series problem:", "1. My validation set is built to use more recent data ensuring that it is a better representation of the public/private dataset.", "2. I created additional parameters surrounding days since patching. By setting a baseline of the last known patch, I could see how far the value was from the provided output. This technique provides excellent metrics for days out of compliance. I was particularly proud of this but got rid of the function as I was not seeing improvements to different models.", "Additionally, there was an external dataset that found a correlation between the AV Signatures and the number of vulnerabilities they solved. So how can we use this?", "Ideally, we would want to see which patches were being put out and if the system was behind in patching. If we knew how many patches out of date a system was, we would be able to create a feature for this. Then we would be able to see if there was a correlation between keeping items up-to-date and detections.", "However, since we don\u2019t have that data, I tried a guess of when the data was pulled by taking the latest date. The numbers didn\u2019t tie back into anything exciting and didn\u2019t prove to be very useful.", "It\u2019s important to note that this is true more because of the competition. As practitioners if we had the dates the machines were collected we could have engineered quite a few more features ( like the number of vulnerability exposed, patches behind, etc.) to pull some interesting insights.", "With such a large dataset, memory becomes a significant problem for many people. Even loading the data was difficult because everything came in as an int64. Even bools start as int64. This bloated method for assigning memory caused some machines to crash during loading.", "Going through and reducing these down a bit, you might seem like a poor use of time. 2 bytes or 8 bytes who cares? Everyone should!", "When there are 8 Million record and 100 columns you have about 6.4 gigabytes of information you are trying to store. Also, you need to load a test set, which would be another 6.3 gigabytes. Suddenly, you are looking at 12.7 GB of data, most of it wasted space.", "Therefore, I wouldn\u2019t have even been able to load that into a consumer GPU. NVIDIA 1080 TI tops off at 11 GB. By using dtypes, we can reduce it down quite a bit.", "The first trick is setting the data types to smaller sizes where it makes sense. Just enough so that you can load in the data without a memory error.", "To do so, you need to make some sanity checks. You need to balance between how you can reduce the dtype while still having enough space for all of your unique variables. Let\u2019s remember while there are 8 million records for the city. There are only X unique city identifiers. We are passed an id for cities so we could see the city \u201c42\u201d 7,000 times while city \u201c28,930\u201d only appears 2 times.", "The same thing happens for categories. This data often comes in as a string, therefore, we use categories to change to say that these are unique and to group them.", "If the size of your array is lower than 32,768 uniques, you are safe to turn it into an int16. Unique cities number over 100,000 so we use float32 instead of Int64. IsBeta is boolean, so we can make it int8.", "If we make it too small, we have problems, but if it is too big, we waste space, which brings in my love of reduce_mem_usage (found here) which finds the optimal value for your data and your unique. While you would have to get the dataset to load manually, you don\u2019t have to spend more time finding the optimal values for all your variables.", "After running reduce_mem-usage, you can see a dramatic cut in memory. Suddenly we have something much smaller. As you can see below, my size drops from 7 GB down to 1.67 GB", "Which then allows me to put more data into the data frame for my GPU.", "Another method I enjoyed was splitting the program into two sections.", "By splitting the builder and the learner, I can keep the code cleaner, and it allows me to run it with different options more easily. Plus experiments go faster. If something crashes in the learner, I can shave 10 minutes offloading off of the reset.", "We end with a list of probability for each machine having malware. Ideally, we should see a saddle where the highest number is either on 0 or 1. If you take just a few training epochs you see this Space Invaders looking thing suggesting with more training we would get there. It was not as effective as the top public kernels which are somewhat disappointing.", "More data exploration and feature work- Probably the biggest problem was not better understanding how significant some of the features were in the problem. I should have checked more for interdependence.", "Data subsampling- Typically as a dataset gets this big you should go back and break items into subsampling and then later aggregate results.", "Adversarial analysis- I need to do a better job understanding how to compare my training set, validation set, and public test. It didn\u2019t seem like these were as close to each other as I would have liked.", "AUCROC- I used cross-entropy for a loss function. However, I should have looked further into using AUCROC instead. While I could print off a metric, I was not able to better explore the feasibility of it.", "Embedding Sizes- It seems like some embeddings exploded outward with many examples of 1s or 2s of unique values in a test set. For example, if Chicago only has a sample size of 2, should that feature be used? It would neither help you determine if there was an infection or not.", "y_range- I should have kept it in and as a tensor to keep moving things forward quickly.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Afflicted with technical wanderlust. Father, Hacker, Veteran, HBS Alumni, @Fastai student"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F22e0fe8c80c8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@JamesDietle?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamesDietle?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "James Dietle"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F557cc66a323a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&user=James+Dietle&userId=557cc66a323a&source=post_page-557cc66a323a----22e0fe8c80c8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/c/microsoft-malware-prediction", "anchor_text": "Microsoft Malware"}, {"url": "https://github.com/jamesdietle/Kaggle2019/tree/master/microsoft-malware-kaggle", "anchor_text": "Github here"}, {"url": "https://www.kaggle.com/cdeotte/time-series-eda-malware-0-64", "anchor_text": "Chris Deotte\u2019s provides a great example above"}, {"url": "https://www.kaggle.com/gemartin/load-data-reduce-memory-usage", "anchor_text": "found here"}, {"url": "https://github.com/jamesdietle/Kaggle2019/blob/master/microsoft-malware-kaggle/Microsoft-Dataloader-Mar10.ipynb", "anchor_text": "where I explore, create features, move, and manipulate data."}, {"url": "http://use%20pickle%20to%20save%20the%20information%20and%20move%20it%20over%20for%20the%20learner/", "anchor_text": "for building models, and running the learning epochs."}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----22e0fe8c80c8---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/fastai?source=post_page-----22e0fe8c80c8---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/malware?source=post_page-----22e0fe8c80c8---------------malware-----------------", "anchor_text": "Malware"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----22e0fe8c80c8---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/cybersecurity?source=post_page-----22e0fe8c80c8---------------cybersecurity-----------------", "anchor_text": "Cybersecurity"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&user=James+Dietle&userId=557cc66a323a&source=-----22e0fe8c80c8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&user=James+Dietle&userId=557cc66a323a&source=-----22e0fe8c80c8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F22e0fe8c80c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----22e0fe8c80c8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----22e0fe8c80c8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamesDietle?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamesDietle?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "James Dietle"}, {"url": "https://medium.com/@JamesDietle/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "115 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F557cc66a323a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&user=James+Dietle&userId=557cc66a323a&source=post_page-557cc66a323a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fcce7b00ae87d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmicrosoft-malware-prediction-and-its-9-million-machines-22e0fe8c80c8&newsletterV3=557cc66a323a&newsletterV3Id=cce7b00ae87d&user=James+Dietle&userId=557cc66a323a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}