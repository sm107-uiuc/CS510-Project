{"url": "https://towardsdatascience.com/tutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80", "time": 1683008067.855028, "path": "towardsdatascience.com/tutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80/", "webpage": {"metadata": {"title": "[TUTORIAL]: Deploy ML model as REST API on Azure and protect it with SSL | by Ivan Zidov | Towards Data Science", "h1": "[TUTORIAL]: Deploy ML model as REST API on Azure and protect it with SSL", "description": "Data Scientists often forget that their new awesome models aren\u2019t so useful if they can't be used in production. In this tutorial, I will show you how you can deploy Tensorflow model to Azure\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.coursera.org/learn/advanced-deployment-scenarios-tensorflow/", "anchor_text": "Coursera course", "paragraph_index": 4}, {"url": "https://www.tensorflow.org/tfx/tutorials/serving/rest_simple", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://gist.github.com/mtigas/952344", "anchor_text": "gist", "paragraph_index": 23}, {"url": "https://medium.com/@jovanshernandez/what-is-nginx-f0a9c3a49a41", "anchor_text": "link", "paragraph_index": 26}, {"url": "https://medium.com/@samkreter/adding-ssl-tls-to-azure-container-instances-1e608a8f321c", "anchor_text": "blog", "paragraph_index": 26}, {"url": "https://fardog.io/blog/2017/12/30/client-side-certificate-authentication-with-nginx/", "anchor_text": "article", "paragraph_index": 26}, {"url": "https://mlinproduction.com/docker-for-ml-part-4/", "anchor_text": "dockerize the model", "paragraph_index": 37}], "all_paragraphs": ["Data Scientists often forget that their new awesome models aren\u2019t so useful if they can't be used in production. In this tutorial, I will show you how you can deploy Tensorflow model to Azure Container Instances and protect it with SSL.", "There will be 3 types of deployment:", "NOTE: If you don\u2019t have valid subscription, you can create a free account for Azure and receive 2 weeks of Trial period.", "Train Tensorflow model and save it with:tf.saved_model.save(model, \"path / to / model\")", "I won\u2019t go into the details of Tensorflow Serving because there is a great Coursera course. This code is used above is code used from this course, but only compressed for this demo. You can learn more about TFServing from here.", "Open terminal and navigate to the directory where you have saved the model.", "Now you have your model exposed thought an API on localhost, and you can be call it from terminal:", "You can now use your model in localhost.", "BONUS TIP: Another option is port forwarding. You connect to the machine with SSH.", "Used to store containers with models.Go to Azure portal and find Container Registries. Click on Add new registry button to create a new registry.", "You can now click on Review and Create this registry button.", "IMPORTANT: Navigate to your resource and enable admin user. Take a note of username and password.", "Congrats:You have successfully stored the container with the model", "After storing the container, it is fairly easy to expose the model.", "The easiest way is to log in to Azure portal, navigate to Container Instances and click Add button. After naming the container, pick a desired region and choose the registry where you have uploaded the model.", "NOTE:Size really depends on your model size. The size used in this example is more than enough for this model. I have deployed the model with ~150M parameters (600MB) and it needed 2 vcpu and 4 GB of memory.", "Now click on Next: Networking button.", "NOTE: DNS name is optional and it needs to be unique.", "Click on Review and Create and your model is ready to be used. (To delete an instance just navigate to resource and click on Delete button)", "Using the model is the same as using the one exposed locally, only difference being the URL. You can use a DNS URL or an IP URL.", "You have deployed a model that can be used over the Internet. You can monitor usage of model and upgrade the size of the container if needed, which makes it scalable.", "To protect API, we will need encryption. If you use commercial Certificate Authority, you can skip this step. We will create our own and self-sign certificates.", "You will be prompted to fill-out the form. Fill it out with your information.", "NOTE:This is an example of elliptic encryption for simplicity. I recommend using an RSA key. This is a great gist that explains how to do it.", "To reject all requests that don\u2019t have a valid certificate.", "Copy everything and paste it to a file. After pasting use CTRL+D to close editor.", "I won\u2019t go into the details of NGINX, but here is the link for the details. This configuration is a mixture of this blog and this article. In a nutshell, it only listens to https (port 443) and validates certificate that it receives. If a certificate is valid, it redirects decrypted request to container with model and encrypts response that is sent back to client.", "Copy everything and paste it to a file. After pasting use CTRL+D to close editor.", "We will use the sed command to replace parts of this template. These are the commands that you can run without editing.", "These commands have to be edited. Replace the bolded parts with location and password from the registry and use your DNS to replace DNS_NAME.", "Replace <AZURE RESOURCE GROUP> with your valid resource group and you are ready to go.", "Make sure that you have a proper path to client.key and client.pem and you can proceed to call the API like this:", "If everything works fine you will get a response like this one:", "IMPORTANT: Since this is a self-signed certificate, you must add -k flag in cURL.", "IMPORTANT: Since this is a self-signed certificate, you must set verify=False", "When called without a valid certificate:", "You can monitor the usage of the model in Container Instance and you can see request made in nginx logs.", "Q: Can I deploy a custom model (without TF Serving)?A: Yes. You have to dockerize the model and if you use the right ports, everything else should work as expected.", "Q: Can I deploy it to AWS?A: Yes, by using nginx.config and CA configuration seen in this blog.", "Q: Can I store the container on Docker Hub?A: Yes. Just replace image with username/repo:version from Docker Hub and remove imageRegistryCredentials from YAML file.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7ed6c7659f80&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ivan.zidov?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivan.zidov?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Ivan Zidov"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57b4df452939&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&user=Ivan+Zidov&userId=57b4df452939&source=post_page-57b4df452939----7ed6c7659f80---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@dtopkin1?utm_source=medium&utm_medium=referral", "anchor_text": "Dayne Topkin"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.coursera.org/learn/advanced-deployment-scenarios-tensorflow/", "anchor_text": "Coursera course"}, {"url": "https://www.tensorflow.org/tfx/tutorials/serving/rest_simple", "anchor_text": "here"}, {"url": "http://localhost:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "http://localhost:8501/v1/models/$MODEL_NAME:predict"}, {"url": "http://51.138.56.160/v1/models/use:predict", "anchor_text": "http://localhost:8501/v1/models/demo_model:predict"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "blogdemo.westeurope.azurecontainer.io"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "http://IP.ADDRESS:8501/v1/models/$MODEL_NAME:predict"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "IP.ADDRESS"}, {"url": "https://gist.github.com/mtigas/952344", "anchor_text": "gist"}, {"url": "https://medium.com/@jovanshernandez/what-is-nginx-f0a9c3a49a41", "anchor_text": "link"}, {"url": "https://medium.com/@samkreter/adding-ssl-tls-to-azure-container-instances-1e608a8f321c", "anchor_text": "blog"}, {"url": "https://fardog.io/blog/2017/12/30/client-side-certificate-authentication-with-nginx/", "anchor_text": "article"}, {"url": "https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict", "anchor_text": "https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "blogdemo.westeurope.azurecontainer.io"}, {"url": "https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict", "anchor_text": "https://IP.ADDRESS/v1/models/demo_model:predict"}, {"url": "http://blogdemo.westeurope.azurecontainer.io:8501/v1/models/$MODEL_NAME:predict", "anchor_text": "IP.ADDRESS"}, {"url": "https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict", "anchor_text": "https://blogdemo.westeurope.azurecontainer.io/v1/models/demo_model:predict"}, {"url": "https://mlinproduction.com/docker-for-ml-part-4/", "anchor_text": "dockerize the model"}, {"url": "https://www.coursera.org/learn/advanced-deployment-scenarios-tensorflow/", "anchor_text": "Advanced Deployment Scenarios with TensorFlow | CourseraBringing a machine learning model into the real world involves a lot more than just modeling. This Specialization will\u2026www.coursera.org"}, {"url": "https://www.tensorflow.org/tfx/tutorials/serving/rest_simple", "anchor_text": "Train and serve a TensorFlow model with TensorFlow Serving | TFXWarning: This notebook is designed to be run in a Google Colab only**. It installs packages on the system and requires\u2026www.tensorflow.org"}, {"url": "https://medium.com/@samkreter/adding-ssl-tls-to-azure-container-instances-1e608a8f321c", "anchor_text": "Adding SSL/TLS To Azure Container InstancesNowadays, SSL/TLS is a base requirement for any website or application that operates over the internet. Unfortunately\u2026medium.com"}, {"url": "https://www.ssltrust.com.au/help/setup-guides/client-certificate-authentication", "anchor_text": "Using Client-Certificate based authentication with NGINX on UbuntuAn authenticated SSL/TLS reverse proxy is a powerful way to protect your application from attack. Both users and bad\u2026www.ssltrust.com.au"}, {"url": "https://fardog.io/blog/2017/12/30/client-side-certificate-authentication-with-nginx/", "anchor_text": "Client-Side Certificate Authentication with nginxAuthentication in applications is tough. If you decide to roll your own, security issues are nearly guaranteed. Most\u2026fardog.io"}, {"url": "https://mlinproduction.com/docker-for-ml-part-4/", "anchor_text": "Using Docker to Generate Machine Learning Predictions in Real Time - ML in ProductionIf we want to generate predictions in real time, we need to expose our trained models. One way to expose our models is\u2026mlinproduction.com"}, {"url": "https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Reverse_proxy_h2g2bob.svg/1200px-Reverse_proxy_h2g2bob.svg.png", "anchor_text": "https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Reverse_proxy_h2g2bob.svg/1200px-Reverse_proxy_h2g2bob.svg.png"}, {"url": "https://miro.medium.com/max/800/1*dIKRcFllFP3_-yqCysDitw.png", "anchor_text": "https://miro.medium.com/max/800/1*dIKRcFllFP3_-yqCysDitw.png"}, {"url": "https://miro.medium.com/max/600/0*7eCQeU5D86SQeFHa.png", "anchor_text": "https://miro.medium.com/max/600/0*7eCQeU5D86SQeFHa.png"}, {"url": "https://cdn0.iconfinder.com/data/icons/home-security-2/45/security-06-512.png", "anchor_text": "https://cdn0.iconfinder.com/data/icons/home-security-2/45/security-06-512.png"}, {"url": "https://skillvalue.com/jobs/wp-content/uploads/sites/7/2019/10/data-scientist-freelance-remote-new-york.jpg", "anchor_text": "https://skillvalue.com/jobs/wp-content/uploads/sites/7/2019/10/data-scientist-freelance-remote-new-york.jpg"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7ed6c7659f80---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/dat?source=post_page-----7ed6c7659f80---------------dat-----------------", "anchor_text": "Dat"}, {"url": "https://medium.com/tag/ssl-certificate?source=post_page-----7ed6c7659f80---------------ssl_certificate-----------------", "anchor_text": "Ssl Certificate"}, {"url": "https://medium.com/tag/azure?source=post_page-----7ed6c7659f80---------------azure-----------------", "anchor_text": "Azure"}, {"url": "https://medium.com/tag/tensorflow-serving?source=post_page-----7ed6c7659f80---------------tensorflow_serving-----------------", "anchor_text": "Tensorflow Serving"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&user=Ivan+Zidov&userId=57b4df452939&source=-----7ed6c7659f80---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&user=Ivan+Zidov&userId=57b4df452939&source=-----7ed6c7659f80---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7ed6c7659f80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7ed6c7659f80---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7ed6c7659f80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivan.zidov?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivan.zidov?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ivan Zidov"}, {"url": "https://medium.com/@ivan.zidov/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "10 Followers"}, {"url": "https://www.linkedin.com/in/ivan-zidov/", "anchor_text": "https://www.linkedin.com/in/ivan-zidov/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57b4df452939&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&user=Ivan+Zidov&userId=57b4df452939&source=post_page-57b4df452939--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F57b4df452939%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftutorial-deploy-ml-model-as-rest-api-on-azure-and-protect-it-with-ssl-7ed6c7659f80&user=Ivan+Zidov&userId=57b4df452939&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}