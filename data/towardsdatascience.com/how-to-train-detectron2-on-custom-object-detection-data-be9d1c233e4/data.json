{"url": "https://towardsdatascience.com/how-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4", "time": 1683009870.989246, "path": "towardsdatascience.com/how-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4/", "webpage": {"metadata": {"title": "How to Train Detectron2 on Custom Object Detection Data | by Jacob Solawetz | Towards Data Science", "h1": "How to Train Detectron2 on Custom Object Detection Data", "description": "Detectron2 is a popular PyTorch based modular computer vision model library. It is the second iteration of Detectron, originally written in Caffe2. The Detectron2 system allows you to plug in custom\u2026"}, "outgoing_paragraph_urls": [{"url": "https://ai.facebook.com/blog/-detectron2-a-pytorch-based-modular-object-detection-library-/", "anchor_text": "Detectron2 release blog", "paragraph_index": 0}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "public blood cell detection", "paragraph_index": 2}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "public blood cell dataset", "paragraph_index": 3}, {"url": "https://colab.research.google.com/drive/1-TNOcPm3Jr3fOJG8rnGT9gh60mHUsvaW#scrollTo=wXisIbT1Zqou", "anchor_text": "Colab Notebook Implementing Detectron2 on Custom Data", "paragraph_index": 4}, {"url": "https://roboflow.ai", "anchor_text": "Sign up", "paragraph_index": 8}, {"url": "https://blog.roboflow.ai/getting-started-with-labelimg-for-labeling-object-detection-data/", "anchor_text": "getting started with LabelImg", "paragraph_index": 9}, {"url": "https://blog.roboflow.ai/getting-started-with-cvat/", "anchor_text": "getting started with CVAT", "paragraph_index": 9}, {"url": "https://blog.roboflow.ai/custom-open-images-datasets/", "anchor_text": "building a free object detection dataset from Open Images", "paragraph_index": 10}, {"url": "https://app.roboflow.ai/", "anchor_text": "create a free account", "paragraph_index": 11}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md", "anchor_text": "Detectron2 model zoo", "paragraph_index": 19}, {"url": "https://blog.roboflow.ai/what-is-mean-average-precision-object-detection/", "anchor_text": "breaking down mAP", "paragraph_index": 25}, {"url": "https://blog.roboflow.ai/what-is-mean-average-precision-object-detection/", "anchor_text": "breaking down mAP", "paragraph_index": 30}, {"url": "https://blog.roboflow.ai/how-to-train-yolov5-on-a-custom-dataset/", "anchor_text": "How to Train YOLOv5", "paragraph_index": 37}, {"url": "https://blog.roboflow.ai/training-yolov4-on-a-custom-dataset/", "anchor_text": "How to Train YOLOv4", "paragraph_index": 37}, {"url": "https://blog.roboflow.ai/yolov5-improvements-and-evaluation/", "anchor_text": "improvements in YOLO v5", "paragraph_index": 37}], "all_paragraphs": ["Detectron2 is a popular PyTorch based modular computer vision model library. It is the second iteration of Detectron, originally written in Caffe2. The Detectron2 system allows you to plug in custom state of the art computer vision technologies into your workflow. Quoting the Detectron2 release blog:", "In this post, we review how to train Detectron2 on custom data for specifically object detection. Though, after you finish reading you will be familiar with the Detectron2 ecosystem and you will be able to generalize to other capabilities included in Detectron2.", "We will be training our custom Detectron2 detector on public blood cell detection data hosted for free at Roboflow. The blood cell detection dataset is representative of a small custom object detection dataset that one might collect to construct a custom object detection system. Notably, blood cell detection is not a capability available in Detectron2 \u2014 we need to train the underlying networks to fit our custom task.", "If you want to follow along step by step in the tutorial, you can fork this public blood cell dataset. Otherwise you can upload your own dataset in any format (more below).", "To get started make a copy of this Colab Notebook Implementing Detectron2 on Custom Data. Google Colab provides us with free GPU resources so make sure to enable them by checking Runtime \u2192 Change runtime type \u2192 GPU.", "To start training our custom detector we install torch==1.5 and torchvision==0.6 - then after importing torch we can check the version of torch and make doubly sure that a GPU is available printing 1.5.0+cu101 True.", "Then we pip install the Detectron2 library and make a number of submodule imports.", "We download our custom data in COCO JSON format from Roboflow with a single line of code \u2014 this is the only line of code you need to change to train on your own custom objects!", "NOTE: In this tutorial we export object detection data with bounding boxes. Roboflow does not currently support semantic segmentation annotation formats. Sign up to be notified when we do.", "If you have unlabeled images, you will first need to label them. For free open source labeling tools, we recommend the following guides on getting started with LabelImg or getting started with CVAT annotation tools. Try labeling ~50 images to proceed in this tutorial. To improve your model\u2019s performance later, you will want to label more.", "You may also consider building a free object detection dataset from Open Images.", "Once you have labeled data, to get move your data into Roboflow, create a free account and then you can drag your dataset in in any format: (VOC XML, COCO JSON, TensorFlow Object Detection CSV, etc).", "Once uploaded you can choose preprocessing and augmentation steps:", "Then, click Generate and Download and you will be able to choose COCO JSON format.", "When prompted, be sure to select \u201cShow Code Snippet.\u201d This will output a download curl script so you can easily port your data into Colab in the proper format.", "Then, Detectron2 keeps track of a list of available datasets in a registry, so we must register our custom data with Detectron2 so it can be invoked for training.", "Detectron2 makes it easy to view our training data to make sure the data has imported correctly. We do so with the following", "Looks like our dataset registered correctly.", "Next we write our custom training configuration.", "The biggest fixtures we have invoked here are the type of object detection model \u2014 the large Faster RCNN. Detectron2 allows you many options in determining your model architecture, which you can see in the Detectron2 model zoo.", "For object detection alone, the following models are available:", "The other large config choice we have made is the MAX_ITER parameter. This specifies how long the model will train for, you may need to adjust up and down based on the validation metrics you are seeing.", "Before starting training, we need to make sure that the model validates against our validation set. Unfortunately, this does not happen by default \ud83e\udd14.", "We can easily do this by defining our custom trainer based on the Default Trainer with the COCO Evaluator:", "Ok now that we have our COCO Trainer we can kick off training:", "The training will run for a while and print out evaluation metrics on our validation set. Curious to learn what mAP is for evaluation? Check out this article on breaking down mAP.", "Once training is finished, we can move on to evaluation and inference!", "First, we can display a tensorboard of results to see how the training procedure has performed.", "There are a lot of metrics of interest in there \u2014 most notably total_loss and validation mAP.", "We run the same evaluation procedure used in our validation mAP on the test set.", "This evaluation will give you a good idea of how your new custom Detectron2 detector will perform in the wild. Again, if you are curious to learn more about these metrics see this post breaking down mAP.", "And finally, we can run our new custom Detectron2 detector on real images! Note, these are images that the model has never seen", "Our model makes good predictions showing that it has learned how to identify red blood cells, white blood cells, and platelets.", "You may consider playing with the SCORE_THRESH_TEST to change the confidence threshold that the model requires to make a prediction.", "You can now save the weights in the os.path.join(cfg.OUTPUT_DIR, \"model_final.pt\") for future inference by exporting to Google Drive.", "You can also see the underlying prediction tensor in the outputs object to use elsewhere in your app.", "Congratulations! Now you know how to train your own custom Detectron2 detector on a completely new domain.", "Not seeing the results you need to move forward? Object detection models have been improved since the release of the Detectron2 model zoo \u2014 consider checking out some of our other tutorials such as How to Train YOLOv5 and How to Train YOLOv4, or this writeup on improvements in YOLO v5.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning @ Roboflow \u2014 building tools and artifacts like this one to help practitioners solve computer vision."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbe9d1c233e4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jacobsolawetz.medium.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Jacob Solawetz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5f06d25ec2e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=post_page-5f06d25ec2e8----be9d1c233e4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://blog.roboflow.com/how-to-train-detectron2/", "anchor_text": "How to Train Detectron2"}, {"url": "https://colab.research.google.com/drive/1-TNOcPm3Jr3fOJG8rnGT9gh60mHUsvaW#scrollTo=kc8MmgZugZWR", "anchor_text": "Detectron2 Colab notebook"}, {"url": "https://ai.facebook.com/blog/-detectron2-a-pytorch-based-modular-object-detection-library-/", "anchor_text": "Detectron2"}, {"url": "https://colab.research.google.com/drive/1-TNOcPm3Jr3fOJG8rnGT9gh60mHUsvaW#scrollTo=wXisIbT1Zqou", "anchor_text": "Colab Notebook Implementing Detectron2 on Custom Data"}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "Public Blood Cell Detection Dataset"}, {"url": "https://ai.facebook.com/blog/-detectron2-a-pytorch-based-modular-object-detection-library-/", "anchor_text": "Detectron2 release blog"}, {"url": "https://ai.facebook.com/blog/-detectron2-a-pytorch-based-modular-object-detection-library-/", "anchor_text": "Detectron2"}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "public blood cell detection"}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "Public blood cell detection data"}, {"url": "https://public.roboflow.ai/object-detection/bccd", "anchor_text": "public blood cell dataset"}, {"url": "https://colab.research.google.com/drive/1-TNOcPm3Jr3fOJG8rnGT9gh60mHUsvaW#scrollTo=wXisIbT1Zqou", "anchor_text": "Colab Notebook Implementing Detectron2 on Custom Data"}, {"url": "https://dl.fbaipublicfiles.com/detectron2/wheels/cu101/torch1.5/index.html", "anchor_text": "https://dl.fbaipublicfiles.com/detectron2/wheels/cu101/torch1.5/index.html"}, {"url": "https://roboflow.ai", "anchor_text": "Sign up"}, {"url": "https://blog.roboflow.ai/getting-started-with-labelimg-for-labeling-object-detection-data/", "anchor_text": "getting started with LabelImg"}, {"url": "https://blog.roboflow.ai/getting-started-with-cvat/", "anchor_text": "getting started with CVAT"}, {"url": "https://blog.roboflow.ai/custom-open-images-datasets/", "anchor_text": "building a free object detection dataset from Open Images"}, {"url": "https://app.roboflow.ai/", "anchor_text": "create a free account"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md", "anchor_text": "Detectron2 model zoo"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md", "anchor_text": "Detectron2 model zoo"}, {"url": "http://twitter.com/classmethod", "anchor_text": "@classmethod"}, {"url": "https://blog.roboflow.ai/what-is-mean-average-precision-object-detection/", "anchor_text": "breaking down mAP"}, {"url": "https://blog.roboflow.ai/what-is-mean-average-precision-object-detection/", "anchor_text": "breaking down mAP"}, {"url": "https://blog.roboflow.ai/how-to-train-yolov5-on-a-custom-dataset/", "anchor_text": "How to Train YOLOv5"}, {"url": "https://blog.roboflow.ai/training-yolov4-on-a-custom-dataset/", "anchor_text": "How to Train YOLOv4"}, {"url": "https://blog.roboflow.ai/yolov5-improvements-and-evaluation/", "anchor_text": "improvements in YOLO v5"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----be9d1c233e4---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----be9d1c233e4---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----be9d1c233e4---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----be9d1c233e4---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----be9d1c233e4---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=-----be9d1c233e4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=-----be9d1c233e4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbe9d1c233e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----be9d1c233e4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----be9d1c233e4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----be9d1c233e4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----be9d1c233e4--------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jacobsolawetz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jacob Solawetz"}, {"url": "https://jacobsolawetz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "513 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5f06d25ec2e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=post_page-5f06d25ec2e8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbdaf42b583ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-detectron2-on-custom-object-detection-data-be9d1c233e4&newsletterV3=5f06d25ec2e8&newsletterV3Id=bdaf42b583ae&user=Jacob+Solawetz&userId=5f06d25ec2e8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}