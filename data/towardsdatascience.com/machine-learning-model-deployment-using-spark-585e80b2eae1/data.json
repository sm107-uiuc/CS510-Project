{"url": "https://towardsdatascience.com/machine-learning-model-deployment-using-spark-585e80b2eae1", "time": 1683017510.523979, "path": "towardsdatascience.com/machine-learning-model-deployment-using-spark-585e80b2eae1/", "webpage": {"metadata": {"title": "Machine Learning Model deployment using Spark | by Charu Makhijani | Towards Data Science", "h1": "Machine Learning Model deployment using Spark", "description": "A while ago, I wrote a post about Productionizing Machine Learning Models, where I mentioned strategies for deploying Machine Learning models into production. This article is about one of the widely\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/swlh/productionizing-machine-learning-models-bb7f018f8122", "anchor_text": "Productionizing Machine Learning Models", "paragraph_index": 0}, {"url": "https://github.com/charumakhijani/credit-card-fraud-detection", "anchor_text": "link", "paragraph_index": 19}, {"url": "https://github.com/charumakhijani/spark-ml-deployment", "anchor_text": "link", "paragraph_index": 28}, {"url": "https://github.com/charumakhijani", "anchor_text": "https://github.com/charumakhijani", "paragraph_index": 32}], "all_paragraphs": ["A while ago, I wrote a post about Productionizing Machine Learning Models, where I mentioned strategies for deploying Machine Learning models into production. This article is about one of the widely used approaches \u2014 Batch Prediction using Spark. Using this approach, you can schedule a job to run the predictions at a specific time and output them to the database/file systems/streaming / any persistent layer.", "Nowadays many solutions/tools are available for batch prediction, simplest is writing code in python and scheduling it with Cron, but there are 2 problems with this approach-", "1. With each prediction, there comes an overhead of pickling/unpickling the model.", "2. We are not using scikit-learn\u2019s optimizations for predicting a solution.", "Another solution is to use tools like, Airflow and Perfect for batch predictions. Cloud solutions are also available for batch predictions like \u2014 MLFlow and Amazon Sagemaker.", "But if you want to take advantage of scikit-learn\u2019s optimizations and don\u2019t want to rely on external tools, then Spark comes as a promising solution for batch predictions.", "When I talk about deploying a machine learning model using Spark, many think that it can be done easily using Spark MLlib, and Yes; it's indeed a solution. But I am more inclined towards using scikit-learn and TensorFlow for machine learning as they are more flexible and provide more robust methods. So I prefer creating my ML models using scikit-learn and Tensorflow pipelines, deploying models over Spark, and then using batch prediction for scoring/forecasting.", "Spark not only provides scheduling and monitoring capabilities for batch predictions, but it is also scalable for more complex models and datasets. Moreover, if you come from a Data Engineering background and have a solid experience in Spark and Hadoop, then you don\u2019t need any third-party solutions for ML model deployments. In this post, I will explain how you can deploy ML models over Spark and perform predictions using parallel processing.", "Batch Prediction using Spark is a 7-step solution and the steps are the same for both Classification and Regression Problems-", "1. Create an ML model & pickle it and store the pickle file in HDFS.", "2. Write a spark job and unpickle the python object.", "3. Broadcast this python object over all Spark nodes.", "4. Create a pyspark UDF and call predict method on the broadcasted model object.", "5. Create a feature column list on which the ML model was trained.", "6. Create a spark data frame for prediction with one unique column and features from step 5.", "7. Create predict column in Dataframe from step 6 and call UDF with feature columns.", "Now you have a spark data frame with a unique id, all feature columns, and a prediction column. And once implemented, can be reused for many ML model predictions.", "Now let's see the actual code implementation (in python) for the above 7 steps.", "In Step 1, we create an ML model and persist in a pickle file.", "Here rf in line 3, is a Random Forest model trained for credit card fraud detection. If you want to see how I created this random forest prediction model please refer GitHub link.", "In Step 2 & 3, we will create a spark job, unpickle the python object and broadcast it on the cluster nodes. Broadcasting python object will make the ML model available on multiple nodes for parallel processing of the batch.", "In Step 4, we\u2019ll create a pyspark UDF to predict fraud detection.", "In Steps 5 & 6, we\u2019ll create a feature list and spark data frame with unique Ids.", "Finally in Step 7, we\u2019ll call pyspark UDF on data frame from step 6 and generate predictions with feature columns.", "Using these steps, any batch prediction model created using scikit-learn can be deployed on Spark cluster.", "For Tensorflow models, there are a few more steps involved which I\u2019ll cover in my next posts.", "In this approach, steps 1\u20134 and step 7 are the same for all models and if you can pickle the feature columns from step 5 with step 1 and unpickle later, then this process will be completely automated and can be used for productionizing any batch prediction models built in scikit-learn. I have used it many times and automated the complete machine-learning batch prediction.", "Productionizing ML models with Spark batch is a very simple, easy, and fast-to-implement solution for many problems. Depending on at what frequency input data is changing the batch predictions can be scheduled once/many times in a day. Batch predictions using Spark are stateless and can also be combined with real-time predictions to run in parallel. Spark batch comes with the capability to schedule jobs in yarn with logging and monitoring functionalities. Also as Spark is completely scalable and you can manage the cluster on your own, the process of batch prediction is very fast.", "To access the complete code for batch prediction using Spark, please refer GitHub link.", "If you are interested in learning about model deployment strategies and real-time deployment of ML models, refer-", "Thanks for the read. If you like the story please like, share, and follow for more such content. As always, please reach out for any questions/comments/feedback.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Engineering Leader | Writing about Data Science, Machine Learning, Product Engineering & Leadership | https://github.com/charumakhijani"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F585e80b2eae1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://charumakhijani.medium.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": ""}, {"url": "https://charumakhijani.medium.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Charu Makhijani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa3b23858b69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&user=Charu+Makhijani&userId=a3b23858b69&source=post_page-a3b23858b69----585e80b2eae1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@chrisliverani", "anchor_text": "Chris Liverani"}, {"url": "https://medium.com/swlh/productionizing-machine-learning-models-bb7f018f8122", "anchor_text": "Productionizing Machine Learning Models"}, {"url": "https://github.com/charumakhijani/credit-card-fraud-detection", "anchor_text": "link"}, {"url": "https://github.com/charumakhijani/spark-ml-deployment", "anchor_text": "link"}, {"url": "https://medium.com/swlh/productionizing-machine-learning-models-bb7f018f8122", "anchor_text": "Productionizing Machine Learning ModelsDeploying models into production is a complex affair.medium.com"}, {"url": "https://towardsdatascience.com/machine-learning-model-deployment-on-heroku-using-flask-467acb4a34da", "anchor_text": "Machine Learning Model Deployment on Heroku Using FlaskMachine Learning Platform as a Servicetowardsdatascience.com"}, {"url": "https://charumakhijani.medium.com/subscribe", "anchor_text": "Get an email whenever I publish and be the first one to read!Get an email whenever I publish and be the first one to read! By signing up, you will create a Medium account if you\u2026charumakhijani.medium.com"}, {"url": "https://github.com/charumakhijani", "anchor_text": "https://github.com/charumakhijani"}, {"url": "https://www.linkedin.com/in/charu-makhijani-23b18318/", "anchor_text": "https://www.linkedin.com/in/charu-makhijani-23b18318/"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----585e80b2eae1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deployment-automation?source=post_page-----585e80b2eae1---------------deployment_automation-----------------", "anchor_text": "Deployment Automation"}, {"url": "https://medium.com/tag/ml-deployment?source=post_page-----585e80b2eae1---------------ml_deployment-----------------", "anchor_text": "Ml Deployment"}, {"url": "https://medium.com/tag/batch-prediction?source=post_page-----585e80b2eae1---------------batch_prediction-----------------", "anchor_text": "Batch Prediction"}, {"url": "https://medium.com/tag/ml-pipeline?source=post_page-----585e80b2eae1---------------ml_pipeline-----------------", "anchor_text": "Ml Pipeline"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&user=Charu+Makhijani&userId=a3b23858b69&source=-----585e80b2eae1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&user=Charu+Makhijani&userId=a3b23858b69&source=-----585e80b2eae1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F585e80b2eae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----585e80b2eae1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----585e80b2eae1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----585e80b2eae1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----585e80b2eae1--------------------------------", "anchor_text": ""}, {"url": "https://charumakhijani.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://charumakhijani.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Charu Makhijani"}, {"url": "https://charumakhijani.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "197 Followers"}, {"url": "https://github.com/charumakhijani", "anchor_text": "https://github.com/charumakhijani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa3b23858b69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&user=Charu+Makhijani&userId=a3b23858b69&source=post_page-a3b23858b69--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6883cd406aeb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-model-deployment-using-spark-585e80b2eae1&newsletterV3=a3b23858b69&newsletterV3Id=6883cd406aeb&user=Charu+Makhijani&userId=a3b23858b69&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}