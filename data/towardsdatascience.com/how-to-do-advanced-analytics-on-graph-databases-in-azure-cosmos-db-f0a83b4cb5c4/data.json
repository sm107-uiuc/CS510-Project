{"url": "https://towardsdatascience.com/how-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4", "time": 1683006629.726507, "path": "towardsdatascience.com/how-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4/", "webpage": {"metadata": {"title": "How to do advanced analytics on graph data in Azure Cosmos DB | by Ren\u00e9 Bremer | Towards Data Science", "h1": "How to do advanced analytics on graph data in Azure Cosmos DB", "description": "Azure Cosmos DB is a fully managed multi-database service. It enables you to build highly responsive applications worldwide. As part of Cosmos DB, Gremlin is supported for graph databases. Since\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/introduction", "anchor_text": "Azure Cosmos DB", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Online_transaction_processing", "anchor_text": "OLTP", "paragraph_index": 0}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/gremlin-limits#limits", "anchor_text": "traversal limits", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Online_analytical_processing", "anchor_text": "OLAP", "paragraph_index": 0}, {"url": "https://github.com/Azure/azure-cosmosdb-spark#working-with-the-connector", "anchor_text": "link", "paragraph_index": 13}, {"url": "https://spark-packages.org/package/graphframes/graphframes", "anchor_text": "link", "paragraph_index": 14}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/introduction", "anchor_text": "Cosmos DB", "paragraph_index": 17}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/gremlin-limits#limits", "anchor_text": "traversal limits", "paragraph_index": 17}], "all_paragraphs": ["Azure Cosmos DB is a fully managed multi-database service. It enables you to build highly responsive applications worldwide. As part of Cosmos DB, Gremlin is supported for graph databases. Since Cosmos DB is optimized for fast processing (OLTP), traversal limits may apply for heavy analytic workloads (OLAP). In that case, Azure Databricks and GraphFrames can be used as an alternative to do advanced analytics, see also architecture below.", "In the remaining of blog, the following is done:", "Finally, a conclusion is drawn in the last chapter.", "In this chapter, the Gremlin API and Python will be used to write data to Cosmos DB. Since Azure Databricks is used in the next chapter for OLAP, an Azure Databricks cluster is also used to write the data to Cosmos DB using the Gremlin API. However, any Python3 environment can be used to write the data to Cosmos DB, e.g. Visual Code, PyCharm or Azure Functions. The following steps are executed:", "The following prerequisites need to be installed:", "When creating the database and graph in Cosmos DB, /name can be used as partition key. Take PeopleDB as name of the database and friends as name of the graph, see also below.", "Start your Azure Databricks workspace and go to Cluster. Create a new cluster with Databricks runtime version 6.4 and only 1 worker node, see also below.", "Subsequently, go to your cluster and click install libraries. Then select Pypi and search for gremlinpython and click install, see also below.", "Go to your Azure Databricks workspace, right-click and then select import. In the radio button, select to import the following notebook using URL:", "Once the notebook is imported, you need to change the URL of your Cosmos DB endpoint and your Cosmos DB key which can be found in the portal, see also below.", "Now select to run the notebook and the data will be written to Cosmos DB. Verify whether the data is there, see also below.", "In this chapter, graph data was added using the Gremlin API, Python and Azure Databricks. In the next chapter, the data is analyzed in which the Databricks cluster is reused.", "In this chapter, the data is retrieved from Cosmos DB and analyzed in Azure Databricks using GraphFrames. In this, the data is directly read from Cosmos DB in Azure Databricks. Since Cosmos DB is typically used as OLTP it may be necessary to stage the data first in ADLSgen2 to minimize load on Cosmos DB, prevent time outs when massive data loads are needed and save costs. However, for simplicity, in this blog data is directly read from Cosmos DB to Azure Databricks. The following steps are executed:", "Cosmos DB connector and GraphFrames needs to installed as a jar file to the cluster that was created in the previous chapter. Download the lastest uber Cosmos DB connector using this link to your desktop. Subsequently, go the your Azure Databricks cluster and click install libraries. Then select Jar and drop the jar file, see also below.", "Subsequently, download the lastest GraphFreams using this link and install this in the same was as the Cosmos DB connector. Verify that all libraries are installed correctly, see also below.", "Go to your Azure Databricks workspace, right-click and then select import. In the radio button, select to import the following notebook using URL:", "Once the notebook is imported, you need to change the URL of your cosmos DB endpoint and your Cosmos DB key which can be found in the portal, see also below. Finally you can run the notebook. In the last cell you can find the result of the Label Propagation Algorithm this is used from Community Detection, see also below.", "Cosmos DB is the multi-model database service in Azure and graph databases are supported. Since Cosmos DB is optimized for OLTP, the traversal limits may apply for heavy OLAP workloads. In that case, Azure Databricks and GraphFrames can be used as an alternative to do advanced analytics, see also architecture below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Solution Architect @ Microsoft, working with Azure services as ADFv2, ADLSgen2, Azure DevOps, Databricks, Function Apps and SQL. Opinions here are mine."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff0a83b4cb5c4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rebremer.medium.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771----f0a83b4cb5c4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/introduction", "anchor_text": "Azure Cosmos DB"}, {"url": "https://en.wikipedia.org/wiki/Online_transaction_processing", "anchor_text": "OLTP"}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/gremlin-limits#limits", "anchor_text": "traversal limits"}, {"url": "https://en.wikipedia.org/wiki/Online_analytical_processing", "anchor_text": "OLAP"}, {"url": "https://docs.microsoft.com/nl-nl/azure/azure-databricks/quickstart-create-databricks-workspace-portal?toc=/azure/databricks/toc.json&bc=/azure/databricks/breadcrumb/toc.json#step-2-create-a-databricks-workspace", "anchor_text": "Azure Databricks"}, {"url": "https://docs.microsoft.com/nl-nl/azure/cosmos-db/create-graph-gremlin-console#create-a-database-account", "anchor_text": "Cosmos DB with Gremlin API"}, {"url": "https://raw.githubusercontent.com/rebremer/cosmosdb-databricks-olap/master/insert_data_CosmosDB_OLTP_Python_Gremlin.py", "anchor_text": "https://raw.githubusercontent.com/rebremer/cosmosdb-databricks-olap/master/insert_data_CosmosDB_OLTP_Python_Gremlin.py"}, {"url": "https://github.com/Azure/azure-cosmosdb-spark#working-with-the-connector", "anchor_text": "link"}, {"url": "https://spark-packages.org/package/graphframes/graphframes", "anchor_text": "link"}, {"url": "https://raw.githubusercontent.com/rebremer/cosmosdb-databricks-olap/master/get_data_cosmosDB_OLAP_Scala_GraphFrames.scala", "anchor_text": "https://raw.githubusercontent.com/rebremer/cosmosdb-databricks-olap/master/get_data_cosmosDB_OLAP_Scala_GraphFrames.scala"}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/introduction", "anchor_text": "Cosmos DB"}, {"url": "https://docs.microsoft.com/en-us/azure/cosmos-db/gremlin-limits#limits", "anchor_text": "traversal limits"}, {"url": "https://medium.com/tag/azure?source=post_page-----f0a83b4cb5c4---------------azure-----------------", "anchor_text": "Azure"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f0a83b4cb5c4---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/graph-database?source=post_page-----f0a83b4cb5c4---------------graph_database-----------------", "anchor_text": "Graph Database"}, {"url": "https://medium.com/tag/programming?source=post_page-----f0a83b4cb5c4---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/spark?source=post_page-----f0a83b4cb5c4---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----f0a83b4cb5c4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----f0a83b4cb5c4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff0a83b4cb5c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f0a83b4cb5c4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f0a83b4cb5c4--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://rebremer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "731 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fed36bca8eb16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-do-advanced-analytics-on-graph-databases-in-azure-cosmos-db-f0a83b4cb5c4&newsletterV3=11e5e7fb3771&newsletterV3Id=ed36bca8eb16&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}