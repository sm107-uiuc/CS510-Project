{"url": "https://towardsdatascience.com/how-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a", "time": 1683016064.287025, "path": "towardsdatascience.com/how-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a/", "webpage": {"metadata": {"title": "How to evaluate Vespa ranking functions from python | by Thiago G. Martins | Towards Data Science", "h1": "How to evaluate Vespa ranking functions from python", "description": "This is the second on a series of blog posts that will show you how to improve a text search application, from downloading data to fine-tuning BERT models. The previous post showed how to download\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/download-and-parse-trec-covid-data-8f9840686c37", "anchor_text": "how to download and parse TREC-COVID data", "paragraph_index": 1}, {"url": "https://cord19.vespa.ai/", "anchor_text": "cord19 search application", "paragraph_index": 1}, {"url": "https://colab.research.google.com/github/vespa-engine/pyvespa/blob/master/docs/sphinx/source/use_cases/cord19/cord19_connect_evaluate.ipynb", "anchor_text": "Google Colab", "paragraph_index": 2}, {"url": "https://pyvespa.readthedocs.io/en/latest/use_cases/cord19/cord19_download_parse_trec_covid.html", "anchor_text": "have processed before", "paragraph_index": 3}, {"url": "https://pyvespa.readthedocs.io/en/latest/index.html", "anchor_text": "pyvespa", "paragraph_index": 6}, {"url": "https://docs.vespa.ai/documentation/nativerank.html", "anchor_text": "nativeRank", "paragraph_index": 11}, {"url": "https://docs.vespa.ai/documentation/reference/bm25.html", "anchor_text": "BM25", "paragraph_index": 11}, {"url": "https://github.com/vespa-engine/sample-apps/blob/master/vespa-cloud/cord-19-search/src/main/application/schemas/doc.sd", "anchor_text": "here", "paragraph_index": 12}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai", "paragraph_index": 20}], "all_paragraphs": ["This is the second on a series of blog posts that will show you how to improve a text search application, from downloading data to fine-tuning BERT models.", "The previous post showed how to download and parse TREC-COVID data. This one will focus on evaluating two query models available in the cord19 search application. Those models will serve as baselines for future improvements.", "You can also run the steps contained here from Google Colab.", "We can start by downloading the data that we have processed before.", "topics contain data about the 50 topics available, including query, question and narrative.", "relevance_data contains the relevance judgments for each of the 50 topics.", "We are going to use pyvespa to evaluate ranking functions from python.", "pyvespa provides a python API to Vespa. It allows us to create, modify, deploy, and interact with running Vespa instances. The library's main goal is to allow for faster prototyping and facilitate Machine Learning experiments for Vespa applications.", "pyvespa expects labeled data to follow the format illustrated below. It is a list of dict where each dict represents a query containing query_id, query and a list of relevant_docs. Each relevant document contains a required id key and an optional score key.", "We can create labeled_data from the topics and relevance_data that we downloaded before. We are only going to include documents with relevance score > 0 into the final list.", "We are going to define two query models to be evaluated here. Both will match all the documents that share at least one term with the query. This is defined by setting match_phase = OR().", "The difference between the query models happens in the ranking phase. The or_default model will rank documents based on nativeRank, while the or_bm25 model will rank documents based on BM25. Discussion about those two types of ranking is out of the scope of this tutorial. It is enough to know that they rank documents according to two different formulas.", "Those ranking profiles were defined by the team behind the cord19 app and can be found here.", "We want to compute the following metrics:", "Connect to a running Vespa instance:", "Compute the metrics defined above for each query model and store the results in a dictionary.", "Let\u2019s first combine the data into one DataFrame in a format to facilitate a comparison between query models.", "We can see below that the query model based on BM25 is superior across all metrics considered here.", "We can also visualize the metrics' distribution across the queries to get a better picture of the results.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Working on Vespa.ai. Follow me on Twitter @Thiagogm"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7749650f6e1a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tgmstat.medium.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86----7749650f6e1a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pyvespa.readthedocs.io/en/latest/index.html", "anchor_text": "pyvespa"}, {"url": "https://cord19.vespa.ai/", "anchor_text": "cord19 search application"}, {"url": "https://towardsdatascience.com/download-and-parse-trec-covid-data-8f9840686c37", "anchor_text": "how to download and parse TREC-COVID data"}, {"url": "https://cord19.vespa.ai/", "anchor_text": "cord19 search application"}, {"url": "https://colab.research.google.com/github/vespa-engine/pyvespa/blob/master/docs/sphinx/source/use_cases/cord19/cord19_connect_evaluate.ipynb", "anchor_text": "Google Colab"}, {"url": "https://unsplash.com/@olloweb?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Agence Olloweb"}, {"url": "https://unsplash.com/s/photos/magnifying-glass?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://pyvespa.readthedocs.io/en/latest/use_cases/cord19/cord19_download_parse_trec_covid.html", "anchor_text": "have processed before"}, {"url": "https://pyvespa.readthedocs.io/en/latest/index.html", "anchor_text": "pyvespa"}, {"url": "https://docs.vespa.ai/documentation/nativerank.html", "anchor_text": "nativeRank"}, {"url": "https://docs.vespa.ai/documentation/reference/bm25.html", "anchor_text": "BM25"}, {"url": "https://github.com/vespa-engine/sample-apps/blob/master/vespa-cloud/cord-19-search/src/main/application/schemas/doc.sd", "anchor_text": "here"}, {"url": "https://medium.com/tag/vespa?source=post_page-----7749650f6e1a---------------vespa-----------------", "anchor_text": "Vespa"}, {"url": "https://medium.com/tag/pyvespa?source=post_page-----7749650f6e1a---------------pyvespa-----------------", "anchor_text": "Pyvespa"}, {"url": "https://medium.com/tag/cord19?source=post_page-----7749650f6e1a---------------cord19-----------------", "anchor_text": "Cord19"}, {"url": "https://medium.com/tag/search?source=post_page-----7749650f6e1a---------------search-----------------", "anchor_text": "Search"}, {"url": "https://medium.com/tag/nlp?source=post_page-----7749650f6e1a---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----7749650f6e1a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----7749650f6e1a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7749650f6e1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7749650f6e1a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7749650f6e1a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7749650f6e1a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7749650f6e1a--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://tgmstat.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "96 Followers"}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd1c0d81e840f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-evaluate-vespa-ranking-functions-from-python-7749650f6e1a&newsletterV3=a578be8bee86&newsletterV3Id=d1c0d81e840f&user=Thiago+G.+Martins&userId=a578be8bee86&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}