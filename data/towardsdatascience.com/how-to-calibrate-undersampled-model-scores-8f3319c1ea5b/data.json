{"url": "https://towardsdatascience.com/how-to-calibrate-undersampled-model-scores-8f3319c1ea5b", "time": 1682994988.6142411, "path": "towardsdatascience.com/how-to-calibrate-undersampled-model-scores-8f3319c1ea5b/", "webpage": {"metadata": {"title": "How to Calibrate Undersampled Model Scores | by Emre Ren\u00e7bero\u011flu | Towards Data Science", "h1": "How to Calibrate Undersampled Model Scores", "description": "Imbalanced data problems in binary prediction models and a simple but effective way to take care of them with Python and R with visualizations."}, "outgoing_paragraph_urls": [], "all_paragraphs": ["The imbalanced data is simply referred to as a situation that one of the classes forms a high majority and dominates other classes. For machine learning, a skewed distribution of target values might cause an accuracy bias in algorithms and affect the performance of models negatively. At this point, the aim of the model and performance metrics are substantial.", "Let\u2019s clarify with an example. If your Target columns have True classes with a %1, a model that always predict False will be %99 of times successful in terms of basic accuracy. However, this is impractical in most cases because the cost of false positive (or Type I Error) and false negative (or Type II Error) predictions are usually not equal.", "There are a couple of solutions to imbalanced data problem but in this article, I will mention the undersampling method and the calibration process which adjust the final scores afterward.", "Assume that your data has a binary target variable with a highly skewed ratio. In order to balance the ratio of target and increase the focus of the machine learning algorithm on the minority class, the rows of the majority class are reduced. This process is called as undersampling and applied in the data preparation phase before the model training.", "After the undersampling process, some side effects are seen on the distribution of the model scores. For instance, if the ratio of the True classes in the training data is %5, we expect that the average of the probability predictions to be %5 as well. But, in case we manipulate the target class ratio, we also change the distribution of prediction scores. Random undersampling of non-target classes improves the prior probability of the target class in the train data and it ends up with increased probability predictions.", "If you aim to select a certain number of instances according to their prediction scores, undersampling is not a problem, by the reason of the fact that it does not change the probability score order of the instances. For example, if you need to specify a population with the highest propensity score for your marketing campaign, you do not need to worry about the side effects of undersampling.", "However, in some cases, a realistic probability prediction matters:", "\u201cif you give all events that happen a probability of .6 and all the events that don\u2019t happen a probability of .4, your discrimination is perfect but your calibration is miserable\u201d.", "If you use AUC as a model evaluation metric, you cannot see any difference before and after calibration, because AUC cares about distinguishing the classes, not the probability of them. However, if you use a metric such as Log Loss that works with the likelihood function, it differs.", "In the chart below, you can see the probability predictions distributions of undersampled data before and after calibration. The vertical purple line shows the prior probability of the target class in the original data. It can be seen on the chart, that the red area of undersampled model predictions becomes highly coherent with the prior probability after the calibration process.", "To adjust the probabilities in the model output, we calibrate them. There are two well-known calibration algorithms: Platt\u2019s Scaling and Isotonic Regression.", "Besides these, I want to talk about another uncomplicated calibration formula and its functions in python and R.", "Here are the explanations of function parameters:", "Let\u2019s say your goal is to generate a model that shows the credit default probabilities and your original training data has 50,000 rows with only 500 of them labeled as target class. When you sample your non-target instances randomly and reduce the total row count to 10,000, while conserving 500 target rows, our calibration function becomes:", "Here model_results is your model probability output array. After you train your model and put the results in it, your function is ready to use. Enjoy it!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Head of Data Science - Hepsiburada"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8f3319c1ea5b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@emrerencberoglu?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@emrerencberoglu?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Emre Ren\u00e7bero\u011flu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc6b0b560a0c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&user=Emre+Ren%C3%A7bero%C4%9Flu&userId=c6b0b560a0c4&source=post_page-c6b0b560a0c4----8f3319c1ea5b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.datascience.com/blog/imbalanced-data", "anchor_text": "How to Handle Imbalanced Data: An Overview"}, {"url": "https://towardsdatascience.com/dealing-with-imbalanced-classes-in-machine-learning-d43d6fa19d2", "anchor_text": "Dealing with Imbalanced Classes in Machine Learning"}, {"url": "http://fastml.com/classifier-calibration-with-platts-scaling-and-isotonic-regression/", "anchor_text": "Classifier calibration with Platt\u2019s scaling and isotonic regression"}, {"url": "https://www.researchgate.net/publication/233784966_Probabilities_for_SV_Machines", "anchor_text": "Platt Scaling Conference Paper"}, {"url": "https://www.kaggle.com/dansbecker/what-is-log-loss", "anchor_text": "What is Log Loss?"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8f3319c1ea5b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----8f3319c1ea5b---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/r?source=post_page-----8f3319c1ea5b---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8f3319c1ea5b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/predictive-analytics?source=post_page-----8f3319c1ea5b---------------predictive_analytics-----------------", "anchor_text": "Predictive Analytics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&user=Emre+Ren%C3%A7bero%C4%9Flu&userId=c6b0b560a0c4&source=-----8f3319c1ea5b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&user=Emre+Ren%C3%A7bero%C4%9Flu&userId=c6b0b560a0c4&source=-----8f3319c1ea5b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8f3319c1ea5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8f3319c1ea5b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8f3319c1ea5b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@emrerencberoglu?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@emrerencberoglu?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Emre Ren\u00e7bero\u011flu"}, {"url": "https://medium.com/@emrerencberoglu/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc6b0b560a0c4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&user=Emre+Ren%C3%A7bero%C4%9Flu&userId=c6b0b560a0c4&source=post_page-c6b0b560a0c4--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F706ea332415b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-calibrate-undersampled-model-scores-8f3319c1ea5b&newsletterV3=c6b0b560a0c4&newsletterV3Id=706ea332415b&user=Emre+Ren%C3%A7bero%C4%9Flu&userId=c6b0b560a0c4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}