{"url": "https://towardsdatascience.com/training-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac", "time": 1683007051.038731, "path": "towardsdatascience.com/training-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac/", "webpage": {"metadata": {"title": "Training on a TPU in parallel using PyTorch XLA | by Abhishek Swain | Towards Data Science", "h1": "Training on a TPU in parallel using PyTorch XLA", "description": "The Kaggle documentation only mentions how to train a model on a TPU with Tensorflow, but I wanted to do it using PyTorch. PyTorch has XLA which is what we are gonna use to run our code on TPU\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/abhishek/bert-multi-lingual-tpu-training-8-cores-w-valid", "anchor_text": "this", "paragraph_index": 4}, {"url": "https://www.kaggle.com/abhishek", "anchor_text": "Abhishek Thakur", "paragraph_index": 4}, {"url": "https://www.youtube.com/watch?v=2oWf4v6QEV8", "anchor_text": "https://www.youtube.com/watch?v=2oWf4v6QEV8", "paragraph_index": 4}, {"url": "https://www.kaggle.com/c/plant-pathology-2020-fgvc7", "anchor_text": "Plant Pathology 2020", "paragraph_index": 6}, {"url": "https://www.kaggle.com/abhiswain/pytorch-tpu-efficientnet-b5-tutorial-reference", "anchor_text": "https://www.kaggle.com/abhiswain/pytorch-tpu-efficientnet-b5-tutorial-reference", "paragraph_index": 14}], "all_paragraphs": ["Taken from the Kaggle TPU documentation:", "TPUs are now available on Kaggle, for free. TPUs are hardware accelerators specialized in deep learning tasks. They are supported in Tensorflow 2.1 both through the Keras high-level API and, at a lower level, in models using a custom training loop.", "You can use up to 30 hours per week of TPUs and up to 3h at a time in a single session.", "The Kaggle documentation only mentions how to train a model on a TPU with Tensorflow, but I wanted to do it using PyTorch. PyTorch has XLA which is what we are gonna use to run our code on TPU. Anyway, the problem I faced was there was no single source of information about how to do it. It was all scattered all over the place!", "I did quite a bit of research and found this amazing kernel by Abhishek Thakur. He explained how to train on a TPU parallelly on all it\u2019s 8 cores. He even has a youtube video that explains training on a TPU. Check it out here https://www.youtube.com/watch?v=2oWf4v6QEV8.", "First, we need to install torch xla, for that all you need to do is copy, paste these two lines on colab or kaggle and run them:", "So, I used the TPU to train my model for a Kaggle competition. It\u2019s a simple one called: Plant Pathology 2020. You can check it out. I am going to skip over the data preprocessing, modeling code as that is a topic for another blog. Here, we are only concerned with running the model on TPU. I will attach the link to the complete Ipython notebook for you.", "So jumping straight to the training code, I will highlight the things needed for running the model parallelly. The first important thing is a distributed sampler for our Dataloader:", "xm.xrt_world_size() retrieves the number of devices that are taking part in the replication. (basically the number of cores)", "xm.get_ordinal() retrieves the replication ordinal of the current process. The ordinals range from 0 to xrt_world_size()-1", "The next thing is to train the model parallelly, traditional DataLoader has to be made into a ParallelLoaderobject and then passed into the training function. For this we do, pl.ParallelLoader(<your-dataloader>, [device])", "The device here is device = xm.xla_device() . We are simply, specifying were to send our model to run. In this case, it is a TPU or as PyTorch likes to call it and XLA device(If your\u2019e a PyTorch user then you can think of it as similar to torch.device('cuda') used to send the tensors to a GPU)", "Torch.xla has it\u2019s own specific requirements. U can\u2019t simply make a device using xm.xla_device() and pass the model to it.", "With all of the specifiactions in place now you\u2019re ready to train your model on a TPU in kaggle, not just kaggle but on colab too. I know it doesn\u2019t quite make complete sense. But this is just a preliminary explanation for you where you can come and refer the specifics. Once you look at the complete code you will understand everything. Best of luck! as promised here is my complete Kernel for Kaggle :)", "Also here is my Kaggle kernel link https://www.kaggle.com/abhiswain/pytorch-tpu-efficientnet-b5-tutorial-reference. If you found this useful you can upvote it! You can also go there and directly run it and see for yourself the magic.", "Let me tell you something, I made this to keep as a reference for myself but decided to share it. Let this be a stop for you in your journey of deep learning :)", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4afef63ee7ac&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://abhi08as-as.medium.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": ""}, {"url": "https://abhi08as-as.medium.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Abhishek Swain"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9bc3d14474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&user=Abhishek+Swain&userId=fd9bc3d14474&source=post_page-fd9bc3d14474----4afef63ee7ac---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/abhishek/bert-multi-lingual-tpu-training-8-cores-w-valid", "anchor_text": "this"}, {"url": "https://www.kaggle.com/abhishek", "anchor_text": "Abhishek Thakur"}, {"url": "https://www.youtube.com/watch?v=2oWf4v6QEV8", "anchor_text": "https://www.youtube.com/watch?v=2oWf4v6QEV8"}, {"url": "https://www.kaggle.com/c/plant-pathology-2020-fgvc7", "anchor_text": "Plant Pathology 2020"}, {"url": "https://www.kaggle.com/abhiswain/pytorch-tpu-efficientnet-b5-tutorial-reference", "anchor_text": "https://www.kaggle.com/abhiswain/pytorch-tpu-efficientnet-b5-tutorial-reference"}, {"url": "https://pytorch.org/xla/release/1.5/index.html#", "anchor_text": "orch X"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----4afef63ee7ac---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/xla?source=post_page-----4afef63ee7ac---------------xla-----------------", "anchor_text": "Xla"}, {"url": "https://medium.com/tag/tpu?source=post_page-----4afef63ee7ac---------------tpu-----------------", "anchor_text": "Tpu"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----4afef63ee7ac---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/kaggle?source=post_page-----4afef63ee7ac---------------kaggle-----------------", "anchor_text": "Kaggle"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&user=Abhishek+Swain&userId=fd9bc3d14474&source=-----4afef63ee7ac---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&user=Abhishek+Swain&userId=fd9bc3d14474&source=-----4afef63ee7ac---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4afef63ee7ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4afef63ee7ac---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4afef63ee7ac--------------------------------", "anchor_text": ""}, {"url": "https://abhi08as-as.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://abhi08as-as.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Abhishek Swain"}, {"url": "https://abhi08as-as.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "11 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9bc3d14474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&user=Abhishek+Swain&userId=fd9bc3d14474&source=post_page-fd9bc3d14474--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F75cc1e01588f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-on-a-tpu-parallelly-using-pytorch-xla-4afef63ee7ac&newsletterV3=fd9bc3d14474&newsletterV3Id=75cc1e01588f&user=Abhishek+Swain&userId=fd9bc3d14474&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}