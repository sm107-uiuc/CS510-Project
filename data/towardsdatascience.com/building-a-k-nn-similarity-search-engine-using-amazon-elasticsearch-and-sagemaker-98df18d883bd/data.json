{"url": "https://towardsdatascience.com/building-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd", "time": 1683005167.448218, "path": "towardsdatascience.com/building-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd/", "webpage": {"metadata": {"title": "Building a k-NN Similarity Search Engine using Amazon Elasticsearch and SageMaker | by Yi Ai | Towards Data Science", "h1": "Building a k-NN Similarity Search Engine using Amazon Elasticsearch and SageMaker", "description": "Amazon Elasticsearch Service recently added support for k-nearest neighbor search. It enables you to run high scale and low latency k-NN search across thousands of dimensions with the same ease as\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/yai333/knnelasticsearch/blob/master/knn-search.ipynb", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html", "anchor_text": "AWS official document", "paragraph_index": 7}, {"url": "https://github.com/UKPLab/sentence-transformers", "anchor_text": "sentence-transformers", "paragraph_index": 8}, {"url": "https://www.kaggle.com/quora/question-pairs-dataset", "anchor_text": "quora question paris datas", "paragraph_index": 11}, {"url": "https://github.com/yai333/knnelasticsearch/tree/master/cf-templates", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://github.com/yai333/knnelasticsearch", "anchor_text": "GitHub repo", "paragraph_index": 22}], "all_paragraphs": ["Amazon Elasticsearch Service recently added support for k-nearest neighbor search. It enables you to run high scale and low latency k-NN search across thousands of dimensions with the same ease as running any regular Elasticsearch query.", "k-NN similarity search is powered by Open Distro for Elasticsearch, an Apache 2.0-licensed distribution of Elasticsearch.", "In this post, I\u2019ll show you how to build a scalable similarity questions search api using Amazon Sagemaker, Amazon Elasticsearch, Amazon Elastic File System (EFS) and Amazon ECS.", "The following diagram shows the architecture of above steps:", "First, Let\u2019s create a Sagemaker notebook instance which connects to Elasticsearch and make sure then are in the same VPC.", "To configure VPC options in Sagemaker console, within Network section of Create notebook instance page, set VPC network configuration details such as VPC subnet IDs and security group IDs:", "We will do all the necessary sentence transforming steps in a SageMaker notebook (code found here).", "Now, mounting EFS to model directory, for more details about EFS, please check AWS official document.", "To run nearest neighbor search, we have to get sentence and tokens embeddings. We can use sentence-transformers which is a sentence embeddings using BERT / RoBERTa / DistilBERT / ALBERT / XLNet with PyTorch. It allows us to map sentences into fixed-length representations in just a few lines of code.", "We will use light weight DistilBERT model to generate sentence embeddings in this example, please note that the number of hidden units of DistilBERT is 768. This dimension seems too big to Elasticsearch index, we can reduce the dimension to 256 by adding a dense layer after the pooling:", "Next, Save sentence embedder to EFS mounted directory:", "We need to make sure dataset has been downloaded, the data set for this example is quora question paris datas.", "Next, extract full text of each question to dataframe:", "To start with, create a kNN index,", "then transform and index question vectors to Elasticsearch.", "Questions in Elasticsearch have the following structure:", "We have embedded questions into fixed-length vectors and indexed all of vectors to Elasticsearch. Let\u2019s create a rest api connects to Elasticsearch and test it out!", "We will use sample cloud formation template to create ECS Cluster and service in VPC (templates and bash scripts found here).", "We will use EFS volumes with ECS, search flow is 1)Flask application loads saved sentence embedder in EFS volume, 2)transform input parameter sentence to vectors, 3)then query K-Nearest neighbors in Elasticsearch.", "We now have flask api running in ECS container, let\u2019s use the basic search function to find similar questions when it comes to the query: \u201cWhat is best way to make money online?\u201d:", "As you can see, the result was pretty amazing, you can also fine-tune your own sentence embedding methods, so that you get task-specific sentence embeddings for k-NN search.", "Great! We have what we need! I hope you have found this article useful.", "The complete scripts can be found in my GitHub repo.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AWS Community Builder | AWS AZURE GCP Certified Engineer | A Cloud Technology Enthusiast | AWS Certified Security/Machine Learning/Database Analytics Specialty"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F98df18d883bd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yia333.medium.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": ""}, {"url": "https://yia333.medium.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Yi Ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22047a0ec61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&user=Yi+Ai&userId=22047a0ec61b&source=post_page-22047a0ec61b----98df18d883bd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/CXDw96Oy-Yw", "anchor_text": "NeONBRAND"}, {"url": "https://unsplash.com/photos/CXDw96Oy-Yw", "anchor_text": "Unsplash"}, {"url": "https://github.com/yai333/knnelasticsearch/blob/master/knn-search.ipynb", "anchor_text": "here"}, {"url": "https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html", "anchor_text": "AWS official document"}, {"url": "https://github.com/UKPLab/sentence-transformers", "anchor_text": "sentence-transformers"}, {"url": "https://www.kaggle.com/quora/question-pairs-dataset", "anchor_text": "quora question paris datas"}, {"url": "https://github.com/yai333/knnelasticsearch/tree/master/cf-templates", "anchor_text": "here"}, {"url": "https://github.com/yai333/knnelasticsearch", "anchor_text": "GitHub repo"}, {"url": "https://medium.com/tag/elasticsearch?source=post_page-----98df18d883bd---------------elasticsearch-----------------", "anchor_text": "Elasticsearch"}, {"url": "https://medium.com/tag/aws?source=post_page-----98df18d883bd---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/sagemaker?source=post_page-----98df18d883bd---------------sagemaker-----------------", "anchor_text": "Sagemaker"}, {"url": "https://medium.com/tag/knn?source=post_page-----98df18d883bd---------------knn-----------------", "anchor_text": "Knn"}, {"url": "https://medium.com/tag/bert?source=post_page-----98df18d883bd---------------bert-----------------", "anchor_text": "Bert"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&user=Yi+Ai&userId=22047a0ec61b&source=-----98df18d883bd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&user=Yi+Ai&userId=22047a0ec61b&source=-----98df18d883bd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F98df18d883bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----98df18d883bd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----98df18d883bd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----98df18d883bd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----98df18d883bd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----98df18d883bd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----98df18d883bd--------------------------------", "anchor_text": ""}, {"url": "https://yia333.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yia333.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yi Ai"}, {"url": "https://yia333.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "318 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22047a0ec61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&user=Yi+Ai&userId=22047a0ec61b&source=post_page-22047a0ec61b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Feb2bd512dbe0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-k-nn-similarity-search-engine-using-amazon-elasticsearch-and-sagemaker-98df18d883bd&newsletterV3=22047a0ec61b&newsletterV3Id=eb2bd512dbe0&user=Yi+Ai&userId=22047a0ec61b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}