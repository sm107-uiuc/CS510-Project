{"url": "https://towardsdatascience.com/tensorflow-2-2-and-a-custom-training-logic-16fa72934ac3", "time": 1683009915.704791, "path": "towardsdatascience.com/tensorflow-2-2-and-a-custom-training-logic-16fa72934ac3/", "webpage": {"metadata": {"title": "TensorFlow 2.2+ and Custom Training Logic | by Libor Vanek | Towards Data Science", "h1": "TensorFlow 2.2+ and Custom Training Logic", "description": "Introduction to a new train_step and test_step methods of tf.keras.Model."}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/api_docs/python/tf/keras/Sequential", "anchor_text": "sequential", "paragraph_index": 0}, {"url": "https://www.tensorflow.org/guide/keras/functional", "anchor_text": "functional", "paragraph_index": 0}, {"url": "https://www.tensorflow.org/guide/keras/functional#models_with_multiple_inputs_and_outputs", "anchor_text": "multiple inputs", "paragraph_index": 1}, {"url": "https://www.tensorflow.org/guide/keras/functional#models_with_multiple_inputs_and_outputs", "anchor_text": "multiple outputs", "paragraph_index": 1}, {"url": "https://www.tensorflow.org/datasets/catalog/beans", "anchor_text": "beans", "paragraph_index": 4}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "There", "paragraph_index": 7}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "gist", "paragraph_index": 7}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/applications/MobileNetV2", "anchor_text": "MobileNet", "paragraph_index": 9}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/GlobalAveragePooling2D", "anchor_text": "GlobalAveragePooling2D", "paragraph_index": 9}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dropout", "anchor_text": "Dropout", "paragraph_index": 9}, {"url": "https://www.tensorflow.org/tutorials/customization/custom_training_walkthrough", "anchor_text": "the official documentation", "paragraph_index": 10}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/Model", "anchor_text": "tf.keras.Model", "paragraph_index": 12}], "all_paragraphs": ["You are all familiar with the standard model \u2014 one input, one output, one loss function. And maybe a couple of metrics. You can define the model in a sequential or functional fashion, compile it and train it.", "Sometimes, there are multiple inputs. Or multiple outputs. This is still doable with those APIs. Provided that the outputs are \u201cindependent\u201d \u2014 the loss function (one for all or one per output) works separately on each of them.", "Occasionally, we need to go even further. Maybe the loss is calculated from more outputs. Or there are some additional information used to calculate the loss. This is when a custom training loop must be implemented.", "I will not cover such specific use case in this blog post. I will show you a simplified example instead, illustrating three ways how to train it. Later on, I will continue with a more complex example. So stay tuned!", "Even in tutorials, I like runnable code and even real world problems. So let's take one of the TensorFlow Datasets \u2014 beans.", "Beans is a dataset of images of beans taken in the field using smartphone cameras. It consists of 3 classes: 2 disease classes and the healthy class. Diseases depicted include Angular Leaf Spot and Bean Rust. Data was annotated by experts from the National Crops Resources Research Institute (NaCRRI) in Uganda and collected by the Makerere AI research lab.", "It is rather small (171.63 MiB, 1295 images) and it enables us to train our model quite fast. Results look promising even after small number of epochs.", "There is a common code for the following three chapters, containing mainly preparation of the dataset and a training setup. It is not directly connected to our topic and i did not want to make the article too long so please check the accompanying gist if you want.", "This is how you define and train a simple transfer model. Nothing mysterious, but I will show it here for the sake of completeness.", "I used MobileNet with a couple of additional layers. GlobalAveragePooling2D converts the features to a single vector which can be then used by a final dense layer. In between, I used Dropout. Remember, the dataset is quite small and we have to be careful about overfitting. The rest is straightforward.", "Detailed description of a custom training loop can be found in the official documentation. If we translate this to our problem from the previous paragraph, we get the following code:", "You see all the code which just takes care about tracking the loss and the accuracy? Now imagine you have multiple metrics and a couple of callbacks, including for example TensorBoard. And you want to have a nicer output. The code starts to expand more and more.", "Since TensorFlow 2.2, all this boiler plate code is no longer needed. You only need to tell TensorFlow how every single train step (and possibly test step) will look like. The rest is done inside the tf.keras.Model class. Let\u2019s not beat around the bush, here is the code:", "I would like to point out two things:", "So what happens when you do leave compile()out? You still need to add a bit of code. But notice the big difference from the completely custom training loop. You are now specifying the behavior of one step. Because of this, the parent Model class can take care about all the supporting functionality. For example print nice progress bars or calling all the callbacks. (They can be provided in the usual way as a parameter to the fitmethod.)", "I tried to write all the important comments into the code itself. Therefore I will add only one small note here. It is possible to leave out the metric() property and return directly name: (float) value pairs in train_step()and test_step(). The progress output will be OK and you will see an average values there. But not in your callbacks. There, you will get exactly the same values you returned.", "In this blog post, I walked you through different ways of training you model in TensorFlow, including overwriting of the new methods train_step and test_stepof a Keras Model. The example was far to simple to use them. But I hope it served its purpose in demonstrating the different approaches without the need to explain a complicated model. I would like to do than in some upcoming article.", "If you found this useful, please leave me a comment. If you have any question, please feel free to do the same. I would be glad to answer you.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F16fa72934ac3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://libor-vanek.medium.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": ""}, {"url": "https://libor-vanek.medium.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Libor Vanek"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F90ae692ebe71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&user=Libor+Vanek&userId=90ae692ebe71&source=post_page-90ae692ebe71----16fa72934ac3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/photo/contemporary-gradient-handrails-perspective-434645/", "anchor_text": "pexels.com"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/Sequential", "anchor_text": "sequential"}, {"url": "https://www.tensorflow.org/guide/keras/functional", "anchor_text": "functional"}, {"url": "https://www.tensorflow.org/guide/keras/functional#models_with_multiple_inputs_and_outputs", "anchor_text": "multiple inputs"}, {"url": "https://www.tensorflow.org/guide/keras/functional#models_with_multiple_inputs_and_outputs", "anchor_text": "multiple outputs"}, {"url": "https://www.tensorflow.org/datasets/catalog/beans", "anchor_text": "beans"}, {"url": "https://www.tensorflow.org/datasets/catalog/beans", "anchor_text": "tensorflow.org"}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "There"}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "gist"}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "this code"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/applications/MobileNetV2", "anchor_text": "MobileNet"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/GlobalAveragePooling2D", "anchor_text": "GlobalAveragePooling2D"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dropout", "anchor_text": "Dropout"}, {"url": "https://www.tensorflow.org/tutorials/customization/custom_training_walkthrough", "anchor_text": "the official documentation"}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "this code"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/Model", "anchor_text": "tf.keras.Model"}, {"url": "https://gist.github.com/liborvaneksw/60597e7f473a739e439b589e8dea295f", "anchor_text": "this code"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----16fa72934ac3---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/tensorflow2?source=post_page-----16fa72934ac3---------------tensorflow2-----------------", "anchor_text": "Tensorflow2"}, {"url": "https://medium.com/tag/image-detection?source=post_page-----16fa72934ac3---------------image_detection-----------------", "anchor_text": "Image Detection"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----16fa72934ac3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----16fa72934ac3---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&user=Libor+Vanek&userId=90ae692ebe71&source=-----16fa72934ac3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&user=Libor+Vanek&userId=90ae692ebe71&source=-----16fa72934ac3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F16fa72934ac3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----16fa72934ac3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----16fa72934ac3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----16fa72934ac3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----16fa72934ac3--------------------------------", "anchor_text": ""}, {"url": "https://libor-vanek.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://libor-vanek.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Libor Vanek"}, {"url": "https://libor-vanek.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "70 Followers"}, {"url": "https://www.linkedin.com/in/libor-vanek/", "anchor_text": "https://www.linkedin.com/in/libor-vanek/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F90ae692ebe71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&user=Libor+Vanek&userId=90ae692ebe71&source=post_page-90ae692ebe71--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F90ae692ebe71%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-2-2-and-a-custom-training-logic-16fa72934ac3&user=Libor+Vanek&userId=90ae692ebe71&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}