{"url": "https://towardsdatascience.com/what-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69", "time": 1683009112.258977, "path": "towardsdatascience.com/what-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69/", "webpage": {"metadata": {"title": "What is your sample size? The dangers of pseudo-replication | by Wicaksono Wijono | Towards Data Science", "h1": "What is your sample size? The dangers of pseudo-replication", "description": "Simple, right? In introductory statistics courses, sample size is always given. n = 1000. Or n = 20. But in the real world, you have to figure out n by yourself. But much of real world data is not\u2026"}, "outgoing_paragraph_urls": [{"url": "https://documentation.sas.com/?docsetId=statug&docsetTarget=statug_glimmix_details40.htm%3Flocale&docsetVersion=14.2&locale=en", "anchor_text": "we can", "paragraph_index": 15}, {"url": "https://en.m.wikipedia.org/wiki/Random_effects_model", "anchor_text": "random effects model", "paragraph_index": 31}, {"url": "https://towardsdatascience.com/stop-using-uniform-priors-47473bdd0b8a", "anchor_text": "never be used", "paragraph_index": 31}, {"url": "https://towardsdatascience.com/a-primer-on-generalized-linear-models-ab1769a03100", "anchor_text": "GLM article", "paragraph_index": 38}], "all_paragraphs": ["Simple, right? In introductory statistics courses, sample size is always given. n = 1000. Or n = 20. But in the real world, you have to figure out n by yourself.", "If the data is flat, then n is the number of rows. Easy.", "But much of real world data is not flat. What is n? What is love? What does the fox say? What is the meaning of life, the universe, and everything? These are the questions that keep me up at night.", "We will start with an overly simplistic example. At first glance, the question \u201cwhat is n?\u201d sounds absolutely useless, but hopefully towards the end you\u2019ll see that this is a ubiquitous and practical business problem. It is common enough that we have ten thousand rows of data, yet the \u201csample size\u201d is closer to ten.", "The \u201csample size\u201d plays a direct role in the quantification of uncertainty. A point estimate is not enough; what is the plausible range of values?", "Imagine you want to find the average height of students at a school. I\u2019m an oracle and know that the true average height is 167 cm, but you don\u2019t know that.", "You secured 10 volunteers, which are representative samples from the normally distributed population (hey, I said imagine). You take out your measuring tape and record, in centimeters:", "Given the setup, 95% of the random samples you take will result in a 95% CI that includes 167.", "You bought your measuring tape from a discount store and you were told it\u2019s cursed: it provides measurements that are slightly off but correct on average.", "It comes with a second measuring tape, for free! The second measuring tape is also cursed in the same way. But you can choose the color!", "As you announce that you will be taking measurements a second time, half of the students said they\u2019ll be late for class and hurriedly left. You used the second tape to record the heights of the first five students, so now your data looks like", "You have 10 students but 15 measurements. This is pseudo-replication \u2014 you have collected more data, but the number of sampling units (students) remains unchanged.", "How should you estimate the average height? If you average the 15 measurements, then some students get double-counted. Your level if uncertainty will be off because your observations are no longer independent. The measurements of a student depend on the student\u2019s true height.", "The correct way is to take the average measurement per student so your data looks like:", "And then you take the average of this to get an estimate of 162.4 \u2014 average of averages, so to speak. (If you\u2019re not doing this for your A/B tests, you either have an alarming problem or have a better and more advanced method.) But how do you build the confidence interval? You are more certain of the first five values, but are we going to pretend that the latter five carry just as much information?", "For that matter, what is n? What is the correct degrees of freedom of the model? We can\u2019t answer that (well, actually, we can, but only for iid Gaussian errors) but it\u2019s better to pretend that n=10 rather than n=15. We\u2019d expect the answer, if it exists, to be somewhere between 10 and 15. We\u2019ll get back to this later.", "After class ended, the remaining five students came to you to get their second measurements taken (hey, they\u2019re nice folks). You maniacally laugh at your now complete dataset, and you can\u2019t wait to unleash its potential in unlocking the secrets of the universe:", "You take the mean and standard deviation of all observations and construct the 95% CI with n = 20 to get the interval (157.6, 167.1) centered on 162.4.", "Then lightning strikes you because the universe doesn\u2019t want this kind of faulty analysis to see the light of day.", "Imagine that you repeatedly take measurements three more times and record these observations:", "Treating these as 50 independent observations (in other words, ignoring pseudo-replication) will result in a very narrow 95% CI of (159.4, 165.1) centered on 162.3. The true value of 167 lies well outside of the CI.", "If you repeat the setup with different students, 167 will lie outside the interval much more often than the desired 5% of the time.", "The problem is this: you are observing the same 10 students. Why would seeing them over and over again make you that much more certain of the population mean? If that worked, why would people spend so much money collecting data when they can stare at the same thing many many times?", "Given that the measurement errors come from the same normal distribution (i.e. the errors are Gaussian, independent of the students\u2019 true heights), the correct approach is to take the average of averages:", "In reality, very rarely is data ever balanced. Even when you set up a study where the end goal is to get balanced data, participants can and will drop out.", "If the bolded error assumption is not reasonable (e.g. binary outcomes) then we cannot do this and have to use more complicated models:", "At its core, Bayesian ML handles pseudo-replication (though it also works for flat data).", "This doesn\u2019t sound remarkable until you realize that the overwhelming majority of data suffers from pseudo-replication. Businesses have repeat customers and take (hopefully) multiple measurements from each customer. Studies might want to track the same people over time.", "Remember how we squashed 15 observations into n=10? You can have a dozen stores with thousands of customers each, but once some questions are posed (\u201cWhat is the average uplift from the promotion?\u201d), you virtually have to squash 10,000 observations into n=12. Either that or you have to pretend that your dependent observations are independent. Not very pretty.", "Most of the popular machine learning algorithms (xgboost, random forest, GLM, etc.) do not innately handle pseudo-replication. There are two possible options. You can properly randomize the folds in cross-validation (observations from the same student should never go to different folds!) and hope the results can be generalized. Or, you can aggregate the data (e.g. average the measurements by student) and discard some information.", "Here\u2019s the R code I used to generate the data above:", "To get frequentist-like estimates, I will use MCMC with extremely weak / uniform priors to fit a random effects model. In practice these priors should never be used outside of basic examples.", "Using the balanced data with 50 observations, the posterior distribution has a 95% credible interval of (154.2, 170.2) and mean of 162.3. This is slightly wider than the CI we got earlier, partly because we are estimating one additional nuisance parameter: measurement errors.", "The magic happens in the unbalanced case. The 95% credible interval is (154.4, 170.0) and we don\u2019t have to make guesses about what n to use. The benefit is not clear in this example because we\u2019re working with the setup where ignoring pseudo-replication is least harmful.", "However, as we drift further away from the comfort of :", "* Gaussian distributions (e.g. binary outcomes, heavily skewed population distribution)", "* uncorrelated parameters (e.g. loyal customers are likely to visit more and spend more)", "* somewhat balanced data (e.g. some customers make a hundred visits a week while others make a single visit)", "going with average-of-averages will give progressively worse results. (Check out my GLM article to understand the details of precision-weighted averages.)", "Intuitively, it\u2019s because average-of-averages pretends that all sampling units have equal weight even when they don\u2019t.", "Considering that some of the most universal metrics are percentages (e.g. conversion rate) or extremely right-skewed (e.g. average spending), Bayesian machine learning has a place in every organization.", "In closing, if you often have to make statistical inferences at work, consider picking up Bayesian machine learning as a core part of your toolkit. They are practically designed to tackle the pseudo-replication problem that\u2019s so prevalent in real-world data.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Bayesian data scientist. Alternates between light reading and more in-depth articles about applied statistics and machine learning."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc66cab14fc69&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@wwijono?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wwijono?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Wicaksono Wijono"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5e69e4814607&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&user=Wicaksono+Wijono&userId=5e69e4814607&source=post_page-5e69e4814607----c66cab14fc69---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.flickr.com/photos/wwarby/4915970843", "anchor_text": "source"}, {"url": "https://www.flickr.com/photos/wwarby/4915970843", "anchor_text": "source"}, {"url": "https://documentation.sas.com/?docsetId=statug&docsetTarget=statug_glimmix_details40.htm%3Flocale&docsetVersion=14.2&locale=en", "anchor_text": "we can"}, {"url": "https://www.flickr.com/photos/adamrice/156643942", "anchor_text": "source"}, {"url": "https://en.m.wikipedia.org/wiki/Random_effects_model", "anchor_text": "random effects model"}, {"url": "https://towardsdatascience.com/stop-using-uniform-priors-47473bdd0b8a", "anchor_text": "never be used"}, {"url": "https://towardsdatascience.com/a-primer-on-generalized-linear-models-ab1769a03100", "anchor_text": "GLM article"}, {"url": "https://www.flickr.com/photos/adamrice/156643942", "anchor_text": "source"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c66cab14fc69---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/statistics?source=post_page-----c66cab14fc69---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/analytics?source=post_page-----c66cab14fc69---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c66cab14fc69---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/business-intelligence?source=post_page-----c66cab14fc69---------------business_intelligence-----------------", "anchor_text": "Business Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&user=Wicaksono+Wijono&userId=5e69e4814607&source=-----c66cab14fc69---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&user=Wicaksono+Wijono&userId=5e69e4814607&source=-----c66cab14fc69---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc66cab14fc69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c66cab14fc69---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c66cab14fc69--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c66cab14fc69--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c66cab14fc69--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wwijono?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wwijono?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Wicaksono Wijono"}, {"url": "https://medium.com/@wwijono/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "785 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5e69e4814607&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&user=Wicaksono+Wijono&userId=5e69e4814607&source=post_page-5e69e4814607--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd2f99368ce0a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhat-is-your-sample-size-the-dangers-of-pseudo-replication-c66cab14fc69&newsletterV3=5e69e4814607&newsletterV3Id=d2f99368ce0a&user=Wicaksono+Wijono&userId=5e69e4814607&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}