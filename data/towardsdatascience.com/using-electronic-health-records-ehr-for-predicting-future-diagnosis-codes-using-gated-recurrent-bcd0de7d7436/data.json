{"url": "https://towardsdatascience.com/using-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436", "time": 1682995374.763982, "path": "towardsdatascience.com/using-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436/", "webpage": {"metadata": {"title": "Using Electronic Health Records to predict future diagnosis codes with Gated Recurrent Units | by Sparkle Russell-Puleri | Towards Data Science", "h1": "Using Electronic Health Records to predict future diagnosis codes with Gated Recurrent Units", "description": "Electronic medical records( EMRs), which is sometimes interchangeably called Electronic health records(EHRs) are primarily used to electronically-store patient health data digitally. While the use of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/sparkle-russell-puleri-ph-d-a6b52643", "anchor_text": "Sparkle Russell-Puleri", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/dorian-puleri-ph-d-25114511", "anchor_text": "Dorian Puleri", "paragraph_index": 0}, {"url": "https://medium.com/@sparklerussell/predicting-future-medical-diagnoses-with-rnns-using-fast-ai-api-from-scratch-ecf78aaf56a2", "anchor_text": "Using the Fast AI API", "paragraph_index": 7}, {"url": "https://medium.com/@sparklerussell/gated-recurrent-units-explained-with-matrices-part-2-training-and-loss-function-7e7147b7f2ae", "anchor_text": "Gated Recurrent Units Review", "paragraph_index": 8}, {"url": "https://github.com/mp2893/doctorai)", "anchor_text": "https://github.com/mp2893/doctorai)", "paragraph_index": 12}, {"url": "https://towardsdatascience.com/gate-recurrent-units-explained-using-matrices-part-1-3c781469fc18", "anchor_text": "GRUs tutorial", "paragraph_index": 19}, {"url": "https://medium.com/@sparklerussell/using-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436", "anchor_text": "part 1", "paragraph_index": 19}, {"url": "https://mimic.physionet.org/", "anchor_text": "MIMIC III electronic health record (EHR) dataset", "paragraph_index": 19}, {"url": "https://medium.com/@sparklerussell/predicting-future-medical-diagnoses-with-rnns-using-fast-ai-api-from-scratch-ecf78aaf56a2", "anchor_text": "Part 2", "paragraph_index": 26}], "all_paragraphs": ["by: Sparkle Russell-Puleri and Dorian Puleri", "Electronic medical records( EMRs), which is sometimes interchangeably called Electronic health records(EHRs) are primarily used to electronically-store patient health data digitally. While the use of these systems seem commonplace today, most notably due to the passing of the Health Information Technology for Economic and Clinical Health Act in 2014. There adaption implementation into healthcare facilities across the US was very slow. Nonetheless, EHR/EMR systems now posses a wealth of longitudinal patient data which can move us closer to developing patient-centered personalized healthcare solutions. That being said, EHR data can be very messy and sparse. Despite these challenges, if harnessed properly EHR data can provide real world data insights on patient journeys, treatment patterns, predict a patients next diagnosis code or risk of readmission and mortality etc.", "As of 2018, it has been reported that healthcare data alone accounts for about 30% of the world\u2019s data production. As a result, there is no secret that many companies and investors are looking to healthcare as the next big investment. However, in order to deliver real solutions on the patient level, we need to understand how to harness and process the wealth of data that we have at hand. To this end, this tutorial will focus on breaking down how to process EHR data for use in AI algorithms. The hope is that with this insight using simulated data, we can get more data scientist and enthusiast on board to democratizing healthcare data and inch closer to making EHR data actionable on the patient level.", "For the purpose of this three part tutorial, we generated some artificial EHR data to demonstrate how EHR data should be processed for use in sequence models. Please note that this data has no clinical relevance and was just created for training purposes only.", "Part 1: Generating artificial EHR data", "Part 2: Pre-processing artificially generated EHR data", "Part 3: Doctor AI Pytorch minimal implementation", "Full Implementation: Using the Fast AI API", "If you need a quick review on the inner workings of GRUs , see the Gated Recurrent Units Review.", "This table contains information on the patient admission history and times. The features generated were:", "The diagnosis table is quite unique, as it can contain several diagnosis codes for the same visit. For example, Patient 1 was diagnosed with diabetes (PrimaryDiagnosisCode:E11.64) during his/her first visit (Admission ID:12). However, this code also shows up on subsequent visits (Admission ID:34, 15), why is that? Well if a patient is diagnosed with an uncurable condition he/she that code will always be associated all subsequent visits. On the other hand, codes associated with acute care, will come and go as seen with PrimaryDiagnosisCode:780.96(headache).", "Why do this step? Unless your EHR system has uniquely identifiable Admission IDs for each patients visit, it would be difficult to associate each patient ID with a unique Admission ID. To demonstrate this, we deliberately created double digit Admission IDs one of which was repeated ( Admission ID: 34) for both patients. To avoid this, we took a pre-cautionary step to create a hash key that is a unique combination of the first half of the the unique PatientIDhyphenated with the patient's specific Admission ID.", "In this section we will demonstrate how to process the data in preparation for modeling.The intent of this tutorial is to provide a detailed step through on how EHR data should be pre-processed for use in RNNs using Pytorch. This paper is one of the few papers that provide a code base to start taking a detailed look into how we can build generic models that leverages temporal models to predict future clinical events. However, while this highly cited paper is open sourced (written using Theano:https://github.com/mp2893/doctorai), it assumes quite a bit about its readers. As such, we have modernized the code for ease of use in python 3+ and provided a detailed explanation of each step to allow anyone, with a computer and access to healthcare data to begin trying to develop innovative solutions to solve healthcare challenges.", "This data set was artificial created with two patients in Part 1 of this series to help provide readers with a clear understanding of the basic structure of EHR data. Please note that each EHR system is specifically designed to meet a specific providers needs and this is just a basic example of data that is typically contained in most systems. Additionally, it is also key to note that this tutorial begins after all of the desired exclusion and inclusion criteria related to your research question has been performed. Therefore, at this step your data would have been fully wrangled and cleaned.", "In this step we are going to create a dictionary that maps each patient with his or her specific visit or Admission ID.", "This step as with all subsequent steps is very important as it is important to keep the patient\u2019s diagnosis codes in the correct visit order.", "This step essentially adds each code assigned to the patient directing into the dictionary with the patient-admission id mapping and the visit date mapping visitMap. Which allows us to have a list of list of diagnosis codes that each patient received during each visit.", "In this step, we will create a list of all of the diagnosis codes, this will then be used in step 4b to convert these strings into integers for modeling.", "Here we need to make sure that the codes are not only converted to integers but that they are kept in the unique orders in which they were administered to each unique patient.", "We will now apply the knowledge gained from the GRUs tutorial and part 1 of this series to a larger publicly available EHR dataset.This study will utilize the MIMIC III electronic health record (EHR) dataset, which is comprised of over 58,000 hospital admissions for 38,645 adults and 7 ,875 neonates. This dataset is a collection of de-identified intensive care unit stays at the Beth Israel Deaconess Medical Center from June 2001- October 2012. Despite being de-identified, this EHR dataset contains information about the patients\u2019 demographics, vital sign measurements made at the bedside (~1/hr), laboratory test results, billing codes, medications, caregiver notes, imaging reports, and mortality (during and after hospitalization). Using the pre-processing methods demonstrated on artificially generated dataset in (Part 1 & Part 2) we will create a companion cohort for use in this study.", "This model was trained on a GPU enabled system\u2026highly recommended.", "The data pre-processed datasets will be loaded and split into a train, test and validation set at a 75%:15%:10% ratio.", "The input tensors were padded with zeros, note that the inputs are padded to allow the RNN to handle the variable length inputs. A mask was then created to provide the algorithm information about the padding. Note this can be done using Pytorch\u2019s utility pad_pack_sequence function. However, given the nested nature of this dataset, the encoded inputs were first multi-one hot encoded. This off-course creates a high-dimenisonal sparse inputs, however the dimensionality was then projected into a lower-dimensional space using an embedding layer.", "This class contains randomly initiated weights needed to begin calculating the hidden states of the algorithms. Note that in this paper the author used embedding matrix (W_emb) generated using the skip-gram algorithm, which outperformed the randomly initialized approached shown in this step.", "The purpose of this class is to perform the initially embedding followed by calculating the hidden states and performing dropout between the layers.", "This model is a minimal implementation for the Dr.AI algorithm created by Edward Choi, while functional it requires significant tuning. This will be demonstrated in a subsequent tutorial.", "This should serve as starter code to get the model up and running. As noted before, a significant amount of tuning will be required as this was built using custom classes. Part 2 of this tutorial shows the full implementation of this paper.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbcd0de7d7436&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@sparklerussell?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sparklerussell?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Sparkle Russell-Puleri"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4c795c746a8d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&user=Sparkle+Russell-Puleri&userId=4c795c746a8d&source=post_page-4c795c746a8d----bcd0de7d7436---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.linkedin.com/in/sparkle-russell-puleri-ph-d-a6b52643", "anchor_text": "Sparkle Russell-Puleri"}, {"url": "https://www.linkedin.com/in/dorian-puleri-ph-d-25114511", "anchor_text": "Dorian Puleri"}, {"url": "https://medium.com/@sparklerussell/predicting-future-medical-diagnoses-with-rnns-using-fast-ai-api-from-scratch-ecf78aaf56a2", "anchor_text": "Using the Fast AI API"}, {"url": "https://medium.com/@sparklerussell/gated-recurrent-units-explained-with-matrices-part-2-training-and-loss-function-7e7147b7f2ae", "anchor_text": "Gated Recurrent Units Review"}, {"url": "https://github.com/sparalic/Electronic-Health-Records-GRUs", "anchor_text": "https://github.com/sparalic/Electronic-Health-Records-GRUs"}, {"url": "https://github.com/mp2893/doctorai)", "anchor_text": "https://github.com/mp2893/doctorai)"}, {"url": "https://towardsdatascience.com/gate-recurrent-units-explained-using-matrices-part-1-3c781469fc18", "anchor_text": "GRUs tutorial"}, {"url": "https://medium.com/@sparklerussell/using-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436", "anchor_text": "part 1"}, {"url": "https://mimic.physionet.org/", "anchor_text": "MIMIC III electronic health record (EHR) dataset"}, {"url": "https://medium.com/@sparklerussell/predicting-future-medical-diagnoses-with-rnns-using-fast-ai-api-from-scratch-ecf78aaf56a2", "anchor_text": "Part 2"}, {"url": "https://arxiv.org/abs/1511.05942", "anchor_text": "https://arxiv.org/abs/1511.05942"}, {"url": "https://medium.com/tag/healthcare?source=post_page-----bcd0de7d7436---------------healthcare-----------------", "anchor_text": "Healthcare"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----bcd0de7d7436---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----bcd0de7d7436---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----bcd0de7d7436---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----bcd0de7d7436---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&user=Sparkle+Russell-Puleri&userId=4c795c746a8d&source=-----bcd0de7d7436---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&user=Sparkle+Russell-Puleri&userId=4c795c746a8d&source=-----bcd0de7d7436---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbcd0de7d7436&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bcd0de7d7436---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bcd0de7d7436--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sparklerussell?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sparklerussell?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sparkle Russell-Puleri"}, {"url": "https://medium.com/@sparklerussell/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "171 Followers"}, {"url": "https://sparalic.github.io", "anchor_text": "https://sparalic.github.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4c795c746a8d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&user=Sparkle+Russell-Puleri&userId=4c795c746a8d&source=post_page-4c795c746a8d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6b72d9ab4946&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-electronic-health-records-ehr-for-predicting-future-diagnosis-codes-using-gated-recurrent-bcd0de7d7436&newsletterV3=4c795c746a8d&newsletterV3Id=6b72d9ab4946&user=Sparkle+Russell-Puleri&userId=4c795c746a8d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}