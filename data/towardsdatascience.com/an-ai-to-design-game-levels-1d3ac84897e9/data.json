{"url": "https://towardsdatascience.com/an-ai-to-design-game-levels-1d3ac84897e9", "time": 1683013578.790245, "path": "towardsdatascience.com/an-ai-to-design-game-levels-1d3ac84897e9/", "webpage": {"metadata": {"title": "An AI to design game levels. How we developed a genetic algorithm\u2026 | by Mathieu d'Aquin | Towards Data Science", "h1": "An AI to design game levels", "description": "A couple of months ago, my son Hugo (12) and I decided to learn to develop games with Unity. We would do that by actually making one. We thought up a puzzle game called Elemaze, were little guys\u2026"}, "outgoing_paragraph_urls": [{"url": "https://unity.com/", "anchor_text": "Unity", "paragraph_index": 0}, {"url": "https://hairygamedev.itch.io/ai-will-survive", "anchor_text": "tch.io", "paragraph_index": 0}, {"url": "https://play.google.com/store/apps/details?id=com.dAquinGames.AIWillSurvive&hl=en", "anchor_text": "Google Play", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/A*_search_algorithm", "anchor_text": "A*", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Fitness_proportionate_selection", "anchor_text": "Roulette Wheel Selection", "paragraph_index": 13}, {"url": "https://play.google.com/store/apps/details?id=com.HairyGameDev.Elemaze&gl=GB", "anchor_text": "Google Play", "paragraph_index": 24}, {"url": "https://hairygamedev.itch.io/elemaze", "anchor_text": "itch.io", "paragraph_index": 24}], "all_paragraphs": ["A couple of months ago, my son Hugo (12) and I decided to learn to develop games with Unity. We would do that by actually making one. We thought up a puzzle game called Elemaze, were little guys representing the four elements have to collaborate to figure out a path to a chest in a maze. We learned a lot about coding, graphics, game mechanics, etc. Hugo went on to create his own game, \u201cA.I. Will survive\u201d, as a challenge to himself (see it on itch.io and on Google Play) and we participated in 2 game jams (we didn\u2019t do great really, but it is all about the experience and the fun). What we really learned however is that, once the basics are in, it is not the coding or mechanics or music or graphics that take time, it is making the levels.", "So, this is a story of how we created a genetic algorithm to design levels for Elemaze. It is also a story of how more traditional approaches to AI are still incredibly relevant, much easier to implement, and, especially in the case of genetic algorithms, can come up with completely new, creative and impressive solutions to problems that would have us scratch our heads endlessly.", "The game we created is relatively simple, with emphasis on relatively. Each level is a maze, in a grid, where each cell/tile has a floor of one of four colours: white for air, blue for water, red for fire and green for earth. There is a chest somewhere in the maze, and the goal is for one of the four characters \u2014 airman, waterman, fireman and earthman \u2014 to get to the chest. Each character can be told to go to any other unoccupied cell in the maze and will follow the shortest path to get there. Simple enough so far, but obviously there is more. Each of the characters might get killed by a certain tile colour, and can change one colour to another. Namely:", "That creates a lot of interesting possibilities where one character will have to go change colours somewhere so, that another could get moving, but not before another one has gotten out of the way. Levels can be simple (move one character to open the way for another) or more complicated (several back and forth movements until one character can finally get to the chest). Coming up with those more complicated levels is, however, very hard. We created 18 levels by hand, most of them simple (2 to 4 steps), some slightly harder (5 and 6 steps), before deciding that we needed help.", "The perspective of spending hours to create enough levels for the game to be releasable did not fill us with happiness. We often came up with a level that we believed to be hard until we tested it and realised that there was a simple solution to it or no solution at all. Laziness being the driver of innovation, that\u2019s when we thought: \u201cMaybe we can AI this problem away!\u201d. I have been doing research in AI and have taught many different AI techniques for a very long time. I knew the ingredients we had (a \u201cdesign\u201d problem with a relatively measurable success criterion: The level should be hard to solve), and the ones we didn\u2019t have (thousands of examples of good levels, rules on how to make a level, etc). Genetic algorithms seemed ideally suited for this, but before starting, we had to put a lot of things in place, including a way to represent levels and a way to automatically (and preferably quickly) solve them.", "Skipping about a million details, we created a basic JSON format for the representation of levels (position of the chest, of each of the characters, and a matrix of cells with for each information about its colour and the directions a character could follow from it). We also came up with a way to display a level in the terminal (see below), because loading Unity every time we wanted to see a result was not going to work.", "Given any level, we then needed to be able to solve it, so we could know, first, that it had a solution, and second, how hard it was to solve it (how many steps it took). Skipping many more details, we implemented the A* search algorithm where every step of the search corresponds to moving one character to a given cell in the level. The evaluation of the next step to try was based on the number of steps already done (g(n)) and, as an estimate of the cost of extending the path (h(n)), the minimum distance between a character and the chest, ignoring the walls. Since this is always underestimating the cost of reaching the chest from a given position, we are guaranteed, according to the properties of the A* algorithm, that the solution found is optimal. It will always find the solution with the shortest number of steps.", "You would think that being able to solve a level does not get us very close to being able to invent one, right? Well actually, that\u2019s the whole point of genetic algorithms: The one thing you need to make it work is to know what you are looking for in a way that can be tested. Genetic algorithms are based on the theory of evolution: Species become better adapted to their environment because of natural selection (\u201csurvival of the fittest\u201d) and small modifications to the gene pool that add up over time (mutations). So the first thing we need is to be able to know how \u201cfit\u201d a level is. We need a fitness function that tells us whether a level is a good one.", "So how do we know if a level is good? We want levels that are not too easy to solve, so for which solutions require a certain number of steps. So we can say that a level is fitter if it gets closer to an ideally large number of steps S to be solved. And it\u2019s that simple. Say our solver returns (as it does) not only the solution for a given level l, but also the number of steps in that solution nsol(l). Our fitness function for level l can be as basic as", "If S is 12 for example, and the current level requires a 7 step solution, the fitness value of this level is 7/12, or 0.583. Note that in the code we use something slightly more complicated, as we added a component to the function that nudges levels towards being more compact (taking less space), but that can be mostly be ignored.", "Assuming that we have a level, the next question is, what very small changes can be made to it so it might move towards a better solution (or, more likely, become an unsolvable, non-viable member of the species). Here, we can randomly change 3 things: The location of one of the characters, the colour of the floor in one cell or the walls in one cell. So what we do is randomly choose one of those changes, and apply them, on a random character or cell.", "We have fitness and we have mutation. We would normally, to be complete, also add crossover, i.e. the mixing of pairs of selected individuals so to create new solutions. We leave this out here for two reasons: To simplify an already long story, and because our first tests were done without crossover, and the results were great. With those two elements in place, the general process of the genetic algorithm is the following:", "One bit that I haven\u2019t talked about is Step 1: Generating an initial population. It turns out that creating a process by which a random but valid level could be generated was the most tedious part to do. Attributing random positions to the characters, random colours to the cells and placing random walls is not so much the issue, as is making sure that the level \u201cmade sense\u201d. Characters should be placed on non-empty cells and not on top of each other (or on top of the chest). Walls should be placed so that you could not fall-off the level, or onto an empty cell, etc. To avoid unnecessary boring details, let\u2019s assume we have that done, so on to selection!", "Selecting individuals for the next generation is done using \u201cRoulette Wheel Selection\u201d (or \u201cFitness Proportionate Selection\u201d). The short version of describing it is that it is a way to \u201cnot completely randomly\u201d select individuals in a population so that an individual with a fitness double the one of another would be twice more likely to be selected. In other words, it is a way to implement \u201csurvival of the fittest\u201d that\u2019s not as binary as the phrase makes it sound (it should be \u201chighest probability of survival for the fittest\u201d). It is like throwing, as many times as there are individuals in the population, a loaded dice where the weight on each face is proportional to the fitness of the corresponding individual. We then pick whichever individual the dice says we should pick, with the less fit individuals being likely not to go further, and the really fit ones possibly being picked more than once.", "Now that we have a new population selected, we simply have to mutate some of them. As you might have realised by now, randomness is a big part of the process, so that\u2019s what we do again: We randomly select a sub-section of the population (the size of which is given by the mutation rate) to which we apply the random mutation described above.", "That\u2019s it. We run fitness, selection, mutation for many generations, on a population with enough individuals in it, and in theory, something should happen.", "But what? The thing that amazes me most with genetic algorithms is that, if you describe it like this, as a process where completely random things are changed completely randomly through \u201cgenerations\u201d of almost randomly selected individuals, how could it possibly give you anything other than random results?", "The answer to that is in the word \u201calmost\u201d in \u201calmost randomly\u201d: The fitness-driven probability of selection. Because individuals that are more fit are more likely to go ahead, on average, every new generation should be fitter. And because random mutations occur, new kinds of individuals (\u201cmutants\u201d) emerge which can either be fitter (and therefore more likely to pass the mutation on to future generations) or not (and therefore be more likely to disappear through not being selected).", "And that\u2019s really the beauty of it. The only thing you need is to know how to recognise that something is good, and it will evolve your initially random solutions to be better and better. The final results look like they have been designed, but there is no information in the process about how to design a good solution, only about what is a good solution. It is incredibly exciting to see something being created like this, something that looks clever and that looks designed, but that is really only emerging from mutations having survived selection over several generations.", "Did we see this magic when we tried it on Elemaze levels? Absolutely!", "We initially ran the process multiple times looking for mazes of 4x4 cells with an ideal number of steps per solutions of 9, populations of 30 individuals, a mutation rate of 30% and a limit at 100 generations. Because solving that many levels takes time, each run took several hours (we ran everything multiple times on multiple computers). Naturally, the first generations were not very promising: most levels generated had no solution, and sometimes, we would have one with a solution in 1 step (i.e. move one character to the chest). However, in most of the processes, it eventually got to find levels requiring 4 steps or even 5. Several of the runs got to 7 steps, and a couple even found levels solved in 8, 9 and 10 steps. The graph below shows the number of steps of the best solution for one of the runs that led to a valid, playable 8-step level.", "As you can see, this follows the expectation: The population mostly becomes better, as it evolves across generations. The 8-step level in question was one of the first ones we tested in the game. It looks like this:", "It might not feel super impressive to you, but we had spent hours trying to figure out how to make levels for this game and how to construct them so that they are challenging enough to be interesting. This AI process invented a level\u2014 actually dozens of levels \u2014 that is not only playable but sophisticated, interesting and hard. The only thing it had to go on is: \u201cwe want levels that should take a lot of steps to solve\u201d. Each run generated much more than one valid level (the one above also had interesting 6-step and 5-step, and even 10 step levels), from a few hundred lines of Python (using modules that are all shipped with Python2.7), on a laptop (without parallel processing, so only using one core) for a couple of hours.", "The elegance of this kind of \u201cintelligent\u201d process is what makes it more interesting to me, especially if you compare it to something that would need multiple GPUs and thousands of training examples to achieve something remotely comparable. It is this elegance that also makes it more applicable, understandable and teachable. Hugo is 12, and for the last few days, we have been constantly talking about what size of populations would be best, how many generations we should leave the process to run for, which of our laptops should be given which configuration depending on the strength of its CPU, etc. We have also been sharing our amazement at seeing how levels were evolving, shouting across the house when one of the processes got anything above a 7-step level, and bursting with impatience at the idea of testing it.", "Our game is finished: You can download it from Google Play or on itch.io. 18 of the levels were made manually. The other 34 were designed by the genetic algorithm. Can you spot which ones they are?", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019m a developer and a researcher in data science, knowledge engineering and artificial intelligence. I\u2019m a (some would say grumpy) frenchman writing in english."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1d3ac84897e9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mathieu.daquin.x?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mathieu.daquin.x?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Mathieu d'Aquin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6cda1d9da2c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&user=Mathieu+d%27Aquin&userId=6cda1d9da2c5&source=post_page-6cda1d9da2c5----1d3ac84897e9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unity.com/", "anchor_text": "Unity"}, {"url": "https://hairygamedev.itch.io/ai-will-survive", "anchor_text": "tch.io"}, {"url": "https://play.google.com/store/apps/details?id=com.dAquinGames.AIWillSurvive&hl=en", "anchor_text": "Google Play"}, {"url": "https://en.wikipedia.org/wiki/A*_search_algorithm", "anchor_text": "A*"}, {"url": "https://en.wikipedia.org/wiki/Fitness_proportionate_selection", "anchor_text": "Roulette Wheel Selection"}, {"url": "https://play.google.com/store/apps/details?id=com.HairyGameDev.Elemaze&gl=GB", "anchor_text": "Google Play"}, {"url": "https://hairygamedev.itch.io/elemaze", "anchor_text": "itch.io"}, {"url": "https://medium.com/tag/genetic-algorithm?source=post_page-----1d3ac84897e9---------------genetic_algorithm-----------------", "anchor_text": "Genetic Algorithm"}, {"url": "https://medium.com/tag/ai?source=post_page-----1d3ac84897e9---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/game-development?source=post_page-----1d3ac84897e9---------------game_development-----------------", "anchor_text": "Game Development"}, {"url": "https://medium.com/tag/level-design?source=post_page-----1d3ac84897e9---------------level_design-----------------", "anchor_text": "Level Design"}, {"url": "https://medium.com/tag/coding-for-kids?source=post_page-----1d3ac84897e9---------------coding_for_kids-----------------", "anchor_text": "Coding For Kids"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&user=Mathieu+d%27Aquin&userId=6cda1d9da2c5&source=-----1d3ac84897e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&user=Mathieu+d%27Aquin&userId=6cda1d9da2c5&source=-----1d3ac84897e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1d3ac84897e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1d3ac84897e9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1d3ac84897e9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mathieu.daquin.x?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mathieu.daquin.x?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mathieu d'Aquin"}, {"url": "https://medium.com/@mathieu.daquin.x/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "141 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6cda1d9da2c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&user=Mathieu+d%27Aquin&userId=6cda1d9da2c5&source=post_page-6cda1d9da2c5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8efd3d435a30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-ai-to-design-game-levels-1d3ac84897e9&newsletterV3=6cda1d9da2c5&newsletterV3Id=8efd3d435a30&user=Mathieu+d%27Aquin&userId=6cda1d9da2c5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}