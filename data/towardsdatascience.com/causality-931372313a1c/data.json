{"url": "https://towardsdatascience.com/causality-931372313a1c", "time": 1682999783.0159519, "path": "towardsdatascience.com/causality-931372313a1c/", "webpage": {"metadata": {"title": "How to Measure Statistical Causality: A Transfer Entropy Approach with Financial Applications | by Th\u00e1rsis Souza, PhD | Towards Data Science", "h1": "How to Measure Statistical Causality: A Transfer Entropy Approach with Financial Applications", "description": "We\u2019ve all heard the say \u201ccorrelation does not imply causation\u201d, but how can we quantify causation? This is an extremely difficult and often misleading task, particularly when trying to infer\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.openquants.com/book", "anchor_text": "Open Source Live Book Initiative", "paragraph_index": 6}, {"url": "https://finance.yahoo.com/world-indices/", "anchor_text": "major global indices", "paragraph_index": 36}, {"url": "https://github.com/souzatharsis/open-quant-live-book/tree/master/data", "anchor_text": "here", "paragraph_index": 37}, {"url": "http://www.souzatharsis.com", "anchor_text": "Souza", "paragraph_index": 46}, {"url": "http://www.souzatharsis.com", "anchor_text": "Souza", "paragraph_index": 49}, {"url": "https://github.com/ZacKeskin/PyCausality", "anchor_text": "https://github.com/ZacKeskin/PyCausality", "paragraph_index": 53}], "all_paragraphs": ["We\u2019ve all heard the say \u201ccorrelation does not imply causation\u201d, but how can we quantify causation? This is an extremely difficult and often misleading task, particularly when trying to infer causality from observational data and we cannot perform controlled trials or A/B testing.", "Take for example the 2-dimensional system from Fig. 4.1.", "At a first glance, one could say that there is no clear relationship or causality between random variables x\u2081 and x\u2082. However, this apparent random system presents a very simple causal relationship defined by the following equations:", "A simple non-linearity introduced in the relationship between x\u2082 and x\u2081 was enough to introduce complexity into the system and potentially mislead a naive human.", "Fortunately, we can take advantage of statistics and information theory to uncover complex causal relationships from observational data (remember, this is still a very challenging task).", "The objectives of this Article are the following:", "We also provide code to reproduce results as part of our Open Source Live Book Initiative.", "We quantify causality by using the notion of the causal relation introduced by Granger (Wiener 1956; Granger 1969), where a signal X is said to Granger-cause Y if the future realizations of Y can be better explained using the past information from X and Y rather than Y alone.", "The most common definitions of Granger-causality (G-causality) rely on the prediction of a future value of the variable Y by using the past values of X and Y itself. In that form, X is said to G-cause Y if the use of X improves the prediction of Y.", "In both models, the functions f\u2081(.) and f\u2082(.) are chosen to minimize the expected value of the loss function. In most cases, these functions are retrieved with linear and, possibly, with nonlinear regressions, neural networks etc. Typical forms for g(.) are the l1- or l2-norms.", "We can now provide our first definition of statistical causality under the Granger causal notion as follows:", "Standard Granger-causality tests assume a functional form in the relationship among the causes and effects and are implemented by fitting autoregressive models (Wiener 1956; Granger 1969).", "Consider the linear vector-autoregressive (VAR) equations:", "where k is the number of lags considered. Alternatively, you can choose your DL/SVM/RF/GLM method of choice to fit the model.", "From Def. 4.1, X does not G-cause Y if and only if the prediction errors of X in the restricted Eq. (4.1)and unrestricted regression models Eq. (4.2) are equal (i.e., they are statistically indistinguishable). A one-way ANOVA test can be utilized to test if the residuals from Eqs. (4.1) and (4.2) differ from each other significantly. When more than one lag k is tested, a correction for multiple hypotheses testing should be applied, e.g. False Discovery Rate (FDR) or Bonferroni correction.", "A more general definition than Def. 4.1 that does not depend on assuming prediction functions can be formulated by considering conditional probabilities.", "Def. 4.2 does not assume any functional form in the coupling between X and Y. Nevertheless, it requires a method to assess their conditional dependency. In the next section, we will leverage an Information-Theoretical framework for that purpose.", "To compute G-Causality, we use the concept of Transfer Entropy. Since its introduction (Schreiber 2000), Transfer Entropy has been recognized as an important tool in the analysis of causal relationships in nonlinear systems (Hlavackovaschindler et al. 2007). It detects directional and dynamical information (Montalto 2014) while not assuming any particular functional form to describe interactions among systems.", "One can interpret this quantity as a measure of the dominant direction of the information flow. In other words, a positive result indicates a dominant information flow from X to Y compared to the other direction or, similarly, it indicates which system provides more predictive information about the other system (Michalowicz, Nichols, and Bucholtz 2013).", "It has been shown (Barnett, Barrett, and Seth 2009) that linear G-causality and Transfer Entropy are equivalent if all processes are jointly Gaussian. In particular, by assuming the standard measure (l2-norm loss function) of linear G-causality for the bi-variate case as follows:", "the following can be proved (Barnett, Barrett, and Seth 2009):", "This result provides a direct mapping between the Transfer Entropy and the linear G-causality implemented in the standard VAR framework. Hence, it is possible to estimate the TE both in its general form and with its equivalent form for linear G-causality.", "In this section, we construct simulated systems to couple random variables in a causal manner. We then quantify information flow using the methods studied in this Article.", "We first assume a linear system, where random variables have linear relationships defined as follow:", "We simulate this linear system with the following code:", "Fig. 4.2 represents the dependencies of the simulated linear system.", "We first define a function that calculates a bi-variate measure for G-causality as defined in Eq. (4.4) as follows:", "We use the function calc_te from the R package RTransferEntropy and the previously defined function Linear.GC to calculate pairwise information flow among the simulated variables as follows:", "The function FApply.Pairwise is an auxiliary function that simply applies a given function D.Func to all possible pairs of columns from a given matrix X as follows:", "Fig. 4.3 A) and B) show Granger-causality and Transfer Entropy among the system\u2019s variables, respectively. A cell (x,y) presents the information flow from variable y to variable x. We observe that both the Granger-causality (linear) and Transfer Entropy (nonlinear) approaches presented similar results, i.e., both methods captured the system\u2019s dependencies similarly. This result is expected as the system is purely linear and Transfer Entropy is able to capture both the linear and nonlinear interactions.", "We define a second system by introducing nonlinear interactions between x\u2081 and the variables x\u2082 and x\u2085 as follows:", "We simulate this nonlinear system with the following code:", "Fig. 4.5 represents the dependencies of the simulated nonlinear system.", "We calculate Granger-causality and Transfer Entropy of the simulated nonlinear system as follows:", "From Fig. 4.6 A) and B), we observe that the nonlinear interactions introduced were not captured by the linear formulation of Granger-causality. While all linear interactions presented similar linear and nonlinear information flows, the two nonlinear interactions introduced into the system presented relatively higher nonlinear information flow compared to the linear formulation.", "The world\u2019s financial markets form a complex, dynamic network in which individual markets interact with one another. This multitude of interactions can lead to highly significant and unexpected effects, and it is vital to understand precisely how various markets around the world influence one another (Junior, Mullokandov, and Kenett 2015).", "In this section, we use Transfer Entropy for the identification of dependency relations among international stock market indices. First, we select some of the major global indices for our analysis, namely the S&P 500, the FTSE 100, the DAX, the EURONEXT 100 and the IBOVESPA, which track the following markets, respectively, the US, the UK, Germany, Europe and Brazil. They are defined by the following tickers:", "Next, we will load log-returns of daily closing adjusted prices for the selected indices as follows (check here to have access to this dataset):", "The influence that one market plays in another is dynamic. Here, we will consider the time period from 01/01/2014 until 08/19/2019 and we will omit days with invalid returns due to missing data using the function NARV.omit from the package IDPmisc as follows:", "We will calculate pairwise Transfer Entropy among all indices considered and construct a matrix such that each value in the position (i,j) will contain the Transfer Entropy from tickers[i] to tickers[j] as follows:", "Fig. 4.8 displays the resulting Transfer Entropy matrix. We normalize the Transfer Entropy values by dividing it by the maximum value in the matrix such that all values range from 0 to 1. We observe that the international indices studied are highly interconnected in the period analyzed with the highest information flow going from the US market to the UK market (^GSPC -> ^FTSE). The second highest information flow is going in the opposite direction, i.e., from the UK market to the US market. That\u2019s a result we would expect as the US and the UK markets are strongly coupled, historically.", "We also calculate the marginal contribution of each market to the total Transfer Entropy in the system by calculating the sum of Transfer Entropy for each row in the Transfer Entropy matrix, which we also normalize such that all values range from 0 to 1:", "We observe that the US is the most influential market in the time period studied with 34.6% of the total Transfer Entropy followed by the UK and Germany with 21.4% and 18.6%, respectively. Japan and Brazil are the least influential markets with normalized Transfer Entropies of 11.7% and 13.4%, respectively.", "An experiment left to the reader is to build a daily trading strategy that exploits information flow among international markets. The proposed thesis is that one could build a profitable strategy by placing bets on futures of market indices that receive significant information flow from markets that observed unexpected returns/movements.", "For an extended analysis with a broader set of indices see (Junior, Mullokandov, and Kenett 2015). The authors develop networks of international stock market indices using an information theoretical framework. They use 83 stock market indices of a diversity of countries, as well as their single day lagged values, to probe the correlation and the flow of information from one stock index to another taking into account different operating hours. They find that Transfer Entropy is an effective way to quantify the flow of information between indices, and that a high degree of information flow between indices lagged by one day coincides to same day correlation between them.", "Investors\u2019 decisions are modulated not only by companies\u2019 fundamentals but also by personal beliefs, peers influence and information generated from news and the Internet. Rational and irrational investor\u2019s behavior and their relation with the market efficiency hypothesis (Fama 1970) have been largely debated in the economics and financial literature (Shleifer 2000). However, it was only recently that the availability of vast amounts of data from online systems paved the way for the large-scale investigation of investor\u2019s collective behavior in financial markets.", "A research paper (Souza and Aste 2016) used some of the methods studied in this Article to uncover that information flows from social media to stock markets revealing that tweets are causing market movements through a nonlinear complex interaction. The authors provide empirical evidence that suggests social media and stock markets have a nonlinear causal relationship. They take advantage of an extensive data set composed of social media messages related to DJIA index components. By using information-theoretic measures to cope for possible nonlinear causal effects between social media and the stock market, the work points out stunning differences in the results with respect to linear coupling. Two main conclusions are drawn: First, social media significant causality on stocks\u2019 returns are purely nonlinear in most cases; Second, social media dominates the directional coupling with stock market, an effect not observable within linear modeling. Results also serve as empirical guidance on model adequacy in the investigation of sociotechnical and financial systems.", "Fig. 4.9 shows the significant causality links found between social media and stocks\u2019 returns considering both cases: nonlinear (Transfer Entropy) and linear G-causality (linear VAR framework). The linear analysis discovers only three stocks with significant causality: INTEL CORP., NIKE INC. and WALT DISNEY CO. The Nonlinear analysis discovers that several other stocks have significant causality. In addition to the 3 stocks identified with significant linear causality, other 8 stocks presented purely nonlinear causality.", "The low level of causality obtained under linear constraints is in-line with results from similar studies in the literature, where it was found that stocks\u2019 returns show weak causality links (Alanyali, Moat, and Preis 2013, Antweiler and Frank (2004)) and social media sentiment analytics, at least when taken alone, have small or no predictive power (Ranco 2015) and do not have significant lead-time information about stock\u2019s movements for the majority of the stocks (Zheludev, Smith, and Aste 2014). Contrariwise, results from the nonlinear analyses unveiled a much higher level of causality indicating that linear constraints may be neglecting the relationship between social media and stock markets.", "In summary, (Souza and Aste 2016) is a good example on how causality can be not only complex but also misleading further highlighting the importance of choice in the methodology used to quantify it.", "In (Keskin and Aste 2019), the authors use information-theoretic measures studied in this Article for non-linear causality detection applied to social media sentiment and cryptocurrency prices.", "Using these techniques on sentiment and price data over a 48-month period to August 2018, for four major cryptocurrencies, namely bitcoin (BTC), ripple (XRP), litecoin (LTC) and ethereum (ETH), the authors detect significant information transfer, on hourly timescales, in directions of both sentiment to price and of price to sentiment. The work reports the scale of non-linear causality to be an order of magnitude greater than linear causality.", "The information-theoretic investigation detected a significant non-linear causal relationship in BTC, LTC and XRP, over multiple timescales and in both the directions sentiment to price and price to sentiment. The effect was strongest and most consistent for BTC and LTC. Fig. 4.10 shows Transfer Entropy results between BTC sentiment and BTC prices.", "All analysis for this paper was performed using a Python package (PyCausality), which is available at https://github.com/ZacKeskin/PyCausality.", "Untangling cause and effect can be devilishly difficult. However, statistical tools can help us tell correlation from causation.", "In this Article, we introduced the notion of Granger-causality and its traditional implementation in a linear vector-autoregressive framework. We then defined information theoretical measures to quantify Transfer Entropy as a method to estimate statistical causality in nonlinear systems.", "We simulated linear and nonlinear systems further showing that the traditional linear G-causality approach failed to detect simple non-linearities introduced into the system while Transfer Entropy successfully detected such relationships.", "Finally, we showed how Transfer Entropy can be used to quantify relationships among global equity indexes. We also discussed further applications from the literature where Information Theoretical measures were used to quantify causal links between investor sentiment and movements in the equity and crypto markets.", "We hope you enjoyed this casual causal journey and remember: Quantify causality, responsibly.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F931372313a1c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----931372313a1c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@souzatharsis?source=post_page-----931372313a1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@souzatharsis?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Th\u00e1rsis Souza, PhD"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F88dd71d1ffe2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&user=Th%C3%A1rsis+Souza%2C+PhD&userId=88dd71d1ffe2&source=post_page-88dd71d1ffe2----931372313a1c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.openquants.com/book", "anchor_text": "Open Source"}, {"url": "http://www.openquants.com/book", "anchor_text": "Open Source Live Book Initiative"}, {"url": "http://www.patreon.com/openquants", "anchor_text": ""}, {"url": "https://en.wikipedia.org/wiki/Clive_Granger", "anchor_text": "Clive Granger"}, {"url": "https://finance.yahoo.com/world-indices/", "anchor_text": "major global indices"}, {"url": "https://github.com/souzatharsis/open-quant-live-book/tree/master/data", "anchor_text": "here"}, {"url": "http://www.souzatharsis.com", "anchor_text": "Souza"}, {"url": "http://www.souzatharsis.com", "anchor_text": "Souza"}, {"url": "https://github.com/ZacKeskin/PyCausality", "anchor_text": "https://github.com/ZacKeskin/PyCausality"}, {"url": "http://www.patreon.com/openquants", "anchor_text": ""}, {"url": "https://medium.com/tag/data-science?source=post_page-----931372313a1c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/finance?source=post_page-----931372313a1c---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/investing?source=post_page-----931372313a1c---------------investing-----------------", "anchor_text": "Investing"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----931372313a1c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/economics?source=post_page-----931372313a1c---------------economics-----------------", "anchor_text": "Economics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&user=Th%C3%A1rsis+Souza%2C+PhD&userId=88dd71d1ffe2&source=-----931372313a1c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&user=Th%C3%A1rsis+Souza%2C+PhD&userId=88dd71d1ffe2&source=-----931372313a1c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----931372313a1c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F931372313a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----931372313a1c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----931372313a1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----931372313a1c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----931372313a1c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----931372313a1c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----931372313a1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@souzatharsis?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@souzatharsis?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Th\u00e1rsis Souza, PhD"}, {"url": "https://medium.com/@souzatharsis/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "416 Followers"}, {"url": "http://www.souzatharsis.com", "anchor_text": "www.souzatharsis.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F88dd71d1ffe2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&user=Th%C3%A1rsis+Souza%2C+PhD&userId=88dd71d1ffe2&source=post_page-88dd71d1ffe2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fde2644c594b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcausality-931372313a1c&newsletterV3=88dd71d1ffe2&newsletterV3Id=de2644c594b1&user=Th%C3%A1rsis+Souza%2C+PhD&userId=88dd71d1ffe2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}