{"url": "https://towardsdatascience.com/how-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a", "time": 1682994155.736864, "path": "towardsdatascience.com/how-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a/", "webpage": {"metadata": {"title": "How to tune a BigQuery ML classification model to achieve a desired precision or recall | by Lak Lakshmanan | Towards Data Science", "h1": "How to tune a BigQuery ML classification model to achieve a desired precision or recall", "description": "BigQuery provides an incredibly convenient way to train machine learning models on large, structured datasets. In an earlier article, I showed you how to train a classification model to predict\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/how-to-train-and-predict-regression-and-classification-ml-models-using-only-sql-using-bigquery-ml-f219b180b947", "anchor_text": "how to train a classification model", "paragraph_index": 0}], "all_paragraphs": ["BigQuery provides an incredibly convenient way to train machine learning models on large, structured datasets. In an earlier article, I showed you how to train a classification model to predict flight delays. Here\u2019s the SQL query that will predict whether a flight is going to be late by 15 minutes or more:", "This will create a model called delayed in a dataset called flights. The model will use the columns carrier, origin, etc. as inputs to the model and predict whether or not the flight will be late. The ground truth comes from historical data of US airline arrival delays. Note that I have pre-split the data by day into whether a row is training data (is_train_day=True) or should be used for independent evaluation (is_train_day=False). This is important because flight delays on the same day tend to be highly correlated.", "When the training finishes, BigQuery reports training statistics, but we should look at evaluation statistics on the withheld dataset (is_train_day=False):", "The flight delays data is an unbalanced dataset \u2014 only 18% of flights are late (which I found by doing):", "In an unbalanced dataset like this, accuracy is not as useful and it is common to have a business goal to meet a desired precision (if 1s are more common) or recall (if 0s are more common).", "A classification model actually returns the probability that the flight will be late; the evaluation statistics in the table above are computed by thresholding that probability at 0.5. We can vary this threshold and get the precision and recall at different thresholds. This is called a ROC curve (it\u2019s an acronym that dates back from radar days) and we can get BigQuery to generate this curve using:", "Essentially, it\u2019s the same as the ML.EVALUATE query, except that you use ML.ROC_CURVE instead \u2014 because we are going to tune the threshold, we should do this on the training data (is_train_day=True). The table comes back with 101 rows, with a false positive rate (1-precision) and recall for each threshold that has been tried. By default, the thresholds are based on computing the percentiles on the training dataset:", "We can click on the \u201cExplore in Data Studio\u201d link in the BigQuery UI to get a graph (set false_positive_rate as the dimension and recall as the metric):", "A more useful view is to have threshold as the dimension and the two other statistics as dimensions:", "We can tune the threshold to achieve a certain recall (then you will live with whatever precision you get). Let\u2019s say that we want to make sure to identify at least 70% of late flights, i.e. we want a recall of 0.7. From the graph above, you see that the probability threshold needs to be 0.335. This means that we will falsely identify 1% of on-time flights as being late.", "Here\u2019s a query that will return the threshold without having to draw a graph and mouse over it:", "This gives us the threshold we need to use to get a recall of 0.7:", "We can evaluate (on the withheld dataset) to see if we do hit the desired recall:", "Hurray! We got recall=70% on the independent evaluation dataset also, so it appears that we have not overfit.", "As with the ML.EVALUATE, when we do ML predictions, we can specify the desired threshold for the probability:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe4d40b93016a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----e4d40b93016a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/how-to-train-and-predict-regression-and-classification-ml-models-using-only-sql-using-bigquery-ml-f219b180b947", "anchor_text": "how to train a classification model"}, {"url": "https://unsplash.com/photos/RyVXnQdcw_4?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Ali Morshedlou"}, {"url": "https://unsplash.com/search/photos/tune?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e4d40b93016a---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----e4d40b93016a---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e4d40b93016a---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/classification?source=post_page-----e4d40b93016a---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----e4d40b93016a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----e4d40b93016a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe4d40b93016a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e4d40b93016a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e4d40b93016a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e4d40b93016a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e4d40b93016a--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-a-bigquery-ml-classification-model-to-achieve-a-desired-precision-or-recall-e4d40b93016a&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}