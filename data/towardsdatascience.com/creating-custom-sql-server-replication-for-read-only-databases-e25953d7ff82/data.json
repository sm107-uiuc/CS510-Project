{"url": "https://towardsdatascience.com/creating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82", "time": 1683004963.014942, "path": "towardsdatascience.com/creating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82/", "webpage": {"metadata": {"title": "Creating custom SQL Server replication for read-only databases | by Evgeniy Gribkov | Towards Data Science", "h1": "Creating custom SQL Server replication for read-only databases", "description": "Quite often there\u2019s a need to create a read-only replica of a SQL Server database. This might be required, for example, for the purpose of separating analytical and operative tasks. The first cause\u2026"}, "outgoing_paragraph_urls": [{"url": "http://twitter.com/src", "anchor_text": "@src", "paragraph_index": 10}, {"url": "http://twitter.com/sch", "anchor_text": "@sch", "paragraph_index": 10}, {"url": "http://twitter.com/sql", "anchor_text": "@sql", "paragraph_index": 10}, {"url": "http://twitter.com/name", "anchor_text": "@name", "paragraph_index": 10}, {"url": "https://www.devart.com/dbforge/sql/sqlcomplete/", "anchor_text": "SQL Complete", "paragraph_index": 42}], "all_paragraphs": ["Quite often there\u2019s a need to create a read-only replica of a SQL Server database. This might be required, for example, for the purpose of separating analytical and operative tasks. The first cause high load on databases and in order to reduce it, the replica of the primary database is created to perform analytical read-only queries.", "Usually, these read-only replicas can be created with in-built DBMS tools:", "But what if you don\u2019t need the entire database but only a few tables from it? In this case, you can create replication by yourself. And as long as data sampling is the main goal, database replication in one direction (master-to-slave) would be enough. Several methods including SSIS and .NET can be used to perform that kind of replication.", "In this article, we will use the JobEmpl recruiting service database to demonstrate how to create database replication in the master-to-slave direction using T-SQL.", "To start with, let\u2019s describe the main principle and the algorithm of this replication. During every iteration, we need to compare the data in the selected tables between the Source and the Target databases. This means that we need to enter a unique surrogate key to compare the tables. To speed up the comparison process, we will also need to create an index on that key. And adding a calculated field for every replicated table that calculates CHECKSUM for every row will also be required.", "It is also important to pick fixed portions of data, for example, a certain number of rows at a time (per iteration).", "Thus, we need to perform the following steps:", "Let\u2019s now review each step in detail using the JobEmpl database that was created for hiring employees.", "We only need to replicate the Employee and the JobHistory tables.", "Then, the 1st step of the mentioned algorithm can be performed with the help of the following script.", "From the script, you can see that it has to be run on the source JobEmpl database and you should specify the source database and the schema in @src and @sch variables accordingly. The @sql variable is required for building dynamic SQL, meanwhile, @name is needed for saving the name of the replicated table.", "First, we collect the replicated tables names into the temporary #tbl table. Next, we go through every table name with a cursor and fetch the table name into the @name variable. After that, for every table, a list of columns that are not the IDENTITY type is formed and the result is inserted into the @listcols variable with the \u201c+\u201d sign.", "It\u2019s worth mentioning that every table name is, at first, converted with the CAST function to NVACHAR(MAX) type and then the COALESCE function ([<ColumnName>], N\u2019\u2019) is used. It\u2019s done to form a single string from all the column values for every row.", "Next, the calculated CheckSumVal field, the REPL_GUID field, and its unique indREPL_GUID index are created.", "In our case, we got the following script.", "You can later delete the created tables and indexes from the databases with the help of the following scripts.", "The replicated tables are also here, and for each of them the indREPL_GUID index, as well as REPL_GUID and CheckSumVal columns, get deleted.", "In our case, the following T-SQL code was created.", "Let\u2019s now create a new JobEmplRead database for receiving data according to the 2nd step of the algorithm, mentioned above. Then, we synchronize schemas for the replicated tables. To perform synchronization, use the DbForge Schema Compare tool: select JobEmpl as the data source and jobEmplRead as the data target.", "Then press the Compare button. Once the metadata creation process for the comparison is done, select the required tables and start configuring the database synchronization process.", "Next, we select the default value \u2014 script generation.", "Let\u2019s now clear the backup creation option.", "Next, we uncheck all the dependencies as we don\u2019t need to create other objects. And we will later delete foreign keys manually in a generated schema synchronization script.", "Now press the Synchronize button and ignore the warnings on the Summary tab.", "Delete the following foreign keys in the generated script:", "We need to do this because we didn\u2019t transfer the Company, Position, and Project tables. As a result, we got a script for moving replicated schema tables.", "Run this script in the JobEmplRead database.", "Thus, we\u2019ve completed step 3 of our algorithm: synchronized tables schema across the JobEmpl and JobEmplRead databases and deleted all references to nonexistent objects.", "Let\u2019s use the following script for monitoring.", "Here we have FULL OUTER JOIN statements creation and the return of the tables list and the number of distinctive rows, including nonexisting and lacking rows.", "In our case, we get the following result.", "The following script was generated for comparison.", "It\u2019s worth noting that to reduce blockings, the transaction isolation level is Dirty Read.", "Let\u2019s unite the 4th and the 5th steps of our algorithm into the following single script.", "First, all foreign keys for the replicated table are disabled in the JobEmplRead database. Then with the MERGE statements data is copied in portions. In our case, we have 100 000 rows per iteration. This script comprises a single iteration and executes the following T-SQL code.", "This script should be run automatically at an interval specified in advance. For example, it can be run every minute or even more frequently depending on the analytics needs.", "The number of distinctive rows has to be smaller after several iterations.", "Remember that to enable foreign keys in the disabled tables you should run the following script.", "In our case, the following script will be generated and executed.", "Keep in mind that you can\u2019t enable foreign keys on the replicated tables while the replication is running until all data is copied.", "We have reviewed one of the ways to implement the process of replicating tables in one direction from the source to the destination.", "This approach and scripts can be applied to any database. But of course, those scripts have to be modified depending on the specifics of the replicated tables. For example, modification might be required if the tables have calculated fields.", "SQL Complete was the main tool to help me build those scripts. The tool also allows code formatting as well as renaming objects and all their references.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am interested in everything related to the database and data. Professionally engaged in MS SQL Server as a developer and administrator."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe25953d7ff82&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@gribkov.evg?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gribkov.evg?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Evgeniy Gribkov"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad6d87f14fe8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&user=Evgeniy+Gribkov&userId=ad6d87f14fe8&source=post_page-ad6d87f14fe8----e25953d7ff82---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.piqsels.com/en/public-domain-photo-zknng", "anchor_text": "Piqsels"}, {"url": "https://docs.microsoft.com/en-us/sql/database-engine/log-shipping/configure-log-shipping-sql-server?view=sql-server-ver15", "anchor_text": "Log Shipping"}, {"url": "https://docs.microsoft.com/en-us/sql/relational-databases/replication/sql-server-replication?view=sql-server-ver15", "anchor_text": "SQL Server Replication"}, {"url": "https://docs.microsoft.com/en-us/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server?view=sql-server-ver15", "anchor_text": "AlwaysOn Availability Groups"}, {"url": "https://docs.microsoft.com/en-us/sql/t-sql/functions/checksum-transact-sql?view=sql-server-ver15", "anchor_text": "CHECKSUM"}, {"url": "http://twitter.com/src", "anchor_text": "@src"}, {"url": "http://twitter.com/sch", "anchor_text": "@sch"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "http://twitter.com/name", "anchor_text": "@name"}, {"url": "https://www.devart.com/dbforge/sql/sqlcomplete/", "anchor_text": "SQL Complete"}, {"url": "https://blog.devart.com/how-to-create-custom-sql-server-replication-for-read-only-databases.html", "anchor_text": "https://blog.devart.com"}, {"url": "https://medium.com/tag/sql-server?source=post_page-----e25953d7ff82---------------sql_server-----------------", "anchor_text": "Sql Server"}, {"url": "https://medium.com/tag/data?source=post_page-----e25953d7ff82---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/tag/database?source=post_page-----e25953d7ff82---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/sql?source=post_page-----e25953d7ff82---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&user=Evgeniy+Gribkov&userId=ad6d87f14fe8&source=-----e25953d7ff82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&user=Evgeniy+Gribkov&userId=ad6d87f14fe8&source=-----e25953d7ff82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe25953d7ff82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e25953d7ff82---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e25953d7ff82--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e25953d7ff82--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e25953d7ff82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gribkov.evg?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gribkov.evg?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Evgeniy Gribkov"}, {"url": "https://medium.com/@gribkov.evg/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "42 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad6d87f14fe8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&user=Evgeniy+Gribkov&userId=ad6d87f14fe8&source=post_page-ad6d87f14fe8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe2e084bc4fe5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-custom-sql-server-replication-for-read-only-databases-e25953d7ff82&newsletterV3=ad6d87f14fe8&newsletterV3Id=e2e084bc4fe5&user=Evgeniy+Gribkov&userId=ad6d87f14fe8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}