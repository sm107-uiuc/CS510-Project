{"url": "https://towardsdatascience.com/build-your-own-custom-scikit-learn-regression-5d0d718f289", "time": 1683017067.22996, "path": "towardsdatascience.com/build-your-own-custom-scikit-learn-regression-5d0d718f289/", "webpage": {"metadata": {"title": "Build your own custom scikit-learn Regression | by Dr. Robert K\u00fcbler | Towards Data Science", "h1": "Build your own custom scikit-learn Regression", "description": "If Python is your programming language of choice for Data Science, you have probably used scikit-learn already. Learn here how to write your own regressor."}, "outgoing_paragraph_urls": [{"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "scikit-learn", "paragraph_index": 0}, {"url": "https://github.com/Garve/TDS/blob/main/TDS%20-%20Own%20Regressors.ipynb", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/Least_absolute_deviations", "anchor_text": "Least Absolute Deviation Regression", "paragraph_index": 21}, {"url": "https://www.scipy.org/", "anchor_text": "scipy", "paragraph_index": 24}, {"url": "https://en.wikipedia.org/wiki/Mean_absolute_percentage_error", "anchor_text": "MAPE", "paragraph_index": 27}, {"url": "https://en.wikipedia.org/wiki/Principal_component_analysis", "anchor_text": "PCA", "paragraph_index": 28}, {"url": "https://scikit-learn.org/stable/modules/classes.html#module-sklearn.base", "anchor_text": "and more", "paragraph_index": 29}, {"url": "https://dr-robert-kuebler.medium.com/membership", "anchor_text": "via this link", "paragraph_index": 32}, {"url": "https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/", "anchor_text": "LinkedIn", "paragraph_index": 35}], "all_paragraphs": ["If Python is your programming language of choice for Data Science and Machine Learning, you have probably used the awesome scikit-learn library already. I\u2019m a big fan of this project myself due to its consistent API: You define some object such as a regressor, you fit, you predict, done. It cannot get much easier than this.", "While scikit-learn covers you by providing you with a whole range of useful algorithms out-of-the-box, at some point this selection will not be enough for you anymore. You might want to define your own transformers, regressors, and classifiers, and you want it to work together with scikit-learn pipelines and hyper-parameter optimizations such as grid search. You want it all. And if you are at this point in your career, this article is for you.", "SPOILER: Get the complete code here.", "Let us now see how to implement our own regressors that work perfectly as a small gear in the large scikit-learn clockwork. We first start with something simple and turn to more sophisticated things later on.", "Let us implement the easiest regressor available, just to get started quickly and without getting lost in theoretical details. I call this the Mean Regressor, which discards all input features (which I call X) and only outputs the mean of the labels (which I call y). That\u2019s the whole theory.", "The learning merely consists of computing the mean of y and storing the result inside of the model, the same way the coefficients in a Linear Regression are stored within the model. The most basic scikit-learn-conform implementation can look like this:", "Done. If you input n samples now, the output will be n times the same number, as it is supposed to be. Just try it out via", "Which outputs 22.53280632 exactly 506 times, the size of the dataset. Do you know what\u2019s cool? You can even use the scoremethod, although you did not even define it anyway! It is done implicitly since you are using the classes BaseEstimator which is the base of all of your own regressors, classifiers, and transformers, as well as RegressorMixin (this one actually adds the score method!).", "The score method computed the r\u00b2 score by default, and if you know a bit about it, you won\u2019t be surprised by the following observation:", "Let us generalize our model slightly. Instead of always computing the mean, we want to add the possibility to add a parameter c during the model instantiation. The model will then output only c. If we don\u2019t provide a parameter, the model should fall back on being the MeanRegressor .", "We just created a model with a hyperparameter! We can use it via", "Again, check that the model really outputs the parameter c that you provide, and also that the score method works. In this case, if c is not None and also not the mean, the r\u00b2 score is negative.", "Quick excursion: The r\u00b2 score is just designed that way. A model outputting the mean of the labels for any input feature always has an r\u00b2 score of 0. A perfect model that hits all of the labels exactly has an r\u00b2 score of 1. Usually, you land somewhere in between. And if you have a horrible model, which we just created, you can even get a negative r\u00b2 score.", "Anyway, we have only seen basic functionality so far. Let us try a GridSearch now since our model has a hyperparameter.", "It works! You can check the best c according to the standard 5-fold cross-validation via", "Now, before we continue with a more interesting model, let\u2019s polish our code to make it truly scikit-learn-conform. I skipped just a bit of boiler-plate code which does some basic checks and input validations but is not needed for our model to run. The full and proper scikit-learn regressor should look like this (I highlighted the added lines)", "Not as bad as you expected, right? Basically, we have added the following (taken from their respective docstrings):", "check_X_y checks X and y for consistent length, enforces X to be 2D and y 1D. By default, X is checked to be non-empty and containing only finite values.Standard input checks are also applied to y, such as checking that ydoes not have np.nan or np.inf targets. [\u2026]", "check_array does input validation on an array, list, sparse matrix or similar. By default, the input is checked to be a non-empty 2D array containingonly finite values. If the dtype of the array is object, attemptconverting to float, raising on failure.", "check_is_fitted checks if the estimator is fitted by verifying the presence offitted attributes (ending with a trailing underscore) and otherwiseraises a NotFittedError with the given message. [\u2026] (that\u2019s why we called our internal variable self.const_ and not only self.const!)", "With this knowledge, we can create a useful regressor now.", "Something that I still miss in scikit-learn is the Least Absolute Deviation Regression. Simply speaking, it is just a Linear Regression, but instead of minimizing the mean squared error (MSE), we minimize the mean absolute error (MAE).", "This is useful because the MSE loss punishes high deviations from the true target, which means that outliers can influence the predictions a lot. The MAE loss, however, does not have this property which makes it a good tool to create more robust linear models.", "There are at least two ways to implement it:", "While I encourage you to compute the gradients of the loss function yourself and implement a simple Gradient Descent in your fit method, we will go for the other option. Our model will essentially be a wrapper around the scipy package that lets us minimize functions. Let\u2019s dive right into the code.", "Let us do a small check if this implementation does the trick. What I usually do is create a small 1- or 2-dimensional dataset that I am able to plot.", "We have created a regressor that optimizes a different loss function. Feel free to create even more regressors that suit your needs! For example, if you are in a setting where overestimation is 100 times worse than an underestimation, create a loss function that punishes overestimation much more, such as", "and plug it in. Do you want to optimize for MAPE? Use", "The journey does not stop here. Of course, you can also build classifiers in the same fashion. Just use the ClassifierMixin . Or build a transformer (no, not Optimus Prime) such as PCA yourself using the TransformerMixin . You have all the tools you need, now. Good luck!", "In this article, we have seen how to build our own scikit-learn regressors. Whenever you cannot find a particular regressor for your special problem, you can just build your own one and benefit from the rest of scikit-learn, such as pipelines and grid searches. The same goes for classification, transformations, clustering, and more.", "I hope that you learned something new, interesting, and useful today. Thanks for reading!", "As the last point, if you", "why not do it via this link? This would help me a lot! \ud83d\ude0a", "To be transparent, the price for you does not change, but about half of the subscription fees go directly to me.", "Thanks a lot, if you consider supporting me!", "If you have any questions, write me on LinkedIn!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Studied Mathematics, graduated in Cryptanalysis, working as a Senior Data Scientist. Interested in algorithms, probability theory, and machine learning."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5d0d718f289&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@robertkuebler", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://kuebler.ai/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": ""}, {"url": "https://kuebler.ai/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Dr. Robert K\u00fcbler"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6d6b5fb431bf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&user=Dr.+Robert+K%C3%BCbler&userId=6d6b5fb431bf&source=post_page-6d6b5fb431bf----5d0d718f289---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@osmanrana?utm_source=medium&utm_medium=referral", "anchor_text": "Osman Rana"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "scikit-learn"}, {"url": "https://github.com/Garve/TDS/blob/main/TDS%20-%20Own%20Regressors.ipynb", "anchor_text": "here"}, {"url": "https://en.wikipedia.org/wiki/Least_absolute_deviations", "anchor_text": "Least Absolute Deviation Regression"}, {"url": "https://www.scipy.org/", "anchor_text": "scipy.optimize"}, {"url": "https://www.scipy.org/", "anchor_text": "scipy"}, {"url": "https://en.wikipedia.org/wiki/Mean_absolute_percentage_error", "anchor_text": "MAPE"}, {"url": "https://en.wikipedia.org/wiki/Principal_component_analysis", "anchor_text": "PCA"}, {"url": "https://scikit-learn.org/stable/modules/classes.html#module-sklearn.base", "anchor_text": "and more"}, {"url": "https://dr-robert-kuebler.medium.com/membership", "anchor_text": "via this link"}, {"url": "https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/scikit-learn?source=post_page-----5d0d718f289---------------scikit_learn-----------------", "anchor_text": "Scikit Learn"}, {"url": "https://medium.com/tag/python?source=post_page-----5d0d718f289---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----5d0d718f289---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/tag/hands-on-tutorials?source=post_page-----5d0d718f289---------------hands_on_tutorials-----------------", "anchor_text": "Hands On Tutorials"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----5d0d718f289---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&user=Dr.+Robert+K%C3%BCbler&userId=6d6b5fb431bf&source=-----5d0d718f289---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&user=Dr.+Robert+K%C3%BCbler&userId=6d6b5fb431bf&source=-----5d0d718f289---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5d0d718f289&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5d0d718f289---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5d0d718f289--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5d0d718f289--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5d0d718f289--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5d0d718f289--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5d0d718f289--------------------------------", "anchor_text": ""}, {"url": "https://kuebler.ai/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://kuebler.ai/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dr. Robert K\u00fcbler"}, {"url": "https://kuebler.ai/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6d6b5fb431bf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&user=Dr.+Robert+K%C3%BCbler&userId=6d6b5fb431bf&source=post_page-6d6b5fb431bf--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F11fae4bef4b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-custom-scikit-learn-regression-5d0d718f289&newsletterV3=6d6b5fb431bf&newsletterV3Id=11fae4bef4b2&user=Dr.+Robert+K%C3%BCbler&userId=6d6b5fb431bf&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}