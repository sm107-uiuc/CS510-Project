{"url": "https://towardsdatascience.com/faster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe", "time": 1683004616.205943, "path": "towardsdatascience.com/faster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe/", "webpage": {"metadata": {"title": "Faster and Memory-Efficient PyTorch models using AMP and Tensor Cores | by Rahul Agarwal | Towards Data Science", "h1": "Faster and Memory-Efficient PyTorch models using AMP and Tensor Cores", "description": "Do you know that the Backpropagation algorithm was given in 1986 in the Nature paper by Geoffrey Hinton? Also, the Convnets were first presented by Yann le cun in 1998 for digit classification where\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.iro.umontreal.ca/~pift6266/A06/refs/backprop_old.pdf", "anchor_text": "paper", "paragraph_index": 0}, {"url": "https://github.com/znxlwm/pytorch-apex-experiment", "anchor_text": "repository", "paragraph_index": 20}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/amp", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://www.coursera.org/specializations/aml?siteID=lVarvwc5BD0-BShznKdc3CUauhfsM7_8xw&utm_content=2&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "\u201cHow to win a data science competition\u201d", "paragraph_index": 24}, {"url": "https://medium.com/@rahul_agarwal?source=post_page---------------------------", "anchor_text": "Medium", "paragraph_index": 25}, {"url": "http://eepurl.com/dbQnuX?source=post_page---------------------------", "anchor_text": "blog", "paragraph_index": 25}, {"url": "https://twitter.com/MLWhiz?source=post_page---------------------------", "anchor_text": "@mlwhiz", "paragraph_index": 25}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 28}], "all_paragraphs": ["Do you know that the Backpropagation algorithm was given in 1986 in the Nature paper by Geoffrey Hinton?", "Also, the Convnets were first presented by Yann le cun in 1998 for digit classification where he used a single convolution layer. It was only later in 2012 that Alexnet popularized Convnets by using multiple convolution layers to achieve state of the art on imagenet.", "So what made them so famous just now and not before?", "It is only with the vast computing resources at our disposal, were we able to experiment and utilize Deep Learning to its full potential in the recent past.", "But are we using our computing resources well enough? Can we do better?", "This post is about utilizing Tensor Cores and Automatic Mixed Precision for faster training of Deep Learning Networks.", "NVIDIA Turing and Volta GPUs are powered by Tensor Cores, a revolutionary technology that delivers groundbreaking AI performance. Tensor Cores can accelerate large matrix operations, which are at the heart of AI, and perform mixed-precision matrix multiply and accumulate calculations in a single operation. With hundreds of Tensor Cores operating in parallel in one NVIDIA GPU, this enables massive increases in throughput and efficiency", "Put simply; they are specialized cores that are great for a particular type of matrix operation.", "We can multiply two FP16 matrices and add it to an FP16/FP32 matrix to get an FP16/FP32 matrix as a result. Tensor cores support mixed-precision math, i.e. having the inputs in half-precision(FP16) and getting the output as full precision(FP32). The above sort of operation is inherently valuable to many Deep Learning tasks, and Tensor Cores provide a specialized Hardware for this operation.", "Now, there are mainly two benefits of using FP16 vs FP32.", "But there are disadvantages too. When we go to FP16 from FP32, we necessarily go to a lower precision.", "Most weights and gradients actually can be very well represented by FP16. So it is just wasteful to have all these extra bits required to store and use FP32.", "I checked that my Titan RTX GPU has 576 tensor cores along with 4,608 NVIDIA CUDA cores. But how do I use these tensor cores?", "Honestly, NVIDIA has made it trivial to use Tensor cores with the Automatic Mixed Precision it provides with a couple of lines of code. We need to do two things in code:", "2. Using loss scaling to preserve small gradient values. The gradient values may fall outside the range of FP16. In such cases, the gradient values are scaled so that they fall in FP16 Range.", "It is alright if you don\u2019t understand the background specifics yet. The code implementation is relatively straightforward.", "Let us start with an elementary network in PyTorch.", "To take advantage of Automatic Mixed Precision training, we first need to install apex library. Just run the following commands in your terminal.", "And we can then just add a few lines to our Neural Network code to take advantage of Automatic Mixed Precision(AMP). I have bolded the added lines below:", "In here you can see that we initialize our model with amp. We also specify loss scaling by using amp.scale_loss", "We can benchmark the performance of amp by using this great repository which benchmarks the VGG16 model on CIFAR Dataset. I just had to change a few lines of code to make this work for us. You can find the modified version here. To run the benchmarking code yourself you may want to:", "This will populate the following graphs for you in the home directory:", "Here I have trained multiple instances of the same model using various precision and batch size settings. We can see that the memory requirements decrease by going from FP32 to amp while the accuracy remains roughly the same. The time also decreases but not by that much. This can likely be attributed to a simple dataset or a simple model.", "As per the benchmarks given by NVIDIA, Automatic Mixed Precision runs around 3x faster than standard FP32 models as shown below.", "If you want to learn more about practical data science, do take a look at the \u201cHow to win a data science competition\u201d Coursera course. I learned a lot of new things from this course taught by one of the most prolific Kaggler.", "Thanks for the read. I am going to be writing more beginner-friendly posts in the future too. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Also, a small disclaimer \u2014 There might be some affiliate links in this post to relevant resources as sharing knowledge is never a bad idea.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F50fd3c8dd7fe&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----50fd3c8dd7fe---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/Pexels-2286921/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1283795", "anchor_text": "Pexels"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1283795", "anchor_text": "Pixabay"}, {"url": "http://www.iro.umontreal.ca/~pift6266/A06/refs/backprop_old.pdf", "anchor_text": "paper"}, {"url": "https://www.nvidia.com/en-us/data-center/tensorcore/", "anchor_text": "NVIDIA"}, {"url": "https://nvlabs.github.io/iccv2019-mixed-precision-tutorial/files/dusan_stosic_intro_to_mixed_precision_training.pdf", "anchor_text": "Source"}, {"url": "https://en.wikipedia.org/wiki/Single-precision_floating-point_format", "anchor_text": "FP32"}, {"url": "https://en.wikipedia.org/wiki/Bfloat16_floating-point_format", "anchor_text": "FP16"}, {"url": "https://nvlabs.github.io/iccv2019-mixed-precision-tutorial/files/dusan_stosic_intro_to_mixed_precision_training.pdf", "anchor_text": "Source"}, {"url": "https://nvlabs.github.io/iccv2019-mixed-precision-tutorial/files/dusan_stosic_intro_to_mixed_precision_training.pdf", "anchor_text": "Source"}, {"url": "https://github.com/znxlwm/pytorch-apex-experiment", "anchor_text": "repository"}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/amp", "anchor_text": "here"}, {"url": "https://github.com/MLWhiz/data_science_blogs", "anchor_text": "https://github.com/MLWhiz/data_science_blogs"}, {"url": "https://medium.com/tensorflow/automatic-mixed-precision-in-tensorflow-for-faster-ai-training-on-nvidia-gpus-6033234b2540", "anchor_text": "Source"}, {"url": "https://www.coursera.org/specializations/aml?siteID=lVarvwc5BD0-BShznKdc3CUauhfsM7_8xw&utm_content=2&utm_medium=partners&utm_source=linkshare&utm_campaign=lVarvwc5BD0", "anchor_text": "\u201cHow to win a data science competition\u201d"}, {"url": "https://medium.com/@rahul_agarwal?source=post_page---------------------------", "anchor_text": "Medium"}, {"url": "http://eepurl.com/dbQnuX?source=post_page---------------------------", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz?source=post_page---------------------------", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/programming?source=post_page-----50fd3c8dd7fe---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-science?source=post_page-----50fd3c8dd7fe---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----50fd3c8dd7fe---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----50fd3c8dd7fe---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----50fd3c8dd7fe---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----50fd3c8dd7fe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----50fd3c8dd7fe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F50fd3c8dd7fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----50fd3c8dd7fe---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----50fd3c8dd7fe--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffaster-and-memory-efficient-pytorch-models-using-amp-50fd3c8dd7fe&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}