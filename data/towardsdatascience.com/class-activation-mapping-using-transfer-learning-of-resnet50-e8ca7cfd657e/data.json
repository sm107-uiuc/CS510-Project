{"url": "https://towardsdatascience.com/class-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e", "time": 1683011440.28202, "path": "towardsdatascience.com/class-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e/", "webpage": {"metadata": {"title": "Class Activation Mapping. A powerful method for object detection\u2026 | by Patrick Brus | Towards Data Science", "h1": "Class Activation Mapping", "description": "In this article I want to share a very powerful and interesting technique with you. This technique is called Class Activation Maps (CAMs), which were first introduced by researchers of MIT in the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "Learning Deep Features for Discriminative Localization", "paragraph_index": 0}, {"url": "https://www.kaggle.com/moltean/fruits", "anchor_text": "Kaggle\u2019s 360 fruits challenge", "paragraph_index": 1}, {"url": "https://github.com/patrickbrus/TransferLearning_and_CMAP", "anchor_text": "Github", "paragraph_index": 1}, {"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "Learning Deep Features for Discriminative Localization", "paragraph_index": 7}, {"url": "https://arxiv.org/abs/1312.4400", "anchor_text": "Network In Network", "paragraph_index": 7}, {"url": "https://alexisbcook.github.io/2017/global-average-pooling-layers-for-object-localization/#:~:text=to%20avoid%20overfitting.-,Global%20Average%20Pooling,of%20a%20three-dimensional%20tensor.", "anchor_text": "Global Average Pooling", "paragraph_index": 7}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "Deep Residual Learning for Image Recognition", "paragraph_index": 7}], "all_paragraphs": ["In this article I want to share a very powerful and interesting technique with you. This technique is called Class Activation Maps (CAMs), which were first introduced by researchers of MIT in the paper \u201cLearning Deep Features for Discriminative Localization\u201d. The usage of CAMs allows you to not only see the class the network predicts, but also the part of the image the network is especially interested in. This helps to get more insights into the learnings of the network and to also ease up debugging, because the user gets an object localization of the predicted class without having to explicitly label the bounding box for this object. In the chapter Methodology I want to go through the used data and where to find the code used for this article. The chapter Model describes the used model and the training of it. The chapter Class Activation Mapping describes the idea of CAMs and how to compute it. The chapter Conclusion is supposed to conclude the findings.", "The training process of the network and the computation of the CAMs is done using jupyter notebook and tensorflow. The data set from Kaggle\u2019s 360 fruits challenge is used. It contains 90483 images of fruits and vegetables with a total of 131 different classes. Figure 1 shows an example image with the ground truth label as title. The corresponding notebooks can be found in my Github repository.", "As model, I decided to use the already trained ResNet50 [4] for Transfer Learning (TL). This model was trained on the ImageNet challenge containing 1000 different classes. TL is very useful for quickly training a large and deep network, because the network doesn\u2019t have to be trained from scratch. Normally, the deeper you go, the more complex features the filters learn in your network. The filters of the first layer only learn very low level features like edges. This is due to the fact that the filters of the first layer only see a small portion of the input image. On the second layer, this portion (also called receptive field) is already larger and so the filters can learn more complex features. And on the last convolution layers the filters can already detect complete objects. When using TL, a pre-trained model gets loaded and the classification layer gets dropped. Afterwards, the complete CNN except the new added classification layer gets frozen and trained until the loss converged. This avoids destroying already learned features due to the initially potentially large gradients. Optionally, you could afterwards unfreeze the remaining part of the CNN or only the last layers and fine tune their weights to fit your current task. For this task I decided to only re-train the classification layer in order to focus on computing the CAMs. Therefore, I dropped all dense layers from the ResNet50 at the end and added a global average pooling layer (see next chapter why this is added) plus the softmax layer with as many neurons as classes to classify. The architecture will be described in more detail within the next chapter. The model was then trained for five epochs resulting in a validation accuracy of 99% at the end.", "A CAM is a weighted activation map generated for each image [1]. It helps to identify the region a CNN is looking at while classifying an image. CAMs aren\u2019t trained supervised, but in a weakly supervised fashion. This means, that the objects do not have to be labeled manually and the localization is kind of learned for \u201cfree\u201d. The only thing that has to be changed on the architecture is to get rid of the fully connected dense layers at the end in order to maintain the spatial information contained in the output of the last convolution layer. In addition, a global average pooling layer is added afterwards. This layer is usually used for regularization in order to prevent the network from overfitting [2]. Finally, the output softmax layer with as many neurons as classes to classify (in our case: 131) is added. Figure 2 summarizes the required architecture and shows how to compute the CAM.", "In our case, the architectural changes and the training is already done (c.f. chapter Model), so we can directly start with computing the CAM. As first step, we feed an image to the network and compute the classification output of the network. As next step, we fetch the weights connected to the \u201cwinning\u201d neuron. Additionally, we store the output of the final convolution layer. Then, we compute the CAM by multiplying each depth from the output of the final convolution layer the corresponding weight connected to the \u201cwinning\u201d neuron (i.e. w1 will be multiplied with depth one of the final convolution layers\u2019 output, w2 with depth two, \u2026) and summing them all up. Finally, we use bilinear up sampling in order to extend the size of the CAM to match the size of the input image. Figure 3 shows the function from the jupyter notebook on my github page.", "Figure 4 shows six example CAMs. The title of each CAM shows the predicted label of the network.", "As one can see, the CAM can be easily computed by just making little adjustments to the network architecture and comes for free, so no one has to expensively label the data. Also, the CAM can be used for debugging, because one can see on which area of the image the network is focusing on. This could be helpful if, for example, the network is supposed to classify the presence of a harbor in the image and by plotting the CAM it gets clear that the network is focusing on the sky and not on the harbor itself. Then the user could adapt the dataset to also contain images of harbors without a visible sky and therefore avoid such wrong correlations.", "[1]: Bolei Zhou, Aditya Khosla, Agata Lapedriza, Aude Oliva and Antonio Torralba, Learning Deep Features for Discriminative Localization (2015), MIT[2]: Min Lin, Qiang Chen, and Shuicheng Yan, Network In Network (2013), National University of Singapore[3]: Alexis Cook, Global Average Pooling (2017), Github Blogpost[4]: Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun, Deep Residual Learning for Image Recognition (2015), Microsoft Research", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A machine learning (ml) engineer with a focus on engineering. Create ml pipelines to enable rapid value from data using ml. This also includes MLOps and DevOps."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe8ca7cfd657e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://brus-patrick63.medium.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": ""}, {"url": "https://brus-patrick63.medium.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Patrick Brus"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5db2cf7aa0b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&user=Patrick+Brus&userId=5db2cf7aa0b7&source=post_page-5db2cf7aa0b7----e8ca7cfd657e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@alesnesetril?utm_source=medium&utm_medium=referral", "anchor_text": "Ales Nesetril"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "Learning Deep Features for Discriminative Localization"}, {"url": "https://www.kaggle.com/moltean/fruits", "anchor_text": "Kaggle\u2019s 360 fruits challenge"}, {"url": "https://github.com/patrickbrus/TransferLearning_and_CMAP", "anchor_text": "Github"}, {"url": "https://www.kaggle.com/moltean/fruits", "anchor_text": "Kaggle dataset"}, {"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "Learning Deep Features for Discriminative Localization"}, {"url": "https://arxiv.org/abs/1312.4400", "anchor_text": "Network In Network"}, {"url": "https://alexisbcook.github.io/2017/global-average-pooling-layers-for-object-localization/#:~:text=to%20avoid%20overfitting.-,Global%20Average%20Pooling,of%20a%20three-dimensional%20tensor.", "anchor_text": "Global Average Pooling"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "Deep Residual Learning for Image Recognition"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----e8ca7cfd657e---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/class-activation-map?source=post_page-----e8ca7cfd657e---------------class_activation_map-----------------", "anchor_text": "Class Activation Map"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e8ca7cfd657e---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----e8ca7cfd657e---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/kaggle?source=post_page-----e8ca7cfd657e---------------kaggle-----------------", "anchor_text": "Kaggle"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&user=Patrick+Brus&userId=5db2cf7aa0b7&source=-----e8ca7cfd657e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&user=Patrick+Brus&userId=5db2cf7aa0b7&source=-----e8ca7cfd657e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe8ca7cfd657e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e8ca7cfd657e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e8ca7cfd657e--------------------------------", "anchor_text": ""}, {"url": "https://brus-patrick63.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://brus-patrick63.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Patrick Brus"}, {"url": "https://brus-patrick63.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "528 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5db2cf7aa0b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&user=Patrick+Brus&userId=5db2cf7aa0b7&source=post_page-5db2cf7aa0b7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2484a7cc7618&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclass-activation-mapping-using-transfer-learning-of-resnet50-e8ca7cfd657e&newsletterV3=5db2cf7aa0b7&newsletterV3Id=2484a7cc7618&user=Patrick+Brus&userId=5db2cf7aa0b7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}