{"url": "https://towardsdatascience.com/restaurant-revenue-prediction-467f0990403e", "time": 1683016245.9052281, "path": "towardsdatascience.com/restaurant-revenue-prediction-467f0990403e/", "webpage": {"metadata": {"title": "Restaurant Revenue Prediction. Developing classical models for\u2026 | by Allen Kong | Towards Data Science", "h1": "Restaurant Revenue Prediction", "description": "Restaurants are an essential part of a country\u2019s economy and society. Whether it may be for social gatherings or a quick bite, most of us have experienced at least one visit. With the recent rise in\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/restaurant-revenue-prediction/overview", "anchor_text": "Kaggle", "paragraph_index": 0}, {"url": "https://www.kaggle.com/c/restaurant-revenue-prediction/discussion", "anchor_text": "discussions", "paragraph_index": 8}], "all_paragraphs": ["Restaurants are an essential part of a country\u2019s economy and society. Whether it may be for social gatherings or a quick bite, most of us have experienced at least one visit. With the recent rise in pop up restaurants and food trucks, it\u2019s imperative for the business owner to figure out when and where to open new restaurants since it takes up a lot of time, effort, and capital to do so. This brings up the problem of finding the best optimal time and place to open a new restaurant. TFI which owns many giant restaurant chains has provided demographic, real estate, and commercial data in their restaurant revenue prediction on Kaggle. The challenge here would be to build a robust model that is capable of predicting the revenue of a restaurant.", "After taking a look at the data, there are 137 samples in the training set and 100,000 samples in the test set. This is very intriguing since the distribution of data is usually the other way around. The goal here would be to model revenue based on 137 samples in the training set and see how well the model performs on the 100,000 samples in the test set. The data fields for each sample consist of the restaurant ID which is unique for each restaurant in the sample, the opening date of the restaurant, the city, city group, restaurant type, several non-arbitrary P-variables, and revenue which is the target variable. Using a complex model for this small training dataset with noise will cause the model to overfit to the dataset. To prevent that from happening, regularization techniques for linear regression will definitely need to be used.", "After a brief look at the training data, it appears that there are no null values which is a good thing. However, that may not be the case for the P-variables as we will see later in the data exploration.", "The two figures above show the count of types of restaurants in the training set and test set. Looking carefully, there doesn\u2019t seem to be a single occurrence of the \u2018MB\u2019 type in the training set. Type \u2018MB\u2019 stands for mobile restaurants and type \u2018DT\u2019 stands for drive-thru restaurants. Since mobile restaurants are more related to drive-thru than inline and food courts, the \u2018MB\u2019 samples in the test set were replaced with the \u2018DT\u2019 type.", "There doesn\u2019t seem to be any changes required for the city group feature. The training set has slightly more \u2018Big Cities\u2019 samples than \u2018Other\u2019 samples but that shouldn\u2019t be a problem when we create our model. It should also be intuitive that restaurant revenue in the city than other areas.", "For the \u2018City\u2019 feature, it appears that there are cities in the test set that aren\u2019t in the training set. It is also worth noting that some of the non-arbitrary P-variables already contain geolocation information so the entire \u2018City\u2019 feature was dropped for both datasets.", "The opening date is the date the restaurant first opened. It won\u2019t be of much use in terms of predicting revenue but it would be useful to know how long the restaurant has been open since the opening date. For that reason, I decided to use March 23, 2015 as the date of comparison to calculate the amount of days the restaurant has been open. Then, I chose to downscale the number of days open by a factor of 1000 to slightly improve model performance.", "The data has 37 p-variables which are all obfuscated data. These features contain demographic data, real estate data, and commercial data based on the data field description on the Kaggle competition page.", "Initially, I had thought that the p-variables were numerical features but after reading some of the discussions in the competition, it turns out that some of these features were actually categorical data encoded using integers. What\u2019s even more interesting is that a majority of the values for some of these features are zero. Once again, after digging through the discussions, people concluded that these zero values were actually null values as shown in the plots above. Multivariate imputation by chained equations (also known as MICE) was used to replace the missing values in some of these features. The way it works is that is uses the entire set of available data to estimate the missing values.", "The imputer was used on all p-variables separately for the training set and the test set. The missing values are estimated several times before the imputer takes the average. Before feeding these averages to the model, they need to be rounded to the nearest integer.", "To deal with object types in the data, one hot encoding will be used to transform these features into numerical form which can be provided to the machine learning models. Dummy encoding can also be used to avoid redundancy. The features that will be encoded are \u2018Type\u2019 and \u2018City Group\u2019 since they are the only object types in the datasets.", "Based on the distribution, it looks like revenue is right skewed. There also appears to be outliers which will cause issues in model training. Since we will be experimenting with linear models, the target variable will be transformed to make it normally distributed for improved model interpretation. The target variable was log transformed so the final predictions will need to be exponentiated to rescale the results back to normal.", "The models that I decided on experimenting with were several different linear models, KNN, random forest and gradient boosted models. The goal here is to find the best hyper-tuned models to ensemble for the final model. Before we train any model, we will split the training set into a training and validation set.", "Ridge regression is a regularized linear model. As stated earlier, regularization techniques need to be used to prevent overfitting especially since our training set is very small. Before we train a ridge model on the training, we need to find the optimal parameters for the model. To do this, grid search along with k-fold cross validation was used to find the optimal parameters that led to the best score.", "The optimal parameters are then used for model evaluation using both the training and test sets. The RMSE here is actually RMSLE since we\u2019ve taken the log of the target variable.", "Now we repeat the same procedure for a lasso model. The lasso model works differently from the ridge model because it shrinks the coefficients of less important features. This can be visualized later in the feature importance plot.", "We can see that the lasso model is generalizing a lot better than the ridge model using just the \u2018Days Open\u2019 feature. It\u2019s able to achieve just about the same test error as the ridge model using all features which shows the true potential of these regularization techniques.", "ElasticNet is a linear model that combines the regularization techniques of ridge and lasso. We will use ElasticNetCV to select the best hybrid model using cross validation.", "There is little to no improvement using the elastic net model. We can see that the training scores and test scores between the linear models are about the same.", "In terms of feature importance, the elastic model reduced features by 72%. Even with this reduction, the model does not seem to give an improved score against the ridge or lasso model. This is probably due to the small dataset and the linear models tendency to overfit.", "For KNN, we will use the KNeighborsRegressor from sklearn. We apply the same process to find the optimal neighbor parameter.", "Surprisingly, the KNN model seems to perform a bit better than the linear models on the test set.", "Random forests are very powerful models which are a bit different from bagged decision trees. Unlike bagged trees, random forests will select a subset of features at random and finds the best feature to split at each node whereas bagged trees considers using all features for splitting at each node. Random forests also provide unique hyperparameters to reduce overfitting as well. We will tune our model based on several of these hyperparameters.", "We can see the training score has improved significantly compared to the linear models we\u2019ve used above and KNN. The model is also able to achieve this using nearly all of the data as shown below in the feature importance plot.", "LightGBM provides boosting capabilities for decision trees. It is a good alternative to XGBoost which we will test as well after.", "Based on the training score, it seems that the model has overfitted to the training set since there is no improvement in the test score. It\u2019s probably not optimal to include this model at all in our ensemble later.", "XGBoost is yet another boosting algorithm for decision trees. Let\u2019s see how it compares to LightGBM after tuning hyperparameters.", "The model doesn\u2019t seem to be overfitting as much as LightGBM. The training and test scores seem to be lower than the random forest model too. This explains why the model is heavily used in just about any problem setting.", "It is very easy to overfit in boosted models so we will add early stopping parameters to reduce overfitting. This gives us a better model that is still able to generalize the test set quite well.", "Based on the experimentation of the models above, it\u2019s clear that the linear models and KNN are not the best models for this dataset. Therefore, they won\u2019t be used as part of the ensemble. The best models to ensemble would be random forests and XGBoost models as we have seen from the training and test errors above. I decided to use a random forest ensemble since boosting models in this scenario have a tendency to overfit as shown by the LightGBM model. For the ensemble, I decided to use a stacked ensemble. The benefits of this is to create a single model that has the well-performing capabilities of several base models. The base models are different tuned random forest models and the meta model will be a simple model such as a linear regressor.", "I fitted the stacked model on the entire dataset and tested it against the Kaggle private leaderboard. The model did surprisingly well placing 4th on the private leaderboard with a RMSE score of 1741680.77896. For reference, the 1st place solution on the private leaderboard was an RMSE of 1727811.48553.", "Initially, I had not planned for a lot of things for this project. Before I read some of the discussions in the Kaggle competition, I had assumed the p-variables were actually numeric values. With this in mind, I log transformed these variables which actually ended up making the linear models better in predicting the target variable. This makes sense since every feature is normalized making it easier for a linear model to predict. After finding out that the p-variables were categorical with many missing values, imputation was a much better approach. This brings up the lesson that it\u2019s very important to understand the data you\u2019re working with especially if it\u2019s a small dataset. I had also played around with many models, manually tweaking hyperparameters until I discovered grid search which did wonders on saving time and effort in finding the best model. These were just some of the few things I learned while working on this dataset. A few things to perhaps try in the future would be to fit models on relevant features and including a more diverse ensemble of models.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Enthusiast, Self-Learner Fascinated with Big Data"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F467f0990403e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----467f0990403e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@allen.kong21?source=post_page-----467f0990403e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Allen Kong"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64c6503c82e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&user=Allen+Kong&userId=64c6503c82e8&source=post_page-64c6503c82e8----467f0990403e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@ninjason?utm_source=medium&utm_medium=referral", "anchor_text": "Jason Leung"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/c/restaurant-revenue-prediction/overview", "anchor_text": "Kaggle"}, {"url": "https://www.kaggle.com/c/restaurant-revenue-prediction/discussion", "anchor_text": "discussions"}, {"url": "https://www.kaggle.com/c/restaurant-revenue-prediction", "anchor_text": "Kaggle Competition"}, {"url": "https://www.kaggle.com/c/restaurant-revenue-prediction/discussion", "anchor_text": "Kaggle Discussion"}, {"url": "https://github.com/allenkong221/restaurant-revenue-prediction", "anchor_text": "Source Code"}, {"url": "https://medium.com/tag/ensemble-learning?source=post_page-----467f0990403e---------------ensemble_learning-----------------", "anchor_text": "Ensemble Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----467f0990403e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/scikit-learn?source=post_page-----467f0990403e---------------scikit_learn-----------------", "anchor_text": "Scikit Learn"}, {"url": "https://medium.com/tag/kaggle?source=post_page-----467f0990403e---------------kaggle-----------------", "anchor_text": "Kaggle"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----467f0990403e---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&user=Allen+Kong&userId=64c6503c82e8&source=-----467f0990403e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&user=Allen+Kong&userId=64c6503c82e8&source=-----467f0990403e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----467f0990403e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F467f0990403e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----467f0990403e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----467f0990403e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----467f0990403e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----467f0990403e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----467f0990403e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----467f0990403e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Allen Kong"}, {"url": "https://medium.com/@allen.kong21/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "64 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64c6503c82e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&user=Allen+Kong&userId=64c6503c82e8&source=post_page-64c6503c82e8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4f72a13337d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frestaurant-revenue-prediction-467f0990403e&newsletterV3=64c6503c82e8&newsletterV3Id=4f72a13337d5&user=Allen+Kong&userId=64c6503c82e8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}