{"url": "https://towardsdatascience.com/bulk-downloads-in-python-fast-%EF%B8%8F-df070451786", "time": 1683009281.56203, "path": "towardsdatascience.com/bulk-downloads-in-python-fast-%EF%B8%8F-df070451786/", "webpage": {"metadata": {"title": "Using Amazon SQS and Lambda to Download Data | Towards Data Science", "h1": "Bulk Downloads in Python FAST \u26a1\ufe0f", "description": "An overview of how I used AWS Lambda and Amazon SQS to download 194,204 files to Amazon S3 at a speed 350X faster than on my local machine!"}, "outgoing_paragraph_urls": [{"url": "https://aws.amazon.com/serverless/use-sqs-as-an-event-source-for-lambda-tutorial/", "anchor_text": "great resources already", "paragraph_index": 6}, {"url": "https://www.linkedin.com/in/hurleydavid/", "anchor_text": "https://www.linkedin.com/in/hurleydavid/", "paragraph_index": 22}], "all_paragraphs": ["This article provides an overview of how I used AWS Lambda and Amazon SQS to download 194,204 files (i.e. CSV format) to Amazon S3 at a speed 350X faster than on my local machine!", "Recently, I built a web application to download historical Canadian weather data. As part of the application structure, I needed to download data from a third-party server for 8,324 independent weather stations and store the data in a database (Amazon S3).", "It seems easy, right? Just create some code, execute, and voila you have the data. WRONG.", "Each station has multiple years of weather data and the third-party server limits downloads to 1-year increments. In short, downloading the dataset for all 8,324 stations would mean downloading 194,204 separate files (i.e. one file for each year of data at a station), combining data for matching stations, and pushing data to Amazon S3.", "The issue with downloading the data is not the file size, the entire dataset is only 4.4 GB, but instead the download speed and network latency. On my local machine, it takes approximately 1.7 seconds to download 1-year of data and push the data to Amazon S3. This means using my local machine to download all 194,204 files and push to Amazon S3 would take 3.9 days, assuming there are no network interruptions or failed downloads. \ud83d\ude32", "It\u2019s obvious that downloading the data on a local machine is impractical and not robust, especially with such easy access to cloud computing. Ultimately, I decided to use AWS Lambda to execute my Python code and Amazon SQS message queue to trigger Lambda events and communicate download tasks.", "This article is not intended to be an in-depth overview of AWS Lambda and SQS, for that there are great resources already, but I will provide a basic overview of what Lambda and SQS do and the framework I used.", "AWS Lambda is a way to run code in response to events without needing to provision or manage servers. Amazon SQS is a way to send, store, and receive messages between different software components (i.e. a message between two AWS Lambda functions).", "In my case, I used one Lambda function to generate messages, containing information such as weather station name and ID, for each of the 8,324 weather stations. Each message was sent and stored in an SQS message queue. At the same time, another Lambda function was designed to execute in response to an SQS event (i.e. a message reaching the queue). This Lambda function retrieved messages from the SQS queue, downloaded data using the message information, and pushed the data to Amazon S3 for storage.", "Below are a few reasons why Lambda and SQS are awesome and how they speed up execution time.", "NOTE: You should be careful when increasing concurrency and memory of an AWS Lambda function as it can quickly lead to increased costs.", "You might ask \u201cwhy should you send the same information from one Lambda function to another through SQS and not use a single Lambda function for everything?\u201d.", "AWS Lambda functions are limited to a maximum execution time of 15 minutes. If I tried to execute 30 tasks that took 1 minute each I would exceed the maximum execution time. Instead, I need to break the 30 tasks into chunks with execution times less than 15 minutes. By using SQS, I can trigger Lambda and define how many tasks I want Lambda to offload from the queue (maximum of 10) making sure the total task time stays below the execution time.", "Use AWS Lamda to send messages to the SQS message queue. In my case, I sent a message for each weather station with information such as weather station ID and start and end years of data.", "Create an AWS Lambda function that triggers (i.e. execute) when messages are available in the SQS message queue. In my case, the Lambda function offloads SQS messages, uses the message information to download weather station data, and pushes the data to Amazon S3 for storage.", "I configured the Lambda function to read 10 messages at a time from the SQS message queue. This kept the total execution time below the 15-minute limit. I also configured the Lambda function with a concurrency of up to 1000 (i.e. if needed Lambda can invocate 1000 execution at the same time) and a memory of 256 MB.", "On my local machine, it would have taken 3.9 days to download and push the data from 8,324 weather stations to Amazon S3.", "Using AWS Lambda and Amazon SQS I was able to complete the task in ~16 minutes or 350X faster than my local machine!!! \ud83d\udcaa", "It takes ~8 minutes to generate the messages for the SQS message queue (Step 1) and another 8 minutes for Lambda to concurrently download and push the data to Amazon S3 (Step 2).", "The total cost with AWS free tier was $0.00 and without it\u2019s about $4.30.", "Overall, I am glad to have found the AWS Lambda and Amazon SQS combo and will use it again!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist in the energy industry | https://www.linkedin.com/in/hurleydavid/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdf070451786&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----df070451786--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----df070451786--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@davidhurley_48402?source=post_page-----df070451786--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidhurley_48402?source=post_page-----df070451786--------------------------------", "anchor_text": "David Hurley"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F995c0a4ee38f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&user=David+Hurley&userId=995c0a4ee38f&source=post_page-995c0a4ee38f----df070451786---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@gabrielrana?utm_source=medium&utm_medium=referral", "anchor_text": "Gabriel Tovar"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/building-a-dynamic-weather-download-app-1ce64a6c3e61", "anchor_text": "Building a Dynamic Weather Download AppHistorical Canadian weather data made easy using Python, Dash, and AWStowardsdatascience.com"}, {"url": "https://aws.amazon.com/serverless/use-sqs-as-an-event-source-for-lambda-tutorial/", "anchor_text": "great resources already"}, {"url": "https://medium.com/tag/aws?source=post_page-----df070451786---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/data-science?source=post_page-----df070451786---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----df070451786---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----df070451786---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----df070451786---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%25EF%25B8%258F-df070451786&user=David+Hurley&userId=995c0a4ee38f&source=-----df070451786---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%25EF%25B8%258F-df070451786&user=David+Hurley&userId=995c0a4ee38f&source=-----df070451786---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----df070451786--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdf070451786&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----df070451786---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----df070451786--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----df070451786--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----df070451786--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----df070451786--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----df070451786--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----df070451786--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----df070451786--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----df070451786--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidhurley_48402?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidhurley_48402?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David Hurley"}, {"url": "https://medium.com/@davidhurley_48402/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "76 Followers"}, {"url": "https://www.linkedin.com/in/hurleydavid/", "anchor_text": "https://www.linkedin.com/in/hurleydavid/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F995c0a4ee38f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&user=David+Hurley&userId=995c0a4ee38f&source=post_page-995c0a4ee38f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F995c0a4ee38f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbulk-downloads-in-python-fast-%EF%B8%8F-df070451786&user=David+Hurley&userId=995c0a4ee38f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}