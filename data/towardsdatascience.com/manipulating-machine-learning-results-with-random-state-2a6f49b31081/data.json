{"url": "https://towardsdatascience.com/manipulating-machine-learning-results-with-random-state-2a6f49b31081", "time": 1683001842.606601, "path": "towardsdatascience.com/manipulating-machine-learning-results-with-random-state-2a6f49b31081/", "webpage": {"metadata": {"title": "Manipulating machine learning results with random state | by Ler Wei Han | Towards Data Science", "h1": "Manipulating machine learning results with random state", "description": "Tuning hyperparameters, performing the right kind of feature engineering, feature selection etc are all part of the data science flow for building your machine learning model. Hours are spent\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/titanic/data", "anchor_text": "Titanic dataset", "paragraph_index": 5}, {"url": "https://stackoverflow.com/questions/45516424/sklearn-train-test-split-on-pandas-stratify-by-multiple-columns", "anchor_text": "multiple columns", "paragraph_index": 32}, {"url": "https://github.com/WeiHanLer/Manipulating-machine-learning-results-with-random-state-", "anchor_text": "github repo", "paragraph_index": 36}, {"url": "http://linkedin.com/in/weihanler", "anchor_text": "linkedin.com/in/weihanler", "paragraph_index": 38}], "all_paragraphs": ["Tuning hyperparameters, performing the right kind of feature engineering, feature selection etc are all part of the data science flow for building your machine learning model. Hours are spent tweaking and modifying each part of the process to improve the outcome of our model.", "However, there is one argument nested within the most popular functions in data science that can be altered to change your machine learning results.", "\u2026..and it has nothing to do with domain knowledge or any of the engineering you have done on your data.", "A seemingly harmless argument that could change your results, yet barely any article teaches you how to optimise it. With some manipulation to the random permutation of the training data and the model seed, anyone can artificially improve their results.", "In this article, I would like to gently highlight an often overlooked component of most data science projects \u2014 random state and how it affects our model outputs in machine learning.", "To show how this affects the prediction result, I will be using Kaggle\u2019s famous Titanic dataset to predict the survival of the passengers.", "Using the train dataset, I have applied some bare minimum data cleaning and feature engineering just to get the data good enough for training. I will be using a typical grid search cross validation with the xgboost classifier model for this example.", "Training data that I will be using:", "Using grid search to find the optimal xgboost hyperparameters, I got the best parameters for the model.", "Based on the cross validation result, my best performance achieved is 82.49% and the best parameters are:", "This process is a staple to many machine learning projects: search through a range of hyperparameters to get the best averaged cross validation result. At this time, the work is considered done.", "After all, cross validation should be robust to randomness\u2026. right?", "For data science tutorials or showcases of results in Kaggle kernels, the notebook would have ended right there. However I would like pull back the previous workflow to show how the result differs with different random states.", "This time lets run the code with 5 different random states on the classifier:", "Lets change the cross validation random state as well:", "All the results returned are different. With 5 different random states for the xgboost classifier and the cross validation split, the grid search run produces 25 different best performance results.", "Having multiple results stems from the fact that the data and the algorithm we use have a random component that can affect the output.", "However this creates a huge doubt in the data science process as we make changes to our model all the time.", "For each of the changes that I make, I would compare the results across different runs to validate the improvements. E.g Changing \u2018a\u2019 improves model by 2%, adding \u2018b\u2019 to the features improves it by a further 3%.", "With the variation of results as shown above, it makes me wonder if my feature engineering actually contributed to a better result or the improvement was all down to chance.", "Maybe a different random state would make my results worse than before.", "Notice that with classifier random state 4 and stratified shuffle random state 2, my results are substantially higher at 84.84% compared to my initial run.", "Which result do I present then?", "It is tantalizing to present the best of the model results, since the random seed is fixed and the results are reproducible.", "It seems absurd that an improvement of 2% to the result can be attributed to just a different random state. It seems like on a good day with the correct seed, we get a better result.", "There are many ways to tackle this issue in a data science pipeline. This is by no means a complete list, but just some of the practices I carry out on my work.", "1) Fix the random state from the start", "Commit to a fixed random state for everything or better yet, fix a global random seed so that randomness does not come into play. Treat it as an immutable variable in your process and not something to be tinkered with.", "2) Use the prediction results as an interval", "Since the results vary across a range, you can opt to report the cross validation results as a range. Repeat the run with different seeds in order to produce a confidence interval that you can report with. Its the range that one can comfortably say the performance band of the model really lies within.", "3) Reduce imbalance/randomness in data split", "One of the ways to reduce the effect of a random split on your data is to make sure the split does not affect the composition of the data too much.", "Stratify your data to reduce randomness. Stratifying your data ensures that the data for your train test split/oob error/cross validation has the same ratio of survivors/non-survivors in the train and test set respectively. The splits are made by preserving the percentage of each class will then reduce the magnitude of how a random shuffle affects the outcome. Stratification can even be done on multiple columns.", "It is certainly important to note that variation in performance should not be drastic despite randomization in the data.", "If the accuracy results vary wildly with the seed, it probably means that the model is not robust and you should consider improving your methods to better fit the data. Most of the time it does not matter, but when margins are very close, it would be tempting to consider all variables that can be used to improve model performance, including random state.", "Hopefully this article has managed to highlight how randomness affects our models and a couple of ways to mitigate its effect.", "Here is the github repo of the code I have used, all of which can be reproduced. Thanks for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist at Great Eastern. Connect with me @ linkedin.com/in/weihanler"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2a6f49b31081&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lerweihan?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lerweihan?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Ler Wei Han"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbf360ebbd4d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&user=Ler+Wei+Han&userId=bf360ebbd4d2&source=post_page-bf360ebbd4d2----2a6f49b31081---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@simonbasler?utm_source=medium&utm_medium=referral", "anchor_text": "Simon Basler"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/c/titanic/data", "anchor_text": "Titanic dataset"}, {"url": "https://unsplash.com/@dylan_nolte?utm_source=medium&utm_medium=referral", "anchor_text": "dylan nolte"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://xkcd.com/2110/", "anchor_text": "https://xkcd.com/2110/"}, {"url": "https://stackoverflow.com/questions/45516424/sklearn-train-test-split-on-pandas-stratify-by-multiple-columns", "anchor_text": "multiple columns"}, {"url": "https://github.com/WeiHanLer/Manipulating-machine-learning-results-with-random-state-", "anchor_text": "github repo"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2a6f49b31081---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/random-state?source=post_page-----2a6f49b31081---------------random_state-----------------", "anchor_text": "Random State"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2a6f49b31081---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/xgboost?source=post_page-----2a6f49b31081---------------xgboost-----------------", "anchor_text": "Xgboost"}, {"url": "https://medium.com/tag/hyperparameter-tuning?source=post_page-----2a6f49b31081---------------hyperparameter_tuning-----------------", "anchor_text": "Hyperparameter Tuning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&user=Ler+Wei+Han&userId=bf360ebbd4d2&source=-----2a6f49b31081---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&user=Ler+Wei+Han&userId=bf360ebbd4d2&source=-----2a6f49b31081---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2a6f49b31081&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2a6f49b31081---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2a6f49b31081--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2a6f49b31081--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2a6f49b31081--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lerweihan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lerweihan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ler Wei Han"}, {"url": "https://medium.com/@lerweihan/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "33 Followers"}, {"url": "http://linkedin.com/in/weihanler", "anchor_text": "linkedin.com/in/weihanler"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbf360ebbd4d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&user=Ler+Wei+Han&userId=bf360ebbd4d2&source=post_page-bf360ebbd4d2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb0bd7c08495&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanipulating-machine-learning-results-with-random-state-2a6f49b31081&newsletterV3=bf360ebbd4d2&newsletterV3Id=b0bd7c08495&user=Ler+Wei+Han&userId=bf360ebbd4d2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}