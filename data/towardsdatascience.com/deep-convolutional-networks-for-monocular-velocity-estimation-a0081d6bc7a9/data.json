{"url": "https://towardsdatascience.com/deep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9", "time": 1683018335.373613, "path": "towardsdatascience.com/deep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9/", "webpage": {"metadata": {"title": "Deep Convolutional Networks for Monocular Velocity Estimation | by Sam Black | Towards Data Science", "h1": "Deep Convolutional Networks for Monocular Velocity Estimation", "description": "In this article, I present my process of solving this interesting computer vision problem from Comma.ai: predicting the speed of a car from a dash-cam video. The somewhat complex challenge is simply\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1504.06852", "anchor_text": "Philipp Fischer, et al. \u201cFlowNet: Learning Optical Flow with Convolutional Networks.\u201d (2015).", "paragraph_index": 8}, {"url": "https://arxiv.org/abs/2007.02246", "anchor_text": "Yong Lee, Shaohua Zhang, Miao Li, & Xiaoyu He. (2020). Blind Inverse Gamma Correction with Maximized Differential Entropy.", "paragraph_index": 13}, {"url": "http://homepages.inf.ed.ac.uk/rbf/CVonline/LOCAL_COPIES/OWENS/LECT12/node4.html", "anchor_text": "reference", "paragraph_index": 24}, {"url": "https://github.com/onesamblack/deep-velocity-estimation", "anchor_text": "https://github.com/onesamblack/deep-velocity-estimation", "paragraph_index": 38}], "all_paragraphs": ["In this article, I present my process of solving this interesting computer vision problem from Comma.ai: predicting the speed of a car from a dash-cam video.", "The final results achieve a remarkable MSE of 0.36*!", "*MSE calculated on a 20% validation set.", "The evaluation for this challenge is as follows:", "The somewhat complex challenge is simply presented. There are two videos, each shot at 20fps. The train.mp4 has an associated train.txt file, with a speed for each frame. The goal is to produce a test.txt file with a speed prediction for each frame in the test.mp4.", "Example 1: Residential area, heavy traffic", "The difference in environments means that the approach needs to be dynamic. Handling speed estimation during turns, stops, and with changing reference points.", "Intuitively, what I want to do is detect changes between frames. Using these changes along with the sampling rate (20hz), I could estimate the speed using some basic physics \u2014 however\u2026", "I implemented a method similar to Philipp Fischer, et al. \u201cFlowNet: Learning Optical Flow with Convolutional Networks.\u201d (2015). However, instead of outputting an optical flow image, there is a fully connected network which predicts the speed. I\u2019m colloquially calling this method \u201cDeep Vehicular Velocity Estimation.\u201d", "Given that I\u2019ve adapted an architecture for optical flow and I\u2019ve changed the target to the velocity, each of the convolutional networks, should, in theory, extract features relevant to velocity estimation instead of flow. For my target, I\u2019m using the mean velocity between the two frames and optimizing based on mean square error.", "The code for the network is here:", "For this network, I\u2019d like the convolutional layers to focus in on edges. My thought is that it would serve as a proxy for actually annotating images with key points and then trying to estimate the delta between key points for adjacent images.", "To make this convenient, I created a class: PreprocessingPipeline that I use to organize the steps. See the example gist below.", "\u00b9 Yong Lee, Shaohua Zhang, Miao Li, & Xiaoyu He. (2020). Blind Inverse Gamma Correction with Maximized Differential Entropy.", "Applying the process creates the following:", "The results were\u2026so, so. It was a nice idea. After training for ~25 epochs, my MSE converged to ~68. Horrible.", "I played around with a few associated ideas, such as increasing the space between sequences to increase the difference between adjacent frames in the hope that the architecture would extract something useful. No dice.", "Typically, I would look to hyper-parameter tuning if I saw that this network was converging and my loss was decreasing steadily, however, I saw no reasons to believe that this architecture is salvageable.", "So much for that genius idea. C\u2019est la vie.", "Let\u2019s move on to the next experiment.", "This is a natural progression. Maybe the image preprocessing was an issue. For this experiment, I used all of the channels of the input image, with the same architecture outlined above.", "Honestly, there\u2019s no reason for me to believe that adding RGB channels will boost performance, but running this experiment cost about ~20 lines of code and a few compute hours. Let\u2019s see.", "It turns out that adding color didn\u2019t improve things much. Hypothesis confirmed. On to the next one!", "Optical flow measures the derivative of two sequential images (as measured by intensity) with respect to time. Said otherwise, the flow measures the change in two images over time, and represents that change as a scalar field.", "If you\u2019re interested in the math behind taking the derivative of images (who isn\u2019t!?), please see this reference.", "Some examples of optical flow from the dataset", "An example of that same optical flow transformed to HSV values \u2014", "Given that an optical flow image represents the degree of \u201cchanginess\u201d per sample of two sequential RGB images, this should, hopefully, be the missing link to fix the performance.", "For this experiment, I\u2019m going to ditch the parallel convolutional approach and just use a deep convolutional network. This should reduce the number of parameters, thus, greatly reducing the training time.", "Surprisingly, the results were not so great with this method despite following the author\u2019s approach.", "I began with a carbon-copy of the architecture described here, then adapted it to mimic the parameters in Resnet layers. Both didn\u2019t return spectacular results.", "One last attempt before I table this project", "For this experiment, instead of using a single channel (image at time_n, image at time_n + 1), I use a depth of frames with the architecture from experiments #1 and #2.", "I spent time making this architecture somewhat modular, so adding depths is as easy as modifying my data loader and adding on some input channels to the VelocityEstimationNet.", "Since I\u2019m using two depths now, the target variable is a vector of element wise means. y\u00b9 is the speed of the 1st frame in the first depth, y\u00b2 is the speed of the 1st frame in the second depth, and n is the size of the depth.", "Additionally, I need to switch my 2D convolutions to 3D convolutions. I\u2019m stacking multiple time steps in one depth \u2014 I want to take advantage of any spatiotemporal features that can be extracted.", "Looks like we got a winner!", "The train time (>1.3 hours per epoch) was eventually worth it.", "I\u2019d love to have someone verify these results, for my own sanity. If you\u2019re willing, the code for the model is here: https://github.com/onesamblack/deep-velocity-estimation", "If you find any discrepancies, issues, or want to challenge the results, please feel free submit an issue on github!", "Here\u2019s a list of the results. For experiments 1\u20133, the MSE exceeded 10 (sometimes by quite a bit as covered in experiment #1), thus, precise results were omitted.", "If you liked this, you may also like:", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa0081d6bc7a9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sam-black.medium.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": ""}, {"url": "https://sam-black.medium.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Sam Black"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd60bcc6a9490&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&user=Sam+Black&userId=d60bcc6a9490&source=post_page-d60bcc6a9490----a0081d6bc7a9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/making-sense-of-big-data", "anchor_text": "Making Sense of Big Data"}, {"url": "https://github.com/commaai/speedchallenge", "anchor_text": "https://github.com/commaai/speedchallenge"}, {"url": "https://arxiv.org/abs/1504.06852", "anchor_text": "Philipp Fischer, et al. \u201cFlowNet: Learning Optical Flow with Convolutional Networks.\u201d (2015)."}, {"url": "https://arxiv.org/abs/2007.02246", "anchor_text": "Yong Lee, Shaohua Zhang, Miao Li, & Xiaoyu He. (2020). Blind Inverse Gamma Correction with Maximized Differential Entropy."}, {"url": "http://www.reddit.com/r/wheredidthesodago/comments/3dytps/tired_of_your_food_processor_get_our_patented/", "anchor_text": "link"}, {"url": "http://homepages.inf.ed.ac.uk/rbf/CVonline/LOCAL_COPIES/OWENS/LECT12/node4.html", "anchor_text": "reference"}, {"url": "https://github.com/JonathanCMitchell/speedChallenge", "anchor_text": "here"}, {"url": "https://chatbotslife.com/autonomous-vehicle-speed-estimation-from-dashboard-cam-ca96c24120e4", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/a-comprehensive-introduction-to-different-types-of-convolutions-in-deep-learning-669281e58215", "anchor_text": "A Comprehensive Introduction to Different Types of Convolutions in Deep Learning"}, {"url": "https://github.com/onesamblack/deep-velocity-estimation", "anchor_text": "https://github.com/onesamblack/deep-velocity-estimation"}, {"url": "https://sam-black.medium.com/using-bert-sentence-embeddings-t-sne-and-k-means-to-visualize-and-explore-statements-1c277a6c161a", "anchor_text": "Using BERT Sentence Embeddings, T-SNE and K-Means to Visualize and Explore StatementsIn this article, I demonstrate a method for understanding natural clusters of statements in transcribed speeches. This\u2026sam-black.medium.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a0081d6bc7a9---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----a0081d6bc7a9---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a0081d6bc7a9---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a0081d6bc7a9---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/making-sense-of-big-data?source=post_page-----a0081d6bc7a9---------------making_sense_of_big_data-----------------", "anchor_text": "Making Sense Of Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&user=Sam+Black&userId=d60bcc6a9490&source=-----a0081d6bc7a9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&user=Sam+Black&userId=d60bcc6a9490&source=-----a0081d6bc7a9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa0081d6bc7a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a0081d6bc7a9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a0081d6bc7a9--------------------------------", "anchor_text": ""}, {"url": "https://sam-black.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sam-black.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sam Black"}, {"url": "https://sam-black.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "305 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd60bcc6a9490&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&user=Sam+Black&userId=d60bcc6a9490&source=post_page-d60bcc6a9490--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6891ac1855bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-convolutional-networks-for-monocular-velocity-estimation-a0081d6bc7a9&newsletterV3=d60bcc6a9490&newsletterV3Id=6891ac1855bc&user=Sam+Black&userId=d60bcc6a9490&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}