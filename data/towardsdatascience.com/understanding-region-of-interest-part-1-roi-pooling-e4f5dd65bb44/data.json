{"url": "https://towardsdatascience.com/understanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44", "time": 1683003658.697637, "path": "towardsdatascience.com/understanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44/", "webpage": {"metadata": {"title": "Understanding Region of Interest \u2014 (RoI Pooling) | by Kemal Erdem (burnpiro) | Towards Data Science", "h1": "Understanding Region of Interest \u2014 (RoI Pooling)", "description": "RoI (Region of Interest) is a proposed region from the original image. We\u2019re not going to describe how to extract those regions because there are multiple methods to do only that. The only thing we\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@kemalpiro/understanding-region-of-interest-part-2-roi-align-and-roi-warp-f795196fc193", "anchor_text": "this article", "paragraph_index": 1}], "all_paragraphs": ["We\u2019re going to discuss original RoI pooling described in Fast R-CNN paper (light blue rectangle on the image above). There is a second and a third version of that process called RoIAlign and RoIWarp.", "If you\u2019re interested in those two please check out this article", "RoI (Region of Interest) is a proposed region from the original image. We\u2019re not going to describe how to extract those regions because there are multiple methods to do only that. The only thing we should know right now is there are multiple regions like that and all of them should be tested at the end.", "Fast R-CNN is different from the basic R-CNN network. It has only one convolutional feature extraction (in our example we\u2019re going to use VGG16).", "Our model takes an image input of size 512x512x3 (width x height x RGB) and VGG16 is mapping it into a 16x16x512 feature map. You could use different input sizes (usually it\u2019s smaller, default input size for VGG16 in Keras is 224x224).", "If you look at the output matrix you should notice that it\u2019s width and height is exactly 32 times smaller than the input image (512/32 = 16). That\u2019s important because all RoIs have to be scaled down by this factor.", "Here we have 4 different RoIs. In the actual Fast R-CNN you might have thousands of them but printing all of them would make image unreadable.", "It\u2019s important to remember that RoI is NOT a bounding box. It might look like one but it\u2019s just a proposal for further processing. Many people are assuming that because most of the papers and blog posts are creating proposals in place of actual objects. It\u2019s just more convenient that way, I did it as well on my image. Here is an example of a different proposal area which also is going to be checked by Fast R-CNN (green box).", "There are methods to limit the number of RoIs and maybe I\u2019ll write about it in the future.", "Now when we know what RoI is we have to be able to map them onto VGG16\u2019s output feature map.", "Every RoI has it\u2019s original coordinates and size. From now we\u2019re going to focus only on one of them:", "Its original size is 145x200 and the top left corner is set to be in (192,296). As you could probably tell, we\u2019re not able to divide most of those numbers by 32 (scale factor).", "Only the last number (Y coordinate of the top left corner) makes sense. That\u2019s because we\u2019re working on a 16x16 grid right now and only numbers we care about are integers (to be more precise: Natural Numbers).", "Quantization is a process of constraining an input from a large set of values (like real numbers) to a discrete set (like integers)", "If we put our original RoI on feature map it would look like this:", "We cannot really apply the pooling layer on it because some of the \u201ccells\u201d are divided. What quantization is doing is that every result is rounded down before placing it on the matrix. 9.25 becomes 9, 4.53 becomes 4, etc.", "You can notice that we\u2019ve just lost a bunch of data (dark blue) and gain new data (green):", "We don\u2019t have to deal with it because it\u2019s still going to work but there is a different version of this process called RoIAlign which fixes that.", "Now when we have our RoI mapped onto feature map we can apply pooling on it. Once again we\u2019re going to choose the size of RoI Pooling layer just for our convenience, but remember the size might be different. You might ask \u201cWhy do we even apply RoI Pooling?\u201d and that\u2019s a good question. If you look at the original design of Fast R-CNN:", "After RoI Pooling Layer there is a Fully Connected layer with a fixed size. Because our RoIs have different sizes we have to pool them into the same size ( 3x3x512 in our example). At this moment our mapped RoI is a size of 4x6x512 and as you can imagine we cannot divide 4 by 3 :(. That\u2019s where quantization strikes again.", "This time we don\u2019t have to deal with coordinates, only with size. We\u2019re lucky (or just convenient size of pooling layer) that 6 could be divided by 3 and it gives 2, but when you divide 4 by 3 we\u2019re left with 1.33. After applying the same method (round down) we have a 1x2 vector. Our mapping looks like this:", "Because of quantization, we\u2019re losing whole bottom row once again:", "Now we can pool data into 3x3x512 matrix", "In this case, we\u2019ve applied Max Pooling but it might be different in your model. Ofc. this process is done on the whole RoI matrix not only on the topmost layer. So the end result looks like this:", "The same process is applied to every single RoI from our original image so in the end, we might have hundreds or even thousands of 3x3x512 matrixes. Every one of those matrixes has to be sent through the rest of the network (starting from the FC layer). For each of them, the model is generating bbox and class separately.", "After pooling is done, we\u2019re certain that our input is a size of 3x3x512 so we can feed it into FC layers for further processing. There is one more thing to discuss. We\u2019ve lost a lot of data due to the quantization process. To be precise, that much:", "This might be a problem because each \u201ccell\u201d contains a huge amount of data (1x1x512 on feature map which loosely translates to 32x32x3 on an original image but please do not use that reference, because that\u2019s not how convolutional layer works). There is a way to fix that (RoIAlign) and I\u2019m going to write a second article about it soon.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Engineer, Javascript Architect, Consultant, MTB lover"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe4f5dd65bb44&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kemalpiro?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kemalpiro?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Kemal Erdem (burnpiro)"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F33f26fcba3a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&user=Kemal+Erdem+%28burnpiro%29&userId=33f26fcba3a2&source=post_page-33f26fcba3a2----e4f5dd65bb44---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arxiv.org/pdf/1504.08083.pdf", "anchor_text": "https://arxiv.org/pdf/1504.08083.pdf"}, {"url": "https://medium.com/@kemalpiro/understanding-region-of-interest-part-2-roi-align-and-roi-warp-f795196fc193", "anchor_text": "this article"}, {"url": "https://www.flickr.com/photos/bunny/", "anchor_text": "https://www.flickr.com/photos/bunny/"}, {"url": "https://arxiv.org/pdf/1504.08083.pdf", "anchor_text": "https://arxiv.org/pdf/1504.08083.pdf"}, {"url": "https://medium.com/@kemalpiro/understanding-region-of-interest-part-2-roi-align-and-roi-warp-f795196fc193", "anchor_text": "https://medium.com/@kemalpiro/understanding-region-of-interest-part-2-roi-align-and-roi-warp-f795196fc193"}, {"url": "https://arxiv.org/pdf/1504.08083.pdf", "anchor_text": "https://arxiv.org/pdf/1504.08083.pdf"}, {"url": "https://erdem.pl/2020/02/understanding-region-of-interest-ro-i-pooling", "anchor_text": "https://erdem.pl"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e4f5dd65bb44---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----e4f5dd65bb44---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----e4f5dd65bb44---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e4f5dd65bb44---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/understanding-ml?source=post_page-----e4f5dd65bb44---------------understanding_ml-----------------", "anchor_text": "Understanding Ml"}, {"url": "https://creativecommons.org/licenses/by-nc-sa/4.0/", "anchor_text": "Some rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&user=Kemal+Erdem+%28burnpiro%29&userId=33f26fcba3a2&source=-----e4f5dd65bb44---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&user=Kemal+Erdem+%28burnpiro%29&userId=33f26fcba3a2&source=-----e4f5dd65bb44---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe4f5dd65bb44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e4f5dd65bb44---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e4f5dd65bb44--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kemalpiro?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kemalpiro?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kemal Erdem (burnpiro)"}, {"url": "https://medium.com/@kemalpiro/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "393 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F33f26fcba3a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&user=Kemal+Erdem+%28burnpiro%29&userId=33f26fcba3a2&source=post_page-33f26fcba3a2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3b505e95e71f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-region-of-interest-part-1-roi-pooling-e4f5dd65bb44&newsletterV3=33f26fcba3a2&newsletterV3Id=3b505e95e71f&user=Kemal+Erdem+%28burnpiro%29&userId=33f26fcba3a2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}