{"url": "https://towardsdatascience.com/gpu-accelerated-machine-learning-on-macos-48d53ef1b545", "time": 1683001804.758236, "path": "towardsdatascience.com/gpu-accelerated-machine-learning-on-macos-48d53ef1b545/", "webpage": {"metadata": {"title": "GPU-Accelerated Machine Learning on MacOS | by Riccardo Di Sipio | Towards Data Science", "h1": "GPU-Accelerated Machine Learning on MacOS", "description": "Massively parallel programming is very useful to speed up calculations where the same operation is applied multiple times on similar inputs. If your code involves a number of if or case statements\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.open-mpi.org/", "anchor_text": "OpenMPI", "paragraph_index": 0}, {"url": "https://developer.nvidia.com/curand", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://www.khronos.org/opencl/", "anchor_text": "OpenCL", "paragraph_index": 2}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 3}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 3}, {"url": "https://developer.nvidia.com/cuda-zone", "anchor_text": "NVIDIA CUDA", "paragraph_index": 3}, {"url": "https://support.apple.com/en-us/HT208544", "anchor_text": "this guide", "paragraph_index": 4}, {"url": "https://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html", "anchor_text": "official documentation", "paragraph_index": 5}, {"url": "https://www.nvidia.com/download/driverResults.aspx/147830/", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://documen.tician.de/pyopencl/", "anchor_text": "PyOpenCL", "paragraph_index": 6}, {"url": "https://documen.tician.de/pycuda/", "anchor_text": "PyCUDA", "paragraph_index": 6}, {"url": "https://www.mooc-list.com/course/intro-parallel-programming-udacity", "anchor_text": "this online course", "paragraph_index": 8}, {"url": "https://www.amazon.ca/OpenCL-Programming-Guide-Aaftab-Munshi/dp/0321749642", "anchor_text": "this book", "paragraph_index": 8}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 13}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "functional APIs", "paragraph_index": 13}, {"url": "https://github.com/Theano/Theano", "anchor_text": "Theano", "paragraph_index": 13}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow", "paragraph_index": 13}, {"url": "https://vertexai-plaidml.readthedocs-hosted.com/en/latest/index.html", "anchor_text": "PlaidML", "paragraph_index": 14}, {"url": "https://github.com/keras-team/keras/blob/master/examples/mnist_cnn.py", "anchor_text": "official documentation", "paragraph_index": 20}, {"url": "https://www.intel.ai/automatic-kernel-generation-in-plaidml/#gs.lecnpy", "anchor_text": "Tile", "paragraph_index": 25}, {"url": "https://vertexai-plaidml.readthedocs-hosted.com/en/latest/writing_tile_code.html", "anchor_text": "documentation", "paragraph_index": 27}, {"url": "https://www.intel.ai/plaidml/", "anchor_text": "Vertex.ai", "paragraph_index": 28}, {"url": "https://www.forbes.com/sites/marcochiappetta/2019/10/26/intel-xe-dg1-discrete-gpu-silicon-is-alive-and-being-validated-in-intels-labs/#1caee6ba645f", "anchor_text": "Bob Swan said", "paragraph_index": 28}], "all_paragraphs": ["Massively parallel programming is very useful to speed up calculations where the same operation is applied multiple times on similar inputs. If your code involves a number of if or case statements, you may want to run on a CPU using e.g. OpenMPI. If your code involves the generation of random numbers, parallel programming may not be the best solution (however, see here). Otherwise, you are probably in the right place, so keep reading!", "Training a neural network involves a very large number of matrix multiplications. This is the quintessential massively parallel operation, which constitutes one of the main reasons why GPUs are vital to Machine Learning. One rule of thumb to remember is that 1K CPUs = 16K cores = 3GPUs, although the kind of operations a CPU can perform vastly outperforms those of a single GPU core. For GPUs, strength is in numbers!", "iMac and MacBook Pro computers are equipped with an AMD Radeon GPU card. Unfortunately, this kind of hardware can not be used directly to speed-up calculations that are typical in Machine Learning applications, such as training a CNN. While there isn\u2019t a solution for all possible applications, there is still a workaround for simple architectures based on a parallel programming language called OpenCL.", "The two most popular ML frameworks Keras and PyTorch support GPU acceleration based on the general-purpose GPU library NVIDIA CUDA. CUDA only works with NVIDIA GPU cards.", "NVIDIA external GPU cards (eGPU) can be used by a MacOS systems with a Thunderbolt 3 port and MacOS High Sierra 10.13.4 or later. Follow this guide to install the eGPU.", "To install CUDA on MacOs follow the official documentation. Drivers can be found here.", "The project PyOpenCL is probably the easiest way to get started with GP-GPU on a Mac. See also its sister project PyCUDA.", "The centrepiece of OpenCL is a kernel, which is a function (written in a C-like language) that can be applied to chunks of input data.", "For an introduction to parallel programming follow this online course based on CUDA, or buy this book by Tim Mattson et al.", "OpenCL is more flexible than CUDA to allow programs to be executed on different architectures. This comes with a price: it is necessary to write some \u201cboilerplate\u201d code to define a context (i.e. what kind of hardware is available), a queue (i.e. a sequence of commands) and a set of memory flags (e.g. READ_ONLY, WRITE_ONLY, etc.). The typical workflow is as follows:", "NB: OpenCL kernels can be executed on both CPUs and GPUs, but if the code is highly optimized for a certain GPU architecture (e.g. with large memory) it may not be completely portable.", "Though GPUs are generally faster, the time taken to transfer huge amounts of data from CPU to GPU can lead to higher overhead time depending on the architecture of the processors.", "Here\u2019s an example of a fully-functional OpenCL program that calculates the sum of two matrices:", "Keras is one of the most popular deep learning frameworks. It\u2019s very easy to define the architecture of a network using Keras\u2019 functional APIs, run the training and execute inference. However, Keras does not perform the actual calculations by itself, but rather deploys other software libraries to define, optimize, and evaluate mathematical expressions involving multi-dimensional arrays. The most common ones are Theano and TensorFlow. In turn, these libraries execute parallel calculations on GPUs using CUDA. As previously states, this comes with the very strong hardware limitation that it works only on NVIDIA cards.", "This problem can be partially evaded by using instead the PlaidML library:", "Following installation, execute the setup script (select default unless you know what you\u2019re doing):", "You should see something like this:", "This library supports many but not all Keras layers. If your architecture involves only Dense, LSTM, CNN and Dropout layers, you\u2019re certainly good, otherwise check the documentation.", "In principle, all you have to do is to pre-pend the following lines of code to your program to activate the PlaidML backend:", "During the execution, you should see some printouts like these:", "This is an example, adapted from from Keras\u2019 official documentation, that should work out-of-the-box:", "Note that the instruction from keras import backend as K would return an error if there is no available backend. For example, if you did not install TensorFlow (default), you would see:", "On a final note, TensorFlow >=2.0 includes Keras API. If your program is written so that layers are defined from TF, and not Keras, you cannot just change the Keras backend to run on the GPU with OpenCL support, because TF2 does not support OpenCL. To be more specific:", "This will not use the GPU (assuming you have installed TensorFlow >=2.0)", "This will work just fine (assuming you have installed Keras)", "It turns out that PlaidML can do much more than just being a Keras backend. In fact, it comes with a programming language called Tile to help users writing optimized kernels without requiring an in-depth knowledge of C and most of the quirks of OpenCL. Tile instructions look more like mathematical functions. For example, a matrix multiplication", "where the \u201c+\u201d operator stands for the \u201csum\u201d in the mathematical expression.", "Many more examples can be found in the documentation, including some of the most common operations such as matrix multiplication, min/max, max pool, convolution, cumulative sum. When the kernel is synthesized, Tile flattens the tensors and transforms indices into pointer offsets. The calculation is split into tiles that fit into memory, with a size that is optimized based on the available hardware. The tiles are then laid out in the GPU memory to optimize SIMDs instructions such as multiplications and accumulations. Finally, the kernels are written out as if they were created by a human user, and passed on to OpenCL for the actual execution.", "PlaidML is now part of Intel\u2019s AI group Vertex.ai. It may finally make AMD cards (possibly more vendors to come) a viable option in ML. In fact, Intel is also set to enter the GPU market in 2020 with hardware designed for ML in data centres which could further reduce the price of computation through competition. Intel CEO Bob Swan said that \u201c in 2020, we\u2019ll continue to expand our 10-nanometer portfolio with exciting new products including an AI Inference Accelerator, 5G base station SOC, Xeon CPUs for server storage, and network and a discrete GPU. This quarter, we\u2019ve achieved power-on exit for our first discrete GPU, DG1, an important milestone.\u201d. So stay tuned!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "NLP Machine Learning engineer at Ceridian. Formerly physicist at U Toronto, Bologna, CERN LHC/ATLAS."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F48d53ef1b545&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://riccardo-disipio.medium.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": ""}, {"url": "https://riccardo-disipio.medium.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Riccardo Di Sipio"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4267d9884285&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&user=Riccardo+Di+Sipio&userId=4267d9884285&source=post_page-4267d9884285----48d53ef1b545---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.open-mpi.org/", "anchor_text": "OpenMPI"}, {"url": "https://developer.nvidia.com/curand", "anchor_text": "here"}, {"url": "https://www.khronos.org/opencl/", "anchor_text": "OpenCL"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://developer.nvidia.com/cuda-zone", "anchor_text": "NVIDIA CUDA"}, {"url": "https://support.apple.com/en-us/HT208544", "anchor_text": "this guide"}, {"url": "https://docs.nvidia.com/cuda/cuda-installation-guide-mac-os-x/index.html", "anchor_text": "official documentation"}, {"url": "https://www.nvidia.com/download/driverResults.aspx/147830/", "anchor_text": "here"}, {"url": "https://documen.tician.de/pyopencl/", "anchor_text": "PyOpenCL"}, {"url": "https://documen.tician.de/pycuda/", "anchor_text": "PyCUDA"}, {"url": "https://www.mooc-list.com/course/intro-parallel-programming-udacity", "anchor_text": "this online course"}, {"url": "https://www.amazon.ca/OpenCL-Programming-Guide-Aaftab-Munshi/dp/0321749642", "anchor_text": "this book"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "functional APIs"}, {"url": "https://github.com/Theano/Theano", "anchor_text": "Theano"}, {"url": "https://www.tensorflow.org/", "anchor_text": "TensorFlow"}, {"url": "https://vertexai-plaidml.readthedocs-hosted.com/en/latest/index.html", "anchor_text": "PlaidML"}, {"url": "https://github.com/keras-team/keras/blob/master/examples/mnist_cnn.py", "anchor_text": "official documentation"}, {"url": "https://www.intel.ai/automatic-kernel-generation-in-plaidml/#gs.lecnpy", "anchor_text": "Tile"}, {"url": "https://vertexai-plaidml.readthedocs-hosted.com/en/latest/writing_tile_code.html", "anchor_text": "documentation"}, {"url": "https://www.intel.ai/plaidml/", "anchor_text": "Vertex.ai"}, {"url": "https://www.forbes.com/sites/marcochiappetta/2019/10/26/intel-xe-dg1-discrete-gpu-silicon-is-alive-and-being-validated-in-intels-labs/#1caee6ba645f", "anchor_text": "Bob Swan said"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&user=Riccardo+Di+Sipio&userId=4267d9884285&source=-----48d53ef1b545---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&user=Riccardo+Di+Sipio&userId=4267d9884285&source=-----48d53ef1b545---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F48d53ef1b545&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----48d53ef1b545---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----48d53ef1b545--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----48d53ef1b545--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----48d53ef1b545--------------------------------", "anchor_text": ""}, {"url": "https://riccardo-disipio.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://riccardo-disipio.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Riccardo Di Sipio"}, {"url": "https://riccardo-disipio.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "554 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4267d9884285&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&user=Riccardo+Di+Sipio&userId=4267d9884285&source=post_page-4267d9884285--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb32833879b5a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-accelerated-machine-learning-on-macos-48d53ef1b545&newsletterV3=4267d9884285&newsletterV3Id=b32833879b5a&user=Riccardo+Di+Sipio&userId=4267d9884285&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}