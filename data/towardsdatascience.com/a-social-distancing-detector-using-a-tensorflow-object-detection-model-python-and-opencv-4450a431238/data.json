{"url": "https://towardsdatascience.com/a-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238", "time": 1683009397.923546, "path": "towardsdatascience.com/a-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238/", "webpage": {"metadata": {"title": "A social distancing detector using a Tensorflow object detection model, Python and OpenCV. | by Basile Roth | Towards Data Science", "h1": "A social distancing detector using a Tensorflow object detection model, Python and OpenCV.", "description": "During the quarantine I was spending time on github exploring Tensorflow\u2019s huge number of pre-trained models. While doing this, I stumbled on a repository containing 25 pre-trained object detection\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md", "anchor_text": "repository", "paragraph_index": 0}, {"url": "https://github.com/basileroth75/covid-social-distancing-detection", "anchor_text": "github repository", "paragraph_index": 4}, {"url": "http://cocodataset.org/#explore", "anchor_text": "dataset", "paragraph_index": 5}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/data/mscoco_complete_label_map.pbtxt", "anchor_text": "repo", "paragraph_index": 5}, {"url": "http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_v2_coco_2018_01_28.tar.gz", "anchor_text": "faster_rcnn_inception_v2_coco", "paragraph_index": 6}, {"url": "https://danijar.com/what-is-a-tensorflow-session/", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://www.pyimagesearch.com/2014/08/25/4-point-opencv-getperspective-transform-example/", "anchor_text": "tutorial", "paragraph_index": 13}, {"url": "https://github.com/basileroth75/covid-social-distancing-detection", "anchor_text": "repository", "paragraph_index": 14}, {"url": "https://stackoverflow.com/questions/104420/how-to-generate-all-permutations-of-a-list", "anchor_text": "this", "paragraph_index": 19}, {"url": "http://www.cvg.reading.ac.uk/PETS2009/a.html#s0", "anchor_text": "PETS2009", "paragraph_index": 22}, {"url": "https://www.linkedin.com/in/basileroth/", "anchor_text": "https://www.linkedin.com/in/basileroth/", "paragraph_index": 28}], "all_paragraphs": ["During the quarantine I was spending time on github exploring Tensorflow\u2019s huge number of pre-trained models. While doing this, I stumbled on a repository containing 25 pre-trained object detection models with performance and speed indicators. Having some knowledge in computer vision and given the actual context, I thought it could be interesting to use one of these to build a social distancing application.", "More so, last semester I was introduced to OpenCV during my Computer Vision class and realized how powerful it was while doing a number of small projects. One of these included performing a bird eye view transformation of a picture. A bird eye view is a basically a top-down representation of a scene. It is a task often performed when building applications for automatic car driving.", "This made me realize that applying such technique on a scene where we want to monitor social distancing could improve the quality of it. This article presents how I used a deep learning model along with some knowledge in computer vision to build a robust social distancing detector.", "This article is going to be structured as follow :", "All of the following code along with installation explanations can be found on my github repository.", "All the models available on the Tensorflow object detection model zoo have been trained on the COCO dataset (Common Objects in COntext). This dataset contains 120,000 images with a total 880,000 labeled objects in these images. These models are trained to detect the 90 different types of objects labeled in this dataset. A complete list of all this different objects is available in the data part of the repository accessible on the data section of the github repo. This list of objects includes a car, a toothbrush, a banana and of course a person.", "They have different performances depending on the speed of the model. I made a few tests in order to determine how to leverage the quality of the model depending on the speed of the predictions. Since the goal of this application was not to be able to perform real time analysis, I ended up choosing the faster_rcnn_inception_v2_coco which has a mAP (detector performance on a validation set) of 28, which is quite strong, and an execution speed of 58 ms.", "To use such model, in order to detect persons, there are a few steps that have to be done:", "The way tensorflow models have been designed to work is by using graphs. The first step implies loading the model into a tensorflow graph. This graph will contain the different operations that will be done in order to get the desired detections. The next step is creating a session which is an entity responsible of executing the operations defined in the previous graph. More explanations on graphs and sessions are available here. I have decided to implement a class to keep all the data related to the tensorflow graph together.", "A new session is started for every frame that needs processing. This is done by calling the run() function. Some parameters have to be specified when doing so. These include the type of input that the model requires and which outputs we want to get back from it. In our case the outputs needed are the following:", "One of the many classes detected by the model is a person. The class associated to a person is 1.", "In order to exclude both weak predictions (threshold : 0.75) and all other classes of objects except from person, I used an if statement combining both conditions to exclude any other object from further computation.", "But since these models are already pre-trained, it is not possible for them to only detect this class. Therefore these models take quite a long time to run because they try to identify all the 90 different type of objects in the scene.", "As explained in the introduction, performing a bird eye view transformation gives us a top view of a scene. Thankfully, OpenCV has great built-in functions to apply this method to an image in order to transform an image taken from a perspective point of view to a top view of this image. I used a tutorial from the great Adrian Rosebrock to understand how to do this.", "The first step involves selecting 4 points on the original image that are going to be the corner points of the plan which is going to be transformed. This points have to form a rectangle with at least 2 opposite sides being parallel. If this is not done, the proportions will not be the same when the transformation happens. I have implemented a script available in my repository which uses the setMouseCallback() function of OpenCV to get these coordinates. The function that computes the transformation matrix also requires the dimension of the image which are computed using the image.shape propriety of an image.", "This returns the width, the height and other non relevant color pixel values. Let\u2019s see the how they are used to compute the transformation matrix :", "Note that I chose to also return the matrix because it will be used in the next step to compute the new coordinates of each person detected. The result of this are the \u201cGPS\u201d coordinates of each person in the frame. It is far more accurate to use these than use the original ground points, because in a perspective view, the distance are not the same when people are in different plans, not at the same distance from the camera. Compared to using the points in the original frame, this could improve the social distancing measurement a lot.", "For each person detected, the 2 points that are needed to build a bounding box a returned. The points are the top left corner of the box and the bottom right corner. From these, I computed the centroid of the box by getting the middle point between them. Using this result, I calculated the coordinates of the point located at the bottom center of the box. In my opinion, this point, which I refer to as the ground point, is the best representation of the coordinate of a person in an image.", "Then I used the transformation matrix to compute the transformed coordinates for each ground point detected. This is done on each frame, using the cv2.perspectiveTransform(), after having detected the person in it. This is how I implemented this task :", "After calling this function on each frame, a list containing all the new transformed points is returned. From this list I had to compute the distance between each pair of points. I used the function combinations() from the itertools library which allows to get every possible combination in a list without keeping doubles. This is very well explained on this stack overflow issue. The rest is simple math : the distance between two points is easy to do in python using the math.sqrt() function. The threshold chosen was 120 pixels, because it is approximatively equal to 2 feet in our scene.", "Once 2 points are identified being too close from one another, the color of the circle marking the point is changed from green to red and same for the bounding box on the original frame.", "Let me resume how this project works :", "I used a video from the PETS2009 dataset which consists of multisensor sequences containing different crowd activities. It was originally build for tasks like person counting and density estimation in crowds. I decided to use video from the the 1st angle because it was the widest one, with the best view of the scene. This video presents the results obtained :", "Nowadays, social distancing along with other basic sanitary mesures are very important to keep the spread of the Covid-19 as slow as possible. But this project is only a proof of concept and was not made to be use to monitor social distancing in public or private areas because of ethical and privacy issues.", "I am well aware that this project is not perfect so these are a few ideas how this application be improved :", "This article is my first contribution to Towards Data Science and Medium. I have made the code available on my Github. Please do not hesitate to ask if you have a question regarding the code itself or this article. If you have ideas for possible improvements or any kind of feedback, feel free to contact me, it will be greatly appreciated. I hope you find this helpful and feel free to share it if you like it.", "While implementing this project, I found a lot of online articles that help me get through the difficulties I had :", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Master\u2019s student in Montreal. My research areas include: Machine Learning, Computer Vision and NLP. https://www.linkedin.com/in/basileroth/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4450a431238&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4450a431238--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4450a431238--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@basileroth.75?source=post_page-----4450a431238--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@basileroth.75?source=post_page-----4450a431238--------------------------------", "anchor_text": "Basile Roth"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3696c89b1d34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&user=Basile+Roth&userId=3696c89b1d34&source=post_page-3696c89b1d34----4450a431238---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md", "anchor_text": "repository"}, {"url": "https://www.researchgate.net/publication/224117777_Low-cost_implementation_of_bird%27s-eye_view_system_for_camera-on-vehicle", "anchor_text": "Implementation of bird\u2019s eye view system for camera on vehicle"}, {"url": "https://github.com/basileroth75/covid-social-distancing-detection", "anchor_text": "github repository"}, {"url": "http://cocodataset.org/#explore", "anchor_text": "dataset"}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/data/mscoco_complete_label_map.pbtxt", "anchor_text": "repo"}, {"url": "http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_v2_coco_2018_01_28.tar.gz", "anchor_text": "faster_rcnn_inception_v2_coco"}, {"url": "https://danijar.com/what-is-a-tensorflow-session/", "anchor_text": "here"}, {"url": "https://www.pyimagesearch.com/2014/08/25/4-point-opencv-getperspective-transform-example/", "anchor_text": "tutorial"}, {"url": "https://github.com/basileroth75/covid-social-distancing-detection", "anchor_text": "repository"}, {"url": "https://stackoverflow.com/questions/104420/how-to-generate-all-permutations-of-a-list", "anchor_text": "this"}, {"url": "http://www.cvg.reading.ac.uk/PETS2009/a.html#s0", "anchor_text": "PETS2009"}, {"url": "https://towardsdatascience.com/analyse-a-soccer-game-using-tensorflow-object-detection-and-opencv-e321c230e8f2", "anchor_text": "Analyze a Soccer game using Tensorflow Object Detection and OpenCVDoing cool things with data!towardsdatascience.com"}, {"url": "https://www.pyimagesearch.com/2014/08/25/4-point-opencv-getperspective-transform-example/", "anchor_text": "4 Point OpenCV getPerspective Transform Example \u2014 PyImageSearch4:18am. Alarm blaring. Still dark outside. The bed is warm. And the floor will feel so cold on my bare feet. But I got\u2026www.pyimagesearch.com"}, {"url": "https://developer.ridgerun.com/wiki/index.php?title=Birds_Eye_View/Introduction/Research", "anchor_text": "RidgeRun\u2019s Birds Eye View project researchIn general, camera-on-vehicle has serious perspective effect as Fig. 1(a). Because of the perspective effect, the\u2026developer.ridgerun.com"}, {"url": "http://www.cvg.reading.ac.uk/PETS2009/a.html#s0", "anchor_text": "PETS 2009The datasets are multisensor sequences containing different crowd activities. Please e-mail datasets@pets2009.net if\u2026www.cvg.reading.ac.uk"}, {"url": "https://medium.com/tag/socialdistancing?source=post_page-----4450a431238---------------socialdistancing-----------------", "anchor_text": "Socialdistancing"}, {"url": "https://medium.com/tag/ai?source=post_page-----4450a431238---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----4450a431238---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/opencv?source=post_page-----4450a431238---------------opencv-----------------", "anchor_text": "Opencv"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----4450a431238---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&user=Basile+Roth&userId=3696c89b1d34&source=-----4450a431238---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&user=Basile+Roth&userId=3696c89b1d34&source=-----4450a431238---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4450a431238--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4450a431238&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4450a431238---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4450a431238--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4450a431238--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4450a431238--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4450a431238--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4450a431238--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4450a431238--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4450a431238--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4450a431238--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@basileroth.75?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@basileroth.75?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Basile Roth"}, {"url": "https://medium.com/@basileroth.75/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "67 Followers"}, {"url": "https://www.linkedin.com/in/basileroth/", "anchor_text": "https://www.linkedin.com/in/basileroth/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3696c89b1d34&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&user=Basile+Roth&userId=3696c89b1d34&source=post_page-3696c89b1d34--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Feb75db6f6ef7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-social-distancing-detector-using-a-tensorflow-object-detection-model-python-and-opencv-4450a431238&newsletterV3=3696c89b1d34&newsletterV3Id=eb75db6f6ef7&user=Basile+Roth&userId=3696c89b1d34&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}