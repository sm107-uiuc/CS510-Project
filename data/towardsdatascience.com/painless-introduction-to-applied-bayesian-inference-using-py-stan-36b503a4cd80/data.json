{"url": "https://towardsdatascience.com/painless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80", "time": 1683003091.77952, "path": "towardsdatascience.com/painless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80/", "webpage": {"metadata": {"title": "Mostly Painless Introduction to Applied Bayesian Inference using (Py)Stan | by Sergio E. Betancourt | Towards Data Science", "h1": "Mostly Painless Introduction to Applied Bayesian Inference using (Py)Stan", "description": "Let's construct a Bayesian linear regression model using the computation engine Stan in order to explain and predict miles-per-gallon (MPG) in a datasaet of automobiles of different specs and makes. Although my approach is a \"classical\" likelihood-based we shall assess the its predictive abilities using a train-test split."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/conceptual-background-for-painless-introduction-to-applied-bayesian-regression-using-pystan-c8f744e3823f", "anchor_text": "Conceptual Background", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/conceptual-background-for-painless-introduction-to-applied-bayesian-regression-using-pystan-c8f744e3823f", "anchor_text": "Conceptual Background", "paragraph_index": 3}, {"url": "https://archive.ics.uci.edu/ml/datasets/auto+mpg", "anchor_text": "UCI ML Repository", "paragraph_index": 11}, {"url": "https://www.cs.jhu.edu/~jason/tutorials/variational.html", "anchor_text": "Here", "paragraph_index": 37}, {"url": "https://arxiv.org/abs/1601.00670", "anchor_text": "here", "paragraph_index": 37}], "all_paragraphs": ["You are encouraged to check out this Conceptual Background before engaging with this article.", "Stan [1] is a computation engine for Bayesian inference and model fitting. It relies on variants of Hamiltonian Monte Carlo (HMC) [2] to sample from the posterior distribution of a large variety of distributions and models.", "Once this set-up is complete we can go ahead and open a (Jupyter) notebook and start our work. First, let\u2019s import our libraries with the following:", "Recall how in the Conceptual Background I spoke about finding a coin on the ground and tossing it K times to gain a sense of its fairness.", "We settled for the below model:", "with the below probability mass function (PMF) for Y:", "First, we can appreciate the behavior of our prior with parameters a=b=5 through simulation using NumPy\u2019s random capabilities:", "As mentioned in the Conceptual Background, this prior seems reasonable: It is symmetrical around 0.5, yet entertains the possibility of bias in either direction. We can then proceed to define our model in pystan with the below syntax:", "Note that the default parameters for model.sampling are iter=1000, chains=4, and warmup=500. We adjust these depending on our time and computing resources available.", "Below is the output of the above model:", "Let\u2019s construct a Bayesian linear regression model to explain and predict miles-per-gallon (MPG) in a dataset of automobiles of different specs and makes. Although my approach is a \u201cclassical\u201d likelihood-based, or rather, distribution-focused one, we can (and should!) assess the quality of our predictions using the primordial ML train-test split.", "This dataset comes from the UCI ML Repository and contains the following information:", "Why don\u2019t we stick to our basics and use standard Linear Regression? [3] Recall its functional form below:", "Although the first two lines look exactly the same, we are now required to establish prior distributions for \u03b1, \u03b2, and \u03c3.", "A few things that we should always think about as we perform our EDA:", "As with any sort of data analysis, it is crucial to first gain a sense at the variables / features in which we are interested and how they may be related to each other and to our y / outcomes.", "Let\u2019s start by loading the dataset:", "Let\u2019s check the relationships (if any) between our target variable and our predictors. Here origin indicates a car\u2019s region of origin \u2014 it has three levels: \u201cAmerican,\u201d \u201cJapanese,\u201d and \u201cEuropean.\u201d", "Now let\u2019s examine the relationship between our numeric variables and mpg:", "Let\u2019s prepare the dataset for fitting and testing:", "Now, on to our model specification, which does not deviate substantially from the coin toss problem above, except for the fact that I am using matrix notation to simplify the model expression as much as possible:", "The above priors were chosen after the initial data examination:", "What is interesting about stan is that we can request predictions be made on the test set without re-fitting \u2014 rather, they can be requested in the first call.", "We specify our dataset for ingestion and proceed to sample from our model, while saving it for future reference:", "Here is the output I printed (I got rid of Rhat and n_efffor the purposes of this tutorial):", "fit.stansummary() is a string arranged like a table that gives me the posterior mean, standard deviation, and several percentiles for each parameter estimated during fitting. While alpha corresponds to the intercept, we have 8 beta regressors, a complexity or observation error sigma, our fitted values on the training set theta, and our predicted values on the test set y_new .", "Running MCMC under the hood, it is crucial that we examine basic diagnostics in the form of plots. For these plots I rely on the excellent arviz library for Bayesian visualization (works equally well with PyMC3).", "Bayesian inference has prediction capabilities, and we can produce them by sampling from the Predictive Posterior distribution:", "What is great about these (and the entirety of the Bayesian framework) is that we have access to (predictive) credible intervals to give us a sense of the variance / volatility of our estimates. After all, what good is a prediction model if its predictions are \u201cclose enough\u201d to the target 1 out of 50 times?", "Let\u2019s see how our predicted values compare to the observed values in the test set:", "We can then subject these predictions to an ML standard metric (MSE) to assess their quality with regards to the actual values in the held-out test set.", "We can also visualize the value of our predictions (as well as their corresponding 95% credibility intervals) as we vary some model inputs:", "In the below, I compare the performance of my Bayesian model to that of a vanilla Maximum Likelihood linear regression model using statsmodels:", "Best practice: To gain a \u201cbetter\u201d idea of model performance, you should bootstrap a 95% confidence interval (CLT) on the Test MSE by running your implementation for K \u2265 30 train-test splits.", "Here\u2019s the whole notebook in .py export format:", "I encourage you to think critically of ways to improve this prediction, not only from a Bayesian point of view, but also from an ML point of view.", "Is the dataset large or rich enough to benefit from a strict ML approach? What are some ways to improve this Bayesian model? Under which circumstances would this model definitely outperform an MLE model? What if the observations are dependent in some way (clustered, autocorrelated, spatially correlated, etc)? What to do when explainability is a modeling priority (regulatory concerns)?", "If you wonder about ways to scale Bayesian methodology to Deep Learning, you can also look into Variational Inference [6] methods as a scalable alternative to a pure Bayesian treatment. Here is a \u201csimple\u201d overview, and here is a technical review.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science at Moz. MSc Statistical Sciences, University of Toronto (Canada)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F36b503a4cd80&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@sergiosonline?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiosonline?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Sergio E. Betancourt"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F951ed7d07b1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&user=Sergio+E.+Betancourt&userId=951ed7d07b1c&source=post_page-951ed7d07b1c----36b503a4cd80---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/conceptual-background-for-painless-introduction-to-applied-bayesian-regression-using-pystan-c8f744e3823f", "anchor_text": "Conceptual Background"}, {"url": "https://pystan.readthedocs.io/en/latest/installation_beginner.html", "anchor_text": "https://pystan.readthedocs.io/en/latest/installation_beginner.html"}, {"url": "https://towardsdatascience.com/conceptual-background-for-painless-introduction-to-applied-bayesian-regression-using-pystan-c8f744e3823f", "anchor_text": "Conceptual Background"}, {"url": "https://pixabay.com/users/Picsues-1416498/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=980992", "anchor_text": "Susan Sewert"}, {"url": "https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=980992", "anchor_text": "Pixabay"}, {"url": "https://archive.ics.uci.edu/ml/datasets/auto+mpg", "anchor_text": "UCI ML Repository"}, {"url": "https://raw.githubusercontent.com/sergiosonline/sergiosonline.github.io/master/files/cars.csv", "anchor_text": "~/cars.csv"}, {"url": "https://gist.github.com/sergiosonline/6a3e0b1345c8f002d0e7b11aaf252d44", "anchor_text": "https://gist.github.com/sergiosonline/6a3e0b1345c8f002d0e7b11aaf252d44"}, {"url": "https://www.cs.jhu.edu/~jason/tutorials/variational.html", "anchor_text": "Here"}, {"url": "https://arxiv.org/abs/1601.00670", "anchor_text": "here"}, {"url": "https://medium.com/tag/bayesian?source=post_page-----36b503a4cd80---------------bayesian-----------------", "anchor_text": "Bayesian"}, {"url": "https://medium.com/tag/data-science?source=post_page-----36b503a4cd80---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/statistics?source=post_page-----36b503a4cd80---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/ba-ba-bayesian?source=post_page-----36b503a4cd80---------------ba_ba_bayesian-----------------", "anchor_text": "Ba Ba Bayesian"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----36b503a4cd80---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&user=Sergio+E.+Betancourt&userId=951ed7d07b1c&source=-----36b503a4cd80---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&user=Sergio+E.+Betancourt&userId=951ed7d07b1c&source=-----36b503a4cd80---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F36b503a4cd80&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----36b503a4cd80---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----36b503a4cd80--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----36b503a4cd80--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----36b503a4cd80--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiosonline?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiosonline?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sergio E. Betancourt"}, {"url": "https://medium.com/@sergiosonline/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "39 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F951ed7d07b1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&user=Sergio+E.+Betancourt&userId=951ed7d07b1c&source=post_page-951ed7d07b1c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F951ed7d07b1c%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpainless-introduction-to-applied-bayesian-inference-using-py-stan-36b503a4cd80&user=Sergio+E.+Betancourt&userId=951ed7d07b1c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}