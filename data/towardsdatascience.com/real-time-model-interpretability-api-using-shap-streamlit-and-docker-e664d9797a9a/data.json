{"url": "https://towardsdatascience.com/real-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a", "time": 1683015495.9825861, "path": "towardsdatascience.com/real-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a/", "webpage": {"metadata": {"title": "Real-time Model Interpretability API using SHAP, Streamlit and Docker | by Sundar Krishnan | Towards Data Science", "h1": "Real-time Model Interpretability API using SHAP, Streamlit and Docker", "description": "As a data scientist, you take a business problem and formulate it into a data science problem. Next, you build a solution/model to address the problem. You validate the model with test and out of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/Sundar0989/model-interpretability/blob/main/bank-full.csv", "anchor_text": "bank dataset", "paragraph_index": 5}, {"url": "https://github.com/Sundar0989/model-interpretability/blob/main/Trial_API.ipynb", "anchor_text": "jupyter notebook", "paragraph_index": 5}, {"url": "https://www.postman.com/downloads/", "anchor_text": "Postman API", "paragraph_index": 13}, {"url": "http://localhost:8501/", "anchor_text": "http://localhost:8501/", "paragraph_index": 33}], "all_paragraphs": ["As a data scientist, you take a business problem and formulate it into a data science problem. Next, you build a solution/model to address the problem. You validate the model with test and out of time data to ensure it is not biased. Finally, you deploy the model in production, monitor the performance of model, conduct experimentations and so on. In addition to these tasks, you present your findings to business stakeholders and sometimes work with them to educate and effectively use your model. Is your job done? Not yet.", "The end users of your model might ponder and come up with questions like this\u2014 \u201cWhy did your model predict this customer as so and so?\u201d or \u201cCould you explain why we get this output from your model?\u201d. Even though you have a proper documentation (assuming you did it), it cannot explain your model predictions on a case by case basis. Consider a scenario where you built a model to classify cats/dogs. Your documentation looks like this.", "When an end user asks you \u201cWhy did your model predict this image as a cat?\u201d", "The documentation provided above cannot answer these type of questions. When you have a linear model, you can use the parameter estimates to interpret the results. However, as the model starts getting complex (Black box models like neural network), it gets harder to interpret the results. It becomes an irony in that situation where you need a black box model to get better results but it becomes harder to explain the results. In addition, when you are asked to explain a model that you developed in the past, it takes certain time before you get to the answer. This fundamental drawback is addressed by SHAP (SHapley Additive exPlanations).", "The entire code is available in the GitHub repository.", "For this exercise, I used the bank dataset to build a binary classification model. The jupyter notebook will walk you through the steps to create the objects for the pickle file. In this exercise, we store 4 objects in the pickle file.", "Once you have the pickle file ready, you can proceed with the API creation.", "Step1: Dockerize your model to perform real-time scoring", "This file contains the helper functions to perform the scoring. When you get the raw data, it needs to be processed and make it ready for scoring. This is achieved by the transform_categorical function. Once, the data is processed, we can score the data using the score_record function. This function returns the probability and prediction which will be later shown in the Front end API.", "This flask app is used to read your model objects and produce the scores. First, we read the pickle file created before (score_objects.pkl) and load the model objects. Second, we get the data from the Streamlit front end API in json format. Third, we use the helper functions to perform preprocessing and produce the scores. Finally, we sent back the scores to Streamlit front end API.", "This file has the list of required packages to perform the operations mentioned above.", "This file is used to create a docker for your model and containerize the entire application. As you can seem, it takes a base image (python:3.7-stretch) and creates a work directory inside the image (/deploy/). We copy the files mentioned before (app.py, requirements.txt, helper.py and score_objects.pkl) to the work directory. It installs the packages in the requirements.txt file inside the image (Line 7) and exposes the port 5000 to outside wold. When flask is executed (Line 9) it will use this port to communicate with the outside applications. If you need to use a different port, then configure the port in the app.py file.", "All these files reside in a directory called pythonapi.", "Note: Before you create the docker container, you can test your application by running the app.py file separately. This will avoid unnecessary errors and helps in code debugging. I would recommend using Postman API for this task.", "You need to make sure to follow the steps to setup the Postman API.", "Launch your Terminal/Command prompt to execute the app.py file with the command shown below.", "After the application is launched, use the example below to verify that the application is running correctly without any errors.", "You should get an output that looks like below.", "After you are done with debugging, you can move to the next step to create the front end Streamlit API.", "Step 2: Create a front-end API using Streamlit", "The Streamlit front-end API sits in its own docker container. This way the front-end application is independent of the model docker and can be altered at any time. This is a good industry practice. The directory structure for streamlit looks like below.", "This file contains the codes for creating the Streamlit application. The best part of using Streamlit is you can interactively build the front end as you work and it requires minimal code. You need to make sure that the Python API endpoint points to pythonapi directory that is created before. If you used a different directory name, you need to change it to make it work.", "To debug this application, you can use the code below.", "The final front end API looks like above. In this API, you can provide the input data in the left sidebar and then get the real time prediction and explanations in the main page.", "We also have the score_objects.pkl file in this directory as well to access the SHAP explainer object.", "Now, we are ready to incorporate the shapley explanatory values in the API.", "Step 3: Use SHAP to interpret the model predictions", "The code for SHAP is already included in the webapp.py. The code below is the snippets taken from the webapp.py.", "The explain_model_prediction function produces the shap values which are necessary for interpretation of results. The st_shap function takes the graph generated by force_plot object (p) and makes it compatible with Streamlit API. Finally, we have added the summary plots for each predictions.", "Now, we are ready with individual components, let us combine them together to make our application work. We will use docker-compose to perform this task. The code is provided below.", "This is the structure of the entire directory to make this thing work.", "Navigate to the Terminal/Command prompt and execute the following commands.", "It will build the complete image and setup the necessary connection between the model and streamlit docker. Once the step is complete, you can execute the code below to run the application.", "You will see the application live in the URL \u2014 http://localhost:8501/. To run the application, provide some inputs for each feature and click on the \u201cGet predictions\u201d button. You should get an output like below.", "Along with the prediction and probability, you get a nice interpretable plot that explains why the model made that prediction. Once you are done using the API, you can shutdown using the code below.", "That\u2019s it. You now have a real time model scoring and interpretation application with a nice front end. You can add/modify/remove plots as it serves your purpose/application.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am passionate about Artificial Intelligence and Data Science. I focus on 360 degree customer analytics models and machine learning workflow automation."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe664d9797a9a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sundarstyles89.medium.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": ""}, {"url": "https://sundarstyles89.medium.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Sundar Krishnan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb61b6673cdce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&user=Sundar+Krishnan&userId=b61b6673cdce&source=post_page-b61b6673cdce----e664d9797a9a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/photos/house-painter-balloon-why-question-3062248/", "anchor_text": "Pixabay"}, {"url": "https://pixabay.com/photos/tree-cat-silhouette-moon-full-moon-736877/", "anchor_text": "Pixabay"}, {"url": "https://github.com/Sundar0989/model-interpretability", "anchor_text": "Sundar0989/model-interpretabilityYou can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or\u2026github.com"}, {"url": "https://github.com/Sundar0989/model-interpretability/blob/main/bank-full.csv", "anchor_text": "bank dataset"}, {"url": "https://github.com/Sundar0989/model-interpretability/blob/main/Trial_API.ipynb", "anchor_text": "jupyter notebook"}, {"url": "https://www.postman.com/downloads/", "anchor_text": "Postman API"}, {"url": "http://localhost:8501/", "anchor_text": "http://localhost:8501/"}, {"url": "https://medium.com/tag/streamlit?source=post_page-----e664d9797a9a---------------streamlit-----------------", "anchor_text": "Streamlit"}, {"url": "https://medium.com/tag/shap?source=post_page-----e664d9797a9a---------------shap-----------------", "anchor_text": "Shap"}, {"url": "https://medium.com/tag/docker-compose?source=post_page-----e664d9797a9a---------------docker_compose-----------------", "anchor_text": "Docker Compose"}, {"url": "https://medium.com/tag/model-interpretability?source=post_page-----e664d9797a9a---------------model_interpretability-----------------", "anchor_text": "Model Interpretability"}, {"url": "https://medium.com/tag/realtime?source=post_page-----e664d9797a9a---------------realtime-----------------", "anchor_text": "Realtime"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&user=Sundar+Krishnan&userId=b61b6673cdce&source=-----e664d9797a9a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&user=Sundar+Krishnan&userId=b61b6673cdce&source=-----e664d9797a9a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe664d9797a9a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e664d9797a9a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e664d9797a9a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e664d9797a9a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e664d9797a9a--------------------------------", "anchor_text": ""}, {"url": "https://sundarstyles89.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sundarstyles89.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sundar Krishnan"}, {"url": "https://sundarstyles89.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.1K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb61b6673cdce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&user=Sundar+Krishnan&userId=b61b6673cdce&source=post_page-b61b6673cdce--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4d95f24c1f40&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-model-interpretability-api-using-shap-streamlit-and-docker-e664d9797a9a&newsletterV3=b61b6673cdce&newsletterV3Id=4d95f24c1f40&user=Sundar+Krishnan&userId=b61b6673cdce&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}