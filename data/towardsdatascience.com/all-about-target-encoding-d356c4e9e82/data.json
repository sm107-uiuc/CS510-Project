{"url": "https://towardsdatascience.com/all-about-target-encoding-d356c4e9e82", "time": 1683010427.611566, "path": "towardsdatascience.com/all-about-target-encoding-d356c4e9e82/", "webpage": {"metadata": {"title": "All About Target Encoding For Classification Tasks | by Nishant Mohan | Towards Data Science", "h1": "All About Target Encoding For Classification Tasks", "description": "Recently I did a project wherein the target was multi-class. I realized TargetEncoder class of category_encoders library does not help you encode multi-class target."}, "outgoing_paragraph_urls": [{"url": "http://contrib.scikit-learn.org/category_encoders/index.html", "anchor_text": "category_encoders", "paragraph_index": 2}, {"url": "http://contrib.scikit-learn.org/category_encoders/_modules/category_encoders/target_encoder.html#TargetEncoder", "anchor_text": "source code", "paragraph_index": 2}, {"url": "https://dl.acm.org/doi/10.1145/507533.507538", "anchor_text": "original paper", "paragraph_index": 4}, {"url": "https://medium.com/@mohannishant6/target-encoding-for-multi-class-classification-c9a7bcb1a53", "anchor_text": "here", "paragraph_index": 27}, {"url": "https://github.com/mohannishant6", "anchor_text": "GitHub", "paragraph_index": 28}], "all_paragraphs": ["Recently I did a project wherein the target was multi-class. It was a simple prediction task and the dataset involved both categorical as well as numerical features.", "For those of you who are wondering what multi-class classification is: If you want to answer in \u20180 vs 1\u2019, \u2018clicked vs not-clicked\u2019 or \u2018cat vs dog\u2019, your classification problem is binary; if you want to answer in \u2018red vs green vs blue vs yellow\u2019 or \u2018sedan vs hatch vs SUV\u2019, then the problem is multi-class.", "Therefore, I was researching suitable ways to encode the categorical features. No points for guessing, I was taken to medium articles enumerating benefits of mean target encoding and how it outperforms other methods and how you can use category_encoders library to do the task in just 2 lines of code. However, to my surprise, I found that no article demonstrated this on multi-class target. I went to the documentation of category_encoders and found that it does not say anything about supporting multi-class targets. I dug deeper, scouring through the source code and realized that the library only works for binary or continuous targets.", "So I thought: \u201cInside of every problem lies an opportunity.\u201d \u2014 Robert Kiposaki", "Going deep, I went straight for the original paper by Daniele Micci-Barreca that introduced mean target encoding. Not only for regression problem, the paper gives the solution for both binary classification as well as multi-class classification. This is the same paper that category_encoders cites for target encoding as well.", "While there are several articles explaining target encoding for regression and binary classification problems, my aim is to implement target encoding for multi-class variables. However, before that, we need to understand how it\u2019s done for binary targets. In this article, I cover an overview of the paper that introduced target encoding, and show by example how target encoding works for binary problems.", "Here is what the paper says for categorical target, in a nutshell:", "(Skip this section if you wish to understand through an example)", "One can map every occurrence of a category to the probability estimate of the target attribute. In a classification scenario, the numerical representation corresponds to the posterior probability of the target, conditioned by the value of the categorical attribute. This is effectively a numerical representation of the expected value of the target, given the value of the categorical attribute. In order to avoid overfitting due to a small number of observations in a category, smoothing of the means is also applied.", "Let\u2019s look at this practically. In binary problem the target is either 0 or 1. Then, the probability estimate for a category within a categorical variable can be given by Empirical Bayesian probability, P(Y=1|X=Xi), i.e.", "where\u00a0n(TR)\u00a0is\u00a0the\u00a0total\u00a0row\u00a0count, n(Y) is the total row count with 1\u2019s in target, n(i) is the count of rows with i-th category and n(iY) is the count of rows with target 1 in i-th category\u00a0. Therefore, the fraction in the first term represents probability of 1 in the i-th category, while the fraction in second term represents probability of 1 in overall data. \u03bb is a function which gives monotonic weight which helps when we have a small number of several categories, increasing with n(i) count from 0 to 1.", "If you have used TargetEncoder from category_encoders library, k is the \u2018min_sample_leaf\u2019 parameter, and f is the \u2018smoothing\u2019 parameter.", "Introducing the weighting factor makes sense because when the sample size is large, we should assign more credit to the posterior probability estimate provided by the first term above. However, if the sample size is small, then we replace the probability estimate with the null hypothesis given by the prior probability of the dependent attribute (i.e. mean of all Ys). With this transformation, missing values are handled by treating them as just another variable.", "The paper extends the same concept to multi-class target as well. We have one new feature for each class of target. Each feature is then effectively a numerical representation of the expected value of exactly one class of target, given the value of the categorical attribute. Of course, the number of inputs can increase significantly if the target has a very high number of classes. However, practically the number of classes is usually small. Read more on this in my next article.", "In the next section, we look at binary classification situation, with an example.", "Let\u2019s look at a binary target example.", "What is the probability of Target being 1 if the category of feature Gender is \u2018Male\u2019?", "Similarly, what is the probability of Target being 1 if the category of feature Gender is \u2018Female\u2019?", "Wait, now if you replace all occurrences of \u2018Female\u2019 with 0.25, you risk what is called overfitting. This is because you did not consider that overall probability of 1\u2019s is not 0.5. It\u2019s 4/9=0.4.", "To account for this fact, we add a weight to this \u2018prior\u2019 information, using the formula shown in the previous section.", "Similarly, for \u2018Female\u2019, we have four rows, so n=4;", "If you look closer, you may notice that \u03bb helps giving importance to those categories for which number of rows are more. In our example, there were 4 rows of Gender \u2018Female\u2019, as opposed to only 2 rows of Gender \u2018Male\u2019. The corresponding Weight Factor were 0.95 and 0.73.", "Thus, replace all occurrences of \u2018Male\u2019 with 0.485 and \u2018Female\u2019 with 0.259. Value for \u2018Other\u2019 can be calculated in a similar fashion.", "Congratulations! You just implemented target encoding.", "Check for yourself by running this code, which does the same using your favorite category_encoders library:", "In this article, I introduced a shortcoming of the TargetEncoder class of category_encoders library. I explained and summarized the paper that introduced target encoding. I explained through an example how the categories can be replaced with a numerical value.", "My next article will focus completely on how we can do the same for multi-class targets. Stay tuned!", "Edit: Published the next one, demonstrating and implementing multi-class target encoding here.", "Check out some of my interesting projects on GitHub", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd356c4e9e82&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mohannishant6.medium.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": ""}, {"url": "https://mohannishant6.medium.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Nishant Mohan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F30ff2a59e5e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&user=Nishant+Mohan&userId=30ff2a59e5e5&source=post_page-30ff2a59e5e5----d356c4e9e82---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@silvanarnet?utm_source=medium&utm_medium=referral", "anchor_text": "Silvan Arnet"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://contrib.scikit-learn.org/category_encoders/index.html", "anchor_text": "category_encoders"}, {"url": "http://contrib.scikit-learn.org/category_encoders/_modules/category_encoders/target_encoder.html#TargetEncoder", "anchor_text": "source code"}, {"url": "https://dl.acm.org/doi/10.1145/507533.507538", "anchor_text": "original paper"}, {"url": "https://medium.com/@mohannishant6/target-encoding-for-multi-class-classification-c9a7bcb1a53", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/mohannishant/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/mohannishant6", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/target-encoding?source=post_page-----d356c4e9e82---------------target_encoding-----------------", "anchor_text": "Target Encoding"}, {"url": "https://medium.com/tag/categorical-data?source=post_page-----d356c4e9e82---------------categorical_data-----------------", "anchor_text": "Categorical Data"}, {"url": "https://medium.com/tag/multiclass-classification?source=post_page-----d356c4e9e82---------------multiclass_classification-----------------", "anchor_text": "Multiclass Classification"}, {"url": "https://medium.com/tag/binary-classification?source=post_page-----d356c4e9e82---------------binary_classification-----------------", "anchor_text": "Binary Classification"}, {"url": "https://medium.com/tag/multi-class?source=post_page-----d356c4e9e82---------------multi_class-----------------", "anchor_text": "Multi Class"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&user=Nishant+Mohan&userId=30ff2a59e5e5&source=-----d356c4e9e82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&user=Nishant+Mohan&userId=30ff2a59e5e5&source=-----d356c4e9e82---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd356c4e9e82&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d356c4e9e82---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d356c4e9e82--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d356c4e9e82--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d356c4e9e82--------------------------------", "anchor_text": ""}, {"url": "https://mohannishant6.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mohannishant6.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nishant Mohan"}, {"url": "https://mohannishant6.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "74 Followers"}, {"url": "https://www.linkedin.com/in/mohannishant/", "anchor_text": "https://www.linkedin.com/in/mohannishant/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F30ff2a59e5e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&user=Nishant+Mohan&userId=30ff2a59e5e5&source=post_page-30ff2a59e5e5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9fbd44251677&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fall-about-target-encoding-d356c4e9e82&newsletterV3=30ff2a59e5e5&newsletterV3Id=9fbd44251677&user=Nishant+Mohan&userId=30ff2a59e5e5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}