{"url": "https://towardsdatascience.com/how-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3", "time": 1683014471.876916, "path": "towardsdatascience.com/how-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3/", "webpage": {"metadata": {"title": "How To Compile TensorFlow 2.3 with CUDA 11.1 | by Tianhao Zhou | Towards Data Science", "h1": "How To Compile TensorFlow 2.3 with CUDA 11.1", "description": "TensorFlow is a framework for building machine learning projects that is pretty easy to use. However, that doesn\u2019t mean it\u2019s always easy to set up, especially when you are playing with the bleeding\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.bazel.build/versions/master/install-ubuntu.html", "anchor_text": "here", "paragraph_index": 11}, {"url": "https://github.com/tensorflow/tensorflow.git", "anchor_text": "https://github.com/tensorflow/tensorflow.git", "paragraph_index": 13}, {"url": "https://medium.com/u/1f89df37e1b0?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Pwuertz", "paragraph_index": 21}, {"url": "https://medium.com/u/1f89df37e1b0?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Pwuertz", "paragraph_index": 25}, {"url": "https://www.linkedin.com/in/tianhaoz", "anchor_text": "https://www.linkedin.com/in/tianhaoz", "paragraph_index": 28}], "all_paragraphs": ["TensorFlow is a framework for building machine learning projects that is pretty easy to use. However, that doesn\u2019t mean it\u2019s always easy to set up, especially when you are playing with the bleeding edge features.", "During the last few years, I have run into situations where TensorFlow won\u2019t work in certain environments multiple times. Every time that happens, I had to spend hours searching the internet for fragmented information and extra hours to put the pieces together. This time, I decided to write up a detailed tutorial to save future situations where nothing works.", "Earlier today I was building a quick experiment with a GAN-based network where I found the experimental Keras preprocessing API to be helpful, but unfortunately, it has just been added in version 2.3 (I was on 2.2):", "For a normally Python package, a simple pip install -U tensorflow should do the trick, and if no, conda install tensorflow will be the backup, but, unfortunately, TensorFlow is nothing normal.", "After doing the pip install -U, all sorts of CUDA and TensorRT \u201cnot found\u201d errors started to pop up, and to make things worse, ANACONDA is still in the previous version.", "After struggling with fixing the libraries for a while, I decided that compiling TensorFlow from source might be the only way to save the situation.", "If we were to compile from source, why not use the lastest CUDA and TensorRT as well (those are Nvidia libraries that TensorFlow depends on), so the plan is to install TensorFlow 2.3 with CUDA 11.1, CuDNN 8.0, and TensorRT 7 (precompiled TensorFlow uses CUDA 10.1, CuDNN 7.6 and TensorRT 6).", "Since we are compiling a Python library, the development libraries and header files will be needed. We can get those with sudo apt install python3-dev python3-pip .", "At the same time, we also need the pure Python part of TensorFlow which is plugged in instead of compiled. We can install them with:", "We will also need the Nvidia libraries:", "Note: you don\u2019t have to get the exact version since this tutorial is about installing with whatever the latest versions are.", "The last thing needed is Bazel, the build system that TensorFlow uses, which you can find how to install it here.", "Note: as of now, you need Bazel 3.1.0 to compile TensorFlow, but TensorFlow will prompt you will the command to change the Bazel version during the compilation setup.", "Since we are compiling from source, we need to first get the source code with git clone https://github.com/tensorflow/tensorflow.git .", "To configure the compilation, we need to run ./configure inside the cloned repository.", "The command will prompt us with some options, we need to select CUDA to be version 11 and TensorRT to be version 7 and supply it with the following paths for finding Nvidia libraries:", "Note: the last one in the list the location the TensorRT 7.2 zip file was extracted to.", "After finishing configuring, we can start compiling TensorFlow with the following command:", "Unfortunately, as soon as you start the compilation, all sorts of errors will start to pop up, but most likely you will see something like this:", "This is saying that a required Nvidia library with a specific version is not found. If you closely followed the library installation steps above, then you should be able to rule out the possibility that it is truly missing, and what is left is just that TensorFlow is making some assumptions on how they are versioned.", "In my case, it is complaining about libcudart.so.11.1 is missing. A quick search with locate libcudart.so finds that, instead of 11.1, I have libcudart.so.11.0 . This means that, although CUDA is in version 11.1, there is likely no change went into libcudart.so , so it\u2019s still 11.0.", "To fix the issue, we need to open third_party/gpus/cuda_configure.bzl (Thanks Pwuertz for pointing out a typo!) inside the TensorFlow repository and replace the following code:", "Note: if the library you are having trouble with is not cudart , you should still be able to fix it by modifying the configuration for other components.", "After the fix, it should start compiling (it takes a while to compile, so be prepared to leave it overnight).", "The takeaway is that, for TensorFlow installation, you should always start with Anaconda or Virtualenv installation, and if it doesn\u2019t work and you can bear with using Docker all the time, then use the official docker image, but if all of them don\u2019t work, use this post as you last resort so at least you can start building things.", "Thanks Pwuertz for pointing out that sometimes you also have to specify \u201c11\u201d for libcublas since Nvidia reduced the suffixes to libcublas.so.11 but TensorFlow uses libcublas.so.11.2.1.74 or other variances depending on the exact version.", "Thanks for the awesome suggestions from:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A boba a day keeps bugs away. LinkedIn: https://www.linkedin.com/in/tianhaoz"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8cbecffcb8d3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tianhaozhou.medium.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": ""}, {"url": "https://tianhaozhou.medium.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Tianhao Zhou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9681ff29fecf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&user=Tianhao+Zhou&userId=9681ff29fecf&source=post_page-9681ff29fecf----8cbecffcb8d3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@robertbye?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Robert Bye"}, {"url": "https://unsplash.com/s/photos/mess?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://developer.nvidia.com/cuda-toolkit", "anchor_text": "CUDA 11.1"}, {"url": "https://developer.nvidia.com/rdp/cudnn-download#", "anchor_text": "CuDNN 8"}, {"url": "https://developer.nvidia.com/nvidia-tensorrt-7x-download", "anchor_text": "TensorRT 7.2"}, {"url": "https://docs.bazel.build/versions/master/install-ubuntu.html", "anchor_text": "here"}, {"url": "https://github.com/tensorflow/tensorflow.git", "anchor_text": "https://github.com/tensorflow/tensorflow.git"}, {"url": "https://medium.com/u/1f89df37e1b0?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Pwuertz"}, {"url": "https://medium.com/u/1f89df37e1b0?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Pwuertz"}, {"url": "https://github.com/tensorflow/tensorflow/issues/43588", "anchor_text": "https://github.com/tensorflow/tensorflow/issues/43588"}, {"url": "https://github.com/tensorflow/tensorflow/issues/26289", "anchor_text": "https://github.com/tensorflow/tensorflow/issues/26289"}, {"url": "https://github.com/tensorflow/tensorflow/issues/26150", "anchor_text": "https://github.com/tensorflow/tensorflow/issues/26150"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----8cbecffcb8d3---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8cbecffcb8d3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----8cbecffcb8d3---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/programming?source=post_page-----8cbecffcb8d3---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-development?source=post_page-----8cbecffcb8d3---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&user=Tianhao+Zhou&userId=9681ff29fecf&source=-----8cbecffcb8d3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&user=Tianhao+Zhou&userId=9681ff29fecf&source=-----8cbecffcb8d3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8cbecffcb8d3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8cbecffcb8d3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8cbecffcb8d3--------------------------------", "anchor_text": ""}, {"url": "https://tianhaozhou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tianhaozhou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tianhao Zhou"}, {"url": "https://tianhaozhou.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "535 Followers"}, {"url": "https://www.linkedin.com/in/tianhaoz", "anchor_text": "https://www.linkedin.com/in/tianhaoz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9681ff29fecf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&user=Tianhao+Zhou&userId=9681ff29fecf&source=post_page-9681ff29fecf--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F142e8e07f85c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compile-tensorflow-2-3-with-cuda-11-1-8cbecffcb8d3&newsletterV3=9681ff29fecf&newsletterV3Id=142e8e07f85c&user=Tianhao+Zhou&userId=9681ff29fecf&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}