{"url": "https://towardsdatascience.com/how-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874", "time": 1683013331.458067, "path": "towardsdatascience.com/how-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874/", "webpage": {"metadata": {"title": "How to build a recommendation system in a graph database using a latent factor model | by Changran Liu | Towards Data Science", "h1": "How to build a recommendation system in a graph database using a latent factor model", "description": "A recommendation system is any rating system which predicts an individual\u2019s preferred choices, based on available data. Recommendation systems are utilized in a variety of services, such as video\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.tigergraph.com/v/2.6/dev/gsql-examples/common-applications#example-1-collaborative-filtering", "anchor_text": "KNN", "paragraph_index": 2}, {"url": "https://www.tigergraph.com/2020/01/20/taking-your-first-steps-in-learning-tigergraph-cloud/", "anchor_text": "Creating You First TigerGraph Instance", "paragraph_index": 16}, {"url": "https://www.tigergraph.com/2020/01/20/taking-your-first-steps-in-learning-tigergraph-cloud/", "anchor_text": "Getting Started with TigerGraph Cloud Portal", "paragraph_index": 17}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens-100K", "paragraph_index": 17}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens-100K", "paragraph_index": 17}], "all_paragraphs": ["A recommendation system is any rating system which predicts an individual\u2019s preferred choices, based on available data. Recommendation systems are utilized in a variety of services, such as video streaming, online shopping, and social media. Typically, the system provides the recommendation to the users based on its prediction of the rating a user would give to an item. Recommendation systems can be categorized by two aspects, the utilized information and the prediction models.", "The two major recommendation approaches, content filtering and collaborative filtering, mainly differ according to the information utilized for rating prediction. Figure 1 shows a set of movie rating data together with some tags for users and movies. Note that the ratings from users to movies from a graph structure: users and movies are the vertices, and ratings are the edges of the graph. In this example, a content filtering approach leverages the tag attributes on the movies and users. By querying the tags, we know Alice is a big fan of Marvel movies, and Iron Man is a Marvel movie, thus the Iron Man series will be a good recommendation for her. A specific example of a content filtering scoring system is TF-IDF, used for ranking document searches.", "The tags on the users and movies may not always be available. When the tag data is sparse, the content filtering method can be unreliable. On the other hand, collaborative filtering approaches mainly rely on the user behavior data (e.g. rating record or movie watching history). In the example above, both Alice and Bob love the movie Toy Story which was rated 5 and 4.5 by them, respectively. Based on these rating records, it can be inferred that these two users may share similar preferences. Now considering that Bob loves Iron Man, we can expect similar behavior from Alice, and recommend Iron Man to Alice. K-nearest neighbors (KNN) is a typical collaborative filtering approach. The collaborative filtering, however, has the so-called Cold Start problem \u2014 it cannot produce a recommendation for new users that have no rating records.", "Recommendation systems can also be categorized into memory-based and model-based approaches depending on the implicity of the utilized features. In the examples above, all the user and movie features are given explicitly, which allows us to directly match movies and users based on their tags. However sometimes a deep learning model is needed to extract the latent features from the information of users and movies (e.g. an NLP model to categorize the movies based on its outline). A model-based recommendation system utilizes machine learning models for prediction. While a memory-based recommendation system mainly leverages the explicit features.", "Some typical examples of different types of recommendation systems are shown below.", "As discussed above, a collaborative filtering method, such as KNN, can predict the movie rating without knowing the attributes of the movies and users. However, such an approach may not generate accurate predictions when the rating data is sparse, i.e., the typical user has rated only a few movies. In Fig. 1, KNN cannot predict Alice\u2019s rating of Iron Man if Bob has not rated Toy Story, since there would be no path between Alice and Bob, and there would be no \u201cneighbor\u201d per se for Alice. To address this challenge, the graph factorization approach [1] combines the model-based method with the collaborative filtering method to improve prediction accuracy when the rating record is sparse.", "Fig. 2 illustrates the intuition of the graph factorization method. Graph factorization is also known as a latent factor or matrix factorization method. The objective is to obtain a vector for each user and movie, which represents their latent features. In this example (Fig. 2), the dimension of the vectors is specified as 2. The two elements of the vector for a movie x(i) represent the degrees of romance and action content of this movie, and the two elements of the vector for a user \u03b8(j) represent the user\u2019s degree of preference for romance and action content, respectively. The prediction of the rating that user j would give to movie i is the dot product of x(i) and \u03b8(j), as we expect a better alignment of these two vectors indicates a higher degree of preference from the user to the movie.", "The example in Fig.2 is only meant to illustrate the intuition of the graph factorization approach. In practice, the meaning of each vector element is usually unknown. The vectors are actually randomly initialized and get \u201ctrained\u201d by minimizing the loss function below [1].", "where M is the number of rating records, n is the dimension of the latent factor vector, y(i,j) is the rating that user j gave to movie i , and \ud835\udf40 is the regularization factor. The first term is essentially the square error of the prediction (sum of \u03b8(j)_k and x(i)_k over k), and the second term is a regularization term to avoid overfitting. The first term of the loss function can also be expressed in the form of matrices,", "where R is the rating matrix with y(i,j) as its elements, and U and V are matrices formed of the latent factor vectors for users and movies, respectively. To minimize the square error of the prediction is equivalent to minimizing the Frobenius norm of R-UV^T. Thus this method is also called a matrix factorization method.", "You may wonder why we also refer to this method as a graph factorization approach. As discussed earlier, the rating matrix R is most likely to be a sparse matrix, since not all the users will give ratings to all the movies. Based on the consideration of the storage efficiency, this sparse matrix is often stored as a graph where each vertex represents a user or a movie, and each edge represents a rating record with its weight as the rating. As will be shown below, the gradient descent algorithm that will be used to optimize the loss function and thus obtain the latent factors can also be expressed as a graph algorithm.", "The partial derivatives of \u03b8(j)_k and x(i)_k can be expressed as follows:", "The equations above show that the partial derivative of a latent vector on a vertex only depends on its edges and neighbors. For our example, the partial derivative of a user vector is only determined by the ratings and the latent vectors of the movies the user has rated before. This property allows us to store our rating data as a graph (Fig. 5) and use a graph algorithm to obtain the latent factors of the movies and users. The user and movie features can be obtained by the following steps:", "It is worth mentioning that computing the derivatives and updating the latent factors can be done in a Map-Reduce framework, where step 2 can be done in parallel for each edge_(i, j) (i.e. rating) and step 3 can also be done in parallel for each vertex_i (i.e. user or movie).", "For industrial applications, the database can hold hundreds of millions of users and movies, and billions of rating records, which means the rating matrix A, feature matrices U and V, plus other intermediate variables can consume terabytes of memory during model training. Such a challenge can be resolved by training the latent features in a graph database where the rating graph can be distributed among a multi-node cluster and partially stored on disk. Moreover, graph-structured user data (i.e. rating records) is stored in the database management system in the first place. In-database model training also avoids exporting the graph data from the DBMS to other machine learning platforms and thus better support continuous model update over evolving training data.", "In this section, we will provision a graph database on TigerGraph Cloud (for free), load a movie rating graph, and train a recommendation model in the database. By following the steps below, you will have a movie recommendation system in 15 minutes.", "Follow the Creating You First TigerGraph Instance (first 3 steps) to provision a free instance on TigerGraph Cloud. In step 1, choose In-Database Machine Learning Recommendation as the starter kit. In step 3, choose TG.Free.", "Follow the Getting Started with TigerGraph Cloud Portal and log into GraphStudio. In the Map Data To Graph page, you will see how the data files are mapped to the graph. In this starter kit, the MovieLens-100K files have already been uploaded into the instance. The MovieLens-100K data set has two files:", "Go to the Load Data page and click Start/Resume loading. After loading finishes, you can see the graph statistics on the right. The MovieLens-100K data set has 100,011 rating records given by 944 users to 1682 movies.", "After loading finishes, you can see the graph statistics on the right. In the Explore Graph page, you can see we just created a bipartite graph where the information of each movie and user is stored in the vertex, and the rating records are stored in the edges.", "In the Write Queries page, you will find the queries needed for our recommendation system have already been added to the database. The queries are written in GSQL, the query language of TigerGraph. Click Install all queries to compile all the GSQL query into C++ code. You can also see a README query on this page. Follow the steps below to build a recommendation with the movie rating records.", "This query split rating data into the validation set and training set. The fraction of testing data is set to be 30% by default. (i.e. 30% of the rating data will be used for model validation and the rest 70% will be used for model training). This query also outputs the size of the total data set, the validation data set and the training data set.", "This query normalizes the ratings by subtracting each rating by the average rating of the movie. The average rating of each movie is computed from the training data.", "This query initializes the latent factor vectors for the users and the movies. The elements in the latent factor vectors are initialized by a normal distributed random number generator. The query inputs are the standard deviation and the mean of the normal distribution.", "This query trains the recommender model using gradient descent algorithm. The number of features is set as 19 by default. This number has to be the same as the num_latent_factors in the initialization query. The query inputs are the learning rate, regularization_factor and the number of training iterations. The query output the root mean square error (RMSE) for each iteration", "After the latent factors are computed, we can test and use the model for recommendation.", "This query outputs the real ratings provided by a user together with the predicted rating by the model. The query input is a user id. The query output is all the ratings given by the user and the rating prediction", "This query output the top-10 movies recommended to a user. The movies are recommended based on the rating prediction.", "Training machine learning model in a graph database has the potential to achieve real-time updates of the recommendation model. In this article, we introduce the mechanism of the graph factorization method and show a step-by-step example of building your own movie recommendation system using TigerGraph cloud service. Once you are familiar of this example, you should be confident with customizing this recommendation system based on your use cases.", "[1] Ahmed, Amr, et al. \u201cDistributed large-scale natural graph factorization\u201d Proceedings of the 22nd international conference on World Wide Web (2013)", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffa2d142f874&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2d142f874--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@liuchangran6106?source=post_page-----fa2d142f874--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuchangran6106?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Changran Liu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1e1029539216&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&user=Changran+Liu&userId=1e1029539216&source=post_page-1e1029539216----fa2d142f874---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.tigergraph.com/v/2.6/dev/gsql-examples/common-applications#example-1-collaborative-filtering", "anchor_text": "KNN"}, {"url": "https://www.tigergraph.com/2020/01/20/taking-your-first-steps-in-learning-tigergraph-cloud/", "anchor_text": "Creating You First TigerGraph Instance"}, {"url": "https://www.tigergraph.com/2020/01/20/taking-your-first-steps-in-learning-tigergraph-cloud/", "anchor_text": "Getting Started with TigerGraph Cloud Portal"}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens-100K"}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens-100K"}, {"url": "https://medium.com/tag/recommendation-system?source=post_page-----fa2d142f874---------------recommendation_system-----------------", "anchor_text": "Recommendation System"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----fa2d142f874---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/graph-database?source=post_page-----fa2d142f874---------------graph_database-----------------", "anchor_text": "Graph Database"}, {"url": "https://medium.com/tag/factorization?source=post_page-----fa2d142f874---------------factorization-----------------", "anchor_text": "Factorization"}, {"url": "https://medium.com/tag/graphql?source=post_page-----fa2d142f874---------------graphql-----------------", "anchor_text": "GraphQL"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&user=Changran+Liu&userId=1e1029539216&source=-----fa2d142f874---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&user=Changran+Liu&userId=1e1029539216&source=-----fa2d142f874---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffa2d142f874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fa2d142f874---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fa2d142f874--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fa2d142f874--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fa2d142f874--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fa2d142f874--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fa2d142f874--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuchangran6106?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@liuchangran6106?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Changran Liu"}, {"url": "https://medium.com/@liuchangran6106/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "50 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1e1029539216&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&user=Changran+Liu&userId=1e1029539216&source=post_page-1e1029539216--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F1e1029539216%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-recommendation-system-in-a-graph-database-using-a-latent-factor-model-fa2d142f874&user=Changran+Liu&userId=1e1029539216&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}