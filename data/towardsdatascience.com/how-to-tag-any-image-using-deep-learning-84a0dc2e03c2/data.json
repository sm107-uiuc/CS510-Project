{"url": "https://towardsdatascience.com/how-to-tag-any-image-using-deep-learning-84a0dc2e03c2", "time": 1683007484.225894, "path": "towardsdatascience.com/how-to-tag-any-image-using-deep-learning-84a0dc2e03c2/", "webpage": {"metadata": {"title": "How To Tag Any Image Using Deep Learning | by Tyler Folkman | Towards Data Science", "h1": "How To Tag Any Image Using Deep Learning", "description": "Read on to learn how to use deep learning and Pytorch to tag any photo with less than 60 lines of code. The best part is, you\u2019ll only have to change about 3 lines of code to get it to work for your\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/slothkong/10-monkey-species", "anchor_text": "dataset", "paragraph_index": 5}, {"url": "https://towardsdatascience.com/understanding-and-coding-a-resnet-in-keras-446d7ff84d33", "anchor_text": "here", "paragraph_index": 12}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colab", "paragraph_index": 12}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet", "paragraph_index": 14}, {"url": "https://github.com/PyTorchLightning/pytorch-lightning", "anchor_text": "Pytorch Lightning", "paragraph_index": 16}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/trainer.html", "anchor_text": "docs", "paragraph_index": 29}, {"url": "https://datascienceleadership.substack.com/", "anchor_text": "Get your FREE copy of 11 INCREDIBLY useful resources to MASTER data science", "paragraph_index": 40}, {"url": "https://datascienceleadership.substack.com/", "anchor_text": "https://datascienceleadership.substack.com/", "paragraph_index": 42}], "all_paragraphs": ["You probably want those photos tagged automatically for you, right?", "But you also don\u2019t want to write a ton of code to do so.", "Read on to learn how to use deep learning and Pytorch to tag any photo with less than 60 lines of code. The best part is, you\u2019ll only have to change about 3 lines of code to get it to work for your own images!", "An extremely common machine learning problem is to classify or tag an image. Image classification is when you have a predefined set of classes for which you want to assign images.", "Let\u2019s say you work at a Zoo and are always forgetting the names of all the monkey species. It would be great if you had a way to automatically classify various pictures of monkeys with the appropriate species.", "Why monkeys, you ask? Because there is an available dataset on Kaggle. :) This dataset contains about 1,400 images of 10 different species of monkeys. Here is a picture of the white-headed capuchin:", "And one of the patas monkey:", "Having data is key. For your own problem, make sure you have some images that are already tagged. My recommendation would be to get at least 50 tagged images per class.", "Once you have your images, let\u2019s get them organized correctly. You will need to create two folders: \u201ctraining\u201d and \u201cvalidation\u201d. Your photos in the training folder will be used to train our deep learning model. The validation photos will be used to make sure our model is tuned well.", "Within each folder, make a folder for each tag you have. For our monkeys, we have 10 tags, we will call them n0-n9. Thus, our folder structure looks like this:", "Then, place the appropriate images within each folder. Maybe put 70% of your tagged images in training, 20% in validation, and leave 10% out for testing.", "We will also maintain a mapping from n0-n9 to the actual species names, so we don\u2019t forget:", "An extremely popular neural network architecture for tagging images is ResNet-50. It does a good job balancing accuracy and complexity. I won\u2019t go into depth on this deep learning model, but you can learn more here. For our purposes, just know its a really good model for image classification and you should be able to train it in a reasonable time if you have access to a GPU. If you don\u2019t, take a look at Google Colab to get access to free GPU resources.", "One of the tricks we will use when training our model will be to use the idea of fine-tuning to hopefully be able to learn how to accurately tag with only a few examples.", "Fine-tuning starts our model with weights already trained on another dataset. We then further tune the weights using our own data. A very common dataset to use as the starting point for fine-tuning is the ImageNet dataset. This dataset originally contained about 1 million images and 1,000 classes or tags. The breadth of image tags tends to make it a good dataset for fine-tuning.", "Besides fine-tuning, there are other tricks we can apply to help our deep learning model train well on our data. For example, using a learning rate finder to pick the best learning rate.", "Implementing all these best practices and keeping track of all the training steps can lead to a lot of code. To avoid all of this boilerplate, we are going to use Pytorch Lightning. I love this library. I find it really helps me to organize my Pytorch code well and avoid dumb mistakes such as forgetting to zero out my gradients.", "We will use Pytorch Lightning by writing a class that implements the LightningModule. Here is the bulk of our code and then we\u2019ll walk you through it:", "The first function we define is init(). This is the function we use to initialize our model. We start with the pre-trained Resnet50 from Pytorch and modify it slightly so that it predicts the appropriate number of classes. The number of classes or tags you want to predict is passed as part of hparams as num_target_classes.", "Next, we have the forward() function. This one is simple, we just pass the input passed to it through our network.", "Then we have the training_step() function. This function takes two inputs \u2014 the batch and the batch index. Within the function, all we need to define is what we want to happen during each training step. For this model, it is very simple. We pass the data through self() which is our neural network and then calculate the cross-entropy as our loss. For this function, it is standard to return a dictionary with the calculated loss as well as a log variable for Tensorboard. One of the great benefits of Pytorch Lightning is that if you do this, you get Tensorboard logging for basically free, which is super nice!", "The configure_optimizers() function is used to define your optimizer. We will use the Adam optimizer and pass the learning rate via our hparams.", "Lastly, for training, you have the train_dataloader() function. This is the function that takes care of loading your training data and passing it to your training step. We make sure to define our transforms to size the images and scale them in the same way our Resnet was pre-trained. We also apply some data augmentation with RandomResizedCrop() and RandomHorizontalFlip(). I then load the data with Pytorch\u2019s ImageFolder() function. This function loads images from a folder as long as the folder follows the structure we defined previously. The data is passed to a DataLoader() which is what Pytorch uses to actually load the data. Within this function, we can define items such as the batch_size. We pass the batch_size as a hyper-parameter via hparams.", "Since we also have validation data, we can define the exact same functions except they are not for the validation data: validation_step() and val_dataloader(). These functions are very similar. Some of the differences are we no longer do data augmentation and our step returns val_loss.", "The validation section also has an additional function: validation_epoch_end(). This defines what should be done with the validation results at the end of an epoch. We just simply return the average validation loss. You can also do this for the training step as well if you wish.", "Now that we have done the heavy lifting of defining all the necessary steps, we can sit back and let Pytorch Lightning do it\u2019s magic. First, let\u2019s define our hyper-parameters (Pytorch Lightning expects it as an argparse Namespace):", "I set the batch size pretty small to work with pretty much any GPU.", "Next, we initialize our model and train!", "The Trainer() is where the real magic happens. First, we tell it how many GPUs to train on, then we let it know to stop training early if the val_loss doesn\u2019t improve, and one of the coolest options is auto_lr_finder. This tells the trainer to use an algorithm to find the best learning rate for our model and data and then use that rate instead of the rate we specified. Note: this only works if you pass hparams to your model and there is a lr value within your hparams. Lastly, to avoid running for too long we set the max_epochs to 50.", "If you\u2019ve done much deep learning you can appreciate the cleanliness of our Trainer(). We didn\u2019t have to write a single loop over our data, its all taken care of for us. If we moved our code over to a machine with 8 GPUs, all we have to do is change gpus to 8. That\u2019s it. If we got access to TPUs, Pytorch Lightning also supports those and you just turn on the option. At some point, you should definitely check out the docs on all the great options the Trainer() provides.", "So \u2014 how well did our model do at tagging monkeys? Pytorch Lightning automatically checkpoints the model with the best validation results, which for me, happened at epoch 26. I loaded up that model with this code:", "And with this code, made predictions on all my validation data:", "Here is my classification report (using scikit-learn):", "Not bad! I was able to average a 0.95 f1-score and my lowest f1-score for a class was 0.91.", "These are validation results, though, so they are very likely to be optimistic. To get a better representation of how well our model does we need to predict on images not in the training nor validation sets.", "I didn\u2019t take the time to create an entire test set, but I did grab 2 random images from Google of monkeys. In fact, those images are the 2 images at the top of this post. And our model was able to predict them both correctly!", "Also, here are the Tensorboard graphs for the training:", "It\u2019s safe to say that we are now, thanks to our deep learning model, experts on monkey species. :)", "The beautiful part is you can now easily go and classify any images you want. All you have to do is tag some of your own images, organize them appropriately (as discussed above), and change 3 lines of code.", "The only 3 lines you need to update are the values for train_dir, val_dir, and num_target_classes. That\u2019s it! So \u2014 go do it for yourself and let me know what cool things you classify!", "Get your FREE copy of 11 INCREDIBLY useful resources to MASTER data science", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Chief Technology and AI Officer at BEN/TubeBuddy. Get your FREE list of useful data science resources: https://datascienceleadership.substack.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F84a0dc2e03c2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tylerfolkman?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tylerfolkman?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Tyler Folkman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47ca8d25c93f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&user=Tyler+Folkman&userId=47ca8d25c93f&source=post_page-47ca8d25c93f----84a0dc2e03c2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@alienaperture?utm_source=medium&utm_medium=referral", "anchor_text": "Michael Rogers"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/slothkong/10-monkey-species", "anchor_text": "dataset"}, {"url": "https://towardsdatascience.com/understanding-and-coding-a-resnet-in-keras-446d7ff84d33", "anchor_text": "here"}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colab"}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet"}, {"url": "https://github.com/PyTorchLightning/pytorch-lightning", "anchor_text": "Pytorch Lightning"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/trainer.html", "anchor_text": "docs"}, {"url": "https://datascienceleadership.substack.com/", "anchor_text": "Get your FREE copy of 11 INCREDIBLY useful resources to MASTER data science"}, {"url": "https://medium.com/tag/data-science?source=post_page-----84a0dc2e03c2---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----84a0dc2e03c2---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/programming?source=post_page-----84a0dc2e03c2---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/technology?source=post_page-----84a0dc2e03c2---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----84a0dc2e03c2---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&user=Tyler+Folkman&userId=47ca8d25c93f&source=-----84a0dc2e03c2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&user=Tyler+Folkman&userId=47ca8d25c93f&source=-----84a0dc2e03c2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F84a0dc2e03c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----84a0dc2e03c2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----84a0dc2e03c2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tylerfolkman?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tylerfolkman?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tyler Folkman"}, {"url": "https://medium.com/@tylerfolkman/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.5K Followers"}, {"url": "https://datascienceleadership.substack.com/", "anchor_text": "https://datascienceleadership.substack.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47ca8d25c93f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&user=Tyler+Folkman&userId=47ca8d25c93f&source=post_page-47ca8d25c93f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2ee8b13cc0ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tag-any-image-using-deep-learning-84a0dc2e03c2&newsletterV3=47ca8d25c93f&newsletterV3Id=2ee8b13cc0ac&user=Tyler+Folkman&userId=47ca8d25c93f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}