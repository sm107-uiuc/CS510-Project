{"url": "https://towardsdatascience.com/classifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697", "time": 1683001565.3419871, "path": "towardsdatascience.com/classifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697/", "webpage": {"metadata": {"title": "Classifying ADHD from Healthy Controls using LSTMs with rs-fMRI Data | by Gili Karni | Towards Data Science", "h1": "Classifying ADHD from Healthy Controls using LSTMs with rs-fMRI Data", "description": "This tutorial walks through the practical steps of using machine learning to analyze rs-fMRI data and more specifically to discriminate Attention Deficit Hyperactivity Disorder (ADHD) from healthy\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@gili.karni/exploring-cognitive-differences-via-resting-state-networks-2112bf5291e2", "anchor_text": "Identifying resting-state networks from fMRI data using ICAs for a preprocessing tutorial", "paragraph_index": 1}, {"url": "https://github.com/karnigili/NetworksNeuroscience", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://nilearn.github.io/", "anchor_text": "nilearn", "paragraph_index": 3}, {"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "sklearn", "paragraph_index": 3}, {"url": "https://keras.io/", "anchor_text": "keras", "paragraph_index": 3}], "all_paragraphs": ["This tutorial walks through the practical steps of using machine learning to analyze rs-fMRI data and more specifically to discriminate Attention Deficit Hyperactivity Disorder (ADHD) from healthy controls. I discuss (1) feature extraction using masks (2) The benefits and drawbacks of recurrent neural networks (RNN) and particularly long short term memory networks (LSTM) for classifying fMRI data (3) hypothesis testing and its use in model evaluation.", "For more details on how to prepare fMRI images for analysis visit Identifying resting-state networks from fMRI data using ICAs for a preprocessing tutorial.", "A note: if you have already read these previous posts, you may have noticed that I have swapped from a schizophrenia (SZ) dataset to an ADHD one. The main reason is that I lack the computational resources to preprocess the full schizophrenia dataset by myself. I could not find a preprocessed SZ dataset but I found an ADHD one.", "The full code for this tutorial is available here. To be prepared, please download python and install the following packages- nilearn, sklearn, and keras.", "As we mentioned previously, fMRI images are 4D matrices reflecting the activation level of each voxel at the three-dimensional space and time. However, oftentimes, the relevant information is portrayed by a subset of this data. For example, here- we are only curious about the resting-state networks. To omit the irrelevant data, we apply masks. Masks are simply filters that pass the desired subset of the data while dropping the rest. Practically, masks replace the activation value of unwanted voxels to 0.", "There are many styles to mask fMRI data, which is mostly determined by the goal of the analysis. This tutorial focuses on classifying ADHD patients from controls via their resting-state networks. Thus, I apply Smith\u2019s rs-fMRI components atlas (Smith et al.,2009). Smith atlas reflects seventy resting-state networks (RSN) acquired using an independent component analysis (ICA) on thousands of healthy patients. I prefer Smith atlas over the use of dataset-specific ICA components because it helps to avoid double-dipping (i.e using the data twice) which could lead to overfitting.", "The Smith\u2019s atlas is available via the Nilearn dataset:", "The ADHD dataset is also available on Nilearn. From the header of the first image, we see that the image contains 73*61*61 voxels over 176 timestamps. Additionally, each voxel is about 3mm\u00b3. It is important to note that this information may not be uniform across the whole dataset.", "To mask the data, we first need to generate the mask from the Smith\u2019s atlas. Applying a standardization could contribute to the features\u2019 robustness. In the case of masking, it can help in enhancing the signal by centering and normalizing the slices for each time-series. Considering the data confounds as part of the transformation process, also helps to enhance the signal by removing confounding noise.", "As mentioned before, a dataset might not hold a homogenous scanning length \u2014 these 40 subjects present quite a large variation. However, most machine learning algorithms (Keras included) require a uniform shape across all subjects. To optimize for keeping data, we can use padding; append each subject with zeros after the end of its scan to match the length of the longest scan. In addition to padding, I reshape the data such that it would fit the requirements posed by Keras; (40,261,10) implies that we have 40 subjects with 261 timestamps long sample over 10 regions.", "We use the train/test split paradigm to make sure the model is tested on completely new data. The function below randomly splits the data into train and test and reshapes each part according to the model\u2019s requirements.", "Long short-term memory (LSTM) models provide some benefits in learning fMRI data. The main reason is that, unlike most machine learning or deep learning methods, they manage to keep the contextual information of the inputs \u2014 thus incorporate details from previous parts of the input sequence while processing a current one. That said, being highly contextual isn\u2019t always such a good thing. There are cases where LSTMs are not the best choice; being contextual could lead to an over-interpretation of the data. In addition, LSTMs could take longer to run than a simple NN and they might have far more parameters to tune. It is important to consider various options and finding the most suitable model from the relevant scenario (Culurciello, 2018).", "In this case \u2014 I chose to demonstrate the ability of LSTMs in analyzing fMRIs due to their contextual nature. fMRI data represents dynamic brain activity over time, thus using LSTMs enables taking advantage of the temporal information (that otherwise would have been lost) when analyzing functional connectivity (Dvornek et al., 2017).", "Note- A common enhancement for LSTM is the use of convolutional neural networks (CNN) which supports analyzing the spatial structure. However, here, we extracted seventy discrete values reflecting independent components of the activation of whole networks \u2014 and thus gave up on the spatial property of the data. Therefore, CNN would unlikely to be useful.", "An issue with LSTMs is that they can easily overfit training data, reducing their predictive capacity. A solution to this problem is via regularization, which hinders the model\u2019s overfitting tendency. A conventional regularization in LSTM networks is the dropout, which probabilistically excludes units from the layer connection. There are two types of dropouts- input dropout and recurrent dropout. A dropout on the input means that for a given probability, the data on the input connection to each LSTM unit will be excluded from node activation and weight updates (see the dropout argument). The dropout on the recurrent input acts the same way but on the recurrent connection (see the reccurent_dropout argument). However, it is important not to over-regularize as it will hinder the model from learning at all (which could be detected by strict non-indicative prediction).", "The model I present here is a sequential model with three stacked LSTM layers and one dense layer with sigmoid activation. To be frank, there is no one right answer to how one chooses their hyperparameters. There is a lot of trial and error and rules of thumb. I present a few that I have collected \u2014", "Let\u2019s try the model and see if it manages to learn. Thus, its accuracy increases and its loss decreases;", "We see some increase in the model\u2019s accuracy and some decrease in the model\u2019s loss as the number of epochs increases. Additionally, both the training and validation sets showing similar trends. Thus, we are (1) having a working model and (2) probably not overfitting \u2014 thus, we shall continue.", "How do we actually use the model?", "I use a hypothesis testing framework to evaluate the model since it helps obtain both the accuracy of the model and its significance. To calculate the model\u2019s significance, I use bootstrapping. Bootstrapping, shortly, is a powerful, computer-based method for statistical inference without relying on too many assumptions. It helps us approximate the properties of the population by estimates from small data samples.", "Our null hypothesis, to be tested, states that there are no differences between ADHD patients to controls, thus the accuracy of comparing the two using our model should be about 0.5 (meaning, chance).", "To evaluate this hypothesis, we will repeatedly resample with replacement from the data; splitting it into a train and test parts, fitting the model, predicting the labels of test data, and calculating the accuracy. Such repetition will create a distribution of accuracies. Such resampling (following the central limit theorem) is likely to approach a Gaussian shape the larger the number of iterations we use. Thus, we could employ statistical tests that require normal distribution (like t-test).", "If 0.5 placed at the tails of the distribution (i.e at the last 5%), we can conclude that it is very unlikely that the distribution is centered around 0.5 and reject the null hypothesis. Otherwise, we would fail to reject it.", "The next function runs the bootstrapped experiment:", "And these two calculate and plot the p-value associated with the accuracy of the bootstrapped experiment.", "Lastly, let us present the results using the Receiver operating characteristic (ROC) curve. The ROC curve reflects the sensitivity and specificity of the model by plotting the true-positive rate against the false-positive rate.", "I chose to present the median (rather than the mean) value of the ROC curve since it presents a more robust measurement in case the data is skewed (and should not present any drawbacks if the data is not skewed).", "The ROC curve seen above shows a significant above-average classification capacity. We see that the median value, as well as one SD around it, is fully placed above the chance diagonal. The 95% confidence intervals (presented by 2 SD around the mean ROC curve expands below the chance diagonal mostly at the bottom left point. This could mean that the model is more likely to express higher sensitivity but lower specificity.", "The model\u2019s sensitivity is the proportion of patients that were identified correctly to have the disease (i.e. True Positive) upon the total number of patients who actually have the disease. The model\u2019s specificity describes the proportion of patients that were identified correctly to not have the disease (i.e. True Negative) upon the total number of patients who do not have the disease. Usually, these two display an inverse relation.", "It depends. However, it is common in diagnostic experiments to favor sensitivity- thus not missing any actually ill patients (and risking falsely diagnosing healthy patients). However, such a decision is highly related to the nature of the hypothesis (Parikh et al., 2008).", "In this tutorial, we have built an LSTM model to classify ADHD patients from healthy controls via rs-fMRI. We have discussed hypothesis testing and demonstrated its benefits in a diagnostic experiment.", "Borlase, N., Melzer, T. R., Eggleston, M. J., Darling, K. A., & Rucklidge, J. J. (2019). Resting-state networks and neurometabolites in children with ADHD after 10 weeks of treatment with micronutrients: results of a randomised placebo-controlled trial. Nutritional neuroscience, 1\u201311.", "Dvornek, N. C., Ventola, P., Pelphrey, K. A., & Duncan, J. S. (2017, September). Identifying autism from resting-state fMRI using long short-term memory networks. In International Workshop on Machine Learning in Medical Imaging (pp. 362\u2013370). Springer, Cham.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F300c1f3e9697&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@gili.karni?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gili.karni?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Gili Karni"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5028088c0074&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&user=Gili+Karni&userId=5028088c0074&source=post_page-5028088c0074----300c1f3e9697---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.americanhealthimaging.com/brain-scan-help-diagnose-adhd/", "anchor_text": "American health imaging"}, {"url": "https://medium.com/@gili.karni/exploring-cognitive-differences-via-resting-state-networks-2112bf5291e2", "anchor_text": "Identifying resting-state networks from fMRI data using ICAs for a preprocessing tutorial"}, {"url": "https://github.com/karnigili/NetworksNeuroscience", "anchor_text": "here"}, {"url": "https://nilearn.github.io/", "anchor_text": "nilearn"}, {"url": "https://scikit-learn.org/stable/index.html", "anchor_text": "sklearn"}, {"url": "https://keras.io/", "anchor_text": "keras"}, {"url": "https://stats.stackexchange.com/questions/181/how-to-choose-the-number-of-hidden-layers-and-nodes-in-a-feedforward-neural-netw", "anchor_text": "here"}, {"url": "https://www.quora.com/Why-is-it-common-in-Neural-Network-to-have-a-decreasing-number-of-neurons-as-the-Network-becomes-deeper", "anchor_text": "here"}, {"url": "https://www.dlology.com/blog/quick-notes-on-how-to-choose-optimizer-in-keras/", "anchor_text": "here"}, {"url": "https://cs231n.github.io/neural-networks-3/", "anchor_text": "CS231n"}, {"url": "https://towardsdatascience.com/the-fall-of-rnn-lstm-2d1594c74ce0", "anchor_text": "https://towardsdatascience.com/the-fall-of-rnn-lstm-2d1594c74ce0"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----300c1f3e9697---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/lstm?source=post_page-----300c1f3e9697---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/fmri?source=post_page-----300c1f3e9697---------------fmri-----------------", "anchor_text": "Fmri"}, {"url": "https://medium.com/tag/hypothesis-testing?source=post_page-----300c1f3e9697---------------hypothesis_testing-----------------", "anchor_text": "Hypothesis Testing"}, {"url": "https://medium.com/tag/adhd?source=post_page-----300c1f3e9697---------------adhd-----------------", "anchor_text": "Adhd"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&user=Gili+Karni&userId=5028088c0074&source=-----300c1f3e9697---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&user=Gili+Karni&userId=5028088c0074&source=-----300c1f3e9697---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F300c1f3e9697&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----300c1f3e9697---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----300c1f3e9697--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----300c1f3e9697--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----300c1f3e9697--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gili.karni?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gili.karni?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gili Karni"}, {"url": "https://medium.com/@gili.karni/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "44 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5028088c0074&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&user=Gili+Karni&userId=5028088c0074&source=post_page-5028088c0074--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8f7f053a5137&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fclassifying-adhd-from-healthy-controls-using-lstms-with-rs-fmri-data-300c1f3e9697&newsletterV3=5028088c0074&newsletterV3Id=8f7f053a5137&user=Gili+Karni&userId=5028088c0074&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}