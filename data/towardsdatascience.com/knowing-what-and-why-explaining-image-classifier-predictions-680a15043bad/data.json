{"url": "https://towardsdatascience.com/knowing-what-and-why-explaining-image-classifier-predictions-680a15043bad", "time": 1683004079.2315469, "path": "towardsdatascience.com/knowing-what-and-why-explaining-image-classifier-predictions-680a15043bad/", "webpage": {"metadata": {"title": "Knowing What and Why? \u2014 Explaining Image Classifier Predictions | by Piotr Skalski | Towards Data Science", "h1": "Knowing What and Why? \u2014 Explaining Image Classifier Predictions", "description": "It is a fact that with every year Machine Learning (ML) is becoming an increasingly important part of our lives. ML helps us to perform simple daily tasks like finding the optimal route to home\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/SkalskiP/ILearnDeepLearning.py/tree/master/02_data_science_toolkit/03_explaining_image_classifier_predictions", "anchor_text": "GitHub", "paragraph_index": 2}, {"url": "https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf", "anchor_text": "AlexNet", "paragraph_index": 5}, {"url": "https://towardsdatascience.com/gentle-dive-into-math-behind-convolutional-neural-networks-79a07dd44cf9", "anchor_text": "Gentle Dive into Math Behind Convolutional Neural Networks", "paragraph_index": 6}, {"url": "https://github.com/TeamHG-Memex/eli5", "anchor_text": "Eli5", "paragraph_index": 7}, {"url": "https://arxiv.org/abs/1610.02391", "anchor_text": "Grad-CAM", "paragraph_index": 8}, {"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "CAM", "paragraph_index": 8}, {"url": "https://arxiv.org/abs/1602.04938", "anchor_text": "hy Should I Trust You?: Explaining the Predictions of Any Classifier", "paragraph_index": 11}, {"url": "https://towardsdatascience.com/simple-method-of-creating-animated-graphs-127c11f58cc5", "anchor_text": "other articles", "paragraph_index": 23}, {"url": "https://twitter.com/PiotrSkalski92", "anchor_text": "Twitter", "paragraph_index": 23}, {"url": "https://medium.com/@piotr.skalski92", "anchor_text": "Medium", "paragraph_index": 23}, {"url": "https://github.com/SkalskiP", "anchor_text": "GitHub", "paragraph_index": 23}, {"url": "https://www.kaggle.com/skalskip", "anchor_text": "Kaggle", "paragraph_index": 23}, {"url": "http://makesense.ai", "anchor_text": "makesense.ai", "paragraph_index": 25}], "all_paragraphs": ["It is a fact that with every year Machine Learning (ML) is becoming an increasingly important part of our lives. ML helps us to perform simple daily tasks like finding the optimal route to home, accurately scanning documents with our phone or translating the text into different languages. However, it is also used as a key element in many highly responsible systems, where human life and well-being is at stake.", "As we implement systems similar to those mentioned above, it is becoming progressively clear that we must provide not only predictions but also explanations as to what influenced our decision. In this post, I\u2019ll compare and benchmark the most commonly used libraries for explaining the model predictions in the field of Image Classification \u2014 Eli5, LIME, and SHAP. We are going to investigate the algorithms that they leverage, as well as compare the efficiency and quality of the provided explanations.", "Note: Because I don\u2019t want to bore you with scrolling through the huge snippets of code, I\u2019ve only put a tiny part of it in the article. However, if you would like to create similar visualizations, or learn how to explain your classifier\u2019s predictions, I encourage you to visit my GitHub.", "Before we start, let\u2019s answer the most basic \u2014 but at the same time an important \u2014 question. Why do we even need explanations? Can\u2019 t we just interpret the model\u2019s predictions to understand what influenced them? Well, unfortunately, in many cases, the answer is no\u2026", "We can argue that there is a trade-off between the complexity of a model and its interpretability. And since some problems \u2014 especially in the field of Computer Vision \u2014 are highly complicated, we have to use strong and complex models to solve them. These types of models are often referred to as Black Boxes because we do not know or understand what is happening inside them. Thus, it often happens that we sacrifice interpretability in favor of the accuracy of our model.", "As I mentioned in the first paragraph, in this project we will deal with Image Classification models. It is one of the oldest and best-recognized Computer Vision (CV) tasks \u2014 it involves assigning a label with the name of the object class to a photo. Despite its apparent simplicity, this is a task that has caused enormous problems for researchers over the years. The breakthrough idea was AlexNet \u2014 Convolutional Neural Network (CNN), used for the first time in the ImageNet competition in 2012. AlexNet beat the other participants with an error that was about 10 percentage points lower. This solution revolutionized Computer Vision forever. Since then, CNN has become the default answer for all tasks in this branch of research. Unfortunately, CNN is an example of the Black Box \u2014 although we know the transformations taking place inside it, their full interpretation is a problem even for experts in the field.", "Note: If you want to explore CNN deeper, I strongly encourage you to read my other post \u2014 Gentle Dive into Math Behind Convolutional Neural Networks.", "The first library we will look into is Eli5 \u2014 it\u2019s a simple but reliable tool designed to visualize, inspect and debug ML models. The library allows, among other things, to interpret the predictions of Image Classifiers written in Keras. To do it, Eli5 leverages Gradient-weighted Class Activation Mapping (Grad-CAM) algorithm. It is worth noting that this is not a general approach and it applies only to CNN solutions.", "Grad-CAM is the next iteration of the CAM, which was one of the first ideas for visualizing the predictions of CNN. It\u2019s using the values of activation maps as well as backpropagation to understand the source of the prediction.", "A Filter map (or Activation map) is a result of applying one of the convolution kernels to layer input. Depending on values inside filters, they react to different patterns. What is important, the convolutional layers located at different depths of the CNN react to different levels of detail of the objects they look at. Layers lying shallowly react to simple shapes \u2014 lines at different angles, surfaces with the same brightness. On the other hand, deep layers of CNN light up in response to the presence of specific, complex patterns. Besides, most often the activation maps in deep CNN layers have a lower resolution than those at the beginning of the graph.", "Grad-CAM explanations are obtained by performing a linear weighted combination of forward-activation maps followed by a ReLU. Coefficients of the linear equation are calculated by averaging the gradient of score obtained for given classes (before Softmax), in relation to the feature map activations.", "Why Should I Trust You?: Explaining the Predictions of Any Classifier is an article that underlies the entire branch of research aimed at explaining ML models. The ideas included in this paper became the foundation for the most popular of the interpretation libraries \u2014 Local interpretable model-agnostic explanations (LIME). This algorithm is completely different from Grad-CAM \u2014 tries to understand the model by perturbating the input data and understanding how these changes affect the predictions.", "This time our goal is to replace the complex Black Box model with a simple, interpretable, linear one. Of course, the new model is only an approximation of the original but chosen so that it faithfully represents it locally. The first step in this direction is to divide the image into super-pixels \u2014 groups of neighboring pixels with similar color and brightness. Such an approach makes sense because the classification of a photo is probably determined by many pixels, so perturbation of single one would have a marginal impact on the prediction. Then we create a collection of artificial photos created by replacing random super-pixels of the original photo with grey color.", "We also define a function \u03c0 that will allow us to determine the level of similarity between the original image and a sample, where D is cosine distance between images and \u03c3 is the width of the image. To calculate this metric, we flatten our digital photo and treat it as a vector. Then we calculate the cosine of the angle between the vectors representing the two images being compared.", "Now all you need to do is find the prediction of the original model for the input image f(x) as well as the predictions of a linear model for perturbated images g(z\u2019) and solve the weighted regression defined by L.", "One of the key features we certainly expect from our dream explanation library is robustness. We want two almost identical images to give a very close explanation. It turns out, however, that LIME is highly unstable in this aspect.", "To verify this, I conducted an experiment \u2014 I explained the predictions of the Image Classifier, for two almost identical images. The second picture was created by adding a tiny amount of Gauss noise to the original one \u2014 so small that the probability obtained from the model almost does not change, and the images are indistinguishable to the naked eye. However, the difference in the explanations turned out to be significant.", "SHapley Additive exPlanations (SHAP) and LIME are quite similar \u2014 both are additive and model-agnostic methods of explaining individual predictions. SHAP however, aims to explain model prediction for given input by computing the contribution of each feature to this prediction. To achieve this goal, SHAP uses Shapley Values, which originally comes from game theory.", "First of all, to better understand the analyzed algorithm, let us explain what is Shapley Value. It is a method described by Shapley (1953) as a way of assigning a reward to game players based on their contribution to total gain. The idea has been transferred to SHAP as a way of assessing which of the features has the greatest contribution to the resulting prediction of the model. It is described as the average marginal contribution of a feature value across all possible coalitions. Coalition vector z\u2019 assigns a value of 0 or 1 to each feature, defining whether it is present in the coalition. These vectors are mapped to the feature space using the function h \u2014 for images, the function fills in grey super-pixels, for which the corresponding vector value is 0.", "KernelSHAP it\u2019s a combination of ideas, known from LIME but with the use of Shapley Values. Similarly, as with LIME, we use super-pixels \u2014 to limit the number of features, combining pixels of similar color and brightness. We also use a weighted regression to build a linear model, where each super-pixel represents a single feature of our model.", "The key difference lies in the selection of the regression model weights. For LIME, it was a cosine measure between the original and the perturbed image, while for KernelSHAP, the weights are determined using the following formula, where M is the maximum coalition and |z\u2019| is the number of features in a considered coalition.", "We will use the wall time, necessary to perform the model explanation, as our metric of library performance. To avoid the influence of factors unrelated to the interpretation of the prediction, we will relly on the average time for 100 individual cases. The obtained values are listed below. Tests were performed on a computer without a GPU, equipped with a processor Intel(R) Core(TM) i7\u20137700HQ CPU @ 2.80GHz.", "Congratulations if you managed to get here. Big thanks for the time spent reading this article. If you liked the post, consider sharing it with your friend, or two friends or five friends. I hope this article turned out to be helpful and now you know how to explain the predictions of your Image Classifier.", "This article is another part of the \u201cData Science Toolkit\u201d series, if you haven\u2019t had the opportunity yet, read the other articles. Also, if you like my job so far, follow me on Twitter and Medium and see other projects I\u2019m working on, on GitHub and Kaggle. Stay curious!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Growth Engineer @ Roboflow / Founder @ makesense.ai"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F680a15043bad&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://skalskip.medium.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": ""}, {"url": "https://skalskip.medium.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Piotr Skalski"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11b65705ec0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&user=Piotr+Skalski&userId=11b65705ec0&source=post_page-11b65705ec0----680a15043bad---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/SkalskiP/ILearnDeepLearning.py/tree/master/02_data_science_toolkit/03_explaining_image_classifier_predictions", "anchor_text": "GitHub"}, {"url": "https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf", "anchor_text": "AlexNet"}, {"url": "https://towardsdatascience.com/gentle-dive-into-math-behind-convolutional-neural-networks-79a07dd44cf9", "anchor_text": "Gentle Dive into Math Behind Convolutional Neural Networks"}, {"url": "https://github.com/TeamHG-Memex/eli5", "anchor_text": "Eli5"}, {"url": "https://arxiv.org/abs/1610.02391", "anchor_text": "Grad-CAM"}, {"url": "https://arxiv.org/abs/1512.04150", "anchor_text": "CAM"}, {"url": "https://github.com/SkalskiP/ILearnDeepLearning.py/blob/master/02_data_science_toolkit/03_explaining_image_classifier_predictions/01_coco_res_net/coco-resnet-keras-resnet-34-eli5.ipynb", "anchor_text": "full example"}, {"url": "https://arxiv.org/abs/1602.04938", "anchor_text": "hy Should I Trust You?: Explaining the Predictions of Any Classifier"}, {"url": "https://github.com/SkalskiP/ILearnDeepLearning.py/blob/master/02_data_science_toolkit/03_explaining_image_classifier_predictions/01_coco_res_net/coco-resnet-keras-resnet-34-lime.ipynb", "anchor_text": "full example"}, {"url": "https://github.com/SkalskiP/ILearnDeepLearning.py/blob/master/02_data_science_toolkit/03_explaining_image_classifier_predictions/01_coco_res_net/coco-resnet-keras-resnet-34-shap.ipynb", "anchor_text": "full example"}, {"url": "https://towardsdatascience.com/simple-method-of-creating-animated-graphs-127c11f58cc5", "anchor_text": "other articles"}, {"url": "https://twitter.com/PiotrSkalski92", "anchor_text": "Twitter"}, {"url": "https://medium.com/@piotr.skalski92", "anchor_text": "Medium"}, {"url": "https://github.com/SkalskiP", "anchor_text": "GitHub"}, {"url": "https://www.kaggle.com/skalskip", "anchor_text": "Kaggle"}, {"url": "https://github.com/SkalskiP/ILearnDeepLearning.py", "anchor_text": ""}, {"url": "https://github.com/SkalskiP/make-sense", "anchor_text": ""}, {"url": "https://twitter.com/PiotrSkalski92", "anchor_text": ""}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----680a15043bad---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----680a15043bad---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----680a15043bad---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----680a15043bad---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----680a15043bad---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&user=Piotr+Skalski&userId=11b65705ec0&source=-----680a15043bad---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&user=Piotr+Skalski&userId=11b65705ec0&source=-----680a15043bad---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F680a15043bad&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----680a15043bad---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----680a15043bad--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----680a15043bad--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----680a15043bad--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----680a15043bad--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----680a15043bad--------------------------------", "anchor_text": ""}, {"url": "https://skalskip.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://skalskip.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Piotr Skalski"}, {"url": "https://skalskip.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4.7K Followers"}, {"url": "http://makesense.ai", "anchor_text": "makesense.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11b65705ec0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&user=Piotr+Skalski&userId=11b65705ec0&source=post_page-11b65705ec0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffd74b5c17627&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fknowing-what-and-why-explaining-image-classifier-predictions-680a15043bad&newsletterV3=11b65705ec0&newsletterV3Id=fd74b5c17627&user=Piotr+Skalski&userId=11b65705ec0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}