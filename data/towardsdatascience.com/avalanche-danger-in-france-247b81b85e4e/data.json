{"url": "https://towardsdatascience.com/avalanche-danger-in-france-247b81b85e4e", "time": 1683012614.931775, "path": "towardsdatascience.com/avalanche-danger-in-france-247b81b85e4e/", "webpage": {"metadata": {"title": "Avalanche danger in France. Visualization of geospatial data in\u2026 | by Kamila Hamalcikova | Towards Data Science", "h1": "Avalanche danger in France", "description": "Which mountain ranges are the most dangerous in France for hikers and alpinists? This was my main question, because I recently moved to Grenoble which is basically french hiking paradise\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.anena.org/5041-bilan-des-accidents.htm#par42276", "anchor_text": "ANENA", "paragraph_index": 1}, {"url": "https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/", "anchor_text": "shapefile of communes in France", "paragraph_index": 1}, {"url": "https://github.com/Kamila-Hamalcikova/Avalanche_danger_in_France", "anchor_text": "my GitHub repo Avalanche danger in France.", "paragraph_index": 2}, {"url": "https://geopandas.org/install.html", "anchor_text": "GeoPandas", "paragraph_index": 4}, {"url": "https://docs.bokeh.org/en/latest/docs/installation.html", "anchor_text": "Bokeh", "paragraph_index": 4}, {"url": "https://github.com/Kamila-Hamalcikova/Avalanche_danger_in_France", "anchor_text": "GitHub repo", "paragraph_index": 15}, {"url": "https://docs.bokeh.org/en/latest/docs/gallery/texas.html", "anchor_text": "Bokeh library with quite similar visualization", "paragraph_index": 30}, {"url": "https://www.linkedin.com/in/kamila-hamalcikova/", "anchor_text": "https://www.linkedin.com/in/kamila-hamalcikova/", "paragraph_index": 35}], "all_paragraphs": ["Which mountain ranges are the most dangerous in France for hikers and alpinists? This was my main question, because I recently moved to Grenoble which is basically french hiking paradise.", "Unfortunately, only regional data I have found about mountain accidents where yearly avalanche accidents from reports of ANENA (organization for study of snow and avalanches in France) divided by communes (small administrative units in France). This was the second best thing to mountain accidents grouped by mountain ranges, which I was unable to find, so as in poker or tetris I played the hand I was dealt and searched for shapefile of communes in France (luckily, official sources of french gouvernment did not let me down). These were only two pieces for my visualization \u201cpuzzle\u201d I needed to start coding in Jupyter Notebook to create interactive map of avalanche accidents in France in last 10 years.", "All files with source data and code in Jupyter notebook can be found in my GitHub repo Avalanche danger in France.", "Assuming you have already standard Python libraries like Pandas and Numpy installed, for handling geospatial data and shapefiles I needed to add GeoPandas and Bokeh.", "In my case (Windows with Anaconda) magical words for my command line were; conda install geopandas and conda install bokeh, as it is advised in documentation of GeoPandas and Bokeh libraries.", "Previously, I used twice term shapefile without further explanation, which is kind of mean and I don\u2019t wanna be mean girl, so\u2026", "Shapefile format means geospatial data in form of points, lines or polygons, typically used in GIS (Geografic Information System). Extension for shapefile is .shp, but for display of data you need actually 3 files in a folder, .shp, .shx and .dbf.", "If polygon sounds more like a name for spaceship Jean-Luc Piccard had to fly, while his Enterprise was being repaired, you will have better idea from following example. This is polygon for french commune Asni\u00e8res-sur-Oise (polygon the most close to spaceship I could find after few random trials).", "Here, we can see that polygons or geospatial data from GeoDataFrames in general can be displayed in same fashion as rows in classic Pandas DataFrame, using iloc method. For image of polygon we need to look for column with active geometry, where are data stored in form of GPS coordinates. (Column with active geometry will be most likely named geometry.)", "Column with coordinate system (geometry) is what sets apart GeoDataFrame in GeoPandas from other DataFrames in Pandas.", "Reading and viewing GeoDataFrame is very similar to simple DataFrame (except for already mentioned neccesity of having .shp, .shx and .dbf files in one folder in order to load shapefile):", "Both pieces of my visualization puzzle (shapefile with all communes and avalanche accidents report) need to have one joining column. It is commune (NOM_COM in gdf GeoDataFrame and commune in avalanche DataFrame).", "Unfortunately, names of communes in GeoDataFrame and DataFrame were written using different guidelines for upper/lowercase letters, special french characters (\u00e9, \u00e0, \u00e7 etc.) and sometimes even mixed use of hyphens vs. blank spaces.", "Therefore I changed all commune names to lowercase with str.lower( ) method and replaced special french characters to avoid double versions of same commune name.", "Ideally, all commune names from avalanche DataFrame should be also in gdf GeoDataFrame, but it was not the case because of several reasons:", "First three problems I solved by simple name changes in either gdf GeoDataframe or avalanche DataFrame. It was time consuming, but because it is quite specific only for my case and not especially linked to geospatial data, I will not go into details about it here (anyway, more details can be found in my GitHub repo).", "Last problem with polygons not always derived from shape you need, is something you might encouter when dealing with geospatial data too. Here we can see that commune Chamonix Mont Blanc consists of 4 different polygons.", "It can be solved by using dissolve function which creates new polygons based on chosen column, (example: dissolve(by=\u201dcolumn_x\u201d)). Commune boundaries are defined as GeoDataFrame keeping only columns we want to keep. Buffer is created to avoid intersection of new polygons.", "Now, I finally had perfect polygons derived from communes. But I also needed sum of avalanche accidents for each commune. Simple groupby() function and creating new dataframe would do the trick:", "Of course, one little cosmetic change was needed for ugly column name 0.", "Finally, I could merge data in gdf GeoDataFrame with cumulative avalanche report in aval_final DataFrame.", "NaN values are communes without any avalanche reported in last 10 years. Later, when using Bokeh we would need to transform this GeoDataFrame into GeoJSON format. This would trigger error, because NaN values are not recognized as JSON object. Therefore, I will replace all NaN by string \u201cNo avalanche\u201d with fillna() function and verify that no NaN appear in GeoDataFrame after.", "If you stuck for so long reading this article, I think you deserve one more cool photo of French Alps before attacking final step of creating visualization in Bokeh library.", "Bokeh library uses GeoJSON format for data visualization, so I need to convert final GeoDataFrame to GeoJSON format.", "Unlike most Python libraries, elements in Bokeh library need to be imported separately in groups. In code below I import all elements I will use, but there are many more options.", "Next, I will chose color settings. There is plenty of color palettes in Bokeh documentation. In color_mapper min and max of vis values are chosen as well as color outside of chosen palette (nan_color) to represent NaN values or more precisely string \u201cNo avalanche\u201d in our GeoJSON.", "I also used major_label_overrides to highlight that only communes with at least one 1 avalanche accident are included in color palette. Without using this feature all communes with 0 up to 4 avalanches would end up in one group with same color which would be visually quite unclear and confusing.", "For final visualization we need to create figure object.", "Method patches() is used to plot shapes of communes in the graph. Apart from defining x and y coordinates, source as our GeoJSON we also need to specify fill_color. Our color has to change on each polygon, therefore I use dictionary with keys field and transform. Field values are variable we want to plot, transform values are color groups for this variable.", "In tooltips of hovertool we chose data shown to user while cursor is moved on the map (in my case it is name of commune and total of avalanche accidents so columns commune and count_of_avalanche_accidents).", "If you still find something unclear in code above, I recommend to check Bokeh library with quite similar visualization.", "Finally, I saved final visualization as separate html file, but if you want to show graph directly in Jupyter Notebook you can use instead of save() function show(). Just don\u2019t forget to import the function before from bokeh.io.", "Anyone would probably guess that most avalanche accidents appeared in French Alps in area around Mont Blanc and Pyrenees mountains near borders with Spain. For me, it was suprising to find out that avalanches did appear also in Alsace region or Massif Central and one case did happen even on island of Corsica.", "One downside of having map visualization with so many polygons is quite slow zooming and need for extra storage on GitHub in case you would like to post it there. On the other hand, the map is very detailed and precise.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data analyst & BI consultant specialized in spatial data, Python, Alteryx and data visualizations https://www.linkedin.com/in/kamila-hamalcikova/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F247b81b85e4e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kamila.hamalcikova?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kamila.hamalcikova?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Kamila Hamalcikova"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68fd4870e44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&user=Kamila+Hamalcikova&userId=68fd4870e44&source=post_page-68fd4870e44----247b81b85e4e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.anena.org/5041-bilan-des-accidents.htm#par42276", "anchor_text": "ANENA"}, {"url": "https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/", "anchor_text": "shapefile of communes in France"}, {"url": "https://github.com/Kamila-Hamalcikova/Avalanche_danger_in_France", "anchor_text": "my GitHub repo Avalanche danger in France."}, {"url": "https://geopandas.org/install.html", "anchor_text": "GeoPandas"}, {"url": "https://docs.bokeh.org/en/latest/docs/installation.html", "anchor_text": "Bokeh"}, {"url": "https://github.com/Kamila-Hamalcikova/Avalanche_danger_in_France", "anchor_text": "GitHub repo"}, {"url": "https://docs.bokeh.org/en/latest/docs/gallery/texas.html", "anchor_text": "Bokeh library with quite similar visualization"}, {"url": "https://www.anena.org/5041-bilan-des-accidents.htm#par42276", "anchor_text": "Anena.org"}, {"url": "https://www.data.gouv.fr/fr/datasets/decoupage-administratif-communal-francais-issu-d-openstreetmap/", "anchor_text": "Data.gouv.org"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "TowardsDataScience.com"}, {"url": "https://www.earthdatascience.org/workshops/gis-open-source-python/dissolve-polygons-in-python-geopandas-shapely/", "anchor_text": "EarthDataScience.org"}, {"url": "https://gis.stackexchange.com/questions/287064/dissolve-causes-no-shapely-geometry-can-be-created-from-null-value-in-geopanda/287065", "anchor_text": "gis.stackexchange.com"}, {"url": "https://stackoverflow.com/questions/59797292/deleting-inner-lines-of-polygons-after-dissolving-in-geopandas", "anchor_text": "Stackoverflow.com"}, {"url": "https://medium.com/tag/avalanche?source=post_page-----247b81b85e4e---------------avalanche-----------------", "anchor_text": "Avalanche"}, {"url": "https://medium.com/tag/bokeh?source=post_page-----247b81b85e4e---------------bokeh-----------------", "anchor_text": "Bokeh"}, {"url": "https://medium.com/tag/jupyter-notebook?source=post_page-----247b81b85e4e---------------jupyter_notebook-----------------", "anchor_text": "Jupyter Notebook"}, {"url": "https://medium.com/tag/france?source=post_page-----247b81b85e4e---------------france-----------------", "anchor_text": "France"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----247b81b85e4e---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&user=Kamila+Hamalcikova&userId=68fd4870e44&source=-----247b81b85e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&user=Kamila+Hamalcikova&userId=68fd4870e44&source=-----247b81b85e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F247b81b85e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----247b81b85e4e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----247b81b85e4e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----247b81b85e4e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----247b81b85e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kamila.hamalcikova?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kamila.hamalcikova?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kamila Hamalcikova"}, {"url": "https://medium.com/@kamila.hamalcikova/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "176 Followers"}, {"url": "https://www.linkedin.com/in/kamila-hamalcikova/", "anchor_text": "https://www.linkedin.com/in/kamila-hamalcikova/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68fd4870e44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&user=Kamila+Hamalcikova&userId=68fd4870e44&source=post_page-68fd4870e44--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fdf323303fa2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Favalanche-danger-in-france-247b81b85e4e&newsletterV3=68fd4870e44&newsletterV3Id=df323303fa2&user=Kamila+Hamalcikova&userId=68fd4870e44&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}