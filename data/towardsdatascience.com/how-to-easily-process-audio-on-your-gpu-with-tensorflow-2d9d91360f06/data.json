{"url": "https://towardsdatascience.com/how-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06", "time": 1683005079.684041, "path": "towardsdatascience.com/how-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06/", "webpage": {"metadata": {"title": "How to Easily Process Audio on Your GPU with TensorFlow | by David Schwertfeger | Towards Data Science", "h1": "How to Easily Process Audio on Your GPU with TensorFlow", "description": "Leverage the power of your GPU and build a custom audio preprocessing-layer to use in any Neural Network with TensorFlow\u2019s signal-processing module."}, "outgoing_paragraph_urls": [{"url": "https://librosa.github.io/librosa/", "anchor_text": "librosa", "paragraph_index": 1}, {"url": "https://essentia.upf.edu/", "anchor_text": "Essentia", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/how-to-build-efficient-audio-data-pipelines-with-tensorflow-2-0-b3133474c3c1", "anchor_text": "set up an efficient audio-data pipeline", "paragraph_index": 7}, {"url": "https://arxiv.org/abs/1905.00078", "anchor_text": "A popular feature representation across audio-domains", "paragraph_index": 11}, {"url": "https://en.wikipedia.org/wiki/Mel_scale", "anchor_text": "mel-scale", "paragraph_index": 12}, {"url": "https://www.tensorflow.org/api_docs/python/tf/signal/stft", "anchor_text": "tf.signal.stft(signals)", "paragraph_index": 17}, {"url": "https://www.tensorflow.org/api_docs/python/tf/math/abs", "anchor_text": "tf.abs()", "paragraph_index": 19}, {"url": "https://www.tensorflow.org/api_docs/python/tf/signal/linear_to_mel_weight_matrix", "anchor_text": "tf.signal.linear_to_mel_weight_matrix()", "paragraph_index": 24}, {"url": "https://en.wikipedia.org/wiki/Decibel", "anchor_text": "decibel", "paragraph_index": 28}, {"url": "https://librosa.github.io/librosa/_modules/librosa/core/spectrum.html#power_to_db", "anchor_text": "librosa.power_to_db", "paragraph_index": 29}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/Layer", "anchor_text": "tf.keras.layers.Layer", "paragraph_index": 33}, {"url": "https://www.tensorflow.org/tutorials/customization/custom_layers#implementing_custom_layers", "anchor_text": "implement three methods", "paragraph_index": 33}, {"url": "https://github.com/keunwoochoi/kapre", "anchor_text": "Kapre", "paragraph_index": 37}, {"url": "https://arxiv.org/abs/1706.05781", "anchor_text": "present a benchmark", "paragraph_index": 37}], "all_paragraphs": ["Deep Learning on audio data often requires a heavy preprocessing step.", "While some models run on raw audio signals, others expect a time-frequency presentation as input. Preprocessing is often done as a separate step, before model training, with tools like librosa or Essentia.", "But, as you start working with larger datasets, this workflow presents a challenge.", "Anytime you change parameters, like sample-rate or FFT-size, you need to process the whole dataset again before you can resume training.", "Even when parallelized onto available CPU-cores, preprocessing can take a long time. Plus, you need to consider how to store and access files for different parameters. This undoubtedly wastes disk space and mental resources and can quickly become a headache.", "Does any of this sound familiar?", "Tired of this tedious two-step process, I started to ask myself if there wasn\u2019t a better way.", "I recently set up an efficient audio-data pipeline which enables me to load audio from file paths into models on-demand.", "And I wanted to use the same data pipeline for spectrogram-based models, too.", "In this post, I want to share with you:", "Read on to find out more.", "A popular feature representation across audio-domains in Deep Learning applications is the mel-spectrogram.", "A mel-spectrogram is a visual representation of a signal\u2019s frequency spectrum over time. The main difference to a standard spectrogram is that frequencies are projected onto the mel-scale, where the perceived distance of pitches equals the distance of mel-frequencies. This is inspired by how we hear.", "Likewise, the mel-spectrogram\u2019s magnitudes are generally logarithmically scaled because this is closer to how we perceive changes in loudness. So, a more precise term would be log-magnitude mel-scaled spectrogram. But because this is quite a mouthful, most people call it log-mel-spectrogram or mel-spectrogram for short. It\u2019s worth pointing out, though, that although mel refers to the frequency-scale, log describes the scale of the magnitudes.", "So, how can you transform your raw audio signals into mel-spectrograms?", "Let\u2019s look at each step in detail.", "The short-time Fourier transform (STFT) divides a long signal into shorter segments, often called frames, and computes the spectrum for each frame. The frames typically overlap to minimize data-loss at the edges. Joining the spectra for each frame creates the spectrogram.", "To compute the STFT with TensorFlow, use tf.signal.stft(signals) where signals is a tensor containing your audio signals.", "Some parameters you need to set are:", "The STFT from the previous step returns a tensor of complex values. Use tf.abs() to compute the magnitudes.", "We can now plot the magnitude-spectrogram.", "Note that you won\u2019t see much before properly scaling the magnitudes, though. The second subplot is scaled with librosa.amplitude_to_db(). So, technically, it's a log-magnitude power-spectrogram.", "More about that in step 5.", "Transforming standard spectrograms to mel-spectrograms involves warping frequencies to the mel-scale and combining FFT bins to mel-frequency bins.", "You can create a mel-filterbank which warps linear-scale spectrograms to the mel-scale with tf.signal.linear_to_mel_weight_matrix().", "You only need to set a few parameters:", "Multiply the squared magnitude-spectrograms with the mel-filterbank and you get mel-scaled power-spectrograms.", "We perceive changes in loudness logarithmically. So, in this last step, we want to scale the mel-spectrograms\u2019 magnitudes logarithmically, too.", "One way to do that would be taking the log of the mel-spectrograms. But that might get you into trouble because log(0) is undefined. Instead, you want to convert the magnitudes to decibel (dB) units in a numerically stable way.", "Here\u2019s how to do that in TensorFlow based on librosa.power_to_db.", "After conversion to log-scale, the spectrograms\u2019 maximum values are zero and the smallest values negative top_db.", "Now here comes the fun part.", "Combining the individual steps into a custom preprocessing layer allows you to feed raw audio to your network and compute mel-spectrograms on-the-fly on your GPU.", "To create your mel-spectrogram layer (or any custom layer), you subclass from tf.keras.layers.Layer and implement three methods:", "Here\u2019s my implementation of a custom Keras layer that transforms raw audio to log-mel-spectrograms:", "Once defined, you can add audio preprocessing to your neural networks in one line (8).", "Now, you may be wondering if it isn\u2019t incredibly inefficient to transform the same audio signals into spectrograms again and again.", "While writing this post, I came across Kapre, a library of \u201cKeras layers for audio and music signal preprocessing.\u201d The authors, Choi et al., present a benchmark that shows, their preprocessing layers add about 20 percent overhead.", "So, it\u2019s a trade-off. Like almost anything in life.", "In this case, you trade storage space for slightly longer computation time. But not only that. You also get rid of a tedious two-step process and instantly gain more flexibility in training your Deep Learning models on audio data.", "Trying different preprocessing parameters is now as simple as restarting your training routine with different parameters.", "All the code and examples are available in this Colab notebook:", "What is a workflow you have simplified (or like to simplify) that is giving you more flexibility and mental space, although it\u2019s slightly more expensive?", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2d9d91360f06&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://davidschwertfeger.medium.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": ""}, {"url": "https://davidschwertfeger.medium.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "David Schwertfeger"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47fff5db2f66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&user=David+Schwertfeger&userId=47fff5db2f66&source=post_page-47fff5db2f66----2d9d91360f06---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@hishahadat?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Shahadat Rahman"}, {"url": "https://unsplash.com/s/photos/signal-flow?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://librosa.github.io/librosa/", "anchor_text": "librosa"}, {"url": "https://essentia.upf.edu/", "anchor_text": "Essentia"}, {"url": "https://towardsdatascience.com/how-to-build-efficient-audio-data-pipelines-with-tensorflow-2-0-b3133474c3c1", "anchor_text": "set up an efficient audio-data pipeline"}, {"url": "https://towardsdatascience.com/how-to-build-efficient-audio-data-pipelines-with-tensorflow-2-0-b3133474c3c1", "anchor_text": "How to Build Efficient Audio-Data Pipelines with TensorFlow 2.0Use TensorFlow\u2019s Dataset API to eliminate bottlenecks in your training workflowtowardsdatascience.com"}, {"url": "https://arxiv.org/abs/1905.00078", "anchor_text": "A popular feature representation across audio-domains"}, {"url": "https://en.wikipedia.org/wiki/Mel_scale", "anchor_text": "mel-scale"}, {"url": "https://en.wikipedia.org/wiki/Short-time_Fourier_transform", "anchor_text": "short-time Fourier transform"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/signal/stft", "anchor_text": "tf.signal.stft(signals)"}, {"url": "https://en.wikipedia.org/wiki/Fast_Fourier_transform", "anchor_text": "FFT"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/math/abs", "anchor_text": "tf.abs()"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/signal/linear_to_mel_weight_matrix", "anchor_text": "tf.signal.linear_to_mel_weight_matrix()"}, {"url": "https://en.wikipedia.org/wiki/Decibel", "anchor_text": "decibel"}, {"url": "https://librosa.github.io/librosa/_modules/librosa/core/spectrum.html#power_to_db", "anchor_text": "librosa.power_to_db"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/Layer", "anchor_text": "tf.keras.layers.Layer"}, {"url": "https://www.tensorflow.org/tutorials/customization/custom_layers#implementing_custom_layers", "anchor_text": "implement three methods"}, {"url": "https://github.com/keunwoochoi/kapre", "anchor_text": "Kapre"}, {"url": "https://arxiv.org/abs/1706.05781", "anchor_text": "present a benchmark"}, {"url": "https://bit.ly/2QEBKEJ", "anchor_text": "Google Colab: How to Process Audio on Your GPU with TensorFlowA complimentary notebook to experience this post interactively.colab.research.google.com"}, {"url": "https://arxiv.org/abs/1905.00078", "anchor_text": "1"}, {"url": "https://arxiv.org/pdf/1706.05781.pdf", "anchor_text": "2"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2d9d91360f06---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----2d9d91360f06---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/audio?source=post_page-----2d9d91360f06---------------audio-----------------", "anchor_text": "Audio"}, {"url": "https://medium.com/tag/technology?source=post_page-----2d9d91360f06---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2d9d91360f06---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&user=David+Schwertfeger&userId=47fff5db2f66&source=-----2d9d91360f06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&user=David+Schwertfeger&userId=47fff5db2f66&source=-----2d9d91360f06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2d9d91360f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2d9d91360f06---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2d9d91360f06--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2d9d91360f06--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2d9d91360f06--------------------------------", "anchor_text": ""}, {"url": "https://davidschwertfeger.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://davidschwertfeger.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David Schwertfeger"}, {"url": "https://davidschwertfeger.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "108 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47fff5db2f66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&user=David+Schwertfeger&userId=47fff5db2f66&source=post_page-47fff5db2f66--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F68b9babc543b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-easily-process-audio-on-your-gpu-with-tensorflow-2d9d91360f06&newsletterV3=47fff5db2f66&newsletterV3Id=68b9babc543b&user=David+Schwertfeger&userId=47fff5db2f66&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}