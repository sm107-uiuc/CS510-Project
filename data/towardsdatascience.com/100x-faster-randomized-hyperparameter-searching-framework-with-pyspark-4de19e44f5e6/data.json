{"url": "https://towardsdatascience.com/100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6", "time": 1683003475.8488698, "path": "towardsdatascience.com/100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6/", "webpage": {"metadata": {"title": "100x faster Hyperparameter Search Framework with Pyspark | by Rahul Agarwal | Towards Data Science", "h1": "100x faster Hyperparameter Search Framework with Pyspark", "description": "Manual tuning was not an option since I had to tweak a lot of parameters. Hyperopt was also not an option as it works serially i.e. at a time, only a single model is being built. So it was taking up\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/automate-hyperparameter-tuning-for-your-models-71b18f819604", "anchor_text": "Hyperopt", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/the-hitchhikers-guide-to-handle-big-data-using-spark-90b9be0fe89a", "anchor_text": "post", "paragraph_index": 10}, {"url": "https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/7664398068420572/3438177909678058/3797400441762013/latest.html", "anchor_text": "Notebook", "paragraph_index": 26}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/spark_hyperparams_tuning", "anchor_text": "GitHub", "paragraph_index": 26}, {"url": "https://coursera.pxf.io/yRPoZB", "anchor_text": "\u201cHow to win a data science competition\u201d", "paragraph_index": 27}, {"url": "https://medium.com/@rahul_agarwal?source=post_page---------------------------", "anchor_text": "Medium", "paragraph_index": 28}, {"url": "http://eepurl.com/dbQnuX?source=post_page---------------------------", "anchor_text": "blog", "paragraph_index": 28}, {"url": "https://twitter.com/MLWhiz?source=post_page---------------------------", "anchor_text": "@mlwhiz", "paragraph_index": 28}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 31}], "all_paragraphs": ["Recently I was working on tuning hyperparameters for a huge Machine Learning model.", "Manual tuning was not an option since I had to tweak a lot of parameters. Hyperopt was also not an option as it works serially i.e. at a time, only a single model is being built. So it was taking up a lot of time to train each model and I was pretty short on time.", "I had to come up with a better more efficient approach if I were to meet the deadline. So I thought of the one thing that helps us data scientists in many such scenarios \u2014 Parallelization.", "Can I parallelize my model hyperparameter search process?", "As you would have guessed, the answer is Yes.", "This post is about setting up a hyperparameter tuning framework for Data Science using scikit-learn/xgboost/lightgbm and pySpark.", "Before we get to implementing the hyperparameter search, we have two options to set up the hyperparameter search \u2014 Grid Search or Random search.", "The figure above gives a definitive answer as to why Random search is better.", "Let\u2019s say we have to tune two hyperparameters for our Machine Learning model. One is not important, and one is very important. In a grid search, we look at three settings for the important parameter. While in a randomized search, we search through 9 settings for the important parameter. And the amount of time we spent is the same.", "Since, Randomized search, searches more thoroughly through the whole space and provides us with better hyperparameters, we will go with it in our example.", "At my workplace, I have access to a pretty darn big cluster with 100s of nodes. It is a data Scientist\u2019s dream. But in this post, I am going to be using the Databricks Community Edition Free server with a toy example. If you want to set up this small server for yourself for practice, check out my post on Spark.", "You can choose to load your data using Spark, but here I start by creating our own classification data to set up a minimal example which we can work with.", "The train_sp spark dataset looks like:", "So now we have got our training dataset in Spark. And we want to run multiple models on this DataFrame.", "Spark is inherently good with Key-Value pairs. That is all data with a particular key could be sent to a single machine. And we can apply functions to that data.", "But we want all our data on every machine. How do we do that?", "We replicate our data n times and add a replication_id to our data so that each key has all the data.", "Ok, now we can send the whole data to multiple machines using groupby on replication_id. But how do we use pandas and scikit learn on that data?", "The answer is: we use pandas_udf. This functionality was introduced in the Spark version 2.3.1. And this allows you to utilise pandas functionality with Spark.", "If you don\u2019t understand this yet, do look at the code as sometimes it is easier to understand the code.", "We first replicate our train dataframe 100 times here by using cross_join with a data frame that contains a column with 1\u2013100 replication_id.", "We also define a function that takes as input a pandas dataframe, gets random hyperparameters using the python random module, runs a model on data(Here I am training a scikit model, but you can replace it with any model like XGBoost or Lightgbm as well) and returns the result in the form of a Pandas Dataframe. Do take a look at the function and the comments.", "We can now apply this pandas_udf function to our replicated dataframe using:", "What the above code does is that it sends all the data with the same replication id to a single machine and applies the function run_model to the data. The above call happens lazily so you won\u2019t be able to see the results till you run the below action call.", "For this toy example, the accuracy results may look pretty close to one another, but they will differ in the case of noisy real-world datasets. Since all of these 100 models run in parallel on different nodes, we can save a lot of time when doing random hyperparameter search.", "The speedup factor certainly depends on how many nodes you have in your cluster. For me, I had 100 machines at my disposal, so I got ~ 100x speedup.", "You can get the full code in this Databricks Notebook or get it from my GitHub repository where I keep codes for all my posts.", "If you want to learn more about practical data science, do take a look at the \u201cHow to win a data science competition\u201d Coursera course. I learned a lot of new things from this course taught by one of the most prolific Kaggler.", "Thanks for the read. I am going to be writing more beginner-friendly posts in the future too. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Also, a small disclaimer \u2014 There might be some affiliate links in this post to relevant resources as sharing knowledge is never a bad idea.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4de19e44f5e6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----4de19e44f5e6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=1539416", "anchor_text": "Pixabay"}, {"url": "https://towardsdatascience.com/automate-hyperparameter-tuning-for-your-models-71b18f819604", "anchor_text": "Hyperopt"}, {"url": "https://towardsdatascience.com/the-hitchhikers-guide-to-handle-big-data-using-spark-90b9be0fe89a", "anchor_text": "post"}, {"url": "https://unsplash.com/@frankvex?utm_source=medium&utm_medium=referral", "anchor_text": "Frank Vessia"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/7664398068420572/3438177909678058/3797400441762013/latest.html", "anchor_text": "Notebook"}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/spark_hyperparams_tuning", "anchor_text": "GitHub"}, {"url": "https://coursera.pxf.io/yRPoZB", "anchor_text": "\u201cHow to win a data science competition\u201d"}, {"url": "https://medium.com/@rahul_agarwal?source=post_page---------------------------", "anchor_text": "Medium"}, {"url": "http://eepurl.com/dbQnuX?source=post_page---------------------------", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz?source=post_page---------------------------", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4de19e44f5e6---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4de19e44f5e6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/programming?source=post_page-----4de19e44f5e6---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----4de19e44f5e6---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/technology?source=post_page-----4de19e44f5e6---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----4de19e44f5e6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----4de19e44f5e6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4de19e44f5e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4de19e44f5e6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4de19e44f5e6--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F100x-faster-randomized-hyperparameter-searching-framework-with-pyspark-4de19e44f5e6&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}