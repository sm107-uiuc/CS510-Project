{"url": "https://towardsdatascience.com/ai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44", "time": 1683012941.923764, "path": "towardsdatascience.com/ai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44/", "webpage": {"metadata": {"title": "AI in Finance: how to finally start to believe your backtests [1/3] | by Alex Honchar | Towards Data Science", "h1": "AI in Finance: how to finally start to believe your backtests [1/3]", "description": "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 0}, {"url": "https://medium.com/swlh/ai-in-finance-advanced-idea-research-and-evaluation-beyond-backtests-d4d7bb185854", "anchor_text": "financial idea discovery", "paragraph_index": 1}, {"url": "https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089", "anchor_text": "Dr. L\u00f3pez De Prado", "paragraph_index": 4}, {"url": "https://github.com/Rachnog/Advanced-Deep-Trading/tree/master/backtest_metrics", "anchor_text": "my GitHub", "paragraph_index": 4}, {"url": "https://newyork.qwafafew.org/wp-content/uploads/sites/4/2015/10/Luo_20150128.pdf", "anchor_text": "Seven Sins of Quantitative Investing", "paragraph_index": 5}, {"url": "https://neurons-lab.com/", "anchor_text": "Neurons Lab", "paragraph_index": 7}, {"url": "https://github.com/Rachnog/Advanced-Deep-Trading/tree/master/backtest_metrics", "anchor_text": "the source code", "paragraph_index": 28}, {"url": "https://bitclout.com/u/alexrachnog", "anchor_text": "support me on Bitclout", "paragraph_index": 29}, {"url": "https://www.facebook.com/rachnogstyle.blog", "anchor_text": "Facebook", "paragraph_index": 29}, {"url": "https://www.linkedin.com/in/alexandr-honchar-4423b962/", "anchor_text": "Linkedin", "paragraph_index": 29}, {"url": "http://instagram.com/rachnogstyle", "anchor_text": "Instagram", "paragraph_index": 29}], "all_paragraphs": ["Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Quantitative research is a process with many intermediate steps, each of which has to be carefully and thoroughly validated. Asset selection, data collection, feature extraction, modeling \u2014 all these phases take time and are delivered and tested by different teams. But what at the end the investor wants to see? That \u201cflawless\u201d backtest on historical data with high Sharpe ratio, alpha with respect to the market, and maybe some fund-related metrics as capacity, leverage, average AUM, etc. However, such an approach doesn\u2019t tell us anything about the future performance of the strategy and such backtests can be easily overfitted and are even dangerous when they\u2019re used as a measure of \u201csuccess\u201d of a trading idea (see more details in my article on financial idea discovery).", "There is nothing easier than producing a backtest of a strategy that performs well in the past, but will you risk and bet your capital on it? Most of investors do.", "In the next couple of articles, I would like to completely review the idea of testing the trading strategy itself.", "Like most of my recent articles, this one is inspired by books of Dr. L\u00f3pez De Prado and I recommend them to dive deeper into the topic. As always, the source could you can find on my GitHub.", "In 2014 a team of practitioners at Deutsche Bank, led by Yin Luo, released a work called \u201cSeven Sins of Quantitative Investing\u201d. It talks about things you have most probably already have heard about: survivorship bias, look-ahead bias, storytelling, data snooping, transaction costs, outliers, and short issues. I expect that we already know how to get the right data and process it right, not to look into the future, and perform feature importance analysis instead of explaining random patterns on the backtest.", "However, to that crucially important list, I would like to add some additional moments that are doubting the idea of the backtest itself:", "To summarize, even if we have avoided the deadly sins by the guys from the Deutsche Bank, our backtest tells us only about how some set of rules would\u2019ve performed in the past and nothing else. That\u2019s why it\u2019s crucially important to have a richer strategy evaluation toolkit that allows probabilistic, scenario-based, and risk-focused approach, that we employ at Neurons Lab and which we are going to develop and test out within these couple of articles.", "Let\u2019s define a typical forecasting-based strategy: there is a signal source of going long or short on some instrument and we act accordingly. For simplicity, we will perform a typical time series forecasting exercise: taking N previous days, extract the factors, predict price change for the next day, and trade. This is a very primitive scenario, that doesn\u2019t take into account transaction costs, slippage, shorts, take-profit, and stop-loss barriers, but let us focus on the discovery of a market understanding principles first, and on the execution later \u2014 we will always have time to discard a strategy because of bad fit to the market/exchange rules.", "Let\u2019s focus on the banking sector and will learn the signals for speculation with such tickers as C, DB, BAC, WFC, and other known banks. Because of their crush in the 2008 crisis, it will be interesting to see how our ML models will deal with this regime change. We will rely mainly on the statistical factors that we will group into 3 categories:", "We will extract these factors in rolling window fashion (statistical ones on the fractionally-differentiated time series) and sample inputs and outputs with respect to the iid rule. The input will be rolling features \u201ctoday\u201d, prediction \u2014 fixed horizon close price change for the next day.", "Following the advice of Dr. L\u00f3pez de Prado, we will use the bagging of decision trees, with a correction towards iid sampling. We will expect that ensembling will help to deal with overfitting and tree-based model will help in further feature importance analysis. In general, we want to keep the forecasting model as simple as possible, focusing on the quality of our factor insights.", "We will train our model on 5 years of data, then trade with this model for the next 3 years and after that repeat the process until the data ends (from 2000 to 2020). This way we supposed to fit to constantly changing regimes at least to some extent.", "Let\u2019s start with Deutsche Bank (DB) ticker and run the above-mentioned strategy and calculate returns, strategy performance, and Sharpe ratio of the benchmark (buy-and-hold) compared to the ML strategy.", "Looks pretty good, but what actual insights do we get from this backtest? Literally none! Maybe our model just has overfitted to tell \u201cshort\u201d signal almost all the time on the bearish market and will fail horribly in the future :) Let\u2019s review more interesting metrics that could help us to understand model\u2019s performance in more detail!", "First, let\u2019s calculate all the above-mentioned metrics both for the benchmark and the strategy on DB ticker:", "We can see, that in terms of main performance and information value metrics our ML-based strategy indeed outperforms baseline! What about overfitting? Probabilistic SR equals 1.0, which means the discovery is true, and deflated SR (calculated from multiple runs of Bagging model) also equals 1.0 which confirms that our model is also adequate. Average MCC is pretty high and even divided by the standard deviation of MCCs (some sort of SR for accuracy score) has high value. What about feature importance? We can see, that some features are stable at the bottom of the importance, and some are very high. We see empirically, that volume-based factors are performing well on this ticker.", "If we already calculate feature importance, why we don\u2019t apply it for making the results better? For example, we could remove the bottom-3 least important features (assuming they mean nothing). Will it change the performance?", "Visually we can confirm, that out updated strategy with updated feature set (it\u2019s re-evaluated every 5 years) beats our baseline of ML strategy that uses all the features. From the metrics points of view, we also see the improvement but note the MRTL (Minimum Required Track Record Length) feature that now tells us that we need many more days of observing both strategies to indeed confirm the boost (and it makes sense since they\u2019re extremely correlated). Also, note the drop in the average certainty \u2014 removing some features could actually hurt the model.", "Now we need to ensure that our strategy and hypothesis about the non-linear dependency of given features can hold on other banking tickers.", "Well\u2026 it doesn\u2019t look very well. If we examine the metrics in detail, we can see that this is a clear fault of ML models. \u201cImportant\u201d features also differ a lot from the Deutsche Bank example. Maybe it\u2019s just one outlier, let\u2019s try the next one!", "The next try is also not profitable at all! However, here the situation is even more tricky: MCC metrics are not negative (even very close to zero), but strategy performance is horrible. Let\u2019s check more examples, but for now, it\u2019s worth considering the idea that Deutsche Bank's example was just a lucky one.", "Check the graphs! Do you see it? Finally, we got it right! Wait, let me check that deflated SR? Zero? Sign of overfitting\u2026 and what about MCCs? Again close to zero! Do we really think that a model that is almost random could beat our benchmark so good? No way we can trust this result!", "Alright, if it worked so well on DB, maybe it is about being in Europe? Let\u2019s check Credit Suisse stocks then! And\u2026 we fail again :)", "Just for curiosity, I\u2019ve tried the strategy with another European bank \u2014 HSBC, and visually it looked very positive, but again, the devil lies in the model performance and MCCs \u2014 we just got lucky here again with ML models that actually didn\u2019t learn anything useful.", "I wanted to finish experiments on a positive note, however, miracles, if happen, not in quantitative finance, especially if we measure everything right ;) Good-looking from the performance and MCC strategy, unfortunately, has deflated SR of zero \u2014 a big chance of not performing well out-of-sample. Also, it performs worse with removed bottom features, which is weird by itself.", "The main outcome of the work we did is straightforward \u2014 we have learned how to evaluate a backtest of an ML-based strategy from many more dimensions than we used to. We need to fight overfitting, multiple comparisons, and \u201cblack-boxness\u201d of our models and to fix these issues we need to spot them first. New proposed statistics do the following:", "However, the results were discouraging but I hope, no one expected that we can actually beat the market and create new economic findings with a couple of formulas from the book :) Checking important features we could see, that there is no consensus between different tickers \u2014 all the time different factors are in the top, which doesn\u2019t allow us to build a strong theory about statistical factors that drive banking stocks. What we could do to actually make it right?", "In the next blog post, we will dive much deeper into the notions we have introduced today. Instead of calculation of those numbers on one historical dataset, we will develop schemes for simulations and data augmentations and will come up not with the point estimates, but with probabilistic interpretations. Who knows, maybe our models performed badly on one time series realization, but at the scale, they\u2019re pretty reliable? Stay tuned and don\u2019t forget to check out the source code :)", "P.S.If you found this content useful and perspective, you can support me on Bitclout. You also can connect with me on the Facebook blog or Linkedin, where I regularly post some AI articles or news that are too short for Medium and Instagram for some more personal content :)", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1613ad81ea44&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://alexrachnog.medium.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": ""}, {"url": "https://alexrachnog.medium.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Alex Honchar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1b1fb9c5ea70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&user=Alex+Honchar&userId=1b1fb9c5ea70&source=post_page-1b1fb9c5ea70----1613ad81ea44---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3544431", "anchor_text": "https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3544431"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/swlh/ai-in-finance-advanced-idea-research-and-evaluation-beyond-backtests-d4d7bb185854", "anchor_text": "financial idea discovery"}, {"url": "https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089", "anchor_text": "Dr. L\u00f3pez De Prado"}, {"url": "https://github.com/Rachnog/Advanced-Deep-Trading/tree/master/backtest_metrics", "anchor_text": "my GitHub"}, {"url": "https://newyork.qwafafew.org/wp-content/uploads/sites/4/2015/10/Luo_20150128.pdf", "anchor_text": "Seven Sins of Quantitative Investing"}, {"url": "https://neurons-lab.com/", "anchor_text": "Neurons Lab"}, {"url": "https://mlfinlab.readthedocs.io/", "anchor_text": "https://mlfinlab.readthedocs.io/"}, {"url": "https://www.keyquant.com/Download/GetFile?Filename=%5CPublications%5CKeyQuant_WhitePaper_APT_Part2.pdf", "anchor_text": "this paper"}, {"url": "https://mlfinlab.readthedocs.io/", "anchor_text": "https://mlfinlab.readthedocs.io/"}, {"url": "https://mlfinlab.readthedocs.io/", "anchor_text": "https://mlfinlab.readthedocs.io/"}, {"url": "https://medium.com/@alexrachnog/neural-networks-for-algorithmic-trading-hyperparameters-optimization-cb2b4a29b8ee", "anchor_text": "this article of mine"}, {"url": "https://github.com/Rachnog/Advanced-Deep-Trading/tree/master/backtest_metrics", "anchor_text": "the source code"}, {"url": "https://bitclout.com/u/alexrachnog", "anchor_text": "support me on Bitclout"}, {"url": "https://www.facebook.com/rachnogstyle.blog", "anchor_text": "Facebook"}, {"url": "https://www.linkedin.com/in/alexandr-honchar-4423b962/", "anchor_text": "Linkedin"}, {"url": "http://instagram.com/rachnogstyle", "anchor_text": "Instagram"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1613ad81ea44---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1613ad81ea44---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/finance?source=post_page-----1613ad81ea44---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----1613ad81ea44---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/trading?source=post_page-----1613ad81ea44---------------trading-----------------", "anchor_text": "Trading"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&user=Alex+Honchar&userId=1b1fb9c5ea70&source=-----1613ad81ea44---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&user=Alex+Honchar&userId=1b1fb9c5ea70&source=-----1613ad81ea44---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1613ad81ea44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1613ad81ea44---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1613ad81ea44--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1613ad81ea44--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1613ad81ea44--------------------------------", "anchor_text": ""}, {"url": "https://alexrachnog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://alexrachnog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alex Honchar"}, {"url": "https://alexrachnog.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "10K Followers"}, {"url": "https://neurons-lab.medium.com/", "anchor_text": "https://neurons-lab.medium.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1b1fb9c5ea70&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&user=Alex+Honchar&userId=1b1fb9c5ea70&source=post_page-1b1fb9c5ea70--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F987a529ced30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fai-in-finance-how-to-finally-start-to-believe-your-backtests-1-3-1613ad81ea44&newsletterV3=1b1fb9c5ea70&newsletterV3Id=987a529ced30&user=Alex+Honchar&userId=1b1fb9c5ea70&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}