{"url": "https://towardsdatascience.com/handling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab", "time": 1683000229.251015, "path": "towardsdatascience.com/handling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab/", "webpage": {"metadata": {"title": "Handling Class imbalanced data using a loss specifically made for it | by Vandit Jain | Towards Data Science", "h1": "Handling Class imbalanced data using a loss specifically made for it", "description": "This article is a review of the paper by Google titled, Class-Balanced Loss Based on Effective Number of Samples that was accepted at\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/vandit15/Class-balanced-loss-pytorch", "anchor_text": "GitHub", "paragraph_index": 1}], "all_paragraphs": ["TL;DR \u2014 It proposes a class-wise re-weighting scheme for most frequently used losses (softmax-cross-entropy, focal loss, etc.) giving a quick boost of accuracy, especially when working with data that is highly class imbalanced.", "Link to implementation of this paper(using PyTorch) \u2014 GitHub", "While handling a long-tailed dataset (one that has most of the samples belonging to very few of the classes and many other classes have very less support), deciding how to weight the loss for different classes can be tricky. Often, the weighting is set to the inverse of class support or inverse of the square root of class support.", "However, as the above figure shows, this overshoots because as the number of samples increases, the additional benefit of a new data point diminishes. There is a high chance that a newly added sample is a near-duplicate of existing samples, primarily when heavy data-augmentation(such as re-scaling, random cropping, flipping, etc.) is used while training neural networks. Re-weighting by Effective number of samples gives a better result.", "Effective number of samples can be imagined as the actual volume that will be covered by n samples where the total volume N is represented by total samples.", "Here, we make an assumption that a new sample will interact with the volume of previously sampled data in two ways only: either wholly covered or wholly outside(shown in the figure above). With this assumption, the above expression can be easily proved using induction(refer to the paper for proof).", "We can also write it as below:", "This means jth sample contributes Beta^(j-1) to the Effective number of samples.", "Another implication from the above equation is En = 1 if Beta = 0. Also, En \u2192 n as Beta \u2192 1. The latter can be easily proved using L\u2019Hopital\u2019s rule. This means when N is huge, the effective number of samples is the same as the number of samples n. In such a case, the number of unique prototypes N is large, and every sample is unique. Whereas, if N=1, this means all data can be represented by one prototype.", "Without extra information, we cannot set separate values of Beta for every class, therefore, using whole data, we will set it to a particular value (customarily set as one of 0.9, 0.99, 0.999, 0.9999).", "Thus, the class balanced loss can be written as:", "Here, L(p,y) can be any loss function.", "The original version of focal loss has an alpha-balanced variant. Instead of that, we will re-weight it using the effective number of samples for every class.", "Similarly, such a re-weighting term can be applied to other famous losses as well (sigmoid-cross-entropy, softmax-cross-entropy etc.)", "Before coming to implementation, a point to note while training with sigmoid-based losses \u2014 initialise the bias of the last layer with b = -log(C-1) where C is the number of classes instead of 0. This is because setting b=0 induces a huge loss at the beginning of the training as the output probability for each class is close to 0.5. So, instead, we can assume the class prior is 1/C and set value of b accordingly.", "Above lines of code is a simple implementation of getting weights and normalising them.", "Here, we get the one hot values for the weights so that they can be multiplied with the Loss value separately for every class.", "Class balancing provides significant gains, especially when the dataset is highly imbalanced (Imbalance = 200, 100).", "Using the concept of Effective Number of Samples, we can tackle the problem of data overlap. Since we don\u2019t make any assumptions about the dataset itself, therefore the re-weighting terms are generally applicable across several datasets and several loss functions. Thus, the problem of class imbalance can be tackled with a more proper structure, and this is important since most of the real-world datasets suffer from a tremendous amount of data imbalance.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6e58fd65ffab&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@vandit_15?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vandit_15?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Vandit Jain"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd74000cb9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&user=Vandit+Jain&userId=d74000cb9d0&source=post_page-d74000cb9d0----6e58fd65ffab---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://openaccess.thecvf.com/content_CVPR_2019/html/Cui_Class-Balanced_Loss_Based_on_Effective_Number_of_Samples_CVPR_2019_paper.html", "anchor_text": "Class-Balanced Loss Based on Effective Number of Samples"}, {"url": "https://github.com/vandit15/Class-balanced-loss-pytorch", "anchor_text": "GitHub"}, {"url": "https://arxiv.org/abs/1901.05555", "anchor_text": "https://arxiv.org/abs/1901.05555"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6e58fd65ffab---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----6e58fd65ffab---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----6e58fd65ffab---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/cvpr-2019?source=post_page-----6e58fd65ffab---------------cvpr_2019-----------------", "anchor_text": "Cvpr 2019"}, {"url": "https://medium.com/tag/loss-function?source=post_page-----6e58fd65ffab---------------loss_function-----------------", "anchor_text": "Loss Function"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&user=Vandit+Jain&userId=d74000cb9d0&source=-----6e58fd65ffab---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&user=Vandit+Jain&userId=d74000cb9d0&source=-----6e58fd65ffab---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6e58fd65ffab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6e58fd65ffab---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6e58fd65ffab--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vandit_15?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vandit_15?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Vandit Jain"}, {"url": "https://medium.com/@vandit_15/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "236 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd74000cb9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&user=Vandit+Jain&userId=d74000cb9d0&source=post_page-d74000cb9d0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff3b483522866&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-class-imbalanced-data-using-a-loss-specifically-made-for-it-6e58fd65ffab&newsletterV3=d74000cb9d0&newsletterV3Id=f3b483522866&user=Vandit+Jain&userId=d74000cb9d0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}