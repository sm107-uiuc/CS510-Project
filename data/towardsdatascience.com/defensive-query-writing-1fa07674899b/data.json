{"url": "https://towardsdatascience.com/defensive-query-writing-1fa07674899b", "time": 1683009324.739501, "path": "towardsdatascience.com/defensive-query-writing-1fa07674899b/", "webpage": {"metadata": {"title": "Defensive Query Writing. Using defensive coding principles to\u2026 | by Kovid Rathee | Towards Data Science", "h1": "Defensive Query Writing", "description": "Derived from defensive programming, defensive query writing is a practice which tries to make sure that a query run doesn\u2019t fail. Just like in application development, try to remove the scope for\u2026"}, "outgoing_paragraph_urls": [{"url": "https://owasp.org/www-community/attacks/SQL_Injection", "anchor_text": "OWASP", "paragraph_index": 8}, {"url": "https://linktr.ee/kovid", "anchor_text": "I have found these to be extremely useful while working on data systems", "paragraph_index": 14}, {"url": "https://kovidrathee.medium.com/membership", "anchor_text": "https://kovidrathee.medium.com/membership", "paragraph_index": 16}], "all_paragraphs": ["Derived from defensive programming, defensive query writing is a practice which tries to make sure that a query run doesn\u2019t fail. Just like in application development, try to remove the scope for silly mistakes and control unforeseen circumstances. Sometimes the decision comes down to whether you want your query to fail or you want it to run even if with some incorrect data. I\u2019ll share a couple of simple examples where we can employ these practices while writing queries.", "Take the very basic example of creating and dropping database objects. Rather than using a CREATE TABLE xyz, use CREATE TABLE IF NOT EXISTS xyz (id int) or if you want to recreate the table losing all the data you can run DROP TABLE IF EXISTS xyz and then CREATE TABLE IF NOT EXISTS xyz (id int).", "The same practice can be used with the creation and deletion of databases, views, indexes, triggers, procedures, functions and more. I have come to realize that in most cases, using this is helpful.", "Prevent yourself from getting ambiguous column errors. See in the example below, the column city might be present both in TABLE_1 and TABLE_2. How do you expect the database to know which field you want it to pick up.", "It\u2019s generally a very good practice to create aliases for database objects and then access those database objects and their child objects using the alias rather than the complete name. Obviously for doing this efficiently, you\u2019d need to follow a SQL Style Sheet. I have written more about it here \u2014", "No, I\u2019m not talking about using LIMIT to restrict the number of records in your final query. Rather, I am talking about queries like this.", "The LIMIT clause in the subquery returning a column is important because it prevents the query from failing if the subquery returns more than one row, that is, if there is more than one record in TABLE_2 for every record in TABLE_1. This is a really useful trick to write better queries.", "Using LIMIT comes with a caveat though. If you\u2019re unsure about data quality or you don\u2019t understand the database sufficiently, using LIMIT can often give you incorrect answers. In some cases, you\u2019d rather like to have an error thrown when a job fails than an incorrect result set returned by the query.", "Believe it or not, SQL injections are still very popular. In the recent years, many popular companies have found themselves at the mercy of hackers attacking with SQL injections. There are very specific ways on how to prevent your application from hit by such attacks. The most resourceful website on this topic is OWASP.", "The idea behind prevention of these attacks is to securely parameterize your queries by using prepared statements or by making use of stored procedures. Even these solutions call for strict validation checks before running queries \u2014 the use of special characters, escape characters and so on.", "I have had my troubles with triggers. I once tried to build a lightweight data transformation pipeline on triggers fired from production databases. What was I thinking, right? It was lightweight and it could have worked longer but it didn\u2019t because of some bugs (most probably regarding transaction boundaries) in the application which never got solved. Even though that didn\u2019t succeed, I\u2019m still really very fond of triggers but they do bring their own pain.", "One has to be extra careful in making sure that triggers are not interdependent and there are no circular triggers possible in the database application.", "Always try to mock your production queries into SELECT statements, even if you\u2019re trying to DELETE or UPDATE. Doing that will give you a fair idea on what you\u2019re actually going to do when you DELETE or UPDATE. I have found this method to be really useful over the years. This definitely adds another time (at times) consuming step but I think it has its benefits over the additional cost.", "Aside form mocking, you have to run the same DELETE and UPDATE statements in your dev/test environments so that you can sign-off on them before doing anything drastic on production.", "These were some of the suggestion from my end. I have found these to be extremely useful while working on data systems. On similar lines, I have also talked about a lot of good and easy SQL tips for improving database query performance here \u2014", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I write about tech, Indian classical music, literature, and the workplace among other things. 1x engineer on weekdays. https://kovidrathee.medium.com/membership"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1fa07674899b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@kovidrathee", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://kovidrathee.medium.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": ""}, {"url": "https://kovidrathee.medium.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Kovid Rathee"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F13d513db037&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&user=Kovid+Rathee&userId=13d513db037&source=post_page-13d513db037----1fa07674899b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@chaikong2511?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Somchai Kongkamsri"}, {"url": "https://www.pexels.com/photo/police-army-commando-special-task-force-20258/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://towardsdatascience.com/how-to-avoid-writing-sloppy-sql-43647a160025", "anchor_text": "How To Avoid Writing Sloppy SQLMaking your SQL code more readable and easy to understandtowardsdatascience.com"}, {"url": "https://owasp.org/www-community/attacks/SQL_Injection", "anchor_text": "OWASP"}, {"url": "https://owasp.org/www-community/attacks/SQL_Injection", "anchor_text": "SQL InjectionA SQL injection attack consists of insertion or \"injection\" of a SQL query via the input data from the client to the\u2026owasp.org"}, {"url": "https://linktr.ee/kovid", "anchor_text": "I have found these to be extremely useful while working on data systems"}, {"url": "https://towardsdatascience.com/easy-fixes-for-sql-queries-ff9d8867a617", "anchor_text": "Easy Fixes For SQL QueriesRules of thumb for querying any traditional relational databasetowardsdatascience.com"}, {"url": "https://medium.com/tag/data?source=post_page-----1fa07674899b---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/tag/software-development?source=post_page-----1fa07674899b---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/security?source=post_page-----1fa07674899b---------------security-----------------", "anchor_text": "Security"}, {"url": "https://medium.com/tag/programming?source=post_page-----1fa07674899b---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----1fa07674899b---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&user=Kovid+Rathee&userId=13d513db037&source=-----1fa07674899b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&user=Kovid+Rathee&userId=13d513db037&source=-----1fa07674899b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1fa07674899b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1fa07674899b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1fa07674899b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1fa07674899b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1fa07674899b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1fa07674899b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1fa07674899b--------------------------------", "anchor_text": ""}, {"url": "https://kovidrathee.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://kovidrathee.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kovid Rathee"}, {"url": "https://kovidrathee.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3.1K Followers"}, {"url": "https://kovidrathee.medium.com/membership", "anchor_text": "https://kovidrathee.medium.com/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F13d513db037&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&user=Kovid+Rathee&userId=13d513db037&source=post_page-13d513db037--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8154c41b0f77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdefensive-query-writing-1fa07674899b&newsletterV3=13d513db037&newsletterV3Id=8154c41b0f77&user=Kovid+Rathee&userId=13d513db037&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}