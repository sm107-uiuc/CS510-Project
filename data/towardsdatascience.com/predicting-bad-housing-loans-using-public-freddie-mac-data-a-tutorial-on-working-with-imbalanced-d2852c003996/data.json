{"url": "https://towardsdatascience.com/predicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996", "time": 1683003360.721835, "path": "towardsdatascience.com/predicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996/", "webpage": {"metadata": {"title": "Predicting Bad Housing Loans using Public Freddie Mac Data \u2014 a tutorial on working with imbalanced data | by Matthew C. F. Tso | Towards Data Science", "h1": "Predicting Bad Housing Loans using Public Freddie Mac Data \u2014 a tutorial on working with imbalanced data", "description": "Freddie Mac is a US government-sponsored enterprise that buys single-family housing loans and bundled them to sell it as mortgage-backed securities. This secondary mortgage market increases the\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.freddiemac.com/research/datasets/sf_loanlevel_dataset.page", "anchor_text": "dataset", "paragraph_index": 1}, {"url": "https://lightgbm.readthedocs.io/en/latest/Parameters.html#objective-parameters", "anchor_text": "LightGBM", "paragraph_index": 7}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.metrics.balanced_accuracy_score.html", "anchor_text": "balanced accuracy score", "paragraph_index": 8}, {"url": "https://pypi.org/project/imbalanced-learn/", "anchor_text": "imbalanced-learn", "paragraph_index": 11}, {"url": "https://lightgbm.readthedocs.io/en/latest/Parameters.html#objective-parameters", "anchor_text": "LightGBM", "paragraph_index": 11}, {"url": "https://towardsdatascience.com/@Tsomatthew", "anchor_text": "my other work on medium", "paragraph_index": 13}, {"url": "http://www.github.com/tsofoon/", "anchor_text": "Github", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/matttso/", "anchor_text": "LinkedIn", "paragraph_index": 13}], "all_paragraphs": ["Freddie Mac is a US government-sponsored enterprise that buys single-family housing loans and bundled them to sell it as mortgage-backed securities. This secondary mortgage market increases the supply of money available for new housing loans. However, if a large number of loans go default, it will have a ripple effect on the economy as we saw in the 2008 financial crisis. Therefore there is an urgent need to develop a machine learning pipeline to predict whether or not a loan could go default when the loan is originated.", "In this analysis, I use data from the Freddie Mac Single-Family Loan Level dataset. The dataset is composed of two parts: (1) the loan origination data which contains all the information when the loan is started and (2) the loan repayment data that record every payment of the loan and any adverse event such as delayed payment or even a sell-off. I primarily use the repayment data to track the terminal outcome of the loans and the origination data to predict the outcome. The origination data contains the following classes of fields:", "Traditionally, a subprime loan is defined by an arbitrary cut-off for a credit score of 600 or 650. But this approach is problematic, i.e. the 600 cutoff only accounted for ~10% of bad loans and 650 only accounted for ~40% of bad loans. My hope is that additional features from the origination data would perform better than a hard cut-off of credit score.", "The goal of this model is thus to predict whether a loan is bad from the loan origination data. Here I define a \u201cgood\u201d loan is one that has been fully paid off and a \u201cbad\u201d loan is one that was terminated by any other reason. For simplicity, I only examine loans that originated from 1999\u20132003 and have already been terminated so we don\u2019t have to deal with the middle-ground of on-going loans. Among them, I will use a separate pool of loans from 1999\u20132002 as the training and validation sets; and data from 2003 as the testing set.", "The biggest challenge from this dataset is how imbalance the outcome is, as bad loans only made up of roughly 2% of all the terminated loans. Here I will demonstrate four ways to tackle it:", "The approach here is to sub-sample the majority class so that its number roughly matches the minority class so that the new dataset is balanced. This approach seems to be working ok with a 70\u201375% F1 score under a list of classifiers(*) that were tested. The advantage of the under-sampling is you are now working with a smaller dataset, which makes training faster. On the flip side, since we are only sampling a subset of data from the good loans, we may miss out on some of the characteristics that could define a good loan.", "(*) Classifiers used: SGD, Random Forest, AdaBoost, Gradient Boosting, a hard voting classifier from all of the above, and LightGBM", "Similar to under-sampling, oversampling means resampling the minority group (bad loans in our case) to match the number on the majority group. The advantage is that you are generating more data, thus you can train the model to fit even better than the original dataset. The disadvantages, however, are slowing training speed due to the larger data set and overfitting caused by over-representation of a more homogenous bad loans class. For the Freddie Mac dataset, many of the classifiers showed a high F1 score of 85\u201399% on the training set but crashed to below 70% when tested on the testing set. The sole exception is LightGBM, whose F1 score on all training, validation and testing sets exceed 98%.", "The problem with under/oversampling is that it is not a realistic strategy for real-world applications. It is impossible to predict whether a loan is bad or not at its origination to under/oversample. Therefore we cannot use the two aforementioned approaches. As a sidenote, accuracy or F1 score would bias towards the majority class when used to evaluate imbalanced data. Thus we will have to use a new metric called balanced accuracy score instead. While accuracy score is as we know (TP+TN)/(TP+FP+TN+FN), the balanced accuracy score is balanced for the true identity of the class such that (TP/(TP+FN)+TN/(TN+FP))/2.", "3. Turn it into an Anomaly Detection Problem", "In a lot of times classification with an imbalanced dataset is actually not that different from an anomaly detection problem. The \u201cpositive\u201d cases are so rare that they are not well-represented in the training data. If we can catch them as an outlier using unsupervised learning techniques, it could provide a potential workaround. For the Freddie Mac dataset, I used Isolation Forest to detect outliers and see how well they match with the bad loans. Unfortunately, the balanced accuracy score is only slightly above 50%. Perhaps it is not that surprising as all loans in the dataset are approved loans. Situations like machine malfunction, power outage or fraudulent credit card transactions may be more appropriate for this approach.", "So here\u2019s the silver bullet. Since we are using ensemble classifiers anyway, we can actually use versions of those classifiers that are designed to handle imbalance data. For the Freddie Mac data, I have used a balanced bagging classifier, a balanced random forest classifier and an easy ensemble classifier from the package imbalanced-learn; as well as a LightGBM classifier with the parameter is_unbalanced = True. The performance decent with a balanced accuracy score at ~70%. With my best model from LightGBM, I am able to flag 75% of bad loans at the expense of flagging 25% of the good loans as false positives. If I flag bad loans strictly based on credit score cutoff, to achieve 75% recall I will have set the cutoff at 720 and we will have a false positive rate of 47%. Thus I have reduced false positive rate almost by half compared to the strict cutoff approach. While there is still room for improvement with the current false positive rate, with 1.3 million loans in the test dataset (a year worth of loans) and a median loan size of $152,000, the potential benefit could be huge and worth the inconvenience. Borrowers flagged hopefully will receive additional support on financial literacy and budgeting to improve their loan outcomes.", "Another question I asked at the beginning how much do features other than credit score contribute to our model? Let\u2019s focus on the feature importance of the imbalanced light GBM model trained with all original data. While Credit Score is still one of the top features, its relative importance is not overwhelming. When it is dropped from the models, its effect on the model is minimal with a 1\u20132% point drop in performance. Geographical information is another feature that comes up top. But with the history of gentrification in our country in mind, I tested whether there is a drop in performance in the model if I remove geospatial information of the property. I was quite aggressive on this that I not only take out the obvious ones such as postal code and property state; but also features that are slightly correlated with location information such as servicer name. This lead to a quite significant drop in performance of ~3% point. Since Freddie Mac itself does not make decision on loan approvals, I think it is better to keep all features in the model.", "In summary, I have demonstrated four different methods to work with imbalanced datasets. A couple of future directions include optimizing some of the classifiers to improve performance, building a pipeline to train and test a continuous flow of yearly loan data, as well as trying different definitions of a bad loan such as more than 3 months of late payment. If you are interested in the detail of this work and my other work on medium, please find my notebooks on Github. You can also connect with me on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | ex-Neuroscientist | Social Science Enthusiast"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd2852c003996&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d2852c003996--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@Tsomatthew?source=post_page-----d2852c003996--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Tsomatthew?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Matthew C. F. Tso"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F952c3035aea1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&user=Matthew+C.+F.+Tso&userId=952c3035aea1&source=post_page-952c3035aea1----d2852c003996---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.freddiemac.com/research/datasets/sf_loanlevel_dataset.page", "anchor_text": "dataset"}, {"url": "https://lightgbm.readthedocs.io/en/latest/Parameters.html#objective-parameters", "anchor_text": "LightGBM"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.metrics.balanced_accuracy_score.html", "anchor_text": "balanced accuracy score"}, {"url": "https://pypi.org/project/imbalanced-learn/", "anchor_text": "imbalanced-learn"}, {"url": "https://lightgbm.readthedocs.io/en/latest/Parameters.html#objective-parameters", "anchor_text": "LightGBM"}, {"url": "https://towardsdatascience.com/@Tsomatthew", "anchor_text": "my other work on medium"}, {"url": "http://www.github.com/tsofoon/", "anchor_text": "Github"}, {"url": "https://www.linkedin.com/in/matttso/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d2852c003996---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/imbalanced-data?source=post_page-----d2852c003996---------------imbalanced_data-----------------", "anchor_text": "Imbalanced Data"}, {"url": "https://medium.com/tag/financial-crisis?source=post_page-----d2852c003996---------------financial_crisis-----------------", "anchor_text": "Financial Crisis"}, {"url": "https://medium.com/tag/freddie-mac?source=post_page-----d2852c003996---------------freddie_mac-----------------", "anchor_text": "Freddie Mac"}, {"url": "https://medium.com/tag/housing-crisis?source=post_page-----d2852c003996---------------housing_crisis-----------------", "anchor_text": "Housing Crisis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&user=Matthew+C.+F.+Tso&userId=952c3035aea1&source=-----d2852c003996---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&user=Matthew+C.+F.+Tso&userId=952c3035aea1&source=-----d2852c003996---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d2852c003996--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd2852c003996&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d2852c003996---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d2852c003996--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d2852c003996--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d2852c003996--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d2852c003996--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d2852c003996--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Tsomatthew?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Tsomatthew?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matthew C. F. Tso"}, {"url": "https://medium.com/@Tsomatthew/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "25 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F952c3035aea1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&user=Matthew+C.+F.+Tso&userId=952c3035aea1&source=post_page-952c3035aea1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F845778a25e17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-bad-housing-loans-using-public-freddie-mac-data-a-tutorial-on-working-with-imbalanced-d2852c003996&newsletterV3=952c3035aea1&newsletterV3Id=845778a25e17&user=Matthew+C.+F.+Tso&userId=952c3035aea1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}