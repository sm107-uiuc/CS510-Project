{"url": "https://towardsdatascience.com/create-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19", "time": 1683013508.1599889, "path": "towardsdatascience.com/create-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19/", "webpage": {"metadata": {"title": "Create a Recommendation System Based on Time-Series Data Using Latent Dirichlet Allocation | by Alon Agmon | Towards Data Science", "h1": "Create a Recommendation System Based on Time-Series Data Using Latent Dirichlet Allocation", "description": "Many believe that the main goal of user segmentation and recommendation systems is to predict or better understand what customers want or likely to buy. Sometimes, however, the important question is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/a-agmon/recommend/blob/master/cluster_users_activity.ipynb", "anchor_text": "here", "paragraph_index": 42}], "all_paragraphs": ["Many believe that the main goal of user segmentation and recommendation systems is to predict or better understand what customers want or likely to buy. Sometimes, however, the important question is not what customers are likely to buy, but when are they likely to buy it.", "Consider the following examples: (1) An online store wants to send its most dedicated customers a coupon for a product that fits their preferences. However, they also know that customers differ in the time-of-day in which they usually shop \u2014e.g. some prefer to shop early in the morning while others prefer to shop late at night. Thus, they want to know exactly when each customer (or group of customers) is more likely to shop and send the coupon at the appropriate time. (2) A provider of network proxy services needs to efficiently allocate network bandwidth to their users. Ideally, they would like to group users according to their activity hours and allocate them the bandwidth accordingly.", "These \u201cbusiness problems\u201d already assume that users or customers want a certain product. The question they pose is when are they most likely to buy or use it. In this post, I would like to share a very simple methodology that can add another tool that might help you answer such questions.", "I will assume that you have a simple time series data set in the form of:", "I will show how LDA enables us to (1) segment users into groups or clusters according to the time in which they are more likely to be \u201cactive\u201d in quite an insightful way, and (2) let us predict how significantly each user is associated with each group, based on its data. (The same analysis can be also applied to products and cluster them into groups according to the time in which they are more likely to be purchased, etc).", "In the sections that follow, I will very briefly introduce LDA and the way it operates, and then dive right into the code.", "LDA is most commonly used for topic modeling in NLP contexts, and that is indeed a good example use case to grasp its value. Topic modeling algorithms usually start with a \u201ccorpus\u201d or a group of \u201cdocuments\u201d that consist of \u201cwords\u201d, and try to use the observed mixture of words and the frequency in which they show together in order to find latent patterns or topics within the documents.", "For example, suppose that I have 3 documents: (1) \u201cMy dog ate my lunch\u201d; (2) \u201cI just love eating fruits\u201d; (3) \u201cI am allergic to dogs\u201d. A topic modeling algorithm should be able to identify at least 2 latent topics or themes within this \u201ccorpus\u201d: a topic that deals with dogs and a topic that deals with food or eating. Some topic modelling algorithms (such as LDA) would also be able to associate a document with more than one topic and tell us which topic is more dominant in the document. For example, these algorithms would be able to tell us that sentence 1 (\u201cMy dog ate my lunch\u201d) is both about dogs and about food or eating, and also that its more about dogs than it is about food.", "LDA makes at least 2 important working assumptions :", "(1) Each topic is a probability distribution of words. Simply put, each topic is associated with certain words that occur in certain probabilities in a document that deals with the topic. One of the main outputs of an LDA model is a term-topic matrix that shows the probability of each word occurring in a certain topic. This matrix allows us to find semantic themes in each topic. For example, if WORD 0 and WORD 1 in the matrix below relate to animals then we can say that TOPIC3 (or its theme) is animals because words that relate to animals are very probable to occur within it.", "(2) Each document has a \u201ctopic recipe\u201d or a probability distribution of topics. This means, for example, that running sentence 1 (\u201cMy dog ate my lunch\u201d) through the model will tell us that the document is 80% about food and eating and 20% about dogs, based on the words it contains.", "When we fit LDA on a certain corpus or group of documents, then it essentially learns which probability distribution of words per topic can best explain (or generate) the distribution of words in each document in our corpus. More accurately, a trained LDA model can reproduce the corpus it was trained on (or at least something semantically similar to it), given the topic recipe. And, more importantly, a trained or fitted LDA model can predict the \u201ctopic recipe\u201d of documents unseen by the model when it was trained.", "A trained LDA model allows us to estimate the \u201ctopic recipe\u201d of any vectorized document . In the context of NLP, where \u201cdocuments\u201d are chunks of text or BOW vectors of words, the document\u2019s topic recipe can help us figure out what are the dominant themes of the document or which theme is more dominant than others.", "However, at the end of the day, LDA is a clustering algorithm \u2014that is, it estimates a set of vectors with N features and finds latent patterns in the values assigned to these features in each vector. In other words, if we think about topics as clusters and about a topic recipe of a document as a cluster recipe of a vector, telling us how strongly the vector is \u201cassociated\u201d with each of the clusters, then its obvious that we can make LDA work for many business problems outside the context of NLP.", "This may still seem not entirely related to the domain of time-series analysis, so let me just jump right into an example that I\u2019ll be using throughout this post which will illustrate this more clearly.", "Suppose that you have a dataset of \u2018customers\u2019 which records the number of TV shows that have been watched by each customer each hour over a period of 24 hours. Each vector in our dataset thus looks something like this:", "[customer, # of shows watched on 1AM, # of shows watched on 2AM\u2026.]", "Our task is to find an efficient way to predict when is the best time to offer a given customer the option to watch a new TV show. Obviously, there is more than one way to approach this. The approach that I will take here is to try and segment customers into groups according to their TV-watching hours and predict the best time to offer a customer a new TV show according to the preferences or activity of the group they are most dominantly associated with.", "How can LDA help us out here? If we treat each hour of day as a feature with a value equals to the number of TV shows watched by the customer, on average, then estimating LDA on this data will enable us to segment our customers to groups according to their TV show watching hours.", "More importantly, we will be able to produce a feature-cluster matrix (or hour-group matrix) that will tell us which hour is more significant in which cluster (and how more significant it is), in addition to providing us a cluster recipe for each customer that will tell us how strongly the customer is \u201cassociated\u201d with each of the groups. Note that while this task can be also accomplished using others clustering algorithm (such as KMeans), the ability to easily produce a feature-cluster matrix that can quantify the significance of the association of each feature to a cluster is a stark advantage of using LDA (though there are more, but this discussion is beyond my scope here).", "We start with this data set:", "The first thing we ought to do is to transform the data to the time series format we want to work with.", "2. We transpose it using the pivot_table method in order to get a row for each customer with every hour (or time bin) as a feature/column", "3. Finally, we use Panda\u2019s GroupBy to get the mean for each hour", "Now, we have our data in the right format", "When we look on the mean views per hour of our entire dataset we indeed see a somewhat expected curve in which more TV shows are viewed during the prime day hours and less during late night hours. However, as we shall shortly see, using this data as an indicator for when is the best time to offer a new TV show overlooks many customers with preferences that diverge from the mean.", "The simple magic happens in these 3 lines of code", "We assume that our customers\u2019 viewing preferences can be divided into 3 groups, and fit() the LDA object on our data. And, that\u2019s it. All we need to do now is extract the latent insights in our data.", "The first and most important insight that LDA produces is a term-topic matrix, or an hour-cluster matrix, that will tell us which viewing hours are more dominant with each cluster. This matrix is usually helpful as a sanity check, to examine whether the clustering makes sense or whether further adjustments are needed.", "*Note that the first line will produce this matrix but it is more readable when normalized, which is what the lines that follow do.", "And here is a more refined version:", "We can clearly notice groups with preferences that \u201cmake sense\u201d. For example, we can say that cluster 0 describes customers that mostly watch TV shows during the night / late evening hours \u2014 there is a chance of 40% (20% + 20%) that the time they will watch a TV show each day is between 8PM and midnight. We also see a group that seems to consist of \u201cdaily\u201d watchers (cluster 1) who watches the most during prime day hours 8AM \u2014 4PM.", "I will shortly return to this, but once the hours probability distribution within our clusters makes sense, we can use the transform() method which will produce the vector-cluster (or customer-cluster) matrix that will show the extent to which each customer is associated with each of the clusters.", "We saw earlier that the prime hours associated with Cluster 0 group are evening-night hours, whereas the prime hours associated with Cluster 1 group are noon-afternoon hours. Accordingly, we can say that the first customer ([0.79, 0.14, 0.06]) mostly watches TV shows on evening-night hours, whereas the second ([0.36, 0.62. 0.01]) mostly watches TV shows during the day. If we could pick just one time frame to present new shows to our customers, we would probably pick the evening/night hours because although the second customer mostly watches their TV during the day, there is still a 36% chance that they will watch a late night show.", "We can illustrate this by assigning each customer to its most dominant cluster and then plotting the mean for each cluster.", "We can also use this to evaluate the size of each group. That will show us, for example, that the group that is associated with somewhat abnormal activity hours (cluster 2) is some kind of outlier that needs to be further explored (e.g. perhaps it is related to users from a different time zone?)", "At the beginning of the post, I mentioned 2 main questions that we need to answer, or 2 main insights that we want LDA to help us with: (1) We want to know the prime hours for each group (the hours in which they watch the most) in order to present the members of each group the option to watch a new TV show when they are more likely to watch it. (2) Given a customer\u2019s TV watching activity, we want to know how strongly the customer is associated with which group.", "One approach we can use to achieve the first task rather simply, is by selecting the mean watching time for each group or cluster, and then find the hours whose values exceed the mean. As the example below shows, the prime hours for the first group (the night watchers) is 4PM to midnight.", "As for the second task (find the best hours to present a TV show to a particular customer), all we have to do is call the transform() method using the watching hours vectors of the customer we want to predict.", "Our model tells us that customer 120 mostly likes to watch their TV during the night, though they also spend some time watching TV during normal day hours. In other words, although they watch more TV at night time, it might also be worthwhile to offer them a new TV show to watch during the day.We can actually confirm this by examining their actual watching hours.", "Indeed, we can see that the best time to show customer 120 a new TV show is between 10PM and 2AM though they do spend a decent time watching TV during the day.", "To sum, we have quite a few tools to cluster users based on their time-series activity data. I have tried to show a rather simple approach that can certainly expand your toolset when analyzing such problems and easily produce valuable insights.", "You can find the full notebook here", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior Engineering Manager | Big Data | Data Science | Data Streaming and Analytics"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2aa141b99e19&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@alon.agmon?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.agmon?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Alon Agmon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbcd1e3126cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&user=Alon+Agmon&userId=bcd1e3126cdc&source=post_page-bcd1e3126cdc----2aa141b99e19---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@lucian_alexe?utm_source=medium&utm_medium=referral", "anchor_text": "Lucian Alexe"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@ugur?utm_source=medium&utm_medium=referral", "anchor_text": "Ugur Akdemir"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/a-agmon/recommend/blob/master/cluster_users_activity.ipynb", "anchor_text": "here"}, {"url": "https://blog.echen.me/2011/08/22/introduction-to-latent-dirichlet-allocation/", "anchor_text": "Introduction to Latent Dirichlet AllocationSuppose you have the following set of sentences: I like to eat broccoli and bananas. I ate a banana and spinach\u2026blog.echen.me"}, {"url": "https://www.machinelearningplus.com/nlp/topic-modeling-python-sklearn-examples/", "anchor_text": "LDA - How to grid search best topic models? (with examples in python)Python's Scikit Learn provides a convenient interface for topic modeling using algorithms like Latent Dirichlet\u2026www.machinelearningplus.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2aa141b99e19---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2aa141b99e19---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/clustering?source=post_page-----2aa141b99e19---------------clustering-----------------", "anchor_text": "Clustering"}, {"url": "https://medium.com/tag/nlp?source=post_page-----2aa141b99e19---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----2aa141b99e19---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&user=Alon+Agmon&userId=bcd1e3126cdc&source=-----2aa141b99e19---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&user=Alon+Agmon&userId=bcd1e3126cdc&source=-----2aa141b99e19---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2aa141b99e19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2aa141b99e19---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2aa141b99e19--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2aa141b99e19--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2aa141b99e19--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.agmon?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.agmon?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alon Agmon"}, {"url": "https://medium.com/@alon.agmon/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "172 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbcd1e3126cdc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&user=Alon+Agmon&userId=bcd1e3126cdc&source=post_page-bcd1e3126cdc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6d59d48776ab&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreate-a-recommendation-system-based-on-time-series-data-using-latent-dirichlet-allocation-2aa141b99e19&newsletterV3=bcd1e3126cdc&newsletterV3Id=6d59d48776ab&user=Alon+Agmon&userId=bcd1e3126cdc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}