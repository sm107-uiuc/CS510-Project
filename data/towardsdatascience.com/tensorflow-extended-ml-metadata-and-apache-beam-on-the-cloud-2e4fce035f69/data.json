{"url": "https://towardsdatascience.com/tensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69", "time": 1683010935.600804, "path": "towardsdatascience.com/tensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69/", "webpage": {"metadata": {"title": "Tensorflow Extended, ML Metadata and Apache Beam on the Cloud | by Theodoros Ntakouris | Towards Data Science", "h1": "Tensorflow Extended, ML Metadata and Apache Beam on the Cloud", "description": "The fully end to end example that tensorflow extended provides by running tfx template copy taxi $target-dir produces 17 files scattered in 5 directories. If you are looking for a smaller, simpler\u2026"}, "outgoing_paragraph_urls": [{"url": "https://beam.apache.org/documentation/runners/capability-matrix/", "anchor_text": "or on different cloud providers/your custom spark clusters", "paragraph_index": 4}, {"url": "https://medium.com/swlh/understanding-ml-in-production-preprocessing-data-at-scale-with-tensorflow-transform-90aefc26e98f?source=friends_link&sk=9734448bfe53fa051e230070c0744e72", "anchor_text": "read this article", "paragraph_index": 4}, {"url": "https://www.tensorflow.org/tfx/guide/custom_component", "anchor_text": "declare custom components", "paragraph_index": 7}, {"url": "https://beam.apache.org/documentation/programming-guide/#output-tags", "anchor_text": "multiple, tagged input-outputs on the beam side", "paragraph_index": 7}, {"url": "https://cloud.google.com/dataflow/docs/guides/specifying-exec-params", "anchor_text": "Here are the Dataflow ones, for reference.", "paragraph_index": 9}, {"url": "https://cloud.google.com/docs/authentication/getting-started", "anchor_text": "environment variable, so that you have got enough permissions to deploy a pipeline to dataflow.", "paragraph_index": 14}, {"url": "https://cloud.google.com/iam/docs/understanding-roles", "anchor_text": "has got sufficient roles", "paragraph_index": 14}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "running environment under a", "paragraph_index": 16}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "setup.py", "paragraph_index": 16}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "file. More on that here.", "paragraph_index": 16}, {"url": "https://cloud.google.com/dataflow/docs/guides/templates/creating-templates#python", "anchor_text": "Read more about them here.", "paragraph_index": 17}, {"url": "https://www.tensorflow.org/datasets/beam_datasets#implementing_a_beam_dataset", "anchor_text": "In these cases, it would be more efficient to use a Beam Generator-Based Dataset and is out of scope of this tutorial.", "paragraph_index": 25}, {"url": "https://stackoverflow.com/questions/55484793/reading-dataset-statistics-generated-by-statisticsgen", "anchor_text": "Similarly, for statistics protocol buffers", "paragraph_index": 32}], "all_paragraphs": ["The fully end to end example that tensorflow extended provides by running tfx template copy taxi $target-dir produces 17 files scattered in 5 directories. If you are looking for a smaller, simpler and self contained example that actually runs on the cloud and not locally, this is what you are looking for. Cloud services setup is also mentioned here.", "We are going to generate statistics and a schema for the Chicago taxi trips csv dataset that you can find by running the tfx template copy taxi command under the data directory.", "Generated artifacts such as data statistics or the schema are going to be viewed from a jupyter notebook, by connecting to the ML Metadata store or just by downloading artifacts from simple file/binary storage.", "Full code sample at the bottom of the article", "The whole pipeline can run on your local machine (or on different cloud providers/your custom spark clusters as well). This is an example that can be scaled by using bigger datasets. If you wish to understand how this happens transparently, read this article.", "It\u2019s a good naming practise to use /temp or /tmp for temporary files and /staging or /binaries for the staging directory.", "Tensorflow Extended provides it\u2019s custom component wrappers around plain old beam components. They are a bit more federated in the form: artifacts are only produced and consumed. This means that they do not stream all the dataset everytime, they just pass around resource locator strings. Your dataset gets streamed for analysis preprocessing speed reasons and then saved in small chunks as tfrecords for maximum performance, taking full advantage of the fast storage technology of Storage Buckets.", "This is why when you declare custom components, you declare strongly typed input and output channels (artifact types and names), which get mapped to multiple, tagged input-outputs on the beam side. You return these with a Dict . Feel free to look into the source of the default TFX Components for more insights on these", "This is why you need to do things like:", "The other TFX abstraction you need to be informed about is tfx.orchestration.pipeline. You don\u2019t just run a Beam Pipeline by using with create-pipeline-here . You pass over control to TFX\u2019s BeamDagRunner , by providing an array of components to form the pipeline DAG with, the pipeline root data source (filesystem or bucket) and an optional metadata store. Beam Pipeline execution parameters that are supported are platform agnostic. Here are the Dataflow ones, for reference.", "Our pipeline creation is pretty minimal for all the things it does", "You can use patterns with wildcards to read multiple files at once.", "And here are our Dataflow execution parameters:", "We don\u2019t need much for this thing to run. Just a storage bucket, the dataflow service to be enabled and if you choose to use ml metadata, a cloud sql instance.", "You should not use your own personal account for cloud operations. Export some credential keys as .json file to use with the GOOGLE_APPLICATION_CREDENTIALS environment variable, so that you have got enough permissions to deploy a pipeline to dataflow. Make sure that your service account has got sufficient roles to make new dataflow jobs, read and write to the Cloud SQL instance and read, write to bucket storage.", "6. Make sure that the services can talk to each other (usually troubleshot when running the pipeline for the first time)", "If your pipeline uses more than the tensorflow extended components, please include anything needed to setup a running environment under a setup.py file. More on that here.", "You might get the UserWarning: RuntimeParameter is only supported on KubeflowDagRunner currently. warnings.warn(\u2018RuntimeParameter is only supported on KubeflowDagRunner \u2018 . Feel free to ignore this warning for now. It\u2019s only for parameterised pipelined (templates) that you can run with different configurations. You usually stage them in a storage service and run them with post http request job submissions. Read more about them here.", "We use BeamDagRunner().run(<your pipeline object here>) .", "Different runners are available under tfx.orchestration . This one is under from tfx.orchestration.beam.beam_dag_runner.", "You can see that our job is finished on Cloud Console. Here, you can view metrics, log messages, time to run, cpu utilisation of each worker.", "You can even view different auto-generated statistics (not the dataset statistics that are saved on protobuf format).", "Let\u2019s jump into Storage Browser and inspect our bucket.", "These are directories to stage binaries and data between components, temporary storage for temporary and staging files. CsvExampleGen contains the tfrecords that are generated straight off from the comma separated values file. StatisticsGen and SchemaGen contain only one (or 2 if you specify a test set as well) tfrecord file that contains the statistics extracted and the generated schema. We will inspect those with a notebook later.", "You can see that aside from different numbered folders that correspond to the specific step in the timeline, tfrecords are split for performance as well.", "Sidenote: this is not for very very huge (terabyte scale) datasets because this way, they are multiplied and occupy huge amounts of space in a bucket. In these cases, it would be more efficient to use a Beam Generator-Based Dataset and is out of scope of this tutorial.", "There is no reason to manually look for these in your bucket if you use an ML Metadata service.", "Tensorflow Extended already provides ways to visualise these default artifacts. First of all, the schema is text based so you can just print it. The statistics can be easily visualised inside a jupyter notebook by loading an extension.", "These data are stored in a cloud-native environment and inspecting them by hand is a bit tricky but non-trivial. For this task, you can:", "No matter what you choose to do or if your data are based on a file based or in ml metadata form, we\u2019ve got you covered.", "Accessing plain files are easy. If you are inside a compute instance/vm/notebook that\u2019s part of your GCP Project where the storage buckets are located, you can just use the gs://<bucket name> url to access the files the same way you would access your filesystem.", "Alternatively, the correct and type safe way to do this would be to load and edit this with python. A type save protocol buffer stub is returned that you can use to edit.", "Similarly, for statistics protocol buffers (these are not text-readable).", "You should now be able to fully understand what the tensorflow extended ecosystem has to offer and how it\u2019s components work under the hood, in collaboration with the cloud beam runner and other public cloud services.", "Thank you for reading all the way to the end!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2e4fce035f69&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://zarkopafilis.medium.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Theodoros Ntakouris"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa030fa2f6701&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=post_page-a030fa2f6701----2e4fce035f69---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://cloud.google.com/dataflow", "anchor_text": "Dataflow"}, {"url": "https://beam.apache.org/", "anchor_text": "Apache Beam Pipeline"}, {"url": "https://cloud.google.com/storage/docs/json_api/v1/buckets", "anchor_text": "Storage Buckets"}, {"url": "https://cloud.google.com/sql", "anchor_text": "Cloud SQL"}, {"url": "https://www.tensorflow.org/tfx/guide/mlmd", "anchor_text": "ML Metadata"}, {"url": "https://beam.apache.org/documentation/runners/capability-matrix/", "anchor_text": "or on different cloud providers/your custom spark clusters"}, {"url": "https://medium.com/swlh/understanding-ml-in-production-preprocessing-data-at-scale-with-tensorflow-transform-90aefc26e98f?source=friends_link&sk=9734448bfe53fa051e230070c0744e72", "anchor_text": "read this article"}, {"url": "https://github.com/cloudpipe/cloudpickle", "anchor_text": "Check out cloudpickle to get some intuition on how serialisation is done."}, {"url": "https://www.tensorflow.org/tfx/guide/custom_component", "anchor_text": "declare custom components"}, {"url": "https://beam.apache.org/documentation/programming-guide/#output-tags", "anchor_text": "multiple, tagged input-outputs on the beam side"}, {"url": "https://cloud.google.com/dataflow/docs/guides/specifying-exec-params", "anchor_text": "Here are the Dataflow ones, for reference."}, {"url": "https://console.cloud.google.com/", "anchor_text": "Log into Google Cloud Console"}, {"url": "https://cloud.google.com/storage/docs/creating-buckets", "anchor_text": "Create a storage bucket"}, {"url": "https://cloud.google.com/sql/docs/mysql/create-manage-databases", "anchor_text": "Create a Cloud SQL MySQL instance"}, {"url": "https://cloud.google.com/docs/authentication/getting-started", "anchor_text": "environment variable, so that you have got enough permissions to deploy a pipeline to dataflow."}, {"url": "https://cloud.google.com/iam/docs/understanding-roles", "anchor_text": "has got sufficient roles"}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "running environment under a"}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "setup.py"}, {"url": "https://beam.apache.org/documentation/sdks/python-pipeline-dependencies/", "anchor_text": "file. More on that here."}, {"url": "https://cloud.google.com/dataflow/docs/guides/templates/creating-templates#python", "anchor_text": "Read more about them here."}, {"url": "https://www.tensorflow.org/datasets/beam_datasets#implementing_a_beam_dataset", "anchor_text": "In these cases, it would be more efficient to use a Beam Generator-Based Dataset and is out of scope of this tutorial."}, {"url": "https://cloud.google.com/compute/docs/instances/preemptible", "anchor_text": "possibly preemptible"}, {"url": "https://github.com/tensorflow/metadata/blob/master/tensorflow_metadata/proto/v0/schema.proto", "anchor_text": "If you know your way around the schema protocol buffer definition, you can inspect or change this in a text editor."}, {"url": "https://stackoverflow.com/questions/55484793/reading-dataset-statistics-generated-by-statisticsgen", "anchor_text": "Similarly, for statistics protocol buffers"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----2e4fce035f69---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----2e4fce035f69---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----2e4fce035f69---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/apache-beam?source=post_page-----2e4fce035f69---------------apache_beam-----------------", "anchor_text": "Apache Beam"}, {"url": "https://medium.com/tag/tensorflow-extended?source=post_page-----2e4fce035f69---------------tensorflow_extended-----------------", "anchor_text": "Tensorflow Extended"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=-----2e4fce035f69---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=-----2e4fce035f69---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2e4fce035f69&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2e4fce035f69---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2e4fce035f69--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2e4fce035f69--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2e4fce035f69--------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Theodoros Ntakouris"}, {"url": "https://zarkopafilis.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "450 Followers"}, {"url": "https://ntakour.is/", "anchor_text": "https://ntakour.is/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa030fa2f6701&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=post_page-a030fa2f6701--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3c6cbfa1ceca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-extended-ml-metadata-and-apache-beam-on-the-cloud-2e4fce035f69&newsletterV3=a030fa2f6701&newsletterV3Id=3c6cbfa1ceca&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}