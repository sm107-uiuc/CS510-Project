{"url": "https://towardsdatascience.com/geospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777", "time": 1683015442.554878, "path": "towardsdatascience.com/geospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777/", "webpage": {"metadata": {"title": "GeoSpatial analysis in Python and Jupyter Notebooks | by Fran P\u00e9rez | Towards Data Science", "h1": "GeoSpatial analysis in Python and Jupyter Notebooks", "description": "using geopandas and kepler.gl for geospatial analysis"}, "outgoing_paragraph_urls": [{"url": "https://blog.mobility.here.com/congestion-charge-impact", "anchor_text": "congestion in city centers", "paragraph_index": 0}, {"url": "http://api.citybik.es/v2/", "anchor_text": "CityBikes API", "paragraph_index": 1}, {"url": "https://github.com/eskerda/python-citybikes", "anchor_text": "python-citybikes", "paragraph_index": 1}, {"url": "https://www.bicing.barcelona/", "anchor_text": "bicing", "paragraph_index": 2}, {"url": "https://github.com/franperezlopez/spatial/blob/master/bicing%20medium.ipynb", "anchor_text": "notebook", "paragraph_index": 5}, {"url": "https://docs.kepler.gl/docs/keplergl-jupyter", "anchor_text": "kepler.gl documentation", "paragraph_index": 8}, {"url": "https://github.com/martgnz/bcn-geodata", "anchor_text": "Barcelona open geodata", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Spatial_reference_system", "anchor_text": "coordinate reference system", "paragraph_index": 16}, {"url": "https://geopandas.org/projections.html", "anchor_text": "Managing Projections \u2014 GeoPandas documentation", "paragraph_index": 18}, {"url": "https://geopandas.org/mergingdata.html#spatial-joins", "anchor_text": "spatial join", "paragraph_index": 19}, {"url": "https://gis.stackexchange.com/a/246184", "anchor_text": "stackoverflow", "paragraph_index": 24}, {"url": "https://github.com/franperezlopez/blog_spatial", "anchor_text": "https://github.com/franperezlopez/blog_spatial", "paragraph_index": 30}, {"url": "https://towardsdatascience.com/4-techniques-to-enhance-your-research-in-machine-learning-projects-c691892ab9dd", "anchor_text": "install Jupyter Notebook", "paragraph_index": 32}, {"url": "https://mobility.here.com/learn/smart-city-mobility/smart-city-bike-services-economic-environmental-and-societal-impacts", "anchor_text": "Smart City Bike Services: Economic, Environmental & Societal Impacts", "paragraph_index": 33}], "all_paragraphs": ["Most capitals in the world are using public city bicycle service, which reduces fuel consumption, emissions, and congestion in city centers. Bike-sharing also encourages physical activity and can contribute to the health of city residents [1].", "Fortunately, it exists an open CityBikes API that can be used to examine in real-time the status of the bike\u2019s stations (for example, we can check the number of free slots in any station). Furthermore, there is a python package python-citybikesfor querying the CityBikes API.", "Barcelona is one of these cities that expose data using CytyBikes API. Using the above-mentioned package, Barcelona\u2019s bicycle service (aka bicing) can be queried using the following code:", "The former call returns the station\u2019s data in JSON format:", "After processing the data, we turned the data from a JSON schema into a tabular schema:", "The API doesn\u2019t provide a historic service, but you can develop your own script for downloading the data every 5 minutes (Bicing refresh rate). The companion notebook shows how to download and process the data; a sample of the processed data is also provided as a parquet file indata/bicing_saturday_morning.parquet.", "The first spatial operation will be to plot the stations on the map, using the longitude and latitude information available when downloading the data from the CityBikes API:", "The first map will place all these stations on the map:", "kepler.gl is smart enough to infer that the columns latitude and longitude represent the station's geographical coordinates. This map can be displayed inside a Jupyter notebook, and the map can be configured using the UI to switch between different map styles (flat or satellite) and layers (road, buildings, etc). These UI adjustments can be exported as a python dictionary and then be used next time you load the map. Check out kepler.gl documentation for more information about customizing the maps.", "The CityBikes API doesn\u2019t provide the information about stations by district (only the name of the station \u2014 aka address of the station). But fear no more, we can still use open data provided by the community. In this case, we will use the Barcelona open geodata repository, and the district's geographical location provided there.", "Geopandas can read .geojson files using:", "The object df_districts is similar to a regular Pandas dataframe, but includes a column named geometry. Geopandas dataframes can contain as many geographical columns as needed, but I highly recommend using just one per dataframe, and named it asgeometry. In this case, the file contains ten districts (rows) and 47 columns (with information such as the name of the district, website, area, etc).", "The geopandas dataframe can be plotted as it is:", "Or we can project the borders of the district alongside the bike stations in another map instance:", "In the above figure we can visually check which stations are in the Gracia district, but is there a way to extract this information in a tabular way? Yes, you can: welcome to spatial joins.", "First, we need to transform the dataframe containing the stations' locations to a Geopandas dataframe:", "In the above snippet, you can observe a parameter named crs. To summarize: the longitude and latitude numbers are regular numbers, but when you apply a coordinate reference system (CRS) to them, these numbers can be projected on a map. There are many reference systems, and the subject is complex, so I will reduce my study to only two CRS's (please GIS experts forgive my rudeness):", "The difference between both reference systems can be appreciated when we project the world map using both CRS:", "If you need more information about projections and working with different reference systems, I recommend checking Managing Projections \u2014 GeoPandas documentation.", "The spatial join will return the points (= bike stations) included inside each district:", "From there, filtering out the stations in Gracia district is as easy as that:", "The area of influence can be displayed as a circle that is centered around each station. The radio of the circle can be a user-defined parameter (for example, 300 meters). As we mentioned before, to work with distances we need to temporarily switch the reference system to Mercator:", "After applying the function to the location of the stations, we can plot the area of influence around each bike stations:", "In this case, the approach taken is that every zone in the map might be influenced by many stations, so the number of bikes available in the zone would be the sum of bikes available in the areas of influence touching the zone.", "We need to calculate the union of all intersection between all areas of influence. This operation can be solved using the library shapely (kudos to stackoverflow):", "The operation creates a shape (zone) for each overlay intersection, thus sixty-eight shapes are produced in total. As seen before, we can plot the shapes to better understand the operation itself:", "The number of free bikes can be obtained by performing a spatial join between zones and stations areas of influence, and adding up all rows in the same zone:", "Again, the instance df_gracia_area_stats is a geopandas dataframe that can be projected on the map to visually check the availability of bikes in the Gr\u00e0cia district:", "In the same way as before, the best zone can be extracted in a tabular way:", "In conclusion, geopandas and kepler.gl are a powerful addition to your data analytics toolbox. geopandas is based on the Pandas dataframe API and kepler.gl supports Pandas dataframes at its core, so the learning curve for both libraries is swift, while the benefits are great.", "The complete code of this post is available here \u2014 https://github.com/franperezlopez/blog_spatial", "Installing this library is a bit tricky, and the documentation is lacking on this side, so I will try to facilitate this step. First of all, it seems this library can\u2019t work in Windows, so you will need to use MacOS, Linux or WSL(2).", "Second, this library needs a Jupyter extension to be installed. Following my own recommendations about how to install Jupyter Notebook, you should install this extension in your base environment executing the following commands:", "[1] Smart City Bike Services: Economic, Environmental & Societal Impacts", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer at Plain Concepts"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff90de25b0777&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f90de25b0777--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@franperez?source=post_page-----f90de25b0777--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@franperez?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Fran P\u00e9rez"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F252b3db7a740&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&user=Fran+P%C3%A9rez&userId=252b3db7a740&source=post_page-252b3db7a740----f90de25b0777---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://blog.mobility.here.com/congestion-charge-impact", "anchor_text": "congestion in city centers"}, {"url": "https://unsplash.com/@jass89?utm_source=medium&utm_medium=referral", "anchor_text": "Jasser G\u00f3mez"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://api.citybik.es/v2/", "anchor_text": "CityBikes API"}, {"url": "https://github.com/eskerda/python-citybikes", "anchor_text": "python-citybikes"}, {"url": "https://www.bicing.barcelona/", "anchor_text": "bicing"}, {"url": "https://github.com/franperezlopez/spatial/blob/master/bicing%20medium.ipynb", "anchor_text": "notebook"}, {"url": "https://docs.kepler.gl/docs/keplergl-jupyter", "anchor_text": "kepler.gl documentation"}, {"url": "https://github.com/martgnz/bcn-geodata", "anchor_text": "Barcelona open geodata"}, {"url": "https://en.wikipedia.org/wiki/Spatial_reference_system", "anchor_text": "coordinate reference system"}, {"url": "https://geopandas.org/projections.html", "anchor_text": "Managing Projections \u2014 GeoPandas documentation"}, {"url": "https://geopandas.org/mergingdata.html#spatial-joins", "anchor_text": "spatial join"}, {"url": "https://gis.stackexchange.com/a/246184", "anchor_text": "stackoverflow"}, {"url": "https://github.com/franperezlopez/blog_spatial", "anchor_text": "https://github.com/franperezlopez/blog_spatial"}, {"url": "https://towardsdatascience.com/4-techniques-to-enhance-your-research-in-machine-learning-projects-c691892ab9dd", "anchor_text": "install Jupyter Notebook"}, {"url": "https://mobility.here.com/learn/smart-city-mobility/smart-city-bike-services-economic-environmental-and-societal-impacts", "anchor_text": "Smart City Bike Services: Economic, Environmental & Societal Impacts"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f90de25b0777---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----f90de25b0777---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/spatial-analysis?source=post_page-----f90de25b0777---------------spatial_analysis-----------------", "anchor_text": "Spatial Analysis"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----f90de25b0777---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/gis?source=post_page-----f90de25b0777---------------gis-----------------", "anchor_text": "GIS"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&user=Fran+P%C3%A9rez&userId=252b3db7a740&source=-----f90de25b0777---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&user=Fran+P%C3%A9rez&userId=252b3db7a740&source=-----f90de25b0777---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff90de25b0777&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f90de25b0777---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f90de25b0777--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f90de25b0777--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f90de25b0777--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f90de25b0777--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f90de25b0777--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@franperez?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@franperez?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Fran P\u00e9rez"}, {"url": "https://medium.com/@franperez/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "94 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F252b3db7a740&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&user=Fran+P%C3%A9rez&userId=252b3db7a740&source=post_page-252b3db7a740--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8deeb5b35390&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeospatial-analysis-in-python-and-jupyter-notebooks-f90de25b0777&newsletterV3=252b3db7a740&newsletterV3Id=8deeb5b35390&user=Fran+P%C3%A9rez&userId=252b3db7a740&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}