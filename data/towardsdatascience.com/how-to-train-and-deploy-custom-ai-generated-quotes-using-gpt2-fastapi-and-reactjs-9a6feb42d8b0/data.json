{"url": "https://towardsdatascience.com/how-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0", "time": 1683017079.9129658, "path": "towardsdatascience.com/how-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0/", "webpage": {"metadata": {"title": "How to Train and Deploy Custom AI-Generated Quotes using GPT2, FastAPI, and ReactJS | by Manu Joseph | Towards Data Science", "h1": "How to Train and Deploy Custom AI-Generated Quotes using GPT2, FastAPI, and ReactJS", "description": "I didn\u2019t write the above quote about quotes (Quote-ception; bad pun?), but an AI model I trained did. And it says it better than I would have. Quotes are something that means different things to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/ShivaliGoel/Quotes-500K", "anchor_text": "Quotes-500k", "paragraph_index": 6}, {"url": "https://eng.uber.com/pplm/", "anchor_text": "PPLM", "paragraph_index": 7}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Transformers from Hugging Face", "paragraph_index": 14}, {"url": "https://gist.github.com/manujosephv/e2beb755de858bcc906ef17a3e2cee59", "anchor_text": "quotes.js", "paragraph_index": 28}, {"url": "https://gist.github.com/manujosephv/de27c203497bfacee4460c17afbff378", "anchor_text": "customRatings.js", "paragraph_index": 28}, {"url": "https://fastapi.tiangolo.com/", "anchor_text": "FastAPI", "paragraph_index": 29}, {"url": "https://free-for.dev/#/", "anchor_text": "list of free services", "paragraph_index": 36}, {"url": "https://dzone.com/articles/react-apps-firebase", "anchor_text": "short tutorial", "paragraph_index": 41}, {"url": "https://docs.atlas.mongodb.com/tutorial/create-new-cluster/", "anchor_text": "cluster is straight-forward", "paragraph_index": 43}, {"url": "https://pymongo.readthedocs.io/en/stable/", "anchor_text": "pymongo", "paragraph_index": 43}], "all_paragraphs": ["Good quotes help make us stronger. What is truly inspiring about quotes is not their tone or contentedness but how those who share them reflect life experiences that really serve others.", "I didn\u2019t write the above quote about quotes (Quote-ception; bad pun?), but an AI model I trained did. And it says it better than I would have. Quotes are something that means different things to different people. Sometimes they inspire us, motivate us. And some other times they make us think about life, religion, and sometimes they just make us laugh.", "So, can we train an AI model to generate more quotes, and make us think, laugh, or inspired? That was the motivation behind me starting on this journey.", "I have fine-tuned GPT2 model on quotes with personas like Motivational/Inspirational, Funny, and Serious/Philosophical and deployed in a ready-to-use website: AI Quotes Generator.", "On June 3, 2020, OpenAI released GPT3, a mammoth language model trained on 570GB of internet text. People have put the multi-talented model to use in all kinds of applications ranging from creating app designs, to websites, to excel functions which do nothing short of magic. But there was just one problem \u2014 the model weights were never released. The only way we can access then was through a paywalled API.", "So, let\u2019s time travel to November 2019, when GPT-2 was released. GPT-2, although not as powerful as GPT-2, was a revolution when it came to text generation. I remember my jaw dropping to the floor while reading the demo text generated by the model- the coherence, and grammatical syntax, it was near perfect. What I want from the model was not to be a magician, but to be able to generate perfectly structured English sentences. And for that GPT2 was more than sufficient.", "First I needed a dataset. Scraping the web for quotes was one option, but before that I wanted to see if somebody had done that already. And bingo! Quotes-500k is a dataset of almost 500k quotes, all scraped from the web along with tags like knowledge, love, friendship, etc.", "Now I wanted to have the model be able to generate quotes according to specific themes. Since I was planning to use a pretrained model, conditional text generation was not something that was easy to do. PPLM was a model, or rather a way of using pretrained models, that Uber released which attempts to do just this(A very interesting paper. Be sure to check that out), but in the end, I went another way. I decided to train three models, each fine-tuned to specific genre of quotes.", "There were three genres I considered \u2014 Motivational, Serious, and Funny. I used the Quotes500k dataset and the tags to separate the quotes based on the tags into these three buckets. For Motivational dataset, I used tags such as love, life, inspirational, motivational, life lessons, dreams, etc. And for Serious, I went with tags like philosophy, life, god, time, faith, fear, etc. And finally, for Funny, I just took tags like humour and funny.", "Nothing fancy here; just the basic hygiene. Things like", "You might have questions like \u2014 What about stop words? Lemmatization? Where are all of those?", "Removal of stop words and lemmatization are not mandatory steps that you have to do in every single NLP task. It really depends on the task. If we were doing a text classification using a TF-IDF kind of a model, then yeah, it makes sense to do all of that. But text classification with a model which uses context, like a Neural Model or an N-Gram model, lesser so. And if you are doing Text Generation or Machine Translation, then removing the stop words and lemmatizing may actually hurt your performance as we are losing valuable context from the corpus.", "I also wanted to make the quotes not be too long. So I took a look at the dataset, plotted the frequencies of the length of the quote, and decided on an appropriate length where I should cut off. In the motivational corpus, I discarded all the quotes greater than 100 words.", "Another important aspect to making the quotes short was the ability of the model to predict an End-of-Sentence token. So, we wrap each quote with a beginning of sentence(bos) token and an end of sentence(eos) token.", "Now that we have the dataset ready and prepared, let\u2019s start training the model. Transformers from Hugging Face is the obvious choice with its easy-to-use api and amazing collection of models with pretrained weights. Thanks to Hugging Face, training or fine-tuning a model is a breezy affair.", "We start off by loading the model and the tokenizer for GPT2.", "That\u2019s it. You have the entire power of the huge pretrained model behind your fingers while you code.", "Now, let\u2019s define a function to load the dataset.", "Now that we have the datasets, let\u2019s create the Trainer. This is the core class which handles all the training process.", "By this point of time, we have all the ingredients necessary to start training \u2014 the Model, Tokenizer, and the Trainer. All that is left is to do is train the model. And once the training is done, we just need to save the model and tokenizer for our use.", "I trained each of the three models ~50 epochs on a single P5000 for a total of ~12 hours(excluding all the test runs, and runs which had some problems.)", "We have trained the model and saved them. Now what? For inference, we take another brilliant feature from Hugging Face \u2014 pipelines. This awesome feature lets you put a model into production in as little as a few lines of code.", "The gen_kwargs configures the text generation. I have used a hybrid approach of top_k sampling with k=50 and top_p sampling with p=0.95. To avoid repetitions in text generation, I have used no_repeat_ngram_size = 3, and repetition_penalty=1.2.", "Now that we have the core model trained, we need a way to interact with it. Writing code every time we need something from it is just not user friendly. So, we need a UI. And I chose to whip up a simple UI with ReactJS.", "Although I can\u2019t make the entire project available on Github, I\u2019ll post the key parts as Github Gists.", "For the purposes of the UI, I have dubbed the three models with a persona \u2014 Inspiratobot(Motivational), Aristobot(Serious), and FunnyBot.", "The key features of the UI are:", "The folder structure of the UI Project is as follows:", "The quotes.js and customRatings.js can be found in my Github Gists.", "For hosting and serving the model, we need a server. And for this, I chose FastAPI, a no-nonsense web framework, specifically designed to build APIs.", "I highly recommend FastAPI because of the sheer simplicity. A very simple API example(from the docs) is below:", "Less than 10 lines of code to get a web server for your API sounds too good to be true, but that is just what it is.", "Without going into details, the key part of the API is the generation of the quotes and below is the code for that.", "The folder structure of the project:", "It would have been all too easy to dockerize the application, spin up an EC2 instance, and host this. But I wanted an option which was cheap, if not free. Another challenge was that the models are about 500MB each and loading them into the memory made the RAM consumption to hover around 1GB. So an EC2 instance would have been costly. In addition to that, I also needed to store three models in the cloud which could cost storage. And to top it all, I also needed a DB to store the ratings that the user makes.", "With these specifications, I went hunting for products/services. To make things easier, I had separated out the app into two \u2014 a backend API server and a frontend UI which calls the backend API internally.", "During my search, I stumbled upon this awesome list of free services that developers can avail. And after evaluating a few of those options, I finally zeroed in on the below options which would make the total cost of deployment as low as possible:", "\u201cKintoHub is an all-in-one deployment platform designed for full stack developers by full stack developers\u201d, reads the home page. If cost was not a concern, I could have deployed the entire app on KintoHub because that is what their offering is \u2014 a backend Server which can scale well, a frontend server to server static HTML files, and a database. In the background, they containerize the app using a very easy to use web interface and deploy it on a machine of chosen specification. And the great thing is that all of this can be done from Github. You check-in your code to a Github repository(public or private) and deploy the app directly by pointing it to the repo.", "As far as the bare minimum settings that has to be done does, it fits in a single page.", "That\u2019s it. Of course, there are more setting available, like the memory that should be available for the app to run, etc. Although KintoHub has a free tier, I soon realized because of the RAM consumption of the models, I need a minimum of 1.5GB to make it run without crashing. So I moved to a Pay-as-you-go tier, where they generously award you with a $5 credit each month. The cost calculator shows we the app hosting is going to cost $5.5 and I\u2019m fine with that(Still waiting to see till the end of the month on the actual cost).", "Firebase is a lot of things. It says on the homepage that it is the complete app development platform, and it really is. But we are only interested in the Firebase Hosting, where they let you host single page websites for free. And it was a breeze to deploy the app. All you have to do is:", "A very short tutorial is all you need to get this done.", "MongoDB Atlas is a cloud DBaaS which provides a MongoDB on the cloud and the good thing is that they offer a free tier with 512MB of storage. For our use-case, it is more than enough.", "Creating a new cluster is straight-forward and once you sort out the access issues, we can use a python wrapper like pymongo to implement our DB connection.", "The result of all this is a website where you can interact with the model, generate quotes and pass it off as yours :D.", "Although the model isn\u2019t perfect, it still churns out some really good quotes that make you think. And that\u2019s what you want from any quote, right? Have fun playing with the model.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9a6feb42d8b0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@manujosephv?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manujosephv?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Manu Joseph"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8dcc7fb5ce5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&user=Manu+Joseph&userId=c8dcc7fb5ce5&source=post_page-c8dcc7fb5ce5----9a6feb42d8b0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/ShivaliGoel/Quotes-500K", "anchor_text": "Quotes-500k"}, {"url": "https://eng.uber.com/pplm/", "anchor_text": "PPLM"}, {"url": "https://pypi.org/project/pyenchant/", "anchor_text": "pyenchant"}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Transformers from Hugging Face"}, {"url": "https://gist.github.com/manujosephv/e2beb755de858bcc906ef17a3e2cee59", "anchor_text": "quotes.js"}, {"url": "https://gist.github.com/manujosephv/de27c203497bfacee4460c17afbff378", "anchor_text": "customRatings.js"}, {"url": "https://fastapi.tiangolo.com/", "anchor_text": "FastAPI"}, {"url": "https://free-for.dev/#/", "anchor_text": "list of free services"}, {"url": "https://www.kintohub.com/", "anchor_text": "Kintohub"}, {"url": "https://firebase.google.com/", "anchor_text": "Firebase"}, {"url": "https://www.mongodb.com/cloud/atlas", "anchor_text": "MongoDB Atlas"}, {"url": "https://dzone.com/articles/react-apps-firebase", "anchor_text": "short tutorial"}, {"url": "https://docs.atlas.mongodb.com/tutorial/create-new-cluster/", "anchor_text": "cluster is straight-forward"}, {"url": "https://pymongo.readthedocs.io/en/stable/", "anchor_text": "pymongo"}, {"url": "https://aiquotesgenerator.com", "anchor_text": "https://aiquotesgenerator.com"}, {"url": "https://deep-and-shallow.com/2020/11/28/how-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs/", "anchor_text": "http://deep-and-shallow.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9a6feb42d8b0---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----9a6feb42d8b0---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/naturallanguageprocessing?source=post_page-----9a6feb42d8b0---------------naturallanguageprocessing-----------------", "anchor_text": "Naturallanguageprocessing"}, {"url": "https://medium.com/tag/fastapi?source=post_page-----9a6feb42d8b0---------------fastapi-----------------", "anchor_text": "Fastapi"}, {"url": "https://medium.com/tag/react?source=post_page-----9a6feb42d8b0---------------react-----------------", "anchor_text": "React"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&user=Manu+Joseph&userId=c8dcc7fb5ce5&source=-----9a6feb42d8b0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&user=Manu+Joseph&userId=c8dcc7fb5ce5&source=-----9a6feb42d8b0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9a6feb42d8b0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9a6feb42d8b0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9a6feb42d8b0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manujosephv?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manujosephv?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Manu Joseph"}, {"url": "https://medium.com/@manujosephv/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "183 Followers"}, {"url": "https://www.linkedin.com/in/manujosephv/", "anchor_text": "https://www.linkedin.com/in/manujosephv/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8dcc7fb5ce5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&user=Manu+Joseph&userId=c8dcc7fb5ce5&source=post_page-c8dcc7fb5ce5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7cea8b947fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-train-and-deploy-custom-ai-generated-quotes-using-gpt2-fastapi-and-reactjs-9a6feb42d8b0&newsletterV3=c8dcc7fb5ce5&newsletterV3Id=7cea8b947fdd&user=Manu+Joseph&userId=c8dcc7fb5ce5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}