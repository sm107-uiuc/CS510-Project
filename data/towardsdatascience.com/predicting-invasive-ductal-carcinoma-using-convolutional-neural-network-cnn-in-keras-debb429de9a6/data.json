{"url": "https://towardsdatascience.com/predicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6", "time": 1682994457.088618, "path": "towardsdatascience.com/predicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6/", "webpage": {"metadata": {"title": "Predicting Invasive Ductal Carcinoma using Convolutional Neural Network (CNN) in Keras | by Bikram Baruah | Towards Data Science", "h1": "Predicting Invasive Ductal Carcinoma using Convolutional Neural Network (CNN) in Keras", "description": "In this blog, we will learn how to use CNN in a real world histopathology dataset. Real-world data requires a lot more preprocessing than standard datasets such as MNIST, and we will go through the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/bikramb98/invasive-ductal-carcinoma-cnn/blob/master/Predicting%20Invasive%20Ductal%20Carcinoma%20using%20CNN%20in%20Keras.ipynb", "anchor_text": "here", "paragraph_index": 4}, {"url": "http://www.andrewjanowczyk.com/use-case-6-invasive-ductal-carcinoma-idc-segmentation/", "anchor_text": "here", "paragraph_index": 9}, {"url": "http://www.apsipa.org/proceedings/2017/CONTENTS/papers2017/15DecFriday/FP-02/FP-02.3.pdf", "anchor_text": "paper", "paragraph_index": 25}, {"url": "https://arxiv.org/pdf/1207.0580.pdf", "anchor_text": "Hinton (2012)", "paragraph_index": 34}, {"url": "https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/", "anchor_text": "here", "paragraph_index": 40}, {"url": "https://medium.com/@ab9.bhatia/set-up-gpu-accelerated-tensorflow-keras-on-windows-10-with-anaconda-e71bfa9506d1", "anchor_text": "tutorial", "paragraph_index": 45}, {"url": "https://www.linkedin.com/in/bikramb/", "anchor_text": "LinkedIn", "paragraph_index": 64}], "all_paragraphs": ["In this blog, we will learn how to use CNN in a real world histopathology dataset. Real-world data requires a lot more preprocessing than standard datasets such as MNIST, and we will go through the process of making the data ready for classification and then use CNN to classify the images. I will also discuss the CNN architecture used and some of the hyperparameters tuned when building the model.", "The different sections of this blog are:", "I assume that the reader knows what convolutional neural networks are and the their basic working mechanism.", "In this blog, we will only discuss the code which is important in the context of deep learning, and also avoid repeated explanation of code used more than once.", "The Github repository for this post can be found here. I\u2019d suggest you to follow along the Jupyter Notebook while going through this tutorial.", "Over the past couple of years, there has been a rise in using deep learning for medical image analysis with increasing success. Deep learning in the field of healthcare is used to identify patterns, classify and segment medical images. As with most image related tasks, convolutional neural networks are used to do this.", "The classification problem tackled here is to classify histopathology slides of Invasive Ductal Carcinoma (IDC) as either malignant or benign.", "IDC is a type of breast cancer, where the cancer has spread to the surrounding breast tissue.", "Cancer tumours can be classified into two types: malignant and benign. A benign tumor is one which does not invade its surrounding tissues whereas a malignant tumor is one which may spread to its surrounding tissues or other parts of the body.", "The dataset we will use can be downloaded here. Scroll down to the Dataset Description section of the page and download the 1.6 GB zip file.", "The dataset consists of 162 whole mount slide images of breast cancer specimens scanned at 40x. From that,277,524 patches of size 50 x 50 were extracted, out of which 198,738 are IDC negative (benign) and 78,786 are IDC positive (malignant).", "Each patch\u2019s file name is of the format:", "Where u is the patient ID (10253_idx5), X is the x-coordinate of where this patch was cropped from, Y is the y-coordinate of where this patch was cropped from, and C indicates the class where 0 is non-IDC (benign) and 1 is IDC (malignant)", "The dataset consists of 279 folders, with sub-folders 0 and 1 inside each of the 279 folders. We first create two variables classZero and classOne, which saves the image locations of all class 0 and class 1 images respectively", "We then create a function process_images which takes as input the starting and end index of the images. This function first reads the image using OpenCV\u2019s cv2.imread() and also resizes the image. Resizing is done because few of the images in the dataset are not 50x50x3. The function returns two arrays: X, which is an array of the resized image data and Y, which is an array of the corresponding labels.", "For this tutorial, we will only analyze images from index 0 to 60,000. The image data (pixel values) are now stored in a list X and their corresponding classes in a list Y.", "The list X is first converted to a numpy array and then casted to the type float32 to save space.", "The images are first normalized by dividing it by 255. This ensures that all the values are between 0 and 1. This helps us to train the model faster and also prevents us from falling into the vanishing and exploding gradients problem.", "The dataset is split into training and test set, with 15% of the entire dataset reserved for testing. For a dataset of 60,000 , this means 51000 images are reserved for training and 9000 for testing.", "Counting the number of 1\u2019s and 0\u2019s in the array Y, we find that there are 44478 images of class 0 and 15522 images of class 1.", "This problem is known as data imbalance and can cause our model to be more biased towards one particular class, usually the one which has more samples. Particularly in fields such as healthcare, classifying the minority class (malignant in this case) as majority class (benign in this case) can be very risky. We will deal with data imbalance by randomly undersampling the majority class, i.e removing samples of the majority class to make the number of samples of the majority and minority class equal.", "Before that, we need to one-hot-encode the output variable y_train and y_test.", "We also need to reshape X_train and X_test to use the Random Under Sampler.", "The parameter \u2018ratio=majority\u2019 states the random under sampler to under sample the majority class.", "Checking the number of samples of each class again after performing random undersampling, we find that we have equal number of samples of both the classes. The image data is then converted back to its original shape of 50 x 50 x 3.", "We use a similar architecture to the one discussed in this paper.", "The model is a sequential which allows us to create the model layer-by-layer. The architecture consists of convolutional layers, max pooling layers, dropout layers and fully connected layers.", "The first layer is a convolutional layer with 32 filters each of size 3 x 3. We are also required to specify the input shape in the first layer, which is 50 x 50 x 3 in our case.", "We will be using the Rectified linear unit (ReLU) activation function for all the layers except the final output layer. ReLU is the most common choice for activation function in the hidden layers and has shown to work pretty well.", "The second layer is a pooling layer. The pooling layers are used to reduce dimension. Max Pooling with a 2x2 window only considers the maximum value in the 2x2 window.", "The third layer is again a convolutional layer of 64 filters each of size 3 x 3 followed by another max pooling layer of 2x2 window. Usually, the number of filters in the convolutional layer grows after each layer. The first layers with lower number of filter learns simple features of the images whereas the deeper layers learn more complex features.", "The next two layers are again convolutional layers with the same filter size but increasing number of filters; 128 and 256.", "We need to flatten the 3D feature map output from the convolutional layer to 1D feature vectors before adding in the fully connected layers. This is where the flatten layer comes in.", "The next layer is a dropout layer with a dropout rate of 0.5 . A dropout layer with dropout rate of 0.5 means 50% of the neurons will be turned off randomly. This helps prevent overfitting by making all the neurons learn something about the data and not rely on just a few neurons. Randomly dropping neurons during training means other neurons will have to do the work of the turned-off neurons, thus generalizing better and prevent overfitting.", "The value 0.5 is taken from the original paper by Hinton (2012), which has proved to be very effective. These dropout layers are added after each of the fully connected layers before the output. Dropout also reduces the training time for each epoch.", "The following dense layer (fully connected layer) has 128 neurons. This is followed by another dropout layer with a dropout rate of 0.5", "The next layer is another dense layer with 128 neurons.", "The final output layer is another dense layer which has number of neurons equal to the number of classes. The activation function in this layer is sigmoid because the problem in hand is a binary classification problem. For multi-class classification problem, the activation function should be set to softmax.", "The model is compiled with binary cross entropy loss function and the Adam optimizer is used. The \u2018accuracy\u2019 metric is used to evaluate the model.", "Adam is an optimization algorithm which updates the network weights in an iterative manner.", "Although the initial learning rate for Adam can be set (we have set it to 0.00001 in our case), this is the initial learning rate and the learning rate for each parameter is adapted as training begins. This is how Adam (short for adaptive moment estimation) is different from stochastic gradient descent, which maintains a single learning rate for all weight updates. A detailed explanation of the Adam optimization algorithm can be found here", "The learning rate determines how fast we are adjusting the weights of our network towards the local minima. Too high of a learning rate can result in such high weight changes that it might result in overshooting the local minima. This causes the training or validation error to fluctuate drastically between consecutive epochs. Too low of a learning rate can result in taking longer time to train our network. Thus, the learning rate is one of the most important hyperparameters that needs to be tuned when building the model.", "Generally, the more data we have, the better deep learning tends to work. Keras ImageDataGenerator generates real time images during training using data augmentation. Transformations are performed on the mini-batches on-the-fly. Data augmentation helps generalize the model by reducing the network\u2019s capacity to overfit the training data. Rotation, vertical and horizontal flipping are some of the common data augmentation techniques used.", "Keras ImageDataGenerator provides a variety of data augmentation techniques. However, we will only use few of them.", "A histopathology slide labelled as malignant is still malignant if it is rotated 20 degrees and flipped vertically.", "Training the model using a GPU speeds up the training process. You will need a NVIDIA GPU to do so. I followed this tutorial to enable GPU training.", "We set the number of epochs to a high number , in our case 80, and use a regularization method called Early Stopping", "Early stopping is a method used to avoid overfitting by stopping the training process when the parameter set to observe does not improve for a certain number of epochs.", "In our case, we tell EarlyStopping to monitor val_loss and if it does not improve for 3 epochs continuously, stop the training process.\u201d", "The batch size is usually set to a power of 2 because it is more computationally efficient. We have set it to 256.", "We use another Keras callback called ModelCheckpoint", "Model checkpoint is used to save the model. The monitor parameter allow us to set a metric which we want to keep an eye on. In our case, we only save the model when the validation loss is the minimum. We save the best model to be used later to make predictions and thus evaluate the model\u2019s performance.", "Combining both these callbacks, the best model (which has the minimum validation loss) is saved and following that, if validation loss does not improve (decrease) over the next 3 epochs (set by EarlyStopping), the model training stops.", "Because we are using ImageDataGenerator on the fly, we use model.fit_generator to train the model. We set it to a variable \u2018training\u2019 as we will later plot the training loss and validation loss. This helps us get an idea of the variance, i.e the difference between training error and validation set error.", "For validation, we will use X_testRosReshaped and Y_testRosHot which we obtained after under-sampling the x_test and y_test set.", "Training stops after 37 epochs due to Early Stopping. Hence, the best model saved is the one during epoch 34, with a validation accuracy of 79.10%", "Plotting the training set and validation set loss, we find that the variance is very low. This plot ensures that our model is not overfitting.", "We load the best model saved by ModelCheckpoint and use the predict function to predict the classes of the images in the array X_testRosReshaped. The predictions are now stored in the list y_pred_labels.", "We use a confusion matrix to evaluate the models performance. The confusion matrix in a binary classification matrix has four quadrants; false positives, false negatives, true positives and true negatives.", "For our case, the four quadrants of the confusion matrix can be simplified as follows:", "The confusion matrix we get is:", "In cases such as this, having a lower false negative is better than having a lower false positive. This is because identifying a malignant tumour as benign is more dangerous than identifying a benign tumour as malignant, since the former will result in the patient receiving a different treatment due to misdiagnosis, and the latter is likely to go through further tests anyway.", "We can see that our model performs well with an accuracy of 79.10% on the test set. The confusion matrix only is also favourable for us and we have a model with low variance.", "Applying deep learning is an iterative process. You can try and improve this model further by tuning the hyperparameters such as learning rate of the optimization algorithm, changing the batch size, changing the filters of the convolutional layers, adding in more layers or using more data.", "Thanks for reading. If you have any questions, comment them down below. I will be writing regularly on topics such as deep learning, so follow me here on Medium. I am also available on LinkedIn! :) Happy coding.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Interested in using AI to solve real world problems"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdebb429de9a6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://baruahbikram05.medium.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": ""}, {"url": "https://baruahbikram05.medium.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Bikram Baruah"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F613e0875cc8d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&user=Bikram+Baruah&userId=613e0875cc8d&source=post_page-613e0875cc8d----debb429de9a6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/bikramb98/invasive-ductal-carcinoma-cnn/blob/master/Predicting%20Invasive%20Ductal%20Carcinoma%20using%20CNN%20in%20Keras.ipynb", "anchor_text": "here"}, {"url": "http://www.andrewjanowczyk.com/use-case-6-invasive-ductal-carcinoma-idc-segmentation/", "anchor_text": "here"}, {"url": "http://www.apsipa.org/proceedings/2017/CONTENTS/papers2017/15DecFriday/FP-02/FP-02.3.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1207.0580.pdf", "anchor_text": "Hinton (2012)"}, {"url": "https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/", "anchor_text": "here"}, {"url": "https://medium.com/@ab9.bhatia/set-up-gpu-accelerated-tensorflow-keras-on-windows-10-with-anaconda-e71bfa9506d1", "anchor_text": "tutorial"}, {"url": "https://www.linkedin.com/in/bikramb/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----debb429de9a6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----debb429de9a6---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----debb429de9a6---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----debb429de9a6---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/python?source=post_page-----debb429de9a6---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&user=Bikram+Baruah&userId=613e0875cc8d&source=-----debb429de9a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&user=Bikram+Baruah&userId=613e0875cc8d&source=-----debb429de9a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdebb429de9a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----debb429de9a6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----debb429de9a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----debb429de9a6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----debb429de9a6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----debb429de9a6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----debb429de9a6--------------------------------", "anchor_text": ""}, {"url": "https://baruahbikram05.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://baruahbikram05.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bikram Baruah"}, {"url": "https://baruahbikram05.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "99 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F613e0875cc8d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&user=Bikram+Baruah&userId=613e0875cc8d&source=post_page-613e0875cc8d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5e13f0fa982&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-invasive-ductal-carcinoma-using-convolutional-neural-network-cnn-in-keras-debb429de9a6&newsletterV3=613e0875cc8d&newsletterV3Id=5e13f0fa982&user=Bikram+Baruah&userId=613e0875cc8d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}