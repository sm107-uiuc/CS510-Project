{"url": "https://towardsdatascience.com/serverless-ml-3184c9c45f93", "time": 1683002250.4709709, "path": "towardsdatascience.com/serverless-ml-3184c9c45f93/", "webpage": {"metadata": {"title": "Serverless ML. Bring your models to life with AWS\u2026 | by Phil Massie | Towards Data Science", "h1": "Serverless ML", "description": "Wrangling data and training models can feel a little\u2026 disconnected. In this post I\u2019ll walk through deploying an ML model in the cloud. It\u2019s quick, easy and free (I think)."}, "outgoing_paragraph_urls": [{"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "You can read more here", "paragraph_index": 1}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://www.google.com/search?q=install+docker", "anchor_text": "how to install", "paragraph_index": 8}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "github repo", "paragraph_index": 10}, {"url": "https://darksky.net/dev", "anchor_text": "https://darksky.net/dev", "paragraph_index": 11}, {"url": "https://locationiq.com/", "anchor_text": "https://locationiq.com", "paragraph_index": 12}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/install-cliv1.html", "anchor_text": "check these instructions for other systems and troubleshooting", "paragraph_index": 15}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration", "anchor_text": "detailed instructions", "paragraph_index": 18}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "github repo", "paragraph_index": 30}], "all_paragraphs": ["Working day in and day out wrangling data sets, engineering interesting features and testing and training heaps and heaps of models can leave you feeling a bit disconnected from real-world systems. Well, it can for me at any rate. Recently I\u2019ve spent time with software engineers who\u2019ve helped me understand how ML models can be deployed in the cloud by leveraging serverless architectures, at little or no cost. As a result, models or ensembles of models can fit into larger systems via simple API calls.", "Using AWS Lambdas, we don\u2019t need to keep costly EC2 instances up and running 24/7. Lambdas spin up really fast as required. (Google Cloud have a similar offering called Cloud Functions but here I\u2019ll be focusing on the AWS offering.) In the background of course they are all running on EC2 servers but Lambdas are so abstracted away from them that you don\u2019t need to bother about the EC2s. There are many good reasons to think go serverless but I don\u2019t want to run an advert. You can read more here", "A Lambda is essentially a small fast container preconfigured with one of a number of different runtimes. These include:", "As a data scientist I work principally with Python these days and in this tutorial I\u2019ll walk you through deploying a simple ML model in an AWS Lambda. There is an accompanying github repo here which includes all the code you\u2019ll need along with the model, data and training data.", "This is not an exercise in training a great model. As a use case I used historical weather data for Cape Town to train a model to predict the likelihood of rain tomorrow based on Cape Town\u2019s history. You can feed it any city in the world, and it will predict whether it will rain there tomorrow based on Cape Town\u2019s history. That\u2019s ok, it\u2019s not really the point.", "If you are unfamiliar with Lambdas or disillusioned with the costs of housing your Docker Containers on EC2 instances, hopefully this will give you an idea of how cheap and easy it can be to think about larger more complex systems of models and code. With luck your creative juices will be stimulated.", "This looks a little tedious but is worth figuring out. Much of it you will only need to do once. I\u2019ll gloss over some things here like AWS execution roles and key management. Additionally the tutorial will use both the AWS web console and the CLI. If you\u2019re unfamiliar with the CLI, hopefully this will be an easy introduction to it.", "We will use the Python 3.6 Lambda runtime environment as this runtime comes with a preconfigured layer containing scipy/numpy. Because these packages have OS dependencies not present in the Lambda environment by default, this layer is critical for us to use any of the low level math functions such as those in SKLearn. I see that the Python 3.7 runtime also has a scipy/numpy layer now!", "In order to build layers we need to install Python packages locally in an environment that matches the Lambda\u2019s remote environment.Solution: Docker (how to install)", "If you\u2019re in Ubuntu, this should get you going:", "A github repo is available for this tutorial. Directory structure is important and I\u2019ll assume you\u2019re running commands from the project root.", "You\u2019ll need a free account here in order to query weather data. Sign up at https://darksky.net/dev. After signup and login, your home page should show you your secret key. Store this in layers/03_rain_model/keys.csv.", "Sign up for a free account at Location IQ https://locationiq.com for geocoding. Create an Access Token and store this in layers/03_rain_model/keys.csv.", "If you haven\u2019t already, set up your free AWS account.", "AWS CLI provides command line access to AWS. You need to install it, typically with pip, and configure it for use with your AWS account.", "TLDR Ubuntu version check these instructions for other systems and troubleshooting:", "We\u2019ll need to use the console to configure AWS CLI.", "Logged in to the AWS console:", "Back to your terminal ( detailed instructions):", "Back to the web console, S3 section, create an empty bucket for this project. Bucket names have to be unique across all buckets so call this something you can remember. You can of course also get this done with the CLI.", "I\u2019ll call mine severless-ml-tutorial in US West Oregon (to match our config). you'll need to adjust the code below to match this name.", "I think this is the only place you could potentially incur some costs. S3 storage is not free, although at this scale it is very cheap. After building your layers delete this bucket to save potential costs. I have a couple buckets with a few MB inside and I haven\u2019t incurred a cost yet. It\u2019s a little confusing.", "Still there? well done! Ok lets build our first simple Lambda. We will expand on it later.", "Your Lambda will be created and it\u2019s properties screen will open.", "Now we will configure an http gateway where we can interact with our new Lambda.", "Now we add an example query so that we can test how our Lambda will respond to API calls. We will be sending our Lambda the name of a city so lets set up a test event to do that.", "Now at last we can add some code. This is extremely simple, It assigns the incoming string to a variable, prints it out and returns a formatted HTML string containing the string.", "Scroll down to Function code panel", "You have now got a simple Lambda, accessible via a URL, you can send it a payload, and it can process and return the payload, in this case as an HTTP response.", "Before we add more code to do more interesting things, lets make our Lambda architecture a little more powerful. We can do this by adding layers. Layers are simply additional resources you\u2019re including in your Lambda container \u2014 There are size constraints to deal with so don\u2019t go too crazy.", "After this section we can get back to the code and extend the Lambda. If you have the github repo you\u2019ll see that I have the files required to build each layer nested within a layers directory.", "Typically we need to collate the contents of each layer, upload them to S3, compile the contents into Lambda layers and then attach the layers to our Lambda.", "This layer is precompiled by AWS and includes not only python libraries but also system libraries that we need to use. This is a really difficult layer to build for yourself but thankfully AWS have done the heavy lifting for us. We dont need to build this layer.", "This layer will include all of the required Python libraries betond those installed by default. We will collate the contents of this layer on our local machine using a docker container that resembles the Lambda environment, namely lambci. From within lambci container, we can use pip to install the libraries to a local directory, outside of the container. We then use this directory to build our new layer.", "In the terminal, from the project root:", "If that worked as expected you should now see a \u2018python\u2019 directory inside your \u201802_dependencies\u2019 layer directory.", "We need to compress the layer contents in preparation for uploading to S3.", "Using the AWS CLI instead of the web Console, sync the contents of your zips directory with a location in S3. It\u2019s a good idea to keep the web console open to see that what you\u2019re doing is having the desired effect.", "Now we can use the uploaded zip file to update or create a Lambda layer that can be used in any Python 3.6 Lambda. Remember to change the name of your bucket next to S3Bucket=.", "The files for this layer already exist on the layers/03_rain_model/ directory, so no Docker hijinks needed here. You need to put your api keys into the file called keys.csv.template and rename it to keys.csv.", "Despite the name and main purpose of the layer, I\u2019ll include the API keys in addition to the model object. NB This is NOT the correct/secure way to manage keys in the cloud.", "DON\u2019T DO THIS WITH IMPORTANT KEYS!", "We need to compress the layer contents in preparation for uploading to S3.", "As before, upload the layer contents to S3\u2026", "\u2026 and build the layer. Remember to change your bucket name here.", "Use the AWS web console to make sure layers exist.", "We will add all the required layers to our Lambda and then we\u2019re done with the set-up.", "In the web console, open your Lambda", "In the Designer pane, click \u2018Layers\u2019.", "That\u2019s it for the set-up. If you\u2019ve gotten this far well done! Writing this out, it seems very long. All that\u2019s left now is to build out the code!", "Each of the following steps expands on the code from the previous step. To follow along and see how the functionality grows, add each block of code to the bottom of the previous, overwriting the previous code\u2019s return braces. After updating and saving at each step, reload the API endpoint URL and submit a different city if you\u2019d like.", "Alternatively, find the full code in severless-ml-lambda.py.", "This block loads up the API keys and uses the LoationIQ key to geocode the city you submitted. These results are printed and returned via http.", "This code takes the DarkSky key and the LocationIQ GPS co-ordinates and returns the current weather conditions for the city you submitted.", "Add this code block to load up the model you pushed in layer 3 and make a prediction about weather it might rain tomorrow.", "NB you will run into memory errors when you test this. Scroll down to Basic settings panel and increase your Lambda\u2019s memory to 1024 Mb. While youre there increase your timeout to 10 sec.", "This last step writes the results of each query out to S3. It\u2019s really just a little extra to show how simple it can be to interact with the AWS infrastructure from Python and Lambdas.", "Admittedly that was quite a long tutorial. Hopefully it has illustrated how a trained model can be incorporated into a larger codebase by using serverless functions. Enjoy.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3184c9c45f93&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pmassie?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pmassie?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Phil Massie"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F468cac846b6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&user=Phil+Massie&userId=468cac846b6f&source=post_page-468cac846b6f----3184c9c45f93---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "You can read more here"}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "here"}, {"url": "https://www.google.com/search?q=install+docker", "anchor_text": "how to install"}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "github repo"}, {"url": "https://darksky.net/dev", "anchor_text": "https://darksky.net/dev"}, {"url": "https://locationiq.com/", "anchor_text": "https://locationiq.com"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/install-cliv1.html", "anchor_text": "check these instructions for other systems and troubleshooting"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration", "anchor_text": "detailed instructions"}, {"url": "https://github.com/philmassie/serverless_ml.git", "anchor_text": "github repo"}, {"url": "https://philmassie.github.io/post/20191220/serverless_ml/", "anchor_text": "https://philmassie.github.io/post/20191220/serverless_ml/"}, {"url": "https://medium.com/tag/aws?source=post_page-----3184c9c45f93---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3184c9c45f93---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/lambda?source=post_page-----3184c9c45f93---------------lambda-----------------", "anchor_text": "Lambda"}, {"url": "https://medium.com/tag/serverless?source=post_page-----3184c9c45f93---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3184c9c45f93---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&user=Phil+Massie&userId=468cac846b6f&source=-----3184c9c45f93---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&user=Phil+Massie&userId=468cac846b6f&source=-----3184c9c45f93---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3184c9c45f93&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3184c9c45f93---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3184c9c45f93--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3184c9c45f93--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3184c9c45f93--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pmassie?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pmassie?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Phil Massie"}, {"url": "https://medium.com/@pmassie/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "22 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F468cac846b6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&user=Phil+Massie&userId=468cac846b6f&source=post_page-468cac846b6f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F468cac846b6f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-ml-3184c9c45f93&user=Phil+Massie&userId=468cac846b6f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}