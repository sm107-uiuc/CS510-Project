{"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08", "time": 1683015170.973142, "path": "towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08/", "webpage": {"metadata": {"title": "Emulating a PID Controller with Long Short-term Memory: Part 1 | by Nicholas Lewis | Towards Data Science", "h1": "Emulating a PID Controller with Long Short-term Memory: Part 1", "description": "Do you ever just get really excited about an idea? Maybe it\u2019s a new DIY project you\u2019re tackling, or a cool assignment at work. Maybe you\u2019re crazy like me and want to hike the Pacific Crest Trail (as\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.pcta.org/", "anchor_text": "Pacific Crest Trail", "paragraph_index": 0}, {"url": "https://www.sciencedirect.com/science/article/pii/S2405896318320597", "anchor_text": "Some researchers", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b", "anchor_text": "earlier post", "paragraph_index": 3}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "APMonitor.com", "paragraph_index": 3}, {"url": "https://apmonitor.com/pdc/index.php/Main/ProportionalIntegralDerivative", "anchor_text": "APMonitor.com", "paragraph_index": 5}, {"url": "https://apmonitor.com/pdc/index.php/Main/FirstOrderSystems", "anchor_text": "first order plus dead time (FOPDT) model", "paragraph_index": 7}, {"url": "https://apmonitor.com/pdc/index.php/Main/TCLabFOPDT", "anchor_text": "enerate a step response for your TCLab", "paragraph_index": 8}, {"url": "https://apmonitor.com/pdc/index.php/Main/FirstOrderGraphical", "anchor_text": "obtain tuning parameters for a PID controller graphically", "paragraph_index": 8}, {"url": "https://medium.com/@nrlewis929/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b", "anchor_text": "another article", "paragraph_index": 18}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "Github", "paragraph_index": 21}], "all_paragraphs": ["Do you ever just get really excited about an idea? Maybe it\u2019s a new DIY project you\u2019re tackling, or a cool assignment at work. Maybe you\u2019re crazy like me and want to hike the Pacific Crest Trail (as I\u2019m moving to Seattle soon, so I can\u2019t help but get excited about the idea of flying down to San Diego and walking home). Well, this project is one of those types of ideas for me, and I hope you enjoy the ride!", "Before I get started, though, I want to warn you that this is quite an extensive project, and so I\u2019m breaking it up into parts. They will be as follows:", "While working on a project for work one day, I came across a paper that introduced a novel idea. Some researchers had the idea to emulate the behavior of a model predictive control (MPC) strategy using a neural network. The idea was that some MPC problems are extremely computationally expensive, but the behavior is predictable; if we could emulate that behavior by training a deep neural network, we could, in theory, replace the computationally expensive MPC with a much faster machine learning model. The only computationally expensive part of the process would be the model training.", "The really neat part of this is that I test the idea here at my desk. The Temperature Control Lab is perfectly designed to prototype this kind of problem. I introduced the TCLab and some basic anomaly detection you can do with machine learning in an earlier post. If you\u2019re new to the TCLab, you can check out my article, or look at the abundant resources at APMonitor.com.", "So here\u2019s what I decided to try: I wanted to tune a Proportional-Integral-Derivative (PID) controller so I could set a temperature on the TCLab and the controller would adjust the heater until it hit that setpoint. Then, I wanted to see if I could emulate this behavior with a Long Short-term Memory neural network. If this prototype worked, it would open the doors for not only improving computational speed, but also applications such as anomaly detection.", "This series is about the machine learning, so if you\u2019re not familiar with PID controllers or control theory, that\u2019s perfectly fine; we\u2019ll just hit a few highlights so you understand the context. There are some amazing resources at APMonitor.com to help you understand PID controllers and how to tune them. These controllers are ubiquitous in engineering industry, and so the potential applications for this are numerous.", "Control systems are everywhere. Think about your thermostat: all you have to do is plug in the temperature, and somehow it knows when to turn the heat on and off to keep your house at that temperature (except, of course, for the room that\u2019s always an ice box\u2026). How does it do that? Control systems can be broken down into three parts: a sensor (something that reads the temperature in the house), an actuator (the A/C or furnace that turns on cold or hot air), and a controller (the computer in your thermostat that is the brains behind the operation). The sensor data feeds into the controller, which then tells the actuator what to do.", "PID controllers are ubiquitous for a reason: they\u2019re straightforward and extremely effective, especially when paired with a first order plus dead time (FOPDT) model. In the case of our TCLab, it takes the difference between the temperature setpoint and temperature sensor (represented as e(t) in the equation below) as an input, and outputs a heater value (labeled output, or OP, below) that will allow the temperature to approach the setpoint. As the name suggests, there is a proportional, integral, and derivative portion to this.", "K_c, \u03c4_I, and \u03c4_D are called the tuning constants, and determine how the controller behaves. You can generate a step response for your TCLab, and then obtain tuning parameters for a PID controller graphically. For my TCLab, some effective tuning parameters were K_c = 6.0, \u03c4_i =75.0, and \u03c4_d = 0.0. Yours will likely be different since each TCLab behaves slightly differently. Let\u2019s take a look at the code now for the PID controller. I put it in the function pid(sp,pv,pv_last,ierr,dt) .", "The first part is to load your tuning parameters and other constants:", "Then we want to calculate the error between the setpoint (sp) and temperature (also referred to as process variable, pv):", "The integral portion is calculated numerically, adding whatever the previous error was to the current time step error:", "And finally, the derivative portion of the controller (also calculated numerically) looks like this:", "Putting it all together now, we can calculate the PID output (op):", "And finally, just to make sure we account for the heater limit between 0 and 100, we add an anti-reset windup condition:", "That\u2019s not so bad! If nothing else, you learned how to program a PID controller function, which is extremely useful for industrial controllers.", "Now we need to actually run the PID controller on the TCLab. We\u2019ll set up several arrays to store data as we go, and run the controller for 90 minutes to make sure we have plenty of data. We\u2019ll change the temperature setpoint intermittently so we have a good mix of steady-state and transient behavior. Here\u2019s what my setup looks like:", "It never hurts to plot what you expect should happen. Over the course of 90 minutes, we intend for the PID controller to set the heater such that the temperature follows this profile:", "We\u2019re all set! I went into more details of how to set up a run on the TCLab in another article I wrote, but this application is slightly more advanced. Most notably, we call our pid(sp,pv,pv_last,ierr,dt) function at each time step to return the heater output so that we stay at the right temperature. We\u2019re updating this every second; the PID isn\u2019t too computationally expensive, so it can easily solve within that time.", "Let\u2019s take a look at how the controller did:", "Pretty neat! We want the red line, which is the temperature sensor, to follow the black line, which is the temperature setpoint. The blue shows how the heater adjusted so that the sensor would match the setpoint. We could always tune the PID parameters for different performance, but we want to get to the machine learning part, so for this exercise, this is perfect. And I don\u2019t know about you, but we haven\u2019t even started the machine learning, but just programming our own controller at our desk is already exciting!", "First things first, you can download the code for this from Github. This exercise depends a lot on the TCLab, but I\u2019m hoping in the future to add some alternative notebooks with raw data so that you can run the code without one.", "How neat is it that we can program a device to control the temperature? There are so many applications \u2014 think of your thermostat, or oven, or even a fancy barbeque grill. Not to mention the industrial applications of reactor temperature or feed stream temperature. What other applications can you think of for this type of controller?", "Thanks for bearing with me through this introductory article, especially if you\u2019ve never seen a controller. I know I promised some machine learning applications, and that\u2019s exactly what we\u2019re working up to. We\u2019ll dive into that first thing in the next section (coming October 2020). If anything, though, I feel that it\u2019s important to understand the background behind machine learning applications. Not only does it make them relevant to our work or daily lives, but it also opens up the door for greater insights. I\u2019m happy to hear what ideas this might open up for you!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbb5b87165b08&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://nrlewis929.medium.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702----bb5b87165b08---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@5tep5?utm_source=medium&utm_medium=referral", "anchor_text": "Alexander Popov"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.pcta.org/", "anchor_text": "Pacific Crest Trail"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Training a Long Short-term Memory neural network in Keras to emulate a PID controller"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Controlling the Temperature Control Lab with an LSTM"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b", "anchor_text": "Practical applications of temperature control using LSTM controller instead of PID controller"}, {"url": "https://www.sciencedirect.com/science/article/pii/S2405896318320597", "anchor_text": "Some researchers"}, {"url": "https://towardsdatascience.com/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b", "anchor_text": "earlier post"}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "APMonitor.com"}, {"url": "https://apmonitor.com/pdc/index.php/Main/ProportionalIntegralDerivative", "anchor_text": "APMonitor.com"}, {"url": "https://unsplash.com/@wesleyphotography?utm_source=medium&utm_medium=referral", "anchor_text": "Wesley Tingey"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://apmonitor.com/pdc/index.php/Main/FirstOrderSystems", "anchor_text": "first order plus dead time (FOPDT) model"}, {"url": "https://apmonitor.com/pdc/index.php/Main/TCLabFOPDT", "anchor_text": "enerate a step response for your TCLab"}, {"url": "https://apmonitor.com/pdc/index.php/Main/FirstOrderGraphical", "anchor_text": "obtain tuning parameters for a PID controller graphically"}, {"url": "https://medium.com/@nrlewis929/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b", "anchor_text": "another article"}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "Github"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----bb5b87165b08---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/lstm?source=post_page-----bb5b87165b08---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/python?source=post_page-----bb5b87165b08---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/process-control?source=post_page-----bb5b87165b08---------------process_control-----------------", "anchor_text": "Process Control"}, {"url": "https://medium.com/tag/lstm-control-emulation?source=post_page-----bb5b87165b08---------------lstm_control_emulation-----------------", "anchor_text": "Lstm Control Emulation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----bb5b87165b08---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----bb5b87165b08---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbb5b87165b08&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bb5b87165b08---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bb5b87165b08--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bb5b87165b08--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bb5b87165b08--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://nrlewis929.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "214 Followers"}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "https://www.linkedin.com/in/nicholas-lewis-0366146b/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9c6ec087b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08&newsletterV3=a4cd35f7b702&newsletterV3Id=9c6ec087b148&user=Nicholas+Lewis&userId=a4cd35f7b702&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}