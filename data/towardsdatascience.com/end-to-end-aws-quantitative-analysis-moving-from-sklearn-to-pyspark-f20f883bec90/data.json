{"url": "https://towardsdatascience.com/end-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90", "time": 1682993155.1392488, "path": "towardsdatascience.com/end-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90/", "webpage": {"metadata": {"title": "End-to-end Quantitative Analysis \u2014 Moving from SKLearn to Spark | by Boris Shabash | Towards Data Science", "h1": "End-to-end Quantitative Analysis \u2014 Moving from SKLearn to Spark", "description": "In a previous post I described how to set up an automated workflow using Amazon Web Services (AWS). We\u2019ve explored how to spin up Elastic Map Reduce (EMR) clusters using AWS\u2019s command line tool\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/end-to-end-quantitative-trading-automating-ml-using-awscli-83035b4f6d03", "anchor_text": "previous post", "paragraph_index": 0}, {"url": "https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html", "anchor_text": "MLlib", "paragraph_index": 9}, {"url": "https://spark.apache.org/docs/latest/api/python/pyspark.ml.html", "anchor_text": "ML", "paragraph_index": 9}, {"url": "https://towardsdatascience.com/end-to-end-quantitative-trading-automating-ml-using-awscli-83035b4f6d03", "anchor_text": "earlier post", "paragraph_index": 14}], "all_paragraphs": ["In a previous post I described how to set up an automated workflow using Amazon Web Services (AWS). We\u2019ve explored how to spin up Elastic Map Reduce (EMR) clusters using AWS\u2019s command line tool, awscli.In that post we\u2019ve seen how to use sklearn\u2019s DecisionTreeClassifier to classify price movement as \u201cgoing up\u201d or \u201cgoing down\u201d (1 or 0, binary classification problem).", "One drawback of using sklearn is that it uses a single machine to perform all calculations. This setup increases run-time as data increases, even when our EMR clusters can contain multiple machines capable of distributed computing. This is where Spark comes in with its version of a DecisionTreeClassifier. We will compare the use of sklearn and Spark in this tutorial.", "Spark is an Apache framework designed to do parallel and distributed processing across multiple machines. The idea is to break up the work into independent chunks that can all be computed (partition the data), then pool the results of the independent calculations. Spark is very powerful, but, sadly for Python programmers, is written in Java. This is where PySpark comes into play. It\u2019s a python wrapper around the Spark framework.", "Spark combines several abstractions from pandas, such as dataframes, as well as from sklearn, such as transformations and machine learning techniques.", "The first thing we have to do is convert our pandas dataframe into a spark dataframe. This is a very common operation so PySpark has a built-in function to do exactly that.", "Notice we have used Spark\u2019s built-in types to specify a schema for the conversion. This step is highly recommended and saves tons of processing time. If this is not done, Spark tries to infer the schema on its own. Also notice we set the nullable Attribute to False in the schema. This also saves processing time since Spark doesn\u2019t have to worry about some columns containing nulls when doing the conversion.Once we do that, you notice we can print the spark dataframe\u2019s schema to see its structure:", "Scikit-learn models are employed on tabular data; either numpy arrays or pandas dataframes. However, Spark machine learning models require a slightly different architecture.", "While pandas and numpy leverage efficient memory use on a single machine, Spark is more concerned with easily spreading the data across different machines. As such, it needs every datapoint encapsulated in a single vector class. We need to employ a VectorAssembler to convert our feature columns into a single column which contains a vector. We have to tell the VectorAssembler which columns to insert into this new column.", "Now, when we check the schema, we see we added a single column of type vector which stores our data. Under this method, each data point is an encapsulated item which can be sent around our cluster.", "Spark has two main machine learning libraries; MLlib and ML. The preferred library is ML since MLlib is slowly fading out of style. We will employ the decision tree classifier from ML.", "This part is fairly similar to our use of sklearn; We initialize our model, fit it, and then ask for predictions. There are two main differences:1) We have to specify the features and target columns in the same dataframe. The decision tree expects all the features to reside in a single column (of type vector). 2) Unlike the sklearn decision tree, there are no separate predict and predict_proba methods. A very detailed dataframe is returned as our predictions which contains hard class predictions, probability predictions, and many more items.", "We will run the following code to employ the decision tree:", "We\u2019ve taken a few steps there so let\u2019s break it down:", "We\u2019re going to need to use a new command with slightly more information here", "I won\u2019t explore every new parameter since I explored the create-cluster command in my earlier post. However I will point out that you will have to set the s3 buckets to be your own buckets. With that being said, let\u2019s take a look at a few new parameters we\u2019ve added:", "For comparison\u2019s sake, let\u2019s take a look at the code I previously used for the sklearn tree as well as for Spark\u2019s tree.", "Employing Spark\u2019s decision tree ends up being more than twice as fast for data processing. This is along the lines of what we expected since Spark can cut the work up between the task and core nodes. However, this particular example becomes slightly more complex.", "While Spark\u2019s decision tree shows clearly superior performance, employing Spark was not a much faster operation in this case.", "The cluster employing the sklearn decision tree had a total run time of 14 minutes, while the Spark cluster ran for 13 minutes. The close run times come from the fact that converting the dataframe into a Spark dataframe can be a costly operation on its own.", "However, the data we were exploring in this instance was only ~4GB in size. This difference will certainly increase as both the data size, and the cluster size, increase. Spark was designed to run on terabytes of data and more. So this example only illustrates the process of deploying a Spark based machine learning workflow.", "The entire script which was used for the processing with PySpark can be found below:", "Spark can be used to accelerate your machine learning needs, and as it contains many of the same algorithms employed in sklearn, the transition is quite easy. The PySpark interface allows for an almost seamless transition, once you are familiar with the Spark framework. However, to reach that point of familiarity, one must venture past the usual knowledge of machine learning algorithms and also dive into configuration and memory management knowledge to allow Spark applications to run to their full potential.", "I had a lot of fun writing this particular post, and I hope you had fun reading it. I have a few more things to learn about Spark but I hope to make your learning experience easier.", "While experimenting with clusters of size 3\u20134 nodes, as well as taking quite some time to realize specifying an explicit schema saves quite a lot of processing time, I had to spend a bit more money on learning how to use Spark. I hope this tutorial will indeed save time and money for whoever reads it, but the overall cost for me has been around $60. I advice you to be careful when prototyping with Spark and EMR, since it is easy to rack up charges, but you can\u2019t learn how to use these tools without trying and failing.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019ve received my PhD in computing science from Simon Fraser University in 2018, and have since been dedicated to a life-long learning of data science and ML"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff20f883bec90&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f20f883bec90--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@boris.shabash?source=post_page-----f20f883bec90--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@boris.shabash?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Boris Shabash"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8d008f0ff99&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&user=Boris+Shabash&userId=8d008f0ff99&source=post_page-8d008f0ff99----f20f883bec90---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@artunchained?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Manuel Geissinger"}, {"url": "https://www.pexels.com/photo/interior-of-office-building-325229/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://towardsdatascience.com/tagged/building-an-aws-pipeline", "anchor_text": "BUILDING AN AWS PIPELINE"}, {"url": "https://towardsdatascience.com/end-to-end-quantitative-trading-automating-ml-using-awscli-83035b4f6d03", "anchor_text": "previous post"}, {"url": "https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html", "anchor_text": "MLlib"}, {"url": "https://spark.apache.org/docs/latest/api/python/pyspark.ml.html", "anchor_text": "ML"}, {"url": "https://towardsdatascience.com/end-to-end-quantitative-trading-automating-ml-using-awscli-83035b4f6d03", "anchor_text": "earlier post"}, {"url": "https://medium.com/tag/building-an-aws-pipeline?source=post_page-----f20f883bec90---------------building_an_aws_pipeline-----------------", "anchor_text": "Building An Aws Pipeline"}, {"url": "https://medium.com/tag/spark?source=post_page-----f20f883bec90---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/aws?source=post_page-----f20f883bec90---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/big-data?source=post_page-----f20f883bec90---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f20f883bec90---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&user=Boris+Shabash&userId=8d008f0ff99&source=-----f20f883bec90---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&user=Boris+Shabash&userId=8d008f0ff99&source=-----f20f883bec90---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff20f883bec90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f20f883bec90---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f20f883bec90--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f20f883bec90--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f20f883bec90--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f20f883bec90--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f20f883bec90--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@boris.shabash?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@boris.shabash?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Boris Shabash"}, {"url": "https://medium.com/@boris.shabash/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "211 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8d008f0ff99&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&user=Boris+Shabash&userId=8d008f0ff99&source=post_page-8d008f0ff99--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4dfac71a59d7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-aws-quantitative-analysis-moving-from-sklearn-to-pyspark-f20f883bec90&newsletterV3=8d008f0ff99&newsletterV3Id=4dfac71a59d7&user=Boris+Shabash&userId=8d008f0ff99&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}