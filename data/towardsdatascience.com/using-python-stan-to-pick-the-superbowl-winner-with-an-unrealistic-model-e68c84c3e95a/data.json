{"url": "https://towardsdatascience.com/using-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a", "time": 1683002592.5640461, "path": "towardsdatascience.com/using-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a/", "webpage": {"metadata": {"title": "Using Python & Stan to pick the Superbowl Winner with an Unrealistic Model | by Bill Fite | Towards Data Science", "h1": "Using Python & Stan to pick the Superbowl Winner with an Unrealistic Model", "description": "This article will illustrate an approach to using Stan to build a simple, unrealistic but useful, probability model to: I was originally looking for a small problem to learn how to use Stan for\u2026"}, "outgoing_paragraph_urls": [{"url": "https://mc-stan.org/", "anchor_text": "https://mc-stan.org/", "paragraph_index": 2}, {"url": "https://www.pro-football-reference.com/years/2019/games.htm", "anchor_text": "https://www.pro-football-reference.com/years/2019/games.htm", "paragraph_index": 5}, {"url": "http://miner3.com", "anchor_text": "miner3.com", "paragraph_index": 39}], "all_paragraphs": ["This article will illustrate an approach to using Stan to build a simple, unrealistic but useful, probability model to:", "I was originally looking for a small problem to learn how to use Stan for Bayesian modeling. An NFL power ranking model seemed like something that would be interesting to try. The small sample size of the data for a particular year made it attractive:", "From Stan\u2019s home page \u2014 https://mc-stan.org/ \u2014 where the software can be downloaded.", "\u201cStan is a state-of-the-art platform for statistical modeling and high-performance statistical computation. Thousands of users rely on Stan for statistical modeling, data analysis, and prediction in the social, biological, and physical sciences, engineering, and business.", "Users specify log density functions in Stan\u2019s probabilistic programming language and get:", "Data is easily available from https://www.pro-football-reference.com/years/2019/games.htm. Just click the share arrow tab to get a csv layout of the data to copy.", "To keep the model simple, the fields that are needed for the model are:", "In actual games scoring events result in 1,2,3 or 6 points and are the results of more than 3 factors.", "The model that will be estimated will treat score as a function of only the team\u2019s offense, opponent\u2019s defense and whether or not the team is playing at home.", "The unrealistic model used to predict the points a team scores is:", "The model will be estimated using Pystan with prior distributions on the features in the model described below.", "Sorry \u2014 wrangling for any data scientist reading this \u2014 my apologies.", "(1) read in the saved csv file of results & rename columns:", "(2) build a dictionary mapping the City-team name to team name and team id. Originally, I thought I would have to build a 256 by 65 X design matrix, so the team id is col_id in the code below. More on that later.", "Problems can show up later if the col_id is not started to 1 as Stan by default starts at 1 and not 0.", "first few team_dict entries with k is the team_id:", "(3) build the reverse dictionary to map the column id back to the team", "(4) build the X matrix to feed to Stan. It will have 3 columns:", "For each row in the data, two rows are created in the X matrix, one for the winning team and one for the loser. idx_o & idx_d are the indices for the offense and defense teams in the team_dict.", "This results in storing what could be a very sparse matrix (only 3 nonzero elements in each row of 65 columns) in 3 column vectors.", "(1) Data dictionary definition for Stan \u2014 fairly straightforward, telling Stan what the data is and how many rows (N).", "(2) Define the Stan model \u2014 a Python multiple line string.", "(3) Compile the Stan model \u2014 this takes a while. An info message will be printed out.", "(4)Estimate the model coefficients \u2014 op will be a dictionary containing the offense and defense coefficients for each team, a home/away coefficient, the intercept, and the predicted mu.", "At this point we now have in hand the model weights that enable us to predict the number of points that will be scored in a game for any 2 teams based on their offense & defense coefficients and whether or not the team is at home by running the sigmoid transform on the the game.", "We can simulate the outcomes of any team playing any other team\u2026 not limited to actual games played. So why not do it? We simulate a schedule where each team \u2018plays\u2019 each other team 100 times \u2014 50 times at home and 50 times away. We keep track of the wins, losses and ties.", "First we need to adjust the indices (team_ids) since the simulation will be in Python and build a team list to run the simulation over.", "First few rows to check \u2014 the Ravens & Chiefs have very positive coefficients for offense & negative ones for defense, while the Eagles are going to be close to average.", "Simulating the 100 game season between all teams:", "Results \u2014 Power Rank by Win Percentage (tie counts as 1/2 a win and loss).", "Simulated Power Ranking for 2019 Season:", "The rankings pass a sense check \u2014 are the strong teams at the top and the weak ones at the bottom. The bulk of the teams are in the center and the Rams and Cowboys were under-achievers based on the ranking while the Seahawks and Eagles over-achieved and made the playoffs.", "The function for 1 matchup to get the win probabilities:", "Function calls to simulate the playoffs:", "Running round 1 and passing the projected winners to round 2.", "NFL results from 2019 were used to build a model using PyStan to predict scores and more importantly as an example of how to use Stan to estimate a Bayesian model.", "The model could be used to generate weekly power rankings as data becomes available and the season progresses.", "If you have any questions, suggestions or need a predictive model please feel free to email me at:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Decision science and machine learning modeler interested in prediction, optimization, simulation and gambling (aka Operations Research) at miner3.com."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe68c84c3e95a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bill.fite?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bill.fite?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Bill Fite"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fde54f47551af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&user=Bill+Fite&userId=de54f47551af&source=post_page-de54f47551af----e68c84c3e95a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@aussiedave?utm_source=medium&utm_medium=referral", "anchor_text": "Dave Adamson"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://mc-stan.org/", "anchor_text": "https://mc-stan.org/"}, {"url": "https://www.pro-football-reference.com/years/2019/games.htm", "anchor_text": "https://www.pro-football-reference.com/years/2019/games.htm"}, {"url": "https://medium.com/tag/nfl?source=post_page-----e68c84c3e95a---------------nfl-----------------", "anchor_text": "NFL"}, {"url": "https://medium.com/tag/python?source=post_page-----e68c84c3e95a---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pystan?source=post_page-----e68c84c3e95a---------------pystan-----------------", "anchor_text": "Pystan"}, {"url": "https://medium.com/tag/super-bowl?source=post_page-----e68c84c3e95a---------------super_bowl-----------------", "anchor_text": "Super Bowl"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e68c84c3e95a---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&user=Bill+Fite&userId=de54f47551af&source=-----e68c84c3e95a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&user=Bill+Fite&userId=de54f47551af&source=-----e68c84c3e95a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe68c84c3e95a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e68c84c3e95a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e68c84c3e95a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bill.fite?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bill.fite?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bill Fite"}, {"url": "https://medium.com/@bill.fite/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "16 Followers"}, {"url": "http://miner3.com", "anchor_text": "miner3.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fde54f47551af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&user=Bill+Fite&userId=de54f47551af&source=post_page-de54f47551af--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fde54f47551af%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-python-stan-to-pick-the-superbowl-winner-with-an-unrealistic-model-e68c84c3e95a&user=Bill+Fite&userId=de54f47551af&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}