{"url": "https://towardsdatascience.com/bayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3", "time": 1683005875.902915, "path": "towardsdatascience.com/bayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3/", "webpage": {"metadata": {"title": "Bayesian LSTM on PyTorch \u2014 with BLiTZ, a PyTorch Bayesian Deep Learning library | by Piero Esposito | Towards Data Science", "h1": "Bayesian LSTM on PyTorch \u2014 with BLiTZ, a PyTorch Bayesian Deep Learning library", "description": "This is a post on how to use BLiTZ, a PyTorch Bayesian Deep Learning lib to create, train and perform variational inference on sequence data using its implementation of Bayesian LSTMs. You can check\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning/blob/master/blitz/examples/stocks-blstm.ipynb", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning", "anchor_text": "BLiTZ Bayesian Deep Learning on PyTorch here", "paragraph_index": 1}, {"url": "https://www.kaggle.com/szrlee/stock-time-series-20050101-to-20171231", "anchor_text": "this dataset from Kaggle", "paragraph_index": 2}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning#Bayesian-Deep-Learning-in-a-Nutshell", "anchor_text": "documentation section on Bayesian DL of our lib repo", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/blitz-a-bayesian-neural-network-library-for-pytorch-82f9998916c7", "anchor_text": "this post on a tutorial for BLiTZ usage", "paragraph_index": 3}], "all_paragraphs": ["This is a post on how to use BLiTZ, a PyTorch Bayesian Deep Learning lib to create, train and perform variational inference on sequence data using its implementation of Bayesian LSTMs.", "You can check the notebook with the example part of this post here and the repository for the BLiTZ Bayesian Deep Learning on PyTorch here.", "To accomplish that, we will explain how Bayesian Long-Short Term Memory works and then go through an example on stock confidence interval forecasting using this dataset from Kaggle.", "If you are new to the theme of Bayesian Deep Learning, you may want to seek one of the many posts on Medium about it or just the documentation section on Bayesian DL of our lib repo. You may also want to check this post on a tutorial for BLiTZ usage.", "As we know, the LSTM architecture was designed to address the problem of vanishing information that happens when standard Recurrent Neural Networks were used to process long sequence data.", "Mathematically, we translate the LSTM architecture as:", "We also know that the core idea on Bayesian Neural Networks is that, rather than having deterministic weights, we can sample them for a probability distribution and then optimize these distribution parameters.", "Using that, it is possible to measure confidence and uncertainty over predictions, which, along with the prediction itself, are very useful data for insights.", "Mathematically, we just have to add some extra steps to the equations above. They are the weights and biases sampling and happen before the feed-forward operation.", "And, of course, our trainable parameters are the \u03c1 and \u03bc of that parametrize each of the weights distributions. BLiTZ has a built-in BayesianLSTM layer that does all this hard work for you, so you just have to worry about your network architecture and training/testing loops.", "Besides our common imports, we will be importing BayesianLSTM from blitz.modules and variational_estimator a decorator from blitz.utils that us with variational training and complexity-cost gathering.", "We also import collections.deque to use on the time-series data preprocessing.", "We will now create and preprocess our dataset to feed it to the network. We will import Amazon stock pricing from the datasets we got from Kaggle, get its \u201cClose price\u201d column and normalize it.", "Our dataset will consist of timestamps of normalized stock prices and will have shape (batch_size, sequence_length, observation_length).", "Lets import and preprocess the data:", "We also must create a function to transform our stock price history in timestamps. To to that, we will use a deque with max length equal to the timestamp size we are using. We add each datapoint to the deque, and then append its copy to a main timestamp list:", "Our network class receives the variational_estimator decorator, which eases sampling the loss of Bayesian Neural Networks. It will have a Bayesian LSTM layer with in_features=1 and out_features=10 followed by a nn.Linear(10, 1), which outputs the normalized price for the stock.", "As you can see, this network works as a pretty normal one, and the only uncommon things here are the BayesianLSTM layer instanced and the variational_estimator decorator, but its behavior is a normal Torch one.", "With that done, we can create our Neural Network object, the split the dataset and go forward to the training loop:", "We now can create our loss object, neural network, the optimizer and the dataloader. See that we are not random splitting the dataset, as we will use the last batch of timestamps to evaluate the model. As our dataset is very small in terms of size, we will not make a dataloader for the train set.", "We will use a normal Mean Squared Error loss and an Adam optimizer with learning rate =0.001", "For our train loop, we will be using the sample_elbo method that the variational_estimator added to our Neural Network. It averages the loss over X samples, and helps us to Monte Carlo estimate our loss with ease.", "For this method to work, the output of the forward method of the network must be of the same shape as the labels that will be fed to the loss object/ criterion.", "We will first create a dataframe with the true data to be plotted:", "To predict a confidence interval, we must create a function to predict X times on the same data and then gather its mean and standard deviation. At the same time, we must set the size of the window we will try to predict before consulting true data.", "Let\u2019s see the code for the prediction function:", "And for the confidence interval gathering. See that we can decide between how many standard deviations far from the mean we will set our confidence interval:", "As we used a very small number of samples, we compensated it with a high standard deviation. Our network will try to predict 7 days and then will consult the data:", "We can check the confidence interval here by seeing if the real value is lower than the upper bound and higher than the lower bound. With the parameters set, you should have a confidence interval around 95% as we had:", "We now just plot the prediction graphs to visually see if our training went well. We will plot the real data and the test predictions with its confidence interval:", "And to end our evaluation, we will zoom in into the prediction zone:", "We saw that BLiTZ Bayesian LSTM implementation makes it very easy to implement and iterate over time-series with all the power of Bayesian Deep Learning. We also saw that the Bayesian LSTM is well integrated to Torch and easy to use and introduce in any work or research.", "We also could predict a confidence interval for the IBM stock price with a very high accuracy, which may be a far more useful insight than just a point-estimation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Google Developer Expert in Machine Learning and Machine Learning Engineer @ Sticker Mule; I\u2019m your friendly neghborhood nerdy guy."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5e1fec432ad3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@piero.skywalker?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@piero.skywalker?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Piero Esposito"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2c56b7cd9b15&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&user=Piero+Esposito&userId=2c56b7cd9b15&source=post_page-2c56b7cd9b15----5e1fec432ad3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/The_LSTM_cell.png/800px-The_LSTM_cell.png", "anchor_text": "Source"}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning/blob/master/blitz/examples/stocks-blstm.ipynb", "anchor_text": "here"}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning", "anchor_text": "BLiTZ Bayesian Deep Learning on PyTorch here"}, {"url": "https://www.kaggle.com/szrlee/stock-time-series-20050101-to-20171231", "anchor_text": "this dataset from Kaggle"}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning#Bayesian-Deep-Learning-in-a-Nutshell", "anchor_text": "documentation section on Bayesian DL of our lib repo"}, {"url": "https://towardsdatascience.com/blitz-a-bayesian-neural-network-library-for-pytorch-82f9998916c7", "anchor_text": "this post on a tutorial for BLiTZ usage"}, {"url": "https://en.wikipedia.org/wiki/Long_short-term_memory", "anchor_text": "https://en.wikipedia.org/wiki/Long_short-term_memory"}, {"url": "https://github.com/piEsposito/blitz-bayesian-deep-learning", "anchor_text": "piEsposito/blitz-bayesian-deep-learningBLiTZ is a simple and extensible library to create Bayesian Neural Network Layers (based on whats proposed in Weight\u2026github.com"}, {"url": "https://colah.github.io/posts/2015-08-Understanding-LSTMs/", "anchor_text": "Understanding LSTM NetworksPosted on August 27, 2015 Humans don't start their thinking from scratch every second. As you read this essay, you\u2026colah.github.io"}, {"url": "https://towardsdatascience.com/blitz-a-bayesian-neural-network-library-for-pytorch-82f9998916c7", "anchor_text": "BLiTZ \u2014 A Bayesian Neural Network library for PyTorchBlitz \u2014 Bayesian Layers in Torch Zoo is a simple and extensible library to create Bayesian Neural Network layers on the\u2026towardsdatascience.com"}, {"url": "https://arxiv.org/abs/1505.05424", "anchor_text": "Weight Uncertainty in Neural NetworksWe introduce a new, efficient, principled and backpropagation-compatible algorithm for learning a probability\u2026arxiv.org"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----5e1fec432ad3---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----5e1fec432ad3---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5e1fec432ad3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----5e1fec432ad3---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bayesian-statistics?source=post_page-----5e1fec432ad3---------------bayesian_statistics-----------------", "anchor_text": "Bayesian Statistics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&user=Piero+Esposito&userId=2c56b7cd9b15&source=-----5e1fec432ad3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&user=Piero+Esposito&userId=2c56b7cd9b15&source=-----5e1fec432ad3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5e1fec432ad3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5e1fec432ad3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5e1fec432ad3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@piero.skywalker?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@piero.skywalker?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Piero Esposito"}, {"url": "https://medium.com/@piero.skywalker/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "211 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2c56b7cd9b15&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&user=Piero+Esposito&userId=2c56b7cd9b15&source=post_page-2c56b7cd9b15--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2195fe448065&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-lstm-on-pytorch-with-blitz-a-pytorch-bayesian-deep-learning-library-5e1fec432ad3&newsletterV3=2c56b7cd9b15&newsletterV3Id=2195fe448065&user=Piero+Esposito&userId=2c56b7cd9b15&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}