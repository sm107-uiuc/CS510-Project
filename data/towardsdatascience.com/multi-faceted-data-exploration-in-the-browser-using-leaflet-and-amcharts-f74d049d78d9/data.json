{"url": "https://towardsdatascience.com/multi-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9", "time": 1683006745.407638, "path": "towardsdatascience.com/multi-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9/", "webpage": {"metadata": {"title": "Multi faceted data exploration in the browser using Leaflet and amCharts | by Sergio Marchesini | Towards Data Science", "h1": "Multi faceted data exploration in the browser using Leaflet and amCharts", "description": "Demo: https://smarques.github.io/mufa-leaf/ (The data in the demo is randomised, and the real study has not been published yet.) In these challenging CoVid times I was asked to work on a data\u2026"}, "outgoing_paragraph_urls": [{"url": "https://smarques.github.io/mufa-leaf/", "anchor_text": "https://smarques.github.io/mufa-leaf/", "paragraph_index": 0}, {"url": "https://github.com/smarques/mufa-leaf", "anchor_text": "https://github.com/smarques/mufa-leaf", "paragraph_index": 6}, {"url": "https://github.com/nuket/google-sheets-geocoding-macro", "anchor_text": "this nice google sheet macro", "paragraph_index": 7}, {"url": "https://www.papaparse.com/", "anchor_text": "Papa Parse", "paragraph_index": 9}, {"url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZ3vkQTK-CrT7Rv6Rdu3uDKmumQB94Ic7WrmBu4ezak-72QWbkUISb7FfvR_Z1AhmYgfASVad205BE/pub?output=csv", "anchor_text": "https://docs.google.com/spreadsheets/d/e/<hash>/pub?output=csv", "paragraph_index": 11}, {"url": "https://leafletjs.com/", "anchor_text": "Leaflet", "paragraph_index": 16}, {"url": "https://github.com/Leaflet/Leaflet.fullscreen", "anchor_text": "Leaflet Full Screen Control", "paragraph_index": 17}, {"url": "https://github.com/rowanwins/leaflet-easyPrint", "anchor_text": "Leaflet Easy Print", "paragraph_index": 17}, {"url": "https://github.com/leaflet-extras/leaflet-providers", "anchor_text": "Leaflet Providers", "paragraph_index": 17}, {"url": "https://stamen.com/opensource/", "anchor_text": "Stamen Watercolor Tiles", "paragraph_index": 17}, {"url": "https://github.com/lvoogdt/Leaflet.awesome-markers", "anchor_text": "Leaflet Awesome Markers", "paragraph_index": 17}, {"url": "https://github.com/Leaflet/Leaflet.markercluster", "anchor_text": "Leaflet.MarkerCluster", "paragraph_index": 24}, {"url": "https://geojson.org/", "anchor_text": "GeoJSON", "paragraph_index": 28}, {"url": "https://github.com/stefanocudini", "anchor_text": "Stefano Cudini", "paragraph_index": 28}, {"url": "https://baconjs.github.io/", "anchor_text": "bacon.js", "paragraph_index": 31}, {"url": "https://github.com/agershun/alasql", "anchor_text": "alasql", "paragraph_index": 32}, {"url": "http://ionden.com/a/plugins/ion.rangeSlider/index.html", "anchor_text": "Ion.RangeSlider", "paragraph_index": 36}, {"url": "https://www.amcharts.com/", "anchor_text": "amCharts", "paragraph_index": 37}, {"url": "https://github.com/smarques/mufa-leaf", "anchor_text": "fork it or drop me a pull request on GitHub", "paragraph_index": 40}, {"url": "https://sergiomarchesini.it/", "anchor_text": "https://sergiomarchesini.it/", "paragraph_index": 42}], "all_paragraphs": ["Demo: https://smarques.github.io/mufa-leaf/(The data in the demo is randomised, and the real study has not been published yet.)", "In these challenging CoVid times I was asked to work on a data visualisation concerning the area in Italy where I live.", "The data consisted of about 20k records, geo-referenced and labeled by sub-sector, type of subject, data source, and the year the activity started.", "My goal was to make this data explorable in different ways:- as marks and clusters on a geographical map- as a navigable TreeMap- through filters and a timeline selector", "Ideally this visualisations should be applied to the whole set or to a selected subset of data, so that you can apply filters and see i.e. how the distribution was in a specific year, and maybe for only a specific sub-sector of a given province.", "The idea is to load the data in the browser as a JSON structure and keep it in memory, loading subsets depending on the user interaction with the filters and feeding the subset data to each visualisation.", "I will go through some of the process here, please refer to the GitHub repo for details of the implementation: https://github.com/smarques/mufa-leaf", "Since the data was still under revision and re-categorisation, I wanted to load it from a shared google sheet.I also used google sheets to geocode the addresses using this nice google sheet macro.", "Because people were still working on the google sheet I decided to do data checks and data cleaning directly when importing the data in my JS app.", "To load data from a Google Sheet the best option I found is Papa Parse. It lets you parse CSV to JSON and back, load it from anywhere, handle big files, the whole deal, plus it has a funny name.", "First of all you need to perform two actions on your Google Sheet:", "The url you need to feed to Papa Parse (jeez the name is really funny to me) is https://docs.google.com/spreadsheets/d/e/<hash>/pub?output=csv", "You could also export your data as JSON directly from google sheets but our friend Papa gives us a lot more options for type casting, data cleaning, etc.", "When you are done we this you can just import your data with:", "The processData function is in charge of cleaning up and refining the data we received from Google Sheets. Sometime you need to apply some regex, remove weird chars, fix inputing errors.", "The goal for now is to get those guys on a map, possibly on three different layers and with different marker colours by layer. We also would like markers to have a different icon for each subject type. Since we have almost 30k markers it might be a good idea to setup some clustering.", "My choice of map library is Leaflet. It has great code and documentation, it\u2019s very flexible and it has a nice plugin ecosystem.", "I added a few plugins, like:Leaflet Full Screen Control because I just love having maps go full screenLeaflet Easy Print: there is a few printing plugins, but this seemed to work best for meLeaflet Providers: to easily mix and match tiles from different sources, I must mention the Stamen Watercolor Tiles because they are really a joy for the eyes.Leaflet Awesome Markers lets you use Font Awesome icons on your map markers", "Now the way you would normally go if you just have to display and eventually filter markers on a leaflet map is to add the markers to their corresponding layers, then call functions on the map to hide or show whole layers or specific markers. My idea is a little different, I want to keep all the data at the application level so I can use it not only for the map but for other graphs and widgets as well. When we apply a filter I want the data to be filtered at application level and the map to be subsequently redrawn, along with any other data-dependent widget in the application.", "The question at this point is: will the map and graphs redraw fast enough to make for a nice user experience and data exploration?Let\u2019s find out. (Spoiler: yayyy they do)", "So we have a variable in the application called currentData that holds the currently displayed subset of the full recordset. Every time the user changes the selection filters we create a new data selection starting from App.data, save it into App.currentData and trigger a redraw on every widget.", "Even if we are just initialising the application after cleaning the data we can call the update function to fill the application currentData, since the user has not had a chance to filter the recordset, the function will just select every record and we are ready to go.", "Let\u2019s see what to do with the map widget for now.", "Without clustering the map would be a little crowded: not very useful and also very heavy on your browser.", "So let\u2019s add a level of clustering using Leaflet.MarkerCluster.", "I structured the markers according the sub-sector they belong to, there is only 4 possible values here, so having each sub-sector on a different layer would make it very easy to switch each group on and off. Also that will make it possible to have separate clusters for each sub-sector, making the display more interesting and giving better clues to the data distribution.", "MarkerCluster allows you to customise the function that displays the cluster markers (hence the name..) so I have slightly different markers depending on the size of the cluster. (See for example the 9 vs the 325 red clusters).", "For each of the four sector we instantiate a marker cluster group, giving an iconCreateFunction as discussed. I also added a mouseover function ti the cluster icons so you can float up a layer (changing its z-index) by hovering the mouse on it.", "I also wanted to highlight the area the study refers to. Leaflet lets you load GeoJSON so all I had to do was search GitHub for a GeoJson with the region\u2019s shape and load it on its own layer. ( Thanks to Stefano Cudini )", "I want all filters to be integrated in the map so I am adding a side panel on the right side of the map that lets you open different panels with filter controls.", "I created filters for whole sub-sectors or just individual subjects within a sector. Then filters for each province", "I won\u2019t go into the implementation details for all the filter gui, you can look it up on the GitHub repo, basically to avoid a call-back hell every gui element is connected to an event stream using bacon.js, a reactive functional library. This way any change in any filter will result in the same update function being called, passing in the full set of filter values so that we can apply al the needed conditions to the full data set and load a new currentData subset for each widget to display.", "Since I want to keep the data filtering at the main application level, every time I get a change in the filters I call an update function to extract the relevant data from the full set.I use a js library called alasql to process the 15k records array according to the filters that the user selected. Among other things, alasql lets you run SQL queries on any array of objects. That makes it so much easier to process your data and makes your code readable and easy to debug and maintain.", "As this point all I have to do in the update function is building an array of conditions to add to my SELECT statement.", "It turns out MarkerCluster is very fast at updating if you just remove all layer markers and just re-add them, so when I have a new currentData object I just run through it and reassign it.", "Next we want to be able to select records based on a year interval.", "Leaflet controls are just html elements so I used Ion.RangeSlider and added its value to the reactive stream that triggers a new query and subsequent redraw. When I first receive the data from Google Sheet I just get the min and max values for the year column so I can use it to display a reasonable range for the time selector.", "As a last element we add a TreeMap graph so we can visualise the structure of the selected subset. I included the amCharts library and setup a call in my update function to redraw the chart. I chose to start the break down by province.", "You can then drill down in the visualisation clicking on the TreeMap blocks.", "So now we have a main application level that is concerned with loading the full data, making sub-selections based on different filters and user behaviour and then triggering updates on different graphs and widgets.It\u2019s a good framework for letting the user explore the data in the browser, and it would be easy to add more visualisations. The whole point is that they all refer to the same data subset.It\u2019s very useful for example to see how locations and data structure change when you change the year parameter. You could add a play button and create an animation that shows changes year by year.One more improvement would be to sync the data on local storage via IndexedDb (alasql supports it) so that you have a full offline experience.", "If you feel like you want to add elements or experiment with it please feel free to fork it or drop me a pull request on GitHub!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I write software and compose music (or is it the other way around?). https://sergiomarchesini.it/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff74d049d78d9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@sergiomarchesini?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiomarchesini?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Sergio Marchesini"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa91a9d1517&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&user=Sergio+Marchesini&userId=fa91a9d1517&source=post_page-fa91a9d1517----f74d049d78d9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://smarques.github.io/mufa-leaf/", "anchor_text": "https://smarques.github.io/mufa-leaf/"}, {"url": "https://github.com/smarques/mufa-leaf", "anchor_text": "https://github.com/smarques/mufa-leaf"}, {"url": "https://github.com/nuket/google-sheets-geocoding-macro", "anchor_text": "this nice google sheet macro"}, {"url": "https://www.papaparse.com/", "anchor_text": "Papa Parse"}, {"url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZ3vkQTK-CrT7Rv6Rdu3uDKmumQB94Ic7WrmBu4ezak-72QWbkUISb7FfvR_Z1AhmYgfASVad205BE/pubhtml", "anchor_text": "https://docs.google.com/spreadsheets/d/e/<hash>/pubhtml"}, {"url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZ3vkQTK-CrT7Rv6Rdu3uDKmumQB94Ic7WrmBu4ezak-72QWbkUISb7FfvR_Z1AhmYgfASVad205BE/pub?output=csv", "anchor_text": "https://docs.google.com/spreadsheets/d/e/<hash>/pub?output=csv"}, {"url": "https://gist.github.com/smarques/3dbfaaae4b3d8a204d2ac280f488528e", "anchor_text": "https://gist.github.com/smarques/3dbfaaae4b3d8a204d2ac280f488528e"}, {"url": "https://leafletjs.com/", "anchor_text": "Leaflet"}, {"url": "https://github.com/Leaflet/Leaflet.fullscreen", "anchor_text": "Leaflet Full Screen Control"}, {"url": "https://github.com/rowanwins/leaflet-easyPrint", "anchor_text": "Leaflet Easy Print"}, {"url": "https://github.com/leaflet-extras/leaflet-providers", "anchor_text": "Leaflet Providers"}, {"url": "https://stamen.com/opensource/", "anchor_text": "Stamen Watercolor Tiles"}, {"url": "https://github.com/lvoogdt/Leaflet.awesome-markers", "anchor_text": "Leaflet Awesome Markers"}, {"url": "https://github.com/Leaflet/Leaflet.markercluster", "anchor_text": "Leaflet.MarkerCluster"}, {"url": "https://geojson.org/", "anchor_text": "GeoJSON"}, {"url": "https://github.com/stefanocudini", "anchor_text": "Stefano Cudini"}, {"url": "https://baconjs.github.io/", "anchor_text": "bacon.js"}, {"url": "https://github.com/agershun/alasql", "anchor_text": "alasql"}, {"url": "http://ionden.com/a/plugins/ion.rangeSlider/index.html", "anchor_text": "Ion.RangeSlider"}, {"url": "https://www.amcharts.com/", "anchor_text": "amCharts"}, {"url": "https://github.com/smarques/mufa-leaf", "anchor_text": "fork it or drop me a pull request on GitHub"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----f74d049d78d9---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/maps?source=post_page-----f74d049d78d9---------------maps-----------------", "anchor_text": "Maps"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&user=Sergio+Marchesini&userId=fa91a9d1517&source=-----f74d049d78d9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&user=Sergio+Marchesini&userId=fa91a9d1517&source=-----f74d049d78d9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff74d049d78d9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f74d049d78d9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f74d049d78d9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f74d049d78d9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f74d049d78d9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiomarchesini?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sergiomarchesini?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sergio Marchesini"}, {"url": "https://medium.com/@sergiomarchesini/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "59 Followers"}, {"url": "https://sergiomarchesini.it/", "anchor_text": "https://sergiomarchesini.it/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa91a9d1517&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&user=Sergio+Marchesini&userId=fa91a9d1517&source=post_page-fa91a9d1517--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Ffa91a9d1517%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-faceted-data-exploration-in-the-browser-using-leaflet-and-amcharts-f74d049d78d9&user=Sergio+Marchesini&userId=fa91a9d1517&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}