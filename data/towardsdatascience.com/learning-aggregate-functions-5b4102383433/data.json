{"url": "https://towardsdatascience.com/learning-aggregate-functions-5b4102383433", "time": 1682994840.05248, "path": "towardsdatascience.com/learning-aggregate-functions-5b4102383433/", "webpage": {"metadata": {"title": "Learning aggregate functions. Machine Learning with relational data | by Michael Larionov, PhD | Towards Data Science", "h1": "Learning aggregate functions", "description": "This article is inspired by the Kaggle competition https://www.kaggle.com/c/elo-merchant-category-recommendation . While I did not participate in the competition, I used the data to explore another\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/elo-merchant-category-recommendation", "anchor_text": "https://www.kaggle.com/c/elo-merchant-category-recommendation", "paragraph_index": 0}, {"url": "https://www.oreilly.com/library/view/sql-in-a/9780596155322/ch04s02.html", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html", "anchor_text": "agg", "paragraph_index": 3}, {"url": "https://pdfs.semanticscholar.org/7919/a8a4cb2e628b7f8e316265d36f84c7714c17.pdf", "anchor_text": "Cascade-Correlation Approach", "paragraph_index": 5}, {"url": "https://www.tensorflow.org/api_docs/python/tf/math/segment_sum", "anchor_text": "segment_sum", "paragraph_index": 11}, {"url": "https://github.com/mlarionov/machine_learning_POC/blob/master/aggregate_functions/basic_aggregate_function_learning.ipynb", "anchor_text": "my github repo", "paragraph_index": 19}], "all_paragraphs": ["This article is inspired by the Kaggle competition https://www.kaggle.com/c/elo-merchant-category-recommendation . While I did not participate in the competition, I used the data to explore another problem that often arises working with realistic data. All machine learning algorithms work great with the tabular data, but in reality a lot of data are relational. In this data set we are trying to draw conclusions about the users (identified by card id) based on the transaction history.", "The transaction table lists transactions, and so contains multiple rows for each user. Let\u2019s look at the histogram in the logarithmic scale.", "As we see from this plot, the majority of users have more than one transaction. In case we want to classify the users, we will have a problem of having multiple records for every user, whereas the machine learning algorithms expect tabular data.", "This is similar to the SQL GROUP BY statement, that helps us group data based on the key (card id in our case). SQL also defines many aggregate function, the complete list of which is defined by the and can be found, for example, here. In Pandas aggregate functions are supported by the agg function.", "Many machine learning practitioners define additional features for all possible aggregate functions, like count, sum, mean, etc. The issue is that we often don't know in advance which aggregate functions matter. For example, we can add total amount as a feature, but what if the label is influenced by a total amount for a specific category? We will end up adding many additional features, the majority of which will be useless, and are likely to miss what really matters.", "What if instead of hand-crafting aggregate features we can have the algorithm to learn them. While this approach was studied in the past (see, for example, Cascade-Correlation Approach), when there is no correlation between transactions, we can use a simple neural network that will learn the aggregate functions using some standard TensorFlow functions.", "The neural network\u2019s architecture in our case is very simple. We have one fully connected layer, which is followed by the segment_sum function that actually does group by operation and sums the outputs of the first layer. The second fully connected layer is connected to the output, which in our case is an aggregate function we are trying to learn. For simplicity, in this POC we used linear units, but for more complex situations we have to introduce nonlinearity.", "The number of units in the first layer gives us the number of aggregate functions it can simultaneously learn.", "Let\u2019s consider two examples: learning count and sum.", "If we set all the weights in the first layer to zero, and set all biases to 1, then (assuming linear unit), the aggregate sum of the outputs will give us the count of transaction for every user.", "If, however, we set the bias and all the weights to zero, but set the weight of purchase_amount to 1, we will get total purchase amount for every user. Let's demonstrate our ideas in TensorFlow.", "The function segment_sum works as follows:", "It accepts a separate tensor with the segment ids, and the data have to be labeled with the same segment ids. It groups the data by segment IDs and sum-reduces over the zero\u2019s dimension.", "Here we plotted the cost function after each iteration. We see that the algorithm learn count function pretty quickly. By tuning hyperparameters of the Adam optimizer we can try to get even more accuracy.", "We see that cost also goes down, but there are spikes in cost that can be explained by high gradients as we feed new data to the algorithm. Perhaps we can tune the hyperparameters to improve the learning procedure convergence.", "We have demonstrated a simple neural network that can learn basic aggregate functions. While our demonstration used linear units, in reality we have to use non-linear units for the layer 1 to enable to learn more complex aggregate functions. For example, if we want to learn the total amount for category2 = 5, then the linear units will not work. But if we use, for example, sigmoid function, then we can set the bias to -100, then set the weight for category2 = 5 to +100, and set the weight for purchase_amount to a small positive value \u03c9\u03c9 . In the second layer we can set the bias to zero and the weight to 1\u03c91\u03c9 .", "This architecture does not learn function mean. But it learn both of its components: sum and count. If our decision boundary depends on the average sales, this is the same as if it depended on number of transaction and total amount.", "This architecture also will not learn more complex functions like variance and standard deviation. This can be important in the financial sector, where you may want to make decision based on the market volatility. Additional layer before aggregation may be required to get that feasible.", "Finally, in the example the learning was slow because we had to present the data in the aggregate form. It is possible to improve speed by pre-aggregating the data and then resampling them.", "All code used in this article can be found in my github repo.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5b4102383433&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@michaellarionov", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://michaellarionov.medium.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Michael Larionov, PhD"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9158ca11a43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=post_page-f9158ca11a43----5b4102383433---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com", "anchor_text": "https://pixabay.com"}, {"url": "https://www.kaggle.com/c/elo-merchant-category-recommendation", "anchor_text": "https://www.kaggle.com/c/elo-merchant-category-recommendation"}, {"url": "https://www.oreilly.com/library/view/sql-in-a/9780596155322/ch04s02.html", "anchor_text": "here"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html", "anchor_text": "agg"}, {"url": "https://pdfs.semanticscholar.org/7919/a8a4cb2e628b7f8e316265d36f84c7714c17.pdf", "anchor_text": "Cascade-Correlation Approach"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/math/segment_sum", "anchor_text": "segment_sum"}, {"url": "https://github.com/mlarionov/machine_learning_POC/blob/master/aggregate_functions/basic_aggregate_function_learning.ipynb", "anchor_text": "my github repo"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5b4102383433---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/relational-databases?source=post_page-----5b4102383433---------------relational_databases-----------------", "anchor_text": "Relational Databases"}, {"url": "https://medium.com/tag/data-science?source=post_page-----5b4102383433---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----5b4102383433---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----5b4102383433---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=-----5b4102383433---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=-----5b4102383433---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5b4102383433&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5b4102383433---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5b4102383433--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5b4102383433--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5b4102383433--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5b4102383433--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5b4102383433--------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Michael Larionov, PhD"}, {"url": "https://michaellarionov.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "611 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9158ca11a43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=post_page-f9158ca11a43--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fcf000f0c5fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-aggregate-functions-5b4102383433&newsletterV3=f9158ca11a43&newsletterV3Id=cf000f0c5fdd&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}