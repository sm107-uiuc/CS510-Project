{"url": "https://towardsdatascience.com/detecting-face-features-and-applying-filters-with-javascript-34a2081daebb", "time": 1683010873.237507, "path": "towardsdatascience.com/detecting-face-features-and-applying-filters-with-javascript-34a2081daebb/", "webpage": {"metadata": {"title": "Detecting Face Features and Applying Filters with JavaScript | by Juan Cruz Martinez | Towards Data Science", "h1": "Detecting Face Features and Applying Filters with JavaScript", "description": "Some days ago I posted an article on \u201cDetecting Facial Features with Python\u201d and I got many questions from people on twitter on how to do that with JavaScript. Today we are going to be answering that\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/detecting-face-features-with-python-30385aee4a8e", "anchor_text": "Detecting Facial Features with Python", "paragraph_index": 0}, {"url": "https://twitter.com/livecodestream", "anchor_text": "twitter", "paragraph_index": 0}, {"url": "https://github.com/auduno/clmtrackr", "anchor_text": "clmtrackr", "paragraph_index": 2}, {"url": "https://p5js.org/", "anchor_text": "p5.js", "paragraph_index": 9}, {"url": "https://codepen.io/livecodestream/pen/rNxrMzp", "anchor_text": "codepen", "paragraph_index": 21}, {"url": "https://twitter.com/livecodestream", "anchor_text": "twitter", "paragraph_index": 23}, {"url": "https://livecodestream.dev", "anchor_text": "https://livecodestream.dev", "paragraph_index": 25}], "all_paragraphs": ["Some days ago I posted an article on \u201cDetecting Facial Features with Python\u201d and I got many questions from people on twitter on how to do that with JavaScript. Today we are going to be answering that and we will add some extras like masking your face with a spiderman filter, or the classic, dog filter. It has been super fun to work on this project and I hope you enjoy it.", "The article will cover two main topics:", "Similarly to how DLib works, for JavaScript, we have a library called clmtrackr which will do the heavy work of detecting where the face is on an image, and will also identify face features such as nose, mouth, eyes, etc.", "This library provides some generic models which are already pre-trained and ready to use following the numbering of the features as follows:", "When we process an image with the library, it will return an array for each of the points on that map, where each point is identified by its position on x and y axis. This will turn out very important when we are building the filters. As you can already probably guess, if we want to draw something replacing the nose of the person, we can use the point 62 which is the center of the nose.", "But enough theory, let\u2019s start working on something cool!", "In this article, we will make use of clmtrackr to identify faces on a video stream (in our case a webcam or camera) and apply custom filters that can be selected by a dropdown on the screen. Here is the demo of the app on codepen (please make sure you allow in your browser for the app to access the camera, otherwise it won\u2019t work):", "Awesome! It may not be perfect but looks amazing!", "Let\u2019s break the code down and explain what we are doing.", "To build the app we are using p5.js library, which is a JavaScript library designed for working mainly with canvas, and that fits perfectly for our use case. P5JS is not your traditional UI library, it instead works with events which define when to build the UI, and when to update it. Similarly to some game engines.", "There are 3 main events from p5 which I want to cover:", "As by definition, we will use the preload event to load the images that we will be using later in the code as follows:", "Very simple. The function loadImage from p5, as you may expect, will load the image and make it available as a P5 Image object.", "Here things get a bit more interesting as it is in here where we load the UI. We will break down the code executed in this event into 4 parts", "As we want our code to be responsive, our canvas will have a dynamic size which will be calculated from the window size and using an aspect ratio of 4:3. It\u2019s not ideal to have the aspect ratio in code like that, but we will make some assumptions to keep the code concise for the demo. After we know the dimensions for our canvas, we can create one with the P5 function createCanvas as shown next.", "After we have our canvas working we need to capture the video stream from the webcam or camera and place it into the canvas, fortunately P5 makes it very easy to do so with the videoCapture function.", "Our app is awesome and can provide options for more than one filter, so we need to build a way to select which filter we want to activate. Again\u2026 we could get really fancy here, however, for simplicity, we will use a simple dropdown, that we can create using P5 createSelect() function.", "The image tracker is an object that can be attached to a video feed and will identify for each frame all the faces and their features. The tracker needs to be set up once for a given video source.", "Now that everything is set up, we need to update our draw event from P5, to output the video source to the canvas, and apply any filter which is selected. In our case the draw function will be very simple, pushing the complexity into each filter definition.", "Building filters can be an easy or very complex task. It will depend on what the filter is supposed to do. For the Spiderman mask, we simply need to ask the Spiderman mask image to the center of the screen. To do that, we first make sure our faceTracker object actually detected a face by using faceTraker.getCurrentPosition().", "Once we have our face detected we use P5 to render the image using the face point 62, which is the center of the nose as the center of the image, and with width and height which represent the size of the face as follows.", "Now the dog filter works the same way but using 3 images instead of one, one for each ear and one for the nose. I won\u2019t bore you with more of the same code, but if you want to check it out, review the codepen, which contains the full code for the demo.", "With the help of JavaScript libraries is very easy to identify facial features and start building your own filters. There are a few considerations though that we did not cover in this tutorial. For example, what happens if the face is not straight to the camera? How do we distort our filters so that they follow the curvature of the face? Or what if I want to add 3d objects instead of 2d filters?", "I know many of you will play with it and build some cool things, I\u2019d love to hear what you built and if you can also share your examples with me. You can always reach me by on twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I help people learn tech skills so they can level up their life. Founder of https://livecodestream.dev, content creator, and Oktanaut!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F34a2081daebb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bajcmartinez.medium.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": ""}, {"url": "https://bajcmartinez.medium.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Juan Cruz Martinez"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46b6f430560f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&user=Juan+Cruz+Martinez&userId=46b6f430560f&source=post_page-46b6f430560f----34a2081daebb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@theorql?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Th\u00e9o rql"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/detecting-face-features-with-python-30385aee4a8e", "anchor_text": "Detecting Facial Features with Python"}, {"url": "https://twitter.com/livecodestream", "anchor_text": "twitter"}, {"url": "https://github.com/auduno/clmtrackr", "anchor_text": "clmtrackr"}, {"url": "https://p5js.org/", "anchor_text": "p5.js"}, {"url": "https://codepen.io/livecodestream/pen/rNxrMzp", "anchor_text": "codepen"}, {"url": "https://twitter.com/livecodestream", "anchor_text": "twitter"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----34a2081daebb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/javascript?source=post_page-----34a2081daebb---------------javascript-----------------", "anchor_text": "JavaScript"}, {"url": "https://medium.com/tag/data-science?source=post_page-----34a2081daebb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----34a2081daebb---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/web-development?source=post_page-----34a2081daebb---------------web_development-----------------", "anchor_text": "Web Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&user=Juan+Cruz+Martinez&userId=46b6f430560f&source=-----34a2081daebb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&user=Juan+Cruz+Martinez&userId=46b6f430560f&source=-----34a2081daebb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F34a2081daebb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----34a2081daebb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----34a2081daebb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----34a2081daebb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----34a2081daebb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----34a2081daebb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----34a2081daebb--------------------------------", "anchor_text": ""}, {"url": "https://bajcmartinez.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bajcmartinez.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Juan Cruz Martinez"}, {"url": "https://bajcmartinez.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.7K Followers"}, {"url": "https://livecodestream.dev", "anchor_text": "https://livecodestream.dev"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F46b6f430560f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&user=Juan+Cruz+Martinez&userId=46b6f430560f&source=post_page-46b6f430560f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F22c096860c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-face-features-and-applying-filters-with-javascript-34a2081daebb&newsletterV3=46b6f430560f&newsletterV3Id=22c096860c66&user=Juan+Cruz+Martinez&userId=46b6f430560f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}