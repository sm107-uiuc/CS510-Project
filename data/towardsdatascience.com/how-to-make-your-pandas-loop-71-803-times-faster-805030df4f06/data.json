{"url": "https://towardsdatascience.com/how-to-make-your-pandas-loop-71-803-times-faster-805030df4f06", "time": 1682999820.913713, "path": "towardsdatascience.com/how-to-make-your-pandas-loop-71-803-times-faster-805030df4f06/", "webpage": {"metadata": {"title": "How To Make Your Pandas Loop 71803 Times Faster | by Benedikt Droste | Towards Data Science", "h1": "How To Make Your Pandas Loop 71803 Times Faster", "description": "If you use Python and Pandas for data analysis, it will not be long before you want to use a loop the first time. However, even for small DataFames it is time-consuming to use the standard loop and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@droste.benedikt/membership", "anchor_text": "If you enjoy Medium and Towards Data Science and didn\u2019t sign up yet, feel free to use my referral link to join the community.", "paragraph_index": 15}, {"url": "https://www.linkedin.com/in/benedikt-droste-893b1b189/", "anchor_text": "https://www.linkedin.com/in/benedikt-droste-893b1b189/", "paragraph_index": 17}], "all_paragraphs": ["If you use Python and Pandas for data analysis, it will not be long before you want to use a loop the first time. However, even for small DataFames it is time-consuming to use the standard loop and you will quickly realize that it can take a long time for larger DataFrames. When I first waited more than half an hour to execute the code, I looked for alternatives that I would like to share with you.", "DataFrames are Pandas-objects with rows and columns. If you use a loop, you will iterate over the whole object. Python can\u00b4t take advantage of any built-in functions and it is very slow. In our example we got a Dataframe with 65 columns and 1140 rows. It contains soccer results for the seasons 2016 - 2019. We want to create a new column that indicates whether a particular team has played a draw. We might start like this:", "Since we got every match from the Premier League in our DataFrame, we have to check if the team of interest (Arsenal) played and if that applies, whether they were the home or away team. As you can see, this loop was very slow and took 20,7 seconds to execute. Let\u00b4s look how we can be more efficient.", "In the first example we looped over the entire DataFrame. iterrows() returns a Series for each row, so it iterates over a DataFrame as a pair of an index and the interested columns as Series. This makes it faster than the standard loop:", "The code took 68 milliseconds to run which is 321 times faster than the standard loop. However, many people advise against using it because there are still faster options and iterrows() does not preserve dtypes across the rows. That means if you use iterrows() on your DataFrame dtypes can be changed which can cause a lot of problems. Do preserve dtypes you can also use itertuples(). We will not go into detail here because we want to pay attention to efficiency. Here you can find the official documentation:", "apply is not faster in itself but it has advantages when used in combination with DataFrames. This depends on the content of the apply expression. If it can be executed in Cython space, apply is much faster (which is the case here).", "We can use apply with a Lambda function. All we have to do it to specify the axis. In this case we have to use axis=1 because we want to perform a column-wise operation:", "This code is even faster than the previous methods and took 27 milliseconds to be finished.", "Now we can come to a new topic. We use the advantages of vectorization to create really fast codes. The point is to avoid Python-level loops like in the examples before [1] and to use optimized C code which uses the memory much more efficient. We just need to modify the function slightly:", "Now we can create with Pandas series as input thew new column:", "In this case we don\u00b4t even need a loop. All we have to do is to adjust the content of the function. Now we can directly pass Pandas series to our function which causes the enormous speed gain.", "In the previous example we passed Pandas series to our function. By adding .values we receive a Numpy array:", "Numpy arrays are so fast because we got the benefits of locality of reference [2]. Our code took 0,305 milliseconds to run and was 71803 times faster than the standard loop used in the beginning.", "If you use Python, Pandas and Numpy for data analysis, there will always be some room for improving your code. We compared five different methods do add a new column to our DataFrame based on some calculation. We have noticed enormous differences in terms of speed:", "I would be glad if you take two rules from this article:", "If you enjoy Medium and Towards Data Science and didn\u2019t sign up yet, feel free to use my referral link to join the community.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Analyst in a management consultancy | Interested in data science, web scraping & storytelling | https://www.linkedin.com/in/benedikt-droste-893b1b189/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F805030df4f06&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----805030df4f06--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@droste.benedikt?source=post_page-----805030df4f06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@droste.benedikt?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Benedikt Droste"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F93813b47e030&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&user=Benedikt+Droste&userId=93813b47e030&source=post_page-93813b47e030----805030df4f06---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html", "anchor_text": "pandas.DataFrame.itertuples - pandas 0.25.1 documentationThe column names will be renamed to positional names if they are invalid Python identifiers, repeated, or start with an\u2026pandas.pydata.org"}, {"url": "https://stackoverflow.com/questions/52673285/performance-of-pandas-apply-vs-np-vectorize-to-create-new-column-from-existing-c", "anchor_text": "https://stackoverflow.com/questions/52673285/performance-of-pandas-apply-vs-np-vectorize-to-create-new-column-from-existing-c"}, {"url": "https://en.wikipedia.org/wiki/Locality_of_reference", "anchor_text": "https://en.wikipedia.org/wiki/Locality_of_reference"}, {"url": "https://medium.com/@droste.benedikt/membership", "anchor_text": "If you enjoy Medium and Towards Data Science and didn\u2019t sign up yet, feel free to use my referral link to join the community."}, {"url": "https://medium.com/tag/data-science?source=post_page-----805030df4f06---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/pandas?source=post_page-----805030df4f06---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----805030df4f06---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&user=Benedikt+Droste&userId=93813b47e030&source=-----805030df4f06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&user=Benedikt+Droste&userId=93813b47e030&source=-----805030df4f06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----805030df4f06--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F805030df4f06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----805030df4f06---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----805030df4f06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----805030df4f06--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----805030df4f06--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----805030df4f06--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----805030df4f06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@droste.benedikt?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@droste.benedikt?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Benedikt Droste"}, {"url": "https://medium.com/@droste.benedikt/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "971 Followers"}, {"url": "https://www.linkedin.com/in/benedikt-droste-893b1b189/", "anchor_text": "https://www.linkedin.com/in/benedikt-droste-893b1b189/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F93813b47e030&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&user=Benedikt+Droste&userId=93813b47e030&source=post_page-93813b47e030--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe545585931c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-loop-71-803-times-faster-805030df4f06&newsletterV3=93813b47e030&newsletterV3Id=e545585931c&user=Benedikt+Droste&userId=93813b47e030&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}