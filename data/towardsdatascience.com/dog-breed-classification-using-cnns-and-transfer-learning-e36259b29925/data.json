{"url": "https://towardsdatascience.com/dog-breed-classification-using-cnns-and-transfer-learning-e36259b29925", "time": 1683003063.191453, "path": "towardsdatascience.com/dog-breed-classification-using-cnns-and-transfer-learning-e36259b29925/", "webpage": {"metadata": {"title": "Applying transfer-learning in CNNs for dog breed classification | by Mark C. F. Sousa | Towards Data Science", "h1": "Applying transfer-learning in CNNs for dog breed classification", "description": "This article proposes the use of pre-trained Convolutional Neural Networks to classify dog breedings. Besides the dog breed classification for dogs, the CNNs are also used to identify the dog breed\u2026"}, "outgoing_paragraph_urls": [{"url": "https://opencv.org/", "anchor_text": "OpenCV", "paragraph_index": 5}, {"url": "https://github.com/opencv/opencv/tree/master/data/haarcascades", "anchor_text": "GitHub", "paragraph_index": 5}, {"url": "https://github.com/opencv/opencv/tree/master/data/haarcascades", "anchor_text": "haarcascades", "paragraph_index": 5}, {"url": "https://github.com/opencv/opencv/blob/master/data/haarcascades/haarcascade_frontalface_alt.xml", "anchor_text": "frontal face detector", "paragraph_index": 5}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 9}, {"url": "https://keras.io/applications/#classify-imagenet-classes-with-resnet50", "anchor_text": "ResNet50", "paragraph_index": 11}], "all_paragraphs": ["This article proposes the use of pre-trained Convolutional Neural Networks to classify dog breedings. Besides the dog breed classification for dogs, the CNNs are also used to identify the dog breed most similar to any given picture of humans.", "This article presents the project in six steps:", "FC layers: Fully Connected layersConv. layers: Convolutional layers", "The dataset provided by Udacity is relatively small. It contains 8351 total dog images from 133 possible dog breed classes, roughly 63 per class. The dataset split as follows:", "Another dataset with 100 images was provided to test the pre-trained human identifier.", "The OpenCV library provides many pre-trained face detector on the GitHub repository. For this project, we used the haarcascades for frontal face detector.", "From the 100 images containing humans, the pre-trained model could identify all of them, 100% accuracy. In three of those 100 images, more than one face was found. These examples are shown in Figure 1. In the first example, there was only one face and it was recognized twice.", "When I gave another set of 100 dog images to the classifier, it identified 11 of them as human pictures. You can see 9 of these mistakes in Figure 2 below. But if you see error 1 below, besides the dog, there also is a human in the image, and the face detector identifies the human correctly. Therefore, let\u2019s consider it is not an error. The detector made only 10 errors, not 11.", "The human face detector is very good to identify humans, there were no false positives. On the other hand, it is not so good to discriminate between dogs and humans, it miss-classified 10 out of 100 dogs as humans.", "The library Keras provide CNN models already trained on the ImageNet dataset. This dataset contains images under 1000 different classes, being 118 of them related to dogs. It means we can use these pre-trained models to determine whether an image contains a dog or not.", "It is important to differentiate between the previous classifier and the classifier going to be presented next. The purpose of the first was to identify whether the image contains a human or not. The purpose of the next is to identify whether the image contains a dog or not. Combining both classifiers we can determine when there is a dog, a human, both, or none in the image.", "The following code shows how to use the pre-trained model ResNet50 in Keras to determine if there is a dog in the image.", "Keras provides the function preprocess_input to normalize the new image according to the distribution from the IMAGENET dataset. This function subtracts the mean pixel [103.939,116.779,123.68], which is known from the dataset, from every RGB pixel in the image.", "The prediction made in ResNet50_model.predict returns a list of probabilities for each class. The classes corresponding to dogs are in the positions between 151 and 268, both inclusive. To verify if the image is a dog, the maximum probability must be in positions ranging from 151 to 268 to be a dog, otherwise, it is not a dog.", "From the 100 images containing humans, the pre-trained model didn\u2019t recognize any dog on them, which is great. In addition, the classifier was also able to recognize all the other 100 images containing dogs. This model didn\u2019t make any mistake over these 200 images.", "At this point, you may be wondering, why don\u2019t we simply use these 118 dog classes to classify the dog breeds. It is because we are trying to classify the dogs into 133 possible dog breed classes, 15 new classes. Even if we knew that some of the 118 classes from pre-trained ResNet50 model overlap with the 133 dog breed classes, we still wouldn\u2019t have a good solution for these specific classes that do not overlap. In fact, we have a solution that uses the knowledge in the pre-trained model and can be used to classify all the 133 dog breeds. It is transfer-learning.", "Fortunately, it is possible to use a CNN already trained in one dataset to shorten the training in other datasets. We just have to take two things into account, the size of the new dataset and the similarity between the new dataset and the dataset used to train the network previously. We these two variables we have four possible scenarios, described in Figure 3.", "When the new dataset is similar to the dataset used to train the network, we can keep most of the layers. If we don\u2019t have much data, we can keep almost all layers, only replacing the output layer by a new layer to match the number of classes we have in the new dataset, as shown in scenario 1 of Figure 3.", "If the new dataset is similar, but it is large, we can keep the Convolutional layers as they are and replace all the Fully Connected layers. This case is shown in scenario 2 of Figure 3. Optionally, we can choose the same number of neurons per layer in the Fully Connected layers, as long as we reset the weights of these layers with random numbers and certify that the number of outputs is the same number of classes in the dataset.", "When we have a new dataset that is different from the dataset the model was trained, we can\u2019t keep all convolutional layers. We have to replace some of the last Convolutional layers because these layers extract higher-level features that are only relevant to the classes in the dataset used to train the model. Therefore, we should extract other higher-level features that are more relevant to the classes that we have in the new dataset. This case is shown in scenario 3 of Figure 3. We can preserve the architecture of the network creating the new layers with the same number of filters, in the case of Convolutional layers, and the same number of neurons, in the case of Fully Connected layers. The output layer must match the number of classes we have in the new dataset.", "I used the ResNet50 trained on ImageNet dataset. The new dataset is similar to ImageNet, so the trained model has already seen dogs before. Also, the new dataset has 8351 images, which is not so small. Using a technique called data-augmentation, we can transform the images already existent in our dataset to generate slightly different images. Using data-augmentation we can have a dataset roughly 5 times bigger. In this case, we can go with scenario 2, the large and similar dataset.", "To train the new FC layers I need the features used to feed the first FC layers. These features are known as bottleneck features. This name is due to the fact that these features are obtained from the last Conv layer, which is the layer with the narrowest features maps. The first Conv layers extract fewer feature maps and they have higher-resolution, while the last Conv layers extract more feature maps and they have lower-resolution.", "We can save time by pre-processing all the images in the dataset through the Conv layers to generate and store the bottleneck features into files. To train the network we must read the bottleneck feature from the files and feed them into the FC layers. Reading all bottleneck features from files is much faster than submitting all images through the Conv layers. In this way we save invaluable time, considering that all the dataset is iterated many times.", "I\u2019ve trained three different models of FC layers. These models are shown in Figure 4.Model A \u2014 The first hidden layer was a GlobalAveragePooling2D layer followed by the output Dense layer.Model B \u2014 This model added a Dropout layer, with a 50% chance of dropping, between the GlobalAveragePooling2D and the output Dense layer.Model C \u2014 This model added another Dense and Dropout layer, with a 50% chance of dropping, before the output Dense layer.", "All models were trained during 50 epochs (50 iterations over the whole dataset). The train and validation accuracies and losses are shown in Figure 5.", "It is important to note the difference between the train and the validation performance. Model A achieves very good results during training, but it couldn\u2019t be replicated to the validation. This difference is a good signal of overfitting, indicating that the model is very good during training but it is not consistent classifying images never seen before. It indicates that the model has a low generalization capacity.", "Model B presents more consistent results between training and validation. But model C was the best between them. Model C has better results in classifying images that were never seen before than classifying the images used during in training. Moreover, model C also achieved the lowest loss.", "In the previous step, only the FC layers were trained using the bottleneck features from ResNet50. To fine-tune the network, I connected the original Conv layers to the FC layers I have just trained, resulting in a complete CNN.", "The training was resumed, but this time adjusting all the weights in the complete CNN, not only the FC layers.", "At this point, I also used data-augmentation to add random modifications to the images in the dataset. The data-augmentation used the following parameters:", "After training the three complete CNN models for more five epochs with data-augmentation, they achieved the results shown in Figure 6 below.", "The insertion of data augmentation resulted in a brief decrease in performance, but the validation values return to the previous point after the five epochs.", "The three models achieve very similar results. It is difficult to see from the graphics which is the best model. We can see the accuracies and losses achieved after iteration 55 in the table below:", "The model C presented the best result, with the highest accuracy and the lowest loss. Considering that this model also presented the best generalization, I trained only model C for more 10 epochs.", "The final accuracy of model C in the test set, never seen before, was 86,12%.", "The extraction of bottleneck features is beneficial to save time when we are only training the fully connected layers.", "The addition Dropout layers in the FC layers improved the capacity of generalisation of models. Moreover, the addition of a second Dense layer with another Dropout layer, not only boosted the generalisation capacity of the network but also helped the model to achieve better classification performance.", "Disclaimer: Udacity may have partially provided some of the source code presented here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I hold a BSc degree in Computer Science and an MSc degree in Electrical Engineering. I have over ten years of experience working with Software Engineering."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe36259b29925&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e36259b29925--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@markfsousa?source=post_page-----e36259b29925--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@markfsousa?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Mark C. F. Sousa"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F856073c3ec58&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&user=Mark+C.+F.+Sousa&userId=856073c3ec58&source=post_page-856073c3ec58----e36259b29925---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/pt/users/Comfreak-51581/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2467149", "anchor_text": "Jonny Lindner"}, {"url": "https://pixabay.com/pt/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2467149", "anchor_text": "Pixabay"}, {"url": "http://docs.opencv.org/trunk/d7/d8b/tutorial_py_face_detection.html", "anchor_text": "Haar feature-based cascade classifiers"}, {"url": "https://keras.io/applications/#classify-imagenet-classes-with-resnet50", "anchor_text": "ResNet50"}, {"url": "http://image-net.org/index", "anchor_text": "ImageNe"}, {"url": "https://opencv.org/", "anchor_text": "OpenCV"}, {"url": "https://github.com/opencv/opencv/tree/master/data/haarcascades", "anchor_text": "GitHub"}, {"url": "https://github.com/opencv/opencv/tree/master/data/haarcascades", "anchor_text": "haarcascades"}, {"url": "https://github.com/opencv/opencv/blob/master/data/haarcascades/haarcascade_frontalface_alt.xml", "anchor_text": "frontal face detector"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://keras.io/applications/#classify-imagenet-classes-with-resnet50", "anchor_text": "ResNet50"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----e36259b29925---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e36259b29925---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e36259b29925---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e36259b29925---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----e36259b29925---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&user=Mark+C.+F.+Sousa&userId=856073c3ec58&source=-----e36259b29925---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&user=Mark+C.+F.+Sousa&userId=856073c3ec58&source=-----e36259b29925---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e36259b29925--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe36259b29925&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e36259b29925---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e36259b29925--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e36259b29925--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e36259b29925--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e36259b29925--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e36259b29925--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@markfsousa?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@markfsousa?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mark C. F. Sousa"}, {"url": "https://medium.com/@markfsousa/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "35 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F856073c3ec58&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&user=Mark+C.+F.+Sousa&userId=856073c3ec58&source=post_page-856073c3ec58--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F856073c3ec58%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdog-breed-classification-using-cnns-and-transfer-learning-e36259b29925&user=Mark+C.+F.+Sousa&userId=856073c3ec58&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}