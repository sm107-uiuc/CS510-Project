{"url": "https://towardsdatascience.com/getting-started-with-recommender-systems-and-tensorrec-8f50a9943eef", "time": 1682994747.294477, "path": "towardsdatascience.com/getting-started-with-recommender-systems-and-tensorrec-8f50a9943eef/", "webpage": {"metadata": {"title": "Getting Started with Recommender Systems and TensorRec | by James Kirk | Towards Data Science", "h1": "Getting Started with Recommender Systems and TensorRec", "description": "Recommender systems are used in many products to present users with relevant or personalized items (food, movies, music, books, news, etc). To do this, they learn from users\u2019 previous interactions\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/jfkirk/tensorrec", "anchor_text": "TensorRec", "paragraph_index": 1}, {"url": "https://github.com/jfkirk/tensorrec/blob/master/examples/getting_started.py", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/jfkirk/tensorrec", "anchor_text": "TensorRec", "paragraph_index": 3}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens dataset", "paragraph_index": 5}, {"url": "https://docs.scipy.org/doc/scipy/reference/sparse.html", "anchor_text": "Scipy sparse matrix", "paragraph_index": 9}, {"url": "https://www.cs.cmu.edu/~mgormley/courses/10601-s17/slides/lecture25-mf.pdf", "anchor_text": "matrix factorization", "paragraph_index": 10}, {"url": "https://arxiv.org/abs/1711.04015", "anchor_text": "WMRB, which stands for \u201cweighted margin-rank batch,\u201d", "paragraph_index": 23}, {"url": "https://github.com/jfkirk/tensorrec/blob/master/tensorrec/loss_graphs.py", "anchor_text": "here", "paragraph_index": 25}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MultiLabelBinarizer.html#sklearn.preprocessing.MultiLabelBinarizer", "anchor_text": "Scikit\u2019s MultiLabelBinarizer", "paragraph_index": 28}, {"url": "https://twitter.com/MITREcorp", "anchor_text": "MITRE", "paragraph_index": 45}, {"url": "https://www.youtube.com/watch?v=xBMGr08fowA&t=3m58s", "anchor_text": "here", "paragraph_index": 45}, {"url": "https://github.com/jfkirk/tensorrec/issues", "anchor_text": "open a GitHub issue", "paragraph_index": 46}], "all_paragraphs": ["Recommender systems are used in many products to present users with relevant or personalized items (food, movies, music, books, news, etc). To do this, they learn from users\u2019 previous interactions with items to identify users\u2019 tastes and improve future recommendations.", "This post will walk us through the prototyping of a new recommender system in Python using TensorRec including input data manipulation, algorithm design, and usage for prediction.", "You can find the Python code from this post\u2019s example here.", "TensorRec is a Python package for building recommender systems. A TensorRec recommender system consumes three pieces of input data: user features, item features, and interactions. Based on the user/item features, the system will predict which items to recommend. The interactions are used when fitting the model: predictions are compared to the interactions and a loss/penalty is calculated, which the system learns to decrease.", "As we prototype our system, we\u2019ll be tackling three major topics: how we handle interactions, how we handle features, and how we structure the recommender itself.", "For this example we\u2019ll use the MovieLens dataset. This dataset contains 1\u20135 star ratings for movies, metadata about those movies, and tags that users applied to the movies. For our first prototype we\u2019ll focus on the ratings, but we\u2019ll return to the other metadata later.", "In raw form, the ratings look like this:", "Each row represents a single rating: one user\u2019s thoughts about one movie. We\u2019ll be using these ratings as our interactions. Our first step toward training this system is to ingest and format this interaction data. First, we read in the CSV file of ratings.", "At this point, we\u2019ll break the ratings in to a training and test set by shuffling and splitting the ratings. Our prototypes will be trained on the training set, and we\u2019ll evaluate their success using the test set. Splitting the train/test sets at random like this is crude, and there are more rigorous techniques for model evaluation, but it is quick and clear for the purposes of this example.", "Next, we reorganize these ratings in to a Scipy sparse matrix. In this matrix, every row represents a user and every column is a movie. The [i, j]th value in this matrix is User i\u2019s interaction with Movie j.", "A collaborative filter is an algorithm that learns which users have similar tastes and recommends items to a user based on what similar users have liked. A common way to do this is through matrix factorization. In matrix factorization, we have to learn two matrices (user representations and item representations) that, when multiplied together, approximate the interactions:", "In this case, rows of W are the user representations, columns of H are the item representations, and values in V are the interactions. W and H need to be learned to produce the best approximation of V.", "The width of W and the height of H are the same \u2014 this shared dimension is referred to as the \u201cnumber of components.\u201d A model with more components is learning more complex representations of users and items, but this can lead to over-fitting the training data. In general, we want to try to squeeze lots of information in to small representations. For this reason, in our prototype I\u2019ve arbitrarily chosen to use 5 components. When prototyping further, we should experiment with increasing and decreasing the number of components and be wary of over-fitting.", "TensorRec will perform matrix factorization by default if it is given only identity matrices as user/item features. These identity matrices are often called \u201cindicator features.\u201d", "We have now created the two indicator feature matrices, built a simple collaborative filter model with 5 components, and fit the model!", "Next, of course, we\u2019ll want to see how well the model performs.", "To do this, we\u2019ll look at a metric called \u201crecall at K.\u201d Recall@K says, for the average user, what percentage of their test items made it in to the top K in the predicted rankings. In other words, if we get a recall@10 value of .06, then there is a 6% chance that a particular movie I like will make it in to my top 10 recommendations.", "Recall@K is a nice metric for many recommender systems because it emulates the behavior of a recommendation product: If a movie website is only going to show me my top 10 recommendations, then their algorithm will want to be effective at putting movies I like in my top 10.", "Before calculating the recall, we\u2019ll want to decide which interactions should count as a \u201clike.\u201d In this case, I\u2019ve chosen to use all ratings of at least 4.0 as \u201clikes\u201d and ignore the rest.", "\u2026Not great. These results tell us that, among the test-set movies, there is only a .1% chance that a liked movie made it in to the top 10. This recommender system is ineffective, and we\u2019ll want to look for ways to improve it.", "One way we can configure our TensorRec system is by changing the loss graph. The loss graph takes in predictions and interactions and calculates a penalty (loss) that the system will try to decrease as it learns.", "By default, TensorRec uses RMSE (root mean square error) as the loss graph. This means that TensorRec is trying to estimate the values of the interactions exactly: if I rated a movie 4.5, TensorRec is trying to produce a predicted score of exactly 4.5.", "This is intuitive, but it doesn\u2019t line up with how recommender systems work in many products: a movie website doesn\u2019t need to predict my rating exactly, it just needs to be able to rank movies I will like above movies I won\u2019t like. For this reason, many systems function by \u201clearning to rank.\u201d We can make our TensorRec system work this way by using a loss graph called WMRB.", "WMRB, which stands for \u201cweighted margin-rank batch,\u201d works by taking a random sample of items the user hasn\u2019t interacted with and comparing their predictions to items the user likes. Over time, this pushes items a user likes to the top of the rankings.", "We can tell TensorRec to use WMRB by specifying it when we construct the model and specifying the size of the sample batch when fitting the model. In this case, we\u2019ll want to train the model on only the positive ratings (\u22654.0) so WMRB pushes those to the top.", "Much better! We\u2019ve gone from a .1% chance of a liked item reaching the top 10 all the way to a 7.76% chance. This is an example of how impactful the right loss function can be. TensorRec allows you to specify and customize your own loss graphs, and you can see more example loss graphs here.", "To continue experimenting, we should try to make use of other data available to us. In the MovieLens example, we can use movie metadata, such as the movie\u2019s genres, to enrich the recommendations.", "In raw form, the movie metadata file looks like this:", "First, we\u2019ll want to read this data, map the movies to our internal IDs, and keep track of the genres for each movie. Then we\u2019ll binarize the genre labels using Scikit\u2019s MultiLabelBinarizer. The binarized output will be our features for our new recommender system.", "Running this will print out an example of the raw metadata and the binarized genres:", "Now that we have metadata about our items, one thing we can try is to recommend based solely on the item metadata.", "To do this, we will configure a TensorRec model to use a pass-through representation graph for item features. For us, this means that the item representations will be the same as the item features that are passed in (just the movie genres) and the user representations will reflect how much the user likes that particular genre.", "It\u2019s not as good as the ranking collaborative filter but, with a recall@10 of 1.3%, it\u2019s significantly more effective than our very first collaborative filter.", "There is a major weakness to this system: genres alone are not very descriptive and are not enough information to make an informed recommendation. If we had more descriptive metadata (more tags, actors, sub-genres, etc) we may have more success with this content-based recommender system.", "On the other hand, there is a major strength to this system: by relying on only metadata features, and not using indicator features, we can recommend movies which were not present when training the model. Similarly, if we have valuable user metadata we can avoid using user indicator features and make predictions for users who\u2019ve never interacted with a movie before. This is called \u201ccold-start\u201d recommendation.", "We know that our ranking collaborative filter gave us the best results, but it seems there is some value in using the movie metadata. Let\u2019s combine these two: we\u2019ll use indicator features to get the strengths of a collaborative filter, and we\u2019ll also use the content features to take advantage of the metadata. Systems like this that combine collaborative filtering and content-based recommendation are called \u201chybrid\u201d models.", "We do this by stacking the two sets of features together:", "With a recall@10 of 7.94%, this is our strongest recommender system yet. Compared to the pure collaborative filter\u2019s result of 7.76% the difference isn\u2019t profound, but it is still an improvement. If we use more metadata than just genres, we\u2019ll likely see an even larger impact.", "We have a trained model and now we can use this model to make recommendations for our users. We do this by passing the user\u2019s feature vector and all the item features to predict_rank() and examining the resulting rankings:", "This code snippet will print out the top 10 recommendations for user 432. I chose user 432 because I am familiar with the movies they\u2019ve rated, so I feel I can put myself in their shoes and judge their recommendations. We should note that the movies user 432 has already rated will still be included \u2014 if we want to filter those out, we will need to do that with a post-processing step.", "Let\u2019s look at user 432\u2019s training data to see what kinds of movies they like:", "Some crime, some dark comedy, and a notable love for Tarantino. Let\u2019s look at user 432\u2019s recommendations from our hybrid model:", "Some more crime flicks with a definite dark comedy bent! This looks pretty good at-a-glance, but let\u2019s check user 432\u2019s test movies:", "Both Fargo and Fight Club made it in to user 432\u2019s recommendations \u2014 this is a great result! For this specific user, we achieved a recall@10 of 50%.", "To continue to refine our recommender system we should experiment with more representation, prediction, and loss graphs, providing more metadata to the system, engineering those metadata features differently, managing interaction/feedback data differently, and optimizing the various hyper-parameters of the system.", "I recently had the chance to visit MITRE to discuss many of the design choices when designing and deploying recommender systems. You can find a video of the talk here.", "If you have questions, please feel free to ask them here or open a GitHub issue.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning, Recommendations, and Personalization. Ex- Spotify, Quantopian, Amazon Robotics. My other blog is an honors student."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8f50a9943eef&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jameskirk1?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jameskirk1?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "James Kirk"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F75df3566f52c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&user=James+Kirk&userId=75df3566f52c&source=post_page-75df3566f52c----8f50a9943eef---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/jfkirk/tensorrec", "anchor_text": "TensorRec"}, {"url": "https://github.com/jfkirk/tensorrec/blob/master/examples/getting_started.py", "anchor_text": "here"}, {"url": "https://github.com/jfkirk/tensorrec", "anchor_text": "TensorRec"}, {"url": "https://grouplens.org/datasets/movielens/", "anchor_text": "MovieLens dataset"}, {"url": "https://docs.scipy.org/doc/scipy/reference/sparse.html", "anchor_text": "Scipy sparse matrix"}, {"url": "https://www.cs.cmu.edu/~mgormley/courses/10601-s17/slides/lecture25-mf.pdf", "anchor_text": "matrix factorization"}, {"url": "https://arxiv.org/abs/1711.04015", "anchor_text": "WMRB, which stands for \u201cweighted margin-rank batch,\u201d"}, {"url": "https://github.com/jfkirk/tensorrec/blob/master/tensorrec/loss_graphs.py", "anchor_text": "here"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MultiLabelBinarizer.html#sklearn.preprocessing.MultiLabelBinarizer", "anchor_text": "Scikit\u2019s MultiLabelBinarizer"}, {"url": "https://twitter.com/MITREcorp", "anchor_text": "MITRE"}, {"url": "https://www.youtube.com/watch?v=xBMGr08fowA&t=3m58s", "anchor_text": "here"}, {"url": "https://github.com/jfkirk/tensorrec/issues", "anchor_text": "open a GitHub issue"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8f50a9943eef---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8f50a9943eef---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----8f50a9943eef---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----8f50a9943eef---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/recommendation-system?source=post_page-----8f50a9943eef---------------recommendation_system-----------------", "anchor_text": "Recommendation System"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&user=James+Kirk&userId=75df3566f52c&source=-----8f50a9943eef---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&user=James+Kirk&userId=75df3566f52c&source=-----8f50a9943eef---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8f50a9943eef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8f50a9943eef---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8f50a9943eef--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8f50a9943eef--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8f50a9943eef--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jameskirk1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jameskirk1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "James Kirk"}, {"url": "https://medium.com/@jameskirk1/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "551 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F75df3566f52c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&user=James+Kirk&userId=75df3566f52c&source=post_page-75df3566f52c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa4f01ce649ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgetting-started-with-recommender-systems-and-tensorrec-8f50a9943eef&newsletterV3=75df3566f52c&newsletterV3Id=a4f01ce649ca&user=James+Kirk&userId=75df3566f52c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}