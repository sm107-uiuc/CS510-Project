{"url": "https://towardsdatascience.com/sex-matters-and-why-i-know-712578a6857d", "time": 1683015392.3636339, "path": "towardsdatascience.com/sex-matters-and-why-i-know-712578a6857d/", "webpage": {"metadata": {"title": "Interpretability in PyTorch, Integrated Gradient | Towards Data Science", "h1": "Sex Matters And Why I Know", "description": "Interpretability in PyTorch using Integrated Gradient in Captum and combining it with PyTorch Lightning to create a mesmerizing training process."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/titanic/data?select=train.csv", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://towardsdatascience.com/pytorch-lightning-machine-learning-zero-to-hero-in-75-lines-of-code-7892f3ba83c0", "anchor_text": "here", "paragraph_index": 12}, {"url": "https://www.kaggle.com/c/titanic/notebooks", "anchor_text": "Kaggle", "paragraph_index": 19}, {"url": "https://arxiv.org/abs/1703.01365", "anchor_text": "Axiomatic Attribution for Deep Networks", "paragraph_index": 27}, {"url": "https://captum.ai/api/attribution.html", "anchor_text": "DeepLift", "paragraph_index": 28}, {"url": "https://arxiv.org/abs/1703.01365", "anchor_text": "Axiomatic Attribution for Deep Networks", "paragraph_index": 29}, {"url": "https://medium.com/python-in-plain-english/how-to-make-gifs-with-python-and-seaborn-from-google-trends-data-fd3fe16cba11", "anchor_text": "How to make GIFS with Python and Seaborn From Google Trends Data", "paragraph_index": 52}, {"url": "https://twitter.com/san_sluck", "anchor_text": "Twitter", "paragraph_index": 55}, {"url": "https://www.linkedin.com/in/sandro-luck-b9293a181/", "anchor_text": "LinkedIn", "paragraph_index": 55}, {"url": "https://www.youtube.com/channel/UCHD5o0P16usdF00-ZQVcFog?view_as=subscriber", "anchor_text": "YouTube", "paragraph_index": 56}], "all_paragraphs": ["Neural networks have been taking the world by storm. Not a week passes without great news about how GPT-3 supposedly automates yet another language task. Or how AI is helping doctors during the current pandemic.", "But an increasing share of the population is becoming more and more skeptical about the turn AI is taking. Did it pick this treatment method because it is the right treatment method? Or because it happened to be the best one for that other 5.29-year-old patient in the training set?", "Entire population groups warn us of the implications of bad designs in AI, and we should better listen. After all, racial and gender-related features have been used in the recent hiring process algorithms in discriminating ways!", "How can we, as an AI-community,", "The answer to 1,2 and 3 is clear Interpretability! It has been taking in the world of Deep Learning by storm. Let\u2019s learn today what it is and how we can easily integrate it into our process.", "We will build a Neural Network to predict the survival chance of a titanic passenger. And finally, understand what we did, and interpret our model using Captum. All using the mighty Lightning framework.", "We will start by importing our dependencies.", "To make this minimal example, we will work with the Titanic dataset (one small file). It can be downloaded here. Once you downloaded it, put it into a new folder \u2018data/train.csv..\u2019 This dataset is probably the most popular Kaggle dataset ever and therefore allows us to verify our results.", "It contains the 890 different passengers of the Titanic. For each passenger, we are going to predict if they survived!", "To do so, we are given several features.", "We will only work with a small subset of these, namely:", "Now that we got an overview, let\u2019s define the Dataset. A Dataset is a class from PyTorch. It needs to define 3 private functions, init(), len(), getitem().", "If you are not familiar with this, you can find an easy explanation here (1. The Dataset). The goal here is to make a minimal preprocessing to show our interpretation later.", "And that\u2019s already our minimal Dataset. Keep in mind that this is only a small helper class. It helps Pytorch Lightning do its magic, so we save more code down the line.", "The features we got and what their interpretation is.", "We will now build a short but powerful model. It will call the following layers in order.", "We will now define a PytorchModel called MyHeartWillGoOn. Basically, only the forward function is crucial.", "Training with PyTorch Lightning is done with a nice little Trainer.", "Training our model on a GPU for 20 epochs will give us the following results.", "As we can see, we get an easy 84% accuracy, which is acceptable for this task. We are more interested in interpreting this time. If you want to know how to get a perfect score on this task, have a look at Kaggle.", "Since Pytorch Lightning is really new, and Captum is even newer ;) We are pretty cutting edge here.", "We need to get around a few little problems, which yet have not been solved properly. To get this right, we need to add a smaller wrapper function to present later to Captum. Basically, Captum is a Library that has several methods available. These methods predict the importance of input features to Neural models. They do so in several ways. We will use the probably most popular method IntegratedGradient. I will give an intuition of this method below.", "Now we can start learning how our model thinks. Give this object IntegratedGradients. We can use its main method attribute()!", "attribute() is a function that takes as an input a tensor and returns us a tensor of the same shape", "This means that when we tell our model, our case study object:", "It will make a prediction using these 5 features. Let\u2019s say 0.3, which means 0.3% survival chance, for this 22-year-old man paying 7.25 in the fare. After predicting, we will send this 30% Survival rate ->0 %, meaning he died.", "Now Integrated gradient returns us a tensor, also having 5 values. Each of these values will tell us how important the respective feature is. This may be a difference in y. E.g.", "A little theory lesson in the middle. Integrated Gradients has been proposed in \u201cAxiomatic Attribution for Deep Networks.\u201d Integrated Gradients is used to understand how our Neural Network works. Integrated Gradients is a so-called interpretability algorithm.", "There are several interpretability algorithms used in today's AI community, but IG is one of the first and most established ones. The scientific community has not clearly decided which algorithm is the best. Feel free to test some of the other ones, like DeepLift.", "This is a simplified explanation, please refer to the paper for more details \u201cAxiomatic Attribution for Deep Networks\u201d", "To optimize a loss function in a Neural Network fashion, we build a gradient. To understand how much each input feature contributes to our loss function, we reverse this process (called Integration), so we Integrate the Gradient.", "Now, calculating the Integral is hard, and the answer is not clear. This is why we have to approximate it. We approximate this Integral using a Riemann Sum.", "We approximate the value by using a hyperparameter n_steps and a baseline. The baseline is what we compare our input to (we look at this in detail below). The n_steps is the number of times we backpropagate to estimate the integral. N_steps basically controls how precise our estimate of the integral is.", "Using these things, we will understand our model", "As you can see, when we give Captum, these two identical examples. With the exception of Gender. We get drastically different survival rates.", "And the Survival guess for the male is 12% and 58% for the female! The two Importance values we got are:", "As we can see in both cases, the importance is the strongest (in absolute terms) in the feature SEX. This indicates that this is the most important feature!", "Interpreting the sign: We can think of it as something that adds to the prediction (+) or deducted from the prediction (-). I.e. + makes it more likely to be (1) or less likely to be (1).", "We can see that depending on the Sex(Male\\Female), the resulting vector is quite different.", "The baseline is what we compare our value. In order to understand its impact, we will compare the most obvious choices. In the initial paper, the ideas of noise and black images (zeros) were used.", "We will compare 4 different baselines.", "To following, code will produce the desired interpretation.", "Our results look something like this.", "Now we found what we are after!", "Once we have done the work, we can sit back and enjoy it!", "A pivot data frame is basically just taking a different view on the same data. Here we tell it to have the index (the rows on the base-type) and the columns on the \u2018features.\u2019 This looks something like this.", "Now all that is left to do is plot it using", "Great, now I hope also the last skeptic is convinced Sex is Great! We can clearly see that the impact of the feature Sex is significant. When we look at the dataset, we could notice that being a man increases your chance of dying significantly. \u201cWomen and children first\u201d is the way they go with ships, after all.", "Here we see quite a difference between the baselines. If we compare the two baselines with the Mean-Base, we notice that the importance of SibSp changes drastically. This generally should illustrate that using baselines such as 1 and 0 is not advisable. The reason for this is that we calculate how much the prediction changes between baseline and value.", "For Images for example using a 0-baseline might make sense. The reason is that a black square represents in this case the absence of information.", "The surprise of the day comes for me in the form of the success of Random baselines. The authors of Integrated Gradients mentioned that using a random baseline is advisable. But i did not anticipate it working so well for this example.", "GIFs are crucial when making people pay attention to your data on certain platforms. Especially on social media, animation can make the difference between a click and a quick glimpse.", "Since this article is already pretty long, please refer to my article \u201cHow to make GIFS with Python and Seaborn From Google Trends Data\u201d to learn at lightning speed to create the GIF above.", "We have learned what Interpretability is and how we can use it in PyTorch. We have seen how easy we can use it in our Prototyping and how to connect it to PyTorch Lightning.", "I hope this introduction to the world of Interpretability was easy and painless. Understanding what you are building can help our customers and us. It increases their confidence in our predictions significantly.", "If you enjoyed this article, I would be excited to connect on Twitter or LinkedIn.", "Make sure to check out my YouTube channel, where I will be publishing new videos every week.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I want to empower you to build the future. As a Machine Learning Engineer, I am passionate about everything in the data sphere Computer Science (MSc ETH)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F712578a6857d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----712578a6857d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@DataWithSandro?source=post_page-----712578a6857d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@DataWithSandro?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Sandro Luck (Data With Sandro)"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6b3d6b362026&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&user=Sandro+Luck+%28Data+With+Sandro%29&userId=6b3d6b362026&source=post_page-6b3d6b362026----712578a6857d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@davideragusa", "anchor_text": "davide ragusa"}, {"url": "https://www.kaggle.com/c/titanic/data?select=train.csv", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/pytorch-lightning-machine-learning-zero-to-hero-in-75-lines-of-code-7892f3ba83c0", "anchor_text": "here"}, {"url": "https://www.kaggle.com/c/titanic/notebooks", "anchor_text": "Kaggle"}, {"url": "https://arxiv.org/abs/1703.01365", "anchor_text": "Axiomatic Attribution for Deep Networks"}, {"url": "https://captum.ai/api/attribution.html", "anchor_text": "DeepLift"}, {"url": "https://arxiv.org/abs/1703.01365", "anchor_text": "Axiomatic Attribution for Deep Networks"}, {"url": "https://medium.com/python-in-plain-english/how-to-make-gifs-with-python-and-seaborn-from-google-trends-data-fd3fe16cba11", "anchor_text": "How to make GIFS with Python and Seaborn From Google Trends Data"}, {"url": "https://twitter.com/san_sluck", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/sandro-luck-b9293a181/", "anchor_text": "LinkedIn"}, {"url": "https://www.youtube.com/channel/UCHD5o0P16usdF00-ZQVcFog?view_as=subscriber", "anchor_text": "YouTube"}, {"url": "https://medium.com/tag/data-science?source=post_page-----712578a6857d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----712578a6857d---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/ai?source=post_page-----712578a6857d---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/programming?source=post_page-----712578a6857d---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----712578a6857d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&user=Sandro+Luck+%28Data+With+Sandro%29&userId=6b3d6b362026&source=-----712578a6857d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&user=Sandro+Luck+%28Data+With+Sandro%29&userId=6b3d6b362026&source=-----712578a6857d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----712578a6857d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F712578a6857d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----712578a6857d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----712578a6857d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----712578a6857d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----712578a6857d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----712578a6857d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----712578a6857d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@DataWithSandro?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@DataWithSandro?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sandro Luck (Data With Sandro)"}, {"url": "https://medium.com/@DataWithSandro/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "853 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6b3d6b362026&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&user=Sandro+Luck+%28Data+With+Sandro%29&userId=6b3d6b362026&source=post_page-6b3d6b362026--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9572238a79c3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsex-matters-and-why-i-know-712578a6857d&newsletterV3=6b3d6b362026&newsletterV3Id=9572238a79c3&user=Sandro+Luck+%28Data+With+Sandro%29&userId=6b3d6b362026&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}