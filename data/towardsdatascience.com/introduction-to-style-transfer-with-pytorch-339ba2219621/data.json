{"url": "https://towardsdatascience.com/introduction-to-style-transfer-with-pytorch-339ba2219621", "time": 1683010787.111159, "path": "towardsdatascience.com/introduction-to-style-transfer-with-pytorch-339ba2219621/", "webpage": {"metadata": {"title": "Introduction to Style Transfer with PyTorch | by Wesley Neill | Towards Data Science", "h1": "Introduction to Style Transfer with PyTorch", "description": "Case in point: The image to the left was created not by the brushstrokes of a human hand, but by a convolutional neural network! This demonstrates that neural networks are not limited in usefulness\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf", "anchor_text": "fascinating research paper", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/Gramian_matrix", "anchor_text": "Gramian matrix", "paragraph_index": 14}, {"url": "https://github.com/wcneill/jn-neural-networks/blob/master/udacity_pytorch/pytorch11_style_transfer.ipynb", "anchor_text": "find it here", "paragraph_index": 34}], "all_paragraphs": ["Did you know that neural networks don\u2019t believe in the separation of left and right brain?", "Case in point: The image to the left was created not by the brushstrokes of a human hand, but by a convolutional neural network!", "This demonstrates that neural networks are not limited in usefulness to complex math and statistics. With a little help, they can even create art! This article is written to explain the concepts of style transfer, as defined in this fascinating research paper by Gatys et al.", "Style transfer is a novel application of convolutional neural networks that was developed by Leon A. Gatys et al. It allows for an accurate mathematical definition of the \u201ccontent\u201d and \u201cstyle\u201d of an image. With content and style in hand, we may define a new kind of loss function that describes the difference in style and content between two images. Then, through back-propagation, we may update the pixels of one image to more closely match the style or content of another image.", "These images contain the style and content, respectively, of the image found in the article introduction.", "Convolutional neural networks are uniquely designed in such a way that they excel at recognizing and separating patterns in visual input.", "Here is a rough sketch of how they work:", "Image style transfer was originally performed on a convolutional network containing 16 convolutional layers in 5 groups separated by pooling layers. This network is called VGG19. Each group finds patterns in the input, and then passes those patterns through the pooling layer to discard some detail but keep the big picture.", "We will use PyTorch\u2019s pre-trained VGG network to get started:", "Based on what we know about ConvNets, they keep general patterns but begin to discard details in the deeper layers of a network. With that in mind, it might be easy to understand why the \u201ccontent\u201d of an image is defined as the output of a deep layer in the network.", "We will use the output of the 10th convolutional layer to define the \u201ccontent\u201d of an image. We name this layer conv4_2 because it is the second layer in the fourth stack of convolutional layers.", "Below is a function that extracts the content of selected layers from the network. These layers are selected based on their use in the linked research paper. Notice that conv4_2 is among them. The rest will be used for determining style:", "Using conv4_2 to describe \u201ccontent\u201d gives us the desired general structure we wish to emulate. Using shallower layers preserves more detail and using deeper layers discards more. You may choose to use a different layer based on your artistic preferences.", "If you know how to compute a correlation matrix of a sample space (often seen as a heatmap of correlation values), then this will seem familiar and quite a bit easier.", "Recall that the output of any given convolutional layer is a set of new image channels, each describing some pattern or feature found in the input. Each of these channels contains a filtered version of the input image that highlights certain features or patterns. We then define style as the correlation between these different features and calculate the correlation using a Gramian matrix.", "Recall also that an image channel is just a 2D grid of pixel values. Then to determine the correlation between different pattern channels from a single convolutional layer, we do the following:", "Here is a small function that does this for us in two lines:", "In order to get a good feeling for the \u201cstyle\u201d of an image, we create 5 separate Gramian matrices for each of 5 different convolutional layers.", "You may be wondering how these 5 layers were chosen to represent the \u201cstyle\u201d of an input image. Simply put, I chose to use the same layers that the authors did. Feel free to experiment with different layers!", "Because we wish to create a new image that contains the style of one parent and the content of another, we must define a loss function that takes both style and content into consideration.", "Content Loss is easy! Content loss is formally defined as the mean squared error between the content of two images. The content of an image is defined as the output of layer conv4_2.", "If the above equation is confusing, that\u2019s okay. This equation is much simplified by the use of linear algebra:", "Look back at the code snippet for get_features() and you will see that the function returns a dictionary containing all the feature channels from each of the following layers:", "c_features and t_features are simply the outputs of get_features() when applied to a content template image and a target image. Therefore matching code to the equation, we see that tensors T and C are defined in code by:", "Style loss is slightly more complicated mathematically but simple to implement. Style loss is found by first computing the mean squared error of the Gramian matrices of a target image and the Gramian matrices of the style template image:", "Here, P and G are the Gramian matrices for the target image and the style template image. The superscript l denotes the layer outputs from which the Gramians were calculated:", "Again, these layer outputs are stored in dictionaries returned by get_features() .", "Next, we find the weighted sum of each error term:", "The weights w are simply user chosen for artistic preference. Each layer\u2019s error will have a different effect on the outcome of the final artistic representation.", "Here\u2019s the code to compute style loss:", "Total loss is the linear combination of style and content loss:", "Where \u03b1 and \u03b2 are scaling factors. The ratio of \u03b1/\u03b2 will determine the style/content ratio in the new target image. In practice, \u03b2 will be much larger because the scale of style error is much smaller.", "The last thing to do is put it all together with feedforward and backpropagation. This time, we are not updating the network parameters! Instead, we are updating the pixel values of our target image so that it iteratively approaches having the style of our style image and the content of our content image:", "Don\u2019t be afraid to play with the parameters found in the code to achieve the exact artistic style you want. This will take some practice, and not every set of images will behave the way you expect. Have fun with it!", "If you\u2019d like to see my full Jupyter notebook on style transfer (including some helper functions I left out), you can find it here.", "For now, I\u2019ll leave you with this combination of abstract art and an aerial photograph of cumulus clouds :)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "MSc Applied Mathematics, BSc Information Technology. Data-Scientist and outdoor enthusiast."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F339ba2219621&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----339ba2219621--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@wesley.neill?source=post_page-----339ba2219621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wesley.neill?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Wesley Neill"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc66e68d62a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&user=Wesley+Neill&userId=c66e68d62a7d&source=post_page-c66e68d62a7d----339ba2219621---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/applied-neural-networks", "anchor_text": "Applications of Neural Networks"}, {"url": "https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf", "anchor_text": "fascinating research paper"}, {"url": "https://commons.wikimedia.org/wiki/File:Tuebingen_Neckarfront.jpg", "anchor_text": "Andreas Praefcke"}, {"url": "https://en.wikipedia.org/wiki/Gramian_matrix", "anchor_text": "Gramian matrix"}, {"url": "https://github.com/wcneill/jn-neural-networks/blob/master/udacity_pytorch/pytorch11_style_transfer.ipynb", "anchor_text": "find it here"}, {"url": "https://www.princeton.edu/news/2018/01/10/spotty-coverage-climate-models-underestimate-cooling-effect-daily-cloud-cycle", "anchor_text": "Princeton Environmental Institute"}, {"url": "https://www.cianellistudios.com/", "anchor_text": "Jaison Cianelli"}, {"url": "https://medium.com/tag/art?source=post_page-----339ba2219621---------------art-----------------", "anchor_text": "Art"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----339ba2219621---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/science?source=post_page-----339ba2219621---------------science-----------------", "anchor_text": "Science"}, {"url": "https://medium.com/tag/math?source=post_page-----339ba2219621---------------math-----------------", "anchor_text": "Math"}, {"url": "https://medium.com/tag/applied-neural-networks?source=post_page-----339ba2219621---------------applied_neural_networks-----------------", "anchor_text": "Applied Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&user=Wesley+Neill&userId=c66e68d62a7d&source=-----339ba2219621---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&user=Wesley+Neill&userId=c66e68d62a7d&source=-----339ba2219621---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----339ba2219621--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F339ba2219621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----339ba2219621---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----339ba2219621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----339ba2219621--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----339ba2219621--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----339ba2219621--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----339ba2219621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wesley.neill?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wesley.neill?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Wesley Neill"}, {"url": "https://medium.com/@wesley.neill/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "44 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc66e68d62a7d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&user=Wesley+Neill&userId=c66e68d62a7d&source=post_page-c66e68d62a7d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F57e6f0c535f6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintroduction-to-style-transfer-with-pytorch-339ba2219621&newsletterV3=c66e68d62a7d&newsletterV3Id=57e6f0c535f6&user=Wesley+Neill&userId=c66e68d62a7d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}