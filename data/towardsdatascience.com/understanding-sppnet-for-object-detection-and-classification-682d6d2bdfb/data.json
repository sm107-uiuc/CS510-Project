{"url": "https://towardsdatascience.com/understanding-sppnet-for-object-detection-and-classification-682d6d2bdfb", "time": 1683015855.613858, "path": "towardsdatascience.com/understanding-sppnet-for-object-detection-and-classification-682d6d2bdfb/", "webpage": {"metadata": {"title": "Understanding SPPNet for Object Classification and Detection | by Parth Rajesh Dedhia | Towards Data Science", "h1": "Understanding SPPNet for Object Classification and Detection", "description": "Spatial Pyramid Pooling (SPP) described in the SPPNet paper, provides ways to allow variable size input to the CNN models using the optimized pre-trained weights on fixed size input image."}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/understanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7", "anchor_text": "R-CNN network", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/bag-of-visual-words-in-a-nutshell-9ceea97ce0fb", "anchor_text": "Bag of Words", "paragraph_index": 5}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition", "paragraph_index": 36}], "all_paragraphs": ["In the paper \u201cSpatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition\u201d, a technique called the Spatial Pyramid Pooling layer was introduced, which makes the CNN model agnostic of input image size. It was the 1st Runner Up in Object Detection and 2nd Runner up in Classification challenge in ILSVRC 2014 and hence is worth a read.", "In this post, I have explained the SPP layer, followed by a review of the entire paper. The blog is structured as a conversation between a student and a teacher.", "I wish to learn more about object detection. Last time, you had explained the R-CNN network for object detection. Has there been any other research after R-CNN, in the domain of Object Detection?", "Soon after the R-CNN, the SPP-Net was introduced. The SPPNet made the model agnostic of input image size, and drastically improved the bounding box prediction speed as compared to the R-CNN, without compromising on the mAP. I will first explain how the made the model agnostic of input image size.", "The fixed size constraint of a CNN network is not because of the convolution layer but because of the Fully Connected (FC) layer. A single convolution layer or a set of convolution layers takes an image and produces a feature map proportional to a particular ratio (called the sub-sampling ratio, explained in a while) w.r.t the input image. But for a fully connected layer, the input has to be a fixed-length vector. To overcome this issue, the authors replaced the last pooling layer (the one just before the FC layer) with a Spatial Pyramid Pooling(SPP) layer.", "Note: The SPP approach is inspired by the Bag of Words approach. An in-depth understanding of the bag of words is not needed, but knowing about it will aid the understanding of the concept.", "The pooling layers that I have seen, have a fixed size of, let\u2019s say, 2 x 2 and a stride of 2 in both the direction. So in such cases, the output remains proportional to the input. How can a pooling layer solve the problem?", "In the pooling layer you described above, you had set up fix stride (of 2) and fix window size (of [2 x 2]). Because of this, your output is always proportional to the input. Now if you make the pooling window and stride proportional to the input image, you can always get a fixed-sized output. Moreover, the SPP layers do not just apply one pooling operation, it applies a couple of different output sized pooling operations (that\u2019s where then same comes from \u2014 Spatial Pyramid Pooling) and combines the results before sending them to the next layer.", "In the above image, the authors have used three pooling operations, where one of them outputs only a single number for each map. The other one gives a 2 x 2 grid output for each map, and similarly, the last one gives a 4 x 4 output. This operation is applied to each feature map (256 maps in the above case) given out by the previous convolution operation. The SPP layer output is flattened and send to the FC layer.", "Now to calculate the window size and stride size, let\u2019s declare some variables and formulas.", "Now on a [13 x 13] map, apply the above window([4 x 4]) and stride([3 x 3]), we get the output to be [4 x 4]. This operation is applied to all the feature maps and for 256 feature maps we get an output of [4 x 4 x 256]. So now we can change the [n x n] grid size to get the desired output size.", "The SPP layer is an intuitive design for the network as it\u2019s making the CNN model produce results irrespective of the input image size. So based on my understanding, I can apply this layer to any CNN before sending the features to the fully connected layer. Which models have the author used in this paper? Also, since a completely new layer is introduced before the FC layer, so did the authors use any pre-trained architecture or they trained a model from the start, for the classification task?", "One could apply the SPP layer to any of your CNN architectures. But, we are talking about the time of 2014. Not many models were present then. The authors used ZF-Net, AlexNet, and OverFeat (5 and 7 layered) architectures. However, these networks were modified by changing the padding to get the desired output feature map.", "The authors trained the model on ImageNet 2012 dataset, and provided a detailed analysis of the training details, and compared them with the contemporary models without using the SPP layer over them. However, let\u2019s just make some definitions clear before diving into the nitty-gritty details.", "Multi-size/Multi-scale image: Changing the input image size", "Multi-view: Using image augmentation \u2014 taking crops from the input image and flipping the same.", "First, the authors train on the model with a single-size input [224 x 224] and then train with a variable input size [224 x 224] and [180 x 180]. The authors perform training on fixed-size images to take the advantage of the GPU implementation. While training for multi-size, they send the same image size for one epoch and then alter to the other epoch. The pyramid used for both of the above training is: {6 x 6, 3 x 3, 2 x 2, 1 x 1}.", "Note: For training, the image is resized such that the minimum(height, width) is equated to 256 and the remainder is adjusted based on aspect ratio. After that 224 x 224 crops are picked from the center and four corners, giving us a total of 5 224 x 224 images. The image is flipped to produce more than 5 images from the same places, giving a total of 10 images from each input image.", "The authors compared the single-size trained SPP model with a no-SPP counterpart and saw a reduction in the error. To prove that this decrement in error is due to the SPP layer and not due to the increased parameters, they changed the SPP layer\u2019s pyramid to {4 x 4, 3 x 3, 2 x 2, 1 x 1}, which considerably reduce the parameter, but only with a minor increase in the error.", "The author also tried to test the model, with and without 224 croppings and analyzed the results. A reduction in error was observed and is shown in the image above. From this loss reduction, the authors said:", "This shows the importance of maintaining the complete content.", "From the above number, we can say that the novel layer introduces in the SPPNet paper did reduce the error for the classification task. I would also like to know how the authors extrapolated the model for the object detection task?", "The authors can use this model as it is for object detection, and can add a bounding box detector to shoot the mAP. However, to understand how this happens, we will first understand the concept of Sub-Sampling ratio (S)", "The sub-sampling ratio can be used to determine the output shape of the CNN feature map from the input image shape. Simply multiplying the input image dimensions with the sub-sampling ratio(S) will give us the feature map size. We will use this concept in a while.", "Note: Padding does affect the Sub-sampling ration as we may need to add/subtract a constant based on the padding. Details provided in the appendix of the paper.", "The SPPNet paper has shown analysis for ZF-Net paper for object detection. The ZF-Net paper has a sub-sampling ratio of 16. Now, for object detection, they still use the Selective Search Algorithm to determine the region (~ 2k regions per image) proposals. But unlike R-CNN, they don\u2019t send each proposed region to the CNN, but instead, map these regions to the output feature map from the last Convolution layer (Conv5).", "In the above image, the object from an image is mapped to the feature map. Let\u2019s look at the maths to see how to do that.", "In this way, we can map any object from the input image to the output feature map. The object\u2019s coordinates are also projected to the feature map, and only that region are then sent to the SPP layer for feature extraction and then to the FC layer.", "Projecting the regions from the input image to the feature map to avoid redundant Convolution Operations on the same part of the image is a smart way to reduce the computation. Has this mechanism affected the mAP of the detection as compared to R-CNN?", "Before comparing its performance, there are some more details that we need to have a look at. The authors have used the single-size ([224 x 224] only) ImageNet pre-trained ZF-5 network. For detection, they have used two different methods for prediction: single scale \u2014 where minimum(height, width) = 688, multi-scale where minimum(height, width) = {480, 576, 688, 864, 1200} and other size is resized depending on the aspect ratio.", "In the case of multi-scale detection, the authors have used a novel strategy of choosing the scale which has the total number of a pixel for the object to be closest to (224 x 224 = 50,176), to determine the presence of an object in that scale.", "In comparison with R-CNN, on a single scale, the performs degrades by 0.5% but in the case of multi-scale, the performance increases by 0.7%. Though this increase in mAP is not large, there is a considerable increase in speed. The authors also compared the model with and without fine-tuning the FC-layers and compared the same with the R-CNN, and their results are shown below.", "Note: The convolution layers were not fine-tuned, only the FC-layers.", "Note: We have discussed the object detection results on Pascal VOC 2007 dataset.", "Most of the key concepts from the paper have been discussed. However, I would recommend you read the paper, as they have provided a more detailed analysis in Classification as well as Detection Section.", "Understanding the SPP Layers makes it easier to learn the two-stage models build after this. I will be soon writing on the FastR-CNN paper. Stay tuned!!", "K. He, X Zhang, S. Ren, J Sun, Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition, ECCV, 2014", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I like reading and implementing the ideas researched in Computer Vision and Deep Learning papers. I post my notes on Medium."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F682d6d2bdfb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://parthdedhia.medium.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Parth Rajesh Dedhia"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69485e9d0ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=post_page-69485e9d0ea6----682d6d2bdfb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@sakulich?utm_source=medium&utm_medium=referral", "anchor_text": "Sergei Akulich"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition"}, {"url": "https://towardsdatascience.com/understanding-regions-with-cnn-features-r-cnn-ec69c15f8ea7", "anchor_text": "R-CNN network"}, {"url": "https://towardsdatascience.com/bag-of-visual-words-in-a-nutshell-9ceea97ce0fb", "anchor_text": "Bag of Words"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://www.youtube.com/watch?v=wGa6ddEXg7w&list=PL1GQaVhO4f_jLxOokW7CS5kY_J1t1T17S&index=72", "anchor_text": "SS from video"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "paper"}, {"url": "https://arxiv.org/pdf/1406.4729.pdf", "anchor_text": "Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----682d6d2bdfb---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/spp-net?source=post_page-----682d6d2bdfb---------------spp_net-----------------", "anchor_text": "Spp Net"}, {"url": "https://medium.com/tag/convolution-neural-net?source=post_page-----682d6d2bdfb---------------convolution_neural_net-----------------", "anchor_text": "Convolution Neural Net"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----682d6d2bdfb---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----682d6d2bdfb---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=-----682d6d2bdfb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=-----682d6d2bdfb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F682d6d2bdfb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----682d6d2bdfb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----682d6d2bdfb--------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://parthdedhia.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Parth Rajesh Dedhia"}, {"url": "https://parthdedhia.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "77 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F69485e9d0ea6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=post_page-69485e9d0ea6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F21fd8c4a6fae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-sppnet-for-object-detection-and-classification-682d6d2bdfb&newsletterV3=69485e9d0ea6&newsletterV3Id=21fd8c4a6fae&user=Parth+Rajesh+Dedhia&userId=69485e9d0ea6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}