{"url": "https://towardsdatascience.com/fastapi-aws-robust-api-part-1-f67ae47390f9", "time": 1683016288.82064, "path": "towardsdatascience.com/fastapi-aws-robust-api-part-1-f67ae47390f9/", "webpage": {"metadata": {"title": "FastAPI + AWS = robust API (Part 1) | by Anna Geller | Towards Data Science", "h1": "FastAPI + AWS = robust API (Part 1)", "description": "Let's build a scalable serverless Python-based REST API with FastAPI, AWS Lambda, and API Gateway. Since its inception, FastAPI has been adopted by large companies, such as Microsoft, Uber, and Netflix, and it\u2019s increasingly gaining popularity."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/fastapi-aws-secure-api-part-2-1123bff28b55", "anchor_text": "future article (Part 2)", "paragraph_index": 2}, {"url": "https://github.com/anna-anisienia/cryptoAPI", "anchor_text": "this Github repository", "paragraph_index": 4}, {"url": "https://stackoverflow.com/questions/57704237/multi-region-api-lambda-architecture-latency-issue", "anchor_text": "some extra latency", "paragraph_index": 10}, {"url": "https://towardsdatascience.com/fastapi-aws-secure-api-part-2-1123bff28b55", "anchor_text": "Part 2, we\u2019ll change it by creating an API key", "paragraph_index": 21}, {"url": "https://console.aws.amazon.com/support/v1#/case/create?issueType=service-limit-increase", "anchor_text": "Support Center console", "paragraph_index": 31}, {"url": "https://github.com/serverless/serverless", "anchor_text": "Serverless Framework", "paragraph_index": 39}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html", "anchor_text": "AWS SAM", "paragraph_index": 41}, {"url": "https://aws.amazon.com/lambda/pricing/", "anchor_text": "here", "paragraph_index": 44}, {"url": "https://aws.amazon.com/api-gateway/pricing/", "anchor_text": "here", "paragraph_index": 44}, {"url": "https://medium.com/@anna.anisienia", "anchor_text": "follow me", "paragraph_index": 48}, {"url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-set-up-simple-proxy.html", "anchor_text": "Lambda proxy integration", "paragraph_index": 49}, {"url": "https://www.1strategy.com/blog/2017/06/06/how-to-use-amazon-api-gateway-proxy/", "anchor_text": "How to use Amazon API Gateway {proxy+}", "paragraph_index": 50}, {"url": "http://www.annageller.com", "anchor_text": "www.annageller.com", "paragraph_index": 52}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe", "paragraph_index": 52}], "all_paragraphs": ["FastAPI revolutionized the way of developing modern Python-based REST APIs. Since its inception, the project has been adopted by large companies, such as Microsoft, Uber, and Netflix, and it\u2019s increasingly gaining popularity, what we can observe by the number of Github stars growing every day.", "Being able to build fast, robust, secure, and scalable APIs is a must-have skill for any backend (data) engineer. In this article, we\u2019ll build a simple REST API that will show the market sentiment and current prices of selected cryptocurrencies in a currency of your choice (euro, dollar, etc.).", "We\u2019ll use the top-down approach: from packaging and deploying the API to diving into details on what it is about. In Part 1, we\u2019ll deploy our FastAPI code to AWS by leveraging Amazon Lambda and API Gateway. In the future article (Part 2), we\u2019ll make sure to secure our API by using API keys. We\u2019ll also demonstrate how to enable distributed tracing and logging to track our application\u2019s health. Let\u2019s dive in!", "Let\u2019s start by creating a Project with a virtual environment in Pycharm. You can either use a Virtualenv or Conda \u2014 whichever you prefer. I usually use Virtualenv on macOS and Conda on Windows.", "If you want to follow along, this Github repository contains the code for this project.", "Let\u2019s change the current working directory to api folder and install the required packages:", "After having installed all package dependencies, we can start the Uvicorn ASGI server in our terminal:", "If you configured your virtual environment and downloaded (or cloned) the code from Github, you should be able to access the interactive Swagger UI from your browser:", "In order to make our API accessible from API Gateway, we need to:", "Note: this part requires that you installed and configured AWS CLI", "From the management console, make sure to choose the same region for your API in API Gateway as the one you selected for the Lambda function. Even though it\u2019s possible to have API Gateway and Lambda function in different regions, it could potentially lead to some extra latency.", "Then: Create API \u2192 Choose REST API (not the private one) \u2192 Build \u2192 enter the name for your API \u2192 Create API.", "Now we need to configure the integration point for our request methods. To use a Lambda function as our integration point for ANY type of request (i.e., GET, POST, PATCH, DELETE, etc.), we will create a Method (to handle the root path) and a child Resource (to handle all child paths). We will configure them to handle any requests made to API Gateway by using the Lambda proxy integration [1].", "When the pop-up window asks you whether you want to grant API Gateway permission to invoke your Lambda function, confirm. Without it, API Gateway will not be authorized to invoke your Lambda function.", "Similarly to the \u201cMethod\u201d configuration, go to Actions \u2192 Create Resource. Make sure to select the checkbox \u201cConfigure as proxy resource\u201d and keep the defaults to enable Lambda proxy integration (as before), then select your Lambda function and Save.", "Again, confirm that you allow API Gateway to invoke the Lambda function on behalf of your API requests:", "Since our Lambda is now configured, we can deploy the API. We can name it dev stage. The deployment is crucial to make the Lambda function integration active.", "Deploying your API to any deployment stage ensures that API Gateway creates a URL that serves as a front door to your API. You can click on this URL and test that the API has been properly configured.", "In your browser, you should see a response\u00a0corresponding\u00a0to\u00a0the\u00a0root\u00a0GET path\u00a0of\u00a0our\u00a0FastAPI\u00a0code:", "We can continue testing further endpoints directly from our browser:", "Side note: If the endpoint dev/v1/prices/ETH doesn\u2019t work for you, and you get a message {\"message\": \"Missing Authentication Token\"}, you should retry the creation of the Resource proxy and redeploy the API.", "Already at this point, we can see that our API is publicly accessible by anyone! In Part 2, we\u2019ll change it by creating an API key directly from the API Gateway console.", "By now, you may have many questions. I will try to guess and answer them in this Q&A form:", "1. How did we make the local FastAPI code work with Amazon Lambda?", "We used the Mangum library [5], which serves as a wrapper for ASGI APIs running inside of AWS Lambda and API Gateway. It provides an adapter, which:", "We only had to add two lines (line 1 and 7) to turn our FastAPI code within main.py to an Amazon Lambda handler:", "2. What is the difference between a Method and a Resource in API Gateway?", "The ANY Method will route requests to the root path / to the Lambda function that executes our FastAPI code. In contrast, the child Resource will route all paths below the root path / in a greedy mode (greedy path parameter: {proxy+}) [7], i.e., it will route all other endpoints defined in your FastAPI code to Lambda, for example, the path /v1/prices/BTC/.", "Using the proxy, we don\u2019t need to write any mapping templates that would route the specific paths to different Lambda functions - instead, we have a single Lambda function that serves all endpoints [6]. Then, API Gateway will route all types of requests (GET, POST, DELETE, PATCH, \u2026) from API Gateway to the paths defined within FastAPI code. And the FastAPI code gets executed inside of the Lambda function thanks to the Mangum adapter.", "4. How does this architecture scale?", "Each request made to API Gateway will invoke a Lambda function. This means that we can have thousands of parallel requests made to our API, as each will be served from a separate Lambda function invocation.", "Note that there are soft concurrency limits of how many parallel Lambda executions we can have per account (at the time of writing, 1000). If you need more than that, you can use the Support Center console to request an increase to this limit [2].", "5. Why is this architecture attractive?", "It provides a completely serverless API infrastructure with many benefits:", "6. Why did we use site-packages from the virtual environment to install package dependencies?", "We could have installed the libraries into some specific directory (ex. libs directory) by adding the flag -t, which stands for target:", "And then we could have added this directory to our lambda.zip.", "However, this way, we would clutter our project with Python packages that would have been installed into the project directory, and it could make it harder for other developers later to distinguish between the actual API code and its dependencies. We would likely have to add the libs directory to .gitignore. Overall, it would add extra work, which we don\u2019t need to do if we are working with a virtual environment and its site-packages.", "7. Could we have used the Serverless Framework or AWS SAM to create a deployment pipeline?", "Yes, this setup works well with Serverless Framework. Here is an example of how it could look like:", "However, I prefer to minimize dependencies in my project and serverless requires additional components such as the Node package manager.", "You can also use this setup with AWS SAM.", "8. How much does it costs?", "With the free tier, you get monthly (free) access to:", "Apart from that, the prices may vary depending on your AWS region and your number of requests (bulk discount), but they are in ranges of 1\u20134.25 dollars per one million requests (at the time of writing). Lambda is priced based on the number of invocations and how long your code is running, measured in milliseconds. You can find out more here and here.", "Finally, here is what the API is doing\u200a\u2014\u200aall functionality is based on information coming from CryptoCompare [4]:", "In this article, we discussed the process of deploying a REST API to AWS by leveraging FastAPI, API Gateway, and Amazon Lambda. Along the way, we learned how to package the code and create a deployment pipeline, and we discussed how all those microservice components work together.", "In Part 2 article, we\u2019ll continue building this API by adding authentication via API Keys, distributed logging and tracing, as well as how to redeploy the API once we made changes to our FastAPI code.", "If this article was useful, follow me to see my next articles.", "[6] About the Lambda proxy integration", "[7] How to use Amazon API Gateway {proxy+}", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "DevRel, Data Professional, Cloud & .py fan. www.annageller.com. Get my articles via email: https://annageller.medium.com/subscribe"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff67ae47390f9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://annageller.medium.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd----f67ae47390f9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/making-sense-of-big-data", "anchor_text": "Making Sense of Big Data"}, {"url": "https://www.pexels.com/@spencer-selover-142259?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Spencer Selover"}, {"url": "https://www.pexels.com/photo/adult-color-palette-colorful-colors-567452/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://towardsdatascience.com/fastapi-aws-secure-api-part-2-1123bff28b55", "anchor_text": "future article (Part 2)"}, {"url": "https://github.com/anna-anisienia/cryptoAPI", "anchor_text": "this Github repository"}, {"url": "https://stackoverflow.com/questions/57704237/multi-region-api-lambda-architecture-latency-issue", "anchor_text": "some extra latency"}, {"url": "https://towardsdatascience.com/fastapi-aws-secure-api-part-2-1123bff28b55", "anchor_text": "Part 2, we\u2019ll change it by creating an API key"}, {"url": "https://console.aws.amazon.com/support/v1#/case/create?issueType=service-limit-increase", "anchor_text": "Support Center console"}, {"url": "https://github.com/serverless/serverless", "anchor_text": "Serverless Framework"}, {"url": "https://github.com/jordaneremieff/serverless-mangum-examples/tree/main/fastapi-example", "anchor_text": "jordaneremieff/serverless-mangum-examplesYou can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or\u2026github.com"}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html", "anchor_text": "AWS SAM"}, {"url": "https://aws.amazon.com/lambda/pricing/", "anchor_text": "here"}, {"url": "https://aws.amazon.com/api-gateway/pricing/", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/fastapi-aws-secure-api-part-2-1123bff28b55", "anchor_text": "FastAPI + AWS = secure API (Part 2)Let\u2019s build a secure and observable Python REST API with FastAPI, AWS Lambda, API Gateway, CloudWatch, and AWS X-Raytowardsdatascience.com"}, {"url": "https://medium.com/@anna.anisienia", "anchor_text": "follow me"}, {"url": "https://www.deadbearcode.com/simple-serverless-fastapi-with-aws-lambda/", "anchor_text": "Blog by Sean Baier"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html", "anchor_text": "Amazon Lambda docs"}, {"url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html", "anchor_text": "API Gateway docs"}, {"url": "https://min-api.cryptocompare.com/documentation?key=Price&cat=SingleSymbolPriceEndpoint", "anchor_text": "CryptoCompare API docs"}, {"url": "https://mangum.io/", "anchor_text": "Mangum docs"}, {"url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-set-up-simple-proxy.html", "anchor_text": "Lambda proxy integration"}, {"url": "https://www.1strategy.com/blog/2017/06/06/how-to-use-amazon-api-gateway-proxy/", "anchor_text": "How to use Amazon API Gateway {proxy+}"}, {"url": "https://medium.com/tag/python?source=post_page-----f67ae47390f9---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----f67ae47390f9---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/aws?source=post_page-----f67ae47390f9---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f67ae47390f9---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/making-sense-of-big-data?source=post_page-----f67ae47390f9---------------making_sense_of_big_data-----------------", "anchor_text": "Making Sense Of Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&user=Anna+Geller&userId=5bdf5a3385cd&source=-----f67ae47390f9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&user=Anna+Geller&userId=5bdf5a3385cd&source=-----f67ae47390f9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff67ae47390f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f67ae47390f9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f67ae47390f9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f67ae47390f9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f67ae47390f9--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://annageller.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5.4K Followers"}, {"url": "http://www.annageller.com", "anchor_text": "www.annageller.com"}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F908ff40c4340&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffastapi-aws-robust-api-part-1-f67ae47390f9&newsletterV3=5bdf5a3385cd&newsletterV3Id=908ff40c4340&user=Anna+Geller&userId=5bdf5a3385cd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}