{"url": "https://towardsdatascience.com/building-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a", "time": 1683016945.153671, "path": "towardsdatascience.com/building-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a/", "webpage": {"metadata": {"title": "Building a Numerical Integration Tool in Python \u2014 From Scratch | by Kasper M\u00fcller | Towards Data Science", "h1": "Building a Numerical Integration Tool in Python \u2014 From Scratch", "description": "Not so long ago I was doing some research in analytic number theory. It was merely for my own sake at home in the evening. It was just a hobby project to satisfy my curiosity. At some point, I was\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/KRBM/numeric_integration", "anchor_text": "here", "paragraph_index": 38}], "all_paragraphs": ["Not so long ago I was doing some research in analytic number theory. It was merely for my own sake at home in the evening. It was just a hobby project to satisfy my curiosity.", "At some point, I was left with a nasty double integral and I wanted to check that what I had found was actually correct. To add some context for the interested reader, I was trying to find a formula for the number of twin primes below a given number using the prime counting function and some techniques from complex analysis\u2026 Phew!, now that that is out of the way, let\u2019s move on with the story.", "So what does one do when faced with such a problem involving a highly discontinuous function? Well, you fetch your laptop, a big cup of coffee and open up a code editor of some sort. In my case, my go-to programming language is Python, so I created an empty python file expecting this to take only 10 to 15 minutes.", "I was wrong! The reason? Well, building the custom functions needed such as detecting if a number is a prime, counting them with a loop and topping with some complex discontinuous functions was a breeze. The problem was when I wanted to integrate them.", "\u201cNormally, Python\u2019s scientific or data related libraries saves the day, but this time it failed me.\u201d", "Now, SciPy has a package (of course) for this sort of thing called quad. And that was why I initially thought that it was going to be easy. Normally, Python\u2019s scientific or data related libraries saves the day and are usually very nice to use, but this time it failed me. The problem was that my integrand (of my double integral) had a pole in the integration interval.", "Say you want to calculate the following integral:", "I actually tried this example and it didn\u2019t work. The function is perfectly finite in a neighborhood around zero but when I tried calculating it, I kept getting a value of nan. I immediately understood what was going on.", "SciPy is using something like Riemann sums or the Trapezoidal rule to calculate the integral and that requires the algorithm to divide the integration interval, into a lot of small intervals. Calculating the areas of the corresponding small rectangles requires it to calculate the function value of all these interval-endpoints\u200a\u2014\u200aone of them was (very close to) zero!", "And of course, trying to divide by zero in Python throws a ZeroDivisonError. As it turns out, according to SciPy\u2019s documentation at least, there should be some ways around it. One can, for example, specify known poles (which of course requires us to know the poles of the function which is not always the case), but again that didn\u2019t work on my double integral (even though it actually does work for the simple example above).", "The point of all of this introduction is the following:", "At this point, I was so frustrated, that I decided to build a tool myself.", "After realizing that I had to do this, I needed to go fetch some more coffee and think about a design for this tool. You can of course do this in many different ways. I went with the most lightweight approach because I believe that such a tool needs to adapt constantly to fit the user\u2019s needs.", "I decided to go for an object-oriented design choosing to build a class around the function to be integrated. I did this so that the user would be able to easily add more features to it in the future and to save meta-information about the calculation such as error intervals etc.", "Let\u2019s start with the basics. First of all, this program only really depends on Numpy. However, for convenience, we will import quad:", "If you don\u2019t have these packages installed, you can install them with", "or pip3 depending on your OS.", "For the code in this article to work, you need to run it with Python 3.", "A few comments are in order here. First, I record the error and you will see why in a moment. Second, we have a sign-attribute defined. This is because when the bounds of the integral swap, then so does the sign of the value and we need to be able to calculate integrals when the lower limit is greater than the upper\u00a0limit. This is of course just to show you how you could do this.", "And now for the main (single) integration method:", "I have used the trapezoidal rule here (if you don\u2019t remember, this is basically an average of left and right Riemann sums), but that is no surprise. You might wonder why I have a big try/except clause lying around. That is actually one of the main points. What it does is that if there should be a division by zero hiding in there, then it will be gracefully ignored without input from the user.", "We also see that we have stored the error if one wants to calculate by interval arithmetic or just check\u00a0how\u00a0accurate\u00a0the\u00a0result\u00a0is.", "That\u2019s all well, but how do we use our tool? Say we wanna integrate the function from our example above.", "This becomes easy now, despite the \u201c0/0\u201d expression when x = 0.", "But we are not done, remember? We have a double integral to solve, and no working tool for it yet.", "So we need to generalize this code to calculate a double integral, but first, let us make sure that we understand the possible errors that we might get. To do that, we need to build a custom error class in Python. This is easy, we just inherit from Exception:", "Moreover, since the input intervals should now be a parameter of type list of lists (or something like that), a possible solution is the following:", "Note! This is by no means performance code, and if we wanted, we could optimize this with e.g. vectorization in Numpy.", "That being said, you can adjust the precision parameter to fit your needs. The higher the value, the more accurate the integral is going to be, but the longer it will take to compute. That\u2019s where the error attribute comes in. You can try as an exercise to optimize this code!", "If we wanted, we could of course generalize this to triple integrals, etc. but for the scope of this article, let\u2019s stick to single and double ones.", "So let me show you how this works in action.", "Say you are working on a project in Python and all of a sudden, you come across the problem of approximating the following integral:", "Well, you now have the tool for the job. At the top of your file, import your new integral engine", "Further down in the project you can now solve it.", "This is pretty d\u2026 close! To compare against the real deal, the true beginning of pi is 3.141592653589793238\u2026 and our error range of course told us exactly that\u2014 namely, that we got the first 14 digits right (At least within our limits of integration \u2014 we need to be a little careful in our example because technically we are missing the \u201ctails\u201d of the function). Of course, increasing the precision parameter, or the limits of the integral for that matter, would give us even more digits right.", "But here\u2019s the important take away:", "Even though the double integral above should be calculated over the entire real plane, we can make sure that within our interval we can get arbitrarily close to the true value \u2014 and we can check that because of our error attribute. So it is a matter of exchanging accuracy for runtime.", "Now I can get back to my work and hopefully, if you encounter some issues in this direction yourself or if you just want to learn more Python, please do not hesitate to use or extend this code.", "You can clone the full repository here.", "After 7 cups of coffee, I can now go to sleep with ease of mind. I only hope that I am not gonna be chased by mad Riemann sums in my dreams.", "Oh.. what about integrating with polar coordinates?\u2026", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Mathematician, programmer and writer interested in the mysteries of the Universe, fascinated by the human mind, music and things that I don\u2019t understand."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa8185449b70a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://kaspermuller.medium.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": ""}, {"url": "https://kaspermuller.medium.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Kasper M\u00fcller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F877b7991f678&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&user=Kasper+M%C3%BCller&userId=877b7991f678&source=post_page-877b7991f678----a8185449b70a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@cdr6934?utm_source=medium&utm_medium=referral", "anchor_text": "Chris Ried"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/KRBM/numeric_integration", "anchor_text": "here"}, {"url": "https://medium.com/tag/mathematics?source=post_page-----a8185449b70a---------------mathematics-----------------", "anchor_text": "Mathematics"}, {"url": "https://medium.com/tag/python?source=post_page-----a8185449b70a---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/programming?source=post_page-----a8185449b70a---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/math?source=post_page-----a8185449b70a---------------math-----------------", "anchor_text": "Math"}, {"url": "https://medium.com/tag/science?source=post_page-----a8185449b70a---------------science-----------------", "anchor_text": "Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&user=Kasper+M%C3%BCller&userId=877b7991f678&source=-----a8185449b70a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&user=Kasper+M%C3%BCller&userId=877b7991f678&source=-----a8185449b70a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa8185449b70a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a8185449b70a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a8185449b70a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a8185449b70a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a8185449b70a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a8185449b70a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a8185449b70a--------------------------------", "anchor_text": ""}, {"url": "https://kaspermuller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://kaspermuller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kasper M\u00fcller"}, {"url": "https://kaspermuller.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "31K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F877b7991f678&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&user=Kasper+M%C3%BCller&userId=877b7991f678&source=post_page-877b7991f678--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3d89a6c8e677&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-numerical-integration-tool-in-python-from-scratch-a8185449b70a&newsletterV3=877b7991f678&newsletterV3Id=3d89a6c8e677&user=Kasper+M%C3%BCller&userId=877b7991f678&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}