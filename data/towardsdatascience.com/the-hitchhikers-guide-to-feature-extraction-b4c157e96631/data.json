{"url": "https://towardsdatascience.com/the-hitchhikers-guide-to-feature-extraction-b4c157e96631", "time": 1682996295.981868, "path": "towardsdatascience.com/the-hitchhikers-guide-to-feature-extraction-b4c157e96631/", "webpage": {"metadata": {"title": "The Hitchhiker\u2019s Guide to Feature Extraction | by Rahul Agarwal | Towards Data Science", "h1": "The Hitchhiker\u2019s Guide to Feature Extraction", "description": "TLDR; this post is about useful feature engineering methods and tricks that I have learned and end up using often. Featuretools is a framework to perform automated feature engineering. It excels at\u2026"}, "outgoing_paragraph_urls": [{"url": "https://amzn.to/2Y4kd9Z", "anchor_text": "feature engineering", "paragraph_index": 3}, {"url": "https://www.kaggle.com/c/nyc-taxi-trip-duration/data", "anchor_text": "New York City Taxi Trip Duration", "paragraph_index": 55}, {"url": "https://www.kaggle.com/gaborfodor/from-eda-to-the-top-lb-0-368", "anchor_text": "Kernel", "paragraph_index": 56}, {"url": "https://amzn.to/2Lv2hU0", "anchor_text": "deep learning", "paragraph_index": 66}, {"url": "https://www.kaggle.com/c/walmart-recruiting-trip-type-classification/", "anchor_text": "Kaggle", "paragraph_index": 71}, {"url": "https://amzn.to/2Y4kd9Z", "anchor_text": "feature engineering", "paragraph_index": 81}, {"url": "https://medium.com/me/stats/post/1c04f41944a1", "anchor_text": "parallelize your Pandas function", "paragraph_index": 84}, {"url": "https://www.kaggle.com/mlwhiz/feature-creation/", "anchor_text": "Kaggle Kernel", "paragraph_index": 86}, {"url": "https://coursera.pxf.io/5bDx3b", "anchor_text": "Advanced Machine Learning on Google Cloud Specialization", "paragraph_index": 87}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium", "paragraph_index": 88}, {"url": "https://mlwhiz.ck.page/a9b8bda70c", "anchor_text": "blog", "paragraph_index": 88}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz", "paragraph_index": 88}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 90}], "all_paragraphs": ["Good Features are the backbone of any machine learning model.", "And good feature creation often needs domain knowledge, creativity, and lots of time.", "In this post, I am going to talk about:", "TLDR; this post is about useful feature engineering methods and tricks that I have learned and end up using often.", "Have you read about featuretools yet? If not, then you are going to be delighted.", "Featuretools is a framework to perform automated feature engineering. It excels at transforming temporal and relational datasets into feature matrices for machine learning.", "How? Let us work with a toy example to show you the power of featuretools.", "Let us say that we have three tables in our database: Customers, Sessions, and Transactions.", "This is a reasonably good toy dataset to work on since it has time-based columns as well as categorical and numerical columns.", "If we were to create features on this data, we would need to do a lot of merging and aggregations using Pandas.", "Featuretools makes it so easy for us. Though there are a few things, we will need to learn before our life gets easier.", "You can understand an entityset as a bucket for dataframes as well as relationships between them.", "So without further ado, let us create an empty entityset. I just gave the name as customers. You can use any name here. It is just an empty bucket right now.", "Let us add our dataframes to it. The order of adding dataframes is not important. To add a dataframe to an existing entityset, we do the below operation.", "So here are a few things we did here to add our dataframe to the empty entityset bucket.", "This is how our entityset bucket looks right now. It has just got one dataframe in it. And no relationships", "Let us add all our dataframes:", "This is how our entityset buckets look now.", "All three dataframes but no relationships. By relationships, I mean that my bucket doesn\u2019t know that customer_id in customers_df and session_df are the same columns.", "We can provide this information to our entityset as:", "After this our entityset looks like:", "We can see the datasets as well as the relationships. Most of our work here is done. We are ready to cook features.", "Creating features is as simple as:", "And we end up with 73 new features. You can see the feature names from feature_defs. Some of the features that we end up creating are:", "You can get features like the Sum of std of amount(SUM(sessions.STD(transactions.amount))) or std of the sum of amount(STD(sessions.SUM(transactions.amount))) This is what max_depth parameter means in the function call. Here we specify it as 2 to get two level aggregations.", "If we change max_depth to 3 we can get features like: MAX(sessions.NUM_UNIQUE(transactions.YEAR(transaction_time)))", "Just think of how much time you would have to spend if you had to write code to get such features. Also, a caveat is that increasing the max_depth might take longer times.", "Creating automated features has its perks. But why would we data scientists be required if a simple library could do all our work?", "This is the section where I will talk about handling categorical features.", "We can use One hot encoding to encode our categorical features. So if we have n levels in a category, we will get n-1 features.", "In our sessions_df table, we have a column named device, which contains three levels \u2014 desktop, mobile, or tablet. We can get two columns from such a column using:", "This is the most natural thing that comes to mind when talking about categorical features and works well in many cases.", "Sometimes there is an order associated with categories. In such a case, I usually use a simple map/apply function in pandas to create a new ordinal column.", "For example, if I had a dataframe containing temperature as three levels: high medium and low, I would encode that as:", "Using this I preserve the information that low<medium<high", "We could also have used LabelEncoder to encode our variable to numbers. What a label encoder essentially does is that it sees the first value in the column and converts it to 0, next value to 1 and so on. This approach works reasonably well with tree models, and I end up using it when I have a lot of levels in the categorical variable. We can use this as:", "BinaryEncoder is another method that one can use to encode categorical variables. It is an excellent method to use if you have many levels in a column. While we can encode a column with 1024 levels using 1023 columns using One Hot Encoding, using Binary encoding we can do it by just using ten columns.", "Let us say we have a column in our FIFA 19 player data that contains all club names. This column has 652 unique values. One Hot encoding means creating 651 columns that would mean a lot of memory usage and a lot of sparse columns.", "We can binaryEncode this variable easily by using BinaryEncoder object from category_encoders:", "One can think of Hashing Encoder as a black box function that converts a string to a number between 0 to some prespecified value.", "It differs from binary encoding as in binary encoding two or more of the club parameters could have been 1 while in hashing only one value is 1.", "There are bound to be collisions(two clubs having the same encoding. For example, Juventus and PSG have the same encoding) but sometimes this technique works well.", "This is a technique that I found works pretty well in Kaggle competitions. If both training/test comes from the same dataset from the same time period(cross-sectional), we can get crafty with features.", "For example: In the Titanic knowledge challenge, the test data is randomly sampled from the train data. In this case, we can use the target variable averaged over different categorical variable as a feature.", "In Titanic, we can create a target encoded feature over the PassengerClass variable.", "We have to be careful when using Target encoding as it might induce overfitting in our models. Thus we use k-fold target encoding when we use it.", "We can then create a mean encoded feature as:", "You can see how the passenger class 3 gets encoded as 0.261538 and 0.230570 based on which fold the average is taken from.", "This feature is pretty helpful as it encodes the value of the target for the category. Just looking at this feature, we can say that the Passenger in class 1 has a high propensity of surviving compared with Class 3.", "While not necessarily feature creation techniques, some postprocessing techniques that you may find useful.", "Something that I learned in the Neural Network course by Jeremy Howard. It is based on an elementary Idea.", "Log loss penalizes us a lot if we are very confident and wrong.", "So in the case of Classification problems where we have to predict probabilities in Kaggle, it would be much better to clip our probabilities between 0.05\u20130.95 so that we are never very sure about our prediction. And in turn, get penalized less. Can be done by a simple np.clip", "A small piece of code that will help you save countless hours of uploading. Enjoy.", "This part will tread upon how to use Latitude and Longitude features well.", "For this task, I will be using Data from the Playground competition: New York City Taxi Trip Duration", "Most of the functions I am going to write here are inspired by a Kernel on Kaggle written by Beluga.", "In this competition, we had to predict the trip duration. We were given many features in which Latitude and Longitude of pickup and Dropoff were also there. We created features like:", "The haversine formula determines the great-circle distance between two points on a sphere given their longitudes and latitudes", "We could then use the function as:", "The distance between two points measured along axes at right angles", "We could then use the function as:", "A bearing is used to represent the direction of one point relative to another point.", "We could then use the function as:", "These are the new columns that we create:", "Sometimes people use Autoencoders too for creating automatic features.", "Encoders are deep learning functions which approximate a mapping from X to X, i.e. input=output. They first compress the input features into a lower-dimensional representation and then reconstruct the output from this representation.", "We can use this representation vector as a feature for our models.", "Or in our case trip duration. Below is the graph of trip duration without log transformation.", "A log transformation on trip duration is much less skewed and thus much more helpful for a model.", "One could create additional Date time features based on domain knowledge and intuition. For example, Time-based Features like \u201cEvening,\u201d \u201cNoon,\u201d \u201cNight,\u201d \u201cPurchases_last_month,\u201d \u201cPurchases_last_week,\u201d etc. could work for a particular application.", "Suppose you have got some shopping cart data and you want to categorize the TripType. It was the exact problem in Walmart Recruiting: Trip Type Classification on Kaggle.", "Some examples of trip types: a customer may make a small daily dinner trip, a weekly large grocery trip, a trip to buy gifts for an upcoming holiday, or a seasonal trip to buy clothes.", "To solve this problem, you could think of creating a feature like \u201cStylish\u201d where you create this variable by adding together the number of items that belong to category Men\u2019s Fashion, Women\u2019s Fashion, Teens Fashion.", "Or you could create a feature like \u201cRare\u201d which is created by tagging some items as rare, based on the data we have and then counting the number of those rare items in the shopping cart.", "Such features might work or might not work. From what I have observed, they usually provide a lot of value.", "I feel this is the way that Target\u2019s \u201cPregnant Teen model\u201d was made. They would have had a variable in which they kept all the items that a pregnant teen could buy and put them into a classification algorithm.", "If you have features A and B, you can create features A*B, A+B, A/B, A-B, etc.", "For example, to predict the price of a house, if we have two features length and breadth, a better idea would be to create an area(length x breadth) feature.", "Or in some case, a ratio might be more valuable than having two features alone. Example: Credit Card utilization ratio is more valuable than having the Credit limit and limit utilized variables.", "These were just some of the methods I use for creating features.", "But there is surely no limit when it comes to feature engineering, and it is only your imagination that limits you.", "On that note, I always think about feature engineering while keeping what model I am going to use in mind. Features that work in a random forest may not work well with Logistic Regression.", "Feature creation is the territory of trial and error. You won\u2019t be able to know what transformation works or what encoding works best before trying it. It is always a trade-off between time and utility.", "Sometimes the feature creation process might take a lot of time. In such cases, you might want to parallelize your Pandas function.", "While I have tried to keep this post as exhaustive as possible(This might very well be my biggest post on medium yet), I might have missed some of the useful methods. Let me know about them in the comments.", "You can find all the code for this post and run it yourself in this Kaggle Kernel", "Take a look at the Advanced Machine Learning on Google Cloud Specialization. This course talks about deploy and productionizing your models. Definitely recommended.", "I am going to be writing more beginner friendly posts in the future too. Let me know what you think about the series. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb4c157e96631&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----b4c157e96631---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://amzn.to/2Y4kd9Z", "anchor_text": "feature engineering"}, {"url": "https://www.kaggle.com/c/nyc-taxi-trip-duration/data", "anchor_text": "New York City Taxi Trip Duration"}, {"url": "https://www.kaggle.com/gaborfodor/from-eda-to-the-top-lb-0-368", "anchor_text": "Kernel"}, {"url": "https://amzn.to/2Lv2hU0", "anchor_text": "deep learning"}, {"url": "https://www.kaggle.com/c/walmart-recruiting-trip-type-classification/", "anchor_text": "Kaggle"}, {"url": "https://amzn.to/2Y4kd9Z", "anchor_text": "feature engineering"}, {"url": "https://medium.com/me/stats/post/1c04f41944a1", "anchor_text": "parallelize your Pandas function"}, {"url": "https://www.kaggle.com/mlwhiz/feature-creation/", "anchor_text": "Kaggle Kernel"}, {"url": "https://coursera.pxf.io/5bDx3b", "anchor_text": "Advanced Machine Learning on Google Cloud Specialization"}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium"}, {"url": "https://mlwhiz.ck.page/a9b8bda70c", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----b4c157e96631---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b4c157e96631---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----b4c157e96631---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----b4c157e96631---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----b4c157e96631---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----b4c157e96631---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----b4c157e96631---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb4c157e96631&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b4c157e96631---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b4c157e96631--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b4c157e96631--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b4c157e96631--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b4c157e96631--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b4c157e96631--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-hitchhikers-guide-to-feature-extraction-b4c157e96631&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}