{"url": "https://towardsdatascience.com/apache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96", "time": 1683013494.145511, "path": "towardsdatascience.com/apache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96/", "webpage": {"metadata": {"title": "Apache/Airflow and PostgreSQL with Docker and Docker Compose | by Ivan Rezic | Towards Data Science", "h1": "Apache/Airflow and PostgreSQL with Docker and Docker Compose", "description": "Hello, in this post I will show you how to set up official Apache/Airflow with PostgreSQL and LocalExecutor using docker and docker-compose. In this post, I won\u2019t be going through Airflow, what it\u2026"}, "outgoing_paragraph_urls": [{"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "the official documentation", "paragraph_index": 0}, {"url": "https://docs.docker.com/get-docker/", "anchor_text": "Docker", "paragraph_index": 1}, {"url": "https://docs.docker.com/compose/install/", "anchor_text": "Docker Compose", "paragraph_index": 1}, {"url": "http://localhost:8080/", "anchor_text": "localhost:8080", "paragraph_index": 5}, {"url": "https://docs.docker.com/compose/compose-file/", "anchor_text": "here", "paragraph_index": 9}, {"url": "http://linkedin.com/in/ivanrezic", "anchor_text": "linkedin.com/in/ivanrezic", "paragraph_index": 24}], "all_paragraphs": ["Hello, in this post I will show you how to set up official Apache/Airflow with PostgreSQL and LocalExecutor using docker and docker-compose. In this post, I won\u2019t be going through Airflow, what it is, and how it is used. Please check the official documentation for more information about that.", "Before setting up and running Apache Airflow, please install Docker and Docker Compose.", "In this chapter, I will show you files and directories which are needed to run airflow and in the next chapter, I will go file by file, line by line explaining what is going on.", "Firstly, in the root directory create three more directories: dags, logs, and scripts. Further, create following files: .env, docker-compose.yml, entrypoint.sh and dummy_dag.py. Please make sure those files and directories follow the structure below.", "Created files should contain the following:", "Positioning in the root directory and executing \u201cdocker-compose up\u201d in the terminal should make airflow accessible on localhost:8080. Image bellow shows the final result.", "If you encounter permission errors, please run \u201cchmod -R 777\u201d on all subdirectories, e.g. \u201cchmod -R 777 logs/\u201d", "In Leyman\u2019s terms, docker is used when managing individual containers and docker-compose can be used to manage multi-container applications. It also moves many of the options you would enter on the docker run into the docker-compose.yml file for easier reuse. It works as a front end \"script\" on top of the same docker API used by docker. You can do everything docker-compose does with docker commands and a lot of shell scripting.", "Before running our multi-container docker applications, docker-compose.yml must be configured. With that file, we define services that will be run on docker-compose up.", "The first attribute of docker-compose.yml is version, which is the compose file format version. For the most recent version of file format and all configuration options click here.", "Second attribute is services and all attributes one level bellow services denote containers used in our multi-container application. These are postgres, scheduler and webserver. Each container has image attribute which points to base image used for that service.", "For each service, we define environment variables used inside service containers. For postgres it is defined by environment attribute, but for scheduler and webserver it is defined by .env file. Because .env is an external file we must point to it with env_file attribute.", "By opening .env file we can see two variables defined. One defines executor which will be used and the other denotes connection string. Each connection string must be defined in the following manner:", "Dialect names include the identifying name of the SQLAlchemy dialect, a name such as sqlite, mysql, postgresql, oracle, or mssql. Driver is the name of the DBAPI to be used to connect to the database using all lowercase letters. In our case, connection string is defined by:", "Omitting port after host part denotes that we will be using default postgres port defined in its own Dockerfile.", "Every service can define command which will be run inside Docker container. If one service needs to execute multiple commands it can be done by defining an optional .sh file and pointing to it with entrypoint attribute. In our case we have entrypoint.sh inside the scripts folder which once executed, runs airflow initdb and airflow webserver. Both are mandatory for airflow to run properly.", "Defining depends_on attribute, we can express dependency between services. In our example, webserver starts only if both scheduler and postgres have started, also the scheduler only starts after postgres have started.", "In case our container crashes, we can restart it by restart_policy. The restart_policy configures if and how to restart containers when they exit. Additional options are condition, delay, max_attempts, and window.", "Once service is running, it is being served on containers defined port. To access that service we need to expose the containers port to the host's port. That is being done by ports attribute. In our case, we are exposing port 8080 of the container to TCP port 8080 on 127.0.0.1 (localhost) of the host machine. Left side of : defines host machines port and the right-hand side defines containers port.", "Lastly, the volumes attribute defines shared volumes (directories) between host file system and docker container. Because airflows default working directory is /opt/airflow/ we need to point our designated volumes from the root folder to the airflow containers working directory. Such is done by the following command:", "This way, when the scheduler or webserver writes logs to its logs directory we can access it from our file system within the logs directory. When we add a new dag to the dags folder it will automatically be added in the containers dag bag and so on.", "That's it for today, thank you for reading this story, I will be posting more soon. If you notice any mistakes, please let me know.", "EDIT: \u201cdeploy:\u201d is needed before \u201crestart_policy:\u201d as suggested by comments", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019m Berlin based Data Engineer. I enjoy learning and teaching others. For more information about me, please visit linkedin.com/in/ivanrezic."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5651766dfa96&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5651766dfa96--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ivanrezic?source=post_page-----5651766dfa96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivanrezic?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Ivan Rezic"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7d04f7042f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&user=Ivan+Rezic&userId=a7d04f7042f2&source=post_page-a7d04f7042f2----5651766dfa96---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@r3dmax?utm_source=medium&utm_medium=referral", "anchor_text": "Jonatan Pie"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "the official documentation"}, {"url": "https://docs.docker.com/get-docker/", "anchor_text": "Docker"}, {"url": "https://docs.docker.com/compose/install/", "anchor_text": "Docker Compose"}, {"url": "http://localhost:8080/", "anchor_text": "localhost:8080"}, {"url": "https://docs.docker.com/compose/compose-file/", "anchor_text": "here"}, {"url": "https://medium.com/tag/apache-airflow?source=post_page-----5651766dfa96---------------apache_airflow-----------------", "anchor_text": "Apache Airflow"}, {"url": "https://medium.com/tag/docker?source=post_page-----5651766dfa96---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/docker-compose?source=post_page-----5651766dfa96---------------docker_compose-----------------", "anchor_text": "Docker Compose"}, {"url": "https://medium.com/tag/postgresql?source=post_page-----5651766dfa96---------------postgresql-----------------", "anchor_text": "Postgresql"}, {"url": "https://medium.com/tag/how-to?source=post_page-----5651766dfa96---------------how_to-----------------", "anchor_text": "How To"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&user=Ivan+Rezic&userId=a7d04f7042f2&source=-----5651766dfa96---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&user=Ivan+Rezic&userId=a7d04f7042f2&source=-----5651766dfa96---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5651766dfa96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5651766dfa96---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5651766dfa96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5651766dfa96--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5651766dfa96--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5651766dfa96--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5651766dfa96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivanrezic?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ivanrezic?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ivan Rezic"}, {"url": "https://medium.com/@ivanrezic/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "23 Followers"}, {"url": "http://linkedin.com/in/ivanrezic", "anchor_text": "linkedin.com/in/ivanrezic"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7d04f7042f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&user=Ivan+Rezic&userId=a7d04f7042f2&source=post_page-a7d04f7042f2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa935d6b80cd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-airflow-and-postgresql-with-docker-and-docker-compose-5651766dfa96&newsletterV3=a7d04f7042f2&newsletterV3Id=a935d6b80cd5&user=Ivan+Rezic&userId=a7d04f7042f2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}