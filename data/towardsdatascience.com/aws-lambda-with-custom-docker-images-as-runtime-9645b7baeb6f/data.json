{"url": "https://towardsdatascience.com/aws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f", "time": 1683017193.056053, "path": "towardsdatascience.com/aws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f/", "webpage": {"metadata": {"title": "AWS Lambda with custom docker images as runtime | by Philipp Schmid | Towards Data Science", "h1": "AWS Lambda with custom docker images as runtime", "description": "It\u2019s the most wonderful time of the year. Of course, I\u2019m not talking about Christmas but re:Invent. It is re:Invent time. Due to the current situation in the world, re:Invent does not take place like\u2026"}, "outgoing_paragraph_urls": [{"url": "https://virtual.awsevents.com/", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://aws.amazon.com/de/blogs/aws/new-for-aws-lambda-functions-with-up-to-10-gb-of-memory-and-6-vcpus/?nc1=b_rp", "anchor_text": "10 GB of Memory and 6 vCPUs", "paragraph_index": 2}, {"url": "https://aws.amazon.com/de/blogs/aws/new-for-aws-lambda-container-image-support/?nc1=b_rp", "anchor_text": "their blog", "paragraph_index": 3}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "AWS Lambda", "paragraph_index": 5}, {"url": "https://aws.amazon.com/ecr/?nc1=h_ls", "anchor_text": "Amazon Elastic Container Registry (ECR)", "paragraph_index": 6}, {"url": "https://aws.amazon.com/serverless/sam/", "anchor_text": "AWS Serverless Application Model (SAM)", "paragraph_index": 7}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "Github repository.", "paragraph_index": 10}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-linux.html", "anchor_text": "5 step guide on how to install", "paragraph_index": 11}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-linux.html", "anchor_text": "link", "paragraph_index": 11}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html", "anchor_text": "here", "paragraph_index": 30}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "GitHub repository", "paragraph_index": 41}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "here.", "paragraph_index": 41}, {"url": "https://twitter.com/_philschmid", "anchor_text": "Twitter", "paragraph_index": 42}, {"url": "https://www.linkedin.com/in/philipp-schmid-a6a2bb196/", "anchor_text": "LinkedIn", "paragraph_index": 42}], "all_paragraphs": ["It\u2019s the most wonderful time of the year. Of course, I\u2019m not talking about Christmas but re:Invent. It is re:Invent time. Due to the current situation in the world, re:Invent does not take place like every year in Las Vegas but is entirely virtual and for free. This means that it is possible for everyone to attend. In addition to this, this year it lasts 3 weeks from 30.11.2020 to 18.12.2020. If you haven\u00b4t already registered do it here.", "In the opening keynote, Andy Jassy presented the AWS Lambda Container Support, which allows you to use custom container (docker) images as a runtime for AWS Lambda. With that, we can build runtimes larger than the previous 250 MB limit, be it for \u201cState-of-the-Art\u201d NLP APIs with BERT or complex processing.", "Furthermore, you can now configure AWS Lambda functions with up to 10 GB of Memory and 6 vCPUs.", "In their blog post, Amazon explains how to use containers as a runtime for AWS lambda via the console.", "But the blog post does not explain how to use custom docker images with the Serverless Application Model. For these circumstances, I created this blog post.", "AWS Lambda is a serverless computing service that lets you run code without managing servers. It executes your code only when required and scales automatically, from a few requests per day to thousands per second.", "Amazon Elastic Container Registry (ECR) is a fully managed container registry. It allows us to store, manage, share docker container images. You can share docker containers privately within your organization or publicly worldwide for anyone.", "The AWS Serverless Application Model (SAM) is an open-source framework and CLI to build serverless applications on AWS. You define the application you want using yaml format. Afterwards, you build, test, and deploy using the SAM CLI.", "We are going to build an AWS Lambda with a docker container as runtime using the \"AWS Serverless Application Model\". We create a new custom docker image using the presented Lambda Runtime API images.", "What are we going to do:", "You can find the complete code in this Github repository.", "AWS provides a 5 step guide on how to installsam. In this tutorial, we are going to skip steps 1-3 and assume you already have an AWS Account, an IAM user with the correct permission set up, and docker installed and setup otherwise check out this link. The easiest way is to create an IAM user with AdministratorAccess (but I don\u00b4t recommend this for production use cases).", "We are going to continue with step 4 \u201cinstalling Homebrew\u201d. To install homebrew we run the following command in our terminal.", "Note: Linux Users have to add Homebrew to your PATH by running the following commands.", "Afterwards we can run brew --version to verify that Homebrew is installed.", "The fifth and last step is to install sam using homebrew. We can install the SAM CLI using brew install.", "After we installed it we have to make sure we have atleast version 1.13.0 installed.", "To update sam if you have it installed you can run brew upgrade aws-sam-cli.", "After the setup, we are going to build a custom python docker image.", "We create a app.py file and paste the following code into it.", "To containerize our Lambda Function, we create a dockerfile in the same directory and copy the following content.", "Additionally, we can add a .dockerignore file to exclude files from your container image.", "To build our custom docker image we run", "and then to test it and run it locally we run the following command.", "Afterwards, in a separate terminal, we can then locally invoke the function using curl.", "Since we now have a local docker image we can deploy this to ECR. Therefore we need to create an ECR repository with the name docker-lambda.", "To be able to push our images we need to login to ECR. We run an output ($()) from the command we retrieve from ecr get-login. (Yes, the $ is intended).", "Next, we need to tag / rename our previously created image to an ECR format. The format for this is{AccountID}.dkr.ecr.{region}.amazonaws.com/{repository-name}", "To check if it worked we can run docker images and should see an image with our tag as the name.", "Finally, we push the image to ECR Registry.", "Now, we can create our template.yaml to define our lambda function using our docker image. In the template.yaml we include the configuration for our AWS Lambda function. I provide the complete template.yamlfor this example, but we go through all the details we need for our docker image and leave out all standard configurations. If you want to learn more about the sam template.yaml, you can read through the documentation here.", "To use a docker image in our template.yaml we have to include the parameters ImageUri and PackageType in our AWS::Serverless::Function resource. The ImageUri, as the name suggests is the URL to our docker image. For an ECR image, the URL looks like this 123456789.dkr.ecr.us-east-1.amazonaws.com/myimage:latest, and for a public docker image like that namespace/image:tag or docker.io/namespace/image:tag.", "PackageType defines the type we provide to our AWS Lambda function, in our case an Image.", "Afterwards, we can deploy our application again using sam deploy and thats it.", "The Guided deployment will walk through all required parameters and will create a samconfig.toml afterwards for us.", "After the successful deployment, we should see something like this.", "We take the URL from our API Gateway from the Outputs section and use any REST Client to test it.", "We successfully deployed and created an AWS Lambda function with a custom docker image as runtime.", "The release of the AWS Lambda Container Support enables much wider use of AWS Lambda and Serverless. It fixes many existing problems and gives us greater scope for the deployment of serverless applications.", "Another area in which I see great potential is machine learning, as the custom runtime enables us to include larger machine learning models in our runtimes. The increase of configurable Memory and vCPUs boost this even more.", "The future looks more than golden for AWS Lambda and Serverless.", "You can find the GitHub repository with the complete code here.", "Thanks for reading. If you have any questions, feel free to contact me or comment on this article. You can also connect with me on Twitter or LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9645b7baeb6f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@schmidphilipp1995?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schmidphilipp1995?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Philipp Schmid"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb5f02a773f45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&user=Philipp+Schmid&userId=b5f02a773f45&source=post_page-b5f02a773f45----9645b7baeb6f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@hdbernd?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Bernd Dittrich"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.philschmid.de/aws-lambda-with-custom-docker-image", "anchor_text": "https://www.philschmid.de"}, {"url": "https://virtual.awsevents.com/", "anchor_text": "here"}, {"url": "https://aws.amazon.com/de/blogs/aws/new-for-aws-lambda-functions-with-up-to-10-gb-of-memory-and-6-vcpus/?nc1=b_rp", "anchor_text": "10 GB of Memory and 6 vCPUs"}, {"url": "https://aws.amazon.com/de/blogs/aws/new-for-aws-lambda-container-image-support/?nc1=b_rp", "anchor_text": "their blog"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "AWS Lambda"}, {"url": "https://aws.amazon.com/ecr/?nc1=h_ls", "anchor_text": "Amazon Elastic Container Registry (ECR)"}, {"url": "https://aws.amazon.com/serverless/sam/", "anchor_text": "AWS Serverless Application Model (SAM)"}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "Github repository."}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-linux.html", "anchor_text": "5 step guide on how to install"}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install-linux.html", "anchor_text": "link"}, {"url": "https://github.com/aws/containers-roadmap/issues/735", "anchor_text": "here"}, {"url": "https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html", "anchor_text": "here"}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "GitHub repository"}, {"url": "https://github.com/philschmid/aws-lambda-with-docker-image", "anchor_text": "here."}, {"url": "https://twitter.com/_philschmid", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/philipp-schmid-a6a2bb196/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/aws?source=post_page-----9645b7baeb6f---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----9645b7baeb6f---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/tag/serverless?source=post_page-----9645b7baeb6f---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/cloud?source=post_page-----9645b7baeb6f---------------cloud-----------------", "anchor_text": "Cloud"}, {"url": "https://medium.com/tag/docker?source=post_page-----9645b7baeb6f---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&user=Philipp+Schmid&userId=b5f02a773f45&source=-----9645b7baeb6f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&user=Philipp+Schmid&userId=b5f02a773f45&source=-----9645b7baeb6f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9645b7baeb6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9645b7baeb6f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9645b7baeb6f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schmidphilipp1995?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schmidphilipp1995?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Philipp Schmid"}, {"url": "https://medium.com/@schmidphilipp1995/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "229 Followers"}, {"url": "https://twitter.com/_philschmid", "anchor_text": "https://twitter.com/_philschmid"}, {"url": "https://www.philschmid.de", "anchor_text": "https://www.philschmid.de"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb5f02a773f45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&user=Philipp+Schmid&userId=b5f02a773f45&source=post_page-b5f02a773f45--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9c9055b110ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-with-custom-docker-images-as-runtime-9645b7baeb6f&newsletterV3=b5f02a773f45&newsletterV3Id=9c9055b110ca&user=Philipp+Schmid&userId=b5f02a773f45&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}