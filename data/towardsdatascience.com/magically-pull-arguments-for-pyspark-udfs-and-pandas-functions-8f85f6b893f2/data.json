{"url": "https://towardsdatascience.com/magically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2", "time": 1683004385.507711, "path": "towardsdatascience.com/magically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2/", "webpage": {"metadata": {"title": "Magically Pull Arguments for PySpark UDFs and Pandas Functions | by Dan VanLunen (DVL) | Towards Data Science", "h1": "Magically Pull Arguments for PySpark UDFs and Pandas Functions", "description": "PySpark User-Defined Functions (UDFs) allow you to take a python function and apply it to the rows of your PySpark DataFrames. When the functions you use change a lot, it can be annoying to have to\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["PySpark User-Defined Functions (UDFs) allow you to take a python function and apply it to the rows of your PySpark DataFrames. When the functions you use change a lot, it can be annoying to have to update both the functions and where you use them. This post will explain how to have arguments automatically pulled given the function. The method also works for functions that take Pandas Series as inputs (see the end of the post).", "Let\u2019s start with some setup: importing things we\u2019ll use along the way and creating a toy data set. Let\u2019s say our data contains information about prices, quantities sold, shipping costs collected from customers, and a list of other costs. We\u2019ll make some simple UDFs to calculate revenue and profit from these numbers.", "Let\u2019s say we want to create a simple UDF that uses the price and revenuecolumns to create a new revenue_wo_shipcolumn.", "There are many situations where the demands of the moment might change. For example, let\u2019s say that we change our definition of revenue to not only include the price of the item, but the shipping fees we have collected from customers as well. This requires two changes", "Removing the Second Step with inspect", "In this case, where the extra information was already in our data frame, it is annoying to have to make both of these code changes. We should be able to just change the function and have the arguments be pulled automatically by name.", "To do this, I took the following strategy:", "A. If the argument is a key in a passed in dictionary, use the value of that key. Otherwise,", "B. If any of the columns in the spark data frame have a name that matches the argument name, use them as the argument. Otherwise,", "C. If the argument has a default specified by the function, use it. Otherwise,", "D. Throw an exception because we don\u2019t know what value to use for the argument.", "The strategy is implemented by looping over the argument names of a function. That\u2019s where inspect comes in: it allows us to get the argument names and default values of a function.", "Now we can put it all together into a function to handle this strategy for us. Comments are included to guide you throughout the code.", "We start with a helper function that inputs constant values as arguments into the UDF to handle 2A and 2C from the strategy described above.", "Now we can make simple calls to this function without changing how we input things into the UDF:", "It also works with list inputs. For example, if we wanted to define profit as the difference between the product of price and quantity and the sum of the costs column:", "Note that this method would work equally well for Pandas:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Manager \u2014 Causal Inference, Prediction, Data Engineering"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8f85f6b893f2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@dvl-data?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dvl-data?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Dan VanLunen (DVL)"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F534d9d75f626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&user=Dan+VanLunen+%28DVL%29&userId=534d9d75f626&source=post_page-534d9d75f626----8f85f6b893f2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/photos/prairie-river-stream-curved-sunset-679014/", "anchor_text": "https://pixabay.com/photos/prairie-river-stream-curved-sunset-679014/"}, {"url": "https://unsplash.com/@almosbech?utm_source=medium&utm_medium=referral", "anchor_text": "Almos Bechtold"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----8f85f6b893f2---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/pandas?source=post_page-----8f85f6b893f2---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/python?source=post_page-----8f85f6b893f2---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8f85f6b893f2---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/big-data?source=post_page-----8f85f6b893f2---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&user=Dan+VanLunen+%28DVL%29&userId=534d9d75f626&source=-----8f85f6b893f2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&user=Dan+VanLunen+%28DVL%29&userId=534d9d75f626&source=-----8f85f6b893f2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8f85f6b893f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8f85f6b893f2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8f85f6b893f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dvl-data?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dvl-data?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dan VanLunen (DVL)"}, {"url": "https://medium.com/@dvl-data/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "81 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F534d9d75f626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&user=Dan+VanLunen+%28DVL%29&userId=534d9d75f626&source=post_page-534d9d75f626--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8e09e2cd9254&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmagically-pull-arguments-for-pyspark-udfs-and-pandas-functions-8f85f6b893f2&newsletterV3=534d9d75f626&newsletterV3Id=8e09e2cd9254&user=Dan+VanLunen+%28DVL%29&userId=534d9d75f626&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}