{"url": "https://towardsdatascience.com/using-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8", "time": 1683004097.5664089, "path": "towardsdatascience.com/using-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8/", "webpage": {"metadata": {"title": "Using Kalman Filter to Predict Coronavirus Spread | by Ran Kremer | Towards Data Science", "h1": "Using Kalman Filter to Predict Coronavirus Spread", "description": "Coronavirus (COVID-19) has recently caused major worldwide concern. As the number of coronavirus cases reportedly increases, the spread of COVID-19 is a serious threat to global health. In this\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/Rank23/COVID19", "anchor_text": "here", "paragraph_index": 2}], "all_paragraphs": ["Coronavirus (COVID-19) has recently caused major worldwide concern. As the number of coronavirus cases reportedly increases, the spread of COVID-19 is a serious threat to global health. In this work, we will try to predict the spread of coronavirus for each one of the infected regions. Fitting time series analysis and statistical algorithms to produce the best short term and long term prediction. An adaptive online Kalman filter provides us a very good one-day prediction for each region.", "As a beginning, let\u2019s briefly compare the COVID-19 to an older fatal virus-Ebola. Ebola is not a new disease (first cases were identified in 1976) but in 2014 and 2018 it erupted again until these days. * The fatality rate of EBOV is much higher and may reach a 75% death case comparing to ~3.9% death of COVID-19. It must be noted that COVID-19 is an ongoing disease so the fatality rate is not final and will most likely increase.* The locations and countries are obviously different where EBOV harms mostly in Africa and COVID-19 in China and Asia.*COVID-19 seems most likely to spread in cold weather where EBOV in warm weather.* Eruption trend seems very similar between the two, both diseases showed powerful eruption rapidly.", "To predict the coronavirus spread, I\u2019ve implemented a Kalman filter algorithm alongside other linear models. The optimization problem was solved with Python, while the script is available in the Google Colab notebook. the process of this project is described below, a full code can be found in Github here.", "Pre-processing data:* Read the data from Github-contain daily total cases of confirmed, death and recovered per location following data of the world health organization.* Fixing region name and concatenate country and province to one column \u201cregion\u201d. Then, clear some wrong characters within the dataset.", "Get Population:I used python \u2018qwikidata\u2019 package that extracts population data from Wikipedia based on the region coordinate (longitude, latitude). We will use this data to evaluate the infected rate in each area and test it in the model.", "Create Time Series and PlotsThe script allows us to generate a visual plot per region to get initial insights about the data. The wide majority of all cases are in Hubei, China (82%) therefore different plots were extracted.Below are the top areas of daily total cases.Confirmed:", "We can see a clear eruption trend in Hubei with exceptional day 13.02.20 of a high jump. On that day, there was a change in the counting method and it will later affect the model. We can\u2019t verify the data loyalty but assume data is reliable.In other top areas, the trend seems different and less sharp. The diamond princess cruise ship seems exceptional with a sharp trend since mid-February. (pink line)", "Death:* Death cases are mostly in Hubei with more than 2,000. After that, Henan with 19.* Death rate in Hubei is 2.1978% and 1.5055% in Henan. In the rest of the areas, the numbers are too small.", "Recovered:* Sharp trend of recovered cases in all areas, mostly in Hubei which can imply us for a positive future.", "Fitting Prediction Model Phase 1-One Day Prediction Kalman Filter", "I implemented a Kalman filter algorithm that fit the problem and generate 1 day ahead prediction for each case -confirmed, death, recovered; for each region.Kalman filter is a recursive algorithm that uses time-series measurement over time, containing statistical noise and produce estimations of unknown variables. I built an online-real time algorithm. This algorithm is adaptive, means it doesn\u2019t need a lot of historical/training data. Each day the algorithm is updated with new observation, after the estimation is done it can generate predictions for the next day. Kalman filter shows very good results predicting the next day observations. It follows the trend of each region separately and rapidly adapts the series and generates the prediction.  It is easy to evaluate the model as we don\u2019t need a training and testing sets. No overfitting or bias \u2014 it is an online algorithm.", "Implementation:I wrote an R script to implement an online Kalman algorithm and then used Python \u2018 rpy2\u2019 package that allows us to combine R script inside Python notebook and pass the outcome variables.After a short initialization, the algorithm starts to follow the series and produce a 1-day ahead prediction for each region. It runs on each possible region.", "Results and Evaluation:To evaluate results, I\u2019ve added some basic error estimator parameters for each region: MSE \u2014 mean square error, RMSE \u2014 root mean square error, MAE \u2014 mean absolute error.  I compared them with other methods to optimize the models and find the best one.The model can also be evaluated with plots and tables as shown below.The script allows to select regions and get a suitable plot and predictions. It was run iteratively for each region. Below are several examples:", "A. Beijing: The orange line is the Kalman prediction, the blue line is the real confirmed cases \u2014 as mentioned, this is not bias prediction, it summarizes the previous online predictions.We can see almost perfect fit:", "The table below shows how close are the predictions to the actual values. For example, on 19.02.20 Kalman predicts 394 cases which are 7 new confirmed cases while there were actual 6. For tomorrow (20.02.20) Kalman predicts 5 new confirmed cases in Beijing.", "B. Hubei confirmed cases \u2014 here we see almost perfect prediction until the 13.02.20, then since the jump in the data that was mentioned above the model had a larger error. But it is adapting fast and, in a few days, will gain better predictions.", "The plot below shows the great prediction rate of death cases in Hubei:", "The table below shows the predictions and the actual death in numbers, in Hubei. For example, on 18.02 Kalman predicted 140 more death where there were eventually 132.On 19.02 Kalman predict 129 more death where there were eventually 108.  For tomorrow (20.02), Kalman predicts another 132 new death cases. The predictions are very close to the real values.", "Recovered daily predictions: We can get some positive insights as to the sharp trend of recovered cases in Hubei.The Kalman prediction adapts this trend and predicts an increasing number of recovered cases recently.", "C. Shanghai-confirmed prediction. Here also great daily predictions very close to the real values", "D. Henan \u2014 Region with more than 1,200 confirmed cases \u2014 again very good predictions that adopt the trend of less confirmed cases in recent days.", "On the 19.02.20 Kalman predicts 56 new recovered cases where there were eventually 51. Tomorrow it predicts another 48 new recovered cases.Similar to Hubei we can see a good trend of recovered cases recently and a good adaptation of the algorithm.", "E. Another interesting region is the well-known diamond princess cruise ship close to Japan.The behavior of this series is thoroughly different from other regions and still, Kalman\u2019s prediction is doing a good job. There was an eruption of cases in the ship at the beginning of February, then it was sharply increased.Kalman predicts another 46 new cases for tomorrow (20.02.2020).", "Fitting Prediction Model Phase 2 \u2014 Spread and New Cases Along Time", "The Kalman algorithm is very powerful and provides a very good indication of what will be tomorrow.But to predict a longer period, it is not enough. (reminding this is an online algorithm).  I fit a linear model to predict the spread of COVID-19 along the time. The idea is to use time series algorithms such as Kalman and send them as the features for another machine learning algorithm, alongside other features that should be considered such as weather, population, infected rate, etc.  The data is not stationary so ML models such as random forest regression didn\u2019t work well.Eventually, I used a linear model that relay on the Kalman prediction.", "Creating Data SetsThe data set for the linear models contain different structure where:* Each row represents day and region.* Each column represents feature/variable where the target variable is the number of confirmed/death/recovered cases.", "Feature engineering: Weather data:I\u2019ve used python \u2018pyweatherbit\u2019 package to extract historical and forecast weather data per region coordinate (longitude, latitude). This package requires an API key which is limited to 500 calls per day so I run it for several days and then stored the data in CSV files (w.csv and w_forecast.csv) to merge it with the Github data.I\u2019ve extracted minimum and maximum temperatures for each day and location. (forecast is limited to 14 days, for a longer period I\u2019ve made a liner temperature forecast).", "The table below shows the top infected areas average temperature (from 22.01.20 until 17.02.20). We can see that most areas (beside Guangdong) get pretty cold weather with no more than 12\u201313 maximum average degrees and less than 5 minimum.", "Infected area data:I used the population data and the daily total confirmed cases to calculate the infected rate of each area each day in percentages. This feature will be important in the final model.", "Features list:The features that were tested in the model:1. Min-max temperature.2. Infected rate per region.3. Last day total.4. Last X days change (x=1,3,7).5. Last X days change rate.6. The prediction from Kalman.7. Region.8. Population.9. Confirmed/death/recovered \u2014 target variable.", "Correlation Matrix: In the plot below we can see the correlation matrix between the variables.* As expected, X days change/rate are correlated between them. (all the time-depended features)* Kalman and time-dependent variables are correlated to the target.* Infected rate also has a relatively high correlation with the target.* Min-max temperature has a very low correlation to the target. (but it doesn\u2019t mean they aren\u2019t helpful).", "Feature ImportanceI\u2019ve used python \u2018H20\u2019 package and run a separated model for the Hubei region.Results below show the most important features:Kalman's prediction is significant, as long as the other time-depended features.Infected rate is an important feature and will be used in the final model.", "Final ModelUsually when training ML models we need to divide our data to training/testing set (~75% to ~25%).Because we deal with time-depended non-stationary series this method doesn\u2019t fit.I\u2019ve solved this problem by imitating an iterative \u201conline\u201d system that trains the model every day and predicts the next day.Then, instead of the getting the feedback of the real value, I updated the next timestamp value with the last prediction plus some calculated noise, and predict again.Each day all the features are being updated (Kalman, infected rate, weather forecast, and last X days calculation).After evaluating several models I chose a simple linear regression model using python \u2018sklearn\u2019 package.", "Results:The script allows us to choose each region and get the prediction of total confirmed, death and recovered cases. Here I show plots of Hubei and other major regions.", "Hubei \u2014 Confirmed: The prediction shows less and less future confirmed issues in Hubei but expects to pass 100,000 confirmed cases next month.", "Recovered- This positive prediction shows the good pace of recovered people in Hubei. Following this prediction, more than 80,000 people will recover from coronavirus next month.", "Major areas:* We can see that in many regions the prediction for next month shows almost no spread. All the bottom lines and lines where the gradient of the graph is not changing.", "* Based on this prediction the massive eruption was passed and the trend showing less and less confirmed cases even in top areas like Zhejiang, Henan, Anhui, Guangdong (top 4 lines in the chart).", "* The diamond ship is expected to get more and more confirmed issue \u2014 until all the people in the ship will be evacuated. This should be happening soon, then there will be no more predictions. (5th line light blue)", "Death: Following the prediction in most of the regions we won\u2019t see an increase in death cases. The main concerned region is Henan with the prediction of almost 40 death next month (today there are 19)", "Recovered \u2014 Prediction shows the recovered rate will increase next month. More and more people will be recovered from COVID-19.", "Heatmap:To present another visualization out of the prediction I\u2019ve used python package \u2018 gmplot\u2019 to show the predictions over google maps.The map shows a hotspot with high infected locations based on the coordinate of the region. The observations are the prediction of the next month in each region.The API of google is not free anymore so this version is limited but it does show the infected location.", "That\u2019s it, thanks for reading feel free to contact me to share your thoughts questions or feedback.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F72d91b74cc8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@rank23?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rank23?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Ran Kremer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe5fd8acb418d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&user=Ran+Kremer&userId=e5fd8acb418d&source=post_page-e5fd8acb418d----72d91b74cc8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/Rank23/COVID19", "anchor_text": "here"}, {"url": "https://medium.com/analytics-vidhya/coronavirus-updated-prediction-using-kalman-filter-3ef8b7a72409", "anchor_text": "here"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----72d91b74cc8---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----72d91b74cc8---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/kalman-filter?source=post_page-----72d91b74cc8---------------kalman_filter-----------------", "anchor_text": "Kalman Filter"}, {"url": "https://medium.com/tag/data-science?source=post_page-----72d91b74cc8---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/health?source=post_page-----72d91b74cc8---------------health-----------------", "anchor_text": "Health"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&user=Ran+Kremer&userId=e5fd8acb418d&source=-----72d91b74cc8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&user=Ran+Kremer&userId=e5fd8acb418d&source=-----72d91b74cc8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F72d91b74cc8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----72d91b74cc8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----72d91b74cc8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----72d91b74cc8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----72d91b74cc8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rank23?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rank23?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ran Kremer"}, {"url": "https://medium.com/@rank23/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "164 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe5fd8acb418d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&user=Ran+Kremer&userId=e5fd8acb418d&source=post_page-e5fd8acb418d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fe5fd8acb418d%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-kalman-filter-to-predict-corona-virus-spread-72d91b74cc8&user=Ran+Kremer&userId=e5fd8acb418d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}