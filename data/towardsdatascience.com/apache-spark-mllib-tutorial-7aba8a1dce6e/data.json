{"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-7aba8a1dce6e", "time": 1682996417.629631, "path": "towardsdatascience.com/apache-spark-mllib-tutorial-7aba8a1dce6e/", "webpage": {"metadata": {"title": "Feature Transformation. How to handle different feature types\u2026 | by Ali Masri | Towards Data Science", "h1": "Feature Transformation", "description": "This post discusses various Feature Transformation concepts and techniques and shows how they are implemented in Spark ML."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-ec6f1cb336a9", "anchor_text": "Part 1: Regression", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-part-3-complete-classification-workflow-a1eb430ad069", "anchor_text": "Part 3: Classification", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-ec6f1cb336a9", "anchor_text": "previous article", "paragraph_index": 1}, {"url": "https://drive.google.com/open?id=1cgZG_6HdI92ThuFxt7V14qUN7n5b5ZoB", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://spark.apache.org/docs/1.6.1/ml-guide.html#estimators", "anchor_text": "https://spark.apache.org/docs/1.6.1/ml-guide.html#estimators", "paragraph_index": 13}, {"url": "https://spark.apache.org/docs/1.6.1/ml-guide.html#transformers", "anchor_text": "https://spark.apache.org/docs/1.6.1/ml-guide.html#transformers", "paragraph_index": 17}, {"url": "https://archive.ics.uci.edu/ml/datasets/wine", "anchor_text": "Wine Data Set", "paragraph_index": 31}, {"url": "https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data", "anchor_text": "here", "paragraph_index": 31}, {"url": "https://drive.google.com/open?id=1SPQS2tD4khaixSHGtTIORN4w11z1zjEo", "anchor_text": "here", "paragraph_index": 48}, {"url": "https://twitter.com/alimasri1991", "anchor_text": "Twitter", "paragraph_index": 58}, {"url": "https://www.facebook.com/alimasri91", "anchor_text": "Facebook", "paragraph_index": 58}, {"url": "https://www.linkedin.com/in/alimasri/", "anchor_text": "LinkedIn", "paragraph_index": 58}, {"url": "https://alimasri.info", "anchor_text": "https://alimasri.info", "paragraph_index": 60}], "all_paragraphs": ["Note: This article is part of a series. Check out the full series: Part 1: Regression, Part 2: Feature Transformation, Part 3: Classification, Parts 4 and up are coming soon.", "In the previous article we talked about Spark ML and how to use it for training a regression model. This article focus on Feature Transformation. We will understand the concepts and how to implement them directly in Spark ML.", "Feature transformation is simply a function that transforms features from one representation to another. But why would we transform our features? Well there are many reasons, such as:", "In this article we will focus on three main transformation techniques:", "Categorical values are values that can be represented as categories or groups. They can be grouped into two main types: Nominal and Ordinal.", "Machine learning algorithms can not handle data represented as categories or labels. Therefore, we need to transform the values into a more relevant format.", "We will work with a very simple dataset so that we put total focus on the techniques we are going to learn. The dataset is simply a CSV file with two fields: ID and Color. [Download it from here]", "For the rest of the article, the following steps are common to setup the development environment:", "Even thought the data is very simple, we can not work with the color column as it is, since it contains categorical data.", "In order to solve this problem, we will introduce two main methods and how implement them in Spark ML: String Indexing and One Hot Encoding.", "The concept behind String Indexing is very intuitive. We simply replace each category with a number. Then we use this number in our models instead of the label.", "Here is how we do it. First, we need to define a StringIndexer.", "Note that indexer here is an object of type Estimator.", "An Estimator abstracts the concept of a learning algorithm or any algorithm that fits or trains on data. Technically, an Estimator implements a method fit(), which accepts a DataFrame and produces a Model, which is a Transformer.source: https://spark.apache.org/docs/1.6.1/ml-guide.html#estimators", "The objective of an estimator here is to learn the mappings from a color label to a color index.", "Next we call the fit() method to initiate the learning process.", "The returned indexer_model is an object of type Transformer.", "A Transformer is an abstraction that includes feature transformers and learned models. It implements a method transform(), which converts one DataFrame into another, generally by appending one or more columns.source: https://spark.apache.org/docs/1.6.1/ml-guide.html#transformers", "After fitting the estimator and getting our transformer, it is time to use it on our data by calling transform().", "Notice how a new column \u201ccolor_indexed\u201d is added as specified in our outputCol field.", "The new column represents an index for each color value. Similar color values have similar indices. Here we see that red, white, orange and blue where given the numbers 0, 1, 2 and 3 respectively.", "These numbers will be the ones collected in the features vector with the VectorAssembler to be passed to the machine learning algorithm.", "But wait! We still have a problem. A color is a nominal value not an ordinal one. This means that there is no order between the color names. For example: red is not greater, less than or equal to green. However, based on the current representation the machine learning model may consider somehow that there is an order based on the values given. Don\u2019t worry we will fix this with another technique called One Hot Encoding.", "We use One Hot Encoding (OHE) to break the ordering within a categorical column. The process to apply OHE is the following:", "Going back to our example, we have four unique colors: red, white, orange and blue. Therefore, we need four columns. We will name them: is_red, is_white, is_orange and is_blue. Now instead of having a value x for the color red we will put 1 in the is_red column and 0 in the others. Then, we will group the values in an array to be used as the color feature instead of the single-value index calculated by StringIndexer. [See the table below to get a better idea]", "To apply OHE, we first import the OneHotEncoderEstimator class and create an estimator variable.", "Now we fit the estimator on the data to learn how many categories it needs to encode.", "We got our trained model, time to apply it on our data.", "Done! We have the color_ohe column that contains our one-hot-encoded data. But what is this weird representation? It is called a DenseVector data type, used to reduce storage space. For example the numbers (3, [0], [1]) mean we have an array of 3 values such that we got the value 1 at index 0, and the value 0 in all other positions. But again, why 3 values while we have four unique categories? Well this is how Spark ML does it. It omits the final category to break the correlation between features. Normally you do not have to worry about it. But in case you want to force Spark ML not to drop the last column, simply add dropLast=False in the constructor.", "Now the color_ohe column is ready to be collected by your VectorAssembler without worrying about the ordinal relationship between colors.", "Let us move from categorical values to numerical ones. But why do we need to bother? This kind of data is already numerical and could be used directly in a machine learning model, right? Unfortunately, this is not always the case. Next we will understand what is feature scaling, and how it could improve our models.", "We will work with the popular Wine Data Set [Download from here]. Let us load it and have a look.", "Note: I have omitted the column names for space purposes.", "You might ask what is wrong with the data? Well, have a closer look at the values in each column. Some values are small fractions < 1, some range between 10 and 20 and others are in thousands. Notice for each column, the difference in means, standard deviations, minimum and maximum values. [Calculated with data.describe().show() method]", "This diversity in scale could cause a lot of problems in some machine learning algorithms e.g. KMeans. This is because the algorithm may treat some variables as more dominant according to their value range. For example: consider a dataset about employees. We may have a years of experience column that ranges between 0 \u2192 30 and a salary column with values in thousands. But this does not mean that the salary column is more dominant!", "To solve this problem we transform the values to be at the same scale. There are a lot of transformation methods, we will look at two of them.", "Note that scalers are applied on Vector Data Types that is why we need to collect the features using a VectorAssembler first:", "Important: We omitted the _c0 column since it is a categorical column. Scaler should be applied only on numerical values.", "Here we got our features column.", "A StandardScaler standardizes features by removing the mean and scaling to unit standard deviation using column-summary-statistics.", "StandardScaler can take two additional parameters:", "Now we fit our estimator on the dataset.", "Finally, we apply our transformer on the data to get our scaled features.", "Done! We have our scaled features ready.", "Applying any other scaler is doing the exact same process as above, but with a different class name and its relevant parameters.", "MinMaxScaler transforms data values to a specific range ([0, 1] by default).", "Principal Component Analysis (PCA) is a procedure that converts a set of observations from m to n dimensions (m > n), after analyzing the correlated features of the variables. It is used to move the data from high to a low dimension for visualization or dimensionality reduction purposes. I will not go much into details since my goal here is to teach you how to apply it.", "Applying PCA is no different than applying other estimators:", "To see how powerful PCA is, we will apply it on a dataset of handwritten images [Download from here]. The data has 785 columns. The first column represents a label defining the digit class (0 \u21929), the other 784 columns represent the pixel values of the 28*28 image.", "It is too difficult for our minds to visualize something higher that 3 dimensions. Here our data has 784 dimensions! So it would be impossible for use to make sense of it in this representation. Luckily we could use PCA to reduce the dimensions to only 2!", "First, we read the data and collect the pixels into a features column:", "We create our PCA model given k = 2 (number of output dimensions):", "Finally, we apply the model on the data:", "Notice how the features_pca column only has two values. These values are the reduced dimensions from 784 \u2192 2.", "Now, notice what happens when we plot these values and label them by each digit label.", "See how we beautifully were able to plot the distribution of digits only using 2 dimensions. We see that similar digits form a cluster, and this insight is very useful for later processing.", "PCA is very powerful when used properly. It helps you visualize data or prepare it for other machine learning algorithms.", "In this article we covered the basics of Feature Transformation. A set of techniques that help transforming our data into more relevant or optimized formats for machine learning algorithms. We covered the most common approaches and how to implement them in Spark ML. Next we are going to learn how to put these techniques in practice and how to organize them in a full work flow. Stay tuned\u2026", "If you enjoyed this article, I would appreciate it if you hit the clap button \ud83d\udc4f so it could be spread to others. You can also follow me on Twitter, Facebook, email me directly or find me on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Lead Data Engineer @ Ford Motor Company. https://alimasri.info"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7aba8a1dce6e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@alimasri1991?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alimasri1991?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Ali Masri"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F759a0c777b02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&user=Ali+Masri&userId=759a0c777b02&source=post_page-759a0c777b02----7aba8a1dce6e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-ec6f1cb336a9", "anchor_text": "Part 1: Regression"}, {"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-part-3-complete-classification-workflow-a1eb430ad069", "anchor_text": "Part 3: Classification"}, {"url": "https://towardsdatascience.com/apache-spark-mllib-tutorial-ec6f1cb336a9", "anchor_text": "previous article"}, {"url": "https://unsplash.com/photos/VMKBFR6r_jg", "anchor_text": "Photo by Suzanne D. Williams"}, {"url": "https://drive.google.com/open?id=1cgZG_6HdI92ThuFxt7V14qUN7n5b5ZoB", "anchor_text": "here"}, {"url": "https://spark.apache.org/docs/1.6.1/ml-guide.html#estimators", "anchor_text": "https://spark.apache.org/docs/1.6.1/ml-guide.html#estimators"}, {"url": "https://spark.apache.org/docs/1.6.1/ml-guide.html#transformers", "anchor_text": "https://spark.apache.org/docs/1.6.1/ml-guide.html#transformers"}, {"url": "https://archive.ics.uci.edu/ml/datasets/wine", "anchor_text": "Wine Data Set"}, {"url": "https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data", "anchor_text": "here"}, {"url": "https://drive.google.com/open?id=1SPQS2tD4khaixSHGtTIORN4w11z1zjEo", "anchor_text": "here"}, {"url": "https://twitter.com/alimasri1991", "anchor_text": "Twitter"}, {"url": "https://www.facebook.com/alimasri91", "anchor_text": "Facebook"}, {"url": "https://www.linkedin.com/in/alimasri/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7aba8a1dce6e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/big-data?source=post_page-----7aba8a1dce6e---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----7aba8a1dce6e---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/feature-transformation?source=post_page-----7aba8a1dce6e---------------feature_transformation-----------------", "anchor_text": "Feature Transformation"}, {"url": "https://medium.com/tag/sparkml?source=post_page-----7aba8a1dce6e---------------sparkml-----------------", "anchor_text": "Sparkml"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&user=Ali+Masri&userId=759a0c777b02&source=-----7aba8a1dce6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&user=Ali+Masri&userId=759a0c777b02&source=-----7aba8a1dce6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7aba8a1dce6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7aba8a1dce6e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7aba8a1dce6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alimasri1991?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alimasri1991?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ali Masri"}, {"url": "https://medium.com/@alimasri1991/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "254 Followers"}, {"url": "https://alimasri.info", "anchor_text": "https://alimasri.info"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F759a0c777b02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&user=Ali+Masri&userId=759a0c777b02&source=post_page-759a0c777b02--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6074babbd9e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fapache-spark-mllib-tutorial-7aba8a1dce6e&newsletterV3=759a0c777b02&newsletterV3Id=6074babbd9e9&user=Ali+Masri&userId=759a0c777b02&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}