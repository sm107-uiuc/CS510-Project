{"url": "https://towardsdatascience.com/how-to-decide-on-learning-rate-6b6996510c98", "time": 1683016457.508723, "path": "towardsdatascience.com/how-to-decide-on-learning-rate-6b6996510c98/", "webpage": {"metadata": {"title": "How to Decide on Learning Rate. Finding good LR for your neural nets\u2026 | by Mateusz Kwa\u015bniak | Towards Data Science", "h1": "How to Decide on Learning Rate", "description": "Among all the hyper-parameters used in machine learning algorithms, the learning rate is probably the very first one you learn about. Most likely it is also the first one that you start playing with\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Supervised_learning", "anchor_text": "supervised learning", "paragraph_index": 1}, {"url": "https://arxiv.org/abs/1506.01186", "anchor_text": "\u201cCyclical Learning Rates for Training Neural Networks\u201d", "paragraph_index": 8}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/lr_finder.html", "anchor_text": "Learning Rate Finder", "paragraph_index": 11}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/lr_finder.html", "anchor_text": "documentation", "paragraph_index": 14}, {"url": "https://github.com/mtszkw", "anchor_text": "here", "paragraph_index": 16}, {"url": "http://linkedin.com/in/mtszkw", "anchor_text": "linkedin.com/in/mtszkw", "paragraph_index": 25}], "all_paragraphs": ["Among all the hyper-parameters used in machine learning algorithms, the learning rate is probably the very first one you learn about. Most likely it is also the first one that you start playing with. There\u2019s a chance to find the optimal value with a bit of hyper parameter optimization, but this requires lots of experimenting. So why not let your tools do that (faster)?", "The shortest explanation of what learning rate really is that it controls how fast your network (or any algorithm) learns. If you recall how supervised learning works, you should be familiar with the concept of neural network adapting to the problem based on supervisor\u2019s response e.g.:", "Thanks to that, it can give more and more accurate answers iteratively. Every single time it receives feedback from the supervisor, it learns what the correct answer should be. And learning rate controls how much to change the model perception in response to recent errors (feedback).", "If there is a \u201cgood learning rate\u201d that we are looking for, does \u201cbad learning\u201d also exist? And what does it mean? Let me stick to the concept of supervised learning and discuss a trivial example:", "While this is not really a neural network example, let\u2019s imagine how one could play that game and let\u2019s assume that it\u2019s not purely random guessing this time.", "Each time you get a feedback \u2014 would you rather take a small step towards the right answer or maybe a big leap? While this example is not really about neural networks or machine learning, this is essentially how learning rate works.", "Now, imagine taking only tiny steps, each bringing you closer to the correct number. Will this work? Of course. However, it can really take some time until you get there. This is the case of small learning rate. In context of machine learning, a model with too-small LR would be a slow-learner and it would need more iterations to solve the problem. Sometimes you may already decide to stop the training (or playing Guess the Number game) before it is finished.", "You can also pick a value that\u2019s too large. And what then? For instance, it may cause a neural network to change its mind too much (and too often). Every new sample will have a huge impact on your network beliefs. Such training will be highly unstable. It is no longer a slow-learner, but it may be even worse: your model may end up not learning anything useful in the end.", "Paper \u201cCyclical Learning Rates for Training Neural Networks\u201d written by Leslie N. Smith in 2015 introduces a concept of cyclical learning rate \u2014 increasing and decreasing in turns during training. However, there\u2019s one important thing covered in the paper, so called \u201cLR Range test\u201d (Section 3.3).", "The whole thing is relatively simple: we run a short (few epochs) training session in which learning rate is increased (linearly) between two boundary values min_lr and max_lr. At the beginning, with small learning rate the network will start to slowly converge which results in loss values getting lower and lower. At some point, learning rate will get too large and cause network to diverge.", "If you plot loss values versus tested learning rate (Figure 1.), you usually look for the best initial value of learning somewhere around the middle of the steepest descending loss curve \u2014 this should still let you decrease LR a bit using learning rate scheduler. In Figure 1. where loss starts decreasing significantly between LR 0.001 and 0.1, red dot indicates optimal value chosen by PyTorch Lightning framework.", "Recently PyTorch Lightning became my tool of choice for short machine learning projects. I have used it for the first time couple months ago and I keep using it since then. Apart from all the cool stuff it has, it also provides Learning Rate Finder class that will help us find a good learning rate.", "Using LR Finder is nothing but auto_lr_find parameter in Trainer class:", "Now when you call trainer.fit method, it performs learning rate range test underneath, finds a good initial learning rate and then actually trains (fit) your model straight away. So basically it all happens automatically within fit call and you have absolutely nothing to worry about.", "As stated in the documentation, there is an alternative approach that allows you to use LR Finder manually and inspect its results. This time you have to create Trainer object with a default value of auto_lr_find (False) and call lr_find method manually:", "And that\u2019s it. Main advantage of this approach is that you can take a closer look at the plot that shows which value was chosen (see Fig. 1.).", "I decided to train a fairly simple network architecture (LeNet) on Fashion MNIST dataset. I ran four separate experiments which only differed in initial learning rate values. Three of them hand-picked (1e-5, 1e-4, 1e-1) and the last one suggested by Learning Rate Finder. I will not describe whole implementation and other parameters (read it by yourself here). Let me just show you the findings.", "It took around 12 seconds (!) to find the best initial learning rate which for my network and problem being solved turned out to be 0.0363. Looking at loss versusLR plot (exactly the one in Figure 1) I was surprised because the suggested point is not exactly \u201chalfway the sharpest downward slope\u201d (as mentioned in the paper). However, I could not tell whether that was good or bad, so started to train the model.", "For logging and visualization I used TensorBoard to log loss and accuracy during training and validation steps. Below you can see metrics history for each of four experiments.", "Learning rate suggested by Lightning (light blue) seems to outperform other values in both training and validation phase. At the end it reached 88,85% accuracy on validation set which is the highest score from all experiments (Figure 2). More than that, loss function values were clearly the best for the \u201cfind_lr\u201d experiment. In the last validation step it reached loss equal to 0.3091 which was the lowest value compared to other curves in Figure 3.", "In that short experiment, Learning Rate Finder has outperformed my hand-picked learning rates. Of course, there was a chance that I could pick 0.0363 as my initial guess, but the whole point of LR Finder is to minimize all the guesswork (unless you are a luck man).", "I think using this feature is useful, as written by Leslie N. Smith:", "Whenever one is starting with a new architecture or dataset, a single LR range test provides both a good LR value and a good range. Then one should compare runs with a fixed LR versus CLR with this range. Whichever wins can be used with confidence for the rest of one\u2019s experiments.", "If you don\u2019t want to perform hyper-parameter search using different values, which can take ages, you have two options left: pick initial values at random (which may leave you with terribly bad performance and convergence but may work great if you are a lucky man though) or use a learning rate finder included in your machine learning framework of choice.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Lead MLOps Engineer, ML Architect // I write about machine learning engineering, system design and platforms // linkedin.com/in/mtszkw"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6b6996510c98&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mtszkw.medium.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": ""}, {"url": "https://mtszkw.medium.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Mateusz Kwa\u015bniak"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe35f39d3a543&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&user=Mateusz+Kwa%C5%9Bniak&userId=e35f39d3a543&source=post_page-e35f39d3a543----6b6996510c98---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Supervised_learning", "anchor_text": "supervised learning"}, {"url": "https://arxiv.org/abs/1506.01186", "anchor_text": "\u201cCyclical Learning Rates for Training Neural Networks\u201d"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/lr_finder.html", "anchor_text": "Learning Rate Finder"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/lr_finder.html", "anchor_text": "documentation"}, {"url": "https://github.com/mtszkw", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6b6996510c98---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6b6996510c98---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----6b6996510c98---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----6b6996510c98---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/programming?source=post_page-----6b6996510c98---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&user=Mateusz+Kwa%C5%9Bniak&userId=e35f39d3a543&source=-----6b6996510c98---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&user=Mateusz+Kwa%C5%9Bniak&userId=e35f39d3a543&source=-----6b6996510c98---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6b6996510c98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6b6996510c98---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6b6996510c98--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6b6996510c98--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6b6996510c98--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6b6996510c98--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6b6996510c98--------------------------------", "anchor_text": ""}, {"url": "https://mtszkw.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mtszkw.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mateusz Kwa\u015bniak"}, {"url": "https://mtszkw.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "183 Followers"}, {"url": "http://linkedin.com/in/mtszkw", "anchor_text": "linkedin.com/in/mtszkw"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe35f39d3a543&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&user=Mateusz+Kwa%C5%9Bniak&userId=e35f39d3a543&source=post_page-e35f39d3a543--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F592b36e1be3b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-decide-on-learning-rate-6b6996510c98&newsletterV3=e35f39d3a543&newsletterV3Id=592b36e1be3b&user=Mateusz+Kwa%C5%9Bniak&userId=e35f39d3a543&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}