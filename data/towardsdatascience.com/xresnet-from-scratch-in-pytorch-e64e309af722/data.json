{"url": "https://towardsdatascience.com/xresnet-from-scratch-in-pytorch-e64e309af722", "time": 1683004457.412535, "path": "towardsdatascience.com/xresnet-from-scratch-in-pytorch-e64e309af722/", "webpage": {"metadata": {"title": "xResNet From Scratch in Pytorch. Squeeze a little extra from your ResNet\u2026 | by Dimitris Poulopoulos | Towards Data Science", "h1": "xResNet From Scratch in Pytorch", "description": "We introduce and code the xResNet architecture, a tweaked version of one of the most influential computer-vision architectures; the ResNet architecture."}, "outgoing_paragraph_urls": [{"url": "http://openaccess.thecvf.com/content_cvpr_2016/html/He_Deep_Residual_Learning_CVPR_2016_paper.html", "anchor_text": "Kaiming He et al. in 2016", "paragraph_index": 0}, {"url": "http://openaccess.thecvf.com/content_CVPR_2019/html/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.html", "anchor_text": "Tong He of Amazon Web Services", "paragraph_index": 0}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai course", "paragraph_index": 2}, {"url": "https://github.com/fastai/fastai2/blob/master/fastai2/vision/models/xresnet.py", "anchor_text": "fast.ai library", "paragraph_index": 2}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "Learning Rate", "paragraph_index": 3}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack", "paragraph_index": 22}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium", "paragraph_index": 22}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn", "paragraph_index": 22}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl", "paragraph_index": 22}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me", "paragraph_index": 24}], "all_paragraphs": ["The ResNet architecture, proposed by Kaiming He et al. in 2016, has been proven to be one of the most successful neural network architectures in the field of computer vision. Almost three years later, a team led by Tong He of Amazon Web Services, suggested a few tweaks in the structure of the model that can have a non-negligible effect on the model accuracy.", "In this story, we implement the ResNet architecture from scratch, taking into account the tweaks introduced in the \u201cBag of Tricks for Image Classification with Convolutional Neural Networks\u201d publication. The resulting model, following Jeremy Howard\u2019s recommendation, is called xResNet and we can either think of it as the mutant ResNet or the architecture\u2019s neXt version.", "The code is, for the most part, taken from the fast.ai course and the fast.ai library. However, I try to simplify it and structure it in a way that supports the narrative.", "Learning Rate is a newsletter for those who are curious about the world of AI and MLOps. You\u2019ll hear from me every Friday with updates and thoughts on the latest AI news and articles. Subscribe here!", "To better understand the reasoning behind the tweaks introduced in xResNet, we briefly discuss the original ResNet architecture. The general view of the model is depicted in the figure below.", "At first, we have the input stem. This module consists of a 7x7 convolution layer with a 64 output channel and a stride of 2. This is followed by a 3x3 max-pooling layer, again with a stride of 2. We know that the output size of an image after a convolution is given by the following formula below.", "In this formula o is the output size of the image (o x o), n is the input size (n x n), p is the padding applied, f is the filter or kernel size and s is the stride. Thus, the input stem reduces the width and height of the image by 4 times, 2 coming from the convolution and 2 from the max pooling. It also increases its channel size to 64.", "Later, starting from Stage 2, every module starts with a downsampling block followed by two residual blocks. The downsampling block is divided into two paths: A and B. The path A has three convolutions; two 1x1 and in the middle a 3x3. The first convolution has a stride of 2 to halve the image size and the last convolution has an output channel that is four times larger than the previous two. The role of path B is to bring the input image to a shape that matches the output of path A so that we can sum the two results. Thus, it only has a 1x1 convolution with a stride of 2 and the same number of channels as the last convolution of Path A.", "The residual block is similar to the downsampling one, but instead of throwing a stride 2 convolution, in the first layer of each stage, it keeps the stride equal to 1 the whole time. Altering the number of residual blocks in each stage gives you back different ResNet models, such as ResNet-50 or ResNet-152.", "There are three different tweaks in the ResNet architecture to obtain the xResNet model; ResNet-B, ResNet-C and ResNet-D.", "ResNet-B, which first appeared in a Torch implementation of ResNet, alters the path A of the downsampling block. It simply moves the stride 2 to the second convolution and keeps a stride of 1 for the first layer. It\u2019s easy to see that if we have the stride 2 in the first convolution, which is a 1x1 convolution, we lose three-quarters of the input feature map. Moving it to the second layer alleviates this problem and does not alter the output shape of path A.", "ResNet-C, proposed in Inception-v2, removes the 7x7 convolution in the input stem of the network and replaces it with three consecutive 3x3 convolutions. The first one has a stride of two and the last one has a 64 channel output followed by a 3x3 max-pooling layer with stride 2. The resulting shape is the same but the 3x3 convolutions are now much more efficient than a 7x7 one, because a 7x7 convolution is 5.4 times more expensive than a 3x3.", "ResNet-D is the new suggestion and is a logical consequence of ResNet-B. In path B of the downsampling block, we also have a 1x1 convolution of stride 2. We are still throwing three-quarters of useful information out of the window. Thus, the authors replaced this convolution with a 2x2 average-pooling layer of stride 2 followed by a 1x1 convolution layer. The three tweaks are summarised in the picture below.", "In the last section of this story, we implement the xResNet architecture in Pytorch. First, let us import the torch library and define the conv helper function, which returns a 2D convolution layer.", "Now to complete the convolution block, we should add the initialization method, batch normalization and the activation function \u2014 if needed. We use the conv function defined above to create a complete block.", "We see that we want to initialize the weights of the batch normalization layer to either 1 or 0. This is something that we will come back to later. Next, we define the xResNet block.", "In the xResNet block, we have two paths. We call path A the convolution path and path B the identity path. The convolution path is divided into two different cases; for xResNet-34 and down, instead of having three convolutions in each stage we get just two 3x3 convolution layers.", "Moreover, in any xResNet architecture, we do not use an activation function to the final convolution layer of each block and initialize the batch normalization weights to 0. The second one is done to allow our network to easily learn the identity function effectively cancelling the whole block. That way we can design deeper network architectures, where the activations are carried further down the model, without worries of exploding or vanishing gradients.", "In path B, the identity path, we use the average-pooling of stride 2 and the 1x1 convolution if we have a downsampling block, otherwise we just let the signal flow through. Finally, for the activation function, we use the default ReLU activation.", "Putting it all together, we create the xResNet architecture, with the stem input and some helper methods to initialize the model.", "In this story, we briefly introduced the ResNet architecture, one of the most influential models in computer vision. We then went a bit further and explained some tricks that make the architecture more powerful by increasing its accuracy. Finally, we implemented the tweaked xResNet architecture in code, using PyTorch.", "In a later chapter, we will see how to use this model to solve a relevant problem with and without transfer learning.", "My name is Dimitris Poulopoulos and I\u2019m a machine learning researcher at BigDataStack and PhD(c) at the University of Piraeus, Greece. I have worked on designing and implementing AI and software solutions for major clients such as the European Commission, Eurostat, IMF, the European Central Bank, OECD, and IKEA. If you are interested in reading more posts about Machine Learning, Deep Learning and Data Science, follow me on Medium, LinkedIn or @james2pl on twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer. I talk about AI, MLOps, and Python programming. More about me: www.dimpo.me"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe64e309af722&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1----e64e309af722---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kuzelevdaniil?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Daniil Ku\u017eelev"}, {"url": "https://unsplash.com/s/photos/vision?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://openaccess.thecvf.com/content_cvpr_2016/html/He_Deep_Residual_Learning_CVPR_2016_paper.html", "anchor_text": "Kaiming He et al. in 2016"}, {"url": "http://openaccess.thecvf.com/content_CVPR_2019/html/He_Bag_of_Tricks_for_Image_Classification_with_Convolutional_Neural_Networks_CVPR_2019_paper.html", "anchor_text": "Tong He of Amazon Web Services"}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai course"}, {"url": "https://github.com/fastai/fastai2/blob/master/fastai2/vision/models/xresnet.py", "anchor_text": "fast.ai library"}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "Learning Rate"}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "here"}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack"}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium"}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e64e309af722---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----e64e309af722---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e64e309af722---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/resnet?source=post_page-----e64e309af722---------------resnet-----------------", "anchor_text": "Resnet"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----e64e309af722---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----e64e309af722---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----e64e309af722---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe64e309af722&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e64e309af722---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e64e309af722--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e64e309af722--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e64e309af722--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e64e309af722--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e64e309af722--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://dpoulopoulos.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12.5K Followers"}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb5ab149102ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fxresnet-from-scratch-in-pytorch-e64e309af722&newsletterV3=7cc87df5b1&newsletterV3Id=b5ab149102ea&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}