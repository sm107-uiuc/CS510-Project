{"url": "https://towardsdatascience.com/dont-over-plan-your-data-visualization-737c7330d80f", "time": 1683010774.5594308, "path": "towardsdatascience.com/dont-over-plan-your-data-visualization-737c7330d80f/", "webpage": {"metadata": {"title": "Don\u2019t over-plan your Data Visualization | by Oskar Kocol | Towards Data Science", "h1": "Don\u2019t over-plan your Data Visualization", "description": "Employing d3.js and Observable Notebooks to learn how to create effective Data Visualizations (Data Viz)."}, "outgoing_paragraph_urls": [{"url": "https://earth.nullschool.net/", "anchor_text": "Wind Map", "paragraph_index": 3}, {"url": "https://twitter.com/cambecc", "anchor_text": "Cameron Beccario", "paragraph_index": 3}, {"url": "https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs", "anchor_text": "Global Forecast System", "paragraph_index": 12}, {"url": "https://en.wikipedia.org/wiki/GRIB", "anchor_text": "GRIB format", "paragraph_index": 13}, {"url": "https://earth.nullschool.net/", "anchor_text": "earth.nullschool.net", "paragraph_index": 16}, {"url": "https://github.com/cambecc/earth", "anchor_text": "Github", "paragraph_index": 17}, {"url": "https://en.wikipedia.org/wiki/WebGL", "anchor_text": "WebGL", "paragraph_index": 26}, {"url": "https://blog.mapbox.com/how-i-built-a-wind-map-with-webgl-b63022b5537f", "anchor_text": "the WebGL-based library developed by the Mapbox team", "paragraph_index": 29}, {"url": "https://pubs.er.usgs.gov/publication/pp1395", "anchor_text": "Map Projections\u2013A Working Manual available at the U.S. Geological Survey", "paragraph_index": 36}, {"url": "https://observablehq.com/@oskarkocol/animated-wind-map", "anchor_text": "https://observablehq.com/@oskarkocol/animated-wind-map", "paragraph_index": 42}], "all_paragraphs": ["It is tempting to start the title of this article with something like \u201cTop 10 lessons\u201d or \u201c5 easy steps\u201d. We, people working with Data, love following some kind of framework or experimentally tested recipe. But coming up with one for Data Visualization would be a big stretch.", "Development of a complex data visualization is not a process with a start and an end connected together by a number of standardized steps. It is more of a repeated, rapid prototyping process where the intermediary steps will not be known until you finish. This characteristic of Data Visualization might be very demotivating, especially for people who like to have a detailed plan to follow.", "If you get wrapped in yet-another unexpected bug that seems like a yet-another setback, think of creating the data visualization as of boat sailing. When on a boat, you might see a destination port on the horizon and have an idea of how to get there. But the final path that you will follow will most likely diverge from your initial plan. It will depend on the ever-changing wind, the height of waves, depth of water, and even traffic of other boats. Like with data visualization, you won\u2019t really know what your route would look like until you finish.", "In the past couple of weeks, I recreated one of my favorite visualizations \u2014 the famous Wind Map designed by Cameron Beccario. In this article, I want to reflect on my design process and in particular describe all the little setbacks that I couldn\u2019t have possibly planned for but which ended up improving my visual storytelling. If you find yourself stuck on a way to make your data visualization, if you lost sight of your destination, you\u2019ve got a good read in front of you.", "But if reading is not your thing, and you want to just see the code \u2014 please, be welcomed too. Go ahead and scroll to the bottom where I linked the Observable Notebook with code.", "I like to start my design by implementing basic functionality. The zooms, pans, sliders \u2014 the more general they are, the more likely I am to include them in the first step. In my map, the first two things that I wanted to include were the drag and zoom behaviors. I structured them", "With dragstarted(), dragged() and dragend()as helper functions responsible for behavior at the start, during, and at the end of the drag event. But it quickly came to my attention that the default behavior of d3.drag() allows dragging in all directions. In the case of the globe, it was possible to change the roll, pitch, and yaw of the globe and turn the globe to the position where the North is not facing top of the visualization. See what I mean on the gif below.", "Such functionality would introduce unnecessary confusion and distraction. I stopped this by setting the rotation around y axis (or, in more detail, setting the Euler rotation angle \u03b3 to 0).", "I implemented the zooming behavior with d3.zoom(), using the same structure as the dragging behavior. I added one more call that used zoomstarted() , zoomed() and zoomend() helper function to implement behavior at the start, during, and at the and of the zoom.", "As soon as the zoom was present on the chart, it became clear that it will have to be tweaked too. The default d3.zoom() allows for dragging during the zoom. It looked as a redundant distraction, that was quickly fixed with the deletion of a couple of lines.", "With a globe that could be zoomed and dragged around, I was ready to move to the next stage.", "To get started on the wind overlay that will introduce the color to the wind map, I needed the data. Getting the data file with the data was easy, but extracting it was not.", "On the website of the National Oceanic and Atmospheric Administration (NOAA), you can find a Global Forecast System. It gives a forecast for a range of parameters (such as temperature, cloudiness, wind strength and direction) for any place on Earth.", "The data is packed into a GRIB format which is quite tricky to work with. It encodes values for 2-dimensional data on an equally spaced grid. For example, a GRIB file for temperature with a 1-degree resolution would give the temperature for:", "But what makes GRIB files difficult to work with is that they are encoded in binary. Unless you use a separate program or a library to decode it, there is no way to make sense out of the raw GRIB file. This, in turn, introduces a need for a backend decoding and serving decoded GRIB files.", "At first, I was planning on making my visualization automatically download the most recent GFS data from the NOAA website, but the complexity of dealing with GRIB files using only JavaScript cooled down my excitement. I decided to use a static JSON file with the wind data from 2014-01-31T00:00:00.000Z . Why this particular date? It looks like a busy day with a lot of little weather systems going around the planet.", "At first glance, the original color scale from earth.nullschool.net is built from two parts:", "I had a peek at the Github repo of the Wind Map and I was able to find that a lot of logic behind the color scales is hardcoded. I jumped into creating my own color scales and I ended up with three different versions:", "With the color scales ready, there was nothing else left to do other than getting started with the color (generating wind overlay).", "I ended up going through 2 failed attempts to efficiently add colors to the wind map before finding the 3rd one that I ended up using. Each of the three approaches worked, but the first two weren\u2019t efficient enough, and they made the visualization look choppy and unappealing.", "The first attempt was a quick and dirty scan through all the pixels on the chart. I would check whether the pixel was in the visualization. If it was, I would look up its coordinates, estimate the wind strength at that point using Bilinear Interpolation, look up the color, and finally plot the pixel. The process could be described in the following pseudocode:", "This worked, but the rendering was taking ages. Generating the layer during the zoom or drag was simply impossible and it had to be turned off. Even using the super-efficient color scale would not help. You can see the delays in real-time on the gif below:", "I tried to figure out how Cameron Beccario was capable of implementing his wind overlay using a very similar approach and yet have it run efficiently. I wasn\u2019t able to get to the root of it, but one thing that I noticed was that he would look up every other pixel (therefore reducing the time needed to render by half).", "I did not want to be forced to turn the colors off when dragging or zooming. I knew that there must be a way to achieve it and I moved to the next step.", "The logic behind this one was to generate a 2D wind overlay once and save it as an image. Then, on an update, I would call raster reprojection \u2014 that is transforming a map encoded in raster image (like .jpeg or .png) to a different map projection (in our case, the orthographic globe).", "The assumption here was that the reprojecting of an image would be less computationally heavy than regenerating. This turned out to be true. But still not quick enough to allow smooth dragging and zooming. You can see the choppiness yourself on the quick prototype below:", "There was nothing else left at this point but to reach for a battle canon of WebGL \u2014 a JavaScript library allowing GPU accelerated in-browser animation.", "You should use WebGL only when it is absolutely necessary. The library is as efficient as it gets but using it requires mastering development in a C-like code. Luckily, I was able to find a lot of relevant code on some of the public notebooks on Observable. One in particular essentially implemented raster reprojection in WebGL.", "After tweaking the code and making it fit my code structure, I ended with a pleasant surprise \u2014 the quickest and smoothest interaction this far.", "Animated wind particles are what make the wind globe so unforgettable. My first intuition was to find a library that would implement the movement of particles. I came across, the WebGL-based library developed by the Mapbox team. It looked attractive but after a little bit of play it turned out, that its default style is quite ugly, and the design of the library doesn\u2019t allow easy manipulation of colors.", "I decided to build my own wind particle animation logic. It looked more difficult than it actually was. I used an animation loop based on requestAnimationFrame(). At the beginning of each loop, I would make a copy of the old frame with a lower opacity and then draw the new frame on top of it. Repeating this process every frame it creates the desired trail effect", "The animation loop could be summarised with the JavaScript-like pseudocode:", "Then, I would generate randomly 1,000 particles. On each frame, I\u2019d calculate their coordinates, and move them to a new position based on a wind vector in that area. When the age of the particle would exceed the randomly set max_age, I\u2019d reset it to the initial position. In pseudocode, it\u2019d look like this:", "Even though after this stage, the map looked ready, I noticed that the wind particles would travel in an odd way around the poles. They followed a path that was indicative of some kind of edge case scenario happening around poles.", "Figuring out what caused this problem was the single, most difficult part of building this data visualization. The solution turned out to be simple. But at first, I incorrectly dived into trying to estimate the distortion of the orthographic projection and account of it.", "This effect was happening only around the poles. I assumed that this must have been related to my projection . In fact, in the orthographic projection, the closer we get to the poles, the shorter 1 degree of longitude is.", "I mined for distortion equations as far as in a fat textbook titled Map Projections\u2013A Working Manual available at the U.S. Geological Survey. I implemented a fairly complex function that numerically estimated first-order derivatives to get the value of distortion. Looking back \u2014 what an overkill. And it didn\u2019t even solve the issue.", "The solution turned out to be very simple. When moving the particles, I forgot to handle cases when the particles crossed the 180 meridian. Two if statements were enough to fix the issue. The distortion equations could be scrapped.", "In the end, there were some arbitrary parameters to find and set before calling the visualization finished. Luckily, Observable Notebooks allow creating sliders that help to find the value that\u2019s visually pleasing.", "And this is was the destination port.", "Looking back, there were so many places that were only seemingly straightforward. But also, every time I spent extra time to address the unexpected, the visual storytelling significantly improved. Robust zooming and dragging, efficient WebGL-based raster reprojection, and the light-weight particle animation all started with an unexpected setback.", "So now, get yourself a coffee and get back to the work on your data viz!", "Don\u2019t forget to check out the live visualization with code on Observable: https://observablehq.com/@oskarkocol/animated-wind-map", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist with a passion for journalism and non-fiction filmmaking. Shoot me an email at contact@oskiproductions.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F737c7330d80f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----737c7330d80f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@oscr?source=post_page-----737c7330d80f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oscr?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Oskar Kocol"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F144634f946d7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&user=Oskar+Kocol&userId=144634f946d7&source=post_page-144634f946d7----737c7330d80f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://earth.nullschool.net/", "anchor_text": "Wind Map"}, {"url": "https://twitter.com/cambecc", "anchor_text": "Cameron Beccario"}, {"url": "https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs", "anchor_text": "Global Forecast System"}, {"url": "https://en.wikipedia.org/wiki/GRIB", "anchor_text": "GRIB format"}, {"url": "https://earth.nullschool.net/", "anchor_text": "earth.nullschool.net"}, {"url": "https://github.com/cambecc/earth", "anchor_text": "Github"}, {"url": "https://en.wikipedia.org/wiki/WebGL", "anchor_text": "WebGL"}, {"url": "https://blog.mapbox.com/how-i-built-a-wind-map-with-webgl-b63022b5537f", "anchor_text": "the WebGL-based library developed by the Mapbox team"}, {"url": "https://pubs.er.usgs.gov/publication/pp1395", "anchor_text": "Map Projections\u2013A Working Manual available at the U.S. Geological Survey"}, {"url": "https://observablehq.com/@oskarkocol/animated-wind-map", "anchor_text": "https://observablehq.com/@oskarkocol/animated-wind-map"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----737c7330d80f---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/maps?source=post_page-----737c7330d80f---------------maps-----------------", "anchor_text": "Maps"}, {"url": "https://medium.com/tag/visualization?source=post_page-----737c7330d80f---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/tag/d3js?source=post_page-----737c7330d80f---------------d3js-----------------", "anchor_text": "D3js"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----737c7330d80f---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&user=Oskar+Kocol&userId=144634f946d7&source=-----737c7330d80f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&user=Oskar+Kocol&userId=144634f946d7&source=-----737c7330d80f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F737c7330d80f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----737c7330d80f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----737c7330d80f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----737c7330d80f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----737c7330d80f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----737c7330d80f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----737c7330d80f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oscr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oscr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Oskar Kocol"}, {"url": "https://medium.com/@oscr/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "156 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F144634f946d7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&user=Oskar+Kocol&userId=144634f946d7&source=post_page-144634f946d7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F144634f946d7%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdont-over-plan-your-data-visualization-737c7330d80f&user=Oskar+Kocol&userId=144634f946d7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}