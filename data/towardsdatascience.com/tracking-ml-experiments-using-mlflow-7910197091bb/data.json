{"url": "https://towardsdatascience.com/tracking-ml-experiments-using-mlflow-7910197091bb", "time": 1682997155.714138, "path": "towardsdatascience.com/tracking-ml-experiments-using-mlflow-7910197091bb/", "webpage": {"metadata": {"title": "Tracking ML Experiments using MLflow | by Hafidz Zulkifli | Towards Data Science", "h1": "Tracking ML Experiments using MLflow", "description": "If you\u2019re familiar with building machine learning models, either at work or as a hobby; you\u2019ve probably come across the situation where you\u2019ve built tons of different models, having different code\u2026"}, "outgoing_paragraph_urls": [{"url": "https://mlflow.org/docs/latest/index.html", "anchor_text": "documentation", "paragraph_index": 10}, {"url": "https://github.com/ikanez/tracking-mlflow", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://mlflow.org/docs/latest/tracking.html", "anchor_text": "[4]", "paragraph_index": 16}, {"url": "https://mlflow.org/docs/latest/tracking.html#logging-data-to-runs", "anchor_text": "documentation", "paragraph_index": 17}, {"url": "https://www.mlflow.org/docs/latest/python_api/mlflow.sklearn.html#mlflow.sklearn.log_model", "anchor_text": "log_model", "paragraph_index": 29}, {"url": "https://www.mlflow.org/docs/latest/python_api/mlflow.sklearn.html#mlflow.sklearn.save_model", "anchor_text": "save_model", "paragraph_index": 29}, {"url": "https://github.com/ikanez/tracking-mlflow", "anchor_text": "here", "paragraph_index": 37}], "all_paragraphs": ["If you\u2019re familiar with building machine learning models, either at work or as a hobby; you\u2019ve probably come across the situation where you\u2019ve built tons of different models, having different code bases, and tons of graphs or notebooks and metrics that you need to keep track of as you optimize your code and tune your model to move up that accuracy ladder.", "I think over the years as I\u2019ve practiced data science I\u2019ve came across a lot of ways that people tend to deal with this problem. My go to method would usually be an excel sheet. It\u2019s easy to use, easy to visualize and easy to convey to external parties.", "I\u2019ve also seen people that tries to programmatically store the metrics in database tables. But those can get quite messy (not to say that excel sheets aren\u2019t messy in and of itself, but if I need to run a few commands just to add in a new metric \u2014 I\u2019d say it\u2019s rather unsustainable in the long run)", "Things get a little more trickier once you have multiple people working on the same machine learning problem. Some ground rules would need to be set prior to the project execution else tracking will become cumbersome. Mature AI teams would have most likely sorted this problem out, but I\u2019d imagine early stage startups would have some trouble dealing with this coordination work (if they can afford having multiple data scientist working on the same thing that is).", "It is such a big problem, that it has spawned a few companies dedicated to solving JUST this particular issue. Some of the ones that I know of are:", "For the sake of brevity, I won\u2019t be covering what features they actually have, how they works nor their pricing models. Some focuses more on deep learning based experiments while others cover a wider range. The point I\u2019m trying to highlight here is that the problem is big enough that people actually PAY other people for some sort of a solution.", "Notable mentions would be TensorBoard, but it seems to be made explicitly for Tensorflow and deep learning (I\u2019m not a heavy TensorBoard user myself, feel free to share with me what you know in the comment section for the benefit of everyone).", "Another option would be MLflow. Started by Databricks, it\u2019s basically an open source platform for the the entire machine learning lifecycle (taken verbatim from their website).", "Which brings us to the focus of this article \u2014 tracking metrics.", "In my current workplace, one of the heavily used tool that we have at our disposal is Databricks. In recent months, they\u2019ve added MLflow as a feature. As someone who\u2019s been dying to learn how to better keep track of things \u2014 it\u2019s the perfect opportunity to try it out. The context of my walkthrough of MLflow tracking will be based on this (aka, a Databricks user).", "For non-Databricks users, MLflow can be setup separately and connected to your environment. The same functionality should exist. Checkout their documentation for more details.", "To demonstrate how I\u2019m currently using MLflow at work, and why I find it useful \u2014 I\u2019ll be using it on a Kaggle kernel [3] where the author does some data analysis and forecasting experiments using cryptocurrency dataset. Some minor changes to change the original code taken from [3] into Databricks (mostly to be able to visualize the graphs), but essentially it\u2019s pretty much the same.", "Note: I\u2019ve just started to use MLflow recently, so it\u2019s highly likely that I\u2019ll miss out on some things.", "The notebook that I\u2019m using for this post can be referred to here. 2 versions of the notebook are available \u2014 \u201cbefore\u201d denotes the original ported Kaggle kernel to Databricks, while \u201cafter\u201d contains the additional code used for tracking.", "To start an experiment with MLflow, one will first need to use the mlflow.set_experiment command, followed by the path where the experiment file will be stored.", "Next, you can start to think about what do you want to keep track in your analysis/experiment. MLflow categorizes these into 3 main categories:", "MLflow Tracking is organized around the concept of runs, which are executions of some piece of data science code [4]. (moving forward, we\u2019ll denote this concept of run by using an italicized `run`)", "Other things that are/can be tracked at every run are code version, start and end time, and the source file. Refer to the documentation for more details on this.", "In cell 37 of the notebook, the author tries to iteratively explore different combinations of parameters to get the best fit on an ARIMA model to our data. Let\u2019s use this section of the code and track the parameters being used and metrics being generated.", "To start our run, we use the mlflow.start_run(). We then log the qs and ps parameters and model.aic metric to MLFlow. Running the above code will give use the following result in the MLFLow UI.", "If we are to click into one of those run, we\u2019ll be taken to the following window.", "As can be seen above, we\u2019ve only tracked a limited amount of parameters and metric per run. There was no artifact being recorded nor tags. We can opt to add in our own notes if we have any. Other things that are recorded are the Date, the User (in my case it\u2019s my Databricks ID), the Run ID, Duration, and Source.", "The latter is something that I find really useful to have, since it actually commits the notebook that is being run into Git. I\u2019m currently not sure how this translates to the self setup version of MLflow, but in my case clicking on the source link would essentially bring me back to the committed version of the notebook in Databricks (below).", "Following the earlier example, we\u2019ve built multiple models in order to determine the best parameters that we should be using for our ARIMA model. In our next example, we\u2019re going to store a few artifacts which are related to the model; namely the model summary and some plots.", "Let\u2019s do this for our SARIMAX model.", "As can be observed from the above code, logging in artifacts require a bit more work than usual. Instead of being able to directly save the plots into MLflow, the file will first have to be stored somewhere first before it could be sent to MLflow\u2019s S3 bucket.", "In my case, the files are first saved into the local Databricks cluster, and later copied over to MLflow\u2019s S3 bucket (which is also within Databricks in this case. Alternatively one can also define an external S3 bucket for each experiment and store all related files there.)", "For reference, below are how the stored artifacts are displayed in the UI.", "For me this rather simplify and standardizes the collection of plots and summaries that one would normally just store in a notebook. While having them exist in notebook is OK, the fact that notebooks can be run by cell and not run in it\u2019s entirety from top to bottom means that certain plots can in fact be generated as a result of an operation that happens much later in time (or one that could\u2019ve been removed altogether during development). Since the plots stored in MLflow are tied back to a committed code in Git, we now have a much better way to ensure that experiments and their result are being documented in a reproducible manner.", "MLflow also allows you to save the model being trained. This can be done either by logging it in as an artifact to MLflow (via log_model() ) or directly to a local file system (via save_model).", "One of my favourite feature for MLflow is it\u2019s metrics visualization. To best highlight it, I\u2019ll be using the final bit of the kernel [3] and change it to also monitor the performance of the best model when deployed to run over a period of time (ie. sliding window validation).", "In the above example we establish a time window of 3 months and evaluate the RMSE score of the model over a time period of 10 sliding windows, where each move forward is of 1 month. At each evaluation, we also log the comparison plot to MLflow for future reference and verification.", "Diving into the RMSE metrics, we can see how it performed over time as it slides across the time horizon over 10 time steps. We can see that the model is generally stable for some time until spikes at the 5th iteration. This is rather expected if we refer back to how volatile the Bitcoin price is in the above diagram.", "Over the course of this post, I\u2019ve talked about the problem that is being faced by every machine learning practitioners out there \u2014 how does one neatly organize and keep track of the multiple modelling experiments results.", "MLflow is one of the many tools that one can use to achieve this. In this article, I highlighted several of its features by running on few examples of how it can be used to aid data science practitioners in the daily modelling routine.", "In the short term, having results that are well managed helps with team communication and collaboration \u2014 something that is crucial especially for teams that are based remotely.", "In the long run, proper governance of modelling activities and their deliverables goes a long way to help retain learned knowledge and findings, reducing errors and ensures that past research and result can be reproduced by other teams or their replacements.", "The code used in this post are available in my github here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7910197091bb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://hafidz.medium.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": ""}, {"url": "https://hafidz.medium.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Hafidz Zulkifli"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9d98e8dadfc2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&user=Hafidz+Zulkifli&userId=9d98e8dadfc2&source=post_page-9d98e8dadfc2----7910197091bb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@elevatebeer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Elevate"}, {"url": "https://unsplash.com/search/photos/experiment?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://medium.com/@u39kun/managing-your-machine-learning-experiments-and-making-them-repeatable-in-tensorflow-pytorch-bc8043099dbd", "anchor_text": "[1]"}, {"url": "https://neptune.ml/", "anchor_text": "https://neptune.ml/"}, {"url": "https://www.wandb.com/", "anchor_text": "https://www.wandb.com/"}, {"url": "https://www.comet.ml/", "anchor_text": "https://www.comet.ml/"}, {"url": "https://www.slideshare.net/databricks/mlflow-infrastructure-for-a-complete-machine-learning-life-cycle", "anchor_text": "[2]"}, {"url": "https://mlflow.org/docs/latest/index.html", "anchor_text": "documentation"}, {"url": "https://github.com/ikanez/tracking-mlflow", "anchor_text": "here"}, {"url": "https://mlflow.org/docs/latest/tracking.html", "anchor_text": "[4]"}, {"url": "https://mlflow.org/docs/latest/tracking.html#logging-data-to-runs", "anchor_text": "documentation"}, {"url": "https://www.mlflow.org/docs/latest/python_api/mlflow.sklearn.html#mlflow.sklearn.log_model", "anchor_text": "log_model"}, {"url": "https://www.mlflow.org/docs/latest/python_api/mlflow.sklearn.html#mlflow.sklearn.save_model", "anchor_text": "save_model"}, {"url": "https://github.com/ikanez/tracking-mlflow", "anchor_text": "here"}, {"url": "https://www.forbes.com/sites/camilomaldonado/2019/02/05/marie-kondo-financial-goals/#24ec9d843091", "anchor_text": "source"}, {"url": "https://medium.com/@u39kun/managing-your-machine-learning-experiments-and-making-them-repeatable-in-tensorflow-pytorch-bc8043099dbd", "anchor_text": "https://medium.com/@u39kun/managing-your-machine-learning-experiments-and-making-them-repeatable-in-tensorflow-pytorch-bc8043099dbd"}, {"url": "https://www.slideshare.net/databricks/mlflow-infrastructure-for-a-complete-machine-learning-life-cycle", "anchor_text": "https://www.slideshare.net/databricks/mlflow-infrastructure-for-a-complete-machine-learning-life-cycle"}, {"url": "https://www.kaggle.com/taniaj/cryptocurrency-price-forecasting", "anchor_text": "https://www.kaggle.com/taniaj/cryptocurrency-price-forecasting"}, {"url": "https://mlflow.org/docs/latest/tracking.html#concepts", "anchor_text": "https://mlflow.org/docs/latest/tracking.html"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7910197091bb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/mlflow?source=post_page-----7910197091bb---------------mlflow-----------------", "anchor_text": "Mlflow"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7910197091bb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----7910197091bb---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/ai?source=post_page-----7910197091bb---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&user=Hafidz+Zulkifli&userId=9d98e8dadfc2&source=-----7910197091bb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&user=Hafidz+Zulkifli&userId=9d98e8dadfc2&source=-----7910197091bb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7910197091bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7910197091bb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7910197091bb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7910197091bb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7910197091bb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7910197091bb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7910197091bb--------------------------------", "anchor_text": ""}, {"url": "https://hafidz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://hafidz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Hafidz Zulkifli"}, {"url": "https://hafidz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "630 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9d98e8dadfc2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&user=Hafidz+Zulkifli&userId=9d98e8dadfc2&source=post_page-9d98e8dadfc2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb889603551d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftracking-ml-experiments-using-mlflow-7910197091bb&newsletterV3=9d98e8dadfc2&newsletterV3Id=b889603551d0&user=Hafidz+Zulkifli&userId=9d98e8dadfc2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}