{"url": "https://towardsdatascience.com/how-to-compare-large-files-f58982eccd3a", "time": 1683005159.911829, "path": "towardsdatascience.com/how-to-compare-large-files-f58982eccd3a/", "webpage": {"metadata": {"title": "How to Compare Large Files. Learn how to use Python to compare big\u2026 | by Costas Andreou | Towards Data Science", "h1": "How to Compare Large Files", "description": "Comparing large files that cannot be held in memory with Python, through SQL"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["In this blog, we are going to learn how to compare two large files together while creating a quick and meaningful summary of the differences. I\u2019ve structured this blog in such a way that you can follow a step by step guide in the end to end solution.", "In general, comparing two data sets is not very difficult. The main difficulty comes from being able to gain quick, meaningful insights. Although the aforementioned difficulty can be solved quickly with the likes of a pre-existing comparison library such as dataComPy, the problem is amplified when the data becomes so large, that it cannot be held into memory.", "To my disappointment, I could not find an existing data comparison library that would handle larger data sets. All the ones I found required all of the data to be in memory.", "Seeing this as a problem to be solved, I began looking into the best way to solve this problem.", "To help identify the solution, I started by clearly defining the problem. I wanted to be able to compare large files. The problem was that the data was so big that I couldn\u2019t hold all of it in memory. I also wanted the solution to be a simple one.", "A problem well stated is a problem half solved.", "One way I considered of solving this problem was to partially load things in memory. That would imply comparing data that was in memory; parking what was matched and what wasn\u2019t (off-memory), and then moving onto more data. These types of operations are a complete logistical nightmare, with complex logic of keeping track of everything.", "I was hoping that there would have been an easier way of doing things. Hold and behold; another idea came to me. What if I used a SQL database to carry out all my comparisons.", "After all, isn\u2019t that the primary purpose of databases? Hold data and carry out data-centric operations quickly?", "I wanted the results of the comparison to be easy to digest and provide meaningful insights. That meant that I was more interested in a quick summary, and some example comparison breaks. I could always deep-dive into the data if I needed to.", "Before we run the full comparison, we should quickly see if the files are 100% alike. To do that, we can do a checksum.", "Looking into the above script closely, we essentially load the files line by line and work out their SHA1 output. This is then compared between the two files.", "To run the above script, we simply have to pass in:", "Assuming there are differences between the files, then we would like to know whether the differences are in the number of records or their values. Hence we can look into doing some quick counts.", "To begin with, we need to load the data into SQL without exceeding our available memory and create indexes to speed up our query operations.", "From the below script, you can see that we first need to define our inputs:", "The only other thing to note from the below script is that we are loading the file chunk by chunk to avoid running out of memory, and we are replacing any column spaces with underscores.", "Given the data is now all loaded into the SQL DB, the next thing to do is carry out the counts. To control the execution and output of our commands, we can create a function we can call.", "And with the above set up, we can now begin our comparison operations.", "It is now time that we leverage all of the functions we have defined this far in our programme, to start building a data comparison summary. Let us then get a glimpse through the total counts by defining a new function that we can call.", "At this point, we know the two files are not matching 100%, and we also know the counts of each file. We now need to look a bit deeper and understand if any of the entries are not matching on our pre-defined key.", "That is, we need to do a FULL OUTER JOIN, and highlight records that are either not in one file or the other (as per our pre-defined key). Technically speaking, the SQL query to do this sort of join is not complex; however, as we want the query to be generated automagically from our inputs, we need to get creative.", "To do so, I have employed a loop and f strings. Let us look at this in more detail.", "We achieve the full outer join, by doing a LEFT and RIGHT join, highlighting orphaned entries at each point.", "Next up, is a columns check. We want to know if any of the files have differences in their headers.", "We can retrieve headers in SQLite through PRAGMA command, so this is relatively straight forward.", "The only thing worth highlighting here is the employment of the subtraction operation on Sets, which allows me to compare lists quickly.", "Following the above checks, we now want to start exploring some of the value differences. To do so, we first want to determine the columns in common between the two files, which will then allow us to compare them.", "To help me test the above script and showcase the results, I have taken a sample data file, cloned it and made some changes. You can see the differences here:", "You can see that I changed one value under the header construction, and removed one of the columns.", "Running the script, returned the following:", "In conclusion, the above script allows you to compare large data sets together that you wouldn\u2019t be able to hold in memory while providing you with a nice summary view at the end.", "It could easily be extended in the future in the following ways:", "I will endeavour to extend this if I continue to use it, but please feel free to extend it yourselves or comment your suggestions.", "If you liked this story, you might also like:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A technologist with domain expertise in Investment Banking"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff58982eccd3a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@costasandreou?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@costasandreou?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Costas Andreou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15d64a735e3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&user=Costas+Andreou&userId=15d64a735e3e&source=post_page-15d64a735e3e----f58982eccd3a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/building-a-python-ui-for-comparing-data-13c10693d9e4", "anchor_text": "Building a Python UI for Comparing DataHow to quickly enable your non-technical team to compare datatowardsdatascience.com"}, {"url": "https://towardsdatascience.com/an-introduction-to-sql-4c9eb27995df", "anchor_text": "An Introduction to SQLLearn the basics of SQL with examplestowardsdatascience.com"}, {"url": "https://medium.com/financeexplained/3-quick-ways-to-compare-data-in-python-65201be10b6", "anchor_text": "3 Quick Ways To Compare Data in PythonFor anyone working in an analytical role, receiving requests to compare data will be all too familiar. Whether that is\u2026medium.com"}, {"url": "https://unsplash.com/@hishahadat?utm_source=medium&utm_medium=referral", "anchor_text": "Shahadat Rahman"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@clark_fransa?utm_source=medium&utm_medium=referral", "anchor_text": "Arnold Francisca"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/building-a-python-ui-for-comparing-data-13c10693d9e4", "anchor_text": "Building a Python UI for Comparing DataHow to quickly enable your non-technical team to compare datatowardsdatascience.com"}, {"url": "https://medium.com/financeexplained/3-quick-ways-to-compare-data-in-python-65201be10b6", "anchor_text": "3 Quick Ways To Compare Data in PythonFor anyone working in an analytical role, receiving requests to compare data will be all too familiar. Whether that is\u2026medium.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f58982eccd3a---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----f58982eccd3a---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----f58982eccd3a---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/python?source=post_page-----f58982eccd3a---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/startup?source=post_page-----f58982eccd3a---------------startup-----------------", "anchor_text": "Startup"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&user=Costas+Andreou&userId=15d64a735e3e&source=-----f58982eccd3a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&user=Costas+Andreou&userId=15d64a735e3e&source=-----f58982eccd3a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff58982eccd3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f58982eccd3a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f58982eccd3a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f58982eccd3a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f58982eccd3a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@costasandreou?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@costasandreou?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Costas Andreou"}, {"url": "https://medium.com/@costasandreou/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.6K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15d64a735e3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&user=Costas+Andreou&userId=15d64a735e3e&source=post_page-15d64a735e3e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Faf5027b2ca6d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compare-large-files-f58982eccd3a&newsletterV3=15d64a735e3e&newsletterV3Id=af5027b2ca6d&user=Costas+Andreou&userId=15d64a735e3e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}