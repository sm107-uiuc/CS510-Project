{"url": "https://towardsdatascience.com/training-models-on-imbalanced-data-561fa3f842b5", "time": 1683014814.7856379, "path": "towardsdatascience.com/training-models-on-imbalanced-data-561fa3f842b5/", "webpage": {"metadata": {"title": "Training models on imbalanced data | by Gabriela Zarzar Gandler | Towards Data Science", "h1": "Training models on imbalanced data", "description": "Class imbalance is when the number of samples is different for the different classes in the data. In real-world applications of machine learning, it\u2019s very common to encounter datasets with various\u2026"}, "outgoing_paragraph_urls": [{"url": "https://doi.org/10.1016/j.ipm.2009.03.002", "anchor_text": "[1]", "paragraph_index": 15}, {"url": "https://doi.org/10.1109/TKDE.2008.239", "anchor_text": "[2]", "paragraph_index": 17}, {"url": "https://dl.acm.org/doi/10.1145/1143844.1143874", "anchor_text": "[3]", "paragraph_index": 17}, {"url": "https://doi.org/10.1016/j.ipm.2009.03.002", "anchor_text": "A systematic analysis of performance measures for classification tasks", "paragraph_index": 20}, {"url": "https://ieeexplore.ieee.org/author/37291665900", "anchor_text": "H. He", "paragraph_index": 21}, {"url": "https://ieeexplore.ieee.org/author/37534980900", "anchor_text": "E. A. Garcia", "paragraph_index": 21}, {"url": "https://doi.org/10.1109/TKDE.2008.239", "anchor_text": "Learning from Imbalanced Data", "paragraph_index": 21}, {"url": "https://dl.acm.org/doi/10.1145/1143844.1143874", "anchor_text": "The Relationship Between Precision-Recall and ROC Curves", "paragraph_index": 22}], "all_paragraphs": ["Class imbalance is when the number of samples is different for the different classes in the data. In real-world applications of machine learning, it\u2019s very common to encounter datasets with various degrees of class imbalance: from moderate imbalance \u2014 e.g. medical images where 10% are diagnosed with having a disease and 90% are not \u2014 to extreme imbalance \u2014 e.g. anomaly detection in an industrial plant, where perhaps 1 out of 10,000 batches fails.", "Most models trained on imbalanced data will have a bias towards predicting the larger class(es) and, in many cases, may ignore the smaller class(es) altogether. When a class imbalance exists within the training data, machine learning models will typically over-classify the larger class(es) due to their increased prior probability.", "As a result, the instances belonging to the smaller class(es) are typically misclassified more often than those belonging to the larger class(es). In many use cases, such as medical diagnosis, this is exactly the opposite of what we want to achieve, as it is very common that the rare class (e.g. a disease) is the most important class to predict correctly. To achieve this, we need to handle the class imbalance in some way when training a model.", "Class imbalance is easily identified by looking at the distribution of the target class within your data. In the Peltarion platform, a histogram shows the distribution, located above each column on the Dataset view.", "If you notice a non-uniform distribution of the column that you intend the model to predict, then you have an imbalanced class problem and need to take some actions to handle it.", "Classification in a scenario where the proportions of each class are significantly different is problematic because a predictive model can usually reach a high accuracy by simply \u201cguessing\u201d that all new examples belong to the most common class as observed in the training data. Since accuracy is what we are usually optimizing for \u2014 often indirectly via categorical cross-entropy loss \u2014 we will very often find trivial majority-guess models. For example, if only 5% of all houses are affected by water damage, we can construct a model that guesses that no house ever gets water damage and still obtain an accuracy of 95%. While 95% is a pleasantly high proportion, this model will probably not do what it is intended to, i.e. distinguish well between houses that get water damage from those that don\u2019t.", "From a neural network perspective, this can be understood in the following alternative way. If we have a batch size of 20 in the above 95/5 water damage case, on average only one example will be from the positive class. The gradient update for the batch in question will then \u201csee\u201d 19 negative examples and one positive example, making it hard for the one positive example to affect the gradient\u2019s direction.", "There are different methods that can be used to handle the class imbalance problem. They can typically be divided into data-level and algorithm-level methods.", "Data-level methods modify the training distribution to decrease the level of imbalance. This enables gradient updates, on average, to \u201csee\u201d a similar number of examples from each class.", "Algorithm-level methods adjust the learning process so that the importance of the smaller classes is increased during training time. A common way of doing this is by using class weights in the loss function.", "During model training, a total loss is computed for each batch, and the model parameters are then iteratively updated in a direction that reduces this loss. The loss is the error between the ground truth and the model\u2019s prediction, summed over all the samples in the batch. By default, each sample counts equally into this total loss. However, with class weighting the sum is adjusted to a weighted sum instead so that each sample contributes to the loss proportionally to the sample\u2019s class weight.", "In this way, samples belonging to the smaller class(es) can be given a higher contribution to the total loss. This in turn means that the learning algorithm will focus more on them when the parameter update is performed. Referring back to the neural network-centric explanation given above, a high class weight on the positive class would afford the single positive example in the batch the \u201cpower\u201d to affect the gradient update.", "A common approach is to assign class weights which are inversely proportional to the class frequencies in the training data. This corresponds to giving all the classes equal importance on gradient updates, on average, regardless of how many samples we have from each class in the training data. This in turn prevents models from over-classifying the larger class(es) simply based on their increased prior probability.", "The Peltarion platform supports class weighting \u2014 the weights are set according to the strategy above. This is what you need to do to enable it: in the modeling view, click on your Target block and then check the \u201cUse class weights\u201d checkbox. That\u2019s it!", "When working with imbalanced data, we don\u2019t recommend using categorical accuracy as the main evaluation measure. It is not unusual to observe a high evaluation accuracy when testing a classification model trained on very imbalanced data. In such cases, the accuracy is only reflecting the underlying class distribution. You want to avoid that!", "In this context, it is useful to distinguish between micro and macro averaging. These are very useful concepts for measuring performance right. So here we go [1]:", "Hence micro-average gives the same importance to each sample, This means that, the more the number of samples, the more impact the corresponding class has on the final score, thus favoring majority classes. The macro-average, instead, gives every class the same importance, and therefore better reflects how well the model performs \u2014 considering that you aim at having a model that performs well on ALL classes, including the minority classes.", "Instead of accuracy, other measures are frequently used in the research community to evaluate models trained on imbalanced data, namely precision, recall and F1-score [2]. As mentioned before, give preference to macro-averaged precision, recall and F1-scores, as opposed to the micro-averaged counterparts. Particularly for binary classification problems, make use of the ROC-AUC score or \u2014 even more suited to imbalanced datasets \u2014 the PR-AUC score [3]. In the Peltarion platform, you can inspect all these measures in the Evaluation view to assess your models.", "Finally, a confusion matrix is an essential evaluation tool for such problems. See below confusion matrices that evaluate BERT classification models trained on a dataset with lyrics from different music styles, for the histograms shown above: in Figure 3, the model was trained on the original data (which is significantly imbalanced), while in Figure 4 (off-platform) oversampling was used to balance the classes before the model was trained. Notice how the class \u201crock\u201d, the majority class in the imbalanced data, was dominating the predictions. After training the model on the fairly balanced data, the confusion matrix presented a stronger diagonal, showing that handling data imbalance improves overall classification performance.", "Now you are all set to:", "[1] M. Sokolova, G. Lapalme, A systematic analysis of performance measures for classification tasks (2009), Information Processing & Management", "[2] H. He, E. A. Garcia, Learning from Imbalanced Data (2009), IEEE Transactions on Knowledge and Data Engineering", "[3] J. Davis, M. Goadrich, The Relationship Between Precision-Recall and ROC Curves (2006), ICML \u201906: Proceedings of the 23rd international conference on Machine learning", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior ML Data Scientist at King. Worked with ML in fields including robotic perception, fashion imagery and semantic textual similarity. Forr\u00f3 dancer."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F561fa3f842b5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@gabriela_20657?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gabriela_20657?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Gabriela Zarzar Gandler"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3edd145a8e49&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&user=Gabriela+Zarzar+Gandler&userId=3edd145a8e49&source=post_page-3edd145a8e49----561fa3f842b5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://platform.peltarion.com/", "anchor_text": "Peltarion platform"}, {"url": "https://platform.peltarion.com/", "anchor_text": "Peltarion platform"}, {"url": "https://peltarion.com/knowledge-center/documentation/modeling-view/build-an-ai-model/image-augmentation", "anchor_text": "these techniques"}, {"url": "https://doi.org/10.1016/j.ipm.2009.03.002", "anchor_text": "[1]"}, {"url": "https://doi.org/10.1109/TKDE.2008.239", "anchor_text": "[2]"}, {"url": "https://dl.acm.org/doi/10.1145/1143844.1143874", "anchor_text": "[3]"}, {"url": "https://platform.peltarion.com/", "anchor_text": "Peltarion platform"}, {"url": "https://platform.peltarion.com/", "anchor_text": "Peltarion platform"}, {"url": "https://doi.org/10.1016/j.ipm.2009.03.002", "anchor_text": "A systematic analysis of performance measures for classification tasks"}, {"url": "https://ieeexplore.ieee.org/author/37291665900", "anchor_text": "H. He"}, {"url": "https://ieeexplore.ieee.org/author/37534980900", "anchor_text": "E. A. Garcia"}, {"url": "https://doi.org/10.1109/TKDE.2008.239", "anchor_text": "Learning from Imbalanced Data"}, {"url": "https://dl.acm.org/doi/10.1145/1143844.1143874", "anchor_text": "The Relationship Between Precision-Recall and ROC Curves"}, {"url": "https://medium.com/tag/imbalanced-data?source=post_page-----561fa3f842b5---------------imbalanced_data-----------------", "anchor_text": "Imbalanced Data"}, {"url": "https://medium.com/tag/class-imbalance?source=post_page-----561fa3f842b5---------------class_imbalance-----------------", "anchor_text": "Class Imbalance"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&user=Gabriela+Zarzar+Gandler&userId=3edd145a8e49&source=-----561fa3f842b5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&user=Gabriela+Zarzar+Gandler&userId=3edd145a8e49&source=-----561fa3f842b5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F561fa3f842b5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----561fa3f842b5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----561fa3f842b5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----561fa3f842b5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----561fa3f842b5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gabriela_20657?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gabriela_20657?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gabriela Zarzar Gandler"}, {"url": "https://medium.com/@gabriela_20657/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3edd145a8e49&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&user=Gabriela+Zarzar+Gandler&userId=3edd145a8e49&source=post_page-3edd145a8e49--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F642155175607&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-models-on-imbalanced-data-561fa3f842b5&newsletterV3=3edd145a8e49&newsletterV3Id=642155175607&user=Gabriela+Zarzar+Gandler&userId=3edd145a8e49&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}