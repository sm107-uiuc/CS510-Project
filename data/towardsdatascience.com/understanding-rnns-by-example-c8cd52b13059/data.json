{"url": "https://towardsdatascience.com/understanding-rnns-by-example-c8cd52b13059", "time": 1682997367.256325, "path": "towardsdatascience.com/understanding-rnns-by-example-c8cd52b13059/", "webpage": {"metadata": {"title": "Understanding RNNs by Example. Training Your PyTorch Model to Count | by David Heffernan | Towards Data Science", "h1": "Understanding RNNs by Example", "description": "One of the toughest tasks of becoming a machine learning practitioner is understanding intuitively the magic behind a model. It\u2019s common to believe you need to be a math savant to fully grasp the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.fast.ai/", "anchor_text": "fast.ai", "paragraph_index": 2}, {"url": "https://drive.google.com/file/d/1kTJc-73djl6mmGdNZjQxFJqJjXvBlGQC/view?usp=sharing", "anchor_text": "train.txt", "paragraph_index": 8}, {"url": "https://drive.google.com/file/d/1bdwi4_tSiuXmC0qpDpr3t5-q6O_B3sBr/view?usp=sharing", "anchor_text": "valid.txt", "paragraph_index": 8}, {"url": "https://www.youtube.com/watch?v=Bl6WVj6wQaE&list=PLtmWHNX-gukKocXQOkQjuVxglSDYWsSh9&index=15", "anchor_text": "fast.ai", "paragraph_index": 14}, {"url": "https://www.fast.ai/2019/07/08/fastai-nlp/", "anchor_text": "A Code-First Introduction to Natural Language Processing", "paragraph_index": 21}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai", "paragraph_index": 21}], "all_paragraphs": ["One of the toughest tasks of becoming a machine learning practitioner is understanding intuitively the magic behind a model. It\u2019s common to believe you need to be a math savant to fully grasp the underlying mechanics, but all you really need is to walk through a few basic examples. Mastering simple models will give you the foundations needed to fall back on as complexity grows.", "There are a lot of great articles that talk at a high level about how an RNN functions, so I have geared this lesson towards those that are interested in actually implementing a concrete example for themselves.", "Many of the ideas and illustrations in this article are derived from fast.ai and their course in NLP.", "Traditional feedforward networks take in a fixed size input and produce a fixed size output. This works great when you have tabular data with a constant number of columns, but is not much use when you have sequences of variable length such as audio, time-series, or, in our example, text.", "The magic of an RNN is the way that it combines the current input with the previous or hidden state. This hidden state can simply be thought of as the memory or the context of the model. If I asked you to predict the next word in a sentence if the current word is \u2018hot\u2019, it would be impossible to make an accurate guess. If you had some memory more than the current input, such as \u2018I ate a hot\u2019 you could make a much better guess that the next word would be \u2018dog\u2019.", "It is amazing the power of RNNs given their simplicity. RNNs are just a loop of adding their memory with the current input and sending that combined value through a linear layer to calculate the next step of memory. After computing the hidden state for each step of input, the hidden state gets sent through an output layer to make the final prediction. Here is the pseudocode of this loop:", "For this tutorial, we will teach our RNN to count in English. For example, if our input is:", "then the next word in the sequence would be \u2018thousand\u2019.", "To start we need to load in train.txt and valid.txt files that have numbers written out from 1 to 8000 and 8000 to 9999 respectively. We will load these files into a list of strings, build our vocabulary by making a set of the strings, and then construct a mapping from each string to an integer.", "When training our model we want the output to be 1 step ahead of the input. For example, if the current input is \u2018two\u2019 then the output should be \u2018,\u2019.", "This iterator will first generate 2d lists of shape (bs,bptt) where bs stands for the batch size and bptt stands for back propagation through time or essentially the number of words in a sequence. Once we generate these lists we map the token to its corresponding integer using the dictionary we built in the previous step. Finally, we convert the 2d lists to torch tensors so that our model can process them.", "While PyTorch has a dedicated RNN layer we will essentially recreate that layer with our loop so that we can grasp more intuitively the order of our layers. Our model will be constructed of 4 unique layers:", "Once we have the model built, training the model is rather boilerplate code. However, I will discuss some details about our training loop.", "We can refactor the above model using PyTorch\u2019s native RNN layer to get the same results as above. In practice, you should use the native layer as it is simpler to work with and runs a bit faster due to some GPU optimizations.", "While our demonstration above shows that RNNs can be effective with sequence data, they struggle with long term dependencies. GRUs (gated recurrent units) function very similarly to RNNs but are smarter in deciding how much the current input should impact the current state. I\u2019ll be writing an article soon about GRUs, but in the meantime, I would recommend this lecture by fast.ai.", "By using a GRU rather than RNN we can bump our accuracy from just above 50% to 95%.", "We use our validation list which consists of numbers 8001\u20139999 and randomly select a sequence of 20 tokens. When I ran the code, I sampled the following input sequence:", "We run this input into our model to predict the next token. After predicting that token we then appending it to the input to predict another token. We repeat this input \u2192 prediction \u2192 concatenation \u2192 input sequence for 20 steps.", "With the same input string as above, we get the following output:", "Now when predicting 20 tokens with a 95% accuracy we will only get the right output 36% of the time. Empirically, using the training set, I get the right output about 80% of the time and about 45% of the time using the validation", "Hopefully, now you have a better understanding of how an RNN works, but I don\u2019t expect you to fully grasp all of the details. With that said I have a lot of suggestions for how to strengthen your understanding:", "J. Howard, R. Thomas, A Code-First Introduction to Natural Language Processing (2019), fast.ai", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Entering my junior year in the M&T program at UPenn Studying CS, Finance, and Statistics. Enjoys all aspects of technology with a concentration towards AI."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc8cd52b13059&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@davidheffernan_99410?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidheffernan_99410?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "David Heffernan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F41262b929328&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&user=David+Heffernan&userId=41262b929328&source=post_page-41262b929328----c8cd52b13059---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai"}, {"url": "https://drive.google.com/file/d/1kTJc-73djl6mmGdNZjQxFJqJjXvBlGQC/view?usp=sharing", "anchor_text": "train.txt"}, {"url": "https://drive.google.com/file/d/1bdwi4_tSiuXmC0qpDpr3t5-q6O_B3sBr/view?usp=sharing", "anchor_text": "valid.txt"}, {"url": "https://arxiv.org/pdf/1805.11604.pdf", "anchor_text": "optimization landscape significantly smoother"}, {"url": "https://www.youtube.com/watch?v=Bl6WVj6wQaE&list=PLtmWHNX-gukKocXQOkQjuVxglSDYWsSh9&index=15", "anchor_text": "fast.ai"}, {"url": "https://www.fast.ai/2019/07/08/fastai-nlp/", "anchor_text": "fasti.ai"}, {"url": "https://www.coursera.org/learn/nlp-sequence-models", "anchor_text": "deeplearning.ai"}, {"url": "https://www.fast.ai/2019/07/08/fastai-nlp/", "anchor_text": "A Code-First Introduction to Natural Language Processing"}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c8cd52b13059---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/rnn?source=post_page-----c8cd52b13059---------------rnn-----------------", "anchor_text": "Rnn"}, {"url": "https://medium.com/tag/nlp?source=post_page-----c8cd52b13059---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----c8cd52b13059---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----c8cd52b13059---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&user=David+Heffernan&userId=41262b929328&source=-----c8cd52b13059---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&user=David+Heffernan&userId=41262b929328&source=-----c8cd52b13059---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc8cd52b13059&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c8cd52b13059---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c8cd52b13059--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c8cd52b13059--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c8cd52b13059--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidheffernan_99410?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@davidheffernan_99410?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "David Heffernan"}, {"url": "https://medium.com/@davidheffernan_99410/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "56 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F41262b929328&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&user=David+Heffernan&userId=41262b929328&source=post_page-41262b929328--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb939c51828e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-rnns-by-example-c8cd52b13059&newsletterV3=41262b929328&newsletterV3Id=b939c51828e6&user=David+Heffernan&userId=41262b929328&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}