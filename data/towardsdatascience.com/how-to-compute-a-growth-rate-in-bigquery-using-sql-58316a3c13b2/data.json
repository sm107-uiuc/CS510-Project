{"url": "https://towardsdatascience.com/how-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2", "time": 1683017832.642105, "path": "towardsdatascience.com/how-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2/", "webpage": {"metadata": {"title": "How to compute a growth rate in BigQuery using SQL | Towards Data Science", "h1": "How to compute a growth rate in BigQuery using SQL", "description": "Leverage the power of BigQuery, SQL, and Data Studio to grow your business and learn how to calculate and monitor revenue growth month-over-month by following this tutorial"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["For some use cases, it\u2019s important to monitor the change of a specific variable over a period of time. A common example would be to monitor revenue month-over-month to understand the growth of a business and measure the impact of, for example, special marketing efforts, a limited time offer, giveaways, changes in pricing, etc\u2026", "Besides, it does not only apply to revenue. A long list of potential variables exists:", "From experience, it\u2019s not easy to find a good and easy method in SQL. Lots of them are using exhaustive grouping and joining clauses, complex date filtering or indexing, and even sometimes, methods or functions that are not present in all SQL dialects.", "So if you are interested in understanding an efficient and easy method to achieve this calculation, you are definitely in the right place! \ud83d\ude0e", "In this article, we will be computing a month-over-month revenue growth rate, based on the Google Merchandise shop data. It\u2019s one of the most common examples we pick here, but the method can work for any variable other than revenue. It can be used for understanding user growth or price changes and more\u2026", "It is the same for the time period, we are executing our example over a monthly period but it can be days, weeks, or years.", "Our solution will be using navigation functions. They are functions that allow us to compute or get a value over a group of rows and return a single result for each row. It\u2019s like traveling or browsing over a single table without performing joins or grouping over dimensions.", "To know more about navigation functions, you can have a look here \ud83d\udc47\ud83c\udffc", "For this experiment, we are using Google Analytics sample data from the public BigQuery data set. You can get more information and access it by following this link \ud83d\udc47\ud83c\udffc", "You can try the following queries assuming that you have already:", "Here is the full code below on gist, that we will explain step by step:", "First, we would like to get our specific variable (in this case revenue) aggregated by our desire time period (in this case on a monthly basis).", "The above query returns a table with the revenue generated by the online shop every month.", "By using the \u201cEXPLORE DATA\u201d button between the query editor and the result table, we can display nicely on Data Studio the monthly revenue as follow:", "That\u2019s only the first step, but it\u2019s a good start, hang on \ud83d\ude05", "To compute the growth rates, we will use navigation functions and more precisely the LAG() function. If you know it already you can jump directly to step #3, if you are not familiar with these functions, we will explain its mechanism in the next step to fully understand our process.", "We are using PARSE_DATE() to change the format of the date because the original Google Analytics format is YYYYMMDD. In this case, the function will return a DATE type with a standard YYYY-MM-DD format.", "We then apply a DATE_TRUNC(), to extract the monthly part of the date, like a %Y-%m format, and get the revenue per month.", "We are converting the revenue because this field is expressed as the value passed to Analytics multiplied by 10\u2076 (e.g., 2.40 would be given as 2400000), we need then to divide it by 1000000. Note that this format is really specific to google analytics data in BigQuery.", "Grouping by 1 means that we actually perform the grouping by the first column regardless of its name.", "To compute the growth rate, we are using the relative change formula which is defined by the following:", "But what does it mean for us?", "In our case, the final value is therevenue from our current month, and the initial value is therevenue from the previous month (or previous row), and that\u2019s why windowing functions will be really helpful in this case.", "The LAG() function is not that hard, I promise \ud83d\ude0e", "It is a function, that returns the value of the wanted variable from a preceding row.", "It is a function that requires an ORDER BY clause in the OVER() statement. It is usually used as LAG(variable,offset) where:", "For readability, we write the previous query inside a WITH clause, we also remove the first ORDER BY which was just to nicely display the previous table.", "After running this query, we obtain the following output:", "As you can see on the output, on the same row, we have the revenue for the current month and the last_month_revenue which is the revenue value from the previous month (which is our preceding row here).", "As said, the LAG() function use as input the column containing our desire variable (revenue), and an OFFSET that you can define (by default 1, meaning the first previous row)", "Changing the offset value changes which preceding row is returned. The default value is 1, indicating that it will pick the previous row. This is why we write it without filling an offset in our example.", "Now that we have our relative change formula, and understood the use of the LAG() function, we need to write our final query expressing the formula in SQL:", "The first WITH clause doesn\u2019t change. Under the \u201c \u2014 Main Query\u201d comment, we only replace our previous last_month_revenue by the relative change formula. This gives us pretty much the same output:", "That\u2019s how we get the month-over-month growth rate! \ud83c\udf7b It is then ready to be displayed on Data studio.", "As a reminder, we use ((final value \u2014 initial value) / initial value) * 100", "revenue = Final value, which is the value of our current month.", "LAG(revenue)OVER(ORDER BY months ASC) = Initial value, the value of our previous month.", "Here, we just convert the formula using our SQL syntax and fields.", "To have a cleaner result, we round the output applying ROUND(value,2) to limit the number to two decimals.", "We can then use Datastudio to display our results, which gives us a nice overview of our revenue changes month-over-month:", "This method can be used on any kind of time series and variable. The interesting part is the use of navigation functions. They make this exercise a lot easier even if they are not that easy to understand at first.", "I hope you\u2019ll like this method and the article will help you save some time and maybe even understand navigation functions better if you are new to it!", "But more importantly, I hope this will help you get more at ease using SQL and BigQuery! It\u2019s a good use case to practice your skills!", "Time to dive into some data! \ud83e\udd13", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "\ud83d\udcca Data Scientist | SQL, BigQuery, Python | Follow me to learn about SQL and data-related topics. Thank you so much for your support!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F58316a3c13b2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://romaingranger.medium.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": ""}, {"url": "https://romaingranger.medium.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Romain Granger"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36c0056b1ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&user=Romain+Granger&userId=36c0056b1ee7&source=post_page-36c0056b1ee7----58316a3c13b2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markusspiske", "anchor_text": "https://unsplash.com/@markusspiske"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/navigation_functions", "anchor_text": "https://cloud.google.com/bigquery/docs/reference/standard-sql/navigation_functions"}, {"url": "https://support.google.com/analytics/answer/7586738?hl=en", "anchor_text": "https://support.google.com/analytics/answer/7586738?hl=en"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/navigation_functions#:~:text=LAG,-LAG%20(value_expression%5B%2C&text=Returns%20the%20value%20of%20the%20value_expression%20on%20a%20preceding%20row,NULL%20or%20a%20negative%20value.", "anchor_text": "here"}, {"url": "https://medium.com/tag/sql?source=post_page-----58316a3c13b2---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----58316a3c13b2---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/data-science?source=post_page-----58316a3c13b2---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-analytics?source=post_page-----58316a3c13b2---------------data_analytics-----------------", "anchor_text": "Data Analytics"}, {"url": "https://medium.com/tag/business-intelligence?source=post_page-----58316a3c13b2---------------business_intelligence-----------------", "anchor_text": "Business Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&user=Romain+Granger&userId=36c0056b1ee7&source=-----58316a3c13b2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&user=Romain+Granger&userId=36c0056b1ee7&source=-----58316a3c13b2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F58316a3c13b2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----58316a3c13b2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----58316a3c13b2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----58316a3c13b2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----58316a3c13b2--------------------------------", "anchor_text": ""}, {"url": "https://romaingranger.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://romaingranger.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Romain Granger"}, {"url": "https://romaingranger.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "247 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36c0056b1ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&user=Romain+Granger&userId=36c0056b1ee7&source=post_page-36c0056b1ee7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9ac924922ec7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-compute-a-growth-rate-in-bigquery-using-sql-58316a3c13b2&newsletterV3=36c0056b1ee7&newsletterV3Id=9ac924922ec7&user=Romain+Granger&userId=36c0056b1ee7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}