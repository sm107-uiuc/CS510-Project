{"url": "https://towardsdatascience.com/custom-calculators-in-mediapipe-5a245901d595", "time": 1683012047.2374551, "path": "towardsdatascience.com/custom-calculators-in-mediapipe-5a245901d595/", "webpage": {"metadata": {"title": "Creating a Virtual Background App\u2026 | by Swati Modi | Aug, 2020 | Towards Data Science | Towards Data Science", "h1": "Creating a Virtual Background App", "description": "How to create a Zoom like Virtual Background App with Portrait Segmentation and MediaPipe"}, "outgoing_paragraph_urls": [{"url": "https://blog.gofynd.com/mediapipe-with-custom-tflite-model-d3ea0427b3c1", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/calculators/image/testdata/BUILD", "anchor_text": "BUILD", "paragraph_index": 29}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/examples/android/src/java/com/google/mediapipe/apps/portraitsegmentationgpu/BUILD", "anchor_text": "BUILD", "paragraph_index": 31}, {"url": "https://swatimodi.com", "anchor_text": "swatimodi.com", "paragraph_index": 38}], "all_paragraphs": ["This is the Part 2 of the MediaPipe Series I am writing.", "Previously, we saw how to get started with MediaPipe and use it with your own tflite model. If you haven\u2019t read it yet, check it out here.", "We had tried using the portrait segmentation tflite model in the existing segmentation pipeline with the calculators already present in MediaPipe", "After getting bored with this Blue Background, I decided to have some fun with it by having some Zoom like Virtual Backgrounds like beautiful stars or some crazy clouds instead :)", "For this, I wrote a custom calculator and used it with the existing pipeline.", "So today I\u2019ll show how did I go about making this App", "Before we get started, I would suggest you to go through this part of the documentation which explains the Flow of a basic calculator.", "Now, let\u2019s get started with the code", "So earlier, the rendering/coloring was done by the RecolorCalculator , it used to take image and mask gpu buffer as input and returned gpu buffer rendered output (rendered using opengl)", "Here, for replacing the Background with an Image(jpg/png), I have used OpenCV operations.", "NOTE : OpenCV operations are performed on CPU \u2014 ImageFrame datatype where as opengl operations are performed on GPU \u2014 Image-buffer datatype", "We will replace the RecolorCalculator with the BackgroundMaskingCalculator", "This calculator takes transformed Image and the Mask (Both ImageFrame Datatype) as input and changes the background with given image.", "For converting the Image and Mask GpuBuffer to ImageFrame, I used the GpuBufferToImageFrameCalculator.", "In this we will write the logic of processing and creating the background masking effect", "Here we are just verifying our inputs and their data types", "Taking the inputs, converting to OpenCV Mat and further processing for desired output", "We need to do this so the calculator is available and accessible while compilation and execution", "the deps (dependencies) you see here are the imports you are using in your calculator", "The name used here is referred in graph BUILD file as well", "Add background_masking_calculator to deps and remove recolor_calculator which we are not using now", "Now we are ready to build, we just have to add the asset(image to be masked on the background)", "NOTE: This asset reading method is straight forward when trying on Desktop but quite different for the Android Build.", "So we will look at the Desktop and Android build one by one", "In the background_masking_calculator.cc , read the asset file as", "Now, we are ready to build", "The build will finish successfully in around 10\u201315 minutes", "Now, you can run the Pipeline using the following", "the webcam starts and you\u2019ll be able to see the output window", "Add the following code to the BUILD file in testdata folder (folder containing the background asset images)", "Adding the files to android_library along with the tflite model", "Modify in android project BUILD file in examples/android/\u2026./portraitsegmentationgpu/", "Here, first using the MediaPipe\u2019s PathToResourceAsFile method, we try to look if the asset is available and if available we read it using it\u2019s value as path to file", "On a side note, this method was a part of resource_util.h present in mediapipe/util/ folder. So whenever you import a new file into your calculator, make sure to add it to BUILD file mentioned in pt. 4", "This would take around 20\u201325 minutes when building for the first time because it downloads all the external dependencies for the Build. Next time it uses the cached dependencies, so it builds much faster.", "Now, you are ready to run the APK and test it.", "Here we successfully added our own calculator and modified the pipeline and graph according by first testing it on Desktop and then finally on Android with minimal changes.", "Feel free to ask any questions in the comments or you can reach me out personally.", "You can find more about me on swatimodi.com", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5a245901d595&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a245901d595--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@swati-modi?source=post_page-----5a245901d595--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swati-modi?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Swati Modi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4c61fd2b2b16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&user=Swati+Modi&userId=4c61fd2b2b16&source=post_page-4c61fd2b2b16----5a245901d595---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://blog.gofynd.com/mediapipe-with-custom-tflite-model-d3ea0427b3c1", "anchor_text": "here"}, {"url": "https://google.github.io/mediapipe/framework_concepts/calculators.html", "anchor_text": "https://google.github.io/mediapipe/framework_concepts/calculators.html"}, {"url": "https://github.com/SwatiModi/portrait-segmentation-mediapipe.git", "anchor_text": "https://github.com/SwatiModi/portrait-segmentation-mediapipe.git"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/graphs/portrait_segmentation/portrait_segmentation.pbtxt", "anchor_text": "portrait_segmentation.pbtxt"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/calculators/image/background_masking_calculator.cc", "anchor_text": "background_masking_calculator.cc"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/calculators/image/BUILD", "anchor_text": "BUILD"}, {"url": "https://github.com/SwatiModi/virtual-background-app/tree/master/mediapipe/calculators/image", "anchor_text": "mediapipe/calculators/image"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/graphs/portrait_segmentation/BUILD", "anchor_text": "BUILD"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/calculators/image/testdata/BUILD", "anchor_text": "BUILD"}, {"url": "https://github.com/SwatiModi/virtual-background-app/blob/master/mediapipe/examples/android/src/java/com/google/mediapipe/apps/portraitsegmentationgpu/BUILD", "anchor_text": "BUILD"}, {"url": "https://swatimodi.com", "anchor_text": "swatimodi.com"}, {"url": "https://blog.gofynd.com/mediapipe-with-custom-tflite-model-d3ea0427b3c1", "anchor_text": "https://blog.gofynd.com/mediapipe-with-custom-tflite-model-d3ea0427b3c1"}, {"url": "https://mediapipe.readthedocs.io/en/latest/framework_concepts.html", "anchor_text": "https://mediapipe.readthedocs.io/en/latest/framework_concepts.html"}, {"url": "https://mediapipe.readthedocs.io/en/latest/calculator.html", "anchor_text": "https://mediapipe.readthedocs.io/en/latest/calculator.html"}, {"url": "https://github.com/google/mediapipe/issues", "anchor_text": "https://github.com/google/mediapipe/issues"}, {"url": "https://github.com/SwatiModi/virtual-background-app", "anchor_text": "https://github.com/SwatiModi/virtual-background-app"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5a245901d595---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----5a245901d595---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/image-segmentation?source=post_page-----5a245901d595---------------image_segmentation-----------------", "anchor_text": "Image Segmentation"}, {"url": "https://medium.com/tag/augmented-reality?source=post_page-----5a245901d595---------------augmented_reality-----------------", "anchor_text": "Augmented Reality"}, {"url": "https://medium.com/tag/tflite?source=post_page-----5a245901d595---------------tflite-----------------", "anchor_text": "Tflite"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&user=Swati+Modi&userId=4c61fd2b2b16&source=-----5a245901d595---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&user=Swati+Modi&userId=4c61fd2b2b16&source=-----5a245901d595---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a245901d595--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5a245901d595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5a245901d595---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5a245901d595--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5a245901d595--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5a245901d595--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5a245901d595--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5a245901d595--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swati-modi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swati-modi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Swati Modi"}, {"url": "https://medium.com/@swati-modi/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "104 Followers"}, {"url": "http://swatimodi.com", "anchor_text": "swatimodi.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4c61fd2b2b16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&user=Swati+Modi&userId=4c61fd2b2b16&source=post_page-4c61fd2b2b16--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F18c3f8e72dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-calculators-in-mediapipe-5a245901d595&newsletterV3=4c61fd2b2b16&newsletterV3Id=18c3f8e72dc5&user=Swati+Modi&userId=4c61fd2b2b16&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}