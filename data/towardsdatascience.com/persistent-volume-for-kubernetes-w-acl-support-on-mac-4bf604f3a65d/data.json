{"url": "https://towardsdatascience.com/persistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d", "time": 1683018000.454725, "path": "towardsdatascience.com/persistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d/", "webpage": {"metadata": {"title": "Persistent Volume for Kubernetes w/ ACL Support on Mac | by Tibor Fabian | Towards Data Science", "h1": "Persistent Volume for Kubernetes w/ ACL Support on Mac", "description": "Although not meant to be a production-ready environment, Docker Desktop provides a quite good playground for Kubernetes (K8s). Even on a playground, you would try to keep K8s configurations as close\u2026"}, "outgoing_paragraph_urls": [{"url": "https://tibor-fabian.medium.com/acl-explained-a-use-case-for-data-protection-5fd1b07a5b84", "anchor_text": "ACL Explained; a Use Case for Data Protection", "paragraph_index": 1}, {"url": "https://phoenixnap.com/kb/docker-privileged", "anchor_text": "in this tutorial", "paragraph_index": 7}, {"url": "https://de.linkedin.com/in/fabiantibor", "anchor_text": "https://de.linkedin.com/in/fabiantibor", "paragraph_index": 25}], "all_paragraphs": ["Although not meant to be a production-ready environment, Docker Desktop provides a quite good playground for Kubernetes (K8s). Even on a playground, you would try to keep K8s configurations as close as possible to the final production version to make things efficient.", "Therefore, I wanted to set up a K8s pod with a persistent volume incl. Access Control List (ACL) activated on my MacBook Pro. I needed ACL as a prerequisite for Dataiku Data Science Studio to support multi-user security or user isolation. A great feature to comply with the latest data protection requirements in the field of data science. A more detailed description of ACL in the context of data protection provides my article \u201cACL Explained; a Use Case for Data Protection\u201d.", "To achieve this was not that easy as I hoped for, but finally, I came up with a solution I\u2019d like to share with you.", "After some tests, I realized that volume mounts, which I wanted to use to maintain persistence, although possible, could be really challenging using Docker Desktop if you also need some special filesystem features like ACL support. I tried the following options:", "After several trials, which I hope to spare you with this article, I found a solution: An Ext4 filesystem image stored on the host machine and mounted from there directly. The steps on how to achieve this are described in this post.", "The software versions I used are pictured below.", "The first step is to create a K8s pod manifest to configure an appropriate Docker image (for example, ubuntu:18.04) and a persistent volume mounted from the host machine (my Mac\u2019s tmp directory in this case).", "Note that in the above pod configuration securityContext /privileged is set to true to allow filesystem mounts, which we\u2019ll need later on. The pros and cons regarding the usage of privileged mode are detailed in this tutorial. To activate privileged mode is definitely not something I would recommend for production systems, but for this case, on a local machine should be OK if you are aware of the risks of using it.", "Once we have the pod\u2019s configuration definition, we can simply start it in a terminal with kubectl apply and then enter the running container using kubectl exec.", "Inside the container, the command df displays free disk space and shows whether the volume was successfully mounted. As listed below, my tmp directory from the host machine was mounted to /media/volume-ext4-image, as specified.", "As a result, we have already got persistence since everything we write to that directory resides on the host and stays accessible within the K8s pod after a restart. The issue is here, however, that the mounted filesystem grpcfuse does not support Linux ACL settings; let\u2019s fix that.", "The next step is to create an image (data dump) with the command dd, in this example, a file of 10 GB.", "The image should be instantly visible on the host machine. In this example, that is the file /Users/\u2026/tmp/ext4fs.img, since my tmp directory from the host was mounted to the path /media/volume-ext4-image in the container.", "Now, to support ACL, we use the command mkfs to make the Ext4 filesystem on our brand new image; there are also other filesystems like XFS with ACL support.", "Almost done, but to use the Ext4 filesystem from the image, we need to set up a loop device with losetup to make it accessible as a block device and then mount it to an existing directory inside the container.", "Note: I used the same volume-mount directory where the filesystem image was created as the mount target path, but this should not confuse you, and feel free to use any directories of your choice. This only demonstrates that the mounted loop device completely hides the original directory content from the host machine. Meaning, all changes made to that directory in the container physically happen inside the Ext4 filesystem image.", "We just achieved our goal and the mounted directory /media/volume-ext4-image now provides the correct filesystem Ext4 with ACL support (ACL is activated as the default when mounting).", "Finally, let\u2019s give it a try and allow write access to a file created by root for an arbitrary user, John Doe, for example.", "As we can see above, after the file was created by root, others are not allowed to update the file\u2019s content. We need to run setfacl with appropriate parameters to change that by giving John Doe read/write access to that file.", "The user, John Doe, can now update the file content, while this is still not permitted for other users.", "There is one last thing: To keep things smooth, we need to automatically mount and detach our Ext4 image during each pod start or stop period. So let\u2019s modify the pod definition by adding some start and pre-stop commands to the manifest.", "The pod manifest above now contains some additional startup commands to set up and also stop commands to detach the persistent volume automatically:", "Note: The script pre-stop.sh is configured in section lifecycle/preStop/exec in the pod manifest above.", "This article\u2019s main takeaway is that creating a volume mount with ACL support when a Kubernetes pod is running inside of Docker Desktop on a Mac could be challenging but possible.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Lead Data Scientist @ Telef\u00f3nica; Visit my LinkedIn profile: https://de.linkedin.com/in/fabiantibor"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4bf604f3a65d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tibor-fabian.medium.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": ""}, {"url": "https://tibor-fabian.medium.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Tibor Fabian"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F41751d3c5caf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&user=Tibor+Fabian&userId=41751d3c5caf&source=post_page-41751d3c5caf----4bf604f3a65d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://tibor-fabian.medium.com/acl-explained-a-use-case-for-data-protection-5fd1b07a5b84", "anchor_text": "ACL Explained; a Use Case for Data Protection"}, {"url": "https://phoenixnap.com/kb/docker-privileged", "anchor_text": "in this tutorial"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----4bf604f3a65d---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/persistent-volume?source=post_page-----4bf604f3a65d---------------persistent_volume-----------------", "anchor_text": "Persistent Volume"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4bf604f3a65d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/docker?source=post_page-----4bf604f3a65d---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/acl?source=post_page-----4bf604f3a65d---------------acl-----------------", "anchor_text": "Acl"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&user=Tibor+Fabian&userId=41751d3c5caf&source=-----4bf604f3a65d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&user=Tibor+Fabian&userId=41751d3c5caf&source=-----4bf604f3a65d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4bf604f3a65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4bf604f3a65d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4bf604f3a65d--------------------------------", "anchor_text": ""}, {"url": "https://tibor-fabian.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tibor-fabian.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tibor Fabian"}, {"url": "https://tibor-fabian.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "26 Followers"}, {"url": "https://de.linkedin.com/in/fabiantibor", "anchor_text": "https://de.linkedin.com/in/fabiantibor"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F41751d3c5caf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&user=Tibor+Fabian&userId=41751d3c5caf&source=post_page-41751d3c5caf--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F819017a298e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpersistent-volume-for-kubernetes-w-acl-support-on-mac-4bf604f3a65d&newsletterV3=41751d3c5caf&newsletterV3Id=819017a298e1&user=Tibor+Fabian&userId=41751d3c5caf&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}