{"url": "https://towardsdatascience.com/machine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96", "time": 1683003460.334207, "path": "towardsdatascience.com/machine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96/", "webpage": {"metadata": {"title": "Machine Learning with Datetime Feature Engineering: Predicting Healthcare Appointment No-Shows | by Andrew Long | Towards Data Science", "h1": "Machine Learning with Datetime Feature Engineering: Predicting Healthcare Appointment No-Shows", "description": "Dates and times are rich sources of information that can be used with machine learning models. However, these datetime variables do require some feature engineering to turn them into numerical data\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.solutionreach.com/blog/which-wins-the-national-average-no-show-rate-or-yours", "anchor_text": "source", "paragraph_index": 1}, {"url": "https://www.kaggle.com/joniarroba/noshowappointments", "anchor_text": "https://www.kaggle.com/joniarroba/noshowappointments", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/understanding-data-science-classification-metrics-in-scikit-learn-in-python-3bc336865019", "anchor_text": "technical post", "paragraph_index": 38}, {"url": "https://towardsdatascience.com/data-science-performance-metrics-for-everyone-4d68f4859eef", "anchor_text": "non-technical post", "paragraph_index": 38}], "all_paragraphs": ["Dates and times are rich sources of information that can be used with machine learning models. However, these datetime variables do require some feature engineering to turn them into numerical data. In this post, I will demonstrate how to create datetime features with built in pandas functions for your machine learning models.", "When I was teaching a machine learning course at Northeastern University, a few of my students used a really interesting dataset (medical appointment no-shows) which I am going to explore in this blog post. Medical appointment no-shows is a large problem in healthcare as approximately 1 in 5 patients will miss their appointment (source). This is an issue for everyone involved: 1) the scheduled patient presumably needs to be seen otherwise they wouldn\u2019t have had an appointment, 2) other patients would have liked to have that spot but couldn\u2019t, 3) healthcare providers must spend extra time to contact and re-schedule the patient as well as wasted any time they used to prepare for the visit.", "Given the dates and times of scheduling day and appointment day, predict if a patient will miss their medical appointment.", "Here we will use the medical appointment no-show hosted on Kaggle (https://www.kaggle.com/joniarroba/noshowappointments). This dataset consists of over 110,000 medical appointments. The main three columns we will use for this project are the ScheduledDay (date and time when the appointment was scheduled), AppointmentDay(date of the appointment, no time included), No-Show (binary flag indicating if they no-showed). For the purposes of this post we will ignore the rest of the numerical features (although to be honest they added no value to the AUC).", "Let\u2019s begin by loading our dataset, creating an output column (1 = no-show, 0= showed up), and converting our datetimes (currently strings) into python datetimes.", "Here I assume that you downloaded the data from Kaggle and placed it in a \u2018data\u2019 folder:", "We can investigate the No-Show column with value_counts", "Let\u2019s define a binary column OUTPUT_LABEL to indicate Yes = 1, No = 0.", "We can check the prevalence of our OUTPUT_LABEL:", "which means that 1 in 5 patients will miss their scheduled appointment.", "Now let\u2019s work with the datetime columns by looking at the first 5 rows of ScheduledDay and AppointmentDay", "As you can see, the dtype for both columns is object which means pandas currently views these values as strings. Another thing to point out is that ScheduledDay has times where as Appointment Day has all the times as 00:00:00. We should probably deal with this, but I find it kind of odd that they didn\u2019t included the time of the appointment in the dataset. Presumably, the time of the appointment would be predictive too.", "To convert these strings into internal datetimes, we can use the pandas function to_datetime . I like to use the format parameter to specifically indicate the format. If you use the format parameter, you have to specify what to do with errors. Here I will make any errors turn into not a datetime (NaT). In general (although not the case here), using the format parameter will speed up the execution of this line.", "I haven\u2019t seen T and Z in standard formats before so I just put them in the format string. If someone knows how to handle these better, let me know.", "Whenever I use the format parameter and if I assume all rows should have dates, I like to put an assertion statement to verify I didn\u2019t get the format incorrect.", "If you check the dtype now, you will see it is datetime64, which is what we want because it exposes us to all the datetime properties in pandas.", "One thing I noticed was that currently there are ~40k appointments that were scheduled after the appointment datetime.", "I think this is due to the fact that all the appointment times were set at the earliest time (00:00:00) whereas the times are included in ScheduledDay. To adjust for this, lets just shift all the appointment times to the end of the day. If I was doing this project for work, I would actually go and get the appointment times.", "With this change there are only 5 rows where scheduledDay time is after appointmentDay. Let\u2019s just drop those rows.", "By converting the strings into datetimes, this exposes all the pandas dt properties.", "Basically you can break apart the date and get the year, month, week of year, day of month, hour, minute, second, etc. You can also get the day of the week (Monday = 0, Sunday = 6). Note be careful with week of year because the first few days of the year may be 53 if that week begins in the prior year. Let\u2019s apply some of these properties to both of our datetime columns.", "At this point it would be good to explore our dates a bit.", "As you can see here, the appointments are in April, May and June of 2016 and range from Monday through Saturday with no appointments on Sunday. I would never use Year as a feature (but showed it anyways) because presumably we want to use this predictive model in the future and those future years wouldn\u2019t be included in the dataset. However, I am kind of disappointed that the months are just for a few months of the year. This means month (and consequently week of year) probably shouldn\u2019t be used as a feature either. If I was doing this for work, I would go back to the database and get a whole year\u2019s (or many years) worth of data. I would imagine that certain times of the year (ie around holidays) would impact the rate of no show.", "Let\u2019s quickly check if dayofweek is predictive of no-show:", "Looks like more people skip their appointments on Friday and Saturday, although the effect is modest.", "Another nice thing with pandas datetime representation is that you can calculate the \u2018time\u2019 between datetimes. Let\u2019s create a new feature that is the number of days between the scheduled date and the appointment date.", "Note that here I use total_seconds . There is a function dt.days but I got in the habit of using total_seconds because 1) dt.days rounds to the nearest day, 2) dt.days used to take much longer than total_seconds. The second point seems to have been fixed in later versions of pandas.", "We can plot the histogram of our two classes on this variable:", "This distribution is a bit odd to me since most of the patients who did not miss their appointment scheduled the appointment on the same day. I kind of wonder if walk-in appointments are included in this data set. My guess is that this model will just draw a line at 1 day and say not-missed if you scheduled it the same day.", "We are now ready to split our samples and train a model!", "For simplicity, I\u2019ll just split into two datasets: train (70%) and validation (30%). It is important to shuffle your samples because you may have been given the data in order of dates.", "We can check the prevalence is about 20% in each:", "Given this data comes from just Apr-Jun 2016 and their are no appointment times, we will just use these columns:", "The \u2018day\u2019 features may even be suspect, but let\u2019s leave in for now.", "This could be expanded if we had:", "We can now build our X (inputs) and Y(output) for training and validation:", "Since the focus of this post is about the datetime features, we will just train a random forest model here. Note if you want to use other types of models, you may need to scale or normalize your data. Another thing you may want to do is convert the dayofweek into a categorical variable via one-hot encoding. We don\u2019t need to do these things for a tree-based method though.", "We can then get our predictions with:", "Here we will evaluate performance of the model. If you are new to classification metrics, I recommend checking out my posts about these metrics (technical post or non-technical post) .", "Using this print_report function we can evaluate the performance for training and validation. Here I set the threshold at the prevalence of 0.201", "We can plot the ROC with", "This indicates that we can get an AUC of 0.71 with just using datetime features. This ROC curve is kind of odd since it has that elbow.", "We can investigate this a bit by looking at the top features", "Which shows that delta_days is basically the only features used in the model. This confirms our suspicion above that the model will likely struggle due to those same day appointments.", "Since our training and validation scores are very similar, this means that we are in the case of high bias. In order to improve this model, we will need additional features, so I will end this project here.", "In this project, we created many new features by unpacking the datetime variables to predict if a patient will no-show. In my experience, datetime features can have a big impact on healthcare machine learning models. I highly recommend trying this in your next project. Please reach out if you have any questions or concerns about this post.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5e4ca3a85f96&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@awlong20?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@awlong20?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Andrew Long"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcfde21be7ef1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&user=Andrew+Long&userId=cfde21be7ef1&source=post_page-cfde21be7ef1----5e4ca3a85f96---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.solutionreach.com/blog/which-wins-the-national-average-no-show-rate-or-yours", "anchor_text": "source"}, {"url": "https://www.kaggle.com/joniarroba/noshowappointments", "anchor_text": "https://www.kaggle.com/joniarroba/noshowappointments"}, {"url": "https://pandas.pydata.org/pandas-docs/version/0.23/api.html#datetimelike-properties", "anchor_text": "https://pandas.pydata.org/pandas-docs/version/0.23/api.html#datetimelike-properties"}, {"url": "https://towardsdatascience.com/understanding-data-science-classification-metrics-in-scikit-learn-in-python-3bc336865019", "anchor_text": "technical post"}, {"url": "https://towardsdatascience.com/data-science-performance-metrics-for-everyone-4d68f4859eef", "anchor_text": "non-technical post"}, {"url": "https://medium.com/tag/healthcare?source=post_page-----5e4ca3a85f96---------------healthcare-----------------", "anchor_text": "Healthcare"}, {"url": "https://medium.com/tag/data-science?source=post_page-----5e4ca3a85f96---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5e4ca3a85f96---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----5e4ca3a85f96---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&user=Andrew+Long&userId=cfde21be7ef1&source=-----5e4ca3a85f96---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&user=Andrew+Long&userId=cfde21be7ef1&source=-----5e4ca3a85f96---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5e4ca3a85f96&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5e4ca3a85f96---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5e4ca3a85f96--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@awlong20?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@awlong20?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrew Long"}, {"url": "https://medium.com/@awlong20/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "946 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcfde21be7ef1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&user=Andrew+Long&userId=cfde21be7ef1&source=post_page-cfde21be7ef1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffd1d11fed667&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-with-datetime-feature-engineering-predicting-healthcare-appointment-no-shows-5e4ca3a85f96&newsletterV3=cfde21be7ef1&newsletterV3Id=fd1d11fed667&user=Andrew+Long&userId=cfde21be7ef1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}