{"url": "https://towardsdatascience.com/sage-shiny-8e6d0e746604", "time": 1683017345.9485178, "path": "towardsdatascience.com/sage-shiny-8e6d0e746604/", "webpage": {"metadata": {"title": "Sage %>% Shiny. From Business Problem to Usable Data\u2026 | by Rob Harrand | Towards Data Science", "h1": "Sage %>% Shiny", "description": "(Note that for reasons of confidentiality, I cannot show the full app in this blog post, nor can I display real data) Sage 200 is a powerful financial software suite that can be used for multiple\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.coursera.org/specializations/strategic-analytics?", "anchor_text": "Strategic Business Analytics Specialization", "paragraph_index": 5}], "all_paragraphs": ["(Note that for reasons of confidentiality, I cannot show the full app in this blog post, nor can I display real data)", "Sage 200 is a powerful financial software suite that can be used for multiple accounting processes within a business. In this blog post, I\u2019ll take you through how I extended its capabilities using R, to give our sales team a useful, bespoke tool for planning, reporting and analysis.", "Making Sense of CustomersAs the old adage goes, \u201cyou don\u2019t know what you don\u2019t know\u201d, and dealing with data is no exception. About 18 months ago I realised that the sales team where I work were organising themselves largely via manually created reports. This worked to some extent, and they were doing the best they could with the resources available, but it suddenly became apparent that there was a huge disconnect between the datasets we as a company were sitting on, and the ways they were being used (or not).", "I knew that we had some great data, namely many years\u2019 worth of transactions from thousands of different customers, but I wasn\u2019t entirely sure what to do with it. I also knew that I could access our Sage database from R, using the code below (along with the RODBC package),", "Using this code I could access all data held in our Sage database (specifically, the \u2018transactions\u2019, \u2018customers\u2019 and \u2018products\u2019 tables). But, to what end?", "I began by looking for a suitable MOOC (massive open online course) to lay the foundations of what I was hoping would be an interesting and productive project. The one I settled on was the Strategic Business Analytics Specialization from Coursera, consisting of 4 courses focussing on how best to exploit financial data of the type I knew I had access to. I already had experience of creating Shiny apps and general data science, so my aim was to plug the \u2018financial\u2019 gap sufficiently well to allow me to make use of the data we had.", "RFM AnalysisOver the course of completing the specialisation, I was introduced to the concept of RFM, or recency, frequency and monetary value, as a way to segment customers based upon their buying behaviour. Here was a technique to find groups of customers who were behaving in different ways, with the idea of then being able to treat them differently. I knew this would be of great benefit to the sales team, each member of which had far too many customers to visit or call in any given week or even month. There would also be a significant benefit to the marketing department, who could use the findings to create targeted email campaigns.", "The idea behind RFM is straight-forwards. First, for each customer, work out the 3 metrics over a chosen time-period (typically a year). Recency is the number of days that have elapsed since their last purchase. Frequency is the number of purchases made in the chosen time period. Monetary value is the total amount of money they\u2019ve generated in that same time period. Below is the R code for creating the 3 metrics (note that your calculation for \u2018monetary\u2019 may be different, depending on how your database is structured and how your business operates),", "Once done, the ranges are scaled, typically by assigning values of 1, 2, 3, 4 or 5, in order to ensure that all 3 are comparable. For example, a recency of 360 days might become a 1, where-as a recency of 3 days might become a 5. A monetary value of \u00a3150 might become a 1, but a value of \u00a37500 might become a 5, etc. You can then assign customers to different groups, via one of two ways.", "The first is to create rules along with arbitrary names. For example, you may decide that any customer with a recency, frequency and monetary value of 4\u20135 is to be classed as a \u2018champion\u2019. These are the loyal, lucrative customers who are buying lots and often. At the other end of the spectrum you may decide to label any customers with scores of 1 for all 3 metrics as \u2018hibernating\u2019, \u2018lost\u2019 or \u2018lapsing\u2019. Given these labels, these customers can then be approached in very different ways, in terms of number of sales team visits, number or nature of emails, promotional offers, etc.", "The second way to segment customers with RFM labels is to use cluster analysis. Note that for this approach, rather than scaling from 1\u20135, we instead retain the full quantitative information by scaling using the scale function. This doesn\u2019t match the scales completely, but for my data, it got all 3 metrics on the same order of magnitude, which was fine. For the clustering, I used k-means with 4 clusters using the code below,", "To check what this gave me, I used a 3D plot to visualise the customers, with the colours of each point set to correspond to their respective clusters. Finally, I assigned names to each cluster based upon their mean levels of R, F and M,", "As you can see, the green cluster labelled \u2018champion\u2019 has low recency (they\u2019ve bought something recently), moderate to high frequency, and relatively high monetary value. In contrast, the red \u2018lapsing\u2019 customers have high recency, low frequency and low monetary value.", "Enter ShinyI now had an R script that allowed me to segment customers into 4 groups. The idea was to provide this information to the sales and marketing teams, to allow them to tailor their approaches. For example, a \u2018champion\u2019 may be open to trialling new products or providing testimonials. \u2018OK\u2019 customers could perhaps be converted over time into \u2018champions\u2019 with more frequent contact, and \u2018lapsing\u2019 customers could be rescued with discounts.", "However, emailing static lists to these departments didn\u2019t achieve a great deal. The information just wasn\u2019t in an easy-to-use format. So, I next decided to create a Shiny app to present the data, which then led to the idea of providing it in the form of a map. After all, the sales team were often on the road, and being able to see where different customers were located would be extremely useful.", "Creating interactive maps in R is straight-forwards thanks to the Leaflet package. All I had to do was provide location data, which I managed to do by downloading an open-source dataset of all UK postcodes vs longitude and latitude. This allowed me to precisely map the posititions of our customers. I then colour-coded the points based upon their RFM cluster type, and made sure the mouse pop-ups displayed useful information, such as the name and address of the customer, the RFM metrics, and the top 5 products purchased.", "Below is an image of the main map view (for customers in the east of the UK),", "As you can see, each customer (a limited number are shown here for clarity) are colour-coded. Notice a couple of other customer types are shown in the legend. The first are \u2018prospects\u2019, which are potential customers, and \u2018lapsed\u2019, which are customers who haven\u2019t made a purchase in the last 12 months.", "Below shows an example of the mouse pop-up, available for each point on the map,", "Along with the map view, a number of other features were added over time. These included 2 reporting tabs, plus a churn prediction tab,", "The reporting sections, as you can imagine, allow the end-user to generate a number of reports. The basic idea was to select one or more customers via an interactive table (using the data-table library), which generated a custom, interactive plot (using the Plotly library), such as that shown below,", "Such plots and associated data could then be exported to Word or PFD formats by the end-user (using the OfficeR library).", "The churn prediction was another section that offered the sales-team a means to focus their efforts on certain customers. For this, I created a logistic regression model (using the Caret library) on previous years data (as a test set), to see if customer churn (i.e. a customer leaving us and not ordering again, at least in the following year) could be predicted using only the RFM metrics. Below is the code used,", "From applying this model to this year\u2019s data, a list of existing customers could be created, ordered by the probability of churn in descending order,", "The numbers here make intuitive sense, in that the higher the recency and lower the frequency and monetary values, the higher the probability of churn. This could be worked out using intuition of course, but this gave a simple to understand list based upon these metrics and the underlying model.", "Finally, a table was given to the end-user, detailing every possible piece of useful information, from the cluster this year, cluster last year, top product sales, year-on-year monetary change, whether or not they were a new customer, to customer lifetime value. This table could be exported to Excel, and crucially, the data displayed in the table auto-refreshed as the end-user moved around the map, zooming in and out and toggling customer types (easier said than done!).", "At first, this Shiny app was quite slow, trying to constantly pull data from Sage200. To improve performance, I stripped out all processing tasks and created a processing script that was run automatically each morning at 6am, using a CRON job in Linux (simply running the command \u2018Rscript\u2019 followed by the script\u2019s file name at the command line). This allowed the Shiny app to then run from a cleaned, pre-processed intermediate layer of data. Below is an overview of the process (where \u2018TM\u2019 refers to \u2018Territory Manager\u2019),", "Closing thoughtsThis was all quite a lot of work, but it was built piece by piece over an extended period, gathering user feedback at each step. Once done, it offered a simple to use, bespoke (and free) tool that the sales team and marketing departments loved and are using heavily to this day.", "So, if you have a Sage financial system where you work (and have read access!), it may be worth considering if there are ways you could extend its functionality using R or Python in ways such as above. Happy RFMing!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8e6d0e746604&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tentotheminus9?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tentotheminus9?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Rob Harrand"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8b08ce01a167&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&user=Rob+Harrand&userId=8b08ce01a167&source=post_page-8b08ce01a167----8e6d0e746604---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@sctgrhm?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Scott Graham"}, {"url": "https://unsplash.com/s/photos/finance?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.coursera.org/specializations/strategic-analytics?", "anchor_text": "Strategic Business Analytics Specialization"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8e6d0e746604---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/r?source=post_page-----8e6d0e746604---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/finance?source=post_page-----8e6d0e746604---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/sage?source=post_page-----8e6d0e746604---------------sage-----------------", "anchor_text": "Sage"}, {"url": "https://medium.com/tag/rfm-analysis?source=post_page-----8e6d0e746604---------------rfm_analysis-----------------", "anchor_text": "Rfm Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&user=Rob+Harrand&userId=8b08ce01a167&source=-----8e6d0e746604---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&user=Rob+Harrand&userId=8b08ce01a167&source=-----8e6d0e746604---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8e6d0e746604&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8e6d0e746604---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8e6d0e746604--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8e6d0e746604--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8e6d0e746604--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tentotheminus9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tentotheminus9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rob Harrand"}, {"url": "https://medium.com/@tentotheminus9/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "65 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8b08ce01a167&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&user=Rob+Harrand&userId=8b08ce01a167&source=post_page-8b08ce01a167--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5c3932f56ece&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsage-shiny-8e6d0e746604&newsletterV3=8b08ce01a167&newsletterV3Id=5c3932f56ece&user=Rob+Harrand&userId=8b08ce01a167&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}