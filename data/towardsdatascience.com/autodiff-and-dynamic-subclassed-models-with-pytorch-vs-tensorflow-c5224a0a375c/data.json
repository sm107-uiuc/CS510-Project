{"url": "https://towardsdatascience.com/autodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c", "time": 1683015137.061463, "path": "towardsdatascience.com/autodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c/", "webpage": {"metadata": {"title": "AutoDiff and Dynamic Subclassed Models with PyTorch Vs TensorFlow | by Jacopo Mangiavacchi | Towards Data Science", "h1": "AutoDiff and Dynamic Subclassed Models with PyTorch Vs TensorFlow", "description": "This short article focus on how to use dynamic subclassed models with Module/Model API respectively in PyTorch 1.x and TensorFlow 2.x and how AutoDiff is used by these frameworks in the training loop\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["This short article focus on how to use dynamic subclassed models with Module/Model API respectively in PyTorch 1.x and TensorFlow 2.x and how AutoDiff is used by these frameworks in the training loop to get the gradients of the loss and implement from scratch a very naive gradient descendant implementation.", "With this intent of focusing on the core of auto-diff / auto-grad functionality we will use the simplest possible model, a linear regression model, and we will generate first, using numpy, some linear data adding a random level of noise.", "We will implement then in both TF and PyTorch a linear regression model from scratch without using any layers or activators but simply defining two tensors, w and b, representing respectively the weights and the bias of our linear model and implement the linear function as simply as: y = wx + b", "As you can see below the TF and PyTorch class definition for our models are basically exactly the same with only very minor differences on few api name.", "The only noticeable difference here is that PyTorch is explicitly using a Parameter object for defining the the weights and the bias tensors to be \u201ccaptured\u201d by the graph while TF instead seems to be a little bit more \u201cmagical\u201d here, automatically capturing instead the parameters to be used for the graph.", "Indeed in PyTorch Parameters are Tensor subclasses that have the very special property, when used with Module api, to automatically added theself to the list of Module parameters, and will appear e.g. in the parameters() iterator.", "Anyway both frameworks are able to extract from this class definition and execution methods (__call__ or forward), the parameters and the graph definition in order to run forward the graph execution and, as we will see in a bit, get the gradients via auto differentiable functionality in order to being able to execute also the back propagation.", "Now that we have our simple TensorFlow and PyTorch models implemented we can define our loss function implementing the mean squared error with both TF and PyTorch api and finally instantiate our model classes and run the training loop for a bunch of epochs.", "Again, with this intent of focusing on the core of auto-diff / auto-grad functionality, we will implement a custom training loop using TF and PyTorch specific auto-diff implementations in order to have the gradients for our simple linear function and manually optimize the weight and bias parameters with an ad-hoc and naive gradient descendent optimizer.", "In the TensorFlow training loop we will explicitly use in particular the GradientTape API to record the forward execution of our model and the loss calculation and then we will obtain from this GradientTape the gradients to use for optimizing our weights and bias parameters.", "PyTorch instead in this case provide a more \u201cmagical\u201d auto-grad approach implicitly capturing any operations on the parameter tensors and giving us the same gradients to use for optimizing our weights and bias parameters without using any specific api.", "Once we have the weights and bias gradients then implementing our custom gradient descendent method on both PyTorch and TensorFlow is as simple as subtracting to the weight and bias params these gradients multiplied by a constant learning rate.", "Only final minor difference here is that as PyTorch implement auto-diff / auto-graf in a more implicit and \u201cmagic\u201d way when we update the weights and bias parameters in our backward propagation we need to be sure to do not continue to let PyTorch extract the grad from this last update operation explicitly calling this time the no_grad api and finally zeroing the gradients for our weights and bias parameters.", "As we saw TensorFlow and PyTorch auto-differentiable and Dynamic sub-classing APIs are very similar and of course the training of both models gave us very similar results.", "In the code snippet below we will use respectively the Tensorflow and PyTorch trainable_variables and parameters methods to get access to the models parameters and plot the graph of our learned linear functions.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Microsoft Principal Data Scientist \u2014 Google Machine Learning Developer Expert (ML GDE) \u2014 Former \uf8ff + IBM Senior Architect and Engineer"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc5224a0a375c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@JMangia?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JMangia?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Jacopo Mangiavacchi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F32d426fb64f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&user=Jacopo+Mangiavacchi&userId=32d426fb64f9&source=post_page-32d426fb64f9----c5224a0a375c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/JacopoMangiavacchi/TF-VS-PyTorch", "anchor_text": "JacopoMangiavacchi/TF-VS-PyTorchComparing AutoDiff Dynamic Model approaches between PyTorch and TensorFlow 2.x training from scratch a Linear\u2026github.com"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----c5224a0a375c---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----c5224a0a375c---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/autodiff?source=post_page-----c5224a0a375c---------------autodiff-----------------", "anchor_text": "Autodiff"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&user=Jacopo+Mangiavacchi&userId=32d426fb64f9&source=-----c5224a0a375c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&user=Jacopo+Mangiavacchi&userId=32d426fb64f9&source=-----c5224a0a375c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc5224a0a375c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c5224a0a375c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c5224a0a375c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c5224a0a375c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c5224a0a375c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JMangia?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JMangia?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jacopo Mangiavacchi"}, {"url": "https://medium.com/@JMangia/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "473 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F32d426fb64f9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&user=Jacopo+Mangiavacchi&userId=32d426fb64f9&source=post_page-32d426fb64f9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1b1eb3a9b2b4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautodiff-and-dynamic-subclassed-models-with-pytorch-vs-tensorflow-c5224a0a375c&newsletterV3=32d426fb64f9&newsletterV3Id=1b1eb3a9b2b4&user=Jacopo+Mangiavacchi&userId=32d426fb64f9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}