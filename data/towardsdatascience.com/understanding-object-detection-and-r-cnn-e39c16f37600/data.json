{"url": "https://towardsdatascience.com/understanding-object-detection-and-r-cnn-e39c16f37600", "time": 1683010546.404162, "path": "towardsdatascience.com/understanding-object-detection-and-r-cnn-e39c16f37600/", "webpage": {"metadata": {"title": "Understanding Object Detection and R-CNN. | by Aakarsh Yelisetty | Towards Data Science", "h1": "Understanding Object Detection and R-CNN.", "description": "In recent times we\u2019ve seen airports and railways stations trying to detect whether people are maintaining social distance, wearing masks using cameras. These are real-time videos captured by cameras\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Convolutional_neural_network", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/entropy-cross-entropy-and-kl-divergence-explained-b09cdae917a", "anchor_text": "my previous article here", "paragraph_index": 23}, {"url": "https://towardsdatascience.com/understanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97", "anchor_text": "here", "paragraph_index": 30}, {"url": "https://www.linkedin.com/in/aakarsh-yelisetty-6b691b171/", "anchor_text": "LinkedIn", "paragraph_index": 31}], "all_paragraphs": ["In recent times we\u2019ve seen airports and railways stations trying to detect whether people are maintaining social distance, wearing masks using cameras. These are real-time videos captured by cameras where constant movement exists. We\u2019ve also seen the research going towards developing self-driving cars where the car needs to detect an obstacle in its way and drive accordingly. How does all this happen?", "This is where Object Detection comes into the picture. Let\u2019s understand how object detection works and we\u2019ll also learn the concept of how R-CNN was approached. R-CNN is the predecessor to the present existing and most happening architectures such as Faster RCNN and Mask RCNN. Last year, FAIR (Facebook AI Research) developed a fully functional framework called the Detectron2 which was built upon these state-of-the-art architectures, Faster R-CNN, and Mask R-CNN.", "Before diving into the concept, I expect you to be familiar with some concepts like Convolutional Neural Networks and standard architectures. Read here to know more.", "Classification is just about labeling an image to its respective class whereas localization refers to the bounding box around the subject. Object Detection refers to many such instances(classification + localization) in a single image. Before going to R-CNN let\u2019s look into the way how the concept of Region Proposals was approached and led them to R-CNN.", "In any standard CNN architectures like VGG Net or Alex Net, the convolution layers and the pooling layers jointly act as feature extractors. The following fully connected and the softmax layers act as a classifier. An SVM can also be used in place of this fully connected layers + Softmax. The feature maps are stretched into a one-dimensional vector and is fed to the fully connected layers.", "Now, for the localization part, consider there is only one object per image. Here, we also need a model to predict the coordinates of the bounding box. For that, we need a regression model with an L2 loss (L2 most of the time, but L1 is also used in some cases of outliers). So in addition to the present classification pipeline, we need to attach a regression model for predicting the bounding box. The same feature maps can be fed to this regression model and instead of a single softmax output layer in case of a classifier, we now need four outcomes. The four outcomes are the coordinates that represent the bounding box.", "Now, coming to Object Detection, the case here is that there might be multiple objects in a single image and that varies from image to image. We do not know the exact count beforehand. The only option is to scan all the possible locations of the image. Now, think of ideas for detection on such images.", "We can consider using the Sliding Window technique here, which works in this way.", "Using this technique, we can take all possible crops of the image and then feed it to the above-shown network. Then the network looks at every patch of the image and then decides if there\u2019s an object in the crop if it identifies any potential features in it. If yes, it gives the bounding box. In this way, by using the same network we\u2019ll be able to detect objects in our image.", "But there\u2019s a limitation to the size of the input to the standard architectures such as AlexNet and VGG Net. Cropped images can\u2019t be fed to the network directly. The cropped image must be scaled to the size of the input the network accepts. This whole process is considered to be the preprocessing phase(Sliding window + Crops + Resizing).", "If you observe keenly, you may notice that all the objects in the image need not be of a fixed size that can fit into our sliding window. So, a window of fixed size cannot solve this problem. Either the window must be taken of different sizes or the image must be scaled into different sizes keeping the window size fixed. Experimentally, it is found out that using six different scales of the image would be good enough to locate most of the objects in the image. So, the latter is usually preferred over the former. Larger objects get detected in smaller-scale images and smaller objects get detected in larger-scale images. This concept is called the Image Pyramid.", "Here, the size of the bicycle and the person are different. You can see that this person will not fit into the sliding window entirely. For this, by using the concept of Image Pyramid, we can resize the image into different scales and on the third scale, we find the person inside our window. Then by using the Bounding Box Regressor, we can match the size of the window to the ground truth. As the bicycle is a smaller object compared to the person, it may get detected either in the first one or the second. Also, note that the person may get detected partially in other scales too, but the confidence score will be usually less and the bounding box won\u2019t be that accurate.", "So, these are the additional preprocessing steps to be done on the input side to perform object detection. Though we have solved the problem of Object Detection using Sliding Window and Image Pyramid, along with the Localization Network, this still leads us to another problem. Since we are cropping the image patches in all locations of the image and at different scales, we end up having a large number of proposals just for a single image. Since CNN\u2019s are very processing-intensive, this will be an expensive operation. So, how do we solve this problem?", "Instead of using a sliding window approach which is a brute-force technique, we can use some region proposal algorithms to avoid unnecessary inputs to the network. Some of the popular region proposal techniques include Colour Contrast, Edge Boxes, Super Pixel Straddling, Selective Search, etc. Out of all these, Selective Search and Edge Boxes are found to be more effective. Selective Search is also known as a Class-agnostic detector.", "Class-agnostic detectors are often used as a pre-processor to produce a bunch of interesting bounding boxes that have a high chance of containing a cat, dog, car, etc.", "Obviously, we need a specialized classifier after a class-agnostic detector to actually know what class each bounding box contains. While R-CNN is agnostic to the particular region proposal method, we use selective search to enable a controlled comparison with prior detection work.", "Selective Search uses Hierarchical Clustering to get various region proposals.", "At first, it groups pixels very tightly, and then the pixels coalesce into one based on similar color, texture, and composition. At a higher level, we get a set of region proposals from the image by cropping out different patches as shown in the last column.", "Since we combine the region proposals with CNN, it is referred to as R-CNN. As the localization network such as VGG Net/Alex Net accepts only fixed-size inputs and all the region proposals may not be of that size, the cropped images must be warped into the size acceptable by the network.", "At first, R-CNN gave an accuracy of 44%, which was a bit low. But after a few changes, it raised to 66%. Let\u2019s look at how the accuracy was increased.", "The very first architecture did not include a BBox Regressor since they thought it would be unnecessary as the input would already be a cropped image.", "With the above architecture, we would get an accuracy of 44%. The AlexNet used is pre-trained on the ImageNet dataset which contains around 14 million images with 1000 classes. But why do we get such a low accuracy even when it is trained on such a huge dataset?", "The reason here is that the images in the ImageNet dataset would be of a specific aspect ratio and the cropped and warped images the network receives from selective search has a different aspect ratio. This means that in general, the network would think that the image of a person would be tall and thin. But when we warp the region proposal to the required size, the image gets stretched and it\u2019s aspect ratio gets disturbed. This accounts for some loss of accuracy.", "As discussed, you can look at the aspect ratios of both the images. The warped image looks stretched. In this way, the warped image looks so unnatural distorting the aspect ratio of the image. So, to counter this issue, fine-tuning of the network with region proposals is proposed. But, this training phase includes a softmax classifier instead of an SVM and the loss function would be the Cross-Entropy loss. To grasp the core intuition behind Cross-Entropy, you can read my previous article here. There is one SVM allocated for one class and the SVMs are trained offline using the stored feature maps. Each SVM is trained by providing the correct and wrong proposals for that class.", "So, when we fine-tune the network, we update weights both in the convolution and fully connected layers. This resulted in a jump of 10% in the accuracy leading to 54.2%. After that, it is also experimentally found out that including a bounding box regressor resulted in a much better accuracy as it tightened the bounding boxes more accurately than before. It included only one fully connected layer rather than two. This resulted in a further jump of accuracy leading to 58.5%. Using VGG Net in place of AlexNet which is much deeper led to the best performing model of R-CNN with an accuracy of 66%.", "This is a high-level diagram of an R-CNN. Further, many improvements and experiments are done by including and removing the fully connected layers with and without fine-tuning. It is observed that while fine-tuning more number of weights were altered in the fully connected layers rather than the convolution layers which was an interesting observation.", "Note that all of these observations were made on the PASCAL VOC 2007 dataset and the architecture used for experiments is the Alex Net.", "Without fine-tuning, there was not much difference in the accuracy even if we add the Fully Connected Layers. This shows that most of the accuracy was achieved in the convolution layers itself and the fully connected layers were hardly adding any value. This needs to be taken into account because the model size of the convolutional layers is around 3.7 MB whereas the Fully Connected Layers need around 192 MB. We can imagine the amount of memory we can save by excluding the FC layers. However, the story turned when we fine-tune the network with the region proposals. Most of the weights were altered in the FC layers and by this, we can see a significant rise in the accuracy. Also, if we exclude the FC7 layer we get an accuracy of 53.1% which is just 1.1% less than to the addition of it. We can consider removing this as it accounts for 29% of the total model size. But it isn\u2019t mandatory, as one can trade-off between time, size, and accuracy. If we need a much accurate model and we have time and space, we may consider including it for critical applications such as in the medical field where accuracy is more important.", "With this R-CNN we\u2019ve avoided the usage of Sliding Window technique and also Image Pyramid, but we\u2019ve got our region proposals of different sizes. We\u2019ve managed to find out the region proposals without using Image Pyramid, but 2000 proposals per image is too large and involves huge computation. R-CNN is not perfect. It has some drawbacks.", "I hope you\u2019ve understood the principles behind Object Detection and the R- CNN architecture. To address the drawbacks of R-CNN, a year later Fast R-CNN was proposed where it was 146 times faster than RCNN. More about Fast, Faster, and Mask RCNNs will be discussed in my upcoming article.", "Edit: You can read the next part to this article which covers Fast RCNN and Faster RCNN here.", "If you\u2019d like to get in touch, connect with me on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "An ardent learner in the field of AI, blockchain and loves to explore new tech."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe39c16f37600&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e39c16f37600--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aakarsh0705?source=post_page-----e39c16f37600--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Aakarsh Yelisetty"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ed920938e13&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=post_page-4ed920938e13----e39c16f37600---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Convolutional_neural_network", "anchor_text": "here"}, {"url": "https://staff.fnwi.uva.nl/th.gevers/pub/GeversIJCV2013.pdf", "anchor_text": "Selective Search for Object Recognition J. R. R. Uijlings, K. E. A. van de Sande, T. Gevers, A. W. M. Smeulders"}, {"url": "https://towardsdatascience.com/entropy-cross-entropy-and-kl-divergence-explained-b09cdae917a", "anchor_text": "my previous article here"}, {"url": "https://towardsdatascience.com/understanding-fast-r-cnn-and-faster-r-cnn-for-object-detection-adbb55653d97", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/aakarsh-yelisetty-6b691b171/", "anchor_text": "LinkedIn"}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "https://arxiv.org/pdf/1312.6229.pdf"}, {"url": "https://arxiv.org/pdf/1312.6229.pdf", "anchor_text": "https://arxiv.org/pdf/1312.6229.pdf"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----e39c16f37600---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e39c16f37600---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e39c16f37600---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----e39c16f37600---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----e39c16f37600---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=-----e39c16f37600---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=-----e39c16f37600---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe39c16f37600&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e39c16f37600---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e39c16f37600--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e39c16f37600--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e39c16f37600--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e39c16f37600--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e39c16f37600--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aakarsh0705?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Aakarsh Yelisetty"}, {"url": "https://medium.com/@aakarsh0705/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "141 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ed920938e13&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=post_page-4ed920938e13--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe011017c9cea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-object-detection-and-r-cnn-e39c16f37600&newsletterV3=4ed920938e13&newsletterV3Id=e011017c9cea&user=Aakarsh+Yelisetty&userId=4ed920938e13&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}