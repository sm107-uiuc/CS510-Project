{"url": "https://towardsdatascience.com/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b", "time": 1683014869.362987, "path": "towardsdatascience.com/anomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b/", "webpage": {"metadata": {"title": "Anomaly Detection in Process Control Data with Machine Learning | by Nicholas Lewis | Towards Data Science", "h1": "Anomaly Detection in Process Control Data with Machine Learning", "description": "Anomaly detection is a powerful application of machine learning in a real-world situation. From detecting fraudulent transactions to forecasting component failure, we can train a machine learning\u2026"}, "outgoing_paragraph_urls": [{"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/nrlewis929/TCLab_anomaly_detection_basic", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://apmonitor.com/pdc/index.php/Main/ArduinoSetup", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html", "anchor_text": "scikit-learn", "paragraph_index": 12}, {"url": "https://scikit-learn.org/stable/supervised_learning.html", "anchor_text": "many other supervised classifiers you could use", "paragraph_index": 13}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html", "anchor_text": "scikit-learn", "paragraph_index": 19}, {"url": "https://scikit-learn.org/stable/supervised_learning.html", "anchor_text": "scikit-learn", "paragraph_index": 27}], "all_paragraphs": ["Anomaly detection is a powerful application of machine learning in a real-world situation. From detecting fraudulent transactions to forecasting component failure, we can train a machine learning model to determine when something out of the ordinary is occurring.", "When it comes to machine learning, I\u2019m a huge advocate for learning by experiment. The actual math behind machine learning models can be a bit of a black box, but that doesn\u2019t keep it from being useful; in fact, I feel like that\u2019s one of the advantages of machine learning. You can apply the same algorithms to solving a whole gamut of problems. Sometimes, the best way to learn is to handle some real data and see what happens with it.", "In this example, we\u2019ll be able to generate some real data with the Temperature Control Lab device and train a supervised classifier to detect anomalies. The TCLab is a great little device for generating real data with a simple plug-and-play Arduino device. If you want to create your own data for this, there are great introductory resources found here; otherwise, I included data I generated on my own TCLab device in the Github repository. If you want to run these examples on your own, you can download and follow the code here.", "The TCLab is a simple Arduino device with two heaters and two temperature sensors. It\u2019s a simple plug and play device, with a plug to power the heaters and a USB port to communicate with the computer. The heater level can be adjusted in a Python script (be sure to pip install tclab), and the temperature sensor is used to read the temperature surrounding each heater. For this example, we\u2019ll keep it basic and just use one heater and sensor, but the same principles could also be applied to the 2 heater system, or even more complex systems such as what you might find in a chemical refinery.", "We can imagine the problem as this: we have a heater for our garage workshop, with a simple on/off setting. We can program the heater to turn on or off for certain amounts of time each day to keep the temperature at a comfortable level. There are, of course, more sophisticated control systems we could use; however, this is designed as an introduction to anomaly detection with machine learning, so we\u2019ll keep the raw data simple for now.", "Under normal circumstances, it\u2019s a simple enough exercise to verify that the heater is on and doing its job \u2014 just look at the temperature and see if it\u2019s going up. But what if there are external factors that complicate the evaluation? Maybe the garage door was left open and lets a draft in, or perhaps some of your equipment starts overheating. Or worse yet, what if there\u2019s a cyberattack on the temperature control, and it\u2019s masked by the attackers? Is there a way to look at the data we\u2019re gathering and determine when something is going wrong? This is the heart of anomaly detection.", "With a supervised classifier, we can look at the sensor data and train it to classify when the heater is on or off. Since we also know when the heater should be on or off, we can then apply the classifier to any new data coming in and determine whether the behavior lines up with the data we see. If the two don\u2019t match, we know there\u2019s an anomaly of some type, and can investigate further.", "To simulate this scenario, we\u2019ll generate a data file from the TCLab, turning the heater on and off at different intervals. If you\u2019re having trouble with your TCLab setup, there are some great troubleshooting resources here.", "To start, we\u2019ll set up a few arrays to store the data, which we\u2019ll collect in 1 second intervals. The heater on/off cycling will be pretty simple for now, just turning it all the way on or off and leaving it for a few minutes. We\u2019ll run for an hour to make sure we have lots of data to train and validate on.", "The TCLab inputs are straightforward, setting lab.Q1 to either on or off, depending on what we generated. We only turn the heater on 70% to avoid overheating, and then record the temperature at each time point from lab.T1 . Finally, let the loop delay for 1 second.", "The anomalous data is created in basically the same way, but with only 20 minutes. The big difference is that I blow a fan across the heater at a specified time, simulating a draft in the garage. The convection from the fan will naturally cool the system, counteracting what the heater is trying to do. Since this is unanticipated, we should see the classifier pick this up \u2014 perhaps indicating the heater is off when we know it\u2019s on. Let\u2019s go ahead and find out if it works!", "One of the keys to machine learning is investigating how to frame your data in a way that is useful for the model. When I do any project in machine learning, this is often the most time-consuming step. If I get it right, the model works like a charm; otherwise, I can spend hours or even days of frustration, wondering why my model won\u2019t work.", "You should always scale your data for machine learning applications, and this can easily be done with the MinMaxScaler from scikit-learn. In addition, check that the format of your data is correct for the model (for example, does the shape of a numpy array match what the classifier expects? If not, you\u2019ll likely get a warning). Let\u2019s see what this looks like so far. Note that we don\u2019t scale the y data because it\u2019s already just 0's and 1's.", "You\u2019ll notice that our input is just the temperature, and the output we\u2019re trying to predict is the heater status (on or off). Is this effective? Can the classifier tell if the heater is on or off based only on the temperature? Thankfully with scikit-learn, training and predicting with a supervised classifier is just a few lines of code. We\u2019ll also be using the Logistic Regression classifier, but there are many other supervised classifiers you could use.", "The answer to if we can just use the raw temperature as the input is an emphatic no. This makes intuitive sense \u2014 for example, at 35\u00b0C, the heater is either on or off. However, the change in temperature would tell us a whole lot about what the heater is doing.", "This introduces the realm of feature engineering, another important part of setting up a problem for machine learning. We can create additional features out of what we already have. What other data can we glean from just the raw temperature? We can get the 1st and 2nd derivatives, the standard deviation over the past few readings, and even look at long-term difference trends. Another trick to try is log scaling the data, especially if it\u2019s log distributed. These are all new features, and some of them may just well be the silver bullet to feed into the classifier for good performance!", "Again, some domain knowledge and intuition of the specific problem is really useful for feature engineering. Let\u2019s start with looking at the change in temperature. There\u2019s a bit of sensor noise, and so taking a rolling average of the temperature gives a nicer plot that will likely result in better performance.", "Let\u2019s see how that does. The only difference is that we create the dT column in our dataframe and use that as the input feature. We also have to drop any data with NaN values.", "The result\u2026is pretty good! There are a few misses, but those are always on the edge when the heater has just turned on or off. We could look into more features such as the 2nd derivative that might help with this, but for now, this looks like it will do the trick.", "Best practice before setting out to use the trained classifier dictates validating the performance on data that has never been seen. I personally like to try it out on the original training data initially, just as a gut check; if it doesn\u2019t work there, it won\u2019t work on new data. However, we saw that it worked well on the above data, so let\u2019s do this check now on a new set of data. You can either generate a new anomaly-free data file from the TCLab, or use the train_test_split from scikit-learn. Note that we only use the transform feature on the data scaling, since we\u2019ve already fit the scaler and used that scaling to train the classifier.", "Here\u2019s a plot of the results:", "It checks out. Again, there are the fringe cases when the heater turns on or off. We could look into additional features to feed into the classifier, or even change the hyperparameters for the classifier, but for a simple demo, this is sufficient.", "Here is where the rubber hits the road. We know the classifier works well to tell us when the heater is on or off. Can it tell us when something unexpected is happening?", "The process is really the same. The only difference is now we have an anomaly in the data. We\u2019ll create the new feature (change in temperature, using the smoothed rolling average), scale the data, and feed it into the classifier to predict.", "This looks like it worked well! We see the prediction is that the heater is off when the fan is running, when in reality the heater is on, there\u2019s just an anomalous event. Even after the fan goes off, the system is re-equilibrating, so there\u2019s some additional mismatch between what\u2019s actually going on with the heater and what the classifier is predicting. If an operator is looking at the data coming in, they can compare what they expect the heater to be doing and what the classifier is predicting; any discrepancies indicate an anomaly that can be investigated.", "This was a neat experiment with just one type of anomaly, using data that we generated right here on our tabletop! Sure it\u2019s simple, but these kinds of problems can quickly become complex. The guiding principles are the same, though.", "What other anomalous events might happen? We could simulate anomalous outside heat by turning on heater 2. We could simulate colder ambient temperature by running the TCLab in a colder room. There\u2019s also a neat trick with these devices: if you make a cell phone call near the sensor, the waves interfere with the signal and you can get a completely new type of anomaly. What kinds of features would be useful for detecting these other types of anomalies? Could we tune the hyperparameters to improve the performance?", "Finally, perhaps my favorite strategy when it comes to classifiers is to train several different classifiers, and then take an aggregate score. Go ahead and try out some other types of classifiers from scikit-learn. Which ones work well? Which don\u2019t? If you find 4 or 5 that work pretty well, you could train all of them, and then only flag something as an anomaly if a majority of classifiers show a mismatch.", "Was this helpful? Did you like being able to generate your own data? What other ideas have you found useful for anomaly detection? Thanks for reading, and I hope this introduction opened up some new ideas for your own projects.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F35056a867f5b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://nrlewis929.medium.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702----35056a867f5b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/hands-on-tutorials", "anchor_text": "Hands-on Tutorials"}, {"url": "https://unsplash.com/@anikinearthwalker?utm_source=medium&utm_medium=referral", "anchor_text": "Dimitry Anikin"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "here"}, {"url": "https://github.com/nrlewis929/TCLab_anomaly_detection_basic", "anchor_text": "here"}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "APMonitor"}, {"url": "https://apmonitor.com/pdc/index.php/Main/ArduinoSetup", "anchor_text": "here"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html", "anchor_text": "scikit-learn"}, {"url": "https://scikit-learn.org/stable/supervised_learning.html", "anchor_text": "many other supervised classifiers you could use"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html", "anchor_text": "scikit-learn"}, {"url": "https://scikit-learn.org/stable/supervised_learning.html", "anchor_text": "scikit-learn"}, {"url": "https://medium.com/tag/anomaly-detection?source=post_page-----35056a867f5b---------------anomaly_detection-----------------", "anchor_text": "Anomaly Detection"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----35056a867f5b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/engineering?source=post_page-----35056a867f5b---------------engineering-----------------", "anchor_text": "Engineering"}, {"url": "https://medium.com/tag/data-generation?source=post_page-----35056a867f5b---------------data_generation-----------------", "anchor_text": "Data Generation"}, {"url": "https://medium.com/tag/hands-on-tutorials?source=post_page-----35056a867f5b---------------hands_on_tutorials-----------------", "anchor_text": "Hands On Tutorials"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----35056a867f5b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----35056a867f5b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F35056a867f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----35056a867f5b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----35056a867f5b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----35056a867f5b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----35056a867f5b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----35056a867f5b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----35056a867f5b--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://nrlewis929.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "214 Followers"}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "https://www.linkedin.com/in/nicholas-lewis-0366146b/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9c6ec087b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fanomaly-detection-in-process-control-data-with-machine-learning-35056a867f5b&newsletterV3=a4cd35f7b702&newsletterV3Id=9c6ec087b148&user=Nicholas+Lewis&userId=a4cd35f7b702&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}