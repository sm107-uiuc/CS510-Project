{"url": "https://towardsdatascience.com/mlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212", "time": 1683005849.7396202, "path": "towardsdatascience.com/mlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212/", "webpage": {"metadata": {"title": "mlmachine - GroupbyImputer, KFoldEncoder, and Skew Correction | by Tyler Peterson | Towards Data Science", "h1": "mlmachine - GroupbyImputer, KFoldEncoder, and Skew Correction", "description": "mlmachine is a Python library that organizes and accelerates notebook-based machine learning experiments. In this article, we use mlmachine to accomplish actions that would otherwise take\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/petersontylerd/mlmachine/blob/master/notebooks/mlmachine_part_2.ipynb", "anchor_text": "Jupyter Notebook", "paragraph_index": 2}, {"url": "https://github.com/petersontylerd/mlmachine", "anchor_text": "project", "paragraph_index": 3}, {"url": "https://github.com/petersontylerd/mlmachine", "anchor_text": "GitHub repository", "paragraph_index": 36}], "all_paragraphs": ["mlmachine is a Python library that organizes and accelerates notebook-based machine learning experiments.", "In this article, we use mlmachine to accomplish actions that would otherwise take considerable coding and effort, including:", "Check out the Jupyter Notebook for this article.", "Check out the project on GitHub.", "Check out other entries in the mlmachine series:", "Let\u2019s start by instantiating a couple Machine() objects, one for our training data and a second for our validation data", "Each Machine() object contains a method for summarizing missingness in tabular form and in graphical form:", "By default, this method acts on the data attribute associated with mlmachine_train. Let\u2019s do the same for the validation dataset:", "Next, we need to determine if there are features with missing values in the training data, but not the validation data, and vice versa. This informs how we should set up our transformation pipeline. For example, if a feature has missing values in the validation dataset, but not the training dataset, we will still want to fit_transform this feature on the training data to learn imputation values to apply on the nulls in the validation dataset.", "We could eyeball the tables and visuals above to compare the state of missingness in the two datasets, but this can be tedious, particularly with large datasets. Instead, we will leverage a method within our Machine() object. We simply pass the validation dataset to mlmachine_titanic_train\u2019s method missing_col_compare, which returns a bidirectional missingness summary.", "The key observation here is that \u201cFare\u201d is fully populated in the training data, but not the validation data. We need to make sure our pipeline learns how to impute these missing values based on the training data, despite the fact that the training data is not missing any values in this feature.", "mlmachine includes a transformer called GroupbyImputer(), which makes it easy to perform the same basic imputation techniques provided by Scikit-learn\u2019s SimpleImputer(), but with the added ability to group by another feature in the dataset. Let\u2019s see an example:", "In the code snippet above, we mean impute \u201cAge\u201d, grouped by \u201cSibSp\u201d. We pass \u201cAge\u201d to the null_column parameter to indicate which column contains the nulls, and pass \u201cSibSp\u201d to the groupby_column parameter. The strategy parameter receives the same instructions as Scikit-learn\u2019s SimpleImputer() - \u201cmean\u201d, \u201cmedian\u201d and \u201cmost_frequent\u201d.", "To inspect the learned values, we can display the object\u2019s train_value attribute, which is a DataFrame containing the category/value pairs:", "GroupbyImputer() uses these pairs to impute the missing values in \u201cAge\u201d. If, in the unlikely circumstance, a level in groupby_column has only null values in null_column, then the missing values associated with that level will be imputed with the mean, median or mode of the entire feature.", "Now we\u2019re going to use GroupbyImputer() within PandasFeatureUnion() to impute nulls in both the training and validation datasets.", "At this point, we have imputed all of our nulls. Here is the output, still in a DataFrame:", "GroupbyImputer() makes two appearances in this PandasFeatureUnion() operation. On line 4, we groupby the feature \u201cSibSp\u201d to impute the mean \u201cAge\u201d value, and on line 8 we groupby the feature \u201cPclass\u201d to impute the mean \u201cFare\u201d value.", "Imputations for \u201cEmbarked\u201d and \u201cCabin\u201d are completed in a straightforward fashion - \u201cEmbarked\u201d is simply imputed with the mode, and \u201cCabin\u201d is imputed with the constant value of \u201cX\u201d.", "Lastly, we fit_transform() the PandasFeatureUnion() on mlmachine_titanic_train.data and finish filling our nulls by calling transform() on mlmachine_titanic_valid.data.", "Target value-based encoding techniques such as mean encoding, CatBoost Encoding, and Weight of Evidence encoding are often discussed in the context of Kaggle competitions. The primary advantage of these techniques is that they use the target variable to inform the encoded feature\u2019s values. However, this comes with the risk of leaking target information into the encoded values.", "KFold cross-validation assists in avoiding this problem. The key is to apply the encoded values to the out-of-fold observations only. This visualization illustrates the general pattern:", "mlmachine has a class called KFoldEncoder() that facilitates KFold encoding with an encoder of choice. Let\u2019s use a small subset of our features to see how this works.", "We want to target encode two features: \u201cPclass\u201d and \u201cAge\u201d. Since \u201cAge\u201d is a continuous feature, we first need to map the values to bins, which is effectively an ordinal categorical column. We handle all of this in the simple PandasFeatureUnion below:", "This operation returns a binned version of \u201cAge\u201d, as well as the original \u201cAge\u201d and \u201cPclass\u201d features.", "Next, we target encode both \u201cPclass\u201d and \u201cAge_binned_5\u201d using mean encoding, CatBoost encoding and Weight of Evidence encoding as provided by the package category_encoders.", "Let\u2019s review the key KFoldEncoder() parameters:", "KFoldEncoder() learns the encoded values on the training data, and applies the values to the out-of-fold observations.", "On the validation data, the process is simpler: we calculate the average out-of-fold encodings applied to the training data and apply these values to all validation observations.", "Just as we have a quick method for evaluating missingness, we have a quick method for evaluating skew.", "The skew_summary() method returns a DataFrame that summarizes the skew for each feature, along with a \u201cPercent zero\u201d column, which informs us of the percentage of values in the feature that are zero.", "mlmachine contains a class called DualTransformer(), which, by default, applies both Yeo-Johnson and Box-Cox transformations to the specified features with the intent of correcting skew. The Box-Cox transformation automatically seeks the lambda value which maximizes the log-likelihood function.", "Since Box-Cox transformation requires all values in a feature to be greater than zero, DualTransformer() applies one of two simple feature adjustments when this rule is violated:", "Let\u2019s use DualTransformer() to see if we can minimize the skew in the original \u201cAge\u201d feature:", "DualTransformer() adds the features \u201cAge_BoxCox\u201d and \u201cAge_YeoJohnson\u201d. Let\u2019s execute skew_summary() again to see if DualTransformer() addressed the skew in our original feature:", "We just learned how to use mlmachine to perform novel imputation techniques, exotic categorical feature encoding, and efficient skew correction.", "Check out the GitHub repository, and stay tuned for additional column entries.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior Director, Data Intelligence & Interoperability at Vizient, Inc"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F357f202d2212&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----357f202d2212--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@petersontylerd?source=post_page-----357f202d2212--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@petersontylerd?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Tyler Peterson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd34516b410ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&user=Tyler+Peterson&userId=d34516b410ae&source=post_page-d34516b410ae----357f202d2212---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2764820", "anchor_text": "Gerd Altmann"}, {"url": "https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2764820", "anchor_text": "Pixabay"}, {"url": "https://github.com/petersontylerd/mlmachine/blob/master/notebooks/mlmachine_part_2.ipynb", "anchor_text": "Jupyter Notebook"}, {"url": "https://github.com/petersontylerd/mlmachine", "anchor_text": "project"}, {"url": "https://towardsdatascience.com/mlmachine-clean-ml-experiments-elegant-eda-pandas-pipelines-daba951dde0a", "anchor_text": "mlmachine - Clean ML Experiments, Elegant EDA & Pandas PipelinesThis new Python package accelerates notebook-based machine learning experimentationtowardsdatascience.com"}, {"url": "https://towardsdatascience.com/mlmachine-crowd-sourced-feature-selection-50cd2bbda1b7", "anchor_text": "mlmachine - Crowd-Sourced Feature SelectionThis new Python package accelerates notebook-based machine learning experimentationtowardsdatascience.com"}, {"url": "https://medium.com/@pouryaayria", "anchor_text": "Pourya"}, {"url": "https://medium.com/@pouryaayria/k-fold-target-encoding-dfe9a594874b", "anchor_text": "Medium"}, {"url": "https://github.com/petersontylerd/mlmachine", "anchor_text": "GitHub repository"}, {"url": "https://medium.com/tag/python?source=post_page-----357f202d2212---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----357f202d2212---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----357f202d2212---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/mlmachine?source=post_page-----357f202d2212---------------mlmachine-----------------", "anchor_text": "Mlmachine"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&user=Tyler+Peterson&userId=d34516b410ae&source=-----357f202d2212---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&user=Tyler+Peterson&userId=d34516b410ae&source=-----357f202d2212---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----357f202d2212--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F357f202d2212&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----357f202d2212---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----357f202d2212--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----357f202d2212--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----357f202d2212--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----357f202d2212--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----357f202d2212--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@petersontylerd?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@petersontylerd?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tyler Peterson"}, {"url": "https://medium.com/@petersontylerd/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "40 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd34516b410ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&user=Tyler+Peterson&userId=d34516b410ae&source=post_page-d34516b410ae--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fd34516b410ae%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmlmachine-groupbyimputer-kfoldencoder-and-skew-correction-357f202d2212&user=Tyler+Peterson&userId=d34516b410ae&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}