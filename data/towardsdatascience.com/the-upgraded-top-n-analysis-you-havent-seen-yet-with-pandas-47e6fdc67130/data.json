{"url": "https://towardsdatascience.com/the-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130", "time": 1683013524.113865, "path": "towardsdatascience.com/the-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130/", "webpage": {"metadata": {"title": "The Upgraded \u201cTop N\u201d Analysis You Haven\u2019t Seen Yet with Pandas | by Byron Dolon | Towards Data Science", "h1": "The Upgraded \u201cTop N\u201d Analysis You Haven\u2019t Seen Yet with Pandas", "description": "A Top N analysis can be useful to select a subset of your data matching a specific condition. For example, what if you owned a restaurant and wanted to look at which customers contributed most to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/you-dont-always-have-to-loop-through-rows-in-pandas-22a970b347ac", "anchor_text": "this introduction", "paragraph_index": 23}], "all_paragraphs": ["Did you know that you can have a Top N analysis based on more than one column in Pandas?", "A Top N analysis can be useful to select a subset of your data matching a specific condition. For example, what if you owned a restaurant and wanted to look at which customers contributed most to your overall sales? The easiest way to do this would be to look at the total sales for all your customers, then sort that list from highest to lowest.", "Another interesting subset for you to look at might be the customers who had the lowest (or negative) profit contribution. You could then accomplish this in a similar fashion, getting a list of all customers by their profit contribution and then taking only the lowest members.", "But what if you wanted to find out if there were customers that appeared on both lists?", "That could help you identify areas in which you\u2019re actually losing money, even if it looks like the total sales value is very high. For example, if you had a dish that had a very low-profit margin, repeated orders of this dish alone might not be beneficial for your bottom line.", "Let\u2019s take a look at how you can combine the built-in Pandas functions to do this kind of analysis!", "The data used in this piece is sourced from Yahoo Finance. We\u2019ll be using a subset of Tesla stock price data. Run the code below if you want to follow along. (And if you\u2019re curious as to the function I used to get the data, scroll to the very bottom and click on the first link.)", "To demonstrate how we can combine the Top N and Bottom N analysis, we\u2019re going to answer the following question:", "Which days had the highest increase in stock price while also having the lowest Open price in the data set?", "First, we\u2019ll need to calculate how much the stock price changed during the day. This can be achieved with a simple calculation:", "We\u2019ve stored the difference between the \u201cClose*\u201d and \u201cOpen\u201d columns into a new column called \u201cGain\u201d. As you can see in the table above, not all column values are positive, as there were some days where the stock price decreased.", "Next, we\u2019ll be creating two new DataFrames: one with the top 10 highest \u201cGain\u201d values and one with the top 10 lowest \u201cOpen\u201d values.", "Here, we\u2019ll be using the nlargest method in Pandas. This method accepts the number of elements you want to keep, the column you want to order the DataFrame by, and which duplicate values (if any) should appear in the outputted DataFrame. By default, nlargest will only keep the first of any duplicates, and the rest will be excluded from the returned DataFrame.", "This method will return the same results as df.sort_values(columns, ascending=false).head(n). This code is very easy to understand and will also work, but according to the documentation, the nlargest method is more performant.", "The code to get the 10 rows with the highest \u201cGain\u201d values is as follows:", "The returned DataFrame now gives us only the values in the original DataFrame with the highest 10 \u201cGain\u201d values. This new DataFrame is also already sorted in descending order.", "Next, we\u2019ll use the nsmallest method on the DataFrame to get the rows with the lowest \u201cOpen\u201d values. This method works exactly like the previous one, except it would sort and slice the values ascending order.", "The code to achieve this is as follows:", "We\u2019re now ready to combine the two DataFrames to create a combined set. I\u2019m borrowing this term from a built-in Tableau function, but all it refers to is a subset of the data that matches multiple conditions based on two or more columns. In this case, we\u2019re looking for the data that exists only in the top 10 of \u201cGain\u201d and the bottom 10 of \u201cOpen\u201d.", "To get our combined set, there are two main steps:", "The code to achieve this is as follows:", "First, we simply call pd.concat and stick the two DataFrames together. Since the top N and bottom N DataFrames come from the exact same source, we don\u2019t need to worry about renaming any columns or specifying an index.", "Next, to create the \u201cDuplicate\u201d column, we make use of the duplicated method. This function returns a boolean Series with marking a row as \u201cTrue\u201d if it\u2019s a duplicate and \u201cFalse\u201d otherwise. You can call this on a DataFrame and specify which column to search for duplicates in by writing the column name as an argument (in this case subset=['Date']). For demonstration, I created a new column \u201cDuplicate\u201d to store the new boolean values in.", "I won\u2019t go into how the loc[] function works, but if you haven\u2019t used it before, quickly skim through this introduction so you understand how you can use it to filter your DataFrame in various ways. All we\u2019re doing with it here is taking the values in the \u201cDuplicate\u201d column that are True because those are the ones that appear in both DataFrames.", "We don\u2019t even really need to create a new column to mark the duplicate values. A slightly condensed (and equivalent) version of the above code would look like this:", "Voila! Now we can see the rows in which there was a high \u201cGain\u201d during one of the days with the lowest \u201cOpen\u201d in the whole dataset.", "I hope you found this quick look at the Top N (and Bottom N) analysis useful. Combining multiple conditions can allow you to filter and work with your data in new ways, which can help you extract valuable information from your dataset.", "Good luck with your Pandas work!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Medium has become a place to store my \u201chow to do tech stuff\u201d type guides. Come check out my notes on data-related shenanigans!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F47e6fdc67130&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://byrondolon.medium.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": ""}, {"url": "https://byrondolon.medium.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Byron Dolon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6b5d063df5dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&user=Byron+Dolon&userId=6b5d063df5dd&source=post_page-6b5d063df5dd----47e6fdc67130---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.instagram.com/softie__arts/", "anchor_text": "softie__arts"}, {"url": "https://finance.yahoo.com/quote/TSLA/history?period1=1546300800&period2=1550275200&interval=1d&filter=history&frequency=1d", "anchor_text": "https://finance.yahoo.com/quote/TSLA/history?period1=1546300800&period2=1550275200&interval=1d&filter=history&frequency=1d"}, {"url": "https://finance.yahoo.com/quote/TSLA/history?period1=1546300800&period2=1550275200&interval=1d&filter=history&frequency=1d", "anchor_text": "Yahoo Finance"}, {"url": "https://towardsdatascience.com/you-dont-always-have-to-loop-through-rows-in-pandas-22a970b347ac", "anchor_text": "this introduction"}, {"url": "https://towardsdatascience.com/2-easy-ways-to-get-tables-from-a-website-with-pandas-b92fc835e741?source=friends_link&sk=9981ddaf0785a79be893b5a1dd3e03dd", "anchor_text": "2 Easy Ways to Get Tables From a Website with Pandas"}, {"url": "https://towardsdatascience.com/how-to-quickly-create-and-unpack-lists-with-pandas-d0e78e487c75?source=friends_link&sk=32ea67b35fe90382dc719c1c78c5900c", "anchor_text": "How to Quickly Create and Unpack Lists with Pandas"}, {"url": "https://towardsdatascience.com/top-4-repositories-on-github-to-learn-pandas-1008cb769f77?source=friends_link&sk=d3acc38062490a86ecb46875342224e6", "anchor_text": "Top 4 Repositories on GitHub to Learn Pandas"}, {"url": "https://towardsdatascience.com/a-quick-way-to-reformat-columns-in-a-pandas-dataframe-80d0b70de026?source=friends_link&sk=e54f86ec079fb17d5824bac6d1e93919", "anchor_text": "A Quick Way to Reformat Columns in a Pandas DataFrame"}, {"url": "https://medium.com/tag/python?source=post_page-----47e6fdc67130---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----47e6fdc67130---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----47e6fdc67130---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/technology?source=post_page-----47e6fdc67130---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/data?source=post_page-----47e6fdc67130---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&user=Byron+Dolon&userId=6b5d063df5dd&source=-----47e6fdc67130---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&user=Byron+Dolon&userId=6b5d063df5dd&source=-----47e6fdc67130---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F47e6fdc67130&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----47e6fdc67130---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----47e6fdc67130--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----47e6fdc67130--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----47e6fdc67130--------------------------------", "anchor_text": ""}, {"url": "https://byrondolon.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://byrondolon.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Byron Dolon"}, {"url": "https://byrondolon.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6b5d063df5dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&user=Byron+Dolon&userId=6b5d063df5dd&source=post_page-6b5d063df5dd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb2ea4b269407&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-upgraded-top-n-analysis-you-havent-seen-yet-with-pandas-47e6fdc67130&newsletterV3=6b5d063df5dd&newsletterV3Id=b2ea4b269407&user=Byron+Dolon&userId=6b5d063df5dd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}