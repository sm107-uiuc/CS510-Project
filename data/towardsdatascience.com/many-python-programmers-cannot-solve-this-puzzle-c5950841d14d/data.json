{"url": "https://towardsdatascience.com/many-python-programmers-cannot-solve-this-puzzle-c5950841d14d", "time": 1683018146.622037, "path": "towardsdatascience.com/many-python-programmers-cannot-solve-this-puzzle-c5950841d14d/", "webpage": {"metadata": {"title": "Many Python Programmers Cannot Solve This Puzzle | by Naser Tamimi | Towards Data Science", "h1": "Many Python Programmers Cannot Solve This Puzzle", "description": "Many Python beginners ask What is happening when I run a Python code? What is under the hood? What is a bytecode? They want to know how the compiler and interpreter work. This article explains how Python compiles and interprets a code from starting to the end."}, "outgoing_paragraph_urls": [{"url": "https://github.com/python/cpython/blob/master/Python/ceval.c", "anchor_text": "see here", "paragraph_index": 14}, {"url": "https://tech.blog.aknin.name/category/my-projects/pythons-innards/", "anchor_text": "https://tech.blog.aknin.name/category/my-projects/pythons-innards/", "paragraph_index": 21}, {"url": "https://twitter.com/TamimiNas", "anchor_text": "https://twitter.com/TamimiNas", "paragraph_index": 22}], "all_paragraphs": ["Let me get straight to the puzzle. Are you ready?!! Okay, take a look at these two super simple codes.", "Both codes do a dummy task. They take numbers between 0 and 10 million (through a for loop) and calculate their mod (remainder) of 5. So far, super easy. Now, are you interested in measuring their run time?", "We only added a simple timer to both codes to measure their runtimes. Since both codes are doing the same simple task, we expect to see the same run times.", "Of course, if the run times were the same, I did not write this article. Actually, the run times are 739 ms and 434 ms for Code 1 and Code 2, respectively. SURPRISE!!!!", "This puzzle is known to some Python programmers. However, most Python programmers do not know about this puzzle because it needs a deeper understanding of how Python works. This article gives you an introduction to \u201cwhat does happen when you run a python code?\u201d", "NOTE: This article is written in a simple language for Python beginners. If you are professional and need some resources go to the \u201cadditional resources\u201d section at the end of this article.", "To make it easy, let me focus on the most popular Python implementation called CPython. If you don\u2019t know what Python implementation you are using, there is a 90% chance that you are using CPython.", "Here is what happens to your source code when you run it.", "First, your source code is being broken into tokens through a process called \u201cLexing.\u201d For example, x=1 would be broken into token such as x, =, and1. The tokens are then organized into an abstract syntax tree (AST) through a process called \u201cParsing.\u201d After that, a \u201cCompiler\u201d converts everything to an abstract code called \u201cBytecode.\u201d", "It is important to understand that in Python, unlike other languages (e.g., C, C++, Java, etc.), the compiler does not take the \u201csource code\u201d and convert it to the \u201cmachine code.\u201d Instead, the compiler takes the \u201csource code\u201d and converts it to a \u201cBytecode.\u201d It is the Interpreter\u2019s task to take the bytecode and run it in the way that the machine understands it.", "For those of you who are curious to see Bytecodes, sometimes they are stored (cached) as .pyc files on your disk. Believe me, you cannot understand them. Just to satisfy your curiosity!!!", "Among the four steps of running a code in Python, the interpreter has the heaviest job to do, and the other three steps are not handling too much of the load. Therefore, any time you want to investigate a Python program's performance, you should look at the interpretation step and look for some clues.", "The interpreter reads the bytecode and runs its instructions. If bytecode is like a recipe, instructions are like different steps in that recipe.", "If we could read the bytecode, we might have some clues about our puzzle. To take a look at the bytecode instructions, we can use the dis package. dis is a Python package to disassemble and decode bytecodes and display them in a way that human can understand it. The output of thedis.dis() has a structure like this:", "I don\u2019t go through the details for the dis package and focus on the one column of Operation Name. Operation name instructs Python interpreter what should be done. If you are too curious, in fact, a file called ceval.c has all the instructions (see here).", "I ran dis.dis() for both codes, and to make it simple for you, I highlight the important part, which is the loop portion. The figure below shows the bytecodes for both codes.", "As you see, both codes are very similar in terms of given instructions. But, if you look more closely, you find some subtle (but important) differences in bytecodes. In Code 1, we see STORE_NAME and LOAD_NAME, but in Code 2, we see STORE_FAST and LOAD_FAST. It seems that the run time difference is because of differences in those two types of instructions. You can take a look at ceval.c file to see the differences.", "Let me make it simple and clear for you. The interpreter processes variables i and x differently in Code 1 compared to Code 2 (note to _NAME and _FAST suffixes). Both i and x are global variables in Code 1, and CPython stores those variables in a dictionary data structure, making the loading process more time-consuming compared to local variables, which are stored in a fixed-sized array. Retrieving a variable from a fixed-size array is much faster compared to a dictionary. Why does Python do that? Simply because in the main code, we don\u2019t know how many variables will show up, but the number of variables is fixed in a function.", "If this is the reason, let\u2019s do a test. Let\u2019s mess with the interpreter and define both x and i variables as global variables in Code 2 (the fast code) and measure the run time again. Here is code 2 after changing.", "I ran Code 3, and it took 805 ms (compared to Code 2, which took 434 ms). The number is very close to Code 1 (i.e., 739 ms). It shows that, as we expected, processing on global variables takes more time compared to local variables (fixed-size array vs. dictionary).", "As you see, we could solve the puzzle with a little bit of knowledge about how Python interpreter works and getting help from dis library. Some other factors, for example, \u201copcode prediction\u201d also contribute to the run time difference, but for the sake of simplicity, we ignored it in this article.", "If you are interested to know more about Python\u2019s underhood. I highly recommend this blog series: https://tech.blog.aknin.name/category/my-projects/pythons-innards/", "Follow me on Twitter for the latest stories: https://twitter.com/TamimiNas", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc5950841d14d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tamimi-naser.medium.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": ""}, {"url": "https://tamimi-naser.medium.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Naser Tamimi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff94e8b97c7aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&user=Naser+Tamimi&userId=f94e8b97c7aa&source=post_page-f94e8b97c7aa----c5950841d14d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@priscilladupreez?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Priscilla Du Preez"}, {"url": "https://unsplash.com/s/photos/local?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@rhyskentish?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Rhys Kentish"}, {"url": "https://unsplash.com/s/photos/what?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/python/cpython/blob/master/Python/ceval.c", "anchor_text": "see here"}, {"url": "https://tech.blog.aknin.name/category/my-projects/pythons-innards/", "anchor_text": "https://tech.blog.aknin.name/category/my-projects/pythons-innards/"}, {"url": "https://twitter.com/TamimiNas", "anchor_text": "https://twitter.com/TamimiNas"}, {"url": "https://medium.com/tag/programming?source=post_page-----c5950841d14d---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c5950841d14d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/computer-science?source=post_page-----c5950841d14d---------------computer_science-----------------", "anchor_text": "Computer Science"}, {"url": "https://medium.com/tag/python?source=post_page-----c5950841d14d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c5950841d14d---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&user=Naser+Tamimi&userId=f94e8b97c7aa&source=-----c5950841d14d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&user=Naser+Tamimi&userId=f94e8b97c7aa&source=-----c5950841d14d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc5950841d14d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c5950841d14d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c5950841d14d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c5950841d14d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c5950841d14d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c5950841d14d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c5950841d14d--------------------------------", "anchor_text": ""}, {"url": "https://tamimi-naser.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tamimi-naser.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Naser Tamimi"}, {"url": "https://tamimi-naser.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff94e8b97c7aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&user=Naser+Tamimi&userId=f94e8b97c7aa&source=post_page-f94e8b97c7aa--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6edd4d0bb08c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmany-python-programmers-cannot-solve-this-puzzle-c5950841d14d&newsletterV3=f94e8b97c7aa&newsletterV3Id=6edd4d0bb08c&user=Naser+Tamimi&userId=f94e8b97c7aa&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}