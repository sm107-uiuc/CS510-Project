{"url": "https://towardsdatascience.com/understanding-customer-churning-with-big-data-analytics-70ce4eb17669", "time": 1682994773.281495, "path": "towardsdatascience.com/understanding-customer-churning-with-big-data-analytics-70ce4eb17669/", "webpage": {"metadata": {"title": "Understanding Customer Churning with Big Data Analytics | by Bowen Chen | Towards Data Science", "h1": "Understanding Customer Churning with Big Data Analytics", "description": "It is not gold, not crude oil\u2026 it is data. You must have heard about the popular buzz word \u201cbig data\u201d, and wondering what exactly that term means. Think about your favorite music streaming services \u2014\u2026"}, "outgoing_paragraph_urls": [{"url": "https://nbviewer.jupyter.org/github/chenbowen184/Data_Science_Portfolio/blob/master/Capstone%20Project/Spark%20-%20Full%20Dataset.ipynb", "anchor_text": "nbviewer site", "paragraph_index": 35}, {"url": "http://Archera.ai", "anchor_text": "Archera.ai", "paragraph_index": 44}], "all_paragraphs": ["Take a guess. What is the world\u2019s most valuable asset right now?", "It is not gold, not crude oil\u2026 it is data. You must have heard about the popular buzz word \u201cbig data\u201d, and wondering what exactly that term means. Think about your favorite music streaming services \u2014 Spotify, Pandora\u2026 etc. Every second across the world, many different users login to the service, have their fair share of interactions with the service. Since every move corresponds to a collectible data point, you would imagine the challenges to store such large data.", "Fortunately, these large datasets could bring real value to the business if they are being consumed in the right way. In this blog post, we will discuss a common use case for these big datasets \u2014 predicting customers churning.", "Churning refers to the behavior of discreetly losing customers from a large population of customers. Some of the churned customers might turn to a competitor, while some of them might simply leave the services forever.", "It might not be noticeable at the beginning, but the effect of such losses accumulates over time. As decision-makers at these music streaming service providers, we would like to understand the contributing factors of such churning behaviors \u2014 that will serve as the primary objective of our project today.", "We will start by examining the dataset available.", "The full dataset is a user log that is stored in a 12 GB .json file \u2014 a size that could only be handled by some big data tools, such as Spark. To fully understand the fields available, we will start by obtaining a small subset of the data (~128 MB) for exploratory data analysis purposes on a single machine. We will load in our dataset through the following commands,", "Spark has a great one-line shortcut of showing all the fields and their respective data types", "After looking at the head of the dataset, we will recognize that all of the user interactions are recorded in the page column.", "While most of the users keep playing the next song, there are some users going into the \u201cCancel\u201d page \u2014 and they all confirmed their cancellations through the \u201cCancellation Confirmation\u201d page (see the same number of \u201cCancel\u201ds and \u201cCancellation Confirmation\u201ds. We will define the churning activity specifically as the number of Cancellation Confirmation. The users with page column have \u201cCancellation Confirmation\u201d will be the churned users that we are specifically interested in.", "We have successfully identified the churned users, now it is time to use our business mindset to think of the contributing factors to users churning. What would you do if you really hate your music streaming services? I have come up with the below 7 features,", "We would reasonably expect some of the other user interactions will eventually lead to our user churning. We could use a box plot to perform the first level filtering. Box plots will effectively help us visualize the minimum, 25th percentile, mean, 75th percentile and maximum for particular data distribution. By plotting box plots for both churned and non-churned users, we could clearly interpret the difference between the two types of users for a particular interaction.", "The following interactions showed significant distribution differences between the two groups,", "Notice that all of our user interactions are in the same column, we will need to pivot and aggregate the total number of a certain interaction for each customer. Based on the above filtering, we will drop some of the less significant interactions.", "For myself, I would probably be using it way shorter than normal users. Therefore, the average length of time the user spent playing music will be a really important factor. A simple visualization showed confirming results on below.", "We will add this feature to our events_pivot table,", "We would also expect a difference in the number of active days between the churned/non-churned groups. Since the datetime column only contains units in seconds, we will need to use a window function to aggregate the total active time for each customer and convert the value to days. We will add this feature to events_pivot.", "4. Number of days as paid users", "Similarly, we could also calculate the number of days as paid users by using a window function, we only need to add a filter for the customer to be a paid customer user.", "5. Number of days as a free user", "Now using the free user filter, we can find the number of days as a free user for each customer,", "The number of music playing sessions could also be a contributing factor. Since the sessionId is available in this dataset, we could directly count the number of unique ids for each user with the groupby clause.", "The streaming service might have disparate performances on different user agents. We will try to add this factor to the model. Since there are 56 different user agents, we will use Spark\u2019s one-hot encoder to turn these different user agents into a vector.", "After we have engineered the appropriate features, we will build three models \u2014 logistic regression, random forest and gradient boosting trees. To avoid writing redundant code, we will build stage objects and construct pipelines with a different classifier at the end of the pipeline.", "now the three objects rf_model, lr_model, gbt_model, represents the 3 different fitted models.", "We will test the fitted models' performances and select the one that has the best performance as the final model. We will start by building a function especially for this purpose,", "We will call the above function to evaluate the above models", "The gradient boosting model showed the best performance (F1 Score) in the test set. F1 score is defined as the harmonic mean of precision and recall, calculated as the following", "Precision is computing the proportion of positive class identifications being the correct ones, in mathematical expressions it is", "Recall is computing the proportion of actual positive class samples being identified correctly, in mathematical expressions it is,", "You might be wondering the reason we opt for a much more complicated metric over the most intuitive accuracy \u2014 it is due to imbalance class distributions existed in the dataset. Since only a small portion of users will eventually churn, we would like our model to correctly identify them instead of pursuing a high overall performance. Imagine if only 6% of the customer will churn within the true population distributions, predicting everyone as non-churn will still give us 94% accuracy. On the other hand, F1 score will penalize poor performances on a single class, which will effectively mitigate such issues. The imbalance class characteristic will be present in every churn prediction problems \u2014 F1 will always be the metric to use in the future.", "We will utilize the feature importance function and visualize the relative importance rank of each feature we built. Due to the last feature userAgentVec is, in fact, a one-hot encoded vector, we will treat the userAgentVec feature as one. The below code will sum up all the feature importance values for all the sub-features obtained from the one-hot encoded vector.", "Now we plot the feature importance for gradient boosting trees.", "Most of the features we constructed are quite important contributing factors for user churning, with days_active as the most important factor.", "We have constructed the appropriate framework \u2014 we are ready to follow the same steps as above to let the model run on the full 12 GB dataset using AWS\u2019s EMR service. We will initialize the session by the following way", "We will not repeat the steps again \u2014 I have attached the full script on the nbviewer site.", "Eventually, the gradient boosting model produced an F1 score of 0.8896, which is a great performance.", "What a journey we have been through \u2014 but we have not finished our mission yet. In the data science world, there is a business intention behind every model. With the feature importance we produced, we could definitely come up with some business strategies to counter customer churns. We will briefly discuss two possible strategies that will truly drive some values for our providers.", "We know that the number of active days is the most significant factor, we could advise the upper management to construct a reward system to encourage low activity users to stay online for extended periods of time.", "In addition, since the agents that users used to access the service is also quite significant, we could also find out the poor-performing agent and get our engineering team to work specifically to solve the issue.", "I hope you have enjoyed reading this post as much as I enjoy writing it. Together, we used Spark, the big data analytics framework, to build an end-to-end machine learning workflow to identify potential customer churning for music streaming services from the user logs. We performed the following steps,", "Due to the sheer size of the data we are working with, performing hyperparameters search has been particularly difficult. One could imagine leaving the notebook open for extended periods of time would not be the most efficient way to use our resources. Some of the nice tricks in using ssh to keep the program running could definitely help tackle this challenge.", "If there is one thing we should take away from this piece \u2014 It comes back to the point we have mentioned at the beginning of the story. As brilliant engineers, we often get drawn to building the best high-performance models through various techniques, but our model needs to solve business problems for it to be valuable.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer@ Archera.ai, Basketball Player Training How to Dunk, Life-long Knicks Fan, Living the Dream"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F70ce4eb17669&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bowenchen.medium.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": ""}, {"url": "https://bowenchen.medium.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Bowen Chen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4eab6908bf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&user=Bowen+Chen&userId=e4eab6908bf4&source=post_page-e4eab6908bf4----70ce4eb17669---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@__matthoffman__?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Matt Hoffman"}, {"url": "https://unsplash.com/s/photos/water-leak?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://nbviewer.jupyter.org/github/chenbowen184/Data_Science_Portfolio/blob/master/Capstone%20Project/Spark%20-%20Full%20Dataset.ipynb", "anchor_text": "nbviewer site"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----70ce4eb17669---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/spark?source=post_page-----70ce4eb17669---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/big-data?source=post_page-----70ce4eb17669---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/churn-rate?source=post_page-----70ce4eb17669---------------churn_rate-----------------", "anchor_text": "Churn Rate"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&user=Bowen+Chen&userId=e4eab6908bf4&source=-----70ce4eb17669---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&user=Bowen+Chen&userId=e4eab6908bf4&source=-----70ce4eb17669---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F70ce4eb17669&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----70ce4eb17669---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----70ce4eb17669--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----70ce4eb17669--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----70ce4eb17669--------------------------------", "anchor_text": ""}, {"url": "https://bowenchen.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bowenchen.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bowen Chen"}, {"url": "https://bowenchen.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "141 Followers"}, {"url": "http://Archera.ai", "anchor_text": "Archera.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4eab6908bf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&user=Bowen+Chen&userId=e4eab6908bf4&source=post_page-e4eab6908bf4--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7b1d5930fa0e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funderstanding-customer-churning-with-big-data-analytics-70ce4eb17669&newsletterV3=e4eab6908bf4&newsletterV3Id=7b1d5930fa0e&user=Bowen+Chen&userId=e4eab6908bf4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}