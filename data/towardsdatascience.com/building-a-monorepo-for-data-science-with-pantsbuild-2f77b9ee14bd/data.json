{"url": "https://towardsdatascience.com/building-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd", "time": 1683013350.602823, "path": "towardsdatascience.com/building-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd/", "webpage": {"metadata": {"title": "Building a monorepo for Data Science with Pantsbuild | by Duc Anh Bui | Towards Data Science", "h1": "Building a monorepo for Data Science with Pantsbuild", "description": "At HousingAnywhere, one of the first major obstacles we had to face when scaling the Data team was building a centralised repository that contains our ever-growing machine learning applications\u2026"}, "outgoing_paragraph_urls": [{"url": "http://housinganywhere.com/", "anchor_text": "HousingAnywhere", "paragraph_index": 0}, {"url": "https://www.pantsbuild.org/", "anchor_text": "Pantsbuild", "paragraph_index": 1}, {"url": "https://www.pantsbuild.org/", "anchor_text": "Pantsbuild", "paragraph_index": 5}, {"url": "https://v1.pantsbuild.org/first_concepts.html", "anchor_text": "documentation", "paragraph_index": 8}, {"url": "https://github.com/uiucanh/monorepo-example", "anchor_text": "repo", "paragraph_index": 11}], "all_paragraphs": ["At HousingAnywhere, one of the first major obstacles we had to face when scaling the Data team was building a centralised repository that contains our ever-growing machine learning applications. Between these projects, many of them share dependencies with each other which means code refactoring can become a pain and consumes lots of time. In addition, as we\u2019re very opposed to Data Scientists\u2019 tendency to copy/paste codes, we need a unified location where we can store reusable functions that can be easily accessed.", "The perfect solution to our use case was building a monorepo. In this article, I\u2019ll go through how a simple monorepo can be built using the build automation system Pantsbuild.", "A monorepo is a repository where code for many projects are stored together. Having a centralised repository for your team comes with a number of benefits:", "Monorepo, however, is not a solution that fits all as there are a number of disadvantages:", "At HousingAnywhere, our team of Data Scientists find monorepo to be the perfect solution for our use cases in the Data team. Many of our machine learning applications have smaller projects that spin off from them. The monorepo enables us to quickly intergrate these new projects into the CI/CD pipeline, reducing the amount of time having to setup pipeline individually for each new project.", "We tried out a number of build automation systems and the one that we stuck with is Pantsbuild. Pants is one of the few systems that supports Python natively, and is an open-source project widely used by Twitter, Toolchain, Foursquare, Square, and Medium.", "Recently Pants has updated to v2 which only supports Python at the moment but it isn\u2019t too much of a limitation for Data Science projects.", "There are a couple of concepts in Pants that you should understand beforehand:", "For more information, I highly recommend reading this documentation where the developers of Pants have done an excellent job in explaining these concepts in detail.", "In this section, I\u2019ll go through how you can easily setup a monorepo using Pants. First, makes sure these requirements are met to install Pants:", "Now, let\u2019s set up a new repository:", "Alternatively, you can clone the example repo via:", "Next, run these commands to download the setup file:", "Then, bootstrap Pants by running ./pants --version . You should receive 1.30.0 as output.", "Let\u2019s add a couple of simple apps to the repo. First, we\u2019ll create a utils/data_gen.py and a utils/metrics.py that contain a couple of util functions:", "Now, we\u2019ll add an application first_app/app.pythat imports these codes. The app uses data fromgenerate_linear_data , passes them to a Linear Regression model and outputs the Mean Absolute Percentage Error.", "And another app second_app/app.pythat uses the first app codes:", "Then we add a couple of simple tests for these apps, for example:", "In each of these directories, we\u2019ll need a BUILD file. These files contain information about your targets and their dependencies. In these files, we\u2019ll declare what requirements are needed for these projects as well as declare the test targets.", "Let\u2019s start from the root of the repository:", "This BUILD file contains a macro python_requirements() that creates multiple targets to pull third party dependencies from a requirements.txt in the same directory. It saves us time from having to do it manually for each requirement:", "The BUILD file inutils would look like below:", "Here we have two targets: First one is a Python library that contains Python codes which are defined in source i.e. our two utility files. It also specifies the requirements needed to run these codes which is numpy, one of our third party dependencies we defined in the root BUILD file.", "The second target is the collection of tests we defined earlier, their dependency is the previous Python library. To run these tests, it\u2019s as simple as running ./pants test utils:utils_test or ./pants test utils:: from root. The second : tells Pants to run all the test targets in that BUILD file. The output should look like this:", "Similarly, we\u2019ll create 2 BUILD files for first_app and second_app", "In the second_app BUILD file, we declare the library fromfirst_app above as the dependency for this library. This means that all the dependencies from that library, together with its source will be the dependencies for first_app .", "Similarly, we also add some test targets to these BUILD files and they can be run with ./pants test first_app:: or ./pants test second_app:: .", "The final directory tree should look like this:", "The power of Pants comes from the ability to trace transitive dependencies between projects and test targets that were affected by the change. The developers of Pants provide us with this nifty bash script that can be used to track down affected test targets:", "To showcase its power, let\u2019s run an example. We\u2019ll create a new branch, make a modification to data_gen.py (e.g. changing the default parameter for generate_linear_data ) and commit:", "Now, running the bash script we\u2019ll see a minimized.txt that contains all the projects that are impacted and the test targets that will be executed:", "Looking at the graph above, we can clearly see that changing utils would affect all of its above nodes, including first_app and second_app .", "Let\u2019s do another example, this time we\u2019ll only modify second_app/app.py . Switch branch, commit and run the script again. Insideminimized.txt , we\u2019ll only get second_app:app_test as it\u2019s the topmost node.", "And that\u2019s it, hopefully, I\u2019ve managed to demonstrate to you how useful Pantsbuild can be for Data Science monorepos. Together with a properly implemented CI/CD pipeline, the speed and reliability of development can be improved vastly.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer @ ABN AMRO"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2f77b9ee14bd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bdanh96?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Duc Anh Bui"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff48b85adb83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&user=Duc+Anh+Bui&userId=f48b85adb83&source=post_page-f48b85adb83----2f77b9ee14bd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@serjosoza?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "sergio souza"}, {"url": "https://unsplash.com/@serjosoza?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://housinganywhere.com/", "anchor_text": "HousingAnywhere"}, {"url": "https://www.pantsbuild.org/", "anchor_text": "Pantsbuild"}, {"url": "https://www.pantsbuild.org/", "anchor_text": "Pantsbuild"}, {"url": "https://v1.pantsbuild.org/first_concepts.html", "anchor_text": "documentation"}, {"url": "https://github.com/uiucanh/monorepo-example", "anchor_text": "repo"}, {"url": "https://github.com/uiucanh/monorepo-example.git", "anchor_text": "https://github.com/uiucanh/monorepo-example.git"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2f77b9ee14bd---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2f77b9ee14bd---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/pantsbuild?source=post_page-----2f77b9ee14bd---------------pantsbuild-----------------", "anchor_text": "Pantsbuild"}, {"url": "https://medium.com/tag/monorepo?source=post_page-----2f77b9ee14bd---------------monorepo-----------------", "anchor_text": "Monorepo"}, {"url": "https://medium.com/tag/technology?source=post_page-----2f77b9ee14bd---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&user=Duc+Anh+Bui&userId=f48b85adb83&source=-----2f77b9ee14bd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&user=Duc+Anh+Bui&userId=f48b85adb83&source=-----2f77b9ee14bd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2f77b9ee14bd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2f77b9ee14bd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2f77b9ee14bd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Duc Anh Bui"}, {"url": "https://medium.com/@bdanh96/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "39 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff48b85adb83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&user=Duc+Anh+Bui&userId=f48b85adb83&source=post_page-f48b85adb83--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fed9f27668bb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-monorepo-for-data-science-with-pantsbuild-2f77b9ee14bd&newsletterV3=f48b85adb83&newsletterV3Id=ed9f27668bb7&user=Duc+Anh+Bui&userId=f48b85adb83&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}