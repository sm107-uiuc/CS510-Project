{"url": "https://towardsdatascience.com/hosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25", "time": 1682996081.645945, "path": "towardsdatascience.com/hosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25/", "webpage": {"metadata": {"title": "Hosting your ML model on AWS Lambdas + API Gateway Part 1 | by Evan Miller | Towards Data Science", "h1": "Hosting your ML model on AWS Lambdas + API Gateway Part 1", "description": "It definitely is, but a whole new problem comes up. You\u2019ve gotta put it somewhere and make it available to other people in the business. This tutorial series will show you how to use AWS to do this\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/hm-land-registry/uk-housing-prices-paid/downloads/uk-housing-prices-paid.zip/2", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://github.com/evanmiller29/aws_model_blog_post", "anchor_text": "here", "paragraph_index": 8}], "all_paragraphs": ["But now someone wants to use your model. That\u2019s great news ain\u2019t it?", "It definitely is, but a whole new problem comes up. You\u2019ve gotta put it somewhere and make it available to other people in the business.", "I\u2019ll show you how to do it easily and cheaply on AWS.", "For my other articles on Model Deployment check out the link above the title.", "This tutorial series will show you how to use AWS to do this. In specific we\u2019ll be using the following components:", "I\u2019m not using Sagemaker because it can be quite expensive \u00a3100 p/m per model opposed to lambda functions where you just pay per request.", "That can result in lambdas being 1/5th to 1/10th of the cost of running the same models on Sagemaker, especially if you\u2019ve got a few models going to deployment with low traffic.", "You\u2019ll need a few things to complete this. You\u2019ll need an installation of Python (scikit learn, pandas etc) and Docker installed. Docker will be needed to build the correct lambda layer files if you are on a Windows machine (I learned this the hard way).", "So you\u2019ll need a model first. I\u2019m going to build my model off the UK house price dataset on Kaggle(the data can be found here and my code here).", "Lambdas are small runtimes that do very specific tasks. They can take awhile to configure but they are fully managed by AWS so all you need to configure is the memory of your lambda.", "They can have installations of Python on them but they won\u2019t have the packages installed to run the model out of the box. To enable that functionality we need to use lambda layers.", "Lambda layers are very similar to Docker images if you\u2019re familiar with them. Each layer inherits the layer above\u2019s functionality. But there\u2019s a few things you\u2019ll need to know about them.", "For this example we\u2019ll need to use 4 lambda layers", "So next I\u2019ll show you how to build your own AWS lambda layer to allow your lambda function to use Pandas", "These steps will be the same between both Pandas/scikit-learn layers so we\u2019ll focus on nailing them here and you can repeat the steps for the scikit-learn layer.", "Next you\u2019ll need open bash/Powershell and to change directory to the layers/Pandas directory.", "NB: ${PWD} mounts the current working directory to the image in Windows environments in Powershell. If you\u2019re using mac/linux $pwd should work fine.", "This simple command does a few things:", "Now run the following script to build the python files for your lambda layer in the docker image bash (exactly the same for the sklearn layer too):", "This builds the python required files for using Pandas in your lambda function. The main difference is all your file extensions in the __pycache__ should have .pyc file types. These files are needed to run the code on the lambda linux environment.", "Next we need to create a zip file for the code to be used.", "Lambda layers need to have a specific folder structure in the zip file:", "So go through and run the code in zip_layers.py which will create zip files that will work as lambda layers.", "Viola, you\u2019ve created your first lambda layer! But now we need to test that it works. To do this you\u2019ll need to create a lambda function with a Python 3.6 runtime.", "To add lambda layers you\u2019ll need to click the Layers icon in the lambda function template and then click the Add a layer button.", "Then you\u2019ll select numpy/scipy from the list of runtime compatible layers and then select your Pandas layer you just built.", "But be sure to put the numpy/scipy layer first. Otherwise the pandas layer won\u2019t be able use the numpy dependency from the layer above it.", "And don\u2019t forget to click save!!", "Next you\u2019ll need to refresh your page and go through and edit the lambda function. Use the following code to test that the Pandas functionality is working as you\u2019d expect:", "Save your function and click test. You\u2019ll need to create a test case but just give the sample a name as we don\u2019t need it until we build the model layer.", "If you see the below output then great success, you\u2019ve got pandas working on your lambda funciton. Woooooo.", "Now we\u2019ll need to repeat the above steps to use docker to build the files for us to use sklearn. Repeat the above steps (with the sklearn resources.txt from my github) to create the new sklearn_lambda.zip and upload it to S3.", "Now we\u2019ll need to test that the sklearn installation is working on the lambda function. To use this we\u2019ll just update the lambda function code from above to include references to sklearn.", "If you see that 0.20.3 is added to the output of the lambda then you\u2019ve done very well, almost all of the hard work is done!! Next we\u2019ll add the model to the lambda function so we can start returning model predictions.", "From running the build_model.py you\u2019ll have a perfectly formatted zip for using the model on your lambdas.", "To add this to your function you\u2018ll repeat the above steps and get use that zip file (upload the zip to S3, create a new model layer and then add the layer to your lambda function).", "To test this we\u2019ll need to do a bit more work. Firstly we\u2019ll need to configure the JSON to allow for inputting the fields needed for the model.", "If you didn\u2019t change the basic test case in the lambdas your test JSON will look like this:", "Now you\u2019ll want to update that to work with our required model inputs.", "Once you\u2019ve linked up your model lambda layer to your lambda function you should be ready to go.", "Update your lambda function to this code and you\u2019ll be able to return predictions from your model. The lambda function will have taken your model layer and saved your .pkl file to /opt/model_name.pkl in your lambda function.", "And that\u2019s it. If all the steps have worked then you should get a result. I get 164344.6062626412, but it\u2019ll depend on your random seed, number of features etc.", "But that\u2019s it. It isn\u2019t too scary, but it can take awhile if you don\u2019t know the ins and outs.", "Next I\u2019ll hook this lambda into the API gateway so we can call our model API using the requests package in Python.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9052e6b63b25&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://evanmiller29.medium.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": ""}, {"url": "https://evanmiller29.medium.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Evan Miller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd0668241920&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&user=Evan+Miller&userId=fd0668241920&source=post_page-fd0668241920----9052e6b63b25---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/modeldeployment", "anchor_text": "My other posts on Model Deployment"}, {"url": "https://www.kaggle.com/hm-land-registry/uk-housing-prices-paid/downloads/uk-housing-prices-paid.zip/2", "anchor_text": "here"}, {"url": "https://github.com/evanmiller29/aws_model_blog_post", "anchor_text": "here"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----9052e6b63b25---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/tag/deployment?source=post_page-----9052e6b63b25---------------deployment-----------------", "anchor_text": "Deployment"}, {"url": "https://medium.com/tag/aws?source=post_page-----9052e6b63b25---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9052e6b63b25---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/modeldeployment?source=post_page-----9052e6b63b25---------------modeldeployment-----------------", "anchor_text": "Modeldeployment"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&user=Evan+Miller&userId=fd0668241920&source=-----9052e6b63b25---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&user=Evan+Miller&userId=fd0668241920&source=-----9052e6b63b25---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9052e6b63b25&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9052e6b63b25---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9052e6b63b25--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9052e6b63b25--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9052e6b63b25--------------------------------", "anchor_text": ""}, {"url": "https://evanmiller29.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://evanmiller29.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Evan Miller"}, {"url": "https://evanmiller29.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "102 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd0668241920&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&user=Evan+Miller&userId=fd0668241920&source=post_page-fd0668241920--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F914a340596d8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhosting-your-ml-model-on-aws-lambdas-api-gateway-part-1-9052e6b63b25&newsletterV3=fd0668241920&newsletterV3Id=914a340596d8&user=Evan+Miller&userId=fd0668241920&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}