{"url": "https://towardsdatascience.com/elasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30", "time": 1683008491.869049, "path": "towardsdatascience.com/elasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30/", "webpage": {"metadata": {"title": "ElasticSearch On Steroids With Avro Schemas | by Felix Kuestahler | Towards Data Science", "h1": "ElasticSearch On Steroids With Avro Schemas", "description": "The following article explains an approach to use modern data storage and serialization technologies to decouple components and stop the explosion of service interface versions inherent in\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/searchbox-io/Jest", "anchor_text": "Jest", "paragraph_index": 21}, {"url": "https://www.baeldung.com/elasticsearch-jest", "anchor_text": "Blaedung\u2019s tutorial article", "paragraph_index": 21}, {"url": "https://https//avro.apache.org/docs/1.7.2/api/java/org/apache/avro/io/parsing/doc-files/parsing.html", "anchor_text": "resolution rules", "paragraph_index": 39}, {"url": "https://avro.apache.org/docs/current/spec.html#single_object_encoding_spec", "anchor_text": "Link", "paragraph_index": 41}, {"url": "https://avro.apache.org/docs/1.7.7/spec.html#Schema+Resolution", "anchor_text": "Avro Schema Resolution", "paragraph_index": 47}, {"url": "https://github.com/talfco/tutorial-apache-avro/blob/tutorial-1/README.md", "anchor_text": "https://github.com/talfco/tutorial-apache-avro", "paragraph_index": 56}, {"url": "https://atnode.ch/", "anchor_text": "https://atnode.ch/", "paragraph_index": 58}], "all_paragraphs": ["The following article explains an approach to use modern data storage and serialization technologies to decouple components and stop the explosion of service interface versions inherent in large-scale data consumer applications of an enterprise.", "Being responsible in a large financial institute for a heavily used data provider system, I\u2019m always confronted with endless deployment iterations of new service versions and the inability of multiple consumers to move to the new version in a decent timeframe. This results over time in a landscape of a multitude of parallel versions running for a service.", "A word of caution: The approach is based on a NoSQL data storage infrastructure and, I\u2019m fully aware that such data storage may not be suited for all kinds of business applications. Nevertheless, there are more than enough use cases which would fit nicely in such type of architecture.", "Our tutorial covers the following scenario:We have a Service Component which processes a user input provided via a React-based browser app to persist its data in an ElasticSearch Cluster-based persistency store.", "A key feature of the Avro Message is that it is self-describing via it\u2019s associated Avro Schema. The Avro Schema is a JSON-based definition of the message structure.", "Refer to the below simple Avro Schema.", "The example outlines already some specifics of the Avro Schema definition language.", "Optional values are always expressed as unions, and to be prepared for seamless Schema Evolution (more on that later), you should always define a default value of optional attributes.", "The Schema is used by the Avro Serializer and Deserializer to parse an Avro binary message (or an Avro JSON message depending on your configuration chosen) into Java Data Access Objects (DAO\u2019s). These DAO\u2019s may be generic or pre-compiled strong typed schema Java classes.", "I.e., the Maven goal generate-sourcesgenerates a class Personwho has three attributes personId, lastName and firstname The person object can then be instantiated out of a binary message of this type by using the Avro parser.", "To be self-describing, an Avro Message may be complemented with the Schema itself or a Schema Fingerprint.", "Provisioning of the full schema JSON is usually done in file-based approaches, which bundles a large amount of Avro Messages. In our interaction journey \u2014 a request-response style with a single Avro Messages \u2014 such an approach would be too much of an overhead. For this scenario, the Schema fingerprint is the right approach.", "The Avro Schema Fingerprint is a globally unique identifier for referencing the correct schema in a central Schema Registry.", "The below abstract SchemaRegistry class describes the methods required by such a Registry.", "That\u2019s it, having a global Schema Registry established which can be used by readers or writers of Avro messages to exchange a schema fingerprint for the associated JSON schema you are ready to exploit the full power of Avro.", "The tutorial provides two implementations of a Schema Registry:", "The below example shows the ElasticSearch registered schema under its fingerprint 8354639983941950121 in the index avroschema. Any writer or reader of messages will use Avro fingerprints for referencing its underlying schema used in its processing.", "Using ElasticSearch, you will get out of the box a central repository of the schema definitions, which can be easily enhanced with lookup- and query capabilities used by business analysts, designers, or developers during the system development time.", "You are wrong if you think there is a lot of coding necessary to implement a Schema Registry.", "Below you see the full functioning ElasticSearchSchemaRegistry java class.", "Pretty straightforward and compact. You could argue now the ESPersistencyManager class hides the complexity (which is used and implemented as part of the tutorial).", "Well not really, the class is an ultra-light layer around Jest, an HTTP Java client for Elasticsearch. While Elasticsearch provides its own native Java client, Jest provides a more fluent API and a more natural interface for working. Interested in JEST, check out Blaedung\u2019s tutorial article.", "Our ESPersisencyManager just shields our tutorial classes from direct Jest exposures. An encapsulation technique used to be capable of replacing the persistency manager in a future version.", "Again very compact to get an Avro Schema persisted. It\u2019s worthwhile to mention that you can provide ElasticSearch your own primary key (in ES called the _id). In our tutorial, we use the global unique fingerprint as the primary identifier in ES, which makes the lookup straightforward (see screenshot above). It\u2019s a key feature to provide your primary key, especially when using ElasticSearch in a data replication scenario, where ES is only the slave of another master system, which already has primary keys generated.", "As you can imagine retrieving a JSON object back is even simpler Jest does the job for us.", "We should now have a pretty good understanding of what must be prepared and configured by the Backend component using our approach.", "The diagram below outlines the most important steps:", "Let\u2019s check out what the Service Component has to prepare.", "The last step -resolving a schema based on the \u201cpre-configured static\u201d fingerprint-must be understood in detail.", "The Schema fingerprint represents the message version number, which either the ServiceComponent or BackendComponent is capable of processing.", "In our simple Hello world example, the Schema fingerprint is identical for the Backend- and ServiceComponet. But in reality, the BackendComponent as well one or multiple ServiceComponent(s) may evolve with a different change speed over time.", "This scenario is illustrated in the below diagram.", "There we are in real life. In case you are the owner of a BackendComponent, which offers data sets that are important for a lot of independent data consumers (ServiceROComponent2 and ServiceROComponent3), you will be confronted with a need to support multiple interface versions. This version support requirement may grow dramatically over time and impacts your time to deliver, the flexibility, and the increasing costs of your components.", "As a data provider to third party components (which are not under your control), you may have only limited power to enforce them to upgrade to newer release interface version numbers.", "Service Versioning and its management over the whole lifecycle of your component play a vital (and sometimes cumbersome) role for a lot of data providers.", "Running SOAP-Webservices backed by WSDL interface definition language or JSON-Services supported by Open API Specification 3 (i.e., Swagger) \u2014 two very popular request-response interaction technologies \u2014 will expose you to constant version change, in case you enhance your published interfaces.", "The version change is explicit and must be adopted by your consumers, which may be out of reach for a single coordinated version upgrade allowing the removal of the older version from your productive component.", "And here Avro shines with its Schema Evolution support out of the box.", "Avro supports schema evolution, which means that you can have producers and consumers of Avro messages with different versions of the schema at the same time. It all continues to work (as long as the schemas are compatible). Schema Evolution is a crucial feature required in large production systems to decouple components and allowing them to run system updates with interface changes at different times.", "The Avro algorithm implementation requires that the reader of an Avro message has the same version of the schema as the writer of the message. So how does Avro support then schema evolution? In case the reader is on another schema version, the reader may pass into the Avro parser two different schemas. The parser then uses its resolution rules to translate data from the writer schema into the reader schema.", "Let\u2019s check that out on our BackendComponent.convertAvroBinarToJSON method. It\u2019s one of the tutorial\u2019s main methods, which converts an Avro Binary Message into an Avro JSON Message format, which is persisted afterward in ES.", "Single Avro objects are encoded as follows: A two-byte marker, C3 01, to show that the message is Avro and uses this single-record format (version 1). The 8-byte little-endian CRC-64-AVRO fingerprint of the object\u2019s schema. The Avro object encoded using Avro\u2019s binary encoding. (Link)", "The methodBackendComponent.persist is responsible for this task, which is straightforward.", "In a real-life scenario, the persist method would be exposed by the BackendComponent as a JSON-, Webservice, or any other remote interfaces.", "Our persisted Avro JSON document is stored as part of the _source attribute.", "Just think about what we have now achieved.", "An essential aspect of data management is schema evolution. After the initial schema is defined, applications may need to evolve, as shown in the above diagram. When this happens, the downstream consumers must be able to handle data encoded with both the old and the new schema seamlessly.", "If a schema evolution is backward-, as well as forward compatible is dependent if the change complies to Avro Schema Resolution constraints", "Here three essential rules out of the resolution spec:", "This implies that adding or removing optional fields to your data message keeps the message fully compatible, as long as a default value was or will be defined for the removed or added attribute. So when you start defining your Schema, you should consider that from the beginning.", "Adding or removing optional data attributes in a data message is a scenario, which happens all the time in production systems, which evolve to fulfill new business requirements.", "Let\u2019s see how Avro will help us to reduce the versioning complexity and component coupling in a simple example, by comparing a classic application setup, as well our enhanced one using ElasticSearch and Avro.", "Assume the following component setup in a productive environment.", "Now let\u2019s check the scenario with our new Bounded Context Application. which is using in its BackendComponentan Avro Message Interface supporting Schema Evolution, as well as a NoSQL data store.", "As a return, the service would give back the unique identifier of the Avro Object, as well as the fingerprint of the BackendComponent writer. This will allow the interface consumer to detect if he is working on the same version.", "This ultimately results in a faster delivery cycle, and fewer change costs for introducing new features in your component.", "So it\u2019s time for you to check out the tutorial, which can be found on Github: https://github.com/talfco/tutorial-apache-avro (a Maven-based tutorial).", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Exploring the emerging world of decentralization. All content and opinion expressed in the context of my legal entity https://atnode.ch/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3bfc483e3b30&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.cloudburo.net/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": ""}, {"url": "https://medium.cloudburo.net/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Felix Kuestahler"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15626f27740c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&user=Felix+Kuestahler&userId=15626f27740c&source=post_page-15626f27740c----3bfc483e3b30---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@bmowinkel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Brandon Mowinkel"}, {"url": "https://unsplash.com/s/photos/chain-break?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://docs.confluent.io/current/schema-registry/schema_registry_tutorial.html", "anchor_text": "Confluent Kafka"}, {"url": "https://github.com/searchbox-io/Jest", "anchor_text": "Jest"}, {"url": "https://www.baeldung.com/elasticsearch-jest", "anchor_text": "Blaedung\u2019s tutorial article"}, {"url": "https://unsplash.com/@stairhopper?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Alex Holyoake"}, {"url": "https://unsplash.com/s/photos/explosion?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://https//avro.apache.org/docs/1.7.2/api/java/org/apache/avro/io/parsing/doc-files/parsing.html", "anchor_text": "resolution rules"}, {"url": "https://avro.apache.org/docs/current/spec.html#single_object_encoding_spec", "anchor_text": "Link"}, {"url": "https://avro.apache.org/docs/1.7.7/spec.html#Schema+Resolution", "anchor_text": "Avro Schema Resolution"}, {"url": "https://unsplash.com/@betno?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Dominik Bednarz"}, {"url": "https://unsplash.com/s/photos/workers?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/talfco/tutorial-apache-avro/blob/tutorial-1/README.md", "anchor_text": "https://github.com/talfco/tutorial-apache-avro"}, {"url": "https://www.elastic.co/", "anchor_text": "https://www.elastic.co/"}, {"url": "https://medium.com/tag/avro?source=post_page-----3bfc483e3b30---------------avro-----------------", "anchor_text": "Avro"}, {"url": "https://medium.com/tag/elasticsearch?source=post_page-----3bfc483e3b30---------------elasticsearch-----------------", "anchor_text": "Elasticsearch"}, {"url": "https://medium.com/tag/architecture?source=post_page-----3bfc483e3b30---------------architecture-----------------", "anchor_text": "Architecture"}, {"url": "https://medium.com/tag/data-management?source=post_page-----3bfc483e3b30---------------data_management-----------------", "anchor_text": "Data Management"}, {"url": "https://medium.com/tag/java?source=post_page-----3bfc483e3b30---------------java-----------------", "anchor_text": "Java"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&user=Felix+Kuestahler&userId=15626f27740c&source=-----3bfc483e3b30---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&user=Felix+Kuestahler&userId=15626f27740c&source=-----3bfc483e3b30---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3bfc483e3b30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3bfc483e3b30---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3bfc483e3b30--------------------------------", "anchor_text": ""}, {"url": "https://medium.cloudburo.net/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.cloudburo.net/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Felix Kuestahler"}, {"url": "https://medium.cloudburo.net/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "635 Followers"}, {"url": "https://atnode.ch/", "anchor_text": "https://atnode.ch/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15626f27740c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&user=Felix+Kuestahler&userId=15626f27740c&source=post_page-15626f27740c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f17bfe73f81&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Felasticsearch-on-steroids-with-avro-schemas-3bfc483e3b30&newsletterV3=15626f27740c&newsletterV3Id=1f17bfe73f81&user=Felix+Kuestahler&userId=15626f27740c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}