{"url": "https://towardsdatascience.com/cross-column-based-data-manipulation-in-python-dfa5d8ffdd64", "time": 1683012747.4316669, "path": "towardsdatascience.com/cross-column-based-data-manipulation-in-python-dfa5d8ffdd64/", "webpage": {"metadata": {"title": "Cross-column-based Data Manipulation in Python | by Jeff, Lu Chia-Ching | Towards Data Science", "h1": "Cross-column-based Data Manipulation in Python", "description": "Let\u2019s suppose your manager gives you a random dataset and told you to do a \u201cbasic\u201d cleaning: \u201cKeep only the records that have values in column A, B, and C or the records don\u2019t have any value in those\u2026"}, "outgoing_paragraph_urls": [{"url": "https://stackoverflow.com/a/52786447/12170001", "anchor_text": "thread", "paragraph_index": 16}, {"url": "https://www.linkedin.com/in/jefflu-chia-ching-lu/", "anchor_text": "Linkedin page", "paragraph_index": 23}, {"url": "https://coronavirus-in-us.herokuapp.com/", "anchor_text": "dashboard", "paragraph_index": 24}, {"url": "https://www.linkedin.com/in/jeff-chia-ching-lu/", "anchor_text": "https://www.linkedin.com/in/jeff-chia-ching-lu/", "paragraph_index": 26}], "all_paragraphs": ["Let\u2019s suppose your manager gives you a random dataset and told you to do a \u201cbasic\u201d cleaning: \u201cKeep only the records that have values in column A, B, and C or the records don\u2019t have any value in those three columns at all\u201c. How would you approach that?", "Feature engineering can be really basic such as scaling and encoding, but sometimes mysterious. Recently, I came across this type of cross-column-based requirement and this got me thinking, how could a cleaning logics sound so simple in words but be inherently complicated in the data cleaning and feature engineering?", "Most of the data manipulation skills we learned from existing courses focus on row-wise applications. This type of function is well written in data analysis packages such as Pandas, meaning analysts or data scientists don\u2019t have to create a new application from scratch. However, things are not that easy when it comes to column-wise applications, especially involving multiple columns. If we like to perform the simple request as I mentioned in the introduction, we have to mix something more advanced such as logical relationship into the process.", "In this post, I will demonstrate a basic use case and a more complicated situation about cross-column manipulation. I will also include the complete manipulation function, showcasing how to apply those functions in a regular ETL process. The techniques shared in the following article includes:", "During the last spring, my friend and I have competed in Datathon 2020 hosted by Brown University. The topic is predicting where are the prospective homebuyers based on credit-bureau data and demographic data at the zip code level. The features include metrics such as bank card limit, number of open bank cards, and balance for the most recent mortgage.", "The provided datasets cover April to September 2019 and the CSV files are split accordingly. There are over 36,000,000 rows and over 300 columns in sum, and the total size of those makes up about 10GB. I would use this to demonstrate the ideas.", "Simply put, the data is a mess. After combing data sets across different times, the total size of the data could freeze a regular laptop whenever a simple computation is applied. Thus, I wanted to come up with a way that generalized the same metric for different months (e.g., there is a \u201cnumber of open bank cards\u201d metric for each month. I like to reduce the total number of features but keep that information).", "Various machine learning techniques (e.g., PCA, clustering) could achieve similar effects. However, I would transform features with the most direct fashion, which is averaging.", "That\u2019s just saying that we need to average the metrics over time. We can easily achieve that with pd.DataFrame.mean(). Pandas package also provides various aggregated function such as sum(), std().", "This is a relatively easy task. However, the trick is setting the correct pipeline that organizes new columns and builds up a new data frame. Here are a few tips worth mentioning:", "The whole function is shown below. Note that \u201cdf\u201d is the data to be processed, and \u201cdf_col\u201d is just for building a list of column names.", "Until this point, it was no too much trouble. But here comes the tough one. Although we narrowed down the data, something was off.", "In common sense, If one record (an area) has one mortgage, then there should be a value in each of the columns (average loan amount, average balance, the proportion) describing the first mortgage. If one record has no mortgage at all, then there should be no value in these three columns at all (since no mortgage in that area). However, I found out the discrepancy just by eyeballing a few rows. Some rows have the average loan amount but no average balance, and some rows only have the proportion of the second loan without the other two counterparts.", "This type of error can seriously damage the model if it couldn\u2019t identify the correct patterns with high-dimensional data. To make the model or the analysis more robust, the questionable records should be excluded from the data set.", "To understand the problem, the Venn Diagram could be helpful for understanding. For what I tried to do here, and most of the general similar ad-hoc situation, I am looking at subsetting completely-non-intersecting part and the totally-intersecting part, which is 000 (All - (A\u222aB\u222aC)) and 111 (A\u22c2B\u22c2C) respectively.", "With the idea, because Pandas supports logical operators (&, |, ~) I could configure the logic like this:", "p.s. In case you are wondering, no, this is not the case that you need to convert AND into OR when you do the negative logical condition (since the elements here are all binary, True or False). See this thread for another example.", "Then I integrated those logical operators into one line and make a series:", "After concatenating all the series of boolean into one data frame, I used all() with apply() and lambda to create a short function while applying it along the columns axis. To be more specific, all(x) will do another logical operation to make sure all the different sections (groups of columns; e.g., a group of columns for 3rd loan in June, a group of columns for 5th mortgage in August) in one row obeys the rule I set in the first place (which is 111 or 000 relationship in the Venn Diagram). This came down to a final series of booleans:", "Here is a final ETL function that I put the dataset through the cleaning process. Note that it was designed to apply to multiple groups of columns such as metrics from different months or from different categories:", "p.s. Before doing the logical works, we have to convert all NaN value into 0 and all numerical values into boolean data type, so that we can utilize the mechanic of the Pandas logic (all zero value will be False and any non-zero will be True).", "I quickly ran through a few tips and examples of crossed-column-based data manipulation. However, I know this is hardly a thorough guide for similar use cases.", "Data manipulation is surprisingly difficult because we often face dynamic problems that a single function to impute missing values or identify biased data is far from enough in real-world scenarios. After trying to find related resources, I realized there is no systematic guide or discussion thoroughly covering the practical stuff since the essence of it is rather hard to be classified and non-traditional. Therefore, this serves as an attempt to share possible solutions, and I hope this post could spark new ideas and discover more non-ordinary methods.", "Congrats and thanks for your reading! Feel free to reply with any thoughts and opinions, or just drop a message on my Linkedin page!", "p.s. If you are interested in some COVID-19 state-wise info, be sure to visit this neat personal dashboard to track the curves.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "MS in Columbia & Data Practitioner in New York! | Linkedin: https://www.linkedin.com/in/jeff-chia-ching-lu/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdfa5d8ffdd64&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://a1080211jeff.medium.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": ""}, {"url": "https://a1080211jeff.medium.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Jeff, Lu Chia-Ching"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7ff7e0ca405&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&user=Jeff%2C+Lu+Chia-Ching&userId=a7ff7e0ca405&source=post_page-a7ff7e0ca405----dfa5d8ffdd64---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@thisisengineering?utm_source=medium&utm_medium=referral", "anchor_text": "ThisisEngineering RAEng"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Venn_diagram", "anchor_text": "https://en.wikipedia.org/wiki/Venn_diagram"}, {"url": "https://stackoverflow.com/a/52786447/12170001", "anchor_text": "thread"}, {"url": "https://unsplash.com/@cristian1?utm_source=medium&utm_medium=referral", "anchor_text": "Cristian Escobar"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.linkedin.com/in/jefflu-chia-ching-lu/", "anchor_text": "Linkedin page"}, {"url": "https://coronavirus-in-us.herokuapp.com/", "anchor_text": "dashboard"}, {"url": "https://medium.com/tag/data-science?source=post_page-----dfa5d8ffdd64---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----dfa5d8ffdd64---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----dfa5d8ffdd64---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/tag/data-cleaning?source=post_page-----dfa5d8ffdd64---------------data_cleaning-----------------", "anchor_text": "Data Cleaning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&user=Jeff%2C+Lu+Chia-Ching&userId=a7ff7e0ca405&source=-----dfa5d8ffdd64---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&user=Jeff%2C+Lu+Chia-Ching&userId=a7ff7e0ca405&source=-----dfa5d8ffdd64---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdfa5d8ffdd64&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----dfa5d8ffdd64---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----dfa5d8ffdd64--------------------------------", "anchor_text": ""}, {"url": "https://a1080211jeff.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://a1080211jeff.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jeff, Lu Chia-Ching"}, {"url": "https://a1080211jeff.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "46 Followers"}, {"url": "https://www.linkedin.com/in/jeff-chia-ching-lu/", "anchor_text": "https://www.linkedin.com/in/jeff-chia-ching-lu/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7ff7e0ca405&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&user=Jeff%2C+Lu+Chia-Ching&userId=a7ff7e0ca405&source=post_page-a7ff7e0ca405--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa7ff7e0ca405%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcross-column-based-data-manipulation-in-python-dfa5d8ffdd64&user=Jeff%2C+Lu+Chia-Ching&userId=a7ff7e0ca405&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}