{"url": "https://towardsdatascience.com/unit-testing-for-data-scientists-dc5e0cd397fb", "time": 1683007594.617036, "path": "towardsdatascience.com/unit-testing-for-data-scientists-dc5e0cd397fb/", "webpage": {"metadata": {"title": "Unit Testing for Data Scientists. Using Pytest to improve the stability\u2026 | by Maarten Grootendorst | Towards Data Science", "h1": "Unit Testing for Data Scientists", "description": "As Data Science becomes more of a staple in large organizations, the need for proper testing of code slowly becomes more integrated into the skillset of a Data Scientist. Imagine you have been\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/pytest-dev/pytest", "anchor_text": "Pytest", "paragraph_index": 21}, {"url": "https://github.com/pytest-dev/pytest-cov", "anchor_text": "Pytest-cov", "paragraph_index": 52}, {"url": "https://www.linkedin.com/in/mgrootendorst/", "anchor_text": "LinkedIn", "paragraph_index": 57}, {"url": "https://twitter.com/MaartenGr", "anchor_text": "Twitter", "paragraph_index": 57}, {"url": "http://www.linkedin.com/in/mgrootendorst/", "anchor_text": "www.linkedin.com/in/mgrootendorst/", "paragraph_index": 60}], "all_paragraphs": ["As Data Science becomes more of a staple in large organizations, the need for proper testing of code slowly becomes more integrated into the skillset of a Data Scientist.", "Imagine you have been creating a pipeline for predicting customer churn in your organization. A few months after deploying your solution, there are new variables that might improve its performance.", "Unfortunately, after adding those variables, the code suddenly stops working! You are not familiar with the error message and you are having trouble finding your mistake.", "This is where testing, and specifically unit testing, comes in!", "Writing tests for specific modules improves the stability of your code and makes mistakes easier to spot. Especially when working on large projects, having proper tests is essentially a basic need.", "No data solution is complete without some form of testing", "This article will focus on a small, but very important and arguably the foundation of testing, namely unit tests. Below, I will discuss in detail why testing is necessary, what unit tests are, and how to integrate them into your Data Science projects.", "Although this seems like a no-brainer, there are actually many reasons for testing your code:", "And that was only from the top of my head!", "Even for those who do write production code, I would advise them to write tests for at least the most important modules of their code.", "What if you run a deep learning pipeline and fails after 3 hours on something you could have easily tested?", "NOTE: I can definitely imagine not wanting to write dedicated tests for one-off analyses that only took you 2 days to write. That is okay! It is up to you to decide when tests seem helpful. The most important thing to realize is that they can save you a lot of work.", "Unit testing is a method of software testing that checks which specific individual units of code are fit to be used. For example, if you would want to test the sum function in python, you could write the following test:", "We know that 1+2+3=6, so it should pass without any problems.", "We can extend this example by creating a custom sum function and testing it for tuples and lists:", "The output will be an assertion error for test_new_sum_tuple as -1+2+3 does not equal 6.", "Unit testing helps you test pieces of code under many different circumstances. However, there is one important thing to remember:", "Unit tests are not perfect and it is near impossible to achieve 100% code coverage", "Unit tests are great for catching bugs, but will not capture everything as tests are prone to the same logical errors as the code you are trying to test for.", "Ideally, you would want to include integration tests, code reviews, formal verification, etc. but that is beyond the scope of this article.", "The issue with the example above is that it will stop running the first time it faces an AssertionError. Ideally, we want to see an overview of all tests that pass or fail.", "This is where test runners, such as Pytest, come in. Pytest is a great tool for creating extensive diagnoses based on the tests that you have defined.", "After doing so, create a test_new_sum.py file and fill it with the following code:", "Finally, cd into the folder where test_new_sum.py is stored and simply run pytest -v. The result should look something like this:", "What you can see in the image above is that it shows which tests passed and which failed.", "The amazing thing is that Pytest shows you what values were expected and where it had failed. This allows you to quickly see what is going wrong!", "To understand how we could use Pytest for Data Science solutions, I will go through several examples. The following data is used for the examples:", "In this data, we have a target class and several features that could be used as predictors.", "Let us start with a few simple preprocessing functions. We want to know the average value of each feature per class. To do that, we created the following basic function, aggregate_mean:", "Great! We throw in a data frame and column, and it should spit out a dictionary with the average per class.", "To test this, we write the following test_aggregate_mean.py file:", "When we run pytest -v it should give no errors!", "Run multiple test cases with Parametrize", "If we want to test for many different scenarios it would cumbersome to create many duplicates of a test. To prevent that, we can use Pytest\u2019s parametrize function.", "Parameterize extends a test function by allowing us to test for multiple scenarios. We simply add the parametrize decorator and state the different scenarios.", "For example, if we want to test the aggregate_mean function for features 1 and 3, we adopt the code as follows:", "After running pytest -v it seems that the result for feature 3 was not what we expected. As it turns out, the None value that we saw before is actually a string!", "We might not have found this bug ourselves if we had not tested for it.", "Prevent repeating code in your unit tests with Fixtures", "When creating these test cases we often want to run some code before every test case. Instead of repeating the same code in every test, we create fixtures that establish a baseline code for our tests.", "They are often used to initialize database connections, load data, or instantiate classes.", "Using the previous example, we would like to turn load_data() into a fixture. We change its name to data() in order to better represent the fixture. Then, @pytest.fixture(scope='module') is added to the function as a decorator. Finally, we add the fixture as a parameter to the unit test:", "As you can see, there is no need to set data() to a variable since it is automatically evoked and stored in the input parameter.", "Fixtures are a great way to increase readability and reduce the chance of any errors in the test functions.", "Imitate code in your pipeline to speed up testing with Mocking", "In many data-driven solutions, you will have large files to work with which can slow down your pipeline tremendously. Creating tests for these pieces of code is difficult as fast tests are preferred.", "Imagine you load in a 2GB csv file with pd.read_csv and you would like to test if the output of a pipeline is correct. With unittest.mock.patch, we can replace the output ofpd.read_csv with our own to test the pipeline with smaller data.", "Let\u2019s say you have created the following codebase for your pipeline:", "Now, to test whether this pipeline works as intended, we want to use a smaller dataset so we can more accurately test cases. To do so, we patch the pd.read_csv with the smaller dataset that we have been using thus far:", "When we run pytest -v, the large .csv will not be loaded and instead replaced with our small dataset. The test runs quickly and we can easily test new cases!", "Have you covered most of your code with unit tests?", "Unit testing is not a perfect method by any means, but knowing how much of your code you are testing is extremely helpful. Especially when you have complicated pipelines, it would be nice to know if your tests cover most of your code.", "In order to check for that, I would advise you to install Pytest-cov, which is an extension to Pytest, and shows you how much of your code is covered by tests.", "After doing so, run the following test:", "This means that we are running Pytest and check how much of the tests cover codebase.py. The result is the following output:", "Fortunately, our test covers all code in codebase.py!", "If there were any lines that we note covered, then that value would be shown under Miss.", "If you are, like me, passionate about AI, Data Science, or Psychology, please feel free to add me on LinkedIn or follow me on Twitter.", "All examples and code in this article can be found here:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Psychologist. Passionate about anything AI-related! Get in touch: www.linkedin.com/in/mgrootendorst/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdc5e0cd397fb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@maartengrootendorst?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Maarten Grootendorst"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22405c3b2875&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&user=Maarten+Grootendorst&userId=22405c3b2875&source=post_page-22405c3b2875----dc5e0cd397fb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/pytest-dev/pytest", "anchor_text": "Pytest"}, {"url": "https://github.com/pytest-dev/pytest-cov", "anchor_text": "Pytest-cov"}, {"url": "https://www.linkedin.com/in/mgrootendorst/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/MaartenGr", "anchor_text": "Twitter"}, {"url": "https://github.com/MaartenGr/UnitTesting", "anchor_text": "MaartenGr/UnitTestingCode and instructions for creating unit tests for data-driven solutions The corresponding article can be found here: To\u2026github.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----dc5e0cd397fb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----dc5e0cd397fb---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----dc5e0cd397fb---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/unittest?source=post_page-----dc5e0cd397fb---------------unittest-----------------", "anchor_text": "Unittest"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----dc5e0cd397fb---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&user=Maarten+Grootendorst&userId=22405c3b2875&source=-----dc5e0cd397fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&user=Maarten+Grootendorst&userId=22405c3b2875&source=-----dc5e0cd397fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdc5e0cd397fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----dc5e0cd397fb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----dc5e0cd397fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@maartengrootendorst?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maarten Grootendorst"}, {"url": "https://medium.com/@maartengrootendorst/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4.5K Followers"}, {"url": "http://www.linkedin.com/in/mgrootendorst/", "anchor_text": "www.linkedin.com/in/mgrootendorst/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F22405c3b2875&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&user=Maarten+Grootendorst&userId=22405c3b2875&source=post_page-22405c3b2875--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb052d90faf55&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funit-testing-for-data-scientists-dc5e0cd397fb&newsletterV3=22405c3b2875&newsletterV3Id=b052d90faf55&user=Maarten+Grootendorst&userId=22405c3b2875&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}