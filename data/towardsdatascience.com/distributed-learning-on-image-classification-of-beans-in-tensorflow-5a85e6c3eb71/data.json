{"url": "https://towardsdatascience.com/distributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71", "time": 1683006978.3523998, "path": "towardsdatascience.com/distributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71/", "webpage": {"metadata": {"title": "Distributed Learning on Image Classification of Beans in TensorFlow | by Arijit Gupta | Towards Data Science", "h1": "Distributed Learning on Image Classification of Beans in TensorFlow", "description": "Deep Learning has led to various technological advancements in the field of Machine Learning, but it still suffers from the substantial amount of computational time required to train on large\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/datasets/catalog/beans", "anchor_text": "\u2018beans\u2019", "paragraph_index": 1}, {"url": "https://colab.research.google.com/drive/1edcUMPcSjijdn-1RF_pOd2yodnexzPlu", "anchor_text": "here", "paragraph_index": 21}, {"url": "https://www.linkedin.com/in/arijitgupta42", "anchor_text": "https://www.linkedin.com/in/arijitgupta42", "paragraph_index": 23}], "all_paragraphs": ["Deep Learning has led to various technological advancements in the field of Machine Learning, but it still suffers from the substantial amount of computational time required to train on large datasets. Training datasets like ImageNet, used for benchmarks, can take a single GPU system up to a week. Distributed training on the other hand, where the training is divided between multiple machines or GPUs, has been seen to greatly reduce this training time.", "TensorFlow provides in-built features to perform distributed learning using different algorithms. Today we will be looking at the \u2018Mirrored Strategy\u2019 and implement it on the \u2018beans\u2019 dataset.", "First, we need to download the required libraries and the dataset we will be working on.", "Now that we have downloaded the dataset and the dependencies to go along with it, we can move on to start writing the code.", "Now, some essential steps are required before we start our training. The hyperparameters need to be defined and more importantly, we need to initialize the distributed learning algorithm.", "We initialized the number of training and testing images by retrieving them from the dataset. We also defined a buffer size for our training and batch size that will depend on the number of GPUs. The more GPUs you have, the larger you can keep your batch size which implies faster training.", "We will be using a simple CNN model to train on this dataset and demonstrate the distributed learning feature. Our CNN will also require some functions that we will define along the way.", "First, we need to do some slight data pre-processing and normalize the pixel values of our images. We also batch the training data and we are also keeping an in-memory cache of the training data to improve performance.", "Now we can start building our CNN.", "Finally, we need to define some supplementary functions including the checkpoint, learning rate decay, and the callback.", "The checkpoint will save the progress of the model after every epoch, the learning rate decay will help us have dynamic learning rate as the number of epochs increase and the callbacks are used by the model at the end of each epoch to run all these functions.", "Once the model has been built and the supplementary functions defined, we can move on to the exciting part, training the model.", "This is the easiest part of the code, but the most essential part of the working of our code. We can now train the model on the dataset, and it will happen using distributed learning!", "There are various strategies or algorithms that can be used for distributed learning. First, let us take the one that we used in our code, the mirrored strategy.", "The Mirrored Strategy supports synchronous training on multiple GPUs on one machine. It creates a copy of each GPU device and each variable in the model is mirrored across all the replicas. All copies of the variable are kept in sync with each other by applying identical and simultaneous updates.", "The Multi Worker Mirrored Strategy is a version of the mirrored strategy, but for multi-worker training instead. This is where we can use distributed learning across multiple machines and not just a single one. This strategy uses synchronous training on multiple workers and each worker can have multiple GPUs. It creates copies of all the variables in the model of each device of each worker.", "The Parameter Server Strategy is a flexible strategy, as it allows synchronous local training on multiple GPUs as well as asynchronous training across multiple machines. The difference in its local training from the mirrored strategy is that instead of creating a copy of variables and updating all of them simultaneously, the variables are stores on the CPU, and operations are replicated across all the local GPUs.", "All the above strategies are just some examples of distribution algorithms. They can all be implemented in TensorFlow using the tf.distribute library.", "As the various strategies are different and have their own positives, they also have their own negatives.", "Our aim is to use the GPU to its maximum ability while wasting the least possible amount of time in data fetching. In Mirrored Strategy, when we use distributed learning on a single local system with multiple GPUs, we see that the GPU usage is far from perfect. The ideal would be that on average, each of your GPUs is optimized equally, but that does not happen. But, we do see that the memory access time gets significantly better, with the time spent on retrieving instructions getting reduced, as the task is divided across multiple GPUs. And the most important thing being, as the datasets get larger we can expect the distributed learning process to reduce the training time more. To improve it even further TensorFlow has the feature of prefetch that fetches the data for the next epoch while the current epoch is going on. But, this feature is still in the experimental phase and might have errors.", "The Multi Worker Mirrored Strategy allows you to get a higher performance because of the synchronization of multiple workers having their own set of GPUs, but at the same time, the strategy is vulnerable to system errors. If one of the workers suffers from a system error, as the training process needs to be synchronized between all the workers, it results in TensorFlow pausing the training process until the worker comes back online. This does lead to an increase in the training time, and the longer the training process the more chances of a network or system failure and an increase in training time. Also, the checkpoint evaluation cannot be done by any of the workers, because while one worker is evaluating the checkpoints, the others will have to wait and that might lead to a communication timeout. So, the evaluation of checkpoints is done by the master system that communicates to all the workers, and the process is completely decided by the power of one machine.", "The complete notebook of the code can be found on colab here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I'm a final year electronics undergrad and a student researcher in NLP and Computer Vision. https://www.linkedin.com/in/arijitgupta42"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5a85e6c3eb71&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@arijitgupta42?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arijitgupta42?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Arijit Gupta"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F70caf73db4e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&user=Arijit+Gupta&userId=70caf73db4e5&source=post_page-70caf73db4e5----5a85e6c3eb71---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.tensorflow.org/datasets/catalog/beans", "anchor_text": "\u2018beans\u2019"}, {"url": "https://colab.research.google.com/drive/1edcUMPcSjijdn-1RF_pOd2yodnexzPlu", "anchor_text": "here"}, {"url": "https://unsplash.com/@izgubljenausvemiru?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Tijana Drndarski"}, {"url": "https://unsplash.com/s/photos/beans?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5a85e6c3eb71---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----5a85e6c3eb71---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/distributed-learning?source=post_page-----5a85e6c3eb71---------------distributed_learning-----------------", "anchor_text": "Distributed Learning"}, {"url": "https://medium.com/tag/image-classification?source=post_page-----5a85e6c3eb71---------------image_classification-----------------", "anchor_text": "Image Classification"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&user=Arijit+Gupta&userId=70caf73db4e5&source=-----5a85e6c3eb71---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&user=Arijit+Gupta&userId=70caf73db4e5&source=-----5a85e6c3eb71---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5a85e6c3eb71&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5a85e6c3eb71---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5a85e6c3eb71--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arijitgupta42?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arijitgupta42?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Arijit Gupta"}, {"url": "https://medium.com/@arijitgupta42/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13 Followers"}, {"url": "https://www.linkedin.com/in/arijitgupta42", "anchor_text": "https://www.linkedin.com/in/arijitgupta42"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F70caf73db4e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&user=Arijit+Gupta&userId=70caf73db4e5&source=post_page-70caf73db4e5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F70caf73db4e5%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdistributed-learning-on-image-classification-of-beans-in-tensorflow-5a85e6c3eb71&user=Arijit+Gupta&userId=70caf73db4e5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}