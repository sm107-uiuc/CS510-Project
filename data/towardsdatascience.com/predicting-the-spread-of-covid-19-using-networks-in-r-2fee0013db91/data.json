{"url": "https://towardsdatascience.com/predicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91", "time": 1683013305.8314528, "path": "towardsdatascience.com/predicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91/", "webpage": {"metadata": {"title": "Using networks to predict Covid-19 cases in R -Part 1 | by James Lowe | Towards Data Science", "h1": "Using networks to predict Covid-19 cases in R -Part 1", "description": "Like all infectious diseases, Covid-19 transmission happens on a very local level. It does not just jump randomly around the world, it has to pass from person to person, and these people will have to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://www.arcgis.com/apps/webappviewer/index.html?id=47574f7a6e454dc6a42c5f6912ed7076", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://c19downloads.azureedge.net/downloads/msoa_data/MSOAs_latest.csv", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "on github", "paragraph_index": 5}, {"url": "https://coronavirus.data.gov.uk/downloads/msoa_data/MSOAs_latest.csv", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "part 2", "paragraph_index": 9}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "github", "paragraph_index": 9}, {"url": "https://opendata.arcgis.com/datasets/efeadef72f3745df86edc1c146006fc0_0.zip?outSR=%7B%22latestWkid%22%3A27700%2C%22wkid%22%3A27700%7D", "anchor_text": "here", "paragraph_index": 14}, {"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "Part 2", "paragraph_index": 36}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "on GitHub", "paragraph_index": 37}], "all_paragraphs": ["Part 2 can be found here.", "Like all infectious diseases, Covid-19 transmission happens on a very local level. It does not just jump randomly around the world, it has to pass from person to person, and these people will have to travel to a new place to spread the virus there. It is for this reason that networks have often been used to help model the spread of diseases, whether it\u2019s by using a social network to model the spread of the disease between people, or geographic networks to help us predict outbreaks based on what\u2019s going on in neighbouring places.", "In this blog series, we will be focusing on geographic networks, where the nodes are places, and the edges link two places if they neighbour each other. Ultimately we will try and use such a network to predict Covid cases in one area based on Covid cases in neighbouring areas.", "The accuracy of this approach will be limited as it does not take account of epidemiological factors (such as herd immunity and social distancing) or other ways areas are linked (such as trains). However, this blog series still provides a helpful guide for visualising networks and using them to create features for predictive analysis. It also shows that network analysis can be a helpful piece of a larger Covid model.", "In the UK, the smallest areas of geography that Covid cases are published on are called Middle Layer Super Output Areas (MSOAs) so we will focus on these. You can see this data in an interactive map here, and download it here.", "In this first part, we will create some visualisations to motivate why such an approach might work, then we will create the network seen in the above image. We will showcase code as we go along, and also, all of the code can be found on github.", "These are all the packages that were used to create the visualisations shown in this post.", "In order to see why this approach might work we will take a look at Leicester, which had a spike in Covid cases in June leading to the UKs first local lockdown. We are going to visualise the spread of Covid in the area by creating maps using the {ggplot2} and {sf} package, and animate these using the {gganimate} package.", "We need to download the case data (which we can do directly from the URL), and get it into the right format. The initial table is wide (with one row per MSOA, and one column per week) and some of the weeks have no data, so we take advantage of the relatively new {tidyr} and {dplyr} functions where, pivot_longer and across to clean this data.", "n.b. Since publishing this story, the data and where it can be accessed has changed. The new URL is here. We use this new data in part 2, and you can access the new code on github.", "The resulting table looks like this (I cut the first few columns out to simplify it). The first two columns tell us the Local Authority District (LAD) which is a larger area than MSOA. The next two columns tell us the MSOA. The final two columns tell us the week, and how many positive cases there were in that week. The \u201clast_7_days\u201d column tells us the number of positive cases between the last full week and today.", "The first thing we should do is check that the Leicester spike really does appear in the data, which we can do by plotting a simple line graph.", "We see that there is a large spike in the data, peaking at 500 cases in week 25.", "The next step is to see how this is distributed amongst the MSOAs. We could do this as another line graph (and in fact, we do in the github code) but that won\u2019t give us the same insight as if we plot it on a map.", "To plot a map, we have to download the shape file of MSOAs in the UK, which you can do here. After saving and unzipping the whole folder, we can load it in the following way:", "Plotting the MSOAs of Leicester is as simple as restricting the shape file down to just those that are in Leicester (we do this by inner joining), and then adding a geom_sf() to a ggplot. To plot the case data we restrict to a particular week (let\u2019s choose the peak of week 25) and join on the cases data too. We can now fill the MSOA areas based on how many positive cases they had in week 25.", "This is where we get the first indication that networks will be useful. We see that Neighbouring MSOAs have cases similar to neighbouring areas. This makes sense. If you have an outbreak in one place you expect it to spread to neighbouring places.", "The one downside of visualising data like this, is it\u2019s hard to see how the cases change over time. That\u2019s where {gganimate} comes in. {gganimate} is a great package that let\u2019s you animate your graphs based on a particular variable. It allows us to create the above map for every week, and then combines it together into a gif for us.", "We see that up to transition_time() , this code looks really similar to our last graph. The only difference is we don\u2019t filter the data to a specific week, and we include a group = week in the aes() for the plot. transition_time() is how we instruct it to use week as the variable to animate over.", "The final bit of code just helps us specify a good number of frames so each week gets the same number. The result is below.", "Again, the importance of neighbouring areas shines through. High case numbers spread from one area to neighbouring areas. Also, just before the peak in numbers for a single MSOA (which happens in week 27) we see the neighbouring areas all have high case numbers too. Would network analysis have allowed us to predict that this one particular area would have such a spike in cases in week 27? There\u2019s only one way to find out.", "Now we know why networks can help us, let\u2019s actually build one. To define a network, it is enough to know what all the nodes are, and how they join together (i.e. the edges).", "In our case the nodes are simple, these are just the MSOAs. We know we want the edges to be such that two nodes are joined if the two MSOAs they represent are neighbours on our map. Fortunately, the poly2nb() function (read \u201cpolygon to neighbours\u201d) from the {spdep} package helps us do just this. It can take a shape file, and tell us which areas are neighbours.", "We can then use the nb2mat() function (read \u201cneighbours to matrix\u201d) to turn this into an adjacency matrix. For a network, an adjacency matrix is such that cell i, j is equal to 1 if there is an edge connecting node i to node j, and a 0 otherwise. Hence an adjacency matrix defines a network, and in fact, we can use the graph_from_adjacency_matrix function from the {igraph} package to create a network object.", "You could stop here, but I have found that the {tidygraph} package provides an amazing way of manipulating network objects using standard {dplyr} verbs (which we will see later). So we turn this network object into a tidy graph object using as_tbl_graph().", "Now we have created this object, how do we interact with it?", "Printing the object shows our network has 37 nodes and 91 edges. We also see that it is defined by two tibbles, one to define the node data, and one to define the edge data.", "Note that the node data just contains the names of the MSOA, and the edge data tells us which nodes are connected based on their position in the node data. For example, the first row of the edge data tells us \u201cBeamont Park\u201d and \u201cStocking Farm & Mowmacre\u201d are neighbours.", "If we want to visualise the network, we can use {ggraph}, which is a network specific extension to {ggplot2} and works in much the same way. Here\u2019s how we create a simple plot. The node positions are determined by an algorithm.", "It would be nice if we could overlay this network on top of our map from before. This would allow us to sense check the network, and make it easier to translate between the network and reality.", "In order to achieve this, we first need to get central co-ordinates for each MSOA. Fortunately, the shape file we downloaded comes with a pair of latitude longitude coordinates for each MSOA. Unfortunately, the polygons themselves are under a different spatial projection. We use the following code to extract the co-ordinates and transform the projection.", "By binding on the MSOA names, it makes it really easy to join this onto our network object. We essentially want to left_join onto our nodes table. {tidygraph} makes this really easy. All we have to do is tell it we want to do something with the nodes table by using activate() then we can use the classic {dplyr} verbs we all know and love, like left_join().", "At any time, you can use as_tibble() to extract the activated tibble (i.e. either nodes or edges). If we do that now, we see the co-ordinates have been successfully joined.", "Now we just create a ggraph plot, where we use the MSOA shape file for a geom_sf layer, and then overlay our network.", "And just like that, we have shown the network is exactly what we wanted it to be; every node is an MSOA, and an edge connects two if they are neighbours.", "We have successfully shown why we might look to networks to help us understand how COVID spreads, and also how to build and visualise such a network.", "In Part 2, we will see how the network structure allows us to create powerful features intuitively and quickly, and then use these new features to create predictive models.", "All the code used in this post can be found on GitHub where renv has been used to deal with package versions and dependencies.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Maths Masters graduate, and a Data Scientist working in the public sector."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2fee0013db91&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lowe-james.medium.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": ""}, {"url": "https://lowe-james.medium.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "James Lowe"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e7cb5074bee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&user=James+Lowe&userId=2e7cb5074bee&source=post_page-2e7cb5074bee----2fee0013db91---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "here"}, {"url": "https://www.arcgis.com/apps/webappviewer/index.html?id=47574f7a6e454dc6a42c5f6912ed7076", "anchor_text": "here"}, {"url": "https://c19downloads.azureedge.net/downloads/msoa_data/MSOAs_latest.csv", "anchor_text": "here"}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "on github"}, {"url": "https://coronavirus.data.gov.uk/downloads/msoa_data/MSOAs_latest.csv", "anchor_text": "here"}, {"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "part 2"}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "github"}, {"url": "https://c19downloads.azureedge.net/downloads/msoa_data/MSOAs_latest.csv'", "anchor_text": "https://c19downloads.azureedge.net/downloads/msoa_data/MSOAs_latest.csv'"}, {"url": "https://opendata.arcgis.com/datasets/efeadef72f3745df86edc1c146006fc0_0.zip?outSR=%7B%22latestWkid%22%3A27700%2C%22wkid%22%3A27700%7D", "anchor_text": "here"}, {"url": "https://lowe-james.medium.com/predicting-the-spread-of-covid-19-using-networks-in-r-part-2-a85377f5fc39", "anchor_text": "Part 2"}, {"url": "https://github.com/theOtherJLo/using_networks_to_predict_covid_cases", "anchor_text": "on GitHub"}, {"url": "https://medium.com/tag/network?source=post_page-----2fee0013db91---------------network-----------------", "anchor_text": "Network"}, {"url": "https://medium.com/tag/predictions?source=post_page-----2fee0013db91---------------predictions-----------------", "anchor_text": "Predictions"}, {"url": "https://medium.com/tag/r?source=post_page-----2fee0013db91---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2fee0013db91---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----2fee0013db91---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&user=James+Lowe&userId=2e7cb5074bee&source=-----2fee0013db91---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&user=James+Lowe&userId=2e7cb5074bee&source=-----2fee0013db91---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2fee0013db91&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2fee0013db91---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2fee0013db91--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2fee0013db91--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2fee0013db91--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2fee0013db91--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2fee0013db91--------------------------------", "anchor_text": ""}, {"url": "https://lowe-james.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lowe-james.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "James Lowe"}, {"url": "https://lowe-james.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "19 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e7cb5074bee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&user=James+Lowe&userId=2e7cb5074bee&source=post_page-2e7cb5074bee--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F2e7cb5074bee%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-spread-of-covid-19-using-networks-in-r-2fee0013db91&user=James+Lowe&userId=2e7cb5074bee&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}