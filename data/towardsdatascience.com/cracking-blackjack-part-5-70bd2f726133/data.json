{"url": "https://towardsdatascience.com/cracking-blackjack-part-5-70bd2f726133", "time": 1683012170.375778, "path": "towardsdatascience.com/cracking-blackjack-part-5-70bd2f726133/", "webpage": {"metadata": {"title": "Cracking Blackjack \u2014 Part 5. Finishing the First-Visit Monte Carlo\u2026 | by adithyasolai | Towards Data Science", "h1": "Cracking Blackjack \u2014 Part 5", "description": "If you haven\u2019t done so already, please read Parts 1\u20134 before continuing. The rest of this article will assume you have read and understood the previous articles. In Part 4, we learned how Step 4 is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/tagged/Cracking-Blackjack", "anchor_text": "Parts 1\u20134", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb", "anchor_text": "Part 4", "paragraph_index": 1}, {"url": "https://github.com/adithyasolai/Monte-Carlo-Blackjack/blob/master/MC_Blackjack_Part_3_and_4/Monte%20Carlo%20Blackjack%20Part%203_and_4.ipynb", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-2-75e32363e38?source=friends_link&sk=41bdbc0e16dddd80c172c7ddb039eb42", "anchor_text": "Part 2", "paragraph_index": 7}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3", "paragraph_index": 10}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb?source=friends_link&sk=1e6c7e29a69e70f123a863f100f15c86", "anchor_text": "Part 4", "paragraph_index": 12}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3", "paragraph_index": 23}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3", "paragraph_index": 37}], "all_paragraphs": ["If you haven\u2019t done so already, please read Parts 1\u20134 before continuing. The rest of this article will assume you have read and understood the previous articles.", "In Part 4, we learned how Step 4 is implemented in the play_game() function. Before diving into Steps 5 & 6 in the same level of detail, I would like introduce the run_mc() function, which allows Steps 4\u20136 to work together.", "Skim the code below. I will be explaining it in detail below. View the code in its entirety here.", "run_mc() is where the Q-table and Prob-table are explicitly defined.", "The Q-table stores the relative value (or Q-value) of each action for each possible state. Again, a state is comprised of the player\u2019s hand value and the dealer\u2019s up-card.", "To represent this in Python, Q is a 2-D list where each index of the outer list corresponds to a unique state, and each inner list is a 2-element list of Q-values for hitting and standing at the state that corresponds to the index.", "The numpy.zeros() function facilitates this by allowing us to specify the shape of the Numpy array we want to use to represent the Q-table. We also want all Q-values to start at 0 to not bias our agent when it starts to experiment and explore options. numpy.zeros() facilitates this by filling the Numpy array we specify with zeros.", "As per our Blackjack environment in Part 2, env.observation_space[0].n is 18 for the possible player hand values (3\u201320), and env.observation_space[1].n is 10 for the possible dealer up-card values (2\u201311). env.action_space.n is 2 because the only possible actions are hit and stand.", "Therefore, the number of possible states is env.observation_space[0].n * env.observation_space[1].n, which is 180. This means that the outer list of Q has 180 values. Each of these 180 values in Q is an inner list of zeros of size env.action_space.n (or 2).", "We define the Prob-table (or prob) in the same exact way, except each value starts at 0.5 (or 50%) instead of 0 to ensure each action has an equal chance of getting selected at the start of the learning process.", "run_mc() is also where the important levers discussed in Part 3 (epsilon, alpha, and gamma) are explicitly defined. The reasoning behind the values assigned to each will be explained in the next article.", "These lines of code encapsulate all of Steps 4\u20136.", "First, we simulate an episode using the play_game() function as discussed in Part 4. This is Step 4.", "Then, we apply the decay factor to epsilon, or just use epsilon_min if epsilon has already gone below epsilon_min. This is Step 5.", "Finally, we update our Q-table and Prob-table using update_Q() and update_prob(). episode and epsilon are crucial arguments for these functions, and they change from episode to episode. This is Step 6.", "Before I continue, congrats on reading this far! You are about to learn the final, and most important, part of this Monte Carlo process. You have come a long way! Take a moment to reflect on that!", "The reason this is called the \u201cFirst-Visit\u201d MC algorithm is because we have a first-visit approach to valuating rewards.", "\u201cFirst-Visit\u201d means that we want to start tracking the rewards of a state-action pair from its first occurrence in the episode, and then use the cumulative rewards of the episode to update our Q-values for that state-action pair in our Q-table.", "The other option is an \u201cEvery Visit\u201d approach. In this approach, we use the immediate rewards of a state-action pair every time it occurs in an episode to update Q-values.", "It doesn\u2019t make sense to use the every-visit approach for our problem given the format of Blackjack and how we have set up our environment.", "The rewards for state-action pairs in our episodes are all 0 except for the final state-action pair. This is because Blackjack players (and our agent) may have to make more than one decision (meaning more than one state-action pair) before the results of the Blackjack round (or episode) is known.", "Therefore, our agent will not improve much if we force it to update the Q-values in the Q-table using immediate rewards of $0 after each state-action pair. Instead, we will use the rewards for the final state-action pair and discount them to approximate the value of a prior state-action pair within the same episode.", "We will use the following formula to find discounted rewards for state-action pairs in each episode:", "An example of calculating discounted rewards was shown in Part 3:", "Putting it together: For each (state \u2192 action \u2192 reward) tuple in episode, we will use the discounted rewards for the state-action pair to update the corresponding Q-value in the Q-table.", "Here is the formula for the change in Q-value for each state-action pair encountered in our episode:", "update_Q() essentially calculates \u2359Q for each state-action pair seen in our episode, and adds \u2359Q to the current Q-value. The implementation is below.", "Below is the calculation of discounted rewards for each state-action pair in our episode. step is defined earlier, and is essentially the i subscript seen in our formulae that keeps track of which state-action pair we are analyzing.", "Below is the calculation of \u2359Q and using that to update the corresponding Q-value in our Q-table.", "At the end of the learning process, we can simply look at our Q-table to see which action has the greater relative value for any given state.", "Please take some more time to digest update_Q(). If you fully understand update_Q(), then update_prob() will be a breeze!", "To refresh your memory, update_prob() tweaks the probability distribution of taking a hit or stand action for each state encountered in our episode. update_prob() is called after update_Q() finishes because Q-values influence how the probabilities get updated, and we want the most updated Q-values.", "I\u2019ll start with the code this time, since the formulae for update_prob() are much simpler.", "In update_prob(), we use the Q-table to find out which action (hit or stand) has the greater Q-value for the state we are updating. This is best_action.", "First, we tweak the probability of picking best_action in the given state. The formula for \u2359Prob is as follows (where prob[Q_state_index][best_action] is the current probability for picking the best_action):", "It is possible for \u2359Prob to exceed 1 (or 100%), so we update the probability in the prob-table like this:", "Finally, we will update the probability of the other_action based on the new probability of best_action:", "It is important to update these probabilities because this will impact the explore vs exploit dynamic in our learning process (read more in Part 3).", "Smaller \u2359Prob values at the start of the learning process ensures that it will take a while before best_action becomes the agent\u2019s dominant choice. Larger \u2359Prob values towards the end will eventually cause the probability of best_action to be 100%, and the agent can start to always take what it thinks is the optimal decision.", "Congrats! You now know all the science behind \u201ccracking\u201d Blackjack! Next, we will dive into the art of experimenting with this algorithm to find the best possible Blackjack returns!", "I would really appreciate feedback of any kind! I want to become a more consistent, effective content creator.", "Did you learn something? Was I hard to follow?", "Feel free to leave a comment below or email me at adithyasolai7@gmail.com!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software Development Engineer I @ AWS"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F70bd2f726133&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://adithyasolai.medium.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": ""}, {"url": "https://adithyasolai.medium.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "adithyasolai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1677da1d199&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&user=adithyasolai&userId=1677da1d199&source=post_page-1677da1d199----70bd2f726133---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/Cracking-Blackjack", "anchor_text": "Cracking Blackjack"}, {"url": "https://towardsdatascience.com/tagged/Cracking-Blackjack", "anchor_text": "Parts 1\u20134"}, {"url": "https://unsplash.com/photos/P787-xixGio", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-2-75e32363e38?source=friends_link&sk=41bdbc0e16dddd80c172c7ddb039eb42", "anchor_text": "Part 2"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb", "anchor_text": "Part 4"}, {"url": "https://github.com/adithyasolai/Monte-Carlo-Blackjack/blob/master/MC_Blackjack_Part_3_and_4/Monte%20Carlo%20Blackjack%20Part%203_and_4.ipynb", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-2-75e32363e38?source=friends_link&sk=41bdbc0e16dddd80c172c7ddb039eb42", "anchor_text": "Part 2"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-4-8b4a9caa38eb?source=friends_link&sk=1e6c7e29a69e70f123a863f100f15c86", "anchor_text": "Part 4"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3"}, {"url": "https://towardsdatascience.com/cracking-blackjack-part-3-8fd3a5870efd?source=friends_link&sk=98055a00e2e685239d7148524a2d0b17", "anchor_text": "Part 3"}, {"url": "https://github.com/adithyasolai/Monte-Carlo-Blackjack", "anchor_text": "GitHub Repo for this project."}, {"url": "https://medium.com/tag/cracking-blackjack?source=post_page-----70bd2f726133---------------cracking_blackjack-----------------", "anchor_text": "Cracking Blackjack"}, {"url": "https://medium.com/tag/reinforcement-learning?source=post_page-----70bd2f726133---------------reinforcement_learning-----------------", "anchor_text": "Reinforcement Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----70bd2f726133---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/data-science?source=post_page-----70bd2f726133---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----70bd2f726133---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&user=adithyasolai&userId=1677da1d199&source=-----70bd2f726133---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&user=adithyasolai&userId=1677da1d199&source=-----70bd2f726133---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F70bd2f726133&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----70bd2f726133---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----70bd2f726133--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----70bd2f726133--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----70bd2f726133--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----70bd2f726133--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----70bd2f726133--------------------------------", "anchor_text": ""}, {"url": "https://adithyasolai.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://adithyasolai.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "adithyasolai"}, {"url": "https://adithyasolai.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "42 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1677da1d199&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&user=adithyasolai&userId=1677da1d199&source=post_page-1677da1d199--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb229f7eeb2b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcracking-blackjack-part-5-70bd2f726133&newsletterV3=1677da1d199&newsletterV3Id=b229f7eeb2b7&user=adithyasolai&userId=1677da1d199&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}