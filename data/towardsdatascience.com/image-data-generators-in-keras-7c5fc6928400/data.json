{"url": "https://towardsdatascience.com/image-data-generators-in-keras-7c5fc6928400", "time": 1682995940.820132, "path": "towardsdatascience.com/image-data-generators-in-keras-7c5fc6928400/", "webpage": {"metadata": {"title": "Image Data Generators in Keras. How to effectively and efficiently use\u2026 | by Manpreet Singh Minhas | Towards Data Science", "h1": "Image Data Generators in Keras", "description": "I have worked as an academic researcher and am currently working as a research engineer in the Industry. What my experience in both of these roles has taught me so far is that one cannot\u2026"}, "outgoing_paragraph_urls": [{"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST dataset", "paragraph_index": 0}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 1}, {"url": "https://keras.io/api/preprocessing/image/#imagedatagenerator-class", "anchor_text": "ImageDataGenerator", "paragraph_index": 2}, {"url": "https://www.robots.ox.ac.uk/~vgg/data/dtd/", "anchor_text": "here", "paragraph_index": 14}, {"url": "https://github.com/msminhas93", "anchor_text": "https://github.com/msminhas93", "paragraph_index": 39}, {"url": "https://www.linkedin.com/in/msminhas93", "anchor_text": "https://www.linkedin.com/in/msminhas93", "paragraph_index": 39}], "all_paragraphs": ["I have worked as an academic researcher and am currently working as a research engineer in the Industry. What my experience in both of these roles has taught me so far is that one cannot overemphasize the importance of data generators for training. Right from the MNIST dataset which has just 60k training images to the ImageNet dataset with over 14 million images [1] a data generator would be an invaluable tool for deep learning training as well as inference. Few of the key advantages of using data generators are as follows:", "In this article, I discuss how to use DataGenerators in Keras for image processing related applications and share the techniques that I used during my researcher days.", "Keras has DataGenerator classes available for different data types. However as I mentioned earlier, this post will be about images and for this data ImageDataGenerator is the corresponding class.", "I will be explaining the process using code because I believe that this would lead to a better understanding. There are six aspects that I would be covering.", "We start with the imports that would be required for this tutorial. This involves the ImageDataGenerator class and few other visualization libraries.", "There are two main steps involved in creating the generator.", "A sample code is shown below that implements both the above steps.", "We start with the first line of the code that specifies the batch size. We have set it to 32 which means that one batch of image will have 32 images stacked together in tensor. The shape of this array would be (batch_size, image_y, image_x, channels). This is a channels last approach i.e. the number of channels are in the last dimension.", "There are few arguments specified in the dictionary for the ImageDataGenerator constructor. They are explained below. [2]", "Apart from the above arguments, there are several others available. These allow you to augment your data on the fly when feeding to your network. Please refer to the documentation[2] for more details.", "These arguments are then passed to the ImageDataGenerator using the python keyword arguments and we create the datagen object. Next step is to use the flow_from _directory function of this object. This method is used when you have your images organized into folders on your OS.", "The directory structure should be as follows.", "The data directory should contain one folder per class which has the same name as the class and all the training samples for that particular class. In above example there are k classes and n examples per class. This makes the total number of samples nk. Although every class can have different number of samples.", "The arguments for the flow_from_directory function are explained below. [2]", "For the tutorial I am using the describable texture dataset [3] which is available here. It contains 47 classes and 120 examples per class. All the images are of variable size. The target_size argument of flow_from_directory allows you to create batches of equal sizes. This is pretty handy if your dataset contains images of varying size.", "Next, we look at some of the useful properties and functions available for the datagenerator that we just created. \u2018samples\u2019 gives you total number of images available in the dataset. \u2018class_indices\u2019 gives you dictionary of class name to integer mapping. These are extremely important because you\u2019ll be needing this when you are making the predictions. Since you\u2019ll be getting the category number when you make predictions and unless you know the mapping you won\u2019t be able to differentiate which is which.", "\u2018filenames\u2019 gives you a list of all filenames in the directory. This is useful if you want to analyze the performance of the model on few selected samples or want to assign the output probabilities directly to the samples.", "The datagenerator object is a python generator and yields (x,y) pairs on every step. In python, next() applied to a generator yields one sample from the generator.", "As expected (x,y) are both numpy arrays. Image batch is 4d array with 32 samples having (128,128,3) dimension. The labels are one hot encoded vectors having shape of (32,47). One hot encoding meaning you encode the class numbers as vectors having the length equal to the number of classes. The vectors has zeros for all classes except for the class to which the sample belongs. So for a three class dataset, the one hot vector for a sample from class 2 would be [0,1,0].", "Since we now have a single batch and its labels with us, we shall visualize and check whether everything is as expected.", "I\u2019ve written a grid plot utility function that plots neat grids of images and helps in visualization. It accepts input image_list as either list of images or a numpy array. nrows and ncols are the rows and columns of the resultant grid respectively.", "An example visualization is shown below.", "We see that the images are rotated randomly as expected and the filling is nearest which repeats the nearest pixel value from the valid frame. The images are also shifted randomly in the horizontal and vertical directions. All of them are resized to (128,128) and they retain their color values since the color mode is \u2018rgb\u2019.", "At this stage you should look at several batches and ensure that the samples look as you intended them to look like. That the transformations are working properly and there aren\u2019t any undesired outcomes. For example if you apply a vertical flip to the MNIST dataset that contains handwritten digits a 9 would become a 6 and vice versa. This would harm the training since the model would be penalized even for correct predictions.", "Moving on let\u2019s compare how the image batch appears in comparison to the original images. For this we set shuffle equal to False and create another generator. This allows us to map the filenames to the batches that are yielded by the datagenerator. There is a reset() method for the datagenerators which resets it to the first batch. So whenever you would want to correlate the model output with the filenames you need to set shuffle as False and reset the datagenerator before performing any prediction. This will ensure that our files are being read properly and there is nothing wrong with them.", "We can see that the original images are of different sizes and orientations. We get augmented images in the batches.", "Next, let\u2019s move on to how to train a model using the datagenerator. This is where Keras shines and provides these training abstractions which allow you to quickly train your models. This is very good for rapid prototyping. And the training samples would be generated on the fly using multi-processing [if it is enabled] thereby making the training faster.", "I\u2019ll explain the arguments being used. [2]", "The workers and use_multiprocessing function allows you to use multiprocessing. Specify only one of them at a time. Remember to set this value to the number of cores on your CPU otherwise if you specify a higher value it would lead to performance degradation.", "Keras makes it really simple and straightforward to make predictions using data generators.", "It has same multiprocessing arguments available.", "The last section of this post will focus on train, validation and test set creation. This can be achieved in two different ways.", "The code for the second method is shown below since the first method is straightforward and is already covered in Section 1.", "Since I specified a validation_split value of 0.2, 20% of samples i.e. 1128 images were assigned to the validation generator. The training and validation generator were identified in the flow_from_directory function with the subset argument.", "This concludes the tutorial on data generators in Keras. Hopefully, by now you have a deeper understanding of what are data generators in Keras, why are these important and how to use them effectively.", "I\u2019ve made the code available in the following repository.", "If you find any bugs or face any difficulty please don\u2019t hesitate to contact me via LinkedIn or GitHub.", "Thank you for reading the post. Happy learning!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "DL/CV Research Engineer | MASc UWaterloo | Follow and subscribe for DL/ML content | https://github.com/msminhas93 | https://www.linkedin.com/in/msminhas93"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7c5fc6928400&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://manpreetsinghminhas.medium.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": ""}, {"url": "https://manpreetsinghminhas.medium.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Manpreet Singh Minhas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F35b4b2dadc4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&user=Manpreet+Singh+Minhas&userId=35b4b2dadc4&source=post_page-35b4b2dadc4----7c5fc6928400---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST dataset"}, {"url": "https://towardsdatascience.com/gradient-descent-unraveled-3274c895d12d", "anchor_text": "batch gradient descent"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://keras.io/api/preprocessing/image/#imagedatagenerator-class", "anchor_text": "ImageDataGenerator"}, {"url": "https://www.robots.ox.ac.uk/~vgg/data/dtd/", "anchor_text": "here"}, {"url": "https://www.robots.ox.ac.uk/~vgg/data/dtd/", "anchor_text": "https://www.robots.ox.ac.uk/~vgg/data/dtd/"}, {"url": "https://github.com/msminhas93/KerasImageDatagenTutorial", "anchor_text": "https://github.com/msminhas93/KerasImageDatagenTutorial"}, {"url": "http://image-net.org/about-stats", "anchor_text": "ImageNet (image-net.org)"}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "https://keras.io/preprocessing/image/"}, {"url": "https://www.robots.ox.ac.uk/~vgg/data/dtd/", "anchor_text": "https://www.robots.ox.ac.uk/~vgg/data/dtd/"}, {"url": "https://cs230.stanford.edu/blog/split/", "anchor_text": "https://cs230.stanford.edu/blog/split/"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7c5fc6928400---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----7c5fc6928400---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7c5fc6928400---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----7c5fc6928400---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/programming?source=post_page-----7c5fc6928400---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&user=Manpreet+Singh+Minhas&userId=35b4b2dadc4&source=-----7c5fc6928400---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&user=Manpreet+Singh+Minhas&userId=35b4b2dadc4&source=-----7c5fc6928400---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7c5fc6928400&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7c5fc6928400---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7c5fc6928400--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7c5fc6928400--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7c5fc6928400--------------------------------", "anchor_text": ""}, {"url": "https://manpreetsinghminhas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://manpreetsinghminhas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Manpreet Singh Minhas"}, {"url": "https://manpreetsinghminhas.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "343 Followers"}, {"url": "https://github.com/msminhas93", "anchor_text": "https://github.com/msminhas93"}, {"url": "https://www.linkedin.com/in/msminhas93", "anchor_text": "https://www.linkedin.com/in/msminhas93"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F35b4b2dadc4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&user=Manpreet+Singh+Minhas&userId=35b4b2dadc4&source=post_page-35b4b2dadc4--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fffc3b82d74a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimage-data-generators-in-keras-7c5fc6928400&newsletterV3=35b4b2dadc4&newsletterV3Id=ffc3b82d74a1&user=Manpreet+Singh+Minhas&userId=35b4b2dadc4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}