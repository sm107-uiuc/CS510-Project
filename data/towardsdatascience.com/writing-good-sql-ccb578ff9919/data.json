{"url": "https://towardsdatascience.com/writing-good-sql-ccb578ff9919", "time": 1683004269.160053, "path": "towardsdatascience.com/writing-good-sql-ccb578ff9919/", "webpage": {"metadata": {"title": "Writing good SQL. Further structuring the query language\u2026 | by Holger Thoese | Towards Data Science", "h1": "Writing good SQL", "description": "In certain real time surroundings only performance counts as \u201cgood\u201d and you measure your execution time in milliseconds. In business intelligence and data warehouse environments performance is still\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.sqlstyle.guide", "anchor_text": "SQL style guide from Simon Holywel", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Correlated_subquery", "anchor_text": "https://en.wikipedia.org/wiki/Correlated_subquery", "paragraph_index": 6}], "all_paragraphs": ["Do you want to write good SQL? Sure, but what does \u201cgood\u201d mean actually?", "In certain real time surroundings only performance counts as \u201cgood\u201d and you measure your execution time in milliseconds. In business intelligence and data warehouse environments performance is still important, but often maintainability is even more valuable. It might be a better solution, to produce readable and maintainable SQL code, even if it burns cloud dollars every month. Keep in mind the costs for hours to understand a complex query, the cost that potential errors produce and the hours to fix them. And depending on your database engine optimizer, you often get both. So, in this article we focus on readability and maintainability.", "I assume you already know the basic and more advanced elements of SQL: joining, grouping, subqueries or analytic functions. Combining these elements, you can quickly generate a big mess. But what can we do, to keep even large queries with hundreds of lines and 20 or more tables readable?", "When we say readability, we have to talk on style. There is an excellent SQL style guide from Simon Holywell, take a look at it. But if you\u2019re in a hurry, you get very far with these three advices:", "With these basic rules, you\u2019re SQL will easily reach at least a moderate readability level.As your SQL gets larger and more complex you will reach certain limits, where you need more structure than the style guide provides.", "You know subqueries? Subqueries are great to encapsulate problems within a block of your query. Basically there are three types of subqueries in SELECT statements:", "Please note that this is also a correlated subquery, which should get used carefully (see https://en.wikipedia.org/wiki/Correlated_subquery).", "Subqueries can have more subqueries in any depth. And when you start with subqueries, the probability is high that more subqueries will follow over time. Other people will follow your example. Every subquery needs to get indented and the lines get longer and longer. This is a mayor issue on readability in more complex statements.", "And even more important, every subquery splits the surrounding query in code \u201cbefore\u201d and \u201cafter\u201d.", "One of the golden rules for coding in procedural times were:", "Don\u2019t write blocks larger than your screen", "(and a screen had 25 lines). But with a subquery in the middle, you can end with hundreds of lines between your columns from the SELECT block and your WHERE clause.", "This leads to an interesting way of reading SQL queries. Typically, you start somewhere in the middle and slowly work yourself to the edges.", "This \u201cinside-out\u201d direction is in contrast to our normal reading direction from top to bottom, which most of us are comfortable with.", "Some of us write SQL for years and never used the WITH clause. Give it a try, it\u2019s worth it!", "In the WITH clause, you can give your subqueries a symbolic name, just like in a FROM clause, while moving it to the beginning of your statement.", "And you can construct a \u201cpipe\u201d of subqueries, which build up on each other", "This leads to the following advances:", "Keep your subquery blocks small, with a strong focus on a single functionality in mind. Don\u2019t mix functionality, e.g. joining, filtering, grouping, mapping.", "And last but not least, make the final block dead simple, with only SELECT and FROM. Think of it as a layer model. The first blocks are for data acquisition, the last block is only the output. If you put more functionality in it, you\u2019ll end up as you started.", "When using SQL within a larger system, there is often variable substitution involved. If you try to switch between two functionalities within SQL, you quickly end up with ugly code.", "Using WITH, you can easily put your database names, table names or different config parameters into a config section. And, you can use it to toggle block usage on and off.", "Think you have a stream of subqueries as discussed before. One of them implements a limit on \u201csalary < 3000\u201d which should only be active in a later version of your code.", "Replace the join table from the last subquery with a variable \u201ct_avg_salary\u201d (here in python f-string format):", "With the change of your \u201ct_avg_salary\u201d toggle variable, you can change the output of your SQL, without changing the code. Whether you create a dummy derived table, or simply use the following derived table is up to you.", "The subquery in between is simply skipped.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fccb578ff9919&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@holger_thoese?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@holger_thoese?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Holger Thoese"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb0109d211456&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&user=Holger+Thoese&userId=b0109d211456&source=post_page-b0109d211456----ccb578ff9919---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@nci?utm_source=medium&utm_medium=referral", "anchor_text": "National Cancer Institute"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.sqlstyle.guide", "anchor_text": "SQL style guide from Simon Holywel"}, {"url": "https://en.wikipedia.org/wiki/Correlated_subquery", "anchor_text": "https://en.wikipedia.org/wiki/Correlated_subquery"}, {"url": "https://medium.com/tag/sql?source=post_page-----ccb578ff9919---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/database?source=post_page-----ccb578ff9919---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/analytics?source=post_page-----ccb578ff9919---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/business-intelligence?source=post_page-----ccb578ff9919---------------business_intelligence-----------------", "anchor_text": "Business Intelligence"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----ccb578ff9919---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&user=Holger+Thoese&userId=b0109d211456&source=-----ccb578ff9919---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&user=Holger+Thoese&userId=b0109d211456&source=-----ccb578ff9919---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fccb578ff9919&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ccb578ff9919---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ccb578ff9919--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ccb578ff9919--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ccb578ff9919--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@holger_thoese?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@holger_thoese?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Holger Thoese"}, {"url": "https://medium.com/@holger_thoese/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "140 Followers"}, {"url": "http://www.linkedin.com/in/holger-thoese", "anchor_text": "www.linkedin.com/in/holger-thoese"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb0109d211456&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&user=Holger+Thoese&userId=b0109d211456&source=post_page-b0109d211456--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fb0109d211456%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwriting-good-sql-ccb578ff9919&user=Holger+Thoese&userId=b0109d211456&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}