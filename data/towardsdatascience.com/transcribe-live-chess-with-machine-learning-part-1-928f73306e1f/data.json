{"url": "https://towardsdatascience.com/transcribe-live-chess-with-machine-learning-part-1-928f73306e1f", "time": 1683000116.100137, "path": "towardsdatascience.com/transcribe-live-chess-with-machine-learning-part-1-928f73306e1f/", "webpage": {"metadata": {"title": "Transcribe Live Chess with Machine Learning Part 1 | by Logan Spears | Towards Data Science", "h1": "Transcribe Live Chess with Machine Learning Part 1", "description": "Have you ever played live chess? The tactile sensation of the pieces, the verbal declaration of check, and the opponent glancing surreptitiously at your king culminate in an exciting and immersive\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Delta_encoding", "anchor_text": "delta compression", "paragraph_index": 2}, {"url": "https://assetstore.unity.com/", "anchor_text": "Unity\u2019s Asset Store", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Object_detection", "anchor_text": "object detection", "paragraph_index": 11}, {"url": "https://tfhub.dev/", "anchor_text": "Tensorflow Hub", "paragraph_index": 13}, {"url": "https://www.tensorflow.org/tensorboard", "anchor_text": "Tensorboard", "paragraph_index": 17}], "all_paragraphs": ["Have you ever played live chess? The tactile sensation of the pieces, the verbal declaration of check, and the opponent glancing surreptitiously at your king culminate in an exciting and immersive experience that online play can\u2019t match. However over the board (OTB) chess has a glaring downside for serious chess players: games are not transcribed automatically. Games must be transcribed, or recorded, manually, using either pen and paper or a chess app (not allowed in competition). Not only is this approach tedious and error prone, but most importantly: it takes away from enjoying the game.", "As you probably guessed from the title, I am proposing an alternative solution. Instead of manually transcribing each move during play, a player can use a computer to \u201cwatch\u201d the game and transcribe the move sequence automatically from live video. In this blog post series, I will show you how to transform this idea into reality using both common and advanced techniques in machine learning and computer vision. Each successive post will look at ever more difficult aspects of the problem and tackle them one by one.", "Like any machine learning problem, the first step after defining the problem (to transcribe the move sequence automatically from live video) is to define the inputs and outputs. The input is video data which consists of a series of images over time with optional audio. The output is the move sequence of a game which is typically recorded in the PGN format. Removing the ordering dependency from both the input and output, we are left with an image corresponding to a chess position (since moves are just delta compression for a series of chess positions). While this method ignores stateful components of a position such as castling and en passant, it forms a much easier learning target and these omissions can be calculated later on. Therefore the simplified input and output is an image and a position respectively. Positions are typically encoded in FEN notation and this project will use that convention.", "The first step in building a dataset is determining a data acquisition strategy. Strategy options for this project include:", "The fourth option has a unique property that the first three lack: it doesn\u2019t require human labeling, since we can generate the input and output pairs simultaneously. One other subtle benefit is that it allows to us to control the input data more effectively and prevent bias in the model toward typical arrangement of pieces or positional patterns. Let\u2019s proceed with this approach using Unity.", "Unity is a 3D game engine and development environment that enables the creation of realistic 3D environments. Programatic access to the environment is available with C# scripts. If you are unfamiliar with Unity, it is easy to get started using their excellent tutorials. In Unity we need to complete the following tasks:", "The first task can be completed by simply downloading prefabbed assets from Unity\u2019s Asset Store. Using Unity\u2019s editor, positioning the camera with a good view of the board is also trivial. The code for generating a random board is shown below. Its strategy, \u201cHalfEmptyRandomDistribution\u201d, gives each square a 1/2 probability of being empty and 1/2 probability of being occupied by a random piece (from black king to white pawn). A fully random distribution was not chosen because the abundance of large pieces resulted in high visual occlusion from the camera\u2019s perspective. In this instance, we\u2019ll avoid using a FIDE chess database distribution because it would bias our model toward typical positions.", "After generating a random board, the next step is to programmatically move the pieces. The positions of A1 and H8 are manually recorded using the Unity editor and other squares positions are computed as shown below:", "Here is the view from Unity\u2019s editor:", "Now, to generate screenshots from the camera\u2019s perspective. Here is the code to generate a screenshot. Bytes are returned and written to a file using the board\u2019s FEN notation (swapping \u201c/\u201d for \u201c-\u201d).", "After we generate ~10,000 images in a directory and zip it up, we have a pre-labeled dataset.", "ImageNet, the dataset most CNN architectures are trained on, has 1000 classifications as possible outputs. The number of unique chess positions, however, is 13\u2076\u2074, which renders the standard image classification output layer unviable. On way to get around this problem is to use object detection to locate the board and pieces in an image and then calculate their position on the board using a 3D perspective transformation. While moderately successful, the main drawback of this approach is that it requires an algorithm to parse the output of the model(s) and construct the chess position. A more elegant approach is to let the model do the work and learn the position directly.", "To start, let\u2019s simplify the problem: how to predict from an image what piece occupies the A1 squares. The square can be occupied by one of twelve different pieces or empty, so there are thirteen possibilities. Using Tensorflow 2.0 and Keras, our model pseudocode looks like:", "This code utilizes transfer learning from Tensorflow Hub\u2019s copy of MobilenetV2 and allows those layers to be fine-tuned by setting the variable \u201ctrainable\u201d to True. In addition, the code fine-tunes MobilenetV2 because its upper level filters are trained to detect patterns relevant to ImageNet classifications. For instance, it has classifications like humans, bikes, and trees that detect patterns for faces, tires, and branches, none of which are needed in our dataset. So, we can replace these with more useful filters. By focusing on one square for now, we have effectively turned the problem into an image classification problem with the accompanying softmax activation and categorical crossentropy loss function. Lastly, to extend our model to detect multiple squares, the code uses Keras\u2019 functional API, which specifies sixty four outputs. Our model pseudocode predicting all squares now looks like:", "This model meets our requirements. Now it\u2019s time to train it.", "In order to train our model, the input and output data must be loaded in a format Keras accepts. So, raw chess images are converted using MobileNet\u2019s preprocessor into a tensor. For the ground truth output, we parse the FEN encoding from the file name and format it for the sixty four outputs. Here is our Keras generator class:", "With the data in the right format, the model can start training. Training will take a few hours using Colab\u2019s built in GPU.", "Using Tensorboard, we can view our learning curve (validation loss in blue).", "The loss function is going down consistently (image is in log scale), indicating that, mathematically at least, the model is learning. The best way to assess the model\u2019s real performance is to test it with an unseen example.", "The model correctly predicted 63 out of 64 squares with an accuracy of ~98%. This level of accuracy proves our model architecture is sound. While we could fine tune our model to be even more precise, we will be upgrading our model in part 2 anyway, so it\u2019s safe to move on. (Note: You might notice that A1 should actually be a dark square. The Unity asset was incorrectly rotated 90 degrees, but I caught this error too late to redo the dataset. We will cover proper board alignment in part 2.)", "In part 2, we will solve one of the issues we skipped over in part 1, that is: due to the inherent symmetry in a chess board, its position is ambiguous. We will also augment our dataset with varied pieces, boards, lighting, backgrounds, and camera angles. Finally we will add some manually labeled real world data to our dataset and try our model on unseen real world images.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F928f73306e1f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----928f73306e1f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@loganspears?source=post_page-----928f73306e1f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@loganspears?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Logan Spears"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8af3df1cb3a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&user=Logan+Spears&userId=8af3df1cb3a8&source=post_page-8af3df1cb3a8----928f73306e1f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Delta_encoding", "anchor_text": "delta compression"}, {"url": "http://unity.com", "anchor_text": "Unity"}, {"url": "https://assetstore.unity.com/packages/3d/props/low-poly-chess-set-104629", "anchor_text": "Free Chess Asset in Unity"}, {"url": "https://assetstore.unity.com/", "anchor_text": "Unity\u2019s Asset Store"}, {"url": "https://en.wikipedia.org/wiki/Object_detection", "anchor_text": "object detection"}, {"url": "https://tfhub.dev/", "anchor_text": "Tensorflow Hub"}, {"url": "https://xkcd.com/303/", "anchor_text": "Famous xkcd Sketch"}, {"url": "https://www.tensorflow.org/tensorboard", "anchor_text": "Tensorboard"}, {"url": "http://bit.ly/2STzn0G", "anchor_text": "http://bit.ly/2STzn0G"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----928f73306e1f---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/chess?source=post_page-----928f73306e1f---------------chess-----------------", "anchor_text": "Chess"}, {"url": "https://medium.com/tag/unity?source=post_page-----928f73306e1f---------------unity-----------------", "anchor_text": "Unity"}, {"url": "https://medium.com/tag/ai?source=post_page-----928f73306e1f---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----928f73306e1f---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&user=Logan+Spears&userId=8af3df1cb3a8&source=-----928f73306e1f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&user=Logan+Spears&userId=8af3df1cb3a8&source=-----928f73306e1f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F928f73306e1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----928f73306e1f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----928f73306e1f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----928f73306e1f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----928f73306e1f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----928f73306e1f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----928f73306e1f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@loganspears?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@loganspears?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Logan Spears"}, {"url": "https://medium.com/@loganspears/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "301 Followers"}, {"url": "https://www.linkedin.com/in/logan-spears-3bb71968/", "anchor_text": "https://www.linkedin.com/in/logan-spears-3bb71968/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8af3df1cb3a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&user=Logan+Spears&userId=8af3df1cb3a8&source=post_page-8af3df1cb3a8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F834b9e24c3af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftranscribe-live-chess-with-machine-learning-part-1-928f73306e1f&newsletterV3=8af3df1cb3a8&newsletterV3Id=834b9e24c3af&user=Logan+Spears&userId=8af3df1cb3a8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}