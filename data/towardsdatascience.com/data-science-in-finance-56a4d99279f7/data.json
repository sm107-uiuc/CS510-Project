{"url": "https://towardsdatascience.com/data-science-in-finance-56a4d99279f7", "time": 1683006163.179156, "path": "towardsdatascience.com/data-science-in-finance-56a4d99279f7/", "webpage": {"metadata": {"title": "Data Science in Finance. Moving Average Strategy Back Test in\u2026 | by Ryan A. Mardani | Towards Data Science", "h1": "Data Science in Finance", "description": "In this work, I will extract historical price data for a specific stock symbol from Yahoo Finance and examine a simple strategy to see whether it can be profitable. You can access the source code of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/mardani72/Finance_Moving_Ave_Strategy", "anchor_text": "account", "paragraph_index": 0}, {"url": "https://www.investopedia.com/terms/m/movingaverage.asp", "anchor_text": "nvestpedia", "paragraph_index": 2}], "all_paragraphs": ["In this work, I will extract historical price data for a specific stock symbol from Yahoo Finance and examine a simple strategy to see whether it can be profitable. You can access the source code of this work through my Github account.", "Several years ago, when I wanted to invest in the stock market, testing a strategy without python knowledge would cost me subscription on various websites. Frankly, in most cases, I was not satisfied with the criteria for data screening and shortlisting.", "Let\u2019s define some concepts that will be used in this work:Simple Moving Average(SMA): this is a trend-following indicator which can be calculated by taking the arithmetic mean of a given set of values. In other words, a set of numbers, or prices in the case of financial instruments, are added together and then divided by the number of prices in the set (for more detail see investpedia).", "For example: if we want to calculate the SMA_20 value in the current point, we can add up the last 20 days (or other time intervals) closing price then divide by 20.", "The moving average strategy suggests buying a stock when shorter SMA crosses over longer SMA and selling it when shorter SMA crosses down the longer one. The picture below shows the buy signal (SMA_20, the red line crosses over the blue line, SMA_50) and the exit point as vice versa.", "Historical stock price data can be found from various sources but the simplest one is Yahoo Finance. To do this, we need to import yfinance library and other related libraries which will be used on data manipulation using pandas.", "First of all, we need to define the time range that we will examine the strategy. To use yfinace library, the date should be in the format of YYYY-MM-DD. Define the start date as your own favorite time. You can do the same for the end date but I prefer the end date as today. We can define it as below:", "In the next step, store your favorite stock symbol ticker string in a stock variable. We are going to use it in yahoo finance library to download as a data frame:", "Here, I selected AMD ticker (Advanced Micro Devices, semiconductor) and stored price data in the data frame using the download attribute of yfinance. There are serval parameters that we should include such as stock name, start and end date. The default sampling interval is one day but you may choose other intervals as well. The Data frame has the open, high, low, close, adjusted close price, and traded volume in the last column.", "To see what parameters we can define for the download function, we may click inside the parenthesis of function and apply shift+Tab keys in the jupyter notebook (figure below). It has also an explanation for each parameter if you scroll down.", "Let\u2019s define the short and long simple moving average, SMA variable, and store them in the list named SMAs here.", "We can calculate moving average one by one for each SMA using rolling and mean function but to make it more flexible for more than two SMAs, we may use for loop such as:", "This line of code says that each SMAs will be calculated using the rolling function in the pre-defined time window for the adjusted close price which is in the 5th column of the data frame. Then each SMAs will be added as a new column with the name of SMA suffixed with the time window we prepared.", "To check the result, we can call tail function to see the last rows of the data frame. SMA_20 and SMA_50 are added.", "This section is the backbone of moving average strategy backtesting. The relative position of these two SMAs should be defined to recognize trend direction. It has simple basics: if shorter SMA is higher than longer SMA, we are in the up-trend area and appropriate to have a position and sell it in the opposite condition. Let\u2019s look at the code:", "This is a for loop block of code that will iterate over data set we previously read into df variable. After defining close price, short and long SMAs from the data frame, it will go into two different branches using if statement based on short and long SMA values (line 9). If short SMA is above long SMA, it prints out the trend direction (\u2018Up trend\u2019) and if there is not existing position in the portfolio, it will buy a position (signal) based on the close price of that day. If short SMA reads smaller values than long SMA, it is in Down trend. If we have already a position, we should sell at the adjusted close price. Using append function in pandas (line 23), we will store the results to a percentChange variable list as defined in the previous line. The last part of block code, starting line24, is to examine whether there is an open position we are counting down to end of the data frame.", "In the figure above, you may look at the lat part of screen print which shows trend print, buy and sell signal and all trades stored in the list.", "After defining some variables such as gains and losses with the quantity of them, we may use for loop again over individual values in perecntChange to find out statistical information. Positive values in the list refer to the gain and will be added up in gains variable. The negative values are losses and will be stored in losses variable. We can print out the total return as percent and round the value up to 2 decimal places.", "In this example, this strategy suggested 10 trades from the early day of 2016. The total return for this stock is over 850%.", "To calculate average gain and loss, we may simply use if statement to see if the number of gains is bigger than zero or not. If so, the average gain can be calculated by gains divided by a number of gains. If the number of losses is a positive value, it will calculate average losses as well. Maximum gain and loss can also be an attractive point of the trades strategy.", "For this example, the average gain for a single stock share is 62 dollars, the average loss is almost 8 dollars. The maximum return is 153 and the maximum loss is 16 dollars.", "Batting average is calculated by dividing the number of gains over the total number of trades. This can be a sign of accuracy to enter for a position ranges between 0 and 1. 1 is the most accurate bat.", "In this example, the batting average is 0.6.", "Although you can use seaborn or matplotlib libraries to plot the stock price, the mplfinance library is perfectly designed specifically for the stock price plot. Its function accept various attributes such as figure size, price plotting type (line, candlestick, \u2026) and moving average.", "Using python and other libraries, we are able to extract historical stock price data and examine various strategies on the data. Moving average strategy is a simple concept based on price trends in shorter and longer SMAs and their relative position to each other. In this work, we showed that using for loop and if statement approach, we can easily examine this strategy over the historical data set.", "If you have a question or need more clarification, please feel free to contact me.", "disclaimer: This post is not financial advising. It has educational purposes.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F56a4d99279f7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mardani.a?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mardani.a?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Ryan A. Mardani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb36223c810e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&user=Ryan+A.+Mardani&userId=b36223c810e6&source=post_page-b36223c810e6----56a4d99279f7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markusspiske?utm_source=medium&utm_medium=referral", "anchor_text": "Markus Spiske"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/mardani72/Finance_Moving_Ave_Strategy", "anchor_text": "account"}, {"url": "https://www.investopedia.com/terms/m/movingaverage.asp", "anchor_text": "nvestpedia"}, {"url": "https://medium.com/tag/data-science?source=post_page-----56a4d99279f7---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/finance?source=post_page-----56a4d99279f7---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----56a4d99279f7---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/tag/python?source=post_page-----56a4d99279f7---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&user=Ryan+A.+Mardani&userId=b36223c810e6&source=-----56a4d99279f7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&user=Ryan+A.+Mardani&userId=b36223c810e6&source=-----56a4d99279f7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F56a4d99279f7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----56a4d99279f7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----56a4d99279f7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----56a4d99279f7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----56a4d99279f7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mardani.a?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mardani.a?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ryan A. Mardani"}, {"url": "https://medium.com/@mardani.a/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "388 Followers"}, {"url": "http://www.dataenergy.ca", "anchor_text": "www.dataenergy.ca"}, {"url": "http://linkedin.com/in/amardani", "anchor_text": "linkedin.com/in/amardani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb36223c810e6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&user=Ryan+A.+Mardani&userId=b36223c810e6&source=post_page-b36223c810e6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7a39952b3ca1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-in-finance-56a4d99279f7&newsletterV3=b36223c810e6&newsletterV3Id=7a39952b3ca1&user=Ryan+A.+Mardani&userId=b36223c810e6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}