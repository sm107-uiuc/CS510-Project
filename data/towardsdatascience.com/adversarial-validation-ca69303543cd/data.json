{"url": "https://towardsdatascience.com/adversarial-validation-ca69303543cd", "time": 1683003150.550109, "path": "towardsdatascience.com/adversarial-validation-ca69303543cd/", "webpage": {"metadata": {"title": "Adversarial Validation. A Diagnostic Tool for Overfitting | by Zak Jost | Towards Data Science", "h1": "Adversarial Validation", "description": "If you were to study some of the competition-winning solutions on Kaggle, you might notice references to \u201cadversarial validation\u201d (like this one). What is it? In short, we build a classifier to try\u2026"}, "outgoing_paragraph_urls": [{"url": "http://discord.gg/xh2chKX", "anchor_text": "new ML Discord server", "paragraph_index": 0}, {"url": "https://blog.zakjost.com/post/adversarial_validation/", "anchor_text": "blog.zakjost.com", "paragraph_index": 1}, {"url": "https://www.kaggle.com/c/ieee-fraud-detection/discussion/111284", "anchor_text": "like this one", "paragraph_index": 2}, {"url": "https://youtu.be/7cUCDRaIZ7I", "anchor_text": "YouTube video", "paragraph_index": 5}, {"url": "https://github.com/zjost/blog_code/tree/master/adversarial_validation", "anchor_text": "github", "paragraph_index": 5}, {"url": "https://www.kaggle.com/c/ieee-fraud-detection/data", "anchor_text": "IEEE-CIS Credit Card Fraud Detection dataset", "paragraph_index": 7}, {"url": "http://discord.gg/xh2chKX", "anchor_text": "new ML Discord server", "paragraph_index": 31}], "all_paragraphs": ["Want to chat with other people learning ML? Join our new ML Discord server!", "This post originally appeared at blog.zakjost.com. Go there for better rendering of in-line code.", "If you were to study some of the competition-winning solutions on Kaggle, you might notice references to \u201cadversarial validation\u201d (like this one). What is it?", "In short, we build a classifier to try to predict which data rows are from the training set, and which are from the test set. If the two datasets came from the same distribution, this should be impossible. But if there are systematic differences in the feature values of your training and test datasets, then a classifier will be able to successfully learn to distinguish between them. The better a model you can learn to distinguish them, the bigger the problem you have.", "But the good news is that you can analyze the learned model to help you diagnose the problem. And once you understand the problem, you can go about fixing it.", "This post is meant to accompany a YouTube video I made to explain the intuition of Adversarial Validation. This blog post walks through the code implementation of the example presented in this video, but is complete enough to be self-contained. You can find the complete code for this post on github.", "First, some boilerplate import statements to avoid confusion:", "For this tutorial, we\u2019re going to be using the IEEE-CIS Credit Card Fraud Detection dataset from Kaggle. First, I\u2019ll assume you\u2019ve loaded the training and test data into pandas DataFrames and called them df_train and df_test, respectively. Then we'll do some basic cleaning by replacing missing values.", "For adversarial validation, we want to learn a model that predicts which rows are in the training dataset, and which are in the test set. We therefore create a new target column in which the test samples are labeled with 1 and the train samples with 0, like this:", "This is the target that we\u2019ll train a model to predict. Right now, the train and test datasets are separate, and each dataset has only one label for the target value. If we trained a model on this training set, it would just learn that everything was 0. We want to instead shuffle the train and test datasets, and then create new datasets for fitting and evaluating the adversarial validation model. I define a function for combining, shuffling, and re-splitting:", "The new datasets, adversarial_train and adversarial_test, include a mix of the original training and test sets, and the target indicates the original dataset. Note: I added TransactionDT to the feature list. The reason for this will become apparent.", "For modeling, I\u2019m going to be using Catboost. I finish data preparation by putting the DataFrames into Catboost Pool objects.", "This part is simple: we just instantiate a Catboost Classifier and fit it on our data:", "Let\u2019s go ahead and plot the ROC curve on the holdout dataset:", "This is a perfect model, which means there\u2019s a clear way to tell whether any given record is in the training or test sets. This is a violation of the assumption that our training and test sets are identically distributed.", "To understand how the model was able to do this, let\u2019s look at the most important features:", "The TransactionDT is by far the most important feature. And that makes total sense given that the original training and test datasets came from different time periods (the test set occurs in the future of the training set). The model has just learned that if the TransactionDT is larger than the last training sample, it\u2019s in the test set.", "I included the TransactionDT just to make this point-it\u2019s not advised to throw a raw date in as a model feature normally. But it\u2019s good news that this technique found it in such a dramatic fashion. This analysis would clearly help you identify such an error.", "Let\u2019s eliminate TransactionDT, and run this analysis again.", "Now the ROC curve looks like this:", "It\u2019s still a fairly strong model with AUC > 0.91, but much weaker than before. Let\u2019s look at the feature importances for this model:", "Now, id_31 is the most important feature. Let's look at some values to understand what it is.", "This column contains software version numbers. Clearly, this is similar in concept to including a raw date, because the first occurrence of a particular software version will correspond to its release date.", "Let\u2019s get around this problem by dropping any characters that are not letters from the column:", "Now the values of our column look like this:", "Let\u2019s train a new adversarial validation model using this cleaned column:", "The ROC plot now looks like this:", "The performance has dropped from an AUC of 0.917 to 0.906. This means that we\u2019ve made it a little harder for a model to distinguish between our training and test datasets, but it\u2019s still quite capable.", "When we naively tossed the transaction date into the feature set, the adversarial validation process helped clearly diagnose the problem. Additional iterations gave us more clues that a column containing software version information had clear differences between the training and test sets.", "But what the process is not able to do is tell us how to fix it. We still need to apply our creativity here. In this example we simply removed all numbers from the software version information, but this is throwing away potentially useful information and might ultimately hurt our fraud modeling task, which is our real goal. The idea is that you want to remove information that is not important for predicting fraud, but is important for separating your training and test sets.", "A better approach might have been to find a dataset that gave the software release dates for each software version, and then created a \u201cdays since release\u201d column that replaced the raw version number. This might make for a better match for the train and test distributions while also maintaining the predictive power that software version information encodes.", "Don\u2019t forget to join our new ML Discord server!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fca69303543cd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ca69303543cd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@zjost85?source=post_page-----ca69303543cd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zjost85?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Zak Jost"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F31b5658f69b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&user=Zak+Jost&userId=31b5658f69b6&source=post_page-31b5658f69b6----ca69303543cd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://discord.gg/xh2chKX", "anchor_text": "new ML Discord server"}, {"url": "https://blog.zakjost.com/post/adversarial_validation/", "anchor_text": "blog.zakjost.com"}, {"url": "https://www.kaggle.com/c/ieee-fraud-detection/discussion/111284", "anchor_text": "like this one"}, {"url": "https://youtu.be/7cUCDRaIZ7I", "anchor_text": "YouTube video"}, {"url": "https://github.com/zjost/blog_code/tree/master/adversarial_validation", "anchor_text": "github"}, {"url": "https://www.kaggle.com/c/ieee-fraud-detection/data", "anchor_text": "IEEE-CIS Credit Card Fraud Detection dataset"}, {"url": "https://www.kaggle.com/c/ieee-fraud-detection/discussion/111284", "anchor_text": "write-up"}, {"url": "https://youtu.be/7cUCDRaIZ7I", "anchor_text": "YouTube video"}, {"url": "https://github.com/zjost/blog_code/tree/master/adversarial_validation", "anchor_text": "Example code"}, {"url": "http://discord.gg/xh2chKX", "anchor_text": "new ML Discord server"}, {"url": "https://blog.zakjost.com/post/adversarial_validation/", "anchor_text": "https://blog.zakjost.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ca69303543cd---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ca69303543cd---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&user=Zak+Jost&userId=31b5658f69b6&source=-----ca69303543cd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&user=Zak+Jost&userId=31b5658f69b6&source=-----ca69303543cd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fca69303543cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ca69303543cd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ca69303543cd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ca69303543cd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ca69303543cd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ca69303543cd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ca69303543cd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zjost85?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zjost85?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Zak Jost"}, {"url": "https://medium.com/@zjost85/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "555 Followers"}, {"url": "https://www.youtube.com/channel/UCxw9_WYmLqlj5PyXu2AWU_g", "anchor_text": "https://www.youtube.com/channel/UCxw9_WYmLqlj5PyXu2AWU_g"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F31b5658f69b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&user=Zak+Jost&userId=31b5658f69b6&source=post_page-31b5658f69b6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fac53ca1e86fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadversarial-validation-ca69303543cd&newsletterV3=31b5658f69b6&newsletterV3Id=ac53ca1e86fa&user=Zak+Jost&userId=31b5658f69b6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}