{"url": "https://towardsdatascience.com/a-mathematical-primer-of-compression-5ea1ca53fc45", "time": 1683004998.501802, "path": "towardsdatascience.com/a-mathematical-primer-of-compression-5ea1ca53fc45/", "webpage": {"metadata": {"title": "A Mathematical Primer of Compression | by Matthew Ward | Towards Data Science", "h1": "A Mathematical Primer of Compression", "description": "Since I\u2019m into music, it often comes up there is a growing trend: music is sold digitally and as vinyl. Sometimes I\u2019ll hear people mistakenly call the vinyl trend \u201cretro\u201d or \u201ctrendy\u201d or \u201chip\u201d or\u2026"}, "outgoing_paragraph_urls": [{"url": "http://dr.loudness-war.info/", "anchor_text": "online database", "paragraph_index": 9}, {"url": "http://www.wavsource.com", "anchor_text": "www.wavsource.com", "paragraph_index": 12}, {"url": "http://amindformadness.com", "anchor_text": "amindformadness.com", "paragraph_index": 46}], "all_paragraphs": ["Since I\u2019m into music, it often comes up there is a growing trend: music is sold digitally and as vinyl. Sometimes I\u2019ll hear people mistakenly call the vinyl trend \u201cretro\u201d or \u201ctrendy\u201d or \u201chip\u201d or whatever. But if you actually ask someone why they prefer records, they\u2019ll probably tell you the sound quality is better.", "This will be an article on lossless compression, and I\u2019ll try to keep everything to general concepts or examples.", "Let\u2019s start with the terminology. First, media files can be large. Back when I was young, computers didn\u2019t have basically infinite space, so compression was an important tool for reducing the size of a media file. That\u2019s when I got fascinated by this topic.", "Compression is basically an algorithm to take the size of a file and makes it smaller. The most obvious method for doing this is lossy compression. This just means you lose information. The goal of such an algorithm is to only lose information that is \u201cunimportant\u201d and \u201cwon\u2019t be noticed.\u201d", "A far more surprising method of compression is called lossless. At first, it seems paradoxical. How can you make the file size smaller, but not lose any information? Isn\u2019t the file size basically the information?", "Let's talk about why people don\u2019t like lossy compressed audio files. There is one quick and dirty thing you can do to immediately lose information and reduce the size of an audio file.", "This is dynamic range (DR) compression.", "Think of a soundwave. The amplitude basically determines how loud it is. You can literally compress the wave to have a smaller amplitude without changing any other musical qualities.", "One of the most important parts of music is the DR. A moving, soaring climax will not have the same effect if the entire build-up to it is the same loudness.", "This is such a controversial compression technique that many people switch to vinyl purely for DR reasons. There is a whole, searchable online database of albums to find out the DR and whether it is considered good, acceptable, or bad.", "Go search for your favorite albums. It is kind of fun to find out how much has been squashed out even in lossless CD format vs vinyl! (e.g. System of a Down\u2019s Toxity is DR 11 [acceptable] on vinyl and DR 6 [truly bad] on CD).", "The other most common lossy compression technique for audio is a bit more involved, but it actually changes the music, so it is worth thinking about. Let\u2019s actually make a rough algorithm for doing this (there currently exist much better and subtler forms of the following, but it amounts to the same thing).", "This is a bit of a silly example, but I went to www.wavsource.com to get a raw wav file to work with. I grabbed one of the first ones, an audio sample from the movie 2001: A Space Odyssey. Here is the data visualization of the sound waves:", "One thing we can do is the Fast Fourier Transform. This will take these sound waves and get rid of the time component. Normally you\u2019ll want to make a \u201cmoving window,\u201d so you keep track of some time.", "For example, we can see that from 0.5 sec to 1.5 sec is one \u201cpacket.\u201d We should probably transform that first, then move to the next.", "The FFT leaves us just with the frequencies that occur and how loud they are. I did this with python\u2019s scypy.fftpack:", "Ignore the scales which were changed just to make everything more visible but not normalized. The crudest thing we could do is set a cutoff and just remove all frequencies that we assume will be inaudible anyway:", "If we do this too much, we are going to destroy how natural the sound is. All sounds occurring naturally have tons of subtle overtones. You often can\u2019t explicitly hear these, so they will occur below the cutoff threshold.", "This will bring us toward a \u201cpure\u201d tone which will sound more synthetic or computer-generated. This is probably why no one actually compresses this way. This example was just to give an idea of one way it could be done (to finish it off you can now just inverse FFT and write to wav).", "A slightly better compression technique would be to take short time intervals and multiply the peak frequency by a bump function. This will shrink all the extraneous frequencies without completely removing the robustness of the sound.", "This is how some lossy compression is actually done. There are other more fun things with wavelets that would take several articles to describe, but the goal here is to get to lossless compression.", "I hope that helps to see what lossy compression is and that it can cause some serious harm when done without care. With care, you will still lose enough sound quality that many music aficionados avoid mp3 and digital downloads completely in favor of vinyl.", "Now let\u2019s tackle the seemingly paradoxical concept of lossless compression.", "I\u2019ll first point out that even if this seems like a paradoxical notion, everyone already believes it can be done. We use it all the time when we compress files on our computers by zipping them.", "Of course, this results in a smaller file, but no one thinks when they unzip they will have lost information. This means that there must exist ways to do lossless compression.", "Today\u2019s example is a really simple and brilliant way of doing it. It will have nothing to do with music for now, but don\u2019t think of this as merely a toy example. Huffman coding is actually used as a step in mp3 encoding, so it relates to what we\u2019ve been discussing.", "Here\u2019s the general idea. Suppose you want to encode (into binary) text in the most naive way possible. You assign A to 0, B to 1, C to 10, D to 11, etc. When you get to Z you\u2019ll have 11001. This means that you have to use 5 bits for every single letter.", "To encode \u201cCAT\u201d we did something dumb. We only needed 3 letters, so if we had chosen ahead of time a better encoding method, maybe C = 00, A = 01, T = 10, then we could encode the text as 00 01 10.", "I know your complaint already. Any sufficiently long text will contain every letter, so there is no way to do better than that original naive method. Well, you\u2019re just not being clever enough!", "Some letters will occur with more frequency than others. So if, for example, the letter \u201cs\u201d occurs with frequency 100 and then the next most frequent letter occurs 25 times, you will want to choose something like \u201c01\u201d for \u201cs\u201d. That way the smallest number of bits is used for the most frequent letters.", "Ah, but the astute reader complains again. The reason we couldn\u2019t do this before is that we wouldn\u2019t be able to tell the difference in a long string between two frequent letters: 10 01, and a single less-frequent letter: 1001. This was why we needed all 5 bits when we used the whole alphabet.", "This is a uniqueness problem. What we do to fix it is to not allow \u201c01\u201d to be a prefix on an assigned string once we\u2019ve assigned it. This way, when we encounter 01, we stop. We know that is the letter \u201cs\u201d because no other letter begins \u201c01\u201d.", "Of course, what ends up happening is that we have to go to much more than 5 bits for some letters, but the idea is that they will be used with such infrequency and the 2- and 3-bit letters used with such high frequency that it ends up saving way more space than if we stuck to 5.", "Now you should be asking two questions:", "We won\u2019t talk about the proof since this is an article \u201cby example\u201d to give you a feel for the types of things people do in compression. But I think the algorithm to generate the symbol strings to encode is pretty neat.", "Let\u2019s generate the Huffman tree for \u201cTitter Twitter Top\u201d (just to get something with high frequency and several \u201crepeat\u201d frequencies).", "Now we will construct a binary tree with these as leaves. Start with the bottom 2 as leaves and connect them to a parent with a placeholder (*) and the sum of the frequencies. Then insert this new placeholder into the correct place on the list and remove the two you used:", "Now repeat the process with the bottom two on the list (if a node is on the list already, use it in the tree):", "Keep repeating this process until you\u2019ve exhausted the list and you will get the full binary tree we will use:", "Now, to work out how to encode each letter, write a 0 on every left edge and a 1 on every right edge. Descend from the top to the letter you want and write the digits in order. This is the encoding.", "Test it out for yourself. You will find there is no ambiguity because each string of digits used for a letter never appears as a prefix of another letter.", "Also, note that the letter that occurs with the highest frequency is a single bit, and the bits needed to get longer only as the frequency gets less. The encoding for Titter Twitter Top with this Huffman code is 39 bits whereas the naive encoding is 80.", "This compresses to half the space needed and loses no information!", "We won\u2019t get into the tedious details of how computers actually store information to see that there are lots of subtleties we\u2019ve ignored for executing this in practice (plus we have to store the conversion table as part of the data), but at least we\u2019ve seen an example of lossless compression in theory.", "Also, there was nothing special about letters here. We could do this with basically any information (for example frequencies in a sound file or pixel colors in an image).", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Lifelong learner and creator. More information at amindformadness.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5ea1ca53fc45&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@wardmj4?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wardmj4?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Matthew Ward"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad7e5fa173f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&user=Matthew+Ward&userId=ad7e5fa173f&source=post_page-ad7e5fa173f----5ea1ca53fc45---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@intelligenciya?utm_source=medium&utm_medium=referral", "anchor_text": "Alexey Ruban"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://dr.loudness-war.info/", "anchor_text": "online database"}, {"url": "http://www.wavsource.com", "anchor_text": "www.wavsource.com"}, {"url": "https://medium.com/tag/compression?source=post_page-----5ea1ca53fc45---------------compression-----------------", "anchor_text": "Compression"}, {"url": "https://medium.com/tag/python?source=post_page-----5ea1ca53fc45---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/math?source=post_page-----5ea1ca53fc45---------------math-----------------", "anchor_text": "Math"}, {"url": "https://medium.com/tag/mathematics?source=post_page-----5ea1ca53fc45---------------mathematics-----------------", "anchor_text": "Mathematics"}, {"url": "https://medium.com/tag/data?source=post_page-----5ea1ca53fc45---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&user=Matthew+Ward&userId=ad7e5fa173f&source=-----5ea1ca53fc45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&user=Matthew+Ward&userId=ad7e5fa173f&source=-----5ea1ca53fc45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5ea1ca53fc45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5ea1ca53fc45---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5ea1ca53fc45--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wardmj4?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@wardmj4?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matthew Ward"}, {"url": "https://medium.com/@wardmj4/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "http://amindformadness.com", "anchor_text": "amindformadness.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad7e5fa173f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&user=Matthew+Ward&userId=ad7e5fa173f&source=post_page-ad7e5fa173f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4b9b6891d7cb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-mathematical-primer-of-compression-5ea1ca53fc45&newsletterV3=ad7e5fa173f&newsletterV3Id=4b9b6891d7cb&user=Matthew+Ward&userId=ad7e5fa173f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}