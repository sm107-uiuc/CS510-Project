{"url": "https://towardsdatascience.com/implied-volatility-in-r-assess-options-risk-correctly-70fe36843474", "time": 1683015326.780573, "path": "towardsdatascience.com/implied-volatility-in-r-assess-options-risk-correctly-70fe36843474/", "webpage": {"metadata": {"title": "Implied Volatility in R \u2014 assess options risk correctly | by Stefan Haring | Towards Data Science", "h1": "Implied Volatility in R \u2014 assess options risk correctly", "description": "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Implied_volatility", "anchor_text": "Wikipedia", "paragraph_index": 7}, {"url": "https://en.wikipedia.org/wiki/Black%E2%80%93Scholes_model", "anchor_text": "Generalized Black Scholes Merton model", "paragraph_index": 12}, {"url": "https://finance.yahoo.com/quote/AAPL?p=AAPL", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://finance.yahoo.com/quote/AAPL/options?p=AAPL", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://www.treasury.gov/resource-center/data-chart-center/interest-rates/Pages/TextView.aspx?data=yield", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://en.wikipedia.org/wiki/Volatility_smile", "anchor_text": "volatility smile", "paragraph_index": 22}, {"url": "https://finance.yahoo.com/quote/AAPL/options", "anchor_text": "here.", "paragraph_index": 26}], "all_paragraphs": ["Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "This article does not offer investment advice and nothing in it should be construed as investment advice. It provides information and education for individuals who can make their investment decisions without advice.", "The information contained in this article is not, and should not be read as, an offer or recommendation to buy or sell or a solicitation of an offer or recommendation to buy or sell any securities. It is not, and should not be seen as, a recommendation to use any particular investment strategy.", "The recent rise of low- or no-fee brokerages like Robinhood has led to a significant increase of retail investors trading option contracts. These financial instruments are inherently riskier than their underlying stocks and this risk is not directly measurable by just using the price of the options. Therefore different measures must be used to adequately assess the risk. One such measure is the Implied Volatility Surface.", "In this article, I will describe the process for obtaining the current Implied Volatility Surface for stock options using freely available data and R. The result can be used to compare risk across different stocks and to price option contracts. I will also demonstrate how we can create an interactive chart of the volatility surface for immediate analysis or to display it in a dashboard.", "Before we can go through the necessary steps to obtain and plot an Implied Volatility Surface like the one above, we need to be able to answer a few questions first:", "Note: If you are already familiar with the concept of Implied Volatility Surfaces and Option Pricing, you can skip to section 2. The following section introduces some key concepts, notations and code snippets that will be used throughout the rest of the article. However, the full code can be found at the end of the article.", "According to Wikipedia, Implied Volatility is defined as follows:", "The implied volatility (IV) of an option contract is that value of the volatility of the underlying instrument which, when input in an option pricing model, will return a theoretical value equal to the current market price of said option.", "In simpler terms, IV is a measure for expected future fluctuations of a stock price based on the stocks currently traded option prices. It is commonly stated as a percentage value that indicates the expected annualized 1 standard deviation range for the stock.", "So why is Implied Volatility important? IV gives us an idea about how market participants assess the uncertainty in a stocks price. It is therefore a good indicator for the general underlying risk of a stock as well as a predictor for the expected trading range. Furthermore, the IV of a stock allows us to price options with parameterisations that are currently not observable in the market. Lastly, IV can be used to assess the relative value between options on different stocks. As the price of an option is dependant on the price of the underlying, it is not suitable for a comparison between options on different stocks. This is why option prices are also often quoted in terms of volatility rather than price.", "Implied Volatility is generally calculated by solving the inverse pricing formula of an option pricing model. This means that instead of using the pricing model to calculate the price of an option, the price that is observed in the market is used as an input and the output is the volatility.", "The best known option pricing model is the Generalized Black Scholes Merton model. Now while this model has drawn its fair share of criticism over the years, due to its simplicity and closed-form solutions it is widely used in practice and we will use it throughout this article.", "The closed-form solutions for European calls and puts are:", "This is easily implemented in R.", "While the pricing model provides us with a closed-form solution, the inverse pricing model that is used to obtain the IV has no such solution. We therefore need to use an optimizer to calculate the IV. For this, we implement an objective function in R and then use the optimize function to get the IV.", "Let\u2019s check if our implementation works by using some real world data. We will use Apple (AAPL) as an example. We can get all the data we need from yahoo finance, the stock data is here and the latest option prices can be found here. Below is a screenshot of the data that we will be using in the example.", "From the screenshot we can see that the current stock price (on October 16th) is 119.02, the first strike price in the list is 125, the option price (we use the ask price) is 3.55, the time to maturity is 28 days and the displayed IV is 45.12%. All that is missing to calculate the IV ourselves is the risk free interest rate. As an approximation we will take the 3-month US treasury bill rate which is currently 0.11% (you can find the data here).", "Plugging these values into our optimization function yields the following:", "Our optimization yields an IV of 45.11% vs the 45.12% displayed by yahoo finance. A pretty good match (and it seems that yahoo finance is also using the Generalized Black Scholes Model).", "Note: You have probably realized that we have set the dividend yield q to 0 in our optimization and have obtained the same result as yahoo finance. When checking the dividend yield for Apple, one can see that it is not 0. This indicates that the data provided by yahoo finance might not be totally accurate. We will therefore stick with our own calculation.", "Looking at the sample data above you have probably observed that the implied volatility changes with the strike price and also when selecting a different expiry date. This observation finally leads us to the Implied Volatility Surface.", "One of the main shortcomings of the original Black Scholes Merton model is that it assumes constant volatility across strike prices. However, in practice different volatilities for different strike prices can be observed. This is known as the so-called volatility smile. The same can be observed for options of different maturities. The Implied Volatility therefore changes along 2 dimensions, the strike price and the time to maturity. Since the strike price depends on the underlying stock price, it is not suitable for comparison across different stocks. Instead of the strike price, the options moneyness is used. This is simply the ratio Stock Price / Strike Price for Calls and Strike Price / Stock Price for Puts.", "This produces the volatility surface which is required to accurately price options and assess the underlying uncertainty of the stock price.", "After this quite lengthy introduction we will finally look at how to obtain Implied Volatility Surfaces from actual market data and compare it across different stocks.", "Unlike historical stock data, historical option chains are not that easy to come by (especially not for free). However, since we are mostly concerned with the current state of the Implied Volatility Surface for pricing and risk assessment, current data will do.", "As shown in the Introduction section, yahoo finance has us covered, e.g. you can find the current option chains for Apple here. To load the data in R, we can either use the getOptionChain function from the quantmod package or scrape it ourselves. I have decided to do the latter as the getOptionChain function does not return the IV column provided by yahoo finance and I wanted to compare these values with the ones calculated by myself. Also, its always good to practice webscraping!", "The following code uses the quantmod package to get the general stock info and the rvest package to scrape the option chains. To avoid unreliable data points we remove options that have not traded during the last 5 minutes of the stocks last trading day (since we will be using the stocks closing price to calculate the IV) as well as set boundaries for the moneyness (between 0.85 and 1.15) and the time to maturity (between 7 days and 6 months).", "This gives us two data frames, one for the call options and one for the put options.", "Next, we will calculate the Implied Volatility based on the given data ourselves. You might ask yourself why we are doing this if we can just get the data from yahoo finance. We do this for the following reasons:", "We will continue our example with Apple and calculate the IV using the method described in the Introduction and without using the dividend yield. As a reminder, here is the code that we will be using.", "As a check, we can plot the difference between the IV obtained by our calculation and the data from yahoo finance.", "We can observe that the absolute difference between the Implied Volatilities are minimal and decrease with the time to maturity. This is due to the aforementioned fact that we calculate the IV based on the closing price whereas the last traded option prices are based on slightly different stock prices. This effect is stronger for shorter times to maturity.", "In this example we haven\u2019t included the dividend yield. Going forward, however, we will include it. Luckily, the data can be obtained easily using the getQuote function from the quantmod package. We can re-run the IV calculation now and use the acast function from the reshape2 package to create our IV grids for calls and puts.", "Inspecting the resulting grids will reveal that we have quite a lot of NAs due to not having option prices for all strikes/maturities available:", "To fill out the missing values, we need to interpolate our surface.", "To perform the interpolation, we will use the interp function from the akima package. It implements a gridded bivariate interpolation for irregular data, basically exactly what we need.", "The steps we need to undertake to obtain our complete surface are as follows:", "A code example with further explanations for the missing call values can be found below.", "And there we have it, the complete Implied Volatility Surface for Call options on Apple stock! We can plot our result in a nice interactive chart using the plotly package.", "We can use the same code to obtain the surfaces for other stocks, for example Tesla.", "We can immediately see the difference between the two stocks, Tesla is inherently more volatile than Apple and it shows in the volatility surface. Simply looking at the option prices wouldn\u2019t show this as they depend on the underlying stocks price and make it impossible to compare them between different stocks.", "In this article I have detailed the process for obtaining the current Implied Volatility Surface for stock options using freely available data and R. This can be used to compare risk across different stocks and pricing option contracts. Using plotly, we can create an interactive charts of the volatility surface for immediate analysis or display it in a dashboard.", "Please make sure to let me know if you have any feedback or suggestions for improving what I have described in this post!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Quant/Data Scientist/Retail Investor. Risk/Data Management/Analytics for Investment Banks, Hedge Funds & Asset Managers"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F70fe36843474&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----70fe36843474--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@harings?source=post_page-----70fe36843474--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287----70fe36843474---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@ishant_mishra54?utm_source=medium&utm_medium=referral", "anchor_text": "Ishant Mishra"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://en.wikipedia.org/wiki/Implied_volatility", "anchor_text": "Wikipedia"}, {"url": "https://en.wikipedia.org/wiki/Black%E2%80%93Scholes_model", "anchor_text": "Generalized Black Scholes Merton model"}, {"url": "https://finance.yahoo.com/quote/AAPL?p=AAPL", "anchor_text": "here"}, {"url": "https://finance.yahoo.com/quote/AAPL/options?p=AAPL", "anchor_text": "here"}, {"url": "https://www.treasury.gov/resource-center/data-chart-center/interest-rates/Pages/TextView.aspx?data=yield", "anchor_text": "here"}, {"url": "https://en.wikipedia.org/wiki/Volatility_smile", "anchor_text": "volatility smile"}, {"url": "https://finance.yahoo.com/quote/AAPL/options", "anchor_text": "here."}, {"url": "https://medium.com/tag/r?source=post_page-----70fe36843474---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/options?source=post_page-----70fe36843474---------------options-----------------", "anchor_text": "Options"}, {"url": "https://medium.com/tag/finance?source=post_page-----70fe36843474---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/options-trading?source=post_page-----70fe36843474---------------options_trading-----------------", "anchor_text": "Options Trading"}, {"url": "https://medium.com/tag/visualization?source=post_page-----70fe36843474---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&user=Stefan+Haring&userId=6c41f5dc3287&source=-----70fe36843474---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&user=Stefan+Haring&userId=6c41f5dc3287&source=-----70fe36843474---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----70fe36843474--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F70fe36843474&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----70fe36843474---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----70fe36843474--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----70fe36843474--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----70fe36843474--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----70fe36843474--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----70fe36843474--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/@harings/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "152 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4a0969693648&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimplied-volatility-in-r-assess-options-risk-correctly-70fe36843474&newsletterV3=6c41f5dc3287&newsletterV3Id=4a0969693648&user=Stefan+Haring&userId=6c41f5dc3287&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}