{"url": "https://towardsdatascience.com/hands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621", "time": 1683013038.727197, "path": "towardsdatascience.com/hands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621/", "webpage": {"metadata": {"title": "Hands-on guide to Python Optimal Transport toolbox: Part 1 | by Aurelie Boisbunon | Towards Data Science", "h1": "Hands-on guide to Python Optimal Transport toolbox: Part 1", "description": "As a follow-up of the introductory article on optimal transport by Ievgen Redko, I will present below how you can solve Optimal Transport (OT) in practice using the Python Optimal Transport (POT)\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/optimal-transport-a-hidden-gem-that-empowers-todays-machine-learning-2609bbf67e59", "anchor_text": "introductory article on optimal transport", "paragraph_index": 0}, {"url": "https://pythonot.github.io/", "anchor_text": "Python Optimal Transport (POT)", "paragraph_index": 0}, {"url": "http://pot.readthedocs.io", "anchor_text": "http://pot.readthedocs.io,", "paragraph_index": 3}, {"url": "https://pythonot.github.io/all.html#ot.dist", "anchor_text": "ot.dist", "paragraph_index": 9}, {"url": "https://pythonot.github.io/all.html#ot.sinkhorn", "anchor_text": "ot.sinkhorn", "paragraph_index": 23}, {"url": "https://towardsdatascience.com/hands-on-guide-to-python-optimal-transport-toolbox-part-2-783029a1f062", "anchor_text": "Part 2 by Ievgen Redko", "paragraph_index": 27}], "all_paragraphs": ["As a follow-up of the introductory article on optimal transport by Ievgen Redko, I will present below how you can solve Optimal Transport (OT) in practice using the Python Optimal Transport (POT) toolbox.", "To start with, let us install POT using pip from the terminal by simply running", "If everything went well, you now have POT installed and ready to use on your computer.", "The online documentation of POT is available at http://pot.readthedocs.io, or you can check the inline help help(ot.dist) .", "We are now ready to start our example.", "We will solve the Bakery/Caf\u00e9s problem of transporting croissants from a number of Bakeries to Caf\u00e9s in a City (in this case Manhattan). We did a quick google map search in Manhattan for bakeries and Caf\u00e9s:", "We extracted from this search their positions and generated fictional production and sale number (that both sum to the same value).", "We have access to the position of Bakeries bakery_pos and their respective production bakery_prod which describe the source distribution. The Caf\u00e9s where the croissants are sold are defined also by their position cafe_pos and cafe_prod, and describe the target distribution.", "Next, we plot the position of the bakeries and caf\u00e9s on the map. The size of the circle is proportional to their production.", "We can now compute a cost matrix between the bakeries and the caf\u00e9s, which will be the transport cost matrix. This can be done using the ot.dist function that defaults to squared Euclidean distance but can return other things such as cityblock (or Manhattan distance).", "The red cells in the matrix image show the bakeries and caf\u00e9s that are further away, and thus more costly to transport from one to the other, while the blue ones show those that are very close to each other, with respect to the squared Euclidean distance.", "We now come to the problem itself, which is to find an optimal solution to the problem of transporting croissants from bakeries to caf\u00e9s. In order to do that, let\u2019s see a little bit of maths.", "The aim is to find the transport matrix gamma such that", "where M is the cost matrix, and a and b are respectively the sample weights for source and target.", "So, what it means, is that we take into account the cost of transporting croissants from a bakery to a caf\u00e9 through M, and we want the sum of each line of gamma to be the number of croissants the corresponding bakery has to sell, and the sum of each column to be the number of croissants the corresponding caf\u00e9s needs. Hence, each element of the transport matrix will correspond to the number of croissants that a bakery has to send to a caf\u00e9.", "This problem is called Earth Mover\u2019s distance, or EMD, also known as discrete Wasserstein distance.", "Let\u2019s see what it gives on our example.", "The graph below (left) show the transport from a bakery to a caf\u00e9, with the width of the line proportional to the number of croissants to be transported. On the right, we can see the transport matrix with the exact values. We can see that the bakeries only need to transport croissants to one or two caf\u00e9s, the transport matrix being very sparse.", "One issue with EMD is that its algorithmic complexity is in O(n\u00b3log(n)), n being the largest dimension between source and target. In our example, n is small, so it is OK to use EMD, but for larger values of n we might want to look into other options.", "As is often the case when an algorithm is long to compute, we can regularize it in order to obtain a solution to a simpler or faster problem. The Sinkhorn algorithm does that by adding an entropic regularization term and thus solves the following problem.", "where reg is an hyperparameter and Omega is the entropic regularization term defined by:", "The Sinkhorn algorithm is very simple to code. You can implement it directly using the following pseudo-code:", "Be careful of numerical problems. A good pre-processing for Sinkhorn is to divide the cost matrix M by its maximum value.", "An alternative is to use the POT toolbox with ot.sinkhorn:", "When plotting the resulting transport matrix, we notice right away that it is not sparse at all with Sinkhorn, each bakery delivering croissants to all 5 caf\u00e9s with that solution. Also, this solution gives a transport with fractions, which does not make sense in the case of croissants. This was not the case with EMD.", "Obviously, the regularization hyperparameter reg of Sinkhorn plays an important role. Let\u2019s see with the following graphs how it impacts the transport matrix by looking at different values.", "This series of graphs shows that the solution of Sinkhorn starts with something very similar to EMD (although not sparse) for very small values of the regularization parameter reg, and tends to a more uniform solution as reg increases.", "This first part showed a simple example for applying Optimal Transport with POT library. Optimal Transport is a powerful tool that can be applied in many ways, as discussed in Part 2 by Ievgen Redko.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F922a2e82e621&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----922a2e82e621--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aboisbunon?source=post_page-----922a2e82e621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aboisbunon?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Aurelie Boisbunon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd0b0aa5dc7d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&user=Aurelie+Boisbunon&userId=d0b0aa5dc7d5&source=post_page-d0b0aa5dc7d5----922a2e82e621---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/optimal-transport-a-hidden-gem-that-empowers-todays-machine-learning-2609bbf67e59", "anchor_text": "introductory article on optimal transport"}, {"url": "https://pythonot.github.io/", "anchor_text": "Python Optimal Transport (POT)"}, {"url": "http://pot.readthedocs.io", "anchor_text": "http://pot.readthedocs.io,"}, {"url": "https://github.com/PythonOT/POT/raw/master/data/manhattan.npz", "anchor_text": "https://github.com/PythonOT/POT/raw/master/data/manhattan.npz"}, {"url": "https://pythonot.github.io/all.html#ot.dist", "anchor_text": "ot.dist"}, {"url": "https://pythonot.github.io/all.html#ot.sinkhorn", "anchor_text": "ot.sinkhorn"}, {"url": "https://towardsdatascience.com/hands-on-guide-to-python-optimal-transport-toolbox-part-2-783029a1f062", "anchor_text": "Part 2 by Ievgen Redko"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----922a2e82e621---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/optimal-transport?source=post_page-----922a2e82e621---------------optimal_transport-----------------", "anchor_text": "Optimal Transport"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&user=Aurelie+Boisbunon&userId=d0b0aa5dc7d5&source=-----922a2e82e621---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&user=Aurelie+Boisbunon&userId=d0b0aa5dc7d5&source=-----922a2e82e621---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F922a2e82e621&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----922a2e82e621---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----922a2e82e621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----922a2e82e621--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----922a2e82e621--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----922a2e82e621--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----922a2e82e621--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aboisbunon?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aboisbunon?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Aurelie Boisbunon"}, {"url": "https://medium.com/@aboisbunon/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "11 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd0b0aa5dc7d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&user=Aurelie+Boisbunon&userId=d0b0aa5dc7d5&source=post_page-d0b0aa5dc7d5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F581b87b2968&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhands-on-guide-to-python-optimal-transport-toolbox-part-1-922a2e82e621&newsletterV3=d0b0aa5dc7d5&newsletterV3Id=581b87b2968&user=Aurelie+Boisbunon&userId=d0b0aa5dc7d5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}