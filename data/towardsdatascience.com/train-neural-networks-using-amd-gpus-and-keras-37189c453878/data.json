{"url": "https://towardsdatascience.com/train-neural-networks-using-amd-gpus-and-keras-37189c453878", "time": 1682994961.207057, "path": "towardsdatascience.com/train-neural-networks-using-amd-gpus-and-keras-37189c453878/", "webpage": {"metadata": {"title": "Train neural networks using AMD GPU and Keras | by Mattia Varile | Towards Data Science", "h1": "Train neural networks using AMD GPU and Keras", "description": "AMD is developing a new HPC platform, called ROCm. Its ambition is to create a common, open-source environment, capable to interface both with Nvidia (using CUDA) and AMD GPUs (further information)\u2026"}, "outgoing_paragraph_urls": [{"url": "https://rocm.github.io/index.html", "anchor_text": "further information", "paragraph_index": 0}, {"url": "https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html#hardware-support", "anchor_text": "hardware solutions", "paragraph_index": 4}, {"url": "https://rocm.github.io/index.html", "anchor_text": "following steps", "paragraph_index": 10}, {"url": "https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html#installing-from-amd-rocm-repositories", "anchor_text": "official documentation", "paragraph_index": 10}, {"url": "https://gist.github.com/mattiavarile/957193417b2a5b8d647759d0c3bfb537", "anchor_text": "link", "paragraph_index": 21}, {"url": "https://gist.github.com/mattiavarile/8ecff9d728eac3d08584271720269e9d", "anchor_text": "link", "paragraph_index": 22}, {"url": "https://docs.docker.com/install/linux/linux-postinstall/", "anchor_text": "Manage Docker as a non-root user", "paragraph_index": 29}, {"url": "https://hub.docker.com/r/rocm/tensorflow", "anchor_text": "Tensorflow docker", "paragraph_index": 30}, {"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST dataset", "paragraph_index": 61}, {"url": "https://gist.github.com/mattiavarile/223d9c13c9f1919abe9a77931a4ab6c1", "anchor_text": "modify accordingly", "paragraph_index": 78}], "all_paragraphs": ["AMD is developing a new HPC platform, called ROCm. Its ambition is to create a common, open-source environment, capable to interface both with Nvidia (using CUDA) and AMD GPUs (further information).", "This tutorial will explain how to set-up a neural network environment, using AMD GPUs in a single or multiple configurations.", "On the software side: we will be able to run Tensorflow v1.12.0 as a backend to Keras on top of the ROCm kernel, using Docker.", "To install and deploy ROCm are required particular hardware/software configurations.", "The official documentation (ROCm v2.1) suggests the following hardware solutions.", "Current CPUs which support PCIe Gen3 + PCIe Atomics are:", "ROCm officially supports AMD GPUs that use the following chips:", "On the software side, the current version of ROCm (v2.1), is supported only in Linux-based systems.", "The ROCm 2.1.x platform supports the following operating systems:", "The following hardware/software configuration has been used, by the author, to test and validate the environment:", "In order to get everything working properly, is recommended to start the installation process, within a fresh installed operating system. The following steps are referring to Ubuntu 18.04 LTS operating system, for other OS please refer to the official documentation.", "The first step is to install ROCm kernel and dependencies:", "Open a new terminal CTRL + ALT + T", "To download and install ROCm stack is required to add related repositories:", "Is now required to update apt repository list and install rocm-dkms meta-package:", "The official documentation suggests creating a new video group in order to have access to GPU resources, using the current user.", "Firstly, check the groups in your system, issuing:", "Then add yourself to the video group:", "You may want to ensure that any future users you add to your system are put into the \u201cvideo\u201d group by default. To do that, you can run the following commands:", "Is now suggested to test the ROCm installation issuing the following commands.", "Open a new terminal CTRL + ALT + T , issue the following commands:", "the output should look as follows: link", "The output should look like that: link", "Official documentation finally suggests to add ROCm binaries to PATH:", "Congratulations! ROCm is properly installed in your system and the command:", "should display your hardware information and stats:", "Tip: Take a look to rocm-smi -h command, to explore more functionalities and OC tools", "The fastest and more reliable method to get ROCm + Tensorflow backend to work is to use the docker image provided by AMD developers.", "First, is required to install Docker. In order to do that, please follow the instructions for Ubuntu systems:", "Tip: To avoid inserting sudo docker <command> instead of docker <command> it\u2019s useful to provide access to non-root users: Manage Docker as a non-root user.", "It\u2019s now time to pull the Tensorflow docker provided by AMD developers.", "Open a new terminal CTRL + ALT + T and issue:", "after a few minutes, the image will be installed in your system, ready to go.", "Because of the ephemeral nature of Docker containers, once a docker session is closed all the modifications and files stored, will be deleted with the container.", "For this reason is useful to create a persistent space in the physical drive for storing files and Jupyter notebooks. The simpler method is to create a folder to initialize with a docker container. To do that issue the command:", "This command will create a folder named tf_docker_share useful for storing and reviewing data created within the docker.", "Now, execute the image in a new container session. Simply send the following command:", "The docker is in execution on the directory /tf_docker_share and you should see something similar to:", "it means that you are now operating inside the Tensorflow-ROCm virtual system.", "Jupyter is a very useful tool, for the development, debug and test of neural networks. Unfortunately, it\u2019s not currently installed, as default, on the Tensorflow-ROCm, Docker image, published by ROCm team. It\u2019s therefore required to manually install Jupyter.", "In order to do that, within Tensorflow-ROCm virtual system prompt,", "It will install the Jupyter package into the virtual system. Leave open this terminal.", "2. Open a new terminal CTRL + ALT + T .", "Find the CONTAINER ID issuing the command:", "A table, similar to the following should appear:", "The first column represents the Container ID of the executed container. Copy that because it\u2019s necessary for the next step.", "3. It\u2019s time to commit, to permanently write modifications of the image. From the same terminal, execute:", "where tag value is an arbitrary name for example personal .", "4. To double check that the image has been generated correctly, from the same terminal, issue the command:", "that should result generate a table similar to the following:", "It\u2019s important to note that we will refer to this newly generated image for the rest of the tutorial.", "The new docker run command, to use, will look like:", "where once again, tag value is arbitrary, for example personal .", "We can finally enter the Jupyter environment. Inside it, we will create the first neural network using Tensorflow v1.12 as backend and Keras as frontend.", "Firstly close all the previously executing Docker containers.", "2. Close all the Docker container/containers:", "3. Close all the already open terminals.", "Let\u2019s open a new terminal CTRL + ALT + T :", "You should be logged into Tensorflow-ROCm docker container prompt.", "a new browser window should appear, similar to the following:", "If the new tab does not appear automatically, on the browser, go back to the terminal where jupyter notebook command has been executed. On the bottom, there is a link to follow (press: CTRL + left mouse button on it) then, a new tab in your browser redirects you to Jupyter root directory.", "In the last section, of this tutorial, we will train a simple neural network on the MNIST dataset. We will firstly build a fully connected neural network.", "Let\u2019s create a new notebook, by selecting Python3 from the upper-right menu in Jupyter root directory.", "A new Jupiter notebook should pop-up in a new browser tab. Rename it tofc_network by clicking Untitled on the upper left corner of the window.", "Let\u2019s check Tensorflow backend. On the first cell insert:", "then press SHIFT + ENTER to execute. The output should look like:", "Let\u2019s import some useful functions, to use next:", "Let\u2019s set batch size, epochs and number of classes.", "We will now download and preprocess inputs, loading them into system memory.", "It\u2019s time to define the neural network architecture:", "We will use a very simple, two-layer fully-connected network, with 512 neurons per layer. It\u2019s also included a 20% drop probability on the neuron connections, in order to prevent overfitting.", "Let\u2019s print some insight into the network architecture:", "Despite the simplicity of the problem, we have a considerable number of parameters to train (almost ~700.000), it means also considerable computational power consumption. Convolutional Neural Networks will solve the issue reducing computational complexity.", "The neural network has been trained on a single RX 480 with a respectable 47us/step. For comparison, an Nvidia Tesla K80 is reaching 43us/step but is 10x more expensive.", "As an additional step, if your system has multiple GPUs, is possible to leverage Keras capabilities, in order to reduce training time, splitting the batch among different GPUs.", "To do that, first it\u2019s required to specify the number of GPUs to use for training by, declaring an environmental variable (put the following command on a single cell and execute):", "Numbers from 0 to \u2026 are defining which GPU to use for training. In case you want to disable GPU acceleration simply:", "It\u2019s also necessary to add multi_gpu_model function.", "As an example, if you have 3 GPUs, the previous code will modify accordingly.", "That concludes this tutorial. The next step will be to test a Convolutional Neural Network on the MNIST dataset. Comparing performances in both single and multi-GPU.", "What\u2019s relevant here, is that AMD GPUs perform quite well under computational load at a fraction of the price. GPU market is changing rapidly and ROCm gave to researchers, engineers, and startups, very powerful, open-source tools to adopt, lowering upfront costs in hardware equipment.", "Please feel free to comment on this article in order to improve his quality and effectiveness.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F37189c453878&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----37189c453878--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37189c453878--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mattiavarile?source=post_page-----37189c453878--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattiavarile?source=post_page-----37189c453878--------------------------------", "anchor_text": "Mattia Varile"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9c50f3928cb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&user=Mattia+Varile&userId=f9c50f3928cb&source=post_page-f9c50f3928cb----37189c453878---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://rocm.github.io/index.html", "anchor_text": "further information"}, {"url": "https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html#hardware-support", "anchor_text": "hardware solutions"}, {"url": "https://rocm.github.io/index.html", "anchor_text": "following steps"}, {"url": "https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html#installing-from-amd-rocm-repositories", "anchor_text": "official documentation"}, {"url": "https://gist.github.com/mattiavarile/957193417b2a5b8d647759d0c3bfb537", "anchor_text": "link"}, {"url": "https://gist.github.com/mattiavarile/8ecff9d728eac3d08584271720269e9d", "anchor_text": "link"}, {"url": "https://docs.docker.com/install/linux/docker-ce/ubuntu/", "anchor_text": "Get Docker CE for UbuntuTo get started with Docker CE on Ubuntu, make sure you meet the prerequisites, then install Docker. Prerequisites\u2026docs.docker.com"}, {"url": "https://docs.docker.com/install/linux/linux-postinstall/", "anchor_text": "Manage Docker as a non-root user"}, {"url": "https://hub.docker.com/r/rocm/tensorflow", "anchor_text": "Tensorflow docker"}, {"url": "http://yann.lecun.com/exdb/mnist/", "anchor_text": "MNIST dataset"}, {"url": "https://gist.github.com/mattiavarile/223d9c13c9f1919abe9a77931a4ab6c1", "anchor_text": "modify accordingly"}, {"url": "http://www.linkedin.com/in/mattia-varile", "anchor_text": "Mattia Varile"}, {"url": "https://medium.com/tag/amd?source=post_page-----37189c453878---------------amd-----------------", "anchor_text": "Amd"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----37189c453878---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----37189c453878---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/keras?source=post_page-----37189c453878---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----37189c453878---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&user=Mattia+Varile&userId=f9c50f3928cb&source=-----37189c453878---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&user=Mattia+Varile&userId=f9c50f3928cb&source=-----37189c453878---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37189c453878--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F37189c453878&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----37189c453878---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----37189c453878--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----37189c453878--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----37189c453878--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----37189c453878--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----37189c453878--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----37189c453878--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----37189c453878--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----37189c453878--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattiavarile?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattiavarile?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mattia Varile"}, {"url": "https://medium.com/@mattiavarile/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "126 Followers"}, {"url": "https://www.linkedin.com/in/mattia-varile/", "anchor_text": "https://www.linkedin.com/in/mattia-varile/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9c50f3928cb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&user=Mattia+Varile&userId=f9c50f3928cb&source=post_page-f9c50f3928cb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F18b61a60c3a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftrain-neural-networks-using-amd-gpus-and-keras-37189c453878&newsletterV3=f9c50f3928cb&newsletterV3Id=18b61a60c3a9&user=Mattia+Varile&userId=f9c50f3928cb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}