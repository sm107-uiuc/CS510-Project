{"url": "https://towardsdatascience.com/callbacks-in-neural-networks-b0b006df7626", "time": 1683017380.587595, "path": "towardsdatascience.com/callbacks-in-neural-networks-b0b006df7626/", "webpage": {"metadata": {"title": "Callbacks in neural networks. Injecting changes to your models | by Risto Hinno | Towards Data Science", "h1": "Callbacks in neural networks", "description": "While training machine learning model you want to play with it. Use different parameters, architectures, tricks and everything else that might improve performance. How to implement those changes? You\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Callback_(computer_programming)", "anchor_text": "Wikipedia", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Executable_code", "anchor_text": "executable code", "paragraph_index": 1}, {"url": "https://github.com/RRisto/callbacks", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/RRisto/callbacks/blob/master/without_callbacks.py", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://github.com/RRisto/callbacks/blob/master/with_callbacks.py", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/fit.py", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/learner.py", "anchor_text": "class", "paragraph_index": 9}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/callback.py", "anchor_text": "source", "paragraph_index": 11}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/callback.py", "anchor_text": "here", "paragraph_index": 14}, {"url": "https://github.com/RRisto/callbacks/blob/master/with_callbacks.py", "anchor_text": "here", "paragraph_index": 17}], "all_paragraphs": ["While training machine learning model you want to play with it. Use different parameters, architectures, tricks and everything else that might improve performance. How to implement those changes? You have to change source code. But that will make codebase bigger, more difficult to maintain, more error-prone. Is there a better way? Yes! We could use callbacks.", "Wikipedia defines callback as a \u201c\u2026 any executable code that is passed as an argument to other code\u201d. To my understanding, the main idea of callbacks is to inject code into existing program (functions, classes). Let\u2019s use a simple example to see what callbacks are.", "Full code examples for this post are available here.", "We want to train a neural network where we fit batches of data. Full example code is available here. Training loop consists of our example main fit function, which uses:", "To do all the work in each batch we use one_batch function which:", "So far this is a simple classical model training example. In each step in fit and one_batch function we might want to use different adjustments to have better overview of the training, increase speed of training etc. Simplistic approach would be to update existing functions by adding new lines of code. But problem is that we don\u2019t know which of the changes are really improving our model. If we hardcode them into our model we might have a bunch of redundant code not to mention the errors that might creep in. Callbacks give us a great way to inject new code into training loop without touching source code of the training loop.", "In our case callbacks are classes which have methods which are called in right step of the fit function. There is a base CallBack class which defines methods for individual callback (callbacks from 1 to n in the following graph). There is a CallBackHandler class which combines individual callbacks into one object which is given as an argument for Learner class which combines data, optimizer etc. to simplify training.", "After everything needed for training is packed into Learner class we could feed it into our fit function. Let\u2019s have an example.", "With callbacks we could adjust our training loop (full example is here and here):", "What we have added some mysterious calls to some learner.cb (learner callback) functions. Learner itself is just a class which holds loss function, optimizer, dataloaders and callbacks. I have made similar adjustments to one_batch function and introduced all_batch function to simplify fit function:", "Adding calls to learner.cb functions give us now freedom to define custom functions which could be called during training time without changing training loop source code. Each step in training loop we call callbacks which contain custom functionality we want to activate.", "Callback is a class which defines functions which are called different stages of the training loop. Base class for callback is following (source):", "This class itself doesn\u2019t do much, if we inserted this code into training loop, it wouldn\u2019t change anything. Reason for this class is to use it as a template for specific callbacks that modify training loop. For example code for callback counting and displaying number of batches during training is following:", "Callback uses inheritance by using base CallBack class and only re-defining functions that are necessary for specific callback. BatchCounter defines begin_epoch to initialize batch counter and after_step to increment batch count and display number of batches processed. We have our first callback, but usually we (may) want to insert multiple callbacks, how to do that? We could use CallbackHandler.", "CallbackHandler is another class whose main purpose is to collect all our callbacks and call them in right training phase. Source code for CallbackHandler could be found here. Beginning of the CallbackHandler is following:", "During initialization all callbacks are stored. In different training phases every callback appropriate function is called (remember every callback inherits from base CallBack class, so if we haven\u2019t defined specific functions in our callback they are inherited from base CallBack with default behaviour doing basically nothing). CallbackHandler checks if we should stop training or skip some step. This a reason why CallBack should return True or False.", "Also, we refer to learner so that each individual callback has access to learner and its internal states (see method set_learn).", "Now we just need to insert callbacks to fit function (full example is here):", "We just added list of callback(s) to CallbackHandler and gave it as a argument to learner. If we want to add more callbacks then we could just define our custom callback class and give it as an argument to CallbackHandler. We don\u2019t have to change fit function anymore.", "I hope this article demonstrated what callbacks are and how to use them in (neural network) training. They require some changes in current fit function but offer a lot of flexibility later during training. We could inject a lot of functionality into our model without touching source code.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb0b006df7626&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ristohinno.medium.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": ""}, {"url": "https://ristohinno.medium.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Risto Hinno"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8732aeabcdf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&user=Risto+Hinno&userId=e8732aeabcdf&source=post_page-e8732aeabcdf----b0b006df7626---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/aVOACNd1cc0", "anchor_text": "Source"}, {"url": "https://en.wikipedia.org/wiki/Callback_(computer_programming)", "anchor_text": "Wikipedia"}, {"url": "https://en.wikipedia.org/wiki/Executable_code", "anchor_text": "executable code"}, {"url": "https://github.com/RRisto/callbacks", "anchor_text": "here"}, {"url": "https://github.com/RRisto/callbacks/blob/master/without_callbacks.py", "anchor_text": "here"}, {"url": "https://github.com/RRisto/callbacks/blob/master/with_callbacks.py", "anchor_text": "here"}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/fit.py", "anchor_text": "here"}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/learner.py", "anchor_text": "class"}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/callback.py", "anchor_text": "source"}, {"url": "https://github.com/RRisto/callbacks/blob/master/src/callback.py", "anchor_text": "here"}, {"url": "https://github.com/RRisto/callbacks/blob/master/with_callbacks.py", "anchor_text": "here"}, {"url": "https://en.wikipedia.org/wiki/Callback_%28computer_programming%29", "anchor_text": "Callback (computer programming)en.wikipedia.org"}, {"url": "https://pouannes.github.io/blog/callbacks-fastai/", "anchor_text": "Understanding callbacks in fastaifastai is a great library for Deep Learning with many powerful features, which make it very easy to quickly build state\u2026pouannes.github.io"}, {"url": "https://medium.com/@edwardeasling/implementing-callbacks-in-fast-ai-1c23de25b6eb", "anchor_text": "Implementing callbacks in fast.aiWhen I first encountered callbacks in fast.ai, I was a bit intimidated. They seemed quite confusing, and they looked\u2026medium.com"}, {"url": "https://github.com/fastai/fastbook/blob/master/19_learner.ipynb", "anchor_text": "fastai/fastbookPermalink GitHub is home to over 50 million developers working together to host and review code, manage projects, and\u2026github.com"}, {"url": "https://medium.com/tag/fastai?source=post_page-----b0b006df7626---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----b0b006df7626---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/callback?source=post_page-----b0b006df7626---------------callback-----------------", "anchor_text": "Callback"}, {"url": "https://medium.com/tag/dynamic-programming?source=post_page-----b0b006df7626---------------dynamic_programming-----------------", "anchor_text": "Dynamic Programming"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----b0b006df7626---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&user=Risto+Hinno&userId=e8732aeabcdf&source=-----b0b006df7626---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&user=Risto+Hinno&userId=e8732aeabcdf&source=-----b0b006df7626---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb0b006df7626&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b0b006df7626---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b0b006df7626--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b0b006df7626--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b0b006df7626--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b0b006df7626--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b0b006df7626--------------------------------", "anchor_text": ""}, {"url": "https://ristohinno.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ristohinno.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Risto Hinno"}, {"url": "https://ristohinno.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "106 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8732aeabcdf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&user=Risto+Hinno&userId=e8732aeabcdf&source=post_page-e8732aeabcdf--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7d3a828cade4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcallbacks-in-neural-networks-b0b006df7626&newsletterV3=e8732aeabcdf&newsletterV3Id=7d3a828cade4&user=Risto+Hinno&userId=e8732aeabcdf&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}