{"url": "https://towardsdatascience.com/emergency-vs-non-emergency-vehicle-classification-f0153c4f87f8", "time": 1683009161.222326, "path": "towardsdatascience.com/emergency-vs-non-emergency-vehicle-classification-f0153c4f87f8/", "webpage": {"metadata": {"title": "Emergency vs Non-Emergency Vehicle Classification | by Venus Rohilla | Towards Data Science", "h1": "Emergency vs Non-Emergency Vehicle Classification", "description": "Fatalities due to traffic delays of emergency vehicles such as ambulance & fire brigade is a huge problem. In daily life, we often see that emergency vehicles face difficulty in passing through\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block api", "paragraph_index": 8}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet", "paragraph_index": 18}, {"url": "https://arxiv.org/abs/1506.01186", "anchor_text": "Cyclical Learning Rates for Training Neural Networks", "paragraph_index": 34}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "do check out this blog", "paragraph_index": 41}], "all_paragraphs": ["Fatalities due to traffic delays of emergency vehicles such as ambulance & fire brigade is a huge problem. In daily life, we often see that emergency vehicles face difficulty in passing through traffic. So differentiating a vehicle into an emergency and non emergency category can be an important component in traffic monitoring as well as self drive car systems as reaching on time to their destination is critical for these services.", "In order to find a solution to this problem we would try building a Image classification model that would classify vehicle images as either belonging to the emergency vehicle or non-emergency vehicle category.", "The first thing we need to do is to get train and test data set of vehicle images. Here the data set used to build the classification model is downloaded from Analytics vidhya , it consists of emergency and non emergency vehicle images where emergency vehicles usually includes police cars, ambulance and fire brigades .", "After this is done we can read in the provided training data set using pandas.", "We would be using the fastai vision library for building our image classification model.", "We have two columns. The image_names column which contains the names of the images and the emergency_or_not column which contains the labels for each image.Here 1 represents label for emergency vehicles and 0 for non emergency vehicles.", "This quick look at the data frame provides us with enough information to load in the data and start building our image classification model but before we will do that we will apply transformations to the images that would help us in generalizing our model , that is to gain a high accuracy.", "The transformations we would be applying are : do_flip \u2014 enabled by default \u2014 and flip_vert,max_rotate=50.We will also play around with the lighting by tuning the max_lighting=0.1 and max_warp=0.", "Now that we have our transforms ready to be applied we can load in the data using FastAIs data block api.", "The .normalize(imagenet_stats) method above is used to normalize the data set based on the stats of the RGB channels from the ImageNet data set.", "What normalization does is that it brings down the intensities of images (original intensity of images is between 0 and 255) between 0 and 1 .This helps increase the computation power of our model .", "Now that we\u2019ve loaded our data set, let us have a peek into what it looks like:", "We can also check this by calling a function that tells us about the number of image classes.", "Since we have our data ready so its time to feed it into a model .We can do this by building a convolution neural network from scratch but doing this would be practically inefficient . So, we take the weights of a pre trained CNN model that has learnt to recognize features(certain kind of things e.g gradient, edges circles e.t.c)", "Here we would be using a pre-trained ResNet50 Convolution Neural Net model, and use transfer learning to learn weights of only the last layer of the network.", "Transfer learning is when you begin with an existing (trained) neural network used for image recognition \u2014 and then tweak it a bit (or more) here and there to train a model for your particular use case, we do this because training a neural network form scratch would mean needing approximately 300,000 image samples, and to achieve really good performance, we\u2019re going to need at least a million images. But with transfer learning we can achieve high performance with limited data set and in much less time .", "We would be fine tuning it by keeping some layers frozen and unfreezing some of them and training over it. This is because the top layers learn simple basic features and we need not to train those layers , while the later layers learn more sophisticated features .", "In the above picture each different layer learns different features of the images .The latter layers of this convolution neural networks learns features like eyes of birds e.t.c .", "We use the cnn_learner function for loading a pre-trained ResNet50 network, that was trained on around a million images from the ImageNet database.", "Let us now fit one cycle of 4 epochs to see how our model performs on this data set:", "The reason for using just 4 epochs is to get an idea of how our model performs and later fine tuning it for better results. As we can see our validation loss is greater then our training loss this clearly indicates that our model is suffering from the problem of under fitting.", "Let\u2019s have a look at our model\u2019s predictions :", "Looking at the top losses we can tell our model makes the same mistake as a human can make when looking at some cars for the first time that seemed to be emergency vehicles but interpreted as non emergency vehicles.", "Another useful tool, kind of, is to use something called a confusion matrix which basically shows you for every actual type of emergency and non emergency vehicle prediction , how many times was it predicted to be that .", "17 times our model predicted emergency vehicles as non emergency vehicles , while 4 times it predicted non emergency vehicles as emergency vehicles. Confused uh? after all we are dealing with a confusion matrix!", "A frozen layer is a layer that is not trained i.e it is not updated.", "So far anything we have done has not changed the pre-trained model weights .All we have done is we added some new layers on top and learned how to mix and match pre-trained features.", "But we want the model to learn features specific to our images .In order to do so we would unfreeze some of the layer to update the weights of the entire network according to our images .", "Layer one which detects edge and gradient and layer two which detects curves and corners don\u2019t need much learning, they don\u2019t need to change much. while the much later layers need to change. This is universally true when training for other image recognition.", "The earlier layers have more general-purpose features. Therefore we would expect them to need less fine-tuning for new datasets. For this reason we will use different learning rates for different layers: the first few layers will be at 1e-4 for basic geometric features and layers closest to the pixels,and 1e-2 as before for the layers we add on top (fully connected layers). We refer to this as differential learning rates.", "We would again run a fit-one-cycle on our unfreeze network and see how it goes now.", "The most important hyper-parameter for tuning our model is learning rate.It helps us in finding the optimal solution by adjusting the weights of our network with respect the loss gradient.The lower the value, the slower we travel along the downward slope. While this might be a good idea (using a low learning rate) in terms of making sure that we do not miss any local minima, it could also mean that we\u2019ll be taking a long time to converge \u2014 especially if we get stuck on a plateau region.", "Here we can see the various effects of learning rate on convergence.", "Hence Picking the right learning rate is important, rather than giving it a random guess or multiple trial-and-errors.", "To do this we would be using a function called lr_find().This function is an implementation of Leslie Smith\u2019s paper( Cyclical Learning Rates for Training Neural Networks.) on tuning neural network hyper-parameters.", "To understand it better we would plot it with help of another function.", "The learning rate is plotted against the losses.With the help of this graph we can pick our learning rate very easily.", "As we can see the loss start increasing after 1e-03 so we would pick a number before that also for updating weights of initial layers we would be choosing a lower learning rate .1e-04 seems good.", "With the chosen learning rate we will again train our unfreeze model but this time a bit longer with 10 epochs.", "We would use accuracy as another parameter often called metric to evaluate how our model is doing .", "Before going further let us also get an intuition about fit_one_cycle method.", "In this method we do a cycle with two steps of equal lengths, one going from a lower learning rate to a higher one than go back to the minimum.The maximum should be the value picked with the Learning Rate Finder, and the lower one can be ten times lower. -to read a bit more about fit_one_cycle ,do check out this blog .", "Now Lets see how our model is doing?", "Our model is doing good enough ,there is no under-fitting as our model had this problem earlier and no over-fitting also (Over fitting would mean that the training loss is much lower than the validation loss), as our validation loss is just approximately 0.02 times greater then training loss.", "Since we have updated our model\u2019s weights according to our vehicle classifying problem we will freeze the layers of our model and save it with a name car_classification.", "We were able to reach an accuracy of approximately 97% , while we can experiment more with our model in terms of increasing number of epochs , finding more optimal learning rates using plot function, more data augmentation techniques, etc.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff0153c4f87f8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@venusrohilla1?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@venusrohilla1?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Venus Rohilla"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff3257700cada&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&user=Venus+Rohilla&userId=f3257700cada&source=post_page-f3257700cada----f0153c4f87f8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@willy_teee?utm_source=medium&utm_medium=referral", "anchor_text": "Will Truettner"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block api"}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet"}, {"url": "http://cs231n.github.io/neural-networks-3/", "anchor_text": "cs231n"}, {"url": "https://arxiv.org/abs/1506.01186", "anchor_text": "Cyclical Learning Rates for Training Neural Networks"}, {"url": "https://developers.google.com/", "anchor_text": "https://developers.google.com/"}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "do check out this blog"}, {"url": "https://arxiv.org/pdf/1803.09820.pdf", "anchor_text": "https://arxiv.org/pdf/1803.09820.pdf"}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "https://sgugger.github.io/the-1cycle-policy.html"}, {"url": "https://arxiv.org/pdf/1506.01186.pdf", "anchor_text": "https://arxiv.org/pdf/1506.01186.pdf"}, {"url": "https://github.com/fastai/fastai/blob/master/courses/dl1/lesson1.ipynb", "anchor_text": "Lesson 1 Notebook, fast.ai Part 1 V2"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----f0153c4f87f8---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----f0153c4f87f8---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----f0153c4f87f8---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----f0153c4f87f8---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f0153c4f87f8---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&user=Venus+Rohilla&userId=f3257700cada&source=-----f0153c4f87f8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&user=Venus+Rohilla&userId=f3257700cada&source=-----f0153c4f87f8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff0153c4f87f8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f0153c4f87f8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f0153c4f87f8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@venusrohilla1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@venusrohilla1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Venus Rohilla"}, {"url": "https://medium.com/@venusrohilla1/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff3257700cada&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&user=Venus+Rohilla&userId=f3257700cada&source=post_page-f3257700cada--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Ff3257700cada%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femergency-vs-non-emergency-vehicle-classification-f0153c4f87f8&user=Venus+Rohilla&userId=f3257700cada&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}