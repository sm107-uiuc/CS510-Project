{"url": "https://towardsdatascience.com/coloring-photos-with-a-generative-adversarial-network-a435c4403b5d", "time": 1683003067.068081, "path": "towardsdatascience.com/coloring-photos-with-a-generative-adversarial-network-a435c4403b5d/", "webpage": {"metadata": {"title": "Coloring Photos with a Generative Adversarial Network | by Justin Tennenbaum | Towards Data Science", "h1": "Coloring Photos with a Generative Adversarial Network", "description": "Ever since I started learning about data science and machine learning, there has always been one algorithm that continually grabbed my attention: Generative Adversarial Networks (GANs). So much so\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@jmtennenbaum/generative-adversarial-networks-what-they-are-and-what-they-can-create-26ab92cf507e", "anchor_text": "second blog", "paragraph_index": 0}, {"url": "https://arxiv.org/abs/1703.10593", "anchor_text": "Cycle-GAN\u2019s", "paragraph_index": 1}, {"url": "https://www.imdb.com/title/tt7905466/", "anchor_text": "Peter Jackson\u2019s They Shall Not Grow Old", "paragraph_index": 2}, {"url": "https://medium.com/@jmtennenbaum/generative-adversarial-networks-what-they-are-and-what-they-can-create-26ab92cf507e", "anchor_text": "my first blog", "paragraph_index": 3}, {"url": "https://github.com/jmt0221/ColorGan", "anchor_text": "Github", "paragraph_index": 6}, {"url": "https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md", "anchor_text": "animation", "paragraph_index": 12}], "all_paragraphs": ["Ever since I started learning about data science and machine learning, there has always been one algorithm that continually grabbed my attention: Generative Adversarial Networks (GANs). So much so that the second blog I ever wrote covered, in detail, how these models work and what they can create. When I first learned about them, most of the articles (including my own) only covered how they are able to take in a vector of random noise and produce life-like photos.", "Shortly after I wrote that blog article I came across Cycle-GAN\u2019s (Zhu et al.) which allows image to image translation. This means we are able to pass in an image as the input and receive an altered copy of it as output. This includes mapping an artist\u2019s styles such as Van Gogh, changing a photo from looking like summer to winter or transforming a zebra to look like a horse.", "After I wrote the aforementioned blog post, I felt as if I was comfortable enough with GANs, how they work and their variations that I decided to build my own. However, with so many applications to choose from I struggled to decide on what I wanted to create. One night, while I was still considering different options, I watched Peter Jackson\u2019s They Shall Not Grow Old, a WWI documentary that was created through image reconstruction and recolorization. This, combined with my knowledge of transfer learning, inspired me to create a model that can convert black and white photos to color.", "(For those not familiar with Generative Adversarial Networks I suggest reading my first blog before continuing)", "Before I could start coding or planning my model\u2019s architecture I needed to find a dataset to work with. I learned that when it comes to image translation, GANs are much more efficient in understanding texture and symmetry in photos than they are at identifying complex geometry. This means, for example, they are able to create photos of landscapes much easier than they can a person or dog. This prompted me to collect 2 different datasets:", "I started with the MIT dataset for my first attempt since these images are easier to model, allowing me to focus on creating my first architecture and all the necessary preprocessing before working with the much larger MPII dataset. Once I acquired all of my data I could finally begin coding.", "Here is the Github for reference.", "Since GANs are extremely computationally intensive, it\u2019s important to limit the size of the images; I chose the size of 256x256 images. The MIT coastal photos were already this size so nothing needed to be done with the pictures from that dataset. On the other hand, the MPII dataset images were of varying sizes larger than 256x256 and thus needed to be resized, which is easily done using Numpy.", "My first idea was to take every image and simply convert it to grayscale and pass that into the generator to create a fully colored image using the standard RGB (red green blue) color channels with their normal values of 0\u2013255. I quickly realized this method was very inefficient and that in order to transform my images I needed to use a few different methods instead of one simple solution.", "During my research, I carefully examined researchers\u2019 examples who attempted to color photos from black and white, and noticed a pattern among them; many transformed the images from RGB color values to LAB color values. Unlike RGB, which merges red, blue and green color values to create the color image, LAB consists of a light sensitivity channel and two color channels. The L channel contains information for the light sensitivity of a photo and is equivalent to a black and white version. A and B are the color channels where A controls the green-red tradeoff and B controls the blue-yellow tradeoff. Python\u2019s Scikit-Image library comes with a great method that allows us to easily convert out RGB photos to LAB.", "Instead of trying to create all three color channels, my initial method, I now decided to pass the L channel through the Generator as the input, and output the new A and B color channels. Lastly, once I converted the images to LAB I need to normalize, since their pixel values are a very inefficient range for my model to work with. I decided to scale the pixel values from -1 to 1 so that I could easily replicate it with a tanh activation.", "To create the models I used Keras, a deep learning library for Python. First, I created the generator and discriminator separately; then I connect the two so the generator can learn based on how well it fools the other model.", "The generator can be broken down into two pieces: the encoder and decoder. The original image, in my case the L channel, is downsized through convolutional layers until the desired feature map size is achieved. This group of feature maps before I upsize the image again is known as the latent space representation of the image. From here, I perform what are known as transpose convolutions or deconvolutions which allow me to upsample my image size; the animation link here displays an excellent example that shows how this works. I repeat this process until I am back at the original size, and then output the new image, the A and B channels.", "My generator\u2019s encoder consists of four convolutional layers with a stride of two so that I can downsize the image. I start with 64 feature maps and double the number of maps at each layer so that by the time I reach the latent space representation, i.e. the middle of the network, I have a maximum of 512 maps, each with a size of 16x16. The outputs of each layer then goes through batch normalization and then finally a leaky ReLU activation. The decoder is almost a reverse copy, as it has four deconvolutional layers whose output goes through batch normalization and ReLU activations. The very last layer is a one-stride convolution with two output channels, A and B color channels, with a tanh activation to match the -1 to 1 scale we set earlier when preprocessing our images.", "The discriminator is a much simpler model than its counterpart, the generator, because it\u2019s a standard Convolutional Neural Network (CNN) that is used to predict whether the AB channels are real or fake. It has four 2-stride convolutional layers each which consists of dropout, leaky relu activation, and, except for the first layer, batch normalization. Like every other CNN, I then flatten the last layer and put it through a sigmoid to predict whether the image is real or fake.", "Both models are going to be using binary cross entropy for its loss function and the Adam optimizer. Contrary to everything I read, I needed to use a higher learning rate for the generator to keep it from being overpowered. First, the discriminator is initialized and then I create and link the generator\u2019s loss to the discriminator\u2019s output.", "After completing the processes explained above, I was ready to train the model, or so I believed. As I ran the model on my laptop, I received the message \u201cKernel Died\u201d. The memory and computational requirements were way too intensive for my laptop. It can also take multiple days to train a GAN on a CPU, and that showed me two things: I needed a strong computer/instance and a GPU. For this, I went to AWS SageMaker and rented a GPU instance which provided me with more than enough power.", "The last tweak I made was limiting my epoch size to be only 320 and instead of training for a few hundred epochs I trained for a few thousand. I trained the discriminator on a half epoch of real images followed by a half epoch of fake. Finally, the generator produces a full epoch\u2019s worth of images which are passed to the discriminator, and the generator is penalized if the images are marked as fake. GANs are hard to train because, unlike most other deep learning algorithms, it doesn\u2019t look to minimize or maximize any loss function. Instead, I look for an equilibrium, or saddle point, where the two networks stay competitive and continue to build off each other. As you can see from the graph of the losses below, it is a very sporadic training cycle.", "It can take many attempts to get the model stable but once you do it\u2019s important to be patient, as it can take anywhere from 6\u201312 hours in a GPU instance to get the model trained. The two things that helped keep me in control of the long training times and vague metrics were printing images frequently and saving the model about half as often. In order to view the photo simply scale back to original pixel values and convert to RGB.", "As you can see from the images above, the model will sometimes have a bias for certain color hues, and the last image, in particular, tends to lean towards greens and reds as well as some color bleeding.", "This project is most definitely still a work in progress and my next is step is to build out a self-attention layer to help the model better understand the geometry in photos. Once I get the new model built, my goal is to train it on the Imagenet dataset so it can generalize to more photos and create a web application to allow anyone to instantly color their pictures.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist at Flatiron passionate about Math and Technology"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa435c4403b5d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jmtennenbaum?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jmtennenbaum?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Justin Tennenbaum"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6d54f7f47f17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&user=Justin+Tennenbaum&userId=6d54f7f47f17&source=post_page-6d54f7f47f17----a435c4403b5d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@jmtennenbaum/generative-adversarial-networks-what-they-are-and-what-they-can-create-26ab92cf507e", "anchor_text": "second blog"}, {"url": "https://arxiv.org/abs/1703.10593", "anchor_text": "Cycle-GAN\u2019s"}, {"url": "https://junyanz.github.io/CycleGAN/", "anchor_text": "Jun-Yan Zhu"}, {"url": "https://www.imdb.com/title/tt7905466/", "anchor_text": "Peter Jackson\u2019s They Shall Not Grow Old"}, {"url": "https://medium.com/@jmtennenbaum/generative-adversarial-networks-what-they-are-and-what-they-can-create-26ab92cf507e", "anchor_text": "my first blog"}, {"url": "https://github.com/jmt0221/ColorGan", "anchor_text": "Github"}, {"url": "https://github.com/vdumoulin/conv_arithmetic/blob/master/README.md", "anchor_text": "animation"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a435c4403b5d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a435c4403b5d---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a435c4403b5d---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/generative-adversarial?source=post_page-----a435c4403b5d---------------generative_adversarial-----------------", "anchor_text": "Generative Adversarial"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&user=Justin+Tennenbaum&userId=6d54f7f47f17&source=-----a435c4403b5d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&user=Justin+Tennenbaum&userId=6d54f7f47f17&source=-----a435c4403b5d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa435c4403b5d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a435c4403b5d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a435c4403b5d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a435c4403b5d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a435c4403b5d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jmtennenbaum?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jmtennenbaum?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Justin Tennenbaum"}, {"url": "https://medium.com/@jmtennenbaum/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "142 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6d54f7f47f17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&user=Justin+Tennenbaum&userId=6d54f7f47f17&source=post_page-6d54f7f47f17--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F14d81184f4ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcoloring-photos-with-a-generative-adversarial-network-a435c4403b5d&newsletterV3=6d54f7f47f17&newsletterV3Id=14d81184f4ed&user=Justin+Tennenbaum&userId=6d54f7f47f17&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}