{"url": "https://towardsdatascience.com/how-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0", "time": 1683012491.6694138, "path": "towardsdatascience.com/how-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0/", "webpage": {"metadata": {"title": "How we built an inexpensive, scalable architecture to cartoonize the world! | by Niraj Pandkar | Towards Data Science", "h1": "How we built an inexpensive, scalable architecture to cartoonize the world!", "description": "A lot of people were interested in the architecture behind Cartoonizer. So Tejas and I (Niraj) have tried explaining the process we employed to make it work. Kudos to Algorithmia for powering our\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cartoonize-lkqov62dia-de.a.run.app/", "anchor_text": "Cartoonizer", "paragraph_index": 0}, {"url": "https://tjdevworks.github.io/", "anchor_text": "Tejas", "paragraph_index": 0}, {"url": "https://nirajpandkar.github.io/about/", "anchor_text": "Niraj", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/why-we-built-a-platform-for-machine-learning-engineering-not-data-science-54004d5b6e95", "anchor_text": "Caleb Kaiser", "paragraph_index": 2}, {"url": "https://www.reddit.com/r/MachineLearning/comments/hyqmi9/p_cartoonize_your_world/", "anchor_text": "Reddit post", "paragraph_index": 7}, {"url": "https://thenextweb.com/neural/2020/07/28/this-ai-will-turn-your-ugly-face-into-a-cute-cartoon/", "anchor_text": "TheNextWeb article", "paragraph_index": 7}, {"url": "https://stackoverflow.com/a/56317974", "anchor_text": "GPU support", "paragraph_index": 19}, {"url": "https://github.com/experience-ml/cartoonize", "anchor_text": "Github", "paragraph_index": 26}, {"url": "https://cartoonize-lkqov62dia-de.a.run.app/", "anchor_text": "here", "paragraph_index": 26}, {"url": "https://nirajpandkar.github.io", "anchor_text": "https://nirajpandkar.github.io", "paragraph_index": 28}], "all_paragraphs": ["A lot of people were interested in the architecture behind Cartoonizer. So Tejas and I (Niraj) have tried explaining the process we employed to make it work. Kudos to Algorithmia for powering our video inference pipeline. \ud83d\ude07", "In today\u2019s fast paced world, ML experts are expected to put on multiple hats in the ML workflow. One of the critical tasks in the workflow is to serve the models in production! This seemingly important piece in the pipeline tends to get overlooked thus faltering to provide value to the customers.", "The engineering discipline clearly can\u2019t exist without the work of the (data) scientists \u2014 MLE (Machine Learning Engineering) is built on the work of data science \u2014 but the engineering is how the the science gets applied to the world.- Caleb Kaiser", "This article is going to explain our attempt to not only serve a computationally intensive GAN model in production inexpensively but also scale it horizontally.", "If you are familiar with hosting a REST API, it warrants these basic things -", "As an ML engineer, the 2nd point is tedious and less than satisfactory in terms of scalability and server costs. Gone are those days when the responsibility of maintaining servers rests on your shoulders! I am talking about outsourcing and automating the 2nd point completely. Enter Google Cloud Run!", "Before I go into how the architecture works, I would like to indulge you in some user statistics and give you a feel of the traffic we could cater to with minimal costs!", "Since we launched our demo web-app on 26th July, we have had around 12,000 users in less than 3 weeks! 6,000 of those coming in the first 4 days \u2014 most of the traffic coming from our Reddit post and TheNextWeb article which was then picked up by other blogs from various countries as well.", "At any given point during this peak time, we had around 50+ users requesting our image and video services.", "Out of the box, Cloud Run lets us spawn 1000 instances based on incoming traffic. It defaults to a max of 80 requests per container instance. So ideally we can cater to 80,000 requests/second!", "BUT since the cartoonization process was already heavy, we limited our program to 8 workers per instance. That means one instance was limited to 8 concurrent requests. The 9th request will be routed to a second instance if at all. So essentially we can cater to 8000 requests/sec!", "Our unique selling point was putting together an architecture which would allow us to serve videos along with images at minimal cost. Videos are nothing but a collection of images (frames) and we have to cartoonize each frame.", "On a 8-core i7 CPU, it takes around 1 second to cartoonize a 1080p resolution image. Unfortunately, Google Cloud Run provides only a maximum of 2 vCPUs which brings up the time to 3 seconds/image! You can imagine the horror of processing a video on that kind of compute! A 10 second video at 30 frames per second (fps) would take 15 minutes! \ud83d\ude31", "We employed 2 techinques to bring down the video inference time.", "We experimented with tensorflow lite for weight quantization to speed up inference pipeline, but we faced issues with serving models for dynamic input image sizes. While it worked for a fixed image size, we didn\u2019t find the results to latency and computation tradeoff justified.", "Even by downplaying resolution and reducing frames per second, video cartoonization was taking 2.5 minutes for a 10 second video. It was still too high considering user experience. And hence, converting a video into a cartoon required some additional artillery.", "Using a GPU gave a 10x increase in speed for an image. Inference time came down to 50 ms/image. That meant we could cartoonize and serve a 10 second video in 7 seconds! Now we are in business.\ud83d\ude09", "Or so we thought. There were 2 questions that haunted us -", "One way would have been to deploy the model on a Google Compute Engine instance as an API but that defeated the purpose of Cloud Run scaling. All the concurrent requests would queue up and GPU would become a bottleneck in our pipeline. Also, running an instance 24/7 is not cheap \ud83d\udcb0", "Cloud Run being a managed stateless container service cannot afford to provide GPU support. Hence, we outsourced our GPU computation to a service called Algorithmia instead of renting out an expensive Google Compute Engine server. The reason is two-folds -", "This meant we could satisfy around 1500+ video requests concurrently AND comparatively inexpensively!", "Our Flask API was coded to handle 8 concurrent requests by spawning 8 workers using Gunicorn BUT we didn\u2019t change the default setting of 80 requests per instance in Cloud Run.", "This meant only one instance was spawned the whole time and perhaps user requests queued up on our Flask server. The downside being user had to wait longer to get their cartoonized images and videos \u2639\ufe0f", "The upside being we were billed for only one instance. Lower the number of requests per instance, greater the number of instances spawned thus increasing your billable instance time. But rerouting requests to separate instances means better and faster user satisfaction. \ud83d\ude09", "We envision this being used for the following \u2014", "If you have something interesting to demo, hit us up!", "Code for the webapp demo is available on Github! Try the demo here!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data in. Wisdom out. My writing outlet \u2014 https://nirajpandkar.github.io"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8610050f90a0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8610050f90a0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@Niraj_pandkar?source=post_page-----8610050f90a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Niraj_pandkar?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Niraj Pandkar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd40076791deb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&user=Niraj+Pandkar&userId=d40076791deb&source=post_page-d40076791deb----8610050f90a0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://cartoonize-lkqov62dia-de.a.run.app/", "anchor_text": "Cartoonizer"}, {"url": "https://tjdevworks.github.io/", "anchor_text": "Tejas"}, {"url": "https://nirajpandkar.github.io/about/", "anchor_text": "Niraj"}, {"url": "https://unsplash.com/@miinyuii?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\"", "anchor_text": "Duy Pham"}, {"url": "https://unsplash.com/s/photos/friends?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/why-we-built-a-platform-for-machine-learning-engineering-not-data-science-54004d5b6e95", "anchor_text": "Caleb Kaiser"}, {"url": "https://www.reddit.com/r/MachineLearning/comments/hyqmi9/p_cartoonize_your_world/", "anchor_text": "Reddit post"}, {"url": "https://thenextweb.com/neural/2020/07/28/this-ai-will-turn-your-ugly-face-into-a-cute-cartoon/", "anchor_text": "TheNextWeb article"}, {"url": "https://stackoverflow.com/a/56317974", "anchor_text": "GPU support"}, {"url": "https://algorithmia.com/blog/deploying-machine-learning-at-scale", "anchor_text": "scale deployed Deep Learning models"}, {"url": "https://github.com/experience-ml/cartoonize", "anchor_text": "Github"}, {"url": "https://cartoonize-lkqov62dia-de.a.run.app/", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8610050f90a0---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----8610050f90a0---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/engineering?source=post_page-----8610050f90a0---------------engineering-----------------", "anchor_text": "Engineering"}, {"url": "https://medium.com/tag/google-cloud-run?source=post_page-----8610050f90a0---------------google_cloud_run-----------------", "anchor_text": "Google Cloud Run"}, {"url": "https://medium.com/tag/algorithmia?source=post_page-----8610050f90a0---------------algorithmia-----------------", "anchor_text": "Algorithmia"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&user=Niraj+Pandkar&userId=d40076791deb&source=-----8610050f90a0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&user=Niraj+Pandkar&userId=d40076791deb&source=-----8610050f90a0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8610050f90a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8610050f90a0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8610050f90a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8610050f90a0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8610050f90a0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8610050f90a0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8610050f90a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Niraj_pandkar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Niraj_pandkar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Niraj Pandkar"}, {"url": "https://medium.com/@Niraj_pandkar/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "20 Followers"}, {"url": "https://nirajpandkar.github.io", "anchor_text": "https://nirajpandkar.github.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd40076791deb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&user=Niraj+Pandkar&userId=d40076791deb&source=post_page-d40076791deb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fd40076791deb%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-we-built-an-inexpensive-scalable-architecture-to-cartoonize-the-world-8610050f90a0&user=Niraj+Pandkar&userId=d40076791deb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}