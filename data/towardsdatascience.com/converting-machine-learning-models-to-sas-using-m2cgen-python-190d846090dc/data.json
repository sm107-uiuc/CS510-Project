{"url": "https://towardsdatascience.com/converting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc", "time": 1683018420.79755, "path": "towardsdatascience.com/converting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc/", "webpage": {"metadata": {"title": "Converting Machine Learning Models to SAS using m2cgen (Python) | by Carrie Lo | Towards Data Science", "h1": "Converting Machine Learning Models to SAS using m2cgen (Python)", "description": "m2cgen is a very friendly package that can convert a lot of different trained models to supported languages like R and VBA. However, SAS is not yet supported by m2cgen. This article is for those who\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/BayesWitnesses/m2cgen#supported-languages", "anchor_text": "supported languages", "paragraph_index": 0}, {"url": "https://github.com/cydalytics/xgboost_to_sas/blob/main/README.md", "anchor_text": "my Github repo", "paragraph_index": 1}, {"url": "https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html", "anchor_text": "The Iris Dataset", "paragraph_index": 3}, {"url": "https://stackoverflow.com/questions/37617390/xgboost-handling-of-missing-values-for-split-candidate-search", "anchor_text": "reference", "paragraph_index": 16}, {"url": "https://github.com/cydalytics/xgboost_to_sas/blob/main/Demo2%20-%20Convert%20XGBoost%20model%20to%20VBA%2C%20then%20to%20SAS%20scripts%20(with%20missing%20values).ipynb", "anchor_text": "my GitHub repo", "paragraph_index": 22}, {"url": "https://github.com/BayesWitnesses/m2cgen", "anchor_text": "official Github repository", "paragraph_index": 24}, {"url": "https://blog.cyda.hk/", "anchor_text": "https://blog.cyda.hk/", "paragraph_index": 26}], "all_paragraphs": ["m2cgen is a very friendly package that can convert a lot of different trained models to supported languages like R and VBA. However, SAS is not yet supported by m2cgen. This article is for those who needs to deploy the trained models in SAS environment. The track introduced in this article is to convert the model to VBA codes first and change the VBA codes to SAS scripts.", "The scripts used in this tutorial are uploaded to my Github repo, feel free to clone the files.", "m2cgen(Model 2 Code Generator) \u2014 is a lightweight library which provides an easy way to transpile trained statistical models into a native code (Python, C, Java, Go, JavaScript, Visual Basic, C#, PowerShell, R, PHP, Dart, Haskell, Ruby, F#).", "The Iris Dataset loaded from sklearn", "Task 1: Convert XGBoost model to VBA", "First of all, we import the packages and data needed for this task.", "Then, let\u2019s train a simple XGBoost model.", "Next, convert XGBoost model to VBA. Using the function, export_to_visual_basic of m2cgen can get your trained XGBoost model in VBA language. The scripts to convert to other languages are also as simple as the one to VBA.", "Here comes the core of this tutorial, after converting the model to VBA, there are some steps needed to convert the VBA codes to SAS scripts such as removing many unnecessary lines that are not used in SAS environment such as \u201cModule xxx\u201d, \u201cFunction yyy\u201d and \u201cDim var Z As Double\u201d, and inserting \u201c;\u201d to the end of statements to follow the syntax rules in SAS.", "The first three parts are quite straight-forward. We simply take away the unwanted lines with the use of regex, then change the beginning of the scripts to \u201cDATA pred_result;\\nSET dataset_name;\u201d where pred_result refers to the output table name after running the SAS scripts and dataset_name refers to the input table name that we need to predict. The last part is to change the ending of the script to \u201cRUN;\u201d.", "To follow the syntax rules in SAS, \u201c;\u201d is needed to indicate the end of each statement.", "Making use of dictonary, we can map the \u201cInputVector\u201d with the variable names in the input dataset and change all the \u201cInputVector\u201d in one go.", "The last part of the conversion steps is to change the prediction labels.", "Lastly, we can save the output with suffix, \u201c.sas\u201d", "That\u2019s the end of the first task, and now, you should be able to convert your trained models to SAS scripts. To double check if there are any issues with the SAS scripts created, you can use the below scripts for checking the difference of python prediction and SAS prediction. Please note that the predicted probabilities (python vs SAS) show a little difference, but the difference should not be very significant.", "Task 2: Convert XGBoost model to VBA, then to SAS scripts (with missing values)", "If your data does not have missing values in training data, XGBoost by default puts the \u201cmissing values\u201d on the left node when generating the tree (as illustrated in the tree diagram below) (reference). From the scripts generated from the m2cgen, you can find the conditions tested are always be if a variable is greater than or equal to a given number. Thus if there is missing value in the testing or prediction dataset, the script will leave the \u201cmissing value\u201d to the else part. For example, in our SAS script generated from task 1, the first test condition is \u201c If (petal_length) >= (2.45) Then var0 = -0.21827246; Else var0 = 0.42043796;\u201d, so if petal_length is missing, it is not greater than or equal to 2.45, the var0 will be assigned as 0.42043796. Another example is shown below.", "What if your training data contains missing values? XGBoost will put the \u201cmissing values\u201d to the left or right node based on the training results. (Thus, you can see the conditions shown in the SAS scripts are sometimes \u201c<\u201d and sometimes \u201c>=\u201d)", "You can create the dataset with missing values using the below scripts and repeat the steps in task 1 to see and compare the prediction output of SAS and python.", "I did the testing and found that some rows have the same prediction output while some rows show big differences (see the below picture).", "I compare the var generated in the intermediate steps in the SAS scripts. Let\u2019s take the second row shown below as an example. If the condition tested is \u201cIf (petal_length) >= (2.45) Then var0 = -0.217358515; Else \u2026\u201d and the petal_length is missing, so it does not fulfill the condition and go to the else statement, then the second condition tested is \u201cIf (petal_width) >= (0.84999996) Then var0 = -0.155172437; Else \u2026\u201d and the petal_width is 0.2, again, it does not fulfill the condition and go to the else statement. Next, we go to the third condition, \u201cIf (sepal_length) < (11.600001) Then var0 = 0.411428601; Else \u2026\u201d and we see that sepal_length is missing, it should not fulfill the condition but SAS somehow accept it as True and the var0 is 0.411428601.", "Therefore, to cater for this scenario, I added some scripts to force the script to check if the value is missing or not first.", "Therefore, the manual scripts to convert VBA to SAS will change to the below scripts. You can find the full version in my GitHub repo.", "In this tutorial, I made use of the m2cgen package to convert a XGBoost model to VBA codes and then SAS scripts, but it is not necessary to convert to VBA codes first, you can pick other languages like C or JAVA if you prefer. This tutorial just demonstrated a hack to convert the scripts from one language to another language.", "To know more about using m2cgen, please go to the official Github repository.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Hong Kong | Data Scientist | Hackathon Enthusiast | Entrepreneur | Public Speaker | https://blog.cyda.hk/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F190d846090dc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----190d846090dc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@carrie_cyda?source=post_page-----190d846090dc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carrie_cyda?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Carrie Lo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2780ee205e68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&user=Carrie+Lo&userId=2780ee205e68&source=post_page-2780ee205e68----190d846090dc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/BayesWitnesses/m2cgen#supported-languages", "anchor_text": "supported languages"}, {"url": "https://github.com/cydalytics/xgboost_to_sas/blob/main/README.md", "anchor_text": "my Github repo"}, {"url": "https://unsplash.com/@chrislawton?utm_source=medium&utm_medium=referral", "anchor_text": "Chris Lawton"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html", "anchor_text": "The Iris Dataset"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://stackoverflow.com/questions/37617390/xgboost-handling-of-missing-values-for-split-candidate-search", "anchor_text": "reference"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://cydalytics.blogspot.com/", "anchor_text": "cyda"}, {"url": "https://github.com/cydalytics/xgboost_to_sas/blob/main/Demo2%20-%20Convert%20XGBoost%20model%20to%20VBA%2C%20then%20to%20SAS%20scripts%20(with%20missing%20values).ipynb", "anchor_text": "my GitHub repo"}, {"url": "https://github.com/BayesWitnesses/m2cgen", "anchor_text": "official Github repository"}, {"url": "https://medium.com/tag/education?source=post_page-----190d846090dc---------------education-----------------", "anchor_text": "Education"}, {"url": "https://medium.com/tag/python?source=post_page-----190d846090dc---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----190d846090dc---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----190d846090dc---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/women-in-tech?source=post_page-----190d846090dc---------------women_in_tech-----------------", "anchor_text": "Women In Tech"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&user=Carrie+Lo&userId=2780ee205e68&source=-----190d846090dc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&user=Carrie+Lo&userId=2780ee205e68&source=-----190d846090dc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----190d846090dc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F190d846090dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----190d846090dc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----190d846090dc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----190d846090dc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----190d846090dc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----190d846090dc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----190d846090dc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carrie_cyda?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carrie_cyda?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Carrie Lo"}, {"url": "https://medium.com/@carrie_cyda/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "172 Followers"}, {"url": "https://blog.cyda.hk/", "anchor_text": "https://blog.cyda.hk/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2780ee205e68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&user=Carrie+Lo&userId=2780ee205e68&source=post_page-2780ee205e68--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F273e5c3aabcd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fconverting-machine-learning-models-to-sas-using-m2cgen-python-190d846090dc&newsletterV3=2780ee205e68&newsletterV3Id=273e5c3aabcd&user=Carrie+Lo&userId=2780ee205e68&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}