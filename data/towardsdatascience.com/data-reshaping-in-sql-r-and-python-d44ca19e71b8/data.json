{"url": "https://towardsdatascience.com/data-reshaping-in-sql-r-and-python-d44ca19e71b8", "time": 1683008153.048287, "path": "towardsdatascience.com/data-reshaping-in-sql-r-and-python-d44ca19e71b8/", "webpage": {"metadata": {"title": "Data Reshaping in SQL, R and Python | by Kat Li | Towards Data Science", "h1": "Data Reshaping in SQL, R and Python", "description": "Think of this scenario: you just finished a SQL query producing the summary statistics for the stakeholders, and let\u2019s take the following table as an example returned from your query, This is a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/BuzzFeedNews/nics-firearm-background-checks", "anchor_text": "linked here", "paragraph_index": 1}, {"url": "http://sqlfiddle.com/#!18/14047/2", "anchor_text": "SQL fiddle playground here", "paragraph_index": 3}, {"url": "https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot?view=sql-server-ver15", "anchor_text": "it merges (possible) multiple rows into one single row in the output", "paragraph_index": 5}, {"url": "http://sqlfiddle.com/#!9/36e0e5/1", "anchor_text": "SQL fiddle playground", "paragraph_index": 7}, {"url": "https://tidyr.tidyverse.org/reference/pivot_wider.html", "anchor_text": "here", "paragraph_index": 10}, {"url": "https://github.com/YiLi225/Data_Reshaping", "anchor_text": "my Github", "paragraph_index": 11}, {"url": "https://rdrr.io/github/tidyverse/tidyr/man/pivot_wider.html", "anchor_text": "names_prefix", "paragraph_index": 12}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html", "anchor_text": "eplace missing values with 0", "paragraph_index": 14}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html", "anchor_text": "reset_index", "paragraph_index": 14}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html", "anchor_text": "an optional argument aggfunc", "paragraph_index": 14}, {"url": "http://sqlfiddle.com/#!18/45c51/5", "anchor_text": "here", "paragraph_index": 15}, {"url": "https://github.com/YiLi225/Data_Reshaping", "anchor_text": "Github repo", "paragraph_index": 16}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link", "paragraph_index": 22}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link", "paragraph_index": 27}, {"url": "https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw", "anchor_text": "\u201cData Talk with Kat\u201d", "paragraph_index": 28}], "all_paragraphs": ["Think of this scenario: you just finished a SQL query producing the summary statistics for the stakeholders, and let\u2019s take the following table as an example returned from your query,", "This is a longitudinal data that tracks the number of firearm permit checks by month and state. The raw data is publicly accessible, and more background is linked here. So your project is a time-series analysis on the changes in firearm permits, both longitudinally across time and horizontally across states. It is not difficult to realize that this analysis requires transforming the data so that either the month or the state variable being placed on columns, as displayed below,", "This data reshaping process is referred to as Pivoting (i.e., long/stack to wide/spread), and its reverse is Unpivoting (i.e., wide/spread to long/stack). Converting data from one format to another is one of the most common data manipulation steps in analytics projects. Hence, in this blog, we will explore how to efficiently transform our data from long to wide (and vice versa), and we will do so using SQL, R, and Python.", "Let\u2019s start with the PIVOT() function, which is available in the Oracle 11g and MS server 2017. I have also coded it up in the SQL fiddle playground here for easy access,", "In this query, the permit column is specified as values to spread, and the month column as the labels of the new pivoted table. Other columns (i.e., the state column in our toy data) is treated as the GROUP BY variable implicitly. The return is exactly what we desired,", "Here, you must have noticed the aggregation function SUM() in our query. This function cannot be eliminated because pivoting is an aggression operation in the sense that it merges (possible) multiple rows into one single row in the output.", "In our case, however, since there is only one row for each state in each month, the SUM() doesn\u2019t do anything, and thus can be replaced by other agg. functions (e.g., AVG()). On the contrary, if we have multiple rows (for each state in each month) to aggregate, these functions would come in handy by avoiding additional sub-queries.", "Now, moving onto other SQL databases, e.g., MySQL or PostgreSQL, where the PIVOT operator is NOT available, and the following shows the query (SQL fiddle playground),", "Like the PIVOT operator, an aggregation function is specified, but this query can easily get lengthy as the number of months increases. Let\u2019s say we have 100, instead of 4, months of records, we would have to type in 100 columns labels manually! This certainly isn\u2019t the optimal solution.", "A data frame in R is essentially a matrix, hence the well-understood idea of matrix transposing is applicable. There are numerous R functions tackling this task, and my favorite two are the reshape(direction = 'wide') and pivot_wider() in the packages {stats} and {tidyr}, respectively.", "Note, the pivot_wider() is the updated function of spread(), which is no longer under active development (see here for more details).", "Now, the following code shows how pivoting is achieved with a couple of lines in R, using the pivot_wider(). If you are also interested in the reshape() version, I have it linked here in my Github,", "Here: [1] we set the names_from argument to be the variable spreading over the columns (i.e., the month variable); [2] another useful optional argument is names_prefix, which specifies the word(s) to prefix to each column name (e.g., month_2020\u201301\u201331).", "Similarly, Python also has a function in pandas aptly named pivot_table(),", "Here: [1] we replace missing values with 0 to convert the permit column to integers (as opposed to the default float64); [2] columns of the output table are set as type string to avoid the labels being converted to datetime (e.g., 2020\u201301\u201331 00:00:00) after reset_index; [3] this function has an optional argument aggfunc that can be used to aggregate multiple rows (e.g., \u2018sum\u2019, \u2018count\u2019).", "Now let\u2019s assume we would like to reverse our wide data back to the raw long data structure. In SQL, the query would be almost identical as pivoting, except that we substitute the function pivot() with unpivot() , and the SQL fiddle is linked here,", "For this demonstration, we will again focus on the pivot_longer() from the {tidyr}, and its equivalent reshape(direction = 'long') version is available in my Github repo. Similar to the pivot_wider() situation, the pivot_longer() is an update on the original gather() function, which is no longer under development.", "Here\u2019s how we would transform our data from wide back to long,", "In this code, the cols argument takes in the columns to stack into longer format, i.e., the month variables in our data. This line colnames(wide_dat)[-1] will exclude the first variable state. Here\u2019s the output, which matches our raw data format,", "One call-out is that unpivoting would NOT produce the original table values if multiple rows have been aggregated.", "Being available in pandas also, the function melt() performs wide to long transformation,", "Like the R output, the return from this code matches exactly our raw data.", "Want more data science and programming tips? Use my link to sign up to Medium and gain full access to all my content.", "As we just learned, SQL, as a query language, can become cumbersome and verbose when it is used for data reshaping. Unlike SQL tables, data frames in R and Python are matrix by nature, where rows and columns are interchangeable; thus are more suitable for tasks like data transforming.", "As to R vs. Python, my experience is that usually one task can be accomplished in more than one way using different packages in R, whereas Python is developed in a way that only one functionality is available whenever possible. While some data scientists appreciate this flexibility in R, others may find it ambiguous and confusing.", "Additionally, Python is considered a slightly lower-level language than R, and it has more strict data type requirements. For instance, a pandas.Series isn\u2019t the same as a numpy.array, and thus they don\u2019t share attributes or methods. Nevertheless, in R, no such a distinction exists, where the equivalent concept is just a vector or matrix. This feature makes statistical/scientific analysis more analyst-friendly than in Python.", "After all, R and Python are designed to serve a somewhat different purpose. I hope that the cognizance of these distinctions can make you more efficient at choosing the optimal language to solve your specific problems. \ud83d\ude00", "Want more data science and programming tips? Use my link to sign up to Medium and gain full access to all my content.", "Also subscribe to my newly created YouTube channel \u201cData Talk with Kat\u201d,", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd44ca19e71b8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yilistats.medium.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Kat Li"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7657f76e72be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&user=Kat+Li&userId=7657f76e72be&source=post_page-7657f76e72be----d44ca19e71b8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/BuzzFeedNews/nics-firearm-background-checks", "anchor_text": "linked here"}, {"url": "https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw", "anchor_text": "\u201cData Talks with Kat\u201d"}, {"url": "http://sqlfiddle.com/#!18/14047/2", "anchor_text": "SQL fiddle playground here"}, {"url": "https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot?view=sql-server-ver15", "anchor_text": "it merges (possible) multiple rows into one single row in the output"}, {"url": "http://sqlfiddle.com/#!9/36e0e5/1", "anchor_text": "SQL fiddle playground"}, {"url": "https://tidyr.tidyverse.org/reference/pivot_wider.html", "anchor_text": "here"}, {"url": "https://github.com/YiLi225/Data_Reshaping", "anchor_text": "my Github"}, {"url": "https://rdrr.io/github/tidyverse/tidyr/man/pivot_wider.html", "anchor_text": "names_prefix"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html", "anchor_text": "eplace missing values with 0"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html", "anchor_text": "reset_index"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html", "anchor_text": "an optional argument aggfunc"}, {"url": "http://sqlfiddle.com/#!18/45c51/5", "anchor_text": "here"}, {"url": "https://github.com/YiLi225/Data_Reshaping", "anchor_text": "Github repo"}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link"}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link"}, {"url": "https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw", "anchor_text": "\u201cData Talk with Kat\u201d"}, {"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "6 SQL Tricks Every Data Scientist Should KnowSQL tricks to make your analytics work more efficienttowardsdatascience.com"}, {"url": "https://levelup.gitconnected.com/4-simple-ways-to-import-word-and-pdf-files-into-python-when-pandas-fails-43cf81599461", "anchor_text": "4 Simple Ways to Import Word and PDF Files into Python when Pandas FailsA practical guide to import unstructured text/images datalevelup.gitconnected.com"}, {"url": "https://medium.com/tag/data-transformation?source=post_page-----d44ca19e71b8---------------data_transformation-----------------", "anchor_text": "Data Transformation"}, {"url": "https://medium.com/tag/sql?source=post_page-----d44ca19e71b8---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/programming?source=post_page-----d44ca19e71b8---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----d44ca19e71b8---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/r?source=post_page-----d44ca19e71b8---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&user=Kat+Li&userId=7657f76e72be&source=-----d44ca19e71b8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&user=Kat+Li&userId=7657f76e72be&source=-----d44ca19e71b8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd44ca19e71b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d44ca19e71b8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d44ca19e71b8--------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kat Li"}, {"url": "https://yilistats.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.5K Followers"}, {"url": "https://www.youtube.com/@DataTalksWithKat", "anchor_text": "https://www.youtube.com/@DataTalksWithKat"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7657f76e72be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&user=Kat+Li&userId=7657f76e72be&source=post_page-7657f76e72be--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F37afe5b5308f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-reshaping-in-sql-r-and-python-d44ca19e71b8&newsletterV3=7657f76e72be&newsletterV3Id=37afe5b5308f&user=Kat+Li&userId=7657f76e72be&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}