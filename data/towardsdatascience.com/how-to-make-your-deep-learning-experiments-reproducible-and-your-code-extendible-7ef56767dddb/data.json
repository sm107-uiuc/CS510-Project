{"url": "https://towardsdatascience.com/how-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb", "time": 1683014379.940774, "path": "towardsdatascience.com/how-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb/", "webpage": {"metadata": {"title": "Improving your deep learning code quality (Part I) | by Isaac Godfried | Towards Data Science", "h1": "Improving your deep learning code quality (Part I)", "description": "Note this is roughly based on a presentation I made back in February at the Boston Data Science Meetup Group. You can find the full slide deck here. I have also included some more recent experiences\u2026"}, "outgoing_paragraph_urls": [{"url": "https://tps://www.youtube.com/watch?v=Z_ubURcsRGc", "anchor_text": "presentation I made back in February at the Boston Data Science Meetup Group", "paragraph_index": 0}, {"url": "https://docs.google.com/presentation/d/1ZlQM80OsfGVRoY9GGQBfwqMRq5tj2aJfQe1Rm5pflrU/edit", "anchor_text": "full slide deck here", "paragraph_index": 0}, {"url": "https://github.com/AIStream-Peelout/flow-forecast", "anchor_text": "to develop flow forecast which is now a multi-purpose deep learning for time series framework", "paragraph_index": 1}, {"url": "https://medium.com/r?url=https%3A%2F%2Fdocs.google.com%2Fpresentation%2Fd%2F1yHLPvPhUs2KGI5ZWo0sU-PKU3GimAk3iTsI38Z-B5Gw%2Fedit", "anchor_text": "For a good overview of why reproducibility is important see Joel Grus\u2019s talk and slide deck", "paragraph_index": 2}, {"url": "https://github.com/AIStream-Peelout/flow-forecast/blob/master/tests/custom_encode.json", "anchor_text": "the configuration files I use for my", "paragraph_index": 14}, {"url": "https://flow-forecast.atlassian.net/wiki/spaces/FF/pages/17760257/A+Dual-Stage+Attention-Based+Recurrent+Neural+Network", "anchor_text": "Confluence", "paragraph_index": 18}, {"url": "https://flow-forecast.readthedocs.io/en/latest/?badge=latest", "anchor_text": "ReadTheDocs", "paragraph_index": 18}, {"url": "https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwiTpovX9ITsAhXFg3IEHdBNCwkQwqsBMAB6BAgNEAU&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D7jiPeIFXb6U&usg=AOvVaw0ch3qY7ngWfThJF0tp_J5e", "anchor_text": "Joel Grus Why I hate Notebooks", "paragraph_index": 24}], "all_paragraphs": ["Note this is roughly based on a presentation I made back in February at the Boston Data Science Meetup Group. You can find the full slide deck here. I have also included some more recent experiences and insights as well as answers to common questions that I have encountered.", "When I first started my river forecasting research, I envisioned using just a notebook. However, it became clear to me that effectively tracking experiments and optimizing hyper-parameters would play a crucial role in the success of any river flow model; particularly, as I wanted to forecast river flows for over 9,000+ rivers around the United States. This led me on the track to develop flow forecast which is now a multi-purpose deep learning for time series framework.", "One of the biggest challenges in machine learning (particularly deep learning) is being able to reproduce experiment results. Several others have touched on this issue, so I will not spend too much time discussing it in detail. For a good overview of why reproducibility is important see Joel Grus\u2019s talk and slide deck. The TLDR: is that in order to build upon prior research we need to make sure that it worked in the first place. Similarly, to deploy models we have to be able to easily find the artifacts of the best \u201cone.\u201d", "One of my first recommendations to enable reproducible experiments is NOT to use Jupyter Notebooks or Colab (at least not in their entirety). Jupyter Notebooks and Colab are great for rapidly prototyping a model or leveraging an existing code-base (as I will discuss in a second) to run experiments, but not for building out your models or other features.", "I have found test driven development very effective in the machine learning space. One of the first things people ask me is how do I write tests for a model that I don\u2019t what its outputs will be? Fundamentally your unit tests should fall into one of the four categories:", "(a) Test that your model\u2019s returned representations are the proper size.", "(b) Test that your models initialize properly for the parameters you specify and that the right parameters are trainable", "Another relatively simple unit test is make sure that model initializes in the way you expect it to and the proper parameters are trainable.", "(c ) Test the logic of custom loss functions and training loops:", "People often ask me how to do this? I\u2019ve found the best way is to create a dummy model with a known result to test the correctness of custom loss functions, metrics, and training loops. For instance you could create a PyTorch model that only returns 0. Then use that to write a unit test that checks if the loss and the training loop are correct.", "(d) Test the logic of data pre-processing/loaders", "Another major thing to cover is to make sure your data loaders are outputting data in the format you expect and handling problematic values. Problems with data quality are a huge issue with machine learning so it is important to make sure your data loaders are properly tested. For instance, you should write tests to check NaN/Null values are filled or the rows are dropped.", "Finally, I recommend using tools CodeCov and Codefactor. They are useful for automatically determining you code test coverage.", "2. Utilize integration tests for end-to-end code coverage", "Having unit tests is good, but it is also important to make sure your code runs properly in an end-to-end fashion. For instance, sometimes I\u2019ve found a single model\u2019s unit tests run, only to find out the way I was passing the configuration file to the model didn\u2019t work. As a result I now add integration tests for every new model I add to the repository. The integration tests can also demonstrate how to use your models. For instance, the configuration files I use for my integration tests I often leverage as the backbone of my full parameter sweeps.", "3. Utilize both type hints and document strings:", "Having both type hints and document strings greatly increases readability; particularly when you are passing around tensors. When I\u2019m coding I frequently have to look back at the doc-strings to remember what shape my tensors are. Without them I have to manually print the shape. which wastes a lot of time and potentially adds garbage that you later forget to remove.", "I\u2019ve found the best time to create documentation for machine learning projects is while I\u2019m writing code or even before. Often laying out the architectural design of ML models and how they will interface with existing classes saves me considerable time when implementing the code as well as forces me to think critically about the ML decisions I make. Additionally, once the implementation is complete you already have good start on informing your peers/researchers on how to use your model.", "Of course you will need to add some things like specifics of what parameters you pass and their types. For documentation, I generally record broader architectural decisions in Confluence (or GH Wiki pages if unavailable) whereas specifics about the code/parameters I include in ReadTheDocs. As we will talk about in Part II. having good initial documentation also makes it pretty simple to add model results and explain why your design works.", "Peer review is another critical step in making sure your code is correct before you run your experiments. Often times, a second pair of eyes can help you avoid all sorts of problems. This is another good reason not to use Jupyter Notebooks as reviewing notebook diffs is almost impossible.", "As a peer reviewer it is also important to take time to go through the code line by line and comment where you don\u2019t understand something. I often see reviewers just quickly approve all changes.", "A recent example: While adding meta-data for DA-RNN, I encountered a bug. This section of code did have an integration test but unfortunately it lacked a comprehensive unit test. As a result several of the experiments that I ran and that I thought used meta-data turned out did not. The problem was very simple; on line 23 I forget to include meta-data while calling the encoder.", "This problem likely could have been averted by writing a unit tests to check that the parameters of the meta-data model wereupdated on the forward pass or by having a test to check that the result with and without the meta-data were not equal.", "In Part II of this series I will talk about how to actually make your experiments reproducible now that you have high quality and (mostly) bug free code. Specifically, I will look at things like data versioning, logging experiment results, and tracking parameters. So", "Joel Grus Why I hate Notebooks", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist, ex-Data Engineer, Maintainer of Flow Forecast"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7ef56767dddb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://igodfried.medium.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": ""}, {"url": "https://igodfried.medium.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Isaac Godfried"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bebc59e793b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&user=Isaac+Godfried&userId=5bebc59e793b&source=post_page-5bebc59e793b----7ef56767dddb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://tps://www.youtube.com/watch?v=Z_ubURcsRGc", "anchor_text": "presentation I made back in February at the Boston Data Science Meetup Group"}, {"url": "https://docs.google.com/presentation/d/1ZlQM80OsfGVRoY9GGQBfwqMRq5tj2aJfQe1Rm5pflrU/edit", "anchor_text": "full slide deck here"}, {"url": "https://github.com/AIStream-Peelout/flow-forecast", "anchor_text": "to develop flow forecast which is now a multi-purpose deep learning for time series framework"}, {"url": "https://medium.com/r?url=https%3A%2F%2Fdocs.google.com%2Fpresentation%2Fd%2F1yHLPvPhUs2KGI5ZWo0sU-PKU3GimAk3iTsI38Z-B5Gw%2Fedit", "anchor_text": "For a good overview of why reproducibility is important see Joel Grus\u2019s talk and slide deck"}, {"url": "https://travis-ci.org/", "anchor_text": "Travis-CI"}, {"url": "https://codecov.io/", "anchor_text": "CodeCov"}, {"url": "https://github.com/AIStream-Peelout/flow-forecast/blob/master/tests/custom_encode.json", "anchor_text": "the configuration files I use for my"}, {"url": "https://flow-forecast.atlassian.net/wiki/spaces/FF/pages/17760257/A+Dual-Stage+Attention-Based+Recurrent+Neural+Network", "anchor_text": "Confluence"}, {"url": "https://flow-forecast.readthedocs.io/en/latest/?badge=latest", "anchor_text": "ReadTheDocs"}, {"url": "https://readthedocs.org/", "anchor_text": "ReadTheDocs"}, {"url": "https://www.atlassian.com/software/confluence", "anchor_text": "Confluence"}, {"url": "https://medium.com/@keeper6928/how-to-unit-test-machine-learning-code-57cf6fd81765", "anchor_text": "Unit testing machine learning code"}, {"url": "https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwiTpovX9ITsAhXFg3IEHdBNCwkQwqsBMAB6BAgNEAU&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D7jiPeIFXb6U&usg=AOvVaw0ch3qY7ngWfThJF0tp_J5e", "anchor_text": "Joel Grus Why I hate Notebooks"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----7ef56767dddb---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/time-series-forecasting?source=post_page-----7ef56767dddb---------------time_series_forecasting-----------------", "anchor_text": "Time Series Forecasting"}, {"url": "https://medium.com/tag/reproducibility?source=post_page-----7ef56767dddb---------------reproducibility-----------------", "anchor_text": "Reproducibility"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7ef56767dddb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----7ef56767dddb---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&user=Isaac+Godfried&userId=5bebc59e793b&source=-----7ef56767dddb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&user=Isaac+Godfried&userId=5bebc59e793b&source=-----7ef56767dddb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7ef56767dddb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7ef56767dddb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7ef56767dddb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7ef56767dddb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7ef56767dddb--------------------------------", "anchor_text": ""}, {"url": "https://igodfried.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://igodfried.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Isaac Godfried"}, {"url": "https://igodfried.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bebc59e793b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&user=Isaac+Godfried&userId=5bebc59e793b&source=post_page-5bebc59e793b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc5f7444d643&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-deep-learning-experiments-reproducible-and-your-code-extendible-7ef56767dddb&newsletterV3=5bebc59e793b&newsletterV3Id=c5f7444d643&user=Isaac+Godfried&userId=5bebc59e793b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}