{"url": "https://towardsdatascience.com/plotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629", "time": 1683004003.311948, "path": "towardsdatascience.com/plotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629/", "webpage": {"metadata": {"title": "Plotnine plot deconstruction: visualizing the Billboard Hot 100 using a rank plot | by Paul Hiemstra | Towards Data Science", "h1": "Plotnine plot deconstruction: visualizing the Billboard Hot 100 using a rank plot", "description": "As far as I am concerned, ggplot2 is the best plotting package out there. So when I found out there was an implementation of the Grammar of Graphics for Python, plotnine, I jumped at the opportunity\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/tagged/plot-deconstruction-paul", "anchor_text": "a series of articles", "paragraph_index": 0}, {"url": "https://ggplot2.tidyverse.org/", "anchor_text": "ggplot2", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/a-comprehensive-guide-to-the-grammar-of-graphics-for-effective-visualization-of-multi-dimensional-1f92b4ed4149", "anchor_text": "Grammar of Graphics", "paragraph_index": 1}, {"url": "https://plotnine.readthedocs.io/en/stable/", "anchor_text": "plotnine", "paragraph_index": 1}, {"url": "https://seaborn.pydata.org/", "anchor_text": "Seaborn", "paragraph_index": 2}, {"url": "https://matplotlib.org/", "anchor_text": "matplotlib", "paragraph_index": 2}, {"url": "https://www.datascienceworkshops.com/blog/plotnine-grammar-of-graphics-for-python/", "anchor_text": "This article", "paragraph_index": 3}, {"url": "http://virginian.mdodd.com/string_diag.html", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://stats.stackexchange.com/a/178344/7419", "anchor_text": "here", "paragraph_index": 5}, {"url": "https://gist.github.com/PaulHiemstra/2130dd9d8a5a297e6eef6cb9eadac212", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://data.world/kcmillersean/billboard-hot-100-1958-2017", "anchor_text": "dataset of the Billboard top 100", "paragraph_index": 7}, {"url": "https://github.com/Phlya/adjustText", "anchor_text": "adjustText", "paragraph_index": 18}, {"url": "https://github.com/Phlya/adjustText", "anchor_text": "package", "paragraph_index": 18}], "all_paragraphs": ["This is part of a series of articles I wrote on making beatiful plots in Python.", "As far as I am concerned, ggplot2 is the best plotting package out there. So when I found out there was an implementation of the Grammar of Graphics for Python, plotnine, I jumped at the opportunity. ggplot2 buffs should have no problem in transitioning to plotnine, the syntax is very similar.", "The strength of the Grammar of Graphics is a consistent way of reasoning about plots. This consistency makes it easy to express plot ideas into code. In comparison to Seaborn and especially matplotlib, plotnine is much easier to work with. It does, however, take a bit of time to get used to plotnine\u2019s syntax and way of thinking, especially when venturing outside the standard scatterplots and barcharts.", "The goal of this article is not to provide a plotnine tutorial, but to explore more advanced plotnine concepts. This article does provide a nice introduction if you need one. These are the topics I will discuss in this article:", "The core of this article is the following plot:", "The plot shows how the chart position of a song (y-axis) varies in the Billboard Hot 100 throughout 2015 (x-axis). One colored line presents the trajectory of a song, the title of the song is given by a text label. The red arrow helps in identifying which title belongs to which line. The best way to read the plot is to pick a specific song and follow the colored line to explore how its trajectory evolves throughout the year. I got the idea for this plot from a textbook on making plots, although I forgot which one. Online I could find similar plots here and here.", "In the rest of the article, I will break down how this plot is built, and what choices I made and why I made them. I assume that you are familiar with the syntax basics of either ggplot2 or plotnine, Python and Pandas. The full Python notebook can be found here.", "To generate the plot, I used the following dataset of the Billboard top 100:", "Each row in the dataset is the chart position of a song in a particular week. All the rows related to a particular song represent the trajectory of that song. The important columns for our plot are:", "The following code takes this data, performs some preprocessing and produces the plot:", "In the first part of the code (lines 4\u201310) I preprocess the data for the plot. Here I make two important choices:", "By removing less important songs from the data we reduce clutter and make it easier for ourselves to focus on the best songs of 2015.", "To discard these rare songs, I first calculate how often a song occurs in the data:", "this is done using a combination of groupby and count, both Pandas functions. After calculating the counts, I select the songs that occur more than 4 times (line 2) and subset the Hot 100 data using those songs.", "In our plot, titles of a song are shown only once and not for every point in the dataset as is the default of geom_text. To achieve this effect, we need to use a separate data source for geom_text.", "I chose the highest chart position a song got to place the song title. I constructed the data using the following code:", "In the custom function, highest_rank, I select the index of the minimum value in Week Position. Note that the minimum value is the highest rank. Next, I select the Week ID and Week Position of the highest rank and return them. Note that we cannot simply use groupby and min (plot_data.groupby([\u2018Song\u2019]).min()), we need both Week ID and Week Position belonging to the highest chart position to plot the text label at the correct location. Finally, we apply the function to the data for each song. Now we have the data, we only have to change the data source for the geom_text to only print the labels once per song.", "Using different data sources per geom layer is a powerful trick. For example, in this way you can also plot some geoms in just a subset of all the facets in a plot by only providing data that references those facets.", "By reducing the font size of the text labels and limiting the number of labels, we already get rid of a lot of the potential overlap in text labels. But there is still potential for this to happen. To fully combat this overlap I use the adjust_text argument of geom_text. This uses the adjustText package to smartly calculate the position of labels. The following code sets some parameters and passes it to geom_text:", "expand_text controls how far the labels can be moved in the x and y direction, and arrowprops controls how the arrows look that will be drawn from the label to the point it belongs to.", "Up until now, we worked with just one year of data. To expand this to multiple years we can stack the plots using facet_wrap:", "the advantage of this approach over simply plotting multiple separate plots is that the colors across multiple years are guaranteed to stay the same. The plot above is generated using the following code:", "The changes that are required from the previous code are marked using comments. The changes are:", "I just love the way plotnine allows me to express my visualization ideas into code. It is especially nice that the expressiveness scales up to the most complex parts of plotnine. I hope you have learned a few new tricks!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Teacher and practitioner of data science."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8048808fd629&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8048808fd629--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@p.h.hiemstra?source=post_page-----8048808fd629--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@p.h.hiemstra?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Paul Hiemstra"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F256545883c97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&user=Paul+Hiemstra&userId=256545883c97&source=post_page-256545883c97----8048808fd629---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/plot-deconstruction-paul", "anchor_text": "a series of articles"}, {"url": "https://ggplot2.tidyverse.org/", "anchor_text": "ggplot2"}, {"url": "https://towardsdatascience.com/a-comprehensive-guide-to-the-grammar-of-graphics-for-effective-visualization-of-multi-dimensional-1f92b4ed4149", "anchor_text": "Grammar of Graphics"}, {"url": "https://plotnine.readthedocs.io/en/stable/", "anchor_text": "plotnine"}, {"url": "https://seaborn.pydata.org/", "anchor_text": "Seaborn"}, {"url": "https://matplotlib.org/", "anchor_text": "matplotlib"}, {"url": "https://www.datascienceworkshops.com/blog/plotnine-grammar-of-graphics-for-python/", "anchor_text": "This article"}, {"url": "http://virginian.mdodd.com/string_diag.html", "anchor_text": "here"}, {"url": "https://stats.stackexchange.com/a/178344/7419", "anchor_text": "here"}, {"url": "https://gist.github.com/PaulHiemstra/2130dd9d8a5a297e6eef6cb9eadac212", "anchor_text": "here"}, {"url": "https://data.world/kcmillersean/billboard-hot-100-1958-2017", "anchor_text": "dataset of the Billboard top 100"}, {"url": "https://github.com/Phlya/adjustText", "anchor_text": "adjustText"}, {"url": "https://github.com/Phlya/adjustText", "anchor_text": "package"}, {"url": "https://medium.com/tag/python?source=post_page-----8048808fd629---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pandas?source=post_page-----8048808fd629---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/ggplot2?source=post_page-----8048808fd629---------------ggplot2-----------------", "anchor_text": "Ggplot2"}, {"url": "https://medium.com/tag/plot-deconstruction-paul?source=post_page-----8048808fd629---------------plot_deconstruction_paul-----------------", "anchor_text": "Plot Deconstruction Paul"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&user=Paul+Hiemstra&userId=256545883c97&source=-----8048808fd629---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&user=Paul+Hiemstra&userId=256545883c97&source=-----8048808fd629---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8048808fd629--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8048808fd629&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8048808fd629---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8048808fd629--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8048808fd629--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8048808fd629--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8048808fd629--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8048808fd629--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@p.h.hiemstra?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@p.h.hiemstra?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Paul Hiemstra"}, {"url": "https://medium.com/@p.h.hiemstra/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "493 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F256545883c97&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&user=Paul+Hiemstra&userId=256545883c97&source=post_page-256545883c97--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F22dfc5b863a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fplotnine-plot-deconstruction-visualizing-the-billboard-hot-100-8048808fd629&newsletterV3=256545883c97&newsletterV3Id=22dfc5b863a2&user=Paul+Hiemstra&userId=256545883c97&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}