{"url": "https://towardsdatascience.com/compute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd", "time": 1683009769.449779, "path": "towardsdatascience.com/compute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd/", "webpage": {"metadata": {"title": "Compute the Incomputable | How SVI and ELBO work | by Richard Michael | Towards Data Science", "h1": "Compute the Incomputable | How SVI and ELBO work", "description": "When you want to gain more insights into your data you rely on programming frameworks that allow you to interact with probabilities. All you have in the beginning is a collection of data-points. It\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/probability", "anchor_text": "TensorFlow Probability", "paragraph_index": 0}, {"url": "https://pyro.ai/", "anchor_text": "Pyro", "paragraph_index": 0}, {"url": "https://mc-stan.org/", "anchor_text": "STAN", "paragraph_index": 0}, {"url": "https://leon.bottou.org/papers/bottou-mlss-2004", "anchor_text": "stochastic gradient descent", "paragraph_index": 7}, {"url": "https://pytorch.org/docs/stable/optim.html", "anchor_text": "Adam optimizer", "paragraph_index": 11}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/PyTorch_BayesRegr.ipynb", "anchor_text": "github for the specifics", "paragraph_index": 13}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/PyTorch_BayesRegr.ipynb", "anchor_text": "regression-task", "paragraph_index": 14}, {"url": "https://pyro.ai/examples/svi_part_iii.html", "anchor_text": "5", "paragraph_index": 17}, {"url": "http://M.Sc", "anchor_text": "M.Sc", "paragraph_index": 19}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog", "paragraph_index": 19}], "all_paragraphs": ["When you want to gain more insights into your data you rely on programming frameworks that allow you to interact with probabilities. All you have in the beginning is a collection of data-points. It is just a glimpse into the underlying distribution from which your data comes. However, you not only want simple data-points in the end. What you want is elaborate, talkative density distributions with which you can perform tests. For this, you use probabilistic frameworks like TensorFlow Probability, Pyro or STAN to compute posteriors of probabilities.As we will see, the computation of this is not always feasible and we rely on Markov Chain Monte Carlo (MCMC) methods or Stochastic Variational Inference (SVI) to solve those problems. Especially over large data-sets or even every-day, medium-sized datasets we have to perform the magic of sampling and inference to compute values and fit models. If these methods would not exist we would be stuck with a neat model that we had thought up, but no way to know if it actually makes sense.We have built a forecasting model with Pyro, which uses exactly that \u2014 SVI:", "In this story, we will look at the computation from a Pyro point of view.In short, instead of brute-forcing the posterior, Pyro makes an estimate which we improve. But why can\u2019t we just compute the whole thing? I\u2019m glad you asked.", "Let's say we have a dataset D and we want to fit a model (\u03b8) that accurately describes our data. For that, we need a set of variables. These variables correspond to events that are random and we call them latent random variables e.g. z.Now to see how well our model does we rely on posterior probability distribution P. That is a good starting point, now how do I compute this P? In order for this to work, we have to do inference like this:", "The math-savvy reader already sees that the right part of the equation above is in general not computable. We face the terror of the almighty integral over something we don\u2019t know yet. Now with z as a continuous variable it might be infinite. That is quite big.What we can do instead is use a variational distribution; let's call it Q.In an ideal world, this approximate Q would be as close as possible to our P which we are trying to compute. So how do we get there?One thing that we need first is a measure of how similar P and Q are. Enter the Kullback Leibler Divergence \u2014 you can find the legendary paper by Kullback and Leibler in the Annals of Mathematical Statistics [1].Our tool to compare the distributions, the Kullback Leibler Divergence isdefined as :", "This measure tells us how similar the distributions P and Q are. If they are similar, the KL is low and if they are very different, the divergence is large.", "Now, this measure requires us to know both distributions P and Q. However we don\u2019t know P yet. After all, that is what we are computing and so far our Q is a wild guess.After some reformulation we end up with this (see [5] for a step-by-step solution):", "The first part (-E[log P(z,x)-log Q(z|x)]) is what is called the evidence lower bound or ELBO. The second part (log(P)) is a constant. That is much better for our later computations. All we have to do now is maximize the ELBO to get minimal divergence between our P and Q.", "Now that we have the basic theory laid out, what do we do about our Q?We can make an estimate of Q by using some form of neural network. We already have TensorFlow or PyTorch in the case of Pyro at our disposal. Compared to the model that we have built, we can now set up something that describes our variational distribution. As soon as we have this distribution estimate, we can use stochastic gradient descent to fit our model. So lets fire away.", "We use our data as input for model and guide. The model gives us P and the guide suggests a Q as an output from the network. If we have this as a Gaussian then the network gives us a mean \u03bc and standard deviation \u03c3. If we picture this process in a very simple form, rolling out over time it looks something like this:", "Let's take a simple example case in which we fit a model-function f given the latent random variable z . That variable comes from a \u03b2-distribution (just as an example). The events we are observing are happening Bernoulli-random. This means that the event either occurs or it doesn\u2019t. Lastly, the events are i.i.d. \u2014 that is independent and identically distributed which we write as the pyro.plate notation. So that our model is:", "So far this is standard Pyro and you don\u2019t always have to specify a guide. Pyro can take care of that but a guide will be there nonetheless. You can take full control of your modelling process, by specifying the guide. In this example the guide\u2019s latent z comes from this:", "Lastly we run our inference by using the SVI object. We provide the previously specified model and the specified guide. Also we rely on the standard PyTorch Adam optimizer for stochastic gradient descent.", "You\u2019re all set. Now let's look at some output.", "The above example was just dummy code and in order to get proper output I have used a simple Bayesian regression task and computed the posterior for the model-function (see my github for the specifics).We use both a Pyro SVI and also a Markov Chain Monte Carlo procedure with a NUTS sampler.", "So far everything sounded very promising \u2014 almost too good to be true. With everything in life you should always check your results. This example below (Fig. 2\u20133) shows the fitted posterior distribution of the previously mentioned regression-task using SVI and MCMC side by side.", "The good thing first: we have fitted a sufficient posterior both with SVI and with MCMC. The not-so-ideal part is that they are visibly different. The in-depth understanding of how and why Markov methods and Stochastic Inference differ is topic of various research and a deep-dive will be the topic for another article. The only thing that we can conclude at this point is that the inference routine has an evident impact on our final model.", "All in all SVI allows us to take any data-set and perform Bayesian Modeling with it. If you ask me, that is a pretty nice feature.", "The mentioned example simply serves as a rough overview of how a Pyro class can be set up. The functional code can be found in the Pyro documentation (see [5]).", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a Data Scientist and M.Sc. student in Bioinformatics at the University of Copenhagen. You can find more content on my weekly blog http://laplaceml.com/blog"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F505ce0868fdd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rcml.medium.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59----505ce0868fdd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/7cdFZmLlWOM", "anchor_text": "nsplash"}, {"url": "https://www.tensorflow.org/probability", "anchor_text": "TensorFlow Probability"}, {"url": "https://pyro.ai/", "anchor_text": "Pyro"}, {"url": "https://mc-stan.org/", "anchor_text": "STAN"}, {"url": "https://towardsdatascience.com/pyro-top-down-forecasting-application-case-4781eb2c8485", "anchor_text": "Pyro Top-Down Forecasting | Application-caseConnect the dots over time and forecast with confidence(-intervals).towardsdatascience.com"}, {"url": "https://leon.bottou.org/papers/bottou-mlss-2004", "anchor_text": "stochastic gradient descent"}, {"url": "https://pytorch.org/docs/stable/optim.html", "anchor_text": "Adam optimizer"}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/PyTorch_BayesRegr.ipynb", "anchor_text": "github for the specifics"}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/PyTorch_BayesRegr.ipynb", "anchor_text": "regression-task"}, {"url": "https://projecteuclid.org/euclid.aoms/1177729694", "anchor_text": "Annals of Mathematical Statistics"}, {"url": "https://arxiv.org/abs/1301.1299", "anchor_text": "arxiv"}, {"url": "https://pyro.ai/examples/svi_part_i.html", "anchor_text": "SVI tutorial I"}, {"url": "https://pyro.ai/examples/svi_part_ii.html", "anchor_text": "SVI tutorial II"}, {"url": "https://pyro.ai/examples/svi_part_iii.html", "anchor_text": "SVI tutorial III"}, {"url": "https://www.cs.ubc.ca/labs/lci/mlrg/slides/SVI.pdf", "anchor_text": "UBC"}, {"url": "http://www.cs.toronto.edu/~madras/presentations/svi-tutorial.pdf", "anchor_text": "Tutorial Stochastic Variational Inference"}, {"url": "https://pyro.ai/examples/svi_part_iii.html", "anchor_text": "5"}, {"url": "https://medium.com/tag/bayesian-inference?source=post_page-----505ce0868fdd---------------bayesian_inference-----------------", "anchor_text": "Bayesian Inference"}, {"url": "https://medium.com/tag/data-science?source=post_page-----505ce0868fdd---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bayesian-machine-learning?source=post_page-----505ce0868fdd---------------bayesian_machine_learning-----------------", "anchor_text": "Bayesian Machine Learning"}, {"url": "https://medium.com/tag/pyro?source=post_page-----505ce0868fdd---------------pyro-----------------", "anchor_text": "Pyro"}, {"url": "https://medium.com/tag/inference?source=post_page-----505ce0868fdd---------------inference-----------------", "anchor_text": "Inference"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&user=Richard+Michael&userId=7229c4f1db59&source=-----505ce0868fdd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&user=Richard+Michael&userId=7229c4f1db59&source=-----505ce0868fdd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F505ce0868fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----505ce0868fdd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----505ce0868fdd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----505ce0868fdd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----505ce0868fdd--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://rcml.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "72 Followers"}, {"url": "http://M.Sc", "anchor_text": "M.Sc"}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7c745d7317a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompute-the-incomputable-how-svi-and-elbo-work-505ce0868fdd&newsletterV3=7229c4f1db59&newsletterV3Id=7c745d7317a0&user=Richard+Michael&userId=7229c4f1db59&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}