{"url": "https://towardsdatascience.com/indexing-for-sql-query-optimization-139b57db9fc6", "time": 1683017143.191027, "path": "towardsdatascience.com/indexing-for-sql-query-optimization-139b57db9fc6/", "webpage": {"metadata": {"title": "How to use Indexing for SQL Query Optimization | Towards Data Science", "h1": "How to use Indexing for SQL Query Optimization", "description": "This article explains indexing for SQL query optimization in an interesting manner, with examples and illustrations. It's time to refine your querying skills."}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Query_plan", "anchor_text": "Query Plan", "paragraph_index": 18}, {"url": "https://www.sisense.com/glossary/relational-database/", "anchor_text": "relational database management system (RDBMS)", "paragraph_index": 18}, {"url": "https://en.wikipedia.org/wiki/Query_optimization", "anchor_text": "Query Optimizer", "paragraph_index": 19}, {"url": "https://en.wikipedia.org/wiki/Binary_search_algorithm", "anchor_text": "binary search", "paragraph_index": 33}, {"url": "https://www.linkedin.com/in/ashish-tomar-565b1654/", "anchor_text": "LinkedIn", "paragraph_index": 50}, {"url": "https://www.linkedin.com/in/ashish-tomar-565b1654/", "anchor_text": "https://www.linkedin.com/in/ashish-tomar-565b1654/", "paragraph_index": 52}], "all_paragraphs": ["I assume that you like SQL and want to refine your querying skills to up your querying game. And you have probably heard that indexing is great for query optimization, but you are not sure about what exactly it is, why is it used, and how to use it.", "Welcome! You are at the exact place where you should be. I\u2019ll explain it in a very easy-to-understand manner, and I promise you\u2019ll enjoy learning about it.", "Suppose you are in the e-Commerce Analytics team at Amazon. The data that you\u2019re dealing with is huge. It has millions of rows. I\u2019ll use the following hypothetical table called \u2018product\u2019 containing 12 million products for all the demonstrations. (Fun Fact: Amazon sells more than 12 million products, excluding books, media, wine, and services.)", "Let\u2019s begin with a simple query.", "Now to run this query, the database has to scan all 12 million rows to check each record for a match. Let\u2019s say this query takes 4 seconds to execute.", "Can you make it faster? Yes, you can.", "Let me explain the whole concept of indexing intuitively. It\u2019s named \u2018indexing\u2019 because of how an index works in a book. If you\u2019re reading a book on statistics and you want to read about \u2018linear regression\u2019, you\u2019ll not want to flip hundreds of pages one by one, to get to the chapter which talks about \u2018linear regression\u2019.", "Instead, you\u2019ll open the index page, look for \u2018linear regression\u2019 and go to the page directly.", "This is the technique that databases use via indexing. When you create an index, the database somehow rapidly finds the data that the query wants. I\u2019ll talk about this \u2018somehow\u2019 later in the article.", "Let\u2019s create an index on the \u2018product\u2019 table and include \u2018category\u2019 in the index.", "When you execute this query, it will take much longer than a normal query. The database scans 12 million rows and builds a \u2018category\u2019 index from scratch. Let\u2019s say this takes 4 minutes.", "Now, let\u2019s test the performance of the old query with indexing.", "You\u2019ll see that the query will be much faster this time. It\u2019ll probably only take 400 milliseconds this time.", "Even the queries which extend further than using \u2018category\u2019 as a condition will benefit from the indexing on \u2018category\u2019. Let\u2019s see an example.", "This query will take less time than what it would have normally taken, say 600 milliseconds for this query. The database can quickly find all \u2018electronics\u2019 products using the index. And from the smaller set of records, it finds headphones in a normal manner.", "Now, let\u2019s change the order of the conditions in the \u2018WHERE\u2019 clause.", "Even when the \u2018product_category\u2019 is mentioned before \u2018category\u2019, the database still picks the column which had an index, i.e. \u2018category\u2019, and then scans rows for finding the specified \u2018product_subcategory\u2019 from that subset of records.", "The database considers all possible paths to execute the query and then chooses the most optimal path.", "It\u2019s time for some database lingo now. Each of the possible paths is called a \u2018Query Plan\u2019. It is essentially a sequence of steps used to access data in a SQL relational database management system (RDBMS).", "And this feature of RDBMS that determines the most efficient way to execute a given query by considering all possible query plans is called \u2018Query Optimizer\u2019.", "An index can be made for more than one column.", "Here, we have an index on both \u2018category\u2019 and \u2018product_subcategory\u2019. The important thing to note here is that the order matters here. It\u2019s like sorting the data first by \u2018category\u2019 and then by \u2018product_subcategory\u2019.", "And the query gets even more fast by using this multi-column index. Let\u2019s say it comes down to 60 milliseconds.", "Moreover, a database can have more than one index.", "Indexes speed up the performance of a database. And as the database gets larger, indexes become even more useful.", "But there are two important things you should remember:", "Thus, it\u2019s good to use indexes on databases in data warehouses that get new data updated on a scheduled basis (off-peak hours) and not on production databases that would receive new updates all the time. This is because if the database is constantly receiving updates, then the indexes won\u2019t get updated and hence, will remain unusable.", "Let me touch upon the two types of database indexes briefly, to give you a comprehensive understanding of the topic:", "A clustered index is the unique index of the table that uses the primary key to organize the data within the table. A clustered index doesn\u2019t have to be explicitly declared but is created by default when the primary key is defined. The primary key sorted in ascending order is used as the clustered index, by default.", "Let me demonstrate this with an easy example.", "This table \u2018product\u2019 will have a clustered index \u2018product_pkey\u2019 automatically created, organized around the primary key \u2018product_id\u2019.", "Now, when you run a query to search the table by \u2018product_id\u2019 (like in the query below), the clustered index will help the database to perform optimal searches, and return the result faster.", "You must be wondering how exactly does it do that?", "Indexes use an optimal search method known as binary search.", "Binary search is an efficient algorithm for finding an entry from a sorted list of entries. It works by repeatedly dividing the data in half and checking if the entry you are searching for via your query comes before or after the entry in the middle of the data. If the value of your search entry is less than the entry in the middle, it narrows the search to the lower half, otherwise, it narrows the search to the upper half. It does this repeatedly until the value is found. This method decreases the number of searches required and thus, makes the execution of queries faster.", "The following table helps to understand the impact of binary search in terms of number of searches:", "Similarly, for our dataset with 12 million rows, only 24 searches at most are required instead of 12 million searches in the worst case scenario, if a binary search is employed. I think now you know the power of indexes.", "Now the question is how to extend this power of indexing to columns other than the primary key. The answer is through non-clustered indexes.", "All the queries that we learned to write at the beginning of the article to optimize the query performance were all using non-clustered indexes, the indexes which have to be explicitly defined.", "A non-clustered index is stored in one place and the physical data in the table is stored in another place. It\u2019s like the index page of a book, that we talked about earlier. The index page of the book is located in one place and the contents of the book are located in another. This allows for more than one non-clustered index per table, as we saw earlier.", "And how exactly is that done?", "Suppose you write the query that involves searching for an entry in a column you have already created a non-clustered index for. The non-clustered index inherently contains the following:", "You can see this visually in the left mini-table in the figure:", "Let me explain this using a query.", "So, there\u2019s an additional step (of finding the address and going to that row in the main table) involved in the working of a non-clustered index and hence, it\u2019s slower than a clustered index.", "This was all about the world of indexing for optimizing the performance of SQL queries, especially when you\u2019re dealing with huge datasets. I\u2019ll write more about the other methods of SQL query optimization very soon.", "I hope I was able to deliver on my promise of making the article enjoyable and easy to understand. And I hope you found it useful.", "To end with a powerful message by the greatest golfer of all time, Tiger Woods,", "\u201cNo matter how good you get you can always get better, and that\u2019s the exciting part.\u201d", "Feel free to have a look at the other articles that I\u2019ve written around data analytics:", "Feel free to provide feedback and follow me for more interesting articles on data analytics. Connect with me on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I work as a data scientist at FedEx Ground. I'm passionate about data analytics & digital experimentation. (https://www.linkedin.com/in/ashish-tomar-565b1654/)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F139b57db9fc6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ashishtomar-60885.medium.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": ""}, {"url": "https://ashishtomar-60885.medium.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Ashish Tomar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff0f831383d74&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&user=Ashish+Tomar&userId=f0f831383d74&source=post_page-f0f831383d74----139b57db9fc6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@casparrubin?utm_source=medium&utm_medium=referral", "anchor_text": "Caspar Camille Rubin"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@christianw?utm_source=medium&utm_medium=referral", "anchor_text": "Christian Wiediger"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://pixabay.com/users/jarmoluk-143740/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=428312", "anchor_text": "Michal Jarmoluk"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=428312", "anchor_text": "Pixabay"}, {"url": "https://www.w3schools.com/sql/sql_create_index.asp", "anchor_text": "How to create indexes"}, {"url": "https://en.wikipedia.org/wiki/Query_plan", "anchor_text": "Query Plan"}, {"url": "https://www.sisense.com/glossary/relational-database/", "anchor_text": "relational database management system (RDBMS)"}, {"url": "https://en.wikipedia.org/wiki/Query_optimization", "anchor_text": "Query Optimizer"}, {"url": "https://dataschool.com/sql-optimization/multicolumn-indexes/", "anchor_text": "multi-column indexing"}, {"url": "https://unsplash.com/@moritz_photography?utm_source=medium&utm_medium=referral", "anchor_text": "Moritz Kindler"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Binary_search_algorithm", "anchor_text": "binary search"}, {"url": "https://in.pinterest.com/petsintech/_created/", "anchor_text": "Don Suratos"}, {"url": "https://in.pinterest.com", "anchor_text": "Pinterest"}, {"url": "https://towardsdatascience.com/7-must-know-sql-querying-mistakes-fixes-321ee292a251", "anchor_text": "7 Must Know SQL Querying Mistakes & FixesAvoid these mistakes and refine your querying skills!towardsdatascience.com"}, {"url": "https://towardsdatascience.com/data-analytics-in-e-commerce-retail-7ea42b561c2f", "anchor_text": "Data Analytics in E-Commerce RetailAnalytics concepts & applications in e-commerce retail with easy demonstrations and interesting business examplestowardsdatascience.com"}, {"url": "https://towardsdatascience.com/a-b-testing-top-4-mistakes-with-business-cases-fixes-85e76767dfde", "anchor_text": "A/B Testing: Top 4 Mistakes With Business Cases & FixesThe ones you may have been ignoring till you found this articletowardsdatascience.com"}, {"url": "https://www.linkedin.com/in/ashish-tomar-565b1654/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/sql?source=post_page-----139b57db9fc6---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/optimization?source=post_page-----139b57db9fc6---------------optimization-----------------", "anchor_text": "Optimization"}, {"url": "https://medium.com/tag/data?source=post_page-----139b57db9fc6---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/tag/analytics?source=post_page-----139b57db9fc6---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/data-science?source=post_page-----139b57db9fc6---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&user=Ashish+Tomar&userId=f0f831383d74&source=-----139b57db9fc6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&user=Ashish+Tomar&userId=f0f831383d74&source=-----139b57db9fc6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F139b57db9fc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----139b57db9fc6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----139b57db9fc6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----139b57db9fc6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----139b57db9fc6--------------------------------", "anchor_text": ""}, {"url": "https://ashishtomar-60885.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ashishtomar-60885.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ashish Tomar"}, {"url": "https://ashishtomar-60885.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "116 Followers"}, {"url": "https://www.linkedin.com/in/ashish-tomar-565b1654/", "anchor_text": "https://www.linkedin.com/in/ashish-tomar-565b1654/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff0f831383d74&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&user=Ashish+Tomar&userId=f0f831383d74&source=post_page-f0f831383d74--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9236be80e8e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Findexing-for-sql-query-optimization-139b57db9fc6&newsletterV3=f0f831383d74&newsletterV3Id=9236be80e8e1&user=Ashish+Tomar&userId=f0f831383d74&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}