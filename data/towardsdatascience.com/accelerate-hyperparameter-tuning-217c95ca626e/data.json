{"url": "https://towardsdatascience.com/accelerate-hyperparameter-tuning-217c95ca626e", "time": 1683008427.079978, "path": "towardsdatascience.com/accelerate-hyperparameter-tuning-217c95ca626e/", "webpage": {"metadata": {"title": "A Simple Way to Accelerate Hyperparameter Tuning | Towards Data Science", "h1": "A Simple Way to Accelerate Hyperparameter Tuning", "description": "If you train your neural network models using more than a handful of files, you can probably significantly reduce your model tuning time. Keep reading..."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/nih-chest-xrays/data/data", "anchor_text": "NIH Chest X-rays", "paragraph_index": 7}, {"url": "https://www.kaggle.com/mozillaorg/common-voice", "anchor_text": "Mozilla Common Voice", "paragraph_index": 7}, {"url": "https://mapr.com/blog/an-introduction-to-disk-storage/", "anchor_text": "Here is an article that provides an excellent basic introduction to this concept.", "paragraph_index": 8}, {"url": "https://www.kaggle.com/nih-chest-xrays/data/data", "anchor_text": "NIH Chest X-rays", "paragraph_index": 11}, {"url": "https://www.kaggle.com/nih-chest-xrays/data", "anchor_text": "Kaggle", "paragraph_index": 11}, {"url": "https://www.linkedin.com/in/johnson-dustin/", "anchor_text": "https://www.linkedin.com/in/johnson-dustin/", "paragraph_index": 33}], "all_paragraphs": ["If you train your neural network models using more than a handful of files, you can probably significantly reduce your model tuning time.", "Here\u2019s a common scenario: you organize and prepare your data, write the first version of your neural network model, get everything set up for the first test, hit run, and then you wait.", "The first epoch takes an eternity because your entire data set has to load into memory. Finally, after a few epochs of training (or even a few batches), you realize that this just isn\u2019t going to work \u2014 the model is already over-fitting or just performs poorly. So you adjust a hyperparameter (or ten) and then wait for the entire process to complete again.", "You probably do this over and over again before your results meet the requirements.", "If you have ever worked with moderate to large quantities of data (think 10GB or more), then this is probably a familiar scenario. If your data set is large enough, you might wait up to ten minutes or more just for your data to finish loading into memory. Even if you are using DataGenerators and flow_from_directory(), you will ultimately experience the same lag, just spread out over the first epoch. This lag is especially painful if your large data set consists of thousands of small files.", "In this article, I will teach you how to use a simple method that, for certain types of large datasets, can save you several minutes every single time you start a new hyperparameter test run.", "Before we get to the solution, let\u2019s talk about the problem: disk I/O. In many cases, the performance bottleneck when working with large data sets is the time it takes to get data off your hard drive and into memory. In many data science applications, data is retrieved from thousands of small fragmented files distributed over the platters of a hard drive.", "One example of this is the NIH Chest X-rays data set [1], which contains 112,121 images totaling 42GB of total data. Another example is the Mozilla Common Voice data set [2], which comprises 13GB over approximately 380,000 .mp3 files. These data sets are just the tip of the iceberg \u2014 it is not uncommon to work with much larger quantities of data.", "When you read thousands of small files off of a disk, you are doing so using random read operations, which incur a significant performance penalty over long sequential read operations. Here is an article that provides an excellent basic introduction to this concept. [3]", "So, our goal is to minimize random read operations. The way to do this is simple: combine all of our data into as few large binary files as possible, so that the I/O operation required to load the data goes from being thousands of slow random reads to a few fast sequential reads.", "This solution will improve load times anytime you need to load large amounts of data to train a neural network model, regardless of whether it is a 2D convolutional network for classification, a 1D regression network, or anything in between.", "The data set I will use for this test is the NIH Chest X-rays data set mentioned above because it is widely available and currently very popular on Kaggle.", "There are many ways to build binaries out of your data set, but in this example, we will use a straightforward and powerful method to demonstrate efficacy: NumPy binary files.", "First, to prepare the data set, I will resize all of the images to a resolution of 512 x 512 and ensure they are a single color channel and that the bit depth is 8 bits per pixel grayscale format. Here are some helpful functions for that:", "These three functions are used to resize a full image directory to a defined size, adding padding as necessary.", "\u201c\u2026another way to save time when performing hyperparameter tuning on large data sets is to pre-augment your data set (when building the binaries) instead of using on the fly augmentation.\u201d", "Creating NumPy binary files is simple. First, read the data and labels and add them to a NumPy array. This step could be easily added as part of the previous step or during data set pre-augmentation (so that you do not need to save the resized files to disk), but for the sake of clarity, I will demonstrate building and saving the binary file from a directory of images as a separate step:", "It should be noted that you will need to have enough memory available to create a single binary file out of a data set like this. In this case, after resizing the images and constraining their color space, the resulting binary file for the full data set is approximately 30GB. Therefore, you must have at least that much memory available.", "For large data sets, you can split the data set into smaller binary files. So, for example, if you have only 16GB of memory, it might be worth it to use several 4GB binary files to store the data set to avoid hitting your memory limit.", "Also, to be clear, while I am treating this as a binary classification for the sake of this test when building up the labels array (and so I am only picking up the pneumonia class as 1 and everything else as 0) if I were really trying to use this data it would be categorical cross-entropy with multiple classes and a lot of other work would be done to ensure better processing of the data set \u2014 but those details do not make a difference for this test, and I saved time by reusing some old code.", "Now we can simply load this data to train our model like so:", "If you need to augment the data, you can use whatever method you prefer, including Keras\u2019 ImageDataGenerator:", "However, another way to save time when performing hyperparameter tuning on large data sets is to pre-augment your data set instead of using on the fly augmentation. If you augment your data during the process of building your binaries, you prevent the need to dedicate CPU/GPU time to those tasks later when you train your model. That means that every time you test your hyperparameters, your data set is already augmented, and therefore does not need to be re-augmented. Over the course of many iterations of tuning, this can add up to be significant. It is convenient to do this during the binary building step because that way, you don\u2019t need to save the files to disk and then reload the resized files to build the binaries.", "We will perform four sets of tests, each with a different number of images in the data set.", "We will simulate different sized data sets with 5,000 images, 20,000 images, 50,000 images, and the full NIH Chest X-ray data set\u2019s 112121 images. I have pre-created binaries containing each quantity of images.", "Each test will consist of loading the data set binary using np.load() and also on a per-image-file basis (as would be done with something like flow_from_directory()). Timing will start just prior to the images being loaded and end after loading has finished. Keep in mind, in a flow_from_directory() scenario, images are loaded on the fly, and so images are loaded as needed in batches. This is slightly different in that we are loading each image in the full data set one after another, but the total duration of the read should approximately match the duration over the course of an actual model training session (assuming you have enough memory to store the full data set and it isn\u2019t disk cached, which would actually hurt performance).", "The following plot illustrates the performance difference using image_flow_from_directory vs. using this binary file method. Note that each value is the average of three attempts, none of which are in sequence (to avoid memory caching playing a role in skewing the results). All files (individual images and binaries) were loaded from a WD My Book USB 3.0 external hard drive.", "As you can see, across the board, loading a binary file is significantly faster than loading individual image files, with the performance benefit scaling roughly linearly with the number of images.", "In this article, I demonstrated how to reduce data set load times during hyperparameter tuning using binary files. This is valuable because, during the hyperparameter tuning process, the data set is loaded every time you make a change to your neural network model.", "As shown in our tests, if you are training on a moderately sized data set like the NIH Chest X-rays data set, you can save several minutes per parameter iteration. Over the course of fifty iterations, that might be over two hours of time!", "The downsides to this method are that you must have enough memory to store your full data set (or use multiple binary files), and you must take the time to script out the creation of the binaries. An added advantage of this is that you can also choose to augment or resize your source data at this time. By pre-augmenting your data set, you get the added benefit of not repeatedly using CPU time to augment on the fly.", "Did this help you? What can be improved? Do you know of other ways to speed up hyperparameter tuning iterations? Let me know!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Medical Imaging SW Eng. | M.S. Software Engineering | M.S. Physics | Connect on LinkedIn: https://www.linkedin.com/in/johnson-dustin/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F217c95ca626e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----217c95ca626e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@thedustyengineer?source=post_page-----217c95ca626e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thedustyengineer?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Dustin Johnson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F742a13a22061&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&user=Dustin+Johnson&userId=742a13a22061&source=post_page-742a13a22061----217c95ca626e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/alan9187-2347/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=534120", "anchor_text": "alan9187"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=534120", "anchor_text": "Pixabay"}, {"url": "https://pixabay.com/users/EliasSch-3372715/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2127669", "anchor_text": "Elias Sch."}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2127669", "anchor_text": "Pixabay"}, {"url": "https://www.kaggle.com/nih-chest-xrays/data/data", "anchor_text": "NIH Chest X-rays"}, {"url": "https://www.kaggle.com/mozillaorg/common-voice", "anchor_text": "Mozilla Common Voice"}, {"url": "https://mapr.com/blog/an-introduction-to-disk-storage/", "anchor_text": "Here is an article that provides an excellent basic introduction to this concept."}, {"url": "https://www.kaggle.com/nih-chest-xrays/data/data", "anchor_text": "NIH Chest X-rays"}, {"url": "https://www.kaggle.com/nih-chest-xrays/data", "anchor_text": "Kaggle"}, {"url": "https://keras.io/api/preprocessing/image/", "anchor_text": "Keras Docs"}, {"url": "http://openaccess.thecvf.com/content_cvpr_2017/papers/Wang_ChestX-ray8_Hospital-Scale_Chest_CVPR_2017_paper.pdf", "anchor_text": "http://openaccess.thecvf.com/content_cvpr_2017/papers/Wang_ChestX-ray8_Hospital-Scale_Chest_CVPR_2017_paper.pdf"}, {"url": "https://voice.mozilla.org/en", "anchor_text": "https://voice.mozilla.org/en"}, {"url": "https://mapr.com/blog/an-introduction-to-disk-storage/", "anchor_text": "https://mapr.com/blog/an-introduction-to-disk-storage/"}, {"url": "https://medium.com/tag/data-science?source=post_page-----217c95ca626e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----217c95ca626e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----217c95ca626e---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/hyperparameter-tuning?source=post_page-----217c95ca626e---------------hyperparameter_tuning-----------------", "anchor_text": "Hyperparameter Tuning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&user=Dustin+Johnson&userId=742a13a22061&source=-----217c95ca626e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&user=Dustin+Johnson&userId=742a13a22061&source=-----217c95ca626e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F217c95ca626e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----217c95ca626e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----217c95ca626e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----217c95ca626e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----217c95ca626e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----217c95ca626e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----217c95ca626e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thedustyengineer?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thedustyengineer?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dustin Johnson"}, {"url": "https://medium.com/@thedustyengineer/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "14 Followers"}, {"url": "https://www.linkedin.com/in/johnson-dustin/", "anchor_text": "https://www.linkedin.com/in/johnson-dustin/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F742a13a22061&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&user=Dustin+Johnson&userId=742a13a22061&source=post_page-742a13a22061--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F742a13a22061%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faccelerate-hyperparameter-tuning-217c95ca626e&user=Dustin+Johnson&userId=742a13a22061&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}