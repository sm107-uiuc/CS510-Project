{"url": "https://towardsdatascience.com/a-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781", "time": 1683003592.677367, "path": "towardsdatascience.com/a-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781/", "webpage": {"metadata": {"title": "A Production Machine Learning Pipeline for Text Classification with fastText | by Ari Bajo | Towards Data Science", "h1": "A Production Machine Learning Pipeline for Text Classification with fastText", "description": "Learn how to organize your ML code in multiple steps to create machine learning pipelines that are version controlled."}, "outgoing_paragraph_urls": [{"url": "https://valohai.com", "anchor_text": "Valohai", "paragraph_index": 2}, {"url": "http://mlg.ucd.ie/datasets/bbc.html", "anchor_text": "2225 documents from BBC News", "paragraph_index": 5}, {"url": "https://arxiv.org/abs/1607.01759", "anchor_text": "official fastText paper", "paragraph_index": 7}, {"url": "https://fasttext.cc/docs/en/autotune.html", "anchor_text": "automatic hyper-parameter tuning for fastText", "paragraph_index": 8}, {"url": "https://click.palletsprojects.com/", "anchor_text": "Click", "paragraph_index": 9}, {"url": "https://docs.valohai.com/valohai-yaml/index.html", "anchor_text": "valohai.yaml.", "paragraph_index": 12}, {"url": "https://docs.valohai.com/core-concepts/pipelines/", "anchor_text": "Valohai pipeline", "paragraph_index": 13}, {"url": "https://blog.valohai.com/scaling-airflow-machine-learning", "anchor_text": "integrate Valohai with Airflow", "paragraph_index": 17}, {"url": "https://valohai.com", "anchor_text": "Valohai", "paragraph_index": 29}, {"url": "https://towardsdatascience.com/classifying-4m-reddit-posts-in-4k-subreddits-an-end-to-end-machine-learning-pipeline-ee511d26b362?source=friends_link&sk=e5e631fed93a2e99ce6746ebd6b36583", "anchor_text": "classify 4M Reddit posts in 4k subreddits", "paragraph_index": 29}, {"url": "http://guriosity.com", "anchor_text": "guriosity.com", "paragraph_index": 31}], "all_paragraphs": ["When doing machine learning in production, the choice of the model is just one of the many important criteria. Equally important is getting the definition of the problem right, gathering high-quality data and architecting the machine learning pipeline.", "This article focuses on architecting a machine learning pipeline for a popular problem: text classification. The pipeline takes labeled data, preprocess it, autotunes a fastText model, retrains the model in all the data and outputs metrics and predictions to iterate on.", "I use Valohai to create a ML pipeline and version control each step. In the end, you can run the pipeline on the cloud with a few clicks and explore each intermediary result.", "In a Kaggle competition, you work on a defined problem and a frozen dataset. You have an idea of what a good result is based on the leaderboard.", "In real-world applications, datasets evolve and models are retrained periodically. For example, in text classification it\u2019s common to add new labeled data and update the label space.", "To architect the ML pipeline I use a dataset of 2225 documents from BBC News labeled in five topics: business, entertainment, politics, sport and tech. The dataset assigns a single label for each document, which is known as a multiclass problem.", "You can run the pipeline on any CSV file that contains two columns: text and label. If you want to train it for a multilabel problem, you can add extra rows with the same text and different labels.", "Facebook announced fastText in 2016 as an efficient library for text classification and representation learning. Some of the benefits reported on the official fastText paper:", "In 2019, Facebook added automatic hyper-parameter tuning for fastText that I use as one of the steps in the pipeline.", "I create a command for each ML step with Click, a Python library that decorates functions to turn them into commands. Each command takes data and parameters and generates data and metrics.", "For example, the autotune command trains several models on the train split to find the best parameters on the validation split.", "The get_input_path and get_output_path functions return different paths locally and on the Valohai cloud environment. The train_supervised method accepts arguments to limit the duration of the training and size of the model. The best parameters are saved to later retrain the model on all data.", "To run the autotune command in the cloud, I add it to the valohai.yaml.", "A Valohai pipeline is a version-controlled collection of steps represented as nodes in a graph. Each data dependency results in an edge between steps.", "The text classification pipeline has 5 steps:", "Similar to executions, pipelines are declared in the valohai.yaml file in two sections: nodes and edges.", "Once you have declared a pipeline, you can run it and inspect each pipeline node by clicking on it. Below you can see the details of the autotune node.", "Valohai pipelines are declarative, making it easy to integrate with your code. For dynamic pipelines, you can integrate Valohai with Airflow.", "The data lineage graph displays the data dependencies between executions and artifacts. In Valohai, you can trace each dependency to debug your pipelines faster.", "The autotune step was key to achieve good results. The F1-score went from 0.3 with the default parameters to a final F1-score of 0.982 on the test dataset. Intermediary results are logged by the fastText autotune command and can be read in the logs. The final score is logged in JSON and stored by Valohai as an execution metric.", "But only looking at a metric is not enough to know if your model works well. The most interesting information is in the test_predictions.csv file. It contains the 4 errors made by the model on the test dataset of 222 records.", "The 4th error assigns a higher probability of 0.59 to the business label than the politics label of 0.39. Exploring the whole text reveals that the article talks about both topics. That observation may lead to iterating on the problem to become multilabel and assign all labels above a probability threshold.", "Overall, the labeled data is of high quality. We could argue that some of the errors with higher p@1 are corrections to the labeled data. In another dataset with labeled data produced by a different process, the model predictions can be used to correct the labeled data.", "If the final metrics are not satisfactory for your business case, new features can be added and a different model trained. But I would argue that is better to start by getting the problem definition and the data right. Those are the ingredients of your ML pipeline.", "It\u2019s easy to run the pipeline in the cloud yourself. The following button will invite you to register/login to your Valohai account and create a project to try this pipeline.", "After you have created a project, follow the steps:", "While the pipeline is running, you can click on each node in the graph and view the logs and outputs. Once the pipeline is completed, you can click on a node and get the data lineage graph by clicking on the Trace button.", "Congratulations, you\u2019ve run your first ML pipeline! You can now try it with your own data to get a baseline for your text classification problem:", "Organizing your ML code in multiple steps is key to create production machine learning pipelines that are version controlled and easy to debug. CLIs are a popular choice for industrializing ML code.", "For common problems such as text classification, fastText is a powerful library to build a baseline. With Valohai you get a version-controlled machine learning pipeline you can run on your data. In another article, I reused the pipeline to classify 4M Reddit posts in 4k subreddits.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Freelance Data Engineer & Technical Writer. I digest 50+ tech blogs by French companies \u2192 guriosity.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7e2d3132c781&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@arimbr?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arimbr?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Ari Bajo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ad5ce9cd2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&user=Ari+Bajo&userId=5ad5ce9cd2&source=post_page-5ad5ce9cd2----7e2d3132c781---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://valohai.com", "anchor_text": "Valohai"}, {"url": "http://mlg.ucd.ie/datasets/bbc.html", "anchor_text": "2225 documents from BBC News"}, {"url": "https://arxiv.org/abs/1607.01759", "anchor_text": "official fastText paper"}, {"url": "https://fasttext.cc/docs/en/autotune.html", "anchor_text": "automatic hyper-parameter tuning for fastText"}, {"url": "https://click.palletsprojects.com/", "anchor_text": "Click"}, {"url": "https://github.com/arimbr/valohai-fasttext-example/blob/master/models/classification/commands.py", "anchor_text": "Check all commands.py code in Github."}, {"url": "https://docs.valohai.com/valohai-yaml/index.html", "anchor_text": "valohai.yaml."}, {"url": "https://github.com/arimbr/valohai-fasttext-example/blob/master/models/classification/commands.py", "anchor_text": "Check all valohai.yaml code in Github"}, {"url": "https://docs.valohai.com/core-concepts/pipelines/", "anchor_text": "Valohai pipeline"}, {"url": "https://github.com/arimbr/valohai-fasttext-example/blob/master/models/classification/commands.py", "anchor_text": "Check all valohai.yaml code in Github"}, {"url": "https://blog.valohai.com/scaling-airflow-machine-learning", "anchor_text": "integrate Valohai with Airflow"}, {"url": "https://app.valohai.com/projects/create/?template=fasttext-example", "anchor_text": ""}, {"url": "https://valohai.com", "anchor_text": "Valohai"}, {"url": "https://towardsdatascience.com/classifying-4m-reddit-posts-in-4k-subreddits-an-end-to-end-machine-learning-pipeline-ee511d26b362?source=friends_link&sk=e5e631fed93a2e99ce6746ebd6b36583", "anchor_text": "classify 4M Reddit posts in 4k subreddits"}, {"url": "https://app.valohai.com/projects/create/?template=fasttext-example", "anchor_text": ""}, {"url": "https://github.com/arimbr/valohai-fasttext-example", "anchor_text": "Code repository on Github"}, {"url": "https://fasttext.cc/docs/en/support.html", "anchor_text": "fastText documentation"}, {"url": "https://docs.valohai.com/core-concepts/pipelines/", "anchor_text": "Valohai documentation"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----7e2d3132c781---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/nlp?source=post_page-----7e2d3132c781---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7e2d3132c781---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----7e2d3132c781---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&user=Ari+Bajo&userId=5ad5ce9cd2&source=-----7e2d3132c781---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&user=Ari+Bajo&userId=5ad5ce9cd2&source=-----7e2d3132c781---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7e2d3132c781&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7e2d3132c781---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7e2d3132c781--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7e2d3132c781--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7e2d3132c781--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arimbr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@arimbr?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ari Bajo"}, {"url": "https://medium.com/@arimbr/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "310 Followers"}, {"url": "http://guriosity.com", "anchor_text": "guriosity.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ad5ce9cd2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&user=Ari+Bajo&userId=5ad5ce9cd2&source=post_page-5ad5ce9cd2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fda3f7181915e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-production-machine-learning-pipeline-for-text-classification-with-fasttext-7e2d3132c781&newsletterV3=5ad5ce9cd2&newsletterV3Id=da3f7181915e&user=Ari+Bajo&userId=5ad5ce9cd2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}