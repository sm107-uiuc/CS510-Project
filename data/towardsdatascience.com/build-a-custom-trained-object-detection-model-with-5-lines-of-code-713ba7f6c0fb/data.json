{"url": "https://towardsdatascience.com/build-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb", "time": 1683003951.0541718, "path": "towardsdatascience.com/build-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb/", "webpage": {"metadata": {"title": "Building custom-trained object detection models in Python | by Alan Bi | Towards Data Science", "h1": "Building custom-trained object detection models in Python", "description": "These days, machine learning and computer vision are all the craze. We\u2019ve all seen the news about self-driving cars and facial recognition and probably imagined how cool it\u2019d be to build our own\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/alankbi/detecto", "anchor_text": "Detecto", "paragraph_index": 1}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html#object-detection-instance-segmentation-and-person-keypoint-detection", "anchor_text": "Faster R-CNN ResNet-50 FPN", "paragraph_index": 7}, {"url": "https://github.com/alankbi/detecto/blob/master/docs/_static/dog_dataset.zip", "anchor_text": "here", "paragraph_index": 9}, {"url": "http://vision.stanford.edu/aditya86/ImageNetDogs/main.html", "anchor_text": "Dog Dataset", "paragraph_index": 9}, {"url": "https://robonation.org/programs/robosub/", "anchor_text": "RoboSub", "paragraph_index": 10}, {"url": "https://github.com/tzutalin/labelImg", "anchor_text": "LabelImg", "paragraph_index": 15}, {"url": "https://developer.nvidia.com/cuda-gpus", "anchor_text": "CUDA-enabled GPU", "paragraph_index": 21}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colaboratory", "paragraph_index": 22}, {"url": "https://detecto.readthedocs.io/en/latest/api/core.html#detecto.core.Dataset", "anchor_text": "Dataset", "paragraph_index": 30}, {"url": "https://www.videolan.org/vlc/index.html", "anchor_text": "VLC", "paragraph_index": 34}, {"url": "https://pytorch.org/docs/stable/torchvision/transforms.html", "anchor_text": "torchvision transforms", "paragraph_index": 36}, {"url": "https://detecto.readthedocs.io/en/latest/api/core.html#detecto.core.DataLoader", "anchor_text": "DataLoader", "paragraph_index": 36}, {"url": "https://github.com/alankbi/detecto", "anchor_text": "Detecto on GitHub", "paragraph_index": 42}, {"url": "https://detecto.readthedocs.io/en/latest/", "anchor_text": "documentation", "paragraph_index": 42}], "all_paragraphs": ["These days, machine learning and computer vision are all the craze. We\u2019ve all seen the news about self-driving cars and facial recognition and probably imagined how cool it\u2019d be to build our own computer vision models. However, it\u2019s not always easy to break into the field, especially without a strong math background. Libraries like PyTorch and TensorFlow can be tedious to learn if all you want to do is experiment with something small.", "In this tutorial, I present a simple way for anyone to build fully-functional object detection models with just a few lines of code. More specifically, we\u2019ll be using Detecto, a Python package built on top of PyTorch that makes the process easy and open to programmers at all levels.", "To demonstrate how simple it is to use Detecto, let\u2019s load in a pre-trained model and run inference on the following image:", "First, download the Detecto package using pip:", "Then, save the image above as \u201cfruit.jpg\u201d and create a Python file in the same folder as the image. Inside the Python file, write these 5 lines of code:", "After running this file (it may take a few seconds if you don\u2019t have a CUDA-enabled GPU on your computer; more on that later), you should see something similar to the plot below:", "Awesome! We did all that with just 5 lines of code. Here\u2019s what we did in each:", "Detecto uses a Faster R-CNN ResNet-50 FPN from PyTorch\u2019s model zoo, which is able to detect about 80 different objects such as animals, vehicles, kitchen appliances, etc. However, what if you wanted to detect custom objects, like Coke vs. Pepsi cans, or zebras vs. giraffes?", "You\u2019ll be glad to know that training a Detecto model on a custom dataset is just as easy; again, all you need is 5 lines of code, as well as either an existing dataset or some time spent labeling images.", "In this tutorial, we\u2019ll start from scratch by building our own dataset. I recommend that you do the same, but if you want to skip this step, you can download a sample dataset here (modified from Stanford\u2019s Dog Dataset).", "For our dataset, we\u2019ll be training our model to detect an underwater alien, bat, and witch from the RoboSub competition, as shown below:", "Ideally, you\u2019ll want at least 100 images of each class. The good thing is that you can have multiple objects in each image, so you could theoretically get away with 100 total images if each image contains every class of object you want to detect. Also, if you have video footage, Detecto makes it easy to split that footage into images that you can then use for your dataset:", "The code above takes every 4th frame in \u201cvideo.mp4\u201d and saves it as a JPEG file in the \u201cframes\u201d folder.", "Once you\u2019ve produced your training dataset, you should have a folder that looks something like the following:", "If you want, you can also have a second folder containing a set of validation images.", "Now comes the time-consuming part: labeling. Detecto supports the PASCAL VOC format, in which you have XML files containing label and position data for each object in your images. To create these XML files, you can use the open-source LabelImg tool as follows:", "You should now see a window pop up. On the left, click the \u201cOpen Dir\u201d button and select the folder of images that you want to label. If things worked correctly, you should see something like this:", "To draw a bounding box, click the icon in the left menu bar (or use the keyboard shortcut \u201cw\u201d). You can then drag a box around your objects and write/select a label:", "When you\u2019ve finished labeling an image, use CTRL+S or CMD+S to save your XML file (for simplicity and speed, you can just use the default file location and name that they auto-fill). To label the next image, click \u201cNext Image\u201d (or use the keyboard shortcut \u201cd\u201d).", "Once you\u2019re done with the entire dataset, your folder should look something like this:", "We\u2019re almost ready to start training our object detection model!", "First, check whether your computer has a CUDA-enabled GPU. Since deep learning uses a lot of processing power, training on a typical CPU can be very slow. Thankfully, most modern deep learning frameworks like PyTorch and Tensorflow can run on GPUs, making things much faster. Make sure you have PyTorch downloaded (you should already have it if you installed Detecto), and then run the following 2 lines of code:", "If it prints True, great! You can skip to the next section. If it prints False, don\u2019t fret. Follow the below steps to create a Google Colaboratory notebook, an online coding environment that comes with a free, usable GPU. For this tutorial, you\u2019ll just be working from within a Google Drive folder rather than on your computer.", "You should now see an interface like this:", "5. Give your notebook a name if you want, and then go to Edit ->Notebook settings -> Hardware accelerator and select GPU", "6. Type the following code to \u201cmount\u201d your Drive, change directory to the current folder, and install Detecto:", "To make sure everything worked, you can create a new code cell and type !ls to check that you\u2019re in the right directory.", "Finally, we can now train a model on our custom dataset! As promised, this is the easy part. All it takes is 4 lines of code:", "Let\u2019s again break down what we\u2019ve done with each line of code:", "This can take anywhere from 10 minutes to 1+ hours to run depending on the size of your dataset, so make sure your program doesn\u2019t exit immediately after finishing the above statements (i.e. you\u2019re using a Jupyter/Colab notebook that preserves state while active).", "Now that you have a trained model, let\u2019s test it on some images. To read images from a file path, you can use the read_image function from the detecto.utils module (you could also use an image from the Dataset you created above):", "From these predictions, we can plot the results using the detecto.visualize module. For example:", "Running the above code with the image and predictions you received should produce something that looks like this:", "If you have a video, you can run object detection on it:", "This takes in a video file called \u201cinput.mp4\u201d and produces an \u201coutput.avi\u201d file with the given model\u2019s predictions. If you open this file with VLC or some other video player, you should see some promising results!", "Lastly, you can save and load models from files, allowing you to save your progress and come back to it later:", "You\u2019ll be happy to know that Detecto isn\u2019t just limited to 5 lines of code. Let\u2019s say for example that the model didn\u2019t do as well as you hoped. We can try to increase its performance by augmenting our dataset with torchvision transforms and defining a custom DataLoader:", "This code applies random horizontal flips and saturation effects on images in our dataset, increasing the diversity of our data. We then define a DataLoader object with batch_size=2; we\u2019ll pass this to model.fit instead of the Dataset to tell our model to train on batches of 2 images rather than the default of 1.", "If you created a separate validation dataset earlier, now is the time to load it in during training. By providing a validation dataset, the fit method returns a list of the losses at each epoch, and if verbose=True, then it will also print these out during the training process itself. The following code block demonstrates this as well as customizes several other training parameters:", "The resulting plot of the losses should be more or less decreasing:", "For even more flexibility and control over your model, you can bypass Detecto altogether; the model.get_internal_model method returns the underlying torchvision model used, which you can mess around with as much as you see fit.", "In this tutorial, we showed that computer vision and object detection don\u2019t need to be challenging. All you need is a bit of time and patience to come up with a labeled dataset.", "If you\u2019re interested in further exploration, check out Detecto on GitHub or visit the documentation for more tutorials and use cases!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Student at Duke University studying computer science and statistics"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F713ba7f6c0fb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@alankbi?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alankbi?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Alan Bi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa296c1c717c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&user=Alan+Bi&userId=a296c1c717c&source=post_page-a296c1c717c----713ba7f6c0fb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/alankbi/detecto", "anchor_text": "Detecto"}, {"url": "https://github.com/alankbi/detecto", "anchor_text": "alankbi/detectoDetecto is a Python package that allows you to build fully-functioning computer vision and object detection models with\u2026github.com"}, {"url": "https://en.wikipedia.org/wiki/Apples_and_oranges", "anchor_text": "Wikipedia"}, {"url": "https://pytorch.org/docs/stable/torchvision/models.html#object-detection-instance-segmentation-and-person-keypoint-detection", "anchor_text": "Faster R-CNN ResNet-50 FPN"}, {"url": "https://github.com/alankbi/detecto/blob/master/docs/_static/dog_dataset.zip", "anchor_text": "here"}, {"url": "http://vision.stanford.edu/aditya86/ImageNetDogs/main.html", "anchor_text": "Dog Dataset"}, {"url": "https://robonation.org/programs/robosub/", "anchor_text": "RoboSub"}, {"url": "https://github.com/tzutalin/labelImg", "anchor_text": "LabelImg"}, {"url": "https://developer.nvidia.com/cuda-gpus", "anchor_text": "CUDA-enabled GPU"}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "Google Colaboratory"}, {"url": "http://drive.google.com/", "anchor_text": "Google Drive"}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb", "anchor_text": "here"}, {"url": "https://detecto.readthedocs.io/en/latest/api/core.html#detecto.core.Dataset", "anchor_text": "Dataset"}, {"url": "https://www.videolan.org/vlc/index.html", "anchor_text": "VLC"}, {"url": "https://pytorch.org/docs/stable/torchvision/transforms.html", "anchor_text": "torchvision transforms"}, {"url": "https://detecto.readthedocs.io/en/latest/api/core.html#detecto.core.DataLoader", "anchor_text": "DataLoader"}, {"url": "https://github.com/alankbi/detecto", "anchor_text": "Detecto on GitHub"}, {"url": "https://detecto.readthedocs.io/en/latest/", "anchor_text": "documentation"}, {"url": "https://github.com/alankbi/detecto", "anchor_text": "alankbi/detectoDetecto is a Python package that allows you to build fully-functioning computer vision and object detection models with\u2026github.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----713ba7f6c0fb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----713ba7f6c0fb---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----713ba7f6c0fb---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----713ba7f6c0fb---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/python?source=post_page-----713ba7f6c0fb---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&user=Alan+Bi&userId=a296c1c717c&source=-----713ba7f6c0fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&user=Alan+Bi&userId=a296c1c717c&source=-----713ba7f6c0fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F713ba7f6c0fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----713ba7f6c0fb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----713ba7f6c0fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alankbi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alankbi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alan Bi"}, {"url": "https://medium.com/@alankbi/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "109 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa296c1c717c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&user=Alan+Bi&userId=a296c1c717c&source=post_page-a296c1c717c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb4c0ae4adb77&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-custom-trained-object-detection-model-with-5-lines-of-code-713ba7f6c0fb&newsletterV3=a296c1c717c&newsletterV3Id=b4c0ae4adb77&user=Alan+Bi&userId=a296c1c717c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}