{"url": "https://towardsdatascience.com/using-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68", "time": 1683011911.483456, "path": "towardsdatascience.com/using-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68/", "webpage": {"metadata": {"title": "How to use Machine Learning Models to make Predictions directly from Snowflake | by Jeno Yamma | Towards Data Science", "h1": "How to use Machine Learning Models to make Predictions directly from Snowflake", "description": "Often, we are faced with the scenarios (and myself recently), where the model which was deployed by the data scientist runs on a schedule and whether that\u2019s once an hour, once a day, or once a\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Often, we are faced with the scenarios (and myself recently), where the model which was deployed by the data scientist runs on a schedule and whether that\u2019s once an hour, once a day, or once a week\u2026you get the point. However, there are times when out-of-schedule results are required to make decisions for a meeting or analysis.", "With that being said, there are a few ways to get out-of-schedule predictions\u2026", "Consequent, even though the Data Scientist & Co could implement a batch prediction application for others to use for out-of-schedule case, it would be intuitive to bring non-technical users closer to the model themselves and give them the power to run predictions from SQL.", "Inspired by Amazon Aurora Machine Learning, I spent a couple of days thinking about how to bridge this gap, and put together an architecture and build that will allow non-technical users to perform batch prediction from the comfort of SQL. This is all within Snowflake using Stored Procedure, Snowpipe, Streams and Tasks, and SageMaker\u2019s batch prediction job (Batch Transform), to create a batch inference data pipeline.", "In order for the user to make a call to Batch Transform, the user will need to create an input table that contains the data for the model, and mandatory fields, the predictionid which is a uuid for the job, record_seq which is a unique identifier for reach input rows, a NULL prediction column which is the target of interest.", "The call_ml_prediction Stored Procedure takes in a user-defined job name and input table name. Calling it will unload the file (using predictionid as the name) onto S3 bucket in the /input path and create an entry in the prediction_status table. From there, Batch Transform will be called to predict on the inputted data.", "To ensure there aren\u2019t multiple requests being submitted, only one job is able to run at a time. For simplicity, I also ensured only a single file is unloaded onto S3, but Batch Transform can handle multiple input files.", "Once the data is unloaded onto the S3 bucket /input, a Lambda gets fired which makes a call SageMaker Batch Transform to read in the input data and output inferences to the /sagemaker path.", "If you\u2019re familiar with Batch Transform, you can set the input_filter, join and output_filter to your likings for the output prediction file.", "Once Batch Transform completes, it outputs the result as a .csv.out in the /sagemaker path. Another Lambda gets fired which will copy and rename the file as .csv to the /snowflake path where SQS is setup for Snowpipe auto-ingest.", "Once the data is dropped onto the /snowflake path, it is inserted into the prediction_result table via Snowpipe. For simplicity, since SageMaker Batch Transform maintains the order of the prediction, the row number was used as the identifier to join to the input table. You can do the postprocessing step within Batch Transform itself.", "A stream is created is on the prediction_result table which will populate prediction_result_stream after Snowpipe delivers the data. This stream, specifically the system$stream_has_data('prediction_result_stream, will be used by the scheduled task populate_prediction_result to call the stored procedure populate_prediction_result to populate the prediction data on the hotel_cancellation table, only if there is a stream. The unique identifier, predictionid, is also set as a task session variable.", "At the end of the job, and after populate_prediction_result completes, using the system task session variable, the next task update_prediction_status updates the prediction status from Submitted to Completed. This concludes the entire \u201cUsing SQL to run Batch Prediction\u201d pipeline.", "Snowflake provides a lot of power through Snowpipe, Streams, Stored Procedure and Task to create a data pipeline which can be used for different applications. When combined with SageMaker, Users will be able to send inputs directly from Snowflake and interact with the prediction results.", "Nonetheless, there are some wishlist items which will improve the whole experience and that is:", "I hope you find this article useful and enjoyed the read.", "I love writing medium articles, and sharing my ideas and learnings with everyone. My day-to-day job involves helping businesses build scalable cloud and data solutions, and trying new food recipes. Feel free to connect with me for a casual chat, just let me know you\u2019re from Medium", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I make a lot of fried chicken, work with data here and there, and love sharing knowledge"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2471b2f71b68&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jenoyamma?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jenoyamma?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Jeno Yamma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85f6d55b1a44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&user=Jeno+Yamma&userId=85f6d55b1a44&source=post_page-85f6d55b1a44----2471b2f71b68---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kennyzhang29", "anchor_text": "kennyzhang29"}, {"url": "https://unsplash.com/photos/5LyYqPEv8w0", "anchor_text": "Unsplash"}, {"url": "https://www.linkedin.com/in/cyamma/", "anchor_text": "Jeno Yamma"}, {"url": "https://medium.com/tag/aws?source=post_page-----2471b2f71b68---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2471b2f71b68---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/sql?source=post_page-----2471b2f71b68---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/startup?source=post_page-----2471b2f71b68---------------startup-----------------", "anchor_text": "Startup"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2471b2f71b68---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&user=Jeno+Yamma&userId=85f6d55b1a44&source=-----2471b2f71b68---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&user=Jeno+Yamma&userId=85f6d55b1a44&source=-----2471b2f71b68---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2471b2f71b68&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2471b2f71b68---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2471b2f71b68--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2471b2f71b68--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2471b2f71b68--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jenoyamma?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jenoyamma?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jeno Yamma"}, {"url": "https://medium.com/@jenoyamma/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "518 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85f6d55b1a44&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&user=Jeno+Yamma&userId=85f6d55b1a44&source=post_page-85f6d55b1a44--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1337a4f348b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-machine-learning-models-to-make-prediction-directly-from-snowflake-2471b2f71b68&newsletterV3=85f6d55b1a44&newsletterV3Id=1337a4f348b&user=Jeno+Yamma&userId=85f6d55b1a44&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}