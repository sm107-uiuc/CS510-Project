{"url": "https://towardsdatascience.com/low-memory-instance-segmentation-b9c425b67db1", "time": 1683011623.391603, "path": "towardsdatascience.com/low-memory-instance-segmentation-b9c425b67db1/", "webpage": {"metadata": {"title": "Low Memory Instance Segmentation. Deploy an instance segmentation web app\u2026 | by Neel Iyer | Towards Data Science", "h1": "Low Memory Instance Segmentation", "description": "Machine Learning models are memory intensive. My current web app consumes at least 1GB of memory. That makes it difficult to deploy to the cloud. The immediate solution that comes to mind is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://spiyer99.github.io/Detectron2-Web-App/", "anchor_text": "current web app", "paragraph_index": 0}, {"url": "https://github.com/jantic/DeOldify/tree/master/deoldify", "anchor_text": "deoldify", "paragraph_index": 2}, {"url": "https://github.com/jantic/DeOldify/blob/master/deoldify/filters.py", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://github.com/jantic/DeOldify/blob/edac73edf1d3557f95a71f860cffd6c4c91f66f0/deoldify/filters.py#L58", "anchor_text": "lead to OOM errors", "paragraph_index": 6}, {"url": "https://spiyer99.github.io/Detectron2-Web-App/", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://github.com/spiyer99/detectron2_web_app/blob/master/app.py", "anchor_text": "Github", "paragraph_index": 10}, {"url": "https://medium.com/@jaychapel/4-ways-to-get-google-cloud-credits-c4b7256ff862", "anchor_text": "many ways", "paragraph_index": 11}, {"url": "https://cloud.google.com/resource-manager/docs/creating-managing-projects", "anchor_text": "project", "paragraph_index": 12}, {"url": "https://cloud.google.com/run/docs/quickstarts/build-and-deploy", "anchor_text": "docs", "paragraph_index": 12}, {"url": "https://github.com/npatta01/web-deep-learning-classifier/", "anchor_text": "this repo", "paragraph_index": 12}, {"url": "https://neelsmlapp-lfoa57ljxa-uc.a.run.app/", "anchor_text": "google cloud instance segmentation web app here", "paragraph_index": 16}], "all_paragraphs": ["Machine Learning models are memory intensive. My current web app consumes at least 1GB of memory. That makes it difficult to deploy to the cloud.", "The immediate solution that comes to mind is increasing the memory of the VM instance. But I\u2019d rather not spend more money that I have to. This is a side project, after all.", "So I came up with a work around. It\u2019s actually inspired by deoldify by Jason Antic. Jason uses a render factor to downscale the image and convert it to a square before running his machine learning model.", "I thought that applying the same idea here could reduce memory requirements.", "In short here is the solution. It\u2019s largely taken from here.", "We scale to square of size targ. targ is essentially the render factor that Jason mentions in deoldify.", "If the render factor is too high it can lead to OOM errors. Too low and the result will have a poor resolution.", "What this looks like in practice is pretty simple actually. First we scale the image to a sqaure of size targ. Then we run inference on that scaled image. The result from inference is passed through the _unsquare function. This converts our square size image to its former size.", "After this we can finally deploy on most cloud platforms without any OOM issues. If you do get an OOM error, just reduce the render factor.", "I\u2019ll be using the web app described here as a starting point.", "We\u2019ll need to modify the app.py script to implement the run_inference_transform function described above. The modified version is on Github.", "There are many ways to get promotional credits for Google Cloud. So I\u2019m going to be using their services for this project. The plan is that everything that I will do will be covered by those free credits :).", "I created a project on google cloud and finally got the deployment to work. The google cloud docs are pretty well written \u2014 but I still ran into errors. I found this repo to be very helpful.", "As usual I created a shell script to implement exactly what we need to do in terminal.", "Once we deploy this on google cloud the detectron2 model finally works. The output has a lower resolution than the input but everything fits within the 2G memory constraints.", "After building with docker stats I can confirm that this method uses far less memory. On my local computer it uses 1.16 GB of memory at its peak. Whereas the previous method used over 2GB (approx. 2.23 GB) at its peak.", "You can access the google cloud instance segmentation web app here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb9c425b67db1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://neel-iyer.medium.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1----b9c425b67db1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://spiyer99.github.io/Detectron2-Web-App/", "anchor_text": "current web app"}, {"url": "https://github.com/jantic/DeOldify/tree/master/deoldify", "anchor_text": "deoldify"}, {"url": "https://github.com/jantic/DeOldify/blob/master/deoldify/filters.py", "anchor_text": "here"}, {"url": "https://github.com/jantic/DeOldify/blob/edac73edf1d3557f95a71f860cffd6c4c91f66f0/deoldify/filters.py#L58", "anchor_text": "lead to OOM errors"}, {"url": "https://spiyer99.github.io/Detectron2-Web-App/", "anchor_text": "here"}, {"url": "https://github.com/spiyer99/detectron2_web_app/blob/master/app.py", "anchor_text": "Github"}, {"url": "https://medium.com/@jaychapel/4-ways-to-get-google-cloud-credits-c4b7256ff862", "anchor_text": "many ways"}, {"url": "https://cloud.google.com/resource-manager/docs/creating-managing-projects", "anchor_text": "project"}, {"url": "https://cloud.google.com/run/docs/quickstarts/build-and-deploy", "anchor_text": "docs"}, {"url": "https://github.com/npatta01/web-deep-learning-classifier/", "anchor_text": "this repo"}, {"url": "https://neelsmlapp-lfoa57ljxa-uc.a.run.app/", "anchor_text": "google cloud instance segmentation web app here"}, {"url": "https://spiyer99.github.io/Detectron2-Web-App-gcloud/", "anchor_text": "https://spiyer99.github.io"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----b9c425b67db1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/instance-segmentation?source=post_page-----b9c425b67db1---------------instance_segmentation-----------------", "anchor_text": "Instance Segmentation"}, {"url": "https://medium.com/tag/detectron2?source=post_page-----b9c425b67db1---------------detectron2-----------------", "anchor_text": "Detectron2"}, {"url": "https://medium.com/tag/docker?source=post_page-----b9c425b67db1---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/flask?source=post_page-----b9c425b67db1---------------flask-----------------", "anchor_text": "Flask"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----b9c425b67db1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----b9c425b67db1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb9c425b67db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b9c425b67db1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b9c425b67db1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b9c425b67db1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b9c425b67db1--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://neel-iyer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "418 Followers"}, {"url": "https://www.linkedin.com/in/neel-iyer/", "anchor_text": "https://www.linkedin.com/in/neel-iyer/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa4687e9ccf6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flow-memory-instance-segmentation-b9c425b67db1&newsletterV3=e7c5e1c9cae1&newsletterV3Id=a4687e9ccf6&user=Neel+Iyer&userId=e7c5e1c9cae1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}