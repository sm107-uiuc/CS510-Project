{"url": "https://towardsdatascience.com/columnar-stores-when-how-why-2d6759914319", "time": 1683012321.848711, "path": "towardsdatascience.com/columnar-stores-when-how-why-2d6759914319/", "webpage": {"metadata": {"title": "Columnar Stores \u2014 When/How/Why?. Demystifying Row vs Column Big Data\u2026 | by Doug Foo | Towards Data Science", "h1": "Columnar Stores \u2014 When/How/Why?", "description": "Long ago data storage was simple \u2014 heapfiles and b-trees and that's it. Today the options are overwhelming \u2014 ORC, Parquet, Avro on HDFS or S3 or a RDBMS solution like Postgresql, MariaDB, or\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/citusdata/cstore_fdw/issues/75", "anchor_text": "bug", "paragraph_index": 20}, {"url": "https://www.citusdata.com/blog/2014/06/14/columnar-store-benchmarks-ssds/", "anchor_text": "notes", "paragraph_index": 20}, {"url": "https://www.confluent.io/ebook/i-heart-logs-event-data-stream-processing-and-data-integration/", "anchor_text": "logs", "paragraph_index": 31}, {"url": "http://foostack.ai", "anchor_text": "foostack.ai", "paragraph_index": 36}], "all_paragraphs": ["Long ago data storage was simple \u2014 heapfiles and b-trees and that's it. Today the options are overwhelming \u2014 ORC, Parquet, Avro on HDFS or S3 or a RDBMS solution like Postgresql, MariaDB, or commercial ones like Oracle and DB2. Even within RDBMS engines and Cloud services there are many options!", "This guide is a \u201crandom walk\u201d into the broad realm of storage.", "I pulled the Chicago Public workers salary info. Did you know public salaries are published w/ the REAL names of each person? Look up your favorite police officer or commissioner\u2019s salary for fun (it won\u2019t include overtime, perks nor bribes, unfortunately).", "First the basic storage mechanics of data. Row and column orientation.", "Row oriented stores each individual record together, Doug Foo\u2019s full record then Jane Foo\u2019s, and so on in sequence.", "Column or columnar stores all column data together\u200a\u2014 so all First Names (Doug,Jane, etc), then all the Last Names, Titles, \u2026\u00a0, finally all Salaries.", "Data is generally read off disk by blocks of KB (or MB/GB), so a single read for 1 record brings in a lot more than what you may want.", "Salary records are pretty small ~ 50chars (<50 bytes). An 8KB block with metadata could easily store 100+ row oriented records [8192 / 50 = 163]. So a single read of the block containing \u201cDoug Foo\u201d\u2019s record includes a lot more.", "For columnar block reads\u200a\u2014\u200athe read varies on column\u00a0size. For example with 8KB blocks:", "This will be important to keep in mind as we do more analysis later.", "I wanted to add a M/F attribute so I merged in a baby names database then wrote out the various pandas supported formats (JSON, CSV and Parquet).", "Note the difference in file sizes for equivalent disk formats (38k records):", "Parquet is a binary compressed format so requires some effort to do a quick peek \u2014\u200awill\u00a0discuss details\u00a0later.", "Obvious, but let\u2019s spell it out:", "Note CSV and JSON have distinct advantages of being very human readable thus are sometimes good interchange formats.", "Postgres is a full featured open source DB that has both traditional row based storage (sometimes called \u201cheapfiles\u201d) as well as a columnar store extension (cstore_fdw).", "I created a schema and loaded the salary data into 2 variants, a standard row and column version.", "Some basic stats/comparisons between the two when querying 38k records:", "2. Select sum(salary) \u2192 this should be a classic case for columnar where we only need to scan one column or sequence of blocks, while row-based needs to scan all blocks to extract the salary from each row. But it is not as fast as we\u2019d expect. The cost is cheaper 493 vs 873, but timing is 14.1ms vs 17.1ms.", "3. Larger datasets \u2014 I pumped this up to 3.8 m rows and re-ran the sum query. Not much change \u2014 somewhat surprising! In theory, it should be much faster than the 20\u201330% gains. In fact, columnar is often slower after caching takes effect! (To be fair to columnar \u2014 you really need GB to TB datasets that are larger than your memory caches to real gains)[*2].", "After reading some bug reports and developer notes, I can guess as an extension it is not as robust as standard row storage. Native row formats offer multi-core processing and buffer caches for example. I should probably compare to a native column store database\u2026.", "Note the file sizes when I loaded 3.8m rows:", "Huge space savings (almost 4x)! Notice the raw data dump for both row and columnar on disk (using \u201cxxd -c 32\u201d on linux/wsl2):", "Parquet came out of Twitter and Cloudera (Hadoop) and is maintained as an Apache project. It is the defacto format for Spark, as a result #1 in popularity. (Prior popular formats include ORC and RCFile).", "It is also natively supported by Python/Pandas and offers multiple compression formats. The basic file format is a columnar in groups of rows and stores a central schema & group level metadata to allow\u00a0parallel and\u00a0partial reads.", "A modest deep dive into the raw file shows:", "In tight competition with Parquet is Avro, which is a bit more than just a storage format but we\u2019ll focus only on storage aspects. It is also an Apache project.[*3] Two main differences to Parquet:", "Schema and changes (defaults for new and old rows) are embedded in the file. Adding a new column just requires defining defaults which makes slowly changing dimensions (SCD) and changes easier to handle.", "Note it is row-oriented so you will not get some of the advantages like compression and performance that you do with Parq \u2014 assuming your use case is more about columnar aggregation rather than record by record processing.", "Avro code and data file example:", "NoSQL \u2014 name-value object stores like MongoDB, AWS Dynamo, and Cassandra store entire JSON (or arbitrary) objects by a distinct key. The API is simple using basic key-value store (put/get) semantics. The high level +/-\u2019s :", "Log Structured Stores (and Log Structured Merge Trees) and their innovative uses are a fascinating area \u2014 Kafka is the leader and innovator (don\u2019t be fooled its not just messaging, its really about logs as per co-creator Jay Kreps). [*4]", "Finally, KDB deserves brief mention as a pioneer in columnar, realtime and timeseries memory DBs. Initially written in the \u201990s and boasts unbeatable single core performance even today. Unfortunately, it is an expensive niche product, thus sold off to First Derivatives recently and likely being bled out to die \u2026", "Apache Arrow (memory columnar format and serializer) and OLAP tech are two areas worth looking into as well.", "Think it thru and do a trial run. Relational DB\u2019s have made massive improvements in caching and indexing that may make it less necessary in some cases.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Tech Manager by Day, ML Hacker by Night \u2014 founder: foostack.ai"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2d6759914319&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://doug-foo.medium.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": ""}, {"url": "https://doug-foo.medium.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Doug Foo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1eddac375cb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&user=Doug+Foo&userId=1eddac375cb9&source=post_page-1eddac375cb9----2d6759914319---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@skylergeraldphoto?utm_source=medium&utm_medium=referral", "anchor_text": "Skyler Gerald"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/citusdata/cstore_fdw/issues/75", "anchor_text": "bug"}, {"url": "https://www.citusdata.com/blog/2014/06/14/columnar-store-benchmarks-ssds/", "anchor_text": "notes"}, {"url": "https://www.confluent.io/ebook/i-heart-logs-event-data-stream-processing-and-data-integration/", "anchor_text": "logs"}, {"url": "https://github.com/citusdata/cstore_fdw", "anchor_text": "https://github.com/citusdata/cstore_fdw"}, {"url": "https://medium.com/swlh/insights-into-parquet-storage-ac7e46b94ffe", "anchor_text": "https://medium.com/swlh/insights-into-parquet-storage-ac7e46b94ffe"}, {"url": "https://www.perfectlyrandom.org/2019/11/29/handling-avro-files-in-python/", "anchor_text": "https://www.perfectlyrandom.org/2019/11/29/handling-avro-files-in-python/"}, {"url": "https://blog.yugabyte.com/a-busy-developers-guide-to-database-storage-engines-the-basics/", "anchor_text": "https://blog.yugabyte.com/a-busy-developers-guide-to-database-storage-engines-the-basics/"}, {"url": "https://www.slideshare.net/ConfluentInc/power-of-the-loglsm-append-only-data-structures", "anchor_text": "https://www.slideshare.net/ConfluentInc/power-of-the-loglsm-append-only-data-structures"}, {"url": "https://www.confluent.io/ebook/i-heart-logs-event-data-stream-processing-and-data-integration/", "anchor_text": "https://www.confluent.io/ebook/i-heart-logs-event-data-stream-processing-and-data-integration/"}, {"url": "https://queue.acm.org/detail.cfm?id=1531242", "anchor_text": "https://kx.com/blog/small-core-code-and-hp-apl/"}, {"url": "https://data.cityofchicago.org/Administration-Finance/Current-Employee-Names-Salaries-and-Position-Title/aned-ke5c", "anchor_text": "https://data.cityofchicago.org/Administration-Finance/Current-Employee-Names-Salaries-and-Position-Title/aned-ke5c"}, {"url": "https://github.com/dougfoo/fileformats", "anchor_text": "https://github.com/dougfoo/fileformats"}, {"url": "https://medium.com/tag/big-data?source=post_page-----2d6759914319---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/database?source=post_page-----2d6759914319---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/storage-containers?source=post_page-----2d6759914319---------------storage_containers-----------------", "anchor_text": "Storage Containers"}, {"url": "https://medium.com/tag/big-data-analytics?source=post_page-----2d6759914319---------------big_data_analytics-----------------", "anchor_text": "Big Data Analytics"}, {"url": "https://medium.com/tag/columnar-databases?source=post_page-----2d6759914319---------------columnar_databases-----------------", "anchor_text": "Columnar Databases"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&user=Doug+Foo&userId=1eddac375cb9&source=-----2d6759914319---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&user=Doug+Foo&userId=1eddac375cb9&source=-----2d6759914319---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2d6759914319&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2d6759914319---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2d6759914319--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2d6759914319--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2d6759914319--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2d6759914319--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2d6759914319--------------------------------", "anchor_text": ""}, {"url": "https://doug-foo.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://doug-foo.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Doug Foo"}, {"url": "https://doug-foo.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.2K Followers"}, {"url": "http://foostack.ai", "anchor_text": "foostack.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1eddac375cb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&user=Doug+Foo&userId=1eddac375cb9&source=post_page-1eddac375cb9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F195f71a45f20&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcolumnar-stores-when-how-why-2d6759914319&newsletterV3=1eddac375cb9&newsletterV3Id=195f71a45f20&user=Doug+Foo&userId=1eddac375cb9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}