{"url": "https://towardsdatascience.com/double-q-learning-the-easy-way-a924c4085ec3", "time": 1682994095.913295, "path": "towardsdatascience.com/double-q-learning-the-easy-way-a924c4085ec3/", "webpage": {"metadata": {"title": "Double Q-Learning, the Easy Way. Q-learning (Watkins, 1989) is\u2026 | by Ziad SALLOUM | Towards Data Science", "h1": "Double Q-Learning, the Easy Way", "description": "Update: The best way of learning and practicing Reinforcement Learning is by going to http://rl-lab.com Q-learning (Watkins, 1989) is considered one of the breakthroughs in TD control reinforcement\u2026"}, "outgoing_paragraph_urls": [{"url": "http://rl-lab.com", "anchor_text": "http://rl-lab.com", "paragraph_index": 0}, {"url": "https://papers.nips.cc/paper/3964-double-q-learning.pdf", "anchor_text": "Double Q-Learning", "paragraph_index": 2}], "all_paragraphs": ["Update: The best way of learning and practicing Reinforcement Learning is by going to http://rl-lab.com", "Q-learning (Watkins, 1989) is considered one of the breakthroughs in TD control reinforcement learning algorithm.", "However in his paper Double Q-Learning Hado van Hasselt explains how Q-Learning performs very poorly in some stochastic environments. He pointed out that the poor performance is caused by large overestimation of action values due to the use of Max Q(s\u2019,a) in Q-learning.", "To remedy this problem he proposed the Double Q-Learning method.", "Consider an MDP having four states two of which are terminal states.State A is always considered at start state, and has two actions, either Right or Left. The Right action gives zero reward and lands in terminal state C.The Left action moves the agent to state B with zero reward.", "State B has a number of actions, they move the agent to the terminal state D. However (this is important) the reward R of each action from B to D has a random value that follows a normal distribution with mean -0.5 and a variance 1.0.", "The expected value of R is known to be negative (-0.5). This means that over a large number of experiments the average value of R is less than zero.", "Based on this assumption, it is clear that moving left from A is always a bad idea. However because some of the values of R are positive, Q-Learning will be tricked to consider that moving left from A maximises the reward. In reality this is a bad decision, because even if it works for some episodes, on the long run it is guaranteed to be a negative reward.", "So why does Q-Learning overestimate?To reply to this question we consider the following scenario:Let X1 and X2 two random variables that represent the reward of two actions at state B. Since they are random variables, we will compute their expected values E(X1) and E(X2). There is a problem though, we don\u2019t know their expected values, so what we can do is use estimates of those expected values by computing incremental average \ud835\udf411 and \ud835\udf412. Those estimates are unbiased because as the number of samples increases, the average over the whole set of values gets closer to E(X1) and E(X2) as it is shown in the table below.", "However, Q-Learning uses Max Q(s\u2019,a), represented in the table by Max(\ud835\udf41). It can be clearly seen from the table (see red cells) that E(Max(\ud835\udf41)) is different than Max E(X). This tells that Max(\ud835\udf41) is not a good estimator for Max E(X). It is biased!In other words, when updating Q(s,a) with Max Q(s\u2019,a), Q(s,a) is not moving towards the expected value of the actions at state B which is -0.5.", "This scenario gives an intuition for why Q-Learning over-estimates the values. Formal mathematical demonstration can be found in the paper.", "The proposed solution is to maintain two Q-value functions QA and QB, each one gets update from the other for the next state.The update consists of finding the action a* that maximises QA in the next state (Q(s\u2019, a*) = Max Q(s\u2019, a)), then use a* to get the value of QB(s\u2019, a*) in order to update QA(s, a).", "The pseudo code below shows how the algorithm behaves. Note that there is a python code at the end of the article that compares the two methods.Line 3 of the algorithm shows how to choose action from the two Q-value functions. For example it is possible to merge the two Q (average the values for each action) then apply epsilon-greedy.", "The algorithm updates both QA and QB in an equiprobable manner.", "The charts below show a comparison between Double Q-Learning and Q-Learning when the number of actions at state B are 10 and 100 consecutively.It is clear that the Double Q-Learning converges faster than Q-learning.Notice that when the number of actions at B increases, Q-learning needs far more training than Double Q-Learning.", "Van Hasselt proves in his paper that E(Q2(s\u2019, a*)) \u2264 Max Q1(s\u2019, a*).So over enough number of experiments the expected value of Q2(s\u2019, a*) is less or equal to Max Q1(s\u2019, a*), which means that Q1(s, a) is not updated with a maximum value.", "The table below shows the evolution of the Q-Values of the Left action at state A as the number of episodes increases.Notice that in Q-Learning, Q(A, Left) is positive because it is affected by the positive rewards that exist at state B. Because of this positive value the algorithm is more interested in taking the Left action hoping to maximize the rewards. As you can see the percentage of left action keeps increasing until 50th episode.In Double Q-Learning Q1(A, Left) and Q2(A, Left) start slightly negative.As a result the percentage of left action starts decreasing very early, thus saving training time.", "The paper shows that Double Q-learning might underestimates the action values at times, but avoids the flaw of the overestimation bias that Q-learning does. It also shows that is this type of problems Double Q-learning reaches good performance levels much more quickly.", "The following Python code simulates both Double Q-Learning and Q-Learning and outputs a table and a comparative graph for the two methods.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa924c4085ec3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://zsalloum.medium.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": ""}, {"url": "https://zsalloum.medium.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Ziad SALLOUM"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f2b933522e2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&user=Ziad+SALLOUM&userId=1f2b933522e2&source=post_page-1f2b933522e2----a924c4085ec3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://rl-lab.com", "anchor_text": "http://rl-lab.com"}, {"url": "https://papers.nips.cc/paper/3964-double-q-learning.pdf", "anchor_text": "Double Q-Learning"}, {"url": "https://towardsdatascience.com/td-in-reinforcement-learning-the-easy-way-f92ecfa9f3ce", "anchor_text": "TD in Reinforcement Learning, the Easy Way"}, {"url": "https://medium.com/p/9350e1523031", "anchor_text": "Q vs V in Reinforcement Learning, the Easy Way"}, {"url": "https://medium.com/p/1b7ed0c030f4", "anchor_text": "Math Behind Reinforcement Learning, the Easy Way"}, {"url": "https://medium.com/@zsalloum/monte-carlo-in-reinforcement-learning-the-easy-way-564c53010511", "anchor_text": "Monte Carlo in Reinforcement Learning, the Easy Way"}, {"url": "https://medium.com/@zsalloum/dynamic-programming-in-reinforcement-learning-the-easy-way-359c7791d0ac", "anchor_text": "Dynamic Programming in Reinforcement Learning, the Easy Way"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a924c4085ec3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/double-q-learning?source=post_page-----a924c4085ec3---------------double_q_learning-----------------", "anchor_text": "Double Q Learning"}, {"url": "https://medium.com/tag/q-learning?source=post_page-----a924c4085ec3---------------q_learning-----------------", "anchor_text": "Q Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----a924c4085ec3---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/temporal-difference?source=post_page-----a924c4085ec3---------------temporal_difference-----------------", "anchor_text": "Temporal Difference"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&user=Ziad+SALLOUM&userId=1f2b933522e2&source=-----a924c4085ec3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&user=Ziad+SALLOUM&userId=1f2b933522e2&source=-----a924c4085ec3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa924c4085ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a924c4085ec3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a924c4085ec3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a924c4085ec3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a924c4085ec3--------------------------------", "anchor_text": ""}, {"url": "https://zsalloum.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://zsalloum.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ziad SALLOUM"}, {"url": "https://zsalloum.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "845 Followers"}, {"url": "https://rl-lab.com", "anchor_text": "https://rl-lab.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f2b933522e2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&user=Ziad+SALLOUM&userId=1f2b933522e2&source=post_page-1f2b933522e2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F408fc441c93b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdouble-q-learning-the-easy-way-a924c4085ec3&newsletterV3=1f2b933522e2&newsletterV3Id=408fc441c93b&user=Ziad+SALLOUM&userId=1f2b933522e2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}