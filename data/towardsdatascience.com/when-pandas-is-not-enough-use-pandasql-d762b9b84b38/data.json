{"url": "https://towardsdatascience.com/when-pandas-is-not-enough-use-pandasql-d762b9b84b38", "time": 1683013028.255074, "path": "towardsdatascience.com/when-pandas-is-not-enough-use-pandasql-d762b9b84b38/", "webpage": {"metadata": {"title": "When Pandas is not enough. Non-Equi Joins with Pandas and PandaSQL | by Rahul Agarwal | Towards Data Science", "h1": "When Pandas is not enough", "description": "Pandas is one of the best data manipulation libraries in recent times. It lets you slice and dice, groupby, join and do any arbitrary data transformation. You can take a look at this post, which\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/minimal-pandas-subset-for-data-scientists-6355059629ae", "anchor_text": "post", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/tagged/python-shorts", "anchor_text": "Python Shorts", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/tagged/python-shorts", "anchor_text": "Python Shorts", "paragraph_index": 19}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/pandasql", "anchor_text": "GitHub", "paragraph_index": 21}, {"url": "https://bit.ly/2XshreA", "anchor_text": "Intermediate level Python", "paragraph_index": 22}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium", "paragraph_index": 23}, {"url": "http://eepurl.com/dbQnuX", "anchor_text": "blog", "paragraph_index": 23}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz", "paragraph_index": 23}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal", "paragraph_index": 26}], "all_paragraphs": ["Pandas is one of the best data manipulation libraries in recent times. It lets you slice and dice, groupby, join and do any arbitrary data transformation. You can take a look at this post, which talks about handling most of the data manipulation cases using a straightforward, simple, and matter of fact way using Pandas.", "But even with how awesome pandas generally is, there sometimes are moments when you would like to have just a bit more. Say you come from a SQL background in which the same operation was too easy. Or you wanted to have more readable code. Or you just wanted to run an ad-hoc SQL query on your data frame. Or, maybe you come from R and want a replacement for sqldf.", "For example, one of the operations that Pandas doesn\u2019t have an alternative for is non-equi joins, which are quite trivial in SQL.", "In this series of posts named Python Shorts, I will explain some simple but very useful constructs provided by Python, some essential tips, and some use cases I come up with regularly in my Data Science work.", "This post is essentially about using SQL with pandas Dataframes.", "Let\u2019s say you have to join two data frames. One shows us the periods where we offer some promotions on some items. And the second one is our transaction Dataframe. I want to know the sales that were driven by promotions, i.e., the sales that happen for an item in the promotion period.", "We can do this by doing a join on the item column as well as a join condition (TransactionDt\u2265StartDt and TransactionDt\u2264EndDt). Since now our join conditions have a greater than and less than signs as well, such joins are called non-equi joins. Do think about how you will do such a thing in Pandas before moving on.", "So how will you do it in Pandas? Yes, a Pandas based solution exists, though I don\u2019t find it readable enough.", "Let\u2019s start by generating some random data to work with.", "You don\u2019t need to worry about the random data generation code above. Just know how our random data looks like:", "Once we have the data, we can do the non-equi join by merging the data on the column item and then filtering by the required condition.", "The result is below just as we wanted:", "The Pandas solution is alright, and it does what we want, but we could also have used PandaSQL to get the same thing done in a much more readable way.", "PandaSQL provides us with a way to write SQL on Pandas Dataframes. So if you have got some SQL queries already written, it might make more sense to use pandaSQL rather than converting them to pandas syntax. To get started with PandaSQL we install it simply with:", "Once we have pandaSQL installed, we can use it by creating a pysqldf function that takes a query as an input and runs the query to return a Pandas DF. Don\u2019t worry about the syntax; it remains more or less constant.", "We can now run any SQL query on our Pandas data frames using this function. And, below is the non-equi join, we want to do in the much more readable SQL format.", "The result is a pandas Dataframe as we would expect. The index is already reset for us, unlike before.", "While the PandaSQL function lets us run SQL queries on our Pandas data frames and is an excellent tool to be aware of in certain situations, it is not as performant as pure pandas syntax.", "When we time Pandas against the more readable PandaSQL, we find that the PandaSQL takes around 10x the time of native Pandas.", "In this post of the Python Shorts series, we learned about pandaSQL, which lets us use SQL queries on our Dataframes. We also looked at how to do non-equi joins using both native pandas as well as pandaSQL.", "While the PandaSQL library is not as performant as native pandas, it is a great addition to our data analytics toolbox when we want to do ad-hoc analysis and to people who feel much more comfortable with using SQL queries.", "For a closer look at the code for this post, please visit my GitHub repository, where you can find the code for this post as well as all my posts.", "If you want to learn more about Python 3, I would like to call out an excellent course on Learn Intermediate level Python from the University of Michigan. Do check it out.", "I am going to be writing more beginner-friendly posts in the future too. Follow me up at Medium or Subscribe to my blog to be informed about them. As always, I welcome feedback and constructive criticism and can be reached on Twitter @mlwhiz.", "Also, a small disclaimer \u2014 There might be some affiliate links in this post to relevant resources, as sharing knowledge is never a bad idea.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "4M Views. Bridging the gap between Data Science and Intuition. MLE@FB, Ex-WalmartLabs, Citi. Connect on Twitter @mlwhiz \u2615\ufe0f ko-fi.com/rahulagarwal"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd762b9b84b38&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mlwhiz.medium.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9----d762b9b84b38---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kunal_au?utm_source=medium&utm_medium=referral", "anchor_text": "Kunal Kalra"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/tagged/python-shorts", "anchor_text": "Python Shorts"}, {"url": "https://towardsdatascience.com/minimal-pandas-subset-for-data-scientists-6355059629ae", "anchor_text": "post"}, {"url": "https://towardsdatascience.com/tagged/python-shorts", "anchor_text": "Python Shorts"}, {"url": "https://github.com/yhat/pandasql", "anchor_text": "PandaSQL"}, {"url": "https://towardsdatascience.com/tagged/python-shorts", "anchor_text": "Python Shorts"}, {"url": "https://github.com/MLWhiz/data_science_blogs/tree/master/pandasql", "anchor_text": "GitHub"}, {"url": "https://bit.ly/2XshreA", "anchor_text": "Intermediate level Python"}, {"url": "https://medium.com/@rahul_agarwal", "anchor_text": "Medium"}, {"url": "http://eepurl.com/dbQnuX", "anchor_text": "blog"}, {"url": "https://twitter.com/MLWhiz", "anchor_text": "@mlwhiz"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d762b9b84b38---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----d762b9b84b38---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/productivity?source=post_page-----d762b9b84b38---------------productivity-----------------", "anchor_text": "Productivity"}, {"url": "https://medium.com/tag/python-shorts?source=post_page-----d762b9b84b38---------------python_shorts-----------------", "anchor_text": "Python Shorts"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d762b9b84b38---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----d762b9b84b38---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&user=Rahul+Agarwal&userId=e8cce06956c9&source=-----d762b9b84b38---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd762b9b84b38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d762b9b84b38---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d762b9b84b38--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d762b9b84b38--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d762b9b84b38--------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mlwhiz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Rahul Agarwal"}, {"url": "https://mlwhiz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13.9K Followers"}, {"url": "http://ko-fi.com/rahulagarwal", "anchor_text": "ko-fi.com/rahulagarwal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe8cce06956c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&user=Rahul+Agarwal&userId=e8cce06956c9&source=post_page-e8cce06956c9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff41165c9f72f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhen-pandas-is-not-enough-use-pandasql-d762b9b84b38&newsletterV3=e8cce06956c9&newsletterV3Id=f41165c9f72f&user=Rahul+Agarwal&userId=e8cce06956c9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}