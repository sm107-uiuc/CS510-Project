{"url": "https://towardsdatascience.com/unittesting-apache-spark-applications-b9a46e319ce3", "time": 1683000872.90492, "path": "towardsdatascience.com/unittesting-apache-spark-applications-b9a46e319ce3/", "webpage": {"metadata": {"title": "Unittesting Apache Spark Applications | by Maria Karanasou | Towards Data Science", "h1": "Unittesting Apache Spark Applications", "description": "Unittesting Spark applications is not that straight-forward. For most of the cases you\u2019ll probably need an active spark session, which means that your test cases will take a long time to run and that\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/holdenk/spark-testing-base/blob/master/python/sparktestingbase/sqltestcase.py", "anchor_text": "SQLTestCase", "paragraph_index": 3}, {"url": "http://buymeacoffee.com/mkaranasou", "anchor_text": "buymeacoffee.com/mkaranasou", "paragraph_index": 19}], "all_paragraphs": ["Unittesting Spark applications is not that straight-forward. For most of the cases you\u2019ll probably need an active spark session, which means that your test cases will take a long time to run and that perhaps we\u2019re tiptoeing around the boundaries of what can be called a unit test. But, it is definitely worth doing it.", "So, should I? Well, yes! Testing your software is always a good thing, and it will most likely save you from many headaches, plus, you\u2019ll be forced to have your code implemented in smaller bits and pieces that\u2019ll be easier to test, thus, gain in readability and simplicity.", "Okay, then what do I need to do this?Well, I\u2019d say we can start with pip install spark-testing-base and work our way from there. We\u2019ll also need pyspark (of course) and unittest (unittest2) and pytest for this \u2014 even though pytest is a personal preference.", "Spark testing base is a collection of base classes to help with spark testing. For this example we\u2019ll be using the base SQLTestCase which inherits from SparkTestingBaseReuse, that creates and reuses a SparkContext.", "From personal experience (using the currently latest spark version 2.4.+), I\u2019ve found that I needed to make some minor adjustments to the SQLTestCase , which is a test case I use quite a lot in my current project. So, here\u2019s an example of the adjustments I\u2019ve made to suit my needs:", "To sum up the changes I\u2019ve made:", "Note that getOrCreate() will create a spark session once and then reuse it through out the test suite.", "Now let\u2019s create a simple feature to be tested:", "This feature simply caclulates a/b where a and b are columns in the input dataframe. Pretty simple and straight-forward. I didn\u2019t include a column check here, because if either a or b are missing, we need the calculation process to fail hard enough to stop everything. But in general, it depends on how you want to handle error cases in your application and how important this calculation is to your process.", "Something to note here: even if you mock the input to calculate dataframe, the spark session will be needed because in our feature\u2019s calculate implementation we are using pyspark.sql.functions like F.col('a') which require you to have an active session. In case we didn\u2019t have the session, we\u2019d get an error like this:", "This is more obvious if, for some reason, we need to declare calculations in the __init__ body (the constructor) of the feature, e.g.:", "Then we\u2019d get the error during the feature instantiation feature = FeatureAToBRatio().", "Let\u2019s now go ahead and add some test cases for this.", "These are just some of the basic test cases one could test for. There are many others that come to mind, e.g. what happens if a is null or a different kind of datatype, but for the example\u2019s sake, let\u2019s keep it simple and clean.", "And that\u2019s it! Notice that it did take 7.58 seconds to run (14.72 seconds when the shuffle partitions are set to the default 200), which is a bit much for unittesting and it\u2019s only 3 test cases \u2014 imagine having a CI/ CD that runs the test suites on every merge or commit\u2026", "Of course, there is a lot more complex testing to be done with spark / pyspark, but I think this is a good base to build upon. Let me know if there\u2019s a better way to do this.", "I hope this was helpful. Any thoughts, questions, corrections and suggestions are very welcome :)", "If you want to know more about how Spark works, take a look at:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A mom and a Software Engineer who loves to learn new things & all about ML & Big Data. Buy me a coffee to help me keep going buymeacoffee.com/mkaranasou"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb9a46e319ce3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@karanasou", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://karanasou.medium.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Maria Karanasou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1570cd236e2d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&user=Maria+Karanasou&userId=1570cd236e2d&source=post_page-1570cd236e2d----b9a46e319ce3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/holdenk/spark-testing-base", "anchor_text": "holdenk/spark-testing-baseBase classes to use when writing tests with Spark. You've written an awesome program in Spark and now its time to write\u2026github.com"}, {"url": "https://github.com/holdenk/spark-testing-base/blob/master/python/sparktestingbase/sqltestcase.py", "anchor_text": "SQLTestCase"}, {"url": "https://medium.com/@achilleus/spark-session-10d0d66d1d24", "anchor_text": "A tale of Spark Session and Spark ContextI have Spark Context, SQL context, Hive context already!medium.com"}, {"url": "https://github.com/holdenk/spark-testing-base/pull/264", "anchor_text": "here"}, {"url": "https://github.com/holdenk/spark-testing-base/issues/268", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/explaining-technical-stuff-in-a-non-techincal-way-apache-spark-274d6c9f70e9", "anchor_text": "Explaining technical stuff in a non-technical way \u2014 Apache SparkWhat is Spark and PySpark and what can I do with it?towardsdatascience.com"}, {"url": "https://towardsdatascience.com/adding-sequential-ids-to-a-spark-dataframe-fa0df5566ff6", "anchor_text": "Adding sequential IDs to a Spark DataframeHow to do it and is it a good idea?towardsdatascience.com"}, {"url": "https://medium.com/tag/apache-spark?source=post_page-----b9a46e319ce3---------------apache_spark-----------------", "anchor_text": "Apache Spark"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----b9a46e319ce3---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/python?source=post_page-----b9a46e319ce3---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----b9a46e319ce3---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b9a46e319ce3---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&user=Maria+Karanasou&userId=1570cd236e2d&source=-----b9a46e319ce3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&user=Maria+Karanasou&userId=1570cd236e2d&source=-----b9a46e319ce3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb9a46e319ce3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b9a46e319ce3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b9a46e319ce3--------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://karanasou.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maria Karanasou"}, {"url": "https://karanasou.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.4K Followers"}, {"url": "http://buymeacoffee.com/mkaranasou", "anchor_text": "buymeacoffee.com/mkaranasou"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1570cd236e2d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&user=Maria+Karanasou&userId=1570cd236e2d&source=post_page-1570cd236e2d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F399ab963554c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Funittesting-apache-spark-applications-b9a46e319ce3&newsletterV3=1570cd236e2d&newsletterV3Id=399ab963554c&user=Maria+Karanasou&userId=1570cd236e2d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}