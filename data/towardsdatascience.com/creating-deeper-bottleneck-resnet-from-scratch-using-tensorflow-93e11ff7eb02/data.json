{"url": "https://towardsdatascience.com/creating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02", "time": 1683013279.089417, "path": "towardsdatascience.com/creating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02/", "webpage": {"metadata": {"title": "Creating Deeper Bottleneck ResNet from Scratch using Tensorflow | by Arjun Sarkar | Towards Data Science", "h1": "Creating Deeper Bottleneck ResNet from Scratch using Tensorflow", "description": "It is seen that often deeper neural networks perform better than shallow neural networks. But, deep neural networks face a common problem, known as the \u2018Vanishing/Exploding Gradient Problem\u2019. To\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "anchor_text": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "paragraph_index": 24}], "all_paragraphs": ["It is seen that often deeper neural networks perform better than shallow neural networks. But, deep neural networks face a common problem, known as the \u2018Vanishing/Exploding Gradient Problem\u2019. To overcome this problem the ResNet network was proposed.", "ResNets contain Residual blocks. As seen in Figure 1, there is an activation \u2018al\u2019 followed by a linear layer with the ReLU non-linearity, \u2018al+1\u2019. It is followed by another linear layer, with another non-linearity, \u2018al+2\u2019. This is what a normal or plain neural network looks like. What ResNet adds to this is the skip-connection. In ResNet, the information from \u2018al\u2019 is fast-forwarded and copied after the linear layer following \u2018al+1\u2019, and before the ReLU non-linearity. This entire block, now with the skip-connection is known as a residual block. Figure 2 shows the residual block, as seen in the original ResNet paper. The skip connections help to skip over almost two layers, to pass its information deeper into the neural network.", "Using residual blocks allowed to train much deeper neural networks. So the authors of the ResNet paper, stacked several of these residual blocks one after the other to form a deep residual neural network, as seen in Figure 3.", "It was seen that when an optimization algorithm such as SGD was used to train a deep plain network, theoretically the training error should have constantly decreased as the number of layers in the neural network increased, but that was not the case practically. After a decrease up to a certain layer, the training error started increasing again. But using residual blocks this problem could be overcome, and the training error kept on decreasing even when the number of layers was significantly increased. This can be seen in Figure 4.", "Figure 5 shows the difference between a common residual block vs a deeper bottleneck residual block. In the common residual block, there are two convolutional layers having 3x3 filters. In the bottleneck architecture, there are 3 convolutional layers instead of 2. The three layers are 1x1, 3x3, and 1x1 convolutions, where the 1x1 layers are responsible for reducing and then increasing (restoring) dimensions, leaving the 3x3 layer a bottleneck with smaller input/output dimensions.", "As seen in Figure 6, the bottleneck residual block has a 1x1 Conv layer followed by Batch Normalization and then ReLU activation, it is followed by a 3x3 Conv layer, followed by Batch Normalization and ReLU, and finally a 1x1 Conv layer with a Batch Normalization. This is connected to the skip connection input, and the final ReLU activation is then applied. This is the first bottleneck layer version (identity block). \u2018f\u2019 represents the number of filters in each Conv layer.", "The second version (Projection) of the bottleneck layer is very similar to the first version, except it has an extra 1x1 Conv layer followed by a Batch Normalization present on the skip connection. The extra Conv layer on the skip connection makes sure that the number of filters on the left side of the residual block is the same as the number of filters on the right side of the residual block. This allows the addition of the input with the residual block without any errors. Also, in case we need to add strides to the left Conv layers to reduce the size of an image, we can make sure that the input from the previous layer also has the same size, by adding a similar number of strides on the Conv layer in the skip connection.", "Importing TensorFlow and all the necessary libraries.", "Function to create the Conv-BatchNorm-ReLU block", "This is the basic building block. It contains a convolutional layer followed by a BatchNormalization which is followed by the ReLU activation function.", "Function to create the Identity bottleneck block", "As we have seen earlier, an identity block contains 3 convolutional layers, and each layer is followed by Batch Normalization and ReLU activation, except the last layer which first adds to the skip connection and only then applied the ReLU activation.", "Also, the first two convolutional layers have the same number of filters, but the last convolutional layer has 4 times the number of filters.", "As seen in Figure 8, \u2018conv2_x\u2019 has 64 filters in its first two convolutional blocks and 64*4=256 filters in the last convolutional block. The same is repeated for all the identity blocks.", "Function to create the Projection block", "The left side of the projection block is similar to the identity block, except that the number of strides is different.", "The right side of the projection block contains the 1x1 convolutional layer with 4 times the number of filters and the same number of strides as the first layer of the left side. This ensures that the original input and the skip connection as the same number of filters and the same strides, without which matrix addition will throw an error.", "Function to create the ResNet block", "In each case, the first block is the projection block and the rest are identity blocks. So for \u2018conv2_x\u2019, the first block is a projection block and the other two repetitions are identity blocks.", "The reason the first block is projection is to make sure, that the strides and the number of filters of the input from skip connection and the actual output of the block are the same. In the projection block, the first convolutional layer has strides=2. This means that if the input is an image, the size of the image after this layer will decrease. But the input in skip connection still has the previous image size. Adding two images of different sizes is not possible. So the skip connection also has a convolutional layer with stride=2. This makes sure that the image sizes are now the same.", "In the following repetitions, strides are set to 1, so the image size remains the same, and there is no need for a projection block. Hence except for the first repetition of each ResNet block, all the other repetitions use Identity blocks.", "Now that all the blocks are ready, the model can now be created following Figure 8.", "The Entire code to create a ResNet 50 from scratch using Tensorflow:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. student \u2014 Deep Learning on Biomedical Images at the Leibniz Institute-HKI, Germany. LinkedIn-https://www.linkedin.com/in/arjun-sarkar-9a051777/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F93e11ff7eb02&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://arjun-sarkar786.medium.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Arjun Sarkar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa31366b2eda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&user=Arjun+Sarkar&userId=fa31366b2eda&source=post_page-fa31366b2eda----93e11ff7eb02---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "https://arxiv.org/abs/1512.03385"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "arXiv:1512.03385"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----93e11ff7eb02---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----93e11ff7eb02---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----93e11ff7eb02---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----93e11ff7eb02---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----93e11ff7eb02---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&user=Arjun+Sarkar&userId=fa31366b2eda&source=-----93e11ff7eb02---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&user=Arjun+Sarkar&userId=fa31366b2eda&source=-----93e11ff7eb02---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F93e11ff7eb02&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----93e11ff7eb02---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----93e11ff7eb02--------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://arjun-sarkar786.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Arjun Sarkar"}, {"url": "https://arjun-sarkar786.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "517 Followers"}, {"url": "https://www.linkedin.com/in/arjun-sarkar-9a051777/", "anchor_text": "https://www.linkedin.com/in/arjun-sarkar-9a051777/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa31366b2eda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&user=Arjun+Sarkar&userId=fa31366b2eda&source=post_page-fa31366b2eda--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F25711c8db9ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcreating-deeper-bottleneck-resnet-from-scratch-using-tensorflow-93e11ff7eb02&newsletterV3=fa31366b2eda&newsletterV3Id=25711c8db9ff&user=Arjun+Sarkar&userId=fa31366b2eda&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}