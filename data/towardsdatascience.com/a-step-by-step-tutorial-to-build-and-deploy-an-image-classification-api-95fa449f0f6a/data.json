{"url": "https://towardsdatascience.com/a-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a", "time": 1683004359.392446, "path": "towardsdatascience.com/a-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a/", "webpage": {"metadata": {"title": "A Step-By-Step tutorial to build and deploy an image classification API | by Youness Mansar | Towards Data Science", "h1": "A Step-By-Step tutorial to build and deploy an image classification API", "description": "Our objective in this small project is to build an image classification API from scratch. We are going to go through all the steps needed to achieve this objective : One of the most important parts\u2026"}, "outgoing_paragraph_urls": [{"url": "https://unsplash.com/", "anchor_text": "Unsplash", "paragraph_index": 4}, {"url": "https://github.com/wkentaro/labelme", "anchor_text": "LabelMe,", "paragraph_index": 6}, {"url": "https://github.com/CVxTz/ToyImageClassificationDataset", "anchor_text": "https://github.com/CVxTz/ToyImageClassificationDataset", "paragraph_index": 7}, {"url": "https://blog.machinebox.io/deploy-docker-containers-in-google-cloud-platform-4b921c77476b", "anchor_text": "here", "paragraph_index": 30}, {"url": "https://github.com/CVxTz/FastImageClassification", "anchor_text": "https://github.com/CVxTz/FastImageClassification", "paragraph_index": 33}], "all_paragraphs": ["Our objective in this small project is to build an image classification API from scratch.We are going to go through all the steps needed to achieve this objective :", "One of the most important parts of any machine learning project is the quality and quantity of the annotated data. It is one of the key factors that will influence the quality of the predictions when the API is deployed.", "In this project we will try to classify an input image into four classes :", "I choose those classes because it is easy to find tons of images representing them online. We use those classes to define a multi-label classification problem :", "Now that we have defined the problem we want to solve we need to get a sufficient amount of labeled samples for training and evaluation. To do that we will first use the Unsplash API to get URLs of images given multiple search queries.", "We would try to get image URLs that are related to our target classes plus some other random images that will serve as negative examples.", "The next step is to go through all the images and assign a set of labels to each one of them, like what is shown in the figure above. For this it is always easier to use annotations tools that are designed for this task like LabelMe, it is a python library that you can run easily from the command line:", "Using Labelme I labeled around a thousand images and made the urls+labels available here: https://github.com/CVxTz/ToyImageClassificationDataset", "Now that we have the labeled samples we can try building a classifier using Tensorflow. We will use MobileNet_V2 as the backbone of the classifier since it is fast and less likely to over-fit given the tiny amount of labeled samples we have, you can easily use it by importing it from keras_applications :", "Since it is a multi-label classification problem with four classes, we will have an output layer of four neurons with the Sigmoid activation ( given an example, we can have multiple neurons active or no neuron active as the target)", "One commonly used trick to tackle the lack of labeled samples is to use transfer learning. It is when you transfer some of the weights learned from a source task ( like image classification with a different set of labels) to your target task as the starting point of your training. This allows for a better initialization compared to starting from random and allows for reusing some of the representations learned on the source task for our multi-label classification.", "Here we will transfer the weights that resulted from training in ImageNet. Doing this is very easy when using Tensorflow+Keras for MobileNet_V2, you just need to specify weights=\u201dimagenet\u201d when creating an instance of MobileNetV2", "Another trick to improve performance when having a small set of annotated samples is to do data augmentation. It is the process of applying random perturbations that preserve the label information ( a picture of a city after the perturbations still looks like a city ). Some common transformations are vertical mirroring, salt and pepper noise or blurring.", "To achieve this we use a python package called imgaug and define a sequence of transformation along with their amplitude :", "We split the dataset into two folds, training and validation and use the binary_crossentropy as our target along with the binary_accuracy as the evaluation metric.", "We run the training from the command line after updating some configuration files :", "Then running the training script :", "We end up with a validation binary accuracy of 94%", "We will be using FastAPI to expose a predictor through an easy to use API that can take as input an image file and outputs a JSON with the classification scores for each class.", "First, we need to write a Predictor class that can easily load a tensorflow.keras model and have a method to classify an image that is in the form of a file object.", "We can use a configuration file to instantiate a predictor object that has all the parameters to do predictions and will download the model from the GitHub repository of the project :", "After doing all of this, the main file of our API becomes trivial when using FastAPI :", "We can now run the app with a single command :", "This gives us access to Swagger UI where we can try out our API on a new file.", "Uploading the image above gives up the following output :", "We can also send a request via curl and time it :", "Its easier to deploy an app if it is inside a container like Docker.", "We will create a Dockerfile with all the instructions needed to run our app after installing the correct environment :", "Then we can run the Docker build :", "We finally run the container while mapping the port 8080 of container to that of the host :", "I tried to do this on an ec2 instance from AWS but the ssh command line was clunky and the terminal would freeze at the last command, no idea why. So I decided to do the deployment using Google Cloud Platform\u2019s App engine. Link to a more detailed tutorial on the subject here.", "The last command will take a while but \u2026 Voilaaa!", "In this project, we built and deployed machine-learning powered image classification API from scratch using Tensorflow, Docker, FastAPI and Google Cloud Platform\u2018s App Engine. All those tools made the whole process straightforward and relatively easy. The next step would be to explore questions related to security and performance when handling a large number of queries.", "Code to reproduce the results is available here: https://github.com/CVxTz/FastImageClassification", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F95fa449f0f6a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@CVxTz?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@CVxTz?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Youness Mansar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F830ca2245343&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&user=Youness+Mansar&userId=830ca2245343&source=post_page-830ca2245343----95fa449f0f6a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@tuannguyenminh?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Tu\u00e2n Nguy\u1ec5n Minh"}, {"url": "https://unsplash.com/s/photos/build?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/", "anchor_text": "https://unsplash.com/"}, {"url": "https://unsplash.com/", "anchor_text": "Unsplash"}, {"url": "https://github.com/yakupadakli/python-unsplash", "anchor_text": "https://github.com/yakupadakli/python-unsplash"}, {"url": "https://unsplash.com/documentation", "anchor_text": "https://unsplash.com/documentation"}, {"url": "https://github.com/wkentaro/labelme", "anchor_text": "LabelMe,"}, {"url": "https://github.com/CVxTz/ToyImageClassificationDataset", "anchor_text": "https://github.com/CVxTz/ToyImageClassificationDataset"}, {"url": "https://unsplash.com/", "anchor_text": "https://unsplash.com/"}, {"url": "http://127.0.0.1:8000/docs", "anchor_text": "http://127.0.0.1:8080/docs"}, {"url": "https://unsplash.com/@antonioresendiz_?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Antonio Resendiz"}, {"url": "https://unsplash.com/s/photos/city?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://127.0.0.1:8000/scorefile/", "anchor_text": "http://127.0.0.1:8080/scorefile/"}, {"url": "http://twitter.com/antonio", "anchor_text": "@antonio"}, {"url": "https://blog.machinebox.io/deploy-docker-containers-in-google-cloud-platform-4b921c77476b", "anchor_text": "here"}, {"url": "https://github.com/CVxTz/FastImageClassification", "anchor_text": "https://github.com/CVxTz/FastImageClassification"}, {"url": "https://github.com/CVxTz/FastImageClassification", "anchor_text": "https://github.com/CVxTz/FastImageClassification"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----95fa449f0f6a---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deployment?source=post_page-----95fa449f0f6a---------------deployment-----------------", "anchor_text": "Deployment"}, {"url": "https://medium.com/tag/docker?source=post_page-----95fa449f0f6a---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----95fa449f0f6a---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----95fa449f0f6a---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&user=Youness+Mansar&userId=830ca2245343&source=-----95fa449f0f6a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&user=Youness+Mansar&userId=830ca2245343&source=-----95fa449f0f6a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F95fa449f0f6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----95fa449f0f6a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----95fa449f0f6a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@CVxTz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@CVxTz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Youness Mansar"}, {"url": "https://medium.com/@CVxTz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "425 Followers"}, {"url": "https://www.linkedin.com/in/mansar/", "anchor_text": "https://www.linkedin.com/in/mansar/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F830ca2245343&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&user=Youness+Mansar&userId=830ca2245343&source=post_page-830ca2245343--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7e379bdcb386&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-step-by-step-tutorial-to-build-and-deploy-an-image-classification-api-95fa449f0f6a&newsletterV3=830ca2245343&newsletterV3Id=7e379bdcb386&user=Youness+Mansar&userId=830ca2245343&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}