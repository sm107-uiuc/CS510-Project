{"url": "https://towardsdatascience.com/managing-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df", "time": 1683013387.55427, "path": "towardsdatascience.com/managing-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df/", "webpage": {"metadata": {"title": "Managing dependencies between data pipelines in Apache Airflow & Prefect | by Anna Geller | Towards Data Science", "h1": "Managing dependencies between data pipelines in Apache Airflow & Prefect", "description": "Many workflow schedulers let us manage dependencies within a single data pipeline. But what if you have dependencies BETWEEN workflows? In this article, I show one easy way of organizing data pipelines and their dependencies."}, "outgoing_paragraph_urls": [{"url": "https://www.manning.com/books/data-pipelines-with-apache-airflow", "anchor_text": "book", "paragraph_index": 2}, {"url": "https://www.astronomer.io/guides/subdags/", "anchor_text": "another quote", "paragraph_index": 5}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/sensors/external_task_sensor/index.html", "anchor_text": "sensor", "paragraph_index": 7}, {"url": "https://airflow.apache.org/docs/stable/_modules/airflow/operators/dagrun_operator.html", "anchor_text": "TriggerDagRunOperator", "paragraph_index": 9}, {"url": "https://github.com/PrefectHQ/prefect/issues/1745", "anchor_text": "this Github issue", "paragraph_index": 28}, {"url": "http://www.annageller.com", "anchor_text": "www.annageller.com", "paragraph_index": 35}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe", "paragraph_index": 35}], "all_paragraphs": ["If you ever built data pipelines for co-dependent business processes, you might have noticed that incorporating all of your company\u2019s business logic into one single workflow does not work well and quickly turns into a maintenance nightmare. Many workflow scheduling systems let us manage dependencies within a single data pipeline but they don\u2019t support us in managing dependencies between workflows.", "A natural way of resolving this problem would be to split a large pipeline into many smaller ones and coordinate the dependencies between them in some parent-child relationship. However, there are many possible ways of addressing this problem and I want to share one simple approach that worked well for me. I hope it might help you to manage dependencies between your data pipelines.", "Within the book about Apache Airflow [1] created by two data engineers from GoDataDriven, there is a chapter on managing dependencies. This is how they summarized the issue:", "\u201cAirflow manages dependencies between tasks within one single DAG, however it does not provide a mechanism for inter-DAG dependencies.\u201d", "The general problem of organizing co-dependent data pipelines is well-known and one way of how people tried to address it, was to use the SubDag abstraction. Organizing workflows into SubDags initially seemed like a great idea, but quickly resulted in many problems:", "Here is another quote [2] which nicely summarizes the discussion on the usefulness of SubDags:", "Astronomer highly recommends staying away from SubDags.", "Another idea was to use a sensor within the parent DAG which regularly pokes for the execution state of a child DAG. This seems like a better idea than SubDags. However, it only works if the schedules between the parent DAG and the child DAG are aligned, which is a very strong assumption that in my case almost never was true. Imagine what will happen when you manually trigger this parent DAG? It will run forever until it times out because the child DAG does not run on the same schedule.", "Another way of looking at it would be to trigger the child DAG from the parent DAG. I like this idea much more, because:", "When I tried it in Airflow, though, I found that the current implementation of TriggerDagRunOperator works in a fire-and-forget way. This means that the parent DAG doesn\u2019t wait until the triggered child DAG is finished before starting the next task! This is not what we want if we wish to manage dependencies between data pipelines.", "To illustrate this, let\u2019s look at the following pipeline:", "If we use TriggerDagRunOperator for the business logic layer in the parent DAG, it would trigger a DagRun for this child DAG, but then it would immediately start the data mart task before waiting until all bus_logic_ETL_x tasks in the child DAG are finished.", "This is the implementation of the sensor:", "And this is how I used this sensor in the parent DAG:", "Prefect includes many useful abstractions that work out of the box. One of them is FlowRunTask, which includes a parameter wait=True that will have the same effect as my WaitForCompletion in Airflow without me having to implement any sensor performing periodic database-lookups. This will:", "The entire implementation of the parent flow is as simple as that:", "If we visualize this flow by running flow.visualize, we can see that the child flows are even visualized differently to easily distinguish between normal task vs. Flow triggered by FlowRunTask (or some other type of task such as ex. mapped tasks).", "I also created some very basic child flows so that we can run a full example and see the output in the UI. In the scripts below, you can see three child flows, each with three tasks:", "Let\u2019s now run the full example by registering the parent flow (MasterFlow) and the three child flows and confirm that the dependencies between flows work as expected.", "We can confirm that the dependencies have been respected and data mart started running only after both staging area and business logic layer flows were completed.", "If something would fail, we could easily navigate to the respective child flow to inspect the logs:", "In order to properly structure and schedule those parent-child dependencies, we can use \u201cMaster\u201d data pipelines (one could also call it \u201cparent data pipeline\u201d or \u201ccoordinating data pipeline\u201d), as shown in the example above, and schedule only those parent pipelines. Since child flows are triggered directly from the parent flow, they don\u2019t need to be scheduled.", "Let\u2019s show it on a concrete example. Let\u2019s assume that currently, those child flows have the following execution runtimes:", "This means that if we schedule the MasterFlow to run at 2 AM at night, it will start by running staging_area at 2 AM and then the business_logic will start at 4:30 AM and the data_mart will start at 6 AM and the entire ETL will be finished by 8 AM.", "To implement this, we simply add a schedule on lines 6 and 9 to the MasterFlow as follows:", "Note: this schedule works in UTC. To use a time zone specific schedule, use:", "Let\u2019s say that you want to modify the business logic layer and add one more task to it: by using this approach, you can make your modifications without any impact on the staging area and data mart workflows. You don\u2019t need to reschedule anything and you won\u2019t get stuck in any deadlocks.", "Overall, I found the Prefect implementation easier, as I didn\u2019t have to write any custom sensor logic to properly reflect the dependencies between data pipelines and it works out of the box. It shows a lot of foresight in the design of those abstractions.", "Prefect community was also discussing SubFlows in this Github issue [3]\u2014 follow along if you are interested.", "In this article, we looked at how to manage dependencies between data pipelines. We demonstrated how this problem was historically approached by Airflow.", "Then, I presented a simple solution to this problem, which is based on a principle: create a master data pipeline which schedules and triggers the child workflows, while ensuring that when triggered, the master data pipeline waits until the child workflow is completed before triggering the next one.", "The \u201ctrigger + wait\u201d paradigm seems to be much safer than aligning the co-dependent pipelines on their schedules and let us manage the dependencies between workflows in a simple way.", "Thank you for reading! If this article was helpful, feel free to follow me for the next articles.", "[1] \u201cData Pipelines with Apache Airflow\u201d \u2014 Bas P. Harenslak and Julian Rutger de Ruiter", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "DevRel, Data Professional, Cloud & .py fan. www.annageller.com. Get my articles via email: https://annageller.medium.com/subscribe"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff4eba65886df&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://annageller.medium.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd----f4eba65886df---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kellysikkema?utm_source=medium&utm_medium=referral", "anchor_text": "Kelly Sikkema"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.manning.com/books/data-pipelines-with-apache-airflow", "anchor_text": "book"}, {"url": "https://www.astronomer.io/guides/subdags/", "anchor_text": "another quote"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/sensors/external_task_sensor/index.html", "anchor_text": "sensor"}, {"url": "https://airflow.apache.org/docs/stable/_modules/airflow/operators/dagrun_operator.html", "anchor_text": "TriggerDagRunOperator"}, {"url": "https://github.com/PrefectHQ/prefect/issues/1745", "anchor_text": "this Github issue"}, {"url": "https://www.astronomer.io/guides/subdags/", "anchor_text": "https://www.astronomer.io/guides/subdags/"}, {"url": "https://github.com/PrefectHQ/prefect/issues/1745", "anchor_text": "https://github.com/PrefectHQ/prefect/issues/1745"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----f4eba65886df---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/programming?source=post_page-----f4eba65886df---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----f4eba65886df---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/data-science?source=post_page-----f4eba65886df---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data?source=post_page-----f4eba65886df---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&user=Anna+Geller&userId=5bdf5a3385cd&source=-----f4eba65886df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&user=Anna+Geller&userId=5bdf5a3385cd&source=-----f4eba65886df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff4eba65886df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f4eba65886df---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f4eba65886df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f4eba65886df--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f4eba65886df--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f4eba65886df--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f4eba65886df--------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://annageller.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anna Geller"}, {"url": "https://annageller.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5.4K Followers"}, {"url": "http://www.annageller.com", "anchor_text": "www.annageller.com"}, {"url": "https://annageller.medium.com/subscribe", "anchor_text": "https://annageller.medium.com/subscribe"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5bdf5a3385cd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&user=Anna+Geller&userId=5bdf5a3385cd&source=post_page-5bdf5a3385cd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F908ff40c4340&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmanaging-dependencies-between-data-pipelines-in-apache-airflow-prefect-f4eba65886df&newsletterV3=5bdf5a3385cd&newsletterV3Id=908ff40c4340&user=Anna+Geller&userId=5bdf5a3385cd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}