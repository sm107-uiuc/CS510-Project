{"url": "https://towardsdatascience.com/de-coding-random-forests-82d4dcbb91a1", "time": 1682994038.86449, "path": "towardsdatascience.com/de-coding-random-forests-82d4dcbb91a1/", "webpage": {"metadata": {"title": "De(Coding) Random Forests. Building your Random Forest from\u2026 | by Sonali Dasgupta | Towards Data Science", "h1": "De(Coding) Random Forests", "description": "Motivation: Random Forest Ensembles are widely used for real-world machine learning problems, Classification as well as Regression. Their popularity can be attributed to the fact that practitioners\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/SonaliDasgupta/MLandAIAlgorithmsFromScratch/blob/master/kernel.ipynb", "anchor_text": "https://github.com/SonaliDasgupta/MLandAIAlgorithmsFromScratch", "paragraph_index": 33}], "all_paragraphs": ["Motivation: Random Forest Ensembles are widely used for real-world machine learning problems, Classification as well as Regression. Their popularity can be attributed to the fact that practitioners often get optimal results using a Random Forest algorithm with minimal data cleaning, and no feature scaling. For a better grasp of the underlying principles, I decided to code a Random Forest from scratch, and perform a few visualizations of different features in the data, and their role in deciding the final result. Widely believed to be a black box, a quick walk-through of the algorithm will prove it is actually quite interpretable, apart from being a powerful technique leveraging the \u2018power of the majority vote\u2019.", "Random Forest Ensembles are a divide-and-conquer approach used to improve performance of individually weak Decision Tree models. The main principle behind this is that a group of \u201cweak learners\u201d can come together to form a \u201cstrong learner\u201d. Each classifier, individually, is a \u201cweak learner,\u201d while all the classifiers taken together are a \u201cstrong learner\u201d.", "At the heart of the Random Forest concept is averaging the results from a number of Decision Trees. Decision Trees are often handy tools to explain the intuition behind a prediction to people unfamiliar with Machine Learning. But explaining how a Random Forest arrived at a prediction, and using which features or independent variables, can be quite a task. Random Forests are often misinterpreted as \u2018Black Boxes\u2019 or difficult to understand.", "The following section is a walk-through to coding and optimizing a Random Forest from scratch, and gaining an in-depth understanding of the way Random Forests work. We also look at understanding how and why certain features are given more weightage than others when it comes to predicting the results.", "Using an Object oriented Programming approach in Python , a class \u2018RandomForest\u2019 is defined,comprised of \u2018DecisionTree\u2019 objects. The Random Forest is basically a collector and average calculator for each of the core functions performed by its Decision Trees.", "The fit() method in Random Forest class is called for training the model, which calls function var_split() in the Decision Tree class, which calls find_better_split() in a loop. This constructs each of the member Decision Trees in the forest, and fits the training data for each tree.", "The Decision Tree recursively splits into the left and right sub-trees after finding a feature which will maximize the homogeniety at each split. This is done by a two-loop logic:", "The code for predicting results using the model is pretty self-explanatory.", "Note: Averaging the predictions is a good technique for a Random Forest Regressor, however for a Random Forest Classifier, considering the frequency of predictions of the trees and choosing the prediction value with the maximum frequency is the way to go.", "We now have the basic structure of our own library for a Random Forest Ensemble. Let us add the super-useful enhancements of Feature Interaction and Tree Interpretation, which are important concepts to help interpret a Random Forest.", "To find how much say a particular feature has in deciding the predictions of the model, the following approach has been followed:", "If randomly shuffling values for a particular feature brings the model performance drastically down, we can say that this feature is surely used in a split, comparatively higher up in the tree, and is important. This technique has been used for each feature by looping through the features, in my implementation.", "Pretty visualizations such as Bar Charts can be plotted for features and their corresponding importances, to interpret the weightage given to different features by our Random Forest Model.", "Partial Dependence Plots are especially useful to understand how the result or target variable varies with a particular feature, and what is the actual relationship between the target and this feature. Is it monotonically increasing / decreasing or irregular ?", "If we look at a typical Univariate plot for finding the effect of a feature on the target variable, we seldom see a continuous upward / downward curve or a straight line. Univariate plots are usually irregular.", "As an example, consider you are working on a housing dataset and want to predict house prices, given a set of features including the year the house was built in, the locality and other features. If you plot a univariate plot of the price against the year built, you would expect a continuous upward curve because real estate prices usually increase with time. But the plot turns out to go downward between some years. This would falsely lead you to believe that those few years were bad years for house prices.", "Whereas, it could have been the case that the majority of houses bought during those years were in a locality which was relatively cheaper, and hence the decline in the curve.", "A Partial Dependence Plot would solve this problem, and show the true relationship between the prices and the years , and you would find them to be continually increasing after all. This is due to the reason that in Partial Dependence Plots, we consider only the feature under consideration to be varying, ensuring all the other features remain constant. Thus we cut out the noise from other dependent variables, and get a better understanding of the true nature of interactions of each feature with the target variable.", "My implementation of Partial Dependence Plot is in the following manner:", "Keeping other columns constant and varying the feature to calculate dependence on, is the key to solving the problem of noise from external sources creeping into the depiction of the relation between the feature and the target.", "A very useful technique of explaining the flow of Random Forest predictions is through using Tree Interpreters for each of the Decision Trees.", "\u00b7 The value at the root of the tree (which is simply an average value of all the targets in training data) is called \u2018Bias\u2019.", "\u00b7 The predict() function inside the Tree Interpreter class, calls the predict_row_for_ti() function inside a decision tree, which predicts the result for a \u2018row\u2019 or a single data sample.", "\u00b7 At each split, the contribution of the feature used in the split is calculated using the amount by which the average of samples would vary after splitting into the sub-trees.", "\u00b7 The feature contributions are stored in an array till a leaf is arrived at, and the results are then returned to the Tree Interpreter.", "\u00b7 At the leaf node, the prediction value for that data sample is returned, along with the bias and \u2018contribs\u2019, which are contributions of each feature towards the final result.", "The contributions provided by each feature for arriving at the leaf node (final result) can be visualized using a Waterfall Chart, using the recent \u2018waterfall\u2019 package in python.", "A Waterfall Chart is one of the most effective ways to visualize the contributions of each feature, starting from the root of a tree, till the final result in the leaf node.", "A few areas in which further enrichment to the Random Forest library needs to be done are as follows:", "\u00b7 Building on the Tree Interpretation , work needs to be done on correlations of features in Random Forest, by finding groups of features which are commonly used in successive splits frequently, and hence might have higher correlations.", "\u00b7 This would be the second way of exploring feature interactions in Random Forests, the first way being the Partial Dependence plots which can be extended to more than one feature.", "Note: Standard Machine Learning libraries in Python are highly optimized for speed and efficiency, due to which any code you write from scratch might need to be executed in Cython (underlying C implementation used by Python) to achieve faster results. For this, simply add \u2018%%cython\u2019 to the beginning of your code.", "This is a good starting point to coding Machine Learning Algorithms from scratch, and also understanding a few super useful libraries in Python, including Numpy for speedy mathematical calculations, and Matplotlib for Data Visualization.", "The full implementation can be found in my Jupyter Notebook at https://github.com/SonaliDasgupta/MLandAIAlgorithmsFromScratch where I have tried to play around with ideas and visualizations using a dataset. The code has to be further refined and optimized, and I am working on it. Any suggestion or contributions are highly welcome.", "This was a very enjoyable exercise for me and I hope I have helped you dive deeper mathematically and visually into the Random Forest implementation, and to understand that it is not as complex or \u2018Black Box\u2019 as it seems after all.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F82d4dcbb91a1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@sonalidasgupta95.2011?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sonalidasgupta95.2011?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Sonali Dasgupta"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcc27adac5819&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&user=Sonali+Dasgupta&userId=cc27adac5819&source=post_page-cc27adac5819----82d4dcbb91a1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/SonaliDasgupta/MLandAIAlgorithmsFromScratch/blob/master/kernel.ipynb", "anchor_text": "https://github.com/SonaliDasgupta/MLandAIAlgorithmsFromScratch"}, {"url": "http://blog.citizennet.com/blog/2012/11/10/random-forests-ensembles-and-performance-metrics", "anchor_text": "http://blog.citizennet.com/blog/2012/11/10/random-forests-ensembles-and-performance-metrics"}, {"url": "https://course.fast.ai/ml.html", "anchor_text": "https://course.fast.ai/ml.html"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----82d4dcbb91a1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/random-forest?source=post_page-----82d4dcbb91a1---------------random_forest-----------------", "anchor_text": "Random Forest"}, {"url": "https://medium.com/tag/ensemble-learning?source=post_page-----82d4dcbb91a1---------------ensemble_learning-----------------", "anchor_text": "Ensemble Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----82d4dcbb91a1---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----82d4dcbb91a1---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&user=Sonali+Dasgupta&userId=cc27adac5819&source=-----82d4dcbb91a1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&user=Sonali+Dasgupta&userId=cc27adac5819&source=-----82d4dcbb91a1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F82d4dcbb91a1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----82d4dcbb91a1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----82d4dcbb91a1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sonalidasgupta95.2011?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@sonalidasgupta95.2011?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sonali Dasgupta"}, {"url": "https://medium.com/@sonalidasgupta95.2011/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "24 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcc27adac5819&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&user=Sonali+Dasgupta&userId=cc27adac5819&source=post_page-cc27adac5819--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fcc27adac5819%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fde-coding-random-forests-82d4dcbb91a1&user=Sonali+Dasgupta&userId=cc27adac5819&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}