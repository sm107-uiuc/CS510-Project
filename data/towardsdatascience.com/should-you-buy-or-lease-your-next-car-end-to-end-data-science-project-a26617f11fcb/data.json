{"url": "https://towardsdatascience.com/should-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb", "time": 1683009052.450259, "path": "towardsdatascience.com/should-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb/", "webpage": {"metadata": {"title": "Should you Buy or Lease your Next Car? End-to-End Project | by Luke Newman | Towards Data Science", "h1": "Should you Buy or Lease your Next Car? End-to-End Project", "description": "In this post we will walk through an entire data science project from end-to-end and come up with a conclusion to the question\u2013\u2013should you buy or lease your next car? The project will include the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/lukenew2/automobile-depreciation/tree/master/leases", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/lukenew2/car-leases/blob/master/collect_data_webscraping.ipynb", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://github.com/lukenew2/car-leases/blob/master/buy_or_lease.ipynb", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://www.linkedin.com/in/lukenewman-/", "anchor_text": "https://www.linkedin.com/in/lukenewman-/", "paragraph_index": 66}], "all_paragraphs": ["In this post we will walk through an entire data science project from end-to-end and come up with a conclusion to the question\u2013\u2013should you buy or lease your next car?", "The project will include the following sections (feel free to skip ahead to any section your most interested in):", "To view the project on Github click the following link here!", "The goal of this project is to determine whether car leases are a good deal by comparing the total expense of a lease with the depreciation cost of a car. If the lease is more expensive we can conclude that it is more cost effective to buy the car new and resell it. However, if the lease is less expensive than we conclude you should lease instead of buy.", "By using machine learning we predict the price of cars and use it to calculate the depreciation cost with which we compare to the cost of its lease.", "The metric we use is Root-Mean-Squared-Error (RMSE) because it gives an idea of how much error the system typically makes in its predictions, with a higher weight for large errors.", "So now we need data. Instead of collecting data on hundreds of different cars we only collect data on one of the best rated cars to lease, the Acura TLX. This helps us simplify the problem and if we conclude that you should buy instead of lease this car, we can conclude the same for lower rated cars.", "In this project we collect our data using BeautifulSoup\u2019s library. We webscrape Acura TLX car listings off of Truecar.com. The notebook complete with code used for webscraping can be found here.", "The code for the rest of the project can be viewed here.", "Let\u2019s load in the data we collected by webscraping and take a first initial look into it.", "Let\u2019s see how complete our dataset is. By looking at the percentage of null values for each column we can get a good idea of how many missing values we are dealing with.", "We see there are missing values in 6 of our columns. Specifically in our target variable Price and attributes Drive, Engine, Trim, Exterior color, and Interior Color. Since Price is our target variable we will have to drop those instances. Since Drive, Engine, and Trim have a very low missing value percentage it should be okay to drop the instances pertaining to those instances as well. Since Exterior and Interior color are more than 10% null and probably won\u2019t have much predictive power on price we will go ahead and drop those columns as well from the dataset.", "We use a stratified split here to ensure our test set is as representative of the various ratios in the whole dataset. Since we believe certain features like the year of the car will be very important predictors of price we ensure that they are evenly distributed between the training and test set. By using a stratified split we avoid a sampling bias where the test is not representative of the whole dataset.", "The following code uses the pd.cut() function to create a year category attribute with 6 categories (labeled from 0 to 5 and corresponding to each year in the dataset):", "Now we are ready to do stratified sampling based on the year attribute. For this we can use Scikit-Learn\u2019s StratifiedShuffleSplit() class:", "Now we remove the Year_cat attribute so the data is back to its original state:", "Let us now discover and visualize the data to get a feel of what it looks like and gain insights. We create a copy of the training set so we can play with it without harming the original training set:", "Below is a table with the columns, data type, and a short description detailing what information they hold.", "We will start by looking at the numerical data types and computing the standard correlation coefficient between every pair of attributes using the corr() method:", "Now let\u2019s look at how much each attribute correlates with the price:", "Another way to check for correlation between attributes is to use pandas scatter_matrix() function, which plots every numerical attribute against every other numerical attribute.", "The figure above shows us a couple things. Indeed the attributes year and mileage are going to be very strong predictors of price and show some interaction that we might be able to capture by creating a new feature, miles per year. Also, there is not many instances with 3 accidents. It might be beneficial to group cars with 2 or 3 accidents into one value of 2 or more.", "To create the miles per year attribute we need to know how many years old the car is instead of the year. We achieve this through taking the absolute value of the current year subtracted from the year of the car. However, we won\u2019t be able to divide by 0 for 2020 Acura TLXs so we will replace 0s with 1s (in this case the attribute miles_per_year will be the same as mileage).", "Now let\u2019s look at the correlation of our target price with the new attribute:", "Great! we see it is strongly correlated with the price as well!", "One last interesting column I want to look at is Trim. This column contains a lot of information including the type of performance package on the car. It might be beneficial to extract the package and use it as an attribute instead. Let\u2019s observe the correlation between different trims and median price.", "Now let\u2019s extract the package and see if there is any obvious correlation between packages.", "Extracting the package does not seem very helpful. The correlation is weak between different packages and does not follow any trends we expect.", "Now we have a pretty good idea of which features will be the most valuable and have explored relations between them. Some important findings were:", "It\u2019s time to prepare the data for Machine Learning algorithms. Instead of doing this manually, we write functions for this purpose, for several good reasons:", "We need a preparation pipeline for numerical attributes and categorical attributes. Let\u2019s start with the numerical attributes!", "Since we are using Scikit-Learn we want our transformers to work seamlessly with Scikit-Learn functionalities (such as pipelines), but thankfully for us all we need to do is create a class and implement three methods: fit() (which returns self), transform(), and fit_transform(). We get the last one for free by simply adding TransformerMixin as a base class.", "We also add BaseEstimator as a base class which gives us two extra methods (get_params() and set_params()) that will be useful for automatic hyperparameter tuning.", "For example, here is a transformer class that adds the numerical attributes which were discussed earlier and its output when we pass it our training set.", "Now after we add new attributes we want to select which attributes we use in our machine learning algorithms. We use the same method as above to create a custom transformer that will select the attributes.", "As you can see, there are many data transformation steps that need to be executed in the right order. Fortunately, Scikit-Learn provides the Pipeline class to help with sequences of transformations. Here is the pipeline for the numerical attributes:", "We used our two custom transformers from above and then Scikit-Learn\u2019s StandardScaler() transformer to standardize all numerical attributes.", "Now the next step is to create a pipeline for our categorical attributes. Since these attributes are strings, we need to use OneHotEncoder to transform them into numerical values. But first we create a custom transformer that will extract the package of a car from the Trim attribute we discussed earlier. We initialize add_trim_features=True to give us the option whether to add the new package attribute.", "Now the full pipeline for our categorical attributes is ready. We use CategoricalAttributesAdder, DataFrameSelector, and OneHotEncoder to completely transform our categorical attributes into a format suited for Machine Learning. The pipeline is shown below:", "So far, we have handled the categorical columns and numerical columns separately. It would be more convenient to have a single transformer able to handle all columns, applying the appropriate transformations to each column. Fortunately, Scikit-Learn introduced the ColumnTransformer for this purpose, and the good news is that it works great with pandas DataFrames. Let\u2019s use it to apply all the transformations to the training set:", "In this pipeline, we specify that the numerical columns should be transformed using the num_pipeline that we defined earlier, and the categorical columns should be transformed using the cat_pipeline we defined earlier. Finally, we apply this ColumnTransformer to the training set: it applies each transformer to the appropriate columns and concatenates the outputs along the second axis (the transformers must return the same number of rows).", "And that\u2019s it! We have a preprocessing pipeline that takes the full training set and applies the appropriate transformations to each column.", "At last! We framed the problem, got the data and explored it, sampled a training set and a test set, and we wrote transformation pipelines to clean up and prepare our data for Machine Learning algorithms automatically. We are now ready to select and train Machine Learning models.", "Our first base model is a Linear Regression with which we will try to improve from. Using Scikit-Learn\u2019s cross_val_score() allows us to randomly split the training set into 10 distinct folds, and then train and evaluates our model 10 times, picking a different fold for evaluation each time and training on the other 9 folds. The result is an array containing the 10 evaluation scores:", "Not bad for our base model! But instead of displaying each model\u2019s scores like this we will plot each model\u2019s scores in a box plot showing the mean, interquartile range, and max/min scores. Remember our metric is RMSE and the lower score the better. Here is a list of the models we try:", "We see that Polynomial Regression did slightly better than plain Linear Regression. Also, Random Forest Regressor and Gradient Boosting Regressor performed significantly better while SVM Regressor performed significantly worse. Remember we are just trying to get a general idea of which Machine Learning algorithms perform the best so all of these algorithms were trained with default settings.", "Now we have a shortlist of promising models. We now need to fine-tune them. Since we trained our models using default hyperparameters we will try and see which hyperparameters work best for our best models, Random Forest Regressor and Gradient Boosting Regressor.", "Instead of doing this manually, we get Scikit-Learn\u2019s GridSearchCV to search for us. All we need to do is tell it which hyperparameters we want it to experiment with and what values to try out, and it will use cross-validation to evaluate all possible combinations of hyperparameter values.", "We can get the best estimator directly:", "Let\u2019s look at the best estimator:", "Another way to fine-tune your system is to try and combine the models that perform best. The group (or \u201censemble\u201d) will often perform better than the best individual model. Now that we tuned our hyperparameters of our best two models let\u2019s try and combine them to improve our best score even more.", "This is relatively easy to do with Scikit-Learn\u2019s VotingRegressor() class which allows us to take the average prediction of our Random Forest Regressor and Gradient Boosting Regressor.", "Look at that it worked! Our mean RMSE is under 1600! Now that we have our best model it is time to analyze its errors. But first let\u2019s make one last box plot comparing the four best models.", "Let\u2019s save the best models so that we can come back easily to any of them!", "We will use cross_val_predict to get a clean prediction on every instance in our training set (\u201cclean\u201d meaning that the prediction is made by a model that never saw the data during training).", "Let\u2019s plot our predicted price against the actual price. If all of our points were on the diagonal line that would mean our model is perfect and has an error of 0.", "This looks pretty good our errors are normally distributed opposed to missing low for one region and high for another. All that\u2019s left is to evaluate on the test set and get one final performance check. Thankfully the test set is easy to prepare using the pipeline we created earlier!", "It seems we might\u2019ve overfitted our training set a bit. It might be tempting to go back and try to perform better on the test set but then we risk overfitting the test set. We will leave it be as it is still in the range of scores we got on our training set.", "Now back to the original problem. Should you buy or lease your next car?", "Now that we have our final model and performance score on the test set we can use it to predict the prices of Acura TLXs with features corresponding to various leases. The leases we use for comparison are from Acura\u2019s website. Let\u2019s look at multiple different lease terms and see what we find out!", "The cars we predict have the following features and leases:", "And here are the predicted depreciation costs and leases compared for the three different trims. The red line represents the predicted depreciation cost while the blue line represents the cost of the lease. The shaded area represents the 95% confidence intervals around our predicted depreciation. We see that in all three cases the lease is a lot more expensive.", "You can save up to $10,000 if you choose to buy the car new. Leasing happens to be a lot more expensive even for one of the best rated cars.", "After concluding the project, some ideas had popped in my head that I thought would be interesting:", "As always thank you for reading I hope you enjoyed it and learned something new and insightful!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Projects | Tutorials | Illustrations | Seattle, WA | Join my network: https://www.linkedin.com/in/lukenewman-/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa26617f11fcb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lukenewman_41351?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lukenewman_41351?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Luke Newman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9f3f8cacc367&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&user=Luke+Newman&userId=9f3f8cacc367&source=post_page-9f3f8cacc367----a26617f11fcb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/lukenew2/automobile-depreciation/tree/master/leases", "anchor_text": "here"}, {"url": "https://github.com/lukenew2/car-leases/blob/master/collect_data_webscraping.ipynb", "anchor_text": "here"}, {"url": "https://github.com/lukenew2/car-leases/blob/master/buy_or_lease.ipynb", "anchor_text": "here"}, {"url": "https://github.com/lukenew2/car-leases", "anchor_text": "lukenew2/car-leasesIn this project I aim to determine whether car leases are a good deal by comparing the depreciation cost of cars with\u2026github.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a26617f11fcb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a26617f11fcb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/regression?source=post_page-----a26617f11fcb---------------regression-----------------", "anchor_text": "Regression"}, {"url": "https://medium.com/tag/ensemble-learning?source=post_page-----a26617f11fcb---------------ensemble_learning-----------------", "anchor_text": "Ensemble Learning"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----a26617f11fcb---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&user=Luke+Newman&userId=9f3f8cacc367&source=-----a26617f11fcb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&user=Luke+Newman&userId=9f3f8cacc367&source=-----a26617f11fcb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa26617f11fcb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a26617f11fcb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a26617f11fcb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a26617f11fcb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a26617f11fcb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lukenewman_41351?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lukenewman_41351?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Luke Newman"}, {"url": "https://medium.com/@lukenewman_41351/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "113 Followers"}, {"url": "https://www.linkedin.com/in/lukenewman-/", "anchor_text": "https://www.linkedin.com/in/lukenewman-/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9f3f8cacc367&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&user=Luke+Newman&userId=9f3f8cacc367&source=post_page-9f3f8cacc367--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbbb1abaa1ab0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fshould-you-buy-or-lease-your-next-car-end-to-end-data-science-project-a26617f11fcb&newsletterV3=9f3f8cacc367&newsletterV3Id=bbb1abaa1ab0&user=Luke+Newman&userId=9f3f8cacc367&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}