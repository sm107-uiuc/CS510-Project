{"url": "https://towardsdatascience.com/serving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e", "time": 1683004126.853697, "path": "towardsdatascience.com/serving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e/", "webpage": {"metadata": {"title": "Deploy Keras Models using TensorFlow Serving \u2014 TF 2.x | by Pranit Bankar | Towards Data Science", "h1": "Deploy Keras Models using TensorFlow Serving \u2014 TF 2.x", "description": "I shall cover how to create a basic and super simple Keras Model and how to deploy it on your local machine. This model would definitely be simpler than whatever you plan to deploy (well, I hope\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/tfx/guide/serving", "anchor_text": "TensorFlow Serving", "paragraph_index": 5}, {"url": "https://github.com/bankarpranit26/deep-learning/blob/master/learnings/TFServing_Local_LinearModel.ipynb", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://colab.research.google.com/drive/1OaGLgnP7QXy0_C0wq0ndq7hwOVr2pEBk", "anchor_text": "Google Colab", "paragraph_index": 8}, {"url": "https://www.tensorflow.org/tfx/serving/docker", "anchor_text": "here", "paragraph_index": 21}, {"url": "https://www.docker.com/products/docker-desktop", "anchor_text": "here", "paragraph_index": 23}], "all_paragraphs": ["Created a great Deep Learning model? Congratulations!", "Don\u2019t know how to create a Deep Learning model using Keras? No worries!", "I shall cover how to create a basic and super simple Keras Model and how to deploy it on your local machine. This model would definitely be simpler than whatever you plan to deploy (well, I hope so!). But since the goal of this post is to enable you to deploy your Keras Model, I want to ensure that we don\u2019t deviate from our goal.", "Now why do we need to deploy it on our local server? To verify that whatever problem we intend to solve with our model, can be solved in the real world. You would expect that your model works in the same way and gives the same performance on the real world data that it gave on your test input in your local IDE or notebook. But the truth is it will hardly ever do that. If it does, great! But you wouldn\u2019t want to realize the gap between your test data and the real world data after you have deployed your model for consumption.", "What if the real world images are different from the white background studio images you used to train, validate and test your model? What if it takes too much time to process your data on the network calls due to latency issues than it did in your IDE? Finding these problems early are key to successfully transitioning your model from your cozy laptop to the reality outside.", "TensorFlow Serving is a flexible, high-performance serving system for machine learning models, designed for production environments. TensorFlow Serving makes it easy to deploy new algorithms and experiments, while keeping the same server architecture and APIs. TensorFlow Serving provides out-of-the-box integration with TensorFlow models, but can be easily extended to serve other types of models and data.", "If you are used to building your models using TensorFlow or Keras, then the easiest way of deploying your models is by using TensorFlow Serving.", "Most of the TensorFlow documentation is written for TensorFlow-1.0 and it sadly doesn\u2019t work as is for TensorFlow-2.0. Hence the need for this blog.", "You can find my notebook here: (You can also run it in Google Colab)", "[If you already have your model ready in SavedModel format, skip this part.]", "Here I shall be creating a model that predicts a linear relationship:", "I used Google Colab but you can use any tool of your choice as long as the generated model remains the same.", "We first load the necessary libraries", "Then we build our model. Since it is a simple linear relationship, a single neuron is enough.", "We now train our model for 20 epochs. After 20 epochs, our model\u2019s losses were around 2e-12 for training as well as validation. Then, we evaluate our model on the test data. Our test loss came out to be around 2e-12. You can try predicting some values to verify the results like I did here. The output I received is 15.866.", "Everything looks great.Let\u2019s now save and download our model in the SavedModel format.", "From this step onwards, the process would be independent of the type of input and output data used. It could be numeric arrays, texts, images, audios or videos. In Colab, you should be able to see a folder named \u2018linear_model\u2019 created in your directory. The \u2018export_path\u2019 variable here indicates that our model is named \u2018linear_model\u2019 and this is the first version of it. Having a version number is mandatory for deploying using TensorFlow Serving so ensure that you have your \u2018export_path\u2019 in the form of {MODEL}/{VERSION}, where VERSION is numeric without any alphabets or special characters.", "Now to download this model, we will zip this folder and then use \u2018google.colab.files\u2019 to download the zip file.", "Once you extract this zip file on your local machine, you should be able to see a folder named \u2018linear_model\u2019, which contains a folder named \u20181\u2019, which contains your variables and model architecture.", "This is a one-time setup activity.", "To start our local server we need a TensorFlow Serving instance on our local machine. Instead of downloading and installing all the necessary libraries, we shall use the recommended way of using Docker.", "You can read more details about it in the Guide here.", "We won\u2019t be following all the steps mentioned in the Guide, as some of the things are specific for TF 1.0 and some things are specific to reusing already available models.", "Once you download Docker on your system from here, go ahead and finish the installation steps. You would need to restart your system so save all your work.", "Once the installation is finished successfully, go to Command Prompt (Mac and Linux users, kindly use appropriate tools) and type", "That\u2019s it! Let\u2019s now proceed to deploy our model.", "What if I told you that deploying the model is just one line of command script.", "All you need is the absolute path to your \u2018linear_model\u2019 folder. Do not forget to use the absolute path as this would cause errors that you would need to spend time and break your head to solve.", "My \u2018linear_model\u2019 was saved inside \u2018D:/my_own_models/\u2019. So my command looked like:", "This is all a single line. For your subsequent models, you need to just change your \u2018source\u2019 path. Changing your \u2018target\u2019 and MODEL_NAME is optional, but, of course, necessary based on the context.", "Now let us try to understand what the above command script indicates. The generic form of this script is", "{LOCAL_PORT}: This is the local port of your machine, so make sure you do not have anything else running there. We are mapping it to the 8501 port exposed for REST API calls by TensorFlow Serving", "{ABSOLUTE_PATH}: This is the absolute path for your model. This tells the TensorFlow Serving where your model is located at (obviously).", "{MODEL_NAME}: This is the service end-point for your REST API call with the prefix \u2018/models/\u2019. Do not change the \u2018/models/\u2019 prefix in the target variable and only change the {MODEL_NAME} part based on your need", "Once you see the below message in your command window, your model has been hosted successfully. You can also see a container running successfully in your Docker dashboard.", "I used Postman for testing my queries, but you can use any form of API calls.", "[Note: You won\u2019t be able to make direct calls from browser or any other host to your REST API since CORS is not enabled by TensorFlow Serving. However, there are ways to achieve a call from the browser to your model that I would cover in a separate post.]", "You need a POST query to test our model. Our request URL looks like:", "Add \u2018Content-Type\u2019 as \u2018application/json\u2019 in your header and your body as:", "Ensure that your JSON key is \u2018instances\u2019 and your values are inside an array. Since our input is [0], we write it as [[0]].", "Remember, that we created a model to predict y = 2x + 1 which means for input value 0, our prediction should have value 1 (or close to it).", "Let\u2019s send our query. The response looks like:", "Well, that looks pretty much like 1 to me. Play around with your model by making POST queries.", "We were able to create a model from scratch and deploy it on our local server. This is a very good way to see if your model would work the same way in the real world as it does on your IDE.", "As I previously mentioned, however, you won\u2019t be able to make calls to this model apart from Postman (or similar tools). How to overcome that? I shall cover that in a separate post as this is already becoming too long.", "If you have reached here, thanks for reading. If you have any queries, suggestions or comments, please feel free to comment on this post. This is my first blog on Machine Learning and I would gladly appreciate any and all feedback.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Working as a Full Stack Developer at SAP Labs since 5 years now. Currently learning Machine Learning, because it helps open new problem-solving paradigms!!!"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8bb8474c304e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bankarpranit26?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bankarpranit26?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Pranit Bankar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff7228ffc859f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&user=Pranit+Bankar&userId=f7228ffc859f&source=post_page-f7228ffc859f----8bb8474c304e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.tensorflow.org/tfx/guide/serving", "anchor_text": "TensorFlow Serving"}, {"url": "https://github.com/bankarpranit26/deep-learning/blob/master/learnings/TFServing_Local_LinearModel.ipynb", "anchor_text": "here"}, {"url": "https://colab.research.google.com/drive/1OaGLgnP7QXy0_C0wq0ndq7hwOVr2pEBk", "anchor_text": "Google Colab"}, {"url": "https://www.tensorflow.org/tfx/serving/docker", "anchor_text": "here"}, {"url": "https://www.docker.com/products/docker-desktop", "anchor_text": "here"}, {"url": "http://localhost:8509/v1/models/linear_model:predict", "anchor_text": "http://localhost:8509/v1/models/linear_model:predict"}, {"url": "http://localhost:{LOCAL_PORT}}/v1/models/{MODEL_NAME}:predict", "anchor_text": "http://localhost:{LOCAL_PORT}}/v1/models/{MODEL_NAME}:predict"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----8bb8474c304e---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/tensorflow-serving?source=post_page-----8bb8474c304e---------------tensorflow_serving-----------------", "anchor_text": "Tensorflow Serving"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----8bb8474c304e---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----8bb8474c304e---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/deployment?source=post_page-----8bb8474c304e---------------deployment-----------------", "anchor_text": "Deployment"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&user=Pranit+Bankar&userId=f7228ffc859f&source=-----8bb8474c304e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&user=Pranit+Bankar&userId=f7228ffc859f&source=-----8bb8474c304e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8bb8474c304e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8bb8474c304e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8bb8474c304e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8bb8474c304e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8bb8474c304e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bankarpranit26?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bankarpranit26?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Pranit Bankar"}, {"url": "https://medium.com/@bankarpranit26/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff7228ffc859f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&user=Pranit+Bankar&userId=f7228ffc859f&source=post_page-f7228ffc859f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Ff7228ffc859f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserving-keras-models-locally-using-tensorflow-serving-tf-2-x-8bb8474c304e&user=Pranit+Bankar&userId=f7228ffc859f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}