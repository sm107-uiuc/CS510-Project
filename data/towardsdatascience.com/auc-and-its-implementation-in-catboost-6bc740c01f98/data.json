{"url": "https://towardsdatascience.com/auc-and-its-implementation-in-catboost-6bc740c01f98", "time": 1683007223.257782, "path": "towardsdatascience.com/auc-and-its-implementation-in-catboost-6bc740c01f98/", "webpage": {"metadata": {"title": "AUC and its implementation in CatBoost | by Anna Volodkevich | Towards Data Science", "h1": "AUC and its implementation in CatBoost", "description": "The model which randomly assigns a class to object is a \u2018bad\u2019 classifier and has a diagonal ROC curve. The better is the classifier, the higher is the ROC curve. The ROC curve is plotted with TPR\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Basic_concept", "anchor_text": "True Positive Rate", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Basic_concept", "anchor_text": "False Positive Rate", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Sensitivity_and_specificity", "anchor_text": "Sensitivity and Specificity", "paragraph_index": 1}, {"url": "https://catboost.ai/docs/concepts/loss-functions-classification.html", "anchor_text": "binary classification", "paragraph_index": 6}, {"url": "https://catboost.ai/docs/concepts/loss-functions-multiclassification.html", "anchor_text": "multiclassification", "paragraph_index": 6}, {"url": "https://catboost.ai/docs/concepts/loss-functions-ranking.html", "anchor_text": "ranking", "paragraph_index": 6}, {"url": "https://catboost.ai/docs/concepts/python-reference_catboost_eval-metrics.html", "anchor_text": "model.eval_metric", "paragraph_index": 6}, {"url": "https://https//catboost.ai/docs/concepts/python-reference_utils_eval_metric.html", "anchor_text": "utils.eval_metric", "paragraph_index": 6}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "article", "paragraph_index": 31}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "the article", "paragraph_index": 44}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "the article", "paragraph_index": 50}, {"url": "https://github.com/catboost/catboost/blob/master/catboost/tutorials/metrics/AUC_tutorial.ipynb", "anchor_text": "CatBoost tutorials", "paragraph_index": 68}], "all_paragraphs": ["The ROC curve shows the model\u2019s ability to distinguishing between classes.", "The model which randomly assigns a class to object is a \u2018bad\u2019 classifier and has a diagonal ROC curve. The better is the classifier, the higher is the ROC curve. The ROC curve is plotted with TPR, True Positive Rate, on the y-axis against the FPR, False Positive Rate, on the x-axis. The curve also could be interpreted in terms of Sensitivity and Specificity of the model with Sensitivity on the y-axis and (1-Specificity) on the x-axis.", "Building and visualizing the ROC curve could be used to measure classification algorithm performance with different probability boundaries and select the probability boundary required to achieve the specified false-positive or false-negative rate.", "AUC is the Area Under the ROC Curve. The best AUC = 1 for a model that ranks all the objects right (all objects with class 1 are assigned higher probabilities then objects of class 0). AUC for the \u2018bad\u2019 classifier which is working as random guessing is equal to 0.5.", "AUC is used for binary classification, multiclass classification, and ranking problems. AUC measures the proportion of correctly ordered objects and the capability of the model to distinguish between the classes.", "The AUC has an important statistical property: the AUC of a classifier is equivalent to the probability that the classifier will rank a randomly chosen positive instance higher than a randomly chosen negative instance.", "There are implementations of AUC in CatBoost for binary classification, multiclassification and ranking problems. You can calculate AUC during training for overfitting detection and automated best model selection, evaluate the model on new data with model.eval_metric and use AUC as a metric for predictions evaluation and comparison with utils.eval_metric. See examples of models fitting and AUC calculation with CatBoost in the section How to use AUC in Catboost on real datasets?", "AUC for binary classification is calculated according to the following formula:", "where a\u1d62,a\u2c7c \u2014 predictions (probabilities) of objects to belong to the class 1 given by the algorithm.", "The sum is calculated on all pairs of objects i, j such that: t\u1d62=0, t\u2c7c=1 where t is the true class label.", "I is an indicator function equal to 1 if objects i, j are ordered correctly:", "A user could assign weights for each object to specify the importance of each object in metric calculation.", "Let\u2019s look at a simple example of ROC curve building and AUC calculation:", "We have a sample of 10 objects, 4 from class 1 and 6 from class 0 (\u2018class\u2019 column). All objects are equally important (weights = 1). Assume we predicted probabilities of objects to come from class 1 (\u2018prediction\u2019 column).", "The denominator is equal to the number of pairs of objects i, j such that true class t\u1d62=0,t\u2c7c=1. As there are 4 objects from class 1 and 6 objects from class 0, the denominator is equal to 24.", "For each object from class 1 count the number of objects from class 0, which are below (has less probability) in the sorted dataset.", "We add +1 of objects ordered correctly (e.g. objects with IDs 0 and 4) and +0.5 if probabilities are equal (e.g. objects with IDs 1 and 7).", "For example, the object with ID = 1 adds +4.5 to AUC numerator as correctly ordered with objects with IDs: 8, 3, 6, 9 and has equal prediction with object 7:", "Let\u2019s calculate the same metric with Catboost and ensure everything is right:", "To build a ROC curve put the number of objects of class 1 (n1) in the square with side 1 along the y-axis, and the number of objects of class 0 (n0) along the x-axis.", "Going by the list of target labels dorted by model predictions in descending order will add 1/n1 along the y-axis encountering an object of class 1 and 1/n0 along the x-axis encountering an object of class 0.", "Going from top to bottom by the \u2018class\u2019 column we go up on the plot if the class is 1 or right if the class is 0. When meet objects with equal prediction add the number of 1 along y and the number of 0 along x and go by the diagonal of the rectangle.", "CatBoost allows us to assign a weight to each object in the dataset for AUC calculation according to the formula above. If no weights assigned, all weights are equal to 1 and thus AUC is proportional to the number of correctly ordered pairs. If weights assigned this property is changed.", "Weights are useful for unbalanced datasets. If there is a class or a group of objects with a small number of samples in the train dataset it could be reasonable to increase the weights for corresponding objects.", "For example, if we assign weight 10 to one object it can be understood as adding 9 of the same objects to the dataset.", "Let\u2019s calculate AUC for an example of the wrong and right classification of one important object with weight = 10.", "AUC = 0.9167. An important object is correctly ordered, AUC increases", "AUC = 0.4417. An important object is incorrectly ordered, AUC decreases", "There are two AUC metrics implemented for multiclass classification in Catboost.", "The first is OneVsAll. AUC value is calculated separately for each class according to the binary classification calculation principles.", "The second is AUC\u03bc, which is designed to meet the following properties:", "AUC\u03bc could be interpreted as an average of pairwise AUCs between the classes. Details could be found in the article.", "OneVsAll AUC in Catboost returns n AUC values for n-class classification. The value is calculated separately for each class k numbered from 0 to K\u20131 according to the binary classification calculation rules. The objects of class k are considered positive, while all others are considered negative.", "It works almost the same way as the binary classification, so I skip calculation details here (they are present in the iPython notebook).", "OneVsAll AUC measures the ability of the classifier to distinguish objects of one class from another.", "An advantage of OneVsAll is the ability to monitor performance on different classes separately.", "AUC\u03bc could be used as an evaluation metric to prevent overfitting, while OneVsAll AUC could be used only for information as contains k values (k is the number of classes).", "Let\u2019s have a look at the AUC\u03bc formula:", "K is a number of classes, i < j \u2264 K are the classes\u2019 numbers.", "S(i, j) is a separability measure between classes i and j defined as:", "Vectors v_i,j come from misclassification cost matrix A, which is defined manually following the learning task.", "A \u1d62 \u2c7c is the cost of classifying an instance as class i when its true class is j. Then A defines a partition on the (K\u22121)\u2212simplex and induces decision boundaries between the K classes.", "Default misclassification cost matrix values are 1 everywhere, except the diagonal where they are 0. It is called the argmax partition matrix as it assigns a class with maximal probability.", "Here is a partition for a 3-class classification problem with the argmax partition matrix A. For a used-defined partition matrix the boundaries (marked by arrows) are shifted.", "Follow the article for more details.", "CatBoost allows us to set the misclassification cost matrix A and objects\u2019 weights to calculate AUC\u03bc.", "Let\u2019s calculate AUC\u03bc for a very small example with 3 classes and 4 objects:", "Let\u2019s compute S(i,j) for each ordered classes\u2019 pair:", "Let\u2019s calculate the same metric with Catboost AUC\u03bc and ensure everything is right:", "As we can see AUC\u03bc is pretty high, but actually, algorithm performance is bad, accuracy is 0.25. Thus it is reasonable to evaluate the other important metrics during the training.", "AUC\u03bc is a good generalizing metric to estimate algorithm ability to separate classes in multiclassification problems. See more about different approaches to multiclass AUC calculation and their properties in section 4.3 of the article.", "AUC\u03bc could be interpreted as an average of pairwise AUCs between the classes. AUC\u03bc is a single value unlike OneVsAll AUC and thus it could be used as an evaluation metric during training for overfitting detection and trees pruning.", "There are two variants of AUC for Ranking in CatBoost.", "is used for models with Logloss and CrossEntropy loss functions. It has the same formula as AUC for binary classification:", "a\u1d62, a\u2c7c \u2014 predicted rank of objects i, j.", "The sum is calculated on all pairs of objects i, j such that: t\u1d62=0, t\u2c7c=1 where t is relevance.", "The formula above suits for simple tasks with target values equal to 1 and 0. What if we have more target values?", "If the target type is not binary, then every object i with target value t and weight w is replaced with two objects for the metric calculation:", "Target values must be in the range [0; 1].", "Let\u2019s calculate Classic AUC for Ranking for a small example. Assume we have 2 documents, 2 requests, corresponding relevances in the range [1, 5] and predicted relevance in the range [0, 1]:", "After data preprocessing (see the notebook for details) we get:", "Ranking AUC is used for ranking loss functions.", "a\u1d62, a\u2c7c are predicted rank of objects i, j.", "The sum is calculated on all pairs of objects i, j such that: t\u1d62<t\u2c7c where t is relevance.", "Ranking AUC is directly measuring the quantity of correctly ranked pairs. The problem is the metric is calculated regardless of groups. In our example, we have groups (requests) and we may want to measure quality inside the groups, but currently, AUC is calculated over the dataset and AUC penalizes us if, for example, top-one document for one request is ranked lower than top-one for another document while true ranks are opposite (but still top-one for each document).", "One more problem of AUC for Ranking is that it does not distinguish the top object from the others. If we have a lot of irrelevant documents, which are ranked irrelevant by the model, but bad ranking in top-10, AUC could still be high because of that \u201ctail\u201d of irrelevant objects, ranked lower than relevant.", "AUC is a widely used metric to measure the ability of a model to distinguish classes and correctly order objects from different classes / with different relevance. AUC is not differentiable and thus cannot be used as a loss function, but it is pretty informative and useful as a metric.", "We have examined the following AUC types:", "To have a closer look at the data processing, calculation details, and examples of using AUC in CatBoost see the iPython notebook with code in CatBoost tutorials.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Master student of Faculty of Computer Science, Higher School of Economics, and Yandex School of Data Analysis"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6bc740c01f98&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@greenberry789?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@greenberry789?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Anna Volodkevich"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2b5480ca273f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&user=Anna+Volodkevich&userId=2b5480ca273f&source=post_page-2b5480ca273f----6bc740c01f98---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Basic_concept", "anchor_text": "True Positive Rate"}, {"url": "https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Basic_concept", "anchor_text": "False Positive Rate"}, {"url": "https://en.wikipedia.org/wiki/Sensitivity_and_specificity", "anchor_text": "Sensitivity and Specificity"}, {"url": "https://catboost.ai/docs/concepts/loss-functions-classification.html", "anchor_text": "binary classification"}, {"url": "https://catboost.ai/docs/concepts/loss-functions-multiclassification.html", "anchor_text": "multiclassification"}, {"url": "https://catboost.ai/docs/concepts/loss-functions-ranking.html", "anchor_text": "ranking"}, {"url": "https://catboost.ai/docs/concepts/python-reference_catboost_eval-metrics.html", "anchor_text": "model.eval_metric"}, {"url": "https://https//catboost.ai/docs/concepts/python-reference_utils_eval_metric.html", "anchor_text": "utils.eval_metric"}, {"url": "https://en.wikipedia.org/wiki/Receiver_operating_characteristic", "anchor_text": "Wikipedia"}, {"url": "https://people.inf.elte.hu/kiss/11dwhdm/roc.pdf", "anchor_text": "the article"}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "the article"}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "article"}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "the article"}, {"url": "http://proceedings.mlr.press/v97/kleiman19a/kleiman19a.pdf", "anchor_text": "the article"}, {"url": "https://github.com/catboost/catboost/blob/master/catboost/tutorials/metrics/AUC_tutorial.ipynb", "anchor_text": "CatBoost tutorials"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6bc740c01f98---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6bc740c01f98---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/roc-curve?source=post_page-----6bc740c01f98---------------roc_curve-----------------", "anchor_text": "Roc Curve"}, {"url": "https://medium.com/tag/catboost?source=post_page-----6bc740c01f98---------------catboost-----------------", "anchor_text": "Catboost"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&user=Anna+Volodkevich&userId=2b5480ca273f&source=-----6bc740c01f98---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&user=Anna+Volodkevich&userId=2b5480ca273f&source=-----6bc740c01f98---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6bc740c01f98&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6bc740c01f98---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6bc740c01f98--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6bc740c01f98--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6bc740c01f98--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@greenberry789?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@greenberry789?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anna Volodkevich"}, {"url": "https://medium.com/@greenberry789/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "15 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2b5480ca273f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&user=Anna+Volodkevich&userId=2b5480ca273f&source=post_page-2b5480ca273f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F2b5480ca273f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fauc-and-its-implementation-in-catboost-6bc740c01f98&user=Anna+Volodkevich&userId=2b5480ca273f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}