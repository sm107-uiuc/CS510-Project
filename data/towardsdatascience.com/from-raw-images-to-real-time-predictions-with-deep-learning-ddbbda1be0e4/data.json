{"url": "https://towardsdatascience.com/from-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4", "time": 1682994523.9453099, "path": "towardsdatascience.com/from-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4/", "webpage": {"metadata": {"title": "From raw images to real-time predictions with Deep Learning | by Jonathan Oheix | Towards Data Science", "h1": "From raw images to real-time predictions with Deep Learning", "description": "In my opinion, one of the most exciting fields in Artificial Intelligence is computer vision. I find it very interesting how we can now automatically extract knowledge from complex raw data\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/jrishabh96/Facial-Expression-Recognition", "anchor_text": "https://github.com/jrishabh96/Facial-Expression-Recognition", "paragraph_index": 25}, {"url": "https://www.linkedin.com/in/jonathanoheix/", "anchor_text": "https://www.linkedin.com/in/jonathanoheix/", "paragraph_index": 55}], "all_paragraphs": ["In my opinion, one of the most exciting fields in Artificial Intelligence is computer vision. I find it very interesting how we can now automatically extract knowledge from complex raw data structures such as images.", "The goal of this article is to explore a complete example of a computer vision application: building a face expression recognition system with Deep Learning. We will see how to:", "Keras is a high-level Neural Network API, written in Python and capable of running on top of TensorFlow, CNTK, or Theano. We will use it to build, train and export out Neural Network.", "Flask is a micro web framework written in Python that will allow us to serve directly our model into a web interface.", "OpenCV is a computer vision library with C++, Python and Java interfaces. We will use this library to automatically detect faces in images.", "The data comes from the past Kaggle competition \u201cChallenges in Representation Learning: Facial Expression Recognition Challenge\u201d:", "The data consists of 48x48 pixel grayscale images of faces. The faces have been automatically registered so that the face is more or less centered and occupies about the same amount of space in each image. Each image corresponds to a facial expression in one of seven categories (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral). The dataset contains approximately 36K images.", "The original data consisted in arrays with a greyscale value for each pixel. We converted this data into raw images and splitted them in multiple folders:", "80% of our images are contained inside the train folder, and the last 20% are inside the validation folder.", "First let\u2019s see how our images look like:", "Can you guess which expressions are those images related to?", "This task is quite easy for a human, but it may be a bit challenging for a predictive algorithm because:", "However all this diversity of images will contribute to make a more generalizable model.", "The face expressions in our training dataset are pretty balanced, except for the \u2018disgust\u2019 category.", "Deep learning models are trained by being fed with batches of data. Keras has a very useful class to automatically feed data from a directory: ImageDataGenerator.", "It can also perform data augmentation while getting the images (randomly rotating the image, zooming, etc.). This method is often used as a way to artificially get more data when the dataset has a small size.", "The function flow_from_directory() specifies how the generator should import the images (path, image size, colors, etc.).", "We chose to use a Convolutional Neural Network in order to tackle this face recognition problem. Indeed this type of Neural Network (NN) is good for extracting the features of images and is widely used for image analysis subjects like image classification.", "Quick reminder of what a NN is:", "A Neural Network is a learning framework that consists in multiple layers of artificial neurons (nodes). Each node gets weighted input data, passes it into an activation function and outputs the result of the function:", "A NN is composed of several layers of nodes:", "Classic NNs are usually composed of several fully connected layers. This means that every node of one layer is connected to all the nodes of the next layer.", "Convolutional Neural Networks also have Convolutional layers that apply sliding functions to groups of pixels that are next to each other. Therefore those structures have a better understanding of patterns that we can observe in images. We will explain this in more details after.", "Now let\u2019s define the architecture of our CNN:", "We define our CNN with the following global architecture:", "The convolutional layers will extract relevant features from the images and the fully connected layers will focus on using these features to classify well our images. This architecture was inspired by the following work on the subject: https://github.com/jrishabh96/Facial-Expression-Recognition", "Now let\u2019s focus on how those convolution layers work. Each of them contain the following operations:", "The green matrix corresponds to the raw image values. The orange sliding matrix is called a \u2018filter\u2019 or \u2018kernel\u2019. This filter slides over the image by one pixel at each step (stride). During each step, we multiply the filter with the corresponding elements of the base matrix and sum the results. There are different types of filters and each one will be able to retrieve different image features:", "We also use some common techniques for each layer:", "We chose softmax as our last activation function as it is commonly used for multi-label classification.", "Now that our CNN is defined, we can compile it with a few more parameters. We chose the Adam optimizer as it is one of the most computationally effective. We chose the categorical cross-entropy as our loss function as it is quite relevant for classification tasks. Our metric will be the accuracy, which is also quite informative for classification tasks on balanced datasets.", "Here we define and train our CNN from scratch, but you may want to apply transfer learning methods for problems that require more computational resources. Keras has several pre-trained models ready to use:", "Everything is set up, let\u2019s train our model now!", "Our best model managed to obtain a validation accuracy of approximately 65%, which is quite good given the fact that our target class has 7 possible values!", "At each epoch, Keras checks if our model performed better than the models of the previous epochs. If it is the case, the new best model weights are saved into a file. This will allow us to load directly the weights of our model without having to re-train it if we want to use it in another situation.", "We also have to save the structure of our CNN (layers etc.) into a file:", "We got outputs at each step of the training phase. All those outputs were saved into the \u2018history\u2019 variable. We can use it to plot the evolution of the loss and accuracy on both the train and validation datasets:", "The validation accuracy starts to stabilize at the end of the 50 epochs between 60% and 65% accuracy.", "The training loss is slightly higher than the validation loss for the first epochs which can be surprising. Indeed we are used to see higher validation losses than training losses in machine learning. Here this is simply due to the presence of dropout, which is only applied during the training phase and not during the validation phase.", "We can see that the training loss is becoming much smaller than the validation loss after the 20th iteration. This means that our model starts to overfit our training dataset after too much epochs. That is why the validation loss does not decrease a lot after. One solution consists in early-stopping the training of the model.", "We could also use some different dropout values and performing data augmentation. Those methods were tested on this dataset, but they did not significantly increase the validation accuracy although they reduced the overfitting effect. Using them slightly increased the training duration of the model.", "Finally we can plot the confusion matrix in order to see how our model classified the images:", "Our model is very good for predicting happy and surprised faces. However it predicts quite poorly feared faces because it confuses them with sad faces.", "With more research and more resources this model could certainly be improved, but the goal of this study was primarily to focus on obtaining a fairly good model compared to what has been done in this field.", "Now it\u2019s time to try our model in a real situation! We will use flask to serve our model in order to perform real-time predictions with a webcam input.", "For this part I re-used some code from the following repositories:", "First let\u2019s create a class that will give us the predictions of our previously trained model:", "Next we implement a camera class that will do the following operations:", "Finally our main script will create a Flask app that will render our image predictions into a web page.", "It works! Our application is able to detect the face location and predict the right expression.", "However the model seems to work poorly in bad conditions (low-light, person not facing the camera, person moving\u2026), but still it\u2019s a good start!", "Thanks for reading this article, I hope you enjoyed it!", "You can find the full code here:", "And find me on LinkedIn here:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist with 4 years of experience in various fields. https://www.linkedin.com/in/jonathanoheix/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fddbbda1be0e4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jo879344?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jo879344?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Jonathan Oheix"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e8e06482696&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&user=Jonathan+Oheix&userId=2e8e06482696&source=post_page-2e8e06482696----ddbbda1be0e4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@plloyd?utm_source=medium&utm_medium=referral", "anchor_text": "Peter Lloyd"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge", "anchor_text": "https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge"}, {"url": "https://github.com/jrishabh96/Facial-Expression-Recognition", "anchor_text": "https://github.com/jrishabh96/Facial-Expression-Recognition"}, {"url": "https://keras.io/applications/", "anchor_text": "Applications \u2014 Keras DocumentationKeras Applications are deep learning models that are made available alongside pre-trained weights. These models can be\u2026keras.io"}, {"url": "https://github.com/log0/video_streaming_with_flask_example", "anchor_text": "https://github.com/log0/video_streaming_with_flask_example"}, {"url": "https://github.com/piyush2896/Facial-Expression-Recognition-Challenge", "anchor_text": "https://github.com/piyush2896/Facial-Expression-Recognition-Challenge"}, {"url": "https://github.com/jonathanoheix/Real-Time-Face-Expression-Recognition", "anchor_text": "jonathanoheix/Real-Time-Face-Expression-RecognitionFace expression recognition app with Keras, Flask and OpenCV - jonathanoheix/Real-Time-Face-Expression-Recognitiongithub.com"}, {"url": "https://www.linkedin.com/in/jonathanoheix/", "anchor_text": "Jonathan Oheix - Data Scientist - Influans | LinkedInView Jonathan Oheix's profile on LinkedIn, the world's largest professional community. Jonathan has 8 jobs listed on\u2026www.linkedin.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ddbbda1be0e4---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ddbbda1be0e4---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----ddbbda1be0e4---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/keras?source=post_page-----ddbbda1be0e4---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----ddbbda1be0e4---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&user=Jonathan+Oheix&userId=2e8e06482696&source=-----ddbbda1be0e4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&user=Jonathan+Oheix&userId=2e8e06482696&source=-----ddbbda1be0e4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fddbbda1be0e4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ddbbda1be0e4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ddbbda1be0e4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jo879344?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jo879344?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jonathan Oheix"}, {"url": "https://medium.com/@jo879344/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "253 Followers"}, {"url": "https://www.linkedin.com/in/jonathanoheix/", "anchor_text": "https://www.linkedin.com/in/jonathanoheix/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e8e06482696&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&user=Jonathan+Oheix&userId=2e8e06482696&source=post_page-2e8e06482696--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa627ef796d52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffrom-raw-images-to-real-time-predictions-with-deep-learning-ddbbda1be0e4&newsletterV3=2e8e06482696&newsletterV3Id=a627ef796d52&user=Jonathan+Oheix&userId=2e8e06482696&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}