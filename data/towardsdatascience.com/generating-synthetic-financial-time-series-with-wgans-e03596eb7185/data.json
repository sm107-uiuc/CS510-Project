{"url": "https://towardsdatascience.com/generating-synthetic-financial-time-series-with-wgans-e03596eb7185", "time": 1683009567.630531, "path": "towardsdatascience.com/generating-synthetic-financial-time-series-with-wgans-e03596eb7185/", "webpage": {"metadata": {"title": "Generating synthetic financial time series with WGANs | by Mirko Savasta | Towards Data Science", "h1": "Generating synthetic financial time series with WGANs", "description": "Overfitting is one of the problems researchers encounter when they try to apply machine learning techniques to time series. This problem occurs because we train our models using the only time series\u2026"}, "outgoing_paragraph_urls": [{"url": "https://jfds.pm-research.com/content/2/1/76.short", "anchor_text": "paper", "paragraph_index": 2}, {"url": "https://medium.com/u/802e9b15f86d?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Andrea Politano", "paragraph_index": 5}, {"url": "https://pytorch.org/tutorials/beginner/data_loading_tutorial.html", "anchor_text": "here", "paragraph_index": 7}, {"url": "https://arxiv.org/abs/1701.07875", "anchor_text": "Wasserstein GAN", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence", "anchor_text": "Jensen\u2013Shannon divergence", "paragraph_index": 10}, {"url": "https://en.wikipedia.org/wiki/Wasserstein_metric", "anchor_text": "Wasserstein distance", "paragraph_index": 10}, {"url": "https://lilianweng.github.io/lil-log/2017/08/20/from-GAN-to-WGAN.html", "anchor_text": "article", "paragraph_index": 10}, {"url": "https://en.wikipedia.org/wiki/Lipschitz_continuity", "anchor_text": "K-Lipschitz continuous", "paragraph_index": 11}, {"url": "https://arxiv.org/abs/1704.00028", "anchor_text": "gradient penalty", "paragraph_index": 13}, {"url": "https://repository.tudelft.nl/islandora/object/uuid%3A51d69925-fb7b-4e82-9ba6-f8295f96705c", "anchor_text": "thesis", "paragraph_index": 14}, {"url": "https://christiancosgrove.com/blog/2018/01/04/spectral-normalization-explained.html", "anchor_text": "article", "paragraph_index": 15}, {"url": "https://arxiv.org/abs/1802.05957", "anchor_text": "paper", "paragraph_index": 15}, {"url": "https://github.com/mirkosavasta/GANetano", "anchor_text": "repo", "paragraph_index": 18}, {"url": "https://en.wikipedia.org/wiki/Autoregressive\u2013moving-average_model", "anchor_text": "ARMA", "paragraph_index": 20}, {"url": "https://arxiv.org/abs/1904.01184", "anchor_text": "paper", "paragraph_index": 27}], "all_paragraphs": ["Overfitting is one of the problems researchers encounter when they try to apply machine learning techniques to time series. This problem occurs because we train our models using the only time series path we know of: the realized history. After all, we have only seen one state of the world for our entire life: boring isn\u2019t it? =)", "In particular, not every possible market regime or event can be well represented in our data. In fact, very unlikely events, such as periods of unusually high volatility, are normally underrepresented and this prevents models from being trained well enough. So, when these trained algorithms face new scenarios, they may fail; and this happens especially if we keep them in production for sufficient time without any precaution.", "Now, what if we could teach a model to generate new data for the same asset? What if we had a tool that produced alternative realistic time series that share the same statistical properties of the original ones? With such a tool, we could augment our training set with data about unlikely events or rare market regimes; therefore researchers would be able to build models that generalize better and practitioners would perform superior simulations and trading backtests. In this regard, the authors of a recently published paper in the Journal of Financial Data Science show how training deep models on synthetic data mitigates overfitting and improves performance.", "It turns out that Generative Adversarial Networks (GANs) could do the trick. GANs are a machine learning framework where two neural nets, a generator (G) and a discriminator (D), play a game against each other where the former tries to trick the latter generating fake data that resemble the real thing. When I say \u201cgame\u201d I am referring to game theory here!", "No player should win, however: GAN researchers are always looking for a Nash equilibrium between G and D where hopefully \u2014 GANs can be hard to train \u2014 the generator has learnt how to produce fake but realistic samples and the discriminator\u2019s best choice is to guess randomly.", "My purpose here is not to dive into GANs theory (there are great papers and resources online) but rather to briefly touch the basics and share the results of the experiments I am carrying on with my teammate and friend Andrea Politano.", "Though our final objective is using one or more trained generators to produce many time series at once, we choose to start simple and proceed gradually. In this respect, we first check if GANs can learn series whose data generating process (DGP) we fully understand. Of course, only a few \u2014 if any \u2014 understand the DGP of financial asset returns; hence we start generating fake sine waves.", "We first code a Pytorch dataset to produce different sine functions. Pytorch datasets are convenient utilities which make data loading easier and improve code readability. Check them out here.", "We then opt for a Wasserstein GAN (WGAN) as this particular class of models have solid theoretical foundations and significantly improve training stability; in addition, the loss correlates with the generator\u2019s convergence and sample quality \u2014 this is extremely useful because researchers do not need to constantly check the generated samples to understand if the model is improving or not. Finally, WGANs are more robust to mode collapse and architectural changes than standard GANs.", "The loss function in a standard GAN quantifies the distance between the training and the generated data distributions. In fact, GANs are based on the idea that as the training advances, the model\u2019s parameters are gradually updated and the distribution learnt by G converges to the real data distribution. This convergence must be as smooth as possible and it is essential to remember that the way this sequence of distributions converges depends on how we compute the distance between each pair of distributions.", "Now, WGANs differ from standard GANs in how they quantify this distance. Regular GANs do so by Jensen\u2013Shannon divergence (JS) whereas WGANs use the Wasserstein distance, which is characterized by nicer properties. In particular, the Wasserstein metric is continuous, has well behaved gradients everywhere and therefore allows a smoother convergence in distribution even when the supports of the true and generated distributions lie in non-overlapping low dimensional manifolds. Check out this good article to explore more details.", "The plain Wasserstein Distance is rather intractable; hence the need to apply a smart trick \u2014 Kantorovich-Rubinstein duality \u2014 to overcome the obstacle and obtain the final form of our problem. As the theory goes, the function f_w in the new form of our Wasserstein metric must be K-Lipschitz continuous. f_w is learnt by our critic and belongs to a sequence of parametrized functions; w represents the set of parameters i.e., the weights.", "We say that a differentiable function is K-Lipschitz continuous if and only if it has gradients with norm at most K everywhere. K is called Lipschitz constant.", "Lipschitz continuity is a promising technique for improving GANs training. Unfortunately, its implementation remains challenging. In fact, this is an active area of research and there are several ways to enforce the constraint. The original WGAN paper proposes weight clipping but we adopt a \u201cgradient penalty\u201d (GP) approach as weight clipping can cause capacity problems and requires additional parameters to define the space where the weights lie. On the other hand, the GP approach enables stabler training with almost no hyper-parameter tuning.", "Our first architecture comes from this thesis which, among other things, presents a WGAN-GP architecture to produce univariate synthetic financial time series \u2014 it\u2019s always a good idea not to start from scratch. The proposed architecture is a mix of linear and convolutional layers in both G and D and it works out of the box. Unfortunately, with this setting the training does not look very stable and D is implemented with batch normalization (BN) despite the original WGAN-GP paper clearly prescribes \u201cNo critic batch normalization\u201d.", "So we get rid of BN and go for spectral normalization (SN). In simple terms, SN ensures D is K-Lipschitz continuous. To do so, it progressively acts on each layer of your critic to bound its Lipschitz constant. Refer to this great article and this paper for further details.", "Though with SN one could theoretically get rid of the GP term in the loss \u2014 SN and GP should be considered alternative ways to enforce Lipschitz continuity \u2014 our tests did not support this proposition. Nevertheless, SN improves training stability and makes convergence faster. We, therefore, adopt it both in G and D.", "Finally, the original WGAN-GP paper suggests to use Adam optimizers for both G and D but we empirically found that RMSprop better suited our needs.", "To give it a try you will also need a piece of code that computes losses, does the backward pass, updates model weights, saves logs, training samples etc\u2026 You will find it below. If you need more details about how to use this code please refer to this repo.", "The good news is that our model learns to generate realistic sine samples; the bad news is that sines are not asset returns! =) So, what\u2019s the next step to increase our trust in this model?", "Why don\u2019t we get rid of simple sines and feed the GAN with samples coming from an ARMA process whose parameters we know?!", "We choose a simple ARMA(1, 1) process with p=0.7 and q=0.2, generate real samples with a new Pytorch dataset and train the model.", "We now generate a hundred of fake samples, estimate p and q and have a look at the results below. p and q are the only parameters of our DGP.", "These results strengthen our trust and encourage further research.", "During our first experiments, we kept asking ourselves what to expect from our losses. Of course, everything depends on the training data, the optimization algorithm and the learning rate you choose but we empirically found that successful trainings are characterized by losses that, though not stable in the beginning, then converge gradually towards lower values. All other things being equal, lowering the learning rate may stabilize training.", "To check for mode collapse we use a different latent tensor each time we generate fake samples during training. With such a procedure we can check what happens when sampling different portions of the noise space. If you sample different random tensors and G keeps producing the same series then you are experiencing mode collapse. =(", "This is an important question I would like to answer with further experiments: GANs complexity must be justified by significantly better performance to be tolerated.", "We have to mention that, according to the authors of this paper, the standard GP approach may not be the best implementation of Lipschitz regularization. In addition, spectral normalization may unnecessarily constrain the critic and impair its ability to provide sound gradients to G. The authors propose an alternative method to use when the standard approaches fail. We will experiment with their suggestions soon.", "A well trained D is vital in a WGAN setting because the critic estimates the Wasserstein distance between the real and fake distributions. An optimal critic will provide good estimates of our distance metric and this, in turn, will cause the gradients to be healthy!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AI enthusiast with a Growth Mindset, a passion for Lifelong Learning, Economics and Innovative ideas."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe03596eb7185&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e03596eb7185--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@savastamirko?source=post_page-----e03596eb7185--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@savastamirko?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Mirko Savasta"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9fff65a0aeb3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&user=Mirko+Savasta&userId=9fff65a0aeb3&source=post_page-9fff65a0aeb3----e03596eb7185---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://jfds.pm-research.com/content/2/1/76.short", "anchor_text": "paper"}, {"url": "https://medium.com/u/802e9b15f86d?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Andrea Politano"}, {"url": "https://pytorch.org/tutorials/beginner/data_loading_tutorial.html", "anchor_text": "here"}, {"url": "https://arxiv.org/abs/1701.07875", "anchor_text": "Wasserstein GAN"}, {"url": "https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence", "anchor_text": "Jensen\u2013Shannon divergence"}, {"url": "https://en.wikipedia.org/wiki/Wasserstein_metric", "anchor_text": "Wasserstein distance"}, {"url": "https://lilianweng.github.io/lil-log/2017/08/20/from-GAN-to-WGAN.html", "anchor_text": "article"}, {"url": "https://en.wikipedia.org/wiki/Lipschitz_continuity", "anchor_text": "K-Lipschitz continuous"}, {"url": "https://arxiv.org/abs/1704.00028", "anchor_text": "gradient penalty"}, {"url": "https://repository.tudelft.nl/islandora/object/uuid%3A51d69925-fb7b-4e82-9ba6-f8295f96705c", "anchor_text": "thesis"}, {"url": "https://christiancosgrove.com/blog/2018/01/04/spectral-normalization-explained.html", "anchor_text": "article"}, {"url": "https://arxiv.org/abs/1802.05957", "anchor_text": "paper"}, {"url": "https://github.com/mirkosavasta/GANetano", "anchor_text": "repo"}, {"url": "https://en.wikipedia.org/wiki/Autoregressive\u2013moving-average_model", "anchor_text": "ARMA"}, {"url": "https://arxiv.org/abs/1904.01184", "anchor_text": "paper"}, {"url": "https://medium.com/tag/generative-adversarial?source=post_page-----e03596eb7185---------------generative_adversarial-----------------", "anchor_text": "Generative Adversarial"}, {"url": "https://medium.com/tag/trading?source=post_page-----e03596eb7185---------------trading-----------------", "anchor_text": "Trading"}, {"url": "https://medium.com/tag/synthetic-data?source=post_page-----e03596eb7185---------------synthetic_data-----------------", "anchor_text": "Synthetic Data"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e03596eb7185---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----e03596eb7185---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&user=Mirko+Savasta&userId=9fff65a0aeb3&source=-----e03596eb7185---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&user=Mirko+Savasta&userId=9fff65a0aeb3&source=-----e03596eb7185---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe03596eb7185&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e03596eb7185---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e03596eb7185--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e03596eb7185--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e03596eb7185--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e03596eb7185--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e03596eb7185--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@savastamirko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@savastamirko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mirko Savasta"}, {"url": "https://medium.com/@savastamirko/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "71 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9fff65a0aeb3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&user=Mirko+Savasta&userId=9fff65a0aeb3&source=post_page-9fff65a0aeb3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F9fff65a0aeb3%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgenerating-synthetic-financial-time-series-with-wgans-e03596eb7185&user=Mirko+Savasta&userId=9fff65a0aeb3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}