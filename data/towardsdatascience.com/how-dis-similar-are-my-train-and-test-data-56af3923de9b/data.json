{"url": "https://towardsdatascience.com/how-dis-similar-are-my-train-and-test-data-56af3923de9b", "time": 1682993372.465051, "path": "towardsdatascience.com/how-dis-similar-are-my-train-and-test-data-56af3923de9b/", "webpage": {"metadata": {"title": "How (dis)similar are my train and test data? | by Shikhar Gupta | Towards Data Science", "h1": "How (dis)similar are my train and test data?", "description": "They always say that don\u2019t compare apples to oranges. But how about if we\u2019re comparing one mix of apples and oranges with another mix of apples and oranges, but the distribution is different. Can you\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data", "anchor_text": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data", "paragraph_index": 11}], "all_paragraphs": ["They always say that don\u2019t compare apples to oranges. But how about if we\u2019re comparing one mix of apples and oranges with another mix of apples and oranges, but the distribution is different. Can you still compare ? And how will you go about it ?", "In most of the cases in the real world, you\u2019ll come across the latter.", "This happens quite often in data science. While developing a machine learning model we come across a situation where our model performs well on our training data but it fails to match up to the same performance for the test data.", "I\u2019m not referring to overfitting here. Even if I\u2019ve picked my best model based on cross-validation and it still performs poorly on test data, there is some inherent patterns in test data that we are not capturing.", "Imagine a situation where I\u2019m trying to model the shopping behaviour of customers. Now if my train and test data looks like below then you can clearly see the issue here.", "The model will be trained on customers with lower average age compared to test. This model would have never seen age patterns like the ones in test data. If age is an important feature in your model, then it\u2019ll not perform well on the test.", "In this post, I\u2019ll talk about how to identify this issue and some raw ideas on how we can fix it.", "We can define this situation more formally. Covariate refers to the predictor variables in our model. Covariate shift refers to a situation where predictor variables have different characteristics (distribution) in train and test data.", "In real world problems with many variables, covariate shift is hard to spot. In this post I have tried to discuss a method to identify this and also how to account for such shift between train and test.", "If there exist a covariate shift, then upon mixing train and test we\u2019ll still be able to classify the origin of each data point (whether it is from test or train) with good accuracy.", "Let\u2019s understand why. Consider the above example where age was the drifting feature between test and train. If we take a classifier like Random Forest and try to classify rows into test and train, age will be come out be very important feature in splitting the data.", "Now let\u2019s try to apply this idea on a real dataset. I\u2019m using dataset from this kaggle competition: https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data", "We have to first clean our data, impute all missing values and do label encoding for all the categorical variables. For this dataset, this step was not required so I have skipped this step", "Step2: Indicator for source of origin", "We have to add a feature \u2018is_train\u2019 in both train and test data. Value for this feature will be 0 for test and 1 for train.", "Then we have to combine both the datasets. Also since train data has the original \u2018target\u2019 variable which is not present in test, we have to drop that variable too.", "Note: For your problem, \u2018target\u2019 will be replaced by the name of the dependent variable for your original problem", "Step4: Building and testing a classifier", "For classification purposes I\u2019m using Random Forest Classifier to predict the labels for each row in the combined dataset. You can use any other classifier also.", "We are using stratified 4 fold to ensure that percentage for each class is preserved and we cover the whole data once. For each row the classifier will calculate the probability of it belonging to train.", "We\u2019ll output the ROC-AUC metric for our classifier as an estimate how much covariate shift this data has.", "If the classifier is able to classify the rows into train and test with good accuracy, our AUC score should be on the higher side (greater than 0.8). This implies strong covariate shift between train and test.", "AUC value of 0.49 implies that there is no evidence of strong covariate shift. This means that majority of the observations comes from a feature space which is not specific to test or train.", "As this dataset is taken from Kaggle, this result is quite expected. As in such kind of competition dataset is carefully curated to ensure such shifts are not there.", "This process can be replicated for any data science problem to check for covariate shift before we start modeling.", "At this point we either observe covariate shift or not. So what can we possibly do to improve our performance on the test data ??", "Note: This method is applicable to the situation where you witness covariate shift.", "The idea is to remove the features that fall in the red bucket", "Importance weight using Density Ratio Estimation", "Note: This method is applicable irrespective of whether there exist a covariate shift or not.", "Let\u2019s look at the predictions that we have calculated in the previous section. For each observation, this prediction tells us the probability that it belongs to the training data according to our classifier.", "So for the first row our classifier thinks that it belongs to training data with .34 probability. Let\u2019s call this P(train). Or we can also say that it has .66 probability of being from the test data. Let\u2019s call this as P(test). Now here is the magic trick:", "For each row of training data we calculate a coefficient w = P(test)/P(train).", "This w tells us how close is the observation from the training data to our test data. Here is the punchline:", "We can use this w as sample weights in any of our classifier to increase the weight of these observation which seems similar to our test data. Intuitively this makes sense as our model will focus more on capturing patterns from the observations which seems similar to our test.", "These weights can be calculated using the below code.", "You can pass the weights calculated in the model fit method like this:", "Some things to notice in the above plot:", "I hope that now you have a better understanding about covariate shift, how you can identify it and treat it effectively.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Applied scientist @Amazon, USF MSDS & IIT Roorkee alumunus (Twitter:@shik1470)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F56af3923de9b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----56af3923de9b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@shik1470?source=post_page-----56af3923de9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shik1470?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Shikhar Gupta"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F83100b0fd306&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&user=Shikhar+Gupta&userId=83100b0fd306&source=post_page-83100b0fd306----56af3923de9b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data", "anchor_text": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data"}, {"url": "https://github.com/erlendd/covariate-shift-adaption", "anchor_text": "https://github.com/erlendd/covariate-shift-adaption"}, {"url": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data", "anchor_text": "https://www.kaggle.com/c/porto-seguro-safe-driver-prediction/data"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----56af3923de9b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----56af3923de9b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/validation?source=post_page-----56af3923de9b---------------validation-----------------", "anchor_text": "Validation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&user=Shikhar+Gupta&userId=83100b0fd306&source=-----56af3923de9b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&user=Shikhar+Gupta&userId=83100b0fd306&source=-----56af3923de9b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F56af3923de9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----56af3923de9b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----56af3923de9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----56af3923de9b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----56af3923de9b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----56af3923de9b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----56af3923de9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shik1470?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shik1470?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Shikhar Gupta"}, {"url": "https://medium.com/@shik1470/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "642 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F83100b0fd306&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&user=Shikhar+Gupta&userId=83100b0fd306&source=post_page-83100b0fd306--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe8b207c26866&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-dis-similar-are-my-train-and-test-data-56af3923de9b&newsletterV3=83100b0fd306&newsletterV3Id=e8b207c26866&user=Shikhar+Gupta&userId=83100b0fd306&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}