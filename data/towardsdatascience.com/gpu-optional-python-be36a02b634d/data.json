{"url": "https://towardsdatascience.com/gpu-optional-python-be36a02b634d", "time": 1683016333.6006389, "path": "towardsdatascience.com/gpu-optional-python-be36a02b634d/", "webpage": {"metadata": {"title": "GPU-Optional Python. Write code that exploits a GPU when\u2026 | by Carl M. Kadie | Towards Data Science", "h1": "GPU-Optional Python", "description": "The wonderful CuPy library allows you to easily run NumPy-compatible code on a NVIDIA GPU. However, sometimes By defining three simple utility functions, you can make your code GPU-optional. (Find\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cupy.dev/", "anchor_text": "CuPy library", "paragraph_index": 0}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "this small GitHub project", "paragraph_index": 1}, {"url": "https://fastlmm.github.io/", "anchor_text": "FaST-LMM", "paragraph_index": 2}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub", "paragraph_index": 4}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub", "paragraph_index": 13}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub", "paragraph_index": 20}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "this small GitHub project", "paragraph_index": 26}], "all_paragraphs": ["The wonderful CuPy library allows you to easily run NumPy-compatible code on a NVIDIA GPU. However, sometimes", "By defining three simple utility functions, you can make your code GPU-optional. (Find the utility functions\u2019 definitions in this small GitHub project.)", "When we tried to use CuPy to add GPU-support to FaST-LMM \u2014 our open-source genomics package \u2014 we ran into three problems. We solved each problem with a simple utility function. Let\u2019s look at each problem, the utility function that solves it, and examples.", "Suppose you want to generate an array of simple random DNA data. Rows represent individuals. Columns represent DNA locations. Values represent an \u201callele count\u201d that can be 0, 1, 2, or NaN (for missing). Additionally, you want to", "The utility function array_module (defined in GitHub) solves the problem. Here is the resulting data generator that use uses array_module:", "As desired, the DNA generator defaults to returning anumpy array.", "Notice gen_data\u2019s optional xp parameter. As xp passes through thearray_module utility function, here is what happens:", "Let\u2019s see it work on my machine which has a GPU and CuPy installed:", "As expected, it generates a cupy array, as requested.", "Aside: Notice that NumPy and CuPy generate different random numbers, even when given the same seed.", "Next, let\u2019s request CuPy via an environment variable.", "As expected, we can request a cupy array via an environment variable. (Also, using patch, we can set an environment variable temporarily.)", "Suppose you want to \u201cstandardize\u201d an array of DNA data. Here \u201cstandardize\u201d means to make the values for each column have mean 0.0 and standard deviation 1.0, and to fill in missing values with 0.0. Additionally, you want this to work", "The utility function get_array_module (defined in GitHub) solves the problem. Here is a standardizer that uses get_array_module:", "Notice how we use get_array_module to set xp to the array module (either numpy or cupy). Then we use xp to call functions such as xp.isnan.", "On my computer, this runs fine, returning an answer in about 5 seconds.", "Next, let\u2019s standardize a CuPy array:", "On my computer, standardize runs faster on the CuPy array, returning an answer in about 1 second.", "Aside: So is the GPU faster? Not necessarily. The CPU run above only used one of my six CPUs. When I use other techniques \u2014 for example, Python multiprocessing or C++ code with multithreading \u2014 to run on all 6 CPUs then the runtimes become comparable.", "Suppose your data starts as a NumPy array and you need to covert it to whatever your desired xp array module is. Later, suppose your data is an xp array and you need to covert it to an NumPy array. (These situations happen when using packages such as Pandas that know about NumPy, but not CuPy.)", "The built-in function xp.asarray and the utility function asnumpy (defined in GitHub) solves the problem. Here is an example:", "This example generates a random NumPy array. Converts it to CuPy (if possible). Standardizes it. Converts (if necessary) to NumPy. On my computer, it runs in about 2 seconds.", "If CuPy is not installed, the code still runs fine (in about 5 seconds), producing this output:", "Aside: Notice that we now see the same results whether CuPy is installed or not. Why? Because this example always uses NumPy to generate the random data.", "We\u2019ve seen how three utility functions enable you to write code that works with or without a GPU.", "In addition to enabling code that works with or without a GPU, writing your code GPU-Optional offers an extra benefit. GPUs will sometimes fail to speed up your work. By making your code GPU-optional you gain the ability to turn off GPU processing when it doesn\u2019t help.", "You can find the definitions of these utility functions in this small GitHub project.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. in CS and Machine Learning. Retired Microsoft & Microsoft Research. Volunteer, open-source projects related to ML, Genomics, Rust, and Python."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbe36a02b634d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----be36a02b634d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@carlmkadie?source=post_page-----be36a02b634d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carlmkadie?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Carl M. Kadie"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa5e87027005f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&user=Carl+M.+Kadie&userId=a5e87027005f&source=post_page-a5e87027005f----be36a02b634d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@frdx?utm_source=medium&utm_medium=referral", "anchor_text": "Fredrick Tendong"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://cupy.dev/", "anchor_text": "CuPy library"}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "this small GitHub project"}, {"url": "https://fastlmm.github.io/", "anchor_text": "FaST-LMM"}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub"}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub"}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "GitHub"}, {"url": "https://github.com/CarlKCarlK/gpuoptional/", "anchor_text": "this small GitHub project"}, {"url": "https://medium.com/tag/python?source=post_page-----be36a02b634d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/gpu?source=post_page-----be36a02b634d---------------gpu-----------------", "anchor_text": "Gpu"}, {"url": "https://medium.com/tag/data-science?source=post_page-----be36a02b634d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/cuda?source=post_page-----be36a02b634d---------------cuda-----------------", "anchor_text": "Cuda"}, {"url": "https://medium.com/tag/bioinformatics?source=post_page-----be36a02b634d---------------bioinformatics-----------------", "anchor_text": "Bioinformatics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&user=Carl+M.+Kadie&userId=a5e87027005f&source=-----be36a02b634d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&user=Carl+M.+Kadie&userId=a5e87027005f&source=-----be36a02b634d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbe36a02b634d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----be36a02b634d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----be36a02b634d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----be36a02b634d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----be36a02b634d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----be36a02b634d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----be36a02b634d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carlmkadie?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@carlmkadie?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Carl M. Kadie"}, {"url": "https://medium.com/@carlmkadie/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "277 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa5e87027005f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&user=Carl+M.+Kadie&userId=a5e87027005f&source=post_page-a5e87027005f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd9d0c3a2db0e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgpu-optional-python-be36a02b634d&newsletterV3=a5e87027005f&newsletterV3Id=d9d0c3a2db0e&user=Carl+M.+Kadie&userId=a5e87027005f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}