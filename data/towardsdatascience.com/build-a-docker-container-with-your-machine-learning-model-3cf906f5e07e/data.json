{"url": "https://towardsdatascience.com/build-a-docker-container-with-your-machine-learning-model-3cf906f5e07e", "time": 1683000717.293118, "path": "towardsdatascience.com/build-a-docker-container-with-your-machine-learning-model-3cf906f5e07e/", "webpage": {"metadata": {"title": "Build a Docker Container with Your Machine Learning Model | by Tina Bu | Towards Data Science", "h1": "Build a Docker Container with Your Machine Learning Model", "description": "As a data scientist, I don\u2019t have a lot of software engineering experience but I have certainly heard a lot of great comments about containers. I have heard about how lightweight they are compared to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/configure-cloud-environment-for-batch-ml-job-on-aws-82edb5631540", "anchor_text": "second part", "paragraph_index": 2}, {"url": "https://docs.docker.com/develop/develop-images/dockerfile_best-practices/", "anchor_text": "best practices", "paragraph_index": 13}, {"url": "https://github.com/jfloff/alpine-python", "anchor_text": "Alpine Python", "paragraph_index": 14}, {"url": "https://docs.docker.com/engine/reference/builder/", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://docs.docker.com/engine/reference/commandline/cli/", "anchor_text": "here", "paragraph_index": 31}], "all_paragraphs": ["As a data scientist, I don\u2019t have a lot of software engineering experience but I have certainly heard a lot of great comments about containers. I have heard about how lightweight they are compared to traditional VMs, how good they are at ensuring a safe consistent environment for your code, and how my devops effort it saves so you can focus on your code.", "However, when I tried to Dockerize my own model, I soon realized it is not that intuitive. It is not at all as simple as putting RUN in front of your EC2 bootstrap script. I found that inconsistencies and unpredictable behaviors happen quite a lot and it can be frustrating to learn to debug a new tool.", "All of these motivated me to create this post with all the code snippets you need to factorize your ML model in Python to a Docker container. I will guide you through installing all the pip packages you need and build your first container image. And in the second part of this post, we will be setting up all the necessary AWS environments and kicking off the container as a Batch job in the third and last part of this series.", "Disclaimer 1: The model I am talking about here is a batch job on a single instance, NOT a web service with API endpoints, NOT distributed parallel jobs. If you follow this tutorial, the whole process to put your code to a container should not take more than 25 minutes.", "Disclaimer 2: If this is your first time reading about containers, this post is probably not going to provide the necessary information for understanding how containers work and I would highly recommend you check out some tutorials online before you proceed.", "To get your code to a container, you need to create a Dockerfile, which tells Docker what you need in your application.", "A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image.", "(You can build a Docker image from either Dockerfile or docker-compose.yml. If your code can be refactored as a multi-container Docker application, you may want to look into docker compose but now a Dockerfile should suffice.)", "A Docker image starts with a base image and is built up by read-only layers, with each of them adding some dependencies. In the end, you tell the container how to trigger your model.", "In the Dockerfile above, I started with the base Python 3.6 stretch image, apt-get updated the system libraries, installed some make and build stuff, checked my python and pip version to make sure they are good, set up my work directory, copied requirements.txt to the container and pip installed all the libraries in it, and finally copied all the other code files to the container, listed all the files to make sure all I need is there and triggered my entrypoint main.py file.", "This Dockerfile should work for you if your code folder structure is like this.", "If your code doesn\u2019t have a main.py or shell script to trigger the model training/inferencing yet, then you may want to refactor your code first. Also remember to freeze the library dependencies into a requirements.txt file with pipreqs path/to/project . I recommend using pipreqs rather than pip freeze because when you run pip freeze > requirements.txt it outputs all the installed packages in that environment whereas pipreqs gives you only the ones actually imported by this project. (Install pipreqs with pip(3) install pipreqs if you don\u2019t have it already)", "If your code already has an entrypoint, all you need to do is to change the <app- name> to your application\u2019s name and we are ready to build it into an image.", "There are a lot of best practices to make a Dockerfile smaller and more efficient but most of them are out of the scope for this post. However, a few things you may want to be mindful about are:", "People say instead of starting with a generic Ubuntu image, use an official base image like Alpine Python instead. Alpine Python is a really small Python Docker image based on Alpine Linux, much smaller than the default docker python images but still has everything needed for the most common python projects. But I have found it extremely difficult to work with especially for installing packages.", "A Ubuntu base image, on the other hand, will provide more predictable behavior but you need to install all the Python stuff yourself.", "So I suggest you start with Python 3.6 stretch, which is the official Python image based on Debian 9 (aka stretch). Python stretch comes with the Python environment and pip installed and up to date, all of which you need to figure out how to install if you choose Ubuntu.", "It\u2019s also very tempting to copy and paste some Dockerfile template posted online especially if this is your first Docker project. But it\u2019s suggested to only install the things you actually need to control the size of the image. If you see a whole bunch of make and build stuff other people installed, try to not include them first and see if your container will work. A smaller image generally means it\u2019s faster to build and deploy. (Another reason you should try my minimalism template above!)", "Also to keep the image as lean as possible, use .dockerignore which works exactly like .gitignore to ignore files that won\u2019t impact the model.", "In your Dockerfile, always add your requirements.txt file before copying the source code. That way, when you change your code and re-build the container, Docker will re-use the cached layer up until the installed packages instead of executing the pip install command on every build even if the library dependencies never changed. No one wants to wait a couple of extra minutes just because you added an empty line in your code.", "If you are interested to learn more about Dockerfile, in appendix I there is a quick summary of a few basic commands we used. Or you can check the Dockerfile documentation here.", "Now feel free to jump to Step 2 to build a container with the Dockerfile you just created.", "After you have a Dockerfile ready, it\u2019s time to build a container image. docker build creates an image according to the instructions given in the Dockerfile. All you need to do is to give your image a name (an an optional version tag).", "The only difference between the 2 commands is if there is a USERNAME/ before the image name. An image name is made up of slash-separated name components, usually the prefix is the registry hostname. USERNAME/IMAGE_NAME is not a mandatory format for specifying the name of the image in general. But images in Amazon ECR repositories do follow the full REGISTRY/REPOSITORY:TAG naming convention. For example, aws_account_id.dkr.ecr.region.amazonaws.com/my-web-app:latest.", "A few things are happening in the commands above.", "First, we told the Docker daemon to fetch the Dockerfile present in the current directory (that\u2019s what the . at the end does).", "Next, we told the Docker daemon to build the image and give it the specified tag. Tagging has always been very confusing for me. Generally tagging an image is like giving it an alias. It\u2019s the same as assigning an existing image another name to refer to it. It helps with distinguishing versions of your Docker images.", "It\u2019s not mandatory to specify a tag name. The :latest tag is a default tag when build is run without a specific tag specified. So it\u2019s suggested that you explicitly tag your image after each build if you want to maintain a good version history.", "You can tag an image while building your image with docker build -t USERNAME/IMAGE_NAME:TAG . or explicit tag it like docker tag SOURCE_IMAGE:TAG TARGET_IMAGE:TAG after it was built.", "Now if you run docker images, you should see an image exists locally whose repository is USERNAME/IMAGE_NAME and tag is TAG .", "I would also recommend you to test your container on your local machine at this point to make sure everything works fine.", "Feel free to check appendix II for a quick summary of some basic Docker CLI commands or the official document here.", "Congratulation! You just baked your model into a container that can be run anywhere Docker is installed. Join me for the second part of this post to configure your AWS environment to meet the prerequisite for scheduling a batch job.", "Some basic Docker CLI commands include:", "I am a machine learning engineer and I write about productivity and self-development besides tech tutorials. I visited Yellowstone on 4th of July thus the cover image.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3cf906f5e07e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tinabu.medium.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": ""}, {"url": "https://tinabu.medium.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Tina Bu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2511f99cdfc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&user=Tina+Bu&userId=e2511f99cdfc&source=post_page-e2511f99cdfc----3cf906f5e07e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@cleipelt?utm_source=medium&utm_medium=referral", "anchor_text": "Chris Leipelt"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/configure-cloud-environment-for-batch-ml-job-on-aws-82edb5631540", "anchor_text": "second part"}, {"url": "https://aws.amazon.com/account/", "anchor_text": "an AWS account"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html", "anchor_text": "AWS CLI"}, {"url": "https://docs.docker.com/install/", "anchor_text": "Docker"}, {"url": "https://hub.docker.com", "anchor_text": "DockerHub"}, {"url": "https://www.python.org/downloads/", "anchor_text": "Python 3"}, {"url": "https://docs.docker.com/develop/develop-images/dockerfile_best-practices/", "anchor_text": "best practices"}, {"url": "https://github.com/jfloff/alpine-python", "anchor_text": "Alpine Python"}, {"url": "https://docs.docker.com/engine/reference/builder/", "anchor_text": "here"}, {"url": "https://docs.docker.com/engine/reference/commandline/cli/", "anchor_text": "here"}, {"url": "https://medium.com/tag/docker?source=post_page-----3cf906f5e07e---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3cf906f5e07e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/containers?source=post_page-----3cf906f5e07e---------------containers-----------------", "anchor_text": "Containers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&user=Tina+Bu&userId=e2511f99cdfc&source=-----3cf906f5e07e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&user=Tina+Bu&userId=e2511f99cdfc&source=-----3cf906f5e07e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3cf906f5e07e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3cf906f5e07e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3cf906f5e07e--------------------------------", "anchor_text": ""}, {"url": "https://tinabu.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tinabu.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tina Bu"}, {"url": "https://tinabu.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "257 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2511f99cdfc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&user=Tina+Bu&userId=e2511f99cdfc&source=post_page-e2511f99cdfc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F892fab03a340&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-a-docker-container-with-your-machine-learning-model-3cf906f5e07e&newsletterV3=e2511f99cdfc&newsletterV3Id=892fab03a340&user=Tina+Bu&userId=e2511f99cdfc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}