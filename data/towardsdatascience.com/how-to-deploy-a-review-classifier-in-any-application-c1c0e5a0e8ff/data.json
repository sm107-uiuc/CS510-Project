{"url": "https://towardsdatascience.com/how-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff", "time": 1683003102.3117812, "path": "towardsdatascience.com/how-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff/", "webpage": {"metadata": {"title": "How to extract Review Classifier model to reuse for real time classification | by Emre Havan | Towards Data Science", "h1": "How to extract Review Classifier model to reuse for real time classification", "description": "There are many tutorials and examples out there about training a review classifier with big portion of the available dataset and testing it with the remaining portion to see how it performs. It sure\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/jiashenliu/515k-hotel-reviews-data-in-europe", "anchor_text": "here.", "paragraph_index": 4}, {"url": "https://towardsdatascience.com/understanding-random-forest-58381e0602d2", "anchor_text": "[1]", "paragraph_index": 32}, {"url": "https://github.com/emrepun/PunReviewClassifier", "anchor_text": "here", "paragraph_index": 48}, {"url": "https://github.com/emrepun", "anchor_text": "https://github.com/emrepun", "paragraph_index": 50}], "all_paragraphs": ["There are many tutorials and examples out there about training a review classifier with big portion of the available dataset and testing it with the remaining portion to see how it performs.", "It sure is nice to see how to build a classifier and how it performs, but how can we export this classifier and install, run in any application so that we can do real-time review classification?", "In this post, first we are going to build a review classifier with 515K Hotel Reviews Data in Europe with some domain adaptation so it can be more generic rather than hotel specific and then we are going to export our classifier with feature indexes to apply on any application of our choice.", "If you are only interested with how are we going to extract and apply the classifier in other applications, you can go to We have a classifier, now what? section.", "Go ahead and download the dataset here.", "We have a huge dataset available for hotels here, and it has many features, hotel_address, review_date, average_score, positive_review, negative_review to name a few. Each entry in the dataset comes from a user for a specific hotel. Each user asked to provide both positive and negative reviews for the hotels they have stayed. It is worth mentioning that, there are some cases where users are only provided one of the two. We see the following feature values when user did not provide a review for positive and negative respectively:", "In this post we will only care about positive_review and negative_review features regardless of which user wrote for which hotel.", "We need to do some preprocessing for our dataset. First we will create a new dataset by only getting positive and negative reviews among 1 percent of the original dataset. (We will only use 5K data entries for this article but you can try building with the whole dataset later on). Then we will clear out the missing reviews (No negative, positive, nothing and etc).", "Lets create a folder for the project, locate the dataset in that folder and then create a new python file for preprocessing. I name it hotel_review_pre_processor.", "First we will import pandas and numpy and then load 1 percent of the original dataset.", "Then lets create a new empty dataframe with review and is_positive features that we will populate later on with the reviews from the hotel dataset.", "Now we will replace No Positive and No Negative values in our dataset with empty strings, then replace them with NaN and finally drop them:", "Then we will do the following:", "Now we are done with preprocessing. We have taken reviews out from the hotel dataset into a new dataset called reviews.csv, with review and is_positive feature. Now we should have around 6500 reviews available for us to analyze. As I mentioned earlier, by changing the frac parameter in the following line, you can increase or decrease the portion of the dataset you use:", "Now we have processed the reviews and refactored them into a new dataset with the features we are interested in, but we still have a problem. Since the original dataset is from hotel reviews, they most probably include words specific to the hotel industry such as: hotel, bed, shower, breakfast and etc. We need to get rid of such words if we want to our classifier to later be generic.", "But first we will get rid of the stop words (words that do not has any contextual meanings such as: for, the, a, or, what and etc), and then stem existing word in reviews to remove duplicates. As an example, when stemming is applied to any of the following word, they all will result in run.", "Go ahead and create a file called review_cleaner.py.", "We will create this as a separate class, as we will need this method again later from multiple files:", "The method will work as following:", "If you ever get the following error: \u201cResource stopwords not found\u201d even if you have nltk library. Open a terminal and execute the following commands:", "- This should fix the error.", "Now lets create a file called review_generifier.py and add the following code block:", "Please note that it will take a while to apply clearing to each data entry in the dataset depending on your machine.", "Here we apply clean_review method from ReviewCleaner class to every review we have available in the dataset. Then we print out the most occurring 100 words with the occurrence amount. (Only 20 is shown for simplicity):", "As you can see, there are words such as; room, staff, hotel, breakfast and etc (you can see more on the whole printed list) that are very specific to hotel industry. We do not want such words to be fed in our classifier if we want to make it generic. Thus we are going remove such words now.", "Now lets create a list of words that we would like to remove from our reviews:", "You can/should also try with removing other words to see if it will affect the accuracy of your classifier.", "We need to import re in order to remove unwanted words. Import re as following on top of the file with other imports:", "Now lets remove unwanted words from our data frame as following:", "You can get the common words and print them again after updating the data frame and you should see that words declared in unwanted_words are now gone.", "Now we will save our updated dataset as cleared_reviews.csv with the following code at the end:", "From now on, we will be using cleared_reviews.csv dataset :)", "Now that we have our generic dataset, we can train a Random Forest Classifier (RFC) [1] model to work as our generic classifier. (Please note that a review classifier can be implemented with many different approaches, I just wanted to go with RFC).", "Now lets create a new file rf_classifier_training.py and add the following code:", "Here we train a classifier as following:", "Printed score should be around 0.90, meaning for every 10 reviews, 9 of them were successfully classified with current label (positive or negative). I think it is pretty good for a RFC as we didn\u2019t try to optimize its parameters.", "Now we have a classifier that can classify reviews as positive or negative. But how are we gonna extract it to use later in an application to classify new data?", "In order to do so, we are going to need to save our model. But this is not enough. Because how are we going to fit new data into this model if we have no idea about the features (words). More specifically, we don\u2019t know which word has what index in feature space. Thus, we are also going to find feature indexes for each word and save them separately.", "Add the following code right after printing the score in rf_classifier_training.py:", "[word: index] dictionary is saved as json key values under word_feature_space.json and classifier model is saved as reviewClassifier.pkl.", "Now run rf_classifier_training.py again to save json and pkl files.", "These files wont be included in github repo as model\u2019s size is going to be around 100 Mb. So you have to run rf_classifier_training.py to acquire these files.", "Now that we have our model and json, we can write a service to provide classification for any given text.", "Our service will work as following:", "It is worth giving more details about the creation of vector from the review, we check each word in the review, if it exists in our word space (word_feature_space.json), we add it to vector space and increase word count, but if it does not exist, we just simply discard it.", "Now we will make a sample request to the service to see how our classifier will perform with new data, lets create example_request.py:", "As you can see, our classifier service can provide a json response with value of 1 for positive and 0 for negative. I\u2019m not trying with different reviews here for simplicity, but it should work fine unless you provide a tricky review (a review with many positive and negative words =D). Please go ahead and try with different reviews as well.", "In this article, we have seen how to play with data to make it useful, how to make a dataset more generic, how to build a review classifier and more importantly how to extract this classifier model and make it to possible to apply to any application we want. You can use these or similar approaches to get your classifiers and then deploy them in your backend and provide a service to lots of applications and clients.", "You can find the completed repository here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "iOS Software Engineer \u2014 Interested in Compilers, ML and recommender systems \u2014 https://github.com/emrepun"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc1c0e5a0e8ff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://emrehavan.medium.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": ""}, {"url": "https://emrehavan.medium.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Emre Havan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff1991f635894&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&user=Emre+Havan&userId=f1991f635894&source=post_page-f1991f635894----c1c0e5a0e8ff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/jiashenliu/515k-hotel-reviews-data-in-europe", "anchor_text": "here."}, {"url": "http://twitter.com/staticmethod", "anchor_text": "@staticmethod"}, {"url": "https://towardsdatascience.com/understanding-random-forest-58381e0602d2", "anchor_text": "[1]"}, {"url": "https://github.com/emrepun/PunReviewClassifier", "anchor_text": "here"}, {"url": "https://medium.com/tag/classification?source=post_page-----c1c0e5a0e8ff---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c1c0e5a0e8ff---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c1c0e5a0e8ff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/application-development?source=post_page-----c1c0e5a0e8ff---------------application_development-----------------", "anchor_text": "Application Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&user=Emre+Havan&userId=f1991f635894&source=-----c1c0e5a0e8ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&user=Emre+Havan&userId=f1991f635894&source=-----c1c0e5a0e8ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc1c0e5a0e8ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c1c0e5a0e8ff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c1c0e5a0e8ff--------------------------------", "anchor_text": ""}, {"url": "https://emrehavan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://emrehavan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Emre Havan"}, {"url": "https://emrehavan.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "118 Followers"}, {"url": "https://github.com/emrepun", "anchor_text": "https://github.com/emrepun"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff1991f635894&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&user=Emre+Havan&userId=f1991f635894&source=post_page-f1991f635894--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc519ffe5aa0e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-deploy-a-review-classifier-in-any-application-c1c0e5a0e8ff&newsletterV3=f1991f635894&newsletterV3Id=c519ffe5aa0e&user=Emre+Havan&userId=f1991f635894&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}