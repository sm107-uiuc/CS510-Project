{"url": "https://towardsdatascience.com/how-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d", "time": 1682993261.073946, "path": "towardsdatascience.com/how-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d/", "webpage": {"metadata": {"title": "How to extend a canned TensorFlow Estimator | by Lak Lakshmanan | Towards Data Science", "h1": "How to extend a canned TensorFlow Estimator", "description": "Prebuilt (\u201ccanned\u201d) estimators like DNNRegressor and DNNLinearCombinedRegressor make life easy when writing TensorFlow programs. For example, here is a complete TensorFlow program to train a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/blob/master/courses/machine_learning/deepdive/03_tensorflow/taxifare/trainer/model.py#L37", "anchor_text": "input function", "paragraph_index": 2}, {"url": "https://cloud.google.com/blog/big-data/2018/02/easy-distributed-training-with-tensorflow-using-tfestimatortrain-and-evaluate-on-cloud-ml-engine", "anchor_text": "train_and_evaluate", "paragraph_index": 2}, {"url": "https://medium.com/google-cloud/how-to-do-time-series-prediction-using-rnns-and-tensorflow-and-cloud-ml-engine-2ad2eeb189e8", "anchor_text": "see example", "paragraph_index": 3}, {"url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/estimator/python/estimator/extenders.py", "anchor_text": "extenders.py", "paragraph_index": 4}, {"url": "https://github.com/GoogleCloudPlatform/cloudml-samples/issues/67", "anchor_text": "frequently", "paragraph_index": 4}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/blob/master/courses/machine_learning/deepdive/07_structured/babyweight/trainer/model.py#L132", "anchor_text": "workaround", "paragraph_index": 10}], "all_paragraphs": ["Prebuilt (\u201ccanned\u201d) estimators like DNNRegressor and DNNLinearCombinedRegressor make life easy when writing TensorFlow programs. For example, here is a complete TensorFlow program to train a TensorFlow model starting from an in-memory Pandas DataFrame:", "If you want to use TensorFlow like scikit-learn, the number of lines of code is pretty much the same.", "In reality, though, you want to be more robust than this. You want to read sharded files that don\u2019t all fit into memory, batch them, etc. This involves a bit more code in your input function using the Dataset API in TensorFlow. And you want to checkpoint and evaluate every once in a while as you train. So, you don\u2019t want just call train, you want to call train_and_evaluate.", "Prebuilt Estimators are pretty straightforward, but also quite opinionated \u2014 they choose a specific way of doing things and give you a bunch of stuff out of the box. If you want more flexibility? Well, write a custom estimator (see example)!", "But there is a gray area in between. You can use a canned estimator, and still get some amount of flexibility. How? Use the capabilities in extenders.py. In this blog post, I\u2019ll show you two such capabilities (incidentally, these are two very frequently asked questions).", "When you use a DNNRegressor, the metric that is part of the evaluation loop is only average_loss, which in this case happens to be the RMSE. But what if you want more metrics? Simply wrap the estimator by add_metrics as follows:", "Note that the my_rmse method above receives the labels and the entire predictions tensor. This way, if you are doing classification and some of your metrics need the predicted class and others need the predicted probabilities, you can compute what you want.", "The predictions dict returned by a canned Estimator has only the predictions in it (duh!). But there are lots of situations when you want the predictions to contain a bit of the input also. For example, you may have a unique key associated with each row, and you want that key to be part of the predictions so that you know which row the prediction corresponds to. Or you might want to compute evaluations based on specific input values (e.g. compute RMSE of baby weight based on whether the baby is pre-term or full-term).", "To do that, wrap the estimator by forward_features as follows:", "You can pass in either a single string (as I did above) or a list of strings. Ideally, that\u2019s all you need. However, there are two caveats.", "The first caveat is that the key column above gets added to the output of predictions, but not to the export signature, so it will work while the model is in memory but not if it is restored after training (this makes no sense: I have submitted a pull request to the TensorFlow repo to fix this). Until then, you need this workaround:", "The second caveat is that you can not both pass-through a feature *and* use it as input to your model. Either consume the input or pass it through. The workaround here is to duplicate such columns that you want in your input functions using tf.identity:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fddf66cd3047d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----ddf66cd3047d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/blob/master/courses/machine_learning/deepdive/03_tensorflow/taxifare/trainer/model.py#L37", "anchor_text": "input function"}, {"url": "https://cloud.google.com/blog/big-data/2018/02/easy-distributed-training-with-tensorflow-using-tfestimatortrain-and-evaluate-on-cloud-ml-engine", "anchor_text": "train_and_evaluate"}, {"url": "https://medium.com/google-cloud/how-to-do-time-series-prediction-using-rnns-and-tensorflow-and-cloud-ml-engine-2ad2eeb189e8", "anchor_text": "see example"}, {"url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/estimator/python/estimator/extenders.py", "anchor_text": "extenders.py"}, {"url": "https://github.com/GoogleCloudPlatform/cloudml-samples/issues/67", "anchor_text": "frequently"}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/blob/master/courses/machine_learning/deepdive/07_structured/babyweight/trainer/model.py#L127", "anchor_text": "complete example"}, {"url": "https://github.com/GoogleCloudPlatform/training-data-analyst/blob/master/courses/machine_learning/deepdive/07_structured/babyweight/trainer/model.py#L132", "anchor_text": "workaround"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ddf66cd3047d---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----ddf66cd3047d---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/estimator?source=post_page-----ddf66cd3047d---------------estimator-----------------", "anchor_text": "Estimator"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----ddf66cd3047d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----ddf66cd3047d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fddf66cd3047d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ddf66cd3047d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ddf66cd3047d--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-extend-a-canned-tensorflow-estimator-to-add-more-evaluation-metrics-and-to-pass-through-ddf66cd3047d&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}