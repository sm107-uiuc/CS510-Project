{"url": "https://towardsdatascience.com/feature-importance-may-be-lying-to-you-3247cafa7ee7", "time": 1683009505.927968, "path": "towardsdatascience.com/feature-importance-may-be-lying-to-you-3247cafa7ee7/", "webpage": {"metadata": {"title": "Feature Importance May Be Lying To You | by Preston Badeer | Towards Data Science", "h1": "Feature Importance May Be Lying To You", "description": "Stop using this analysis before something goes wrong"}, "outgoing_paragraph_urls": [{"url": "https://explained.ai/rf-importance/", "anchor_text": "explained.ai", "paragraph_index": 9}, {"url": "https://explained.ai/rf-importance/#4", "anchor_text": "source", "paragraph_index": 14}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.inspection.permutation_importance.html#sklearn.inspection.permutation_importance", "anchor_text": "the documentation here", "paragraph_index": 25}, {"url": "https://towardsdatascience.com/@eryk.lewinson", "anchor_text": "Eryk Lewinson", "paragraph_index": 27}, {"url": "https://towardsdatascience.com/explaining-feature-importance-by-example-of-a-random-forest-d9166011959e", "anchor_text": "an excellent post on many aspects of feature importance", "paragraph_index": 28}, {"url": "https://explained.ai/rf-importance/", "anchor_text": "explained.ai", "paragraph_index": 33}], "all_paragraphs": ["I love random forest models. They\u2019re easy to set up, don\u2019t require much power to train, and are easy to understand. It\u2019s also one of the first models I used in production.", "Random forest is an Interpretable Model, meaning you can see what it\u2019s doing behind-the-scenes. Being interpretable is incredibly valuable when doing something like predicting which customers will cancel because instead of just knowing which customer will cancel, you can also know why.", "What you probably didn\u2019t know is that feature importance is calculated totally separately from the model training.", "There are two popular ways to understand the \u201cwhy\u201d, the first is visualizing the entire decision tree which helps you see the process from start to finish and step through vital areas. It can be overwhelming, but it\u2019s powerful.", "The other way is visualizing feature importances, which tells us which data the model relied on the most for its predictions. This is a lot easier to understand!", "What you probably didn\u2019t know is that feature importance is calculated totally separately from the model training. It\u2019s a best-guess at what the model already did.", "There are multiple feature importance algorithms but I\u2019m going to focus on the one used in scikit-learn called \u201cmean decrease in impurity.\u201d", "This algorithm measures how effective the feature is at reducing uncertainty or variance when creating decision trees. Like I said, best guess.", "It was selected for its speed, but unfortunately, it isn\u2019t always accurate.", "This is not a bug in the implementation, but rather an inappropriate algorithm choice for many data sets \u2014 explained.ai", "The best way to demonstrate how inaccurate the algorithm can be is to insert completely random data into training.", "This data won\u2019t affect your model, however, the feature importance algorithm seems to think it does:", "This is a major problem. If it\u2019s wrong about the random data, what other data is it ranking incorrectly?", "Thankfully, people smarter than me have figured out a much better way to determine feature importance. There are two algorithms, you should use both.", "\u201cThe importance of that feature is the difference between the baseline and the drop in overall accuracy caused by permuting the column.\u201d \u2014 source", "Put simply, this method changes the data in a column and then tests how much that affects the model accuracy. If changing the data in a column drops the accuracy, then that column is assumed to be important.", "You can already see how this would avoid the issue we see with random data in the default algorithm. Permutation importance is great, but it shouldn\u2019t be used on its own.", "The problem with this algorithm is when features are highly-ranked just because they\u2019re just correlated with other highly-ranked features.", "Drop-column Importance is exactly what it sounds like. You completely delete a column from your dataset, retrain the model, and see how much it affects accuracy.", "As you might assume, this can be expensive. You can mitigate costs by using a subset of the training data, but it will still be slow. If understanding true feature importance is valuable to your analysis I still highly recommend it.", "In this chart, the random ranked poorly but not as poorly as you\u2019d expect. This is why it\u2019s important to combine these methods and focus on the columns that rank well in both.", "Now that you know what they are, let\u2019s look at two common ways to use these algorithms.", "If you\u2019re using scikit-learn then I have some good news, in July 2019 they added permutation importance to it! First, check what version of scikit-learn you\u2019re using.", "If you\u2019re using a version older than 0.22, then you\u2019ll need to update to at least 0.22 to take advantage of this feature. You can upgrade using this command:", "Here\u2019s a simple example of how to pass your model into the new permutation_importance function and print out the results.", "This example is modified from the documentation here, it\u2019s worth a read.", "Drop-column importance can be done simply by dropping each column and re-training, which you already know how to do if you\u2019ve trained a model.", "However, my fellow TDS writer Eryk Lewinson has written some beautiful code to help you accomplish this in scikit-learn, here\u2019s his gist:", "He wrote an excellent post on many aspects of feature importance, if you\u2019re looking to go in-depth I highly recommend giving it a read.", "The researchers who uncovered the issues and came up with these alternatives have a lightweight package called rfpimp. I still prefer it, even though permutation importance has been added to scikit-learn.", "First, you\u2019ll need to install it with pip install rfpimp", "Next, change clf to your model (same as the earlier example) and pass in your training and test x/y columns to this snippet:", "If you want the charts I displayed above, here\u2019s the code for rendering the results into charts using matplotlib:", "Much of this post is a simplification of the excellent work done by Terence Parr, Kerem Turgutlu, Christopher Csiszar, and Jeremy Howard at explained.ai.", "They did all the hard work, I wrote this post because it had a huge impact on me, it was hard to find simple explanations, and I learned about it way too late.", "If you found value in this post, I think you might also enjoy my post about common pandas mistakes.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Startups, Business, Data Science, Product Management, and building stuff."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3247cafa7ee7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pbadeer?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pbadeer?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Preston Badeer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9c73881503f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&user=Preston+Badeer&userId=9c73881503f1&source=post_page-9c73881503f1----3247cafa7ee7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@pawel_czerwinski?utm_source=medium&utm_medium=referral", "anchor_text": "Pawe\u0142 Czerwi\u0144ski"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://explained.ai/rf-importance/", "anchor_text": "explained.ai"}, {"url": "https://explained.ai/rf-importance/#4", "anchor_text": "source"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.inspection.permutation_importance.html#sklearn.inspection.permutation_importance", "anchor_text": "the documentation here"}, {"url": "https://towardsdatascience.com/@eryk.lewinson", "anchor_text": "Eryk Lewinson"}, {"url": "https://towardsdatascience.com/explaining-feature-importance-by-example-of-a-random-forest-d9166011959e", "anchor_text": "an excellent post on many aspects of feature importance"}, {"url": "https://explained.ai/rf-importance/", "anchor_text": "explained.ai"}, {"url": "https://link.medium.com/tHYGFMVbo7", "anchor_text": "Please Stop Doing These 5 Things in PandasAs someone who did over a decade of development before moving into Data Science, there\u2019s a lot of mistakes I see data\u2026link.medium.com"}, {"url": "https://medium.com/tag/programming?source=post_page-----3247cafa7ee7---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3247cafa7ee7---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----3247cafa7ee7---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/analysis?source=post_page-----3247cafa7ee7---------------analysis-----------------", "anchor_text": "Analysis"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3247cafa7ee7---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&user=Preston+Badeer&userId=9c73881503f1&source=-----3247cafa7ee7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&user=Preston+Badeer&userId=9c73881503f1&source=-----3247cafa7ee7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3247cafa7ee7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3247cafa7ee7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3247cafa7ee7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pbadeer?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pbadeer?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Preston Badeer"}, {"url": "https://medium.com/@pbadeer/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "971 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9c73881503f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&user=Preston+Badeer&userId=9c73881503f1&source=post_page-9c73881503f1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4cd1eb0310af&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-importance-may-be-lying-to-you-3247cafa7ee7&newsletterV3=9c73881503f1&newsletterV3Id=4cd1eb0310af&user=Preston+Badeer&userId=9c73881503f1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}