{"url": "https://towardsdatascience.com/finding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5", "time": 1682995420.7504818, "path": "towardsdatascience.com/finding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5/", "webpage": {"metadata": {"title": "Finding similar images using Deep learning and Locality Sensitive Hashing | by Aayush Agrawal | Towards Data Science", "h1": "Finding similar images using Deep learning and Locality Sensitive Hashing", "description": "In this post, we are trying to achieve the above result, i.e., given an image, we should be able to find similar images from the Caltech-101 database. The post guides with an end to end process on\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.vision.caltech.edu/Image_Datasets/Caltech101/", "anchor_text": "Caltech-101 database", "paragraph_index": 0}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/tree/master/8_Image_similarity_search", "anchor_text": "GitHub repository", "paragraph_index": 0}, {"url": "http://www.vision.caltech.edu/Image_Datasets/Caltech101/", "anchor_text": "Caltech-101 database", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/transfer-learning-using-the-fastai-library-d686b238213e", "anchor_text": "previous blog", "paragraph_index": 2}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "this notebook", "paragraph_index": 2}, {"url": "https://medium.com/gsi-technology/visualising-embeddings-using-t-sne-8fd4e31b56e2", "anchor_text": "this blog", "paragraph_index": 4}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "notebook", "paragraph_index": 5}, {"url": "https://pytorch.org/docs/stable/nn.html?highlight=register_forward_hook#torch.nn.Module.register_forward_hook", "anchor_text": "register_forward_hook", "paragraph_index": 6}, {"url": "https://pytorch.org/docs/stable/nn.html", "anchor_text": "the torch.nn module", "paragraph_index": 6}, {"url": "https://towardsdatascience.com/fast-near-duplicate-image-search-using-locality-sensitive-hashing-d4c16058efcb", "anchor_text": "This blog", "paragraph_index": 12}, {"url": "https://pypi.org/project/lshash3/", "anchor_text": "lshash3", "paragraph_index": 14}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "notebook", "paragraph_index": 14}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/find_similar_image.py", "anchor_text": "Github here", "paragraph_index": 16}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/tree/master/7_Facial_attributes_fastai_opencv", "anchor_text": "Github", "paragraph_index": 20}, {"url": "https://www.linkedin.com/in/aayushmnit/", "anchor_text": "LinkedIn", "paragraph_index": 20}, {"url": "http://aayushmnit.com", "anchor_text": "aayushmnit.com", "paragraph_index": 22}], "all_paragraphs": ["In this post, we are trying to achieve the above result, i.e., given an image, we should be able to find similar images from the Caltech-101 database. The post guides with an end to end process on how I went about building this. The entire codebase for replicating the project is in my GitHub repository. The process to achieve the above result can be broken down in these few steps -", "As I mentioned above, for this project, my goal is to query any given image and find a semantically similar image in the Caltech-101 database. This database contains 9,144 images divided into 101 categories. Each category has about 50\u2013800 images in them.", "The first exercise in our project is to obtain a deep learning network which can classify these categories accurately. For this task, we will use a pre-trained ResNet 34 network which is trained on the ImageNet database and transfer learn it to classify 101 categories of Caltech-101 database using Pytorch 1.0 and FastAI library. As I have written about exactly how to do transfer learning with any given dataset in my previous blog, I am just going to outline the process in this blog. You can refer to this notebook to find the code to do the same. Find below the steps to do transfer learning for classifying Caltech-101 images -", "Now that we have a pre-trained network, we need to extract embeddings from this network for all of our Caltech-101 images. Embedding is nothing but a representation of an object in an N-dimensional vector. An image embedding, in this case, is a representation of an image in N-dimension. The basic idea is the closer a given image to another image their embedding will also be similar and close in the spatial dimension.", "You can see in the above image taken from this blog that image embedding is a spatial representation of an image in the vectorized form where similar images are close in spatial dimension as well.", "We can obtain image embeddings from a ResNet-34 by taking the output of its second last Fully-connected layer which has a dimension of 512. To save intermediate calculations in a deep learning model in Pytorch for inspection or in our case to extract embeddings we use Pytorch Hooks. Hooks can be of two types \u2014 forward and backward. Forward hooks are used to save information passing forward in a network to make an inference while backward hooks are used to collect information about gradients during backpropagation. In our case, we need output of our second last Fully connected layers in the inference stage which means we need to use a forward hook. Let\u2019s look at the code for creating a hook (also in \u201cExtracting Feature\u201d section of my notebook) \u2014", "The above code is all you need in creating a Pytorch hook. The SaveFeatures class invokes register_forward_hook function from the torch.nn module and given any model layer it will save the intermediate computation in a numpy array which can be retrieved using SaveFeatures.features functions. Let\u2019s see the code to use this class \u2014", "Line 1\u20132: Invokes the class SaveFeatures using model layer reference to the output of second last fully-connected layer as the input.", "Line 4\u20136: Passing the Caltech-101 data to get their predictions. Note that we are not interested in saving predictions and that\u2019s why we used \u201c_.\u201d In this case, the intermediate output of second last layers in saved in the variable named \u201csf\u201d, which is an instance of SaveFeatures class.", "Line 8\u201310: Creating a python dictionary where image path is the key and image embeddings is the value.", "Now we have embedding representation of each image in Caltech-101 in our dictionary.", "We can use our newly generated Caltech 101 image embeddings and get a new image, convert it into embedding to calculate distance b/w the new image and all the Caltech 101 database to find similar images. This process is computationally expensive in nature and as a new image embedding have to compare with all the 9K+ image embedding in the Caltech 101 database to find the most similar image(nearest neighbor), which in computational complexity notation is an O(N\u00b2) problem and will take exponentially more time to retrieve similar images as the number of images increases.", "To solve this problem, we will use locality sensitive hashing(LSH) which is an approximate nearest neighbor algorithm which reduces the computational complexity to O(log N). This blog explains LSH in good details in terms of time complexity and implementation. In short, LSH generates a hash value for image embeddings while keeping spatiality of data in mind; in particular; data items that are similar in high-dimension will have a higher chance of receiving the same hash value.", "Below are the steps on how LSH converts an embedding in a hash of size K-", "Let\u2019s now look at how LSH will perform an ANN query. Given a new image embedding, we will use LSH to create a hash for the given image and then compare the distance from image embedding of the pictures of Caltech-101 dataset which shares the same hash value. In this way, instead of doing similarity search over the whole Caltech-101 database we will only do a similarity search with a subset of images which shares the same hash value with the input image. For our project, we are using lshash3 package for an approximate nearest neighbor search. Let\u2019s look at the code to do the same (you can find the code in the \u201cUsing Locality Sensitive hashing to find near similar images\u201d section of my notebook)-", "The above code takes the image embedding dictionary and converts it into LSH table. To query the LSH table, we can use the code below \u2014", "Now we have our LSH table created let\u2019s write a script which can take an image URL as an input and give us N(user-defined) similar images from CalTech 101 database. The code for this part is on my Github here.", "The script does the following task -", "We can use a similar concept in various applications like finding similar images in our photo gallery, item-item recommendation of similar looking items, doing a web search on images, finding near-duplicate images, etc.", "In the blog, we saw an application of deep learning in finding semantically similar images and how to do an approximate nearest neighbor query using Locality-sensitive hashing(LSH) to speed up query time for large datasets. Also, it\u2019s important to note that we used LSH not on the raw features(images) but on the embeddings which help do fast similarity search in huge collections.", "I hope you enjoyed reading, and feel free to use my code on Github to try it out for your purposes. Also, if there is any feedback on code or just the blog post, feel free to reach out on LinkedIn or email me at aayushmnit@gmail.com. You can also follow me on Medium and Github for future blog post and exploration project codes I might write.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Experienced data scientist. Passionate about solving interesting problems with data. All views are my own unless you share them. More on aayushmnit.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9528afee02f5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9528afee02f5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aayushmnit?source=post_page-----9528afee02f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Aayush Agrawal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85dd669ac015&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&user=Aayush+Agrawal&userId=85dd669ac015&source=post_page-85dd669ac015----9528afee02f5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.vision.caltech.edu/Image_Datasets/Caltech101/", "anchor_text": "Caltech-101 database"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/tree/master/8_Image_similarity_search", "anchor_text": "GitHub repository"}, {"url": "http://www.vision.caltech.edu/Image_Datasets/Caltech101/", "anchor_text": "Caltech-101 dataset"}, {"url": "http://docs.fast.ai/", "anchor_text": "FastAI"}, {"url": "https://pytorch.org/", "anchor_text": "Pytorch"}, {"url": "http://www.vision.caltech.edu/Image_Datasets/Caltech101/", "anchor_text": "Caltech-101 database"}, {"url": "https://towardsdatascience.com/transfer-learning-using-the-fastai-library-d686b238213e", "anchor_text": "previous blog"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "this notebook"}, {"url": "https://medium.com/gsi-technology/visualising-embeddings-using-t-sne-8fd4e31b56e2", "anchor_text": "Blog"}, {"url": "https://medium.com/gsi-technology/visualising-embeddings-using-t-sne-8fd4e31b56e2", "anchor_text": "this blog"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "notebook"}, {"url": "https://pytorch.org/docs/stable/nn.html?highlight=register_forward_hook#torch.nn.Module.register_forward_hook", "anchor_text": "register_forward_hook"}, {"url": "https://pytorch.org/docs/stable/nn.html", "anchor_text": "the torch.nn module"}, {"url": "https://towardsdatascience.com/fast-near-duplicate-image-search-using-locality-sensitive-hashing-d4c16058efcb", "anchor_text": "This blog"}, {"url": "https://towardsdatascience.com/fast-near-duplicate-image-search-using-locality-sensitive-hashing-d4c16058efcb", "anchor_text": "Link"}, {"url": "https://pypi.org/project/lshash3/", "anchor_text": "lshash3"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/Image%20similarity%20on%20Caltech101%20using%20FastAI%2C%20Pytorch%20and%20Locality%20Sensitive%20Hashing.ipynb", "anchor_text": "notebook"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/find_similar_image.py", "anchor_text": "Github here"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/8_Image_similarity_search/find_similar_image.py", "anchor_text": "find similar image"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/tree/master/7_Facial_attributes_fastai_opencv", "anchor_text": "Github"}, {"url": "https://www.linkedin.com/in/aayushmnit/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----9528afee02f5---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/image-recognition?source=post_page-----9528afee02f5---------------image_recognition-----------------", "anchor_text": "Image Recognition"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----9528afee02f5---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9528afee02f5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----9528afee02f5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&user=Aayush+Agrawal&userId=85dd669ac015&source=-----9528afee02f5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&user=Aayush+Agrawal&userId=85dd669ac015&source=-----9528afee02f5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9528afee02f5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9528afee02f5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9528afee02f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9528afee02f5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9528afee02f5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9528afee02f5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9528afee02f5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Aayush Agrawal"}, {"url": "https://medium.com/@aayushmnit/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "414 Followers"}, {"url": "http://aayushmnit.com", "anchor_text": "aayushmnit.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85dd669ac015&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&user=Aayush+Agrawal&userId=85dd669ac015&source=post_page-85dd669ac015--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8137fc02bcb8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffinding-similar-images-using-deep-learning-and-locality-sensitive-hashing-9528afee02f5&newsletterV3=85dd669ac015&newsletterV3Id=8137fc02bcb8&user=Aayush+Agrawal&userId=85dd669ac015&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}