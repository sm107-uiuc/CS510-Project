{"url": "https://towardsdatascience.com/overcome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc", "time": 1683002234.3692422, "path": "towardsdatascience.com/overcome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc/", "webpage": {"metadata": {"title": "Overcome Overfitting During Instance Segmentation with Mask-RCNN | by Kayo Yin | Towards Data Science", "h1": "Overcome Overfitting During Instance Segmentation with Mask-RCNN", "description": "Advancements in computer vision hold many promising applications such as self-driving cars or medical diagnosis. In these tasks, we rely on the machine\u2019s ability to recognize objects. There are four\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/kayoyin/tiny-instance-segmentation", "anchor_text": "Github", "paragraph_index": 7}, {"url": "https://github.com/matterport/Mask_RCNN", "anchor_text": "implementation", "paragraph_index": 12}, {"url": "https://arxiv.org/abs/1703.06870", "anchor_text": "Mask-RCNN paper", "paragraph_index": 13}, {"url": "https://engineering.matterport.com/splash-of-color-instance-segmentation-with-mask-r-cnn-and-tensorflow-7c761e238b46", "anchor_text": "article", "paragraph_index": 14}, {"url": "https://paperswithcode.com/task/instance-segmentation", "anchor_text": "other state-of-the-art architectures", "paragraph_index": 28}, {"url": "http://kayoyin.github.io/blog", "anchor_text": "kayoyin.github.io/blog", "paragraph_index": 31}], "all_paragraphs": ["Advancements in computer vision hold many promising applications such as self-driving cars or medical diagnosis. In these tasks, we rely on the machine\u2019s ability to recognize objects.", "There are four tasks related to object recognition we often see: classification and localization, object detection, semantic segmentation, and instance segmentation.", "In classification and localization, we are interested in assigning the class label to the object in the image and drawing a bounding box around the object. In this task, the number of objects to be detected is fixed.", "Object detection differs from classification and localization because here, we do not make assumptions on the number of objects in the image beforehand. We start with a fixed set of object categories and we aim to assign the class label and draw the bounding box each time an object in these categories appears in the image.", "In semantic segmentation, we assign a class label to each image pixel: all pixels belonging to the grass are labeled \u201cgrass\u201d, those belonging to sheep are labeled \u201csheep\u201d. Notably, this task does not make the difference between two sheep, for example.", "Our task in this assignment is instance segmentation which builds on both object detection and semantic segmentation. As in object detection, we aim to label and localize all instances of objects in predefined categories. However, instead of generating bounding boxes for detected objects, we go further by identifying which pixels belong to the object, like in semantic segmentation. The difference with semantic segmentation is that instance segmentation draws a separate mask for each object instance, while semantic segmentation will use the same mask for all instances of the same class", "In this article, we will train an instance segmentation model on a tiny Pascal VOC dataset with only 1,349 images for training, and 100 images for testing. The main challenge here will be to prevent the model from overfitting without using external data.", "You can find the datasets used and the full training and inference pipeline on Github.", "The annotations are in the COCO format so we can use functions from pycocotools to retrieve class labels and masks. In this dataset, there are 20 categories in total.", "Below are some visualizations of the training images and the associated masks. Different shades of the masks represent separate masks for several instances of the same object category.", "The images are of varying size and aspect ratios so before feeding the images into the model, we resize each image to have dimension 500x500. When the image dimensions are smaller than 500, we upscale the image so that the largest side is of length 500, and add zero paddings as necessary to obtain square images.", "For the model to generalize well, especially on a limited dataset such as this one, data augmentation is key to overcome overfitting. For each image, a horizontal flip is performed with probability 0.5, the image is randomly cropped to a scale between 0.9 and 1 times the original dimension, a Gaussian blur with random standard deviation is performed with probability 0.5, the contrast is adjusted by a scale between 0.75 and 1.5, the brightness is adjusted by a scale between 0.8 and 1.2, and a series of random affine transformations are also applied such as scaling, translation, rotation, and shearing.", "We will use matterport\u2019s implementation of Mask-RCNN for training. Though tempting, we will not use their pre-trained weights for MS COCO to show how we can obtain good results using only 1,349 training images.", "Mask-RCNN was proposed in the Mask-RCNN paper in 2017 and it is an extension of Faster-RCNN by the same authors. Faster-RCNN is widely used for object detection in which the model generates bounding boxes around detected objects. Mask-RCNN takes it a step further by generating the object masks as well.", "I will provide a quick overview of the model architecture below, and matterport published a great article that details their model implementation.", "First, we use a backbone model to extract relevant features from the input image. Here, we use the ResNet101 architecture as backbone. The image is converted from a tensor of shape (500, 500, 3) to a feature map of shape (32, 32, 2048).", "The features previously obtained are then fed into a Region Proposal Network (RPN). The RPN scan regions of the feature map, called anchors, and try to determine regions that contain objects. These anchors are of different size and aspect ratio. The RPN assigns an anchor class to each anchor: foreground (positive anchors) or background (negative anchors). Neutral anchors are ones that do not affect training.", "A proposal layer then picks the anchors most likely to contain an object and refine the anchor box to fit the object more closely. When too many anchors overlap, only the one with the highest foreground score is preserved (Non-Maximum Suppression). In doing so, we obtain Regions of Interest (ROI).", "For each region that contains an object selected by the ROI classifier, the model then generates 28x28 masks. During training, the ground truth mask is downscaled to compute the loss with the predicted mask, and during inference the generated mask is up-scaled to the ROI bounding box size.", "The key to training the model both faster and better, especially with limited data, is transfer learning. The Imagenet dataset is a huge corpus of natural images, similar to our images. We can, therefore, initialize the weights of our Resnet101 backbone model to weights pre-trained on Imagenet. This will improve the accuracy of the feature maps we obtain, and therefore the overall model.", "To fine-tune the model pre-trained on Imagenet, we first only train the model heads. Then we train the layers from ResNet stage 4 and up for the remaining epochs. This training scheme also helps minimize overfitting. We can allow ourselves to freeze and never fine-tune the first layers because we can reuse the weights the model learned to extract features from natural images.", "Training the model heads for 20 epochs, and the rest of selected model layers for 25 additional epochs allow us to obtain a mAP score on the testing set of 0. 53650. Here are some visualizations of the model output on randomly selected testing images:", "We can also visualize the outputs for different steps of the algorithm. Below, we have the top anchors by score before bounding box refinement.", "Next, we have the output anchors after bounding box refinement and non-max suppression. These proposals are then fed into the classification network. Notice how at this point, we have boxes that tightly bound some objects, like the signs, that are not part of the object categories we have defined.", "The classification network runs over the proposal to determine positive detections, generate class probabilities and bounding box regressions.", "After obtaining the bounding boxes and refining them, the instance segmentation model generates the masks for each detected object. The masks are soft masks (with float pixel values) and of size 28x28 during training.", "Finally, the predicted masks are rescaled to the bounding box dimensions, and we can overlay them on the original image to visualize the final output.", "Thanks for reading this article and I hope you enjoyed!", "There are many other state-of-the-art architectures for instance segmentation you can experiment with too, let me know if you try any of them on this tiny COCO dataset :)", "You might also want to check out how I trained a ResNet classifier on 3,859 greyscale images to rank 2nd place in my in-class Kaggle challenge:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "PhD student at UC Berkeley researching AI. Now writing at kayoyin.github.io/blog"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F32db91f400bc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----32db91f400bc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kayo.yin?source=post_page-----32db91f400bc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kayo.yin?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Kayo Yin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fee0d7547aae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&user=Kayo+Yin&userId=ee0d7547aae1&source=post_page-ee0d7547aae1----32db91f400bc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.oreilly.com/ideas/introducing-capsule-networks?cmp=tw-data-na-article-ainy18_thea", "anchor_text": "https://www.oreilly.com/ideas/introducing-capsule-networks?cmp=tw-data-na-article-ainy18_thea"}, {"url": "https://github.com/kayoyin/tiny-instance-segmentation", "anchor_text": "Github"}, {"url": "https://github.com/matterport/Mask_RCNN", "anchor_text": "implementation"}, {"url": "https://arxiv.org/abs/1703.06870", "anchor_text": "Mask-RCNN paper"}, {"url": "https://engineering.matterport.com/splash-of-color-instance-segmentation-with-mask-r-cnn-and-tensorflow-7c761e238b46", "anchor_text": "article"}, {"url": "https://medium.com/@jonathan_hui/image-segmentation-with-mask-r-cnn-ebe6d793272", "anchor_text": "https://medium.com/@jonathan_hui/image-segmentation-with-mask-r-cnn-ebe6d793272"}, {"url": "https://www.researchgate.net/figure/Examples-in-the-ImageNet-dataset_fig7_314646236", "anchor_text": "ImageNet sample images"}, {"url": "https://paperswithcode.com/task/instance-segmentation", "anchor_text": "other state-of-the-art architectures"}, {"url": "https://towardsdatascience.com/latest-winning-techniques-for-kaggle-image-classification-with-limited-data-5259e7736327", "anchor_text": "Latest Winning Techniques for Kaggle Image Classification with Limited DataTutorial on how to prevent your model from overfitting on a small dataset but still make accurate classificationstowardsdatascience.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----32db91f400bc---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----32db91f400bc---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----32db91f400bc---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----32db91f400bc---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----32db91f400bc---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&user=Kayo+Yin&userId=ee0d7547aae1&source=-----32db91f400bc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&user=Kayo+Yin&userId=ee0d7547aae1&source=-----32db91f400bc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F32db91f400bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----32db91f400bc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----32db91f400bc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----32db91f400bc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----32db91f400bc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----32db91f400bc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----32db91f400bc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kayo.yin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kayo.yin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kayo Yin"}, {"url": "https://medium.com/@kayo.yin/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "538 Followers"}, {"url": "http://kayoyin.github.io/blog", "anchor_text": "kayoyin.github.io/blog"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fee0d7547aae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&user=Kayo+Yin&userId=ee0d7547aae1&source=post_page-ee0d7547aae1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F97e53eb796c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fovercome-overfitting-during-instance-segmentation-with-mask-rcnn-32db91f400bc&newsletterV3=ee0d7547aae1&newsletterV3Id=97e53eb796c&user=Kayo+Yin&userId=ee0d7547aae1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}