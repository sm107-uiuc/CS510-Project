{"url": "https://towardsdatascience.com/foray-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874", "time": 1683009712.720012, "path": "towardsdatascience.com/foray-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874/", "webpage": {"metadata": {"title": "Forays into Deep Learning: Transfer Learning and fast.ai | by Joraaver Chahal | Towards Data Science", "h1": "Forays into Deep Learning: Transfer Learning and fast.ai", "description": "I\u2019ve wanted to get more into deep learning as of late, and while I have decent theoretical experience from classwork and courses, I have very little practical experience. Thus, I\u2019ve decided to fully\u2026"}, "outgoing_paragraph_urls": [{"url": "https://course.fast.ai/", "anchor_text": "The fast.ai course", "paragraph_index": 1}, {"url": "https://archive.ics.uci.edu/ml/datasets/Daily+and+Sports+Activities", "anchor_text": "dataset of sensor recordings classified into different human movements", "paragraph_index": 2}, {"url": "http://kilyos.ee.bilkent.edu.tr/~billur/publ_list/cj14.pdf", "anchor_text": "there is an accompanying paper", "paragraph_index": 4}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "this paper", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Hadamard_product_(matrices)", "anchor_text": "matrix element-wise multiplication, extremely simple", "paragraph_index": 11}, {"url": "https://arxiv.org/abs/1803.09820", "anchor_text": "one cycle policy", "paragraph_index": 21}, {"url": "https://github.com/abcde13/HumanActivityRecognition", "anchor_text": "github repo", "paragraph_index": 29}], "all_paragraphs": ["I\u2019ve wanted to get more into deep learning as of late, and while I have decent theoretical experience from classwork and courses, I have very little practical experience. Thus, I\u2019ve decided to fully commit to practicing deep learning with more rigor, and actually build models that do things.", "The fast.ai course has been fantastic for just that. Jeremy Howard\u2019s focus on practical deep learning is refreshing, reminding me of the advice I used to give friends in college when looking for jobs. Students should commit blocks of time, finish a project, and maybe write about it, to really flesh out the experience of software engineering, end to end. So here I am, implementing the advice by using the fastai library (the company is called fast.ai, the library, fastai), doing a project, and writing about it.", "Human movement is an interesting field \u2014 it fascinates me, I\u2019m constantly reading about it, and I\u2019m always looking for novel ways to understand it. Luckily for me, UCI has a great repository for machine learning, and specifically a dataset of sensor recordings classified into different human movements.", "I won\u2019t touch too much on the exploration of the data, but to summarize, there are multiple different sensor recordings for the torso, left arm, right arm, left leg, and right leg, in the x, y, and z axes of different movements. Each movement has a 60 second recording split into 5 second segments. There are 19 movements recorded.", "Often Jeremy takes a model that he\u2019s built to solve a problem and demonstrates how it now does better than the paper the problem came from. For my project, there is an accompanying paper that takes the data and compares the performance of models provided by two different libraries in the classification task. The best results of those models that took the tabular data as input is 95.5% (with different validation methods being less accurate, but more realistic). The paper discusses some fine-tuning enhancements that were attempted (or the lack thereof, such as for the artificial neural network\u2019s learning rate and momentum in the PRTools library).", "I wanted to see if, using the fastai library, I could get better results. After taking a look at the data, and using bit of intuition, I chose to look at acceleration data only, hoping that that would provide me with enough differentiation to recognize the different movements.", "I created images from the acceleration data and fed them into a convolutional neural network (CNN) with a pretrained ResNet34 model. I\u2019ll explain these decisions in a bit.", "Inspired by Jeremy\u2019s confidence in transfer learning, I wanted to try a different route to using the data than just feeding it into a neural network, Transfer learning is the process of using an already pretrained model on a different task, in the hope that this model has enough generalized information to solve the specific task.", "A lot of Jeremy\u2019s initial coursework revolves around using a pretrained ResNet34 (first appeared in this paper) or ResNet50 model for transfer learning. These architectures are specific to image recognition. I\u2019ll explore the architecture of ResNet in a later post; it deserves its own attention. However, just know that ResNet34/50 is pretty good at general image recognition applications.", "Of course, I still needed images to use an image recognition model, and all I currently had was tabular data for what\u2019s known as a multivariate time series (multivariate because there are multiple variables being tracked). Here is an example of the data (x axis is time in seconds, y axis is m/s\u00b2 ):", "After some research, I discovered a couple of well-established techniques for turning a univariate time series into an image.", "The only image demonstrated for capturing multivariate time series data is the joint recurrence plot, which is a result of taking the Hadamard product of multiple recurrence plots (matrix element-wise multiplication, extremely simple). Now, here\u2019s the gotcha. I tried to use joint recurrence plots from the pyts library, but I couldn\u2019t figure out how to get it to work with my data. It requires an input of (n_samples, n_features, n_timestamps) which I massaged my data to create, but I got just one fairly wimpy plot for a set of recordings, which didn\u2019t feel right. I wish I had saved one of those images for this post, but for now, know that I tried and failed.", "Instead, I went with a very simple approach. I normalized the acceleration data so it had a minimum of 0 and a maximum of 1. Then, for each body part, for each recording, I turned it into a grayscale pixel, stacked those pixels left to right in time, and top to bottom for each body part. The end result is an image like this:", "Not as pretty as those plots above, but the differences in acceleration are still obvious. Satisfied by the example image I created, I looped through the data and saved all these images to a new folder to feed into the CNN.", "Now, the big question was, even though the differences in the image are obvious to the human eye, was it obvious to the eye of a pretrained ResNet34 model that was not trained on small, gray, rectangular, images of no particular object? I was a little skeptical, but it turns out the model did recognize the classes from these images, and pretty well too.", "With the datablock API in the fastai library, preparing the data for the CNN was a breeze. All it took to get the data, split it into training and validation sets, apply transforms, and create what\u2019s known as a databunch for the CNN looked like this (the labels for the image classes are part of the filename):", "After that, it was also a cinch to quickly explore some of the data", "I want to note that I didn\u2019t normalize the data with imagenet_stats (provided by fastai). Jeremy says in his videos to always normalize the data using the same techniques that the pretrained model was trained with, but I had a difficult time rationalizing that when my input images were already so different. However, I should have at least tried the normalization and seen what happened. I may come back and experiment with that later.", "Applying the pretrained model was ridiculously simple, since the fastai library comes with some models available for use.", "This is now a model that uses the ResNet34 architecture with pretrained weights, uses my data as input, and uses accuracy as a metric to track during learning. Before training it, I tried to find the best set of learning rates to use. The fastai library has a quick way to examine the learning rates and check the losses to see when the losses start to explode (diverge, really) using lr_find.", "Before doing the training, let me answer the question \u201cwhy do we need to train the network if we are already using a pretrained model?\u201d The pretrained model is good at generalized pattern recognition, but we need it to solve our specific problem. When using a pretrained model for training, most of the layers in the architecture\u2019s weights will be frozen, and won\u2019t be updated. Only the last layer\u2019s weights will be affected by our training, and this is more or less what we want. The initial layers of the architecture often recognize broad, generic things, whereas the deeper layers tend to get more specific in what they recognize. Thus, we want to train the last layers of the model, and touch the initial layers only infrequently.", "I used the one cycle policy to train the network (The fast.ai course introduced me to the concept).", "Loss plots to observe the progression of training:", "After 13 epochs, I achieved a 98.7% accuracy on identification of the activity by acceleration data alone. The best the paper did, regardless of library and validation technique, was a 95.5% accuracy. To really confirm the results, it would be best if I also attempted the different validation techniques in the paper, but that was beyond the scope of my effort.", "Notice that the loss didn\u2019t change much during the last 3 epochs and that the training loss is still less than the validation loss. This indicates that the model I created is not overfitting. General intuition tells us that for the images we are training on, we should always see that the model does well on the training data, and a little less well on the validation data.", "Now, based on the activities the model was trying to classify, I figured that it would struggle the most with the treadmill activity and elevator activity. The confusion matrix above confirms that, with some additional misclassifications in activities like walking in a lot.", "Transfer learning is quite powerful, and I was honestly surprised by how well the model did. However, there are a few things I think aided in the recognition of the features. For example, because the sixty second recordings were split into five second segments, the movement of the pattern through the image could be considered \u201ctime invariant.\u201d The model learned to ignore the specific placement of the changes in data and focus more on the appearance of that change, in either its once or cyclic presentation, in the data. In a way this was also a form of \u201cdata augmentation\u201d that helped the model avoid overfitting.", "It is worth noting that in this post and in my repo, I didn\u2019t unfreeze the model to train all the layers. I tried training the frozen model and then the unfrozen model with different epoch counts, different learning rates, etc, but the results seemed to suggest that unfreezing the model did little good. I suspect this is because there is a vast difference between my input data and the data ResNet34 was trained on, and training the initial layers on my data didn\u2019t really aid in the understanding of my problem.", "The fastai library is simple, clean, and intuitive. Often, in data science projects, the common belief is that 80% of the work is data preparation and 20% is actual analysis. With deep learning, that split tends to go 50/50 with how difficult it can be to get the model right; often hours are spent training models that don\u2019t work, and the lack of intuition behind some of the layers makes understanding what to do next difficult. Luckily for me, the fastai library put this project back into the 80/20 split.", "Everything I just talked about is available, with code, in my github repo, with a nice README and python notebooks.", "I look forward to writing more posts like this, either about papers/subjects I\u2019m studying, or projects I\u2019m working on.", "Thanks for reading! Comments or questions are welcome!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "By day, a software engineer. By night, an artificial intelligence enthusiast, a reader, a gamer, an amateur saxophonist, and an even more fledgling writer."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fca0c44c03874&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://chr0nikler.medium.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": ""}, {"url": "https://chr0nikler.medium.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Joraaver Chahal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa56e878d1e7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&user=Joraaver+Chahal&userId=a56e878d1e7c&source=post_page-a56e878d1e7c----ca0c44c03874---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://course.fast.ai/", "anchor_text": "The fast.ai course"}, {"url": "https://archive.ics.uci.edu/ml/datasets/Daily+and+Sports+Activities", "anchor_text": "dataset of sensor recordings classified into different human movements"}, {"url": "http://kilyos.ee.bilkent.edu.tr/~billur/publ_list/cj14.pdf", "anchor_text": "there is an accompanying paper"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "this paper"}, {"url": "https://en.wikipedia.org/wiki/Hadamard_product_(matrices)", "anchor_text": "matrix element-wise multiplication, extremely simple"}, {"url": "https://arxiv.org/abs/1803.09820", "anchor_text": "one cycle policy"}, {"url": "https://github.com/abcde13/HumanActivityRecognition", "anchor_text": "github repo"}, {"url": "https://pyts.readthedocs.io/en/stable/auto_examples/image/plot_gaf.html", "anchor_text": "https://pyts.readthedocs.io/en/stable/auto_examples/image/plot_gaf.html"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ca0c44c03874---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----ca0c44c03874---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/computer-science?source=post_page-----ca0c44c03874---------------computer_science-----------------", "anchor_text": "Computer Science"}, {"url": "https://medium.com/tag/fastai?source=post_page-----ca0c44c03874---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/human-movement?source=post_page-----ca0c44c03874---------------human_movement-----------------", "anchor_text": "Human Movement"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&user=Joraaver+Chahal&userId=a56e878d1e7c&source=-----ca0c44c03874---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&user=Joraaver+Chahal&userId=a56e878d1e7c&source=-----ca0c44c03874---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fca0c44c03874&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ca0c44c03874---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ca0c44c03874--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ca0c44c03874--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ca0c44c03874--------------------------------", "anchor_text": ""}, {"url": "https://chr0nikler.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://chr0nikler.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Joraaver Chahal"}, {"url": "https://chr0nikler.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "11 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa56e878d1e7c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&user=Joraaver+Chahal&userId=a56e878d1e7c&source=post_page-a56e878d1e7c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa56e878d1e7c%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforay-into-deep-learning-transfer-learning-and-fast-ai-ca0c44c03874&user=Joraaver+Chahal&userId=a56e878d1e7c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}