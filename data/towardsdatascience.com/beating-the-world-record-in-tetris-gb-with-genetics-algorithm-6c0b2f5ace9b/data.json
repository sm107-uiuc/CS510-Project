{"url": "https://towardsdatascience.com/beating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b", "time": 1683009030.9349382, "path": "towardsdatascience.com/beating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b/", "webpage": {"metadata": {"title": "Beating the world record in Tetris (GB) with genetics algorithm | by Duc Anh Bui | Towards Data Science", "h1": "Beating the world record in Tetris (GB) with genetics algorithm", "description": "A couple of weeks ago, I found this awesome Game Boy emulator written in Python with support for AI/bots. I was very excited because now I could use my Machine Learning knowledge to create agents for\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/Baekalfen/PyBoy", "anchor_text": "emulator", "paragraph_index": 0}, {"url": "https://www.twingalaxies.com/game/tetris/game-boy-game-boy-color/points/", "anchor_text": "TwinGalaxies", "paragraph_index": 1}, {"url": "https://www.britannica.com/science/NP-complete-problem", "anchor_text": "NP-complete", "paragraph_index": 2}, {"url": "https://pathmind.com/wiki/neural-network", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://github.com/Baekalfen/PyBoy/blob/master/examples/gamewrapper_tetris.py", "anchor_text": "example", "paragraph_index": 6}, {"url": "https://github.com/uiucanh/tetris", "anchor_text": "https://github.com/uiucanh/tetris", "paragraph_index": 31}, {"url": "https://arxiv.org/abs/cs/0210020", "anchor_text": "Tetris is Hard, Even to Approximate", "paragraph_index": 32}, {"url": "https://www.researchgate.net/publication/322321608_Playing_the_Original_Game_Boy_Tetris_Using_a_Real_Coded_Genetic_Algorithm", "anchor_text": "Playing the Original Game Boy Tetris Using a Real Coded Genetic Algorithm", "paragraph_index": 33}], "all_paragraphs": ["A couple of weeks ago, I found this awesome Game Boy emulator written in Python with support for AI/bots. I was very excited because now I could use my Machine Learning knowledge to create agents for games that haunted my childhood.", "In this article, I\u2019ll show how we can use a simple implementation of genetics algorithm and neural network to create an agent that can play the original Tetris on Game Boy extremely well and able to beat the world record which is set at 999999 and 523 lines according to TwinGalaxies.", "Tetris, one of the best selling video game franchises, is a puzzle game where the main goal is to reach the highest possible score by clearing lines of Tetrominoes (yes, that\u2019s what those pieces are called). The rules of the game are very simple, yet, it\u2019s actually a NP-complete problem [1]. This means coding a rules based agent might not be the wisest approach and heuristics, such as a genetics algorithm, would be a better fit.", "Genetics algorithms (GA) are a set of algorithms that are inspired by Darwin\u2019s theory of evolution. These algorithms are used to solve optimisation problems. This means we can use GA to optimise the weights of a neural network (and they can do that pretty well too). I won\u2019t go into what is a neural network in this article as there\u2019re plenty of resources out there for it already, such as here.", "The general idea is that we\u2019ll create a neural network (NN) that will produce a score for each action the agent does. For every new tetromino, the agent will try all possible actions it could do and choose the action with the highest score. Using GA, we wish to optimise the network to converge to an optimal state via evolution.", "In GA, we have a number of key concepts: fitness, elitism, crossover, and mutation.", "Like many other Machine Learning problems, the first step we need to do is collect data, or in this case, state data from the environment. Here\u2019s a quick example that shows how to quickly initialise the environment.", "The script itself is pretty self-explanatory. The developers have made it very easy to get a captured state of the game via tetris.game_area() . We can then create a sparse matrix where 0s are the blank tiles and 1s are the pieces:", "Using the matrix above, we can define a number of features as seen in [2]:", "Aggregate HeightThis calculates a sum of all the column heights. In the example above, the sum would be 16.", "Number of holesThe number of holes on the board. There are 6 holes in the board below:", "Number of columns with at least one holeThat would be 5 in the example above.", "Row transitionsThe number of transitions from occupied to unoccupied tiles in each row summed. Each red dot in the picture below counts as one transition:", "Column transitionsLike above but column wise.", "Number of pitsA pit is defined as a column without any blocks. There are 3 pits in the board below:", "Deepest wellA well is best explained via the image below. In this case, the deepest well has a height of 2.", "Lines clearedThe number of lines cleared with the move.", "Let\u2019s implement these features using the matrix representation:", "First, we create a class for the Network", "Our model is a simple network with an input layer with size 9 and an output layer with size 1. This simple network will allow us to interpret the weights easily and can be represented as follows:", "I\u2019m using PyTorch to create the network but feel free to use any other library or implement your own. Using this, we can create a Population class with crossover and mutation implemented:", "For each new generation, we\u2019ll bring over the top 20% networks.", "For crossover, we sample parents with probability distribution generated from population fitnesses (the higher a Network fitness it the more likely it will be chosen). Each weight is chosen randomly with a 50/50 chance from either parent.", "Afterwards, weights have 20% chance of being mutated with the addition of random Gaussian noise multiplied by a factor of 0.5.", "The next step is to code some logic to play the game. First, let\u2019s define some helper functions to move the blocks:", "For each new piece, we\u2019ll try all the possible moves with that piece. The number of turns and sideways moves we need to check is dependant on the block type. We can use these 3 functions to determine them:", "Now we have all we needed to start simulating the networks. For each new piece, we pass the board information to get_score() to get the output of the network for each possible action. We choose the action with the highest output. Once the game is over, we return the fitness of the network which is the score of the game.", "Due to the randomness of the game, the network won\u2019t produce the same result for each run. We could evaluate multiple runs for each network via run_per_child to better approximate the network fitness.", "As the agent gets better at the game, training time can get much longer. To speed training up, we stop the game once the agent has reached the maximum score (999999) and utilise multiprocessing. It\u2019s simple enough to spawn multiple processes to evaluate networks parallelly like so:", "And there you have it, we have implemented a genetic algorithm to create a simple agent that can play Tetris. Here\u2019s an example run with the best model obtained after just 10 generations with a population size of 50:", "There\u2019re definitely some limitations to the agent due to its simplicity, however. As the agent only takes into account of present reward and disregards future rewards, it\u2019s very likely to get into situations where placing a block gets lines cleared but worsen the board positioning. In addition, due to the small board size (18x10), if the agent gets multiple bad blocks in a row, it\u2019s very likely to lose. These lead to a very high standard deviation between runs like the example above where, in the best run, the agent clear 1031 lines and 364 lines in the worst one.", "And that\u2019s it, I hope you had fun reading my approach to this project. Feel free to check out the full source code available at and make any improvements as you wish: https://github.com/uiucanh/tetris", "[1] Erik D. Demaine, Susan Hohenberger, David Liben-Nowell. Tetris is Hard, Even to Approximate.", "[2] Renan Samuel da Silva, Rafael Stubs Parpinelli. Playing the Original Game Boy Tetris Using a Real Coded Genetic Algorithm", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer @ ABN AMRO"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6c0b2f5ace9b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bdanh96?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Duc Anh Bui"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff48b85adb83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&user=Duc+Anh+Bui&userId=f48b85adb83&source=post_page-f48b85adb83----6c0b2f5ace9b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@helloimnik?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Hello I\u2019m Nik \ud83c\udf9e"}, {"url": "https://unsplash.com/@helloimnik?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/Baekalfen/PyBoy", "anchor_text": "emulator"}, {"url": "https://www.twingalaxies.com/game/tetris/game-boy-game-boy-color/points/", "anchor_text": "TwinGalaxies"}, {"url": "https://www.britannica.com/science/NP-complete-problem", "anchor_text": "NP-complete"}, {"url": "https://pathmind.com/wiki/neural-network", "anchor_text": "here"}, {"url": "https://github.com/Baekalfen/PyBoy/blob/master/examples/gamewrapper_tetris.py", "anchor_text": "example"}, {"url": "https://github.com/uiucanh/tetris", "anchor_text": "https://github.com/uiucanh/tetris"}, {"url": "https://arxiv.org/abs/cs/0210020", "anchor_text": "Tetris is Hard, Even to Approximate"}, {"url": "https://www.researchgate.net/publication/322321608_Playing_the_Original_Game_Boy_Tetris_Using_a_Real_Coded_Genetic_Algorithm", "anchor_text": "Playing the Original Game Boy Tetris Using a Real Coded Genetic Algorithm"}, {"url": "https://medium.com/tag/tetris?source=post_page-----6c0b2f5ace9b---------------tetris-----------------", "anchor_text": "Tetris"}, {"url": "https://medium.com/tag/genetic-algorithm?source=post_page-----6c0b2f5ace9b---------------genetic_algorithm-----------------", "anchor_text": "Genetic Algorithm"}, {"url": "https://medium.com/tag/ai?source=post_page-----6c0b2f5ace9b---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6c0b2f5ace9b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----6c0b2f5ace9b---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&user=Duc+Anh+Bui&userId=f48b85adb83&source=-----6c0b2f5ace9b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&user=Duc+Anh+Bui&userId=f48b85adb83&source=-----6c0b2f5ace9b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6c0b2f5ace9b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6c0b2f5ace9b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6c0b2f5ace9b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bdanh96?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Duc Anh Bui"}, {"url": "https://medium.com/@bdanh96/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "39 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff48b85adb83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&user=Duc+Anh+Bui&userId=f48b85adb83&source=post_page-f48b85adb83--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fed9f27668bb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeating-the-world-record-in-tetris-gb-with-genetics-algorithm-6c0b2f5ace9b&newsletterV3=f48b85adb83&newsletterV3Id=ed9f27668bb7&user=Duc+Anh+Bui&userId=f48b85adb83&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}