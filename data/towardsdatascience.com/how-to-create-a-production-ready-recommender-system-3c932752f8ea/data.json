{"url": "https://towardsdatascience.com/how-to-create-a-production-ready-recommender-system-3c932752f8ea", "time": 1683000125.420647, "path": "towardsdatascience.com/how-to-create-a-production-ready-recommender-system-3c932752f8ea/", "webpage": {"metadata": {"title": "How to create a production-ready Recommender System | by Tirmidzi Faizal Aflahi | Towards Data Science", "h1": "How to create a production-ready Recommender System", "description": "You might have seen e-commerce websites every day. Or read many articles from lots of blogs, news, and Medium publications. From your perspective as a user or reader, what is the common pain point\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.verifysuper.com/filelockers/?id=23f9913377e0ced1b7b1f7664df6bb86", "anchor_text": "download the FREE book here", "paragraph_index": 7}, {"url": "https://www.python.org/downloads/", "anchor_text": "Python website", "paragraph_index": 39}, {"url": "https://www.kaggle.com/retailrocket/ecommerce-dataset", "anchor_text": "Retailrocket recommender system dataset", "paragraph_index": 46}, {"url": "https://thedatamage.com/best-course-for-ai-2019-updated/", "anchor_text": "best course for AI", "paragraph_index": 125}], "all_paragraphs": ["You might have seen e-commerce websites every day. Or read many articles from lots of blogs, news, and Medium publications.", "From your perspective as a user or reader, what is the common pain point when looking at all of those things?", "There are a lot of things available to see, and you often lost when trying to discover something.", "Yes, with those huge numbers of things or articles on those websites, the users need a solution, to simplify their discovery journey.", "If you are operating an e-commerce website or a blog, maybe you want to ask. Why bother?", "Well, have you heard about the funnel?", "The less the funnel of a user when trying to do something, the bigger the conversion. That is a basic rule in user experience. So, if reducing the number of steps can increase your site page view or even revenue, why not?", "If you want to read more about Recommendation System or Deep Learning in general, you can download the FREE book here.", "In simple terms, a recommender system is a discovery system. The system learns from the data and provides recommendations to users. Without the user specifically searching for that item, that item was brought automatically by the system.", "And this magic has been used by Amazon and Netflix since decades ago.", "How awesome it is, when you open Spotify and it already gives you a list of songs to listen to (Discover Weekly, and I amazed on how it can pick songs that I have never heard before, and I like it).", "In general term, there are two kinds of recommender system known by us, a human. Well, not all human.", "The type of recommender system that can easily be digested by our brain. Without a sign of short-circuiting or exploding.", "For example, you are an avid novel reader. And you like \u201cAnd then there were none\u201d by Agatha Christie. You bought it from an online bookstore.", "It makes sense if the bookstore will show you \u201cThe ABC Murders\u201d the next time you open the website.", "Because both of them written by Agatha Christie.", "Hence, the Content-based filtering model will recommend you that title.", "Wow, so easy! Let\u2019s use that!", "While Content-based filtering is easily digested by our brain and looks so simple, it can fail to guess the real behavior of the user.", "For example, I don\u2019t like Hercule Poirot, but I like other detectives in her novels. In that case, \u201cThe ABC Murders\u201d should not be recommended for me.", "This type will overcome the previous problem. Essentially, the system record all the previous interaction of the user on the website. And provide recommendations based on that.", "Take a look at this scenario.", "There are two users, A and B.", "The collaborative filtering will recommend B item 2 since there is another user who bought items 1 and 3 also bought item 2.", "You might say, wow, they could be sporadically bought together in coincidence.", "But, what if, there are 100 users who have the same behavior with user A?", "That was, the so-called, the power of crowds.", "So, why waiting? Let\u2019s just start creating Collaborative filtering system in your production environment!", "While it has an extremely good performance. It has several serious issues. More importantly when you are trying to create a production-ready system.", "While the problem no. 1 is easily solved with going hybrid, the other ones will still be a headache.", "Well, solving the number 2, 3, and 4 is the reason for this post.", "I might be in the same spot as you. I was really confused on how to make this thing possible. With the limitation of the machine, and of course common sense, I can\u2019t deploy a huge service just for this tiny requirement.", "And by luck, I stumbled upon this book", "They told me that for a production-ready system, you might not want the best accuracy of whatever performance it has.", "A somewhat inaccurate yet acceptable most often work in the real world use case.", "The most interesting part on how you can do that is,", "Let me explain while we build the system.", "Why python? Well, python is one of the easiest languages to learn. It will take you just a couple of hours to understand the syntax.", "And you can print all the item in the bag.", "Go to Python website to download and install it according to your Operating System.", "For this tutorial, you need several packages", "Numpy and Scipy are python package to handle mathematical computation, you will need them for the matrix. Pandas is used for your data. Requests is for http calls. and Jupyter is a web app to run your python code interactively.", "type jupyter notebook and you will see something like this", "Write the code on the cells provided, and the code will be run interactively.", "Before we begin, you need several tools.", "Download and install both of them, and you are ready to go.", "For this tutorial, let\u2019s take a look at a dataset in Kaggle. The Retailrocket recommender system dataset. Download it and extract the data in your Jupyter notebook directory.", "Among those files, you only need events.csv for this tutorial.", "That file consists of millions of actions by users to the items on the e-commerce website.", "Write those imports on the Jupyter notebook. And you are ready to go.", "Let\u2019s check, what kind of events are available", "You will get three events, view, addtocart, and transaction", "For the sake of simplicity, you might not want to play with all of the events. And for this tutorial, you will only play with transactions.", "So, let\u2019s filter the transactions only.", "You will have 22K transactions you can play with. I think it is good enough for a newbie like us.", "Let\u2019s take a look further into the data", "The rule of thumb on creating a simple yet effective recommender system is to downsample the data without losing quality. It means, you can take only maybe 50 latest transactions for each user and you still get the quality you want because behavior changes over-time.", "Now you only have 19,939 transactions. Means around 2K transactions are obsolete.", "Because of the visitor id and item id are huge numbers, you will be hard to remember each of those ids.", "You need other columns that are a 0 based index. You will see something like this.", "It\u2019s cleaner. Now you can use only the visitors and items column for all of our next steps.", "You have 11,719 unique visitors and 12,025 items, so you will need around 500MB memory to store the matrix.", "Sparse matrix comes to the rescue.", "Sparse matrices are a matrix with most of their element are zero. It makes sense since not all of the users buy all the items. Lot\u2019s of the connection will be zero.", "Apply the set_occurences function on each row in the data you have.", "It will print something like this", "From those 140 million cells in the matrix, only 18,905 are filled with non-zero.", "So basically you only need to store those 18,905 value to the memory. A 99.99% improved efficiency.", "The downside of the sparse matrix is, it is computationally higher when trying to retrieve the data in real-time. So, you should not finish at this step.", "Let\u2019s construct an item-item matrix where each element means how many times both items bought together by a user. Call it the co-occurrence matrix.", "To create a co-occurrence matrix, you need to dot product the transpose of the occurrence matrix with itself.", "I have tried it without sparse matrix and my computer suddenly stops working. So, let\u2019s not do that.", "It finished instantly with a sparse matrix. And I am happy.", "The setdiag function is setting the diagonal to 0, means you don\u2019t want to compute the value of item 1 and item 1 comes together since they are the same item.", "The co-occurrence matrix will consist of the number of the time both items bought together.", "But there is a chance, that there is an item. That item is bought regardless of the behavior of the user. Might be a flash sale, or something like that.", "In reality, you might want to really capture the behavior of the user, clean from something like that flash sale. Because it is not a behavior you are expecting.", "To remove those things affected, you need to penalize the score on the co-occurrence matrix.", "Ted Dunnings in the previous book has an algorithm called, Log-Likelihood Ratio or LLR.", "The LLR function is computing the likelihood of two events, A and B appear together.", "Now calculate the LLR function and save it to the pp_score matrix.", "Sort the result, so that the highest LLR score on each item is on the first column of each row.", "That first item on the result matrix, if high enough, can be considered as an indicator to the item.", "Let\u2019s take a look at one of the result", "You can safely answer that with a high number of LLR score, item 8682 and 380 can be an indicator for item 8456. While item 8501 since the score is not that big, might not be an indicator for item 8456.", "But, for a rule of thumb, you might want to give some limit on the LLR score, so insignificant indicators will be removed.", "Now you are ready to put those together to elasticsearch. So you can query the recommendation in real-time.", "Okay, now you are ready to put the things inside elasticsearch you have prepared before.", "But, be careful. If you are trying to add the data one by one using /_create/<id> API, it will take you forever. Of course, you can, but you need maybe half an hour to an hour just to move our 12,025 items into elasticsearch.", "I did it once, so please, don\u2019t repeat my mistake.", "Fortunately, elasticsearch has bulk API that can easily send multiple documents at once.", "So, create a new index (items2, I used items for the previous mistake) and let\u2019s try it", "And voila, it will finish within several seconds.", "You will have your data stored already", "Id is the id of the item. While indicators are the other items which become indicators to recommend this item.", "The best part of the thing we create is a real-time query,", "Great! So, the problem of needing a huge resource is a non-factor now. So, how about the other two problems?", "Before that, rest your eye for a while.", "The very common problem when building recommender systems is the cold start problem. Every new user will not have any of their behavior recorded in the system.", "So, what should the system recommend them?", "Let\u2019s take a look at our recently built recommendation system. Do you think anything strange about the result?", "Yep, the result only returns 3 recommended items. Just 3. How do you plan to display it to the customer?", "Let\u2019s display the other item not recommended at the end of the list. Just for the sake of good user experience.", "You can use a constant score to return all other items.", "But, for all the non-recommended items, you need to rank them so that the things that users probably will like even though not captured in their behavior.", "In many cases, popular item works really well.", "How do you calculate a popular item?", "Simple, count the item appearance one by one. So the highest popular value is the most popular.", "Let\u2019s create another index, called items3. And bulk insert", "In this indexing phase, you include the popular field. So, your data will look like this", "You will have three fields. Id and indicators like the previous one, and the popular field. The count of that item bought by users.", "Let\u2019s add popular to our previous query.", "So, you have multiple sources of scores now, i.e. the indicator matches and popular, how to combine the scores?", "Elasticsearch has function score to do with that.", "Rework your query and add a function score to slightly add 0.1 times the popular value to the constant score you have above. You don\u2019t have to stick with 0.1, you can use other function, even Natural logarithm. Like this,", "Now, you will see your most popular item, 461686 placed fourth, just below the recommended items.", "And also other popular items below.", "As you can see, our result stays the same every time we run the real-time query. That might be good because our technique is reproducible, but at the same time, the user might not be happy about it.", "Ted Dunnings from the book said, the click-through rate of the recommendation, will fall really low after the 20th result. It means any item we recommend after that will not be known to the user.", "There is a technique called dithering. It is creating a random noise when querying to bring up the least recommended item but still make the strongly recommended item at the top.", "The random score, it will give all of your item uniformly distributed random noise. The score will be minuscule so that the top recommendation will not go down.", "Hit that query, and see the result. You can see", "The positive note is. your user will not have to go scrolling to the second or third page. He or she just needs to hit that refresh button on the browser, and he or she will be provided new contents.", "Building a production-ready recommender system is not that hard. And current technology allows us to do that.", "Create the system with your data and get ready to deploy it to production.", "And of course, you can learn AI from this best course for AI", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Engineering is a process to make a better life. To make our life better."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3c932752f8ea&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kuzuryu71?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kuzuryu71?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Tirmidzi Faizal Aflahi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3f0ba807d0dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&user=Tirmidzi+Faizal+Aflahi&userId=3f0ba807d0dd&source=post_page-3f0ba807d0dd----3c932752f8ea---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@syinq?utm_source=medium&utm_medium=referral", "anchor_text": "Susan Yin"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.verifysuper.com/filelockers/?id=23f9913377e0ced1b7b1f7664df6bb86", "anchor_text": "download the FREE book here"}, {"url": "https://unsplash.com/@samuelzeller?utm_source=medium&utm_medium=referral", "anchor_text": "Samuel Zeller"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://mapr.com/practical-machine-learning/", "anchor_text": "Practical Machine Learning by Ted Dunning & Ellen Friedman"}, {"url": "https://www.python.org/downloads/", "anchor_text": "Python website"}, {"url": "https://www.elastic.co/", "anchor_text": "open-source"}, {"url": "https://www.getpostman.com/", "anchor_text": "Postman"}, {"url": "https://www.kaggle.com/retailrocket/ecommerce-dataset", "anchor_text": "Retailrocket recommender system dataset"}, {"url": "https://unsplash.com/@andreilazarev?utm_source=medium&utm_medium=referral", "anchor_text": "Andrei Lazarev"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://127.0.0.1:9200/_bulk/", "anchor_text": "http://127.0.0.1:9200/_bulk/"}, {"url": "http://127.0.0.1:9200/_bulk/", "anchor_text": "http://127.0.0.1:9200/_bulk/"}, {"url": "https://unsplash.com/@seantookthese?utm_source=medium&utm_medium=referral", "anchor_text": "Sean O."}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://127.0.0.1:9200/items/_create/", "anchor_text": "http://127.0.0.1:9200/items/_create/"}, {"url": "http://127.0.0.1:9200/_bulk/", "anchor_text": "http://127.0.0.1:9200/_bulk/"}, {"url": "http://127.0.0.1:9200/_bulk/", "anchor_text": "http://127.0.0.1:9200/_bulk/"}, {"url": "https://unsplash.com/@marvelous?utm_source=medium&utm_medium=referral", "anchor_text": "Marvin Meyer"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://thedatamage.com/best-course-for-ai-2019-updated/", "anchor_text": "best course for AI"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3c932752f8ea---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----3c932752f8ea---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/recommender-systems?source=post_page-----3c932752f8ea---------------recommender_systems-----------------", "anchor_text": "Recommender Systems"}, {"url": "https://medium.com/tag/python?source=post_page-----3c932752f8ea---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----3c932752f8ea---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&user=Tirmidzi+Faizal+Aflahi&userId=3f0ba807d0dd&source=-----3c932752f8ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&user=Tirmidzi+Faizal+Aflahi&userId=3f0ba807d0dd&source=-----3c932752f8ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3c932752f8ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3c932752f8ea---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3c932752f8ea--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3c932752f8ea--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3c932752f8ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kuzuryu71?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kuzuryu71?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tirmidzi Faizal Aflahi"}, {"url": "https://medium.com/@kuzuryu71/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "696 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3f0ba807d0dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&user=Tirmidzi+Faizal+Aflahi&userId=3f0ba807d0dd&source=post_page-3f0ba807d0dd--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbbba613fb3d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-a-production-ready-recommender-system-3c932752f8ea&newsletterV3=3f0ba807d0dd&newsletterV3Id=bbba613fb3d5&user=Tirmidzi+Faizal+Aflahi&userId=3f0ba807d0dd&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}