{"url": "https://towardsdatascience.com/detecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9", "time": 1683013830.431674, "path": "towardsdatascience.com/detecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9/", "webpage": {"metadata": {"title": "Building an Image Classification Model with CNN | by Eunjoo Byeon | Towards Data Science", "h1": "Building an Image Classification Model with CNN", "description": "A step-by-step guide in building an image classification model using a convolutional neural network"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["In this blog, I will outline how to build a simple image classification model using a convolutional neural network to detect the presence of pneumonia from chest X-ray images.", "Pneumonia is a common infection that inflames the air sacs in the lungs causing symptoms such as difficulty breathing and fever. Even though pneumonia is not difficult to treat, a timely diagnosis is crucial. Without proper treatment, pneumonia can become fatal especially among children and elders. Chest X-ray is an affordable method for the diagnosis of pneumonia. Developing a model that can reliably classify pneumonia from X-ray images can alleviate a load of physicians in the areas where the demand is high.", "Kermany and his colleagues at UCSD took the initiative to identify diseases based on the chest X-rays and Optical Coherence Tomography scans using deep learning. We used chest X-ray images provided in their study as our dataset.", "A data folder should be structured as below.", "After removing image files without proper encodings, we had 5,639 files in our data set, and we used 15% of these images as our validation set and the other 15% as a testing set. Our final training set included 1,076 normal cases and 2,873 cases of pneumonia.", "If you are interested in the steps to run exploratory data analysis on image data, please see my previous post.", "Our exploratory data visualizations showed that the inflammation in the lungs often obstructs visibility of the heart and the ribcage creating a larger variability around the lung area.", "As our baseline model, we will build a simple convolutional neural network that takes in images after resizing them to be a square matrix and normalizing all pixel values to range from 0 to 1. The full step is shown below.", "Now I will explain each step in detail.", "keras.image.ImageDataGenerator() takes images and create augmented data based on the parameters. Here we are just asking it to rescale all pixel values to be 0 to 1 without specifying any other augmentation parameters. Combined with flow_from_directory, the generator calls images from the directory in the assigned format, then creates rescaled data.", "keras.models.Sequential() initiates a sequential model. This model will sequentially process the added layers.", "Conv2D layers are the convolutional layers, which takes the input and runs them through the assigned number of filters. Kernel size refers to the dimension of filters. So in this example, each consecutive group of 3*3 pixels in our 256*256*1 image (1 referring to the number of channels, RGB images have 3 channels, while grayscale images have 1 channel) will run through 32 filters generating 32 feature maps with a size of 256*256*1.", "padding = \u2018same' is used to add equal paddings around our window since 256 is not divisible by 3.", "activation = 'relu' means that we are assigning the rectified linear unit as our activation function. Simply put, we are telling the layer to convert all our negative values to 0.", "We then feed these outputs from convolutional layers into the pooling layer. The MaxPooling2D layer abstracts the convolved outputs by only leaving the maximum value of each of the 2*2 matrices of the convolved output. Now we would have 32 feature maps with the size of 128*128*1.", "Now we need to narrow down these 4-dimensional outputs to a single number that can tell us whether to classify the image as pneumonia or normal. We do this by first flattening the layer into a single dimension then running them subsequently through smaller and smaller dense layers. A sigmoid function is applied as an activation function on the final layer because we now want the model to output a probability of whether the output is pneumonia or not.", "We have defined the architecture of our model. The next step is to decide the goal of this model and how we want it to get there. Using model.compile , we tell the model to minimize the binary cross-entropy loss (the log-loss, think logistic regression) using the gradient-descent. Here we are using the RMSprop algorithm to optimize this process by adaptively decreasing the learning rate. In the later model, I used the AMSGrad algorithm, which performed better for our problem.", "Finally, we finished constructing our model. It\u2019s time to fit our training data! Each epoch will run 32 batches by default. We are setting EarlyStopping to prevent overfitting. This model will stop running if our validation loss is not reduced for 5 consecutive epochs. I set the restore_best_weights to be true so it will revert to the highest performing weights after those 5 epochs. It tests its performance on the validation generator we created earlier.", "Our first model showed 94% accuracy predicting the class of validation data with the log loss of 0.11. Based on the below graph, we can see that training loss has room to improve so we can probably increase the complexity of the model. Also, the validation loss seems to be hovering around 0.1. We can try to improve generalizability by imitating adding more data using data augmentation.", "Here\u2019s a full code to plot the loss graph and accuracy graph from the fitted model.", "Now, we will try to implement data augmentation and add more complexity to our model.", "This time we added some parameters to our train image data generator. Therefore, now our generator will create new images for each batch by applying different rotation, brightness, shear, and zoom within the assigned range to the original image set.", "We also increased the model complexity by adding three more sets of convolutional and pooling layers. It\u2019s recommended to increase the number of convolution filters as the layer progresses. This is because as we move through the layers, we are trying to abstract more information, thus requiring larger sets of filters. The analogy is similar to how our brain processes visual information. As the signal moves from our retina to the optic chiasm, to the thalamus, to the primary visual cortex then through the inferior temporal cortex, the receptive fields of neurons at each step grow larger and become more and more sensitive to complex information.", "Our second model showed 97.3% accuracy with a log loss of 0.075 on a validation set. It seems like our adjustments indeed improved our model! Let\u2019s test it on our testing set to make sure they are generalizing well to the unseen data.", "Our model predicted the class of the X_ray images in the test set with 97.8% accuracy. It successfully identified 97.9% of the pneumonia cases.", "Our model showed that it is able to detect close to 98% of the pneumonia cases correctly given our dataset using a convolutional neural network. But especially for the medical problems where lives are at stake, even only 2% of missed cases should not be simply dismissed. In order to understand the limitation of our model, a detailed investigation into where the model fails is an important next step.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist | Designer | Programmer | Researcher | Lifelong Learner"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F599aea2d3fc9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://stereopickle.medium.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": ""}, {"url": "https://stereopickle.medium.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Eunjoo Byeon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F96add1ec6388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&user=Eunjoo+Byeon&userId=96add1ec6388&source=post_page-96add1ec6388----599aea2d3fc9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://data.mendeley.com/datasets/rscbjbr9sj/3", "anchor_text": "Large Dataset of Labeled Optical Coherence Tomography (OCT) and Chest X-Ray ImagesBe sure to download the most recent version of this dataset to maintain accuracy. This dataset contains thousands of\u2026data.mendeley.com"}, {"url": "https://towardsdatascience.com/exploratory-data-analysis-ideas-for-image-classification-d3fc6bbfb2d2", "anchor_text": "Exploratory Data Analysis Ideas for Image ClassificationVisualizing Patterns of Image Datatowardsdatascience.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----599aea2d3fc9---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----599aea2d3fc9---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/image-classification?source=post_page-----599aea2d3fc9---------------image_classification-----------------", "anchor_text": "Image Classification"}, {"url": "https://medium.com/tag/medical?source=post_page-----599aea2d3fc9---------------medical-----------------", "anchor_text": "Medical"}, {"url": "https://medium.com/tag/keras?source=post_page-----599aea2d3fc9---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&user=Eunjoo+Byeon&userId=96add1ec6388&source=-----599aea2d3fc9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&user=Eunjoo+Byeon&userId=96add1ec6388&source=-----599aea2d3fc9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F599aea2d3fc9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----599aea2d3fc9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----599aea2d3fc9--------------------------------", "anchor_text": ""}, {"url": "https://stereopickle.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://stereopickle.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Eunjoo Byeon"}, {"url": "https://stereopickle.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "188 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F96add1ec6388&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&user=Eunjoo+Byeon&userId=96add1ec6388&source=post_page-96add1ec6388--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fda8b33a640fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-pneumonia-using-convolutional-neural-network-599aea2d3fc9&newsletterV3=96add1ec6388&newsletterV3Id=da8b33a640fe&user=Eunjoo+Byeon&userId=96add1ec6388&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}