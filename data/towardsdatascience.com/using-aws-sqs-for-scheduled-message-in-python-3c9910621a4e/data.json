{"url": "https://towardsdatascience.com/using-aws-sqs-for-scheduled-message-in-python-3c9910621a4e", "time": 1683005647.141058, "path": "towardsdatascience.com/using-aws-sqs-for-scheduled-message-in-python-3c9910621a4e/", "webpage": {"metadata": {"title": "Using AWS SQS For Scheduled Message In Python | by Kizy | Towards Data Science", "h1": "Using AWS SQS For Scheduled Message In Python", "description": "For Data-as-a-Service product, sometimes, the architecture is more important than the idea itself. This is exactly the case for the product that we are developing with my friend. Newscatcher is an\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.safegraph.com/blog/data-as-a-service-bible-everything-you-wanted-to-know-about-running-daas-companies?source=search_post---------0", "anchor_text": "Data-as-a-Service", "paragraph_index": 0}, {"url": "http://newscatcherapi.com", "anchor_text": "Newscatcher", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/collecting-news-articles-through-rss-atom-feeds-using-python-7d9a65b06f70", "anchor_text": "RSS feeds", "paragraph_index": 3}, {"url": "https://www.alexa.com/about", "anchor_text": "Alexa", "paragraph_index": 4}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/guide/index.html#general-feature-guide", "anchor_text": "documentation", "paragraph_index": 12}, {"url": "https://stackoverflow.com/questions/42809096/difference-in-boto3-between-resource-client-and-session", "anchor_text": "Stackoverflow", "paragraph_index": 12}, {"url": "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html", "anchor_text": "IAM Roles and Policies", "paragraph_index": 21}, {"url": "https://github.com/NewscatcherAPI/beta/tree/master/Newscatchet%20Architecture%2C%20Part%20I", "anchor_text": "Github repository", "paragraph_index": 25}, {"url": "https://newscatcherapi.com/docs", "anchor_text": "sign up", "paragraph_index": 25}], "all_paragraphs": ["For Data-as-a-Service product, sometimes, the architecture is more important than the idea itself. This is exactly the case for the product that we are developing with my friend. Newscatcher is an API to search through news articles that were published online. In other words, we collect all the articles from the most popular news sources around the world, put them in one place and give a possibility to make a search based on date, source and full text.", "So far, we have released a closed beta. At its core, we are developers-first team, that is why we decided to share everything that we passed through. Another founder of Newcatcher API published an article about the whole data architecture.", "My goal is to dig deeper into details and talk about the functional part of the product. Explain the data pipeline, give some tips and reveal pitfalls to avoid. I will try to make this article as interesting as useful. Maybe you will be able to use it as a guide if you wonder about building the same architecture.", "Let\u2019s go back to the idea. We wanted to build an API containing the last news articles. The base point is the RSS feeds of every online news source. RSS feed is simple text files with basic updated information about articles. Almost every news source ahs one where they stock information like title, summary, published date, etc. Our goal was to create a data pipeline to get the information from multiple RSS feeds on an hourly basis. In order to fulfil the idea, we faced some simple questions:", "To answer the first question, we used sources like Wikipedia, Alexa and others to scrape news sources website and their RSS feeds. After several hours of manual cleaning and we got more or less some referential data stocked in .csv file. Everything starts with a .csv.", "Next step was to retrieve new articles using RSS feed multiple times a day. At this point, we came up with the idea to use SQS queues to gradually send referential data and get updates on articles. It had 2 main advantages:", "SQS queues and AWS Lambda in tandem suit perfectly to our needs. Multiple Lambda functions can be launched simultaneously. It means that each bunch of messages can be received by a lambda. To be fair, the advantages of SQS and Lambda functions are visible further in the data pipeline where we receive SQS queues and put them inside a DynamoDB table. Later in the article where we talk about Lambda function, there is only one that is launched for sending SQS queues.", "Now let\u2019s switch to a more technical part. Next half of the article contains a vivid example of the actual implementation.", "There are some steps to do before beginning to work on the data pipeline:", "Let\u2019s begin with something simple. Open S3 service on AWS, create a bucket and upload your .csv file there. Congratulations, one third is done.", "If you have done all the preinstallation requirements mentioned earlier, you will not have any problems in terms of access to different services.", "From now on, keep in mind that every time you want to use an AWS service, you have to import boto3 and to establish an appropriate connection either Resource or Client.", "I cannot tell when to use each one of them, try to read official documentation or short explanation from Stackoverflow. For your project, we always connected to DynamoDB as Resource, to S3 as Client, to SQS as Client for sending messages and as Resource to receive them.", "One more thing, you need to create a table in DynamoDB. It is not difficult: you go on the DynamoDB service and lick \u201cCreate table\u201d. The only thing to configure it is to choose by default a primary partition key \u2014 the variable with a unique value for each observation. If you do not have that variable, you can create MD5 hash of two variable that will give you a unique ID. For example:", "Sending data from S3 to DynamoDB is a one-shot action, no need to repeat it if your data has not been changed. The code snippet for this action begins with establishing the connection to needed services.", "One of the possible ways to send data to DynamoDB is through a list of dictionaries, where each dictionary represents an observation from your .csv file. So you will need a function to do the job. Each variable will be sent as a string. For the record, your .csv file must have the same name as the one you chose as the primary key for DynamoDB table.", "The final piece is the process of sending itself using the connections that you opened previously.", "You insert the main code under if __name__ == '__main__': , imports and the function can be put outside. Then launch .py from your virtual environment. Check the tab \u201cItems\u201d on your table in DynamoDB service.", "Using AWS Lambda, we are going to take immutable referential data and send it via SQS to be consumed by another Lambda. For performing this operation, we need to create a SQS queue, as well as Lambda function with all rights.", "Nothing difficult here. You go on the SQS service and create a new queue. There is a choice between Standard and FIFO queue. The main difference is the order: using FIFO the order of sent messages is saved, whereas, for Standard, it is not taken into account. We chose the Standard one, we do not really care about the order.", "You can also configure your queue. The configuration remains unique to your subject and type of information. In your case, each message contains 6 string variables. Here attached, the configuration from our SQS queue.", "For Lambda function, one of the trickiest parts is IAM Roles and Policies. In short, a Role is a set of policies. Policies are the actions authorized for one service to perform on another. Multiple policies can be attached to a role. A Role, in its turn, is associated with a service. You can add policies by searching among existing ones or you can create your own. In the example below, we authorize our Lambda function to retrieve information from DynamoDB table, send queues and leave logs.", "The structure of Lambda\u2019s function code repeats the one from Step 2, except it is not one-shot anymore. For our project, this function is the start of the whole data pipeline. We want it to be executed every 30 minutes by adding a trigger with simple cron schedule expression.", "The interior of the Lambda function looks like this.", "Messages are sent following the configuration of the SQS queue. There is another tip I can give you. If \u201cDelivery Delay\u201d option from SQS does not suit you, sqs.send_message has another parameter called DelaySeconds. Use this parameter when you want to separate sending actions inside Lambda function. For example, you have 10k observations to send, which will be proceeded one after another. Instead, you separate them into 5 pieces of 2k, with DelaySeconds=180 each and your next service will receive it gradually, without overloading your platform. Max limit of the DalaySeconds parameter is 900 seconds, that is why you will always have to delete 900 by the number of parts to have a max delay between sets of queues.", "Hope you found something useful in this article/guide. You can find all the mentioned code on our Github repository. Besides, we have released a closed beta. If you are interested in news API, sign up and test our product with your own hands.", "I am planning to write two other parts about receiving SQS messages, saving data on DynamoDB, using DynamoDB streams to fill in ES index, creating RESTful API on Flask and installing the beta version of Gateway API with Zappa. Be safe and stay at home.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3c9910621a4e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kizy625?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kizy625?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Kizy"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F456df1e68b1e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&user=Kizy&userId=456df1e68b1e&source=post_page-456df1e68b1e----3c9910621a4e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@melanie_sophie?utm_source=medium&utm_medium=referral", "anchor_text": "Melanie Pongratz"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.safegraph.com/blog/data-as-a-service-bible-everything-you-wanted-to-know-about-running-daas-companies?source=search_post---------0", "anchor_text": "Data-as-a-Service"}, {"url": "http://newscatcherapi.com", "anchor_text": "Newscatcher"}, {"url": "https://towardsdatascience.com/launching-beta-data-product-within-two-month-with-aws-6ac6b55a9b5d", "anchor_text": "How we launched a data product in 60 days with AWSTeam of two planned and shipped a beta for 200 users in less than 2 months without quitting their full-time jobs.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/collecting-news-articles-through-rss-atom-feeds-using-python-7d9a65b06f70", "anchor_text": "RSS feeds"}, {"url": "https://www.alexa.com/about", "anchor_text": "Alexa"}, {"url": "https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&all-free-tier.sort-order=asc", "anchor_text": "an AWS Free Tier account"}, {"url": "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html", "anchor_text": "EC2 instance"}, {"url": "https://console.aws.amazon.com/iam/home?#/security_credentials", "anchor_text": "an access key"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html", "anchor_text": "configure"}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/guide/index.html#general-feature-guide", "anchor_text": "documentation"}, {"url": "https://stackoverflow.com/questions/42809096/difference-in-boto3-between-resource-client-and-session", "anchor_text": "Stackoverflow"}, {"url": "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html", "anchor_text": "IAM Roles and Policies"}, {"url": "https://github.com/NewscatcherAPI/beta/tree/master/Newscatchet%20Architecture%2C%20Part%20I", "anchor_text": "Github repository"}, {"url": "https://newscatcherapi.com/docs", "anchor_text": "sign up"}, {"url": "https://medium.com/tag/aws?source=post_page-----3c9910621a4e---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/sqs?source=post_page-----3c9910621a4e---------------sqs-----------------", "anchor_text": "Sqs"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----3c9910621a4e---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/tag/product?source=post_page-----3c9910621a4e---------------product-----------------", "anchor_text": "Product"}, {"url": "https://medium.com/tag/s3?source=post_page-----3c9910621a4e---------------s3-----------------", "anchor_text": "S3"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&user=Kizy&userId=456df1e68b1e&source=-----3c9910621a4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&user=Kizy&userId=456df1e68b1e&source=-----3c9910621a4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3c9910621a4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3c9910621a4e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3c9910621a4e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3c9910621a4e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3c9910621a4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kizy625?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kizy625?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kizy"}, {"url": "https://medium.com/@kizy625/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "6 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F456df1e68b1e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&user=Kizy&userId=456df1e68b1e&source=post_page-456df1e68b1e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F456df1e68b1e%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-sqs-for-scheduled-message-in-python-3c9910621a4e&user=Kizy&userId=456df1e68b1e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}