{"url": "https://towardsdatascience.com/improve-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff", "time": 1683011756.325807, "path": "towardsdatascience.com/improve-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff/", "webpage": {"metadata": {"title": "Improve Your Model with Missing Data | Imputation with NumPyro | by Richard Michael | Towards Data Science", "h1": "Improve Your Model with Missing Data | Imputation with NumPyro", "description": "How do you handle missing data, gaps in your data-frames or noisy parameters? You have spent hours at work, in the lab or in the wild to generate or curate a dataset given an interesting research\u2026"}, "outgoing_paragraph_urls": [{"url": "https://bulbapedia.bulbagarden.net/wiki/Wild_Area", "anchor_text": "in the wild", "paragraph_index": 0}, {"url": "https://www.cs.cornell.edu/courses/cs4110/2016fa/lectures/lecture33.html", "anchor_text": "Probabilisitc Programming", "paragraph_index": 1}, {"url": "https://archive.ics.uci.edu/ml/datasets/iris", "anchor_text": "Iris flower data-set", "paragraph_index": 2}, {"url": "https://scikit-learn.org/stable/modules/classes.html#module-sklearn.datasets", "anchor_text": "sklearn.datasets", "paragraph_index": 2}, {"url": "https://github.com/pyro-ppl/numpyro", "anchor_text": "NumPyro", "paragraph_index": 13}, {"url": "https://pyro.ai/", "anchor_text": "Pyro", "paragraph_index": 13}, {"url": "https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo#:~:text=In%20statistics%2C%20Markov%20chain%20Monte,recording%20states%20from%20the%20chain.", "anchor_text": "MCMC", "paragraph_index": 13}, {"url": "https://jax.readthedocs.io/en/latest/notebooks/quickstart.html", "anchor_text": "JAX library", "paragraph_index": 18}, {"url": "https://jax.readthedocs.io/en/latest/_autosummary/jax.ops.index_update.html", "anchor_text": "efficient index updating", "paragraph_index": 18}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/Bayesian_Imputation.ipynb", "anchor_text": "github and in Google-Colab", "paragraph_index": 28}, {"url": "http://www.stat.columbia.edu/~gelman/book/", "anchor_text": "Bayesian Data Analysis", "paragraph_index": 35}, {"url": "http://pyro.ai/numpyro/bayesian_regression.html", "anchor_text": "NumPyro Documentations.", "paragraph_index": 35}, {"url": "https://arxiv.org/pdf/1701.02434.pdf", "anchor_text": "ArXiv", "paragraph_index": 35}, {"url": "https://arxiv.org/pdf/1701.02434.pdf", "anchor_text": ".", "paragraph_index": 35}, {"url": "https://www.cs.cornell.edu/courses/cs4110/2016fa/lectures/lecture33.html", "anchor_text": "Cornell University.", "paragraph_index": 35}, {"url": "http://M.Sc", "anchor_text": "M.Sc", "paragraph_index": 37}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog", "paragraph_index": 37}], "all_paragraphs": ["How do you handle missing data, gaps in your data-frames or noisy parameters? You have spent hours at work, in the lab or in the wild to generate or curate a dataset given an interesting research question or hypothesis. Terribly enough, you find that some of the measurements for a parameter are missing! Another case that might throw you off is unexpected noise that was introduced at some point in the experiment and has doomed some of your measurements to be extreme outliers. Sometimes you cannot just exile a whole bunch of parameter from your analysis, simply because it has 25% missing entries or should you?", "Fear not, there is a way you can make the most of your dataset anyways.In this post we will use Probabilisitc Programming [5] to fill the gaps that your model might struggle with.", "Lets build a problem from scratch. The studious reader is most likely familiar with the Iris flower data-set. It is somewhat part of the \u201chello-world\u201d in the ML community; next to the well-known MNIST that is.We use sklearn.datasets to get the data and put it into a pandas data-frame.:", "To make this example more explicit and easy on the eyes, lets select for only 2 out of the given 3 species.:", "Now you should see 100 measurements (rows that are our n) of the Iris flower data.We now take out 50% of the petal length entries by chance and assign NaN values with a bit of numpy and pandas magic.", "When we plot our data, we can clearly see that the petal length and petal width can help us identify which species (target-column) we are observing (see Fig. 1).", "We can make an even clearer distinction by regressing on the groups using just the petal-length parameter which we have brutally decimated earlier.", "Too bad about half of the data is missing. So what do we do now?", "First off, there are at least two broader degrees of missing data:", "Missing Completely at Random (MCAR) and Missing at Random (MAR).", "For a formal introduction to this see Bayesian Data Analysis [1] Ch.18 .", "One important distinction is that MCAR treats your missing parameters as independent of your observed measurements (lets call them y).In our example we rely on our parameter being missing at random or MAR. That means we don\u2019t think that the chance of a value gone missing is dependent on the parameter property but we think that there is potentially some relation between our length measure and the target species.", "First lets extract some basic info from the data of what we have so far:", "Now we build the model to do the imputation. For this we use the tool NumPyro, which is a light-weight probabilistic library. NumPyro provides a numpy-like backend to Pyro, a heavy duty probabilistic language. This comes in handy for the later model fitting. We are going to use MCMC methods to perform Baysian Inference and simulate missing entries along the way.To make this more applicable to a use case we combine this with a Bayesian regression-model. That means we want to model the distinction in species given all parameters that we know. Our variables are therefore:", "For each of those parameters we introduce a learnable bias which comes from a regular Normal distribution aka Gaussian, for the sake of simplicity. So lets get started.:", "One can do a bit of tweaking for the bias parameters above, but for our initial runs the normal Gaussian worked reasonably well. Now comes the delicate part. We introduce the distribution which we assume lies under our half-destroyed parameter. As with a lot of things we assume this to be Gaussian, which in our case is a reasonable assumption. Therefore we use the values we had computed earlier as loc=\u03bc (2.8 +/- 0.2) and scale=\u03c3\u00b2 (1.5+/-0.2).", "The informed reader clearly sees how the \u03bc and \u03c3 themselves are probabilistic parameters which we model in the process. For both we assume Gaussians but more rigorous distributions could be chosen. Now lets find our targets which we model. We localize our missing positions in the vector with numpy functionality.", "Additionally, we tell NumPyro to make the imputation-value (len_impute) a learnable parameter and fill with as many zeroes as values we are missing.On a short side-note shed some light on the mask: our model has a predictive mode, that occurs when no target (aka species) is provided. When we invoke the predictive capabilities, we sample from the introduced distribution with the sampled \u03bc and sampled \u03c3 instead. Make sure to only apply this on the NaN positions in your vector.", "We then put the imputed values into the right places and sample, with the actual length values as our observations. For this we use the JAX library with some efficient index updating \u2014 linear-algebra style.:", "In our length-sampling we include the actual length measures as the observations in the process .", "We proceed to put the imputed values into the regression model. For this Bayesian model to work, we have to fit our target y (the species). Since we have two classes, we do this by invoking a Bernoulli distribution.We therefore ask in a Bernoulli process whether we are looking at y=0 or y=1 \u2014 two classes, two potential outcomes.", "We introduce two parameters, one of which is a bias term for the length parameter.", "Now to the magical part. We use the logit for the Bernoulli, which composes of all the parameters that we put into the model in interaction with their biases. The observed value in this process is now the target-parameter - our y.", "To fit the model we use Bayesian Inference utilizing a MCMC method; the NUTS sampler to be specific. The beauty of the NUTS sampler is that it is a hands-off approach, as it adjusts step sizes by itself, given its stepping through the problem-space. We let it have 5000 warm-up or burn-in runs, which are discarded in the process and let it run for 10000 iterations, just to be sure. Our inference finishes with an acceptance probability of 0.96 or 96% \u2014 neat!. We then have a look at the summary what has happened:", "The output clearly shows convergence of the parameters which we sampled in our inference. Specifically the R-hat values are all >= 1.0 .", "We then pull the samples and visualize the posterior \u2014 we rely on JAX again for the formatting magic:", "We can see the plot over the posterior below. There we have it. A clear distinction between our two classes. There is quite a bit of jitter going on above and below the bounds, but the regression-line looks nicer.To be fair, this comes also from the fact that we used all available parameters in the regression compared to our earlier one-parameter model.The cherry on top is the 90% confidence interval around our regression-line, which is taken from our posterior. This puts things into perspective.", "We have shown that we can fill in the blanks in our model through MCMC-sampling.", "For the code-savvy, curious reader the final notebook can be found on my github and in Google-Colab.", "These questions can be answered with NumPyro\u2019s toolkit as well:", "A good example to fit with categorical data instead of continuous one is in the excellent Kaggle notebook on Age Imputation given other parameters for the Titanic dataset:", "Please stick to what you have!", "Do not invent data. I cannot stress that enough. It is a very fine line that we are walking here. If your experiments have generated insufficient data or you had to throw some data out, then imputing values, might not be the best way to go. Even when your data might become presentable that way. When talking to a client or an academic journal you don\u2019t get points for: we simulated parameter X and Y to 85.3% \u2014 no matter how nice the model looks.Please do declare what methods, distributions and, assumptions you used to make the models and imputations for maximum transparency. One recommendation is that you can always take out the data, fit a model without missing measurements and compare it to a model with imputed values in the end. That can make for a compelling story.", "We have walked through data imputation process, from the original messy data-frame to the final Bayesian inference procedure and fitted posterior distribution.We have shown how your Bayesian regression can benefit from an imputed vector and what the output looks like including confidence intervals.Probabilistic Programming can be a powerful tool in your daily work.", "Best of luck with your models and analysis!", "[1] A. Gelman, J.B. Carlin, et. al., Bayesian Data Analysis . Third Edition.[2] R. McElreath. Statistical Rethinking. 2016. CRC Press.[3] Uber Technologies. Regression using NumPyro. 2019. NumPyro Documentations. [4] M. Betancourt. A Conceptual Introduction to Hamiltonian Monte Carlo. 2020 on ArXiv.[5] CS 4110 \u2014 Programming Languages and Logics. Probabilistic Programming. 2016. Cornell University.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a Data Scientist and M.Sc. student in Bioinformatics at the University of Copenhagen. You can find more content on my weekly blog http://laplaceml.com/blog"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fdcb3c3376eff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rcml.medium.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59----dcb3c3376eff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arxiv.org/pdf/1701.02434.pdf", "anchor_text": "Monte Carlo methods"}, {"url": "https://bulbapedia.bulbagarden.net/wiki/Wild_Area", "anchor_text": "in the wild"}, {"url": "https://www.cs.cornell.edu/courses/cs4110/2016fa/lectures/lecture33.html", "anchor_text": "Probabilisitc Programming"}, {"url": "https://archive.ics.uci.edu/ml/datasets/iris", "anchor_text": "Iris flower data-set"}, {"url": "https://scikit-learn.org/stable/modules/classes.html#module-sklearn.datasets", "anchor_text": "sklearn.datasets"}, {"url": "https://github.com/pyro-ppl/numpyro", "anchor_text": "NumPyro"}, {"url": "https://pyro.ai/", "anchor_text": "Pyro"}, {"url": "https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo#:~:text=In%20statistics%2C%20Markov%20chain%20Monte,recording%20states%20from%20the%20chain.", "anchor_text": "MCMC"}, {"url": "https://jax.readthedocs.io/en/latest/notebooks/quickstart.html", "anchor_text": "JAX library"}, {"url": "https://jax.readthedocs.io/en/latest/_autosummary/jax.ops.index_update.html", "anchor_text": "efficient index updating"}, {"url": "https://github.com/RMichae1/PyroStudies/blob/master/Bayesian_Imputation.ipynb", "anchor_text": "github and in Google-Colab"}, {"url": "https://www.kaggle.com/fehiepsi/bayesian-imputation-for-age", "anchor_text": "Bayesian Imputation for AgeExplore and run machine learning code with Kaggle Notebooks | Using data from Titanic: Machine Learning from Disasterwww.kaggle.com"}, {"url": "http://www.stat.columbia.edu/~gelman/book/", "anchor_text": "Bayesian Data Analysis"}, {"url": "http://pyro.ai/numpyro/bayesian_regression.html", "anchor_text": "NumPyro Documentations."}, {"url": "https://arxiv.org/pdf/1701.02434.pdf", "anchor_text": "ArXiv"}, {"url": "https://arxiv.org/pdf/1701.02434.pdf", "anchor_text": "."}, {"url": "https://www.cs.cornell.edu/courses/cs4110/2016fa/lectures/lecture33.html", "anchor_text": "Cornell University."}, {"url": "https://medium.com/tag/data-science?source=post_page-----dcb3c3376eff---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----dcb3c3376eff---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/tag/probabilistic-programming?source=post_page-----dcb3c3376eff---------------probabilistic_programming-----------------", "anchor_text": "Probabilistic Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----dcb3c3376eff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/predictions?source=post_page-----dcb3c3376eff---------------predictions-----------------", "anchor_text": "Predictions"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&user=Richard+Michael&userId=7229c4f1db59&source=-----dcb3c3376eff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&user=Richard+Michael&userId=7229c4f1db59&source=-----dcb3c3376eff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fdcb3c3376eff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----dcb3c3376eff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----dcb3c3376eff--------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rcml.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Richard Michael"}, {"url": "https://rcml.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "72 Followers"}, {"url": "http://M.Sc", "anchor_text": "M.Sc"}, {"url": "http://laplaceml.com/blog", "anchor_text": "http://laplaceml.com/blog"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7229c4f1db59&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&user=Richard+Michael&userId=7229c4f1db59&source=post_page-7229c4f1db59--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7c745d7317a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fimprove-your-model-with-missing-data-imputation-with-numpyro-dcb3c3376eff&newsletterV3=7229c4f1db59&newsletterV3Id=7c745d7317a0&user=Richard+Michael&userId=7229c4f1db59&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}