{"url": "https://towardsdatascience.com/database-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db", "time": 1683011681.724691, "path": "towardsdatascience.com/database-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db/", "webpage": {"metadata": {"title": "Database Migration using AWS Data Migration Service (DMS) \u2014 A few lessons learnt along the way | by Manoj Kukreja | Towards Data Science", "h1": "Database Migration using AWS Data Migration Service (DMS) \u2014 A few lessons learnt along the way", "description": "Recently, we migrated a fairly large on-premises Oracle Database to Amazon Aurora PostgreSQL. To start off heterogeneous migrations between different database platforms are never easy. Coupling this\u2026"}, "outgoing_paragraph_urls": [{"url": "https://aws.amazon.com/dms/schema-conversion-tool/", "anchor_text": "AWS Schema Conversion Tool", "paragraph_index": 5}, {"url": "https://aws.amazon.com/dms/", "anchor_text": "AWS Database Migration Service", "paragraph_index": 6}, {"url": "http://www.datafence.com", "anchor_text": "Datafence Cloud Academy", "paragraph_index": 15}], "all_paragraphs": ["Recently, we migrated a fairly large on-premises Oracle Database to Amazon Aurora PostgreSQL. To start off heterogeneous migrations between different database platforms are never easy. Coupling this with migrating the database to the cloud definitely adds on to the challenge.", "The intent of this article is to share the migration methodology and highlight a few issues and pitfalls that came our way.", "Database Edition: Oracle Enterprise Edition 12", "Largest Table Size: 9 billion rows with over 2000 partitions and sub-partitions", "Since the size of the data was fairly large we decided against the idea of having AWS DMS fetch source data from the on-premises location using a VPN connection. Instead, we opted for a temporary Oracle instance on Amazon EC2. Without a doubt that would make a lot of sense for performance reasons.", "We used the AWS Schema Conversion Tool for the heterogeneous database migration. The tool worked pretty seamlessly. Any objects that could not be converted are clearly marked so that they can be manually converted to complete the migration. Assuming you do not have a lot of stored procedures, functions and packages you can expect that the AWS Schema Conversion Tool will convert the majority of your schema objects.", "We used the AWS Database Migration Service for migrating the huge data set from Oracle to PostgreSQL.", "One r4.4xlarge instance. One endpoint each for Oracle and PostgreSQL.", "All dimension tables were pretty small so we create one DMS job to a migrate data for all these tables in one shot.", "For the largest fact table we created multiple DMS jobs that copied 500\u2013600 million rows per job. The splits were done using the Selection Filters as below:", "This is the part where we spent the most time on. Our objective was to compare every row of data between Oracle and PostgreSQL.", "We started off by creating a data validation framework that uses a JDBC connection to fetch data from Oracle tables in chunks. Each chunk is then compared to the corresponding chunk in PostgreSQL. We did anticipate that JDBC method will be slow but the framework work fairly well in the test migration for both correctness and performance. However, things quickly went south during the production run due to the size of data increase. At one point we calculated it would take the framework one month to do the comparisons\u2026once again not good.", "We resolved the above issue by changing our approach. Instead of JDBC we opted to dump the Oracle and PostgreSQL tables on Amazon S3 as Parquet format files. We then wrote a simple Pyspark program that performed the comparison using Datafames. We fired the Spark program using an EMR cluster with a 1 m5.xlarge master and 4 core nodes using c4.8xlarge Spot instances. One month job folded to less than 1.5 days\u2026..not bad.", "Finally the results of the Pyspark script\u2026music to my ears. Check out the failed_count column.", "Hope you found this article helpful. I hope it saves some time and aggravation during your migrations. Feel free to ping me if you require the Pyspark script. I will happily supply it to you.", "I hope this article was helpful. AWS Data Migration Service is covered as part of the AWS Big Data Analytics course offered by Datafence Cloud Academy. The course is taught online by myself on weekends.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Author, Big Data Engineering, Data Science, Data Lakes, Cloud Computing and IT security specialist."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8c9a1624b8db&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mkukreja1.medium.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Manoj Kukreja"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4076fc16cb6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&user=Manoj+Kukreja&userId=4076fc16cb6a&source=post_page-4076fc16cb6a----8c9a1624b8db---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://aws.amazon.com/dms/schema-conversion-tool/", "anchor_text": "AWS Schema Conversion Tool"}, {"url": "https://aws.amazon.com/dms/", "anchor_text": "AWS Database Migration Service"}, {"url": "http://www.datafence.com", "anchor_text": "Datafence Cloud Academy"}, {"url": "https://medium.com/tag/aws?source=post_page-----8c9a1624b8db---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/oracle?source=post_page-----8c9a1624b8db---------------oracle-----------------", "anchor_text": "Oracle"}, {"url": "https://medium.com/tag/postgres?source=post_page-----8c9a1624b8db---------------postgres-----------------", "anchor_text": "Postgres"}, {"url": "https://medium.com/tag/amazon-web-services?source=post_page-----8c9a1624b8db---------------amazon_web_services-----------------", "anchor_text": "Amazon Web Services"}, {"url": "https://medium.com/tag/data?source=post_page-----8c9a1624b8db---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&user=Manoj+Kukreja&userId=4076fc16cb6a&source=-----8c9a1624b8db---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&user=Manoj+Kukreja&userId=4076fc16cb6a&source=-----8c9a1624b8db---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8c9a1624b8db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8c9a1624b8db---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8c9a1624b8db--------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Manoj Kukreja"}, {"url": "https://mkukreja1.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "626 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4076fc16cb6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&user=Manoj+Kukreja&userId=4076fc16cb6a&source=post_page-4076fc16cb6a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffc0268f00243&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdatabase-migration-using-aws-data-migration-service-dms-a-few-lessons-learnt-along-the-way-8c9a1624b8db&newsletterV3=4076fc16cb6a&newsletterV3Id=fc0268f00243&user=Manoj+Kukreja&userId=4076fc16cb6a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}