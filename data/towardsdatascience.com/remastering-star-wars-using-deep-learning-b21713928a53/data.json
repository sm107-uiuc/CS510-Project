{"url": "https://towardsdatascience.com/remastering-star-wars-using-deep-learning-b21713928a53", "time": 1683009583.046217, "path": "towardsdatascience.com/remastering-star-wars-using-deep-learning-b21713928a53/", "webpage": {"metadata": {"title": "Star Wars Episode IV (1977) Remastered | by Neel Iyer | Towards Data Science", "h1": "Star Wars Episode IV (1977) Remastered", "description": "I\u2019m a huge Star Wars fan. And like a lot of Star Wars fans I\u2019ve been getting into Star Wars: The Clone Wars on Cartoon Network and Disney+. It\u2019s a phenomenal show. But I\u2019m always annoyed by the drop\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/spiyer99/spiyer99.github.io/blob/master/nbs/star_wars_remastery.ipynb", "anchor_text": "Github", "paragraph_index": 1}, {"url": "https://www.imdb.com/title/tt0458290/", "anchor_text": "Star Wars: The Clone Wars", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Cue_mark", "anchor_text": "cue marks", "paragraph_index": 6}, {"url": "https://github.com/jantic/DeOldify", "anchor_text": "Deoldify", "paragraph_index": 7}, {"url": "https://www.youtube.com/watch?v=P0fMwA3X5KI", "anchor_text": "NVIDIA\u2019s Noise2Noise model", "paragraph_index": 7}, {"url": "https://ffmpeg.org/", "anchor_text": "Ffmpeg", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Seinfeld", "anchor_text": "Seinfeld", "paragraph_index": 10}, {"url": "https://ffmpeg.org/documentation.html", "anchor_text": "docs", "paragraph_index": 11}, {"url": "https://gist.github.com/HaydenFaulkner/54318fd3e9b9bdb66c5440c44e4e08b8#file-video_to_frames-py", "anchor_text": "Hayden Faulker\u2019s", "paragraph_index": 13}, {"url": "https://www.fast.ai/2019/05/03/decrappify/", "anchor_text": "NoGAN network", "paragraph_index": 20}, {"url": "https://github.com/fastai/course-v3/blob/master/nbs/dl1/lesson7-superres.ipynb", "anchor_text": "lesson 7", "paragraph_index": 20}, {"url": "https://colab.research.google.com/", "anchor_text": "google colab\u2019s free gpus", "paragraph_index": 21}, {"url": "https://www.youtube.com/watch?v=9spwoDYwW_I", "anchor_text": "recommends", "paragraph_index": 22}, {"url": "https://sgugger.github.io/how-do-you-find-a-good-learning-rate.html", "anchor_text": "shown", "paragraph_index": 25}, {"url": "https://github.com/ytdl-org/youtube-dl", "anchor_text": "youtube-dl", "paragraph_index": 30}, {"url": "https://github.com/jantic/DeOldify", "anchor_text": "Deoldify", "paragraph_index": 32}, {"url": "https://github.com/jantic/DeOldify#stuff-that-should-probably-be-in-a-paper", "anchor_text": "shown", "paragraph_index": 32}, {"url": "https://docs.fast.ai/vision.image.html#Image.save", "anchor_text": "save image", "paragraph_index": 36}, {"url": "https://github.com/AlphaAtlas/VapourSynth-Super-Resolution-Helper", "anchor_text": "VapourSynth", "paragraph_index": 40}], "all_paragraphs": ["Here\u2019s the output from the model. Left is remastered output. Right is original video.", "Full Jupyter Notebook for training and running inference is is available on Github", "A New Hope for the deleted scenes", "I\u2019m a huge Star Wars fan. And like a lot of Star Wars fans I\u2019ve been getting into Star Wars: The Clone Wars on Cartoon Network and Disney+. It\u2019s a phenomenal show.", "But I\u2019m always annoyed by the drop in video quality when I watch the older stuff. For example, here are the deleted scenes from Star Wars: Episode IV: A New Hope (1977). This was the very first Star Wars to be created.", "There\u2019s these weird black specs that keep popping up. Small wonder why these are the deleted scenes.", "Apparently those weird specs are called cue marks. They\u2019re marks that come from scratches on film. Star Wars is a fantastic series, but it\u2019s also fantastically old.", "Deep Learning has recently been used for video restoration. The results have been very promising. Deoldify for example, allows users to colorize old videos and images. NVIDIA\u2019s Noise2Noise model allows people to restore old images to their former glory.", "But so far there\u2019s nothing I know of that can specifically remove \u2018cue marks\u2019 and grainy spots from old film. So let\u2019s build it!", "Creating the dataset was tricky \u2014 but still doable. Here\u2019s what I did. I downloaded high quality videos into from youtube. Then I ruined them. I added black specs and reduced the resolution of the video. Ffmpeg was very useful in doing this.", "I\u2019m using this video. I\u2019m using a clip from Seinfeld. Cause why not?", "Then we\u2019ll need to ruin it. To do this I downloaded a grainy film overlay from youtube. Then I overlayed the video using ffmpeg with the blend setting set to softlight. Finding the right blend setting took a lot of trial and error. The ffmpeg docs don\u2019t have a lot of examples.", "Now we have two videos. One in perfect quality and another in crappy quality.", "Now we\u2019ll extract frames from each video. Initially, I adopted a naive approach for doing this. Where I would do through the video in python and scrape each frame individually. But that took too long. I eventually realised we can use multi-processing here to really speed things up. This was adapted from Hayden Faulker\u2019s script.", "Great. Now we have two datasets. One of crappy quality images (taken from the ruined video) and one of good quality images (taken from the high quality video). To make the crappy images crappier, I\u2019ll downscale them (this isn\u2019t a necessary step though).", "This is what the crappy and normal images looked like now. Side note: this is a great scene from seinfeld.", "A quick check shows that we have a dataset of about 10014 files. Pretty good.", "Let\u2019s make the most of those 10014 files by using transforms.", "I added horizontal and vertical flips, zoom changes, lighting changes and rotation changes. With Fastai this is really easy to do.", "Here are some of the image transforms.", "We\u2019ll use the NoGAN network pioneered by fastai and jason antic on this data. This code was inspired by lesson 7 of the fastai course.", "I trained the model on google colab\u2019s free gpus. They\u2019re a great resource and I can\u2019t believe they are free.", "The interesting thing that fastai recommends is increasing the size of your images gradually.", "So at first, you train on small size images, then you upscale your images and retrain on the larger images. It saves you a lot of time. Pretty smart.", "First, we\u2019ll train on images of size 128x128. Because the images are so small I can up the batch size to 64.", "I picked a learning rate of 1e-2 for this. I wanted something aggressive, but still on the safe side of explosion. This has been shown to be very useful.", "The network will print the results during training. The input is on the left, the prediction in the middle and the target on the right. The results look very promising!", "I resized and trained again. And again. Every time I make the resize slightly larger than it was previously. I moved from 128x128 to 480x480 to the original size of the video frames.", "This was the final train. For this I used pct_start = 0.3. I wanted to learning rate to reduce 70% of the time during training. I prefer a lower learning rate when fine tuning models. The results from this piece of training look really good.", "Once this network had trained, I ran inference. This was more involved than I originally thought.", "I had to download the Star Wars deleted scenes (using youtube-dl) and then extract all the frames in this video. I extracted the frames using the same method previously.", "Then I had to run inference from the learner on each individual frame of the video. That takes a long time.", "First, I added a render factor. This was taken from Deoldify. The idea is that I downscale the image and convert it to a square. Then I run inference on that image. The model is more receptive to images that are square shaped. This has been shown to reduce \u2018glitches\u2019 considerably.", "After running inference on the square shaped image I convert it back to its original shape. I found this to reduce glitches and generally result in a smoother video output. I set the render_factor to 40, although it can be higher if we want higher res output. I may need a larger RAM for that though.", "Second, I adjust brightness. This isn\u2019t really a hack. Seems like more of a mistake that I\u2019m correctly manually. For some reason, the model inference results in images that are very low in brightness.", "I suspect it\u2019s something to with the softlight filter we used for ffmpeg earlier. But I'm having to manually correct that here. I'll need to look into this further.", "Third, I\u2019m using matplotlib\u2019s save functionality. I found fastai\u2019s save image functionality to give me very weird results (Luke\u2019s clothes were fluroscent blue and red). But strangely, matplotlib\u2019s save functionality gives me okay results. I\u2019ll need to look into this. I suspect that I may be losing quality on the image because I\u2019m using matplotlib\u2019s savefig functionality.", "Here\u2019s some of the outputs from the model.", "Then I had to stitch all these frames together to create a video. To do that I initially used ffmpeg but I ended up overloading my RAM. Instead, I used opencv2\u2019s VideoWriter.", "2. There\u2019s a weird horizontal bar line that shows up around the 22 second mark. I didn't add any horizontal bars in the training set so it's completely understandable that the network didn't remove that at all. But in the future, I'll need to add more horizontal bars to my training set to fix these.", "3. I\u2019m also thinking of doing more super-resolution on the video. It would be nice to show a young Luke Skywalker in high quality. To do that I could resize the images before training further. I\u2019ve already downscaled the image, but potentially I could downscale it further.Alternatively, to achieve superres I could potentially use a ready-made upscaler such as VapourSynth. This is probably the best option as the original video is already in poor quality.", "4. Inference is also an issue. It tends to overload memory and crash. The result is that 42 seconds is the longest I could get for this video. I'm not completely sure how to solve this problem. But I'll need to solve it if I'm going to be using this further.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb21713928a53&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://neel-iyer.medium.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1----b21713928a53---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@koalamoose", "anchor_text": "Agnieszka Kowalczyk"}, {"url": "https://unsplash.com/photos/c0VRNWVEjOA", "anchor_text": "Unsplash"}, {"url": "https://github.com/spiyer99/spiyer99.github.io/blob/master/nbs/star_wars_remastery.ipynb", "anchor_text": "Github"}, {"url": "https://www.imdb.com/title/tt0458290/", "anchor_text": "Star Wars: The Clone Wars"}, {"url": "https://www.youtube.com/channel/UCSrRYklbl6GDioKfoQsjfeQ", "anchor_text": "Marcelo Zuniga"}, {"url": "https://en.wikipedia.org/wiki/Cue_mark", "anchor_text": "cue marks"}, {"url": "https://github.com/jantic/DeOldify", "anchor_text": "Deoldify"}, {"url": "https://www.youtube.com/watch?v=P0fMwA3X5KI", "anchor_text": "NVIDIA\u2019s Noise2Noise model"}, {"url": "https://ffmpeg.org/", "anchor_text": "Ffmpeg"}, {"url": "https://www.youtube.com/watch?v=nEAO60ON7yo", "anchor_text": "https://www.youtube.com/watch?v=nEAO60ON7yo"}, {"url": "https://en.wikipedia.org/wiki/Seinfeld", "anchor_text": "Seinfeld"}, {"url": "https://www.youtube.com/channel/UCFg3kyRzqAGpeEedLMPDZlA", "anchor_text": "SeriesHD"}, {"url": "https://ffmpeg.org/documentation.html", "anchor_text": "docs"}, {"url": "https://gist.github.com/HaydenFaulkner/54318fd3e9b9bdb66c5440c44e4e08b8#file-video_to_frames-py", "anchor_text": "Hayden Faulker\u2019s"}, {"url": "https://www.fast.ai/2019/05/03/decrappify/", "anchor_text": "NoGAN network"}, {"url": "https://github.com/fastai/course-v3/blob/master/nbs/dl1/lesson7-superres.ipynb", "anchor_text": "lesson 7"}, {"url": "https://colab.research.google.com/", "anchor_text": "google colab\u2019s free gpus"}, {"url": "https://www.youtube.com/watch?v=9spwoDYwW_I", "anchor_text": "recommends"}, {"url": "https://sgugger.github.io/how-do-you-find-a-good-learning-rate.html", "anchor_text": "shown"}, {"url": "https://github.com/ytdl-org/youtube-dl", "anchor_text": "youtube-dl"}, {"url": "https://github.com/jantic/DeOldify", "anchor_text": "Deoldify"}, {"url": "https://github.com/jantic/DeOldify#stuff-that-should-probably-be-in-a-paper", "anchor_text": "shown"}, {"url": "https://docs.fast.ai/vision.image.html#Image.save", "anchor_text": "save image"}, {"url": "https://www.youtube.com/channel/UCSrRYklbl6GDioKfoQsjfeQ", "anchor_text": "Marcelo Zuniga"}, {"url": "https://github.com/AlphaAtlas/VapourSynth-Super-Resolution-Helper", "anchor_text": "VapourSynth"}, {"url": "https://github.com/spiyer99/spiyer99.github.io/blob/master/nbs/star_wars_remastery.ipynb", "anchor_text": "Github"}, {"url": "https://spiyer99.github.io/Star-Wars-Remastery/", "anchor_text": "https://spiyer99.github.io"}, {"url": "https://medium.com/tag/star-wars?source=post_page-----b21713928a53---------------star_wars-----------------", "anchor_text": "Star Wars"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----b21713928a53---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----b21713928a53---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----b21713928a53---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----b21713928a53---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----b21713928a53---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----b21713928a53---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb21713928a53&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b21713928a53---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b21713928a53--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b21713928a53--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b21713928a53--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b21713928a53--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b21713928a53--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://neel-iyer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "418 Followers"}, {"url": "https://www.linkedin.com/in/neel-iyer/", "anchor_text": "https://www.linkedin.com/in/neel-iyer/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa4687e9ccf6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fremastering-star-wars-using-deep-learning-b21713928a53&newsletterV3=e7c5e1c9cae1&newsletterV3Id=a4687e9ccf6&user=Neel+Iyer&userId=e7c5e1c9cae1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}