{"url": "https://towardsdatascience.com/how-to-tune-pytorch-lightning-hyperparameters-80089a281646", "time": 1683012632.423367, "path": "towardsdatascience.com/how-to-tune-pytorch-lightning-hyperparameters-80089a281646/", "webpage": {"metadata": {"title": "How to tune Pytorch Lightning hyperparameters | by Richard Liaw | Towards Data Science", "h1": "How to tune Pytorch Lightning hyperparameters", "description": "This blog post demonstrates how to tune Pytorch Lightning hyperparameters with Ray Tune with just a couple lines of code!"}, "outgoing_paragraph_urls": [{"url": "https://github.com/PyTorchLightning/pytorch-lightning", "anchor_text": "Pytorch Lightning", "paragraph_index": 0}, {"url": "https://docs.ray.io/en/latest/tune.html", "anchor_text": "Ray Tune, an industry standard for hyperparameter tuning", "paragraph_index": 2}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 2}, {"url": "https://ray.io/", "anchor_text": "Ray", "paragraph_index": 2}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 4}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 9}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 10}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 11}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 13}, {"url": "https://docs.ray.io/en/latest/tune/api_docs/search_space.html", "anchor_text": "search space", "paragraph_index": 13}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 14}, {"url": "https://docs.ray.io/en/master/tune/api_docs/grid_random.html#random-distributions-api", "anchor_text": "many other (even custom) methods available", "paragraph_index": 14}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 15}, {"url": "https://docs.ray.io/en/master/using-ray-with-gpus.html#fractional-gpus", "anchor_text": "Ray Tune supports fractional GPUs", "paragraph_index": 16}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 21}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 21}, {"url": "https://docs.ray.io/en/latest/tune/tutorials/tune-usage.html#logging-tensorboard", "anchor_text": "into TensorBoard,", "paragraph_index": 22}, {"url": "https://docs.ray.io/en/master/tune/api_docs/schedulers.html#hyperband-tune-schedulers-hyperbandscheduler", "anchor_text": "early stopping of bad performing trials", "paragraph_index": 23}, {"url": "https://docs.ray.io/en/master/tune/api_docs/schedulers.html#population-based-training-tune-schedulers-populationbasedtraining", "anchor_text": "population based training", "paragraph_index": 23}, {"url": "https://docs.ray.io/en/master/tune/tutorials/tune-pytorch-lightning.html", "anchor_text": "full PyTorch Lightning tutorial", "paragraph_index": 23}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune", "paragraph_index": 24}, {"url": "https://forms.gle/9TSdDYUgxYs8SA9e8", "anchor_text": "joining our Slack", "paragraph_index": 24}, {"url": "https://github.com/ray-project/ray", "anchor_text": "Github", "paragraph_index": 24}], "all_paragraphs": ["Pytorch Lightning is one of the hottest AI libraries of 2020, and it makes AI research scalable and fast to iterate on. But if you use Pytorch Lightning, you\u2019ll need to do hyperparameter tuning.", "Proper hyperparameter tuning can make the difference between a good training run and a failing one. Everyone knows that you can dramatically boost the accuracy of your model with good tuning methods!", "In this blog post, we\u2019ll demonstrate how to use Ray Tune, an industry standard for hyperparameter tuning, with PyTorch Lightning. Ray Tune is part of Ray, a library for scaling Python.", "It is available as a PyPI package and can be installed like this:", "To use Ray Tune with PyTorch Lightning, we only need to add a few lines of code!!", "To run the code in this blog post, be sure to first run:", "Let\u2019s first start with some imports:", "After imports, there are three easy steps.", "First step, create your LightningModule. Your LightningModule should take a configuration dict as a parameter on initialization. This dict should then set the model parameters you want to tune. Your module could look like this:", "We will use a callback to communicate with Ray Tune. The callback is very simple:", "This callback ensures that after each validation epoch, we report the loss metrics back to Ray Tune. The val_loss and val_accuracy keys correspond to the return value of the validation_epoch_end method.", "Further, Ray Tune will start a number of different training runs. To create multiple training runs (for the hyperparameter search), we thus need to wrap the trainer call in a function:", "The train_mnist() function expects a config dict, which it then passes to the LightningModule. This config dict will contain the hyperparameter values of one evaluation.", "Finally, we need to call ray.tune to optimize our parameters. Here, our first step is to tell Ray Tune which values are valid choices for the parameters. This is called the search space, and we can define it like so:", "Let\u2019s take a quick look at the search space. For the first and second layer sizes, we let Ray Tune choose between three different fixed values. The learning rate is sampled between 0.0001 and 0.1. For the batch size, also a choice of three fixed values is given. Of course, there are many other (even custom) methods available for defining the search space.", "Ray Tune will now proceed to sample ten different parameter combinations randomly, train them, and compare their performance afterwards.", "We wrap the train_mnist function in tune.with_parameters to pass constants like the maximum number of epochs to train each model and the number of GPUs available for each trial. Ray Tune supports fractional GPUs, so something like gpus=0.25 is totally valid as long as the model still fits on the GPU memory.", "The final invocation of tune.run can look like this:", "And finally, the tuning result could look like this:", "In this simple example, a number of configurations reached a good accuracy. The best result we observed was a validation accuracy of 0.978105 with a batch size of 32, layer sizes of 128 and 64, and a small learning rate around 0.001. We can also see that the learning rate seems to be the main factor influencing performance \u2014 if it is too large, the runs fail to reach a good accuracy.", "You can retrieve the best score by using the return value of tune.run :", "You can also easily leverage some of Ray Tune\u2019s more powerful optimization features. For example, Ray Tune\u2019s search algorithm allows you to easily optimize the landscape of hyperparameter combinations. Ray Tune\u2019s schedulers can also stop bad performing trials early to save resources.", "Ray Tune automatically exports metrics into TensorBoard, and also easily supports W&B.", "Of course, this is a very simple example that doesn\u2019t leverage many of Ray Tune\u2019s search features, like early stopping of bad performing trials or population based training. If you would like to see a full example for these, please have a look at our full PyTorch Lightning tutorial.", "If you\u2019ve been successful in using PyTorch Lightning with Ray Tune, or if you need help with anything, please reach out by joining our Slack or dropping by our Github \u2014 we would love to hear from you!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "PhD Student at UC Berkeley \u2014 BAIR and RISELab"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F80089a281646&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----80089a281646--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----80089a281646--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@richliaw?source=post_page-----80089a281646--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@richliaw?source=post_page-----80089a281646--------------------------------", "anchor_text": "Richard Liaw"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F842dc7bf293f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&user=Richard+Liaw&userId=842dc7bf293f&source=post_page-842dc7bf293f----80089a281646---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/PyTorchLightning/pytorch-lightning", "anchor_text": "Pytorch Lightning"}, {"url": "https://docs.ray.io/en/latest/tune.html", "anchor_text": "Ray Tune, an industry standard for hyperparameter tuning"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://ray.io/", "anchor_text": "Ray"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://github.com/ray-project/ray/blob/releases/1.0.1/python/ray/tune/examples/mnist_ptl_mini.py", "anchor_text": "See the full example here."}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/latest/tune/api_docs/search_space.html", "anchor_text": "search space"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/master/tune/api_docs/grid_random.html#random-distributions-api", "anchor_text": "many other (even custom) methods available"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/master/using-ray-with-gpus.html#fractional-gpus", "anchor_text": "Ray Tune supports fractional GPUs"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://github.com/ray-project/ray/blob/releases/1.0.1/python/ray/tune/examples/mnist_ptl_mini.py", "anchor_text": "See the full example here."}, {"url": "https://docs.ray.io/en/latest/tune/tutorials/tune-usage.html#logging-tensorboard", "anchor_text": "into TensorBoard,"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://docs.ray.io/en/master/tune/api_docs/schedulers.html#hyperband-tune-schedulers-hyperbandscheduler", "anchor_text": "early stopping of bad performing trials"}, {"url": "https://docs.ray.io/en/master/tune/api_docs/schedulers.html#population-based-training-tune-schedulers-populationbasedtraining", "anchor_text": "population based training"}, {"url": "https://docs.ray.io/en/master/tune/tutorials/tune-pytorch-lightning.html", "anchor_text": "full PyTorch Lightning tutorial"}, {"url": "https://docs.ray.io/en/latest/tune/index.html", "anchor_text": "Ray Tune"}, {"url": "https://forms.gle/9TSdDYUgxYs8SA9e8", "anchor_text": "joining our Slack"}, {"url": "https://github.com/ray-project/ray", "anchor_text": "Github"}, {"url": "https://wandb.ai/amogkam/transformers/reports/Hyperparameter-Optimization-for-Huggingface-Transformers--VmlldzoyMTc2ODI", "anchor_text": "Weights and Biases report"}, {"url": "https://medium.com/distributed-computing-with-ray/the-simplest-way-to-serve-your-nlp-model-in-production-with-pure-python-d42b6a97ad55", "anchor_text": "simplest way to serve your NLP model"}, {"url": "https://medium.com/tag/data-science?source=post_page-----80089a281646---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----80089a281646---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/hyperparameter-tuning?source=post_page-----80089a281646---------------hyperparameter_tuning-----------------", "anchor_text": "Hyperparameter Tuning"}, {"url": "https://medium.com/tag/pytorch-lightning?source=post_page-----80089a281646---------------pytorch_lightning-----------------", "anchor_text": "Pytorch Lightning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&user=Richard+Liaw&userId=842dc7bf293f&source=-----80089a281646---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&user=Richard+Liaw&userId=842dc7bf293f&source=-----80089a281646---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----80089a281646--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F80089a281646&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----80089a281646---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----80089a281646--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----80089a281646--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----80089a281646--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----80089a281646--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----80089a281646--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----80089a281646--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----80089a281646--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----80089a281646--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@richliaw?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@richliaw?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Richard Liaw"}, {"url": "https://medium.com/@richliaw/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "209 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F842dc7bf293f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&user=Richard+Liaw&userId=842dc7bf293f&source=post_page-842dc7bf293f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F851035326d85&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-tune-pytorch-lightning-hyperparameters-80089a281646&newsletterV3=842dc7bf293f&newsletterV3Id=851035326d85&user=Richard+Liaw&userId=842dc7bf293f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}