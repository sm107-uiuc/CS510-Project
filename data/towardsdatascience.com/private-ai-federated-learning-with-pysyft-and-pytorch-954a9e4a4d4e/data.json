{"url": "https://towardsdatascience.com/private-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e", "time": 1682996513.299776, "path": "towardsdatascience.com/private-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e/", "webpage": {"metadata": {"title": "Private AI \u2014 Federated Learning with PySyft and PyTorch | by Andr\u00e9 Macedo Farias | Towards Data Science", "h1": "Private AI \u2014 Federated Learning with PySyft and PyTorch", "description": "During the last years, we all have witnessed an important and quick evolution in the fields of Artifical Intelligence and Machine Learning. This fast development is happening thanks to the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Facebook%E2%80%93Cambridge_Analytica_data_scandal", "anchor_text": "Cambridge Analytica Scandal", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/General_Data_Protection_Regulation", "anchor_text": "GDPR", "paragraph_index": 1}, {"url": "https://github.com/OpenMined/PySyft", "anchor_text": "PySyft", "paragraph_index": 5}, {"url": "https://arxiv.org/pdf/1602.05629.pdf", "anchor_text": "paper", "paragraph_index": 8}, {"url": "https://github.com/OpenMined/PySyft", "anchor_text": "PySyft", "paragraph_index": 12}, {"url": "https://arxiv.org/pdf/1811.04017.pdf", "anchor_text": "paper", "paragraph_index": 13}, {"url": "https://colab.research.google.com/", "anchor_text": "Colab", "paragraph_index": 18}, {"url": "https://archive.ics.uci.edu/ml/datasets/sms+spam+collection", "anchor_text": "SMS Spam Collection Data Set", "paragraph_index": 29}, {"url": "https://archive.ics.uci.edu/ml/index.php", "anchor_text": "UCI Machine Learning Repository", "paragraph_index": 29}, {"url": "https://github.com/andrelmfarias/Private-AI/blob/master/Federated_Learning/preprocess.py", "anchor_text": "script", "paragraph_index": 30}, {"url": "https://github.com/andrelmfarias/Private-AI", "anchor_text": "GitHub", "paragraph_index": 30}, {"url": "https://github.com/andrelmfarias/Private-AI/blob/master/Federated_Learning/handcrafted_GRU.py", "anchor_text": "script", "paragraph_index": 34}, {"url": "https://github.com/andrelmfarias/Private-AI", "anchor_text": "GitHub", "paragraph_index": 34}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_auc_score.html", "anchor_text": "AUC score", "paragraph_index": 36}, {"url": "https://eu.udacity.com/course/secure-and-private-ai--ud185", "anchor_text": "this free course on Udacity", "paragraph_index": 43}], "all_paragraphs": ["During the last years, we all have witnessed an important and quick evolution in the fields of Artifical Intelligence and Machine Learning. This fast development is happening thanks to the improvement of computation power (made available by the last generations of GPUs and TPUs) and the enormous amount of data that has been accumulated over the years and is being created every second.", "From conversational assistants to lung cancer detection, we can clearly see the several applications and various benefits of AI development for our society. However, for the past years, this progress came with a cost: loss of privacy at some degree. The Cambridge Analytica Scandal was the event that raised the alarms for concerns on confidentiality and data privacy. Furthermore, the increasing usage of data by tech companies, either small or big, led the authorities in several jurisdictions to work on regulation and laws regarding data protection and privacy. The GDPR in Europe is the most known example of such actions.", "These concerns and regulations are not directly compatible with the development of AI and Machine Learning, as the models and algorithms always relied on the availability of data and the possibility to centralize it in big servers. In order to address this issue, a new field of research is getting the interest of ML researchers and practitioners: Private and Secure AI.", "This new field consists of an ensemble of techniques that allow ML engineers to train models without having direct access to the data used for the training and avoid them to get any information about the data by the use of cryptography.", "It seems like black magic doesn't it?", "Don't worry\u2026 in a series of articles, I will show how it works and how we can apply it on our own Deep Learning models in Python with the open-source library PySyft.", "This framework relies on three main techniques:", "In this article, I will cover Federated Learning and its application for SMS spam detection.", "Maybe the easiest to understand concept in Private AI, Federated Learning is a technique to train AI models without having to move data to a central server. The term was first used by Google in a paper published in 2016.", "The main idea is that, instead of bringing the data to the model, we send the model to where the data is located.", "As the data is located in several devices (which I will call workers from here) the model is sent to each worker and then sent back to the central server.", "One simple example of Federated Learning in the real world happens with Apple devices. The application QuickType (Apple's text prediction tool) actually uses models that are sent time to time to iOS devices via WiFi, are trained locally with users' data and are sent back to Apple's central server with their weights updated.", "PySyft is an open-source library built for Federate Learning and Privacy Preserving. It allows its users to perform private and secure Deep Learning. It is built as an extension of some DL libraries, such as PyTorch, Keras and Tensorflow.", "If you are more interested you can also take a look at the paper published by OpenMined about the framework.", "In this article, I will show a tutorial using the PySyft extension of PyTorch.", "In order to install PySyft, it is recommended that you set up a conda environment first:", "Please be sure that you also have PyTorch 1.0.1 or higher installed in your environment.", "If you have an installation error regarding zstd, try to uninstall zstd and reinstall it.", "If you are still getting errors with the setup, you can alternatively use a Colab notebook and run the following line of code:", "The jupyter notebook with the code below is available on my GitHub page.", "In this tutorial, I will simulate two workers, Bob and Anne\u2019s devices, where the SMS messages will be stored. With PySyft we can simulate these remote machines by using the abstraction of VirtualWorker object.", "We can now send tensors to the workers with the method .send(worker). For example:", "You probably will get something like that as output:", "You can also check where is located the tensor the pointer is pointing to:", "We can see that the tensor is located at a VirtualWorker called \"bob\" and this worker has one tensor.", "Now you can do remote operations using these pointers:", "You can see that after the operation we get a pointer as a return. To get the tensor back you need to use the method .get()", "The most amazing thing is that we can effectuate all the operations provided by the PyTorch API on these pointers, such as compute losses, take gradients back to zero, perform backpropagation, etc.", "Now that you understand the basics of VirtualWorkers and Pointers we can train our model using Federated Learning.", "To simulate the remote data we will use SMS Spam Collection Data Set available on the UCI Machine Learning Repository. It consists of c. 5500 SMS messages, of which around 13% are spam messages. We will send about half of the messages to Bob's device and the other half to Anne's device.", "For this project, I performed some text and data preprocessing that I will not show here, but if you are interested you can take a look at the script I used available on my GitHub page. Please also note that in a real-life case this preprocessing will be done in each user's device.", "We then split the datasets in two and send it to the workers with the class sy.BaseDataset:", "When training in PyTorch, we use DataLoaders to iterate over the batches. With PySyft we can do a similar iteration with FederatedDataLoaders, where the batches come from several devices, in a federated manner.", "For this task, I decided to use a classifier based on a 1-layer GRU network. Unfortunately, the current version of PySyft does not support the RNNs modules of PyTorch yet. However, I was able to handcraft a simple GRU network with linear layers, which are supported by PySyft.", "As our focus here is the usage of the PySyft framework, I will skip the construction of the model. If you are interested in how I built it, you can check it out this script on my GitHub page.", "Please note the lines 8, 12, 13 and 27. These are the steps that differentiate a centralised training in PyTorch from a federated training with PySyft.", "After getting the model back at the end of the training loop, we can use it to evaluate its performance on local or remote test sets with a similar approach. In this case, I was able to achieve over 97.5% of AUC score, showing that training models in a federated manner does not hurt performance. However, we can notice an increase in overall time computation.", "We can see that with the PySyft library and its PyTorch extension, we can perform operations with tensor pointers such as we can do with PyTorch API (but for some limitations that are still to be addressed).", "Thanks to this, we were able to train a spam detector model without having any access to the remote and private data: for each batch, we sent the model to the current remote worker and got it back to the local machine before sending it to the worker of the next batch.", "There is however one limitation of this method: by getting the model back we can still have access to some private information. Let\u2019s say Bob had only one SMS on his machine. When we get the model back, we can just check which embeddings of the model changed and we will know which were the tokens (words) of the SMS.", "In order to address this issue, there are two solutions: Differential Privacy and Secured Multi-Party Computation (SMPC). Differential Privacy would be used to make sure the model does not give access to some private information. SMPC, which is one kind of Encrypted Computation, in return allows you to send the model privately so that the remote workers which have the data cannot see the weights you are using.", "I will show how we perform these techniques with PySyft in the next article.", "Feel free to give me feedback and ask questions!", "If you are interested in learning more about Secure and Private AI and how to use PySyft you can also check out this free course on Udacity. It's a great course for beginners taught by Andrew Trask, the founder of the OpenMined Initiative.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F954a9e4a4d4e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@andre.lmfarias?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.lmfarias?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Andr\u00e9 Macedo Farias"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa800706492c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&user=Andr%C3%A9+Macedo+Farias&userId=a800706492c5&source=post_page-a800706492c5----954a9e4a4d4e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Facebook%E2%80%93Cambridge_Analytica_data_scandal", "anchor_text": "Cambridge Analytica Scandal"}, {"url": "https://en.wikipedia.org/wiki/General_Data_Protection_Regulation", "anchor_text": "GDPR"}, {"url": "https://github.com/OpenMined/PySyft", "anchor_text": "PySyft"}, {"url": "https://arxiv.org/pdf/1602.05629.pdf", "anchor_text": "paper"}, {"url": "https://github.com/OpenMined/PySyft", "anchor_text": "PySyft"}, {"url": "https://github.com/OpenMined/PySyft", "anchor_text": "OpenMined/PySyftA library for encrypted, privacy preserving deep learning - OpenMined/PySyftgithub.com"}, {"url": "https://arxiv.org/pdf/1811.04017.pdf", "anchor_text": "paper"}, {"url": "https://colab.research.google.com/", "anchor_text": "Colab"}, {"url": "https://github.com/andrelmfarias/Private-AI", "anchor_text": "andrelmfarias/Private-AIRepository with tutorials and applications of Private-AI algorithms with PySyft - andrelmfarias/Private-AIgithub.com"}, {"url": "https://archive.ics.uci.edu/ml/datasets/sms+spam+collection", "anchor_text": "SMS Spam Collection Data Set"}, {"url": "https://archive.ics.uci.edu/ml/index.php", "anchor_text": "UCI Machine Learning Repository"}, {"url": "https://github.com/andrelmfarias/Private-AI/blob/master/Federated_Learning/preprocess.py", "anchor_text": "script"}, {"url": "https://github.com/andrelmfarias/Private-AI", "anchor_text": "GitHub"}, {"url": "https://github.com/andrelmfarias/Private-AI/blob/master/Federated_Learning/handcrafted_GRU.py", "anchor_text": "script"}, {"url": "https://github.com/andrelmfarias/Private-AI", "anchor_text": "GitHub"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_auc_score.html", "anchor_text": "AUC score"}, {"url": "https://eu.udacity.com/course/secure-and-private-ai--ud185", "anchor_text": "this free course on Udacity"}, {"url": "https://arxiv.org/pdf/1811.04017.pdf", "anchor_text": "https://arxiv.org/pdf/1811.04017.pdf"}, {"url": "https://arxiv.org/pdf/1602.05629.pdf", "anchor_text": "https://arxiv.org/pdf/1602.05629.pdf"}, {"url": "https://github.com/OpenMined/PySyft/tree/dev/examples/tutorials", "anchor_text": "https://github.com/OpenMined/PySyft/tree/dev/examples/tutorials"}, {"url": "https://medium.com/datadriveninvestor/an-overview-of-federated-learning-8a1a62b0600d", "anchor_text": "https://medium.com/@ODSC/an-open-framework-for-secure-and-private-ai-96c1891a4b"}, {"url": "https://medium.com/@ODSC/an-open-framework-for-secure-and-private-ai-96c1891a4b", "anchor_text": "https://medium.com/@ODSC/an-open-framework-for-secure-and-private-ai-96c1891a4b"}, {"url": "https://blog.openmined.org/upgrade-to-federated-learning-in-10-lines/", "anchor_text": "https://blog.openmined.org/upgrade-to-federated-learning-in-10-lines/"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----954a9e4a4d4e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/privacy?source=post_page-----954a9e4a4d4e---------------privacy-----------------", "anchor_text": "Privacy"}, {"url": "https://medium.com/tag/federated-learning?source=post_page-----954a9e4a4d4e---------------federated_learning-----------------", "anchor_text": "Federated Learning"}, {"url": "https://medium.com/tag/ai?source=post_page-----954a9e4a4d4e---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----954a9e4a4d4e---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&user=Andr%C3%A9+Macedo+Farias&userId=a800706492c5&source=-----954a9e4a4d4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&user=Andr%C3%A9+Macedo+Farias&userId=a800706492c5&source=-----954a9e4a4d4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F954a9e4a4d4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----954a9e4a4d4e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----954a9e4a4d4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.lmfarias?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andre.lmfarias?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andr\u00e9 Macedo Farias"}, {"url": "https://medium.com/@andre.lmfarias/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "208 Followers"}, {"url": "https://www.linkedin.com/in/andremfarias/", "anchor_text": "https://www.linkedin.com/in/andremfarias/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa800706492c5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&user=Andr%C3%A9+Macedo+Farias&userId=a800706492c5&source=post_page-a800706492c5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F670f0a90c9b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprivate-ai-federated-learning-with-pysyft-and-pytorch-954a9e4a4d4e&newsletterV3=a800706492c5&newsletterV3Id=670f0a90c9b6&user=Andr%C3%A9+Macedo+Farias&userId=a800706492c5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}