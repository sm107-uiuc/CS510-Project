{"url": "https://towardsdatascience.com/sql-tricks-for-data-scientists-53298467dd5", "time": 1683012904.360339, "path": "towardsdatascience.com/sql-tricks-for-data-scientists-53298467dd5/", "webpage": {"metadata": {"title": "SQL Tricks For Data Scientists. Leveraging SQL for the win | by Michael Beale | Towards Data Science", "h1": "SQL Tricks For Data Scientists", "description": "I found myself buried in cron jobs and CSV files that were requested by various teams within my company. There were endless requests for new data exports or updates to those exports. Anytime anybody\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.metabase.com/", "anchor_text": "Metabase", "paragraph_index": 2}, {"url": "https://simple.wikipedia.org/wiki/Turing_complete#:~:text=Turing%20complete%20is%20a%20term,programming%20languages%20are%20Turing%2Dcomplete.", "anchor_text": "Turing", "paragraph_index": 4}, {"url": "https://dev.mysql.com/doc/sakila/en/", "anchor_text": "Sakila", "paragraph_index": 6}, {"url": "https://www.mysqltutorial.org/mysql-recursive-cte/", "anchor_text": "here", "paragraph_index": 22}, {"url": "https://www.metabase.com/", "anchor_text": "Metabase", "paragraph_index": 24}, {"url": "http://www.themichaelbeale.com", "anchor_text": "www.themichaelbeale.com", "paragraph_index": 26}], "all_paragraphs": ["I found myself buried in cron jobs and CSV files that were requested by various teams within my company. There were endless requests for new data exports or updates to those exports. Anytime anybody wanted to add a field, I was the single point of failure for that task. I had to first remember which service generated that report as well as remember the point of the report. Then I had to investigate if the new field that was desired was available, could be derived from other columns, or required a new database connection.", "I needed to find an application that could help me to keep track of all the reports, manage all the various database connections, and allow someone to maintain the notifications on their own. A final important feature would be to offload some of the report generating off of my plate and allow people to self-serve all the data.", "I settled on Metabase because it fit all the criteria I was looking for. It\u2019s open-source, works with a variety of different data sources, has user/permission management, many charting/dashboarding options, and various different types of notifications.", "There was only one problem \u2014 Metabase is entirely SQL based. My workflow of using simple selects to query the database and transforming the data into CSVs wasn\u2019t going to be available. I had to use raw SQL. How could I insert any logic into SQL? How could I loop over results? How could I generate date ranges? How can I use rolling windows? Those types of questions made it sound like a SQL-only workflow wasn\u2019t going to cut it.", "But what if those operations were actually possible? What if SQL was actually a Turing-complete language with recursion? What if there was a way to pivot data or use windows? Below I\u2019ll go over a few tips that I discovered on my journey to take full advantage of the power of SQL.", "If you want to be able to execute the examples on your own, you can follow the below instructions. If you just want to read, skip to the next section.", "I\u2019m using MySQL 8 and the sample Sakila database for the examples. If you have Docker installed, I have provided lines of code to use to get a working MySQL 8 server running.", "The following starts the docker container.", "The database sample database can be loaded by downloading the sample files and extracting them.", "After the setup is completed, you can try out the examples for yourself.", "I\u2019ll start off with an easier \u2014 yet still powerful \u2014 example. Joining a table with another table can cause a cross (or cartesian) join if that table has a one to many or many to many relationships. We can use a subquery to narrow down the result set to one row from each table.", "For instance, let's say we want to find each actor and the last film they appeared in alphabetical order.", "The above query will list all the actors and all the films. But if you want to list just one film \u2014 the last one \u2014 we need to add a subquery to use only the films we want.", "For tables that have repeating events \u2014 like logging in and creating objects \u2014 you can find the first or last occurrence or a difference between the first and last occurrence. Below is the SQL to find the longevity of the customers where longevity is defined as the difference (in days) between their first and last rental date.", "Data that you want to convert the rows to columns \u2014 for presentation and/or charting \u2014 can be pivoted and summarized to fit your needs. Take the following query and sample output.", "Using CASE WHEN we can move the monthly breakdown into one row per month instead of one row per month per category.", "I didn\u2019t use all the categories to avoid a one page SQL statement but you could add the other columns to complete the query. MySQL doesn\u2019t have a built-in way to dynamically create each column but there is the ability to use a prepared statement to avoid having to spell out each column.", "Note: The group_concat_max_len variable needs to be sufficiently long enough to hold all the possible categories. The default value is 1024 but that can be changed per session if you run into any errors when trying to run the above SQL statement.", "Continuing with the theme of aggregating data, we can also use window functions to create rolling aggregates. Earlier we used a query to list all the rentals by genre and month. How could we add another column to show a running total per month as well as what percentage of rentals for the month were in each genre?", "The Overkeyword allows you to define how to partition the data. In this case, we are using the rental date month.", "I often run across data that I want to track over time. The problem is that there are instances where the data is sparse and may not have values for each time unit I want to display. For instance, take the following query:", "The previous query shows the count by month as expected but what if I want to see a 0 for the other columns.", "Recursive CTEs look more intimidating than they are. A better explanation than I could provide on the subject can be found here.", "SQL offers a powerful language to extract data. I\u2019ve gone over a few tips on how to use SQL to handle more complex filtering and aggregation instead of needing to perform those operations outside of the database.", "I do recommend Metabase for those wishing to add a business intelligence reporting engine to the organization. The only criteria that it has yet to satisfy is to actually get my coworkers to self-serve the report generation. But that\u2019s probably a function of me saying \u201cyes\u201d to all report requests.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Technology Enthusiast, Writer, Champion of the Customer. www.themichaelbeale.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F53298467dd5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----53298467dd5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@michael.beale?source=post_page-----53298467dd5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@michael.beale?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Michael Beale"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9ad66878e02c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&user=Michael+Beale&userId=9ad66878e02c&source=post_page-9ad66878e02c----53298467dd5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.metabase.com/", "anchor_text": "Metabase"}, {"url": "https://simple.wikipedia.org/wiki/Turing_complete#:~:text=Turing%20complete%20is%20a%20term,programming%20languages%20are%20Turing%2Dcomplete.", "anchor_text": "Turing"}, {"url": "https://dev.mysql.com/doc/sakila/en/", "anchor_text": "Sakila"}, {"url": "https://downloads.mysql.com/docs/sakila-db.tar.gz", "anchor_text": "https://downloads.mysql.com/docs/sakila-db.tar.gz"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "http://twitter.com/sql", "anchor_text": "@sql"}, {"url": "https://www.mysqltutorial.org/mysql-recursive-cte/", "anchor_text": "here"}, {"url": "https://www.metabase.com/", "anchor_text": "Metabase"}, {"url": "https://medium.com/tag/mysql?source=post_page-----53298467dd5---------------mysql-----------------", "anchor_text": "MySQL"}, {"url": "https://medium.com/tag/sql?source=post_page-----53298467dd5---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/data-science?source=post_page-----53298467dd5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----53298467dd5---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&user=Michael+Beale&userId=9ad66878e02c&source=-----53298467dd5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&user=Michael+Beale&userId=9ad66878e02c&source=-----53298467dd5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----53298467dd5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F53298467dd5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----53298467dd5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----53298467dd5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----53298467dd5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----53298467dd5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----53298467dd5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----53298467dd5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@michael.beale?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@michael.beale?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Michael Beale"}, {"url": "https://medium.com/@michael.beale/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "32 Followers"}, {"url": "http://www.themichaelbeale.com", "anchor_text": "www.themichaelbeale.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9ad66878e02c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&user=Michael+Beale&userId=9ad66878e02c&source=post_page-9ad66878e02c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F9ad66878e02c%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsql-tricks-for-data-scientists-53298467dd5&user=Michael+Beale&userId=9ad66878e02c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}