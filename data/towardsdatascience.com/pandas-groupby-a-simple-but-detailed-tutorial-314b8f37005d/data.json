{"url": "https://towardsdatascience.com/pandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d", "time": 1683006104.085857, "path": "towardsdatascience.com/pandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d/", "webpage": {"metadata": {"title": "Pandas Groupby: a simple but detailed tutorial | by Shiu-Tang Li | Towards Data Science", "h1": "Pandas Groupby: a simple but detailed tutorial", "description": "Pandas groupby is quite a powerful tool for data analysis. However, it\u2019s not very intuitive for beginners to use it because the output from groupby is not a Pandas Dataframe object, but a Pandas\u2026"}, "outgoing_paragraph_urls": [{"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rank.html", "anchor_text": "link", "paragraph_index": 36}], "all_paragraphs": ["Pandas groupby is quite a powerful tool for data analysis. However, it\u2019s not very intuitive for beginners to use it because the output from groupby is not a Pandas Dataframe object, but a Pandas DataFrameGroupBy object. A DataFrame object can be visualized easily, but not for a Pandas DataFrameGroupBy object. If an object cannot be visualized, then this makes it harder to manipulate.", "Some of the tutorials I found online contain either too much unnecessary information for users or not enough info for users to know how it works. I think a guide which contains the key tools used frequently in a data scientist\u2019s day-to-day work would definitely help, and this is why I wrote this article to help the readers better understand pandas groupby.", "Important notes. 1. I assume the reader already knows how group by calculation works in R, SQL, Excel (or whatever tools), before getting started. 2. All codes are tested and they work for Pandas 1.0.3. There could be bugs in older Pandas versions.", "Examples will be provided in each section \u2014 there could be different ways to generate the same result, and I would go with the one I often use.", "In order to generate the statistics for each group in the data set, we need to classify the data into groups, based on one or more columns.", "Then, we decide what statistics we\u2019d like to create. This can be done with .agg(). And there\u2019re a few different ways to use .agg():", "A. Use a dictionary as the input for .agg().B. Use a single aggregation function or a list of aggregation functions as the input.C. Use named aggregation (new in Pandas 0.25.0) as the input.", "I\u2019ll use the following example to demonstrate how these different solutions work.", "A. DictionaryWhen to use? \u2014 When we need to run different aggregations on the different columns, and we don\u2019t care about what aggregated column names look like.", "For each key-value pair in the dictionary, the keys are the variables that we\u2019d like to run aggregations for, and the values are the aggregation functions.", "If for each column, no more than one aggregation function is used, then we don\u2019t have to put the aggregations functions inside of a list. And in this case, tbl will be single-indexed instead of multi-indexed.", "B. A single aggregation function or a list aggregation functionsWhen to use? \u2014 When we need to run the same aggregations for all the columns, and we don\u2019t care about what aggregated column names look like.", "If we\u2019d like to apply the same set of aggregation functions to every column, we only need to include a single function or a list of functions in .agg().", "If we\u2019d like to view the results for only selected columns, we can apply filters in the codes:", "Note. If we filter by multiple columns, then tbl.columns would be multi-indexed no matter which method is used. If we filter by a single column, then [['col_1']] makes tbl.columns multi-indexed, and ['col_1'] makes tbl.columns single-indexed.", "C. Named aggregations (Pandas \u2265 0.25)When to use? \u2014 When we need to run different aggregations on the different columns, and we\u2019d like to have full control over the column names after we run .agg()", "In each tuple, the first element is the column name, the second element is the aggregation function.", "to convert the columns to categorical series with levels specified by the user before running .agg(). (Note.pd.Categorical may not work for older Pandas versions)", "Let\u2019s look at another example to see how we compute statistics using user defined functions or lambda functions in .agg().", "We\u2019d like to calculate the following statistics for each store:A. The number of products starting with \u2018A\u2019 B. The list of all productsC. The difference of max product price and min product priceD. The first quantile (25th percentile) of the product price", "First, we define a function that computes the number of elements starting with \u2018A\u2019 in a series.", "And we can then use named aggregation + user defined functions + lambda functions to get all the calculations done elegantly.", "When the function is not complicated, using lambda functions makes you life easier. lambda x: x.max()-x.min() and", "Note. if you need a unique list when there\u2019re duplicates, you can do lambda x: ', '.join(x.unique()) instead of lambda x: ', '.join(x).", "Let\u2019s use the data in the previous section to see how we can use .transform() to append group statistics to the original data.", "With .transform(), we can easily append the statistics to the original data set.", "Note 1. Unlike .agg(), .transform() does not take dictionary as its input. Note 2. In order to correctly append the data, we need to make sure there\u2019re no missing values in the columns used in .groupby(). (According to Pandas User Guide, .transform() returns an object that is indexed the same (same size) as the one being grouped.)", "Question: how to calculate the percentage of account types in each bank? First, we calculate the group total with each bank_ID + acct_type combination:", "and then calculate the total counts in each bank and append the info using .transform().", "Another solution without .transform(): grouping only by bank_ID and use pd.merge() to join the result back to tbl.", "With the transaction data above, we\u2019d like to add the following columns to each transaction record:", "Note. Make sure the data is sorted first before doing the following calculations. This table is already sorted, but you can do df.sort_values(by=['acct_ID','transaction_time'], inplace=True) if it\u2019s not.", "For 2.-6., it can be easily done with the following codes:", "The key idea to all these calculations is that, window functions like .rank(), .shift(), .diff(), .cummax(),.cumsum() not only work for pandas dataframes, but also work for pandas groupby objects.", "Let\u2019s see what we get after running the calculations above. The result is split into two tables.", "The reader can play with these window functions using different arguments and check out what happens (say, try .diff(2) or .shift(-1)?).", "Questions for the readers: 1. How do we calculate moving average of the transaction amount with different window size? (Hint: Combine.shift(1), .shift(2) , \u2026)2. How do we calculate the transaction row number but in descending order? (Hint: play with the ascending argument in .rank() \u2014 see this link.)", "This is the end of the tutorial, thanks for reading. Suggestions are appreciated \u2014 welcome to post new ideas / better solutions in the comments so others can also see them.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Mathematician \u2192 Data scientist \u2192 Software engineer"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F314b8f37005d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----314b8f37005d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@shiutangli?source=post_page-----314b8f37005d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shiutangli?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Shiu-Tang Li"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1e77e054ef75&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&user=Shiu-Tang+Li&userId=1e77e054ef75&source=post_page-1e77e054ef75----314b8f37005d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@dvlw?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "dirk von loen-wagner"}, {"url": "https://unsplash.com/s/photos/lake?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rank.html", "anchor_text": "link"}, {"url": "https://medium.com/tag/data-science?source=post_page-----314b8f37005d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----314b8f37005d---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/tag/python?source=post_page-----314b8f37005d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pandas?source=post_page-----314b8f37005d---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/programming?source=post_page-----314b8f37005d---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&user=Shiu-Tang+Li&userId=1e77e054ef75&source=-----314b8f37005d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&user=Shiu-Tang+Li&userId=1e77e054ef75&source=-----314b8f37005d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F314b8f37005d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----314b8f37005d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----314b8f37005d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----314b8f37005d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----314b8f37005d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----314b8f37005d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----314b8f37005d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shiutangli?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@shiutangli?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Shiu-Tang Li"}, {"url": "https://medium.com/@shiutangli/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.5K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1e77e054ef75&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&user=Shiu-Tang+Li&userId=1e77e054ef75&source=post_page-1e77e054ef75--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fceccfcc5a7a4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpandas-groupby-a-simple-but-detailed-tutorial-314b8f37005d&newsletterV3=1e77e054ef75&newsletterV3Id=ceccfcc5a7a4&user=Shiu-Tang+Li&userId=1e77e054ef75&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}