{"url": "https://towardsdatascience.com/designing-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d", "time": 1683010902.2824588, "path": "towardsdatascience.com/designing-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d/", "webpage": {"metadata": {"title": "Designing an optimal multi-language search engine with Elasticsearch | by Artem | Towards Data Science", "h1": "Designing an optimal multi-language search engine with Elasticsearch", "description": "When I was designing Elasticsearch index for NewsCatcherAPI, one of the biggest problems I had was handling multi-language news articles. I knew that Elasticsearch has pre-build analyzers for the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatcherAPI", "paragraph_index": 0}, {"url": "https://nlp.stanford.edu/IR-book/html/htmledition/stemming-and-lemmatization-1.html#:~:text=Lemmatization%20usually%20refers%20to%20doing,is%20known%20as%20the%20lemma%20.", "anchor_text": "Lemmatization", "paragraph_index": 4}, {"url": "https://nlp.stanford.edu/IR-book/html/htmledition/stemming-and-lemmatization-1.html#:~:text=Lemmatization%20usually%20refers%20to%20doing,is%20known%20as%20the%20lemma%20.", "anchor_text": "stemming", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Stop_words", "anchor_text": "stopwords", "paragraph_index": 4}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lang-analyzer.html#analysis-lang-analyzer", "anchor_text": "language-specific analyzers", "paragraph_index": 5}, {"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatherAPI", "paragraph_index": 6}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/7.x/multi-fields.html", "anchor_text": "fields", "paragraph_index": 7}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-index.html", "anchor_text": "multiple indexes via a wildcard", "paragraph_index": 16}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/7.x/set-processor.html", "anchor_text": "set processor", "paragraph_index": 21}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html", "anchor_text": "painless script", "paragraph_index": 22}, {"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatcherAPI", "paragraph_index": 27}, {"url": "https://www.elastic.co/blog/multilingual-search-using-language-identification-in-elasticsearch", "anchor_text": "Multilingual search using language identification in Elasticsearch", "paragraph_index": 28}], "all_paragraphs": ["When I was designing Elasticsearch index for NewsCatcherAPI, one of the biggest problems I had was handling multi-language news articles.", "I knew that Elasticsearch has pre-build analyzers for the most popular languages. The question was \u201cHow do I manage to have documents with different languages that I can search all together (if needed)?\u201d", "Important: in our case, we had each document already labeled with the correct language. Still, it is not necessary for all approaches described in this post.", "Also, for this post set up, let\u2019s assume that each document (news article) has only 2 fields:title and language. Where language is the language of the title. For simplicity, assume that there can be only two different languages: English (en) and French (fr).", "Each language is different in many ways ( I speak 4 languages so gimme some credits). Lemmatization, stemming, stopwords. All of these are unique on a per-language basis.", "So, if you want Elasticsearch to understand that \u201cdogs\u201d is just a plural form of \u201cdog\u201d, or that \u201cdifferent\u201d and \u201cdiffer\u201d share the same root \u2014 you have to use language-specific analyzers. (even for English!)", "First, I will describe 2 approached that I found on the web and explain why I did not like them. Then, I will propose my solution which we used for NewsCatherAPI. And, finally, I will leave a link to a very advanced approach that will autodetect the language.", "The idea of such an approach is to index your text field multiple times using fields parameter.", "For example, if we want to make an index that would index the same text field with standard, English, and French analyzers:", "The title variable is, therefore, indexed 3 times. Now, to search through all the languages, you will have to perform a multi-match search. For example:", "When you have just 2 languages it is acceptable, but assume you have 10 (as we do).", "The first two points may not be that bad, however, the third one is. Assume you have 10 languages. To search through your entire database, you would have to compose a multi-match query that has to search through 10 differently indexed fields simultaneously (plus, the number of index\u2019 shards).", "To sum up this approach, it may be an acceptable option for a 2\u20133 languages index (and relaxed budget).", "The most popular answer you can get on Stackoverflow (assumes the language of each document is known at the pre-index time).", "Create a separate index for each language. For example, an index with English text we call and the French one would be.", "Then, if you know the language of search you can direct it to the correct index.", "Regarding the last point. Assume we have a timestamp field, and we want to retrieve all the articles published over this week. For that, you have to filter by the published DateTime field over all of the indexes. Technically, not a problem at all, just search your field from multiple indexes via a wildcard.", "For example, if we want to search through both, and, just use.", "But, that is no better than using a multi-match search. It is a multi-index search now.", "Our source data does not have nor fields. So, we have to set up the ingest node\u2019s pipeline to fix this.", "Use an ingest node to pre-process documents before the actual document indexing happens. The ingest node intercepts bulk and index requests, it applies transformations, and it then passes the documents back to the index or bulk APIs.", "We will use a set processor to \u201ccopy\u201d title value to title_en or title_fr depending on the language value.", "We have to write a simple painless script to make the set processor conditional.", "We create an ingest pipeline called \u201c langdetect \u201c", "It has 2 processors that will set title_en and title_fr fields depending on the values of the language field.", "According to our pipeline, if language field\u2019s value is equal to \u201cen\u201d then set title_en field to what is in the title field. Therefore, English text will be analyzed by a standard analyzer (title field) and also by English analyzer (title_en field).", "Now, when the pipeline is created, we have to \u201cattach\u201d it to the index. So, let\u2019s update our index settings:", "For NewsCatcherAPI example, when user wants to search in English she has to set language parameter in our API to en. We, at the back-end, will search through title_ + {lang} which is title_en in case of en. It is a bit more complicated than that but should be enough to explain this blog post.", "Multilingual search using language identification in Elasticsearch", "It was a bit of surprise when I realized that it is not easy and obvious to manage multi-language search index with Elasticsearch. I had to spend lots of time to figure out the best case for our use-case.", "Hope this \u201ccheat-sheet\u201d will save you a bit of time!", "Ask me questions in the comments if something is not clear.", "By the way, if you need help with your Elasticsearch cluster/index/set up, I do consult.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3d2de1b9636d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://kotartemiy.medium.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": ""}, {"url": "https://kotartemiy.medium.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Artem"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F572d20cac11d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&user=Artem&userId=572d20cac11d&source=post_page-572d20cac11d----3d2de1b9636d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@joeljnaren?utm_source=medium&utm_medium=referral", "anchor_text": "Joel Naren"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatcherAPI"}, {"url": "https://nlp.stanford.edu/IR-book/html/htmledition/stemming-and-lemmatization-1.html#:~:text=Lemmatization%20usually%20refers%20to%20doing,is%20known%20as%20the%20lemma%20.", "anchor_text": "Lemmatization"}, {"url": "https://nlp.stanford.edu/IR-book/html/htmledition/stemming-and-lemmatization-1.html#:~:text=Lemmatization%20usually%20refers%20to%20doing,is%20known%20as%20the%20lemma%20.", "anchor_text": "stemming"}, {"url": "https://en.wikipedia.org/wiki/Stop_words", "anchor_text": "stopwords"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-lang-analyzer.html#analysis-lang-analyzer", "anchor_text": "language-specific analyzers"}, {"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatherAPI"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/7.x/multi-fields.html", "anchor_text": "fields"}, {"url": "https://codarium.substack.com/p/optimizing-elasticsearch-performance", "anchor_text": "my other post"}, {"url": "https://www.elastic.co/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster", "anchor_text": "Indices are not free from a cluster perspective, as there is some level of resource overhead for each index."}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-index.html", "anchor_text": "multiple indexes via a wildcard"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/7.x/ingest.html", "anchor_text": "the official documentation"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/7.x/set-processor.html", "anchor_text": "set processor"}, {"url": "https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html", "anchor_text": "painless script"}, {"url": "https://newscatcherapi.com/", "anchor_text": "NewsCatcherAPI"}, {"url": "https://www.elastic.co/blog/multilingual-search-using-language-identification-in-elasticsearch", "anchor_text": "Multilingual search using language identification in Elasticsearch"}, {"url": "https://codarium.substack.com/p/designing-an-optimal-multi-language", "anchor_text": "https://codarium.substack.com"}, {"url": "https://medium.com/tag/elasticsearch?source=post_page-----3d2de1b9636d---------------elasticsearch-----------------", "anchor_text": "Elasticsearch"}, {"url": "https://medium.com/tag/software-development?source=post_page-----3d2de1b9636d---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/programming?source=post_page-----3d2de1b9636d---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----3d2de1b9636d---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/data-science?source=post_page-----3d2de1b9636d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&user=Artem&userId=572d20cac11d&source=-----3d2de1b9636d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&user=Artem&userId=572d20cac11d&source=-----3d2de1b9636d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3d2de1b9636d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3d2de1b9636d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3d2de1b9636d--------------------------------", "anchor_text": ""}, {"url": "https://kotartemiy.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://kotartemiy.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Artem"}, {"url": "https://kotartemiy.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "433 Followers"}, {"url": "http://newscatcherapi.com", "anchor_text": "newscatcherapi.com"}, {"url": "http://codarium.substack.com", "anchor_text": "codarium.substack.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F572d20cac11d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&user=Artem&userId=572d20cac11d&source=post_page-572d20cac11d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F615c9b135202&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdesigning-an-optimal-multi-language-search-engine-with-elasticsearch-3d2de1b9636d&newsletterV3=572d20cac11d&newsletterV3Id=615c9b135202&user=Artem&userId=572d20cac11d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}