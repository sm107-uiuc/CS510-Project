{"url": "https://towardsdatascience.com/feature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88", "time": 1683011624.190878, "path": "towardsdatascience.com/feature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88/", "webpage": {"metadata": {"title": "Feature selection and error analysis Roadmap for spatial data analysis | by Jan Majewski | Towards Data Science", "h1": "Feature selection and error analysis Roadmap for spatial data analysis", "description": "Error analysis is one of the key parts while training any ML model. Despite its importance, I have found myself spending far too many hours experimenting with model architecture and hyperparameter\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86", "anchor_text": "https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86", "paragraph_index": 40}], "all_paragraphs": ["Error analysis is one of the key parts while training any ML model. Despite its importance, I have found myself spending far too many hours experimenting with model architecture and hyperparameter tuning before investigating errors made by the algorithm. Efficient error analysis requires combining good knowledge of the input data, algorithms as well as domain knowledge about the problem we are trying to solve.", "Working with spatial data makes structuring error analysis easier as you can extract a lot of insights just by mapping your errors. In this article, I will focus on benchmarking Real Estate prices in Warsaw using Random Forest Regression.", "The key data source consists of around 25k property sale offers from Warsaw with nearly 100 features. During project development, this data was enriched with additional data sources after the need for extra location information has been found during error analysis. I will demonstrate the key stages of the error analysis driven development process.", "The data used can be downloaded from GitHub", "After initial data transformation and basic EDA, which is described in detail within the linked notebook, we end up with a DataFrame called ml_data with 25240 rows and 89 columns.", "Going through nearly 100 features might seem difficult at first, but we can quickly realize that apart from 5 numerical features like Area, building year, number of rooms and floors, the remaining features are 1-hot columns created from numerical data.", "We can see that the basic dataset consists only of property level characteristics similar to BostonHousing or CaliforniaHousing datasets. Initial data misses a detailed description of building location, which in reality is the key price driver.", "The first challenge is how to select the most important features to make the training of the regression model easier and avoid overfitting. Sklearn provides a great function \u2014 SelectKBest to aid us in feature selection. As we are facing a regression problem I chose f_regression scoring function.", "SelectKBest allows us to find top features, which carry most information about variable y, which in our case is unit_price expressed as price per area.", "After several rounds of iteration, I decided to use only features with a f_regression score over 200. While working with initial data there are 33 features passing this threshold.", "As feature selection and error analysis is the key focus of this article, I chose Random Forest Regressor as the best algorithm \u2014 it combines quite good performance with the ability to analyze feature importances. I will be using one model with the same hyperparameters across all interactions for results comparability.", "To avoid overfitting I chose a few regularization hyperparameters \u2014 they could probably be tuned to achieve slightly better results but hyperparameter tuning could be a good material for another article. Please find the model setup below:", "As the key goal of my model is to accurately benchmark real estate prices I aim to get as many properties as possible close to the benchmark. I will analyze the model performance as the share of properties from the test set, for which the absolute percentage error of model forecast was within 5%, 10%, and 25% boundary.", "We can see that the initial model is working quite well \u2014 nearly 2/3 of all properties from the test set were less than 10% off and over 1/3 of predictions were within 5% of actual values.", "District_Downtown feature turned out to be the most important feature, followed by District_Bialoleka. This is quite logical as these two districts are the most expensive and the cheapest in terms of pricing.", "The remaining 8 top features describe key property characteristics such as build year, building type or if the building is from the primary market, which all have significant effect on price.", "Analyzing the error on a map is a useful tool when working with data, where the location is one of the key variables. A good model dealing with spatial data should minimize the correlation between location and error \u2014 it should work well for all areas that we model. If there are obvious spots with over or underestimation it is a clear hint that we are missing some important data.", "Looking on the map of the initial model error, there is one clear trend that quickly becomes apparent. Currently, our model does not see one of the key landmarks shaping the City itself and the prices with it \u2014 the Vistula river.", "Everyone who has spent at least 15 minutes on research on the Warsaw RE market will know, that the districts on the west riverbanks are much more popular and expensive than their eastern counterparts. Analyzing errors made by the model, we can see the majority of blue areas on the West and red areas on the East. This means that the provided data fails to capture, which properties are located on the cheaper east riverside.", "Let\u2019s add just one feature, describing if each district is on the eastern side of the river and see how it affects performance.", "Adding just this one simple feature improved our model performance in each category, with a 1 p.p. increase in the share of properties within only 5% error. East_bank feature also became 4th most important feature in the enriched model.", "This might not sound impressive at first glance, but considering how easy this feature engineering task was, I think that it was actually a lot of Bang for the buck.", "Adding the east bank flag helped to balance errors on both sides of Vistula \u2014 decreasing overestimation area on East and decreasing underestimation areas on the West.", "Now we can see another apparent trend \u2014 most of blue areas where the model is underestimating prices are near the city center, in contrast we can spot the highest overestimating near city outskirts. It seems we are missing some additional data describing the location.", "I figured out that drivetime and commute time to City Center might be the best representation of \u201cgood location\u201d that we seem to be currently missing. I prepared 4 GoogleMaps features extracted from GoogleMaps API:", "All of these 4 features made it past the 200 f_regression score threshold, which together with east_bank feature increased our number of regressors to 38. To be honest they have not only made it past the threshold but also took the top 4 scores with distance_transit doubling the score of ex-leader: district_Downtown.", "Let\u2019s see how more features and higher scores translate into model performance!", "We can see impressive progress on model accuracy with over 10% more properties falling within the lowest error category and improvement in all analyzed segments. It seems we are getting close to producing quite an accurate real estate benchmarking model for Warsaw. Let\u2019s see if the error distribution smoothed out across the whole City.", "We can see a clear improvement in error distribution with the majority of areas being covered by light green (0%-5% error), significant reduction of underestimated areas in the center and decrease in overestimation in the suburbs.", "After zooming in I realized that we have an area with one of highest underestimations on Praga or Saska Kepa to be more precise. Domain knowledge tells me that this is one of the cultural centres of Warsaw with dozens of restaurants, which makes this part of otherwise unpopular Praga district a popular location.", "Could we try adding some Restaurant data from google to capture the price premium for a popular location? This might be quite a long shot but let\u2019s see the results.", "I scrapped information about nearly 3k restaurants in Warsaw and analyzed their popularity, rating and price range to analyze if they can serve as a representation of how popular each block is. I divided Warsaw into a grid of approximately 600 tiles and analyzed what kind of restaurants can be found within 1km from each tile center.", "This allowed me to create the following extra features:", "I must admit that I was a bit surprised to find out that all of these 5 features passed the 200 f_regression score threshold, which leaves us with a total of 43 features. Let\u2019s see how this final round of iteration affects our model performance.", "We can see a decrease in incremental improvement as we are probably getting closer to Bayes Unavoidable Error related to prices in any market not being 100% effective. I still believe that increasing the share of buildings within 5% error to nearly 45% is quite a success.", "In the end, 3 restaurant features made it into the top 10 features. Together with 4 GoogleMaps features this left space only for 3 property-specific characteristics.", "Restaurant data poses the chicken or the egg question as they are probably the effect and not the cause of a popular location. We probably should not use this kind of model to support any theories like \u201cbuilding an extra 20 restaurants should increase local real estate price by 5%\u201d. As long as we use restaurants as a representation of popularity for benchmarking we are still out of the Danger Zone.", "After 4 interactions I am finally satisfied with the current state of model and majority of areas within -10%-10% error. We still have some areas with high errors but they are usually on the outskirts, where we have smaller samples.", "Combining map based error analysis and domain knowledge in any location-driven problem can help steer your project in the right direction and focus your time on getting the additional features or data missing in the initial input.", "If you have read so far I hope my roadmap could be useful on your spatial analysis projects.", "If you are interested in how to create Heatmaps used in this project please read my previous article: https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist passionate about changing complex data into clear stories. Focus on Real Estate and Energy sectors."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa9d38af05b88&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@janekmajewski?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@janekmajewski?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Jan Majewski"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbf80a4208270&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&user=Jan+Majewski&userId=bf80a4208270&source=post_page-bf80a4208270----a9d38af05b88---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/Jan-Majewski/Project_Portfolio/blob/master/03_Real_Estate_pricing_in_Warsaw/03_03_Feature_selection_and_error_analysis.ipynb", "anchor_text": "https://github.com/Jan-Majewski/Project_Portfolio/blob/master/03_Real_Estate_pricing_in_Warsaw/03_03_Feature_selection_and_error_analysis.ipynb"}, {"url": "https://nbviewer.jupyter.org/github/Jan-Majewski/Project_Portfolio/blob/eb4bb8be0cf79cac979d9411b69d5150270550d5/03_Real_Estate_pricing_in_Warsaw/03_03_Feature_selection_and_error_analysis.ipynb", "anchor_text": "https://nbviewer.jupyter.org/github/Jan-Majewski/Project_Portfolio/blob/eb4bb8be0cf79cac979d9411b69d5150270550d5/03_Real_Estate_pricing_in_Warsaw/03_03_Feature_selection_and_error_analysis.ipynb"}, {"url": "https://raw.githubusercontent.com/Jan-Majewski/Project_Portfolio/master/03_Real_Estate_pricing_in_Warsaw/Warsaw_RE_data.xlsx", "anchor_text": "https://raw.githubusercontent.com/Jan-Majewski/Project_Portfolio/master/03_Real_Estate_pricing_in_Warsaw/Warsaw_RE_data.xlsx"}, {"url": "https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86", "anchor_text": "https://towardsdatascience.com/visualizing-spatial-data-with-geojson-heatmaps-1fbe2063ab86"}, {"url": "https://medium.com/tag/real-estate?source=post_page-----a9d38af05b88---------------real_estate-----------------", "anchor_text": "Real Estate"}, {"url": "https://medium.com/tag/feature-selection?source=post_page-----a9d38af05b88---------------feature_selection-----------------", "anchor_text": "Feature Selection"}, {"url": "https://medium.com/tag/error-analysis?source=post_page-----a9d38af05b88---------------error_analysis-----------------", "anchor_text": "Error Analysis"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----a9d38af05b88---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/spatial-analysis?source=post_page-----a9d38af05b88---------------spatial_analysis-----------------", "anchor_text": "Spatial Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&user=Jan+Majewski&userId=bf80a4208270&source=-----a9d38af05b88---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&user=Jan+Majewski&userId=bf80a4208270&source=-----a9d38af05b88---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa9d38af05b88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a9d38af05b88---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a9d38af05b88--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a9d38af05b88--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a9d38af05b88--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@janekmajewski?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@janekmajewski?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jan Majewski"}, {"url": "https://medium.com/@janekmajewski/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "158 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fbf80a4208270&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&user=Jan+Majewski&userId=bf80a4208270&source=post_page-bf80a4208270--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F42906e3e4cdf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffeature-selection-and-error-analysis-while-working-with-spatial-data-a9d38af05b88&newsletterV3=bf80a4208270&newsletterV3Id=42906e3e4cdf&user=Jan+Majewski&userId=bf80a4208270&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}