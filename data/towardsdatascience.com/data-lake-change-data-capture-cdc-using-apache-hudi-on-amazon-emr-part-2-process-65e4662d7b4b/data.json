{"url": "https://towardsdatascience.com/data-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b", "time": 1683015533.4634082, "path": "towardsdatascience.com/data-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b/", "webpage": {"metadata": {"title": "Data Lake Change Data Capture (CDC) using Apache Hudi on Amazon EMR \u2014 Part 2\u2014Process | by Manoj Kukreja | Towards Data Science", "h1": "Data Lake Change Data Capture (CDC) using Apache Hudi on Amazon EMR \u2014 Part 2\u2014Process", "description": "Data Lake Change Data Capture (CDC) using Apache Hudi on Amazon EMR \u2014 Part 2\u2014Process. Easily process data changes over time from your database to Data Lake using Apache Hudi on Amazon EMR."}, "outgoing_paragraph_urls": [{"url": "http://www.datafence.com", "anchor_text": "Datafence Cloud Academy", "paragraph_index": 18}], "all_paragraphs": ["In a previous article below we had discussed how to seamlessly collect CDC data using Amazon Database Migration Service (DMS).", "The following article will demonstrate how to process CDC data such that a near real-time representation of the your database is achieved in your data lake. We will use the combined power of of Apache Hudi and Amazon EMR to perform this operation. Apache Hudi is an open-source data management framework used to simplify incremental data processing in near real time.", "We will kick-start the process by creating a new EMR Cluster", "After creating the EMR cluster logon to the Master Node using SSH and issue the following commands. These commands will copy the Apache Hudi JAR files to S3.", "Now create a new EMR notebook and upload the notebook available at the following location. Upload hudi/hudi.ipynb", "Create a Spark session using the Hudi JAR files uploaded to S3 in the previous step.", "Lets read the CDC files. We will start by reading the full load file.", "Apache Hudi requires a primary key to singularly identify each record. Typically, a sequentially generated primary key is best for this purpose. However our table does not have one. Tosolve this issue let us generate a PK by using a composite of Entity and Year columns. The key column below will be used as the primary key.", "We are now ready to save the data in the Hudi format. Since this is the very first time we are saving this table we will use the \u201cbulk_insert\u201d operation and mode=overwrite. Also notice that we are using the \u201ckey\u201d column as the recordkey.", "We can now read the newly create Hudi table.", "Notice that we have 6282 rows from the full load and data for key India2013. This key will updated in the next operation so it is important to note the history. We will now read the incremental data.", "The incremental data came with 4 rows \u2014 2 rows were Inserted, one row was Updated, and one row is Deleted. We will handle the Inserted and Updated rows first. notice the filter for (\u201cMode IN (\u2018U\u2019, \u2018I\u2019)\u201d) below.", "We are now ready to perform a Hudi Upsert operation for the incremental data. Since this table already exists this time we will use the append option.", "Check the underlying data. Notice that the 2 new rows have been added so the table count has gone up from 6282 to 6284. Also note the row for key India2013 now has been updated for Production & Consumption columns.", "Now we would like to deal with the one Deleted row.", "We can do this with a Hudi Upsert operation but need to use and extra option for deletes hoodie.datasource.write.payload.class=org.apache.hudi.EmptyHoodieRecordPayload", "We can now check the results. Since one row has been deleted the count has gone down from up from 6284 to 6283. Also, the query for the deleted row came back empty. Everything worked as desired.", "All the code used in this article can be found on the link below:", "I hope this article was helpful. CDC using Amazon Database Migration Service is covered as part of the AWS Big Data Analytics course offered by Datafence Cloud Academy. The course is taught online by myself on weekends.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Author, Big Data Engineering, Data Science, Data Lakes, Cloud Computing and IT security specialist."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F65e4662d7b4b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mkukreja1.medium.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Manoj Kukreja"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4076fc16cb6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&user=Manoj+Kukreja&userId=4076fc16cb6a&source=post_page-4076fc16cb6a----65e4662d7b4b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/absolutvision-6158753/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2654130", "anchor_text": "Gino Crescoli"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2654130", "anchor_text": "Pixabay"}, {"url": "https://towardsdatascience.com/data-lake-change-data-capture-cdc-using-amazon-database-migration-service-part-1-capture-b43c3422aad4", "anchor_text": "https://towardsdatascience.com/data-lake-change-data-capture-cdc-using-amazon-database-migration-service-part-1-capture-b43c3422aad4"}, {"url": "https://github.com/mkukreja1/blogs/tree/master/dms", "anchor_text": "mkukreja1/blogsYou can\u2019t perform that action at this time. You signed in with another tab or window. You signed out in another tab or\u2026github.com"}, {"url": "http://www.datafence.com", "anchor_text": "Datafence Cloud Academy"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----65e4662d7b4b---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/data-science?source=post_page-----65e4662d7b4b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/aws?source=post_page-----65e4662d7b4b---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/data?source=post_page-----65e4662d7b4b---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----65e4662d7b4b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&user=Manoj+Kukreja&userId=4076fc16cb6a&source=-----65e4662d7b4b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&user=Manoj+Kukreja&userId=4076fc16cb6a&source=-----65e4662d7b4b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F65e4662d7b4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----65e4662d7b4b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----65e4662d7b4b--------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mkukreja1.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Manoj Kukreja"}, {"url": "https://mkukreja1.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "626 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4076fc16cb6a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&user=Manoj+Kukreja&userId=4076fc16cb6a&source=post_page-4076fc16cb6a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffc0268f00243&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-lake-change-data-capture-cdc-using-apache-hudi-on-amazon-emr-part-2-process-65e4662d7b4b&newsletterV3=4076fc16cb6a&newsletterV3Id=fc0268f00243&user=Manoj+Kukreja&userId=4076fc16cb6a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}