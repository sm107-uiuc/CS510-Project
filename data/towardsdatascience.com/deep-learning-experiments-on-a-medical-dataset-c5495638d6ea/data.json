{"url": "https://towardsdatascience.com/deep-learning-experiments-on-a-medical-dataset-c5495638d6ea", "time": 1683005511.49441, "path": "towardsdatascience.com/deep-learning-experiments-on-a-medical-dataset-c5495638d6ea/", "webpage": {"metadata": {"title": "Intracranial hemorrhage detection using deep learning | by Dipam Vasani | Towards Data Science", "h1": "Intracranial hemorrhage detection using deep learning", "description": "The use of deep learning for medical applications has increased a lot in the last decade. Whether it\u2019s to identify diabetes using retinopathy, predict pnuemonia from Chest X-rays or count cells and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/u/2f12cb08e70?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Prajakta Phadke", "paragraph_index": 0}, {"url": "https://github.com/dipam7/deep_learning_for_healthcare/tree/master/Blindness_detection", "anchor_text": "identify diabetes using retinopathy", "paragraph_index": 1}, {"url": "https://github.com/dipam7/deep_learning_for_healthcare/tree/master/Pneumonia_detection", "anchor_text": "pnuemonia from Chest X-rays", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/image-segmentation-with-fastai-9f8883cc5b53", "anchor_text": "count cells and measure organs using image segmentation", "paragraph_index": 1}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage", "anchor_text": "Github as a sequence of notebooks.", "paragraph_index": 2}, {"url": "https://www.kaggle.com/jhoward/rsna-hemorrhage-jpg", "anchor_text": "Jeremy Howard\u2019s clean dataset", "paragraph_index": 7}, {"url": "https://www.kaggle.com/jhoward/cleaning-the-data-for-rapid-prototyping-fastai", "anchor_text": "notebook", "paragraph_index": 7}, {"url": "https://towardsdatascience.com/data-augmentations-in-fastai-84979bbcefaa", "anchor_text": "apply some transformations on the data", "paragraph_index": 25}, {"url": "https://www.pyimagesearch.com/2019/02/04/keras-multiple-inputs-and-mixed-data/", "anchor_text": "feed both the data to a neural netowork", "paragraph_index": 30}, {"url": "https://towardsdatascience.com/how-do-pretrained-models-work-11fe2f64eaa2", "anchor_text": "Transfer learning has shown good results when it comes to image classification", "paragraph_index": 32}, {"url": "https://www.fast.ai/2020/01/13/self_supervised/", "anchor_text": "there are no pretrained models available", "paragraph_index": 33}], "all_paragraphs": ["This article is co-authored by Prajakta Phadke", "The use of deep learning for medical applications has increased a lot in the last decade. Whether it\u2019s to identify diabetes using retinopathy, predict pnuemonia from Chest X-rays or count cells and measure organs using image segmentation, deep learning is being used everywhere. Datasets are being made freely available for practitioners to build models with.", "In this article, you will learn about a bunch of experiments we conducted while working with brain MRIs. These experiments are available on Github as a sequence of notebooks.", "The reason for numbering the notebooks in this way is to allow others to systematically go through them to see what steps we took, what intermediate results we got and what decisions we made along the way. Instead of providing a final polished notebook, we wanted to show all the work that goes into one project because that\u2019s where the real learning lies.", "The repository also includes useful links to blogs for domain knowledge, research papers and all our trained models. I would recommend everyone to fork this repository and run every notebook themselves, understand what every bit of code does and why it was written how it was written.", "Let\u2019s take a look at each notebook. All of these notebooks were run on Kaggle or Google Colaboratory.", "This notebook contains steps to be followed to download and unzip the data on Google colaboratory. On Kaggle you can access the data directly.", "For this project, we have used Jeremy Howard\u2019s clean dataset. He has a notebook on the steps he performed to clean the data. We replicate some of those steps in our notebook. In general it is a good idea in deep learning to clean the data quickly for rapid prototyping.", "The data is available in the form of dicom files which is the standard extension for medical data. Let\u2019s look at the contents of one of them.", "Along with the image, it contains a bunch of machine recorded meta-data. We can use this metadata to get insights about our scans. Hence we save them in a data frame (since dicoms are too slow to access and use).", "A useful tip to view the head of a data frame with a lot of columns would be to transpose it.", "Now let\u2019s take a look at some of the images.", "We see that we have images of various slices of a person\u2019s brain from the top of his head right down to his teeth. This is how brain scans are performed as a series of slices starting from top and gradually going down. Sometimes the top or the bottom slice can be completely black (a slice before or after the face). Such slices will be useless for our model and should be removed.", "There is a helpful column in the meta-data known as img_pct_window which tells us about the percentage of pixels in the brain window. If we plot this column we get the following graph:", "We see that a lot of images have hardly any pixels in the brain window. Hence we discard such images. If we look at some of the images we are discarding", "we see that they\u2019re the early ones or the latter ones where the teeth start to appear.", "The second step in our data cleaning process is fixing the RescaleIntercept column. Refer to Jeremy\u2019s notebook for more information about this. Finally we center crop (to eliminate background) and resize the images to (256,256). Although high quality images would give a better accuracy, this size is enough for prototyping.", "Now that we\u2019ve cleaned our data, we can explore it a bit. We will be doing the modeling in 2 stages. In stage 1, we only predict whether a person has a bleed or not.", "We start by checking for null values. The labels data frame does not have null values while the metadata dataframe has some columns which are almost completely null. We can safely eliminate these columns.", "We then move on to checking the target variable.", "We have a very balanced dataset. This is usually not the case with medical datasets. They\u2019re usually imbalanced with the number of positive class samples much much less than the number of negative class samples.", "Next, we check the count of each subcategory.", "Subdural seems like the most common type of hemorrhage. One interesting column in the metadata is the \u201cbits stored\u201d column which indicates the number of bits used to store the data. It has two distinct values: 12 and 16.", "This might indicate that the has come from 2 different organizations. In deep learning, it is generally advised to have data from the same distribution. Finally, we can view our images in various windows.", "However, this is only for human perception. A neural network can process floating point data and does not require any windowing.", "The first step in training a good deep learning model is to get enough data. However, that\u2019s not always possible. What is possible though, it to apply some transformations on the data.", "What we do is, instead of feeding the model with the same pictures every time, we do small random transformations (a bit of rotation, zoom, translation, etc\u2026) that doesn\u2019t change what\u2019s inside the image (for the human eye) but changes its pixel values. Models trained with data augmentation will then generalize better.", "In this notebook, we try some of these transformations on our dataset and see if they make sense. Also note that these transformations are only applied on the training set. We apply very minimalistic transformations on the validation set.", "would make sense, however some other transformations might not be useful at all because they wouldn\u2019t resemble the actual data.", "Also note that we\u2019ve already cropped and resized so we won\u2019t be doing those.", "Recent research has shown that metadata can prove useful in image classification. We can either do this by averaging the predictions or feed both the data to a neural netowork.", "To do this, we fisrt try to classify the hemorrhages solely using the metadata to gauge its usefulness. We find that even after using a robust model like Random Forest, we get an accuracy of only 50%. Hence, we decide to discard the metadata and focus on the images itself.", "For our baseline model, we start with a resnet18 as our backbone and attach a custom head to it. Transfer learning has shown good results when it comes to image classification. It gives better results, faster training and reduces resource consumption significantly.", "However, for things like medical images, there are no pretrained models available. Hence we make do with resnet. We train 2 models in this notebook, one with and without pretraining. In both the models, we are able to achieve an accuracy of about 89% in just 5 epochs.", "The batch_size is set to 256. We use Leslie Smith\u2019s learning rate finder to find a good learning rate during training.", "In simple terms, we can run a mock training on our data varying our learning rate from a very low value to a value as high as 10. We then calculate the loss and plot it against the learning rates. We then select a learning rate with the maximum decreasing slope.", "In this case we can select something like 3e-3 since 1e-1 and 1e-2 are on the edge and the loss can shoot up very easily. We can also use a slice for our learning rate, for example 1e-5 to 1e-3 . In this case, different learning rates will be applied to different groups of our network.", "For training, we initally freeze the pretrained part of the model and only train the new head. However, we do update the batchnorm layers of the resnet to maintain a mean of 0 and standard deviation of 1 among every layer.", "A plot of the losses is as shown below.", "We can then show some of the results.", "The red ones are the ones our model misclassified.", "That will be it for now. Before I end this article, I would like to give one very important tip: \u201cDon\u2019t set random seed when training a model, let it train on different datasets every time. It will help you see how robust your model is.\u201d", "This article and project is a work in progress, in the next stage you will see the following notebooks. Till then, happy leanring.", "Visualize which parts of the image your model is focusing on for classification. Move on to classifying the subcategories of the bleeds. An image can have one or more types of bleeds present.", "Since we\u2019ve identified that metadata won\u2019t be really useful for our application, we experiment with various architectures like resnet34, resnet50, alexnet, densenet and so on.", "We also use mixed precison training to lower the training time.", "We use some tricks from the bag of tricks research paper. Things like progressive image resizing. We also experiment with the batch size, we try to increase it as much as possible. A larger batch size gives better updates.", "Test time augmentation, Qure dataset for testing and a simple website for deployment.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc5495638d6ea&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dipam44.medium.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Dipam Vasani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdb5934347fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&user=Dipam+Vasani&userId=db5934347fa&source=post_page-db5934347fa----c5495638d6ea---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://swdic.com/radiology-services/mri-brain.php", "anchor_text": "https://swdic.com/radiology-services/mri-brain.php"}, {"url": "https://medium.com/u/2f12cb08e70?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Prajakta Phadke"}, {"url": "https://github.com/dipam7/deep_learning_for_healthcare/tree/master/Blindness_detection", "anchor_text": "identify diabetes using retinopathy"}, {"url": "https://github.com/dipam7/deep_learning_for_healthcare/tree/master/Pneumonia_detection", "anchor_text": "pnuemonia from Chest X-rays"}, {"url": "https://towardsdatascience.com/image-segmentation-with-fastai-9f8883cc5b53", "anchor_text": "count cells and measure organs using image segmentation"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage", "anchor_text": "Github as a sequence of notebooks."}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/00_setup.ipynb", "anchor_text": "00_setup.ipynb"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/01_data_cleaning.ipynb", "anchor_text": "01_data_cleaning.ipynb"}, {"url": "https://www.kaggle.com/jhoward/rsna-hemorrhage-jpg", "anchor_text": "Jeremy Howard\u2019s clean dataset"}, {"url": "https://www.kaggle.com/jhoward/cleaning-the-data-for-rapid-prototyping-fastai", "anchor_text": "notebook"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/02_data_exploration.ipynb", "anchor_text": "02_data_exploration.ipynb"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/03_data_augmentation.ipynb", "anchor_text": "03_data_augmentation.ipynb"}, {"url": "https://towardsdatascience.com/data-augmentations-in-fastai-84979bbcefaa", "anchor_text": "apply some transformations on the data"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/05_metadata.ipynb", "anchor_text": "05_metadata.ipynb"}, {"url": "https://www.pyimagesearch.com/2019/02/04/keras-multiple-inputs-and-mixed-data/", "anchor_text": "feed both the data to a neural netowork"}, {"url": "https://github.com/dipam7/RSNA_Intracranial-hemorrhage/blob/master/nbs/04_baseline_model.ipynb", "anchor_text": "04_baseline_model.ipynb"}, {"url": "https://towardsdatascience.com/how-do-pretrained-models-work-11fe2f64eaa2", "anchor_text": "Transfer learning has shown good results when it comes to image classification"}, {"url": "https://www.fast.ai/2020/01/13/self_supervised/", "anchor_text": "there are no pretrained models available"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----c5495638d6ea---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c5495638d6ea---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine?source=post_page-----c5495638d6ea---------------machine-----------------", "anchor_text": "Machine"}, {"url": "https://medium.com/tag/programming?source=post_page-----c5495638d6ea---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----c5495638d6ea---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&user=Dipam+Vasani&userId=db5934347fa&source=-----c5495638d6ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&user=Dipam+Vasani&userId=db5934347fa&source=-----c5495638d6ea---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc5495638d6ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c5495638d6ea---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c5495638d6ea--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c5495638d6ea--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c5495638d6ea--------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dipam44.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dipam Vasani"}, {"url": "https://dipam44.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "698 Followers"}, {"url": "https://github.com/dipam7/", "anchor_text": "https://github.com/dipam7/"}, {"url": "https://www.linkedin.com/in/dipam-vasani-734932104/", "anchor_text": "https://www.linkedin.com/in/dipam-vasani-734932104/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdb5934347fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&user=Dipam+Vasani&userId=db5934347fa&source=post_page-db5934347fa--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe16e216bc3bf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-experiments-on-a-medical-dataset-c5495638d6ea&newsletterV3=db5934347fa&newsletterV3Id=e16e216bc3bf&user=Dipam+Vasani&userId=db5934347fa&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}