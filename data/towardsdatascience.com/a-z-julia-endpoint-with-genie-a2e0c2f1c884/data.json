{"url": "https://towardsdatascience.com/a-z-julia-endpoint-with-genie-a2e0c2f1c884", "time": 1683008492.924576, "path": "towardsdatascience.com/a-z-julia-endpoint-with-genie-a2e0c2f1c884/", "webpage": {"metadata": {"title": "A-Z Julia Endpoint With Genie. An introduction to using the Genie\u2026 | by Emma Boudreau | Towards Data Science", "h1": "A-Z Julia Endpoint With Genie", "description": "One of the most important tasks that any aspiring Data-Scientist should be able to accomplish is creating and deploying an end-point. End-points are the back-bone of modern machine-learning, and are\u2026"}, "outgoing_paragraph_urls": [{"url": "http://127.0.0.1:8000/", "anchor_text": "http://127.0.0.1:8000/", "paragraph_index": 21}], "all_paragraphs": ["One of the most important tasks that any aspiring Data-Scientist should be able to accomplish is creating and deploying an end-point. End-points are the back-bone of modern machine-learning, and are the easiest way to translate models into a real production environment. In order to deploy a model at an endpoint, you will first need to select a web-framework to use to create that endpoint. For Python and R, the choice is pretty obvious, and it can be rather easy to find a proper web-framework that will meet your needs.", "Although Julia\u2019s ecosystem certainly isn\u2019t as mature as Python or R\u2019s, Julia does have some interesting options for deploying your models. Firstly, you could always fall back onto PyCall. This will allow you to use Python libraries like Flask and Django to do your deployment instead of having to worry about using a Julia project that is still relatively young compared to those two options. But for those of us with a desire for higher performance, I introduce", "Of course, Genie is rather young compared to other web frameworks, but in my opinion, it brings a lot more interesting ideas to the table that make deploying a model an activity of leisure. Genie is still in version 0.31.1, but you might be surprised just how capable the technology already is. Today I am going to be walking you through everything with Genie from setting up a virtual environment to serializing models and deploying a Genie-based API on Ubuntu.", "For the sake of an example, nothing about a model is really going to matter. Regardless, we are going to be using Lathe to create our model, because unlike many other options, a Lathe model is incredibly easy to serialize and deploy. For today\u2019s example we are going to be using Lathe 0.1.2, but the syntax should remain the same until at least the release of Lathe 1.0. First thing is first, let\u2019s find some data!", "The data-set I decided on was a \u201c Vehicle Dataset\u201d from Kaggle. I chose this one mostly because I am interested in cars. Also, I\u2019ve been especially excited about them because I am about to buy a Del Sol next week. For the car people out there I will just say one thing:", "Back in the world of Data Science, I downloaded our new data-set, and now we can read it in. We will do this using CSV.jl:", "Funny thing about Julia; although DataFrames.jl is a dependency of CSV.jl, it will not be precompiled whenever we import CSV. So in other words, df is of the type DataFrame, which comes from DataFrames.jl, but we can\u2019t use any of the methods associated with this type until we also import DataFrames.", "Though there are certainly other ways to remove your missing values, this is one that works:", "An advantage to using this method is that collect() and skipmissing() are both base methods in the Julia language. That means that they can apply to any type, and even your own types if explicitly imported. Eachrow() is from data-frames, and is just used to turn our df into something that can be iterated across. A disadvantage to this is that we will get an Array of DataFrame rows as a return.", "We can mitigate this by asserting the DataFrame type to this data.", "Skipping ahead, we\u2019re not going to bother about statistical testing, as we don\u2019t really care about accuracy for this example, so next we will go ahead and split our data. To do this we will use TrainTestSplit from Lathe.preprocess. In the unstable version of Lathe we will need to have the at parameter set (the float set to 75 percent), but in any stable version this is not the case.", "Next we will need to decide on a target and a feature. I thought a cool idea for this would be to compare Kms_Driven to Selling_Price. Then I thought maybe the year would be cool, too, so why not just do both of them?", "Now let\u2019s plug those in to get the actual arrays out of the DataFrame:", "Now we will fit two separate Lathe models:", "Now we will test their accuracy both together and separate. For our validation metric, we will be using mean absolute error:", "Let\u2019s see what happens if we combine the two. We will combine the two by averaging all of the predictions in a zip loop:", "Now we\u2019ll compare all of the accuracies:", "As you might have expected, our new feature is bringing down our accuracy ever so slightly because this model doesn\u2019t make any logical decisions on which value to use or prioritize. As a result, we\u2019ll just use the first model, as it has the best accuracy. In order to serialize this model, we are going to use JLD2. Using JLD2, we can use the @save macro to save our model the serialized JLD2 format.", "Now we\u2019ll take that JLD2 file and we will move it to a new directory. I\u2019ll do this in Bash, but of course, you can do this however you want:", "Now we\u2019re going to make a directory for our endpoint.", "Now we will initialize a Genie project. To do this, we will enter the Julia REPL, import Genie, and then finally newapp_webservice() method:", "This will instantiate a new Pkg environment and create a new directory system for our Genie endpoint. It will also start a server, so you can go ahead and visit your localhost (http://127.0.0.1:8000/ by default) and check out your server! These files will not be able to be written to by default, so you will need to adjust the permissions in order to edit them. After that, I moved our model file to our endpoint\u2019s directory, then put it in its own folder called models. Now we just load it back up using JLD2 inside of the routes.jl file generated by Genie:", "Next, we will request a parameter argument from the request, we can do this like so:", "Now we will just predict off of that data, and return the result.", "In order to deploy the model, we will first have to get our files onto our server. To do this you can either use FTP, HTTP (via Git or Wget), or STP. Normally in this scenario, you would use STP, but since I already committed my files to Github, i\u2019ll just git clone it into my /var/www directory on my server.", "Now we have two things to setup:", "For my web-server, I am going to be using NGINX. I use NGINX for basically everything because it has a few advantages over Apache, primarily being that it typically has a better response time. If you need to make a decision, I would suggest going with whichever you are familiar with. If you aren\u2019t familiar with either, go with NGINX because it has easier configurations and in my subjective opinion (as well as by many metrics) is just better. There are certainly advantages to using Apache instead, but I don\u2019t think that you will be missing much by at least starting by trying NGINX.", "What we are going to have to do with our NGINX configuration is create a proxy pass onto the port that our server will be running on, which by default will be 8000. If you are running multiple web-servers on your VPS, then you\u2019ll probably need to use a higher port like 8001 or 8002. The configuration files are stored in /etc/nginx/conf.d, so let\u2019s create a new configuration:", "Here is an example of a configuration for a proxy pass from port 80 (the default HTTP protocol port) to port 8000:", "If this is your first NGINX server, you\u2019ll have to unlink the NGINX default site:", "Next, we will need to setup a supervisor. Like NGINX, the configuration files for supervisor. My server is on Ubuntu, despite my RHEL obsession, so installing supervisor is as easy as", "Now we will create a new configuration.", "The command and directory are the two parameters you should look at here. We are going to source the SH file in bin/server that comes with our Genie endpoint, which will automatically startup a Genie server we can use. We also need the directory to run said command, and that is pretty much it. Now we just need to reload our services:", "And now our endpoint is deployed!", "Julia deployment isn\u2019t too difficult, and has been made easier recently. Whenever I was first getting into Genie, the documentation was absolutely abysmal. That has fortunately changed with time, and now the tool is far easier to use than it ever has before. The Lathe model is also an aspect of this that I think is really cool. Alternatively, you could also deploy a pipeline using Lathe. Here is a tutorial for deploying a pipeline for older versions of Lathe:", "The difference between the old version and the new version is that now pipelines take one parameter:", "So in order to make a pipeline, you would just do:", "So pipeline deployment is definitely viable, and just as well is pretty cool using Lathe in Julia. I\u2019m excited to see just how far this methodology will be able to take machine-learning using Lathe in this aspect, as pipelines are definitely an important part of the DS ecosystem.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa2e0c2f1c884&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://emmettgb.medium.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": ""}, {"url": "https://emmettgb.medium.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Emma Boudreau"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fea170050148c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&user=Emma+Boudreau&userId=ea170050148c&source=post_page-ea170050148c----a2e0c2f1c884---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://julialang.org", "anchor_text": "http://julialang.org"}, {"url": "https://github.com/emmettgb/Emmetts-DS-NoteBooks/blob/master/Julia/DeployingGenie.ipynb", "anchor_text": "notebook"}, {"url": "https://github.com/emmettgb/CarPricePredictor", "anchor_text": "Github repo"}, {"url": "https://www.kaggle.com/nehalbirla/vehicle-dataset-from-cardekho/data#", "anchor_text": "Vehicle dataset from cardekhoUsed Cars and motorcycles datawww.kaggle.com"}, {"url": "http://twitter.com/save", "anchor_text": "@save"}, {"url": "http://127.0.0.1:8000/", "anchor_text": "http://127.0.0.1:8000/"}, {"url": "http://twitter.com/load", "anchor_text": "@load"}, {"url": "http://twitter.com/load", "anchor_text": "@load"}, {"url": "http://twitter.com/params", "anchor_text": "@params"}, {"url": "http://twitter.com/load", "anchor_text": "@load"}, {"url": "http://twitter.com/params", "anchor_text": "@params"}, {"url": "https://github.com/emmettgb/CarPricePredictor", "anchor_text": "https://github.com/emmettgb/CarPricePredictor"}, {"url": "https://towardsdatascience.com/building-pipelines-with-lathe-0-0-7-unstable-in-julia-f7ba1850bde3", "anchor_text": "https://towardsdatascience.com/building-pipelines-with-lathe-0-0-7-unstable-in-julia-f7ba1850bde3"}, {"url": "https://medium.com/tag/julia?source=post_page-----a2e0c2f1c884---------------julia-----------------", "anchor_text": "Julia"}, {"url": "https://medium.com/tag/programming?source=post_page-----a2e0c2f1c884---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a2e0c2f1c884---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a2e0c2f1c884---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/devops?source=post_page-----a2e0c2f1c884---------------devops-----------------", "anchor_text": "DevOps"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&user=Emma+Boudreau&userId=ea170050148c&source=-----a2e0c2f1c884---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&user=Emma+Boudreau&userId=ea170050148c&source=-----a2e0c2f1c884---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa2e0c2f1c884&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a2e0c2f1c884---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a2e0c2f1c884--------------------------------", "anchor_text": ""}, {"url": "https://emmettgb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://emmettgb.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Emma Boudreau"}, {"url": "https://emmettgb.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4.6K Followers"}, {"url": "https://twitter.com/emmettboudgie", "anchor_text": "https://twitter.com/emmettboudgie"}, {"url": "https://github.com/emmettgb", "anchor_text": "https://github.com/emmettgb"}, {"url": "https://ems.computer/", "anchor_text": "https://ems.computer/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fea170050148c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&user=Emma+Boudreau&userId=ea170050148c&source=post_page-ea170050148c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff16bf42bb45f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-z-julia-endpoint-with-genie-a2e0c2f1c884&newsletterV3=ea170050148c&newsletterV3Id=f16bf42bb45f&user=Emma+Boudreau&userId=ea170050148c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}