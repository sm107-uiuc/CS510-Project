{"url": "https://towardsdatascience.com/how-deep-is-their-love-749bc9913c66", "time": 1683007470.4635499, "path": "towardsdatascience.com/how-deep-is-their-love-749bc9913c66/", "webpage": {"metadata": {"title": "How deep is their love?. Machine Learning Greatest Hits\u2026 | by Beverley O'Neill | Towards Data Science", "h1": "How deep is their love?", "description": "We\u2019re talking churn. Nope, not the type that threatens your waistbands or coats your arteries in buttery yumminess. However, this type of churn is life threatening to many businesses if left\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.globalbankingandfinance.com/avoidable-customer-churn-costs-british-businesses-25-billion/", "anchor_text": "British businesses are losing an eye-watering \u00a325bn per year", "paragraph_index": 1}, {"url": "https://spark.apache.org/docs/latest/api/python/index.html", "anchor_text": "PySpark API", "paragraph_index": 4}, {"url": "https://spark.apache.org/docs/2.2.0/api/python/pyspark.ml.html", "anchor_text": "PySpark ML Package", "paragraph_index": 4}, {"url": "https://github.com/bev-o-neill/DSND-p7-Sparkify", "anchor_text": "GitHub repo", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/the-art-of-joining-in-spark-dcbd33d693c", "anchor_text": "Beware of joins!", "paragraph_index": 17}, {"url": "https://machinelearningmastery.com/failure-of-accuracy-for-imbalanced-class-distributions/", "anchor_text": "Not so when the data is imbalanced", "paragraph_index": 22}, {"url": "https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-imbalanced-classification/", "anchor_text": "equivalents for the imbalanced population.", "paragraph_index": 23}, {"url": "https://github.com/bev-o-neill/DSND-p7-Sparkify", "anchor_text": "https://github.com/bev-o-neill/DSND-p7-Sparkify", "paragraph_index": 33}], "all_paragraphs": ["We\u2019re talking churn. Nope, not the type that threatens your waistbands or coats your arteries in buttery yumminess. However, this type of churn is life threatening to many businesses if left unchecked.", "Customer churn, otherwise known as customer attrition, is the number of customers that stop using a company\u2019s product or service over a fixed time period. Losing customers means losing revenue. British businesses are losing an eye-watering \u00a325bn per year in avoidable customer churn. If a business can correctly identify customers that are likely to leave, then they can offer discounts or incentives to mitigate this. Frequently the clues for who is going to leave are within the customer transactional database if you just follow the breadcrumbs in the big data\u2026.", "In this post, we walk through the development of a simple customer churn prediction model for a fictitious company offering a music-streaming service imaginatively called Sparkify. Their business model is the same as their (almost)-namesake\u2019s, Spotify. Users have the choice of two subscription types:", "Users aren\u2019t locked into any membership type, having the opportunity to not only upgrade or downgrade their subscription level any time, but also to cancel it outright. This flexibility naturally comes with great risk: users can and will vote with their feet if they aren\u2019t satisfied with the service.", "Sparkify management is concerned about attrition rates and want to predict which customers are at risk of cancelling their account. We have a sample dataset of the event log, jupyter notebooks, working knowledge of Apache Spark\u2019s PySpark API and PySpark ML Package. What more could a girl want?", "Every activity performed on Sparkify is captured in the event log.", "Been playing Achy Breaky Heart on repeat? That\u2019d be logged. Got a best of Blue playlist on the go? We\u2019d be able to follow that getting created in there. No action, no matter how credible or embarrassing, is left off the list.", "We\u2019ve been given a .json file containing the event log data for October-December 2018. It is made of 286,500 rows and 18 columns detailing the characteristics of the customer and the nature of the action being performed.", "After some simple data inspection and the resulting data cleaning (removing rows that are attributed to a user ID), we are left with 278,154 rows of event data for 225 customers. They sure have been busy!", "To build a predictive model, we have to have something to predict. We define a customer as churned if and only if they have visited the \u201cCancellation Confirmation\u201d page. We use this definition to create a binary flag that will be the target variable for the classification model we develop.", "Note that there is a case to include customers that visited the \u201cSubmit Downgrade\u201d page within our definition. However, these customers were still active after that page event. Free customers still make Sparkify money through advertising. Therefore these customers aren\u2019t as much of a threat to company revenue as those that cancel.", "Caution: Only 52 customers churned: our data is imbalanced. Therefore the metrics we use to evaluate the performance of models built on this data will have to be chosen wisely.", "Equipped with a target variable, we interrogate the data for predictive features for feeding into a machine learning algorithm.", "Some of the above characteristics we\u2019ve looked at aren\u2019t explicitly within the data. Instead, we manipulate the data to create more predictive customer-level features.", "In this vein, we create new features for from the existing ones in the dataset. I built 65 features in total. These can be broadly be categorised as:", "I\u2019ll not go into detail on how this feature engineering is done. You can find those delights in the GitHub repo accompanying this post. However it\u2019s worth highlighting a couple of key tricks for wrangling data with PySpark:", "Here\u2019s a quick starter for ten on how these are used in feature engineering:", "Caution: Beware of joins! For they are subtle and quick to anger. Battered and bruised after too many out-of-memory errors, I just resorted to limiting joins unless completely necessary.", "Before we\u2019re ready for modelling, we have a few final steps to whip our data into shape:", "The PySpark ML package has a number of binary classifier models for us to choose from. We will train five different algorithms to hone in on the best performing one and then run hyperparameter tuning to enhance it further.", "We split the dataset into training (70%) and test (30%), and create a training pipeline (via pyspark.ml.Pipeline) that does the following:", "The results we gathered are given in the table below:", "Metric mayhem: When the classes of the target variable are balanced then you can use accuracy and Gini coefficient with gusto. Not so when the data is imbalanced. In which case they can be inflated and misleading. Have no fear, our skew-superheroes are here!", "Introducing F1 score and area under the precision-recall curve (AUC P-R): Think of these as accuracy and Gini coefficient equivalents for the imbalanced population.", "The table of initial results shows that the random forest is the best all-round: 1st for F1 score, 1st for AUC P-R and fastest to run. Unequivocally the model we should take forward for hyper-parameter tuning to see if we can improve it further.", "Via the ParamGridBuilder class in pyspark.ml.tuning and the CrossValidator class in pyspark.ml.tuning we optimised the random forest by dividing the training dataset using 3-fold cross validation and performing a grid search iterating over all combinations of", "The results we gathered are given in the table below:", "We managed to get an improvement in F1 Score but a degradation in AUC P-R. F1 score is the harmonic mean of precision and recall calculated at a specific threshold. The precision-recall curve is a graphical representation of the interplay between precision and recall across all thresholds. The conclusion we make is that compared to the baseline random forest, the optimised model is better for a specific threshold but actually worse across all thresholds: it is the poorer classifier!", "So what features are the most predictive in our optimised model? The random forest algorithm calculates this and provides a feature_importances property that can be accessed to retrieve the relative importance scores for each input feature. The top ten scores for the optimised model are shown in the following table:", "Broadly these variables correspond to the following:", "On reflection we can see that many of these will be highly correlated, number of weeks registered (weeksRegistered) and number of days registered (daysRegistered). These features should have been removed prior to model development\u2026.which gives a great insight into how iterative the process of building a good model is!", "As we\u2019ve seen, there are a few tweaks we could make to our model build process that would take it from an average B-side track to a firm favourite on the Greatest Hits album.", "So then, who\u2019s ready for a comeback tour?", "If you fancy tinkering under the hood of this model build then please check out my repository on GitHub: https://github.com/bev-o-neill/DSND-p7-Sparkify", "Thanks to Udacity, the roadies, who provided the dataset for us to play with.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F749bc9913c66&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----749bc9913c66--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@oneill.beverley?source=post_page-----749bc9913c66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oneill.beverley?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Beverley O'Neill"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F383346f44ebe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&user=Beverley+O%27Neill&userId=383346f44ebe&source=post_page-383346f44ebe----749bc9913c66---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@swimstaralex?utm_source=medium&utm_medium=referral", "anchor_text": "Alexander Sinn"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.globalbankingandfinance.com/avoidable-customer-churn-costs-british-businesses-25-billion/", "anchor_text": "British businesses are losing an eye-watering \u00a325bn per year"}, {"url": "https://spark.apache.org/docs/latest/api/python/index.html", "anchor_text": "PySpark API"}, {"url": "https://spark.apache.org/docs/2.2.0/api/python/pyspark.ml.html", "anchor_text": "PySpark ML Package"}, {"url": "https://giphy.com/gifs/90s-music-video-vanilla-ice-Jale8dlFc4ASs", "anchor_text": "Giphy"}, {"url": "https://giphy.com/gifs/cute-aww-eyebleach-322FvxfciE8UsYvILG", "anchor_text": "Giphy"}, {"url": "https://github.com/bev-o-neill/DSND-p7-Sparkify", "anchor_text": "GitHub repo"}, {"url": "https://towardsdatascience.com/the-art-of-joining-in-spark-dcbd33d693c", "anchor_text": "Beware of joins!"}, {"url": "https://giphy.com/gifs/black-and-white-music-video-madonna-iqdvmjxie4Zby", "anchor_text": "Giphy"}, {"url": "https://machinelearningmastery.com/failure-of-accuracy-for-imbalanced-class-distributions/", "anchor_text": "Not so when the data is imbalanced"}, {"url": "https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-imbalanced-classification/", "anchor_text": "equivalents for the imbalanced population."}, {"url": "https://github.com/bev-o-neill/DSND-p7-Sparkify", "anchor_text": "https://github.com/bev-o-neill/DSND-p7-Sparkify"}, {"url": "https://medium.com/tag/data-science?source=post_page-----749bc9913c66---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----749bc9913c66---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/spark?source=post_page-----749bc9913c66---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&user=Beverley+O%27Neill&userId=383346f44ebe&source=-----749bc9913c66---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&user=Beverley+O%27Neill&userId=383346f44ebe&source=-----749bc9913c66---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F749bc9913c66&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----749bc9913c66---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----749bc9913c66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----749bc9913c66--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----749bc9913c66--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----749bc9913c66--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----749bc9913c66--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oneill.beverley?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@oneill.beverley?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Beverley O'Neill"}, {"url": "https://medium.com/@oneill.beverley/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "19 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F383346f44ebe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&user=Beverley+O%27Neill&userId=383346f44ebe&source=post_page-383346f44ebe--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F383346f44ebe%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-deep-is-their-love-749bc9913c66&user=Beverley+O%27Neill&userId=383346f44ebe&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}