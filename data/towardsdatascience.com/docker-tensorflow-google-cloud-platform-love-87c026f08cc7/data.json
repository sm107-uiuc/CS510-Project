{"url": "https://towardsdatascience.com/docker-tensorflow-google-cloud-platform-love-87c026f08cc7", "time": 1683005800.592851, "path": "towardsdatascience.com/docker-tensorflow-google-cloud-platform-love-87c026f08cc7/", "webpage": {"metadata": {"title": "Docker + TensorFlow + Google Cloud Platform = Love | by Justin | Towards Data Science", "h1": "Docker + TensorFlow + Google Cloud Platform = Love", "description": "When I first installed TensorFlow with GPU support on my Windows laptop years ago, I was horrified at how complex and fragile the process was. I had to repeat this horrific process when I started\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/GoogleCloudPlatform/cos-gpu-installer", "anchor_text": "this repo", "paragraph_index": 16}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/startup.sh", "anchor_text": "Here", "paragraph_index": 18}, {"url": "https://googlecloudplatform.uservoice.com/forums/302595-compute-engine/suggestions/32030122-ability-to-run-startup-script-only-once", "anchor_text": "here.", "paragraph_index": 27}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/startup.sh", "anchor_text": "startup script", "paragraph_index": 27}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/Dockerfile", "anchor_text": "Here", "paragraph_index": 29}, {"url": "https://embracingtherandom.com/deep-learning/cloud/tensorflow/docker/dockerise-your-tf/", "anchor_text": "https://embracingtherandom.com", "paragraph_index": 47}, {"url": "http://embracingtherandom.com", "anchor_text": "embracingtherandom.com", "paragraph_index": 49}, {"url": "http://linkedin.com/in/justin-m-evans/", "anchor_text": "linkedin.com/in/justin-m-evans/", "paragraph_index": 49}], "all_paragraphs": ["Docker changed my engineering life. I have learnt to love that whale!", "When I first installed TensorFlow with GPU support on my Windows laptop years ago, I was horrified at how complex and fragile the process was. I had to repeat this horrific process when I started dual booting Ubuntu on my laptop. I had to relive my past traumas when I got a GPU for my desktop.", "What if there was an OS-agnostic way of running TensorFlow that would get you up and running in a matter of minutes?", "This is the focus of this post! We will be using a Google Cloud Platform (GCP) Compute Engine VM as our machine. But you could easily replace this VM with your very own laptop/desktop with a NVIDIA GPU.", "Note: I will assume that you have a GCP account and that you have the GCP SDK installed so that you can run GCP commands from your terminal.", "Here\u2019s an overview of the topics that this article will cover:", "When you first get started in GCP, you aren\u2019t allocated a GPU to play with. If you try to make a VM with a GPU with insufficient quota, you\u2019ll get an error telling you that your quota has been exceeded. So let\u2019s fix this right now.", "Go toIAM & Admin -> Quotas.", "In the Metrics dropdown, firstly click None.", "Search for GPUs (all regions) in the text box and click on the result that appeared:", "Tick the box in the list below and then click on EDIT QUOTAS:", "Complete the form that appeared to the right of your screen and make a request for at least one GPU:", "Now we wait for our approval to come through. This should be quick \u2014 I was approved in less than 2 minutes!", "Once we have increased our quota, we can get to building a VM with at least one GPU. To accomplish this, we could either go into Compute Engine in the UI, or we could learn how to use the GCP's Cloud SDK . Let's do the latter!", "Say that we want to create a VM in the zone us-west-1b named deep-docker. Assuming we have installed the Cloud SDK, we can issue this command in our terminal:", "Don\u2019t worry about the metadata-from-file startup-script=... argument for now. We will explore this in the next section.", "Why have we chosen Ubuntu when we can create a VM with a container using gcloud compute instances create-with-container? Good question! This command creates a VM with a Container-Optimized OS based on Chromium OS. It's a lot more complex to install NVIDIA drivers on such a VM, so we make our lives easier by choosing Ubuntu instead. If you're keen to stick with the Container-Optimised OS, then see this repo for a GPU driver installation solution.", "Before we can issue this command, we need to have a startup script present in our current directory. Let\u2019s find out what this startup script is all about!", "Here is the full startup script.", "The startup script takes care of a bunch of tricky things:", "Let\u2019s finally issue our command and wait for our VM to finish building.", "You can track the progress of the startup script by SSH-ing into your machine:", "Once in your VM, issue this and watch your log stream:", "At some point, you should see something like this:", "And this is where you can dance a little celebratory dance. The hardest part of this process is over!", "An issue with our startup script is that it is run each time our VM boots up. If we frequently reboot our VMs, this will get unnecessarily time-consuming.", "One way to make sure that our script is run once only is to remove it from our VM\u2019s metadata using the gcloud CLI:", "Another way to accomplish this is to follow the suggestion from here. This is the approach that I have taken. In the startup script, you will see that most of it is enclosed in an if statement:", "We decide whether to run the body of our startup script based on whether a file named .ran-startup-script exists in a particular location. Upon the first boot, that file does not exist, so the body of the if statement is executed. If all goes well in our first boot of our VM, the .ran-startup-script should get created by the touch line, above. On the second boot onwards, all the time-consuming parts of our startup script won't get executed. We can check /var/log/syslog to confirm that this is the case:", "Here is our Dockerfile. It\u2019s super simple!", "The TensorFlow image we\u2019re using is about 2GB in size. Instead of building our Docker image locally and pushing it to Container Registry from our local machine, we'll take advantage of the power of GCP and build it in the cloud!", "The image that we will be building will be located at gcr.io/GCP_PROJECT_NAME/SOME_IMAGE_NAME. My project is called learning-deeply. I want to call the image tf-2.1.0-gpu. So I will issue this command in my terminal:", "I specify a longer timeout to overcome a timeout issue I was experiencing. Let\u2019s issue our command and watch our build take place!", "We can monitor the progress of our build in the GCP Console\u2019s Cloud Build section:", "Once done, let\u2019s head over to Container Registry section and we should see our beautiful image there!", "This is exciting! I see you rubbing your palms in anticipation. Let\u2019s see if our hard work has paid off.", "Firstly, let\u2019s SSH into our VM (see the startup script section for how to do this).", "Let\u2019s pull our Docker image into our VM! Issue a command similar to this one, replacing the reference to the location of the image with whatever you provided when issuing gcloud builds submit earlier:", "As we have made taken care of Container Registry authentication in our startup script, this should pull your image from Container Registry.", "Next, let\u2019s start up our container. Note that we have a --gpus argument which exposes all of the GPUs on our VM to our container:", "Issue docker ps and we should see our container running!", "Let\u2019s now execute an interactive Bash shell on our container:", "You should see something beautiful like this:", "Now cross your fingers and run this to check if we can access our GPU:", "A bunch of text will be printed. But if you see something like this at the end, you know that you have succeeded, my friends:", "Docker changed the way I work. Not only do I use it for my machine learning work, I also use it for my regular data analysis work and to build my blog.", "If your job title begins with \u201cData\u201d, do yourself a favour and learn to use it. You might also learn to love the whale!", "Originally published at https://embracingtherandom.com on April 13, 2020.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Hello, world! My name is Justin. I solve problems using data. Check me out at embracingtherandom.com and linkedin.com/in/justin-m-evans/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F87c026f08cc7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@eustin.jvans?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Justin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F14d6f9d6ed51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&user=Justin&userId=14d6f9d6ed51&source=post_page-14d6f9d6ed51----87c026f08cc7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/GoogleCloudPlatform/cos-gpu-installer", "anchor_text": "this repo"}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/startup.sh", "anchor_text": "Here"}, {"url": "https://googlecloudplatform.uservoice.com/forums/302595-compute-engine/suggestions/32030122-ability-to-run-startup-script-only-once", "anchor_text": "here."}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/startup.sh", "anchor_text": "startup script"}, {"url": "https://github.com/eustin/docker-tf-gcp/blob/master/Dockerfile", "anchor_text": "Here"}, {"url": "https://embracingtherandom.com/deep-learning/cloud/tensorflow/docker/dockerise-your-tf/", "anchor_text": "https://embracingtherandom.com"}, {"url": "https://medium.com/tag/docker?source=post_page-----87c026f08cc7---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----87c026f08cc7---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----87c026f08cc7---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/gcp?source=post_page-----87c026f08cc7---------------gcp-----------------", "anchor_text": "Gcp"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----87c026f08cc7---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&user=Justin&userId=14d6f9d6ed51&source=-----87c026f08cc7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&user=Justin&userId=14d6f9d6ed51&source=-----87c026f08cc7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F87c026f08cc7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----87c026f08cc7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----87c026f08cc7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----87c026f08cc7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----87c026f08cc7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Justin"}, {"url": "https://medium.com/@eustin.jvans/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "56 Followers"}, {"url": "http://embracingtherandom.com", "anchor_text": "embracingtherandom.com"}, {"url": "http://linkedin.com/in/justin-m-evans/", "anchor_text": "linkedin.com/in/justin-m-evans/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F14d6f9d6ed51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&user=Justin&userId=14d6f9d6ed51&source=post_page-14d6f9d6ed51--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F14d6f9d6ed51%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdocker-tensorflow-google-cloud-platform-love-87c026f08cc7&user=Justin&userId=14d6f9d6ed51&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}