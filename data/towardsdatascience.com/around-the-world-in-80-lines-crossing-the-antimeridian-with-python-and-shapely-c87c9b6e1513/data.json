{"url": "https://towardsdatascience.com/around-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513", "time": 1683015445.6187892, "path": "towardsdatascience.com/around-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513/", "webpage": {"metadata": {"title": "Antimeridian Crossing with Python and Shapely | Towards Data Science", "h1": "Around the World in 80 Lines", "description": "Splitting or cutting GeoJSON polygons crossing the antimeridian (180th meridian or international date line) in Python with Shapely"}, "outgoing_paragraph_urls": [{"url": "https://www.esri.com/about/newsroom/arcnews/five-tech-trends-driving-new-geospatial-development/", "anchor_text": "proliferation of new developments", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/180th_meridian", "anchor_text": "antimeridian", "paragraph_index": 1}, {"url": "https://tools.ietf.org/html/rfc7946#section-3.1.9", "anchor_text": "GeoJSON standard", "paragraph_index": 2}, {"url": "https://gist.github.com/PawaritL/ec7136c0b718ca65db6df1c33fd1bb11", "anchor_text": "Here\u2019s my implementation", "paragraph_index": 4}, {"url": "https://shapely.readthedocs.io/en/stable/manual.html#polygons", "anchor_text": "Shapely Polygon API spec", "paragraph_index": 5}, {"url": "http://esri.github.io/geometry-api-java/doc/Polygon.html", "anchor_text": "each of the Polygon\u2019s rings.", "paragraph_index": 8}, {"url": "https://shapely.readthedocs.io/en/stable/manual.html#shapely.ops.split", "anchor_text": "splitter", "paragraph_index": 12}, {"url": "https://www.linkedin.com/in/pawarit-laosunthara/", "anchor_text": "LinkedIn", "paragraph_index": 16}], "all_paragraphs": ["Thanks to the proliferation of new developments in IoT, transport, logistics, and climate/earth sciences, more and more data analysts/scientists (often familiar with the Python ecosystem) are incorporating geospatial analysis in their problems and workflows.", "While popular Python libraries such as Shapely or GeoPandas often work straight out-of-the-box, I\u2019ve now come across several instances where people commonly run into problems\u00b9 with Cartesian coordinate systems. In particular, if a polygon crosses the antimeridian (aka the 180th meridian) :", "You\u2019re not alone. In fact, even the official GeoJSON standard recognizes this problem and also advocates splitting geometries along the antimeridian. While splitting a LineString should be straightforward enough, this might not be so trivial for challenging polygons that:", "Rest assured \u2014 several tools\u00b2 to tackle this problem do exist. However, I\u2019ll run through a stripped-down and accessible Python implementation that requires only 80 lines of code\u2026excluding docstrings \ud83d\ude05", "TL;DR \u2014 Here\u2019s my implementation of antimeridian-splitting for Polygons (final snippet also provided at the end of the article).", "As mentioned in this article\u2019s title, we will be leveraging Shapely to solve the most hardcore aspects of this problem. Therefore, any geometrical constructions should eventually conform to the Shapely Polygon API spec.", "Here\u2019s an example of an input GeoJSON (as a Python dictionary) to be fed to the final split_polygon function (see bottom of this article):", "We should also lay out some practical assumptions:", "From Assumption 1 above, we can write a super short function to detect whether the antimeridian is crossed. This function will then be applied to consecutive coordinate pairs for each of the Polygon\u2019s rings.", "Step 2: Shifting Vertices to Cartesian Space \u2b05\ufe0f \u27a1\ufe0f", "For each coordinate of each ring: if a crossing is detected, we now perform a shift based on Assumption 2 to ensure that the longitudinal distance between consecutive vertices is always minimized. In this new shifted space, we are allowed to set x-coordinates (i.e. shifted longitudes) outside of the range [-180, +180]. Here\u2019s the basic, *incomplete* skeleton:", "Watch Out, Watch Out: if the boundary (outer shell) of a polygon crosses the antimeridian and is therefore shifted, but any inner ring doesn\u2019t contain any crossings, the resulting shifted geometry may end up corrupt or invalid.", "To address this issue, we need to keep track of the outer shell\u2019s bounds. After performing Step 2 for each inner ring, if any of the respective ring\u2019s coordinates still lie outside the outer shell\u2019s bounds, then an x-component correction of +/- 360 degrees must first be applied to that entire ring. Subsequently, we can now note whether a (shifted) ring overlaps with the line x = -180 or x = 180 . Essentially, this line will serve as our splitter.", "Step 3: Split \u2702\ufe0f and Translate \ud83d\udd19 to Longitude, Latitude", "After all that shifting, we can now:", "\u2026and we\u2019re done! (see the Gists below for the code)", "Hope you find this walkthrough and the implementation below useful. If you have any questions, feedback, or issues, please feel free to get in touch with me via LinkedIn. Thanks for your time!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Strategic Solutions Architect at Databricks. Interested in Responsible/Interpretable Machine Learning"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc87c9b6e1513&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pawarit.laosunthara?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pawarit.laosunthara?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Pawarit Laosunthara"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F775fa6ec85db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&user=Pawarit+Laosunthara&userId=775fa6ec85db&source=post_page-775fa6ec85db----c87c9b6e1513---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.esri.com/about/newsroom/arcnews/five-tech-trends-driving-new-geospatial-development/", "anchor_text": "proliferation of new developments"}, {"url": "https://en.wikipedia.org/wiki/180th_meridian", "anchor_text": "antimeridian"}, {"url": "https://tools.ietf.org/html/rfc7946#section-3.1.9", "anchor_text": "GeoJSON standard"}, {"url": "https://gist.github.com/PawaritL/ec7136c0b718ca65db6df1c33fd1bb11", "anchor_text": "Here\u2019s my implementation"}, {"url": "https://shapely.readthedocs.io/en/stable/manual.html#polygons", "anchor_text": "Shapely Polygon API spec"}, {"url": "https://shapely.readthedocs.io/en/stable/manual.html#shapely.ops.split", "anchor_text": "Shapely\u2019s split operation."}, {"url": "http://esri.github.io/geometry-api-java/doc/Polygon.html", "anchor_text": "each of the Polygon\u2019s rings."}, {"url": "https://geojson.io/", "anchor_text": "https://geojson.io/"}, {"url": "https://shapely.readthedocs.io/en/stable/manual.html#shapely.ops.split", "anchor_text": "splitter"}, {"url": "https://www.linkedin.com/in/pawarit-laosunthara/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/Toblerity/Shapely/issues/495", "anchor_text": "https://github.com/Toblerity/Shapely/issues/495"}, {"url": "https://gis.stackexchange.com/questions/226605/shapely-polygons-crossing-the-antimeridian", "anchor_text": "https://gis.stackexchange.com/questions/226605/shapely-polygons-crossing-the-antimeridian"}, {"url": "https://gis.stackexchange.com/questions/95990/split-a-polygon-that-crosses-international-date-line-arcpy", "anchor_text": "https://gis.stackexchange.com/questions/95990/split-a-polygon-that-crosses-international-date-line-arcpy"}, {"url": "https://www.gplates.org/docs/pygplates/generated/pygplates.DateLineWrapper.html", "anchor_text": "https://www.gplates.org/docs/pygplates/generated/pygplates.DateLineWrapper.html"}, {"url": "https://github.com/briannaAndCo/Leaflet.Antimeridian", "anchor_text": "https://github.com/briannaAndCo/Leaflet.Antimeridian"}, {"url": "https://medium.com/tag/geospatial?source=post_page-----c87c9b6e1513---------------geospatial-----------------", "anchor_text": "Geospatial"}, {"url": "https://medium.com/tag/python?source=post_page-----c87c9b6e1513---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/geopandas?source=post_page-----c87c9b6e1513---------------geopandas-----------------", "anchor_text": "Geopandas"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c87c9b6e1513---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/gis?source=post_page-----c87c9b6e1513---------------gis-----------------", "anchor_text": "GIS"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&user=Pawarit+Laosunthara&userId=775fa6ec85db&source=-----c87c9b6e1513---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&user=Pawarit+Laosunthara&userId=775fa6ec85db&source=-----c87c9b6e1513---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc87c9b6e1513&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c87c9b6e1513---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c87c9b6e1513--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pawarit.laosunthara?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pawarit.laosunthara?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Pawarit Laosunthara"}, {"url": "https://medium.com/@pawarit.laosunthara/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F775fa6ec85db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&user=Pawarit+Laosunthara&userId=775fa6ec85db&source=post_page-775fa6ec85db--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F171e283fe595&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faround-the-world-in-80-lines-crossing-the-antimeridian-with-python-and-shapely-c87c9b6e1513&newsletterV3=775fa6ec85db&newsletterV3Id=171e283fe595&user=Pawarit+Laosunthara&userId=775fa6ec85db&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}