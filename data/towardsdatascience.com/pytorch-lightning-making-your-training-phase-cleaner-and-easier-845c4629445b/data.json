{"url": "https://towardsdatascience.com/pytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b", "time": 1683016987.7521229, "path": "towardsdatascience.com/pytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b/", "webpage": {"metadata": {"title": "PyTorch Lightning: Making your Training Phase Cleaner and Easier | by Fernando L\u00f3pez | Towards Data Science", "h1": "PyTorch Lightning: Making your Training Phase Cleaner and Easier", "description": "PyTorch has become one of the preferred frameworks by industry and academia due to the great flexibility to prototype neural network architectures, as well as a great structure to control each\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.pytorchlightning.ai/", "anchor_text": "PyTorch Lightning", "paragraph_index": 2}, {"url": "https://www.williamfalcon.com/", "anchor_text": "William Falcon", "paragraph_index": 3}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning", "paragraph_index": 5}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/trainer.html", "anchor_text": "documentation", "paragraph_index": 15}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning", "paragraph_index": 16}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning", "paragraph_index": 28}], "all_paragraphs": ["PyTorch has become one of the preferred frameworks by industry and academia due to the great flexibility to prototype neural network architectures, as well as a great structure to control each component of the training phase of a deep learning model. However, sometimes prototyping the training phase of a deep learning model becomes a complex task for various reasons which can cause several mistakes to be made, this is where PyTorch Lightning appears, the PyTorch extension that facilitates and organizes the PyTorch model training phase.", "That is why in this blog we are going to know what PyTorch Lightning is, some of its components and we will see a couple of examples so you can start using PyTorch Lightning now. So this blog will be divided into the following sections:", "PyTorch Lightning is a PyTorch extension for the prototyping of the training, evaluation and testing phase of PyTorch models. Also, PyTorch Lightning provides a simple, friendly and intuitive structure to organize each component of the training phase of a PyTorch model. On the other hand, PyTorch Lightning provides a great variety of functionalities and flags for a detailed customization of the training of our model. In short, PyTorch Lightning came to organize, simplify and compact the components that involve a training phase of a deep learning model such as: training, evaluation, testing, metrics tracking, experiment organization and logs.", "The PyTorch Lightning project was started in 2016 by William Falcon when he was completing his PhD at NYU [1]. Subsequently PyTorch Lightning was launched in March 2019 and made public in July of the same year, it is also in 2019 that PyTorch Lightning was adopted by the NeurIPS Reproducibility Challenge as the standard to send code to such conference [2]. Lightning is an open-source project that currently has more than 180 contributors [3].", "Great, we already know what PyTorch Lightning is, who started the project and why it arises, now let\u2019s move on to the technical details. In the following sections we are going to see a couple of examples using PyTorch Lightning, the first example will explain a basic training with which you can start using Lightning. In the second example we will see how to make use of some of the many amenities that Lightning provides, specifically we will see some important flags, the use of callbacks and how to automatically find the optimal suggested \u201clearning_ rate\u201d as well as the optimal suggested \u201cbatch_size\u201d, so let\u2019s get started!", "If you want to take a look at the complete implementation, I leave you the link to my GitHub repository: https://github.com/FernandoLpz/PyTorch-Lightning", "The objective of this example is to show the basic structure of a training phase in PyTorch Lighting as well as the main and required components to be able to use it. In this example, we are going to create a dummy classification model using the breast cancer dataset (a toy dataset for classification).", "In the above code snnipet we are building a simple neural network with 2 linear layers. It is important to note that we are not extending from \u201cnn.Module\u201d as we would commonly do in a pure PyTorch model, in this case we are extending from \u201cpl.LightningModule\u201d (line 18). Likewise, in the class constructor we are initializing a couple of variables that will make use of the API provided by PyTorch Lightning for the calculation of metrics, in this case the accuracy (lines 26 and 27) \u2014 it is important to mention that the calculation of metrics is can be done in several ways, in this case we will do it this way since it seems to me the most practical way.", "Perfect, so far we have only defined our neural network (all normal for now). From this moment we begin to introduce the elements that are required to compact our training phase with PyTorch Lightning. Therefore, first I would like us to observe the following structure:", "As you can see, the previous structure is the class shown in code snippet 1, only we have added new functions. These functions are what PyTorch Lightning will implement to perform each procedure in a super organized way.", "Important: It is very important to mention that these functions are not the only ones that can be implemented, PyTorch Lightning provides a large number of functions that we can use as best suits us, in this case, for practical reasons we will implement the aforementioned since we will allow to approach in a didactic way the dynamics of training with PyTorch Lightning.", "As we can see, the structure of the class is self-explanatory, that is, in addition to defining the neural network and the forward function, with PyTorch Lightning we can define what we want to be done in each batch execution as well as in each epoch for both the training and validation data, on the other hand, we also observe that the optimizer is isolated, which allows us to have a better organization of each element of the training phase.", "So the real full class will look like:", "As you can see, the content of each function is super simple, this is the practicality, flexibility and cleanliness that we get with PyTorch Lightning. Some important points to note:", "Perfect, until now we have the class that defines our model ready as well as the elements for training, we only need the data to be able to start the training, so let\u2019s go for it!", "As we can see, in lines 2 and 3 we are downloading and splitting the data, in lines 6 to 11 we are transforming the arrays into PyTorch tensors. In lines 14 and 15 as well as 18 and 19, we are using the PyTorch \u201cDatasets\u201d and \u201cDataLoaders\u201d utility. So far everything is normal, the previous steps we would also have done if we were to train a pure PyTorch model. The big difference comes next, in line 22 we initialize our model, as we can see, we are only passing \u201clearning_rate\u201d as a parameter. In line 25 we are starting the \u201cTrainer\u201d of PyTorch Lightning, and this (the Trainer) is the key piece for the training. We can pass a large number of arguments to the \u201cTrainer\u201d in order to have a detailed customization of our training phase (for more options, I leave you the link to the documentation), in this case we are only defining the maximum number of epochs. Finally on line 28 we execute the training phase, for which we pass the model and datasets as arguments, that\u2019s all!", "If you want to take a look at the complete implementation, I leave you the link to my GitHub repository: https://github.com/FernandoLpz/PyTorch-Lightning", "Perfect, with what is explained in this section you can start implementing your training phase with PyTorch Lightning. In the next section we are going to see an example where we do a more detailed customization of the same model, let\u2019s go for it!", "In this example we are going to make some changes with respect to the previous one, specifically we are going to:", "The first important thing that we have to notice is the \u201csetup\u201d function (line 51), this function will be called when the model is in \u201ctraining\u201d or \u201ctesting\u201d mode by passing the respective datasets for each respective stage. On the other hand, it is important to note the use of the \u201cprepare_data\u201d function (line 46), where we basically have to do whatever we need to get our dataset ready. Finally, the handlers of each dataset, basically return the required dataset as an object of a \u201cDataLoader\u201d.", "Well, so far we have already added the functions to manage the datasets within the model class, now let\u2019s see how to use the functionalities that Lightning provides to find the optimal \u201clearning_rate\u201d as well as the optimal \u201cbatch_size\u201d.", "In line 2 we are initializing the model. In line 5 we begin the initialization of the Trainer, as we can see we are making use of some additional parameters which are:", "On the other hand, we define the extension that we will use to search for the optimal learning rate (line 12), for this we pass the following arguments:", "Great! We have everything ready to proceed with the first step, find the optimal learning rate, so if we execute code snippet 5 and visualize the result, we would obtain something like that shown in Figure 2.", "Perfect, we have already obtained our optimal learning rate. Now we will proceed to assign it to our model, as follows:", "Fantastic, what proceeds is to find the optimal batch. This PyTorch Lightning feature refers to the largest batch that can fit the memory of the processor in question. Although it is not necessary for this example, it is important to know that this feature is available and we can make use of it when working with larger datasets. Then, given that in the trainer we define which would be the search process for the optimal batch size, it is only enough to execute the \u201ctune\u201d method of the \u201cTrainer\u201d, as follows:", "This would mean that the optimal batch (or the one that best fits the processor memory) is the batch of size 278 (however, since we are working with a toy dataset, this suggestion this suggestion could be limited by the number of data in our dataset).", "Great! With this we would have already covered our objectives, find the optimal learning rate as well as the optimal batch size, the only thing missing is to train and test as follows:", "If you want to take a look at the complete implementation, I leave you the link to my GitHub repository: https://github.com/FernandoLpz/PyTorch-Lightning", "Congratulations, we have reached the end of this blog!", "In this blog we have introduced PyTorch Lightning as well as its main components. In the same way, we have mentioned the objective that PyTorch Lightning has as an extension of the well-known PyTorch framework.", "On the other hand, we have shown a couple of examples in order to try to show the flexibility, order and clarity that PyTorch Lightning provides us when training a PyTorch model.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer | Data Scientist | Software Engineer"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F845c4629445b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ferneutron.medium.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": ""}, {"url": "https://ferneutron.medium.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Fernando L\u00f3pez"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd606f5d846f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&user=Fernando+L%C3%B3pez&userId=d606f5d846f2&source=post_page-d606f5d846f2----845c4629445b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@noaa?utm_source=medium&utm_medium=referral", "anchor_text": "NOAA"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.pytorchlightning.ai/", "anchor_text": "PyTorch Lightning"}, {"url": "https://www.williamfalcon.com/", "anchor_text": "William Falcon"}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/lightning_module.html#", "anchor_text": "documentation"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/trainer.html", "anchor_text": "documentation"}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning"}, {"url": "https://github.com/FernandoLpz/PyTorch-Lightning", "anchor_text": "https://github.com/FernandoLpz/PyTorch-Lightning"}, {"url": "https://www.pytorchlightning.ai/team", "anchor_text": "https://www.pytorchlightning.ai/team"}, {"url": "https://reproducibility-challenge.github.io/neurips2019/resources/", "anchor_text": "https://reproducibility-challenge.github.io/neurips2019/resources/"}, {"url": "https://github.com/PyTorchLightning/pytorch-lightning", "anchor_text": "https://github.com/PyTorchLightning/pytorch-lightning"}, {"url": "https://pytorch-lightning.readthedocs.io/en/latest/amp.html", "anchor_text": "https://pytorch-lightning.readthedocs.io/en/latest/amp.html"}, {"url": "https://arxiv.org/pdf/1506.01186.pdf", "anchor_text": "https://arxiv.org/pdf/1506.01186.pdf"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----845c4629445b---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/pytorch-lightning?source=post_page-----845c4629445b---------------pytorch_lightning-----------------", "anchor_text": "Pytorch Lightning"}, {"url": "https://medium.com/tag/lightning?source=post_page-----845c4629445b---------------lightning-----------------", "anchor_text": "Lightning"}, {"url": "https://medium.com/tag/pytorch-tutorial?source=post_page-----845c4629445b---------------pytorch_tutorial-----------------", "anchor_text": "Pytorch Tutorial"}, {"url": "https://medium.com/tag/training?source=post_page-----845c4629445b---------------training-----------------", "anchor_text": "Training"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&user=Fernando+L%C3%B3pez&userId=d606f5d846f2&source=-----845c4629445b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&user=Fernando+L%C3%B3pez&userId=d606f5d846f2&source=-----845c4629445b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F845c4629445b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----845c4629445b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----845c4629445b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----845c4629445b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----845c4629445b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----845c4629445b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----845c4629445b--------------------------------", "anchor_text": ""}, {"url": "https://ferneutron.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ferneutron.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Fernando L\u00f3pez"}, {"url": "https://ferneutron.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "537 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd606f5d846f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&user=Fernando+L%C3%B3pez&userId=d606f5d846f2&source=post_page-d606f5d846f2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F14c367392dfa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-lightning-making-your-training-phase-cleaner-and-easier-845c4629445b&newsletterV3=d606f5d846f2&newsletterV3Id=14c367392dfa&user=Fernando+L%C3%B3pez&userId=d606f5d846f2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}