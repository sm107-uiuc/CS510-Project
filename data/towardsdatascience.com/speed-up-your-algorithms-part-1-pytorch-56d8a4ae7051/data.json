{"url": "https://towardsdatascience.com/speed-up-your-algorithms-part-1-pytorch-56d8a4ae7051", "time": 1682993739.5404422, "path": "towardsdatascience.com/speed-up-your-algorithms-part-1-pytorch-56d8a4ae7051/", "webpage": {"metadata": {"title": "Speed Up your Algorithms Part 1 \u2014 PyTorch | by Puneet Grover | Towards Data Science", "h1": "Speed Up your Algorithms Part 1 \u2014 PyTorch", "description": "In this post I will show how to check, initialize GPU devices using torch and pycuda, and how to make your algorithms faster. PyTorch is a Machine Learning library built on top of torch. It is backed\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Torch_(machine_learning)", "anchor_text": "torch", "paragraph_index": 3}, {"url": "https://medium.com/u/7dd01b9c5ed1?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Ilia Karmanov", "paragraph_index": 29}, {"url": "https://medium.com/@iliakarmanov/multi-gpu-rosetta-stone-d4fa96162986", "anchor_text": "here", "paragraph_index": 29}, {"url": "https://github.com/ilkarman/DeepLearningFrameworks", "anchor_text": "here", "paragraph_index": 29}, {"url": "https://pytorch.org/docs/stable/distributed.html", "anchor_text": "here", "paragraph_index": 34}], "all_paragraphs": ["This is the first post in a series I am writing. All posts are here:", "And these goes with Jupyter Notebooks available here:", "In this post I will show how to check, initialize GPU devices using torch and pycuda, and how to make your algorithms faster.", "PyTorch is a Machine Learning library built on top of torch. It is backed by Facebook\u2019s AI research group. After being developed recently it has gained a lot of popularity because of its simplicity, dynamic graphs, and because it is pythonic in nature. It still doesn\u2019t lag behind in speed, it can even out-perform in many cases.", "pycuda lets you access Nvidia\u2019s CUDA parallel computation API from python.", "To check if you have cuda device available using Torch you can simply run:", "To get basic info on devices, you can use torch.cuda. But to get more info on your devices you can use pycuda , a python wrapper around CUDA library. You can use something like:", "I wrote a simple class to get information on your cudacompatible GPU(s):", "To get current usage of memory you can use pyTorch's functions such as:", "And after you have run your application, you can clear your cache using a simple command:", "However, using this command will not free the occupied GPU memory by tensors, so it can not increase the amount of GPU memory available for PyTorch.", "These memory methods are only available for GPUs. And that\u2019s where they are actually needed.", "If you want to store something on cpu, you can simply write:", "This vector is stored on cpu and any operation you do on it will be done on cpu. To transfer it to gpu you just have to do .cuda:", "And this will select the default device for it which can be seen by the command:", "You can also send a Model to the GPU device. For example consider a simple module made from nn.Sequential:", "To send this to GPU device, simply do:", "You can check if it is on GPU device or not, for that you will have to check if its parameters are on GPU or not, like:", "You can select a GPU for your current application/storage which can be different from the GPU you selected for your last application/storage.", "As already seen in part (2) we can get all our cuda compatible devices and their Id's using pycuda, we will not discuss that here.", "Considering you have 3 cuda compatible devices, you can initialize and allocate tensors to a specific device like this:", "When you do any operation on these Tensors, which you can do irrespective of the selected device, the result will be saved on the same device as the Tensor.", "If you have multiple GPUs, you can split your application\u2019s work among them, but it will come with a overhead of communication between them. But if your doesn\u2019t need to relay messages too much, you can give it a go.", "Actually there is one more problem. In PyTorch all GPU operations are asynchronous by default. And though it does make necessary synchronization when copying data between CPU and GPU or between two GPUs, still if you create your own stream with the help of the command torch.cuda.Stream() then you will have to look after synchronization of instructions yourself.", "Giving a example from PyTorch's documentation, this is incorrect:", "If you want to use multiple GPUs to its full potential, you can:", "In data parallelism we split the data, a batch, that we get from Data Generator into smaller mini batches, which we then send to multiple GPUs for computation in parallel.", "In PyTorch data parallelism is implemented using torch.nn.DataParallel.", "But we will see a simple example to see what is going under the hood. And to do that we will have to use some of the functions of nn.parallel, namely:", "I don\u2019t have multiple GPU\u2019s but I was able to find and a great post by Ilia Karmanov here and his github repo comparing most frameworks using multiple GPUs here.", "So, as you can see Parallel Processing definitely helps even if has to communicate with main device in beginning and at the end. And PyTorch is giving results faster than all of them than only Chainer, only in multi GPU case. Pytorch makes it simple too by just one call to DataParallel.", "torch.multiprocessing is a wrapper around Python multiprocessingmodule and its API is 100% compatible with original module. So you can use Queue's, Pipe's, Array's etc. which are in Python\u2019s multiprocessing module here. To add to that, to make it faster they have added a method, share_memory_(), which allows data to go into a state where any process can use it directly and so passing that data as argument to different processes won\u2019t make copy of that data.", "You can share Tensors, model\u2019s parameters, and you can share them on CPU or GPU as you like.", "You can use methods above in \u201cPool and Process\u201d section here, and to get more speedup you can use share_memory_() method to share a Tensor(say) among all processes without being copied.", "You can also work with a cluster of machines. For more info see here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F56d8a4ae7051&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://techelfpuneet.medium.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": ""}, {"url": "https://techelfpuneet.medium.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Puneet Grover"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdfddda6ba487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&user=Puneet+Grover&userId=dfddda6ba487&source=post_page-dfddda6ba487----56d8a4ae7051---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@sutirtab?utm_source=medium&utm_medium=referral", "anchor_text": "sutirta budiman"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/speed-up-your-algorithms-part-1-pytorch-56d8a4ae7051", "anchor_text": "Speed Up your Algorithms Part 1 \u2014 PyTorch"}, {"url": "https://towardsdatascience.com/speed-up-your-algorithms-part-2-numba-293e554c5cc1", "anchor_text": "Speed Up your Algorithms Part 2 \u2014 Numba"}, {"url": "https://towardsdatascience.com/speed-up-your-algorithms-part-3-parallelization-4d95c0888748", "anchor_text": "Speed Up your Algorithms Part 3 \u2014 Parallelization"}, {"url": "https://towardsdatascience.com/speeding-up-your-algorithms-part-4-dask-7c6ed79994ef", "anchor_text": "Speed Up your Algorithms Part 4 \u2014 Dask"}, {"url": "https://github.com/PuneetGrov3r/MediumPosts/tree/master/SpeedUpYourAlgorithms", "anchor_text": "Github-SpeedUpYourAlgorithms"}, {"url": "https://www.kaggle.com/puneetgrover/kernels", "anchor_text": "Kaggle"}, {"url": "https://nbviewer.jupyter.org/github/PuneetGrov3r/MediumPosts/blob/master/SpeedUpYourAlgorithms/1%29%20PyTorch.ipynb", "anchor_text": "SpeedUpYourAlgorithms-Pytorch"}, {"url": "https://en.wikipedia.org/wiki/Torch_(machine_learning)", "anchor_text": "torch"}, {"url": "https://unsplash.com/@srz?utm_source=medium&utm_medium=referral", "anchor_text": "sydney Rae"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@rawpixel?utm_source=medium&utm_medium=referral", "anchor_text": "rawpixel"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@nate_dumlao?utm_source=medium&utm_medium=referral", "anchor_text": "Nathan Dumlao"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://discuss.pytorch.org/t/how-to-check-if-model-is-on-cuda/180", "anchor_text": "discuss.pytorch.org/t/how-to-check-if-model-is-on-cuda"}, {"url": "https://unsplash.com/@neonbrand?utm_source=medium&utm_medium=referral", "anchor_text": "NeONBRAND"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@akeenster?utm_source=medium&utm_medium=referral", "anchor_text": "Abigail Keenan"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://unsplash.com/@icons8?utm_source=medium&utm_medium=referral", "anchor_text": "Icons8 team"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/u/7dd01b9c5ed1?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Ilia Karmanov"}, {"url": "https://medium.com/@iliakarmanov/multi-gpu-rosetta-stone-d4fa96162986", "anchor_text": "here"}, {"url": "https://github.com/ilkarman/DeepLearningFrameworks", "anchor_text": "here"}, {"url": "https://unsplash.com/@mjhphotography?utm_source=medium&utm_medium=referral", "anchor_text": "Matthew Hicks"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://pytorch.org/docs/stable/distributed.html", "anchor_text": "here"}, {"url": "https://documen.tician.de/pycuda/", "anchor_text": "https://documen.tician.de/pycuda/"}, {"url": "https://pytorch.org/docs/stable/notes/cuda.html", "anchor_text": "https://pytorch.org/docs/stable/notes/cuda.html"}, {"url": "https://discuss.pytorch.org/t/how-to-check-if-model-is-on-cuda", "anchor_text": "https://discuss.pytorch.org/t/how-to-check-if-model-is-on-cuda"}, {"url": "https://pytorch.org/tutorials/beginner/blitz/data_parallel_tutorial.html#sphx-glr-beginner-blitz-data-parallel-tutorial-py", "anchor_text": "https://pytorch.org/tutorials/beginner/blitz/data_parallel_tutorial.html"}, {"url": "https://medium.com/@iliakarmanov/multi-gpu-rosetta-stone-d4fa96162986", "anchor_text": "https://medium.com/@iliakarmanov/multi-gpu-rosetta-stone-d4fa96162986"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----56d8a4ae7051---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----56d8a4ae7051---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/parallel-computing?source=post_page-----56d8a4ae7051---------------parallel_computing-----------------", "anchor_text": "Parallel Computing"}, {"url": "https://medium.com/tag/cuda?source=post_page-----56d8a4ae7051---------------cuda-----------------", "anchor_text": "Cuda"}, {"url": "https://medium.com/tag/data-science?source=post_page-----56d8a4ae7051---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "http://creativecommons.org/licenses/by/4.0/", "anchor_text": "Some rights reserved"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&user=Puneet+Grover&userId=dfddda6ba487&source=-----56d8a4ae7051---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&user=Puneet+Grover&userId=dfddda6ba487&source=-----56d8a4ae7051---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F56d8a4ae7051&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----56d8a4ae7051---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----56d8a4ae7051--------------------------------", "anchor_text": ""}, {"url": "https://techelfpuneet.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://techelfpuneet.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Puneet Grover"}, {"url": "https://techelfpuneet.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "408 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdfddda6ba487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&user=Puneet+Grover&userId=dfddda6ba487&source=post_page-dfddda6ba487--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8beb028904ce&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fspeed-up-your-algorithms-part-1-pytorch-56d8a4ae7051&newsletterV3=dfddda6ba487&newsletterV3Id=8beb028904ce&user=Puneet+Grover&userId=dfddda6ba487&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}