{"url": "https://towardsdatascience.com/serverless-building-your-own-router-c2ca3071b2ec", "time": 1683004410.870547, "path": "towardsdatascience.com/serverless-building-your-own-router-c2ca3071b2ec/", "webpage": {"metadata": {"title": "Serverless: Building Your Own Router | by Anuradha Wickramarachchi | Towards Data Science", "h1": "Serverless: Building Your Own Router", "description": "In my previous article, I presented how to develop a boilerplate to support an AWS lambda deployment. In this article, I will present how we can develop a proper lambda router for a REST API. This is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/serverless-a-painless-aws-boilerplate-e5ec3b4fb609", "anchor_text": "previous article", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/serverless-a-painless-aws-boilerplate-e5ec3b4fb609", "anchor_text": "Read here", "paragraph_index": 11}, {"url": "https://medium.com/@anuradhawick/understanding-aws-cognito-and-iam-roles-af2dfefef996", "anchor_text": "Read more from here", "paragraph_index": 13}, {"url": "https://github.com/anuradhawick/aws-lambda-serverless-boilerplate", "anchor_text": "GitHub", "paragraph_index": 22}], "all_paragraphs": ["In my previous article, I presented how to develop a boilerplate to support an AWS lambda deployment. In this article, I will present how we can develop a proper lambda router for a REST API. This is an important step in the development of a scalable AWS lambda instance.", "It is a common workaround that people would deploy a fully-fledged NodeJS HTTP server inside the lambda. However, in an ideal scenario, we should avoid doing so since it imparts delays inside a lambda function. Furthermore, we would definitely miss out on the API gateway\u2019s sole purpose and features like authentication and authorization.", "In this case, we will implement a simple router that does not start a separate server but will utilize lambda proxy implementation headers for navigating requests to our implemented function logic. Through this approach, we will have instant routing of requests as lambdas are invoked.", "The default deployment using the serverless framework would deploy lambdas via the Lambda Proxy Integration.", "The lambdas consist of functions with the three parameters event, context, and callback. The event object has all the useful information including the request body, path parameters, query parameters, request path, source, cookie information, headers, and other request parameters. In the proxy integration, our lambdas act similar to that of Nginx router (where we have all rewrite rules, forwardings, static file renderings, etc). We would exploit this information from the event object to build our router. First, let us have a look at the event object.", "Observing the event object, we can clearly note the following two main useful attributes.", "This is basically what we need for pure routing. Which path of which method should be forwarded to the target function. This is simply analogous to a switch case. But the switch case should have few more facilities including response building and handling different kinds of request methods.", "The router will have to be consistent with the AWS function call, i.e. use event, context, and callback as parameters.", "In classic javascript, classes are emulated using functions. Thus in this example, I will proceed with a function considering the naive scenario (which is usually the preferred mean in Lambdas).", "We will implement a function named Router which will accept event, context and callback as parameters (analogous to constructor attributes). Within this, we can have a function to call the relevant handler assigned to a method and a path. Let\u2019s have a look at how our code would look.", "You could also see that I have another function as builResponse . This takes care of building a response, stringifying body and assigning the status code. This would just make things much simpler as you will see in the next code snippet on how to use the router.", "Now that we have implemented the router, let us have a look as to how we might use it. In the below code I will present how we can ask the router to handle GET requests on paths data and data/{taskId}. As you can see the second path is a path template. Routing will have to be done relative to the service determined by the service\u2019s service.yml file. I have discussed this in my previous article (Read here). If you have only one serverless.yml file for the entire program, you can use the complete path ignoring my previous sentence.", "You can see that we can use the router and pass a handler function with the same parameters as we get from the lambda invocation. We must call the callback function with error and response values. However, we are returning errors in the form of HTTP status codes. Therefore, the error parameter will always be null.", "An application is basically useless without proper access control. The authentication is where you grant access to API endpoints having the identity of the user. Authorization is ensuring that tasks are done by those who have the proper rights to do so. Authentication is best done using the Cognito user pool where each user\u2019s header is validated against the user pool (Read more from here). This will allow the requests with the valid tokens to reach lambda invocations.", "More fine-grained control is needed where you have roles and roles have authority to perform specific actions. In other words, headers must be validated to check the authority of the token bearer. This can be done using Cognito user groups. These can be easily created from Cognito console. Following are a few groups from a real-world application. You can see an Admin group.", "These groups can be created to assign specific roles to users. One user may be assigned to multiple groups. Note that these groups can be created on the fly using the AWS SDK and there is no need to visit this UI.", "Validating Roles from the Lambda Event Object", "These roles we have assigned must be validated in our router, where we actually implement the role-based access. We could perform this using IAM roles in AWS. However, this method is more complicated and is more suited for limiting access for AWS resources; i.e. S3 buckets, User pool, etc. Therefore, we will implement our role-based access at the router level inside lambda in order to manipulate access to the database and other resources.", "The event object will have authorization attributes in the path event.requestContext.authorizer.claims. This object will have an attribute under the name cognito:groups. This will either be an array or a value matching the groups or the group the person would belong to. This value can be used to implement our authorization.", "This can simply be added as an extension to our route function of the router. Let us have a look at the modification.", "You could see that I have checked whether cognito:groups is an array or not. I had to do this due to a mismatch of serverless offline emulation and the actual lambda behaviour. Anyway, it makes the function more strong against possible errors. Our route function call will simply have an additional parameter, roles array. That's all!. For example;", "Now you have a complete lambda router that you can just import and use. There are no server instances inside lambdas or heavy code handling routes. This is one big switch case which sort of follows the \u201cChain of responsibilities\u201d design pattern. In each function call, if the function call is responsible for the given Method and Path, handle them, or ignore.", "This router design was a result of our effort at a startup and I have been improving bits and pieces of the initial design to fit newer needs. The complete boilerplate is available in GitHub.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc2ca3071b2ec&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://anuradhawick.medium.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": ""}, {"url": "https://anuradhawick.medium.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Anuradha Wickramarachchi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fddf633dcad17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&user=Anuradha+Wickramarachchi&userId=ddf633dcad17&source=post_page-ddf633dcad17----c2ca3071b2ec---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/serverless-a-painless-aws-boilerplate-e5ec3b4fb609", "anchor_text": "previous article"}, {"url": "https://aws.amazon.com/api-gateway/", "anchor_text": "AWS API Gateway Architecture"}, {"url": "https://towardsdatascience.com/serverless-a-painless-aws-boilerplate-e5ec3b4fb609", "anchor_text": "Read here"}, {"url": "https://medium.com/@anuradhawick/understanding-aws-cognito-and-iam-roles-af2dfefef996", "anchor_text": "Read more from here"}, {"url": "https://github.com/anuradhawick/aws-lambda-serverless-boilerplate", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/serverless?source=post_page-----c2ca3071b2ec---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/aws?source=post_page-----c2ca3071b2ec---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----c2ca3071b2ec---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/tag/programming?source=post_page-----c2ca3071b2ec---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----c2ca3071b2ec---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&user=Anuradha+Wickramarachchi&userId=ddf633dcad17&source=-----c2ca3071b2ec---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&user=Anuradha+Wickramarachchi&userId=ddf633dcad17&source=-----c2ca3071b2ec---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc2ca3071b2ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c2ca3071b2ec---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c2ca3071b2ec--------------------------------", "anchor_text": ""}, {"url": "https://anuradhawick.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://anuradhawick.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Anuradha Wickramarachchi"}, {"url": "https://anuradhawick.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2K Followers"}, {"url": "https://anuradhawick.com/", "anchor_text": "https://anuradhawick.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fddf633dcad17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&user=Anuradha+Wickramarachchi&userId=ddf633dcad17&source=post_page-ddf633dcad17--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9f8ac7ab9f5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fserverless-building-your-own-router-c2ca3071b2ec&newsletterV3=ddf633dcad17&newsletterV3Id=9f8ac7ab9f5b&user=Anuradha+Wickramarachchi&userId=ddf633dcad17&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}