{"url": "https://towardsdatascience.com/how-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314", "time": 1683009148.722398, "path": "towardsdatascience.com/how-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314/", "webpage": {"metadata": {"title": "How to configure IAM roles for Fargate Tasks on AWS | by Timo B\u00f6hm | Towards Data Science", "h1": "How to configure IAM roles for Fargate Tasks on AWS", "description": "IAM roles and policies on AWS are huge topics. This blog post explains the basics and helps you grasping them with a concrete implementation."}, "outgoing_paragraph_urls": [{"url": "https://blog.codecentric.de/en/2020/06/cost-effective-batch-jobs-on-aws-serverless-infrastructure/", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://github.com/timo-boehm/serverless_batch_aws", "anchor_text": "public code repository", "paragraph_index": 1}, {"url": "https://blog.codecentric.de/en/2020/06/cost-effective-batch-jobs-on-aws-serverless-infrastructure/", "anchor_text": "the conceptual post", "paragraph_index": 33}, {"url": "https://github.com/timo-boehm/serverless_batch_aws", "anchor_text": "public code repository", "paragraph_index": 33}, {"url": "https://towardsdatascience.com/network-configurations-for-fargate-tasks-6333314c4001", "anchor_text": "a blog post about that", "paragraph_index": 33}, {"url": "https://twitter.com/timo_data", "anchor_text": "Twitter", "paragraph_index": 34}, {"url": "https://www.linkedin.com/in/timo-boehm-datascience/", "anchor_text": "LinkedIn", "paragraph_index": 34}], "all_paragraphs": ["This blog post is one of three technical deep-dives about a specific type of architecture for serverless batch jobs on AWS. If you want to know more about the background of this cloud setup, go here for more details. The overall picture of the implemented service looks like this:", "In short, the architecture consists of one block of components for development and another one for executing a batch job. For this blog post, we focus only on the roles and policies of this architecture. There is also a public code repository that allows you to reproduce the full service and all its parts based on Cloudformation scripts.", "When we talk about roles and policies, we talk about Identity and Access Management (IAM). It constitutes the main security block of every AWS cloud architecture. IAM restricts which entity can do what within a given cloud environment. For this blog post, you need to understand two concepts: roles and policies.", "When users or services want to do something in the cloud, they assume roles. When you specify a role, you can limit the type of entity that can use it. For instance, you can define a role for human users that allows them to see everything but change nothing. If an AWS service tries to use that role, it fails. Think about roles as an organizational umbrella for what a user or service can do within your cloud environment.", "Policies, in contrast, list the specific actions a role can perform. In the same way that roles restrict which entity can assume them, policies restrict which resources they can use.", "When you design your roles and policies, stick to the principle of least privilege. That is, only allow access and actions that services need. Any extension beyond that is a potential security issue. For example, if a service needs to write data to an S3 bucket, you should not implement a policy that allows all S3 actions.", "Before we move on to the big picture, let\u2019s start with a small primer to CloudFormation scripts. If you already have experience with CloudFormation \u2014 or similar concepts \u2014 you can skim or skip the next three paragraphs.", "CloudFormation is the AWS service for Infrastructure as Code. That is, you define a target infrastructure, push it to AWS, and AWS provisions it for you. You organize your resources in so-called stacks, which make it very easy to adjust, monitor, or delete them.", "You can write CloudFormation scripts in JSON or YAML files. All examples here and in the code repository are YAML files, but you could do the same thing in JSON.", "There is also a set of CloudFormation specific commands available to you. In the upcoming examples, I use three of them:", "From a role and policy perspective, we have to consider both component blocks of the service. For each part, we need to identify which services need to interact with other services. Services without outgoing interactions, such as S3 or a code repository, can be left as such. Services that require engagement with other components need policies that allow them to do that.", "For the development components, we need to make sure that we can build a container image and push it to the registry. For the batch job components, we need to make sure that the trigger can run the most recent container image from the registry.", "To avoid abstract ruminations, let\u2019s dive into the implementation details. I provide an overview figure for each building block so that you can follow along visually.", "As mentioned before, roles are the organizational umbrella for policies. For the sake of simplicity, each role in this example relates to precisely one policy. Before we look at each policy, let me walk you through the two main properties of roles:", "Here is what it looks like in CloudFormation with the CodeBuild role as an example:", "It is best practice to define one role for each component of your architecture. Technically, you can embed policies into your role definition. However, it is easier to read and to maintain if you create a separate policy resource.", "There are two services involved in the development workflow: CodePipeline and CodeBuild. CodePipeline is an orchestration tool that triggers the CodeBuild project whenever developers push a new version of the master branch to the code repository.", "First, let\u2019s look at the CodePipeline. In our scenario, the service needs to interact with three services:", "Here\u2019s how CodePipeline\u2019s role and the associated policy look like in CloudFormation:", "Note: For simplicity, I did not restrict the resources in this and the following examples. In a real-world implementation, the principle of least-privilege demands that you minimize the accessed resources, too!", "Second, there is CodeBuild. It involves four different services.", "The last point is optional, but I promise that you regret it if you leave it out. The corresponding CloudFormation scripts look like this:", "The two roles for the development components should be pretty self-explanatory. Well, things get a little bit more complicated now.", "We are now left to define roles and policies for the batch job. That is, for the Fargate task and the CloudWatch rule that triggers it. Let\u2019s start with the slightly confusing one first: the Fargate task.", "Although one box represents the Fargat task in the architectural diagram, it requires two roles. Think about your relationship with your boss. Your boss has the authority to assign a task to you. You need the tools to carry out the assigned job. That\u2019s what you need for Fargate, too. One execution role, aka a \u201cboss role\u201d and a task role, aka an \u201cemployee role.\u201d", "The execution role comprises access to two services:", "Here\u2019s how the execution role and its policy look like in CloudFormation:", "The vital policies for the task role depend on what developers put into the container image. That is, without knowing what the developers implemented, you can not decide on the correct set of policies. Let\u2019s assume that the task loads some data from S3, transforms it, and writes it back to another bucket. In this simple case, you need to configure two services for the task role:", "Have a look at the CloudFormation specification for details:", "Again, the specific resources and actions depend entirely on the implemented business logic within the container image.", "Finally, there is the CloudWatch rule, which triggers the batch job. Its role and policy is straightforward again and concerns two services:", "A natural question to ask at this point: why are there several places, e.g., to allow access to CloudWatch logs? Why not define one policy for logging and attach it to all roles that need it?", "There is one primary reason to avoid that: shared policies add dependencies between resources. These dependencies can come back to bite you later on. If you change a policy that is assumed by several roles, you might break stuff without even realizing it.", "I hope this post helped you to understand better how to think about and build IAM roles and policies. Again, if you want to know more about the architecture, refer to the conceptual post. If you\u2019re going to rebuild it, have a look at the public code repository. Also, there will be one more post shortly that extends this discussion to the specific building blocks for the whole service. If you are more interested in the network aspects of such a service, I already wrote a blog post about that.", "Let me know your thoughts and experiences in the comments. I am also happy to connect on Twitter and LinkedIn. Thank you for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Principal consultant working in the intersection of business agility, data and cloud."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F76ad54f11314&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----76ad54f11314--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@timoboehm?source=post_page-----76ad54f11314--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@timoboehm?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Timo B\u00f6hm"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F19880a76e030&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&user=Timo+B%C3%B6hm&userId=19880a76e030&source=post_page-19880a76e030----76ad54f11314---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://blog.codecentric.de/en/2020/06/cost-effective-batch-jobs-on-aws-serverless-infrastructure/", "anchor_text": "here"}, {"url": "https://github.com/timo-boehm/serverless_batch_aws", "anchor_text": "public code repository"}, {"url": "https://blog.codecentric.de/en/2020/06/cost-effective-batch-jobs-on-aws-serverless-infrastructure/", "anchor_text": "the conceptual post"}, {"url": "https://github.com/timo-boehm/serverless_batch_aws", "anchor_text": "public code repository"}, {"url": "https://towardsdatascience.com/network-configurations-for-fargate-tasks-6333314c4001", "anchor_text": "a blog post about that"}, {"url": "https://twitter.com/timo_data", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/timo-boehm-datascience/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/aws?source=post_page-----76ad54f11314---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/programming?source=post_page-----76ad54f11314---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/cloud-computing?source=post_page-----76ad54f11314---------------cloud_computing-----------------", "anchor_text": "Cloud Computing"}, {"url": "https://medium.com/tag/infrastructure-as-code?source=post_page-----76ad54f11314---------------infrastructure_as_code-----------------", "anchor_text": "Infrastructure As Code"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----76ad54f11314---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&user=Timo+B%C3%B6hm&userId=19880a76e030&source=-----76ad54f11314---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&user=Timo+B%C3%B6hm&userId=19880a76e030&source=-----76ad54f11314---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F76ad54f11314&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----76ad54f11314---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----76ad54f11314--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----76ad54f11314--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----76ad54f11314--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----76ad54f11314--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----76ad54f11314--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@timoboehm?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@timoboehm?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Timo B\u00f6hm"}, {"url": "https://medium.com/@timoboehm/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "676 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F19880a76e030&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&user=Timo+B%C3%B6hm&userId=19880a76e030&source=post_page-19880a76e030--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2113dda7429d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-configure-iam-roles-for-fargate-tasks-on-aws-76ad54f11314&newsletterV3=19880a76e030&newsletterV3Id=2113dda7429d&user=Timo+B%C3%B6hm&userId=19880a76e030&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}