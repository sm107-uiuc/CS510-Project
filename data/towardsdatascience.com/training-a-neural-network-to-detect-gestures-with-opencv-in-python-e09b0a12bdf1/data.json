{"url": "https://towardsdatascience.com/training-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1", "time": 1682994252.384937, "path": "towardsdatascience.com/training-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1/", "webpage": {"metadata": {"title": "Training a Neural Network to Detect Gestures with OpenCV in Python | by Brenner Heintz | Towards Data Science", "h1": "Training a Neural Network to Detect Gestures with OpenCV in Python", "description": "You can find the code in the Github project repository here, or view the final presentation slides here. Imagine that you\u2019re hosting a birthday party for a loved one. Everyone\u2019s having a great time\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/athena15/project_kojak", "anchor_text": "code in the Github project repository here", "paragraph_index": 0}, {"url": "https://docs.google.com/presentation/d/1UY3uWE5sUjKRfV7u9DXqY0Cwk6sDNSalZoI2hbSD1o8/edit?usp=sharing", "anchor_text": "final presentation slides here", "paragraph_index": 0}, {"url": "https://www.kaggle.com/benenharrington/hand-gesture-recognition-database-with-cnn", "anchor_text": "Kaggle.com", "paragraph_index": 3}, {"url": "https://github.com/studioimaginaire/phue", "anchor_text": "phue", "paragraph_index": 24}, {"url": "https://github.com/SoCo/SoCo", "anchor_text": "SoCo", "paragraph_index": 24}, {"url": "https://twitter.com/brennerheintz", "anchor_text": "Twitter here", "paragraph_index": 28}, {"url": "http://linkedin.com/in/brennerheintz", "anchor_text": "LinkedIn here", "paragraph_index": 28}, {"url": "https://databricks.com/discover/data-lakes/introduction", "anchor_text": "this page explaining data lakes", "paragraph_index": 28}, {"url": "https://databricks.com/blog/author/brenner-heintz", "anchor_text": "Databricks blog", "paragraph_index": 28}], "all_paragraphs": ["You can find the code in the Github project repository here, or view the final presentation slides here.", "Imagine that you\u2019re hosting a birthday party for a loved one. Everyone\u2019s having a great time, music\u2019s playing, and the party is noisy. Suddenly, it\u2019s time for birthday cake! It\u2019s too loud to use Alexa, and rather than hunting for your phone or a remote control, what if you could simply raise an open hand while in mid-conversation, your smart home device would recognize that gesture, and turn off the music? And with the same gesture, you could dim the lights \u2014 just in time to see the birthday candles light up the face of the birthday boy or girl. Wouldn\u2019t that be amazing?", "I\u2019ve been curious about gesture detection for a long time. I remember when the first Microsoft Kinect came out \u2014 I had an absolute blast playing games and controlling the screen with just a wave of the hand. As time went on and devices like Google Home and Amazon Alexa were released, it seemed that gesture detection fell of the radar in favor of voice. Still, I wondered whether it was likely to experience a renaissance, now that video devices like the Facebook Portal and Amazon Echo Show are coming out. With this in mind, I wanted to see if it was possible to build a neural network that could recognize my gestures in real time \u2014 and operate my smart home devices!", "I was excited about this idea and moved quickly to implement it, like I\u2019d been shot out of a cannon. I started working with a hand gesture recognition database on Kaggle.com, and exploring the data. It consists of 20,000 labeled hand gestures, like the ones found below.", "Once I read the images in, the first problem I ran into was that my images were black & white. This means the NumPy arrays have only one channel, instead of three (i.e., the shape of each array is (224, 224, 1)). As a result, I was unable to use these images with the VGG-16 pre-trained model, as that model requires an RGB, 3-channel image. This was solved by using np.stack on the list of images, X_data:", "Once I got through that hurdle, I set about building a model, using a train-test split that completely held out photos from 2 of the 10 individuals in them. After re-running the model built on the VGG-16 architecture, my model achieved an F1 score of 0.74 overall. This was quite good, given that random guessing over 10 classes would result in only 10% accuracy, on average.", "However, training a model to recognize images from a homogenous dataset is one thing. Training it to recognize images that it hasn\u2019t seen before in real time is another. I tried adjusting the lighting of my photos, and using a dark background \u2014 mimicking the photos the model had trained on.", "I also tried image augmentation \u2014 flips, skews, rotations, and more. Although these images did better than before, I was still having unpredictable \u2014 and in my mind unacceptable \u2014 results. I had the nagging feeling that I needed to rethink the problem, and come up with a creative way to make this project work.", "Takeaway: Train your model on images that are as close as possible to the images it is likely to see in the real world.", "I decided to pivot and try something new. It seemed to me that there was a clear disconnect between the odd look of the training data and images that my model was likely to see in real life. I decided I\u2019d try building my own dataset.", "I had been working with OpenCV, an open source computer vision library, and I needed an engineer a solution that would grab an image from the screen, then resize and transform the image into a NumPy array that my model could understand. The methods I used to transform my data are as follows:", "In a nutshell, once you get the camera up and running you can grab the frame, transform it, and get a prediction from your model:", "Getting the pipeline connected between the webcam and my model was a big success. I started to think about what would be the ideal image to feed in to my model. One clear obstacle was that it\u2019s difficult to separate the area of interest (in our case, a hand) from the background.", "The approach that I took was one that is familiar to anyone who has played around with Photoshop at all \u2014 background subtraction. It\u2019s a beautiful thing! In essence, if you take a photo of a scene before your hand is in it, you can create a \u201cmask\u201d that will remove everything in the new image except your hand.", "Once I had subtracted the background from my images, I then used binary thresholding to make the target gesture totally white, and the background totally black. I chose this approach for two reasons: it made the outline of the hand crisp and clear, and it made the model easier to generalize across users with different skin colors. This created the telltale \u201csilhouette\u201d-like photos that I ultimately trained my model on.", "Now that I could accurately detect my hand in images, I decided to try something new. My old model didn\u2019t generalize well, and my ultimate goal was to build a model that could recognize my gestures in real time \u2014 so I decided to build my own dataset!", "I chose to focus on 5 gestures:", "I strategically chose 4 gestures that were also included in the Kaggle data set, so I could cross-validate my model against those images later. I also added the peace sign, although that gesture did not have an analogue in the Kaggle data set.", "From here, I built the dataset by setting up my webcam, and creating a click binding in OpenCV to capture and save images with unique filenames. I tried to vary the position and size of the gestures in the frame, so that my model would be more robust. In no time, I had built a dataset with 550 silhouette images each. Yes, you read that right \u2014 I captured over 2700 images.", "I then built a convolutional neural network using Keras & TensorFlow. I started with the excellent VGG-16 pre-trained model, and added 4 dense layers along with a dropout layer on top.", "I then took the unusual step of choosing to cross-validate my model on the original Kaggle dataset I had tried earlier. This was key \u2014 if my new model couldn\u2019t generalize to images of other people\u2019s hands that it hadn\u2019t trained on before, than it was no better than my original model.", "In order to do this, I applied the same transformations to each Kaggle image that I had applied to my training data \u2014 background subtraction and binary thresholding. This gave them a similar \u201clook\u201d that my model was familiar with.", "The model\u2019s performance exceeded my expectations. It classified nearly every gesture in the test set correctly, ending up with a 98% F1 score, as well as 98% precision and accuracy scores. This was great news!", "As any well-seasoned researcher knows, though, a model that performs well in the lab but not in real life isn\u2019t worth much. Having experienced the same failure with my initial model, I was cautiously optimistic that this model would perform well on gestures in real time.", "Before testing my model, I wanted to add another twist. I\u2019ve always been a bit of a smart home enthusiast, and my vision had always been to control my Sonos and Philips Hue lights using just my gestures. To easily access the Philips Hue and Sonos APIs, I used the phue and SoCo libraries, respectively. They were both extremely simple to use, as seen below:", "Using SoCo to control Sonos via the web API was arguably even easier:", "I then created bindings for different gestures to do different things with my smart home devices:", "When I finally tested my model in real time, I was extremely pleased with the results. My model was accurately predicting my gestures the vast majority of the time, and I was able to use those gestures to control the lights and music. See the video below for a demo:", "I hope you enjoyed the results! Thanks for reading. You can find me on Twitter here, and on LinkedIn here. Recently, I\u2019ve been writing content for Databricks explaining complex topics in simple terms, like this page explaining data lakes. Finally, I contribute regularly to the Databricks blog. Onward and upward!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist and machine learning engineer."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe09b0a12bdf1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@brenner.heintz?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brenner.heintz?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Brenner Heintz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F824441f2b596&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&user=Brenner+Heintz&userId=824441f2b596&source=post_page-824441f2b596----e09b0a12bdf1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/athena15/project_kojak", "anchor_text": "code in the Github project repository here"}, {"url": "https://docs.google.com/presentation/d/1UY3uWE5sUjKRfV7u9DXqY0Cwk6sDNSalZoI2hbSD1o8/edit?usp=sharing", "anchor_text": "final presentation slides here"}, {"url": "https://www.kaggle.com/benenharrington/hand-gesture-recognition-database-with-cnn", "anchor_text": "Kaggle.com"}, {"url": "https://github.com/studioimaginaire/phue", "anchor_text": "phue"}, {"url": "https://github.com/SoCo/SoCo", "anchor_text": "SoCo"}, {"url": "https://twitter.com/brennerheintz", "anchor_text": "Twitter here"}, {"url": "http://linkedin.com/in/brennerheintz", "anchor_text": "LinkedIn here"}, {"url": "https://databricks.com/discover/data-lakes/introduction", "anchor_text": "this page explaining data lakes"}, {"url": "https://databricks.com/blog/author/brenner-heintz", "anchor_text": "Databricks blog"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e09b0a12bdf1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e09b0a12bdf1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/smart-home?source=post_page-----e09b0a12bdf1---------------smart_home-----------------", "anchor_text": "Smart Home"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----e09b0a12bdf1---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e09b0a12bdf1---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&user=Brenner+Heintz&userId=824441f2b596&source=-----e09b0a12bdf1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&user=Brenner+Heintz&userId=824441f2b596&source=-----e09b0a12bdf1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe09b0a12bdf1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e09b0a12bdf1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e09b0a12bdf1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brenner.heintz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@brenner.heintz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Brenner Heintz"}, {"url": "https://medium.com/@brenner.heintz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "201 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F824441f2b596&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&user=Brenner+Heintz&userId=824441f2b596&source=post_page-824441f2b596--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F196a72f52c0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-a-neural-network-to-detect-gestures-with-opencv-in-python-e09b0a12bdf1&newsletterV3=824441f2b596&newsletterV3Id=196a72f52c0&user=Brenner+Heintz&userId=824441f2b596&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}