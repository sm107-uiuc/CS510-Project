{"url": "https://towardsdatascience.com/building-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454", "time": 1683013392.283015, "path": "towardsdatascience.com/building-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454/", "webpage": {"metadata": {"title": "Building a Recommendation System with Spark ML and Elasticsearch | by Lijo Abraham | Towards Data Science", "h1": "Building a Recommendation System with Spark ML and Elasticsearch", "description": "Building a recommendation System with Spark ML and Elasticsearch using the ALS and cosine similarity"}, "outgoing_paragraph_urls": [{"url": "http://deepyeti.ucsd.edu/jianmo/amazon/index.html", "anchor_text": "site", "paragraph_index": 9}, {"url": "https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client/7.9.0", "anchor_text": "file", "paragraph_index": 13}, {"url": "https://github.com/lijoabraham/spark-playground/tree/master/recommendation_system_spark_es", "anchor_text": "Github", "paragraph_index": 28}], "all_paragraphs": ["While working in search teams of different product companies, there was always a constant demand for building a recommendation system for users. We have build with popular search engines like Elasticsearch, SOLR, and tried perfecting the search relevance. But there was always a limit when it comes to doing search relevance and creating recommendation system with just search engines. I was always amazed by companies like Amazon and Netflix providing recommendations based on our interest. So by using Apache spark machine learning capabilities along with elasticsearch, we are going to build a recommendation system.", "As in the picture above, if User 1 likes Item A, Item B, and Item C and User 2 likes Item B and Item C, there is a high probability that User 2 also likes Item A and can recommend Item A to User 2.", "In the field of recommendations system, there are mainly three techniques used for providing recommendations.", "We will be using the Collaborative filtering technique in Pyspark for creating a recommendation system. Apache Spark ML implements alternating least squares (ALS) for collaborative filtering, a very popular algorithm for making recommendations.", "ALS is a matrix factorization algorithm that uses Alternating Least Squares with Weighted-Lambda-Regularization (ALS-WR).", "The main problem with Spark ALS is that it will only recommend top products for a specific user (user-products model) and top users for a specific product (product-users model).", "Calculating an all-pairs similarity is not scaling to big product catalogues. The growing number of combinations O(n2) leads very quickly to overly costly shuffle operations and infeasible computer times. For calculating the Item-Item similarity, we are building an item-item model using the similarity of item factors from the ALS model using spark and elasticsearch.", "The ALS algorithm essentially factorizes two matrix \u2014 one is userFeatures and the other is itemFeatures matrix. We are doing cosine similarity on the itemFeatures rank matrix to find item-item similarity.", "The dataset contains mainly two types of data from amazon.com. One is metadata, which contains the product metadata and the other is rating data of different products respective of users.", "Note: The dataset can be downloaded from this site.", "The spark version used is 2.4.6 and elasticsearch version is 7.9.0", "The below code has been used for reading the product data and convert them to a spark dataframe.", "After loading data in spark, the dataframe looks like below.", "Now we need to index the product data to an Elasticsearch index. For connecting elasticsearch along with spark, we need to add a JAR file to the classpath or place the file in the jars folder of spark. The JAR file needs to be downloaded based on the spark version we have.", "Now that product metadata is indexed in Elasticsearch, we need to index feature vectors for every product in the model_factor column of documents based on the primary id.", "Feature vectors are generated by using the ItemFeatures matrix that is produced when we run the MLib ALS algorithm on user-product-ratings data.", "After loading the rating data in spark and converted to dataframe will be like below.", "After evaluating the model, we have got a Root Mean Square Error value of RMSE=0.032, which is pretty good. The lower the value, better the model.", "Now we have to index the item vectors back to Elasticsearch.", "Now the item vector has been indexed to elasticsearch, we need to find similar products.", "For finding the similarity between two items, we will be using cosine similarity functionality. Cosine similarity is a measure of similarity between two nonzero vectors of an inner product space that measures the cosine of the angle between them.", "The smaller the value of cosine distance, the more similar the items.", "We will be calculating cosineSimilarity score of products using script_score functionality in elasticsearch. The cosineSimilarity function calculates the measure of cosine similarity between a given query vector and document vectors.", "The below query has been used for fetching similar items from elasticsearch. We are filtering with category also for better results within the category. We can change the filter options according to our needs. The script adds 1.0 to the cosine similarity to prevent the score from being negative. To take advantage of the script optimizations, provide a query vector as a script parameter.", "The below code has been used for getting similar products. We are passing the ASIN of the product and the number of product recommendations we want.", "This will give the top 5 products as result, that is similar to the product we have passed.", "Not bad! The results came similar to the product we have searched for. We can always tune the ALS algorithm for better performance and accuracy.", "We can also take implicit feedback parameters for tuning the algorithm. Essentially, instead of trying to model the matrix of ratings directly, this approach treats the data as numbers representing the strength in observations of user actions (such as the number of clicks, or the number of times the product bought).", "Source code can be found on Github.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Just another engineer who loves exploring new technologies."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fabbd0fb59454&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lijoabraham1234?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lijoabraham1234?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Lijo Abraham"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29cc72ceda78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&user=Lijo+Abraham&userId=29cc72ceda78&source=post_page-29cc72ceda78----abbd0fb59454---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://deepyeti.ucsd.edu/jianmo/amazon/index.html", "anchor_text": "site"}, {"url": "https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client/7.9.0", "anchor_text": "file"}, {"url": "https://github.com/lijoabraham/spark-playground/tree/master/recommendation_system_spark_es", "anchor_text": "Github"}, {"url": "https://spark.apache.org/docs/3.0.0/ml-collaborative-filtering.html", "anchor_text": "https://spark.apache.org/docs/3.0.0/ml-collaborative-filtering.html"}, {"url": "http://cseweb.ucsd.edu/~jmcauley/pdfs/emnlp19a.pdf", "anchor_text": "PDF"}, {"url": "https://medium.com/@lijoabraham1234/finding-the-right-mutual-fund-using-spark-ml-2f3e96f2c535", "anchor_text": "https://medium.com/@lijoabraham1234/finding-the-right-mutual-fund-using-spark-ml-2f3e96f2c535"}, {"url": "https://medium.com/tag/data-science?source=post_page-----abbd0fb59454---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/spark?source=post_page-----abbd0fb59454---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----abbd0fb59454---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----abbd0fb59454---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/elasticsearch?source=post_page-----abbd0fb59454---------------elasticsearch-----------------", "anchor_text": "Elasticsearch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&user=Lijo+Abraham&userId=29cc72ceda78&source=-----abbd0fb59454---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&user=Lijo+Abraham&userId=29cc72ceda78&source=-----abbd0fb59454---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fabbd0fb59454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----abbd0fb59454---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----abbd0fb59454--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----abbd0fb59454--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----abbd0fb59454--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lijoabraham1234?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lijoabraham1234?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lijo Abraham"}, {"url": "https://medium.com/@lijoabraham1234/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "21 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29cc72ceda78&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&user=Lijo+Abraham&userId=29cc72ceda78&source=post_page-29cc72ceda78--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff27fa6523ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-recommendation-system-with-spark-ml-and-elasticsearch-abbd0fb59454&newsletterV3=29cc72ceda78&newsletterV3Id=f27fa6523ee&user=Lijo+Abraham&userId=29cc72ceda78&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}