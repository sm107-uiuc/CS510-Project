{"url": "https://towardsdatascience.com/object-detection-by-tensorflow-1-x-5a8cb72c1c4b", "time": 1683013769.9368372, "path": "towardsdatascience.com/object-detection-by-tensorflow-1-x-5a8cb72c1c4b/", "webpage": {"metadata": {"title": "Object Detection by Tensorflow 1.x | by Yuki Takahashi | Towards Data Science", "h1": "Object Detection by Tensorflow 1.x", "description": "The computer vision is one of the top fast growing domain and the deep learning based approach is now widely applied to solve real-world problems such as face recognition, cancer detection, etc. One\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "Tensorflow Object Detection API", "paragraph_index": 1}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-2-x-e1199558abc?sk=c200d58b9d3dd1ab923e2c317e4ece95", "anchor_text": "see another post explaining how to", "paragraph_index": 2}, {"url": "http://www.cvlibs.net/datasets/kitti/index.php", "anchor_text": "http://www.cvlibs.net/datasets/kitti/index.php", "paragraph_index": 5}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 6}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 7}, {"url": "https://github.com/yuki678/driving-object-detection/tree/master/scripts", "anchor_text": "all scripts", "paragraph_index": 9}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md", "anchor_text": "Tensorflow 1 Detection Model Zoo", "paragraph_index": 11}, {"url": "https://cocodataset.org/#home", "anchor_text": "coco dataset", "paragraph_index": 11}, {"url": "https://github.com/tensorflow/models/tree/r1.13.0/research/object_detection/samples/configs", "anchor_text": "tensorflow model repo", "paragraph_index": 12}, {"url": "https://github.com/tzutalin/labelImg#installation", "anchor_text": "installation guide", "paragraph_index": 13}, {"url": "https://github.com/yuki678/driving-object-detection/blob/master/traffic-light-detection-tf1.ipynb", "anchor_text": "traffic-light-detection-tf1.ipynb", "paragraph_index": 19}, {"url": "https://github.com/protocolbuffers/protobuf/releases/tag/v3.4.0", "anchor_text": "here", "paragraph_index": 38}, {"url": "https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#saving-environment-variables", "anchor_text": "Saving environment variables", "paragraph_index": 39}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-2-x-e1199558abc?sk=c200d58b9d3dd1ab923e2c317e4ece95", "anchor_text": "another post, which explains how to use the latest Tensorflow 2.x Object Detection API", "paragraph_index": 40}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 40}, {"url": "https://github.com/yuki678", "anchor_text": "https://github.com/yuki678", "paragraph_index": 42}], "all_paragraphs": ["The computer vision is one of the top fast growing domain and the deep learning based approach is now widely applied to solve real-world problems such as face recognition, cancer detection, etc.", "One of the most effective tool is Tensorflow Object Detection API and use their pre-trained model, replacing the last layer for the particular problem trying to solve and fine tune the model.", "Now the API is adopted to Tensorflow 2.x. However, the runtime environment sometimes does not allow to use the latest version and still need to use Tensorflow 1.x. This blog post demonstrate how to use the API in such a situation. If you can use Tensorflow 2.x for inference, best to go for it \u2014 see another post explaining how to.", "Here, I take the traffic light detection for a self-driving car, where red, yellow or green traffic light have to be detected at high frequency (~10fps) even on a small computing resource on the car by older libraries due to dependencies.", "Please note that this post only describes the object detection by a machine learning approach. An actual self-driving car uses Lidar, Rader, GPS and map, and apply various filters for localization, object detection, trajectory planning and so on then apply actuators to accelerate, decelerate or turn the car, which is beyond this post.", "As for training data, kitti (http://www.cvlibs.net/datasets/kitti/index.php) provides comprehensive dataset for autonomous car.", "The below uses Google Colab. If you train on a local environment, please refer to README in the repo.", "1. Clone the project repo or create new one", "If you created a new repo, make the following directories", "When creating a new repo, copy all scripts in scripts dir.", "2. Select which pre-trained model to use", "Go to Tensorflow 1 Detection Model Zoo in github and download the one which fits for the purpose. Models trained by coco dataset works well in most cases. Speed and accuracy (mAP) are trade-off. I selected SSD Mobilenet v2 for fast inference speed, but one can choose larger models with better accuracy such as Faster RCNN Resnet101, which is about 100 times model size and 10 times slower in my machine, but comes with a great accuracy.", "Once the model is decided, unarchive and copy pipeline.config. Alternatively, you can copy sample pipeline config from the tensorflow model repo.", "As is always the case for supervised learning, you need to spend a few hours to manually label input data. Save training images under images directory where I provided traffic light detection images in a simulator with labels in Pascal VOC in my repo. There are a number of tools available and labelImg is one of the simplest classic ones for box type. Make sure you have python 3 and simply install it from PyPI, or refer to installation guide.", "Save the xml files in the same directory. Good news is, no need to prepare tens of thousands of labels as this is a transfer learning and 100 labels per category will yield good results for fine tuning.", "This is just a list of labels. Names should match with the annotated labels in the previous step. Save the file as annotations/label_map.pbtxt", "Next step of training set preparation is to separate images to train set and test set, then generate .TFRecord for each the xml files. This can be done locally here but I included in the step on Colab so that any additional labelling are not missed in TFRecord.", "Some changes are mandatory and others are optional but better to fit for the training data.", "Push the repo to github\u2014 all set!", "Next, go to Google Colab and create a new notebook. traffic-light-detection-tf1.ipynb is a sample in my repo.", "1. Install Tensorflow 1.14 and required libraries", "Download tensorflow model repo to the Colab env, compile protocol buffers, set PYTHONPATH and install COCO API for evaluation.", "Download the pre-trained model to the Colab environment.", "Make sure the local changes are committed in master branch and pushed to github beforehand.", "6. Process input images (training dataset)", "It is very useful to launch tensorboard to monitor the training progress. To access the tensorboard process, use ngrok tunnel here.", "This takes a while, depending on the model and parameters though, a few minutes to hours or more. Take a couple of tea, or even dinner and shower and TV and sleep\u2026", "In TF1, the evaluation runs at the checkpoint during the training as specified in pipeline.config. Good to check the progress on Tensorboard and adjust parameters in pipeline.config if the loss is not decreased, accuracy/recall is not improved or learning curve is not as expected. Target total loss under 2.", "It provides nice comparison between ground truth and detection in images too, at each evaluation step.", "Don\u2019t forget to export and download the trained model, which will be used for inference.", "Once downloaded, unarchive the file to exported_models/[model name] dir.", "Tensorboard already provides prediction images, so here is just a demonstration how to use the trained model for inference and draw images.", "If your runtime for inference has limitation of the tensorflow version, the exported model may get errors as referring to parameters which did not exist in the older version. This can be avoided by converting the exported model in the environment which matches the runtime version.", "Here, my runtime is tensorflow v1.3. The oldest available Object Detection API is on v1.4 but luckily it seems to be compatible with v1.3, so use this version.", "1. Create an env and install libraries", "I use conda but you can use any one of virtual environment management tool.", "2. Clone tensorflow model repo, copy the compatible version", "3. Download protoc and compile protocol buffers", "The compatible protoc version is v3.4.0, which can be downloaded from here. After downloaded, compile the protocol buffers.", "If you launch a new console, make sure to set PYTHONPATH, which can be also saved to automatically run every time you switch the virtual env \u2014 e.g. for conda, refer to Saving environment variables.", "This post explains how to use Tensorflow Object Detection API for training and perform inference on the fine-tuned model by the older version of Tensorflow 1.x. If you don\u2019t have such limitation, please see another post, which explains how to use the latest Tensorflow 2.x Object Detection API . Sample code and images are available in my github repo.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A product manager in London. Github \u2014 https://github.com/yuki678"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5a8cb72c1c4b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yuki678.medium.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Yuki Takahashi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3acb9d6e47b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=post_page-3acb9d6e47b8----5a8cb72c1c4b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "Tensorflow Object Detection API"}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-2-x-e1199558abc?sk=c200d58b9d3dd1ab923e2c317e4ece95", "anchor_text": "see another post explaining how to"}, {"url": "http://www.cvlibs.net/datasets/kitti/index.php", "anchor_text": "http://www.cvlibs.net/datasets/kitti/index.php"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://github.com/yuki678/driving-object-detection/tree/master/scripts", "anchor_text": "all scripts"}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md", "anchor_text": "Tensorflow 1 Detection Model Zoo"}, {"url": "https://cocodataset.org/#home", "anchor_text": "coco dataset"}, {"url": "https://github.com/tensorflow/models/tree/r1.13.0/research/object_detection/samples/configs", "anchor_text": "tensorflow model repo"}, {"url": "https://github.com/tzutalin/labelImg#installation", "anchor_text": "installation guide"}, {"url": "https://github.com/yuki678/driving-object-detection/blob/master/traffic-light-detection-tf1.ipynb", "anchor_text": "traffic-light-detection-tf1.ipynb"}, {"url": "https://github.com/protocolbuffers/protobuf/releases/tag/v3.4.0", "anchor_text": "here"}, {"url": "https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#saving-environment-variables", "anchor_text": "Saving environment variables"}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-2-x-e1199558abc?sk=c200d58b9d3dd1ab923e2c317e4ece95", "anchor_text": "another post, which explains how to use the latest Tensorflow 2.x Object Detection API"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----5a8cb72c1c4b---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/ai?source=post_page-----5a8cb72c1c4b---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----5a8cb72c1c4b---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5a8cb72c1c4b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/self-driving-cars?source=post_page-----5a8cb72c1c4b---------------self_driving_cars-----------------", "anchor_text": "Self Driving Cars"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=-----5a8cb72c1c4b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=-----5a8cb72c1c4b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5a8cb72c1c4b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5a8cb72c1c4b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5a8cb72c1c4b--------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yuki Takahashi"}, {"url": "https://yuki678.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "385 Followers"}, {"url": "https://github.com/yuki678", "anchor_text": "https://github.com/yuki678"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3acb9d6e47b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=post_page-3acb9d6e47b8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F23923a612f87&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-1-x-5a8cb72c1c4b&newsletterV3=3acb9d6e47b8&newsletterV3Id=23923a612f87&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}