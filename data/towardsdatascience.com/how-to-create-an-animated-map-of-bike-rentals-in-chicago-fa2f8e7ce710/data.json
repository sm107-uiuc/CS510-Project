{"url": "https://towardsdatascience.com/how-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710", "time": 1683014923.172789, "path": "towardsdatascience.com/how-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710/", "webpage": {"metadata": {"title": "How to Create an Animated Map of Bike Rentals in Chicago | by Mike Thompson | Towards Data Science", "h1": "How to Create an Animated Map of Bike Rentals in Chicago", "description": "This article assumes the reader already knows how to plot geographic data using the Bokeh library in Python. For an excellent and thorough explanation, please see this article written by Colin\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/exploring-and-visualizing-chicago-transit-data-using-pandas-and-bokeh-part-ii-intro-to-bokeh-5dca6c5ced10", "anchor_text": "article", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/@colinpatrickreid", "anchor_text": "Colin Patrick Reid", "paragraph_index": 0}, {"url": "https://github.com/mthomp12/mthomp12.github.io/blob/master/assets/images/divvy_data.csv", "anchor_text": "processed data", "paragraph_index": 2}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide/server.html#userguide-server-applications", "anchor_text": "enables Bokeh", "paragraph_index": 13}], "all_paragraphs": ["This article assumes the reader already knows how to plot geographic data using the Bokeh library in Python. For an excellent and thorough explanation, please see this article written by Colin Patrick Reid.", "Your data is processed and you\u2019ve successfully adapted Colin\u2019s code to create your own beautiful visualization in Bokeh, but you want to convey more information than is possible with a static image. You\u2019re in the right place!", "Initial SetupWe will start with this already processed data that combines bike rental data with historic daily average Chicago temperatures and the code below:", "Which generates the following static image:", "Add AnimationTo create an animated graph, we need to add a periodic callback function that updates the data after a specified amount of time has passed. In order to do this, the code needs to refer to the JavaScript document that is automatically created from your Python script. Therefore, instead of using show(p) to display our code, we need to update to curdoc().add_root(column(p)). Note we need to make sure we import curdoc from bokeh.plotting and column from bokeh.layouts. This change requires that the script be ran from the command line, which will be explained further below.", "Each row in this dataset represents the number of bikes rented from a given bike station, averaged over days by average temperature (rounded to the nearest 5\u00b0F). Each update is to refresh the data to the next 5\u00b0F bucket, from 30\u00b0F to 80\u00b0F. Data for the graph is stored in a dictionary, containing x and y coordinates and circle size. Each callback updates the dictionary for the new circle sizes representing the next temperature bucket. To make the updates, store the Bokeh circle object in a variable, then update variable_name.data_source.data with the updated data dictionary.", "Smoothing and PacingThe data is grouped into 5\u00b0F buckets to make sure there is a sufficient number of data points for each temperature and to make the general trend easier to interpret. If we transition directly from one temperature bucket to the next, the animation would be very choppy, making it difficult to gain insight from the graph. To smooth out the animation, each frame interpolates the number of bike rentals as well as the temperature (rounded to nearest degree) between the previous and next bucket.", "I found that 20 frames per bucket resulted in smooth animation. This equates to 4 frames per degree (20 frames per 5\u00b0F = 4 frames per 1\u00b0F). Refreshing the data every 80 milliseconds results in each temperature shown for 0.32 seconds (0.08s * 4 frames), for a total runtime of 16 seconds (0.32 * 50 temperatures).", "Create the GIFAdding the callback function and calling the graph via the curdoc method is sufficient to create an animated graph that will run on localhost in your browser, but if you want to create a file of your animation (perhaps to include in a PowerPoint presentation), then you will want to create a .gif file.", "To create a gif, save each frame of the animation to a .png file via the export_png method from bokeh.io (see code above). Then use the imread function from the imageio library to create a gif from the png files:", "Note I recommend finalizing your code for the Bokeh server (including smoothing and pacing) before saving any png files. It takes a lot longer to save all the png files than it does to generate the server, so error checking the server is a much faster process than error checking the resulting gif.", "Bokeh Server vs GIF RuntimeObservant readers may have noticed that I calculated the gif to be 16 seconds long, but the animation at the beginning of this article actually runs for 20 seconds. Why the discrepancy? The Bokeh server created from this code does run for 16 seconds, but I did not specify the framerate in the code that creates the gif from the png files. The default is 10 frames per second (fps), compared to 12.5 fps used in the Bokeh server code (1 frame/80 ms callback period), which explains the gif\u2019s 20 second runtime (12.5 fps in gif / 10 fps in Bokeh server * 16 seconds).", "Keep this in mind if the Bokeh server has a different pace than the resulting gif. You can specify your desired framerate in the mimsave function via the fps parameter, or alternatively set the periodic callback refresh rate to 100 ms (which is equivalent to the mimsave default of 10 fps).", "Run your CodeThe static image can be ran directly from your IDE, but as mentioned earlier, the curdoc method needs to be ran from the command line, which enables Bokeh to create a new plot each time your browser connects to the server. To run the code, run the following code from the command prompt:", "Note I use the Anaconda distribution of Python, so I actually use the Anaconda Prompt to run this command. Some additional configuration may be necessary to execute this command from your computer.", "Results Was the extra effort of animating the graph worth it? I think it was, because it allowed me to find insight from the data I may otherwise not have and illustrate it in a very easily digestible way.", "You probably noticed that demand at the labeled lakeshore locations exploded once the temperature reached approximately 55\u00b0F. This makes perfect sense as people are much more likely to visit the beach when the weather is warm, but I am not sure if I would have realized this without the animated visualization. I may have thought these destinations were simply more popular overall, like the locations west of the south branch of the river (which Chicago readers will recognize as the commuter train arrivals from the suburbs) that have a linear relationship with temperature.", "From this insight, I was able to show that demand at these lakeshore locations increases quadratically with temperature, while the other locations increase linearly:", "This is helpful information, since it demonstrates that estimating demand for the beach locations should probably use a different model than the other locations, which could improve the restocking strategy.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Masters in Data Science Candidate at University of Chicago and Former Actuary (FSA)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffa2f8e7ce710&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mthomp12?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mthomp12?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Mike Thompson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F28ba38616343&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&user=Mike+Thompson&userId=28ba38616343&source=post_page-28ba38616343----fa2f8e7ce710---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/exploring-and-visualizing-chicago-transit-data-using-pandas-and-bokeh-part-ii-intro-to-bokeh-5dca6c5ced10", "anchor_text": "article"}, {"url": "https://towardsdatascience.com/@colinpatrickreid", "anchor_text": "Colin Patrick Reid"}, {"url": "https://github.com/mthomp12/mthomp12.github.io/blob/master/assets/images/divvy_data.csv", "anchor_text": "processed data"}, {"url": "https://github.com/mthomp12/Animated_Bike_Graph/blob/master/AnimatedGraph.py", "anchor_text": "here"}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide/server.html#userguide-server-applications", "anchor_text": "enables Bokeh"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----fa2f8e7ce710---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/data-science?source=post_page-----fa2f8e7ce710---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bokeh?source=post_page-----fa2f8e7ce710---------------bokeh-----------------", "anchor_text": "Bokeh"}, {"url": "https://medium.com/tag/python?source=post_page-----fa2f8e7ce710---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&user=Mike+Thompson&userId=28ba38616343&source=-----fa2f8e7ce710---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&user=Mike+Thompson&userId=28ba38616343&source=-----fa2f8e7ce710---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffa2f8e7ce710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fa2f8e7ce710---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fa2f8e7ce710--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mthomp12?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mthomp12?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Mike Thompson"}, {"url": "https://medium.com/@mthomp12/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "15 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F28ba38616343&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&user=Mike+Thompson&userId=28ba38616343&source=post_page-28ba38616343--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F28ba38616343%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-an-animated-map-of-bike-rentals-in-chicago-fa2f8e7ce710&user=Mike+Thompson&userId=28ba38616343&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}