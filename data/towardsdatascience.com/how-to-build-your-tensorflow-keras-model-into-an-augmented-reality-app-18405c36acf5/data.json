{"url": "https://towardsdatascience.com/how-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5", "time": 1683008971.3460338, "path": "towardsdatascience.com/how-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5/", "webpage": {"metadata": {"title": "How to Build Your Tensorflow/Keras Model into an Augmented Reality App | by Andrew Hong | Towards Data Science", "h1": "How to Build Your Tensorflow/Keras Model into an Augmented Reality App", "description": "This process is convoluted, and will probably change slightly over time. I will do my best to update this as changes come out. I\u2019m assuming you already have both Unity and Tensorflow set up. Unity\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/onnx/tensorflow-onnx", "anchor_text": "onnx", "paragraph_index": 4}, {"url": "https://www.youtube.com/watch?v=_9aPZH6pyA8&t=639s", "anchor_text": "this Youtube tutorial", "paragraph_index": 6}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/index.html", "anchor_text": "Barracuda", "paragraph_index": 6}, {"url": "https://github.com/Unity-Technologies/arfoundation-samples/blob/2.1/Assets/Scripts/TestCameraImage.cs", "anchor_text": "this is another", "paragraph_index": 9}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/index.html", "anchor_text": "barracud", "paragraph_index": 11}, {"url": "https://www.youtube.com/watch?v=eI2GOuEMGfQ", "anchor_text": "android debugger (adb)", "paragraph_index": 15}, {"url": "https://www.youtube.com/watch?v=C56bbgtPr_w", "anchor_text": "Unity\u2019s Job System", "paragraph_index": 16}, {"url": "https://docs.unity3d.com/Manual/Profiler.html", "anchor_text": "Unity Profiler", "paragraph_index": 17}], "all_paragraphs": ["This process is convoluted, and will probably change slightly over time. I will do my best to update this as changes come out. I\u2019m assuming you already have both Unity and Tensorflow set up. Unity should be 2017.x or later, Tensorflow should work with any version (I used Unity 2019.3.3, and tf2.1). I\u2019m still figuring it all out in my current project, so this may not be the best way but it definitely works. I\u2019ll update this article as I learn more.", "We will be going in the following order platform wise, which looks more confusing than it actually is:", "Trained Python/Tensorflow/Keras \u2192 Convert to ONNX \u2192 Implement Baracuda/Tensorflow Sharp \u2192 Unity/C# \u2192 Build Android Application", "If you have a Keras .h5 file, you will first need to save it into a saved_model.pb. We\u2019ll now convert that into a Open Neural Network Exchange (ONNX) file that is read into Unity using Tensorflow Sharp.", "Then, take the file path of your saved_model.pb Now install onnx by following their readme (I cloned their repo then ran setup.py install). Run the following command in the same folder (it looks for saved_model.pb so make sure that is the file name in the your folder path).", "The following are what is supported by Barracuda, the package we will be using to read the .onnx file into Unity.", "Now you have your .onnx file, we need to bring Unity mlagents into your project. The easiest way to do this is by following this Youtube tutorial, which asks you to get mlagents in your Unity package manager (enable preview packages) and to also pull in the GitHub folder in the video description. The reason for doing all this is because these packages contain Barracuda, which is what Unity uses to easily bring in .onnx files as .nn and execute them in C#. I believe you could install mlagents and Barracuda from the package manager as well, but if that doesn\u2019t work try the above directions. You\u2019re almost there!", "For those who aren\u2019t familiar with Unity, I might lose you here. Unity has great documentation so you should be able to search up anything that is confusing to you.", "We\u2019re going to perform three steps:", "First create an AR Session Origin and AR Session by right clicking in the hierarchy. To access the camera feed, we will create a \u201cRender Texture\u201d by right clicking in your project folder. Click on the texture and in the inspector change it\u2019s size to 1080x1920 (or whatever you want it to be). If you don\u2019t want to use a render texture for some reason, then this is another workaround to access the camera frame. Place that render texture in your AR Camera\u2019s camera component\u2019s \u201cTarget Texture\u201d field. This will remove the normal camera view and instead render it on objects you place this render texture on.", "We\u2019re going to create a UI RawImage, stretch it to the canvas in the \u201cRect Transform\u201d component, then attach the render texture to it\u2019s Raw Image component. It should look like this:", "Now we can get into the code. You can familiarize yourself with barracuda in their Unity documentation, but we\u2019re basically going to need to load the .nn model, then create a method that executes the model. After that, we\u2019re going to call the last layer and transform it from a Tensor into an array of floats.", "This is a lot, but let\u2019s walk through it. The NNModel will show up in the inspector, and is where you can drag and drop your .nn from your project files. We want to load that and cache is at start of runtime in m_RuntimeModel .", "After that we create additionaloutputs to call the softmax layer (just the way I\u2019ve done it so I can set a threshold manually instead of just using an argmax), and create an engine to execute the model with on the device GPU. We have to resize the render texture to fit the inputs of our model, which for me is (224,224,3). The two functions I used to convert to Texture2D and then resize are below:", "The rest of the code is pretty self explanatory, don\u2019t worry about the dispose() methods yet we\u2019ll get into that at the end. With this, you should be able to connect to a UI Text element instead of using the debug.log and build the app onto your phone! I like to use Vuforia\u2019s Camera for testing on my pc, then changing it to AR Foundation\u2019s Camera when building.", "If the build isn\u2019t working you\u2019ll have to use the android debugger (adb). This will allow you to see the crash log of the built app using adb logcat -s Unity. Sometimes things that were working with my PC webcam weren\u2019t on my phone, all of this is very version dependent! Just keep tweaking it until it works.", "Great, so now your model is working on your phone! But unfortunately you will quickly notice that the frame rate is abysmal, mine was about 3fps on the first build. Even with tiny yolov2, the frame rate isn\u2019t amazing (especially for the mAP you are sacrificing). What you will need to do is learn about multithreading and the garbage collector in Unity\u2019s Job System package. Barracuda already functions like a job system with a worker (handle), execute (check out executeasync), and disposal methods.", "As you build more interactions into your app to make it truly AR, you\u2019ll need to save all the processing you can. The Unity Profiler will help you with that, just make sure to have it set to hierarchy instead of timeline. For this simple app I just execute the model every 10\u201315 frames instead of each frame.", "Alternatively, you could use quantization on your model but that has to be done after it is an .onnx file (sorry no tflite support yet). The following code should work in python, but note that quantization will cost your model accuracy.", "And there you have it! There are a lot of moving and changing parts, but it is all fairly well documented. Don\u2019t be afraid to dive into issues on the Barracuda and Onnx GitHub repositories or the Unity forums for help.", "Please leave a comment if you are confused or lost in any way. Have fun!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Follow me on @andrewhong5297 on twitter for more data insights"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F18405c36acf5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://andrew-hong.medium.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": ""}, {"url": "https://andrew-hong.medium.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Andrew Hong"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad1e6939064c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&user=Andrew+Hong&userId=ad1e6939064c&source=post_page-ad1e6939064c----18405c36acf5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@davidgrdm?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "David Grandmougin"}, {"url": "https://unsplash.com/s/photos/augmented-reality?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://github.com/onnx/tensorflow-onnx", "anchor_text": "onnx"}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@0.7/manual/index.html#getting-unity-barracuda", "anchor_text": "https://docs.unity3d.com/Packages/com.unity.barracuda@0.7/manual/index.html#getting-unity-barracuda"}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@0.7/manual/index.html#getting-unity-barracuda", "anchor_text": "https://docs.unity3d.com/Packages/com.unity.barracuda@0.7/manual/index.html#getting-unity-barracuda"}, {"url": "https://www.youtube.com/watch?v=_9aPZH6pyA8&t=639s", "anchor_text": "this Youtube tutorial"}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/index.html", "anchor_text": "Barracuda"}, {"url": "https://github.com/Unity-Technologies/arfoundation-samples/blob/2.1/Assets/Scripts/TestCameraImage.cs", "anchor_text": "this is another"}, {"url": "https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/index.html", "anchor_text": "barracud"}, {"url": "https://www.youtube.com/watch?v=eI2GOuEMGfQ", "anchor_text": "android debugger (adb)"}, {"url": "https://www.youtube.com/watch?v=C56bbgtPr_w", "anchor_text": "Unity\u2019s Job System"}, {"url": "https://docs.unity3d.com/Manual/Profiler.html", "anchor_text": "Unity Profiler"}, {"url": "https://gist.github.com/andrewhong5297/6601e7e48fc862e60a3843cd8fcfe480", "anchor_text": "https://gist.github.com/andrewhong5297/6601e7e48fc862e60a3843cd8fcfe480"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----18405c36acf5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----18405c36acf5---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/augmented-reality?source=post_page-----18405c36acf5---------------augmented_reality-----------------", "anchor_text": "Augmented Reality"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----18405c36acf5---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/mixed-reality?source=post_page-----18405c36acf5---------------mixed_reality-----------------", "anchor_text": "Mixed Reality"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&user=Andrew+Hong&userId=ad1e6939064c&source=-----18405c36acf5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&user=Andrew+Hong&userId=ad1e6939064c&source=-----18405c36acf5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F18405c36acf5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----18405c36acf5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----18405c36acf5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----18405c36acf5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----18405c36acf5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----18405c36acf5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----18405c36acf5--------------------------------", "anchor_text": ""}, {"url": "https://andrew-hong.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://andrew-hong.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrew Hong"}, {"url": "https://andrew-hong.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "717 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad1e6939064c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&user=Andrew+Hong&userId=ad1e6939064c&source=post_page-ad1e6939064c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F38f8eb637a1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-your-tensorflow-keras-model-into-an-augmented-reality-app-18405c36acf5&newsletterV3=ad1e6939064c&newsletterV3Id=38f8eb637a1c&user=Andrew+Hong&userId=ad1e6939064c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}