{"url": "https://towardsdatascience.com/rent-scraping-how-i-saved-money-using-r-fc93925ca11b", "time": 1682993667.552296, "path": "towardsdatascience.com/rent-scraping-how-i-saved-money-using-r-fc93925ca11b/", "webpage": {"metadata": {"title": "Rent-scraping: How I saved money using R | by Justin | Towards Data Science", "h1": "Rent-scraping: How I saved money using R", "description": "Learn how I used R and web scraping to fight a rent increase and won."}, "outgoing_paragraph_urls": [{"url": "https://www.facs.nsw.gov.au/resources/statistics/rent-and-sales", "anchor_text": "reports", "paragraph_index": 9}, {"url": "https://www.auhouseprices.com/", "anchor_text": "AuHousePrices", "paragraph_index": 10}, {"url": "https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/", "anchor_text": "rvest", "paragraph_index": 15}, {"url": "https://magrittr.tidyverse.org/", "anchor_text": "piping operator from magrittr", "paragraph_index": 15}, {"url": "https://dplyr.tidyverse.org/", "anchor_text": "dplyr", "paragraph_index": 15}, {"url": "https://selectorgadget.com/", "anchor_text": "SelectorGadget", "paragraph_index": 18}, {"url": "https://cran.r-project.org/web/packages/stringr", "anchor_text": "stringr", "paragraph_index": 28}, {"url": "https://embracingtherandom.com/r/web-scraping/rent-scraping/", "anchor_text": "https://embracingtherandom.com", "paragraph_index": 51}, {"url": "http://embracingtherandom.com", "anchor_text": "embracingtherandom.com", "paragraph_index": 53}, {"url": "http://linkedin.com/in/justin-m-evans/", "anchor_text": "linkedin.com/in/justin-m-evans/", "paragraph_index": 53}], "all_paragraphs": ["(TD;DR: Received letter from real estate increasing my weekly rent. Reason for the increase was not supported by evidence. Used R to look for evidence supporting real estate\u2019s claim. Fought the power and won!)", "Gather \u2018round, gather \u2018round. Come hear a story of one man\u2019s triumph against the establishment. Read in disbelief as he goes to great lengths to avoid paying a $5 per week rent increase on the grounds that it could not be justified by empirical evidence.", "(On a serious note: this is about web scraping in R)", "The 12-month lease for my current apartment was coming to an end. Just when I was wondering when the annual email from my real estate agent offering me a new 12-month lease was going to arrive, I received this:", "You are currently leasing your property for $500.00 per week and the lease is due to expire on the 18/11/2017. We have recently completed a rental review for your property and advised the owner that based on current market conditions, the rent for your property should increase by $5 per week.", "Craving specificity, my mind goes into overdrive: What market conditions? How have they defined them? $5 is so little \u2014 what change in market conditions could justify a $5 per week increase?", "Having had my rent increased by $20 per week a year ago, a further $5 increase didn\u2019t seem to make sense to me. I also perceived a power imbalance which I didn\u2019t like. On the one hand, we have the real estate agent, who has access to databases of property prices and reports. On the other hand, we have a tenant who does not have access to the same amount of information. This information asymmetry would have traditionally put the tenant in a weaker position and thus more likely to accept the advice of the real estate agent.", "Unfortunately for my real estate agent, I\u2019m a little bit crazy.", "I live in a two-bedroom apartment with a car space and a single bathroom. I wanted to look for data on apartments with a similar configuration.", "I knew that the NSW Government publishes reports on newly rented out houses and apartments on a quarterly basis. There\u2019s a tab in the report that shows the first quartile, median and third quartile of the distribution of weekly rent paid for one and two-bedroom apartments.", "After some Googling, I found AuHousePrices. Take a look at this screenshot:", "It has all the info that I need:", "Another attractive quality of this site was the loop-friendly URL. This is the URL for the first page:", "Here is the URL for the second page:", "Now guess what the first 50 URLs might be. Easy, right?", "rvest is a web scraping R package by R royalty, Hadley Wickham. Like most of Hadley\u2019s packages, rvest is simple to use with its intuitive syntax. The package is built to work with the piping operator from magrittr (which users of the dplyr will be familiar with), allowing us to create elegant data munging pipelines.", "Getting started with rvest is easy:", "How can we find out which CSS selector contains the data we\u2019re after?", "SelectorGadget is a Google Chrome extension that allows you to quickly discover which CSS selector contains the data you\u2019re targeting by simply clicking on it. You no longer have to dig through HTML in your browser\u2019s developer tools. It\u2019s a huge time saver.", "We now have all the ingredients necessary to scrape data from websites using R. The output that I ultimately want to create is a time series of weekly rent per the months in which the apartments were leased. I want to make sure that my scraping is working as intended so I want to extract the addresses of the apartments so that I can visually inspect my data against a sample of webpages in Chrome.", "Let\u2019s build a prototype and scrape the first page.", "Go into Chrome, and click on the SelectorGadget icon in the top right-hand corner. Click on one of the addresses, and you should see something like this pop up in the bottom right-hand corner of your browser.", "This is the CSS selector that contains the address data. To access the data contained within this selector, we can pipe the page into html_nodes(), specifying the CSS selector name as its argument. To access the text contained within, we can pipe this result into html_text().", "Let\u2019s take a look at its output:", "We don\u2019t want element 13 (\u201c Search Filter and Sorting \u201c) in our vector of addresses, so let\u2019s exclude it.", "Clicking on the weekly rent and the month in which the apartments were leased presents us with a challenge. The selector that contains the data we\u2019re after (\u201cli\u201d) is shared by a whole bunch of other data. Take a look at the stuff that is highlighted:", "Let\u2019s take a look at the first few elements of what we can extract from the \u201cli\u201d selector:", "We know the pattern of text we want to extract. It goes something like this:", "Let\u2019s use some regex and the str_extract() function from the stringr package (all Hail Hadley, again) to extract any text matching this pattern in our vector of elements in the \u201cli\u201d selector. Note that str_extract() returns a vector of the same length as the input with NAs for the elements that didn\u2019t match our pattern. We will filter out the NAs as a final step.", "My claim is that the above pattern can be expressed in regex like this:", "Don\u2019t be afraid. It looks crazy, but all this is saying is this:", "Woohoo! We have 12 sets of data for the 12 addresses. We can easily break this string apart using more regex to extract the month and the rent per week. I\u2019ll show you how I did it, but try to break it down like I did above and all those symbols will appear less daunting. Firstly, extracting the month\u2026", "\u2026and then the rent per week:", "We set out wanting to analyse apartments similar to mine. That is, we want to analyse apartments with 2 bedrooms, 1 bathroom, and 1 car space. A look at the search results reveals to us that we need to cater for 2 scenarios:", "I want to capture both patterns so that I have 12 sets of apartment configurations that they can be easily combined with the sets of 12 addresses, months and weekly rent amounts. Once they have been combined into a data frame, I can easily filter out those apartments that don\u2019t meet my target apartment configuration.", "Try translating the below regex into plain English:", "All we need to do before we can analyse our data is to write a loop that loops through n pages of apartments while appending each page\u2019s data onto some master dataset. We will then subset this master dataset for apartments that match our desired apartment configuration. Describing this process is not the focus of this article so I will simply provide my final code at the end of this article.", "Weekly rent for two-bedroom, one-bathroom and one car space apartments varied significantly within months.", "Some possible reasons for what is driving this are these:", "My apartment is quite old, and about 10 minutes away from the train station. It is by no means exceptional so I felt that a \u201ctypical\u201d price would best describe my apartment\u2019s \u201ctrue\u201d weekly rent. So I played around with some smoothing methods.", "I personally love using LOESS via ggplot\u2019s geom_smooth().", "However, I didn\u2019t want to have to explain to my real estate agent how LOESS works. So I settled on a quarterly median rental price. Not as simple as taking an average. But I thought the median was appropriate given the outliers and that it would be easy to explain if I were questioned about my choice of statistic.", "So I put this into an email:", "1. Rent was increased last year by $20 per week and this appears to be in excess of the market rate at the time (more on this below).", "2. I have performed a review of the data myself and have found that the current rent we pay is fair:", "* I have used webscraping to collect data on 346 newly rented \u201ctwo bedroom, one bathroom, one car space\u201d apartments in Ashfield from January-2016 to August-2017. Rent ranges from ~$400 per week for older apartments to +$600 per week for brand new apartments.", "* Since January 2017, median rent prices appear to be hovering ust above or just below the $500 mark (please see the below chart). In fact, the median rent per week over this period is $495 per week.", "* I have cross-checked this with the latest Housing NSW Rent and Sales report. The median rent for a 2 bedroom apartment in Ashfield is $500 over the last quarter. It makes sense that the median is slightly higher than my number as Housing NSW data would include apartments with more than one bathroom or more than one car spot.", "* When our rent was raised to $500 per week last year, median prices were hovering at about $480 per week. I have cross-checked this with the Housing NSW Rent and Sales report for December and can confirm this to be accurate.", "I never got a reply to this email. Instead, I received a contract for the same weekly rent for the next 12 months!", "Data is powerful, so learn how to use it. Go and save some money, people!", "Originally published at https://embracingtherandom.com on September 1, 2018.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Hello, world! My name is Justin. I solve problems using data. Check me out at embracingtherandom.com and linkedin.com/in/justin-m-evans/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffc93925ca11b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@eustin.jvans?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Justin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F14d6f9d6ed51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&user=Justin&userId=14d6f9d6ed51&source=post_page-14d6f9d6ed51----fc93925ca11b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.facs.nsw.gov.au/resources/statistics/rent-and-sales", "anchor_text": "reports"}, {"url": "https://www.auhouseprices.com/", "anchor_text": "AuHousePrices"}, {"url": "https://www.auhouseprices.com/rent/list/NSW/2131/Ashfield/1/?sort=date&type=apartment&bmin=2&bmax=2", "anchor_text": "https://www.auhouseprices.com/rent/list/NSW/2131/Ashfield/1/?sort=date&type=apartment&bmin=2&bmax=2"}, {"url": "https://www.auhouseprices.com/rent/list/NSW/2131/Ashfield/2/?sort=date&type=apartment&bmin=2&bmax=2", "anchor_text": "https://www.auhouseprices.com/rent/list/NSW/2131/Ashfield/2/?sort=date&type=apartment&bmin=2&bmax=2"}, {"url": "https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/", "anchor_text": "rvest"}, {"url": "https://magrittr.tidyverse.org/", "anchor_text": "piping operator from magrittr"}, {"url": "https://dplyr.tidyverse.org/", "anchor_text": "dplyr"}, {"url": "https://selectorgadget.com/", "anchor_text": "SelectorGadget"}, {"url": "https://cran.r-project.org/web/packages/stringr", "anchor_text": "stringr"}, {"url": "https://embracingtherandom.com/r/web-scraping/rent-scraping/", "anchor_text": "https://embracingtherandom.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----fc93925ca11b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/r?source=post_page-----fc93925ca11b---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/scraping?source=post_page-----fc93925ca11b---------------scraping-----------------", "anchor_text": "Scraping"}, {"url": "https://medium.com/tag/personal-finance?source=post_page-----fc93925ca11b---------------personal_finance-----------------", "anchor_text": "Personal Finance"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&user=Justin&userId=14d6f9d6ed51&source=-----fc93925ca11b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&user=Justin&userId=14d6f9d6ed51&source=-----fc93925ca11b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffc93925ca11b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fc93925ca11b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fc93925ca11b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fc93925ca11b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fc93925ca11b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eustin.jvans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Justin"}, {"url": "https://medium.com/@eustin.jvans/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "56 Followers"}, {"url": "http://embracingtherandom.com", "anchor_text": "embracingtherandom.com"}, {"url": "http://linkedin.com/in/justin-m-evans/", "anchor_text": "linkedin.com/in/justin-m-evans/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F14d6f9d6ed51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&user=Justin&userId=14d6f9d6ed51&source=post_page-14d6f9d6ed51--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F14d6f9d6ed51%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frent-scraping-how-i-saved-money-using-r-fc93925ca11b&user=Justin&userId=14d6f9d6ed51&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}