{"url": "https://towardsdatascience.com/save-the-date-ad964b2397d0", "time": 1683013244.30653, "path": "towardsdatascience.com/save-the-date-ad964b2397d0/", "webpage": {"metadata": {"title": "Save The Date. How to generate missing dates in SQL\u2026 | by Amirk | Towards Data Science", "h1": "Save The Date", "description": "Data integrity is one of the most important things we need to address before performing calculations over our data. Even with all the right intentions, we can sometimes miss that there is an error in\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Data integrity is one of the most important things we need to address before performing calculations over our data. Even with all the right intentions, we can sometimes miss that there is an error in our data. This can become very difficult when the mistake is not in the data we have but in the data we don\u2019t have.", "When performing a calculation that takes into account the number of samples in our data (calculating an average or median value) we need to address rows where the value is NULL or zero.", "Let\u2019s assume we run an online shop and want to see the average amount of daily purchases a customer makes over a month. In dates in which a customer doesn\u2019t make any purchases we won\u2019t have an indication for that in our data. If we ignore this issue and calculate the average amount of purchases for each customer, we will get an overestimate.", "If we calculate the customer\u2019s daily average purchase amount without looking at our raw data, we would think his average purchase amount is 1.4 (what a customer!).", "To overcome this issue, we must generate and match between all dates to all customers. Via Presto SQL we can do this in a simple query:", "Using SEQUENCE, we will create an array with the dates in our range and preform a cross join between each element in the array to the array itself. The result is a column with a row for each of the different dates.", "A quick alternative could be to extract all the different dates regardless of customer from our initial data and store it as a WITH AS statement as well.", "Next, we will preform another cross join in order to match between our customers and the different dates in order to fill in the missing ones:", "Last, we will join the table with the new matches between customer and dates to the initial table with our data.", "The strong table should be the new table we created with customer and dates while the left joined table should be our initial data. If we perform an inner join we will lose all of the dates that had no purchases. Also, we need to make sure not to put conditions in the where clause that address columns in the left joined table, this will turn the left join to an inner join.", "Now we can calculate the average daily purchase amount, the right way.", "1. Using SEQUENCE, we can create an array with a range of dates and turn them into a table. This method is effective for filling missing dates in our data to make sure that dates in which nothing happened will still appear.", "2. When performing a left join between two tables having conditions in the where clause that address columns from the left table, will turn the left join to an inner join. It\u2019s easy to miss this and you should always think twice when applying conditions in the same query with a join between tables.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fad964b2397d0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@amirk_45397?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@amirk_45397?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Amirk"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F689527b8d9db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&user=Amirk&userId=689527b8d9db&source=post_page-689527b8d9db----ad964b2397d0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/presto?source=post_page-----ad964b2397d0---------------presto-----------------", "anchor_text": "Presto"}, {"url": "https://medium.com/tag/sql?source=post_page-----ad964b2397d0---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ad964b2397d0---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----ad964b2397d0---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data?source=post_page-----ad964b2397d0---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&user=Amirk&userId=689527b8d9db&source=-----ad964b2397d0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&user=Amirk&userId=689527b8d9db&source=-----ad964b2397d0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fad964b2397d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ad964b2397d0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ad964b2397d0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ad964b2397d0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ad964b2397d0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@amirk_45397?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@amirk_45397?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Amirk"}, {"url": "https://medium.com/@amirk_45397/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F689527b8d9db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&user=Amirk&userId=689527b8d9db&source=post_page-689527b8d9db--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9216cd4855ef&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsave-the-date-ad964b2397d0&newsletterV3=689527b8d9db&newsletterV3Id=9216cd4855ef&user=Amirk&userId=689527b8d9db&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}