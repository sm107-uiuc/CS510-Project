{"url": "https://towardsdatascience.com/mounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b", "time": 1683014344.0532548, "path": "towardsdatascience.com/mounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b/", "webpage": {"metadata": {"title": "Mounting & accessing ADLS Gen2 in Azure Databricks using Service Principal and Secret Scopes | by Dhyanendra Singh Rathore | Towards Data Science", "h1": "Mounting & accessing ADLS Gen2 in Azure Databricks using Service Principal and Secret Scopes", "description": "A guide on how to mount and access Azure Data Lake Storage (ALDS) Gen2 from Azure Databricks Python notebook with Azure Key Vault-backed Secret Scopes and Service Principal."}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/dhyans/", "anchor_text": "LinkedIn", "paragraph_index": 28}, {"url": "https://dhyanintech.medium.com/membership", "anchor_text": "Medium", "paragraph_index": 28}], "all_paragraphs": ["Azure Data Lake Storage and Azure Databricks are unarguably the backbones of the Azure cloud-based data analytics systems. Azure Data Lake Storage provides scalable and cost-effective storage, whereas Azure Databricks provides the means to build analytics on that storage.", "The analytics procedure begins with mounting the storage to Databricks distributed file system (DBFS). There are several ways to mount Azure Data Lake Store Gen2 to Databricks. Perhaps one of the most secure ways is to delegate the Identity and access management tasks to the Azure AD.", "This article looks at how to mount Azure Data Lake Storage to Databricks authenticated by Service Principal and OAuth 2.0 with Azure Key Vault-backed Secret Scopes.", "Caution: Microsoft Azure is a paid service, and following this article can cause financial liability to you or your organization.", "At the time of writing, Azure Key Vault-backed Secret Scopes is in \u2018Public Preview.\u2019 It is recommended not to use any \u2018Preview\u2019 feature in production or critical systems.", "If you don\u2019t have prerequisites set up yet, refer to our previous article to get started:", "To access resources secured by an Azure AD tenant (e.g., storage accounts), a security principal must represent the entity that requires access. A security principal defines the access policy and permissions for a user or an application in the Azure AD tenant. When an application is permitted to access resources in a tenant (e.g., upon registration), a service principal object is created automatically.", "Let\u2019s begin by registering an Azure AD application to create a service principal and store our application authentication key in the Azure Key Vault instance.", "Find and select Azure Active Directory on the Azure Portal home page. Select App registrations and click + New registration.", "On the Register an application page, enter the name ADLSAccess, signifying the purpose of the application, and click Register.", "In the ADLSAccess screen, copy the Application (client) ID and the Directory (tenant) ID into notepad. Application ID refers to the app we just registered (i.e., ADLSAccess), and the Azure AD tenant our app ADLSAccess is registered to is the Directory ID.", "Next, we need to generate an authentication key (aka application password or client secret or application secret) to authenticate the ADLSAccess app. Click on Certificates and secrets, and then click + New client secret. On the Add a client secret blade, type a description, and expiry of one year, click Add when done.", "When you click on Add, the client secret (authentication key) will appear, as shown in the image below. You only have one opportunity to copy this key-value into notepad. You will not be able to retrieve it later if you perform another operation or leave this blade.", "Next, we need to assign an access role to our service principal (recall that a service principal is created automatically upon registering an app) to access data in our storage account. Go to the Azure portal home and open the resource group in which your storage account exists. Click Access Control (IAM), on Access Control (IAM) page, select + Add and click Add role assignment. On the Add role assignment blade, assign the Storage Blob Data Contributor role to our service principal (i.e., ADLSAccess), as shown below.", "Go to the Azure portal home and open your key vault. Click Secrets to add a new secret; select + Generate/Import. On Create a secret blade; give a Name, enter the client secret (i.e., ADLS Access Key we copied in the previous step) as Value and a Content type for easier readability and identification of the secret later. Repeat the creation process for the Application (client) ID and the Directory (tenant) ID we copied earlier. Your vault should have three secrets now.", "Select Properties, copy the Vault URI and Resource ID to notepad; we will need them in the next step.", "If you\u2019ve followed our another article on creating a Secret Scope for Azure SQL Server credentials, you don\u2019t have to perform this step as long as your key vault and Databricks instance in question remains the same.", "Go to https://<DATABRICKS-INSTANCE>#secrets/createScopeand replace <DATABRICKS-INSTANCE> with your actual Databricks instance URL. Create a Secret Scope, as shown below.", "Finally, it\u2019s time to mount our storage account to our Databricks cluster. Head back to your Databricks cluster and open the notebook we created earlier (or any notebook, if you are not following our entire series).", "We will define some variables to generate our connection strings and fetch the secrets using Databricks utilities. You can copy-paste the below code to your notebook or type it on your own. We\u2019re using Python for this notebook. Run your code using controls given at the top-right corner of the cell. Don\u2019t forget to replace the variable assignments with your storage details and secret Names.", "Further reading on Databricks utilities (dbutils) and accessing secrets:", "Further reading on how to use notebooks efficiently:", "We can override the default language of a notebook by specifying the language magic command at the beginning of a cell. The supported magic commands are %python, %r, %scala, and %sql. Notebooks also support few additional magic commands like %fs, %sh, and %md. We can use %fs ls to list the content of our mounted store.", "Don\u2019t forget to unmount your storage when you no longer need it.", "Congratulations! You\u2019ve successfully mounted your storage account to Databricks without revealing and storing your application secrets and access keys.", "We looked at how to register a new Azure AD application to create a service principal, assigned access roles to a service principal, and stored our secrets to Azure Key Vault. We created an Azure Key Vault-backed Secret Scope in Azure Dataricks and securely mounted and listed the files stored in our ADLS Gen2 account in Databricks.", "If you\u2019re curious to know how we got those CSV files in our storage, please head to our other article to set up an innovative Azure Data Factory pipeline to copy files over HTTP from a GitHub repository.", "We have another exciting article on connecting and accessing the Azure Synapse analytic data warehouse from Datarbricks. Take a look:", "Let\u2019s be friends! You can find me on LinkedIn or join me on Medium.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Analytics Expert. Data and BI Professional. Owner of Everyday BI. Private consultation - dhyan.singh@everydaybi.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F96e5c3d6008b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dhyanintech.medium.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": ""}, {"url": "https://dhyanintech.medium.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Dhyanendra Singh Rathore"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb038ca7c0471&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&user=Dhyanendra+Singh+Rathore&userId=b038ca7c0471&source=post_page-b038ca7c0471----96e5c3d6008b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markuswinkler", "anchor_text": "Markus Winkler"}, {"url": "https://unsplash.com/?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://dhyanintech.medium.com/disclaimer-disclosure-terms-of-use-fb3bfbd1e0e5", "anchor_text": "https://dhyanintech.medium.com/disclaimer-disclosure-terms-of-use-fb3bfbd1e0e5"}, {"url": "https://medium.com/@dhyanintech/a-definitive-guide-to-turn-csv-files-into-power-bi-visuals-using-azure-4483cf406eab", "anchor_text": "A definitive guide to turn CSV files into Power BI visuals using AzureA step-by-step guide to turning COVID-19 data into stunning Power BI visuals using Microsoft Azure offerings.medium.com"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals", "anchor_text": "Apps & service principals in Azure AD \u2014 Microsoft identity platformThis article describes application registration, application objects, and service principals in Azure Active Directory\u2026docs.microsoft.com"}, {"url": "https://docs.databricks.com/dev-tools/databricks-utils.html#secrets-utilities", "anchor_text": "Databricks UtilitiesDatabricks Utilities (DBUtils) make it easy to perform powerful combinations of tasks. You can use the utilities to\u2026docs.databricks.com"}, {"url": "https://docs.databricks.com/notebooks/notebooks-use.html", "anchor_text": "Use notebooksA notebook is a collection of runnable cells (commands). When you use a notebook, you are primarily developing and\u2026docs.databricks.com"}, {"url": "https://medium.com/@dhyanintech/using-azure-data-factory-to-incrementally-copy-files-based-on-url-pattern-over-http-569476b625fc", "anchor_text": "Using Azure Data Factory to incrementally copy files based on URL pattern over HTTPAn innovative Azure Data Factory pipeline to copy multiple files, incrementally, over HTTP from a third-party web\u2026medium.com"}, {"url": "https://medium.com/@dhyanintech/a-credential-safe-way-to-connect-and-access-azure-synapse-analytics-in-azure-databricks-1b008839590a", "anchor_text": "A credential-safe way to connect and access Azure Synapse Analytics in Azure DatabricksA guide on how to setup SQL Server firewall and connect from Databricks using Secret Scopes in PySparkmedium.com"}, {"url": "https://www.linkedin.com/in/dhyans/", "anchor_text": "LinkedIn"}, {"url": "https://dhyanintech.medium.com/membership", "anchor_text": "Medium"}, {"url": "https://medium.com/tag/secret-scope?source=post_page-----96e5c3d6008b---------------secret_scope-----------------", "anchor_text": "Secret Scope"}, {"url": "https://medium.com/tag/azure-databricks?source=post_page-----96e5c3d6008b---------------azure_databricks-----------------", "anchor_text": "Azure Databricks"}, {"url": "https://medium.com/tag/service-principal?source=post_page-----96e5c3d6008b---------------service_principal-----------------", "anchor_text": "Service Principal"}, {"url": "https://medium.com/tag/mount?source=post_page-----96e5c3d6008b---------------mount-----------------", "anchor_text": "Mount"}, {"url": "https://medium.com/tag/azure-data-lake-store?source=post_page-----96e5c3d6008b---------------azure_data_lake_store-----------------", "anchor_text": "Azure Data Lake Store"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&user=Dhyanendra+Singh+Rathore&userId=b038ca7c0471&source=-----96e5c3d6008b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&user=Dhyanendra+Singh+Rathore&userId=b038ca7c0471&source=-----96e5c3d6008b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F96e5c3d6008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----96e5c3d6008b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----96e5c3d6008b--------------------------------", "anchor_text": ""}, {"url": "https://dhyanintech.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dhyanintech.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dhyanendra Singh Rathore"}, {"url": "https://dhyanintech.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "258 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb038ca7c0471&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&user=Dhyanendra+Singh+Rathore&userId=b038ca7c0471&source=post_page-b038ca7c0471--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbd8cfa4cf694&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmounting-accessing-adls-gen2-in-azure-databricks-using-service-principal-and-secret-scopes-96e5c3d6008b&newsletterV3=b038ca7c0471&newsletterV3Id=bd8cfa4cf694&user=Dhyanendra+Singh+Rathore&userId=b038ca7c0471&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}