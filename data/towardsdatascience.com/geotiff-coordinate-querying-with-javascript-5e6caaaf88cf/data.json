{"url": "https://towardsdatascience.com/geotiff-coordinate-querying-with-javascript-5e6caaaf88cf", "time": 1683013298.4752388, "path": "towardsdatascience.com/geotiff-coordinate-querying-with-javascript-5e6caaaf88cf/", "webpage": {"metadata": {"title": "GeoTIFF Coordinate Querying with JavaScript | by Thomas Horner | Towards Data Science", "h1": "GeoTIFF Coordinate Querying with JavaScript", "description": "If you\u2019re building a geospatial application in Node.js or clientside JavaScript, you may need to eventually extract data from a raster at a specific coordinate \u2014 or a large number of them. This\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["If you\u2019re building a geospatial application in Node.js or clientside JavaScript, you may need to eventually extract data from a raster at a specific coordinate \u2014 or a large number of them. This historically hasn\u2019t been very straightforward in JavaScript, as the most common format for geospatial rasters is the GeoTIFF file type, which cannot be easily parsed.", "There are a few solutions available, and with recent advances in the JavaScript language and Node ecosystem, this is no longer the technological hurdle it used to be.", "Before JavaScript had any real ability to parse GeoTIFF files \u2014 unless you rolled your own wrappers around a lower-level programming language \u2014 your best bet was to call another application via exec(), such as a python script or command-line utility. One that immediately comes to mind is gdallocationinfo , which is part of the GDAL suite and can be used to query a raster using a latitude and longitude, like so:", "If you\u2019re just querying a point in a raster, this approach is good enough. However, there are some issues:", "As a real-world example, using this approach to query a point across 60 GeoTIFF files with hundreds of bands apiece required about ten seconds of processing time on a reasonably fast computer. Multiple points would quickly add up to an unreasonable amount of time.", "If calling the shell script and loading the file is most of the overhead, then why not use the gdal npm package which provides bindings for the library? As of September 2020, this was also not a very good option, mostly because it requires GDAL version 2 (current version is 3.1), so if you have GDAL installed on your machine or server you are going to have to do some difficult version juggling to make it work, if you can even make it build from source in the first place. It also does not provide asynchronous bindings, meaning you have to set up web workers if you don\u2019t want your thread to be blocked (this is problematic if running a Node.js server, depending on how much processing you intend to do).", "This library has been around for 4\u20135 years and reached version 1.0.0 just a few months ago. Not only does GeoTIFF.js provide reading and writing functionality for the eponymous file type, it does so with built-in asynchronous capabilities and even a web worker pool for more serious processing tasks.", "One thing the library does not do natively is provide a simple means for querying a geographic coordinate in a raster, so you will need to write this functionality yourself. However, it is quite easy once you extract the geographic metadata from the GeoTIFF.", "First, load the GeoTIFF and its associated image. For best results, make sure it has been projected to WGS84 first. If you keep the file in memory, you will not deal with the overhead of reading it repeatedly from disk, as small as it may be:", "Now, grab the geographic information and calculate a few numbers that you\u2019ll use to figure out which pixel corresponds to a given latitude and longitude:", "Bounding box data is stored as [xMin, yMin, xMax, yMax]. We can now take the coordinate and figure out which pixel it corresponds to:", "Note that the heightPct has been inverted as the origin for this weather model is in the lower left corner. Some weather models have it in the upper right corner. You will probably need to write some code to determine whether to invert the heightPct based on that fact.", "Now what? You can of course, extract the entire raster from the image. For smaller images, this is great, and you can keep the entire array of data in memory, which is very cheap and quick to query. However, if you are working with a large raster and/or a lot of bands, this is going to take a very long time and quite a bit of memory.", "Luckily, GeoTIFF.js provides a method to extract a raster using a bounding box \u2014 so we\u2019ll just use a bounding box that is one pixel by one pixel. This turns out to be pleasantly quick, even on very large rasters with lots of bands (also, GeoTIFF.js has support for tiled rasters \u2014 tiling large rasters should improve performance further, but I haven\u2019t tested it.):", "You now have an array of all the bands at this specific point.", "Note that you can have readRasters use a pool of web workers, which adds multi-threading potential, but with such tiny bounding boxes, the overhead of spinning up a new web worker drastically decreases performance, so it\u2019s not recommended for this approach.", "How does the GeoTIFF.js query logic stack up against a call to gdallocationinfo? This can depend a bit on how many files you are opening (especially repeatedly), but my results, both experimentally and in practice, have been decisive. On a solid state drive, I queried the same raster (about 500px by 200px, with 250 bands) using the same latitude and longitude and recorded the elapsed milliseconds.", "This method seems to experience random hiccups every few runs that are detrimental to its overall processing time. This has been noted across my development computer in addition to my servers.", "Not only was this library slightly quicker than a call to gdallocationinfo, performance was very consistent, nearly halving the average processing time.", "Using this technique, I was able to improve the performance of a JavaScript weather forecasting algorithm nearly threefold, as it reads from about 60 GeoTIFFs and thousands of bands. With gdallocationinfo, this typically took around ten seconds. After switching to the above technique using GeoTIFF.js, the algorithm runs in just under three seconds. These days, with some additional caching techniques, my production server is retrieving forecasts generated off a couple thousand raster bands in less than a second \u2014 performance can only likely be seriously improved by moving to a full binary or some other more compiled solution.", "Of course, there are other external libraries that read GeoTIFF data, but it doesn\u2019t seem likely that invoking them with exec() will provide much of an edge over GeoTIFF.js, especially since you will be unable to keep the GeoTIFF images or the data itself (as a raw numeric array) cached within your JavaScript application.", "Yes, you could always read from GeoTIFFs in a language or framework actually suited for working with this data, but this paradigm is beginning to change. JavaScript continues to grow and mature, servers built in Node.js are becoming more common, and implementing something like a browser-based weather model analysis application is no longer a pipe dream. You may need to use this technique. Maybe you\u2019ll come up with something even quicker, and if so, I\u2019d love to hear it!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5e6caaaf88cf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@potion_cellar?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Thomas Horner"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9e4260fa5487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&user=Thomas+Horner&userId=9e4260fa5487&source=post_page-9e4260fa5487----5e6caaaf88cf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/gis?source=post_page-----5e6caaaf88cf---------------gis-----------------", "anchor_text": "GIS"}, {"url": "https://medium.com/tag/geospatial-data?source=post_page-----5e6caaaf88cf---------------geospatial_data-----------------", "anchor_text": "Geospatial Data"}, {"url": "https://medium.com/tag/web-development?source=post_page-----5e6caaaf88cf---------------web_development-----------------", "anchor_text": "Web Development"}, {"url": "https://medium.com/tag/nodejs?source=post_page-----5e6caaaf88cf---------------nodejs-----------------", "anchor_text": "Nodejs"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&user=Thomas+Horner&userId=9e4260fa5487&source=-----5e6caaaf88cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&user=Thomas+Horner&userId=9e4260fa5487&source=-----5e6caaaf88cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5e6caaaf88cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5e6caaaf88cf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5e6caaaf88cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@potion_cellar?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thomas Horner"}, {"url": "https://medium.com/@potion_cellar/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "73 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9e4260fa5487&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&user=Thomas+Horner&userId=9e4260fa5487&source=post_page-9e4260fa5487--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3a6cac31d7db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fgeotiff-coordinate-querying-with-javascript-5e6caaaf88cf&newsletterV3=9e4260fa5487&newsletterV3Id=3a6cac31d7db&user=Thomas+Horner&userId=9e4260fa5487&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}