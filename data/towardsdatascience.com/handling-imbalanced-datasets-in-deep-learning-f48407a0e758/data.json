{"url": "https://towardsdatascience.com/handling-imbalanced-datasets-in-deep-learning-f48407a0e758", "time": 1682993957.602161, "path": "towardsdatascience.com/handling-imbalanced-datasets-in-deep-learning-f48407a0e758/", "webpage": {"metadata": {"title": "Handling Imbalanced Datasets in Deep Learning | by George Seif | Towards Data Science", "h1": "Handling Imbalanced Datasets in Deep Learning", "description": "Not all data is perfect. In fact, you\u2019ll be extremely lucky if you ever get a perfectly balanced real-world dataset. Most of the time, your data will have some level of class imbalance, which is when\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.superquotes.co/?utm_source=mediumtech&utm_medium=web&utm_campaign=sharing", "anchor_text": "Super Quotes newsletter", "paragraph_index": 0}, {"url": "https://arxiv.org/pdf/1708.02002.pdf", "anchor_text": "Focal Loss", "paragraph_index": 11}, {"url": "https://twitter.com/GeorgeSeif94", "anchor_text": "twitter", "paragraph_index": 17}, {"url": "https://www.linkedin.com/in/georgeseif/", "anchor_text": "LinkedIn", "paragraph_index": 17}], "all_paragraphs": ["Want to be inspired? Come join my Super Quotes newsletter. \ud83d\ude0e", "Not all data is perfect. In fact, you\u2019ll be extremely lucky if you ever get a perfectly balanced real-world dataset. Most of the time, your data will have some level of class imbalance, which is when each of your classes have a different number of examples.", "Before committing time to any potentially lengthy task in a Deep Learning project, it\u2019s important to understand why we should do it so that we can be sure it\u2019s a valuable investment. Class balancing techniques are only really necessary when we actually care about the minority classes.", "For example, let\u2019s say we are trying to predict whether or not we should buy a house based on the current state of the market, the house\u2019s attributes, and our budget. In this case it\u2019s very important that if we buy then it is the right decision since it\u2019s such a huge investment. At the same time it\u2019s not a really big deal if our model says not to buy when we should have. There will always be other houses to buy if we miss out on one, but making the wrong investment on such a huge asset would be really bad.", "In that example, we absolutely need our minority \u201cbuy\u201d class to be extremely accurate, while for our \u201cdon\u2019t buy\u201d class it\u2019s not such a big deal. Yet in a practical case, since buying will be far more rare than not buying in our data, our model will be biased to learning the \u201cdon\u2019t buy\u201d class very well since it has the most data and might perform poorly on the \u201cbuy\u201d class. That calls for balancing our data so that we can put more weight on the \u201cbuy\u201d predictions being correct!", "Now what about if we don\u2019t really care about the minority classes? For example, let\u2019s say we are doing image classification and your class distribution looks something like this:", "At first glance it may seem like balancing our data would help. But maybe we\u2019re not very interested in those minority classes. Perhaps our main goal is to get the highest possible percentage accuracy. In that case it doesn\u2019t really make sense to do any balancing since most of our percentage accuracy will come from the classes with more training examples. Secondly, categorical crossentropy losses tend to perform quite well when aiming for the highest percentage accuracy even when the dataset is imbalanced. All in all our minority classes don\u2019t contribute much to achieving our main goal, so balancing isn\u2019t necessary.", "With all of that being said, when we do encounter a case where we want to balance our data there are two techniques that we can use to help us out.", "Weight balancing balances our data by altering the weight that each training example carries when computing the loss. Normally, each example and class in our loss function will carry equal weight i.e 1.0. But sometimes we might want certain classes or certain training examples to hold more weight if they are more important. Referring again to our example of buying a house, since the accuracy of the \u201cbuy\u201d class is most important to us, training examples within that class should have significant effect on the loss function.", "We can give weight to the classes simply by multiplying the loss of each example by a certain factor depending on their class. In Keras we can do something like this:", "We created a dictionary that basically says our \u201cbuy\u201d class should hold 75% of the weight for the loss function since it is more important that the \u201cdon\u2019t buy\u201d class which we accordingly set to 25%. Of course these values can easily be tweaked to find the most optimal settings for your application. We can also use this method of balancing if one of our classes has significantly more examples than the other. Instead of spending time and resources trying to collect more for the minority class, we can try to use weight balancing to make all classes contribute equally to our loss.", "Another method which we can use to balance the weighting of our training examples is the Focal Loss shown below. Here\u2019s the main idea: in our dataset, we will naturally have some training examples that are easier to classify than others. During training, these examples will be classified with 99% accuracy, while other more challenging ones may still exhibit poor performance. The problem is that those easily classified training examples are still contributing to the loss. Why are we still giving them equal weight when there are other more challenging data points that if correctly classified can contribute much more to our overall accuracy?!", "And that\u2019s exactly the problem that the focal loss can address! Instead of giving equal weighting to all training examples, focal loss down-weights the well-classified examples. This has the net effect of putting more training emphasis on that data that is hard to classify! In a practical setting where we have a data imbalance, our majority class will quickly become well-classified since we have much more data for it. Thus, in order to insure that we also achieve high accuracy on our minority class, we can use the focal loss to give those minority class examples more relative weight during training. The focal loss can easily be implemented in Keras as a custom loss function:", "Selecting the proper class weights can sometimes be complicated. Doing a simple inverse-frequency might not always work very well. Focal loss can help, but even that will down-weight all well-classified examples of each class equally. Thus, another way to balance our data is by doing so directly, via sampling. Check out the image below for an illustration.", "In both the left and right side of the image above, our blue class has far more samples than the orange class. In this case, we have 2 pre-processing options which can help in the training of our Machine Learning models.", "Undersampling means we will select only some of the data from the majority class, only using as many examples as the minority class has. This selection should be done to maintain the probability distribution of the class. That was easy! We just evened out our dataset by just taking less samples!", "Oversampling means that we will create copies of our minority class in order to have the same number of examples as the majority class has. The copies will be made such that the distribution of the minority class is maintained. We just evened out our dataset without getting any more data! Sampling can be a good alternative to class balancing if you find that the class weights are difficult to set effectively.", "Follow me on twitter where I post all about the latest and greatest AI, Technology, and Science! Connect with me on LinkedIn too!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff48407a0e758&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f48407a0e758--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@george.seif94?source=post_page-----f48407a0e758--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@george.seif94?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "George Seif"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2af5c8737ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&user=George+Seif&userId=e2af5c8737ec&source=post_page-e2af5c8737ec----f48407a0e758---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.superquotes.co/?utm_source=mediumtech&utm_medium=web&utm_campaign=sharing", "anchor_text": "Super Quotes newsletter"}, {"url": "https://arxiv.org/pdf/1708.02002.pdf", "anchor_text": "Focal Loss"}, {"url": "https://twitter.com/GeorgeSeif94", "anchor_text": "twitter"}, {"url": "https://www.linkedin.com/in/georgeseif/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f48407a0e758---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f48407a0e758---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/technology?source=post_page-----f48407a0e758---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/tag/innovation?source=post_page-----f48407a0e758---------------innovation-----------------", "anchor_text": "Innovation"}, {"url": "https://medium.com/tag/science?source=post_page-----f48407a0e758---------------science-----------------", "anchor_text": "Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&user=George+Seif&userId=e2af5c8737ec&source=-----f48407a0e758---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&user=George+Seif&userId=e2af5c8737ec&source=-----f48407a0e758---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff48407a0e758&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f48407a0e758---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f48407a0e758--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f48407a0e758--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f48407a0e758--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f48407a0e758--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f48407a0e758--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@george.seif94?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@george.seif94?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "George Seif"}, {"url": "https://medium.com/@george.seif94/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "21K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2af5c8737ec&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&user=George+Seif&userId=e2af5c8737ec&source=post_page-e2af5c8737ec--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc78596234267&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandling-imbalanced-datasets-in-deep-learning-f48407a0e758&newsletterV3=e2af5c8737ec&newsletterV3Id=c78596234267&user=George+Seif&userId=e2af5c8737ec&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}