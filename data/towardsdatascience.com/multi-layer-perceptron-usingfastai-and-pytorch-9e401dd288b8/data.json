{"url": "https://towardsdatascience.com/multi-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8", "time": 1682994510.8873758, "path": "towardsdatascience.com/multi-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8/", "webpage": {"metadata": {"title": "Multi-Layer Perceptron using FastAI and PyTorch | by Aayush Agrawal | Towards Data Science", "h1": "Multi-Layer Perceptron using FastAI and PyTorch", "description": "In this blog, I am going to show you how to build a neural network(multilayer perceptron) using FastAI v1 and Pytorch and successfully train it to recognize digits in the image. Pytorch is a very\u2026"}, "outgoing_paragraph_urls": [{"url": "https://pytorch.org/", "anchor_text": "Pytorch", "paragraph_index": 0}, {"url": "https://docs.fast.ai/", "anchor_text": "FastAI v1", "paragraph_index": 0}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai", "paragraph_index": 0}, {"url": "https://github.com/fastai/fastai", "anchor_text": "fastai repo", "paragraph_index": 0}, {"url": "https://medium.com/@aayushmnit/building-neural-network-from-scratch-9c88535bf8e9", "anchor_text": "previous blog", "paragraph_index": 0}, {"url": "https://medium.com/@aayushmnit/multi-layer-perceptron-using-tensorflow-9f3e218a4809", "anchor_text": "another blog", "paragraph_index": 0}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/3_MLP_FastAI/MLP%20using%20Fast%20%20%26%20Pytorch.ipynb", "anchor_text": "Jupyter Notebook", "paragraph_index": 0}, {"url": "https://github.com/aayushmnit", "anchor_text": "Github", "paragraph_index": 0}, {"url": "https://course.fast.ai/datasets", "anchor_text": "fastai dataset", "paragraph_index": 3}, {"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block API", "paragraph_index": 7}, {"url": "https://docs.fast.ai/vision.transform.html", "anchor_text": "image transformation functions", "paragraph_index": 7}, {"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block API", "paragraph_index": 10}, {"url": "https://pytorch.org/tutorials/beginner/deep_learning_60min_blitz.html", "anchor_text": "DEEP LEARNING WITH PYTORCH: A 60 MINUTE BLITZ", "paragraph_index": 12}, {"url": "https://arxiv.org/pdf/1803.09820.pdf", "anchor_text": "Leslie Smith\u2019s paper", "paragraph_index": 13}, {"url": "https://arxiv.org/pdf/1803.09820.pdf", "anchor_text": "Leslie Smith\u2019s paper", "paragraph_index": 16}, {"url": "https://tqdm.github.io/", "anchor_text": "tqdm", "paragraph_index": 16}, {"url": "https://twitter.com/jeremyphoward", "anchor_text": "Jeremy Howard", "paragraph_index": 19}, {"url": "https://www.linkedin.com/in/aayushmnit/", "anchor_text": "LinkedIn", "paragraph_index": 20}, {"url": "http://aayushmnit.com", "anchor_text": "aayushmnit.com", "paragraph_index": 22}], "all_paragraphs": ["In this blog, I am going to show you how to build a neural network(multilayer perceptron) using FastAI v1 and Pytorch and successfully train it to recognize digits in the image. Pytorch is a very popular deep learning framework released by Facebook, and FastAI v1 is a library which simplifies training fast and accurate neural nets using modern best practices. It\u2019s based on research into deep learning best practices undertaken at fast.ai, including \u201cout of the box\u201d support for vision, text, tabular, and collab (collaborative filtering) models. If you\u2019re looking for the source code, head over to the fastai repo on GitHub. This notebook will guide for build a neural network with this library. If you want to understand what is a Multi-layer perceptron, you can look at my previous blog where I built a Multi-layer perceptron from scratch using numpy and another blog where I built the same model using TensorFlow. As you will notice, the amount of code which is needed to write this notebook is way less than what\u2019s been used in previous notebooks, all thanks to fastai library which lets us focus more on solving problems than writing code. This blog is also available as a Jupyter Notebook on my Github.", "It\u2019s standard practice to start the notebook with the following three lines; they ensure that any edits to libraries you make are reloaded here automatically, and also that any charts or images displayed are shown in this notebook.", "Let\u2019s import fastai library and define our batch_size parameter to 128. Usually, image databases are enormous, so we need to feed these images into a GPU using batches, batch size 128 means that we will feed 128 images at once to update parameters of our deep learning model. If you are running out of memory because of smaller GPU RAM, you can reduce batch size to 64 or 32.", "We will start by downloading MNIST handwritten dataset from fastai dataset page. MNIST is a standard dataset of small (28x28) handwritten grayscale digits, developed in the 1990s for testing the most sophisticated models of the day; today, often used as a basic \u201chello world\u201d for introducing deep learning. This fast.ai datasets version uses a standard PNG format instead of the special binary format of the original so that you can use the regular data pipelines in most libraries; if you want to use just a single input channel like the original, simply pick a single slice from the channels axis.", "By running the above command, the data is downloaded and stored in the path shown above. Let\u2019s look at how the data directory is set up as we have to import data from these directories. Let\u2019s start by looking at path directory, and we can see below that our data already have training and testing folder.", "Let\u2019s look inside the training folder. Data is split by digits 1 to 9 in a different folder.", "Within each digit folder, we have images.", "Now we have an understanding of how our data directory is set up; we will use FastAI amazing data block API to import data and FastAI image transformation functions to do data augmentation. Let\u2019s start by defining what transformation we want to do.", "In get_transforms function, we can define all the transformations we want to do. FastAI makes doing data augmentation incredibly easy as all the transformation can be passed in one function and uses an incredibly fast implementation. Let\u2019s look at each argument given in the function.", "Now that we have defined what transformation we want to do on our input images let\u2019s start by defining out data batches or databunch as FastAI will call it. Image data sets are massive in size, so we never want to import the entire dataset in memory, instead of that we define a databunch which will let us load batches of data and do required transformation on the fly.", "Jeremy Howard calls the above step as label engineering, as most of the time and effort is spent on importing data correctly. FastAI\u2019s data block API makes it drastically easy to define how we want to import our data using an R ggplots \u2018grammar of graphics\u2019like API where you can keep chaining different functions until you get your data bunch ready. Let\u2019s understand what the above code is doing -", "Now we have defined our databunch let\u2019s look have a peek at our data. As seen below you can see the digits are imported and visualized using show_batch function and notice that these images have our defined transformation applied.", "Now we have defined our databunch. Let\u2019s define our Multilayer perceptron model using Pytorch. For fully connected layers we used nn.Linear function and to apply non-linearity we use ReLU transformation. In Pytorch, we only need to define the forward function, and backward function is automatically defined using autograd. If you are new to Pytorch, they provide excellent documentation and tutorials. I would recommend you to go through this DEEP LEARNING WITH PYTORCH: A 60 MINUTE BLITZ tutorial, it will cover all the basics needed to understand what\u2019s happening below.", "So now we have defined our Model, we need to train it. We can use FastAI\u2019s Learner function which makes it easier to leverage modern enhancement in optimization methods and many other neat tricks like 1-Cycle style training as highlighted in Leslie Smith\u2019s paper for faster convergence. Let\u2019s define our Learner class -", "Let\u2019s understand what happening by the above arguments-", "Learner class provides provide a great function to find the ideal learning rate to start with while training your Deep learning model. Let\u2019s try to find the ideal learning rate.", "Ideally, we want to find the point where there is the maximum slope. In this case, that point is 1e-2. So we will start with 1e-2 as our learning rate and do five epochs using a fit_one_cycle function which uses a 1-cycle style training approach as highlighted in Leslie Smith\u2019s paper for faster convergence. Also, FastAI shows\u2019 tqdm style progress bar while training and at the end of training, it starts showing the table which shows the progress of loss functions and metrics we have defined on validation data.", "Let\u2019s lower are learning rate a bit further by lowering the learning rate and train the model a bit more.", "As we can see we are reaching 98.6% accuracy just by using simple Multilayer Perceptron.", "Fast.ai is an excellent initiative by Jeremy Howard and his team, and I believe fastai library can genuinely achieve the motive of democratizing deep learning to everyone by making building deep learning models super simple.", "I hope you enjoyed reading, and feel free to use my code to try it out for your purposes. Also, if there is any feedback on code or just the blog post, feel free to reach out on LinkedIn or email me at aayushmnit@gmail.com.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Experienced data scientist. Passionate about solving interesting problems with data. All views are my own unless you share them. More on aayushmnit.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9e401dd288b8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@aayushmnit?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Aayush Agrawal"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85dd669ac015&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&user=Aayush+Agrawal&userId=85dd669ac015&source=post_page-85dd669ac015----9e401dd288b8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pytorch.org/", "anchor_text": "Pytorch"}, {"url": "https://docs.fast.ai/", "anchor_text": "FastAI v1"}, {"url": "https://www.fast.ai/", "anchor_text": "fast.ai"}, {"url": "https://github.com/fastai/fastai", "anchor_text": "fastai repo"}, {"url": "https://medium.com/@aayushmnit/building-neural-network-from-scratch-9c88535bf8e9", "anchor_text": "previous blog"}, {"url": "https://medium.com/@aayushmnit/multi-layer-perceptron-using-tensorflow-9f3e218a4809", "anchor_text": "another blog"}, {"url": "https://github.com/aayushmnit/Deep_learning_explorations/blob/master/3_MLP_FastAI/MLP%20using%20Fast%20%20%26%20Pytorch.ipynb", "anchor_text": "Jupyter Notebook"}, {"url": "https://github.com/aayushmnit", "anchor_text": "Github"}, {"url": "https://course.fast.ai/datasets", "anchor_text": "fastai dataset"}, {"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block API"}, {"url": "https://docs.fast.ai/vision.transform.html", "anchor_text": "image transformation functions"}, {"url": "https://docs.fast.ai/data_block.html", "anchor_text": "data block API"}, {"url": "https://pillow.readthedocs.io/en/3.1.x/reference/Image.html#PIL.Image.Image.convert", "anchor_text": "convert"}, {"url": "https://pytorch.org/tutorials/beginner/deep_learning_60min_blitz.html", "anchor_text": "DEEP LEARNING WITH PYTORCH: A 60 MINUTE BLITZ"}, {"url": "https://arxiv.org/pdf/1803.09820.pdf", "anchor_text": "Leslie Smith\u2019s paper"}, {"url": "https://pytorch.org/docs/stable/nn.html?highlight=loss%20crossentropy#torch.nn.CrossEntropyLoss", "anchor_text": "cross entropy loss"}, {"url": "https://arxiv.org/pdf/1803.09820.pdf", "anchor_text": "Leslie Smith\u2019s paper"}, {"url": "https://tqdm.github.io/", "anchor_text": "tqdm"}, {"url": "https://twitter.com/jeremyphoward", "anchor_text": "Jeremy Howard"}, {"url": "https://www.linkedin.com/in/aayushmnit/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----9e401dd288b8---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----9e401dd288b8---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----9e401dd288b8---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----9e401dd288b8---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----9e401dd288b8---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&user=Aayush+Agrawal&userId=85dd669ac015&source=-----9e401dd288b8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&user=Aayush+Agrawal&userId=85dd669ac015&source=-----9e401dd288b8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9e401dd288b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9e401dd288b8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9e401dd288b8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9e401dd288b8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9e401dd288b8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@aayushmnit?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Aayush Agrawal"}, {"url": "https://medium.com/@aayushmnit/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "414 Followers"}, {"url": "http://aayushmnit.com", "anchor_text": "aayushmnit.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F85dd669ac015&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&user=Aayush+Agrawal&userId=85dd669ac015&source=post_page-85dd669ac015--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8137fc02bcb8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmulti-layer-perceptron-usingfastai-and-pytorch-9e401dd288b8&newsletterV3=85dd669ac015&newsletterV3Id=8137fc02bcb8&user=Aayush+Agrawal&userId=85dd669ac015&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}