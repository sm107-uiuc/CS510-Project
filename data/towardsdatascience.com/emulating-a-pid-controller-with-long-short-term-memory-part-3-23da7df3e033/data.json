{"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "time": 1683015457.134279, "path": "towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033/", "webpage": {"metadata": {"title": "Emulating a PID Controller with Long Short-term Memory: Part 3 | by Nicholas Lewis | Towards Data Science", "h1": "Emulating a PID Controller with Long Short-term Memory: Part 3", "description": "Welcome to part 3 of this project! By now, your employer is looking at your results and saying \u201cso what?\u201d You\u2019ve done a lot of legwork in getting things going, but so far it just looks nice on a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "code", "paragraph_index": 1}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "emperature Control Lab", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08", "anchor_text": "Part 1", "paragraph_index": 5}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Part 2", "paragraph_index": 6}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "here", "paragraph_index": 17}], "all_paragraphs": ["Welcome to part 3 of this project! By now, your employer is looking at your results and saying \u201cso what?\u201d You\u2019ve done a lot of legwork in getting things going, but so far it just looks nice on a computer. Well, here\u2019s the \u201cso what\u201d part. Here\u2019s where we finally get to implement this LSTM neural network to emulate the behavior of the PID controller. As a quick recap, here\u2019s where we\u2019ve been and where we\u2019re going:", "As always, feel free to run the code on your own, ideally with the Temperature Control Lab so you can see live data.", "Although we checked the LSTM controller output last time, we still want to practice safety first. We don\u2019t want to debug our control loop while running something as sensitive as a reactor temperature. So, to start, we\u2019ll keep our PID controller, but also compute the LSTM controller output. This allows us to see what the LSTM controller that we programmed does in comparison to the PID controller, and also debug it.", "You\u2019re familiar with this by now, but setting up the run requires just a few tweaks:", "First thing you\u2019ll notice is we loaded our model and preprocessing parameters from our training run. It\u2019s important that these match, otherwise the results will be awful, or won\u2019t work at all. I\u2019m running for 30 minutes, since I just need to see enough to be convinced that it works rather than trying to generate enough quality data to train the LSTM. I also have two separate heater arrays, one to store the PID output and one to store the LSTM output. Finally, I put my temperature setpoint back to room temperature for the last 2 minutes. Normally you don\u2019t need to worry about this, but since I\u2019m doing 2 runs right in a row, this lets the second run start from close to room temperature without waiting a few extra minutes in between runs.", "The control loop we program will be the same as what we had for the PID controller (see Part 1 for a refresher, if needed), only now we also want to see what the LSTM controller would output as well. I already put this in a function lstm(T1_m,Tsp_m), but I suggest putting it straight in the code at first for debugging. T1_m is the temperature of sensor 1 for the LSTM model, which we\u2019ll be reading at each time point, and Tsp_m is the setpoint temperature for the LSTM model. Let\u2019s take a look at what we do with it.", "First, calculate the error, being sure it\u2019s the same way we calculated it when training the LSTM in Part 2.", "Next, we need to put the data we have into the format expected by the LSTM, so putting it in an array in the same way we did in Part 2, scaling it, and reshaping it.", "Now we have the input data, we can call the model.predict() function to get the heater output. Recall that this is a scaled value, which isn\u2019t much use to our actual heater, so we undo the scaling for the real-world value.", "And finally, like we noticed in Part 2 when we trained, there are times the LSTM will predict a value outside the valid [0,100] range, so we\u2019ll just limit the possible output values.", "I hope you can see why I decided to test this out and debug it before putting it in place!", "One last thing to do when we\u2019re in the control loop. Recall that we specified a certain window of data points to use as a history for the LSTM input. We have to wait until we have that number of data points before we can feed anything in to the LSTM controller. That\u2019s a potential drawback of this emulator, and one reason why you\u2019d want to keep that window decently low. However, after that initial window passes, it\u2019s smooth sailing. Here\u2019s what the final implementation looks like in a control loop:", "I also saved some snapshots of the controller behaviors as we went, and put them into a video. Let\u2019s see how it worked.", "Pretty amazing! Remember that the blue line (PID) is what\u2019s actually controlling the heater, the green (LSTM) is just for reference. It doesn\u2019t match exactly, and I wouldn\u2019t necessarily expect it to. The LSTM controller looks like it tends to be a bit more aggressive in dropping the heater value, which might result in a bit more overshoot in real life. It also tends to have a lower output in general, but since high temperatures tend to be more dangerous, I\u2019m glad to see that it\u2019s more conservative. Overall, it looks like we have it programmed right, so I\u2019d trust the LSTM to run the heater output values to control the temperature. Let\u2019s see what that looks like next.", "And now, what we\u2019ve been waiting for! Let\u2019s turn the controller over to the LSTM. There\u2019s really nothing new here, but for the sake of completion, here\u2019s what my code looks like for using the LSTM to control the heater output, emulating the PID controller behavior.", "Wow. I don\u2019t know about you, but this is exciting stuff here. We successfully replicated the behavior of a PID controller with an LSTM neural network, and were able to use that on completely new data in real-time to control the temperature. This is why machine learning is so exciting!", "Of course, you probably notice a few areas for improvement. The controller had a hard time around the middle of the run getting the temperature all the way up to 70\u00b0C. We could always tweak the hyperparameters in the LSTM model, and it never hurts to have more training data (what other ideas might improve the fidelity of the LSTM controller to the PID controller?). But even though the LSTM controller didn\u2019t match the PID controller exactly, it still accomplished the goal of emulating the behavior, and that on its own is exciting!", "At this point, your boss is still wondering \u201cso what?\u201d What\u2019s the point of this, if the PID controller already does exactly what we want? That\u2019s what we have coming up, so stick around for some more exciting exploration! As always, feel free to follow along with the code here, hopefully on your own TCLab that you can run at your desk!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F23da7df3e033&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://nrlewis929.medium.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702----23da7df3e033---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@jplenio?utm_source=medium&utm_medium=referral", "anchor_text": "Johannes Plenio"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/@nrlewis929/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08", "anchor_text": "Using the Temperature Control Lab to create Proportional-Integral-Derivative controller data"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Training a Long Short-term Memory neural network in Keras to emulate a PID controller"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b", "anchor_text": "Practical applications of temperature control using LSTM controller instead of PID controller"}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "code"}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "emperature Control Lab"}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08", "anchor_text": "Part 1"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Part 2"}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "here"}, {"url": "https://medium.com/tag/lstm?source=post_page-----23da7df3e033---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----23da7df3e033---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----23da7df3e033---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pid-controller?source=post_page-----23da7df3e033---------------pid_controller-----------------", "anchor_text": "Pid Controller"}, {"url": "https://medium.com/tag/lstm-control-emulation?source=post_page-----23da7df3e033---------------lstm_control_emulation-----------------", "anchor_text": "Lstm Control Emulation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----23da7df3e033---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----23da7df3e033---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F23da7df3e033&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----23da7df3e033---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----23da7df3e033--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----23da7df3e033--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----23da7df3e033--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----23da7df3e033--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----23da7df3e033--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://nrlewis929.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "214 Followers"}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "https://www.linkedin.com/in/nicholas-lewis-0366146b/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9c6ec087b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033&newsletterV3=a4cd35f7b702&newsletterV3Id=9c6ec087b148&user=Nicholas+Lewis&userId=a4cd35f7b702&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}