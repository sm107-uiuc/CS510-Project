{"url": "https://towardsdatascience.com/handwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3", "time": 1683005381.3383949, "path": "towardsdatascience.com/handwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3/", "webpage": {"metadata": {"title": "Handwriting to Text Conversion using Time Distributed CNN and LSTM with CTC Loss Function | by Gireesh Sundaram | Towards Data Science", "h1": "Handwriting to Text Conversion using Time Distributed CNN and LSTM with CTC Loss Function", "description": "This post is part of the project that we did as the capstone for the Indian School of Business\u2019s Business Analytics Program Co\u2019 Summer 2019 and sponsored by Jan Elaaj. The motivation of the project\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.isb.edu/ampba/admissions", "anchor_text": "Business Analytics Program", "paragraph_index": 0}, {"url": "https://janelaaj.com/home", "anchor_text": "Jan Elaaj", "paragraph_index": 0}, {"url": "http://www.robots.ox.ac.uk/~vgg/software/via/via_demo.html", "anchor_text": "VGG image annotator", "paragraph_index": 3}, {"url": "https://keras.io/layers/wrappers/", "anchor_text": "TimeDistributed", "paragraph_index": 5}, {"url": "https://keras.io/examples/conv_lstm/", "anchor_text": "CRNN", "paragraph_index": 6}, {"url": "https://towardsdatascience.com/intuitively-understanding-connectionist-temporal-classification-3797e43a86c", "anchor_text": "Connectionist Temporal Categorical", "paragraph_index": 8}, {"url": "https://en.wikipedia.org/wiki/Levenshtein_distance", "anchor_text": "Levenshtein distance", "paragraph_index": 10}, {"url": "https://www.linkedin.com/in/gireeshsundaram/", "anchor_text": "Gireesh Sundaram", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/balaji-venktesh-6a3a5321/", "anchor_text": "Balaji Venktesh", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/soumya-panigrahi-69a107127/", "anchor_text": "Soumya Panigrahi", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/vineet-kapoor-/", "anchor_text": "Vineet Kapoor", "paragraph_index": 13}], "all_paragraphs": ["This post is part of the project that we did as the capstone for the Indian School of Business\u2019s Business Analytics Program Co\u2019 Summer 2019 and sponsored by Jan Elaaj.", "The motivation of the project comes from the fact that a lot of people still prefer to write on paper with pen and if digitized it adds a lot of value to be stored in long term and uses it for the downstream system for analysis. One such example is in the field of medicine, in India most of the doctors still write the patient prescription in a paper, and our sponsor needed to digitize it so that it can be put into the patient health records system. Through this project, we demonstrate how to train a Handwriting Recognition system with labeled data. Specifically, we train a deep convolution recurrent neural network (CRNN) system on manually labeled text-line data from a specific doctor prescription datasets and propose an incremental training procedure that covers the rest of the data as and when available to perform at the highest level of accuracy for the model to be able to adapt to individual doctor\u2019s handwriting.", "This project consists of multiple segments as mentioned below:", "This is the first and most time-consuming step of the project. We tried and evaluated multiple tools for this purpose, and found VGG image annotator by Oxford best for our purpose. This tool allows us to select areas in the prescription by drawing bounding boxes for the words, and by entering an annotation corresponding to the area selected. Once the annotation is done, we will be able to download the annotation in CSV format for further processing in Python. The downloaded file presents information like the region of annotation in x and y coordinates, the file name, and the region attributes, which is the actual annotation of the word itself. This is how a sample annotation looks like:", "This is performed with the help of OpenCV library in python. The raw image is read in its original resolution by the process. It is then converted into a greyscale value. Since for the input of the handwriting recognition system, it does not matter if we give the image in the greyscale values or in three channels. Once this is done, then the contours in the image are identified. The contours are helpful in identifying the boundaries for the pixels having the same color or intensity. After the bounding boxes are drawn, we then crop the image to take out the individual line segmented image.In the process of getting the proper line segmented data, we ignore all the images which have height bounding boxes below a certain threshold limit. By experimentation, we found that using a value of 64 gives us the desired output.Also, it is very important to preserve the order of the images obtained. For this, we ensure that we read the images from contours based on the starting pixel value of the image. Thereby the images will be read from the top left corner to the bottom right corner.", "We used Keras wrapper TimeDistributed to feed the CNN layers. What this does is it takes different frames of the input and processed it frame by frame. Then frames of 64 x 64 pixels images are obtained from the input image with a stride of 4 for each subsequent frame. The sliding window is applied in the direction of the writing which is from left to right. Keras TimeDistributed wrapper is used for passing the frames of input to the CNN layers. TimeDistributed wrapper is helpful in preserving the temporal sequence of the frames of images that we get from the input. Essentially the input and the output will look like this:", "The core of this project is a deep CRNN which is inspired by VGG16 architecture. We use stacked 13 convolution layers followed by three bidirectional LSTMs consisting of 256 units in each of the directions. Max pooling is applied after some convolution layers, a total of 5 max-pooling layers are applied. To introduce non-linearity in the convolution layers, the activation function ReLU is used. The weights of the convolution layers are initialized to he-normal and also batch normalization layers are used after all of the convolution layers to normalize the weights, which will be helpful in faster convergence of the network. The dropout rate for the training is set to 0.25 in each of the LSTM layers. There is a dense layer between the output of the CNN and the input of the LSTMs, which is very effective in reducing the number of parameters that are used for our training.", "We set the total number of output classes that are applicable for our problem to 91 (A-Z, a-z, 0\u20139, all standard special characters on an English keyboard, plus one additional class for unknown). Hence the last layer of the neural network had 91 weights for each output of the LSTM frame. The softmax layer is used in the final layer to get the output class which has the highest probability in a frame.", "The objective function which is used to minimize the loss is the Connectionist Temporal Categorical (CTC) loss function. While other loss function optimized single objective function, the CTC loss is specially designed to optimize both the length of the predicted sequence and the classes of the predicted sequence, as the input image varying in nature. The convolution filters and the LSTM weights are jointly learned within the back-propagation procedure. Adam optimizer is used for the training with an initial learning rate of 0.001.", "The models were trained on GPU servers taken from google cloud services. The system configurations are 32GB RAM, 8 core processor, and 4 Tesla K80 GPUs.", "The metrics that is used to track the performance of the network is Levenshtein distance (also known as edit distance), which is a commonly used metrics to measure the string metrics by measuring the difference between the observed sequence and the predicted sequence.", "For this we built a vocabulary of all the words in the input. The CTC loss function does not actually give the entire word correctly as there is an overlap between the frames fed using the TimeDistributed wrapper. Since a single alphabet could be in multiple frames, the output will contain repetition of words. So we have to use edit distance as metric to find out what is the nearest word in our entire corpus which matches closest to the word given as output.", "Putting all the pieces together, the output of the model worked with 0.75 accuracy to predict the test dataset and about 0.80 on the training dataset. The predictions will be fed to the CRNN line by line and the output of the CTC layer will be matched with the closest word in our corpus for the prediction to be checked with actual words using the edit distance metric.Furthermore, we wanted to experiment with RESNET architecture for the CNN layers instead of the VGG-16 architecture that was initially chosen for the project, but retraining from the scratch will be very time and resource-consuming since the capstone was ending, we did not have the opportunity to do so.As for the practical use of the project, we wanted to integrate this with an inscription pad, on which you can place a piece of paper and write, and in the backend, our system will automatically fragment the whole page into lines, lines into words and feed to CRNN architecture and will automatically give out the words corresponding to the handwritten letters.", "Authored by: Gireesh Sundaram, Balaji Venktesh, Soumya Panigrahi, Vineet Kapoor", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa784dccc8ec3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@GireeshS?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@GireeshS?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Gireesh Sundaram"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f36d05fc750&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&user=Gireesh+Sundaram&userId=4f36d05fc750&source=post_page-4f36d05fc750----a784dccc8ec3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@nickmorrison?utm_source=medium&utm_medium=referral", "anchor_text": "Nick Morrison"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.isb.edu/ampba/admissions", "anchor_text": "Business Analytics Program"}, {"url": "https://janelaaj.com/home", "anchor_text": "Jan Elaaj"}, {"url": "http://www.robots.ox.ac.uk/~vgg/software/via/via_demo.html", "anchor_text": "VGG image annotator"}, {"url": "https://keras.io/layers/wrappers/", "anchor_text": "TimeDistributed"}, {"url": "https://keras.io/examples/conv_lstm/", "anchor_text": "CRNN"}, {"url": "https://towardsdatascience.com/intuitively-understanding-connectionist-temporal-classification-3797e43a86c", "anchor_text": "Connectionist Temporal Categorical"}, {"url": "https://en.wikipedia.org/wiki/Levenshtein_distance", "anchor_text": "Levenshtein distance"}, {"url": "https://github.com/GireeshS22/Handwriting-CNN-LSTM", "anchor_text": "https://github.com/GireeshS22/Handwriting-CNN-LSTM"}, {"url": "https://www.linkedin.com/in/gireeshsundaram/", "anchor_text": "Gireesh Sundaram"}, {"url": "https://www.linkedin.com/in/balaji-venktesh-6a3a5321/", "anchor_text": "Balaji Venktesh"}, {"url": "https://www.linkedin.com/in/soumya-panigrahi-69a107127/", "anchor_text": "Soumya Panigrahi"}, {"url": "https://www.linkedin.com/in/vineet-kapoor-/", "anchor_text": "Vineet Kapoor"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a784dccc8ec3---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----a784dccc8ec3---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/lstm?source=post_page-----a784dccc8ec3---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a784dccc8ec3---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&user=Gireesh+Sundaram&userId=4f36d05fc750&source=-----a784dccc8ec3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&user=Gireesh+Sundaram&userId=4f36d05fc750&source=-----a784dccc8ec3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa784dccc8ec3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a784dccc8ec3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a784dccc8ec3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@GireeshS?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@GireeshS?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gireesh Sundaram"}, {"url": "https://medium.com/@GireeshS/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "74 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f36d05fc750&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&user=Gireesh+Sundaram&userId=4f36d05fc750&source=post_page-4f36d05fc750--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6872d1f72ac4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhandwriting-to-text-conversion-using-time-distributed-cnn-and-lstm-with-ctc-loss-function-a784dccc8ec3&newsletterV3=4f36d05fc750&newsletterV3Id=6872d1f72ac4&user=Gireesh+Sundaram&userId=4f36d05fc750&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}