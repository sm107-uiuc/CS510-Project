{"url": "https://towardsdatascience.com/utilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5", "time": 1683006292.1334221, "path": "towardsdatascience.com/utilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5/", "webpage": {"metadata": {"title": "Utilizing Endogenous Variables with Binary Cross-Entropy | by Taylor Hawks | Towards Data Science", "h1": "Utilizing Endogenous Variables with Binary Cross-Entropy", "description": "Recently, I was tasked with building a classifier using data that had an interesting endogenous variable \u2014 one that could be highly valuable in telling my model how to train. In this article, I\u2019m\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.statisticshowto.com/endogenous-variable/", "anchor_text": "endogenous variable", "paragraph_index": 0}], "all_paragraphs": ["Recently, I was tasked with building a classifier using data that had an interesting endogenous variable \u2014 one that could be highly valuable in telling my model how to train. In this article, I\u2019m going to walk through the steps I took, and you might be able to employ a similar strategy yourself. By the end, we\u2019ll have a way to use endogenous variables to train a model without worrying about its effects on model assumptions or taking any logical shortcuts. Plainly, using a separate piece of data that could not be included in the model, we can improve the model by telling it whether it made a good prediction retrospectively.", "Before starting, you should have a basic idea of how classification algorithms work and what a cost function does. Also, having some understanding of differential calculus will help with the last section.", "Binary cross-entropy, also known as log-loss, or logistic loss, is the cost function for logistic regression. Log-loss is also a popular loss function for classification with deep learning models, as well as tree ensemble models like XGBoost. \u201cBinary Cross-Entropy\u201d happens to be an especially fitting name for the method explored in this post, since we\u2019ll be taking full advantage of the separable nature of the equation.", "Above is the equation for binary cross-entropy written as a piecewise function.", "The further our prediction is from the actual value, the higher the value of the cost function.", "It can also be combined into one equation:", "Note that the equation simplifies to the pieces of the first function for y=1 and y=0, which are the only possible values of y.", "Loss Function, Cost Function, and Objective Function are often used interchangeably. \u201cLoss function\u201d refers to the loss associated with a single observation whereas \u201cCost\u201d refers to an entire dataset. \u201cObjective function\u201d is just a more general term for a function to be minimized or maximized.", "In a classification model, the goal is to find model parameters to optimize p, minimizing this function for all observations. To do so, we need to use the gradient of the function, and sometimes also the hessian. These are found by taking the first and second derivatives with respect to the model parameters, respectively.", "The gradient and hessian for log-loss are given below. We\u2019ll return to this later and dig into the math a bit more after discussing a modified version of the original cost function.", "An endogenous variable is a variable that is dependent on the output of a model. Typically, people might refer to the target variable of a model as the endogenous variable, but in some cases, there can be more than one.", "For example, if a model predicts whether someone buys a pet dog, whether they name the dog \u201cChunky\u201d would be dependent on whether or not they bought the dog. Two problems arise if we try to use the dog being named Chunky as a variable in the \u201cwill this person buy a dog\u201d model.", "Think about that second point for a moment\u2026 an individual\u2019s willingness to name their dog Chunky could have a lot to say about that person and their affinity for dogs in the first place. We\u2019ll return to this concept in a bit.", "What you\u2019ll notice about the four examples so far is that sometimes the variable is quantifiable, and sometimes not. For example, you could measure zero inches of rain, but you can\u2019t get the length of a speech that didn\u2019t happen. There are different ways to impute the missing values, but that\u2019s taking on assumptions that aren\u2019t necessary and adding unnecessary caveats to our prediction. In the next section, we\u2019ll discuss a general solution.", "Let\u2019s take another look a the rainfall example. A model that predicts \u201cno rain\u201d when the truth is that it rained half an inch is quantifiably less wrong than a model that predicts \u201cno rain\u201d when it actually rains six inches. It might be a good idea to use this information to improve the model.", "Sometimes, the relationship isn\u2019t quite so clear, but if a relationship between the endogenous variable and the target variable can be rationalized and mathematically formulated, then it could be worked into the cost function.", "This would \u201cpunish\u201d a model more than predicts an outcome that\u2019s more wrong than one that\u2019s less wrong, producing a higher or lower output for the cost function accordingly.", "Modifying the cost function will change the minima and slopes of the error surface for the model parameters. This means that convergence may occur where model parameters are better generalized since the model now incorporates additional information.", "In some cases, it might be valid to predict the endogenous variable in question and then establish a decision boundary thereafter to predict the original target variable. However, some problems may arise:", "Another thought might be to instrument some modified value for y using the endogenous variable, but you must consider what this does to the cost function. Values will be undefined using the original cost function if p>1.", "Since binary cross-entropy can be treated like a piecewise function, we can modify just one piece of the equation. We\u2019ll add a scaling factor, s, which is a function of our endogenous variable, for cases where y=1. This scaling factor is a function of the endogenous variable in question, taking a value of 1 for fairly neutral cases, high values when the cost should be higher, and low values when the cost should be lower.", "What this ends up doing is penalizing the model more or less depending on the value of the endogenous variable. Now it\u2019s not just about whether the estimate is wrong, but there\u2019s another factor at play for certain cases. You can excuse cases where you could say something like \u201cThis estimate is technically wrong, but I don\u2019t care because of this other factor, so I don\u2019t want the model to change as significantly.\u201d In essence, this is what changing the cost function does.", "Now we can see that it actually doesn\u2019t matter what we impute for the values of our missing endogenous variable since it\u2019s mathematically irrelevant for cases where y=0. This still holds true when converting the original function to a non-piecewise function.", "Some machine learning libraries, as well as any custom gradient descent implementations, will require the calculation of the gradient of a cost function. Sometimes, the hessian is required as well.", "Now we\u2019ll calculate the gradient and hessian of this modified version of binary cross-entropy.", "This simplifies to the original gradient for cases where s=1, and where y=0. We\u2019ve now found the first derivative of our modified cost function, which is needed for basic gradient descent algorithms.", "For more complex algorithms, we\u2019ll need the second derivative as well. Keep in mind we\u2019ve defined x to be the pre-transformation model output.", "This simplifies to the original hessian for cases where s=1, and where y=0.", "Just because a variable is endogenous does not mean it can\u2019t be used to improve a model. Here I\u2019ve laid out a proposal for tweaking logistic loss to incorporate data that typically wouldn\u2019t be used in a model, which can potentially improve results. It\u2019s still important to rationalize decisions about how these variables are being used, but there is plenty of room to experiment.", "This is a method I came up with on my own, having not come across similar solutions to the problem. Please share in the comments if you\u2019ve come across other resources on the topic!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa4320b586be5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a4320b586be5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@taylor.a.hawks?source=post_page-----a4320b586be5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@taylor.a.hawks?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Taylor Hawks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd32f9b879e73&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&user=Taylor+Hawks&userId=d32f9b879e73&source=post_page-d32f9b879e73----a4320b586be5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.statisticshowto.com/endogenous-variable/", "anchor_text": "endogenous variable"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a4320b586be5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/classification-algorithms?source=post_page-----a4320b586be5---------------classification_algorithms-----------------", "anchor_text": "Classification Algorithms"}, {"url": "https://medium.com/tag/model-optimization?source=post_page-----a4320b586be5---------------model_optimization-----------------", "anchor_text": "Model Optimization"}, {"url": "https://medium.com/tag/statistics?source=post_page-----a4320b586be5---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&user=Taylor+Hawks&userId=d32f9b879e73&source=-----a4320b586be5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&user=Taylor+Hawks&userId=d32f9b879e73&source=-----a4320b586be5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa4320b586be5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a4320b586be5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a4320b586be5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a4320b586be5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a4320b586be5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a4320b586be5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a4320b586be5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@taylor.a.hawks?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@taylor.a.hawks?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Taylor Hawks"}, {"url": "https://medium.com/@taylor.a.hawks/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7 Followers"}, {"url": "https://www.linkedin.com/in/taylor-hawks-1370705b/", "anchor_text": "https://www.linkedin.com/in/taylor-hawks-1370705b/"}, {"url": "https://github.com/taylorhawks", "anchor_text": "https://github.com/taylorhawks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd32f9b879e73&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&user=Taylor+Hawks&userId=d32f9b879e73&source=post_page-d32f9b879e73--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fd32f9b879e73%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Futilizing-endogenous-variables-with-binary-cross-entropy-a4320b586be5&user=Taylor+Hawks&userId=d32f9b879e73&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}