{"url": "https://towardsdatascience.com/you-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee", "time": 1683003019.3690891, "path": "towardsdatascience.com/you-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee/", "webpage": {"metadata": {"title": "You should try the new TensorFlow\u2019s TextVectorization layer. | by Stefano Frassetto | Towards Data Science", "h1": "You should try the new TensorFlow\u2019s TextVectorization layer.", "description": "This article treats a rather advanced topic, so if you\u2019re still a TensorFlow/NLP beginner, you may want to have a quick peek at TensorFlow 2 quickstart tutorial or a little refresher on\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/tutorials/quickstart/beginner", "anchor_text": "TensorFlow 2 quickstart tutorial", "paragraph_index": 0}, {"url": "https://www.tensorflow.org/tutorials/text/word_embeddings", "anchor_text": "WordEmbeddings", "paragraph_index": 0}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "recent release of", "paragraph_index": 1}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "Tensorflow 2.1", "paragraph_index": 1}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization?version=stable", "anchor_text": "TextVectorization", "paragraph_index": 1}, {"url": "https://colab.research.google.com/drive/1RvCnR7h0_l4Ekn5vINWToI9TNJdpUZB3", "anchor_text": "official TensorFlow\u2019s team Colab example", "paragraph_index": 25}, {"url": "https://github.com/tensorflow/serving", "anchor_text": "served model", "paragraph_index": 26}, {"url": "https://www.tensorflow.org/tfx/guide#developing_with_tfx", "anchor_text": "By doing so you will use the same preprocessing and analysis code consistently, and avoid differences between data used for training and data fed to your trained models in production, as well as benefitting from writing that code once.", "paragraph_index": 29}, {"url": "https://github.com/tensorflow/serving", "anchor_text": "Tensorflow Serving", "paragraph_index": 32}, {"url": "https://github.com/tensorflow/text/issues/210", "anchor_text": "chances are we will have the ability to export this layer soon with future TensorFlow releases", "paragraph_index": 32}, {"url": "https://github.com/tensorflow/community/blob/master/governance/api-reviews.md#experimental-apis", "anchor_text": "experimental", "paragraph_index": 33}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing?version=nightly", "anchor_text": "Keras Preprocessing Layers API", "paragraph_index": 33}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization", "anchor_text": "TensorFlow documentation", "paragraph_index": 34}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "official TensorFlow 2.1 release", "paragraph_index": 35}, {"url": "https://colab.research.google.com/drive/1RvCnR7h0_l4Ekn5vINWToI9TNJdpUZB3", "anchor_text": "end-to-end text classification example", "paragraph_index": 35}, {"url": "https://colab.research.google.com/drive/1YzCrpSl26ET56o_r-_u1Q1N504cBNRTq", "anchor_text": "this Google Colab notebook", "paragraph_index": 36}], "all_paragraphs": ["This article treats a rather advanced topic, so if you\u2019re still a TensorFlow/NLP beginner, you may want to have a quick peek at TensorFlow 2 quickstart tutorial or a little refresher on WordEmbeddings.", "With the recent release of Tensorflow 2.1, a new TextVectorization layer was added to the tf.keras.layers fleet.", "This layer has basic options for managing text in a Keras model. It transforms a batch of strings (one sample = one string) into either a list of token indices (one sample = 1D tensor of integer token indices) or a dense representation (one sample = 1D tensor of float values representing data about the sample\u2019s tokens).\u00b9", "The processing of each sample contains the following steps:", "1. standardize each sample (usually lowercasing + punctuation stripping) .", "2. split each sample into substrings (usually words) .", "3. recombine substrings into tokens (usually ngrams).", "4. index tokens (associate a unique int value with each token) .", "5.transform each sample using this index, either into a vector of ints or a dense float vector.\u00b9", "In its first step the data will go through a standardization\u00a0process. During this phase each text sample is cleaned up and transformed before further processing.", "You can control the standardization step with the standardize parameter of the TextVectorization layer. The possible values for this parameter are:", "If you\u2019ve chosen to pass your own Callable to the standardize parameter, there are just a few things you should be aware of:", "In this second step, each text sample will be splitted into substring tokens (normally words).", "Again, you can control the splitting behaviour with the split parameter available for the TextTokenization layer. The possible values are:", "Just as before, there are some limitations for what you can pass as a Callable :", "After splitting our text into tokens, we can decide how to recombine them before creating our vocabulary index. This basically means we can decide if just keeping all the tokens we\u2019ve gotten so far, or use ngrams combinations of them.", "We control this step with the ngrams parameter. Possible values are:", "This step lets you create a vocabulary for you, based on the recombined tokens obtained from the previous step. For this reason, you can specify a max_tokens integer parameter that will control the maximum size of the vocabulary for this layer, or simply leave the default None value for giving no cap size to the vocabulary.", "In order to actually build this index, you will need to call the layer\u2019s adapt method, which will fit the state of the preprocessing layer to the dataset. This also overrides the default adapt method to apply relevant preprocessing to the inputs, before passing it to the combiner.", "In case you want to set your own vocabulary (and document frequency, optionally), you can use the set_vocabulary method.", "This method sets the vocabulary and DF data for this layer directly, instead of analyzing a dataset through \u2018adapt\u2019. It should be used whenever the vocab (and optionally document frequency) information is already known. If vocabulary data is already present in the layer, this method will either replace it, if \u2018append\u2019 is set to False, or append to it (if \u2018append\u2019 is set to True).\u00b9", "The set_vocabulary method takes the following parameters:", "For the last step, the preprocessed data gets transformed and served in the desired flavour. There are four different output_mode options one could choose from:", "Moreover, there are two other parameters that will affect the output shape of your layer:", "Just like any other tf.keras layer, its usage is pretty straight forward. All you need to do is instantiating the layer, adaptit to your data, and then you\u2019ll be ready to slide it into your model layers stack.", "Once again, you really should have a look at the official TensorFlow\u2019s team Colab example, but in a nutshell:", "Up until now, while working on text based machine learning models, you probably had to decide an input preprocessing strategy: this basically means having to go through all the steps defined above for the TextTokenization layer all by yourself, fit your model on the preprocessed data, save it, then somehow reproducing the preprocessing steps at inference time, before passing them to the served model and get back some prediction.", "This could be done in a series of different ways, from implementing the whole preprocessing pipeline totally \u201coutside\u201d TensorFlow, to using the poweful tf.data api. Of course, there are ways to include your own operations into the exported graph too, and TensorFlow is flexible enough for you to implement your own preprocessing layer, but it\u2019s a long way to the top if you wanna rock\u2019n\u2019roll.", "What this layer gives you is the opportunity to include any text preprocessing logic into your model.", "By doing so you will use the same preprocessing and analysis code consistently, and avoid differences between data used for training and data fed to your trained models in production, as well as benefitting from writing that code once.\u00b2", "But here\u2019s where our dreams come to and end.", "Unfortunately, exporting a model including this layer is not implemented, yet.", "This means that using this layer in production is not yet a good idea, since you wouldn\u2019t be able to export your model and serve it with solutions like Tensorflow Serving. However, this layer is still marked as experimental, and chances are we will have the ability to export this layer soon with future TensorFlow releases.", "TensorFlow 2.3 adds experimental support for the new Keras Preprocessing Layers API. These layers allow you to package your preprocessing logic inside your model for easier deployment \u2014 so you can ship a model that takes raw strings, images, or rows from a table as input.", "A lot of what you found in this article was taken from the official TensorFlow documentation, which really has it all, dig it.", "For some general info, see the official TensorFlow 2.1 release, in which you will find a notebook that will guide you through an end-to-end text classification example using the TextVectorizationLayer\u00a0.", "Want more? Check out this Google Colab notebook I created as a playground!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa80b3c6b00ee&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@frassetto.stefano?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@frassetto.stefano?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Stefano Frassetto"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa1f02e9afcb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&user=Stefano+Frassetto&userId=a1f02e9afcb7&source=post_page-a1f02e9afcb7----a80b3c6b00ee---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.tensorflow.org/tutorials/quickstart/beginner", "anchor_text": "TensorFlow 2 quickstart tutorial"}, {"url": "https://www.tensorflow.org/tutorials/text/word_embeddings", "anchor_text": "WordEmbeddings"}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "recent release of"}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "Tensorflow 2.1"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization?version=stable", "anchor_text": "TextVectorization"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/utils/register_keras_serializable", "anchor_text": "register keras serializable"}, {"url": "https://github.com/tensorflow/tensorflow/issues/36071", "anchor_text": "None"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/utils/register_keras_serializable", "anchor_text": "register keras serializable"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/strings/split", "anchor_text": "tf.strings.split()"}, {"url": "https://colab.research.google.com/drive/1RvCnR7h0_l4Ekn5vINWToI9TNJdpUZB3", "anchor_text": "official TensorFlow\u2019s team Colab example"}, {"url": "https://github.com/tensorflow/serving", "anchor_text": "served model"}, {"url": "https://www.tensorflow.org/tfx/guide#developing_with_tfx", "anchor_text": "By doing so you will use the same preprocessing and analysis code consistently, and avoid differences between data used for training and data fed to your trained models in production, as well as benefitting from writing that code once."}, {"url": "https://github.com/tensorflow/serving", "anchor_text": "Tensorflow Serving"}, {"url": "https://github.com/tensorflow/text/issues/210", "anchor_text": "chances are we will have the ability to export this layer soon with future TensorFlow releases"}, {"url": "https://blog.tensorflow.org/2020/07/whats-new-in-tensorflow-2-3.html", "anchor_text": "TensorFlow Blog 2020\u201307\u201327"}, {"url": "https://github.com/tensorflow/community/blob/master/governance/api-reviews.md#experimental-apis", "anchor_text": "experimental"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing?version=nightly", "anchor_text": "Keras Preprocessing Layers API"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization", "anchor_text": "TensorFlow documentation"}, {"url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.1.0", "anchor_text": "official TensorFlow 2.1 release"}, {"url": "https://colab.research.google.com/drive/1RvCnR7h0_l4Ekn5vINWToI9TNJdpUZB3", "anchor_text": "end-to-end text classification example"}, {"url": "https://colab.research.google.com/drive/1YzCrpSl26ET56o_r-_u1Q1N504cBNRTq", "anchor_text": "this Google Colab notebook"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization", "anchor_text": "TextVectorization"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization", "anchor_text": "https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/TextVectorization"}, {"url": "https://www.tensorflow.org/tfx/guide#developing_with_tfx", "anchor_text": "Developing with TFX"}, {"url": "https://www.tensorflow.org/tfx/guide#developing_with_tfx", "anchor_text": "https://www.tensorflow.org/tfx/guide#developing_with_tfx"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----a80b3c6b00ee---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a80b3c6b00ee---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/nlp?source=post_page-----a80b3c6b00ee---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/tokenization?source=post_page-----a80b3c6b00ee---------------tokenization-----------------", "anchor_text": "Tokenization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&user=Stefano+Frassetto&userId=a1f02e9afcb7&source=-----a80b3c6b00ee---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&user=Stefano+Frassetto&userId=a1f02e9afcb7&source=-----a80b3c6b00ee---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa80b3c6b00ee&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a80b3c6b00ee---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a80b3c6b00ee--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@frassetto.stefano?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@frassetto.stefano?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stefano Frassetto"}, {"url": "https://medium.com/@frassetto.stefano/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "62 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa1f02e9afcb7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&user=Stefano+Frassetto&userId=a1f02e9afcb7&source=post_page-a1f02e9afcb7--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa1f02e9afcb7%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fyou-should-try-the-new-tensorflows-textvectorization-layer-a80b3c6b00ee&user=Stefano+Frassetto&userId=a1f02e9afcb7&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}