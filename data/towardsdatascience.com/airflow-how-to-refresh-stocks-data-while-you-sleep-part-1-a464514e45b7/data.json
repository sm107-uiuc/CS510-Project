{"url": "https://towardsdatascience.com/airflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7", "time": 1683010099.9200692, "path": "towardsdatascience.com/airflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7/", "webpage": {"metadata": {"title": "Airflow: How To Refresh Stock Market Data While You Sleep \u2014 Part 1 | by Antonello Benedetto | Towards Data Science", "h1": "Airflow: How To Refresh Stock Market Data While You Sleep \u2014 Part 1", "description": "In this introductory Apache Airflow tutorial, learn how to build a data pipeline to automatically extract, transform and load the stock prices and statistics you need for your projects."}, "outgoing_paragraph_urls": [{"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "Apache Airflow", "paragraph_index": 0}, {"url": "https://plotly.com/dash/", "anchor_text": "Dash", "paragraph_index": 2}, {"url": "https://github.com/anbento0490/code_tutorials/blob/master/Airflow%20Stock%20Prices%20ETL/stocks_analysis.py", "anchor_text": "GitHub account", "paragraph_index": 8}, {"url": "https://github.com/anbento0490/code_tutorials/tree/master/Airflow%20Stock%20Prices%20ETL", "anchor_text": "code_tutorials/Airflow Stock Prices ETL", "paragraph_index": 9}, {"url": "https://www.astronomer.io/guides/managing-dependencies/", "anchor_text": "dependencies", "paragraph_index": 22}, {"url": "https://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work", "anchor_text": "bit-shift", "paragraph_index": 22}, {"url": "https://airflow.apache.org/docs/1.10.1/concepts.html?highlight=xcom", "anchor_text": "documentation", "paragraph_index": 24}, {"url": "https://stackoverflow.com/questions/46059161/airflow-how-to-pass-xcom-variable-into-python-function", "anchor_text": "this is another excellent post", "paragraph_index": 26}, {"url": "http://0.0.0.0:8080/admin/", "anchor_text": "http://0.0.0.0:8080/admin/", "paragraph_index": 30}, {"url": "https://www.linkedin.com/in/anbento4/", "anchor_text": "https://www.linkedin.com/in/anbento4/", "paragraph_index": 38}], "all_paragraphs": ["Apache Airflow is a workflow management platform that allows users to programmatically schedule jobs that run on a standalone basis and to monitor them through its user interface. Airflow\u2019s main components are a Webserver (Airflow\u2019s UI build as a Flask App), a Scheduler, an Executor and a Metadata Database.", "As a BI Developer I worked close enough to data engineers to learn pretty early what Airflow was very good at, but I never really put the theory into practice until I started with side projects.", "In effect, while I was building an app to visualize stock prices and stock stats with Dash, I realized that every time I wanted data to be updated, I had to re-run the entire code manually. This process takes a very long time when you need to extract, manipulate and make available data for hundreds of stock tickers. I knew that if I wanted to scale up my project, I needed a tool to orchestrate the repetitive tasks behind the scenes while I was focused on building new interesting features.", "In the first part of this tutorial, I will show you how I eventually started to combine Python and Airflow to create an automated ETL pipeline that:", "But first let\u2019s activate a virtual environment and install Airflow.", "For this tutorial I\u2019ll assume you are familiar with virtual environments and that you are using Python 3.6 or above as I found the installation being buggy otherwise (simply use python -V if you wish to double check):", "Find below the bash commands that summarize what has been done so far:", "If you followed all the steps, you should now be ready to launch Airflow Webserver and Scheduler, but before that, you need to fill the stock_analysis.py file with a DAG.", "The full code I am going to use in this tutorial to refresh stock prices, set a DAG and its operators, is available on my GitHub account.", "If you are following along it\u2019s now time to edit the empty file with open stock_analysis.py and paste the entire Python script you find in the code_tutorials/Airflow Stock Prices ETL folder. After saving the changes and before doing anything else, make sure to install all the following packages in the environment:", "Airflow should now be able to recognize a valid DAG and you can easily check it with airflow list_dags :", "The screen above did not throw an error and you can tell that a DAG was in fact identified by the system because stock_analysis_ETL_7AM is exactly the name I assigned to the DAG:", "In effect, I would suggest to assign a meaningful name to your DAGs (following the convention project_name + process + schedule interval ) as it helps to visualize immediately which job you are looking at and when it is supposed to run and this adds clarity when dealing with multiple workflows.", "The code above tells Airflow when to schedule the job, what the job needs to accomplish and in which order. It can be split into three components, starting from the top:", "2. DAG Operators: for this tutorial, I am going to use three PythonOperators to run three Python functions. Each Python operator is a separate task that needs to be passed to Airflow Sequential Executor in order to achieve the expected result. Each task is identified by a task_id and in order to avoid confusion I would suggest for you to make sure that task name and task id always match. In my case the tasks are:", "If you run the function it should return something similar to this:", "Because I am going to use the stock_prices list as an input for the other two Python functions, this is is the first task that needs to be executed in the order. The task execution hierarchy is important as it will allow me not to download stock prices at each step, but to do it only once (at beginning), so that each task will run faster and the overall process will be more efficient.", "When the function is run, it displays the first 5 rows of the stock_plots_data DF:", "The output of the function above is a DF with 5 rows and 13 columns of which 11 are key statistics:", "3. Task Hierarchy \u2192 This is the last component of the DAG and it is used to specify the order according to which you wish for Airflow to execute the three tasks. In my case I opted for:", "Meaning that the fetch_prices_task will be executed first (it makes sense as it generates the stock_prices list that is then used in the other two tasks), followed by the stocks_plot_task and the stocks_table_task .", "In this case, you can also decide to combine the second and third tasks, since they are not dependent on each other:", "Note how in Airflow dependencies can be set syntactically (set_upstream() , set_downstream() ) or using bit-shift operators like I did.", "If you tried to test the functions as they are in a Python IDE, you probably noticed that they simply\u2026fail!. This is because in order for one task output to be called as an input in other tasks down the line, Airflow uses an inter-task communication Python class named XCom. Therefore I had to modify the original functions by adding:", "In effect, as the documentation (pretty concisely\u2026) explains, a task can make an output available by calling the xcom_push() method or simply by returning the output at the end of the function it calls (like I am doing with return stock_prices ).", "In a similar fashion, a task down the line can fetch that output by calling the xcom_pull() method specifying exactly the task from which the input should be retrieved ( task_ids ='fetch_prices_task' ).", "Yeah I know\u2026if you are using Airflow for the first time you might be wondering why you cannot just define stock_prices=[] outside the fetch_prices_function() and use it as a global list in the other two functions. The thing is that Airflow parses Python code all in one go, therefore it needs a more complex system for the tasks to \u201ccommunicate\u201d with each other. If you still have doubts on the topic this is another excellent post that helped me in the recent past.", "The Final Step: How to activate the Stocks Analysis ETL job", "Now that you have a grasp of what the code is doing and how a DAG is built, it\u2019s time to open two separate Bash windows. On the first window you should run the command to launch the Airflow Webserver:", "Whereas on the second window you should launch the Airflow Scheduler:", "If you navigate to the default http://0.0.0.0:8080/admin/ local address you will hopefully see the screen below:", "Airflow is correctly displaying the stocks_analysis_ETL_7AM DAG but in order for the process to start, the job needs to be switched on manually. As soon as you do that, Airflow Sequential Executor will immediately run all the three tasks according to their hierarchy:", "The dark-green color indicates that all the 3 tasks were successfully executed and you can verify it by clicking on Recent Tasks:", "This means that 2 updated CSV files containing stocks data have been saved to the specified location. If something went wrong and you wished to double-check the code, you can do that within the user interface by clicking on DAG_name > Code:", "Congratulations! If you were so motivated to get to the end of PART 1 of this Airflow tutorial, you should now be able to build your first ETL local pipeline and employ it to refresh data behind your personal projects. You have also learnt how to use the XCom class to dynamically connect tasks and I hope this knowledge will come handy as you start building more complex DAGs.", "In PART 2, I will show you how to deploy Airflow DAGs in production so that they can really run while you sleep, but before that, have a look at these last two suggestions:", "Please let me know if you liked the tutorial in the comments and I hope to see you in Part 2!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Engineer @Wise | \ud83c\udfc6 Among Top Writers In Engineering \ud83d\udcbb Trying To Be Good At Tough Sports\ud83c\udfca\ud83c\udffb \ud83d\udeb4\ud83c\udffd\ud83c\udfc3\ud83c\udffb Connect Via https://www.linkedin.com/in/anbento4/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa464514e45b7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://anbento4.medium.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": ""}, {"url": "https://anbento4.medium.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Antonello Benedetto"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2d93b58a0f8a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&user=Antonello+Benedetto&userId=2d93b58a0f8a&source=post_page-2d93b58a0f8a----a464514e45b7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@jsnbrsc?utm_source=medium&utm_medium=referral", "anchor_text": "Jason Briscoe"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "Apache Airflow"}, {"url": "https://plotly.com/dash/", "anchor_text": "Dash"}, {"url": "https://uk.finance.yahoo.com/most-active", "anchor_text": "Yahoo Finance"}, {"url": "https://en.wikipedia.org/wiki/Directed_acyclic_graph", "anchor_text": "Directed Acyclic Graph"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/index.html", "anchor_text": "official documentation"}, {"url": "https://github.com/apache/airflow/tree/master/airflow/example_dags", "anchor_text": "a long list of default DAG examples"}, {"url": "https://github.com/anbento0490/code_tutorials/blob/master/Airflow%20Stock%20Prices%20ETL/stocks_analysis.py", "anchor_text": "GitHub account"}, {"url": "https://unsplash.com/@adamaszczos?utm_source=medium&utm_medium=referral", "anchor_text": "Adam Nowakowski"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/anbento0490/code_tutorials/tree/master/Airflow%20Stock%20Prices%20ETL", "anchor_text": "code_tutorials/Airflow Stock Prices ETL"}, {"url": "https://github.com/anbento0490/code_tutorials/blob/master/Airflow%20Stock%20Prices%20ETL/stocks_analysis.py#L24", "anchor_text": "here"}, {"url": "https://www.astronomer.io/guides/managing-dependencies/", "anchor_text": "dependencies"}, {"url": "https://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work", "anchor_text": "bit-shift"}, {"url": "https://stackoverflow.com/questions/1769403/what-is-the-purpose-and-use-of-kwargs", "anchor_text": "keyword argument (**kwargs)"}, {"url": "https://airflow.apache.org/docs/1.10.1/concepts.html?highlight=xcom", "anchor_text": "documentation"}, {"url": "https://unsplash.com/@dnevozhai?utm_source=medium&utm_medium=referral", "anchor_text": "Denys Nevozhai"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://stackoverflow.com/questions/46059161/airflow-how-to-pass-xcom-variable-into-python-function", "anchor_text": "this is another excellent post"}, {"url": "http://0.0.0.0:8080/admin/", "anchor_text": "http://0.0.0.0:8080/admin/"}, {"url": "https://towardsdatascience.com/airflow-schedule-interval-101-bbdda31cc463", "anchor_text": "this article"}, {"url": "https://levelup.gitconnected.com/15-git-commands-you-should-learn-before-your-very-first-project-f8eebb8dc6e9", "anchor_text": "15 Git Commands To Master Before Your Very First ProjectThe last Git tutorial you are going to need to master version control at the command line.levelup.gitconnected.com"}, {"url": "https://towardsdatascience.com/8-popular-sql-window-functions-replicated-in-python-e17e6b34d5d7", "anchor_text": "8 Popular SQL Window Functions Replicated In PythonA tutorial on how to take advantage of Pandas in business analytics to efficiently replicate the most used SQL Window\u2026towardsdatascience.com"}, {"url": "https://medium.com/analytics-vidhya/connect-to-databases-using-python-and-hide-secret-keys-with-env-variables-a-brief-tutorial-4f68e33a6dc6", "anchor_text": "Hide Your Passwords Using Environment VariablesA tutorial on how to keep your secret keys hidden using environment variables while connecting to databases with Pythonmedium.com"}, {"url": "https://medium.com/tag/airflow?source=post_page-----a464514e45b7---------------airflow-----------------", "anchor_text": "Airflow"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----a464514e45b7---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a464514e45b7---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----a464514e45b7---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/programming?source=post_page-----a464514e45b7---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&user=Antonello+Benedetto&userId=2d93b58a0f8a&source=-----a464514e45b7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&user=Antonello+Benedetto&userId=2d93b58a0f8a&source=-----a464514e45b7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa464514e45b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a464514e45b7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a464514e45b7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a464514e45b7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a464514e45b7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a464514e45b7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a464514e45b7--------------------------------", "anchor_text": ""}, {"url": "https://anbento4.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://anbento4.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Antonello Benedetto"}, {"url": "https://anbento4.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.4K Followers"}, {"url": "https://www.linkedin.com/in/anbento4/", "anchor_text": "https://www.linkedin.com/in/anbento4/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2d93b58a0f8a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&user=Antonello+Benedetto&userId=2d93b58a0f8a&source=post_page-2d93b58a0f8a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7fbba797bc8f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fairflow-how-to-refresh-stocks-data-while-you-sleep-part-1-a464514e45b7&newsletterV3=2d93b58a0f8a&newsletterV3Id=7fbba797bc8f&user=Antonello+Benedetto&userId=2d93b58a0f8a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}