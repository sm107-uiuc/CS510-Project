{"url": "https://towardsdatascience.com/compression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb", "time": 1683015632.078061, "path": "towardsdatascience.com/compression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb/", "webpage": {"metadata": {"title": "Compression, search, interpolation, and clustering of images using machine learning | by Lak Lakshmanan | Towards Data Science", "h1": "Compression, search, interpolation, and clustering of images using machine learning", "description": "Embeddings in machine learning provide a way to create a concise, lower-dimensional representation of complex, unstructured data. Embeddings are commonly employed in natural language processing to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/how-to-create-a-concise-image-representation-using-machine-learning-20156c1e0c19", "anchor_text": "earlier article", "paragraph_index": 1}, {"url": "https://github.com/GoogleCloudPlatform/ml-design-patterns/blob/master/02_data_representation/weather_search/wx_embeddings.ipynb", "anchor_text": "full code is on GitHub", "paragraph_index": 4}], "all_paragraphs": ["Embeddings in machine learning provide a way to create a concise, lower-dimensional representation of complex, unstructured data. Embeddings are commonly employed in natural language processing to represent words or sentences as numbers.", "In an earlier article, I showed how to create a concise representation (50 numbers) of 1059x1799 HRRR images. In this article, I will show you that the embedding has some nice properties, and you can take advantage of these properties to implement use cases like compression, image search, interpolation, and clustering of large image datasets.", "First of all, does the embedding capture the important information in the image? Can we take an embedding and decode it back into the original image?", "Well, we won\u2019t be able to get back the original image, since we took 2 million pixels\u2019 values and shoved them into a vector of length=50. Still, does the embedding capture the important information in the weather forecast image?", "We can obtain the embedding for the timestamp and decode it as follows (full code is on GitHub). First, we create a decoder by loading the SavedModel, finding the embedding layer and reconstructing all the subsequent layers:", "Once we have the decoder, we can pull the embedding for the time stamp from BigQuery:", "This gives us a table like this:", "We can then pass the \u201cref\u201d values from the table above to the decoder:", "Note that TensorFlow expects to see a batch of inputs, and since we are passing in only one, I have to reshape it to be [1, 50]. Similarly, TensorFlow returns a batch of images. I squeeze it (remove the dummy dimension) before displaying it. The result?", "As you can see, the decoded image is a blurry version of the original HRRR. The embedding does retain key information. It functions as a compression algorithm.", "If the embeddings are a compressed representation, will the degree of separation in embedding space translate to the degree of separation in terms of the actual forecast images?", "If this is the case, it becomes easy to search for \u201csimilar\u201d weather situations in the past to some scenario in the present. Finding analogs on the 2-million-pixel representation can be difficult because storms could be slightly offset from each other, or somewhat vary in size.", "Since we have the embeddings in BigQuery, let\u2019s use SQL to search for images that are similar to what happened on Sep 20, 2019 at 05:00 UTC:", "Basically, we are computing the Euclidean distance between the embedding at the specified timestamp (refl1) and every other embedding, and displaying the closest matches. The result:", "This makes a lot of sense. The image from the previous/next hour is the most similar. Then, images from +/- 2 hours and so on.", "What if we want to find the most similar image that is not within +/- 1 day? Since we have only 1 year of data, we are not going to great analogs but let\u2019s see what we get:", "The result is a bit surprising: Jan. 2 and July 1 are the days with the most similar weather:", "Well, let\u2019s take a look at the two timestamps:", "We see that the Sep 20 image does fall somewhere between these two images. There is weather in Gulf Coast and upper midwest in both images. As it is in the Sep 20 image.", "We would probably get more meaningful search if we had (a) more than just one year of data (b) loaded HRRR forecast images at multiple time-steps instead of just the analysis fields, and (c) used smaller tiles so as to capture mesoscale phenomena. This is left as an exercise to interested meteorology students reading this :)", "Recall that when we looked for the images that were most similar to the image at 05:00, we got the images at 06:00 and 04:00 and then the images at 07:00 and 03:00. The distance to the next hour was on the order of sqrt(0.5) in embedding space.", "Given this behavior in the search use case, a natural question to ask is whether we can use the embeddings for interpolating between weather forecasts. Can we average the embeddings at t-1 and t+1 to get the one at t=0? What\u2019s the error?", "The result? sqrt(0.1), which is much less than sqrt(0.5). In other words, the embeddings do function as a handy interpolation algorithm.", "In order to use the embeddings as a useful interpolation algorithm, though, we need to represent the images by much more than 50 pixels. The information lost can not be this high. Again, this is left as an exercise to interested meteorologists.", "Given that the embeddings seem to work really well in terms of being commutative and additive, we should expect to be able to cluster the embeddings.", "Let\u2019s use the K-Means algorithm and ask for five clusters:", "The resulting centroids form a 50-element array:", "and we can go ahead and plot the decoded versions of the five centroids:", "Here are the resulting centroids of the 5 clusters:", "The first one seems to be your class midwestern storm. The second one consists of widespread weather in the Chicago-Cleveland corridor and the Southeast. The third one is a strong variant of the second. The fourth is a squall line marching across the Appalachians. The fifth is clear skies in the interior, but weather on the coasts.", "In order to use the clusters as a useful forecasting aid, though, you probably will want to cluster much smaller tiles, perhaps 500km x 500km tiles, not the entire CONUS.", "In all five clusters, it is raining in Seattle and sunny in California.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Feb65fcf0abbb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----eb65fcf0abbb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/how-to-create-a-concise-image-representation-using-machine-learning-20156c1e0c19", "anchor_text": "earlier article"}, {"url": "https://github.com/GoogleCloudPlatform/ml-design-patterns/blob/master/02_data_representation/weather_search/wx_embeddings.ipynb", "anchor_text": "full code is on GitHub"}, {"url": "https://github.com/GoogleCloudPlatform/ml-design-patterns/blob/master/02_data_representation/weather_search/wx_embeddings.ipynb", "anchor_text": "full code on GitHub"}, {"url": "https://towardsdatascience.com/how-to-convert-binary-files-into-tensorflow-records-3150d7236341", "anchor_text": "convert HRRR files into TensorFlow records"}, {"url": "https://towardsdatascience.com/how-to-create-a-concise-image-representation-using-machine-learning-20156c1e0c19", "anchor_text": "how to use autoencoders"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----eb65fcf0abbb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/embedding?source=post_page-----eb65fcf0abbb---------------embedding-----------------", "anchor_text": "Embedding"}, {"url": "https://medium.com/tag/image-processing?source=post_page-----eb65fcf0abbb---------------image_processing-----------------", "anchor_text": "Image Processing"}, {"url": "https://medium.com/tag/meteorology?source=post_page-----eb65fcf0abbb---------------meteorology-----------------", "anchor_text": "Meteorology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----eb65fcf0abbb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----eb65fcf0abbb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Feb65fcf0abbb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----eb65fcf0abbb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----eb65fcf0abbb--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcompression-search-interpolation-and-clustering-of-images-using-machine-learning-eb65fcf0abbb&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}