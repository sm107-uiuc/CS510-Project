{"url": "https://towardsdatascience.com/transformers-for-multilabel-classification-71a1a0daf5e1", "time": 1683008215.450608, "path": "towardsdatascience.com/transformers-for-multilabel-classification-71a1a0daf5e1/", "webpage": {"metadata": {"title": "Transformers for Multilabel Classification | Towards Data Science", "h1": "Transformers for Multi-Label Classification made simple.", "description": "How to use transformers such as BERT, XLNet, RoBERTa, etc, for multilabel classification using the Hugging Face library."}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/jigsaw-toxic-comment-classification-challenge/data", "anchor_text": "Toxic Comment Classification Challenge", "paragraph_index": 1}, {"url": "https://colab.research.google.com/github/rap12391/transformers_multilabel_toxic/blob/master/toxic_multilabel.ipynb", "anchor_text": "Google Colab notebook", "paragraph_index": 2}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Hugging Face\u2019s transformers library", "paragraph_index": 3}, {"url": "https://colab.research.google.com/github/rap12391/transformers_multilabel_toxic/blob/master/toxic_multilabel.ipynb", "anchor_text": "Google Colab notebook", "paragraph_index": 17}, {"url": "https://www.linkedin.com/in/ronak-anit-patel/", "anchor_text": "LinkedIn", "paragraph_index": 17}, {"url": "https://twitter.com/ratchetronak1", "anchor_text": "Twitter", "paragraph_index": 17}], "all_paragraphs": ["As a data scientist who has been learning the state of the art for text classification, I found that there are not many easy examples to adapt transformers (BERT, XLNet, etc.) for multilabel classification\u2026so I decided to try for myself and here it is!", "As an homage to other multilabel text classification blog posts, I will be using the Toxic Comment Classification Challenge dataset.", "This post is accompanied by an interactive Google Colab notebook so you can try this yourself. All you have to do is upload the train.csv, test.csv, and test_labels.csv files into the instance. Let\u2019s get started.", "In this tutorial I will be using Hugging Face\u2019s transformers library along with PyTorch (with GPU), although this can easily be adapted to TensorFlow \u2014 I may write a seperate tutorial for this later if this picks up traction along with tutorials for multiclass classification. Below I will be training a BERT model but I will show you how easy it is to adapt this code for other transformer models along the way.", "The toxic dataset is already cleaned and separated into train and test sets, so we can load the train set and use it directly.", "Each transformer model requires different tokenization encodings \u2014 meaning the way that the sentence is tokenized and attention masks are used may differ depending on the transformer model you use. Thankfully, HuggingFace\u2019s transformers library makes it extremely easy to implement for each model. In the code below we load a pretrained BERT tokenizer and use the method \u201cbatch_encode_plus\u201d to get tokens, token types, and attention masks. Feel free to load the tokenizer that suits the model you would like to use for prediction. e.g.,", "Next, we will use 10% of our training inputs as a validation set so we can monitor our classifier\u2019s performance as it is training. Here we want to make sure we utilize the \u201cstratify\u201d parameter so no unseen labels appear in the validation set. In order to stratify appropriately we will take all labels that only appear once in the dataset and force them into the training set. We will also need to create PyTorch data loaders to load the data for training/prediction.", "Loading the appropriate model can be done as shown below, each model already contains a single dense layer for classification on top.", "Optimizer params can configured in a few ways. Here we are using a customized optimization parameters (which I\u2019ve had more success with), however, you could just pass \u201cmodel.parameters( )\u201d as shown in the comments.", "The HuggingFace library is configured for multiclass classification out of the box using \u201cCategorical Cross Entropy\u201d as the loss function. Therefore, the output of a transformer model would be akin to:", "However, if we avoid passing in a labels parameter, the model will only output logits, which we can use to calculate our own loss for multilabel classification.", "Below is the code snippet of doing exactly that. Here we use \u201cBinary Cross Entropy With Logits\u201d as our loss function. We could have just as easily used standard \u201cBinary Cross Entropy\u201d, \u201cHamming Loss\u201d, etc.", "For validation, we will use micro F1 accuracy to monitor training performance across epochs. To do so we will have to utilize our logits from our model output, pass them through a sigmoid function (giving us outputs between [0, 1], and threshold them (at 0.50) to generate predictions. These predictions can then be used to calculate accuracy against the true labels.", "Viola! We\u2019re ready for training, now run it\u2026my train times ranged between 20\u201340 min per epoch depending on the max token length and the GPU at use.", "Prediction for our test set is similar to our validation set. Here we will be loading, preprocessing, and predicting with the test data.", "Creating a dataframe of outputs that show sentences and their classification.", "Iterating through threshold values to maximize Micro F1 Accuracy.", "That\u2019s it! Please comment if you have any questions. Here is the link to the Google Colab notebook again in case you missed it. If you have any personal inquiries feel free to contact me on LinkedIn or Twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer | Humanitarian \u2014 be easy"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F71a1a0daf5e1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ronakpatel12391?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ronakpatel12391?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Ronak Patel"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15fcba20ca4f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&user=Ronak+Patel&userId=15fcba20ca4f&source=post_page-15fcba20ca4f----71a1a0daf5e1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/c/jigsaw-toxic-comment-classification-challenge/data", "anchor_text": "Toxic Comment Classification Challenge"}, {"url": "https://colab.research.google.com/github/rap12391/transformers_multilabel_toxic/blob/master/toxic_multilabel.ipynb", "anchor_text": "Google Colab notebook"}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Hugging Face\u2019s transformers library"}, {"url": "https://colab.research.google.com/github/rap12391/transformers_multilabel_toxic/blob/master/toxic_multilabel.ipynb", "anchor_text": "Google Colab notebook"}, {"url": "https://www.linkedin.com/in/ronak-anit-patel/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/ratchetronak1", "anchor_text": "Twitter"}, {"url": "https://github.com/google-research/bert", "anchor_text": "https://electricenjin.com/blog/look-out-google-bert-is-here-to-shake-up-search-queries"}, {"url": "https://github.com/google-research/bert", "anchor_text": "https://github.com/google-research/bert"}, {"url": "https://github.com/huggingface/transformers", "anchor_text": "https://github.com/huggingface/transformers"}, {"url": "https://pytorch.org/docs/stable/nn.html#bcewithlogitsloss", "anchor_text": "https://pytorch.org/docs/stable/nn.html#bcewithlogitsloss"}, {"url": "https://arxiv.org/abs/1706.03762", "anchor_text": "https://arxiv.org/abs/1706.03762"}, {"url": "https://medium.com/tag/bert?source=post_page-----71a1a0daf5e1---------------bert-----------------", "anchor_text": "Bert"}, {"url": "https://medium.com/tag/xlnet?source=post_page-----71a1a0daf5e1---------------xlnet-----------------", "anchor_text": "Xlnet"}, {"url": "https://medium.com/tag/nlp?source=post_page-----71a1a0daf5e1---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/data-science?source=post_page-----71a1a0daf5e1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----71a1a0daf5e1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&user=Ronak+Patel&userId=15fcba20ca4f&source=-----71a1a0daf5e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&user=Ronak+Patel&userId=15fcba20ca4f&source=-----71a1a0daf5e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F71a1a0daf5e1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----71a1a0daf5e1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----71a1a0daf5e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ronakpatel12391?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ronakpatel12391?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ronak Patel"}, {"url": "https://medium.com/@ronakpatel12391/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "31 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F15fcba20ca4f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&user=Ronak+Patel&userId=15fcba20ca4f&source=post_page-15fcba20ca4f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc522b92814a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransformers-for-multilabel-classification-71a1a0daf5e1&newsletterV3=15fcba20ca4f&newsletterV3Id=c522b92814a8&user=Ronak+Patel&userId=15fcba20ca4f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}