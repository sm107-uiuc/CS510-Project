{"url": "https://towardsdatascience.com/an-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac", "time": 1682997486.423718, "path": "towardsdatascience.com/an-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac/", "webpage": {"metadata": {"title": "An introduction to Computer Vision using transfer learning in fast.ai \u2014 Aircraft Classification | by Surag Gupta | Towards Data Science", "h1": "An introduction to Computer Vision using transfer learning in fast.ai \u2014 Aircraft Classification", "description": "I started exploring the fast.ai library for deep learning in November 2018, by means of Jeremy Howard\u2019s fantastic MOOC that goes by the same name, and have wanted to experiment with the library on\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/u/85dd669ac015?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Aayush Agrawal", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/transfer-learning-using-the-fastai-library-d686b238213e", "anchor_text": "blog post on using transfer learning to detect plant diseases using leaf images", "paragraph_index": 2}, {"url": "http://fast.ai", "anchor_text": "fast.ai", "paragraph_index": 3}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet", "paragraph_index": 20}, {"url": "http://openaccess.thecvf.com/content_ICCV_2017/papers/Selvaraju_Grad-CAM_Visual_Explanations_ICCV_2017_paper.pdf", "anchor_text": "this paper", "paragraph_index": 24}, {"url": "https://arxiv.org/abs/1803.09820?source=post_page---------------------------", "anchor_text": "paper", "paragraph_index": 33}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "this is a great post on the topic.", "paragraph_index": 39}, {"url": "https://github.com/suraggupta/fastai-aircraft-classification/blob/master/aircraft-classification-fastai.ipynb", "anchor_text": "Code for this project", "paragraph_index": 45}, {"url": "https://github.com/suraggupta", "anchor_text": "Github", "paragraph_index": 45}], "all_paragraphs": ["I\u2019m a little late to the fast.ai party, but there\u2019s a famous saying that goes,", "It\u2019s not the greatest of sayings, but it works for me.", "I started exploring the fast.ai library for deep learning in November 2018, by means of Jeremy Howard\u2019s fantastic MOOC that goes by the same name, and have wanted to experiment with the library on some dataset to get a good feel of it. I also took inspiration from my friend Aayush Agrawal\u2019s blog post on using transfer learning to detect plant diseases using leaf images.", "fast.ai is a Deep Learning library in Python that sits on top of Facebook\u2019s PyTorch framework for Deep Learning. In this post, we look at how to classify 9 aircraft models using transfer learning, on a dataset that I manually built by downloading images of 9 aircraft models from the internet, shown below:", "From a young age, I\u2019ve always been fascinated by airplanes. There was also a time when I had dreams of becoming a pilot \u2014 but I guess those dreams never took off (see what I did there?) \u2014 so I decided to bring some of that fascination into my deep learning exploration. Let\u2019s now dive into the Python code to see how all of these unfold:", "Let us begin by importing the necessary modules for our Computer Vision problem:", "There\u2019s probably gonna be a bunch of Pythonistas who are waiting to throw eggs at me because of my usage of import * above, but that\u2019s pretty much all you need for this post. The library has a lot of functionality packed in it, and you\u2019ll realize the ease of using it as we dive deeper into the data exploration.", "Our image dataset is stored as .jpg files in 9 different folders, with each folder bearing the name of the aircraft model of the images contained in the folder. We use the ImageDataBunch.from_folder() function to load the images and assign labels the images based on the name of the folder they\u2019re read from.", "We begin by declaring the path in which the folders are located:", "That\u2019s all we needed to do to load those images. fastai definitely seems to be a coder friendly library.", "The .normalize(imagenet_stats) method above is used to normalize the dataset based on the stats of the RGB channels from the ImageNet dataset.", "Now that we\u2019ve loaded our dataset, let us have a peek into what it looks like:", "Looks alright to me. Let\u2019s have a look at what the image classes are, the number of classes, and the sizes of the training and test sets:", "data.classes \u2014 What are the classes of aircrafts in our dataset?", "data.c \u2014 How many classes are there in our dataset?", "len(data.train_ds) \u2014 What is the size of our training dataset?", "len(data.valid_ds) \u2014 What is the size of our validation dataset?", "So we have 2473 images in the training set and 618 images in the test set (~ 20%) as defined in the ImageDataBunch.from_folder() function above.", "We now use a pre-trained ResNet50 Convolutional Neural Net model, and use transfer learning to learn weights of only the last layer of the network.", "Why Transfer learning? Because with transfer learning, you begin with an existing (trained) neural network used for image recognition \u2014 and then tweak it a bit (or more) here and there to train a model for your particular use case. And why do we do that? Training a reasonable neural network would mean needing approximately 300,000 image samples, and to achieve really good performance, we\u2019re going to need at least a million images. In our case, we have approximately 2500 images in our training set \u2014 you have one guess to decide if that would have been enough if were to train a neural net from scratch.", "We use the create_cnn() function for loading a pre-trained ResNet50 network, that was trained on around a million images from the ImageNet database.", "Let us now fit one cycle of 4 epochs to see how our model performs on this dataset:", "Why just 4 epochs? I wanted to try and benchmark my first attempt with tweaks that I\u2019d be making in a while, to make a reasonable comparison. With 4 epochs and no tweaks to our model, we\u2019ve managed to achieve(?) an error rate of approximately 32% (which translates to an accuracy of 68%). How good is this? We\u2019ll get to the answer for this as we read further.", "Let\u2019s have a look at what\u2019s wrong with our model predictions:", "The heat-maps in the above images depict the regions in the image that activated the network \u2014 more simply, these are the regions in the image that helped the network in identifying the class (not very helpful in the above cases, where the losses were the highest). For more on this, this paper gives a great walk-through.", "One thing that stands out is the fact that most images get cropped to squares (n x n pixels) when it is fed into the model. This is because currently, GPU inputs can only be square images. This is a potential caveat for our use case since one of the main components that help in identifying the aircraft is its nose, which gets cropped out in a majority of the images, and hence our model does not have enough information to learn from.", "To overcome this, let us now squish our images to squares, rather than cropping them. Think of it as pressure being applied from both sides of the image that makes it look a little distorted, but retains the components of the image without cropping it. To do this, we make a slight change to our ImageDataBunch.from_folder() function. Initially, we had set the size argument to a value of 450, meaning that the image would be cropped to a 450 x 450 image. Let us make a change to that argument as shown below:", "We now have changed the value of size to (450,450) instead of 450. This change, although not obvious, squishes the image to the same dimensions mentioned:", "The difference here is obvious, compared to the images we loaded initially where the wider ends of the image (in most cases, the nose) got cropped off:", "Let us now create another learner by retraining the model with the new images:", "Let us now fit our model with 4 epochs (one epoch means our model sweeps through our data once \u2014 the more the number of epochs, the more it learns in each sweep)", "This results is an error rate of 21%, a decent improvement over our previous error rate of 32%. Let us now try and improve our model by fine tuning it:", "Let us save the model (the weights) for now:", "One of the most important parameters to tune in a deep learning model is the learning rate. Picking the right learning rate is important, and rather than giving it a random guess or multiple trial-and-errors, we can use a beautiful function \u2014 lr_finder() to find a pretty good learning rate for our model to learn with. This function is an implementation of Leslie Smith\u2019s paper on tuning neural network hyper-parameters, so give it a read.", "Before we run lr_find() , we could unfreeze the whole network. I found that unfreezing the network before running lr_find() gets me better results. unfreeze() enables us to update the weights of the entire network. Ideally, we\u2019d like to not update the weights of the earlier layers by a huge margin, but small changes (defined by low learning rates) and gradually increasing the learning rate as we move across the layers could lead to better results.", "lr_find() essentially trains the model with linearly increasing learning rates that usually range from around 10e-7 to 1. Once that is run, we plot the graph of the loss vs. the learning rate, as shown below:", "We can choose our learning rate such that it is lower than the rate at which the loss starts going up significantly. In the above graph, 1e-4 seems like a reasonable learning rate for the last layer group.", "We can distribute the learning rates across the layers of the network by choosing a range for the rates, where the maximum learning rate would be 1e-4 (from the above graph), and the minimum learning rate (which would be applied to the first learning group) can be a tenth of the maximum learning rate, which in this case would be 1e-5.", "To train the entire network, we first need to unfreeze the network \u2014 this is something we did right before running lr_find() , so we don\u2019t have to do it again.", "Let us now fit one cycle to our model with 8 epochs \u2014 to read a bit more about fit_one_cycle , this is a great post on the topic.", "With the above steps, we have reduced our error rate to ~4% \u2014 not bad! We initially started off with an error rate of 32%, and this is quite an improvement over that!", "Let us now take a look at our confusion matrix to see where our model is giving erroneous predictions:", "From the confusion matrix, it looks like the model is predicting aircrafts as Boeing 787s when it was actually another model. Let us take a look at the instances where the loss was maximum:", "We could give our model a pass on some of these predictions \u2014 for example, the 4th image is just an engine, and I don\u2019t think I fed enough zoomed-in engine images to the model to accurately distinguish aircraft engines. The 7th image is that of a zoomed-in front portion of the aircraft, which, to be fair, is difficult to distinguish between aircrafts, especially with a model that we didn\u2019t tune all that much. The heat maps in the above images show the activation layers for the images.", "Without deeply tuning our model, we were able to get an accuracy close to 97%. There are a good number of experiments we could do further to see if the accuracy can be improved, such as increasing the number of epochs, running a single epoch cycle multiple times, more data augmentation techniques, etc. The purpose of this post was to illustrate the ease of use and speed of the fastai library, and the state-of-the-art results it can achieve with very minimal tuning, and the incredible power of transfer learning to develop state-of-the-art image recognition models. The library is continuously being worked on by the folks at fast.ai, and will inspire people to learn more about AI and its phenomenal use cases in building a better world.", "Code for this project can be found on my Github profile", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Scientist @ Target, Machine Learning & Deep Learning Enthusiast"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa2685d266ac&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a2685d266ac--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@suraggupta17?source=post_page-----a2685d266ac--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@suraggupta17?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Surag Gupta"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56e44dfc7794&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&user=Surag+Gupta&userId=56e44dfc7794&source=post_page-56e44dfc7794----a2685d266ac---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/u/85dd669ac015?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Aayush Agrawal"}, {"url": "https://towardsdatascience.com/transfer-learning-using-the-fastai-library-d686b238213e", "anchor_text": "blog post on using transfer learning to detect plant diseases using leaf images"}, {"url": "http://fast.ai", "anchor_text": "fast.ai"}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet"}, {"url": "http://openaccess.thecvf.com/content_ICCV_2017/papers/Selvaraju_Grad-CAM_Visual_Explanations_ICCV_2017_paper.pdf", "anchor_text": "this paper"}, {"url": "https://arxiv.org/abs/1803.09820?source=post_page---------------------------", "anchor_text": "paper"}, {"url": "https://sgugger.github.io/the-1cycle-policy.html", "anchor_text": "this is a great post on the topic."}, {"url": "https://github.com/suraggupta/fastai-aircraft-classification/blob/master/aircraft-classification-fastai.ipynb", "anchor_text": "Code for this project"}, {"url": "https://github.com/suraggupta", "anchor_text": "Github"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a2685d266ac---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----a2685d266ac---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----a2685d266ac---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/fastai?source=post_page-----a2685d266ac---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----a2685d266ac---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&user=Surag+Gupta&userId=56e44dfc7794&source=-----a2685d266ac---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&user=Surag+Gupta&userId=56e44dfc7794&source=-----a2685d266ac---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa2685d266ac&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a2685d266ac---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a2685d266ac--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a2685d266ac--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a2685d266ac--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a2685d266ac--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a2685d266ac--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@suraggupta17?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@suraggupta17?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Surag Gupta"}, {"url": "https://medium.com/@suraggupta17/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "23 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56e44dfc7794&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&user=Surag+Gupta&userId=56e44dfc7794&source=post_page-56e44dfc7794--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F56e44dfc7794%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-computer-vision-using-transfer-learning-in-fast-ai-aircraft-classification-a2685d266ac&user=Surag+Gupta&userId=56e44dfc7794&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}