{"url": "https://towardsdatascience.com/best-practices-for-securing-aws-ec2-instances-4bd656e22462", "time": 1683007284.115496, "path": "towardsdatascience.com/best-practices-for-securing-aws-ec2-instances-4bd656e22462/", "webpage": {"metadata": {"title": "Best Practices For Securing AWS EC2 Instances | by Akshay Kapoor | Towards Data Science", "h1": "Best Practices For Securing AWS EC2 Instances", "description": "Security in the cloud has different dimensions and as an end-user you should be very cautious in striking the best balance between ease of use, performance and safety."}, "outgoing_paragraph_urls": [{"url": "https://securityboulevard.com/2020/01/keep-telnet-off-the-internet-heres-why/", "anchor_text": "unknowingly expose ports", "paragraph_index": 4}, {"url": "https://docs.aws.amazon.com/vpc/latest/userguide/vpce-interface.html", "anchor_text": "currently available over AWS PrivateLink", "paragraph_index": 6}, {"url": "https://aws.amazon.com/cloudwatch/", "anchor_text": "Cloudwatch Monitoring", "paragraph_index": 9}, {"url": "https://aws.amazon.com/systems-manager/", "anchor_text": "AWS Systems Manager", "paragraph_index": 9}, {"url": "http://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/", "anchor_text": "cattle instead of pets", "paragraph_index": 9}, {"url": "https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up.html", "anchor_text": "setting up configurations", "paragraph_index": 10}, {"url": "https://docs.aws.amazon.com/systems-manager/latest/userguide/execute-remote-commands.html", "anchor_text": "run batch of commands", "paragraph_index": 12}, {"url": "https://aws.amazon.com/waf/", "anchor_text": "Web Application Firewall", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 19}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 19}], "all_paragraphs": ["Security in the cloud has different dimensions and as a user you should be very cautious in striking the best balance between ease of use, performance and safety. While AWS does a superb job in ensuring the security of the Cloud, users still need to do their bit in the Cloud. From perspective of virtualisation, multi-tenancy or physical access to the data centre, AWS secures everything, but there is a lot that still remains to be taken care off by the user.", "Want to learn more ? Then keep reading. This post will explore different topics which I\u2019ve found relevant over past many years of experience.", "User responsibilities in context of EC2 start at the configuration and management of Operating System and move up the stack including all utilities and software that user installs on the virtual machine. The layers can be roughly broken down into:", "AWS regularly upgrades existing AMIs which further point to snapshots, permissions and boot volumes to use when an instance comes up. If you\u2019re using a custom built AMI, it\u2019s always a good practice to restrict the access to your own account. Secondly, only preserve your volumes after instance termination if there is a strong motivation to do so. It might contain application state data which could be used by attaching these volumes to other instances in future.", "You as an end-user are responsible for everything you install on the EC2 host. Avoid utilities like telnet, for example. Choosing a thin base AMI and only installing things which are absolutely needed for the application runtime is the best way to build your setup. You might unknowingly expose ports from your host by having such utilities installed.", "It\u2019s important to understand that Security Groups in AWS not only help you control traffic flow, but also act as an Identification mechanism. Avoid using default security groups which by default allows two instances with same security group to talk to each other on all ports. So, you might end up opening all traffic to another machine in your network that might have been compromised for different reasons altogether. Also, any other machine which is later associated with such security groups automatically becomes part of the club, resulting in a mesh topology.", "50+ AWS services are currently available over AWS PrivateLink \u2014 which basically means that your request to such resources never really takes the internet route, rather uses AWS\u2019s own internal backbone network.", "So, if your access requirements from EC2 instances are just centred around common AWS services (like S3, DynamoDB, API Gateway etc.), it makes sense to block outgoing internet routing rules altogether and just use private endpoints. With these modifications your routing tables are reduced down to something like:", "pl-1a2b3c4d in this case points to the specific AWS Service private link endpoint within your VPC. I have come across multiple stacks where services like S3, DynamoDB and EC2 sum up all the requirements of the stack.", "First and most common issue is opening up SSH to the world, primarily because you don\u2019t have a dedicated static IP/CIDR that could identify the good source of traffic with. However, you can first start with the need of having SSH at all in the first place. AWS ecosystem has grown a lot in past few years and requiring SSH should probably be the last thing you would want to do (consider stacks running 10s and 1000s of servers). In terms of logging, monitoring and operations management, AWS already has extensive support with Cloudwatch Monitoring, AWS Systems Manager etc. Plan your architecture/stack from ground up in a way that all actionable insights are available externally so that you really don\u2019t need to access the machine. The famous analogy of considering your resources as cattle instead of pets is very relevant here. Design your systems so that you can easily dispose them off at any point without any local state in terms of logs, files etc.", "Systems Manager is an excellent offering from AWS which allows you to access the EC2 machines without associating a SSH key pair. Also, you don\u2019t need to allow ingress on port 22 either. By installing the SSM agent and setting up configurations, you can just login to your instance from your terminal with:", "Behind the scenes, SSM works by returning a URL and token, using which you can initiate a WebSocket connection to send commands and receive output from the instance.", "Using SSM \u2018Run\u2019 command, you can run batch of commands on group of instances. This further gives you the capability of running commands without actually logging into the server at all.", "More often than not, you will not need \u2018all\u2019 associated permissions in policies managed by AWS. Secondly, you don\u2019t control the updates that might happen to such policies in future. Always prefer to have minimalistic authorisation policies with restricted principals with just the access you need.", "I have made the mistake of running Jenkins on an EC2 machine reachable over the internet few years back. Within no time there were bitcoin mining processes running on the instance which I could not kill/stop, no matter what I tried. Anyways, the point here is to know all aspects of your stack running on a publicly exposed machine. Tools like Jenkins work atop many plugins, which might create backdoor entries into your server. Moreover, vulnerabilities of such plugins are easily exposed since the entire source code is mostly available online.", "Public subnets include instances with a public IP address which route outgoing traffic (0.0.0.0/0) through the Internet gateway. This makes them approachable on the internet and thus breaking the boundary for secure connectivity. A rule of thumb to address such problems is to minimise the number of ways you can identify yourself from within your account to the outside world. Instead, always prefer to have the instances in private subnets even if they are serving a public facing application. For such requirements , you can always provision Load Balancers in the public subnets with routes defined to private subnet instances. Integrations with Web Application Firewall can additionally help you outrightly reject malicious traffic from reaching your machines.", "Nothing can get better than temporary access credentials offered on demand with short validity period. From within EC2 instances, all official SDKs, CLIs etc. have built in support for fetching temporary credentials aligned with the associated policies before initiating any request to AWS.", "These dynamic credentials are fetched using instance metadata which is a REST endpoint resolvable from within the instance only. Based on the authorisations in the policy definition, an appropriately scoped access key pair is assigned for the request, usually expiring after one hour automatically.", "That\u2019s all for this post. Until next time, tsch\u00fcss !", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Cloud Solutions and DevOps | DISCLAIMER: Opinions expressed are solely my own and do not express the views or opinions of my employer"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4bd656e22462&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4bd656e22462--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@akskap?source=post_page-----4bd656e22462--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Akshay Kapoor"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffc66d24e947c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&user=Akshay+Kapoor&userId=fc66d24e947c&source=post_page-fc66d24e947c----4bd656e22462---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@wdnet?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "PhotoMIX Ltd."}, {"url": "https://www.pexels.com/photo/building-metal-house-architecture-101808/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://securityboulevard.com/2020/01/keep-telnet-off-the-internet-heres-why/", "anchor_text": "unknowingly expose ports"}, {"url": "https://docs.aws.amazon.com/vpc/latest/userguide/vpce-interface.html", "anchor_text": "currently available over AWS PrivateLink"}, {"url": "https://aws.amazon.com/cloudwatch/", "anchor_text": "Cloudwatch Monitoring"}, {"url": "https://aws.amazon.com/systems-manager/", "anchor_text": "AWS Systems Manager"}, {"url": "http://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/", "anchor_text": "cattle instead of pets"}, {"url": "https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up.html", "anchor_text": "setting up configurations"}, {"url": "https://docs.aws.amazon.com/systems-manager/latest/userguide/execute-remote-commands.html", "anchor_text": "run batch of commands"}, {"url": "https://aws.amazon.com/waf/", "anchor_text": "Web Application Firewall"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/ec2?source=post_page-----4bd656e22462---------------ec2-----------------", "anchor_text": "Ec2"}, {"url": "https://medium.com/tag/aws?source=post_page-----4bd656e22462---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/security?source=post_page-----4bd656e22462---------------security-----------------", "anchor_text": "Security"}, {"url": "https://medium.com/tag/devops?source=post_page-----4bd656e22462---------------devops-----------------", "anchor_text": "DevOps"}, {"url": "https://medium.com/tag/cloud?source=post_page-----4bd656e22462---------------cloud-----------------", "anchor_text": "Cloud"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&user=Akshay+Kapoor&userId=fc66d24e947c&source=-----4bd656e22462---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&user=Akshay+Kapoor&userId=fc66d24e947c&source=-----4bd656e22462---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4bd656e22462&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4bd656e22462---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4bd656e22462--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4bd656e22462--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4bd656e22462--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4bd656e22462--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4bd656e22462--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Akshay Kapoor"}, {"url": "https://medium.com/@akskap/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "212 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffc66d24e947c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&user=Akshay+Kapoor&userId=fc66d24e947c&source=post_page-fc66d24e947c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc12538f7710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbest-practices-for-securing-aws-ec2-instances-4bd656e22462&newsletterV3=fc66d24e947c&newsletterV3Id=c12538f7710&user=Akshay+Kapoor&userId=fc66d24e947c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}