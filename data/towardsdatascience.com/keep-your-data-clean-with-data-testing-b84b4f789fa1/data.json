{"url": "https://towardsdatascience.com/keep-your-data-clean-with-data-testing-b84b4f789fa1", "time": 1683015354.847337, "path": "towardsdatascience.com/keep-your-data-clean-with-data-testing-b84b4f789fa1/", "webpage": {"metadata": {"title": "Keep your data clean with data testing | by Laurenz Reitsam | Towards Data Science", "h1": "Keep your data clean with data testing", "description": "In software engineering, it is best practice to write tests with language-specific frameworks to reduce errors and improve code quality. However, in the world of data science and data engineering\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.greatexpectations.io/en/v0.4.5/index.html", "anchor_text": "great-expectations", "paragraph_index": 1}, {"url": "https://github.com/CSSEGISandData/COVID-19", "anchor_text": "Covid-19 data coming from the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University", "paragraph_index": 2}, {"url": "https://docs.greatexpectations.io/en/v0.4.5/dataset_module.html", "anchor_text": "predefined expectations", "paragraph_index": 17}], "all_paragraphs": ["In software engineering, it is best practice to write tests with language-specific frameworks to reduce errors and improve code quality. However, in the world of data science and data engineering, the quality of the pipelines and the models you are building does not only depend on the written code, it mostly depends on the data you are using. In this article, we will see how we can write tests for our input data to avoid unpleasant surprises. So, we can guarantee the correct behavior of our machine learning models or ETL pipelines building up on this data.", "In this article, we will focus on Python code and use the great-expectations package for testing. We will concentrate on Pandas DataFrames, but tests for PySpark and other tools are also supported by great-expectations.", "For this example, I decided to use the Covid-19 data coming from the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University.", "Why this dataset? I used this dataset because it consists of several batches. There is one .csv file for every day since the beginning of Covid 19. The quality of the data and the amount of information is changing over time. So, we can build our tests on a subset of the data, which is available on a specific date. Later, we can apply these tests to new, unseen data and assure that the data content is as expected.", "First, let\u2019s create a list of all files we want to load and use later in our pipeline:", "Instead of loading all the files right now, we will first inspect the oldest file and the latest file only. So, we can see how the columns look like and evaluate the data quality.", "This overview, which is regarding the column names only, already shows that there was a huge change over time. Several additional columns were added and the naming of some columns was changed. This means that we cannot load all .csv files and concatenate them without any additional preprocessing steps.", "Based on the gained information we can write our first tests to check if all the column we need for our later use are present in every file:", "Here, we first wrapped the DataFrame object of the latest data file by a great_expectations dataset object. This still behaves like a pandas DataFrame but brings some additional features. Then, we created our first tests, which are called expectations with the expect_column_to_exist() method. We applied this method to a defined list of our DataFrame columns to assure that these columns do exist. In this case, we created 5 expectations (one kind of expectation for 5 different columns). Finally, we created an expectation-config object that describes the created tests. This object can be saved and loaded as a JSON file.", "Until now, we have only created these tests and saved them in a config file. Now, let\u2019s apply these tests to our two data files and see if they succeed:", "The ge.read_csv() method is a wrapper for the corresponding Pandas method and gives the opportunity to define the expectation suite, which is our config object that should be used for the data validation. We can apply the defined tests with validate() and check whether they were successful with success(). The results show that the tests were successful for the last data file, but failed for the first file. This output is as expected and the tests failed for the first file, which has a different column naming. We can see more details with the following command:", "Here, we iterate over each individual expectation and check whether it succeeds or not. If it does not, we print additional information to the console. The output tells us that there are no necessary columns \u2018Country_Region\u2019, \u2018Last_Update\u2019, and \u2018Active\u2019 in the dataset. We can fix the first two issues with simple column renaming. The \u2018Active\u2019 column must be calculated if missing.", "The necessary data cleansing and data validation can be summarized in one function:", "This function does the needed data preparation and raises an error if one of the defined tests failed. Otherwise, it returns a valid DataFrame object.", "Now, after successfully checking the basics, we can think about some more advanced tests for the individual columns. As an example, we can check the columns \u201cConfirmed\u201d, \u201cDeaths\u201d, and \u201cRecovered\u201d. We know that these columns should all be of type integer and be positive numbers. Also, the whole data row would be worthless, if there is no valid entry for \u2018Country_Region\u2019 or \u2018Last_Update\u2019. So we should test this, too.", "Because we have already applied these tests to our latest data file, we immediately see that there is a problem with the \u201cActive\u201d column, which contains negative values. We should handle these cases in an additional preprocessing step.", "The additional data cleaning seems to be sufficient to succeed in all defined tests. Now, we can load all files and start working with them without worrying about any unexpected behaviors in our input data.", "Great-expectations is a powerful tool that helps you to check your data sources for consistency and assure data quality. There are many predefined expectations and you can easily define your own ones. The content that is shown in this example is only demonstrating the basics. Great-expectations offers a lot more interesting and powerful features like Data Docs, which creates beautiful HTML results of your validation results. Check out the tutorials and documentation to find out more:", "There seem to be several approaches to generate and apply tests with great-expectations. Because these techniques are pretty new to me, as well, please tell me, if there are some more advanced methods than the one applied in the code above.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Thrilled by Data Science, AI, and Big Data"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb84b4f789fa1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@laurenz.reitsam?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@laurenz.reitsam?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Laurenz Reitsam"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa14bfd20a3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&user=Laurenz+Reitsam&userId=fa14bfd20a3e&source=post_page-fa14bfd20a3e----b84b4f789fa1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@scienceinhd?utm_source=medium&utm_medium=referral", "anchor_text": "Science in HD"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://docs.greatexpectations.io/en/v0.4.5/index.html", "anchor_text": "great-expectations"}, {"url": "https://github.com/CSSEGISandData/COVID-19", "anchor_text": "Covid-19 data coming from the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University"}, {"url": "https://docs.greatexpectations.io/en/v0.4.5/dataset_module.html", "anchor_text": "predefined expectations"}, {"url": "https://github.com/great-expectations/great_expectations", "anchor_text": "great-expectations/great_expectationsAlways know what to expect from your data. Great Expectations helps data teams eliminate pipeline debt, through data\u2026github.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b84b4f789fa1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/pandas?source=post_page-----b84b4f789fa1---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/tag/etl?source=post_page-----b84b4f789fa1---------------etl-----------------", "anchor_text": "Etl"}, {"url": "https://medium.com/tag/testing?source=post_page-----b84b4f789fa1---------------testing-----------------", "anchor_text": "Testing"}, {"url": "https://medium.com/tag/test-automation?source=post_page-----b84b4f789fa1---------------test_automation-----------------", "anchor_text": "Test Automation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&user=Laurenz+Reitsam&userId=fa14bfd20a3e&source=-----b84b4f789fa1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&user=Laurenz+Reitsam&userId=fa14bfd20a3e&source=-----b84b4f789fa1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb84b4f789fa1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b84b4f789fa1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b84b4f789fa1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@laurenz.reitsam?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@laurenz.reitsam?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Laurenz Reitsam"}, {"url": "https://medium.com/@laurenz.reitsam/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "34 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa14bfd20a3e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&user=Laurenz+Reitsam&userId=fa14bfd20a3e&source=post_page-fa14bfd20a3e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Ffa14bfd20a3e%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fkeep-your-data-clean-with-data-testing-b84b4f789fa1&user=Laurenz+Reitsam&userId=fa14bfd20a3e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}