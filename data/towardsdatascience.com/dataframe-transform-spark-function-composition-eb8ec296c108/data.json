{"url": "https://towardsdatascience.com/dataframe-transform-spark-function-composition-eb8ec296c108", "time": 1682996514.247194, "path": "towardsdatascience.com/dataframe-transform-spark-function-composition-eb8ec296c108/", "webpage": {"metadata": {"title": "DataFrame.transform \u2014 Spark Function Composition | by Daniel Mateus Pires | Towards Data Science", "h1": "DataFrame.transform \u2014 Spark Function Composition", "description": "How to leverage the .transform function to concisely chain custom Spark transformations"}, "outgoing_paragraph_urls": [{"url": "https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Dataset@transform[U](t:org.apache.spark.sql.Dataset[T]=%3Eorg.apache.spark.sql.Dataset[U]):org.apache.spark.sql.Dataset[U]", "anchor_text": "Dataset[T].transform", "paragraph_index": 2}, {"url": "https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.package@DataFrame=org.apache.spark.sql.Dataset[org.apache.spark.sql.Row]", "anchor_text": "a DataFrame is a type alias for Dataset[Row]", "paragraph_index": 3}, {"url": "https://gist.github.com/dmateusp/e738a9647ffe2fa432457460d1c0c445", "anchor_text": "gist", "paragraph_index": 18}], "all_paragraphs": ["As organizations migrate to, and create new data-processing logic on Spark, the resulting pieces of Software grow to a significant size, significant enough to call for all of the maintainability considerations we apply to other Software projects.", "While there are many comprehensive and valuable resources on writing performant logic, the same cannot be said about resources on structuring projects, creating re-usable Spark code and ultimately reducing the costs of maintaining those projects in the long-term.", "In this post let\u2019s look into the Spark Scala DataFrame API specifically and how you can leverage the Dataset[T].transform function to write composable code.", "Note: a DataFrame is a type alias for Dataset[Row].", "There are some transactions coming in for a certain amount, containing a \u201cdetails\u201d column describing the payer and the beneficiary:", "Let\u2019s create 2 functions to process the transactions:", "Use these methods to answer the following question: \u201cWhat beneficiaries on which days had a total amount value greater than 25?\u201d", "This is a simple example, but it does not read well. Compare it to the typical use of Dataset functions:", "We factored out some logic into methods and it helped us reason about each piece separately, but the readability of the code got arguably worse.", "The transform function is a method of the Dataset class and its purpose is to add a \u201cconcise syntax for chaining custom transformations.\u201d", "It takes a function from Dataset[T], T being the type of the rows in your Dataset, to Dataset[U], U being the type of the rows in the resulting Dataset \u2014 U can be the same as T.", "A function DataFrame => DataFrame fits that signature \u2014 if we unpack the type alias we get Dataset[Row] => Dataset[Row] where T and U are both Row .", "Using the methods you defined earlier and simply switching to using .transform is a good starting point:", "The sumAmounts and extractPayerBeneficiary methods are not fitting in .transformvery well. This is because these methods return a DataFrame, not a function DataFrame => DataFrame, so you constantly need to be using an underscore in place of the DataFrame argument in order to return a function that can be used in .transform .", "You can rewrite those methods to return functions of the signature: DataFrame => DataFrame, to match exactly the .transform parameter type:", "Now you removed the need for the \u201cunderscores\u201d and, can combine the functions in different ways:", "All of your custom transformations now return DataFrame => DataFrame, so you can use a type alias to better describe the returned value:", "type Transform = DataFrame => DataFrame", "You can find my build.sbt and the code above in this gist", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Feb8ec296c108&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@dmateusp?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dmateusp?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Daniel Mateus Pires"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2fa68a257a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&user=Daniel+Mateus+Pires&userId=2fa68a257a2&source=post_page-2fa68a257a2----eb8ec296c108---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.Dataset@transform[U](t:org.apache.spark.sql.Dataset[T]=%3Eorg.apache.spark.sql.Dataset[U]):org.apache.spark.sql.Dataset[U]", "anchor_text": "Dataset[T].transform"}, {"url": "https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.package@DataFrame=org.apache.spark.sql.Dataset[org.apache.spark.sql.Row]", "anchor_text": "a DataFrame is a type alias for Dataset[Row]"}, {"url": "https://gist.github.com/dmateusp/e738a9647ffe2fa432457460d1c0c445", "anchor_text": "gist"}, {"url": "https://medium.com/tag/spark?source=post_page-----eb8ec296c108---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/big-data?source=post_page-----eb8ec296c108---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/tag/scala?source=post_page-----eb8ec296c108---------------scala-----------------", "anchor_text": "Scala"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----eb8ec296c108---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/software-development?source=post_page-----eb8ec296c108---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&user=Daniel+Mateus+Pires&userId=2fa68a257a2&source=-----eb8ec296c108---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&user=Daniel+Mateus+Pires&userId=2fa68a257a2&source=-----eb8ec296c108---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Feb8ec296c108&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----eb8ec296c108---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----eb8ec296c108--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----eb8ec296c108--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----eb8ec296c108--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dmateusp?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dmateusp?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Daniel Mateus Pires"}, {"url": "https://medium.com/@dmateusp/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "438 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2fa68a257a2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&user=Daniel+Mateus+Pires&userId=2fa68a257a2&source=post_page-2fa68a257a2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa149a7e7d2c1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdataframe-transform-spark-function-composition-eb8ec296c108&newsletterV3=2fa68a257a2&newsletterV3Id=a149a7e7d2c1&user=Daniel+Mateus+Pires&userId=2fa68a257a2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}