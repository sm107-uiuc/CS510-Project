{"url": "https://towardsdatascience.com/tensorflow-meet-the-esp32-3ac36d7f32c7", "time": 1683001692.485215, "path": "towardsdatascience.com/tensorflow-meet-the-esp32-3ac36d7f32c7/", "webpage": {"metadata": {"title": "TensorFlow, Meet The ESP32. How to Set Up TensorFlow Lite for ESP32\u2026 | by Wezley Sherman | Towards Data Science", "h1": "TensorFlow, Meet The ESP32", "description": "A guide to set up a development environment for deploying TensorFlow Lite on the ESP32 using PlatformIO."}, "outgoing_paragraph_urls": [{"url": "https://github.com/espressif/arduino-esp32", "anchor_text": "Arduino-ESP32", "paragraph_index": 7}, {"url": "https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/partition-tables.html", "anchor_text": "found here", "paragraph_index": 11}, {"url": "https://github.com/tensorflow/tensorflow", "anchor_text": "clone the TensorFlow repository", "paragraph_index": 12}, {"url": "https://www.tensorflow.org/lite/microcontrollers/get_started", "anchor_text": "TensorFlow\u2019s documentation", "paragraph_index": 30}], "all_paragraphs": ["If I had to choose a favorite field of computing, I would choose Embedded Systems. I\u2019m a fan of the challenge that optimizing code to run in a resource-constrained environment presents.", "When I realized that TensorFlow Lite supports microcontrollers, I flipped my desk \u2014 with excitement.", "I have a couple of the ESP32-CAM modules that I\u2019m wanting to use with a home security system. My idea is to deploy a model that recognizes people and starts recording as soon as the camera picks up on a person. I don\u2019t want to use motion-sensing here because I have a dog who would just trip the sensors.", "I see TensorFlow Lite as being a great tool for this use-case. I can train a model to recognize people on my desktop, and then deploy it to my ESP32-CAM modules.", "After reading through the TensorFlow Lite documentation it became apparent that using PlatformIO wasn\u2019t going to be as easy as calling:", "Unless I want to use an Adafruit library (spoiler: I don\u2019t).", "With some careful trial and error, I was able to get TensorFlow Lite to play nice with PlatformIO on the ESP32.", "This guide will go through how I got the \u201cHello World\u201d example compiling and uploaded to an ESP32-CAM module using PlatformIO with Arduino-ESP32 support.", "The first thing you\u2019ll want to do is install PlatformIO. To do so open up a terminal and type:", "Now, create your project\u2019s root directory. This directory should also contain sub-directories for src, lib, and include.", "Within your project\u2019s root directory, create a file named platformio.ini. This file will contain all of the information needed for PlatformIO to initialize your development environment. Mine looks like:", "Next, you\u2019ll need to create a file named custom.csv. This is the partition information for the ESP32\u2019s flash. You can format the partition table based on your application\u2019s needs and ESP32\u2019s flash size. More information on ESP32 partition tables can be found here. Below is how my custom.csv file is formatted:", "With all of that set up, go ahead and clone the TensorFlow repository (TensorFlow Lite is included). You can download this as a .zip and extract to a directory of your choosing, or clone using git:", "Once you have the TensorFlow repository downloaded, generate one of the sample ESP32 projects from the TensorFlow Lite folder. We want to generate a sample project so we can grab the tfmicro library that is generated and the sample model. To generate the sample project, navigate to the root \u2018tensorflow\u2019 folder and run:", "This will generate a sample project that\u2019ll be located in:", "Navigate to the hello_world/esp-idf directory and copy the tfmicro folder from components into the lib folder that you created earlier. If you plan on running the sample program to ensure you set up your environment correctly, then copy over sin_model_data.cc and sine_model_data.h from the main folder to your src and include folders.", "Your file structure should now look something like:", "You are almost done! You just need to tweak a few things in the tfmicro library folder so PlatformIO can see all the third-party libraries TensorFlow Lite requires.", "Navigate into the tfmicro folder. You should see two folders: tensorflow and third_party.", "Go into third_party/flatbuffers/include and copy the flatbuffers sub-directory into the tfmicro root.", "Next, go into third_party/gemmlowp and copy both the fixedpoint and internal directories into the tfmicro root directory.", "Finally, copy over the kissfft directory from third_party into the tfmicro root directory.", "At this point, you can go ahead and delete the third_party directory.", "By moving all of the third-party libraries into the tfmicro root, PlatformIO can recognize and use them.", "The final structure of your project should look like:", "With the file structure finished, navigate to lib/tfmicro/flatbuffers and open base.h.Within base.h, change line 34 from:", "You are now done! The only thing that\u2019s left to do is import and use TensorFlow Lite in a project.", "To test that TensorFlow Lite was working correctly, I adapted the \u201cHello World!\u201d sine model to be used in an Arduino-ESP32 sketch.", "I\u2019ll guide you through what I did below!", "The first thing I did was import all of the libraries the project will use.", "The first global variable I defined was the memory pool to store the arrays generated by the model. TensorFlow\u2019s documentation states that you may have to come up with the pool size from experimentation for different models. For this, I just went what was in the sample code that TensorFlow provided for running the sine model.", "Then I defined the model, interpreter, and input/output nodes.", "With global variables defined, it\u2019s time to set up the environment.", "Within the \u2018setup()\u2019 function, I started serial at 115200 baud and imported the sine model.", "Then I instantiated the TensorFlow Lite Micro Interpreter", "Finally, I allocated the model\u2019s tensors into the memory pool that was defined as a global and I set the input and output variables to their corresponding nodes.", "That concludes the \u2018setup()\u2019 function. In a gist: I imported the model, created the interpreter, and loaded the model into memory.", "With the \u2018setup()\u2019 function finished, I started implementing the control loop logic.", "For the control loop, I waited for user input from serial and converted it to a float. Then I checked to make sure the user input was within the model\u2019s params (0\u20132*PI):", "I then set the input node for the model to parsed user input, invoked the interpreter, and then printed out the result:", "With the code finished, you can deploy to the ESP32 using PlatformIO with:", "You can then give the program input through serial by using:", "That\u2019s it! I\u2019m genuinely surprised at how easy TensorFlow makes it to deploy models to microcontrollers. My next article will be on how to create a model using TensorFlow and how to convert it to something that can be run by TensorFlow Lite!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "B.S.E. Software Engineering specializing in embedded computing. I am an A.I. enthusiast."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3ac36d7f32c7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@dawezdog?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dawezdog?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Wezley Sherman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F934642e40dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&user=Wezley+Sherman&userId=934642e40dc&source=post_page-934642e40dc----3ac36d7f32c7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/espressif/arduino-esp32", "anchor_text": "Arduino-ESP32"}, {"url": "https://docs.espressif.com/projects/esp-idf/en/latest/api-guides/partition-tables.html", "anchor_text": "found here"}, {"url": "https://github.com/tensorflow/tensorflow", "anchor_text": "clone the TensorFlow repository"}, {"url": "https://github.com/tensorflow/tensorflow.git", "anchor_text": "https://github.com/tensorflow/tensorflow.git"}, {"url": "https://www.tensorflow.org/lite/microcontrollers/get_started", "anchor_text": "TensorFlow\u2019s documentation"}, {"url": "https://github.com/wezleysherman/ESP32-TensorFlow-Lite-Sample", "anchor_text": "https://github.com/wezleysherman/ESP32-TensorFlow-Lite-Sample"}, {"url": "https://medium.com/tag/programming?source=post_page-----3ac36d7f32c7---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/esp32?source=post_page-----3ac36d7f32c7---------------esp32-----------------", "anchor_text": "Esp32"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----3ac36d7f32c7---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----3ac36d7f32c7---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----3ac36d7f32c7---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&user=Wezley+Sherman&userId=934642e40dc&source=-----3ac36d7f32c7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&user=Wezley+Sherman&userId=934642e40dc&source=-----3ac36d7f32c7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3ac36d7f32c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3ac36d7f32c7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3ac36d7f32c7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dawezdog?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dawezdog?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Wezley Sherman"}, {"url": "https://medium.com/@dawezdog/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "134 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F934642e40dc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&user=Wezley+Sherman&userId=934642e40dc&source=post_page-934642e40dc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F934642e40dc%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftensorflow-meet-the-esp32-3ac36d7f32c7&user=Wezley+Sherman&userId=934642e40dc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}