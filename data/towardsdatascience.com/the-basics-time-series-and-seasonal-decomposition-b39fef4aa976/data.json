{"url": "https://towardsdatascience.com/the-basics-time-series-and-seasonal-decomposition-b39fef4aa976", "time": 1682992973.954821, "path": "towardsdatascience.com/the-basics-time-series-and-seasonal-decomposition-b39fef4aa976/", "webpage": {"metadata": {"title": "The Basics: Time Series and Seasonal Decomposition | by Max Miller | Towards Data Science", "h1": "The Basics: Time Series and Seasonal Decomposition", "description": "Handling time stamped data is one of the most intuitively obvious use cases for data science. After all, any data we can collect necessarily must be gathered from or represent the past and we often\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/A_Random_Walk_Down_Wall_Street", "anchor_text": "famously random", "paragraph_index": 4}], "all_paragraphs": ["Handling time stamped data is one of the most intuitively obvious use cases for data science. After all, any data we can collect necessarily must be gathered from or represent the past and we often want to make predictions about unseen cases we\u2019ll encounter in the future, so it makes sense that our models might have an important time component, in some form or other. Time series models are distinct from other sorts of predictive models in that the target variable is both the object of the prediction (for future values) and an input feature of the model (for the historical values).", "The first steps in approaching a time series project are frequently to visualize and then decompose the data into trend and cyclical components. From there, you can start to work on more complicated predictive models, though simply decomposing the series can itself yield some valuable insights. This article will focus on the simplest decomposition technique, classical seasonal decomposition, but even this can be quite useful.", "When are time series techniques appropriate?", "Nowadays, most data, particularly procedurally generated data, comes with a timestamp. Whenever a digital form is filled out and submitted, or whenever a purchase is made online, the exact time is typically recorded and stored. As a result, many datasets come with a time element of some nature, but that doesn\u2019t mean that the time series techniques discussed here are necessarily appropriate. These techniques only really make sense when there is some degree of auto-correlation in the target variable, that is, when the target variable is correlated with itself from earlier periods. If a value from yesterday or last month, or last year can help you predict the value for today, then these time series techniques are appropriate. If that isn\u2019t the case, then they won\u2019t help.", "Consider, for instance, the day to day movements in stock prices, which are famously random. Knowing that a stock went up yesterday doesn\u2019t really tell you whether the stock is likely to go up today. Here, for example, is a real life example of day to day stock price movements:", "The company in question is actually Apple, but you wouldn\u2019t be able to tell that just by looking at the day to day movements \u2014 like all stocks, Apple\u2019s bounces around from day to day in a way that defies prediction. Time series analysis won\u2019t help.", "Now, instead of looking at the day to day movement in price, let\u2019s consider the stock price itself. Unlike the day to day change, the price does exhibit autocorrelation. Yesterday\u2019s stock price gives me a very good indication of what today\u2019s stock price will be because the price typically doesn\u2019t change by more than a percent or two in any given day. If the price was $200 yesterday, I can be pretty sure it\u2019ll close between $190 and $210 today, barring exceptional events. Out of the seeming noise of the day to day movements, the price itself exhibits a trend that suggests time series analysis might be useful:", "But then, stock prices are still stochastic in nature and while there might be some benefit in smoothing out a graph like this depending on what sort of analysis you\u2019re doing, you\u2019re going to have a hard time actually predicting future values. So, let\u2019s consider one final Apple related series, the number of iPhones sold globally each quarter:", "Now, this is a time series we can work with! Notice that it doesn\u2019t just exhibit a general trend, but also has predictable cycles within the trend \u2014 you\u2019ll see a spike in sales each year corresponding with Apple\u2019s first quarter (their accounting year starts in October, so their first quarter is picking up holiday sales). The goal of our time series techniques is often to find and exploit predictable patterns like this, even when the patterns are subtler and harder to spot than the seasonal pattern in iPhone sales.", "Rolling averages and trends in time series", "A common first step when approaching a new time series project is to smooth out the data with something like a rolling average. This has two main benefits. One is that real world data tends to jump around a bit, even if there is a clear underlying trend, and looking at the rolling average makes it easier to tell how the trend is moving underneath the noise. Second, finding a trend in this or a similar manner is the first step towards creating a seasonal decomposition. Let\u2019s look at a real example. Here is a common starter time series data set, which shows the number of airline passengers there were per month in the US in the fifties:", "There\u2019s obviously an upward slope as air travel went from a relatively rare luxury in the late 40s to a much more common experience in the 60s, but there\u2019s also clearly a seasonal pattern with travel being consistently higher in some months rather than others. The month to month variation makes it hard to see exactly how fast this growth is. We can smooth out the monthly fluctuations by considering a rolling average, where a few consecutive months are considered together. A particularly high or low value in one month will, therefore, be tempered by the less extreme values in the other months in the rolling window. Consider the original data alongside a six month rolling average:", "The rolling average doesn\u2019t get as high as the original data at its peaks, or as low during the troughs. One thing you may notice about this particular example is that it also doesn\u2019t seem to hit the peaks and troughs at exactly the same time as the original data. This rolling average is more specifically a trailing average: the six months that make up the average for a given month are that month\u2019s point and the five preceding months. As an alternative, you might consider centering your window on the month. You could, for instance, consider the month itself, the two previous months and the two subsequent months for a 5 month window (this tends to work better with odd numbers of months), but one that coincided with the peaks and troughs of the data rather than lagging them by a month or so:", "You might be able to see already, that this strategy has an issue when you get towards the end of your data set \u2014 you can\u2019t consider the average of a future month for which you have no data yet! In the above example, the centered rolling average simply stops two months before the end of the dataset while the trailing average goes all the way to the edge. There are some ways to deal with this \u2014 perhaps as you get towards the end and start running out of future months, you start to consider fewer months to close the gap \u2014 but these may not be satisfactory. (Of course, the trailing average also has a similar problem, but one at the beginning of the series, where you can\u2019t take an average of the last 6 months if you\u2019re only in, say month 2 or 3 of the data set.)", "You can also vary the size of the window to adjust how much smoothing you do. As you increase the window, the rolling average will get less and less peaky:", "There are a few other ways of smoothing out time series and finding trend lines, but they tend to be variations on the theme of the simple average. One common one worth mentioning is the Exponentially Weighted Moving Average (EWMA) which, true to its name, averages previous periods, but weights them so that the more recent periods count for more in the average.", "One use of a creating a smoothed trend line in this fashion is to perform seasonal decomposition, to break out the original data into components for the trend, cyclical deviations from this trend and then whatever residuals are left over. How do we go from a smoothed line to the full decomposition? Well, notice that as you increase the size of the rolling average\u2019s window the impact of the seasonal fluctuations fade away. If your rolling average considers a window that is the same size as your seasonal cycle, it essentially washes out the seasonal cycle altogether by considering one of each month in the cycle:", "We\u2019re looking for a seasonal cycle that accounts for the differences between the original data and this season-less rolling average. There are two ways to try to calculate this seasonal element. The first is as an additive model. In this method, we\u2019ll imagine that the true value for any given month is the value of the trend at that month plus a static seasonal value that changes from month to month within a year but stays roughly the same for the same month in consecutive years, with some (hopefully small) amount of error left over. Let\u2019s start by calculating a \u2018de-trended\u2019 series: taking our original series and subtracting the trend from it:", "This de-trended series shows us just the seasonal cycle along with whatever other noise there is in our data set. Now we can simply consider each month within the cycle one by one. How much above or below the trend is the average January data point? Or the average February? We can simply take a month by month average to get an approximation of the seasonal cycle:", "Looking at these average seasonal components like this you can see clearly how air travel varied from month to month, with much more travel in the summer months than in the winter. Now we can model our original data as being comprised by the trend and this seasonal component:", "Our modeled data in the green line isn\u2019t horrible, but it\u2019s clearly got a problem \u2014 it consistently overshoots in the early years and consistently undershoots in the later years. Actually, we could have foreseen this problem arising when we graphed out the de-trended data and saw that the seasonal swings got more and more extreme. In this case there is a simple fix, which is to consider the second way of decomposing the time series, the multiplicative model.", "The multiplicative model works similarly to the additive one, except in this case we say that the final data for any given month is some value from the trend multiplied by some seasonal adjustment that stays roughly the same year over year. The additive model says something like \u201cthe number of flights is typically 40,000 higher than the trend in June\u201d, while the multiplicative model says \u201cthe number of flights is typically 10% higher than the trend in June\u201d. In this way, the multiplicative model scales the size of the seasonal cycle as the trend rises or falls.", "Calculating the multiplicative seasonal cycle is similar to calculating the additive one, except that to find the de-trended series, we divide the original data by the trend:", "We can find the monthly adjustments by averaging each month of this de-trended series, and then model out our data as the trend multiplied by the appropriate seasonal adjustment:", "You might already be able to tell that successfully decomposing a time series set in this fashion depends crucially on properly identifying the period of the seasonal cycle. Is it a yearly cycle? Or does it take two years? Or only 6 months? Often times there are clear calendar cycles \u2014 week to week, month to month or year to year \u2014 but depending on what sort of data you are working with, there might not be any reason for it to conform to the calendar. Choosing an inappropriately sized period will render your decomposition functionally useless.", "As an example, imagine you were looking through a data set like the one we\u2019ve been considering, but you didn\u2019t know what it represented and didn\u2019t assume that it had an even yearly period of 12 months. What happens if you select an 11 month period instead of a 12 month one? Well, at first things seem to be going ok. When you plot out your rolling average, it looks like you\u2019ve more or less removed the seasonality:", "When you perform the rest of your steps to decompose the series along the 11-month period, however, you quickly see that something isn\u2019t right:", "This seasonal decomposition is basically useless, adding no real value above the smoothed out trend line. As you can see classical decomposition really depends on finding a sensible value for the period.", "Classical decomposition may seem simple, and in a way it is and old-fashioned to boot, having been developed in the 1920s. Yet, hopefully, you can see that simple as it is, it can be fairly powerful, modeling out our data well. It may also be clear how you can extend this sort of technique to start predicting future values as well, drawing out the trend a few extra months and applying the appropriate monthly adjustment.", "It\u2019s also worth bearing it in mind for how it captures the time series process in general: try to isolate the trend, look for predictable patterns and account for them. You can then look for explanations for any significant deviations. There are more complicated ways of isolating trends, but they will all, basically by necessity, look at multiple points in time to try and isolate the trend from the day to day, week to week, or month to month variation. There are more advanced methods to look for predictable patterns in the de-trended data, including methods that consider multiple patterns of different periods happening at the same time, but in principle, they also work much the same way.", "In my next post on time series, I\u2019ll profile some of these more advanced methods and how they can be extended for predicting future values.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist with a particular passion for limericks, policy and renewable energy."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb39fef4aa976&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@max.samuel.miller?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@max.samuel.miller?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Max Miller"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdfd5ba1a8332&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&user=Max+Miller&userId=dfd5ba1a8332&source=post_page-dfd5ba1a8332----b39fef4aa976---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/A_Random_Walk_Down_Wall_Street", "anchor_text": "famously random"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b39fef4aa976---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/time-series-analysis?source=post_page-----b39fef4aa976---------------time_series_analysis-----------------", "anchor_text": "Time Series Analysis"}, {"url": "https://medium.com/tag/time-series?source=post_page-----b39fef4aa976---------------time_series-----------------", "anchor_text": "Time Series"}, {"url": "https://medium.com/tag/seasonal-decomposition?source=post_page-----b39fef4aa976---------------seasonal_decomposition-----------------", "anchor_text": "Seasonal Decomposition"}, {"url": "https://medium.com/tag/data-science-ground-up?source=post_page-----b39fef4aa976---------------data_science_ground_up-----------------", "anchor_text": "Data Science Ground Up"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&user=Max+Miller&userId=dfd5ba1a8332&source=-----b39fef4aa976---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&user=Max+Miller&userId=dfd5ba1a8332&source=-----b39fef4aa976---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb39fef4aa976&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b39fef4aa976---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b39fef4aa976--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b39fef4aa976--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b39fef4aa976--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@max.samuel.miller?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@max.samuel.miller?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Max Miller"}, {"url": "https://medium.com/@max.samuel.miller/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "409 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdfd5ba1a8332&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&user=Max+Miller&userId=dfd5ba1a8332&source=post_page-dfd5ba1a8332--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F930bd413e257&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-time-series-and-seasonal-decomposition-b39fef4aa976&newsletterV3=dfd5ba1a8332&newsletterV3Id=930bd413e257&user=Max+Miller&userId=dfd5ba1a8332&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}