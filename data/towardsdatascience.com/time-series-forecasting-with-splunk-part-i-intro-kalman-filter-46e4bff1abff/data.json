{"url": "https://towardsdatascience.com/time-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff", "time": 1682993216.5324821, "path": "towardsdatascience.com/time-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff/", "webpage": {"metadata": {"title": "Time Series Forecasting with Splunk. Part I. Intro & Kalman Filter. | by Nikolai Riabykh | Towards Data Science", "h1": "Time Series Forecasting with Splunk. Part I. Intro & Kalman Filter.", "description": "Time series forecasting is a quite typical task in data analysis. Splunk ML Toolkit provides a couple of well-known methods for this task: Kalman filter and ARIMA. Unfortunately, these methods\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Kalman_filter", "anchor_text": "wiki article", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average", "anchor_text": "ARIMA", "paragraph_index": 30}], "all_paragraphs": ["Time series forecasting is a quite typical task in data analysis. Splunk ML Toolkit provides a couple of well-known methods for this task: Kalman filter and ARIMA. Unfortunately, these methods sometimes fail when encountering a real-world problems. So, let\u2019s take a closer look on them and then consider a couple of other techniques of time series forecasting in Splunk.", "OK, let\u2019s define a goal. Let we use Splunk to monitor some metrics, such as number of logins to a system, number of transactions in DB, etc. We want to analyse growth of our business (for example, in purposes of capacity planning and resources management). As part of this analysis, we want to predict number of logins for a year based on data of the last several years.", "Quite a common task, as you can see. But let\u2019s make it more complex with the requirement of flexibility. Because of monitoring not the only metric, our method or algorithm must be quite universal to predict almost any metric without lots of tuning by user. After all, we need to construct a dashboard with such functionality: user selects a metric, specifies few tuning parameters, and gets an appropriate forecast of selected metric for a year.", "Let\u2019s refresh some basic concepts about time series. In general, time series can be decomposed into several components: trend component, seasonal component, and residual component. Trend is a general direction of changing time series value. Increasing trend, for example, means that the values of time series are, in average, larger than previous ones. Seasonal component stands for some periodic fluctuations in data. For example, number of logins in night hours is constantly smaller than in day hours, as well as number of logins in weekdays is larger than on weekends. Residual component is the difference between time series values and determinate components (trend, seasonality) and often stands for some kind of noise.", "There are two main models to deal with these components. In additive model initial time series represents as the sum of components, in multiplicative model \u2014 as the product of them. Sometimes it might be a tough choice what model to prefer. Generally, multiplicative model is more preferable if amplitude of seasonal fluctuations increases over time.", "For each time series one can calculate mean, variance, and autocorrelation. Time series is stationary if these parameters are constant over time. In the picture below you find some examples of stationary (blue) and non-stationary (yellow, red, violet) time series.", "Mean and variance of \u2018blue\u2019 series are equal to 0 and 1 respectively, so this series is stationary. \u2018Yellow\u2019 series shows an increasing trend, that is mean is not constant. \u2018Red\u2019 series shows an obvious daily seasonality, that is autocorrelation function has a local maximum at the lags of 24, 48, \u2026 hours \u2014 and it\u2019s not constant, too. \u2018Violet\u2019 series shows an increasing trend and disturbance, that is mean and variance are not constant as well.", "Real-word time series are seldom stationary. But there are a lot of techniques and transformations for turning them into stationary ones.", "Let\u2019s turn ML Toolkit on and try to predict our series.", "Kalman filtering is an algorithm that produces estimates of unknown variables that tend to be more accurate than those based on a single measurement alone (sorry, I copypasted definition from wiki article). In other words, Kalman filter takes time series as input and performs some kind of smoothing and denoising. After this, smoothed series might be predicted. But one should take into account that Kalman filter is firstly for denoising, rather than forecasting. That\u2019s why the results of forecasting might be a bit inappropriate.", "Go to Assistants > Forecast Time Series and select Kalman filter as algorithm.", "ML Toolkit provides several methods for prediction:", "First of all, let\u2019s try to apply Kalman filter to one of non-stationary time series from example above just to check smoothing capabilities. Let\u2019s select \u201cyellow\u201d series \u2014 it\u2019s just a sum of constant trend and normally distributed noise. I got it by this SPL query (normal is a custom external command that returns a normally distributed value with mean and variance from fields specified in loc and scale parameters respectively):", "Ok, let\u2019s apply Kalman filter with algorithm \u201cLLT\u201d, future timespan = 200, confidence interval = 95.", "Looks nice. Filter really removes normally distributed noise and predicts actual trend.", "Now let\u2019s try to predict our number of logins. Our time series includes apparently both trend and seasonal components, so let\u2019s select prediction algorithm = LLP5, future timespan = 365 (predict for a year), period = 365 (as we expect this seasonal period to be the biggest one).", "Well\u2026 It\u2019s pretty obvious that the result is slightly not as expected. It seems that filter considers our fluctuations in data as a noise. Thereby, filter eliminates this noise and keeps only the trend component. But it\u2019s a bit confused that \u201cLLP\u201d part of algorithm, which is responsible for seasonal component, doesn\u2019t work at all. Anyway, this forecast is unacceptable.", "There is, however, a silver lining. First of all, upper and lower bounds of confidence interval are very useful for outliers detection. Secondly, it cannot be denied that the forecast of trend component is rather well. So, let\u2019s try to filter out all outliers and remove trend component from initial data. Notice that variance of initial time series increases over time. That\u2019s why it seems multiplicative model to be more appropriate in our case. So, let\u2019s divide initial values by the values of trend component.", "Here I use a predict command in SPL. This is a command for Kalman filtering, you can check it by clicking the \u201cShow SPL\u201d button on the \u201cForecast Time Series\u201d dashboard.", "Change method to LLP and click \u201cForecast\u201d.", "Well, not bad. Main seasonal profiles (like a big recession after the New Year) are captured and predicted almost perfectly.", "There is an extended New Year holiday in Russia. It starts on the January, 1 and lasts about 8\u201310 days (actual duration varies from one year to the next). It figures that user activity in many areas in those days is much less than in other days.", "But, as always, the devil is in the detail. Look at the predicted spike right after New Year holiday. It seems it is the same as a year ago. Actually, they seems to be too identical. Notice that in 2015 and 2016 there wasn\u2019t anything similar to this peak. Similarity becomes even more obvious if turning off outliers removal.", "Outlier from Feb, 2017 is repeated in prediction, but outlier from May, 2016 is not. So, it seems that Kalman filter with LLP algorithm overrates values of the last period (last 365 days in our case) and not pays any mind to corresponding values of previous periods.", "The same situation is with the high season in New Year\u2019s Eve.", "However, such feature of Kalman filtering does not make this forecast totally inadequate. It might be useful if we really want to rely only on the last period of data. For example, we\u2019re going to predict number of logins for a week based on data of previous weeks just for real-time detection of critical problems. If number of logins decreases remarkably, it likely stands for some issues with availability of authentication server or something like that. For that monitoring we can create a simple and clean forecast and just compare new data to the bounds of confidence interval.", "OK, let\u2019s get back to initial forecast for a year. Despite its apparent shortcomings, forecast of seasonal component of our time series is rather reasonable. So, let\u2019s multiply predicted trend component by predicted seasonal component for reverting to desired number of logins.", "Looks pretty nice. Notice that I\u2019ve finally implemented this forecast in pure SPL without ML Toolkit Assistant GUI. So, I can insert this search into any dashboard of any application (just take care of permissions to knowledge objects). The only parameter I need to specify is the period of seasonal component (i.e. maximum seasonal period in case of multiple seasonality). You can allow user to specify this parameter on a dashboard via a simple input text box with default value of 365. Also it\u2019s possible to calculate the maximum seasonal period automatically using Fourier transform or analyzing autocorrelation function (we\u2019ll talk about it a bit later, I think).", "Let\u2019s make a brief review of Kalman filter in Splunk.", "But this simplicity means the lack of flexibility.", "Well, let\u2019s call it a night. In the next part let\u2019s look more closely at ARIMA in Splunk. Stay tuned!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist in VK, Moscow, Russia."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F46e4bff1abff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nikolayryabykh?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikolayryabykh?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Nikolai Riabykh"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F533d8a0793ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&user=Nikolai+Riabykh&userId=533d8a0793ba&source=post_page-533d8a0793ba----46e4bff1abff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Kalman_filter", "anchor_text": "wiki article"}, {"url": "https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average", "anchor_text": "ARIMA"}, {"url": "https://medium.com/tag/splunk?source=post_page-----46e4bff1abff---------------splunk-----------------", "anchor_text": "Splunk"}, {"url": "https://medium.com/tag/timeseries?source=post_page-----46e4bff1abff---------------timeseries-----------------", "anchor_text": "Timeseries"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----46e4bff1abff---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/forecasting?source=post_page-----46e4bff1abff---------------forecasting-----------------", "anchor_text": "Forecasting"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----46e4bff1abff---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&user=Nikolai+Riabykh&userId=533d8a0793ba&source=-----46e4bff1abff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&user=Nikolai+Riabykh&userId=533d8a0793ba&source=-----46e4bff1abff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F46e4bff1abff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----46e4bff1abff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----46e4bff1abff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----46e4bff1abff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----46e4bff1abff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikolayryabykh?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nikolayryabykh?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nikolai Riabykh"}, {"url": "https://medium.com/@nikolayryabykh/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "172 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F533d8a0793ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&user=Nikolai+Riabykh&userId=533d8a0793ba&source=post_page-533d8a0793ba--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6466498e0687&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftime-series-forecasting-with-splunk-part-i-intro-kalman-filter-46e4bff1abff&newsletterV3=533d8a0793ba&newsletterV3Id=6466498e0687&user=Nikolai+Riabykh&userId=533d8a0793ba&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}