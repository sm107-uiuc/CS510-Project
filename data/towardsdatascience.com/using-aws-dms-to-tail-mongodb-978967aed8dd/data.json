{"url": "https://towardsdatascience.com/using-aws-dms-to-tail-mongodb-978967aed8dd", "time": 1683004594.9790301, "path": "towardsdatascience.com/using-aws-dms-to-tail-mongodb-978967aed8dd/", "webpage": {"metadata": {"title": "Using AWS DMS to tail MongoDB. AWS DMS as a streaming data ingestion\u2026 | by Atharva Inamdar | Towards Data Science", "h1": "Using AWS DMS to tail MongoDB", "description": "AWS DMS is a service designed to migrate one database to another. A guide to using DMS as a data ingestion tool."}, "outgoing_paragraph_urls": [{"url": "https://aws.amazon.com/dms/", "anchor_text": "AWS DMS", "paragraph_index": 0}, {"url": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.MongoDB.html", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.S3.html", "anchor_text": "AWS Docs", "paragraph_index": 19}], "all_paragraphs": ["AWS DMS is a service designed to migrate one database to another. Whether it is on-premise DB to AWS RDS or AWS EC2 (self-managed DB) to RDS. The intent is simple and one with an assumption that the migration is usually short-lived. DMS not only allows migrating an entire database but also continuous replication of changed while the full load takes place.", "Technically, there is no restriction on the duration of the migration task. Having an essentially an infinitely running migration task means it could be used to stream DB changes to S3. So let\u2019s take a look at DMS and how we can use it for populating our lake.", "DMS service concept is fairly simple and can be simple to use. Simple if defaults are left as is. There are three main components: Endpoints, Replication Instances, and Tasks.", "Endpoints define the connections to sources and targets. An endpoint can be configured as either a source or a target so that being misused is limited. There are various databases supported including AWS DocumentDB and S3.", "Tasks define which source endpoint to migrate to the target. Each task can migrate one source to one target. The endpoints can be referenced in multiple tasks. Task also defines whether to perform a full migration or an ongoing replication or both. Full migration creates a point in time snapshot in the target while ongoing migration replicates each change to the target.", "A task can also be configured to delete an existing table from target or to truncate it. Other tuning settings include which schemas and tables to include & exclude in the migration.", "A task can transition through multiple states that resume, pause or reset it. If multiple tables are being migrated as part of a task, then each table can be individually reloaded if required. For ongoing replication, the task also maintains a checkpoint state internally which is used for resuming the replication.", "Some basic transformation rules can be applied within each task. These act on either the schema, table or column and allow each to be either renamed, removed or a prefix and suffix to be added to the names. Data cannot be manipulated.", "The tasks need to be executed on some EC2 instances. DMS is not serverless but provision involves creating an instance only. There is no need or ability to access the instance via SSH or even manage it. A majority of tasks will be memory bound unless a lot of transformation needs to happen. The r family of DMS instances is a pretty good place to start. Cloudwatch Metrics allow monitoring this and should be used for testing and capacity planning.", "I assume you have a MongoDB server with a replica set running. If not, you can easily set up one in AWS EC2 or ECS. I\u2019m going to use one on EC2 I set up just for this demo.", "First, we need to create our Endpoints. There are two: Source and Target. The Source Endpoint should point to the MongoDB host and Target to S3 bucket.", "Creating the replication instance first enables us to test connections to our sources and endpoints. The size of the instance should be determined by the memory and disk requirements. It is a good practice to limit the number of tables being replicated by each instance.", "Creating a replication instance is quite important as replication tasks cannot be easily migrated between instances. It is recommended to have multiple replication instances especially if you have more than a few sources and over 50 tables/collections to replicate.", "AWS DMS supports a large number of sources including all the RDS database types, MongoDB and S3.", "It is time to create a connection to our source MongoDB cluster. If you have a cluster and router, unfortunately, you cannot connect to the router as the oplog collection is not accessible. You will need to select a single instance for replication. You can select a secondary so that writes to the cluster are not affected but the data is still being replicated correctly.", "For this demo, I have a single MongoDB instance running within a replica set on an EC2 instance. The configuration below is an example.", "There are a few key configuration options worth discussing. The first is Metadata Mode. DMS supports document or table mode for MongoDB. document mode saves the oplog and documents as JSON, whereas table mode saves it as CSV. With table mode it is possible to specify the number of levels to be flattened using nestingLevel as NONEor ONE .", "The next is _id as a separate column or extractDocId . This allows extracting document _id as a new column. If this is false (unchecked) and Metadata Mode is set to document , then the output file has a single column with JSON string. With extractDocId=true , the output file has two columns as CSV, first is the _id and second is JSON document as a string. This will become more apparent later when we look at the replication task output. You can find more information here.", "AWS DMS supports multiple target database types and S3. Configuring the S3 target is fairly simple as shown below. The bucket folder defines the prefix under which each of the tables is written.", "The most important settings are Extra Connection Attributes. This is for any Target. You can specify compression, delimiters, formats, etc The AWS Docs are very detailed on this and provide good examples. I\u2019ve found that CDC Path has no effect, maybe this is because the DMS API doesn\u2019t actually allow specifying this.", "Once the endpoints are defined, we need to define a Migration Task. A Migration Task is a definition of which data and how to copy data from Source Endpoint to Target Endpoint. The Migration Type setting allows migrating as a one time load or as continuous replication.", "The Task Settings are worth discussion. The first option is Target Table Preparation Mode ; this defines the behaviour for writing to the destination table. For S3, this refers to the prefix. Do Nothing will add data, Drop Tables on Target will delete table prefixes for selected tables and truncate will delete all data objects under the table prefix. This is a global setting for all selected tables in the task.", "Include LOB Columns in Replication controls how large binary objects are migrated. BLOB/CLOB field types can contain megabytes of data which can be difficult to migrate. DMS allows reading a truncated form of this type or can exclude them entirely. Usually Limited LOB mode is the best practice, however, Full LOB mode may be used when the destination database/system can handle such data types. Unfortunately, the S3 target endpoint doesn\u2019t support Full LOB mode.", "Enable Validation is a great feature but again not supported by S3. For other database types, DMS allows verification that all data has been copied completely and accurately. For S3 we can see this when we look at the metrics.", "As a quick note, Control Tables allow auditing and logging of DMS actions and status. This can be useful in addition to the logs to quickly inspect the state.", "Once the task has been created and started, the data will start flowing via your replication instance. It should be noted that the Replication instance cannot be changed after the task has been created. If you need to run the task on a new replication instance, a new task needs to be created.", "Below is a skeleton of monitoring provided by DMS, which happens to be quite detailed. My MongoDB source is a small instance with mock data. so only had few hundred documents. However, it is evident that table/collection level monitoring is possible and updated almost instantaneously via CloudWatch include all inserts, updates, and deletes. Full Load and CDC metrics are provided separately at a task level too. EC2 metrics along with these can inform decisions on how many tasks to run on each replication instance and whether the instance type needs updating.", "Hopefully, this guide has given you a good starting point to DMS and how it can be used not just for database migration but data ingestion into a Data Lake. I\u2019ve shown you an example of connecting to MongoDB, however, you can connect DynamoDB with MongoDB compatibility too! As new versions of DMS and DynamoDB are released, this will add more features including CDC replication. Since DMS is a managed service, it makes it easier to operate and provides full integration with Cloudwatch for monitoring and alerting.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F978967aed8dd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://atharva-inamdar.medium.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": ""}, {"url": "https://atharva-inamdar.medium.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Atharva Inamdar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb60da41cfbf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&user=Atharva+Inamdar&userId=b60da41cfbf8&source=post_page-b60da41cfbf8----978967aed8dd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://aws.amazon.com/dms/", "anchor_text": "AWS DMS"}, {"url": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.html#CHAP_ReplicationInstance.Creating", "anchor_text": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.html#CHAP_ReplicationInstance.Creating"}, {"url": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.MongoDB.html", "anchor_text": "here"}, {"url": "https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Target.S3.html", "anchor_text": "AWS Docs"}, {"url": "https://medium.com/tag/aws?source=post_page-----978967aed8dd---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/aws-dms?source=post_page-----978967aed8dd---------------aws_dms-----------------", "anchor_text": "Aws Dms"}, {"url": "https://medium.com/tag/migration?source=post_page-----978967aed8dd---------------migration-----------------", "anchor_text": "Migration"}, {"url": "https://medium.com/tag/etl?source=post_page-----978967aed8dd---------------etl-----------------", "anchor_text": "Etl"}, {"url": "https://medium.com/tag/data-ingestion?source=post_page-----978967aed8dd---------------data_ingestion-----------------", "anchor_text": "Data Ingestion"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&user=Atharva+Inamdar&userId=b60da41cfbf8&source=-----978967aed8dd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&user=Atharva+Inamdar&userId=b60da41cfbf8&source=-----978967aed8dd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F978967aed8dd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----978967aed8dd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----978967aed8dd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----978967aed8dd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----978967aed8dd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----978967aed8dd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----978967aed8dd--------------------------------", "anchor_text": ""}, {"url": "https://atharva-inamdar.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://atharva-inamdar.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Atharva Inamdar"}, {"url": "https://atharva-inamdar.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "75 Followers"}, {"url": "https://twitter.com/atharvai", "anchor_text": "https://twitter.com/atharvai"}, {"url": "https://github.com/atharvai", "anchor_text": "https://github.com/atharvai"}, {"url": "https://www.linkedin.com/in/ainamdar/", "anchor_text": "https://www.linkedin.com/in/ainamdar/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb60da41cfbf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&user=Atharva+Inamdar&userId=b60da41cfbf8&source=post_page-b60da41cfbf8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fcfae0acb6167&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-aws-dms-to-tail-mongodb-978967aed8dd&newsletterV3=b60da41cfbf8&newsletterV3Id=cfae0acb6167&user=Atharva+Inamdar&userId=b60da41cfbf8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}