{"url": "https://towardsdatascience.com/how-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29", "time": 1682994082.187038, "path": "towardsdatascience.com/how-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29/", "webpage": {"metadata": {"title": "How to Build a Market Simulator Using Markov Chains and Python | by Bassim Eledath | Towards Data Science", "h1": "How to Build a Market Simulator Using Markov Chains and Python", "description": "In this article, I aim to introduce you (regardless of your technical ability) to Markov chains and use it to simulate customer behavior. This isn\u2019t going to be a traditional \u201chow to\u201d tutorial with\u2026"}, "outgoing_paragraph_urls": [{"url": "https://mathinsight.org/matrix_vector_multiplication", "anchor_text": "link", "paragraph_index": 14}, {"url": "http://github.com/bassimeledath", "anchor_text": "github.com/bassimeledath", "paragraph_index": 35}], "all_paragraphs": ["In this article, I aim to introduce you (regardless of your technical ability) to Markov chains and use it to simulate customer behavior.", "This isn\u2019t going to be a traditional \u201chow to\u201d tutorial with code snippets every two lines. My primary aim in writing this is to provide you with a conceptual framework that you can flexibly use, so you do not necessarily have to code along to learn something new. Technical details will pop up here and there, but I will provide as much intuition for them as possible.", "For this analysis I will be using Credit Sesame\u2019s analytics data that I was provided with during a datathon. You can use any user data provided it spans your time-frame of interest (for example a week\u2019s/month\u2019s/year\u2019s worth of data). It should follow a structure similar to the one below.", "Examples of action can be \u201cclicked offer/ad\u201d, \u201cclicked subscribe\u201d etc. Columns can also be other metrics such as page views or revenue. Include any column you think will be useful for what you plan on modeling \u2014 in my case, it is user engagement.", "Select a particular day in your dataset and get new-user data for that particular day. I am modeling how new users behave within 30 days of using Credit Sesame\u2019s website.", "Next, we segment our customers into different categories or states. There are many ways you can do this.", "2. Apply an unsupervised algorithm such as k-means: You may use clustering algorithms such as k-means to cluster similarly engaged customers. Each cluster would have their own distinct properties which are hopefully the ones you wish to model. You could even apply the algorithm on your previously calculated score function (univariate data) to make it even simpler.", "After segmenting first day data, you pick a time-frame. I chose to go with a month as I believe Credit Sesame has a lot of returning users and the magnitude of that can be captured with a month\u2019s worth of data. After 30 days, users would have had the opportunity to shift to and from each segment: very active users may become inactive, moderately active users may become very active, and so on.", "Apply segmentation to this post-30-day data. Make sure you account for the time frame (for example, average your engagement score for the 30 days).", "As expected, the number of users who became inactive rose over the 30 days and the number of users who stayed active and very active decreased.", "Markov chains are simply mathematical systems that model state-to-state movement using certain probabilistic rules and fixed assumptions.", "To put it more simply, when you have a system with fixed states (or segments), and agents/users who can move between those states with a certain fixed probability, you can model it using a Markov chain.", "But let us first see if our system satisfies the assumptions of a Markov model:", "Our system performs well against most assumptions of the Markov chain. This gives us some confidence in our model estimates, which we will get to once we build the model.", "There are three parts to a Markov chain that are best represented as matrix-vector multiplication. If you are completely new to linear algebra, I would recommend going through this link before proceeding with the article.", "The initial state in our system is a 3x1 vector that represents the number of users in each segment. The end state is also a 3x1 vector that shows the number of users in each segment after the first month (after we multiply the initial state vector with the probabilities matrix). The transition probability matrix is a 3x3 matrix that represents the fixed probabilities of moving to and from different customer segments.", "So how do we calculate these fixed probabilities?", "From our recorded segment movements. We look at how users from each segment on day 1 moved to various segments after 30 days and calculate the probabilities accordingly (equivalent to proportions).", "0.89 (in the picture) refers to the probability that someone in segment 1 on day 1 stays in the same segment after 30 days i.e. it is the probability that an inactive user will stay inactive after 30 days. Note, the probabilities in each column must add up to 1. We repeat this process for all segments and build the final transition matrix:", "Finally, we put it all together into this nice beautiful form:", "Now that we\u2019ve modeled it, we can get to the fun stuff.", "Let\u2019s start by plotting the trend in our customer movement given our Markov chain.", "What can we infer from this?", "We see that after a period of around 2 months, all three segments hit an equilibrium i.e. while there are users moving from segment to segment, the overall number of customers in each segment stays constant.", "But there\u2019s a catch. There is a very strong assumption we\u2019re making here \u2014 we believe the probabilities are going to be fixed no matter how far into the future we predict user behavior. This is highly implausible. Let me give you an example: say you own a website that sells winter clothing. Active users who buy several coats over December are highly unlikely to follow the same shopping pattern in, say, July. Patterns can be seasonal and our Markov model does not capture that!", "We can either calculate different transition matrices for every month to capture these trends or we can restrict our domain of analysis to one month. Since the data I have only spans one month, I go for the latter option. If you do have data that spans further, I would encourage you to compare real data results to the Markov model output to see if the transition probabilities do stay fixed over the months, and adjust accordingly.", "The results I get are shown below:", "Now that you have a model that describes customer behavior, how can we introduce \u201cchanges\u201d or \u201cinterventions\u201d, and model their impact? Well our Markov model recognizes two types of these changes:", "Let\u2019s say you own a pizza service and your website offers a buy-2-get-1-free deal on December 1st. You suspect this change will introduce many more active users who visit your website. Your assumptions are confirmed when you get a thousand unique new visitors, 300 of whom actually buy pizza (very active users) on that very day. You are pleasantly surprised and think \u201chmmm I\u2019m used to getting a 100 orders a day: how will this fare in a month\u2019s time.\u201d You simply have to adjust the initial state in the Markov chain to account for this change.", "From changing the initial state from (inactive=500, active=400, very active=100) to (100, 600, 300), we get the results above. With more active and very active users early in the month, you increase your chance of having more repeat customers for the span of the month.", "You realize that these deals are good but they only impact initial states and the benefits of these deals do not last for several months i.e. they are short term solutions to expanding engaged users. In order to have more long lasting changes we\u2019d have to introduce actions that change the probabilities. Let\u2019s say you completely redesign your pizza delivery website to make checking out 10x faster. This is a type of action that will affect the number of users in each segment consistently. In order to account this type of change we change the probabilities in the transition matrix. You can calculate the changed probabilities either by A/B testing the new website on a subsample of users, or, you can change them manually using your own heuristics and assumptions.", "Assuming probabilities stay fixed, we can see how the customer flow changes with the new transition matrix.", "You can predict several other user metrics such as Customer Lifetime Value, revenue per user etc. using the techniques we described above. For example, to predict revenue changes, calculate the average revenue for each segment, calculate the output state, and multiply the revenue with the number of users in their respective segment.", "If you\u2019ve gotten this far, I commend you. At a minimum, I hope I have been able to convey the beauty of Markov chains and their ability to provide key insights despite their simplicity (assuming the key assumptions are satisfied). I hope you find your own creative ways to apply this model!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senor Data Science Consultant @ Andela | github.com/bassimeledath"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7923256f8d29&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----7923256f8d29--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bassimfaizal?source=post_page-----7923256f8d29--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bassimfaizal?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Bassim Eledath"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3646d306eb30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&user=Bassim+Eledath&userId=3646d306eb30&source=post_page-3646d306eb30----7923256f8d29---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://mathinsight.org/matrix_vector_multiplication", "anchor_text": "link"}, {"url": "https://medium.com/tag/a-b-testing?source=post_page-----7923256f8d29---------------a_b_testing-----------------", "anchor_text": "A B Testing"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----7923256f8d29---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/data-science?source=post_page-----7923256f8d29---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/analytics?source=post_page-----7923256f8d29---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----7923256f8d29---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&user=Bassim+Eledath&userId=3646d306eb30&source=-----7923256f8d29---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&user=Bassim+Eledath&userId=3646d306eb30&source=-----7923256f8d29---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F7923256f8d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----7923256f8d29---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----7923256f8d29--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----7923256f8d29--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----7923256f8d29--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----7923256f8d29--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----7923256f8d29--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bassimfaizal?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bassimfaizal?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bassim Eledath"}, {"url": "https://medium.com/@bassimfaizal/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "135 Followers"}, {"url": "http://github.com/bassimeledath", "anchor_text": "github.com/bassimeledath"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3646d306eb30&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&user=Bassim+Eledath&userId=3646d306eb30&source=post_page-3646d306eb30--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F874fbc10b3c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-a-market-simulator-using-markov-chains-and-python-7923256f8d29&newsletterV3=3646d306eb30&newsletterV3Id=874fbc10b3c2&user=Bassim+Eledath&userId=3646d306eb30&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}