{"url": "https://towardsdatascience.com/beeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071", "time": 1682993180.13137, "path": "towardsdatascience.com/beeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071/", "webpage": {"metadata": {"title": "Beeralytics \u2014 A Guide to Analyzing Beer Prices from Web Data | by Matt Grierson | Towards Data Science", "h1": "Beeralytics \u2014 A Guide to Analyzing Beer Prices from Web Data", "description": "A few weeks ago my girlfriend and I were having drinks at a bar and started debating what the cheapest beer on the menu was. The challenge itself was that there were multiple sizes and alcohol\u2026"}, "outgoing_paragraph_urls": [{"url": "https://drizly.com/", "anchor_text": "Drizly", "paragraph_index": 2}, {"url": "https://minibardelivery.com/", "anchor_text": "Minibar", "paragraph_index": 2}, {"url": "https://requests.readthedocs.io/en/master/", "anchor_text": "Requests", "paragraph_index": 3}, {"url": "https://bokeh.org/", "anchor_text": "Bokeh", "paragraph_index": 3}, {"url": "https://github.com/mattygyo/minibar-project", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401", "anchor_text": "401 unauthorized error", "paragraph_index": 6}, {"url": "https://requests.readthedocs.io/en/master/user/quickstart/#custom-headers", "anchor_text": "headers parameter", "paragraph_index": 7}, {"url": "https://www.crummy.com/software/BeautifulSoup/", "anchor_text": "Beautiful Soup", "paragraph_index": 9}, {"url": "https://github.com/ResidentMario/missingno", "anchor_text": "missingno", "paragraph_index": 12}, {"url": "https://untappd.com/", "anchor_text": "https://untappd.com/", "paragraph_index": 13}, {"url": "https://docs.bokeh.org/", "anchor_text": "Bokeh", "paragraph_index": 15}, {"url": "https://demo.bokeh.org/movies", "anchor_text": "move ratings one", "paragraph_index": 15}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide.html", "anchor_text": "read the docs", "paragraph_index": 16}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide/interaction/callbacks.html#javascript-callbacks", "anchor_text": "CustomJS model", "paragraph_index": 29}, {"url": "https://towardsdatascience.com/a-beginners-guide-to-grabbing-and-analyzing-salary-data-in-python-e8c60eab186e?source=friends_link&sk=343d0c494a90e460a0c57f8867f74743", "anchor_text": "Exploratory Data Analysis", "paragraph_index": 31}], "all_paragraphs": ["A few weeks ago my girlfriend and I were having drinks at a bar and started debating what the cheapest beer on the menu was. The challenge itself was that there were multiple sizes and alcohol content across 20-or-so beers which made simple comparisons a challenge. Bets were made, and we started doing cell phone math (I swear we\u2019re this exciting all the time) using a basic formula to normalize them:", "This revealed that the high ABV IPAs were the most value for your money by a decent margin! Now that I had lost yet another betting game to my girlfriend I was curious as to whether this was a local choice (maybe the bar had trouble moving those kinds of drinks) or was this kind of pricing consistent at scale? This seemed like a fun data science problem, so I started brainstorming ways in which to answer this question.", "A decade ago, this probably wouldn\u2019t be possible without proprietary datasets or visiting each individual store and writing down all the pricing (I\u2019m sure store owners love that). Instead we now have a plethora of delivery services like Drizly and Minibar that act as an aggregator by offering beer delivery via local stores.", "The rest of the article will go into the method of how to pull data from a website using the Python Requests library, chart and library selection based on the kind of data you are pulling, and medium- to advanced-techniques of visualization using the Bokeh library. The final files and code explained below can be found and forked here.", "Like I said in the intro, the first challenge was capturing the data so that I could actually perform some analysis on it. Neither has an API, so I started looking at the structure of their website and network calls to see which/either could be viable. Drizly has a very odd way of injecting data directly into react components so that there\u2019s never a simple JSON payload in the network calls (maybe for obfuscation purposes?), and it was clearly going to take a lot of time to morph it in a usable form. Switching focus to Minibar, I quickly found they not only had a standard JSON payload that was easy to grab, but had a bunch of metadata too, yeehaw!", "Once I found this, it was just a matter of using the Requests library to pull the JSON\u2026Or so I thought. After creating a simple request, I was met with an error message:", "Hm, well this is awkward. Running item_count.status_code also confirms a 401 unauthorized error, which means our response is correctly making it to the server but is getting denied due to missing some kind of credential alongside the request. Since tokens aren\u2019t created out of thin air and the site requires no sign-in, the only logical conclusion was that it must be created for the session once a user visits the site. This prompted me to check the request headers section of XHR request referenced above, and lo and behold I came across a bearer token:", "Once I added in the headers parameter I was able to confirm this worked and returned data! The next challenge was to figure out how to programmatically grab and and add the bearer token to the request, since the the token would likely auto-expire in some set amount of time. My plan roughly became:", "The bearer turned out to be a pain to find on the main page since it wasn\u2019t in any XHR requests, but instead included as one of the meta name tags:", "So how are we going to grab something if it\u2019s not in json? Simple, we\u2019ll treat it like a normal web page and use Beautiful Soup! This can be done by writing a really simple function:", "As you can see, all we did was specify to Beautiful Soup that the text should be treated like HTML, and then told it to return the contents of the access-token attribute. This saves us from doing any kind of convoluted or error-prone regex to find the token. Now that we can dynamically grab the data at any time it\u2019s just a matter of flattening it into a DataFrame.", "Looking at the JSON, many beers had \u2018variants\u2019 (different prices due to pack size/store-specific sales/container types/etc.) which I also wanted to capture and contrast. Using the following code I was able to loop through all the beers based on a count variable in the initial call, add each variant as an individual line item, and then output it into a single DataFrame", "Once I had ~2,000 beers in the DataFrame I used the missingno library to get a sense of how complete the data was:", "Turns out alcohol %, the crux of my whole experiment, was missing for a LOT of beers, about 3/5 of the dataset. Blinded by stubbornness and zeal, I did what any rational person would do in this situation \u2014 I grabbed a 6-pack from the store and spent the next several hours manually plugging in values I found searching sites like https://untappd.com/. Eventually I completed both the beer and the data entry, and was ready to move on to the next phase.", "So now that we have a nice dataset, we need to think about how we want to effectively visualize the data. The data has both quantitative and categorical dimensions, and we\u2019re going to want to compare things like type of beer, container type, etc. against different attributes. Considering the amount of potential data points at any given point as well, scatterplots stuck out as a good choice given their ability to easily display pattern and correlation trends. I also knew there were a few different advanced interactions I wanted to perform with the visualization:", "After experimenting with a few familiar simple graphing libraries I realized that this was not going to work without a highly flexible and customizable library. I ended up settling on Bokeh which not only has a huge library of pre-made charts, but also came with some great examples \u2014 particularly this move ratings one. I decided this one would suit my needs with only minor tweaks, so with that it was full-steam ahead!", "I\u2019ll warn you right now, if you want to do anything beyond basic graphs with Bokeh, read the docs. I resisted at first and it resulted in me filtering through Stack Overflow and Google for hours like a lost child. Understanding the structure of where to access and update objects like glyphs and how ColumnDataSource updates data are key concepts you should try and understand without diving too much further.", "My second disclaimer is that some of this code is likely not efficient, but if I tried to tune/understand it anymore I would have never published this.", "Bokeh for the most part is pretty easy to understand after looking through a few examples on their site, plus I\u2019m basically using the movie example. The idea in bullet points is:", "It seems like a lot of code but it is mainly making unique lists of columns you want for filters, assigning those lists to widgets, and setting default values for the filter.", "We\u2019ll also add in a section to create a figure, glyphs, and all the styling needed for our final chart. We have both a bar and legend in here because we\u2019ll need to toggle their visibility in order to switch between quantitative and categorical selections:", "Perfect! Now that the basics are out of the way we can move to the more advanced concepts.", "One of the things I wanted to do was to map either categorical OR quantitative data to the points on the plot. I wanted the color bar to rescale on quantitative data as well, or else outliers (like the price of a keg) would mess with the color distribution of filtered data. Without going deep on the fundamental issues, my logic ended up looking like this:", "Now that we have the framework for updating our color scales/legends, we can move onto how to update everything once a user interacts with our widget filters.", "We\u2019re going to heavily mirror the movie graph example for this, but I\u2019ll walk through the concepts briefly. We want to create a function called select_beer() which will find all the current values for our widget filters, and then filter the dataset based on those selections:", "The next thing we want to write is an update() function which will update the graph elements (such as name of axis and total # of beers selected), as well as update the ColumnDataSource which is how the data on the graph is updated. It will finally force updates on the legend/color scales by calling cat_linear_toggle and updating the legend. The final points applies to jitter to the newly filtered data:", "After that\u2019s done all we need to do is setup callbacks for all our controls. The final output is very similar to the generic bokeh in the movie example. I added a os.system(...) at the end to make it convenient to run on my local:", "Running this all together gave me the first visual of what we put together, not bad!", "At this point I felt pretty happy with the output and thought I was done, but once I started examining the data I tried to highlight areas of points on the chart to filter the data table. Many data points were on top of each other, and it was difficult to examine without some way of seeing underlying selection areas. Bokeh graphs naturally handle selecting data on graphs through their default tools such as box_select, but there\u2019s no default way to reflect this on the data table.", "After reading and googling more about it,I came to the unfortunate conclusion that this could not be done using the default library\u2026ughhhhh. Luckily, Bokeh allows for use of JavaScript through the CustomJS model, and what I needed to accomplish required very little knowledge of JS. What we want to do is the following:", "And there we have it! The final result should only then show the selected points reflected in the data table, similar to what you see below when I select a few data points on the graph:", "I know what you may be thinking \u2014 what about the actual beer?! So turns out there were very few surprises, the malt beverage brand 4Loko (aka battery acid in a can) was by far and away the cheapest in my area with a \u2018Oz of Alcohol per $\u2019 of $0.72, about $0.10 per oz cheaper than the next best challenger. \u201cAlcohol %\u201d (ABV) turns out to be the best baseline predictor for value, which you can confirm through Exploratory Data Analysis or other means.", "Ultimately you could probably do more like including additional zip code areas or sites into this analysis, but the excessive missing data definitely affects what you can do without some manual data cleaning. Bokeh was also really interesting to work with, but I\u2019m not sure I\u2019ll start with it as my first choice for graphs in the future. Maybe if I was doing data visualization for a job I would consider it, but the learning curve is pretty steep for most things people need to show with graphs.", "Hope this was helpful to anyone out there and feel free to reach out or comment below with questions/comments. Thanks for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F37d4ba206071&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----37d4ba206071--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mattygyo?source=post_page-----37d4ba206071--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattygyo?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Matt Grierson"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F642d1ad397ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&user=Matt+Grierson&userId=642d1ad397ba&source=post_page-642d1ad397ba----37d4ba206071---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@albanmartel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Alban Martel"}, {"url": "https://unsplash.com/s/photos/beers?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://drizly.com/", "anchor_text": "Drizly"}, {"url": "https://minibardelivery.com/", "anchor_text": "Minibar"}, {"url": "https://requests.readthedocs.io/en/master/", "anchor_text": "Requests"}, {"url": "https://bokeh.org/", "anchor_text": "Bokeh"}, {"url": "https://github.com/mattygyo/minibar-project", "anchor_text": "here"}, {"url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401", "anchor_text": "401 unauthorized error"}, {"url": "https://requests.readthedocs.io/en/master/user/quickstart/#custom-headers", "anchor_text": "headers parameter"}, {"url": "https://minibardelivery.com/", "anchor_text": "https://minibardelivery.com/"}, {"url": "https://www.crummy.com/software/BeautifulSoup/", "anchor_text": "Beautiful Soup"}, {"url": "https://minibardelivery.com'", "anchor_text": "https://minibardelivery.com'"}, {"url": "https://minibardelivery.com'", "anchor_text": "https://minibardelivery.com'"}, {"url": "https://github.com/ResidentMario/missingno", "anchor_text": "missingno"}, {"url": "https://untappd.com/", "anchor_text": "https://untappd.com/"}, {"url": "https://www.beeradvocate.com/beer/profile/29/66/", "anchor_text": "King Cobra"}, {"url": "https://docs.bokeh.org/", "anchor_text": "Bokeh"}, {"url": "https://demo.bokeh.org/movies", "anchor_text": "move ratings one"}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide.html", "anchor_text": "read the docs"}, {"url": "http://twitter.com/name", "anchor_text": "@name"}, {"url": "http://twitter.com/brand", "anchor_text": "@brand"}, {"url": "http://twitter.com/price", "anchor_text": "@price"}, {"url": "http://twitter.com/alcohol_pct", "anchor_text": "@alcohol_pct"}, {"url": "http://twitter.com/hierarchy_type", "anchor_text": "@hierarchy_type"}, {"url": "http://twitter.com/hierarchy_subtype", "anchor_text": "@hierarchy_subtype"}, {"url": "https://docs.bokeh.org/en/latest/docs/user_guide/interaction/callbacks.html#javascript-callbacks", "anchor_text": "CustomJS model"}, {"url": "https://towardsdatascience.com/a-beginners-guide-to-grabbing-and-analyzing-salary-data-in-python-e8c60eab186e?source=friends_link&sk=343d0c494a90e460a0c57f8867f74743", "anchor_text": "Exploratory Data Analysis"}, {"url": "https://medium.com/tag/data-science?source=post_page-----37d4ba206071---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----37d4ba206071---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----37d4ba206071---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/programming?source=post_page-----37d4ba206071---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----37d4ba206071---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&user=Matt+Grierson&userId=642d1ad397ba&source=-----37d4ba206071---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&user=Matt+Grierson&userId=642d1ad397ba&source=-----37d4ba206071---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F37d4ba206071&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----37d4ba206071---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----37d4ba206071--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----37d4ba206071--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----37d4ba206071--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----37d4ba206071--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----37d4ba206071--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattygyo?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mattygyo?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matt Grierson"}, {"url": "https://medium.com/@mattygyo/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "346 Followers"}, {"url": "https://www.linkedin.com/in/matthewgrierson/", "anchor_text": "https://www.linkedin.com/in/matthewgrierson/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F642d1ad397ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&user=Matt+Grierson&userId=642d1ad397ba&source=post_page-642d1ad397ba--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbcc255d5ba5e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeeralytics-a-guide-to-analyzing-beer-prices-from-web-data-37d4ba206071&newsletterV3=642d1ad397ba&newsletterV3Id=bcc255d5ba5e&user=Matt+Grierson&userId=642d1ad397ba&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}