{"url": "https://towardsdatascience.com/training-serving-skew-77d947c4c100", "time": 1683018336.213792, "path": "towardsdatascience.com/training-serving-skew-77d947c4c100/", "webpage": {"metadata": {"title": "MLOps In Action: Training-serving skew | by Eduardo Blancas | Towards Data Science", "h1": "MLOps In Action: Training-serving skew", "description": "Once we clean the data (2), we apply transformations (3) to it to make the learning problem easier. Feature engineering is a particularly important task when working with tabular data and classic ML\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Independence_(probability_theory)", "anchor_text": "statistically independent", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Feature_scaling", "anchor_text": "feature scaling", "paragraph_index": 4}, {"url": "https://developers.google.com/machine-learning/guides/rules-of-ml#training-serving_skew", "anchor_text": "term", "paragraph_index": 10}, {"url": "https://github.com/ploomber/ploomber", "anchor_text": "Ploomber", "paragraph_index": 16}, {"url": "https://dvc.org/doc/start/data-pipelines", "anchor_text": "DVC Pipelines", "paragraph_index": 16}, {"url": "https://github.com/ropensci/drake", "anchor_text": "drake", "paragraph_index": 16}, {"url": "https://feast.dev/", "anchor_text": "Feast", "paragraph_index": 18}, {"url": "https://github.com/ploomber/posts/issues/new?title=Issue%20in%20post%3A%20%22Training-serving%20skew%22", "anchor_text": "Click here to let us know", "paragraph_index": 21}, {"url": "https://ploomber.io/", "anchor_text": "https://ploomber.io/", "paragraph_index": 23}], "all_paragraphs": ["When training a Machine Learning model, we always follow the same series of steps:", "Once we clean the data (2), we apply transformations (3) to it to make the learning problem easier. Feature engineering is a particularly important task when working with tabular data and classic ML models (which is the most common setting in industry), the only exception are Deep Learning models, where there is little to no feature engineering. This post focuses on the former scenario.", "When deploying a model, the pipelines look very similar, except we make predictions using a previously trained model after computing the features. However, not all deployments are equal, the two most common settings are:", "Feature engineering is the set of statistically independent transformations that operate on a single (or group of) observation(s). In practical terms, it means that no information from the training set is part of the transformation.", "This contrasts with some pre-processing procedures such as feature scaling, where information from the training set (i.e. mean and standard deviation) is used as part of the transformation (subtract mean, divide by standard deviation). These pre-processing methods are not feature engineering, but part of the model itself: mean and standard deviation are \u201clearned\u201d from the training set and then applied to the validation/test set.", "In mathematical terms, we can express the feature engineering process as a function that transforms a raw input into another vector that is used to train the model.", "Ideally, we should re-use the same feature engineering code to guarantee that a given raw input maps to the same feature vector at training and serving time. If this does not happen, we have training-serving skew. One common reason for this is a mismatch of computational resources at training and serving time.", "Imagine you are working on a new ML project and decide to write your pipeline using Spark. A few months later, you have the first version and are ready to deploy it as a microservice. It would be very inefficient to require your microservice to connect to a Spark cluster to make a new prediction, hence, you decide to re-implement all your feature engineering code using numpy/pandas to avoid any extra infrastructure. All of a sudden, you have two feature engineering codebases to maintain (spark and numpy/pandas). Given an input, you must ensure they the same output to avoid training-serving skew.", "This is less of a problem with batch deployments, since you usually have the same resources available at training and serving time, but always keep this situation in mind. And whenever possible, use a training technology stack that can also be used at serving time.", "If for any reason, you cannot re-use your feature engineering training code. You must test for training-serving skew before deploying a new model. To do this, pass your raw data through your feature engineering pipelines (training and serving), then compare the output. All raw input vectors should map to the same output feature vector.", "Note that training-serving skew is not a universally defined term. For the purpose of this post, we limit the definition to a discrepancy between the training and serving feature engineering code.", "If you are able to re-use feature engineering at training and serving time, you must ensure the code is modular so you can integrate it in both pipelines easily, the next sections present three ways of doing so.", "The simplest approach is to abstract your feature engineering code in a function and call it at training and serving time:", "Then, call your generate_features function in your microservice code, here's an example if using Flask:", "While simple, the first solution above does not offer a great development experience. Developing features is a highly iterative process. The best way to accelerate this is via incremental builds, which keep track of source code changes and skip redundant work.", "Say for example you have 20 features that are independent of each other, if you modify one of them, you can skip the rest since they\u2019ll produce identical results if you executed them before.", "Workflow managers are frameworks that allow you to describe a graph of computations (such as feature engineering code). There are many options to choose from, unfortunately, only a few of them support incremental builds, Ploomber is one of them. Other options are DVC Pipelines and drake for R.", "To enable incremental builds, workflow managers save results to disk, and load them if the source code hasn\u2019t changed. In production, you usually want to perform in-memory operations exclusively because disk access is slow. As far as I know, Ploomber is the only workflow manager that allows you to convert a batch-based pipeline to an in-memory one for deployment without any code changes.", "Another solution is to use a feature store, which is an external system that pre-computes features for you. You only need to fetch the ones you want for model training and serving. Here\u2019s an example using Feast, an open-source feature store:", "A feature store is a great way to tackle training-serving skew. It also reduces development time, since you only need to code a feature once. This is a great solution for batch deployments and some online ones. If your online model expects user-submitted input data (e.g. a model the classifies images from a user\u2019s camera), a feature store is unfeasible.", "The main caveat is that you need to invest in maintaining the feature store infrastructure, but if you are developing many models that can benefit from the same set of features, it is worth considering this option.", "Found an error? Click here to let us know.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist turned startup founder. M.S. in Data Science from Columbia University. Currently building Ploomber: https://ploomber.io/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F77d947c4c100&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://edublancas.medium.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": ""}, {"url": "https://edublancas.medium.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Eduardo Blancas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1ed5e037fe0e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&user=Eduardo+Blancas&userId=1ed5e037fe0e&source=post_page-1ed5e037fe0e----77d947c4c100---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Independence_(probability_theory)", "anchor_text": "statistically independent"}, {"url": "https://en.wikipedia.org/wiki/Feature_scaling", "anchor_text": "feature scaling"}, {"url": "https://developers.google.com/machine-learning/guides/rules-of-ml#training-serving_skew", "anchor_text": "term"}, {"url": "https://github.com/ploomber/ploomber", "anchor_text": "Ploomber"}, {"url": "https://dvc.org/doc/start/data-pipelines", "anchor_text": "DVC Pipelines"}, {"url": "https://github.com/ropensci/drake", "anchor_text": "drake"}, {"url": "https://feast.dev/", "anchor_text": "Feast"}, {"url": "https://github.com/ploomber/posts/issues/new?title=Issue%20in%20post%3A%20%22Training-serving%20skew%22", "anchor_text": "Click here to let us know"}, {"url": "https://ploomber.io/posts/train-serve-skew/", "anchor_text": "ploomber.io"}, {"url": "https://medium.com/tag/data-science?source=post_page-----77d947c4c100---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----77d947c4c100---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/python?source=post_page-----77d947c4c100---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/ai?source=post_page-----77d947c4c100---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/mlops?source=post_page-----77d947c4c100---------------mlops-----------------", "anchor_text": "Mlops"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&user=Eduardo+Blancas&userId=1ed5e037fe0e&source=-----77d947c4c100---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&user=Eduardo+Blancas&userId=1ed5e037fe0e&source=-----77d947c4c100---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F77d947c4c100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----77d947c4c100---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----77d947c4c100--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----77d947c4c100--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----77d947c4c100--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----77d947c4c100--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----77d947c4c100--------------------------------", "anchor_text": ""}, {"url": "https://edublancas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://edublancas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Eduardo Blancas"}, {"url": "https://edublancas.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "617 Followers"}, {"url": "https://ploomber.io/", "anchor_text": "https://ploomber.io/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1ed5e037fe0e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&user=Eduardo+Blancas&userId=1ed5e037fe0e&source=post_page-1ed5e037fe0e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe100b6d296f3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraining-serving-skew-77d947c4c100&newsletterV3=1ed5e037fe0e&newsletterV3Id=e100b6d296f3&user=Eduardo+Blancas&userId=1ed5e037fe0e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}