{"url": "https://towardsdatascience.com/how-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1", "time": 1683004934.200232, "path": "towardsdatascience.com/how-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1/", "webpage": {"metadata": {"title": "How to use Cypher projection in Neo4j Graph Data Science library on a Lord of the Rings social network | by Tomaz Bratanic | Towards Data Science", "h1": "How to use Cypher projection in Neo4j Graph Data Science library on a Lord of the Rings social network", "description": "Continuing the introduction of the Neo4j Graph data science library graph catalog feature from the last blog post, where we took a deep dive in Native projections, we will take a look at Cypher\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/neo4j/graph-data-science", "anchor_text": "Neo4j Graph data science library", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/exploring-the-graph-catalog-feature-of-neo4j-graph-data-science-plugin-on-a-lord-of-the-rings-d2de0d0a023", "anchor_text": "last blog post", "paragraph_index": 0}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/native-projection/", "anchor_text": "Native projections", "paragraph_index": 0}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/cypher-projection/", "anchor_text": "Cypher projection", "paragraph_index": 0}, {"url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/", "anchor_text": "APOC library", "paragraph_index": 1}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/native-projection/", "anchor_text": "native projection", "paragraph_index": 8}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/alpha-algorithms/random-walk/", "anchor_text": "Random Walk algorithm", "paragraph_index": 12}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/algorithms/triangle-counting-clustering-coefficient/", "anchor_text": "Triangle Count and Clustering Coefficient algorithm", "paragraph_index": 14}, {"url": "https://twitter.com/kennybastani", "anchor_text": "Kenny Bastani", "paragraph_index": 19}, {"url": "https://neo4j.com/blog/categorical-pagerank-using-neo4j-apache-spark/", "anchor_text": "blog post", "paragraph_index": 19}, {"url": "https://tbgraph.wordpress.com/2018/01/14/neo4j-categorical-pagerank/", "anchor_text": "blog post", "paragraph_index": 19}, {"url": "https://tbgraph.wordpress.com/2018/01/14/neo4j-categorical-pagerank/", "anchor_text": "original blog post", "paragraph_index": 27}, {"url": "https://github.com/neo4j/graph-data-science", "anchor_text": "Graph Data Science library", "paragraph_index": 30}, {"url": "https://github.com/tomasonjo/blogs/blob/master/lotr_graph_data_science_catalog/Cypher%20projection%20of%20the%20Graph%20Catalog%20feature%20on%20a%20Lord%20of%20the%20Rings%20network.ipynb", "anchor_text": "GitHub", "paragraph_index": 31}, {"url": "http://mng.bz/GGVN", "anchor_text": "http://mng.bz/GGVN", "paragraph_index": 33}], "all_paragraphs": ["Continuing the introduction of the Neo4j Graph data science library graph catalog feature from the last blog post, where we took a deep dive in Native projections, we will take a look at Cypher projection in this blog post. It is the more expressive variant of the graph projection and allows us to project virtual graphs as well.", "We will be using some procedures from the APOC library in our import statement. I have gotten so used to always having APOC around, that I rarely even mention it individually. It contains many awesome procedures, and it is hard to imagine life without it.", "The general syntax to use cypher projection is:", "Node query is a cypher statement used to describe the nodes we want to project. It must return the internal ids of the nodes and optionally any of their properties. Relationship query, on the other hand, describes the relationships we want to project. The cypher statement should return internal ids of source and target nodes of relationships, and optionally their type and any of their properties.", "We will begin with a simple scenario and project the entire graph in memory. Adding the column type in the relationship query allows the data science engine to distinguish between relationship types, which in turn gives us an option to filter relationships when executing algorithms.", "As in the previous blog post, we will start with the weakly connected components algorithm. It is used to examine how many islands or disconnected components there are in our graph, which will help us better understand results from different graph algorithms. Also, sometimes we might want to run other graph algorithms only on the largest connected component.", "As there is only one connected component in our graph, we don\u2019t have to worry about skewed results from other graph algorithms.", "After each analysis, we will release the projected graph from memory.", "Next, we are going to project an undirected weighted graph. Let\u2019s take a look at how does the native projection handle undirected relationships:", "To produce an undirected relationship with cypher projection, we project a single relationship in both directions, effectively allowing the graph data science engine to traverse it in both directions. Let\u2019s take a look at the following example to gain a better understanding. We create two nodes with a single connection between them.", "To project the relationship in both directions, we only have to omit the direction of the relationship in our MATCH statement, and that\u2019s it. A tiny but crucial detail!", "We will also demonstrate a favorable way to project multiple node labels using a UNION statement in the node query.", "To stray away from the common graph algorithms like PageRank or Louvain, let\u2019s use the Random Walk algorithm. In essence, it mimics how a drunk person would traverse our graph. It is commonly used in the node2vec algorithms. We define Frodo as the start node and then walk five random steps twice.", "You will get different results as it is a random walk algorithm, after all.", "Another useful algorithm for analyzing social networks is Triangle Count and Clustering Coefficient algorithm. A triangle composes of three nodes, where each node has a relationship to the other two. The clustering coefficient is a measure of the degree to which nodes in a graph tend to cluster together. This allows us to estimate how tightly-knit nodes in our graph are.", "The global or average clustering coefficient is 0.54, which means that the persons in our graph are quite tightly-knit. We can also look at individuals and their local clustering coefficients.", "Let\u2019s visualize Thr\u00e1in and his connections to observe how they form a tight community.", "All of Thrain\u2019s contacts have also interacted with each other, hence the 1.0 value of the clustering coefficient.", "Up until this point, all the above graph analysis could be done with the native projection. Cypher projection can project graphs that exist only at query time or when we want to use more advanced filtering than just node labels or relationship types.", "Categorical PageRank is a concept first introduced by Kenny Bastani in his blog post. I have also written a blog post about it using the Graph algorithms library. Now it is time to demonstrate it with the Graph Data Science library as well.", "The idea behind it is pretty simple. As shown in the example above, we have a graph of pages that have links between each other and might also belong to one or more categories. To better understand the global pagerank score of nodes in a network, we can breakdown our graph into several subgraphs, one for each category and execute the pagerank algorithm on each of that subgraphs. We store results as a relationship property between category and pages. This way, we can break down which are the contributing categories to page\u2019s global pagerank score.", "We will start by assuming that each interaction is a positive endorsement(I know it\u2019s actually not, but let\u2019s pretend). We will breakdown our graph into several subgraphs by the class(men, elves) that the characters belong. For example, when calculating the pagerank for the category of men, all nodes will be considered. Still, only relationships that come from characters that belong to the class of men will be considered.", "Let us now run the weighted pageRank on this graph.", "Gandalf comes out on top, with Aragorn following very closely in the second place. I am wondering if Aragorn has the most support from men in the third book, as he becomes their king at the end.", "As predicted, Aragorn takes the lead. Frodo is no longer on the list as he is quite isolated from everybody in the third book and walks alone with Sam to Mount Doom. To be honest, if you have Sam by your side, you are never lonely though.", "We have only looked at the class of men and calculated the categorical pagerank for that specific subgraph. It would be very time consuming if we projected a subgraph for each class separately. That is why we will project a subgraph for each class in a single named graph using virtual relationship types. In the relationship query, we have the option to return whatever we feel like as the column type. We will return the original relationship type combined with the class of the person to create virtual relationship types. This will allow us to calculate the categorical pagerank for each class.", "We can now calculate the categorical pagerank for the class of elves.", "If we want to calculate categorical pagerank for each class and store the results, we can use the same approach as in the original blog post, where we saved the results in the relationship between a class and a person.", "We can now get the top three members for each class based on their categorical pagerank score.", "Frodo leads with four first places, Gandalf has three first places, and Sam has two. Most of the results are self-explanatory, like the support from dwarf class, where Gandalf leads, with Gimli himself being a dwarf in second place, so he probably has interactions with all the other dwarves. Because Legolas hangs out with Gimli so much, he gets to be in the third place. On the other hand, Sam and Frodo venture into the heart of Orc land by themselves, and have the most interactions with Orcs (not really an endorsement).", "Cypher projection is very expressive and allows us to project any subgraph of the stored graph as well as any virtual graph that exists only at query time. We are mostly limited only by our imagination. Try out the Graph Data Science library for yourselves and let us know if you have any suggestions or feedback.", "As always, the code is available on GitHub.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data explorer. Turn everything into a graph. Author of Graph algorithms for Data Science at Manning publication. http://mng.bz/GGVN"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb3459138c4f1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bratanic-tomaz.medium.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Tomaz Bratanic"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57f13c0ea39a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=post_page-57f13c0ea39a----b3459138c4f1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/neo4j/graph-data-science", "anchor_text": "Neo4j Graph data science library"}, {"url": "https://towardsdatascience.com/exploring-the-graph-catalog-feature-of-neo4j-graph-data-science-plugin-on-a-lord-of-the-rings-d2de0d0a023", "anchor_text": "last blog post"}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/native-projection/", "anchor_text": "Native projections"}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/cypher-projection/", "anchor_text": "Cypher projection"}, {"url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/", "anchor_text": "APOC library"}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/management-ops/native-projection/", "anchor_text": "native projection"}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/alpha-algorithms/random-walk/", "anchor_text": "Random Walk algorithm"}, {"url": "https://neo4j.com/docs/graph-data-science/1.0/algorithms/triangle-counting-clustering-coefficient/", "anchor_text": "Triangle Count and Clustering Coefficient algorithm"}, {"url": "https://twitter.com/kennybastani", "anchor_text": "Kenny Bastani"}, {"url": "https://neo4j.com/blog/categorical-pagerank-using-neo4j-apache-spark/", "anchor_text": "blog post"}, {"url": "https://tbgraph.wordpress.com/2018/01/14/neo4j-categorical-pagerank/", "anchor_text": "blog post"}, {"url": "https://www.kennybastani.com/2015/01/categorical-pagerank-neo4j-spark.html", "anchor_text": "Categorical Pagerank post"}, {"url": "https://twitter.com/kennybastani", "anchor_text": "Kenny Bastani"}, {"url": "https://tbgraph.wordpress.com/2018/01/14/neo4j-categorical-pagerank/", "anchor_text": "original blog post"}, {"url": "https://github.com/neo4j/graph-data-science", "anchor_text": "Graph Data Science library"}, {"url": "https://github.com/tomasonjo/blogs/blob/master/lotr_graph_data_science_catalog/Cypher%20projection%20of%20the%20Graph%20Catalog%20feature%20on%20a%20Lord%20of%20the%20Rings%20network.ipynb", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/neo4j?source=post_page-----b3459138c4f1---------------neo4j-----------------", "anchor_text": "Neo4j"}, {"url": "https://medium.com/tag/graph?source=post_page-----b3459138c4f1---------------graph-----------------", "anchor_text": "Graph"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b3459138c4f1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/algorithms?source=post_page-----b3459138c4f1---------------algorithms-----------------", "anchor_text": "Algorithms"}, {"url": "https://medium.com/tag/cypher?source=post_page-----b3459138c4f1---------------cypher-----------------", "anchor_text": "Cypher"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=-----b3459138c4f1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=-----b3459138c4f1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb3459138c4f1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b3459138c4f1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b3459138c4f1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b3459138c4f1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b3459138c4f1--------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tomaz Bratanic"}, {"url": "https://bratanic-tomaz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3.1K Followers"}, {"url": "http://mng.bz/GGVN", "anchor_text": "http://mng.bz/GGVN"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57f13c0ea39a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=post_page-57f13c0ea39a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Feab586d298c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cypher-projection-in-neo4j-graph-data-science-library-on-a-lord-of-the-rings-social-b3459138c4f1&newsletterV3=57f13c0ea39a&newsletterV3Id=eab586d298c8&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}