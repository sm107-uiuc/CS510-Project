{"url": "https://towardsdatascience.com/the-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b", "time": 1683010409.47914, "path": "towardsdatascience.com/the-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b/", "webpage": {"metadata": {"title": "The ultimate guide to building maintainable Machine Learning pipelines using DVC | by D\u00e9borah Mesquita | Towards Data Science", "h1": "The ultimate guide to building maintainable Machine Learning pipelines using DVC", "description": "When my ML projects start to evolve I usually get anxious because: everything starts to become messy, I\u2019m aware that it\u2019s becoming a mess but I don\u2019t know what to do to improve it. I love working\u2026"}, "outgoing_paragraph_urls": [{"url": "https://dvc.org/", "anchor_text": "DVC", "paragraph_index": 1}, {"url": "https://dvc.org/blog/dvc-1-0-release", "anchor_text": "DVC 1.0", "paragraph_index": 1}, {"url": "https://github.com/iterative/example-get-started", "anchor_text": "Get Started Guide", "paragraph_index": 1}, {"url": "https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://dvc.org/doc/command-reference/dag", "anchor_text": "pipelines", "paragraph_index": 26}, {"url": "https://dvc.org/doc/command-reference/run", "anchor_text": "stages", "paragraph_index": 26}, {"url": "https://dvc.org/doc/command-reference/repro", "anchor_text": "repro docs", "paragraph_index": 27}, {"url": "https://vega.github.io/vega-lite/", "anchor_text": "Vega-Lite", "paragraph_index": 57}, {"url": "https://dvc.org/doc/command-reference/plots", "anchor_text": "https://dvc.org/doc/command-reference/plots", "paragraph_index": 60}, {"url": "https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial", "anchor_text": "here", "paragraph_index": 61}, {"url": "https://dvc.org/doc/use-cases/versioning-data-and-model-files", "anchor_text": "here", "paragraph_index": 63}, {"url": "https://dvc.org/doc/use-cases/sharing-data-and-model-files", "anchor_text": "here", "paragraph_index": 63}, {"url": "http://deborahmesquita.com/", "anchor_text": "http://deborahmesquita.com/", "paragraph_index": 66}], "all_paragraphs": ["When my ML projects start to evolve I usually get anxious because: everything starts to become messy, I\u2019m aware that it\u2019s becoming a mess but I don\u2019t know what to do to improve it. I love working with open source tools and frameworks because as the projects evolve, the knowledge of the contributors gets \u201cembedded\u201d in them. To me, this means that if I don\u2019t have much experience on building reproducible machine learning pipelines, if I use a tool created by people who have a lot of experience building them I\u2019m actually using their principles on my project (and learning as well).", "DVC is an open-source version control system for Machine Learning projects. At first, I thought it was just a Git for large files, but the system actually addresses all my needs for experiment and pipeline management. They recently released DVC 1.0 along with a new Get Started Guide, which I used as a starting point for this tutorial.", "Today I\u2019ll show you how to build reproducible Machine Learning pipelines using DVC. You can check the final code here. Enough said, let\u2019s get started!", "Let\u2019s build a model to classify the 20newsgroups dataset. To keep the evaluate phase simple we\u2019ll only use two categories. This is the main script to do that:", "A good workflow to write clean and maintainable code is to always keep improving the quality of the code. It\u2019s ok to make experiments and see if it works (like we did on main.py above). Now that we know what we\u2019re going to build, we can take the next step and make the code more maintainable.", "If we take a closer look to main.py we can break down the script into those famous Machine Learning steps:", "Now that we have the steps, these are the principles to build maintainable pipelines using DVC:", "Let\u2019s install DVC and see how to implement those steps.", "I\u2019m using Linux and we\u2019re going to install DVC as a Python library. To follow along you should have Python 3, pip and Git installed in your environment. We\u2019re going to create a virtual environment for the project (tip: if you care about managing your projects you should always do this). DVC works best in a Git repository, so we\u2019ll initialize one before initiating the DVC project:", "And we\u2019re ready to go. Now let\u2019s implement each step.", "We\u2019re using Scikit\u2019s fetch_20newsgroups() method to load data to memory, but I want to save it to a file so I can use it as a dependency for the next step of the pipeline. So in this script I\u2019ll gather the data and save it to a csv file.", "We\u2019ll set the name for this stage as prepare.", "I was using three categories at first (['comp.graphics', 'sci.space', 'rec.sport.basecball']), but then when I got to the evaluation phase I thought that the tutorial would be simpler if I used only two categories. I then had to build the dataset again, specifying the new list with these categories. This showed me that it would be a good idea to use categories as a parameter for this script. DVC uses a params.yam file as the default parameters file, so let\u2019s create one and define the categories there:", "prepare is the name of the stage, categories is the name of the parameter and to create a list using yaml we add a - before each item.", "I want to save the data to a data/prepared folder, so we\u2019ll use the script to do that. Here is the final prepare.py file:", "To execute this stage of the pipeline we only depend on the script code file, and we will save the files generated by the script on the data/prepared folder. Now we have all the components to build this step:", "To keep things organized we\u2019ll save the scripts inside a src folder, so let\u2019s create one:", "The contents of your dvc_tutorial folder should look like this:", "All set, now let\u2019s learn how to build this stage using DVC.", "DVC saves the pipeline stages on a dvc.yaml file (human readable) and a dvc.lock (this is for DVC use only). To create a pipeline stage we use the dvc run command. These are the main options:", "After setting these options we add a command argument where we specify how to actually run this step of the pipeline. In this step the command will be python3 src/prepare.py. Let\u2019s first install the dependencies prepare.py needs:", "And now let\u2019s run the dvc run command to generate the stage:", "Now your folder show look like this:", "And these are the contents of the dvc.yaml file auto-generated by DVC:", "The dvc dag command displays the stages of a pipeline. We only have one stage so far but let\u2019s see it:", "You can hit q to hide the visualization.", "The dvc repro command reproduces complete or partial pipelines by executing commands defined in their stages. As the docs says:", "DVC caches relevant data artifacts along the way and recursively searches in pipeline stages to determine which ones have changed. Then it executes the corresponding commands. Outputs are deleted from the workspace before executing the stages command that produces them. \u2014 repro docs", "Cool, let\u2019s test it then (I didn\u2019t make any changes yet):", "What if I change the name of a category?", "And then run the command again?", "It runs the stage again because we added -p prepare.categories as a parameter for this stage. DVC then saw that we changed this parameter and ran the stage again. The dvc.yaml file is still the same but if you check the dvc.lock file you\u2019ll see that the parameters changed there. Amazing right?", "So these are the basics for creating, running and visualizing pipeline stages:", "Now let\u2019s go to the next pipeline step.", "We\u2019ll set the name for this stage as featurize.", "In this step, we\u2019ll use Scikit\u2019s TfidfVectorizer and save the transformed matrix into pickle files inside the data/features folder. We\u2019ll depend on the script file and the data/prepared folder, so this is our recipe:", "This is the final featurize.py file:", "You should save it inside the /src folder and then create the stage using DVC like this:", "Go ahead and run the dvc dag command to check the new step of the pipeline.", "In this stage, we\u2019ll finally train the model and save it to a pickle file. We\u2019ll use the Naive Bayes classifier and only set the alpha parameter. This is the recipe:", "First, let\u2019s add the new alpha parameter:", "Then save the train.py script inside /src:", "And finally, create the stage using DVC:", "In this step, we\u2019ll get to know two new dvc run parameters: --metrics and --plots:", "We\u2019ll use the Area Under the Curve (AUC) metric and compute the precision-recall pairs for different probability thresholds to plot the graphics. To do that we\u2019ll create a script to save a scores.json file with the AUC score and a plots.json file with the precision/recall/threshold pairs:", "Go ahead and save this evaluate.py script inside the /src folder.", "Regarding the metrics and plots files, we have two options:", "Since on this tutorial we\u2019ve not seen how to use DVC to track files, we\u2019ll go with the second option and track the files ourselves using Git. To accomplish that we\u2019re going to use the --metrics-no-cache and the --plots-no-cache commands. This is the recipe for this stage:", "Ok, now let\u2019s create this last step:", "The dvc metrics command let us display and compare metrics. dvc metrics show prints the metric values and dvc metrics diff shows the difference between metrics values when there are metric file changes (before committing them with Git). Let\u2019s see this in action.", "The dvc metrics show allows us to see current scores:", "(\u2615\ufe0f hmm that smell of overfitting\u2026 but that\u2019s not out point to today so let\u2019s go on \ud83d\ude1c)", "Let\u2019s check the parameters we\u2019re currently using:", "The dvc metrics diff command is calculated between a previous commit and a current state, so let\u2019s first commit this experiment:", "Now let\u2019s first change the alpha parameter:", "We can see the params diff with dvc params diff:", "And finally, see how the scores change with dvc metrics diff:", "The dvc plots command generates plots as HTML files that can be open with a web browser. These HTML files use Vega-Lite. Let\u2019s plot a precision recall curve. The plots.json file looks like this:", "And we want a graph with precision on the y-axis and recall on the y-axis, so let\u2019s build one:", "We can even plot the difference between the precision scores for alpha=0.1 and alpha=0.9", "And that\u2019s the end of our tour. You can check more plots options and configurations here: https://dvc.org/doc/command-reference/plots.", "The final code for this tutorial is here", "Using DVC to track experiments and manage Machine Learning pipelines can really take our projects to the next level. The key is to make your ML projects reproducible is to create single Python scripts for each step and specify the parameters, inputs and outputs used by each script. You can do that with a simple dvc run command and use dvc repro to run the pipeline as you like.", "Besides experiments and pipelines management, DVC also provides Version Control and the Deployment and Collaboration features. You can read more about them here and here.", "That\u2019s it for today, thanks for reading! \ud83d\ude01", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Award-winning Data Scientist \ud83d\udc69\ud83c\udffe\u200d\ud83d\udcbb Loves to write and explain things in different ways\u2728 - http://deborahmesquita.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa976907b2a1b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@dehhmesquita?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dehhmesquita?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "D\u00e9borah Mesquita"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd9e06a0a640&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&user=D%C3%A9borah+Mesquita&userId=dd9e06a0a640&source=post_page-dd9e06a0a640----a976907b2a1b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/video-tutorial", "anchor_text": "Video Tutorial"}, {"url": "https://dvc.org/", "anchor_text": "DVC"}, {"url": "https://dvc.org/blog/dvc-1-0-release", "anchor_text": "DVC 1.0"}, {"url": "https://github.com/iterative/example-get-started", "anchor_text": "Get Started Guide"}, {"url": "https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial", "anchor_text": "here"}, {"url": "https://unsplash.com/@realaxer", "anchor_text": "@realaxer"}, {"url": "https://unsplash.com/photos/9AxFJaNySB8", "anchor_text": "cool picture"}, {"url": "https://dvc.org/doc/command-reference/params", "anchor_text": "parameter dependencies"}, {"url": "https://dvc.org/doc/command-reference/dag", "anchor_text": "pipelines"}, {"url": "https://dvc.org/doc/command-reference/run", "anchor_text": "stages"}, {"url": "https://dvc.org/doc/command-reference/repro", "anchor_text": "repro docs"}, {"url": "https://vega.github.io/vega-lite/", "anchor_text": "Vega-Lite"}, {"url": "https://dvc.org/doc/command-reference/plots", "anchor_text": "https://dvc.org/doc/command-reference/plots"}, {"url": "https://github.com/dmesquita/dvc_pipelines_and_experiments_tutorial", "anchor_text": "here"}, {"url": "https://dvc.org/doc/use-cases/versioning-data-and-model-files", "anchor_text": "here"}, {"url": "https://dvc.org/doc/use-cases/sharing-data-and-model-files", "anchor_text": "here"}, {"url": "https://medium.com/tag/data-science?source=post_page-----a976907b2a1b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a976907b2a1b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/reproducibility?source=post_page-----a976907b2a1b---------------reproducibility-----------------", "anchor_text": "Reproducibility"}, {"url": "https://medium.com/tag/project-management?source=post_page-----a976907b2a1b---------------project_management-----------------", "anchor_text": "Project Management"}, {"url": "https://medium.com/tag/video-tutorial?source=post_page-----a976907b2a1b---------------video_tutorial-----------------", "anchor_text": "Video Tutorial"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&user=D%C3%A9borah+Mesquita&userId=dd9e06a0a640&source=-----a976907b2a1b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&user=D%C3%A9borah+Mesquita&userId=dd9e06a0a640&source=-----a976907b2a1b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa976907b2a1b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a976907b2a1b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a976907b2a1b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a976907b2a1b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a976907b2a1b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dehhmesquita?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dehhmesquita?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "D\u00e9borah Mesquita"}, {"url": "https://medium.com/@dehhmesquita/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.8K Followers"}, {"url": "http://deborahmesquita.com/", "anchor_text": "http://deborahmesquita.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd9e06a0a640&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&user=D%C3%A9borah+Mesquita&userId=dd9e06a0a640&source=post_page-dd9e06a0a640--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f593355f97f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-ultimate-guide-to-building-maintainable-machine-learning-pipelines-using-dvc-a976907b2a1b&newsletterV3=dd9e06a0a640&newsletterV3Id=1f593355f97f&user=D%C3%A9borah+Mesquita&userId=dd9e06a0a640&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}