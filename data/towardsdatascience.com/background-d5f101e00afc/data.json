{"url": "https://towardsdatascience.com/background-d5f101e00afc", "time": 1682996088.1030111, "path": "towardsdatascience.com/background-d5f101e00afc/", "webpage": {"metadata": {"title": "Dealing with highly correlated columns in ML models | by A S | Towards Data Science", "h1": "Dealing with highly correlated columns in ML models", "description": "I was working with a credit card default data set as part of a data science bootcamp project. We had to run various ML algorithms to try and predict whether someone would default or not, largely\u2026"}, "outgoing_paragraph_urls": [{"url": "https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients", "anchor_text": "credit card default", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/F1_score", "anchor_text": "F1 score", "paragraph_index": 0}], "all_paragraphs": ["I was working with a credit card default data set as part of a data science bootcamp project. We had to run various ML algorithms to try and predict whether someone would default or not, largely using F1 score as a metric. We tried grid searches on ridge and lasso logistic regression, K nearest neighbours, and decision trees to see which model worked best.", "As suggested by the above sub-heading, I ran into some problems. Here is a list of the columns of the DataFrame:", "Note that there are some very similar seeming columns, pay_ 0\u20136, bill_amt 1\u20136, and pay_amt 1\u20136. The numbers represent which month they are in. When I looked at the correlations, I found this:", "As you can see, the pay_ columns are strongly correlated with each other, as are the bill_amt columns. The pay_amt ones are not that correlated with each other. The high correlations suggest that many of the columns contain redundant information, i.e. information from one column is contained in other columns.", "My first question was: How do I quantify this level of redundancy? It is commonly accepted that the square of correlation is a good approximation for how well a column is described by another column. What would happen if I squared all of those correlation matrices and added them up?", "Each group has 6 columns, so if all the columns were independent (and therefore had 0 correlation), the sum of squares would be 6, as each column has a correlation of 1 with itself. If they were all identical, then all correlations would be 1, and the sum would be 36. The average across each column in the first case is 1, and in the second case it is 6. It intuitively makes sense to me that there is 6 columns \u2018worth\u2019 of information in the first case, and 6/6=1 column \u2018worth\u2019 of information in the second case.", "Finding this sum for the above 3 examples, dividing by 6 each time, we get:", "To get the non redundant number of columns in each group, we divide the total number of columns in the group by this number. This suggests that the pay_ group actually has 6/3.21= 1.87 columns \u2018worth\u2019 of information, the bill_amt group has 6/4.94= 1.21 columns worth, and the pay_amt group has 6/1.19=5.05 columns worth. This intuitively makes sense, as the bill_amt columns were almost identical, whereas the pay_amt columns were not.", "I also asked myself what would happen if these groups were correlated with each other, e.g. \u2018bill amt\u2019 and \u2018pay amt\u2019, and then I arrived at an elegant solution.", "My solution is to come up with a redundancy score for each column, which I will call C\u00b2, which is the sum of the squares of the correlation between that column and all other columns in the data. Here are the top and bottom columns by C\u00b2 measure:", "Note how C\u00b2 never goes below 1, as discussed earlier, and is nearly 6 for the bill_amt columns (very redundant!).", "If you are doing a ridge regression, there is a penalty which is proportional to the coefficient of a column squared. e.g. if your model is trying to predict X, using A, and you say X=2A, the penalty will be (2\u00b2)\u03bb , which is 4\u03bb. \u03bb is a hyper parameter set before doing the ridge regression. Now if you create a column B=A, your model will be X= A+B, which will have a penalty of (2*1\u00b2)\u03bb, or 2\u03bb, half as much as before. This means that redundant columns are under-penalised by ridge regressions.", "This problem can be fixed by dividing the values in the columns by sqrt(C\u00b2). In the above case, the correlation between A and B is 1, so the C\u00b2 of each of the columns will be 2. If we divide each of the columns by \u221a2, we\u2019ll get the equation X= \u221a2 A + \u221a2 B, giving us a penalty of (2*\u221a2\u00b2)\u03bb, or 4\u03bb as before. This means that our model is not biased by adding in the new column.", "Disclaimer: Remember to divide after using a scaler, not before!", "The K-Nearest Neighbors (KNN) algorithm attempts to guess the target variable by looking at the similar data points. The number of similar data points it looks it is \u2018K\u2019, and it determines similarity by minimising \u2018distance\u2019.", "A common way of measuring distance is Euclidean distance- the straight line distance between two points. This is calculated by squaring the differences in each column, adding them up, and square rooting the sum. For example, if the distance in column A is 3, and column B is 4, the Euclidean distance is sqrt(3\u00b2 + 4\u00b2)= sqrt(25)= 5.", "In the above example, if we define a new column X=A, distance in column X will be 3, and new Euclidean distance will be sqrt(2*3\u00b2 + 4\u00b2)= sqrt(34). This creates an undue bias towards the redundant information.", "This can again be fixed by dividing both columns by sqrt(C\u00b2). In the above example, the correlation between A and X is 1, so if B is independent from A, their C\u00b2 values would be 2. So after dividing by sqrt(2), the distance will be 3/sqrt(2) in each column. The new Euclidean distance will be sqrt( 2* (3/\u221a2)\u00b2 + 4\u00b2) = sqrt(2*4.5 + 4\u00b2) = sqrt(25), the same as before!", "Note: If you are using the Minkowski distance of order p, you divide the columns by (C\u00b2)^(1/p). In the Euclidean case, if you\u2019re measuring Manhattan distance, p=1, so you divide the columns by C\u00b2.", "Disclaimer: Remember to divide after using a scaler, not before!", "A random forest is a collection of randomly generated decision trees that \u2018vote\u2019 on the solution to a machine learning problem. Random data is selected via bootstrapping, and random \u2018features\u2019, which are random columns are selected at each node.", "If the columns have redundant information, then random selection will bias us towards the redundant information. This can actually be resolved quite easily, by giving each column a weight of 1/C\u00b2 when picking them.", "When picking one out of A and B, the odds are 50/50. If we add X=A, then there is a 2/3 chance we get the information from A. Since A and X have a correlation of 1, they both have a C\u00b2 score of 2. Dividing by C\u00b2 we get weights of 0.5 for A, 0.5 for X, and 1 for B. This means that there\u2019s a 25% chance we pick A, 25% chance we pick X, and 50% chance we pick B \u2014 back to 50/50.", "I feel what I have discussed above is a smooth solution to some of the problems that arise from correlated columns in machine learning models. I tried to look on Google for people who tried similar things and I could not find anything. If there is either a flaw, or you know of someone who has done so before, please inform me, so I can make the necessary corrections.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Maths graduate, former algorithmic trader, aspiring data scientist, played online poker."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd5f101e00afc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@asquant?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@asquant?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "A S"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F77c9d1ca99db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&user=A+S&userId=77c9d1ca99db&source=post_page-77c9d1ca99db----d5f101e00afc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients", "anchor_text": "credit card default"}, {"url": "https://en.wikipedia.org/wiki/F1_score", "anchor_text": "F1 score"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d5f101e00afc---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d5f101e00afc---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/regression?source=post_page-----d5f101e00afc---------------regression-----------------", "anchor_text": "Regression"}, {"url": "https://medium.com/tag/regularization?source=post_page-----d5f101e00afc---------------regularization-----------------", "anchor_text": "Regularization"}, {"url": "https://medium.com/tag/random-forest?source=post_page-----d5f101e00afc---------------random_forest-----------------", "anchor_text": "Random Forest"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&user=A+S&userId=77c9d1ca99db&source=-----d5f101e00afc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&user=A+S&userId=77c9d1ca99db&source=-----d5f101e00afc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd5f101e00afc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d5f101e00afc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d5f101e00afc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d5f101e00afc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d5f101e00afc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@asquant?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@asquant?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "A S"}, {"url": "https://medium.com/@asquant/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "112 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F77c9d1ca99db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&user=A+S&userId=77c9d1ca99db&source=post_page-77c9d1ca99db--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F85d08d9c8f11&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbackground-d5f101e00afc&newsletterV3=77c9d1ca99db&newsletterV3Id=85d08d9c8f11&user=A+S&userId=77c9d1ca99db&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}