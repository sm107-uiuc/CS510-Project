{"url": "https://towardsdatascience.com/a-hands-on-application-of-homography-ipm-18d9e47c152f", "time": 1683007345.924802, "path": "towardsdatascience.com/a-hands-on-application-of-homography-ipm-18d9e47c152f/", "webpage": {"metadata": {"title": "A Hands-On Application of Homography: IPM | by Daryl Tan | Towards Data Science", "h1": "A Hands-On Application of Homography: IPM", "description": "In computer vision, homography is a transformation matrix H when applied on a projective plane maps it to another plane (or image). In the case of Inverse Perspective Mapping (IPM), we want to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/darylclimb/cvml_project/tree/master/projections/ipm", "anchor_text": "here", "paragraph_index": 7}], "all_paragraphs": ["In computer vision, homography is a transformation matrix H when applied on a projective plane maps it to another plane (or image). In the case of Inverse Perspective Mapping (IPM), we want to produce a birds-eye view image of the scene from the front-facing image plane.", "In the field of autonomous driving, IPM aids in several downstream tasks such as lane marking detection, path planning and intersection prediction solely from using a monocular camera as this orthographic view is scale-invariant. Emphasising the importance of this technique.", "IPM first assume the world to be flat on a plane. Then it maps all pixels from a given viewpoint onto this flat plane through homography projection.", "In practice, IPM works well in the immediate vicinity of the camera. For faraway features in the scene, blurring and stretching of the scene become more prominent during perspective projection as a smaller number of pixel is represented, limiting the application of IPM. This can be observed in figure 1, where severe undesirable distortion is produced farther away. To be exact, the lookahead distance is approximately 50m in the figure.", "In addition, the following constraints must hold:", "In this article, I will attempt to explain the idea of IPM. More importantly, this post is dedicated to how we can work out and apply the homography using only Python and Numpy.", "Next, I will show that somewhat similar results can be obtained using OpenCV. We will be using a relatively common road scene from Cityscape dataset as an example. Feel free to message me regarding any questions/doubts or even mistakes you might have spotted.", "The code for this article is available here. And all inline text refers to some variable or function in the code.", "The problem that we are trying to solve is to transform a frontal view image into a birds-eye view image. IPM does this by removing the perspective effect from the front-facing camera and remap its image onto a top-view 2D domain. The image in BEV is one that attempts to preserve distance and parallel lines, correcting perspective effect.", "The following bullet points summarise the procedure for homography based IPM:", "I will go into more details in the following sections.", "Before we get started, it is important to know where the camera is relative to the road. For the road scene in Cityscape, the camera is mounted on top of the vehicle pitching slightly downwards. The exact position and orientation is written in the file camera.json . Note that the values are relative to the ego-vehicle.", "To understand IPM, some background knowledge about perspective projection and camera projective geometry is required. I will briefly describe what you need to know about those topics in this section.", "Perspective projection precisely describes how the world around us gets mapped on a 2D plane. During this mapping, 2 parallel lines in the world (euclidean space) are transformed into a pair of line in the new plane which converges at the point of infinity. Referring to figure 3, the parallel properties of the 2 cubes placed in the world are not preserved from where we are observing right now. An example of this would be the lane lines.", "In the case of our example as shown in figure 4, when the road is observed from a different viewpoint, notice that the same region looks different. Parallel lies are no longer preserved in a projective transformation P.", "The camera model describes the perspective projection from the 3D scene to a 2D image. The image formed depends on the intrinsic and extrinsic properties.", "The extrinsic [R|t] describes the relative position and orientation of the world relative to the camera. It brings the scene in world coordinate into the camera coordinate system.", "The intrinsic, K defines how the 3D scene will be warped onto the image with respect to change in the focal length and camera center. Note: This is a simple pinhole camera model. Other factors such as pixel skew and lens distortion are not reflected in the equation.", "In our problem. the origin is set to the top left-hand corner of the image plane 2. The idea is to project the entire scene (X, Y, Z) lying on image plane 2 onto the camera image plane 1.", "As mention, we assumed that the road is flat on the ground. Therefore, Z = 0 for every points lying on the road. Which effectively transform the problem into planar homography. This is one method that can be done in OpenCV to perform the image warping.", "The approach I have taken to tackle the problem is as follows:", "Lets now go through each point mention above.", "As the vehicle moves, we want the viewing region to be consistent relative to it. Hence the plane is defined with respect to the vehicle.", "The origin of the plane is located at the top left corner. The viewable region is illuminated and depends on the field of view of the camera. That is why unobservable pixel (black) is on the image after IPM. I have defined the plane with the following properties (figure 7)", "The camera parameters are given in camera.json and given with respect to the ego-vehicle. Since the projection model requires us to define the scene with respect to the camera, some manipulation is required to reverse the transformation.", "The extrinsic and intrinsic parameters are constructed in this function load_camera_params.", "The projective transformation is then applied after transforming the points into homogenous representation. The pixels are scale normalize. i.e. effective focal length = 1. This is done in perspective .", "As we move further away from the camera, sparsity becomes more observable as a consequence of perspective. Therefore, I use bilinear interpolation as an approximation.", "This is done by taking the weighted (by distance) sum of the 4 corners", "Now that we understand how to perform the perspective warping. Let\u2019s see how all the above steps can be easily performed in OpenCV. This is done by formulating the problem as a plane to plane transformation.", "OpenCV does this by solving for the homography matrix H internally using point correspondence. H now is equivalent to the camera matrix that I have discussed above. A minimum of 4 points is required to estimate H via least-squares method.", "There are only 2 steps to perform the transformation", "The most convenient features to choose are the lane lines. Since we know for sure they are going to be parallel in the target image (BEV).", "To show that it produces approximately the same result as the derived method discuss previously, I picked out the points denoting the green polygon vertices as shown in figure 4.", "And there we have it. I hope you will find this post useful if you are working on computer vision.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F18d9e47c152f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://daryl-tan.medium.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": ""}, {"url": "https://daryl-tan.medium.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Daryl Tan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd5d47d10c0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&user=Daryl+Tan&userId=d5d47d10c0e9&source=post_page-d5d47d10c0e9----18d9e47c152f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.cityscapes-dataset.com/", "anchor_text": "Figure 1."}, {"url": "https://github.com/darylclimb/cvml_project/tree/master/projections/ipm", "anchor_text": "here"}, {"url": "http://www.cvc.uab.es/~asappa/publications/J__Elsevier_IF_Vol_24_July_2015_pp_108-121.pdf", "anchor_text": "Source"}, {"url": "https://en.wikipedia.org/wiki/Bilinear_interpolation", "anchor_text": "Bilinear interpolation"}, {"url": "https://github.com/darylclimb/cvml_project/tree/master/projections/ipm", "anchor_text": "darylclimb/cvml_projectProjects and application using computer vision and machine learning - darylclimb/cvml_projectgithub.com"}, {"url": "https://medium.com/tag/mathematics?source=post_page-----18d9e47c152f---------------mathematics-----------------", "anchor_text": "Mathematics"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----18d9e47c152f---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----18d9e47c152f---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&user=Daryl+Tan&userId=d5d47d10c0e9&source=-----18d9e47c152f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&user=Daryl+Tan&userId=d5d47d10c0e9&source=-----18d9e47c152f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F18d9e47c152f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----18d9e47c152f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----18d9e47c152f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----18d9e47c152f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----18d9e47c152f--------------------------------", "anchor_text": ""}, {"url": "https://daryl-tan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://daryl-tan.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Daryl Tan"}, {"url": "https://daryl-tan.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "429 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd5d47d10c0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&user=Daryl+Tan&userId=d5d47d10c0e9&source=post_page-d5d47d10c0e9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa91ae4c3a6fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-hands-on-application-of-homography-ipm-18d9e47c152f&newsletterV3=d5d47d10c0e9&newsletterV3Id=a91ae4c3a6fd&user=Daryl+Tan&userId=d5d47d10c0e9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}