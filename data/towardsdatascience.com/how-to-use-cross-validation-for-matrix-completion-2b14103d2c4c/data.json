{"url": "https://towardsdatascience.com/how-to-use-cross-validation-for-matrix-completion-2b14103d2c4c", "time": 1683002516.726711, "path": "towardsdatascience.com/how-to-use-cross-validation-for-matrix-completion-2b14103d2c4c/", "webpage": {"metadata": {"title": "How to Use Cross-Validation for Matrix Completion | by Ishay Telavivi | Towards Data Science", "h1": "How to Use Cross-Validation for Matrix Completion", "description": "This post demonstrates: How to step by step implement cross-validation to find the best k (latent features) in NMF (Non-negative Matrix Factorization) algorithm for completing missing values in a matrix How to handle the randomness of initial factor matrices"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Non-negative_matrix_factorization", "anchor_text": "https://en.wikipedia.org/wiki/Non-negative_matrix_factorization", "paragraph_index": 3}, {"url": "http://alexhwilliams.info/itsneuronalblog/2018/02/26/crossval/", "anchor_text": "http://alexhwilliams.info/itsneuronalblog/2018/02/26/crossval/", "paragraph_index": 7}, {"url": "https://en.wikipedia.org/wiki/Netflix_Prize", "anchor_text": "Netflix Prize", "paragraph_index": 13}], "all_paragraphs": ["Cross-Validation is a well-known practice in machine learning, and normally, it is a part of the training process which assures that our models perform well on data that was not fitted. There are different ways of performing cross-validation, but in all of them, we predict our fitted model on unfitted data.", "In my searches for Matrix Completion tools, I found mainly examples that use the whole data, and don\u2019t leave a test set. In this post, I am demonstrating step by step how to use cross-validation to find the best k (latent features) in NMF (Non-negative Matrix Factorization) algorithm for completing missing values in a matrix. However, this can be applied to other algorithms as well.", "Just to keep everyone on the same page, Matrix Factorization is the reduction of a matrix into its constituent parts using linear algebra. Any matrix X can be reduced to a pair of factor matrices, A and Y, where X is the dot product of these matrices:", "There are tons of information about matrix factorization on the internet, so I do not elaborate on it. NMF is when all values, of both the matrix and its factor matrices are non-negative. See more information in https://en.wikipedia.org/wiki/Non-negative_matrix_factorization", "1. How to implement the cross-validation for finding the best k latent features", "2. How to handle the randomness of initial factor matrices", "The following were the basis for my work:", "1. A post by Alex Williams, from which I took the inspiration of the cross validation for NMF: http://alexhwilliams.info/itsneuronalblog/2018/02/26/crossval/, and my post is actually a step-by-step implementation of that concept.", "The code is written in Python, and is demonstrated on a Numpy array, but can be easily adapted to be used with a Pandas dataframe.", "What is \u2018Latent Features\u2019, and why do we need the right number of them?", "For a matrix X, there may be many possible pairs of A/Y, each pair varies in shape and values.", "To focus the discussion on the shape element, let\u2019s assume that X has m rows and n columns, as in the diagram above. Therefore the shape of A and Y should be m by k for A, and k by n for Y, where k may be any counting number (positive whole number).", "k represents the number of features of both A and Y. However, since we have only X, we do not know the size of k, and therefore we do not know the shape of A/Y. This is why the features represented by k are called latent features. In the diagram below we see different pairs of factor matrices A/Y, each with different k, all of them are valid matrices:", "To demonstrate what latent features are, let\u2019s examine an example. There are many uses for matrix completion, however the most famous is the movie rating recommender system, based on Netflix Prize, where the users\u2019 preferences are partially missing.", "Below is an example for a completed matrix (the blue one), where the figures represent the users\u2019 ranking, and the factor matrices embed some features, 3 in this case.", "Which k should we choose to use when we want to complete missing values in X?", "A too small k may lack the information we need and will result in underfitting. Adding more features, in this case, can tell us more about the missing values.", "A too high value for k might end up in overfitting. This is caused when we get multiple solutions, like in the following matrix:", "Determining k is done by the cross-validation process.", "Here we create our own \u201cmissing data\u201d. What\u2019s behind it?", "1. We want to create a full table, including the \u201cmissing values\u201d, so we can really see if we got good completion at the end of the process for these values.", "2. We want to generate the table from real A and Y, so we know what k is optimal and see if we get this as an output.", "In the printed outputs, I used a small matrix (10 by 12), mainly for presentation convenience. However to see a real effect of the cross-validation we need a larger matrix, so all the plots were taken from a 40 by 25 matrix. Both matrices had 5 latent features.", "Note that k must be smaller than the minimum of the matrix\u2019s rows/columns, otherwise we have multiple solutions.", "Now we create nulls randomly to simulate the real \u201cmissing values\u201d:", "From now on, the code is relevant for a real matrix with missing values.", "First, we create the null mask. It is required for the last step where we complete the missing values with the resulted matrix.", "Now we add 1 (or any other number) to the matrix. Why is that?", "The learning phase begins with filling the nulls with 0, so we want to distinguish between the real zeros and the nulls-filled-with-zero.", "Of course, this is only relevant if you have zeros in your matrix.", "In any cross-validation we split the data such as some of it is being fitted on, and the rest of the data is used for testing.", "Here we partition the data matrix into four folds, where each fold serves as a held-out set for testing at its turn. The matrix is split in half vertically and horizontally, as in the diagram below.", "This meets a basic requirement that the fitted area should spread out over all the rows and columns, otherwise, the algorithm doesn\u2019t have the right data to learn from.", "We get the train and test errors for each fold, and then we use their average.", "I used 4 folds. However, one may use a different number of folds and even develop it to be a parameter.", "Applying the function on our matrix produces the train and test sets, as well as 0/1 masks per each set. For example, with fold=2, we get:", "These masks are for the folds only, and not yet include the null-mask. This will be combined together with the fold-mask into one on the next step.", "The cross-validation function is relatively long, so first I write its main components as a short algorithm:", "Why do we split each fold into several cycles?", "The learning process starts by assigning random values to one of the factor matrices A and Y. Then during the learning process, the matrices are updated till we reach the optimum.", "However, we do not know if the random matrix we start with will lead us to the absolute optimum or only to a local one.", "So here we try out several initiation random matrices in several cycles and take the end matrices of the best cycle. Note that our best cycle is the one with the lower train error (not the test error) since this is still a part of the fitting phase and not the testing.", "The diagram below describes several cycles of one fold:", "The full cross-validation function has a few parts. The main ones are presented below. The rest can be found in the full notebook that is referred to at the bottom of the post.", "First part: preparation per fold \u2014 is where we prepare mainly the mask per fold.", "Second part: matrix initiation \u2014 initiates Y, A, X (masked) per cycle. Also initiates the train and test errors values.", "Third part: update \u2014 learning process where A, Y and X are being updated per iteration.", "Fourth part: conclusion \u2014 collect all results, elect best cycle per fold and average folds errors.", "Here we use the nmf_cv function for different ks. During the learning, we can follow the train and test errors per cycle, and a plot for the best cycle per fold.", "Below are three representative plots and respective errors \u2014 for underfit (too low k) on the left-hand side, right k in the middle, and overfit on the right-hand side. Notice the differences.", "Then we extract the best run:", "The following plot shows the train and test errors per k. As we could expect, the best k is 5, due to the latent features we picked when creating the sample data on step 1. In real data we don\u2019t know this number of course.", "For some of the ks (for example k=8), the test error is very high, and seem to divert from the \u201cperfect\u201d test error curve. To overcome this issue, one may use square root or log over the matrix, to reduce the numbers and by that \u201ccontrol\u201d the error.", "As discussed earlier, a given matrix X may have totally different factor matrices, not only in shape, but also in their values. So we may end up the training process in similar X matrices for the different folds, but very different A and Y. See example on a 2 by 2 matrices:", "This means that we cannot just average All As or Ys. The alternative is to use one of the pairs (for example A and Y from fold 0).", "This is the step that we actually use the cross validation results:", "- We use the optimal k (implicitly only, the shapes of A/Y assume the right k)", "- We use the end A/Y matrices. Since these are the end matrices, we do not have to use very high number of iterations.", "And we get the predicted matrix. We can compare the original matrix with the predicted one (top left corner of both) and the error on the non-null values:", "Since we know the missing values (we created the original matrix), we have the opportunity to examine how well the algorithm managed to predict the missing values.", "And here we get the completed matrix.", "Without the cross validation we couldn\u2019t have known the k latent features to be used, and will have gotten better train performance for any higher k, since we use all the data.", "In addition, random matrices might lead us to local optimization point and not to the best one. By using the end A/Y matrices from the best run, we ensure that we reach the minimum error.", "One may use this code as is or modify it in accordance for specific needs, for example with another algorithm.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2b14103d2c4c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@ishay.telavivi?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ishay.telavivi?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Ishay Telavivi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F44ca4c35c8b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&user=Ishay+Telavivi&userId=44ca4c35c8b6&source=post_page-44ca4c35c8b6----2b14103d2c4c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@jespl?utm_source=medium&utm_medium=referral", "anchor_text": "Jessi Pena"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Non-negative_matrix_factorization", "anchor_text": "https://en.wikipedia.org/wiki/Non-negative_matrix_factorization"}, {"url": "http://alexhwilliams.info/itsneuronalblog/2018/02/26/crossval/", "anchor_text": "http://alexhwilliams.info/itsneuronalblog/2018/02/26/crossval/"}, {"url": "https://stackoverflow.com/questions/22767695/python-non-negative-matrix-factorization-that-handles-both-zeros-and-missing-dat", "anchor_text": "https://stackoverflow.com/questions/22767695/python-non-negative-matrix-factorization-that-handles-both-zeros-and-missing-dat"}, {"url": "https://en.wikipedia.org/wiki/Netflix_Prize", "anchor_text": "Netflix Prize"}, {"url": "https://github.com/IshayTelavivi/cross_validation_matrix_completion/blob/master/cv_for_nmf_sample1.ipynb", "anchor_text": "https://github.com/IshayTelavivi/cross_validation_matrix_completion/blob/master/cv_for_nmf_sample1.ipynb"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2b14103d2c4c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----2b14103d2c4c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/nmf?source=post_page-----2b14103d2c4c---------------nmf-----------------", "anchor_text": "Nmf"}, {"url": "https://medium.com/tag/crossvalidation?source=post_page-----2b14103d2c4c---------------crossvalidation-----------------", "anchor_text": "Crossvalidation"}, {"url": "https://medium.com/tag/matrix-factorization?source=post_page-----2b14103d2c4c---------------matrix_factorization-----------------", "anchor_text": "Matrix Factorization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&user=Ishay+Telavivi&userId=44ca4c35c8b6&source=-----2b14103d2c4c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&user=Ishay+Telavivi&userId=44ca4c35c8b6&source=-----2b14103d2c4c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2b14103d2c4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2b14103d2c4c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2b14103d2c4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ishay.telavivi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@ishay.telavivi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ishay Telavivi"}, {"url": "https://medium.com/@ishay.telavivi/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "4 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F44ca4c35c8b6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&user=Ishay+Telavivi&userId=44ca4c35c8b6&source=post_page-44ca4c35c8b6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F44ca4c35c8b6%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-cross-validation-for-matrix-completion-2b14103d2c4c&user=Ishay+Telavivi&userId=44ca4c35c8b6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}