{"url": "https://towardsdatascience.com/nyc-taxi-fare-prediction-605159aa9c24", "time": 1683017418.2205691, "path": "towardsdatascience.com/nyc-taxi-fare-prediction-605159aa9c24/", "webpage": {"metadata": {"title": "NYC Taxi Fare Prediction. Rider Fare Prediction in The Big Apple | by Allen Kong | Towards Data Science", "h1": "NYC Taxi Fare Prediction", "description": "The data for this project can be found on Kaggle in the New York City Taxi Fare Prediction competition held by Google Cloud. The entire training set consists of about 55 million rows of NYC taxi fare\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/new-york-city-taxi-fare-prediction/data", "anchor_text": "Kaggle", "paragraph_index": 0}, {"url": "https://www.kaggle.com/cdeotte/rapids", "anchor_text": "RAPIDS", "paragraph_index": 11}, {"url": "https://dask.org/", "anchor_text": "dask", "paragraph_index": 11}], "all_paragraphs": ["The data for this project can be found on Kaggle in the New York City Taxi Fare Prediction competition held by Google Cloud. The entire training set consists of about 55 million rows of NYC taxi fare data. There is not enough memory in the CPU to train a model using all this data so I decided to use 4 million rows of training data which is roughly 7% of the entire dataset. However, I was able to load the entire dataset on the GPU which I will go over later.", "Let\u2019s take a quick peek at how the data looks like.", "We can see that there are 8 columns which consist of the unique key, the fare amount and 6 features. Before jumping into the statistics, let\u2019s check the sample for null entries.", "There appears to be an insignificant amount of null entries in the sample so it should be fine to remove them from the sample. Now we can review the statistics of the training set and the test set to find anomalies.", "After analyzing the statistics between the training set and the test set, it appears that there are outliers in the training dataset. Including these data points in the training set will prevent our model from running efficiently so it is best to handle them. The fare amount appears to range from -$62 to almost $1300 which makes no sense. The base fee for NYC taxi cabs is $2.50 so we will limit the fare amount to be at least $2.50 and below $500. The passenger count seems to go up to 208 which makes no sense so we will limit it to the maximum capacity which is 5 passengers.", "Currently, Pandas is viewing the \u201cpickup_datetime\u201d feature as an object type in the dataframe. In order for object types to be utilized in our machine learning model, the feature needs to be transformed into a numeric type. This can be accomplished by converting the feature to a datetime type and then transforming the datetime object into multiple attributes using the Pandas datetime functionality. From the datetime object, we\u2019ll be able to create useful attributes like Year, Month, Day, Day of Week, and Hour.", "The city of New York longitude ranges between -75 and -72. The latitude ranges between 40 and 42. There are a few points in the dataset that lie outside these bounds. These points will be removed since they are not within the boundaries of the city.", "Along with the datetime attributes that were added, there are a few features that can be added using the pick-up and drop-off points from the data. The distance between the two points would be a common choice. I decided to use the geopy geodesic and great_circle distance calculations which uses both pick-up and drop-off points. The city is full of many notable locations that taxi travelers tend to go to so we will also introduce the distance between several of these notable locations and the drop-off point. The locations I decided to use were the JFK airport, the LaGuardia airport, the Newark airport, Times Square, Central Park, the Statue of Liberty, Grand Central, the MET museum, and the World Trade Center.", "Now that we have a clean dataset, we are ready to train a model for predicting taxi fare. Before we do that through, we will split the dataset into a train (80%) and test (20%).", "The model I chose for this particular dataset was XGBoost. Another alternative would be LightGBM which many others have used as well in the Kaggle competition. XGBoost uses the DMatrix data structure for optimized and efficient computing so we will transform the training and test sets into a DMatrix. The parameters are already preset in my model from hyperparameter tuning using grid search. The preset parameters will be used to train a booster for 700 rounds and the loss score has to improve at least once every 100 rounds.", "After boosting the model, we are ready to test it against the real test dataset. This model which was trained and boosted on the CPU ended up achieving a score of 3.0325 which places us in the 80th percentile on the Kaggle leaderboard. In order to achieve a better score, it may be time to scale up and utilize more of the data since we are only using about 7%.", "It\u2019s very easy to run out of memory using the CPU when training the XGBoost model. Not only that, cleaning and training using 7% of the data took more than 8 hours. This makes it very inefficient to use a CPU when dealing with large datasets. GPUs on the other hand are extremely efficient when it comes to parallel computing. The perfect technology to use for this case would be RAPIDS which is an advanced library that runs on CUDA and utilizes dask for parallel computing. Using the same data cleaning processes earlier, I decided to put the XGBoost model to test using the entire dataset.", "Training with 7000 boost rounds and 44 million rows (80%) of data only took about 17 minutes! This shows the magnitude of using the GPU for training. It feels too good to be true but the numbers don\u2019t lie. I only used 1 GPU for this process and it\u2019s easily 10 times more efficient than using the CPU. Using the GPU trained model, the predictions turned out to be much better than the CPU trained model. The GPU trained model ended up achieving a score of 2.89185 which places us in the 94th percentile on the Kaggle leaderboard.", "When we\u2019re given data, it\u2019s extremely important to be able to utilize all of it. Using 7% and 100% makes a huge difference and we have the technologies to be able to do that. The GPU offers better performance, higher efficiency and unmatched computing power compared to the CPU counterpart. Whenever you plan on your next data science project, just remember that the GPU can save you a whole day on pre-processing and training!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science Enthusiast, Self-Learner Fascinated with Big Data"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F605159aa9c24&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----605159aa9c24--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@allen.kong21?source=post_page-----605159aa9c24--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Allen Kong"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64c6503c82e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&user=Allen+Kong&userId=64c6503c82e8&source=post_page-64c6503c82e8----605159aa9c24---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@alexanderredl?utm_source=medium&utm_medium=referral", "anchor_text": "Alexander Redl"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/c/new-york-city-taxi-fare-prediction/data", "anchor_text": "Kaggle"}, {"url": "https://www.kaggle.com/cdeotte/rapids", "anchor_text": "RAPIDS"}, {"url": "https://dask.org/", "anchor_text": "dask"}, {"url": "https://github.com/allenkong221/nyc-taxi-fare-prediction", "anchor_text": "Project Code"}, {"url": "https://www.kaggle.com/c/new-york-city-taxi-fare-prediction", "anchor_text": "Kaggle Competition"}, {"url": "https://github.com/rapidsai", "anchor_text": "RAPIDS GitHub"}, {"url": "https://dask.org/", "anchor_text": "Dask"}, {"url": "https://medium.com/tag/data-science?source=post_page-----605159aa9c24---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----605159aa9c24---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----605159aa9c24---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/xgboost?source=post_page-----605159aa9c24---------------xgboost-----------------", "anchor_text": "Xgboost"}, {"url": "https://medium.com/tag/gpu?source=post_page-----605159aa9c24---------------gpu-----------------", "anchor_text": "Gpu"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&user=Allen+Kong&userId=64c6503c82e8&source=-----605159aa9c24---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&user=Allen+Kong&userId=64c6503c82e8&source=-----605159aa9c24---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F605159aa9c24&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----605159aa9c24---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----605159aa9c24--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----605159aa9c24--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----605159aa9c24--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----605159aa9c24--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----605159aa9c24--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@allen.kong21?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Allen Kong"}, {"url": "https://medium.com/@allen.kong21/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "64 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F64c6503c82e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&user=Allen+Kong&userId=64c6503c82e8&source=post_page-64c6503c82e8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4f72a13337d5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fnyc-taxi-fare-prediction-605159aa9c24&newsletterV3=64c6503c82e8&newsletterV3Id=4f72a13337d5&user=Allen+Kong&userId=64c6503c82e8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}