{"url": "https://towardsdatascience.com/lessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5", "time": 1682996086.0788312, "path": "towardsdatascience.com/lessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5/", "webpage": {"metadata": {"title": "Lessons from a real Machine Learning project, part 1: from Jupyter to Luigi | by Emanuele Fabbiani | Towards Data Science", "h1": "Lessons from a real Machine Learning project, part 1: from Jupyter to Luigi", "description": "In the last 6 months, my awesome team and I have been working on a challenging enterprise-level Machine Learning project: rebuilding from scratch the short-term power load forecasting models of a\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["In the last 6 months, my awesome team and I have been working on a challenging enterprise-level Machine Learning project: rebuilding from scratch the short-term power load forecasting models of a major energy provider.", "It has been a difficult yet satisfying journey: we have learnt a lot, mostly by trying to recover from naive mistakes. It is time to try and share the main lessons learnt, hoping to help and \u2014 why not? \u2014 be helped to improve even more.", "A single article would be far too long \u2014 and dull: I\u2019ll try and post a bunch of them, each one focusing on a single topic. This one covers a very painful point: how to organize, structure, and manage the code for a Machine Learning project.", "I had used Jupyter in my latest academic projects \u2014 and I enjoyed its power and flexibility. A fast-prototyping tool which is also the ultimate result sharing platform is priceless, isn\u2019t it? Thus, Jupyter was the choice for our first analysis.", "It went no further than Data Exploration. At that moment, our project repository looked like this.", "You spotted the problem, right? It\u2019s not scalable. Not at all.", "We used to copy and paste parts of code from one notebook to another \u2014 and that\u2019s something no software engineer can stand. Moreover, we were practically prevented from collaborating over the same code base, as the json-based stucture of notebooks makes versioning with git very painful.", "Before passing the point of no return, we looked for a more scalable structure. We found the following resources very useful:", "All of them were repeating the same message.", "The code for a Machine Learning project is not different from any other and shall follow the best practices of Software Engineering.", "Thus, we refactored the whole code base:", "As soon as the operation was completed, the Python, non-notebook code became the single source of truth: as per team convention, it was our state-of-the-art version of data preparation, feature extraction, modelling and scoring. Everyone could experiment, but the Python code was to be changed if and only if a proven improved model was available.", "What about experimentation? And what about notebooks?", "Of course, notebooks were not eliminated from our development workflow. They are still an awesome prototyping platform and an invaluable result sharing tool, aren\u2019t they?", "We just started using them for the purposes they were created in the first place.", "Notebooks became personal, thus avoiding any git pain, and subject to a strict naming convention: author_incremental number_title.ipynb, to be easily searchable. They remained the starting point of every analysis: models were prototyped using notebooks. If one happened to outperform our state-of-the-art, it was integrated in the production Python code. The concept of outperforming was here well-defined, as scoring procedures were implemented in utility modules and shared by all members of the team. Notebooks also made up most of the documentation.", "It took only a few days for us as a team to complete the transformation. The difference was incredible. Almost overnight, we unlocked the power of collective code ownership, unit testing, code reusability, and all the legacy of the last 20 years of Software Engineering. A great boost in terms of productivity and responsiveness to new requests was the obvious consequence.", "The most evident proof came when we realized we were missing unit of measure and labels from all the goodness-of-fit charts. As they were all implemented by a single function, it was fast and easy to fix them all. What would have happened if the same charts were still copied and pasted in lots of notebooks?", "At the end of the transformation, our repository looked like this.", "We were satisfied with the separation of Jupyter prototypes and Python production code, but we knew we were still missing something. Despite trying to apply all the principles of clean coding, our end-to-end scripts for training and scoring became a little bit messy as more and more steps were added.", "Once again, we figured out there was some flaw in the way we were approaching the problem and we looked for a better solution. Once again, valuable resources came to rescue:", "We studied AirFlow, Luigi and d6tflow and we finally opted for a Luigi/d6tflow pipeline, with the latter used for simpler tasks and the former for more advanced use cases.", "This time it took just a single day to implement the whole pipeline: we saved all our functions and classes, encapsulating the logic for preprocessing, feature engineering, training and scoring, and we replaced scripts with pipelines. The improvements in readibility and flexibility were significant: when we had to change how train and test sets were splitted, we could modify only two tasks, preserving input and output signatures, without worrying of everything else.", "Wrapping up, we got three important lessons about code in a Machine Learning project:", "Thank you, my reader, for getting here!", "This is my first article on Medium and by no means I am a good writer. If you have any comment, suggestion, or critic, I beg you to share with me.", "Also, if you have any question or doubt about the topic of this post, please feel free to get in touch!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "PhD in Machine Learning, Co-Founder and Head of Data Science @ xtream, passionate about Data Science, ML, AI, and teaching."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbdfd0b050ca5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@donlelef?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@donlelef?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Emanuele Fabbiani"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3439142d7553&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&user=Emanuele+Fabbiani&userId=3439142d7553&source=post_page-3439142d7553----bdfd0b050ca5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/structure-and-automated-workflow-for-a-machine-learning-project-2fa30d661c1e", "anchor_text": "Mateusz Bednarski, Structure and automated workflow for a machine learning project, 2017"}, {"url": "https://www.kaggle.com/general/4815", "anchor_text": "Kaggle community, How to manage a Machine Learning project, 2013"}, {"url": "https://stripe.com/blog/reproducible-research", "anchor_text": "Dan Frank, Reproducible research: Stripe\u2019s approach to Machine Learning, 2016"}, {"url": "https://github.com/drivendata/cookiecutter-data-science", "anchor_text": "DrivenData, Data science cookiecutter, 2019"}, {"url": "https://towardsdatascience.com/4-reasons-why-your-machine-learning-code-is-probably-bad-c291752e4953", "anchor_text": "Norm Niemer, 4 Reasons why your Machine Learning code is probably bad, 2019"}, {"url": "https://towardsdatascience.com/data-pipelines-luigi-airflow-everything-you-need-to-know-18dc741449b7", "anchor_text": "Lorenzo Peppoloni, Data pipelines, Luigi, AirFlow: everything you need to know, 2018"}, {"url": "https://medium.com/tag/data-science?source=post_page-----bdfd0b050ca5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----bdfd0b050ca5---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/jupyter-notebook?source=post_page-----bdfd0b050ca5---------------jupyter_notebook-----------------", "anchor_text": "Jupyter Notebook"}, {"url": "https://medium.com/tag/luigi?source=post_page-----bdfd0b050ca5---------------luigi-----------------", "anchor_text": "Luigi"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----bdfd0b050ca5---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&user=Emanuele+Fabbiani&userId=3439142d7553&source=-----bdfd0b050ca5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&user=Emanuele+Fabbiani&userId=3439142d7553&source=-----bdfd0b050ca5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbdfd0b050ca5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bdfd0b050ca5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bdfd0b050ca5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@donlelef?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@donlelef?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Emanuele Fabbiani"}, {"url": "https://medium.com/@donlelef/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "309 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3439142d7553&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&user=Emanuele+Fabbiani&userId=3439142d7553&source=post_page-3439142d7553--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F13ee78e986fa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flessons-from-a-real-machine-learning-project-part-1-from-jupyter-to-luigi-bdfd0b050ca5&newsletterV3=3439142d7553&newsletterV3Id=13ee78e986fa&user=Emanuele+Fabbiani&userId=3439142d7553&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}