{"url": "https://towardsdatascience.com/forward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602", "time": 1683002459.720633, "path": "towardsdatascience.com/forward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602/", "webpage": {"metadata": {"title": "Forward and backward propagations for 2D Convolutional layers | by Tristan Dardoize | Towards Data Science", "h1": "Forward and backward propagations for 2D Convolutional layers", "description": "Already numerous articles on TowardsDataScience discuss backpropagation for convolutional neural networks. They explain well for simple cases (e.g. an input with only one channel, only one\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.cs.umd.edu/~djacobs/CMSC426/Convolution.pdf", "anchor_text": "Correlation and Convolution Class Notes for CMSC 426, Fall 2005 David Jacobs", "paragraph_index": 34}, {"url": "http://ufldl.stanford.edu/tutorial/supervised/ConvolutionalNeuralNetwork/", "anchor_text": "Convolutional Neural Networks UFLDL Tutorial", "paragraph_index": 35}, {"url": "https://www.jefkine.com/general/2016/09/05/backpropagation-in-convolutional-neural-networks/", "anchor_text": "Backpropagation In Convolutional Neural Networks, Jefkine, 5 September 2016", "paragraph_index": 36}], "all_paragraphs": ["Already numerous articles on TowardsDataScience discuss backpropagation for convolutional neural networks.", "They explain well for simple cases (e.g. an input with only one channel, only one convolutional filter at the time) but I found it somehow difficult to generalize backward pass implementation to arbitrarily chosen layers.", "To overcome this difficulty, I decided to come back to the theoretical aspect of backpropagation. After finding these equations, the implementation became a lot easier.", "This article aims at giving you the key equations of forward propagation and of backpropagation for multi-channels inputs and multi-filters convolutional layers, and how do we get them.", "If you are only interested in the results, feel free to jump to the conclusion!", "A convolutional layer performs\u2026 convolutions! We need then to define useful mathematical operators:", "On the one hand, the convolution between an image of an arbitrary size and C channels with the kernel K of size (k1, k2) is defined by:", "On the other hand, the cross-correlation between an image of an arbitrary size and C channels with the kernel K of size (k1, k2) is defined by:", "A sharp eye notices that the convolution of an image with a kernel is equivalent to the cross-correlation of the image with this kernel but flipped by 180\u00b0:", "Therefore, we can directly consider the flipped kernel as being the kernel we want for the convolution and let our layer compute only a cross-correlation.", "In this post, we will consider elements X as 3 or 4 dimensional arrays:", "In the case where X has 3 dimensions, f does not appear on the notation. That\u2019s it! We can now discuss the convolutional layer itself.", "The layer transforms the output of the previous layer A_prev of height n_H_prev, width n_W_prev and C channels into the variable Z of height n_H, width n_W and of F channels.", "The parameters of this layer are:", "The convolutional layer forwards the padded input; therefore, we consider A_prev_pad for the convolution.", "The equations of forward propagation are then:", "For ease of notation, we define:", "In practice, we perform the backward pass of a layer by always knowing da_{i,j,f} or dz_{i,j,f} and we assume we know da_{i,j,f} for this case.", "Where g\u2019 is the derivative of g.", "Recalling that dz_{m,n,k} is only linked to the kth filter (given by Eq. [1]), the weights of the fth kernel are only linked to the fth channel of dz;", "The expression of Eq. [5] is then:", "One can notice that this is the cross-correlation of A_prev_pad with the kernel dZ", "The same procedure is followed for the bias:", "The last thing to perform is the backpropagation of the error: finding the relation between dA_prev and dZ.", "Remembering that we have a relation between dZ and the padded version of dA_prev (given in Eq. [1]), we will consider computing da_prev_pad.", "Using chain rule (again!), we have:", "We recognize dz_{m,n,f} as being the first term of the sum, this is good. Let\u2019s focus on the second term:", "Which is not equal to zero if and only if m\u2019+m=i, n\u2019+n=j and c\u2019=c.", "We notice that Eq. [9] describes a convolution where the layer\u2019s filters are considered to be the image, and where dZ is the kernel.", "We finally obtain da_prev_{i,j,c} by selecting da_prev_pad_{i+p1,j+p2,c}, p1 and p2 being the padding values around the first and second dimensions for this layer.", "In this article, you have seen how to compute the forward and backward propagations for a convolutional layer with an arbitrary number of filters and of input channels.", "The forward pass is given by two equations:", "To compute the backpropagation of a convolutional layer, you only need to implement these four equations:", "Other details could have been covered in this article (e.g. how to compute values for n_H and n_W) but numerous article have already discussed these points and therefore I encourage you to read them before you start implementing your own convolutional layers.", "[2] Correlation and Convolution Class Notes for CMSC 426, Fall 2005 David Jacobs", "[3] Convolutional Neural Networks UFLDL Tutorial", "[4] Backpropagation In Convolutional Neural Networks, Jefkine, 5 September 2016", "I wish you good luck in implementing these algorithms!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fed970f8bf602&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tristan.dardoize?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tristan.dardoize?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Tristan Dardoize"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4952c468111f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&user=Tristan+Dardoize&userId=4952c468111f&source=post_page-4952c468111f----ed970f8bf602---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arxiv.org/pdf/1603.07285.pdf", "anchor_text": "Dumoulin, V. & Visin, F. (2016). A guide to convolution arithmetic for deep learning (cite arxiv:1603.07285)"}, {"url": "http://www.cs.umd.edu/~djacobs/CMSC426/Convolution.pdf", "anchor_text": "Correlation and Convolution Class Notes for CMSC 426, Fall 2005 David Jacobs"}, {"url": "http://ufldl.stanford.edu/tutorial/supervised/ConvolutionalNeuralNetwork/", "anchor_text": "Convolutional Neural Networks UFLDL Tutorial"}, {"url": "https://www.jefkine.com/general/2016/09/05/backpropagation-in-convolutional-neural-networks/", "anchor_text": "Backpropagation In Convolutional Neural Networks, Jefkine, 5 September 2016"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ed970f8bf602---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----ed970f8bf602---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ed970f8bf602---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/backpropagation?source=post_page-----ed970f8bf602---------------backpropagation-----------------", "anchor_text": "Backpropagation"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----ed970f8bf602---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&user=Tristan+Dardoize&userId=4952c468111f&source=-----ed970f8bf602---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&user=Tristan+Dardoize&userId=4952c468111f&source=-----ed970f8bf602---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fed970f8bf602&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ed970f8bf602---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ed970f8bf602--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ed970f8bf602--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ed970f8bf602--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tristan.dardoize?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tristan.dardoize?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tristan Dardoize"}, {"url": "https://medium.com/@tristan.dardoize/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "5 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4952c468111f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&user=Tristan+Dardoize&userId=4952c468111f&source=post_page-4952c468111f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F4952c468111f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforward-and-backward-propagations-for-2d-convolutional-layers-ed970f8bf602&user=Tristan+Dardoize&userId=4952c468111f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}