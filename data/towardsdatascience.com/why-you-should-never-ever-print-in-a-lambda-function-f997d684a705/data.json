{"url": "https://towardsdatascience.com/why-you-should-never-ever-print-in-a-lambda-function-f997d684a705", "time": 1683011937.447194, "path": "towardsdatascience.com/why-you-should-never-ever-print-in-a-lambda-function-f997d684a705/", "webpage": {"metadata": {"title": "Why You Should Never, Ever print() in a Lambda Function | by Paul Singman | Towards Data Science", "h1": "Why You Should Never, Ever print() in a Lambda Function", "description": "One moment everything is fine, then \u2026 Bam! Your Lambda function raises an exception, you get alerted and everything changes instantly. Now, this isn\u2019t some low-volume Lambda where you can scroll\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.aws.amazon.com/lambda/latest/dg/python-logging.html#python-logging-lib", "anchor_text": "customized logger", "paragraph_index": 19}, {"url": "https://www.denialof.services/lambda/", "anchor_text": "a formatter", "paragraph_index": 20}, {"url": "https://docs.python.org/3/library/logging.html#logging.Logger.debug", "anchor_text": "standard way", "paragraph_index": 21}, {"url": "https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs", "anchor_text": "automatically parsed", "paragraph_index": 22}], "all_paragraphs": ["One moment everything is fine, then \u2026 Bam! Your Lambda function raises an exception, you get alerted and everything changes instantly.", "Critical systems could be impacted, so it\u2019s important that you understand the root cause quickly.", "Now, this isn\u2019t some low-volume Lambda where you can scroll through CloudWatch Logs and find the error in purely manual fashion. So instead you head to CloudWatch Insights to run a query on the log group, filtering for the error:", "Looks like we found our error! While helpful, unfortunately it omits any other log messages associated with the failed invocation.", "With the information shown above maybe \u2014 just maybe \u2014 you can figure out what the root cause is. But more likely than not, you won\u2019t be confident.", "Do you tell people you aren\u2019t sure what happened and that you\u2019ll spend more time investigating if the issue happens again? As if!", "So instead you head to the CloudWatch Logs Log Stream, filter records down to the relevant timestamp, and begin manually scrolling through log messages to find the full details on the specific errored invocation.", "Resolution Time: 1\u20132 hoursLambda Enjoyment Usage Index: Low", "Same Lambda function, same error. But this time the logging and error handling are improved. As the title implies, this involves replacing print() statements with something a \u2018lil better.", "What is that something and what does this Lambda function look like anyway? Let\u2019s first go through what error debugging looks like for the professional, then take a look at code. Fair?", "Again, we start with an Insights query:", "And again we find the error in the logs, but unlike last time, the log event now includes the @requestId from the Lambda invocation. What this allows us to do is run a second Insights query, filtered on that requestId to see the full set of logs for the exact invocation we are interested in!", "Now we get 5 results, which together paint the full crime scene picture of what happened for this request. Most helpfully, we immediately see the exact input passed to trigger the Lambda. From this we can either deduce what happened mentally, or run the Lambda code locally with the exact same input event to debug.", "Resolution Time: 10\u201320 minutesLambda Enjoyment Usage Index: High!", "I\u2019d like to imagine my readers are on the edge of their seats, begging to know the difference between the Amateur and the Pro\u2019s code from the tale above.", "Whether that\u2019s true or not, here is the Amateur Lambda:", "It is, of course, intentionally simple for illustrative purposes. Errors were generated by simply passing an event dictionary without artist as a key, for example: event = {'artisans': 'Leonardo Da Vinci'}.", "Now for the Professional Lambda, which performs the same basic function but improves upon the print() statements and error handling.", "Interesting! So why are we using the logging module and formatting exception tracebacks?", "First, the Lambda runtime environment for python includes a customized logger that is smart to take advantage of.", "It features a formatter that, by default, includes the aws_request_id in every log message. This is the critical feature that allows for an Insights query, like the one shown above that filters on an individual @requestId, to show the full details of one Lambda invocation.", "Next, you are probably noticing the fancy error handling. Although intimidating looking, using sys.exec_info is the standard way to retrieve information about an exception in python.", "After retrieving the exception name, value, and stacktrace , we format it into a json-dumped string so all three appear in one log message, with the keys automatically parsed into fields. This also makes it easy to create custom metrics based off specific errors without requiring complex string parsing.", "Lastly, it is worth noting that in contrast, logging an exception with the default Lambda logger without any formatting results in an unfortunate multi-line traceback looks something like this:", "I hope if your Lambda functions look more like the Amateur Lambda at the moment, this article inspires you to upgrade your dance and go Pro!", "Before I let you go, I should warn that the downside to replacing print statements with proper logging is that you lose any terminal output generated from local executions of your Lambda.", "There are clever ways around this involving either environment variables or some setup code in a lambda_invoke_local.py type of file. If interested, let me know and I\u2019ll be happy to go over the details in a future article.", "Lastly, as a final bit of inspiration, instead of needing to run Cloudwatch Insights queries to debug yourself, it should be possible to set up an Alarm against the Lambda Errors metric that notifies an SNS topic when in state \u201cIn Alarm\u201d. Another Lambda could then trigger off that SNS topic to run the same debugging Insights queries as the Pro automatically, and return the relevant logs in Slack or something.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data @ Meta. Whisperer of data and productivity wisdom. Standing on the shoulders of giants."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff997d684a705&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://psingman.medium.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b----f997d684a705---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.lucaromeo.com", "anchor_text": "Luca Romeo"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/python-logging.html#python-logging-lib", "anchor_text": "customized logger"}, {"url": "https://www.denialof.services/lambda/", "anchor_text": "a formatter"}, {"url": "https://docs.python.org/3/library/logging.html#logging.Logger.debug", "anchor_text": "standard way"}, {"url": "https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs", "anchor_text": "automatically parsed"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----f997d684a705---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/aws?source=post_page-----f997d684a705---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/programming?source=post_page-----f997d684a705---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----f997d684a705---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/serverless?source=post_page-----f997d684a705---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&user=Paul+Singman&userId=d810baa7423b&source=-----f997d684a705---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&user=Paul+Singman&userId=d810baa7423b&source=-----f997d684a705---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff997d684a705&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f997d684a705---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f997d684a705--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f997d684a705--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f997d684a705--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f997d684a705--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f997d684a705--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://psingman.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc7186ddb0db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhy-you-should-never-ever-print-in-a-lambda-function-f997d684a705&newsletterV3=d810baa7423b&newsletterV3Id=c7186ddb0db1&user=Paul+Singman&userId=d810baa7423b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}