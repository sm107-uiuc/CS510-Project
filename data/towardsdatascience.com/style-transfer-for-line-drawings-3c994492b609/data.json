{"url": "https://towardsdatascience.com/style-transfer-for-line-drawings-3c994492b609", "time": 1683013489.8452082, "path": "towardsdatascience.com/style-transfer-for-line-drawings-3c994492b609/", "webpage": {"metadata": {"title": "Style Transfer for Line Drawings. Generating Images From Line Drawings\u2026 | by Ryan Rudes | Towards Data Science", "h1": "Style Transfer for Line Drawings", "description": "Here, I\u2019ll walk through a machine learning project I recently did in a tutorial-like manner. It is an approach to generating full images in an artistic style from line drawings. I trained on 10% of\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.image-net.org/", "anchor_text": "Imagenet", "paragraph_index": 1}, {"url": "https://academictorrents.com/collection/imagenet-2012", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Canny_edge_detector", "anchor_text": "Canny edge detection algorithm", "paragraph_index": 12}, {"url": "https://www.pyimagesearch.com/2015/04/06/zero-parameter-automatic-canny-edge-detection-with-python-and-opencv/", "anchor_text": "this", "paragraph_index": 13}], "all_paragraphs": ["Here, I\u2019ll walk through a machine learning project I recently did in a tutorial-like manner. It is an approach to generating full images in an artistic style from line drawings.", "I trained on 10% of the Imagenet dataset. This is a dataset commonly used for benchmarks in computer vision tasks. The Imagenet dataset is not openly available; it is restricted to those undergoing research which requires use of it to compute performance benchmarks for comparing with other approaches. Therefore, it is typically required that you submit a request form. But if you are just using it casually, it is available here. I just wouldn\u2019t use this for beyond anything beyond personal projects. Note that the dataset is very large, which is why I only used 1/10th of it to train my model. It consists of 1000 classes, so I used 100 of these image classes for training.", "I used Imagenet for a different personal project a few weeks ago, so I already had a large collection of files in Google Drive. Unfortunately, however, it took approximately 20 hours to upload these 140,000 images or so to Google Drive. It is necessary to train the model on Google Colab\u2019s online GPU, but this requires you to upload the images to Google Drive, as you aren\u2019t hosting your coding environment locally.", "I have a Colab Pro account, but even with the additional RAM, I certainly can\u2019t handle 140,000 line drawing, each of 256x256 pixels in size, along with their 256x256 pixel colored counterparts. Hence, I have to load in the data on-the-go using a TensorFlow data input pipeline.", "Before we start to set up the pipeline, let\u2019s import the required libraries (these are all of the import statements in my code):", "Now, let\u2019s load the filepaths which refer to each image in our subset of Imagenet, assuming you have uploaded them to Drive under the appropriate directory structure and connection your Google Colab instance to your Google Drive.", "If you don\u2019t want to use the glob module, you can use functions from theos library, which are often more efficient.", "Here\u2019s a few helper functions I need:", "The aforementioned process of posterization takes an image as input and transforms smooth gradients into more clearly-separated color sections by rounding color values to some nearest value. Here\u2019s an example:", "As you can see, the resulting image has less smooth gradients, which are replaced with separated color sections. The reason I am implementing this is because I can limit the output images to a set of colors, allowing me to format the learning problem as a classification problem across each pixel in an image. For each available color, I assign a label. The model outputs an image of shape (height, width, num_colors) activated by a softmax function over the last channel, num_colors. Given a variable num_values, I allow all combinations of RGB where the color values are limited to np.arange(0, 255, 255 / num_values). This means that num_colors = num_values ** 3. Here\u2019s an example:", "For an example of how I implemented this, here\u2019s a demonstration:", "In order to create the input data from our colored images, we need a method of extracting edges from an image which are akin to a trace or line drawing.", "We\u2019ll be using the Canny edge detection algorithm. Let\u2019s write our helper function, which inputs the path to an image and output the associated example/(X, Y) training pair, comprised of a posterization of the colored input, alongside the black and white edge extraction:", "The automatic Canny edge detection is just my modification to the small function used in this article.", "As I said, I\u2019m loading in data on-the-spot using an input pipeline. Therefore, I need to define a generator object to load in this data when needed. My generator function is simple because we basically just defined it. All it adds is filtering out the None outputs of the preprocess function (images of lower resolution than input_image_size and filtering out any results containing nan or inf values.", "I use (128, 128) for both input_image_size and output_image_size. A 128x128 pixel image isn\u2019t that low-resolution, so there\u2019s no significant disadvantage for our purposes. Also, Imagenet images are typically much higher resolution, so we can go higher if desired.", "Now let\u2019s build the pipeline. I\u2019m using multithreading for improved speeds. TensorFlow\u2019s.interleave()allows us to do this:", "Let\u2019s load in a training example through our pipeline:", "It\u2019s exactly as desired. Note that the image depicted on the left is not exactly what was outputted by the pipeline. Recall that the pipeline is returning the index referring to the color of each pixel. I simply referred to each associated color to create the visualization. Here\u2019s an example of one that came out much simpler.", "You\u2019ll see that on the left we have the output, posterized color image, which partially resembles a painting. On the right, you see the input edge extraction, which resembles a sketch.", "Of course not all training examples will have as good of an edge extraction than others. When the colors are more difficult to separate, the resulting outline might be a little noisy and/or scattered. However, this was the most accurate method for extracting edges I could think of.", "Let\u2019s move on to the model architecture.", "I begin at input_image_size = (128, 128), thus making the input of shape (128, 128, 1) after expanding the last axis. I decrease the layer input shape by a power of 2 until it equals 1. Then, I apply two more convolutional layers with stride = 1, because we can\u2019t decrease the shape of the first two axes any further. Then, I perform the reverse with transposed layers. Each convolutional layer has padding = 'valid' and there is a batch normalization layer between each convolutional layer. All convolution layers have ReLU activation, except the last, which of course has softmax activation over the final one-hot-encoded color-label channel.", "Let\u2019s create some lists to store out metrics throughout training.", "Also, a variable for the number of training epochs", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am a high-school student studying and researching in ML. I work on projects in Python, mostly using TensorFlow."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3c994492b609&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ryanrudes.medium.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": ""}, {"url": "https://ryanrudes.medium.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Ryan Rudes"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7b60671f7b73&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&user=Ryan+Rudes&userId=7b60671f7b73&source=post_page-7b60671f7b73----3c994492b609---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.image-net.org/", "anchor_text": "Imagenet"}, {"url": "https://academictorrents.com/collection/imagenet-2012", "anchor_text": "here"}, {"url": "https://en.wikipedia.org/wiki/Canny_edge_detector", "anchor_text": "Canny edge detection algorithm"}, {"url": "https://www.pyimagesearch.com/2015/04/06/zero-parameter-automatic-canny-edge-detection-with-python-and-opencv/", "anchor_text": "this"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----3c994492b609---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/style-transfer?source=post_page-----3c994492b609---------------style_transfer-----------------", "anchor_text": "Style Transfer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&user=Ryan+Rudes&userId=7b60671f7b73&source=-----3c994492b609---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&user=Ryan+Rudes&userId=7b60671f7b73&source=-----3c994492b609---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3c994492b609&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3c994492b609---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3c994492b609--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3c994492b609--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3c994492b609--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3c994492b609--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3c994492b609--------------------------------", "anchor_text": ""}, {"url": "https://ryanrudes.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ryanrudes.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ryan Rudes"}, {"url": "https://ryanrudes.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "45 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7b60671f7b73&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&user=Ryan+Rudes&userId=7b60671f7b73&source=post_page-7b60671f7b73--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F659c9ad3e119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstyle-transfer-for-line-drawings-3c994492b609&newsletterV3=7b60671f7b73&newsletterV3Id=659c9ad3e119&user=Ryan+Rudes&userId=7b60671f7b73&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}