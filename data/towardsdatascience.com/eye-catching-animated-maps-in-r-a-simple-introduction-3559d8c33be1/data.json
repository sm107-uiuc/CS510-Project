{"url": "https://towardsdatascience.com/eye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1", "time": 1683015614.15896, "path": "towardsdatascience.com/eye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1/", "webpage": {"metadata": {"title": "Eye-catching animated maps in R \u2014 a simple introduction | by Stefan Haring | Towards Data Science", "h1": "Eye-catching animated maps in R \u2014 a simple introduction", "description": "Every day, we as data scientists and data analysts have to work with different kinds of data. And we all know that visualization of the data and our findings is key, especially when presenting it to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://leafletjs.com/", "anchor_text": "leaflet.js", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Choropleth_map", "anchor_text": "Choropleth", "paragraph_index": 5}, {"url": "https://www.openstreetmap.org/", "anchor_text": "OpenStreetMap", "paragraph_index": 9}, {"url": "http://leaflet-extras.github.io/leaflet-providers/preview/index.html", "anchor_text": "here", "paragraph_index": 9}, {"url": "http://www.thematicmapping.org", "anchor_text": "www.thematicmapping.org", "paragraph_index": 11}, {"url": "http://thematicmapping.org/downloads/world_borders.php", "anchor_text": "World Borders Dataset", "paragraph_index": 11}, {"url": "https://github.com/rstudio/leaflet/issues/496", "anchor_text": "here", "paragraph_index": 28}], "all_paragraphs": ["Every day, we as data scientists and data analysts have to work with different kinds of data. And we all know that visualization of the data and our findings is key, especially when presenting it to co-workers or clients. After all, it is far easier to tell a story with a chart than it is with plain numbers or text. When you\u2019re presenting data via a dashboard, not only static visualization becomes important, you will also want to display changes in your data dynamically.", "In this post, I will demonstrate how you can easily animate charts based on geospatial data using the leaflet and shiny libraries in R.", "While there are many ways to draw maps in R (e.g. with ggplot2 or tmap), the leaflet library is my personal favourite due to the following reasons:", "The leaflet R library is built on leaflet.js, which is the leading open-source JavaScript library for mobile-friendly interactive maps. The R implementation lets us produce simple maps in just a few lines. For example, with just one line of code you can display the following map, zooming in on beautiful Vienna, Austria:", "Even though it was quite simple to create this map, it doesn\u2019t show any data yet. Eventually what we would like is something like this:", "We want to overlay our map with data (like in the example above we\u2019ve added some circle markers) or even colour our map according to some underlying data (a so called Choropleth). And finally, we want to be able to animate changes in the data over time to include our map in a beautiful dashboard.", "In the following sections I will briefly demonstrate how to produce an animation similar to the one above and also how to create an animated Choropleth.", "To get started, we require two types of data: we need to display our desired map and the data that we are interested in displaying.", "For the map data, we have two main options with leaflet:", "We\u2019ve already seen how to use the basic tiles in the above charts, simply using the addTiles() function which defaults to OpenStreetMap Tiles. We could also be using other third-party tile sets using the addProviderTiles() function. For a full list of available tiles, see here.", "We can also read geospatial data from GeoJSON or TopJSON files and convert them into spatial objects in R. To create our Choropleth we will have to make use of a function called addPolygons() which requires us to use such spatial data. While this whole process sounds complicated and intimidating at first, it is actually pretty straightforward.", "For this article, we will focus on displaying data on country level. We can easily get the required spatial data from www.thematicmapping.org which provides the \u201cWorld Borders Dataset\u201d. The following code snippet shows how to download, unzip and load this data all from R. Obviously you only have to download the dataset once.", "The resulting spatial polygons data frame contains information about all countries, e.g. country code, name, longitude and latitude coordinates. The basic data included in the object can be accessed as follows:", "Important for drawing a Choropleth is the polygon data contained in the object. This is essentially the data used to draw the country borders.", "This is all the data we need in terms to create the basic map that we are going to be using.", "The data that we are going to display is connected to a current and important topic: case data for the ongoing COVID-19 pandemic. The World Health Organisation publishes daily case statistics for all countries in csv format which we can readily access.", "The dataset provides us with daily statistics since the beginning of 2020 and is updated on a daily basis.", "In this section, I will show how to create the basic versions of the map that we are going to animate later.", "First, we are going to combine our spatial data with the COVID cases for a selected date, define label texts that we are going to display as well as set up a color palette for the data and the chart legend.", "Now we can create the first version of our map using circle markers to display the COVID cases.", "This was pretty easy! All we had to do was use the addCircleMarkers() function, use the longitude and latitude coordinates included in our dataset as midpoints for the circles and make their radius and color dependent on the number of cases. We also added label texts that appear on hover as well as a legend in the bottom left corner. All of that with minimal effort!", "Creating a Choropleth version is equally straightforward. Instead of using the addCircleMarkers() function, we just have to use the addPolygons() function and instead of using coordinates we need to use the polygons contained in the spatial polygons data frame.", "Again, super easy! In the next section we will use shiny to animate both versions of the map that we have created.", "Note: I will briefly explain the general idea behind animating both versions of the map and will then show the entire code for the resulting shiny app to avoid confusing you with too many out-of-context code snippets.", "While leaflet itself can\u2019t help us with our task to display changes in the data over time, we can use a simple setup in shiny to accomplish this. All we have to do is to use a sliderInput widget that selects the dates for us and set the animate argument to TRUE.", "This input widget will have a small play button in the bottom right corner, and if we make our map observing changes in this widget, we will get our simulation!", "To avoid the overhead of redrawing the entire map every time it changes, we can use the leafletProxy() function, which was specifically designed to be used in a shiny context. It allows us to access an already drawn map and change its characteristics.", "For the markers version of the map, we simply need to clear the existing markers via clearMarkers() and add the new markers when we observe a change in the selected date.", "Unfortunately, redrawing the polygons is computationally more expensive and would introduce significant lagging in our shiny application. As of the writing of this article, no direct method included in the leaflet library allows us to simply alter the characteristics of the drawn polygons. However, using a little bit of JavaScript as detailed here will allow us to do what we want.", "As promised, you can find the full code for the shiny app below:", "This brings us to the end of this article in which I\u2019ve demonstrated how to easily create eye-catching animated maps using the leaflet and shiny R libraries. Hopefully, this will allow you to create amazing, interactive maps in just a few simple steps yourself and share it in a beautiful dashboard!", "Please make sure to let me know if you have any feedback or questions about what I\u2019ve shown in this article and stay safe in these uncertain times!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Quant/Data Scientist/Retail Investor. Risk/Data Management/Analytics for Investment Banks, Hedge Funds & Asset Managers"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3559d8c33be1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@harings?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287----3559d8c33be1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@timowielink?utm_source=medium&utm_medium=referral", "anchor_text": "Timo Wielink"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://leafletjs.com/", "anchor_text": "leaflet.js"}, {"url": "https://en.wikipedia.org/wiki/Choropleth_map", "anchor_text": "Choropleth"}, {"url": "https://www.openstreetmap.org/", "anchor_text": "OpenStreetMap"}, {"url": "http://leaflet-extras.github.io/leaflet-providers/preview/index.html", "anchor_text": "here"}, {"url": "http://www.thematicmapping.org", "anchor_text": "www.thematicmapping.org"}, {"url": "http://thematicmapping.org/downloads/world_borders.php", "anchor_text": "World Borders Dataset"}, {"url": "https://github.com/rstudio/leaflet/issues/496", "anchor_text": "here"}, {"url": "https://medium.com/tag/r?source=post_page-----3559d8c33be1---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/visualization?source=post_page-----3559d8c33be1---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/tag/charts?source=post_page-----3559d8c33be1---------------charts-----------------", "anchor_text": "Charts"}, {"url": "https://medium.com/tag/maps?source=post_page-----3559d8c33be1---------------maps-----------------", "anchor_text": "Maps"}, {"url": "https://medium.com/tag/shiny?source=post_page-----3559d8c33be1---------------shiny-----------------", "anchor_text": "Shiny"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&user=Stefan+Haring&userId=6c41f5dc3287&source=-----3559d8c33be1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&user=Stefan+Haring&userId=6c41f5dc3287&source=-----3559d8c33be1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3559d8c33be1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3559d8c33be1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3559d8c33be1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3559d8c33be1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3559d8c33be1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harings?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Stefan Haring"}, {"url": "https://medium.com/@harings/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "152 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6c41f5dc3287&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&user=Stefan+Haring&userId=6c41f5dc3287&source=post_page-6c41f5dc3287--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F4a0969693648&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Feye-catching-animated-maps-in-r-a-simple-introduction-3559d8c33be1&newsletterV3=6c41f5dc3287&newsletterV3Id=4a0969693648&user=Stefan+Haring&userId=6c41f5dc3287&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}