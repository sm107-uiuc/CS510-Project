{"url": "https://towardsdatascience.com/credit-card-fraud-detection-1b3b3b44109b", "time": 1683005877.4662359, "path": "towardsdatascience.com/credit-card-fraud-detection-1b3b3b44109b/", "webpage": {"metadata": {"title": "Credit Card Fraud Detection. Fraud detection using the multivariate\u2026 | by Christos Mousmoulas | Towards Data Science", "h1": "Credit Card Fraud Detection", "description": "Nowadays most of the transactions take place online, meaning that credit cards and other online payment systems are involved. This method is convenient both for the company and for the consumer\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/christk1/anomaly-detection", "anchor_text": "github repo", "paragraph_index": 1}, {"url": "https://aiverse.dev/articles/6/data-preprocessing-pt-2-2/", "anchor_text": "this", "paragraph_index": 9}, {"url": "https://devnal.com/articles/7/fraud-detection-in-python/", "anchor_text": "Fraud detection in Python (devnal.com)", "paragraph_index": 24}, {"url": "http://devnal.com", "anchor_text": "devnal.com", "paragraph_index": 26}], "all_paragraphs": ["Nowadays most of the transactions take place online, meaning that credit cards and other online payment systems are involved. This method is convenient both for the company and for the consumer. Consumers save time because they don\u2019t have to go to the store to make their purchases and companies save money by not owing physical stores and avoiding expensive rental payments. It seems that the digital age brought some highly useful features which changed the way that both companies and consumers interact with each other but with one cost\u2026 Companies need to hire skilled software engineers and penetration testers to make sure that all the transactions are legal and non-fraudulent. Those people are designing the company\u2019s servers in a way that the client has no control over critical transaction parts such as payment amount. With careful designing most (if not all) of the problems can be eliminated but even the framework which was used to create the server is not perfect. For example, if you follow the django framework release notes, you will see that there are many bug fixes among versions, thus a company should not rely only on its engineering skills.", "In this article, I will present a way to detect if someone bypasses the security walls and makes an illegal transaction. You can find the code and the dataset in my github repo but I strongly encourage you to build it along with the instructions of this article.", "The dataset consists of credit card transactions whose features are the product of PCA analysis and thus we don\u2019t know what they represent except from the \u2018Amount\u2019, \u2018Time\u2019 and \u2018Class\u2019 ones. \u2018Amount\u2019 is the price of each transaction, \u2018Time\u2019 is the <<seconds elapsed between each transaction and the first transaction>> and \u2018Class\u2019 represents a fraud transaction when its value equals 1 and a valid transaction when its value equals 0. Initially, we will install the required packages so grub the \u2018requirements.txt\u2019 file from my GitHub repo, create a virtual environment install them:", "Initially create a \u2018main.py\u2019 file and import the following:", "Now we will read the dataset and check if there is any missing value:", "There are no missing values so we can proceed with the visualizations to better understand our data. Let\u2019s plot how balanced our dataset is:", "We see that our data is highly imbalanced. Therefore, we cannot use any supervised learning algorithm directly because it will overfit based on the \u2018Normal\u2019 examples. At this point we are still in the data investigation-analysis stage so let\u2019s plot the heatmap:", "It seems that we don\u2019t have highly correlated features although there is a slightly negative correlation between \u2018V2\u2019 and \u2018Amount\u2019 (label not shown in the above heatmap but it is near the \u2018Class\u2019 feature) features. The \u2018Amount\u2019 feature is slightly correlated with the other features as well, meaning that it can partially be calculated by them so we can try dropping it (from my tests, this gave a nice amount of improvement to the final score). There is also a little correlation between \u2018Time\u2019 and other features but we will see a more important reason to drop it in the aftermath of this article.", "Until now, we did some nice data analysis but we didn\u2019t do the most important part which is, learning \u201cwhere our data came from\u201d. Thus the next graph will be the data distribution one:", "I encourage you to execute the above code snippet in your local machine to see the results better. The blue line indicates the actual Gaussian distribution, while the red one our data\u2019s probability density function. We see that almost every feature comes from the normal (or gaussian) distribution except from the \u2018Time\u2019 one. Therefore, this will be our motivation to do fraud detection with the multivariate Gaussian distribution. This method works only for features from the gaussian distribution, thus if your data is not gaussian-like you can transform it to be with a method that I describe in this article. For example, you can try this technique on features \u2018V26\u2019, \u2018V4\u2019, \u2018V1\u2019 and see if you get improvements in our final score. The \u2018Time\u2019 feature comes from the bimodal distribution which can\u2019t be transformed to gaussian-like, thus we will discard it. Another reason to discard \u2018Time\u2019 feature is that it doesn\u2019t seem to contain extreme values like the features shown in the other graphs.", "Moreover, the algorithm which we will be using is sensitive to distance metrics so if we scale the features to a fixed range, we will obtain much better results. Add the following code snippet which will drop the features mentioned above and scale the others so that they take values between 0 and 1:", "Note that MinMaxScaler won\u2019t change the shape of the distribution so the outliers will still be on the right place.", "At this point, we finished with our data analysis and preprocessing and we are ready to dive into the algorithm\u2019s implementation details. The steps of the algorithm are the following:", "where \u03bc is the mean, det is the determinant, \u03a3 is the covariance matrix, and \u03ba is the dimension of the space where x takes values.", "In general, this pdf returns the <<confidence>> that a transaction is normal. If that number is lower than the threshold then the transaction is an outlier.", "And yes, I know that the above pdf hurts your eyes (just like mine) but it is already implemented in the scipy package\u2026", "Continuing with our code, create a file called \u2018functions.py\u2019 where we will add useful functions to implement certain stages of the algorithm and place the following function which will split our dataset into train, validation and test sets:", "Now add the function below which will calculate the mean and the covariance matrix:", "Back to our \u201cmain.py\u201d, import and call the above functions along with the multivariate normal pdf for each of our sets:", "Now it\u2019s time to refer to the threshold (or \u2018epsilon\u2019). In general, a good practice is to initialize the threshold with the minimum value of the pdf and increment it with a small step until you reach the maximum pdf while saving each threshold value in a vector. For our problem, I found that the values from the pdf can effectively be used to create the threshold vector. After creating the vector, we create a \u2018for\u2019 loop and iterate over it. In every iteration, we compare the current threshold with the values of the pdf which yield our predictions. We then calculate the F1 score based on our predictions and the ground truth values and if the F1 score that we found is greater than the previous one, we override a \u201cbest threshold\u201d variable. At the end of the \u2018for\u2019 loop, we have the epsilon value that generated the best F1 score.", "Note that we can\u2019t use accuracy as our metric! If we identify all the transactions as \u2018normal\u2019 we could have 99% accuracy and a useless algorithm.", "To implement the above, add the following functions to the \u201cfunctions.py\u201d:", "Finally, import the functions in our \u201cmain.py\u201d file and call them to return our threshold and the F1 score on the validation set, and to evaluate our model on our test set:", "You reached the end of this tutorial, I hope that you found this information useful. Please feel free to comment, and ask about things you didn\u2019t understand and I will try to reply as soon as possible!", "Originally published at Fraud detection in Python (devnal.com).", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software engineer. Creator of \"devnal.com\". BS in Computer science."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1b3b3b44109b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@chrismousmoulas83?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chrismousmoulas83?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Christos Mousmoulas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe164017a15bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&user=Christos+Mousmoulas&userId=e164017a15bb&source=post_page-e164017a15bb----1b3b3b44109b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/mohamed_hassan-5229782/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=3696073", "anchor_text": "mohamed Hassan"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=3696073", "anchor_text": "Pixabay"}, {"url": "https://github.com/christk1/anomaly-detection", "anchor_text": "github repo"}, {"url": "https://aiverse.dev/articles/6/data-preprocessing-pt-2-2/", "anchor_text": "this"}, {"url": "https://devnal.com/articles/7/fraud-detection-in-python/", "anchor_text": "Fraud detection in Python (devnal.com)"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1b3b3b44109b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1b3b3b44109b---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-visualization?source=post_page-----1b3b3b44109b---------------data_visualization-----------------", "anchor_text": "Data Visualization"}, {"url": "https://medium.com/tag/python?source=post_page-----1b3b3b44109b---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/statistics?source=post_page-----1b3b3b44109b---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&user=Christos+Mousmoulas&userId=e164017a15bb&source=-----1b3b3b44109b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&user=Christos+Mousmoulas&userId=e164017a15bb&source=-----1b3b3b44109b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1b3b3b44109b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1b3b3b44109b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1b3b3b44109b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chrismousmoulas83?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chrismousmoulas83?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Christos Mousmoulas"}, {"url": "https://medium.com/@chrismousmoulas83/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "55 Followers"}, {"url": "http://devnal.com", "anchor_text": "devnal.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe164017a15bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&user=Christos+Mousmoulas&userId=e164017a15bb&source=post_page-e164017a15bb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7bafac6e7c47&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcredit-card-fraud-detection-1b3b3b44109b&newsletterV3=e164017a15bb&newsletterV3Id=7bafac6e7c47&user=Christos+Mousmoulas&userId=e164017a15bb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}