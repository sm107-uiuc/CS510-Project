{"url": "https://towardsdatascience.com/using-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6", "time": 1683002274.4058151, "path": "towardsdatascience.com/using-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6/", "webpage": {"metadata": {"title": "Using neural networks for a functional connectivity classification of fMRI data | by Gelana Tostaeva | Towards Data Science", "h1": "Using neural networks for a functional connectivity classification of fMRI data", "description": "All the necessary code will be provided in this guide. For the full version, please see this GitHub page. Prerequisites: This tutorial uses Python, Nilearn, and Keras. You do not need to have used\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/gelanat/network_neuroscience/blob/master/nn_2_final.ipynb", "anchor_text": "this GitHub page", "paragraph_index": 0}, {"url": "https://www.nhs.uk/conditions/attention-deficit-hyperactivity-disorder-adhd/", "anchor_text": "attention deficit hyperactivity disorder (ADHD)", "paragraph_index": 2}, {"url": "https://www.frontiersin.org/articles/10.3389/fnins.2018.00525/full", "anchor_text": "Du et al., 2018", "paragraph_index": 4}, {"url": "http://fcon_1000.projects.nitrc.org/indi/adhd200/index.html", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://github.com/gelanat/network_neuroscience/blob/master/nn_2_final.ipynb", "anchor_text": "full code.", "paragraph_index": 14}, {"url": "https://towardsdatascience.com/building-a-deep-learning-model-using-keras-1548ca149d37", "anchor_text": "this blog", "paragraph_index": 23}, {"url": "https://github.com/gelanat/network_neuroscience/blob/master/functional%20connectivity%20using%20neural%20nets.ipynb", "anchor_text": "Jupyter notebook", "paragraph_index": 28}, {"url": "https://medium.com/@gelana/using-fmriprep-for-fmri-data-preprocessing-90ce4a9b85bd", "anchor_text": "here", "paragraph_index": 30}], "all_paragraphs": ["All the necessary code will be provided in this guide. For the full version, please see this GitHub page.", "Prerequisites: This tutorial uses Python, Nilearn, and Keras. You do not need to have used Nilearn before, but you should have some experience with using Python and Keras. If you have never made a neural network before, this tutorial might be difficult to follow towards the end when we build a model, but feel free to stick around for the Nilearn part.", "We will explore a neural network approach to analyzing functional connectivity-based data on attention deficit hyperactivity disorder (ADHD). Functional connectivity shows how brain regions connect with one another and make up functional networks. As such, it might hold insights into how the brain communicates", "Our approach does not directly rely on neuroimaging scans and, instead, makes use of vectorized functional connectivity measures. This provides a computationally light way of getting practice with using machine learning for functional connectivity analysis.", "Similar approaches using more complicated neural network models have been used for classification, in the context of brain disorders in particular. However, these have proven to be challenging due to the numerous features in the data and validation difficulty (see Du et al., 2018 for a review). Our own analysis also shows less than optimal model accuracy, but the purpose of this tutorial is to provide a guide on how to get started. You are encouraged to try out your own neural network in the end!", "Nilearn, which is a Python module for neuroimaging data we will be using, has a variety of preprocessed datasets you can easily download with a built-in function:", "We will use the ADHD-200 publicly accessible dataset composed of resting-state fMRI and anatomical data collected from multiple research centers. Nilearn has data for only 40 subjects, so we load all of them.", "We can inspect the dataset by looking at the .keys() \u2014 we see that there are 4 types of information. \u201cfunc\u201d features the paths to the rs-fMRI data images; \u201cconfounds\u201d are the CSV files containing the nuisance variables (confounds) we want to be aware of as not to affect our analysis; \u201cphenotypic\u201d provides explanations for the preprocessing steps; \u201cdescription\u201d is, well, description of the dataset.", "The data were collected to increase understanding of the neural correlates of ADHD. If you want, you can learn more about the original dataset here. For the purposes of this tutorial, you only need to know that the dataset features both typically developing individuals (\u201ccontrols\u201d) and those with diagnosed ADHD (\u201ctreatments\u201d).", "We will extract the functional connectivity coefficients from this dataset to classify whether a given subject is a \u201ccontrol\u201d or \u201ctreatment\u201d. We will do so by first using an independent component analysis from nilearn and then use it to extract functional connectivity coefficients. Finally, we will build a neural network using these coefficients to discriminate \u201ccontrols\u201d from \u201ctreatments\u201d.", "Independent component analysis (ICA) is commonly used to assess functional connectivity. Nilearn has a method for group-level ICA (CanICA) which allows for control over single subject variability, especially given that we are interested in functional networks.", "We use Nilearn\u2019s built-in function and get nice visualizations of what we are working with. We choose to use a 20-component decomposition based on the standards provided in the Nilearn documentation for the chosen dataset. We get the independent components using masker_.inverse_transform which we then plot using the Nilearn\u2019s plotting options for both the statistical and probabilistic atlas maps. We need the statistical one to plot the default mode network (DMN) specifically \u2014 the plot_stat_map function allows plotting cuts of this region of interest; the probabilistic one simply uses all the components yielded from the decomposition and layers them on top of the default anatomical brain image.", "Our component decomposition is hard to interpret conclusively (essentially, we are seeing different brain regions in the fMRI data), but we can use it as a filter to extract the regions we are interested in. We do so calling the NiftiMapsMasker function from Nilearn to \u201csummarize\u201d the brain signals we obtained using ICA. Once we have that, we transform the extracted data to time-series by using the fit_transform method.", "We then use everything we know about the dataset (\u201cfunc\u201d, \u201cconfounds\u201d, and \u201cphenotypic\u201d files) to get the information we need, including whether the subject is \u201ctreatment\u201d or \u201ccontrol\u201d and their associated data collection location (site).", "Thus far, we used a CanICA to get components that we needed to determine the regions of interest. The last thing to do before we can build our neural network model is to get functional connectivity coefficients. For this, we need to look at the functional connectivity between the regions of interest we extracted. We considered three different kinds of functional connectivity and determined correlation to be the most accurate. You can find how we did this in the full code.", "Correlation simply determines the marginal connectivity between pairwise regions of interest. Nilearn has a built-in method for computing the correlation matrices, the ConnectivityMeasure function. We only need to specify the kind of functional connectivity we are interested in and then fit the time-series data we extracted in the previous step.", "We now have our connectivity matrices for all subjects, but let\u2019s see what the average connectivity across all looks like. We split the matrices into those of treatment versus control subjects for comparison. This comparison is what our neural network model will use for classification.", "We can see that the connections are not particularly strong for either group (the diagonal line can be ignored as it shows correlation with itself and, thus, always equals to 1). To better visualize the connections and the differences, we can project these back onto the brain.", "This gives us a nice connectome, the brain map of all the connections for 20 regions we are looking at.", "The resulting ADHD connections do not seem as dense, compared to the control ones, which might be related to the notion of reduced functional connectivity associated with ADHD (Yang et al., 2011). In line with some of the previous research (Tomasi & Volkow, 2012), for ADHA subjects, we notice fewer connections in the superior parietal cortex (the upper right part in the first coronal graph) which is thought to be implicated in attention. There also seem to be fewer connections in the DMN, which we visualized before, a network active during rest and associated with the \u201cself\u201d \u2014 one that is suggested to be altered in ADHD (Mowinckel et al., 2017). These, albeit small differences, suggest that it should not be impossible to classify between treatments and controls using correlation matrices in our neural network model.", "If you would like to see an interactive visualization of the connectome, you can run the line below. Otherwise, we are ready to move on to the modeling!", "Now that we have our correlation matrices providing a vectorized measure of functional connectivity, we can use these as the input data for our neural network.", "Before we build our model, we should split the data for training (70%) and testing (30%):", "Our neural network can be anything from one layer to five. After playing with a few different architectures, we settled on a Sequential model made up of four Dense layers. This tutorial assumes you know what these mean, so we will not go into all the details and give a brief overview of the overall architecture instead. If you need a refresher on the topic, this blog is a good start.", "And this is it! We built a simple neural network. Let\u2019s recap the architecture of our model:", "Now, there\u2019s only one thing left to do \u2014 see how our model performs. We will use accuracy as our main metric as it represents the proportion of correct classifications.", "Let\u2019s start with the training set:", "Hooray, the accuracy on our training data is 1. Onto the scary part of testing data.", "The overall accuracy of our classification is 75% which is not terrible but could be better. We also only got 2 false negatives and 1 false positive. It\u2019s now up to you to play with the simple model you build in this step-by-step guide! A disclaimer that the model in the corresponding Jupyter notebook has a much lower accuracy than reported here likely due to random processes \u2014 all the more reason to experiment and come up with a better model.", "This tutorial explored how functional connectivity data can be used to screen for ADHD. We created a neural network based on functional connectivity coefficients for different regions to do so. As we have seen through the component analysis and connectome plots, the differences between treatment and control samples are not prominent which could explain the lower accuracy of our screening. More work with larger datasets should be done to see if there is a more consistent pattern within functional connectivity in ADHD. It could be also interesting to examine a higher number of regions and components in future analyses.", "Hopefully, this has given you some idea of how you can use machine learning for functional connectivity analysis of fMRI data. We (conveniently) used preprocessed data, but if you want to learn more about the preprocessing step of fMRI data analysis, check out my other tutorial here. Until next time!", "Du, Y., Fu, Z., & Calhoun, V. D. (2018). Classification and prediction of brain disorders using functional connectivity: promising but challenging. Frontiers in neuroscience, 12.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "a [wannabe] computational neuroscience student hoping & trying to make learning effective and personalized while traveling the world with Minerva. @gelana_t"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fff0999057bc6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@gelana?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gelana?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Gelana Tostaeva"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8b1e66cca19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&user=Gelana+Tostaeva&userId=c8b1e66cca19&source=post_page-c8b1e66cca19----ff0999057bc6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/gelanat/network_neuroscience/blob/master/nn_2_final.ipynb", "anchor_text": "this GitHub page"}, {"url": "https://www.nhs.uk/conditions/attention-deficit-hyperactivity-disorder-adhd/", "anchor_text": "attention deficit hyperactivity disorder (ADHD)"}, {"url": "https://www.frontiersin.org/articles/10.3389/fnins.2018.00525/full", "anchor_text": "Du et al., 2018"}, {"url": "http://fcon_1000.projects.nitrc.org/indi/adhd200/index.html", "anchor_text": "here"}, {"url": "https://github.com/gelanat/network_neuroscience/blob/master/nn_2_final.ipynb", "anchor_text": "full code."}, {"url": "https://towardsdatascience.com/building-a-deep-learning-model-using-keras-1548ca149d37", "anchor_text": "this blog"}, {"url": "https://github.com/gelanat/network_neuroscience/blob/master/functional%20connectivity%20using%20neural%20nets.ipynb", "anchor_text": "Jupyter notebook"}, {"url": "https://medium.com/@gelana/using-fmriprep-for-fmri-data-preprocessing-90ce4a9b85bd", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ff0999057bc6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/nilearn?source=post_page-----ff0999057bc6---------------nilearn-----------------", "anchor_text": "Nilearn"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----ff0999057bc6---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/fmri?source=post_page-----ff0999057bc6---------------fmri-----------------", "anchor_text": "Fmri"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----ff0999057bc6---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&user=Gelana+Tostaeva&userId=c8b1e66cca19&source=-----ff0999057bc6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&user=Gelana+Tostaeva&userId=c8b1e66cca19&source=-----ff0999057bc6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fff0999057bc6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ff0999057bc6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ff0999057bc6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ff0999057bc6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ff0999057bc6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gelana?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@gelana?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gelana Tostaeva"}, {"url": "https://medium.com/@gelana/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "73 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc8b1e66cca19&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&user=Gelana+Tostaeva&userId=c8b1e66cca19&source=post_page-c8b1e66cca19--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9392e665f67b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fusing-neural-networks-for-a-functional-connectivity-classification-of-fmri-data-ff0999057bc6&newsletterV3=c8b1e66cca19&newsletterV3Id=9392e665f67b&user=Gelana+Tostaeva&userId=c8b1e66cca19&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}