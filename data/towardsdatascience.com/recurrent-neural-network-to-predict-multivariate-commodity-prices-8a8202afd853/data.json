{"url": "https://towardsdatascience.com/recurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853", "time": 1683000866.196945, "path": "towardsdatascience.com/recurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853/", "webpage": {"metadata": {"title": "LSTM to Predict Stock Prices \u2014 Time-Series Data | by Sarit Maitra | Towards Data Science", "h1": "LSTM to Predict Stock Prices \u2014 Time-Series Data", "description": "PREDICTION of financial series is always a complex task and has attracted major attention from academics, investment companies, banks etc. Price prediction are typically evaluated on the basis of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/granger-causality-and-vector-auto-regressive-model-for-time-series-forecasting-3226a64889a6", "anchor_text": "seen", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/granger-causality-and-vector-auto-regressive-model-for-time-series-forecasting-3226a64889a6", "anchor_text": "earlier", "paragraph_index": 2}], "all_paragraphs": ["PREDICTION of financial series is always a complex task and has attracted major attention from academics, investment companies, banks etc. Price prediction are typically evaluated on the basis of statistical criteria, such as mean error, mean absolute error (MAE), or root mean squared error (RMSE). We have already seen the relationships among multiple time series (Gold prices, Silver prices, Crude Oil prices, Stock index , Interest Rate and USD rate) and how they influence each other.", "Let\u2019s use the same data set and try to solve our prediction problem with Recurrent Neural network (RNN) algorithm. Neural networks are well known for their efficiency with multiple input variables.", "Let\u2019s load the data which is already processed earlier; if there is any data error, hopefully our model will learn to ignore.", "Let\u2019s understand the mathematical intuition of feed-forward network.", "where, x1, x2\u2026.xk are input series, \u0177 is output series and in between a bunch of hidden layers. However, here the issues are-", "\u201cFeed-Forward network architecture does not have a memory built-in. Moreover, it appears a situation where a deep multilayer feed-forward network is unable to propagate useful gradient information from the output end of the model back to the layers near the input end of the model\u201d", "To overcome these difficulties, RNN was introduced which comes with a network architecture that can-", "\u201cRNN handles variable-length sequence by having a recurrent hidden state whose activation at each time is dependent on that of the previous time\u201d", "Below diagram and equations give a clear idea about how RNN works \u2014", "where, \ud835\udc65\ud835\udc61 represents inputs, \u210e\ud835\udc61 expresses the hidden layers from input to output, yt is output. On the top of that, it has a recurrent loop which loop back to the past to express that, the output is not only a function of new input but also a function of past hidden layer and that way the network keeps growing. However, it has a problem of exploding and vanishing gradient. Recurrent Neural Networks (LSTM) addresses this issue. They are networks with loops in them, allowing information to persist. The most important concept for LSTM is the state of the cell, and this information is transmitted to each other between cells with yt data embedded on the top of the cell.", "In the above diagram, a chunk of neural network, A, looks at some input xt and outputs a value ht. A loop allows information to be passed from one step of the network to the next. These loops make recurrent neural networks kind of mysterious object. However, they aren\u2019t all that different than a normal Neural Network. A Recurrent Neural Network is the multiple copies of the same network, each passing a message to a successor. The cell state works like a conveyor belt and is carried through the entire chain. Cells may make small changes to this information. There are gates inside the cells. These gates contain a sigmoid function and open and close the sigmoid function according to the output value. Then the gate output value and yt value are subjected to multiplication. The sigmoid function outputs can take values between 0 and 1, while a value of zero closes the information transition and moves a value across the entire information. If the loop is unrolled as shown in below diagram-", "This chain-like nature reveals that recurrent neural networks are intimately related to sequences and lists. They\u2019re the natural architecture of neural network to use for such data. Let\u2019s consider the hidden state ht at time step t. The first thing the LSTM cell needs to decide is to report the cell status. This decision is made by the forget gate layer. The forget gate layer generates a value between 0 and 1 for each yt\u22121 by looking at ht\u22121 and \ud835\udc65\ud835\udc61. 1 means that data is stored and 0 means that it will be forgotten. The mathematical expression of the process performed by forget gate layer :", "The next step is about whether to record the new information in the cell state. Input gate layer decides which value to update. The input gate layer and the output of the input gate layer can be formulated as :", "A non-linear function layer (tanh) which generates a vector of new candidate values, \u0177t which could be added to the state.", "The old cell state is then updated and the y\ud835\udc61 value representing the new cell state is determined. The below equation can be written for obtaining the new y\ud835\udc61 value.", "Finally, to ensure that the output value is between -1 and 1 and filter the output, the output functions can be specified as :", "LSTM suffers from vanishing gradients as well, but not as much as the basic RNN. The difference is for the basic RNN, the gradient decays with w\u03c3\u2032(\u22c5) while for the LSTM the gradient decays with \u03c3(\u22c5). For the LSTM, there\u2019s is a set of weights which can be learned such that \u03c3(\u22c5)\u22481. Assuming vt + k = wx for some weight w and input x, then Neural Network can learn a large w to prevent gradients from vanishing. For the basic RNN, there is no set of weights which can be learned such that :", "The LSTM model in Keras assumes that the data is divided into input (x) and output (y) components. This can be achieve this by using the observation from the last time step (t-1) as the input and the observation at the current time step (t) as the output in a time series.", "Let\u2019s add a \u201cpred\u201d column as our output and shift it.", "Scaling and normalizing is an important activity in the formation of Neural Network Architecture.", "If we check the data, it has a wide range of values (1.336, 13592.79) and neural network do not perform well in this kind of range.", "We have defined a function to specify the look back interval (60 time steps) and the predicted column as below.", "Here, I have split the data in 80/20 ratio. Moreover, we need to reshape the data to 3D array for LSTM to read and train the model.", "We can see the training set contains 4103 data points and testing set has 966 data points.", "Now, we add the LSTM layers and few Dropout layers to prevent overfitting. I have added 3 extra layers in the network. The following arguments are considered for the network architecture:", "Next, the model was fit to run on 100 epochs with a batch size of 32. Instead of training the RNN on the complete sequences of observations, we have used a batch of shorter sub-sequences (32) picked at random from the training-data.", "A line plot of model accuracy on the train and test sets is created, showing the change in performance over all 15 training epochs. The line plot below of the test data (blue) vs the predicted values (orange) providing the context for the model skill.", "The model is fit to the training data; therefore, it can be used to make forecasts. Now, used the trained model to predict the \u201cpred\u201d values in test dataset. I have used fixed approach here for prediction.", "Fixed approach : We can decide to fit the model once on all of the training data, then predict each new time step one at a time from the test data", "Dynamic approach: We can re-fit the model or update the model each time step of the test data as new observations from the test data are made available.", "We must invert the scale on forecasts to return the values back to the original scale so that the results can be interpreted and a comparable error score can be calculated.", "Now we can see, we are not quite there yet. The result is not that impressive. We can check the difference between these two and compare the results in various ways & optimize the model before we build the trading strategy.", "Let\u2019s see if we can improve the model performance by shifting 10 time steps and doing some hyper parameter adjustments.", "Here the line plot visually looks better than the previous two on both training and testing set. The model appears to rapidly learn the problem, converging on a solution in about 20 epochs. The loss metrics e.g. RMSE, MAE can be obtained similar way as shown earlier.", "Though there is some improvement, but in terms of prediction, we still have rooms for improvement. An important factor here is that, we have used daily prices in this model so the data points are really less only 5,129 data points for Neural Network Architecture. I would recommend to use more than 100,000 data points using minute or tick data for training the model while building ANN or any other Deep Learning model to be most effective.", "Six different time series were used in order to measure the performance of the network fairly. We have found these series are causing each other by using Granger\u2019s Causality. The estimation results obtained are compared with the graphs. RMSE and R values were examined as predictive success criteria. However, it is possible to achieve more successful results with more data points and by changing the hyper parameters of the LSTM network.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Analytics & Data Science Practice Lead"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8a8202afd853&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sarit-maitra.medium.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Sarit Maitra"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc611876588a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&user=Sarit+Maitra&userId=c611876588a8&source=post_page-c611876588a8----8a8202afd853---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/granger-causality-and-vector-auto-regressive-model-for-time-series-forecasting-3226a64889a6", "anchor_text": "seen"}, {"url": "https://towardsdatascience.com/granger-causality-and-vector-auto-regressive-model-for-time-series-forecasting-3226a64889a6", "anchor_text": "earlier"}, {"url": "https://www.linkedin.com/in/saritmaitra/", "anchor_text": "here"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----8a8202afd853---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/timeseries-forecasting?source=post_page-----8a8202afd853---------------timeseries_forecasting-----------------", "anchor_text": "Timeseries Forecasting"}, {"url": "https://medium.com/tag/multivariate-analysis?source=post_page-----8a8202afd853---------------multivariate_analysis-----------------", "anchor_text": "Multivariate Analysis"}, {"url": "https://medium.com/tag/long-short-term-memory?source=post_page-----8a8202afd853---------------long_short_term_memory-----------------", "anchor_text": "Long Short Term Memory"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&user=Sarit+Maitra&userId=c611876588a8&source=-----8a8202afd853---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&user=Sarit+Maitra&userId=c611876588a8&source=-----8a8202afd853---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8a8202afd853&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8a8202afd853---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8a8202afd853--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8a8202afd853--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8a8202afd853--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8a8202afd853--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8a8202afd853--------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sarit-maitra.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sarit Maitra"}, {"url": "https://sarit-maitra.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.8K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc611876588a8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&user=Sarit+Maitra&userId=c611876588a8&source=post_page-c611876588a8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fba440ad8d04d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Frecurrent-neural-network-to-predict-multivariate-commodity-prices-8a8202afd853&newsletterV3=c611876588a8&newsletterV3Id=ba440ad8d04d&user=Sarit+Maitra&userId=c611876588a8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}