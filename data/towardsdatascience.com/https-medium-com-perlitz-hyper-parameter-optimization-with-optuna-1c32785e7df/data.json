{"url": "https://towardsdatascience.com/https-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df", "time": 1683001535.98926, "path": "towardsdatascience.com/https-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df/", "webpage": {"metadata": {"title": "Hyper-parameter optimization with Optuna | by Yotam Perlitz | Towards Data Science", "h1": "Hyper-parameter optimization with Optuna", "description": "How to use optuna for Hyper-parameter optimization with pytorch and google Colab"}, "outgoing_paragraph_urls": [{"url": "https://optuna.org/", "anchor_text": "Optuna", "paragraph_index": 0}, {"url": "https://optuna.readthedocs.io/en/stable/tutorial/index.html", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://optuna.readthedocs.io/en/latest/faq.html", "anchor_text": "this", "paragraph_index": 10}, {"url": "https://optuna.readthedocs.io/en/stable/tutorial/index.html", "anchor_text": "Optuna documentation", "paragraph_index": 23}], "all_paragraphs": ["In this post, we will take a simple functioning pytorch neural network training script and enhance it using the Optuna package(docs here). This will allow easy assimilation of smart hyper-parameter tuning and trial pruning into your ML workflow with minimal code modifications.", "Personally, finding the best hyper-parameters to fit my objective has been the worst part of my ML workflow. Up until now, my choices were two: (1) sacrifice my time and sanity and use good old graduate-student-descent or (2) implement a complicated framework to search the parameter space, find the best values, document and visualize the process.", "The good news: such a framework already exists, it\u2019s called Optuna, and it\u2019s easy and fun to use.", "Our starting point is an MNIST classification script from the Pytorch tutorials. The full script is presented here for completeness, however, since none of the other parts are relevant to our point, I recommend skimming through all parts leading up to the main function.", "If you want to see the code in action, below is a link to a working google colab notebook.", "Now let\u2019s get down to business.", "We begin with imports and data loaders:", "Notice that up to this point, nothing interesting really happened, just a simplified pytorch MNIST classifier script. Training the above script with the current randomly chosen hyper-parameters for 5 epochs will give 93% accuracy. Can we do better? Let us see\u2026", "The Optuna framework (installed via pip install optunaand imported as import optuna ) is based upon the study object. It contains all of the information about the required parameter space, the sampler method and the pruning:", "Once the study is created, the search space is incorporated via the trial.suggest_ methods. We will embed these into the train_mnist config such that these values:", "In this manner we define the search space to our requirements, once this is done, train_mnist() should get trial as its input and be defined as train_mnist(trial) . Note that a configuration which allows train_mnist to have inputs other than trial exists, check this out, if you come across this need.", "The final step is to define an objective function, the output of which will be optimized over. In our case we choose train_mnist and its output, the test error\u00b9.", "Therefore study.optimize will be called, with train_mnist as its parameter:", "All in all, main, which was comprised of a single call for train_mnist() , has turned into:", "And that\u2019s it! Once these lines are added to the code, the optimizer will sample the defined parameter space according to the sampler.", "After optimization is done, results can be accessed as a dataframe via study.trials_dataframe:", "were one can see all trials and their value. To find the best trial best parameters, study.best_trial and study.best_params can be also used.", "Here, we also see how one of the results got a 98.9% test error (~6% improvement) with the same amount of training data and time, this is a major improvement for 3 lines of code.", "Other than showing you the best configuration of parameters, Optuna also helps in visualizing the dependence of the objectives on the parameters. Given the study object, all sorts of visualization tools exist in optuna.visualization . You can call plot_parallel_coordinates(study) to view the dependence between the parameters (in this case- lr and momentum) and the objective:", "Another way to try to gain some intuition is by using a contour plot. This can be produced by calling plot_contour(study) :", "To complete the picture, you can also produce a slice plot by calling slice_plot(study) . This can help with the understanding of where the best subspaces are located for each parameter individually.", "One last visualization option is the study history, produced by plot_optimization_history(study) . This will present the following plot:", "This shows how Optuna\u2019s study takes place, first by sampling the space evenly, then by focusing in on the most promising areas.", "To conclude, I hope you enjoyed this tutorial, I left out several great features like early pruning and different search algorithms, which will have to wait for another time. If I\u2019ve piqued your interest, check out the great Optuna documentation, it\u2019s all there.", "[1] Note that in this article I perform a terrible crime for the sake of brevity: one should never optimize over the test set, as it will overfit the testing data! A better path would be to split the training set into train and validate, but since this is not the subject of this post, I\u2018ve decided to leave it as is.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1c32785e7df&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1c32785e7df--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@perlitz?source=post_page-----1c32785e7df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perlitz?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Yotam Perlitz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F551288f3c5cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&user=Yotam+Perlitz&userId=551288f3c5cf&source=post_page-551288f3c5cf----1c32785e7df---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://optuna.org/", "anchor_text": "Optuna"}, {"url": "https://optuna.readthedocs.io/en/stable/tutorial/index.html", "anchor_text": "here"}, {"url": "https://colab.research.google.com/drive/1TEILbIeyE1wW3daNWOx9rLq0Hc9TXmbV", "anchor_text": "Google ColaboratoryOptuna MNIST pytorch"}, {"url": "https://optuna.readthedocs.io/en/latest/faq.html", "anchor_text": "this"}, {"url": "https://optuna.readthedocs.io/en/stable/tutorial/index.html", "anchor_text": "Optuna documentation"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1c32785e7df---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/optimization?source=post_page-----1c32785e7df---------------optimization-----------------", "anchor_text": "Optimization"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----1c32785e7df---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----1c32785e7df---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1c32785e7df---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&user=Yotam+Perlitz&userId=551288f3c5cf&source=-----1c32785e7df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&user=Yotam+Perlitz&userId=551288f3c5cf&source=-----1c32785e7df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1c32785e7df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1c32785e7df---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1c32785e7df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1c32785e7df--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1c32785e7df--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1c32785e7df--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1c32785e7df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perlitz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@perlitz?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yotam Perlitz"}, {"url": "https://medium.com/@perlitz/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F551288f3c5cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&user=Yotam+Perlitz&userId=551288f3c5cf&source=post_page-551288f3c5cf--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9f3ec3374da9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhttps-medium-com-perlitz-hyper-parameter-optimization-with-optuna-1c32785e7df&newsletterV3=551288f3c5cf&newsletterV3Id=9f3ec3374da9&user=Yotam+Perlitz&userId=551288f3c5cf&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}