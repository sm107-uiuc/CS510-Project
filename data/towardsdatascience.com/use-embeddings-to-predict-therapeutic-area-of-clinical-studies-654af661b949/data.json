{"url": "https://towardsdatascience.com/use-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949", "time": 1682994220.125589, "path": "towardsdatascience.com/use-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949/", "webpage": {"metadata": {"title": "Use Embeddings to Predict Therapeutic Area of Clinical Studies | by Thierry Herrmann | Towards Data Science", "h1": "Use Embeddings to Predict Therapeutic Area of Clinical Studies", "description": "Clinical studies is a world of fascinating concepts for which a lot of freely downloadable data sets exist. One of my tasks at Comprehend (recruiting) was to do a proof of concept to automatically\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.comprehend.com", "anchor_text": "Comprehend", "paragraph_index": 0}, {"url": "https://boards.greenhouse.io/comprehend/jobs/1456548", "anchor_text": "recruiting", "paragraph_index": 0}, {"url": "https://clinicaltrials.gov/", "anchor_text": "ClinicalTrials.gov", "paragraph_index": 1}, {"url": "https://www.ctti-clinicaltrials.org/", "anchor_text": "CTTI", "paragraph_index": 1}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "Jupyter notebook", "paragraph_index": 2}, {"url": "https://nlpforhackers.io/word-embeddings/", "anchor_text": "nice introduction", "paragraph_index": 3}, {"url": "https://www.nlm.nih.gov/research/umls/", "anchor_text": "Unified Medical Language System", "paragraph_index": 4}, {"url": "https://www.nlm.nih.gov/mesh/", "anchor_text": "MeSH", "paragraph_index": 6}, {"url": "https://www.nlm.nih.gov/research/umls/new_users/online_learning/UMLST_009.html", "anchor_text": "Rich Release Format (RRF) browser", "paragraph_index": 7}, {"url": "http://dl.acm.org/citation.cfm?id=2661974", "anchor_text": "De Vine et al. CIKM '14", "paragraph_index": 8}, {"url": "https://github.com/clinicalml/embeddings/blob/master/DeVine_etal_200.txt.gz", "anchor_text": "here", "paragraph_index": 8}, {"url": "http://people.csail.mit.edu/dsontag/papers/ChoiChiuSontag_AMIA_CRI16.pdf", "anchor_text": "Learning Low-Dimensional Representations of Medical Concepts", "paragraph_index": 8}, {"url": "https://radimrehurek.com/gensim/", "anchor_text": "gensim", "paragraph_index": 8}, {"url": "https://www.ctti-clinicaltrials.org/", "anchor_text": "CTTI", "paragraph_index": 12}, {"url": "https://clinicaltrials.gov/", "anchor_text": "ClinicalTrials.gov", "paragraph_index": 12}, {"url": "https://aact.ctti-clinicaltrials.org/download", "anchor_text": "CTTI download site", "paragraph_index": 12}, {"url": "https://www.nlm.nih.gov/research/umls/knowledge_sources/metathesaurus/release/", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://www.ncbi.nlm.nih.gov/books/NBK9685/table/ch03.T.concept_names_and_sources_file_mr/?report=objectonly", "anchor_text": "here", "paragraph_index": 16}, {"url": "https://radimrehurek.com/gensim/models/keyedvectors.html", "anchor_text": "Gensim", "paragraph_index": 25}, {"url": "https://radimrehurek.com/gensim/models/keyedvectors.html", "anchor_text": "Gensim", "paragraph_index": 28}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "notebook", "paragraph_index": 30}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "notebook", "paragraph_index": 33}], "all_paragraphs": ["Clinical studies is a world of fascinating concepts for which a lot of freely downloadable data sets exist. One of my tasks at Comprehend (recruiting) was to do a proof of concept to automatically classify clinical studies in one of about 40 manually defined therapeutic areas of such as the following:", "The set of about 289000 studies to consider is available on ClinicalTrials.gov. As we\u2019ll see below one can download the full content as CSV files or Postgres database for offline use thanks to the CTTI (Clinical Trials Transformation Initiative) that provides top quality documentation. In particular studies are associated to some medical terms.", "Since the above therapeutic areas have been manually defined, how can we relate those to the studies\u2019 medical terms ? This is where concept embeddings come. All the code presented below is available in a Jupyter notebook", "A lot has already been written about word embeddings. Here\u2019s a nice introduction about their power. In this post we\u2019ll use pre-trained clinical concept embeddings to map the therapeutic areas to the studies.", "The National Library of Medicine (NLM) created the Unified Medical Language System\u00ae (UMLS\u00ae), an incredibly well organized source of medical concepts and terms best described on its web site:", "The UMLS integrates and distributes key terminology, classification and coding standards, and associated resources to promote creation of more effective and interoperable biomedical information systems and services, including electronic health records", "In particular a central notion is the one of a medical concept as varied as Malaria, Radiotherapy, Neoplasms or Leukemia. Each concept is identified by a Concept Unique Identifier (CUI) and mapped to data sources for various medical terms like MeSH (Medical Subjects Headings) that we\u2019ll use below.", "Here\u2019s a screenshot of the Rich Release Format (RRF) browser, a powerful tool provided with the UMLS that can be downloaded after one obtains a license from the NLM. Concepts can be searched by word and relations to other concepts can be found:", "Pretrained embeddings of UMLS CUIs learned by De Vine et al. CIKM '14, derived from 348,566 medical journal abstracts (courtesy of the authors) can be downloaded here, thanks to D. Sontag et al for the excellent work done from there (see Learning Low-Dimensional Representations of Medical Concepts). Here\u2019s how to load them thanks to the awesome gensim library:", "As expected the cosine similarity of closely related concepts is high. For example here are the concepts that are the closest ones to headache or hepatitis:", "We will connect a clinical study to therapeutic areas with concept embeddings by using this path:", "The set of data sources and transformations is summarized in this diagram:", "The CTTI offers very well organized and documented data from ClinicalTrials.gov. The studies as well as associated data can be downloaded from CTTI download site . Here\u2019s the subset of the data we\u2019re interested in (schema diagram provided by CTTI):", "Studies are in file studies.txt and are linked to MeSH terms in browse_conditions.txt. Here\u2019s an example of the MeSH terms for study NCT01007578 about atherosclerosis:", "It\u2019s easy to load those and build a dictionary from study ID to its set of MeSH terms. load_df() is a small wrapper function around pandas\u2019 read_csv(). The dictionary is then built:", "The relevant MeSH file can be downloaded from the National Library of Medicine. Parsing details are in the notebook.", "We\u2019ll now load the Concepts and Sources files (MRCONSO.RRF) that comes with the huge set of UMLS files available here. Its format is described here. Before loading this CSV file as a pandas data frame, we can reduce its size (7148656 rows for 897Mb) by half by retaining only the columns we need.", "The short load_conso() function loads the reduced file into a data frame. See how the same concept (same CUI) is mapped to different source specific codes (different SAB/CODE):", "From the above data frame create a map from MeSH code to CUIs . This will be used later to link a study to concept CUIs (through MeSH codes)", "We then use the results of 1., 2. and 3.1 above to build a dictionary of study identifiers to concept CUIs. For a first pass we remove studies referring to a MeSH term that is not in the CTTI files:", "From the above data frame create a map from CUIs to the corresponding set of strings. This will be used later to map therapeutic areas to CUIs:", "For evaluation purposes later it is useful to use that map to associate studies with description strings made of the strings of the associated CUIs:", "Therapeutic areas are manually defined to match strategic business needs. Thus to relate them with studies we need to associate them to concept CUIs. This is the most tricky part of this post.", "Subject matter experts know about each area thus are able to identify which strings or descriptions are related to it. Using the above cui_to_strings dictionary it\u2019s easy to identify which CUI matches which string, using sub-string matching.", "For example for the cardiology area let\u2019s try to retain all CUIs whose set of terms contain at least the cardiodiolog and cardiovascul sub-strings (results truncated):", "It is hoped that the similarity between this set of CUIs and the studies about cardiology will be high, using Gensim\u2019s KeyedVector.n_similarity() on two sets of embedding vectors.", "In some cases it is necessary to require terms from more than one set. For example for the area Infections and Infectious Diseases the first set [\u2018infectious\u2019, \u2018infected\u2019, \u2018infection\u2019] returns concepts related to infections but not necessarily diseases. The following attempt gave better results:", "In other cases some terms matched CUIs from undesired areas. For the Dental and Oral Health area using [\u2018tooth cavit\u2019, \u2018caries\u2019, \u2018cavities\u2019] yielded CUIs from many unwanted fields. See the excluded_terms argument for the set of cavities-related strings that are unrelated to the dental area. The final result below doesn\u2019t seem to have an outlier:", "This is where everything is put together. From the structures constructed so far it is not difficult to use brute force to retain the therapeutic areas that are the most similar to each study using using Gensim\u2019s KeyedVector.n_similarity() between:", "Results can be displayed with this code:", "Here\u2019s an excerpt of typical results for various therapeutic areas. It is truncated due to space restrictions. If this is too small to read on your device the notebook contains many more results to help see them without executing the code (executing the code requires a license from UMLS to download the files which wasn\u2019t difficult and I got warm support from NLM).", "Results are pretty interesting although some studies are misclassified. Usually focusing on misclassifications helps understand which CUI caused (or influenced) the wrong choice.", "When focusing on a misclassification, always look at the second and third therapeutic areas and see how close they are to the first one. For example in the misclassification below, the second (and correct) area Trauma, 0.49841 has a similarity very close to the first (and incorrect) area Urology: 0.50133. This tells us that results are not always that bad and focus should be rather put on worse misclassifications.", "In some cases it might be necessary to manually verify each CUI and remove or add some from the specific therapeutic area or from the study and find the one that causes the mismatch (with the help of gensim\u2019s similarity functions). Then try to infer the interaction of this CUI with others to understand the semantic aspect that causes the disagreement. The notebook includes some misclassifications that deserve investigation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F654af661b949&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----654af661b949--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----654af661b949--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@thierry.herrmann?source=post_page-----654af661b949--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thierry.herrmann?source=post_page-----654af661b949--------------------------------", "anchor_text": "Thierry Herrmann"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F19269ed0087f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&user=Thierry+Herrmann&userId=19269ed0087f&source=post_page-19269ed0087f----654af661b949---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.comprehend.com", "anchor_text": "Comprehend"}, {"url": "https://boards.greenhouse.io/comprehend/jobs/1456548", "anchor_text": "recruiting"}, {"url": "https://clinicaltrials.gov/", "anchor_text": "ClinicalTrials.gov"}, {"url": "https://www.ctti-clinicaltrials.org/", "anchor_text": "CTTI"}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "Jupyter notebook"}, {"url": "https://nlpforhackers.io/word-embeddings/", "anchor_text": "nice introduction"}, {"url": "https://www.nlm.nih.gov/research/umls/", "anchor_text": "Unified Medical Language System"}, {"url": "https://www.nlm.nih.gov/mesh/", "anchor_text": "MeSH"}, {"url": "https://www.nlm.nih.gov/research/umls/new_users/online_learning/UMLST_009.html", "anchor_text": "Rich Release Format (RRF) browser"}, {"url": "http://dl.acm.org/citation.cfm?id=2661974", "anchor_text": "De Vine et al. CIKM '14"}, {"url": "https://github.com/clinicalml/embeddings/blob/master/DeVine_etal_200.txt.gz", "anchor_text": "here"}, {"url": "http://people.csail.mit.edu/dsontag/papers/ChoiChiuSontag_AMIA_CRI16.pdf", "anchor_text": "Learning Low-Dimensional Representations of Medical Concepts"}, {"url": "https://radimrehurek.com/gensim/", "anchor_text": "gensim"}, {"url": "https://www.nlm.nih.gov/mesh/", "anchor_text": "MeSH"}, {"url": "https://aact.ctti-clinicaltrials.org/", "anchor_text": "AACT"}, {"url": "https://www.ctti-clinicaltrials.org/", "anchor_text": "CTTI"}, {"url": "https://clinicaltrials.gov/", "anchor_text": "ClinicalTrials.gov"}, {"url": "https://aact.ctti-clinicaltrials.org/download", "anchor_text": "CTTI download site"}, {"url": "https://www.nlm.nih.gov/research/umls/knowledge_sources/metathesaurus/release/", "anchor_text": "here"}, {"url": "https://www.ncbi.nlm.nih.gov/books/NBK9685/table/ch03.T.concept_names_and_sources_file_mr/?report=objectonly", "anchor_text": "here"}, {"url": "https://radimrehurek.com/gensim/models/keyedvectors.html", "anchor_text": "Gensim"}, {"url": "https://radimrehurek.com/gensim/models/keyedvectors.html", "anchor_text": "Gensim"}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "notebook"}, {"url": "https://github.com/thierryherrmann/simple-machine-learning/blob/master/2018-11-10-studies-therapeutic-areas/studies-therapeutic-areas.ipynb", "anchor_text": "notebook"}, {"url": "https://github.com/clinicalml/embeddings", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----654af661b949---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/word-embeddings?source=post_page-----654af661b949---------------word_embeddings-----------------", "anchor_text": "Word Embeddings"}, {"url": "https://medium.com/tag/clinical-trials?source=post_page-----654af661b949---------------clinical_trials-----------------", "anchor_text": "Clinical Trials"}, {"url": "https://medium.com/tag/nlp?source=post_page-----654af661b949---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----654af661b949---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&user=Thierry+Herrmann&userId=19269ed0087f&source=-----654af661b949---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&user=Thierry+Herrmann&userId=19269ed0087f&source=-----654af661b949---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----654af661b949--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F654af661b949&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----654af661b949---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----654af661b949--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----654af661b949--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----654af661b949--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----654af661b949--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----654af661b949--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----654af661b949--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----654af661b949--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----654af661b949--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thierry.herrmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thierry.herrmann?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thierry Herrmann"}, {"url": "https://medium.com/@thierry.herrmann/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "52 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F19269ed0087f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&user=Thierry+Herrmann&userId=19269ed0087f&source=post_page-19269ed0087f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7b50b470930&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fuse-embeddings-to-predict-therapeutic-area-of-clinical-studies-654af661b949&newsletterV3=19269ed0087f&newsletterV3Id=7b50b470930&user=Thierry+Herrmann&userId=19269ed0087f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}