{"url": "https://towardsdatascience.com/custom-object-detection-using-tensorflow-from-scratch-e61da2e10087", "time": 1682996431.4558022, "path": "towardsdatascience.com/custom-object-detection-using-tensorflow-from-scratch-e61da2e10087/", "webpage": {"metadata": {"title": "Custom Object Detection using TensorFlow from Scratch | by Khush Patel | Towards Data Science", "h1": "Custom Object Detection using TensorFlow from Scratch", "description": "This blog will showcase Object Detection using TensorFlow for Custom Dataset. TensorFlow object detection models like SSD, R-CNN, Faster R-CNN and YOLOv3. Dog detection in real time object detection."}, "outgoing_paragraph_urls": [{"url": "https://brew.sh/", "anchor_text": "here", "paragraph_index": 5}, {"url": "http://google.github.io/proto-lens/installing-protoc.html", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://github.com/hardikvasa/google-images-download", "anchor_text": "google-images-download", "paragraph_index": 18}, {"url": "https://sites.google.com/a/chromium.org/chromedriver/downloads", "anchor_text": "here", "paragraph_index": 19}, {"url": "https://github.com/tzutalin/labelImg", "anchor_text": "labelImg", "paragraph_index": 21}, {"url": "https://gist.github.com/iKhushPatel/ed1f837656b155d9b94d45b42e00f5e4", "anchor_text": "link", "paragraph_index": 31}, {"url": "https://www.skcript.com/svr/why-every-tensorflow-developer-should-know-about-tfrecord/", "anchor_text": "here", "paragraph_index": 32}, {"url": "https://gist.github.com/iKhushPatel/5614a36f26cf6459cc49c8248e8b5b48", "anchor_text": "here", "paragraph_index": 34}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md", "anchor_text": "model zoo", "paragraph_index": 38}, {"url": "http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v2_coco_2018_03_29.tar.gz", "anchor_text": "here", "paragraph_index": 39}, {"url": "https://neptune.ai/", "anchor_text": "https://neptune.ai", "paragraph_index": 56}, {"url": "http://www.khushpatel.com", "anchor_text": "http://www.khushpatel.com", "paragraph_index": 58}], "all_paragraphs": ["In this tutorial, we\u2019re going to get our hands dirty and train our own dog (corgi) detector using a pre-trained SSD MobileNet V2 model.", "Instead of training your own model from scratch, you can build on existing models and fine-tune them for your own purpose without requiring as much computing power.", "Install Tensorflow using the following command:", "If you have a GPU that you can use with Tensorflow:", "$ pip install pillow Cython lxml jupyter matplotlib", "Install protobuf using Homebrew (you can learn more about Homebrew here)", "For protobuf installation on other OS, follow the instructions here.", "In this tutorial, we\u2019re going to use resources in the Tensorflow models repository. Since it does not come with the Tensorflow installation, we need to clone it from their Github repo:", "First change into the Tensorflow directory:", "From this point on, this directory will be referred to as the modelsdirectory", "Every time you start a new terminal window to work with the pre-trained models, it is important to compile Protobuf and change your PYTHONPATH.", "Run the following from your terminal:", "Run a quick test to confirm that the Object Detection API is working properly:", "If the result looks like the following, you\u2019re ready to proceed to the next steps!", "To make this tutorial easier to follow along, create the following folder structure within the models directory you just cloned:", "These folders will be used to store the required components for our model as we proceed.", "You can collect data in either images or video format. Here I mentioned both ways to collect data.", "Data preparation is the most important part of training your own model. Since we\u2019re going to train a corgi detector, we must collect pictures of corgis! About 200 of them would be sufficient.", "I recommend using google-images-download to download images. It searches Google Images and then downloads images based on the inputs you provided. In the inputs, you can specify search parameters such as keywords, number of images, image format, image size, and usage rights.", "Since we\u2019re downloading more than 100 images at a time, we need a chromedriver in the models directory (download here). Once you have the chromedriver ready, you could use this sample command to download images. Make sure all your images are in the jpg format:", "After downloading, save all images to models/images/. To make subsequent processes easier, let's rename the images as numbers (e.g. 1.jpg, 2.jpg) by running the following script:", "Once you\u2019ve collected all the images you need, you need to label them manually. There are many packages that serve this purpose. labelImg is a popular choice.", "labelImg provides a user-friendly GUI. Plus, it saves label files (.xml) in the popular Pascal VOC format. If you want these images for training YOLO(You only Look Once) then use YOLO. Just set the current directory and Save directory as per our structure.", "Here's what a labelled image looks like in labelImg:", "Double check that every image has a corresponding .xml file and save them in models/annotations/xmls/.", "For a large number of annotations, you can use different shortcuts mentioned below:", "Classes need to be listed in the label map. Since we\u2019re only detecting corgis, the label map should contain only one item like the following:", "Note that id must start from 1, because 0 is a reserved id.", "Save this file as label_map.pbtxt in models/annotations/", "trainval.txt is a list of image names without file extensions. Since we have sequential numbers for image names, the list should look like this:", "Save this file as trainval.txt in models/annotations/", "You can use this link to create XML files to CSV. We have all images and their bounding boxes are in XML format. Also all image has separate XML file so using this code we are creating a CSV file which contains all the XML files and their bounding box co-ordinates to single CSV file which is input for creating TFrecords.", "TFRecord is an important data format designed for Tensorflow. (Read more about it here). Before you can train your custom object detector, you must convert your data into the TFRecord format.", "Since we need to train as well as validate our model, the data set will be split into training (train.record) and validation sets (val.record). The purpose of training set is straight forward - it is the set of examples the model learns from. The validation set is a set of examples used DURING TRAINING to iteratively assess model accuracy.", "We\u2019re going to use create_tf_record.py to convert our data set into train.record and val.record. Download here and save it to models/research/object_detection/dataset_tools/.", "Just change the label name in if row_label == \u2018Label1\u2019: as per your classifications.", "This script is preconfigured to do 70\u201330 train-val split. Execute it by running:", "If the script is executed successfully, train.record and val.record should appear in your models/research/ directory. Move them into the models/tf_record/ directory.", "There are many pre-trained object detection models available in the model zoo. In order to train them using our custom data set, the models need to be restored in Tensorflow using their checkpoints (.ckpt files), which are records of previous model states.", "For this tutorial, we\u2019re going to download ssd_mobilenet_v2_coco here and save its model checkpoint files (model.ckpt.meta, model.ckpt.index, model.ckpt.data-00000-of-00001) to our models/checkpoints/ directory.", "Each of the pretrained models has a config file that contains details about the model. To detect our custom class, the config file needs to be modified accordingly.", "The config files are included in the models directory you cloned in the very beginning. You can find them in:", "In our case, we\u2019ll modify the config file for ssd_mobilenet_v2_coco. Make a copy of it first and save it in the models/ directory.", "Here are the items we need to change:", "At this point, your models directory should look like this:", "If you have successfully completed all previous steps, you\u2019re ready to start training!", "Training time varies depending on the computing power of your machine.", "Evaluation can be run in parallel with training. The eval.py script checks the train directory for progress and evaluate the model based on the most recent checkpoint.", "You can visualize model training progress using Tensorboard:", "Based on the graphs output by Tensorboard, you may decide when you want to stop training. Usually, you may stop the process when the loss function is tapering off and no longer decreasing by a significant amount. In my case, I stopped at step 3258.", "Once you finish training your model, you can export your model to be used for inference. If you\u2019ve been following the folder structure, use the following command:", "Now that you have a model, you can use it to detect corgis in pictures and videos! For the purpose of demonstration, we\u2019re going to detect corgis in an image. Before you proceed, pick an image you want to test the model with.", "The models directory came with a notebook file (.ipynb) that we can use to get inference with a few tweaks. It is located at models/research/object_detection/object_detection_tutorial.ipynb. Follow the steps below to tweak the notebook:", "After following through the steps, run the notebook and you should see the corgi in your test image highlighted by a bounding box!", "There you have your custom corgi detector!", "You might wondering after training you very first model that I wanted to improve my model and track the details of my experiments, what is good tool?", "Then you can checkout https://neptune.ai which provides clear and concise model tracking. You can track all the hyper-parameters and save the model in model registry and compare your model real time. Neptune supports Log, store, query, display, organize, and compare all your model metadata in a single place. For more info you can refer the below blog to train object detection model.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "ML Engineer / Data Scientist | Master\u2019s in AI | DL & CV Nanodegree Holder | Facebook AI Scholar | Inventor | Int\u2019l Medal Winner@USA | http://www.khushpatel.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe61da2e10087&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://ikhushpatel.medium.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": ""}, {"url": "https://ikhushpatel.medium.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Khush Patel"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe6bf5eabb8e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&user=Khush+Patel&userId=e6bf5eabb8e3&source=post_page-e6bf5eabb8e3----e61da2e10087---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/towards-data-science/inside-ai/home", "anchor_text": "Inside AI"}, {"url": "https://github.com/bourdakos1/Custom-Object-Detection", "anchor_text": "https://github.com/bourdakos1/Custom-Object-Detection"}, {"url": "https://brew.sh/", "anchor_text": "here"}, {"url": "http://google.github.io/proto-lens/installing-protoc.html", "anchor_text": "here"}, {"url": "https://github.com/tensorflow/models.git", "anchor_text": "https://github.com/tensorflow/models.git"}, {"url": "https://github.com/hardikvasa/google-images-download", "anchor_text": "google-images-download"}, {"url": "https://sites.google.com/a/chromium.org/chromedriver/downloads", "anchor_text": "here"}, {"url": "https://medium.com/@iKhushPatel/convert-video-to-images-images-to-video-using-opencv-python-db27a128a481", "anchor_text": "Convert Video to Images & Images to Video using OpenCV (Python)Generate Images (Frames) from Video and Video from Images (Frames) using OpenCV library in Pythonmedium.com"}, {"url": "https://github.com/tzutalin/labelImg", "anchor_text": "labelImg"}, {"url": "https://gist.github.com/iKhushPatel/ed1f837656b155d9b94d45b42e00f5e4", "anchor_text": "link"}, {"url": "https://www.skcript.com/svr/why-every-tensorflow-developer-should-know-about-tfrecord/", "anchor_text": "here"}, {"url": "https://gist.github.com/iKhushPatel/5614a36f26cf6459cc49c8248e8b5b48", "anchor_text": "here"}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md", "anchor_text": "model zoo"}, {"url": "http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v2_coco_2018_03_29.tar.gz", "anchor_text": "here"}, {"url": "https://neptune.ai/", "anchor_text": "https://neptune.ai"}, {"url": "https://neptune.ai/blog/tensorflow-object-detection-api-best-practices-to-training-evaluation-deployment", "anchor_text": "https://neptune.ai/blog/tensorflow-object-detection-api-best-practices-to-training-evaluation-deployment"}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection/g3doc", "anchor_text": "Tensorflow Object Detection Model Documentation"}, {"url": "http://khushpatel.com/", "anchor_text": "http://www.khushpatel.com"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----e61da2e10087---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e61da2e10087---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e61da2e10087---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----e61da2e10087---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----e61da2e10087---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&user=Khush+Patel&userId=e6bf5eabb8e3&source=-----e61da2e10087---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&user=Khush+Patel&userId=e6bf5eabb8e3&source=-----e61da2e10087---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe61da2e10087&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e61da2e10087---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e61da2e10087--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e61da2e10087--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e61da2e10087--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e61da2e10087--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e61da2e10087--------------------------------", "anchor_text": ""}, {"url": "https://ikhushpatel.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://ikhushpatel.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Khush Patel"}, {"url": "https://ikhushpatel.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "316 Followers"}, {"url": "http://www.khushpatel.com", "anchor_text": "http://www.khushpatel.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe6bf5eabb8e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&user=Khush+Patel&userId=e6bf5eabb8e3&source=post_page-e6bf5eabb8e3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6fcd0f51883a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-object-detection-using-tensorflow-from-scratch-e61da2e10087&newsletterV3=e6bf5eabb8e3&newsletterV3Id=6fcd0f51883a&user=Khush+Patel&userId=e6bf5eabb8e3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}