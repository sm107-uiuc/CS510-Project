{"url": "https://towardsdatascience.com/how-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de", "time": 1683007733.1849449, "path": "towardsdatascience.com/how-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de/", "webpage": {"metadata": {"title": "How to use Dynamic SQL in BigQuery | by Lak Lakshmanan | Towards Data Science", "h1": "How to use Dynamic SQL in BigQuery", "description": "Let\u2019s say that we want to find the number of confirmed COVID cases over the past 3 days in various Canadian provinces. There is a BigQuery public dataset with information published by Johns Hopkins\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/string_functions#format_string", "anchor_text": "string format function", "paragraph_index": 5}, {"url": "https://groups.google.com/g/bigquery-discuss/c/vQ96W1HZFj4", "anchor_text": "very first user", "paragraph_index": 15}, {"url": "https://medium.com/u/279fe54c149a?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Felipe Hoffa", "paragraph_index": 16}, {"url": "https://medium.com/u/ac51b9da0e54?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Jagan R. Athreya", "paragraph_index": 17}, {"url": "https://medium.com/u/279fe54c149a?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Felipe Hoffa", "paragraph_index": 17}], "all_paragraphs": ["Let\u2019s say that we want to find the number of confirmed COVID cases over the past 3 days in various Canadian provinces. There is a BigQuery public dataset with information published by Johns Hopkins, and we can query it as follows:", "Yikes! There is a column for every date. How do we find the last three days for which there is data?", "We can use INFORMATION_SCHEMA to get the list of columns and find the last three days using:", "You can run a dynamic SQL statement using EXECUTE IMMEDIATE. For example, suppose we have a variable with the column name _5_18_20, this is how to use it to execute a SELECT statement:", "Look carefully at the query above. First of all, because I\u2019m declaring a variable, etc., this is a BigQuery script where each statement ends with a semicolon.", "I am then using BigQuery\u2019s string format function to create the statement I want to run. Because I am passing in a string, I specify %s in the format string and pass in col_0.", "The result consists of two stages:", "with the result of the second stage being:", "We can combine the above three ideas \u2014 INFORMATION_SCHEMA, scripting, and EXECUTE IMMEDIATE to get the data for the past 3 days.", "Instead of using String format, you can do named variables as follows:", "You can also do positional variables using question marks:", "The USING clause is tricky in some situations. For example, the following doesn\u2019t work:", "That\u2019s because the first parameter gets interpreted as:", "So, you can\u2019t pass in a column name through USING. Hence, I recommend using String FORMAT() to create the query to execute immediately because it doesn\u2019t have these problems.", "The Dynamic SQL feature was released on BigQuery\u2019s 10th birthday. Here\u2019s a video featuring some BigQuery friends wishing it a happy birthday:", "The very first user thread from 10 years ago raves about processing 60B records in a few seconds and muses about near-real-time queries (the more things change \u2026). In that same thread is the first feature request \u2026 for pivots:", "Dynamic SQL finally makes this possible and Felipe Hoffa has promised he\u2019ll write a function to finally be able to PIVOT() inside BigQuery - stay tuned.", "Thanks to my colleague Jagan R. Athreya for useful discussions on USING and the suggestion to use FORMAT and to Felipe Hoffa for the walk down nostalgia lane.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "articles are personal observations and not investment advice."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8c04dcc0f0de&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://lakshmanok.medium.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6----8c04dcc0f0de---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/44833-44833/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=166539", "anchor_text": "Jim Semonik"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=166539", "anchor_text": "Pixabay"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/string_functions#format_string", "anchor_text": "string format function"}, {"url": "http://twitter.com/country", "anchor_text": "@country"}, {"url": "https://groups.google.com/g/bigquery-discuss/c/vQ96W1HZFj4", "anchor_text": "very first user"}, {"url": "https://medium.com/u/279fe54c149a?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Felipe Hoffa"}, {"url": "https://medium.com/u/ac51b9da0e54?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Jagan R. Athreya"}, {"url": "https://medium.com/u/279fe54c149a?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Felipe Hoffa"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----8c04dcc0f0de---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/dynamic-sql?source=post_page-----8c04dcc0f0de---------------dynamic_sql-----------------", "anchor_text": "Dynamic Sql"}, {"url": "https://medium.com/tag/sql?source=post_page-----8c04dcc0f0de---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----8c04dcc0f0de---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&user=Lak+Lakshmanan&userId=247b0630b5d6&source=-----8c04dcc0f0de---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8c04dcc0f0de&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8c04dcc0f0de---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8c04dcc0f0de--------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://lakshmanok.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Lak Lakshmanan"}, {"url": "https://lakshmanok.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F247b0630b5d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&user=Lak+Lakshmanan&userId=247b0630b5d6&source=post_page-247b0630b5d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F44e3f26acd1a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-dynamic-sql-in-bigquery-8c04dcc0f0de&newsletterV3=247b0630b5d6&newsletterV3Id=44e3f26acd1a&user=Lak+Lakshmanan&userId=247b0630b5d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}