{"url": "https://towardsdatascience.com/the-travelling-apothecary-baae49d27c17", "time": 1683017583.092274, "path": "towardsdatascience.com/the-travelling-apothecary-baae49d27c17/", "webpage": {"metadata": {"title": "The Travelling Apothecary. A discrete optimization approach to\u2026 | by Nathan Pratt | Towards Data Science", "h1": "The Travelling Apothecary", "description": "A discrete optimization of Skyrim's alchemy system using R and a graph data structure. Combinatorics | Discrete Optimization | R"}, "outgoing_paragraph_urls": [{"url": "https://skyrimforums.org/sf/threads/discover-all-ingredient-effects-by-brewing-56-potions.18638/", "anchor_text": "This forum post", "paragraph_index": 4}, {"url": "https://elderscrolls.fandom.com/wiki/Ingredients_(Skyrim)", "anchor_text": "a fan-based wiki", "paragraph_index": 10}, {"url": "https://www.linkedin.com/in/nathan-a-pratt/", "anchor_text": "https://www.linkedin.com/in/nathan-a-pratt/", "paragraph_index": 57}], "all_paragraphs": ["Whether you are replaying the game for the 5th time or on your 15th character (unable to remember what you were doing with the other 14 saves when you last had free time), Skyrim still holds a warm spot in the hearts of many players. For me, this replayability does not extend to the alchemy system within Skyrim. Nearly a year ago, I had some free time over the holidays and was starting up another character. I was trying to find a way to avoid the grind of unlocking ingredient effects when I recognized this could be represented as an optimization problem.", "I would like to share with you the premise behind this problem and the approach with explanations (written in R).", "Skyrim is a role-playing game set in a medieval fantasy world. There are several mechanics the player can master within the game. These include archery, swordsmanship, blacksmithing, magic, and alchemy among others. Alchemy, in particular, involves collecting 111 different ingredients (from the wild, purchasing from shops, or occasionally finding them as loot from fallen foes).", "A player on his first playthrough will begin by randomly testing hundreds of ingredient combinations that will often fail to produce viable potions. By the end of their playthrough, most will eventually go to a wiki site and look up the effects of unknown ingredients. Others will invest some points into the Experimenter perk and eat any ingredient they see with unknown effects.", "On subsequent playthroughs, many players will open up the console and cheat in the Experimenter perk early or go to online forums for an optimal route to unlocking effects. This forum post is the most well done of these posts that I have seen, but unfortunately, it only contains ingredients from the base game (none from the additions to the game). For reference, the recommendations by the players on this board consist of 74 potions to unlock the effects for the 90 ingredients in the base game. The slower of the two algorithms mentioned in this article can unlock all these effects using only 67 potions. Unfortunately, the faster of the algorithms uses 82 potions due to it currently leaving isolated pockets of unknown effects (This will be discussed in the Testing section of the article).", "When effects are known, you can easily filter by which effects you want and choose ingredients accordingly within Skyrim\u2019s own crafting system (at the alchemy table). For this reason, revealing the effects the first time will subsequently provide a great deal of convenience for players.", "Since I am not willing to level up to 90 in Alchemy before unlocking these ingredient effects, we will attempt to unlock effects by creating potions using the fewest number of ingredients.", "We will be setting up this data in a directed graph where each ingredient connects to its associated effects.", "I will assume you have some familiarity with R and the libraries I will be using. I will provide explanations/comments that should provide sufficient context if you aren\u2019t familiar with any particular library.", "The following libraries will be used (links lead to cran for each)", "We will be scraping the data from a fan-based wiki using the following code:", "This data frame should look like the following:", "We now must decide how to represent this data to most efficiently use it for this optimization problem. I have chosen a fairly simple graph representation where the nodes consist of the ingredients and effects and the edges represent connections from ingredients to their effects. (One important point to note, I am adding in a property count which we will discuss later)", "The following code will set up this data in an igraph object for use in our functions:", "Notice that this creates a graph where every node has the following properties:", "Also, every edge contains a boolean property Known, which represents whether or not that ingredient-effect relationship is unlocked by the player. Accessed via E(alchemyGraph)$Known", "The resulting graph contains 111 ingredients, 55 effects, and 444 edges. For a sense of scale, it can be visualized using the following:", "Below we will define several utility functions. Error handling is included for some. My apologies for the length of this section and congrats if you can follow them all. Feel free to use the table of contents if you would like to skip this part.", "First, we will define a few functions that will get ingredients and their effects back out of the graph.", "Next, we will define functions to set/get the ingredient count as well as set the Known property of ingredient-effect edges.", "Next will be functions for calculating the effects present in a potion given the ingredients used and another to calculate the number of ingredient-effects unlocked if the supplied ingredients were used. We will also add a function to simulate creating a potion using a given graph as well as one to evaluate the number of ingredients a series of potions reveals.", "Now a couple of functions that are a little more abstract and will be used to get all possible combinations of a given set of ingredients for use in the main function. (The expand grid function is a modification of one found on stack overflow. The original function is linked in the comments)", "I went through 5 alternative versions of the algorithm to attempt to gain processing efficiency without sacrificing results. One of which pre-loaded the graph with all potential potion combinations and connected those potions to a single root node for searching (root > potion > ingredients > effects). The following two algorithms keep the same graph structure defined above and show minor tradeoffs in terms of speed and efficiency. In a Gremlin graph database, there are a few traversal strategies that could make this easier than when done in R.", "I mentioned I would explain the need for the Count property. The simplest approach would assume that we have all the ingredients and I want to know the fewest potions I should make to unlock all ingredient effects (With this algorithm that answer is 78). With the Count property, we can use subgraphs to only calculate for those ingredients we currently have in our inventory. This makes the solution much more dynamic and useful to the adventurer who wants to be an apothecary but hasn\u2019t found the rarest of ingredients yet.", "The function recommendPotionForEffectReveal() will serve as the primary logic for the optimization. This function will take a graph in the form of alchemyGraph above, and return a vector (length 2 or 3) of the ingredients to use to make the next potion. This recommended potion should be the one that will reveal the highest number of unknown ingredient-effect edges with a secondary priority of fewest ingredients. Other factors we could also prioritize are cost/rarity of ingredient (not included in this algorithm) and quantity of ingredients (showing a preference for unlocking more effects for the ingredient we have fewer of)", "We will cover this function step by step. Before we begin, let\u2019s look at a simple subgraph consisting of only 4 ingredients", "Next, we\u2019ll showcase known/unknown edges by using a dotted line for unknown ingredient effects. Also, you\u2019ll note that this graph has effects with only one edge. This would not happen in the original graph. For now, we will mark those edges as known to ignore them.", "In the first phase of the algorithm we will create the following subgraphs:", "Next, we will determine the ingredient to start from by finding the ingredient with the highest degree in sgUnknown (Ingredient with most unknown effects)", "In this case, we will be starting from \u201cBear Claws\u201d. Which has 4 unknown effects (tied with \u201cHanging Moss\u201d) as seen in the depiction of sgUnknown above. Next, we will perform a breadth-first search (bfs)from Bear Claws and get all neighboring ingredients (Those that are 2 steps away in bfs).", "For this version of the algorithm, we need to consider any potentially relevant potion combinations. This will be broken up into 3 parts:", "Unfortunately, this process in its current form can produce duplicates, so those will need to be cleaned up before checking the resulting potions.", "This results in 6 combinations of the ingredients representing 6 different potions. In this simple subgraph, we are using all 4 ingredients, but, in the full graph, this can greatly reduce the number of combinations that need to be checked.", "At this point, if the length of potionCombinations was 0, we would exit the function (returning NA).", "Next, we will get some metadata for each of the potion combinations. We will check the following:", "Using this information we will prioritize revealing the highest number of effects, showing preference to potions that use 2 ingredients rather than 3, and using potions that use the most ingredients that only have 1 in the inventory (Rationale for this is to assume that the potion using that ingredient is revealing more effects now than if it were used after further iterations).", "And based on this we will be making a potion with Bear Claws, Eye of Sabre Cat, and Hanging Moss.", "Putting this all together we have the following function:", "We will now call this in a loop until no more potions are returned.", "The second approach is much more efficient (in terms of processing time) in a graph with many unknown edges. This approach uses similarity scores of the ingredients (scoring based on the number of shared neighbors vs the number of total edges). Using a rare spark of inspiration, we will call this function recommendPotionForEffectReveal2.", "The second approach starts out much the same. We do add an additional subgraph (sgKnown) which shows only the known edges. We also calculate the similarity scores of all the Ingredient vertices left in sg.", "If there are any similarity scores greater than 0, we can use this matrix to identify the first two ingredients of our potion.", "We then look at any other ingredients that share the highest similarity with ingredient 1 or 2. In this function, if there are any similarity scores greater than 0 among the remaining ingredients, we will select whichever is highest and any ties will go to matching with ingredient 1.", "The more complex part of this function comes in the else block. This block is checking for any unknown edges between any of these ingredient pairs where one ingredient knows the effect, but the other does not (These would not show up in this similarity matrix as these were based on sgUnknown).", "If the similarityMatrix did not have any values above 0, it would imply that no two ingredients shared the same unknown effect (One might know the effect, but we won\u2019t see it in sgUnknown). When this case occurs, we will simply call the original function from approach 1. (To test the speed of this algorithm and exit early when this condition is met, you can simply return NA here. When testing on a full graph with all unknown edges the return time was ~20 seconds and only 24 edges remained unknown.) The final function and the looping function are below.", "We will set up two versions of the graph for testing.", "Now we will perform 4 runs, one for each graph and algorithm.", "You can see that in each case, the second function is much faster. Regarding potion/ingredient efficiency:", "Based on the above, the second algorithm performs fairly well for the increase in speed. The inefficiencies found in function 2 could be a result of it leaving small outliers when optimizing for the highest number of effect reveals. Potentially, tweaking the portion of the algorithm that determines the third ingredient (if one is used) could cause this function to leave fewer unknown edges stranded.", "As a visual aid, below are some gifs showing the graph as each algorithm processes it. For reference:", "alchemyGraph_Full using Approach 1: 444/444 effects revealed, 78 potions, most revealed with a single potion is 12. (run1)", "alchemyGraph_Full using Approach 2: 444/444 effects revealed, 90 potions, most revealed with a single potion is 12. (run3)", "alchemyGraph_Partial using Approach 1: 157/222 effects revealed, 41 potions, most revealed with a single potion is 8. (run2)", "alchemyGraph_Partial using Approach 2: 153/222 effects revealed, 48 potions, most revealed with a single potion is 8. (run4)", "These algorithms don\u2019t always find the single most optimal mix of ingredients, but they do a decent job without sacrificing too much in terms of time and they do so while dynamically keeping the player\u2019s own inventory and known/unknown effects in mind.", "I\u2019m hoping you enjoyed this guided example and it has given some of you inspiration to apply what you\u2019ve been learning to unconventional problems. Any feedback is always appreciated.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Former Nurse of 8 years and now Data Engineer with a love of graph structures and algorithms. | https://www.linkedin.com/in/nathan-a-pratt/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbaae49d27c17&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----baae49d27c17--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@napratt91?source=post_page-----baae49d27c17--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@napratt91?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Nathan Pratt"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1b7439a97bc0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&user=Nathan+Pratt&userId=1b7439a97bc0&source=post_page-1b7439a97bc0----baae49d27c17---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.linkedin.com/in/joshua-littles-15a5651bb/", "anchor_text": "Joshua Littles"}, {"url": "https://towardsdatascience.com/tagged/hands-on-tutorials", "anchor_text": "Hands-on Tutorials"}, {"url": "https://skyrim.gamepedia.com/Experimenter", "anchor_text": "Experimenter"}, {"url": "https://skyrimforums.org/sf/threads/discover-all-ingredient-effects-by-brewing-56-potions.18638/", "anchor_text": "This forum post"}, {"url": "https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html", "anchor_text": "stringr"}, {"url": "https://cran.r-project.org/web/packages/rvest/rvest.pdf", "anchor_text": "rvest"}, {"url": "https://cran.r-project.org/web/packages/igraph/index.html", "anchor_text": "igraph"}, {"url": "https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html", "anchor_text": "dplyr"}, {"url": "https://cran.r-project.org/web/packages/tidyr/tidyr.pdf", "anchor_text": "tidyr"}, {"url": "https://elderscrolls.fandom.com/wiki/Ingredients_(Skyrim)", "anchor_text": "a fan-based wiki"}, {"url": "https://medium.com/tag/optimization-algorithms?source=post_page-----baae49d27c17---------------optimization_algorithms-----------------", "anchor_text": "Optimization Algorithms"}, {"url": "https://medium.com/tag/graph?source=post_page-----baae49d27c17---------------graph-----------------", "anchor_text": "Graph"}, {"url": "https://medium.com/tag/data-science?source=post_page-----baae49d27c17---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----baae49d27c17---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/tag/hands-on-tutorials?source=post_page-----baae49d27c17---------------hands_on_tutorials-----------------", "anchor_text": "Hands On Tutorials"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&user=Nathan+Pratt&userId=1b7439a97bc0&source=-----baae49d27c17---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&user=Nathan+Pratt&userId=1b7439a97bc0&source=-----baae49d27c17---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbaae49d27c17&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----baae49d27c17---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----baae49d27c17--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----baae49d27c17--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----baae49d27c17--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----baae49d27c17--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----baae49d27c17--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@napratt91?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@napratt91?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nathan Pratt"}, {"url": "https://medium.com/@napratt91/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "19 Followers"}, {"url": "https://www.linkedin.com/in/nathan-a-pratt/", "anchor_text": "https://www.linkedin.com/in/nathan-a-pratt/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1b7439a97bc0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&user=Nathan+Pratt&userId=1b7439a97bc0&source=post_page-1b7439a97bc0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Faf55ba075e6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-travelling-apothecary-baae49d27c17&newsletterV3=1b7439a97bc0&newsletterV3Id=af55ba075e6e&user=Nathan+Pratt&userId=1b7439a97bc0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}