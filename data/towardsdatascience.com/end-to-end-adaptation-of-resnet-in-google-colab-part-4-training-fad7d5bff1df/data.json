{"url": "https://towardsdatascience.com/end-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df", "time": 1683015975.165612, "path": "towardsdatascience.com/end-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df/", "webpage": {"metadata": {"title": "End to End Adaptation of ResNet in Google Colab \u2014 Part 4: Training | by Dev Dash MD MPH | Towards Data Science", "h1": "End to End Adaptation of ResNet in Google Colab \u2014 Part 4: Training", "description": "Now we have to tackle the meat of the entire project and everything that came before this was set up to allow for training to happen seamlessly \u2014 downloading the dataset, formatting everything for\u2026"}, "outgoing_paragraph_urls": [{"url": "https://pytorch.org/tutorials/beginner/deep_learning_60min_blitz.html", "anchor_text": "Deep Learning with Pytorch", "paragraph_index": 26}, {"url": "https://pytorch.org/tutorials/beginner/blitz/neural_networks_tutorial.html", "anchor_text": "Neural Networks with Pytorch.", "paragraph_index": 27}, {"url": "https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html", "anchor_text": "Transfer Learning for Computer Vision.", "paragraph_index": 28}], "all_paragraphs": ["Now we have to tackle the meat of the entire project and everything that came before this was set up to allow for training to happen seamlessly \u2014 downloading the dataset, formatting everything for entry into the network, using creating data transforms for image manipulation and creating dataloaders that help insert the images in a structured way.", "If you are just joining, I\u2019ve made a colab notebook that lets you run the entire code (one click) and in the end, allows you upload a picture for testing. This particular dataset and network is designed to differentiate between dogs and cats \u2014 but you can upload whatever picture you want to generate an output.", "It is actually pretty instructive to do so, especially for any future work you may want to do. Knowing the underlying data, its issues and biases is critical to interpreting the results. Every dataset has bias and is imperfect, which doesn\u2019t necessarily imply that it\u2019s useless.", "Here are links to the previous parts:", "Let\u2019s first unpack what\u2019s going on in train_model below:", "I pasted the entire function above just to get an overview of how \u2018large\u2019 it is, but this will be broken down in parts:", "Epoch \u2014 one complete presentation of the underlying data to the model (er, architecture, as I told myself I would say).", "Training Phase \u2014 If you\u2019ll recall, we used a ratio of 75/25 (80/20 and 70/30 is also common), in that we split the dataset, randomly, assigning 75% into the training set and 25% into the validation set. Doing so randomly is important because if you had all the pictures in order, you might end up over-representing dogs or cats in the training phase if its not randomized (and as a result, the architecture would better \u2018trained\u2019 on one animal vs the other).", "Validation Phase \u2014 The 25% that we assigned into the validation set should not be used for training. This is your best way of showing new data to the network to see if it has learned well. Like teaching a child addition, you wouldn\u2019t want to present the same exact problem but a similar one to see if the child learned to add.", "Optimizer Zero Grad \u2014 This isn\u2019t a \u2018vocabulary\u2019 term per se but important to know. When the gradients are generated in a mini batch, they will continue to propagate through (which you do not want per training cycle; you want to start fresh). The zero_grad function enables you to start fresh for each minibatch to calculate gradients.", "Most of the heavy lifting is done here:", "The first if/else statement sets the model to train or evaluation mode (pytorch feature). By default, models are in train mode. Interestingly enough, this convention doesn\u2019t matter too much if you are not using dropout layers or batch normalization but having this convention is important for future proofing your code (and how you approach pytorch).", "You then iterate over the data using the dataloaders and use the \u201cinputs.to(device)\u201d and \u201clabels.to(device)\u201d lines to load the code into the GPU. We discussed the ability to use high end GPUs through Colab earlier.", "With torch.set_grad_enabled(phase == \u2018train\u2019) \u2014 the parentheses being true only if the phase is indeed in training mode, you allow for calculation of the gradients during training mode and loss.backward (again, during training), will calculation the gradients, and optimizer.step updates all the gradients with the recent calculation.", "Now, if the phase is NOT train, then set_grad_enabled becomes False, gradients are not calculated and nothing is updated. The model only evaluates the inputted images (which is what you want in training).", "The \u2018scheduler.step()\u2019 is a tiny line but critical to obtaining lower error rates. Changing the learning rate is critical to hyperparameter tuning. You want large learning rates, in the beginning, to be efficient and as the training proceeds, you want to decrease the learning rate. Imagine trying to find the lowest point in a field. You want large steps initially so you don\u2019t miss any valleys and are not stuck in a small corner of your map. But as you find valleys, you don\u2019t want to be bouncing off the sides of the wall of the valley because your steps are large. Making your steps (here, learning rate) smaller will allow you to more efficiently find the lowest point.", "Finally, the accuracies are calculated and if the epoch of this particular accuracy is better than the best accuracy (initially set to 0), the best_acc variable is updated and the model weights are updated as well and the whole process repeats.", "True to the namesake, we are using a Resnet18 model. The fully connected layer (model_ft.fc) has two final outputs (cat vs dog). We then load the model onto the GPU and define the loss function as CrossEntropyLoss.", "Discussion of this loss function is beyond an introductory series but suffice it to say, it is very commonly used for classification (not regression) models, and well covered by many other posts and videos.", "The optimizer function (SGD \u2014 stochastic gradient descent) is also something I encourage you to read (or watch youtube videos) about.", "Finally the learning rate scheduler \u2014 as discussed above, we want to learning rate to get smaller as the epoch # gets larger, to allow for better fine tuning of the architecture (weights) and a lower loss.", "Finally, we put all of it together and let it run:", "I recommend you do at least 5-10 epochs to convince yourself there is a stopping point that makes sense, and iterating over a hundred epochs has profoundly diminishing gains.", "If you are reading the above and find it to be simplistic, I applaud you for being lightyears ahead of me. However, if there is some part above that doesn\u2019t make sense, please leave a comment and I will connect you to an appropriate resource.", "The goal of this series is not a deep dive into neural networks \u2014 I am not qualified to do that. The goal is to convince you that this architecture is accessible to you, you can run it on high end compute and upload your own image for testing in the end \u2014 and I have followed this up with an overview of what\u2019s going on under the hood.", "Next time \u2014 uploading a picture and the gritty details surrounding that.", "[1] Deep Learning with Pytorch, Accessed October 2020", "[2] Neural Networks with Pytorch. Accessed October 2020", "[3] Transfer Learning for Computer Vision. Accessed October 2020", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffad7d5bff1df&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://piotrr.medium.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": ""}, {"url": "https://piotrr.medium.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Dev Dash MD MPH"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F21d76fb2c1a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&user=Dev+Dash+MD+MPH&userId=21d76fb2c1a9&source=post_page-21d76fb2c1a9----fad7d5bff1df---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/end2end", "anchor_text": "End to End ResNet"}, {"url": "https://unsplash.com/photos/rD2dc_2S3i0", "anchor_text": "Source"}, {"url": "https://towardsdatascience.com/end-to-end-adaptation-of-resnet-in-google-colab-part-1-5e56fce934a6", "anchor_text": "End to End Adaptation of ResNet in Google Colab \u2014 Part 1Train a deep neural network with only a few clickstowardsdatascience.com"}, {"url": "https://towardsdatascience.com/end-to-end-adaptation-of-resnet-in-google-colab-part-2-hardware-dataset-setup-f23dd4e0004d", "anchor_text": "End to End Adaptation of ResNet in Google Colab \u2014 Part 2: Hardware & Dataset SetupEvaluating your hardware \u2014 CPU and GPU, and setting up your datasettowardsdatascience.com"}, {"url": "https://towardsdatascience.com/end-to-end-adaptation-of-resnet-in-google-colab-part-3-image-pre-processing-fe30917d9aa2", "anchor_text": "End to End Adaptation of ResNet in Google Colab \u2014 Part 3: Image Pre-ProcessingGetting the dataset ready for trainingtowardsdatascience.com"}, {"url": "https://pytorch.org/tutorials/beginner/deep_learning_60min_blitz.html", "anchor_text": "Deep Learning with Pytorch"}, {"url": "https://pytorch.org/tutorials/beginner/blitz/neural_networks_tutorial.html", "anchor_text": "Neural Networks with Pytorch."}, {"url": "https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html", "anchor_text": "Transfer Learning for Computer Vision."}, {"url": "https://github.com/Kaggle/kaggle-api", "anchor_text": "Kaggle API."}, {"url": "https://medium.com/tag/pytorch?source=post_page-----fad7d5bff1df---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/resnet?source=post_page-----fad7d5bff1df---------------resnet-----------------", "anchor_text": "Resnet"}, {"url": "https://medium.com/tag/google-colab?source=post_page-----fad7d5bff1df---------------google_colab-----------------", "anchor_text": "Google Colab"}, {"url": "https://medium.com/tag/cnn?source=post_page-----fad7d5bff1df---------------cnn-----------------", "anchor_text": "Cnn"}, {"url": "https://medium.com/tag/end2end?source=post_page-----fad7d5bff1df---------------end2end-----------------", "anchor_text": "End2end"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&user=Dev+Dash+MD+MPH&userId=21d76fb2c1a9&source=-----fad7d5bff1df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&user=Dev+Dash+MD+MPH&userId=21d76fb2c1a9&source=-----fad7d5bff1df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffad7d5bff1df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fad7d5bff1df---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fad7d5bff1df--------------------------------", "anchor_text": ""}, {"url": "https://piotrr.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://piotrr.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dev Dash MD MPH"}, {"url": "https://piotrr.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "22 Followers"}, {"url": "https://www.linkedin.com/in/dev-dash-6b6834173/", "anchor_text": "https://www.linkedin.com/in/dev-dash-6b6834173/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F21d76fb2c1a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&user=Dev+Dash+MD+MPH&userId=21d76fb2c1a9&source=post_page-21d76fb2c1a9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F78b6f9b4cc46&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fend-to-end-adaptation-of-resnet-in-google-colab-part-4-training-fad7d5bff1df&newsletterV3=21d76fb2c1a9&newsletterV3Id=78b6f9b4cc46&user=Dev+Dash+MD+MPH&userId=21d76fb2c1a9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}