{"url": "https://towardsdatascience.com/parking-spot-detection-using-mask-rcnn-cb2db74a0ff5", "time": 1683004619.57802, "path": "towardsdatascience.com/parking-spot-detection-using-mask-rcnn-cb2db74a0ff5/", "webpage": {"metadata": {"title": "Parking spot detection using Mask-RCNN | by Angela Kunanbaeva | Towards Data Science", "h1": "Parking spot detection using Mask-RCNN", "description": "I have recently worked on a project to detect whether the parking spot is available or occupied based on security view camera photos. There are limitations to my work which I will go into more detail\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/blanderbuss/parking-lot-dataset", "anchor_text": "dataset", "paragraph_index": 1}, {"url": "https://github.com/matterport/Mask_RCNN", "anchor_text": "link.", "paragraph_index": 1}, {"url": "https://pjreddie.com/darknet/yolo/", "anchor_text": "link", "paragraph_index": 3}, {"url": "https://machinelearningmastery.com/how-to-train-an-object-detection-model-with-keras/", "anchor_text": "here", "paragraph_index": 10}], "all_paragraphs": ["I have recently worked on a project to detect whether the parking spot is available or occupied based on security view camera photos. There are limitations to my work which I will go into more detail further, but once these are resolved this project may be a low-cost solution to optimize parking availability. There\u2019s certainly a potential in this project to simplify the process of finding a parking spot in a given area since most of the parking lots have security cameras placed and this way the parking lots won\u2019t need any additional equipment being installed.", "Let me elaborate on the resources that I used for this project. There\u2019s a Parking Lot dataset available on Kaggle that has enough data points for training a deep learning model and xml files with annotations whether the spot has been occupied or not. You can access the dataset here parking lot dataset. For the model, I used state-of-the-art object detection and segmentation Mask-RCNN model which performs amazingly and can be accessed via this link.", "As you can see Mask-RCNN out-of-the-box pre-trained on COCOdataset model does an excellent job at object detection and segmentation. Although in some cases it misclassifies cars for train and truck.", "On a side note, I also tried YOLO-v3 which performed identically so I didn\u2019t go in further with YOLO model but if you\u2019re looking for alternative YOLO is an awesome model for object detection, here\u2019s the link.", "At first I used Mask-RCNN model to detect the cars on the parking spot, and given the number of spots available calculate the empty slots. We don\u2019t need all COCO classes for our model, so I limited the clasess to cars, trucks, and motorcycles. But the pre-trained on COCOdataset model doesn\u2019t do an excellent job in detecting small objects even though I tried tweaking the threshold and bounding boxes and those cars that are being misclassified as trains are not detected. Here the bounding boxes are drawn instead of masks that are provided with model\u2019s visualize method.", "Given the above performance I decided to train the top layer of the COCO model not only to transfer knowledge from the pre-trained model but also to improve the predictions based on our dataset, so that we\u2019ll have two classes to predict whether the spot is occupied or empty.", "The constraints of this parking lot dataset are such that the photos are taken from two perspectives only which leads to overfitting issues with training the model and do not allow to generalize better. Secondly, the annotations of each parking spot are not complete and thus raise exceptions during training, furthermore not all parking spots available on the photo are annotated which also leads to poorer performance of the model. I\u2019ll show you what I mean, the photo below just shows how many parking spots are annotated:", "Many xml files didn\u2019t have occupied class filled in:", "And the number of parking spaces with missing info can rise to around 10\u201315 spaces. I thought this could be fixed manually, but after running some code:", "There are far too many files to be fixed and for purposes of training only the top layer of the model, it\u2019s easier to avoid these files. For parsing an xml file I used XML.etree.ElementTree built-in python package. It is worth noting also, that coordinates of the bounding boxes are given at an angle with a center point, so some adjustments to parsing and creating bounding boxes are essential if we want to do it properly.", "Since Mask-RCNN uses masks for training the classes, in a similar fashion to Kangaroo Detection article, that can be accessed here, I used bounding boxes to create masks. This article actually helped me a lot in understanding how to use Mask-RCNN model and Machine Learning Mastery in general is a great resource for many machine learning applications. So check it out, if you haven\u2019t yet. The main difference is that we going to have 2 classes detected instead of one and thus create masks based on the occupied classification, and also how the bounding boxes are calculated.", "As for the dataset organization, we have to create two directories for train and test data, each containing image folder and matching label folder, where each xml file has the same filename except for an extension. Whilst the rest is practically following the general practices to train top layer of Mask-RCNN. You can check different sample codes on the Matterport GitHub.", "We have to create a class ParkingLot that will load the dataset, extract the contours of the bounding boxes by parsing xml annotated files, create the masks based on the extracted contours and we\u2019ll need an image reference function that will return the path to annotated xml file.", "Then we\u2019ll need to specify config class based on the classes that we want the model to be trained on, load the train and test datasets, load the model using the \u2018training\u2019 mode and start training.", "The model will be saved in logs folder after each epoch so that once the training is complete, you can go ahead and load the model to evaluate its performance. The way to do that with Mask-RCNN is to create new Config class that would limit the scope of our predictions", "Load the model with the \u2018inference\u2019 mode, load the model from the logs folder:", "Since the Mask-RCNN visualizes the masks of the detected objects and it\u2019s class, we will use this function to draw the bounding boxes:", "So if we load any random image, detect the available and occupied parking spots, use our function to draw them, this will be the result:", "The green boxes are the available parking spots and the blue bounding boxes are the occupied parking spots. It seems that the model performance is pretty good, although it\u2019s still not detecting small cars/parking spots. The cars that are parked alongside the pavement were intentionally omitted in the dataset so that the model wouldn\u2019t take those cars into account whilst training. This is how the results will look like with Mask-RCNN\u2019s visualize method:", "Given this results it seems that the model\u2019s performance is really good. But in our dataset we have only two angles of the parking lot, and since I was training only top model, I used only a portion of the dataset. So why not look at another photo of the parking lot with a similar camera positioned but not part of this dataset. How good our model is going to perform then?", "Wow! This is just bad! It\u2019s pretty obvious that the model is overfitted to our Parking Lot dataset, meaning it performs well on the same dataset, I didn't say training since training and testing photos are practically the same photos with different cars positioned in the parking lot and although there\u2019s no technically a leakage of test data but in a sense they are the same. Out-of-the-box pre-trained Mask-RCNN would perform much better at detecting vehicles.", "Given these conclusions and the limitations that I mentioned earlier what could be the next steps in order to improve the model or move forward? Well, we can train the model from scratch using whole set of data and see how it performs, try tuning detection threshold. I might as well try and do that, maybe that could be a part II of this post? But ideally, more varying dataset is essential with complete annotation is fundamental to create an accurate parking spot detection model. Furthermore, in order to build not only accurate but also robust detection model, I\u2019d say that it is really important to account for cars that are moving and not parked yet, unauthorized parked cars. These maybe further steps to look into in the future.", "Thank you for taking your time to read my post!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fcb2db74a0ff5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kunanba?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kunanba?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Angela Kunanbaeva"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ffa1b2f4da5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&user=Angela+Kunanbaeva&userId=5ffa1b2f4da5&source=post_page-5ffa1b2f4da5----cb2db74a0ff5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.kaggle.com/blanderbuss/parking-lot-dataset", "anchor_text": "dataset"}, {"url": "https://github.com/matterport/Mask_RCNN", "anchor_text": "link."}, {"url": "https://pjreddie.com/darknet/yolo/", "anchor_text": "link"}, {"url": "https://machinelearningmastery.com/how-to-train-an-object-detection-model-with-keras/", "anchor_text": "here"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----cb2db74a0ff5---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----cb2db74a0ff5---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/visual-recognition?source=post_page-----cb2db74a0ff5---------------visual_recognition-----------------", "anchor_text": "Visual Recognition"}, {"url": "https://medium.com/tag/mask-r-cnn?source=post_page-----cb2db74a0ff5---------------mask_r_cnn-----------------", "anchor_text": "Mask R Cnn"}, {"url": "https://medium.com/tag/parking-lot?source=post_page-----cb2db74a0ff5---------------parking_lot-----------------", "anchor_text": "Parking Lot"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&user=Angela+Kunanbaeva&userId=5ffa1b2f4da5&source=-----cb2db74a0ff5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&user=Angela+Kunanbaeva&userId=5ffa1b2f4da5&source=-----cb2db74a0ff5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fcb2db74a0ff5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----cb2db74a0ff5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----cb2db74a0ff5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kunanba?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kunanba?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Angela Kunanbaeva"}, {"url": "https://medium.com/@kunanba/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "40 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F5ffa1b2f4da5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&user=Angela+Kunanbaeva&userId=5ffa1b2f4da5&source=post_page-5ffa1b2f4da5--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fde7514cb14b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fparking-spot-detection-using-mask-rcnn-cb2db74a0ff5&newsletterV3=5ffa1b2f4da5&newsletterV3Id=de7514cb14b1&user=Angela+Kunanbaeva&userId=5ffa1b2f4da5&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}