{"url": "https://towardsdatascience.com/integrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c", "time": 1682993537.766201, "path": "towardsdatascience.com/integrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c/", "webpage": {"metadata": {"title": "Integrating TensorFlow Distributed Image Serving with the TensorFlow Object Detection API | by Tyler LaBonte | Towards Data Science", "h1": "Integrating TensorFlow Distributed Image Serving with the TensorFlow Object Detection API", "description": "This Notebook is a sequel to Serving Image-Based Deep Learning Models with TensorFlow-Serving\u2019s RESTful API. Please be sure to read that article to understand the basics of TensorFlow-Serving and the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@tmlabonte/serving-image-based-deep-learning-models-with-tensorflow-servings-restful-api-d365c16a7dc4", "anchor_text": "Serving Image-Based Deep Learning Models with TensorFlow-Serving\u2019s RESTful API", "paragraph_index": 0}, {"url": "https://github.com/tmlabonte/tendies", "anchor_text": "the Tendies repository", "paragraph_index": 0}, {"url": "https://github.com/tmlabonte/tendies/blob/master/full_functionality/tendies-extension-tutorial.ipynb", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://arxiv.org/abs/1506.01497", "anchor_text": "Faster R-CNN", "paragraph_index": 1}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "TensorFlow Object Detection API", "paragraph_index": 1}, {"url": "https://i.imgflip.com/2en7d1.jpg", "anchor_text": "Closures are the best", "paragraph_index": 9}, {"url": "https://github.com/tensorflow/serving/issues/700", "anchor_text": "someone made a solution", "paragraph_index": 16}, {"url": "https://github.com/tmlabonte/tendies", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://tmlabonte.github.io/", "anchor_text": "my website", "paragraph_index": 20}], "all_paragraphs": ["This Notebook is a sequel to Serving Image-Based Deep Learning Models with TensorFlow-Serving\u2019s RESTful API. Please be sure to read that article to understand the basics of TensorFlow-Serving and the TensorFlow Distributed Image Serving (Tendies) library. It is highly recommended to clone the Tendies repository for following along with this tutorial, as I will be focusing on important excerpts of code rather than the entire file. If you would like to view this article in a Jupyter Notebook, click here.", "Here, we will extend the functionality of the basic Tendies classes to integrate a Faster R-CNN deep neural network, which uses the TensorFlow Object Detection API. This will allow us to serve the Faster R-CNN for REST-compliant remote inference, much like CycleGAN in the previous article.", "CycleGAN was rather simple because it accepted an image and output an image; however, Faster R-CNN accepts an image and outputs a dictionary of tensors. Furthermore, the Object Detection API forces us to build our model from a pipeline.config and redefine the inference function, making serving Faster R-CNN a more difficult task. The steps to integrating a new model with Tendies are as follows:", "While I will be demonstrating with Faster R-CNN, these steps remain the same for any arbitrary model, so feel free to follow along with your specific use case.", "Each preprocessing function must take as arguments an image bitstring, image size, and *args (where *args can be used to represent any number of custom positional arguments), then returns the model input as a tensor. Conversely, each postprocessing function must take as arguments model output and *args, then return the list of output node names and whether the output should be transmitted as an image. These outputs will then be used in ServerBuilder when exporting the model.", "First, we\u2019ll define our preprocessing function, which will transform an image bitstring to a uint8 tensor suitable for inference.", "Models compliant with the Object Detection API return a dictionary of useful tensors, such as num_detections, detection_boxes, and so on. In our postprocessing function, we\u2019ll iterate through these tensors and assign names to them, so we can extract them in ServerBuilder. We also have to account for the 1-indexing of the detection_classes tensor. Finally, we return a list of output node names and set output_as_image to False, since we will be sending the output tensors (not the visualized image) back to the client through JSON.", "If you are following along with your own model, feel free to utilize *args to accept as many parameters as you need for processing. Tendies is rather picky about tensor shape and typing, so make sure that the protos of the output of your preprocessor and the input of your postprocessor are equivalent to the input and output of your model, respectively.", "Next, we have to build the Faster R-CNN from pipeline.config and define our inference function. The code for this is in ServerBuilder.py under example_usage(), which is where the exportation of our model occurs. By reading the config file into an Object Detection API model_builder, we can instantiate a Faster R-CNN without ever actually seeing the model code. The next few cells are understood to be in the scope of example_usage().", "Since export_graph expects a single inference function, but the Object Detection API has its own pre- and post-processing to do, we have to combine them ourselves. This is a great place to use a closure, because we want to preserve the scope where we instantiated the Faster R-CNN as we pass around the inference function. Closures are the best.", "Lastly, we\u2019ll instantiate a ServerBuilder and LayerInjector, then export the model. Note that we pass our inference function, preprocessor, and postprocessor into export_graph().", "The best way to create customized Tendies clients is to inherit from Client, which provides a framework for remote inference. In such a child class, one only has to create visualize() and associated helper functions, then call client.inference() to begin the evaluation process.", "We\u2019ll need a couple of these helper functions; the first is almost exactly the same as our preprocessing function, except without the addition of batching.", "Our second helper function will be used to create our category index dictionary from the Object Detection API from the provided label map; this specific implementation of Faster R-CNN has only one class, so it\u2019s simple:", "With the use of our helpers, our visualize function isn\u2019t too bad. We\u2019ll decode the JSON data and convert it to bounding boxes, then overlay them on our input image with the help of the Object Detection API visualization_utils. Note that we convert the input image to a tensor, so we have to .eval() it before visualization.", "Now that we\u2019re done integrating Faster R-CNN with Tendies, let\u2019s run the server. First, we have to export our model:", "As of July 2018, Python 3 is not officially supported with TensorFlow Serving, but someone made a solution. Install the Python 3 TensorFlow Serving API with:", "Now, we can run this TensorFlow Model Server from bash with the command:", "Where $(path) is the path to the serve directory. In my case, it is /mnt/c/Users/Tyler/Desktop/tendies/full_functionality/serve.", "Finally, we can run remote inference by calling our client on a folder of input images:", "Thanks for following along with this tutorial; I hope it helped you out! This Notebook was built with my TensorFlow Distributed Image Serving library, which you can download here. For more blog posts and information about me, please visit my website.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning PhD at Georgia Tech | Prev. Microsoft Research, Google X, USC"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5f62d80bce4c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tmlabonte?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tmlabonte?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Tyler LaBonte"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f3d07df4e4d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&user=Tyler+LaBonte&userId=4f3d07df4e4d&source=post_page-4f3d07df4e4d----5f62d80bce4c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@tmlabonte/serving-image-based-deep-learning-models-with-tensorflow-servings-restful-api-d365c16a7dc4", "anchor_text": "Serving Image-Based Deep Learning Models with TensorFlow-Serving\u2019s RESTful API"}, {"url": "https://github.com/tmlabonte/tendies", "anchor_text": "the Tendies repository"}, {"url": "https://github.com/tmlabonte/tendies/blob/master/full_functionality/tendies-extension-tutorial.ipynb", "anchor_text": "here"}, {"url": "https://arxiv.org/abs/1506.01497", "anchor_text": "Faster R-CNN"}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "TensorFlow Object Detection API"}, {"url": "https://i.imgflip.com/2en7d1.jpg", "anchor_text": "Closures are the best"}, {"url": "https://github.com/tensorflow/serving/issues/700", "anchor_text": "someone made a solution"}, {"url": "https://github.com/tmlabonte/tendies", "anchor_text": "here"}, {"url": "https://tmlabonte.github.io/", "anchor_text": "my website"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5f62d80bce4c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----5f62d80bce4c---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/programming?source=post_page-----5f62d80bce4c---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-science?source=post_page-----5f62d80bce4c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/networking?source=post_page-----5f62d80bce4c---------------networking-----------------", "anchor_text": "Networking"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&user=Tyler+LaBonte&userId=4f3d07df4e4d&source=-----5f62d80bce4c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&user=Tyler+LaBonte&userId=4f3d07df4e4d&source=-----5f62d80bce4c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5f62d80bce4c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5f62d80bce4c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5f62d80bce4c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tmlabonte?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tmlabonte?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tyler LaBonte"}, {"url": "https://medium.com/@tmlabonte/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "60 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f3d07df4e4d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&user=Tyler+LaBonte&userId=4f3d07df4e4d&source=post_page-4f3d07df4e4d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F4f3d07df4e4d%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fintegrating-tensorflow-distributed-image-serving-with-the-tensorflow-object-detection-api-5f62d80bce4c&user=Tyler+LaBonte&userId=4f3d07df4e4d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}