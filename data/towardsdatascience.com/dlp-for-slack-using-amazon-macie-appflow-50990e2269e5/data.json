{"url": "https://towardsdatascience.com/dlp-for-slack-using-amazon-macie-appflow-50990e2269e5", "time": 1683008857.488965, "path": "towardsdatascience.com/dlp-for-slack-using-amazon-macie-appflow-50990e2269e5/", "webpage": {"metadata": {"title": "Data Loss Prevention (DLP) for Slack Using Amazon Macie & AppFlow | Towards Data Science", "h1": "Data Loss Prevention (DLP) for Slack Using Amazon Macie & AppFlow", "description": "Implement an AWS Data Loss Prevention (DLP) solution for Slack using Amazon Macie, AppFlow's Slack integration, CloudWatch Events to detect & notify on sensitive data leaks. Amazon AppFlow allows us to integrate and automate data flow between various Software as a service (SaaS) applications and AWS services."}, "outgoing_paragraph_urls": [{"url": "https://aws.amazon.com/privatelink/", "anchor_text": "AWS PrivateLink", "paragraph_index": 1}, {"url": "https://docs.aws.amazon.com/macie/latest/userguide/macie-migration.html", "anchor_text": "recommended to upgrade to the newer version", "paragraph_index": 43}, {"url": "https://aws.amazon.com/blogs/aws/new-enhanced-amazon-macie-now-available/", "anchor_text": "this post", "paragraph_index": 43}, {"url": "https://docs.aws.amazon.com/macie/latest/user/discovery-jobs.html", "anchor_text": "Macie Data Classification Job", "paragraph_index": 48}, {"url": "https://bbideep.medium.com/subscribe", "anchor_text": "Subscribe on Medium", "paragraph_index": 68}, {"url": "https://www.linkedin.com/in/bideep/", "anchor_text": "https://www.linkedin.com/in/bideep/", "paragraph_index": 70}], "all_paragraphs": ["AWS announced a new service called Amazon AppFlow recently. Amazon AppFlow allows us to integrate and automate data flow between various Software as a service (SaaS) applications and AWS services.", "This can be a game-changer in many aspects and can open up many new possibilities and interesting use cases. Amazon AppFlow can enable data flows both from SaaS applications to AWS as well as from supported AWS services to SaaS applications. Data flow can happen in a secure way as well in case the SaaS application has been integrated with AWS PrivateLink.", "Let Us Consider An Interesting Data Leakage Scenario", "Many enterprises today use communication platforms like Slack for better collaboration and even ChatOps. I am picking Slack in this scenario as it is the only supported communication platform in Amazon AppFlow at the time of writing this post.", "Slack users, say DevOps teams, can possibly post sensitive information (PII, SSNs, Credit card numbers, Access keys, and so on) on Slack channels by mistake.", "As an enterprise guideline you might want to enforce policies to stop, or at least notify users from sharing such information on Slack channels which can be visible to other channel/team members.", "Given the scenario, let\u2019s see how we can build a solution using AWS services.", "How does the solution look like?", "Integrate Amazon AppFlow with a Slack channel as the source.", "Upload conversation data to Amazon S3.", "Use Amazon Macie to discover and detect sensitive data in the S3 contents.", "Use Amazon CloudWatch Events generated by Amazon Macie to take appropriate actions for remediation or notification.", "As a prerequisite to this step, you would require the below details to connect to Slack from AppFlow. You\u2019ll see this pop-up whenever you try to configure an AppFlow flow connection to Slack. Refer Step 3 below where the new connection needs to be set up.", "Step 1: Create an S3 bucket for Amazon AppFlow", "Create an S3 bucket where Amazon AppFlow would upload the data from Slack. No additional configurations are required at this point. Check this link if required \u2014", "Step 2: Specify the flow details", "Provide the Flow Name, Description, Encryption and optional Tags.", "Note that, Amazon Macie has certain restrictions in terms of encrypted data discovery. As you\u2019ll see we would be using AWSServiceRoleForAmazonMacie service-linked role for Amazon Macie, we would have to use a custom AWS KMS customer managed key (CMK) as shown in the below screenshot \u2018Picture: Data Encryption\u2019. Create an AWS KMS key if you don\u2019t have one already to use.", "Note: I had to get this configuration part along with the KMS key permissions (discussed in a later section below) validated with AWS as well since this info was not readily available.", "Refer to this link for Amazon Macie\u2019s encryption/decryption related details \u2014", "Here a new Slack connection needs to be created. Follow the instructions carefully provided in this link \u2014", "Once the connection is created, configure the Slack channel you want to monitor. Currently, it is not possible to select multiple channels in the same flow. So, if you want to monitor multiple channels, you would have to configure multiple flows.", "Configure the destination S3 bucket where the Slack channel conversation data will be uploaded by Amazon AppFlow.", "Flow trigger can be scheduled as required. Slack integration does not support the \u2018Run flow on event\u2019 trigger.", "Step 4: Create the mapping between source and destination data fields", "In this step, you can select the source fields which need to be mapped to the destination fields. In this case, I have mapped all the fields. You can select only a few ones that you need and it allows you to do some data modifications as well like masking a field.", "I have not added any validations or filters. Go ahead and experiment as you like.", "Once created, submit some messages in the Slack channel to see if AppFlow uploads the data successfully to S3. Test data should be in a valid format for Amazon Macie to detect properly.", "Once the flow starts triggering you can see the run history as below. Ignore the 0 KB size for now. When the flow processes non-empty data, it\u2019ll show the correct size.", "Note that the \u2018Error\u2019 records do not provide any option to troubleshoot. No links to browse, no CloudWatch logs, it\u2019s just a black hole. You are on your own to figure out what went wrong until AWS provides a way in some future release! I have submitted a feature request for now. Kindly share if you find a way to troubleshoot any further.", "If a flow runs successfully, it should upload the data to the configured S3 bucket. Uploaded objects are stored under a path created with the flow name.", "And, depending on the configured data mapping, an S3 object contents might look like this \u2014", "Amazon AppFlow auto-configures an S3 bucket policy as well with a policy statement like the one below.", "This policy works fine for Amazon AppFlow as such, but we would have to add an additional policy like the one below to allow Amazon Macie to read from the S3 bucket. Permissions might look too permissive here. Go ahead and experiment to make it more restrictive.", "With the data uploaded to S3, now we can configure Amazon Macie to classify the S3 data and receive generated alerts when sensitive data is detected.", "Amazon Macie uses machine learning to automatically discover, classify, and protect sensitive data stored in S3 buckets.", "It is possible to capture CloudWatch Events generated by Amazon Macie findings. An event rule can be created to send notifications to the required targets. For now, we\u2019ll configure a simple SNS topic as the notification target of the rule.", "Let\u2019s Configure the Notification System before Configuring Macie", "Step 1: Create or reuse an SNS topic with the required subscribers", "Refer this link to create an SNS topic -", "Step 2: Create a CloudWatch Event rule", "Create a CloudWatch Event rule with the below event pattern and the SNS topic.", "Now, Let Us Configure Amazon Macie", "Prerequisite: Amazon Macie needs to be enabled. In case you are already using Macie classic version, it is recommended to upgrade to the newer version. There are a lot of improvements in the new version. Refer this post as well.", "Once Macie is enabled, you would see a dashboard like the one below with a summary view. Macie might take some time to discover and show the data depending on the data volume.", "Step 1: Configure AWS KMS CMK permissions", "Add a key policy statement like the one below to allow Amazon Macie\u2019s service-linked role to decrypt the S3 objects encrypted by Amazon AppFlow using the CMK key.", "Step 2: Creating custom data identifiers (Optional; depends on the use case)", "I am configuring custom data identifiers for this specific use case demonstration. But, it might be optional for you. I\u2019ll be using them in a Macie Data Classification Job configuration.", "I have configured 2 regex based identifiers to detect AWS Access keys and AWS secret keys with regexes AKIA[0\u20139A-Z]{16} and [0\u20139a-zA-Z/+]{40} respectively.", "Step 3: Creating Data Classification Job", "Go to the S3 buckets page, select the buckets you want to discover and classify the data, and click \u2018Create job\u2019. Click Next.", "In the \u2018Scope\u2019 screen, configure the job execution frequency and data discovery criteria. I have selected \u2018One-time job\u2019 for this use case. And, since I wanted to discover all the data and classify, I have not configured any inclusion and/or exclusion criteria.", "Select the custom data identifiers if required.", "Provide the Job name and description, and create the job.", "The job will take some time to complete depending on the data volume that needs to be discovered and classified.", "Step 4: View Amazon Macie Findings", "Once a job finds sensitive data, findings can be filtered and searched under the \u2018Findings\u2019 screen. Amazon Macie shows the severity level, type, and other details of the findings which can be further drilled down.", "Send some more data from Slack", "Now that we have the solution working as expected, fire up Slack and send some more messages in the channel with appropriate sensitive data.", "Assuming Amazon AppFlow is processing the data every few mins, we should see the alerts in Macie and receive SNS notifications as well.", "This below notification is in plain SNS message format, so it might not be very intuitive. Based on the CloudWatch event target appropriate actions can be taken and the data can be processed as required. But, you got the idea anyway!", "Thank you for reading this far!", "So, this post shows how we can build an AWS solution to detect and notify sensitive data leakage scenarios in chat based communication platforms. The architecture is completely serverless, secure, and scalable.", "A point to note regarding this solution \u2014", "Documents and images uploaded to the Slack channel cannot be processed by Amazon AppFlow and stored in S3 in the same format. So, Amazon Macie won\u2019t be able to detect sensitive information passed through such objects.", "In case such a capability is required, we should be able to build a solution using Slack APIs and AWS Lambda to retrieve the data and store it back in S3 for Amazon Macie to analyze.", "Depending on the requirements, various such solutions can be built using Amazon AI services like Rekognition, Textract, etc. as well.", "Subscribe on Medium for more such posts.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Principal Engineer | Architect | Technology Leader | Product, Platform, Cloud Engineering | AWS Community Builder | https://www.linkedin.com/in/bideep/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F50990e2269e5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bbideep.medium.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": ""}, {"url": "https://bbideep.medium.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Bideep Bezbaruah"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F12f7f5edb7c0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&user=Bideep+Bezbaruah&userId=12f7f5edb7c0&source=post_page-12f7f5edb7c0----50990e2269e5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@ferarcosn?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Fernando Arcos"}, {"url": "https://www.pexels.com/photo/white-caution-cone-on-keyboard-211151/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://aws.amazon.com/privatelink/", "anchor_text": "AWS PrivateLink"}, {"url": "https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html", "anchor_text": "How do I create an S3 Bucket?Before you can upload data to Amazon S3, you must create a bucket in one of the AWS Regions to store your data. After\u2026docs.aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/macie/latest/user/discovery-supported-encryption-types.html", "anchor_text": "Analyzing encrypted S3 objects with Amazon MacieIf an object is stored in an Amazon S3 bucket and it's encrypted, Amazon Macie might not be able to analyze the data in\u2026docs.aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/appflow/latest/userguide/requirements.html#slack", "anchor_text": "Requirements for Amazon AppFlowBefore you create a flow using Amazon AppFlow, verify that you have the required information about the source and\u2026docs.aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/US_SetupSNS.html", "anchor_text": "Setting Up Amazon SNS NotificationsAlternatively, if you plan to create your CloudWatch alarm using the AWS Management Console, you can skip this\u2026docs.aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/macie/latest/userguide/macie-migration.html", "anchor_text": "recommended to upgrade to the newer version"}, {"url": "https://aws.amazon.com/blogs/aws/new-enhanced-amazon-macie-now-available/", "anchor_text": "this post"}, {"url": "https://docs.aws.amazon.com/macie/latest/user/discovery-jobs.html", "anchor_text": "Macie Data Classification Job"}, {"url": "https://aws.amazon.com/appflow/", "anchor_text": "Amazon AppFlow - Amazon Web ServicesSecurely integrate apps and automate data flows at any scale, without code Amazon AppFlow is a fully managed\u2026aws.amazon.com"}, {"url": "https://aws.amazon.com/blogs/aws/new-announcing-amazon-appflow/", "anchor_text": "New - Announcing Amazon AppFlow | Amazon Web ServicesSoftware as a service (SaaS) applications are becoming increasingly important to our customers, and adoption is growing\u2026aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/macie/latest/user/what-is-macie.html", "anchor_text": "What is Amazon Macie?Amazon Macie is a fully managed data security and data privacy service that uses machine learning and pattern matching\u2026docs.aws.amazon.com"}, {"url": "https://aws.amazon.com/blogs/aws/new-enhanced-amazon-macie-now-available/", "anchor_text": "New - Enhanced Amazon Macie Now Available with Substantially Reduced Pricing | Amazon Web ServicesAmazon Macie is a fully managed service that helps you discover and protect your sensitive data, using machine learning\u2026aws.amazon.com"}, {"url": "https://www.linkedin.com/in/bideep/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/bbideep", "anchor_text": "Twitter"}, {"url": "https://bbideep.medium.com/subscribe", "anchor_text": "Subscribe on Medium"}, {"url": "https://medium.com/tag/aws?source=post_page-----50990e2269e5---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/security?source=post_page-----50990e2269e5---------------security-----------------", "anchor_text": "Security"}, {"url": "https://medium.com/tag/data-loss-prevention?source=post_page-----50990e2269e5---------------data_loss_prevention-----------------", "anchor_text": "Data Loss Prevention"}, {"url": "https://medium.com/tag/cybersecurity?source=post_page-----50990e2269e5---------------cybersecurity-----------------", "anchor_text": "Cybersecurity"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----50990e2269e5---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&user=Bideep+Bezbaruah&userId=12f7f5edb7c0&source=-----50990e2269e5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&user=Bideep+Bezbaruah&userId=12f7f5edb7c0&source=-----50990e2269e5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F50990e2269e5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----50990e2269e5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----50990e2269e5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----50990e2269e5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----50990e2269e5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----50990e2269e5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----50990e2269e5--------------------------------", "anchor_text": ""}, {"url": "https://bbideep.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bbideep.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bideep Bezbaruah"}, {"url": "https://bbideep.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "381 Followers"}, {"url": "https://www.linkedin.com/in/bideep/", "anchor_text": "https://www.linkedin.com/in/bideep/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F12f7f5edb7c0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&user=Bideep+Bezbaruah&userId=12f7f5edb7c0&source=post_page-12f7f5edb7c0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7053c85f3277&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdlp-for-slack-using-amazon-macie-appflow-50990e2269e5&newsletterV3=12f7f5edb7c0&newsletterV3Id=7053c85f3277&user=Bideep+Bezbaruah&userId=12f7f5edb7c0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}