{"url": "https://towardsdatascience.com/traveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5", "time": 1683013157.468551, "path": "towardsdatascience.com/traveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5/", "webpage": {"metadata": {"title": "Part 1: Import WikiData to Neo4j with Neosemantics library | by Tomaz Bratanic | Towards Data Science", "h1": "Part 1: Import WikiData to Neo4j with Neosemantics library", "description": "After a short summer break, I have prepared a new blog series. In this first part, we will construct a knowledge graph of monuments located in Spain. As you might know, I have lately gained a lot of\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.wikidata.org/wiki/Wikidata:Main_Page", "anchor_text": "WikiData API", "paragraph_index": 0}, {"url": "https://twitter.com/BarrasaDV", "anchor_text": "Dr. Jesus Barrasa", "paragraph_index": 0}, {"url": "https://neo4j.com/labs/neosemantics/4.0/", "anchor_text": "Neosemantics library", "paragraph_index": 0}, {"url": "https://neo4j.com/docs/graph-data-science/current/", "anchor_text": "Neo4j Graph Data Science library", "paragraph_index": 1}, {"url": "https://neo4j.com/developer/neo4j-apoc/", "anchor_text": "APOC", "paragraph_index": 2}, {"url": "https://neo4j.com/graph-data-science-library/", "anchor_text": "GDS", "paragraph_index": 2}, {"url": "https://neo4j.com/download/", "anchor_text": "Neo4j Desktop", "paragraph_index": 2}, {"url": "https://neo4j.com/labs/neosemantics/4.0/", "anchor_text": "Neosemantics", "paragraph_index": 2}, {"url": "https://github.com/neo4j-labs/neosemantics/releases", "anchor_text": "latest release", "paragraph_index": 3}, {"url": "https://neo4j.com/labs/neosemantics/4.0/reference/", "anchor_text": "documentation", "paragraph_index": 5}, {"url": "https://query.wikidata.org/", "anchor_text": "WikiData query editor", "paragraph_index": 8}, {"url": "https://www.wikidata.org/wiki/Q4989906", "anchor_text": "monuments", "paragraph_index": 9}, {"url": "https://www.wikidata.org/wiki/Q29", "anchor_text": "Spain", "paragraph_index": 9}, {"url": "https://markhneedham.com/blog/2020/02/02/querying-wikidata-construct-select/", "anchor_text": "blog post", "paragraph_index": 12}, {"url": "https://twitter.com/markhneedham", "anchor_text": "Mark Needham", "paragraph_index": 12}, {"url": "http://neo4j-contrib.github.io/neo4j-apoc-procedures/3.5/utilities/spatial/#_configuring_custom_geocode_provider", "anchor_text": "documentation", "paragraph_index": 23}, {"url": "https://tbgraph.wordpress.com/2017/04/01/neo4j-location-trees/", "anchor_text": "Location trees post", "paragraph_index": 29}, {"url": "https://neo4j.com/try-neo4j/", "anchor_text": "try Neo4j", "paragraph_index": 35}, {"url": "https://neo4j.com/tag/twin4j/", "anchor_text": "Twin4j newsletter", "paragraph_index": 35}, {"url": "https://github.com/tomasonjo/blogs/blob/master/Traveling_tourist/Part1%20-%20Import%20knowledge%20graph.ipynb", "anchor_text": "GitHub", "paragraph_index": 36}, {"url": "http://mng.bz/GGVN", "anchor_text": "http://mng.bz/GGVN", "paragraph_index": 38}], "all_paragraphs": ["After a short summer break, I have prepared a new blog series. In this first part, we will construct a knowledge graph of monuments located in Spain. As you might know, I have lately gained a lot of interest and respect for the wealth of knowledge that is available through the WikiData API. We will continue honing our SPARQL syntax knowledge and fetch the information regarding the monuments located in Spain from the WikiData API. I wasn\u2019t aware of this before, but scraping the RDF data available online and importing it into Neo4j is such a popular topic that Dr. Jesus Barrasa developed a Neosemantics library to help us with this process.", "In the next parts of the series, we will take a look at the pathfinding algorithms available in the Neo4j Graph Data Science library.", "In this blog series, we will use the standard APOC and GDS libraries, which we can install with a single click in the Neo4j Desktop application. On top of that, we will add the Neosemantics library to our stack. It is used to interact with RDF data in the Neo4j environment. We can either import RDF data to Neo4j or export property graph model in RDF format.", "To install the Neosemantics library, we download the latest release and save it to the Neo4j plugins folder. We also need to add the following line to the Neo4j configuration file.", "We are now ready to start our Neo4j instance. First, we need to initiate the Neosemantics configuration with the following cypher procedure.", "Take a look at the documentation for information about the configuration options.", "Monuments are in the center of our graph. We have their name and the URL of the image stored as a node property. The monuments have been influenced by various architectural styles, which we indicate as a relationship to an Architecture node. We will save the city and the state of the monument as a two-level hierarchical location tree.", "The Neosemantics library requires a unique constraint on the property \u201curi\u201d of the nodes labeled Resource. We will also add indexes for the State and City nodes. The apoc.schema.assert procedure allows us to define many indexes and unique constraints with a single call.", "For me, the easiest way to construct a new SPARQL query is using the WikiData query editor. It has a lovely autocomplete feature. It also helps with query debugging.", "We want to retrieve all the instances of monuments located in Spain. I have found the easiest way to find various entities on WikiData is by simply using Google search. You can then inspect all the available properties of the entity on the website. The SPARQL query I first came up looks like this:", "The first two lines in the WHERE clause define the entities we are looking for:", "Next, we also determine which properties of the entities we are interested in. In our case, we would like to retrieve the monument\u2019s name, image, location, and architectural style. If we run this query in the query editor, we get the following results.", "We have defined the information we would like to retrieve in the WHERE clause of the SPARQL query. We need to massage the data format a bit before we can import it with Neosemantics. The first and most crucial thing is to change the SELECTclause to CONSTRUCT. This way, we will get returned RDF triplets instead of a table of information. You can read more about the difference between SELECTand CONSTRUCTin this blog post written by Mark Needham.", "With the Neosemantics library, we can preview what our stored graph model would look like with the n10s.rdf.preview.fetch procedure. We will start by inspecting the graph schema of an empty CONSTRUCT statement.", "One problem is that the nodes have no labels. You could also notice that the relationship types are not very informative as P149 or P31 does not mean much if you don\u2019t know the WikiData property mapping. Another thing, which is not very obvious from this visualization is that the URL of the image is stored as a separate node. If you remember the graph model from before, we decided we want to save the image URL as a property of the monument node.", "I won\u2019t go much into detail, but inside the CONSTRUCT clause, we can define how our graph schema should look like in Neo4j. We have also defined we want to save the URL of the image as a property of the monument node instead of a separate node with the following syntax:", "We can now preview the new query with the updated CONSTRUCT statement.", "Now we can go ahead and import the graph to Neo4j. Instead of the n10s.rdf.preview.fetch procedure we use n10s.rdf.import.fetch and keep the rest of the query identical.", "Let\u2019s start with some exploratory graph queries. We will first count the number of monuments in our graph.", "We have imported 1401 monuments into our graph. We will continue with counting the number of monuments grouped by an architectural style.", "Romanesque and Gothic architecture styles influence the most monuments. While I was exploring WikiData, I have noticed that an architectural style can be a subclass of other architectural styles. As an exercise, we will import the architectural hierarchy relationships to our graph. In our query, we will iterate over all architecture styles stored in our graph, and fetch any parent architectural style from WikiData and save it back to our graph.", "We can now look at some examples of architectural hierarchy.", "It seems that modernism is a child category of Art Noveau, and Art Noveau is a child category of decorative arts.", "At first, I wanted to include the municipality information of monuments available on WikiData, but as it turned out, this information is relatively sparse. No worries though, I later realized we could use the reverse geocode API to retrieve this information. APOC has a dedicated procedure available for reverse geocoding. By default, it uses Open Street Map API, but we can customize it to work with other providers as well. Check the documentation for more information.", "First, we have to transform the location information to a spatial point data type.", "Check a sample response from the OSM reverse GeoCode API.", "Open Street Map API is a tad interesting as it differs between cities, towns, and villages. Also, the monuments located in the Canaries have no state available but are a part of the Canaries archipelago. We will treat archipelago as a state and lump city, town, and village under a single label City. For batching purposes, we will use the apoc.periodic.iterate procedure.", "This query will take a long time because the default throttle delay setting is five seconds. If you don\u2019t have the time to wait, I have saved the spatial results to GitHub, and you can easily import them with the following query in less than five seconds.", "We will first inspect if there are any missing spatial values for monuments.", "We have retrieved the spatial information for almost all of the monuments. Something you need to be careful when creating location hierarchy trees is that every node in the tree has only a single outgoing relationship to its parent. If this rule is broken, the structural integrity of the location tree is lost, as some entities will have more than a single location. Check my Location trees post for more information on how to circumnavigate this problem.", "Luckily we don\u2019t run into this problem here. We can now explore the results of our spatial enrichment. We will look at the count of monuments grouped by architectural style located in Catalunya.", "Let\u2019s quickly look at the WikiData definition of vernacular architecture for educational purposes.", "Vernacular architecture is architecture characterized by the use of local materials and knowledge, usually without the supervision of professional architects.", "We can also look at the most frequent architectural style of monuments by states. We will use the subquery syntax introduced in Neo4j 4.0.", "If you have followed the steps in this post, your graph should look something like in the above picture. I was always impressed by how easy it is to fetch data from various APIs using only cypher. And if you want to call any custom endpoint, you can still use the apoc.load.json procedure.", "In the next part, we will dig into the pathfinding algorithms. In the meantime, try Neo4j and join the Twin4j newsletter.", "As always, the code is available on GitHub.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data explorer. Turn everything into a graph. Author of Graph algorithms for Data Science at Manning publication. http://mng.bz/GGVN"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff80235f40dc5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bratanic-tomaz.medium.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Tomaz Bratanic"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57f13c0ea39a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=post_page-57f13c0ea39a----f80235f40dc5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/traveling-tourist", "anchor_text": "Traveling tourist"}, {"url": "https://www.wikidata.org/wiki/Wikidata:Main_Page", "anchor_text": "WikiData API"}, {"url": "https://twitter.com/BarrasaDV", "anchor_text": "Dr. Jesus Barrasa"}, {"url": "https://neo4j.com/labs/neosemantics/4.0/", "anchor_text": "Neosemantics library"}, {"url": "https://neo4j.com/docs/graph-data-science/current/", "anchor_text": "Neo4j Graph Data Science library"}, {"url": "https://neo4j.com/developer/neo4j-apoc/", "anchor_text": "APOC"}, {"url": "https://neo4j.com/graph-data-science-library/", "anchor_text": "GDS"}, {"url": "https://neo4j.com/download/", "anchor_text": "Neo4j Desktop"}, {"url": "https://neo4j.com/labs/neosemantics/4.0/", "anchor_text": "Neosemantics"}, {"url": "https://github.com/neo4j-labs/neosemantics/releases", "anchor_text": "latest release"}, {"url": "https://neo4j.com/labs/neosemantics/4.0/reference/", "anchor_text": "documentation"}, {"url": "https://app.diagrams.net/", "anchor_text": "draw.io"}, {"url": "https://query.wikidata.org/", "anchor_text": "WikiData query editor"}, {"url": "https://www.wikidata.org/wiki/Q4989906", "anchor_text": "monuments"}, {"url": "https://www.wikidata.org/wiki/Q29", "anchor_text": "Spain"}, {"url": "https://markhneedham.com/blog/2020/02/02/querying-wikidata-construct-select/", "anchor_text": "blog post"}, {"url": "https://twitter.com/markhneedham", "anchor_text": "Mark Needham"}, {"url": "http://neo4j-contrib.github.io/neo4j-apoc-procedures/3.5/utilities/spatial/#_configuring_custom_geocode_provider", "anchor_text": "documentation"}, {"url": "https://tbgraph.wordpress.com/2017/04/01/neo4j-location-trees/", "anchor_text": "Location trees post"}, {"url": "https://neo4j.com/try-neo4j/", "anchor_text": "try Neo4j"}, {"url": "https://neo4j.com/tag/twin4j/", "anchor_text": "Twin4j newsletter"}, {"url": "https://github.com/tomasonjo/blogs/blob/master/Traveling_tourist/Part1%20-%20Import%20knowledge%20graph.ipynb", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/neo4j?source=post_page-----f80235f40dc5---------------neo4j-----------------", "anchor_text": "Neo4j"}, {"url": "https://medium.com/tag/knowledge-graph?source=post_page-----f80235f40dc5---------------knowledge_graph-----------------", "anchor_text": "Knowledge Graph"}, {"url": "https://medium.com/tag/wikidata?source=post_page-----f80235f40dc5---------------wikidata-----------------", "anchor_text": "Wikidata"}, {"url": "https://medium.com/tag/spatial?source=post_page-----f80235f40dc5---------------spatial-----------------", "anchor_text": "Spatial"}, {"url": "https://medium.com/tag/traveling-tourist?source=post_page-----f80235f40dc5---------------traveling_tourist-----------------", "anchor_text": "Traveling Tourist"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=-----f80235f40dc5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=-----f80235f40dc5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff80235f40dc5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f80235f40dc5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f80235f40dc5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f80235f40dc5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f80235f40dc5--------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bratanic-tomaz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tomaz Bratanic"}, {"url": "https://bratanic-tomaz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "3.1K Followers"}, {"url": "http://mng.bz/GGVN", "anchor_text": "http://mng.bz/GGVN"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F57f13c0ea39a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=post_page-57f13c0ea39a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Feab586d298c8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftraveling-tourist-part-1-import-wikidata-to-neo4j-with-neosemantics-library-f80235f40dc5&newsletterV3=57f13c0ea39a&newsletterV3Id=eab586d298c8&user=Tomaz+Bratanic&userId=57f13c0ea39a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}