{"url": "https://towardsdatascience.com/the-quest-of-higher-accuracy-for-cnn-models-42df5d731faf", "time": 1682996345.129605, "path": "towardsdatascience.com/the-quest-of-higher-accuracy-for-cnn-models-42df5d731faf/", "webpage": {"metadata": {"title": "The Quest of Higher Accuracy for CNN Models | by Swanand Mhalagi | Towards Data Science", "h1": "The Quest of Higher Accuracy for CNN Models", "description": "Performance is key when it comes to deep learning models and it becomes an arduous task when you have limited resources. One of the important parameter to measure performance is \u2018Accuracy\u2019. This\u2026"}, "outgoing_paragraph_urls": [{"url": "https://keras.io/preprocessing/image/", "anchor_text": "ImageDataGenerator", "paragraph_index": 3}, {"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "database", "paragraph_index": 13}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "ImageDataGenerator", "paragraph_index": 16}, {"url": "https://keras.io/preprocessing/image/#flow_from_dataframe", "anchor_text": "flow_from_dataframe", "paragraph_index": 16}, {"url": "https://keras.io/layers/convolutional/", "anchor_text": "convolution layers", "paragraph_index": 17}, {"url": "https://keras.io/activations/", "anchor_text": "activation function", "paragraph_index": 17}, {"url": "https://keras.io/layers/convolutional/#zeropadding2d", "anchor_text": "zero padding layers", "paragraph_index": 17}, {"url": "https://keras.io/layers/pooling/", "anchor_text": "max pooling layers", "paragraph_index": 17}, {"url": "https://keras.io/layers/normalization/", "anchor_text": "batch normalization", "paragraph_index": 17}, {"url": "https://keras.io/regularizers/", "anchor_text": "L2 regularization", "paragraph_index": 17}, {"url": "https://keras.io/callbacks/", "anchor_text": "Callbacks", "paragraph_index": 19}, {"url": "https://keras.io/models/model/#predict_generator", "anchor_text": "predict_generator", "paragraph_index": 25}, {"url": "https://swanandm.github.io/IamSwan/", "anchor_text": "https://swanandm.github.io/IamSwan/", "paragraph_index": 31}], "all_paragraphs": ["Performance is key when it comes to deep learning models and it becomes an arduous task when you have limited resources. One of the important parameter to measure performance is \u2018Accuracy\u2019. This article is all about achieving higher accuracy with various techniques related to data, algorithm tuning and model optimization. We will also see effects on accuracy after varying parameters like learning rate, batch size, number of training images, images size and number of trainable model parameters.", "After reading this article, you will know", "To start with, I will implement a code which I recently posted. (Link below) This is a TF/Keras implementation for Diabetic Retinopathy detection. This is a very basic version of CNN model with very less accuracy. I have made several changes to this code in order to achieve high accuracy as well as fast training/data load time. I will walk you through the best performing code later in this article.", "The best performing code implemented using ImageDataGenerator, flow_from_dataframe, various data augmentation techniques, L2 regularization, batch normalization, one hot encoding on a subset of data considering the class weights in Keras. Lets take a look at all the performance improvement techniques.", "Techniques for performance improvement with hyper-parameter tuning", "Techniques for performance improvement with data redesigning", "Techniques for performance improvement with model optimization", "Below table depicts the performance summary for various models created", "The last 4 columns show the highlights of all the performance improvement techniques we are applying while defining the model as well as during data processing. In general while doing performance measurement its recommended to change one variable at a time, the table shows only such runs where we see some performance improvement or if we have applied any new tuning technique.", "All the measurements are done on NVIDIA Quadro M400 GPU. This GPU has a 8 GB RAM. GPU is configured with CUDA 9.0, cuDNN 7.4, TF for GPU 1.8.0 on Ubuntu 16.04 instance.", "Some of the limitations of these measurements", "Now lets take a look at the code where we got 80% accuracy", "This code uses Linux packages such as mat-plot, NumPy, Keras, Pillow, H5py and Tensor-Flow.", "I have already downloaded the database from Kaggle. The database has several zip files, we need to unzip them into train/test folders containing respective images. All the labels for train images are provided in a separate CSV file.", "In the code below we will read a CSV file containing labels and name of the images. We need to do some sanity checks (adding .jpeg extension, delete all the images of size 0 KB, remove entries of deleted images from the data frame) before we move forward.", "Lets split the database into train and validation data and then convert the labels into one hot encoded labels. We are purposefully doing one hot encoding after splitting the data to retain the original label format to compare the labels to the predicted once later. (This will be useful when we retrain on wrongly predicted images) We will also calculate class weights since this is a highly imbalanced database.", "As I said before we will use ImageDataGenerator (to apply all image augmentation techniques, image rotations, width/height shift and re-scale) and flow_from_dataframe (to read all the images, set batch size and image size)", "Lets define the model. This model consist of 2 dimensional convolution layers with Relu as activation function, zero padding layers and max pooling layers. We will be also implementing batch normalization and L2 regularization. This is a Keras functional API implementation.", "Initialize the optimizer and loss function. We will be using stochastic gradient descent (SGD) with a learning rate of 0.01 which will be decaying every epoch. In practice SGD is 2 dimensional function but the neural network might have millions of parameters which means the millions of directions the loss function can move. If the loss function has a local minimum point/saddle point, there will be \u201czero gradient\u201d and the gradient descent will get stuck. If we add momentum to SGD, the saddle points will get velocity to move forward. Adding nesterov momentum will take shorter path towards convergence.", "Callbacks will help us retain the best weights and biases we trained so far, since we will be training with multiple epochs and each epoch will go through entire training set. There is always a possibility that the model is over-fitting after certain number of epoch or accuracy may stop improving, the already saved weights will be helpful.", "The model we defined looks like below", "Its time to train the model on a GPU", "This is how the training will progress and you can see we achieved 80% training as well as validation accuracy.", "We can also see how accuracy and losses are changing over time using below code", "This is how the plots look", "In order to further improve the accuracy, we will be retraining on wrongly predicted training images. For this we will load the model that we just saved, later we will use the predict_generator to predict on the same training images. In this way we will be fine tuning model to specific set of images for which previous model miss predicted.", "Now we have a new database in df_filtered. we can use same old data pipeline and model definition we used earlier. This retraining allowed me to reach up to 82% accuracy.", "What else we can do to improve the accuracy?", "Sometime in real world scenario its difficult to relay on single model. Different models can have different properties depending on number of layers it had, number of parameters it is trained on, etc. A particular model may not be able to predict best on particular set/type of images. In such cases we can combine multiple models to make a best prediction.", "In my next article, we will implement model ensembles by using some of the best performing models which we already created. Model ensembles can be used to take a vote from those models to make final prediction.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Investment and AI Enthusiast | Cloud Software Engineer at Intel | https://swanandm.github.io/IamSwan/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F42df5d731faf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----42df5d731faf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@swan1991m?source=post_page-----42df5d731faf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Swanand Mhalagi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9424d18458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&user=Swanand+Mhalagi&userId=fd9424d18458&source=post_page-fd9424d18458----42df5d731faf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@swan1991m/convolutional-neural-network-cnn-implementation-for-diabetic-retinopathy-detection-with-tf-989ac802ce4b", "anchor_text": "Convolutional Neural Network (CNN) implementation for Diabetic Retinopathy Detection with TFThe aim of this tutorial is to develop automated detection system for diabetic retinopathy using CNN. This was one of\u2026medium.com"}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "ImageDataGenerator"}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "flow_from_dataframe"}, {"url": "https://www.kaggle.com/c/diabetic-retinopathy-detection/overview", "anchor_text": "database"}, {"url": "https://keras.io/preprocessing/image/", "anchor_text": "ImageDataGenerator"}, {"url": "https://keras.io/preprocessing/image/#flow_from_dataframe", "anchor_text": "flow_from_dataframe"}, {"url": "https://keras.io/layers/convolutional/", "anchor_text": "convolution layers"}, {"url": "https://keras.io/activations/", "anchor_text": "activation function"}, {"url": "https://keras.io/layers/convolutional/#zeropadding2d", "anchor_text": "zero padding layers"}, {"url": "https://keras.io/layers/pooling/", "anchor_text": "max pooling layers"}, {"url": "https://keras.io/layers/normalization/", "anchor_text": "batch normalization"}, {"url": "https://keras.io/regularizers/", "anchor_text": "L2 regularization"}, {"url": "https://keras.io/callbacks/", "anchor_text": "Callbacks"}, {"url": "https://keras.io/models/model/#predict_generator", "anchor_text": "predict_generator"}, {"url": "https://github.com/swanandM/Diabetic-Retinopathy-Detection-with-TF", "anchor_text": "https://github.com/swanandM/Diabetic-Retinopathy-Detection-with-TF"}, {"url": "https://towardsdatascience.com/different-ways-of-improving-training-accuracy-c526db15a5b2", "anchor_text": "https://towardsdatascience.com/different-ways-of-improving-training-accuracy-c526db15a5b2"}, {"url": "https://machinelearningmastery.com/image-augmentation-deep-learning-keras/", "anchor_text": "https://machinelearningmastery.com/image-augmentation-deep-learning-keras/"}, {"url": "https://deepsense.ai/diagnosing-diabetic-retinopathy-with-deep-learning/", "anchor_text": "https://deepsense.ai/diagnosing-diabetic-retinopathy-with-deep-learning/"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----42df5d731faf---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----42df5d731faf---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/imagedatagenerator?source=post_page-----42df5d731faf---------------imagedatagenerator-----------------", "anchor_text": "Imagedatagenerator"}, {"url": "https://medium.com/tag/accuracy?source=post_page-----42df5d731faf---------------accuracy-----------------", "anchor_text": "Accuracy"}, {"url": "https://medium.com/tag/cnn?source=post_page-----42df5d731faf---------------cnn-----------------", "anchor_text": "Cnn"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&user=Swanand+Mhalagi&userId=fd9424d18458&source=-----42df5d731faf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&user=Swanand+Mhalagi&userId=fd9424d18458&source=-----42df5d731faf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F42df5d731faf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----42df5d731faf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----42df5d731faf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----42df5d731faf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----42df5d731faf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----42df5d731faf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----42df5d731faf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@swan1991m?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Swanand Mhalagi"}, {"url": "https://medium.com/@swan1991m/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "67 Followers"}, {"url": "https://swanandm.github.io/IamSwan/", "anchor_text": "https://swanandm.github.io/IamSwan/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffd9424d18458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&user=Swanand+Mhalagi&userId=fd9424d18458&source=post_page-fd9424d18458--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F38b2eefc6408&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-quest-of-higher-accuracy-for-cnn-models-42df5d731faf&newsletterV3=fd9424d18458&newsletterV3Id=38b2eefc6408&user=Swanand+Mhalagi&userId=fd9424d18458&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}