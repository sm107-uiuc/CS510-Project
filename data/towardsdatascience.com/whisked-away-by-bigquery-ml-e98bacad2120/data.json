{"url": "https://towardsdatascience.com/whisked-away-by-bigquery-ml-e98bacad2120", "time": 1682994600.7591732, "path": "towardsdatascience.com/whisked-away-by-bigquery-ml-e98bacad2120/", "webpage": {"metadata": {"title": "Whisked Away by BigQuery ML. Predicting Whiskey Preferences in GCP | by Phil Goerdt | Towards Data Science", "h1": "Whisked Away by BigQuery ML", "description": "\u2026anything that is peaty, smoky like a campfire on the beach, medium to high alcohol, dried fruits, citrus, and a has subtle hint of terra firma.\u201d It\u2019s easy for me to walk into my local liquor store\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cloud.google.com/bigquery/docs/bigqueryml-intro", "anchor_text": "BigQueryML", "paragraph_index": 3}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create", "anchor_text": "create these models using specialized SQL commands", "paragraph_index": 4}, {"url": "https://medium.com/@srobtweets", "anchor_text": "Sara Robinson", "paragraph_index": 6}, {"url": "https://medium.com/@phil.goerdt/no-the-cloud-is-not-too-expensive-76ef99cf1fbb", "anchor_text": "previous blogs", "paragraph_index": 7}, {"url": "https://en.wikipedia.org/wiki/Data_definition_language", "anchor_text": "DDL", "paragraph_index": 15}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create", "anchor_text": "check there", "paragraph_index": 15}, {"url": "https://developers.google.com/machine-learning/crash-course/descending-into-ml/training-and-loss", "anchor_text": "Let\u2019s take a quick look a this figure from Google\u2019s ML crash course.", "paragraph_index": 24}, {"url": "https://damndram.com/recommendations/", "anchor_text": "Damn Dram", "paragraph_index": 29}], "all_paragraphs": ["\u2026anything that is peaty, smoky like a campfire on the beach, medium to high alcohol, dried fruits, citrus, and a has subtle hint of terra firma.\u201d", "It\u2019s easy for me to walk into my local liquor store and talk tasting notes (and joke) with the whiskey guy or gal on staff, and he or she will be able to know what I\u2019m looking for and make a recommendation to me. But can a machine learning model do the same on a minimal data set and with limited inputs? That\u2019s the question at hand.", "(For those of you joining in now, thanks for coming along on this part of the story! I recommend you take a look at the other blogs in this series, but if you don\u2019t, the summary is I have a bunch of whiskey data with my tasting preferences. Let\u2019s see what we can learn from it.)", "For this exercise I\u2019ll be using Google Cloud Platform\u2019s BigQueryML engine. If you didn\u2019t guess, this is an ML tool that will allow you to create ML models and run them in BigQuery.", "BQML is an incredible advantage for anyone who has tons of data within BigQuery (or anywhere else that can easily transfer data to BQ) because the data can stay put and doesn\u2019t require data frame defining. Not only that, we can manage and run our models in BigQuery as well; this means no more ML specific compute virtual (or I suppose physical) machines to provision. And finally, we can create these models using specialized SQL commands available in BQ. This isn\u2019t like other SQL plugins that require tons of user defined functions, classes and other fun things that keep us from developing real content; it works right out of the box. How cool is that?!", "Why should we care about these features? Shouldn\u2019t I try using \u201ca real ML framework\u201d like TensorFlow? Well, yes\u2026 maybe. I could try to do this exercise in a \u201creal framework\u201d like TensorFlow. But, there are a few reasons I didn\u2019t go down that path.", "For one, I didn\u2019t want to write another \u201chow to do your first whatever with TensorFlow\u201d blog. That\u2019s been blogged to death already. Also, someone like Sara Robinson is going to do so much better of a job at producing cool, avant-garde TensorFlow content than me. BigQueryML here we come!", "Another reason is that in previous blogs I have talked about my love of simplicity when designing systems that work together. I like things to have as few moving parts, to have as few failure points as possible, and to be as automated as possible from the outset. BigQueryML is simple, it\u2019s cheap for me to experiment with, and it fits in my current tech stack definition. Using it was a no brainer for me.", "Finally, my requirements didn\u2019t dictate that I needed anything with high horsepower. My training set is a subset of just over 100 rows (all the whiskies I\u2019ve tried in 2018), and I\u2019m doing pretty simple regressions for prediction. And because of these reasons, I think the risk of overtraining by using a more robust and highly engineered solution was high. (Comment and discuss below, if you\u2019d like. If there is a lot of response to this, maybe I\u2019ll do some TensorFlow models and compare them to BQML in a future post.)", "Regardless of my reasons for choosing BigQueryML, let\u2019s get down to the business of using it.", "As I said above, using BigQueryML is pretty dang easy, and mostly this is due to the feature set of the product. However, just because it\u2019s easy to use doesn\u2019t mean that it\u2019s without nuance. Let\u2019s create an example model based on my data, evaluate it, and have a little chat about it.", "In some earlier blogs in this series, I provided a quick run down of what the whiskey rating data looked like. Here\u2019s a quick reminder:", "Above are the raw, unweighted scores for two whiskies, along with a few dimensional attributes. Think that\u2019s enough to predict against? I think the verdict is still out on this one. I think that we if think about this from how most drinkers of whiskey typically start the conversation of what they drink, it is usually by saying a style of whiskey, such as \u201cI\u2019m a bourbon guy\u201d or \u201cI only drink single malts\u201d. Sometimes maturity comes into play, and oftentimes price dictates what we buy or can afford. These usually are good indicators by themselves. But will the model be able to learn beyond that? Do we have enough to detect nuance?", "I guess we\u2019ll have to see what the model thinks.", "Now that we\u2019re all up to speed on the training data set, let\u2019s take a look at how to actually model stuff in BigQueryML.", "If you are familiar with SQL, you may have guessed creating a model is similar to any DDL statement. Using the create model statement, we can create some models that run and train right in BigQuery. The GCP documentation does an excellent job of reviewing all of the available parameters, so check there if you want to read up on things I\u2019m not using in this example.", "It seems simple enough, but let me break down what is going on in there.", "First, we have the create or replace model statement followed by the model name. Next comes the options clause, which allows us to parameterize our newly minted model. As I said before, there are lots of fun levers to pull and knobs to twist in here, and you can read more about those in the documentation. This example has just a couple of options in it to whet your appetite. Let\u2019s take a look at what they are.", "Moving further down the SQL statement, you\u2019ll notice that there is a select statement that serves the data to the model. This is pretty self explanatory, and this simplicity of not needing to define data frames, features and all of the other fun stuff that comes along with ML models makes BigQueryML very appealing for someone in my situation.", "Once the model is defined, I can run the above statement and what happens next is pretty cool. BigQuery ingests the model logic, queries the data and then runs the model in BigQuery. Seriously, how cool is that? The eagle eyed (with billing admin permissions) may notice that there are a few additional line items for GCE, and that is because you will be billed for running these ML statements. However, you aren\u2019t responsible for spinning these resources up or down when running them.", "Now that I\u2019ve run the model, I should evaluate it. The reason for doing that is to better understand the accuracy of the model. While we can definitively know if the model is accurate (because, you know, math), in some cases model building and tuning is a bit more art than science. Let\u2019s walk through a few examples of why this is the case.", "I can check out a few important indicators of my models accuracy by running the following command in BigQuery:", "This will give you an output that looks something like this:", "The variety of stats above help quantify the amount of error that is in the model; that is, how much the model is \u201coff\u201d from the correct score. If we are trying to predict the correct score each time (and we are), we would be trying to have an error as close to zero as possible.", "Let\u2019s take a quick look a this figure from Google\u2019s ML crash course. This figure shows us how the model is trying to fit to the data set, and clearly the one on the right is doing a better job of it. By looking at the statistical errors for the model it looks like we could do better\u2026 right?", "In theory, yes, I definitely could. What I did next was run the same model multiple times with different feature sets to determine what had an impact on the model\u2019s error rates. You can see below that adding and removing additional features changed the errors rates quite a bit, and none of the error rates were as low as the base model.", "Does that mean that we should revert to the base? In my opinion, no, and here\u2019s why. The data set is just too small. If we look at the base model, there are two features: The whiskey\u2019s full name, and the distillery. If I were to only use those for predicting whether or not I liked a whiskey, I would probably have poor results over time. The reason the error rates are going up when I add in more features is that there is not enough data or rich enough features to determine a pattern.", "This means that even while we can see from a mathematical standpoint one model is \u201cthe most correct\u201d, it does not mean it will scale or be able to learn from new data it is exposed to. And what\u2019s the point of that?", "I\u2019ve made several other models since that first model, and have experimented with them to produce much better results. Part of this process was getting more data, specifically introducing tasting notes to the model. Also, tuning the models parameters also helped. So what did the final \u201cwork in progress\u201d turn out like?", "I think the results above are OK. Obviously I still need to do some tweaking to the models, and I also think that a small data set is part of the problem. (If you want to check out all of the recommendations, feel free to head over to Damn Dram.)", "But let\u2019s not forget the star of the show here, which is BigQueryML. It was so incredibly easy to build, manage and test these models in BigQueryML, and it integrated seamlessly into what I was already building. And I can\u2019t see anything wrong with that.", "Phil Goerdt is an independent consultant specializing in cloud architecture and data engineering.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Consultant. Data & Cloud architect. Founder. Petrolhead. Traveler. Foodie. Geek. Opinions my own."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe98bacad2120&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e98bacad2120--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@phil.goerdt?source=post_page-----e98bacad2120--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@phil.goerdt?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Phil Goerdt"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e09293ed18c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&user=Phil+Goerdt&userId=2e09293ed18c&source=post_page-2e09293ed18c----e98bacad2120---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://cloud.google.com/bigquery/docs/bigqueryml-intro", "anchor_text": "BigQueryML"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create", "anchor_text": "create these models using specialized SQL commands"}, {"url": "https://medium.com/@srobtweets", "anchor_text": "Sara Robinson"}, {"url": "https://medium.com/@phil.goerdt/no-the-cloud-is-not-too-expensive-76ef99cf1fbb", "anchor_text": "previous blogs"}, {"url": "https://en.wikipedia.org/wiki/Data_definition_language", "anchor_text": "DDL"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/bigqueryml-syntax-create", "anchor_text": "check there"}, {"url": "https://developers.google.com/machine-learning/crash-course/regularization-for-sparsity/l1-regularization", "anchor_text": "weighting of inputs in the model"}, {"url": "https://developers.google.com/machine-learning/crash-course/descending-into-ml/training-and-loss", "anchor_text": "Let\u2019s take a quick look a this figure from Google\u2019s ML crash course."}, {"url": "https://damndram.com/recommendations/", "anchor_text": "Damn Dram"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e98bacad2120---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----e98bacad2120---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----e98bacad2120---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/tag/whiskey?source=post_page-----e98bacad2120---------------whiskey-----------------", "anchor_text": "Whiskey"}, {"url": "https://medium.com/tag/big-data?source=post_page-----e98bacad2120---------------big_data-----------------", "anchor_text": "Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&user=Phil+Goerdt&userId=2e09293ed18c&source=-----e98bacad2120---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&user=Phil+Goerdt&userId=2e09293ed18c&source=-----e98bacad2120---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe98bacad2120&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e98bacad2120---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e98bacad2120--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e98bacad2120--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e98bacad2120--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e98bacad2120--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e98bacad2120--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@phil.goerdt?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@phil.goerdt?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Phil Goerdt"}, {"url": "https://medium.com/@phil.goerdt/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "109 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2e09293ed18c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&user=Phil+Goerdt&userId=2e09293ed18c&source=post_page-2e09293ed18c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F2e09293ed18c%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhisked-away-by-bigquery-ml-e98bacad2120&user=Phil+Goerdt&userId=2e09293ed18c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}