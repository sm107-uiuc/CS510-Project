{"url": "https://towardsdatascience.com/how-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f", "time": 1683005870.119516, "path": "towardsdatascience.com/how-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f/", "webpage": {"metadata": {"title": "How to perform scenario analysis of a financial portfolio in Python | by Gianluca Malato | Towards Data Science", "h1": "How to perform scenario analysis of a financial portfolio in Python", "description": "Financial investors know that nobody can predict the future, but they also know that they must make at least a probabilistic idea of what the future can be. That\u2019s why scenario analysis is a very\u2026"}, "outgoing_paragraph_urls": [{"url": "http://YourDataTeacher.com", "anchor_text": "YourDataTeacher.com", "paragraph_index": 54}], "all_paragraphs": ["Financial investors know that nobody can predict the future, but they also know that they must make at least a probabilistic idea of what the future can be. That\u2019s why scenario analysis is a very powerful tool in an investor\u2019s toolbox.", "Scenario analysis is a discipline that tries to give a probabilistic view of the possible future scenarios that may happen in relationship to a phenomenon.", "In a previous article, I\u2019ve shown you how to perform portfolio optimization in R using a genetic algorithm. While portfolio optimization is a science, scenario analysis is almost like an art. It often starts from some assumptions and then simulates many future scenarios using Monte Carlo techniques. The higher the number of simulated scenarios, the higher the precision. Finally, the results of all the simulations are analyzed. For example, typical scenario analysis of a financial portfolio can be related to risk (e.g. what\u2019s the probability that our portfolio will lose 3% within 30 days).", "In this article, I\u2019ll show you how to apply scenario analysis to a financial portfolio. For this example, we\u2019ll simulate a portfolio made by Microsoft (50%), Apple (20%) and Google (30%) stocks using their daily historical data from January 1 2010 to December 31 2019. We\u2019ll correct their average return in a more pessimistic way than it was in the past and calculate the cumulative expected return of our portfolio, a confidence interval and the expected Sharpe ratio.", "First of all, we need to install the yfinance library. It allows us to download the stock prices directly from our notebook.", "Then we can import some useful libraries:", "For each stock, we want to calculate the daily return of the close price P from day t to day t+1, which is defined as", "Fortunately, Python series provide the useful pct_change method that calculates this formula for us.", "Let\u2019s define the portfolio composition and the loop that fills a pandas data frame with the daily returns of each stock.", "The returns data frame looks as follows:", "Now we are ready to simulate our data.", "If we want to simulate m days in the future we just have to:", "That\u2019s it. It\u2019s very similar to bootstrap, which is a resampling technique. This method assumes that the future returns are a random resampling from the past returns. It\u2019s a strong approximation, but it can be a good start point.", "This simulation can be easily performed with a single line of code as in the following function:", "If we try to simulate 1000 days, we get:", "Let\u2019s now create the necessary function for simulating a portfolio.", "A portfolio is a combination of returns and weights. Given the returns R\u1d62 of the i-th stock and given the weight w\u1d62 of each stock in the portfolio (all the weights must sum up to 1), the portfolio return R can be expressed as:", "that is the weighted sum of the stock returns.", "This is the function that performs all the calculations starting from the returns data frame we have created before:", "Let\u2019s see what happens if we simulate 10 days of our portfolio:", "This may be enough for portfolio simulation, but we want something more, that is the what-if analysis.", "If we perform portfolio simulation as shown before, we are simply saying that the future returns are a random sample of the past returns. We already know this isn\u2019t completely true. Moreover, maybe we are performing scenario analysis because we want to know what happens if certain conditions will occur. For example, what happens if the average daily return of each stock is lower than its historical value?", "Let\u2019s try to simulate what happens if the average returns drop by -0.0001 for MSFT, -0.001 for AAPL and -0.0005 for GOOG. We must subtract these quantities from each stock and then simulate the future portfolios with the new, modified data.", "We\u2019ll add these corrections directly to the portfolio_composition list (they are the third component of each tuple):", "We can then redefine all the previously defined function.", "This is the function that simulates the modified stocks:", "This is the function that simulates the modified portfolio:", "Finally, we can define a function that performs portfolio simulation many times, generating many possible scenarios:", "Now we are ready to start our simulations and analyze the results.", "Let\u2019s simulate 20 days in the future calculating our statistics on 200 different scenarios.", "We can now run the simulations:", "This function may take some seconds or even minutes if the number of iterations is high.", "Each column is a scenario of a simulated portfolio and each row is a single day in the future.", "Taken the daily returns of a portfolio, we can build the return after N days with the compound interest formula:", "Since the returns are quite small numbers, we can approximate this expression as follows:", "That is, the return after N days is the sum of the returns of the N days.", "We can now calculate some observables from this dataset.", "Scenario analysis can be used as a risk management tool. For this purpose, we may want to calculate the 5th and the 95th percentile of the future cumulative return. The former tells you that there\u2019s a 5% chance that our portfolio will underperform this value, the latter tells you there\u2019s a 5% chance your portfolio will outperform this value. We also want to check how the average portfolio will perform.", "Here follows the code that calculates these 3 curves.", "The bands are the percentiles and the solid line is the average portfolio. As you can see, after 20 days there\u2019s a 5% probability that our portfolio will lose 5.3% (lower band) and there\u2019s a 5% probability that our portfolio return will be greater than 8.3% (upper band). On average, we expect our portfolio to have a 1% return (solid line).", "Another kind of analysis we can perform is the probability that our portfolio will outperform a target return as a function of the day in the future.", "Since probability is an observable value, we\u2019d like to calculate its standard error too.", "If we have a sample probability p (that is, the number of positive occurrences divided by the number N of scenarios), an estimate of its standard error is:", "We can use this value, calculated day by day, to show the error bars in our chart.", "Let\u2019s assume we have a 2% target. The probability of beating this target is calculated by:", "The size of the error bars is calculated with the standard error formula:", "Finally, we can plot the results:", "As you can see, the probability of overperforming our target return increases with time (that\u2019s obviously true since our portfolio has a positive average return). After 20 days, our portfolio will outperform the 2% target with a 38.0 +/- 3.4% probability.", "Finally, we can calculate some statistics related to Sharpe ratio. It\u2019s a very popular performance metric of a portfolio and, for this example, we can calculate the Sharpe ratio of the returns R of a portfolio as follows:", "where E(x) is the expected value and Var(x) is the variance.", "Each of our 200 portfolio scenarios has its own Sharpe ratio, so we can calculate it for each one of them. Then we can plot a histogram and calculate the average value.", "In this article, I\u2019ve shown you how to perform a simple scenario analysis for a financial portfolio in Python. This approach can be adapted to many problems and scenarios (e.g. increasing volatility, black swans, a crisis of some industries) in order to assess the possible future risk of a portfolio and its ability to grow up.", "This tool could be easily mixed with portfolio optimization in order to assess a complete analysis of financial asset allocation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Theoretical Physicists, Data Scientist and fiction author. I teach Data Science, statistics and SQL on YourDataTeacher.com. E-mail: gianluca@gianlucamalato.it"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc2a68f05dd1f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://gianlucamalato.medium.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Gianluca Malato"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f015e9ee21d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&user=Gianluca+Malato&userId=1f015e9ee21d&source=post_page-1f015e9ee21d----c2a68f05dd1f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markusspiske?utm_source=medium&utm_medium=referral", "anchor_text": "Markus Spiske"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/gianlucamalato/machinelearning/blob/master/Portfolio_scenario_analysis.ipynb", "anchor_text": "https://github.com/gianlucamalato/machinelearning/blob/master/Portfolio_scenario_analysis.ipynb"}, {"url": "https://medium.com/the-trading-scientist/portfolio-optimization-in-r-using-a-genetic-algorithm-8726ec985b6f", "anchor_text": "https://medium.com/the-trading-scientist/portfolio-optimization-in-r-using-a-genetic-algorithm-8726ec985b6f"}, {"url": "https://medium.com/data-science-reporter/the-bootstrap-the-swiss-army-knife-of-any-data-scientist-acd6e592be13", "anchor_text": "https://medium.com/data-science-reporter/the-bootstrap-the-swiss-army-knife-of-any-data-scientist-acd6e592be13"}, {"url": "https://en.wikipedia.org/wiki/Binomial_distribution", "anchor_text": "https://en.wikipedia.org/wiki/Binomial_distribution"}, {"url": "https://en.wikipedia.org/wiki/Sharpe_ratio", "anchor_text": "https://en.wikipedia.org/wiki/Sharpe_ratio"}, {"url": "https://medium.com/tag/finance?source=post_page-----c2a68f05dd1f---------------finance-----------------", "anchor_text": "Finance"}, {"url": "https://medium.com/tag/python?source=post_page-----c2a68f05dd1f---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/portfolio?source=post_page-----c2a68f05dd1f---------------portfolio-----------------", "anchor_text": "Portfolio"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----c2a68f05dd1f---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c2a68f05dd1f---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&user=Gianluca+Malato&userId=1f015e9ee21d&source=-----c2a68f05dd1f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&user=Gianluca+Malato&userId=1f015e9ee21d&source=-----c2a68f05dd1f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc2a68f05dd1f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c2a68f05dd1f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c2a68f05dd1f--------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gianluca Malato"}, {"url": "https://gianlucamalato.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.8K Followers"}, {"url": "http://YourDataTeacher.com", "anchor_text": "YourDataTeacher.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f015e9ee21d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&user=Gianluca+Malato&userId=1f015e9ee21d&source=post_page-1f015e9ee21d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fadb09bc451d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-perform-scenario-analysis-of-a-financial-portfolio-in-python-c2a68f05dd1f&newsletterV3=1f015e9ee21d&newsletterV3Id=adb09bc451d&user=Gianluca+Malato&userId=1f015e9ee21d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}