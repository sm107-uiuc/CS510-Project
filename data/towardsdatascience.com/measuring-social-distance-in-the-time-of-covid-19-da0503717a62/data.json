{"url": "https://towardsdatascience.com/measuring-social-distance-in-the-time-of-covid-19-da0503717a62", "time": 1683011248.331813, "path": "towardsdatascience.com/measuring-social-distance-in-the-time-of-covid-19-da0503717a62/", "webpage": {"metadata": {"title": "Measuring social distance using TensorFlow in the time of COVID-19 - IMMUNE Technology Institute | Towards Data Science", "h1": "Measuring social distance in the time of Covid-19", "description": "Measuring social distance using TensorFlow Object Detection API in the time of COVID-19."}, "outgoing_paragraph_urls": [{"url": "https://immune.institute/en/?utm_campaign=IMMUNE&utm_source=Embajador", "anchor_text": "Immune Technology Institute", "paragraph_index": 0}, {"url": "https://www.tensorflow.org/tutorials/images/transfer_learning", "anchor_text": "behind transfer learning", "paragraph_index": 3}, {"url": "https://github.com/alejandrods/Social-Distance-Using-TensorFlow-API-Object", "anchor_text": "GitHub", "paragraph_index": 7}, {"url": "https://github.com/tensorflow/models/tree/r1.13.0", "anchor_text": "r1.13.0", "paragraph_index": 11}, {"url": "https://github.com/protocolbuffers/protobuf", "anchor_text": "these instructions.", "paragraph_index": 20}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md", "anchor_text": "other models", "paragraph_index": 24}, {"url": "https://immune.institute/en/?utm_campaign=IMMUNE&utm_source=Embajador", "anchor_text": "Immune Technology Institute", "paragraph_index": 41}, {"url": "https://immune.institute/en/data-science?utm_campaign=MDS2021_2&utm_source=Embajador", "anchor_text": "Master in Data Scienc", "paragraph_index": 42}, {"url": "https://tech.immune.institute/sesion-informativa-data-science?utm_campaign=MDS2021_2&utm_source=Embajador", "anchor_text": "live session", "paragraph_index": 43}, {"url": "https://medium.com/u/3b43171da13b?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Alejandro Diaz Santos", "paragraph_index": 44}, {"url": "https://www.linkedin.com/in/alex-diaz-santos-8aab812a/", "anchor_text": "LinkedIn", "paragraph_index": 44}, {"url": "https://github.com/alejandrods", "anchor_text": "GitHub", "paragraph_index": 44}], "all_paragraphs": ["Today, unfortunately, everyone is familiar with the term \u201csocial distance\u201d. It\u2019s something we will have to live with for a while until everything returns to normal. At Immune Technology Institute we have tried to develop an application using the TensorFlow Object Detection API for identifying and measuring the social distance between pedestrians.", "The TensorFlow Object Detection API is the framework for creating a deep learning network that solves object detection problems. It contains some pre-trained models trained on different datasets which can be used for inference.", "Additionally, we can use this framework for applying transfer learning in pre-trained models that were previously trained on large datasets which enables us to customize these models for a certain task. For instance, we can apply transfer learning to train a model for identifying if a person is wearing a mask or not.", "The intuition behind transfer learning for image classification is that if a model is trained on a large and general enough dataset, this model will effectively serve as a generic model of the visual world. You can then take advantage of these learned feature maps without having to start from scratch by training a large model on a large dataset.", "In this case, we did not need to apply transfer learning since we want to identify pedestrians, and there are already some models trained to inference this. We have used the model ssd_mobilenet_v2_coco_2018_03_29 which has been trained on these objects:", "For this use case, we only need to identify and display pedestrians, therefore we will create a function for filtering predictions by label and we are only going to display the person (id=1) labels.", "When I developed this code the TensorFlow Object Detection API had not full support for TensorFlow 2 but on July 10th Google released a new version, developing support for some new functionalities. In this case, I have used TensorFlow 1 with the release r1.13.0 of TF Object Detection API and all the capacity of Google Colab for this experiment.", "You can find the code in my GitHub.", "First of all, we need to create our working directory, called Projects/Pedestrian_Detection in our Drive, where we will clone the TensorFlow Object Detection API repository. Then, we will able to start a notebook with Google Colab.", "First of all, we need to mount our drive inside our notebook, we just need to follow the instructions.", "Then, we\u2019ll be able to change thepath to our root folder Projects/Pedestrian_Detection.", "Now, we can clone the repository of TF Object Detection, in this case the release r1.13.0.", "Why did I use this release? \ud83d\ude04 Basically, because I have tested some other releases but I have found some bugs and this is the first one I tested it and it worked perfectly.", "Once you clone the repository you will see a folder called Models in the directory: Projects/Pedestrian_Detection.", "The guys from TensorFlow are very nice people and they have provided us a notebook to walk you through the process of using a pre-trained model to detect objects in an image (you can find it here: Projects/Pedestrian_Detection/models/research/object_detection/colab_tutorials). However, we will create our own notebook because we are going to learn how to implement new visualization functions.", "Go to Projects/Pedestrian_Detection/models/research/object_detection in Drive and create a new Google Colab in this directory.", "The first thing is to set the TensorFlow version to 1.x.", "As we did before, we should mount our drive image into Google Colab and go to Projects/Pedestrian_Detection/models/research/.", "We will need to install some libraries such as Cython, contextlib2, pillow, lxml, matplotlib, pycocotools and the protocbuf compiler.", "Now we should run the protoc compiler , which is a Google library for serializing structure data which is used by TensorFlow \u2014 think XML, but smaller, faster, and simpler.", "Protoc is already installed in Google Colab but if you are using your own machine you have to follow these instructions.", "Wait\u2026What did protoc do? Basically, protoc has generated a python script for each file in /models/research/object_detection/protos.", "Great!! We are a little closer \u270c\ufe0f. The next step is pretty straight forward since we need to set the PYTHONPATH and install the packages using setup.py.", "In the end, you should see something like this:", "One second\u2026 We need a model, right? Yeep! We need to download a pre-trained model, in this case I have chosen this one: ssd_mobilenet_v2_coco_2018_03_29 because it is fast (important in a real-time application) and has great accuracy. However, you can explore how other models perform and select the right one for your application.", "If everything has worked correctly you will be able to use the TensorFlow Object Detection API. The next step is to import the libraries that we are going to use.", "Currently, we are able to load our pre-trained model, we just need to define the PATH_TO_FROZEN_GRAPH, which is the path to our model, and the PATH_TO_LABELS which is the path to the labels.", "Label indices are mapped to category names, so that when our convolution network predicts 1, we know that this corresponds to person. Here we use internal utility functions, but anything that returns a dictionary mapping integers to appropriate string labels would be fine.", "The function run_inference_for_single_image takes as arguments an image and our model, running the inference for our image. This function returns a dictionary output_dict, which contains the coordinates and the label for each object detected in the image.", "As we said before, our model is going to predict any object contained in the category_index. However, we only want to display a category in particular: person. Therefore, we have created a function to filter our predictions based on a threshold, min_score and the label id, categories. In this case the id for the person label is 1. (we can check this in category_index).", "We already have a model running inferences which returns a dictionary output_dict with the predictions. We want to measure the distance between these predicted objects but this is not a trivial solution. Therefore, we have created some functions to calculate the distance between the centroids of each predicted boxes. These are the steps:", "Now that we have defined these functions, we can create the main function called show_inference which will run the prediction for images and display the boxes and distances between pedestrians.", "The first part of the function is responsible for getting the image and running the inference. We will get a dictionary output_dict with the boxes that the model has predicted.", "Then, we will set the confidence_cutoff=0.5 to avoid displaying low accuracy predictions. In parallel, we will get the size of our image and we will need to set a relation \u201cpixel-meter\u201d to calculate the distance correctly. I have checked some images and I considered that width \u2014 150px = 7 meters is a good relation. This part is complicated because we don\u2019t take into account the perspective or the camera angle, it is a difficult problem to solve for all images and I encourage you to improve it and share your solution with us \ud83d\ude04.", "Finally, we can calculate all centroids for our predictions and generate the permutations. Then, we will be able to create the lines dx,dy that connect the centroids and display the distance.", "To sum up, this is the final status of this function.", "After all this work, we are able to generate some example images. We just need to add our images to this folder: ../Projects/Pedestrian_Detection/models/research/test_images", "Wow! It looks pretty good but it would be even cooler if we could run this in videos. So, let\u2019s go!", "The code for running the model in videos is the same as for images because we use openCV to split the video in frames and we process each frame as individual images.", "As we did before, we just need to copy our video into ../Projects/Pedestrian_Detection/models/research/test_images and update the path in cap = cv2.VideoCapture(\u2026). Additionally, we can set a name for the FILE_OUTPUT.", "Great Job!! The code is now ready for predicting and measuring social distance.", "We have developed this application because at Immune Technology Institute we try to apply the most advanced technology. We enjoy sharing knowledge since we consider that it is when it becomes powerful.", "If you want to learn how to develop real-world applications such as this application for measuring \u201csocial distance\u201d, you could be interested in our Master in Data Science. It is a program aimed at professionals that seek to specialize in Data Science, know the main Artificial Intelligence techniques and how to apply them into different industries.", "If you are interested in what we do and how we do, join us to this live session. Feel free to take our code and improve it. Share the results with us! \ud83d\ude04", "This article and code have been written by: Alejandro Diaz Santos\u2014 (LinkedIn, GitHub) for IMMUNE Technology Institute.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fda0503717a62&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----da0503717a62--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@alejandrods?source=post_page-----da0503717a62--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alejandrods?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Alex Diaz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3b43171da13b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&user=Alex+Diaz&userId=3b43171da13b&source=post_page-3b43171da13b----da0503717a62---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://immune.institute/en/?utm_campaign=IMMUNE&utm_source=Embajador", "anchor_text": "Immune Technology Institute"}, {"url": "https://www.tensorflow.org/tutorials/images/transfer_learning", "anchor_text": "behind transfer learning"}, {"url": "https://github.com/alejandrods/Social-Distance-Using-TensorFlow-API-Object", "anchor_text": "GitHub"}, {"url": "https://github.com/tensorflow/models/tree/r1.13.0", "anchor_text": "r1.13.0"}, {"url": "https://github.com/protocolbuffers/protobuf", "anchor_text": "these instructions."}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md", "anchor_text": "other models"}, {"url": "https://immune.institute/en/?utm_campaign=IMMUNE&utm_source=Embajador", "anchor_text": "Immune Technology Institute"}, {"url": "https://immune.institute/en/data-science?utm_campaign=MDS2021_2&utm_source=Embajador", "anchor_text": "Master in Data Scienc"}, {"url": "https://tech.immune.institute/sesion-informativa-data-science?utm_campaign=MDS2021_2&utm_source=Embajador", "anchor_text": "live session"}, {"url": "https://medium.com/u/3b43171da13b?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Alejandro Diaz Santos"}, {"url": "https://www.linkedin.com/in/alex-diaz-santos-8aab812a/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/alejandrods", "anchor_text": "GitHub"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----da0503717a62---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----da0503717a62---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----da0503717a62---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/python?source=post_page-----da0503717a62---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/technology?source=post_page-----da0503717a62---------------technology-----------------", "anchor_text": "Technology"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&user=Alex+Diaz&userId=3b43171da13b&source=-----da0503717a62---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&user=Alex+Diaz&userId=3b43171da13b&source=-----da0503717a62---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----da0503717a62--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fda0503717a62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----da0503717a62---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----da0503717a62--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----da0503717a62--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----da0503717a62--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----da0503717a62--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----da0503717a62--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alejandrods?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alejandrods?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alex Diaz"}, {"url": "https://medium.com/@alejandrods/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "128 Followers"}, {"url": "https://medium.com/@immune_technology_institute", "anchor_text": "https://medium.com/@immune_technology_institute"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3b43171da13b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&user=Alex+Diaz&userId=3b43171da13b&source=post_page-3b43171da13b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb9a177424e1e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmeasuring-social-distance-in-the-time-of-covid-19-da0503717a62&newsletterV3=3b43171da13b&newsletterV3Id=b9a177424e1e&user=Alex+Diaz&userId=3b43171da13b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}