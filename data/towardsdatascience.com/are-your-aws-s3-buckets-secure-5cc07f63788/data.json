{"url": "https://towardsdatascience.com/are-your-aws-s3-buckets-secure-5cc07f63788", "time": 1683007879.546473, "path": "towardsdatascience.com/are-your-aws-s3-buckets-secure-5cc07f63788/", "webpage": {"metadata": {"title": "Are Your AWS S3 Buckets Secure ? | Towards Data Science", "h1": "Are Your AWS S3 Buckets Secure ?", "description": "Learn to unleash full potential of IAM policies and start utilising the 'Condition' policy element"}, "outgoing_paragraph_urls": [{"url": "http://169.254.169.254.", "anchor_text": "http://169.254.169.254.", "paragraph_index": 6}, {"url": "https://policysim.aws.amazon.com/home/index.jsp?#", "anchor_text": "AWS Policy Simulator", "paragraph_index": 9}, {"url": "https://www.w3.org/TR/NOTE-datetime", "anchor_text": "ISO 8601", "paragraph_index": 11}, {"url": "https://gist.github.com/akskap/3ccdae007c2c4c9de063c422aa61d96f", "anchor_text": "here", "paragraph_index": 18}], "all_paragraphs": ["An important aspect of defining IAM security policies which people often tend to miss is, reducing the blast radius \u2014 which effectively means, how can you further reduce/nullify the damage in scenarios of an access leak. Approaching security definitions from this perspective can often help you consider additional factors to limit the damage when a security breach happens.", "Security in general drills down to two things: Authentication & Authorisation. Authentication defines who you are, and Authorisation defines what you can do (after authenticated). When working with AWS cloud, IAM (Identity and Access Management) plays the gatekeeper role, thus taking care of the two dimensions we discussed. IAM Policies manage the Authorisation part and are really important to restrict what users can/cannot do.", "In this post, I want to discuss a list of bare minimum steps that you should be considering when giving someone access to your AWS resources. Let\u2019s define a sample problem statement with the most commonly used AWS service, S3", "A user from a different AWS account, running some workflows in EC2 instances\u2019 needs to access your S3 objects between specific date and time intervals. Access is further restricted to list files with a certain prefix, and only download the ones which have a specific tag associated. The traffic should also originate from a whitelisted network", "To start with, it\u2019s usually a good practice to separate out the S3 bucket and object related permissions into separate sections. AWS refers to them as Statements in the policy document.", "Or in AWS terms, who is the principal. As a best practice, let\u2019s assume that there are no access keys provisioned and injected into the consumer EC2 instance. Instead, there is an IAM role which would be assumed in order to access S3 resources. To define the principal, you can extend the policy template, as given below:", "At this point, a service like EC2, which is mapped to an IAM role arn:aws:iam::<requester_account_id>:roleaccess-s3-objects can get dynamic temporary credentials from the instance metadata endpoint at http://169.254.169.254. This is automatically handled by official SDKs and CLIs, so user need not worry about it.", "The problem statement above mentions a S3 bucket which needs to be accessed from a different account. This becomes the Resource element in the IAM Policy. Let\u2019s assume the name of the private bucket to be my-test-bucket", "For different Sections, you can define the Resource elements appropriately. First referring to the bucket as a whole, second referring to the objects inside", "This is defined by the Action element in the IAM Policy structure. It\u2019s very important to follow the principal of Least Privilege here and avoid something like s3:* at all costs. Additionally, simple tests can be done using AWS Policy Simulator for mocking/debugging needs.", "For this scenario, user just needs to have 3 basic permissions of s3:List ucketVersions, s3:ListBucket and s3:GetObject", "Conditions put IAM policies on steroids. You can now start playing with the granular control which they allow you to enforce. In this example, let\u2019s say you want to only allow the requests between 2020-04-01T00:00:00Z and 2020-05-30T23:59:59Z . You can use any ISO 8601 format to define these timelines. There are two flavours for Conditional keys : Global and Service specific. After introducing these the IAM Policy looks like:", "This is super helpful if you want to allow temporary access to an outside entity which automatically expires at a pre-defined time.", "Let\u2019s assume the outgoing NAT Gateway, or instance public IP is 13.126.87.165 . You can restrict the traffic originating from just this source.", "As described in the problem statement, you further want to control the resource access which should be just limited to some prefixes in the bucket. With this approach, you can restrict what different users see, and what they can further download from that set. Let\u2019s say you just want to restrict the ability to list the folders with prefixes, test/ andtest/sample-folder", "Further, user should be able to only download objects which have a tag available:yes", "This can be achieved with other interesting conditional keys:", "It\u2019s important to note here, that S3 in the web console looks like a typical directory structure. However, internally it is just name prefixes using which you can refer to the individual objects.", "The complete IAM Policy gist is available here, if you wish to copy or edit it.", "At this point, I am sure you are less afraid even if you loose your access keys, as the depth of granular policy definition makes it super difficult for a hacker to tick all boxes before getting access to your confidential data.", "I hope this post helps you define more secure IAM policies next time. It would be great to hear your comments and other use-cases which you have accomplished.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Cloud Solutions and DevOps | DISCLAIMER: Opinions expressed are solely my own and do not express the views or opinions of my employer"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5cc07f63788&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5cc07f63788--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@akskap?source=post_page-----5cc07f63788--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Akshay Kapoor"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffc66d24e947c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&user=Akshay+Kapoor&userId=fc66d24e947c&source=post_page-fc66d24e947c----5cc07f63788---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@chrispanas?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "chris panas"}, {"url": "https://unsplash.com/s/photos/security?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://169.254.169.254.", "anchor_text": "http://169.254.169.254."}, {"url": "https://policysim.aws.amazon.com/home/index.jsp?#", "anchor_text": "AWS Policy Simulator"}, {"url": "https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition.html", "anchor_text": "Conditions"}, {"url": "https://www.w3.org/TR/NOTE-datetime", "anchor_text": "ISO 8601"}, {"url": "https://gist.github.com/akskap/3ccdae007c2c4c9de063c422aa61d96f", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/best-practices-for-securing-aws-ec2-instances-4bd656e22462", "anchor_text": "security practices around EC2 usage"}, {"url": "https://medium.com/faun/forget-your-passwords-forever-73cb7f9421eb", "anchor_text": "passwords efficiently"}, {"url": "https://medium.com/tag/aws?source=post_page-----5cc07f63788---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/security?source=post_page-----5cc07f63788---------------security-----------------", "anchor_text": "Security"}, {"url": "https://medium.com/tag/cloud?source=post_page-----5cc07f63788---------------cloud-----------------", "anchor_text": "Cloud"}, {"url": "https://medium.com/tag/s3?source=post_page-----5cc07f63788---------------s3-----------------", "anchor_text": "S3"}, {"url": "https://medium.com/tag/programming?source=post_page-----5cc07f63788---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&user=Akshay+Kapoor&userId=fc66d24e947c&source=-----5cc07f63788---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&user=Akshay+Kapoor&userId=fc66d24e947c&source=-----5cc07f63788---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5cc07f63788&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5cc07f63788---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5cc07f63788--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5cc07f63788--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5cc07f63788--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5cc07f63788--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5cc07f63788--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@akskap?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Akshay Kapoor"}, {"url": "https://medium.com/@akskap/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "212 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffc66d24e947c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&user=Akshay+Kapoor&userId=fc66d24e947c&source=post_page-fc66d24e947c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc12538f7710&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fare-your-aws-s3-buckets-secure-5cc07f63788&newsletterV3=fc66d24e947c&newsletterV3Id=c12538f7710&user=Akshay+Kapoor&userId=fc66d24e947c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}