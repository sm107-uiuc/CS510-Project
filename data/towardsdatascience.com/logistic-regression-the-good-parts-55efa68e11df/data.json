{"url": "https://towardsdatascience.com/logistic-regression-the-good-parts-55efa68e11df", "time": 1682994870.988962, "path": "towardsdatascience.com/logistic-regression-the-good-parts-55efa68e11df/", "webpage": {"metadata": {"title": "Logistic Regression: The good parts | by Thalles Silva | Towards Data Science", "h1": "Logistic Regression: The good parts", "description": "Binary and Multiclass Logistic Regression with GD and Newton\u2019s Method"}, "outgoing_paragraph_urls": [{"url": "https://medium.freecodecamp.org/an-illustrative-introduction-to-fishers-linear-discriminant-9484efee15ac?source=friends_link&sk=842b291dc6304d477b278c7aa622ec23", "anchor_text": "Machine Learning classification through the lens of dimensionality reduction", "paragraph_index": 0}, {"url": "https://github.com/sthalles/logistic-regression", "anchor_text": "Colab notebooks", "paragraph_index": 10}, {"url": "https://sthalles.github.io/", "anchor_text": "https://sthalles.github.io/", "paragraph_index": 66}], "all_paragraphs": ["In the last post, we tackled the problem of Machine Learning classification through the lens of dimensionality reduction. We saw how Fisher\u2019s Linear Discriminant can project data points from higher to smaller dimensions. The projection follows two principles.", "Even though Fisher\u2019s method is not (in essence) a discriminant, we built one by modeling a class conditional distribution using a Gaussian. First, we found the prior class probabilities p(Ck). Then, we used Bayes theorem to find the posterior class probabilities p(Ck|x). Here, x is the input vector and Ck is the label for class k.", "In short, we can categorize ML models based on the way they classify data. There are two types: generative and discriminative methods.", "Generative methods learn the posterior class probabilities explicitly. As opposed to it, discriminative algorithms learn the posterior class probabilities directly.", "Intuitively, it has a nice geometrical interpretation. For each class, generative models are concerned to find a probabilistic representation of the data. On the contrary, discriminative algorithms focus on separating the data by decision boundaries.", "In other words, generative models try to explain the data by building a statistical model for each class.", "On the other hand, the goal of a discriminative algorithm is to find an optimal decision boundary that separates the classes. Thus, as long as there is a decision surface, such models do not care about the distributions of the data.", "Take a binary classification problem as an example. Given an input vector x, we need to decide to which class Ck, x is most likely to belong to. To make this decision, both types of ML algorithms need a way to compute the posterior probability p(Ck|x) from the training data.", "For Fisher\u2019s, we explicitly learned posterior class probabilities using a Gaussian. Once we found it, we used decision theory to determine class membership for x.", "For a discriminative model, the posterior p(Ck|x) will be directly derived. In this case, once we have the posterior, we can use decision theory and assign x to the most probable class.", "Before we begin, make sure you follow along with these Colab notebooks.", "Logistic Regression is probably the best known discriminative model. As such, it derives the posterior class probability p(Ck|x) implicitly.", "For binary classification, the posterior probabilities are given by the sigmoid function \u03c3 applied over a linear combination of the inputs \u03d5.", "Similarly, for multiclass problems, we can estimate the posterior using the softmax function. Like the sigmoid, softmax normalizes a given vector to probabilities \u2014 values between 0 and 1.", "Let\u2019s begin with the case of binary classification.", "For an M-dimensional input feature-vector, Logistic Regression has to learn M parameters.", "Take the SVHN dataset as an example. Each RGB image has a shape of 32x32x3. Thus, logistic regression needs to learn 32x32x3=3072 parameters.", "To find these parameters, we usually optimize the cross-entropy error function.", "The cross-entropy measures how far the model\u2019s predictions are from the labels. It increases when the predicted values deviate from the true values and decrease otherwise.", "Assuming target values t to be either 0 or 1, cross-entropy is defined as:", "Here, N denotes the total number of instances in the dataset and y\u1d62 are the model's probabilities.", "Cross-entropy compares 2 probability distributions. Because of that, it is important to note that the output of logistic regression is interpreted as probabilities \u2014 even during learning.", "Taking the derivative of the cross-entropy with respect to the weight vector w, we get the gradient.", "Note that to compute this derivative, we need the derivative of the sigmoid function w.r.t weights w. Luckily, one nice property of the sigmoid is that we can express its derivative in terms of itself.", "The gradient is a vector-valued function. In fact, the gradient is a linear transformation that maps input vectors to other vectors of the same shape.", "The gradient captures the derivative of a whole multi-variable function. Each one of its values denotes the direction in which we can change one specific weight so that we can reach the maximum point of a function. Thus, the gradient represents the direction of steepest ascent.", "For multiclass classification, only a few things change. Now, we can model the posterior probabilities using a softmax function.", "Since logistic regression treats its predictions as probabilities, we need to change the way we represent our labels. Up to this point, the target/label vector is usually represented as a vector of integers. Each value representing a different class. If we want them to be equally valued probabilities, they need to be between 0 and 1. To do this, we can change their representation to one-hot-encodings.", "This time, for inputs with M features and K different classes, logistic regression learns MxK parameters. We can view it as a matrix.", "Now, we can proceed similarly to the case of binary classification. First, we take the derivative of the softmax with respect to the activations. Then, the negative logarithm of the likelihood gives us the cross-entropy function for multi-class classification.", "In practice, cross-entropy measures the distance between two vectors of probabilities. One, that comes out of the softmax. And a second containing the one-hot-encoding representations of the true target values.", "Note the difference between the error functions used for binary and multiclass classification. In reality, they are really the same thing.", "The binary cross-entropy treats the targets as scalars. They take either 0 or 1. For multiclass classification, targets are represented as one-hot-encoded vectors.", "Finally, we take the gradient of the error function w.r.t the weights w and obtain the following gradient vectors.", "Different from linear regression, logistic regression does not have a closed form solution. In other words, for linear regression, we can solve for a point of gradient equal 0 with the following equation:", "For logistic regression, such a closed-form equation does not exist. Thanks to the nonlinearity we apply on the linear combination of the inputs.", "However, the relationship between the loss function and the parameters w still gives us a concave error function. Thus, we can rest assured that there is only a unique minimum on the error surface.", "As a result, we can solve for it using an iterative technique such as gradient descent or Newton-Raphson.", "If we choose gradient descent, we have everything set.", "In plain English, the direction of steepest descent. As such, we can iteratively update the weights w as:", "However, we can do a little better.", "Gradient descent offers the direction of steepest descent to the next critical point. And the learning rate controls the length (magnitude) of the step we take in that direction. Take a look at the following image though.", "Especially in (c), depending on the magnitude of the step we take, we might get our loss function to rather increasing. To avoid this caveat, we take advantage of the information given by the second derivative.", "In practice, instead of only taking the derivative of the cross-entropy, we also take the derivative of its derivative. The second derivative, described by f\u2019\u2019(x), gives information about the curvature of a function.", "With that information, the update step, for minimizing the cross-entropy takes the form of:", "This update equation is called Newton-Raphson.", "Note that it multiplies the inverse of the matrix H\u207b\u00b9 by the gradient. H, or the Hessian, stores the second derivatives of the cross-entropy w.r.t the weights w.", "Let\u2019s now dive into the code.", "Taking this toy dataset as an example.", "There are 210 points in this 2D coordinate system with 3 classes: blue, red and green circles. Since the number of classes is greater than 2, we can use Softmax Logistic Regression.", "First, to introduce the bias variables to our model, we can perform a simple transformation called: fixed basis function. This is done by simply adding a column full of 1s to the input. For binary classification, it makes the corresponding weight value w\u2080 plays the role of the bias. For multiclass, the first column of the weight matrix act as the biases.", "Then, we can create a Logistic Regression object.", "Following sklearn\u2019s based API, we can fit and eval the model", "Note that we can choose between Newton\u2019s and Gradient descent update rules. While Newton\u2019s method tends to converge faster, it needs to compute and store a full Hessian in each iteration. Besides, the Hessian needs to be invertible \u2014 for parameter update.", "For a matrix to be invertible, there are some constraints that must be true.", "First, H has to be a square matrix. Second, the columns of H need to be linearly independent. It means that for any column i of H, i cannot be represented as a linear combination of any other column j.", "That is the same to say that the columns of H span the coordinate system. Or that the determinant of H is non-zero", "Since for really large matrices these constraints are likely not to hold, we can use pseudo-inverse techniques here. That is what the function pinv(H) does on the code above.", "Even though for smaller datasets, this might not be a problem, the Hessian tends to grow as the number of feature and classes increase. To have an idea, using inputs with M features and a dataset with K classes. The full Hessian has shape [M*K, M*K]; which for this example mean: [9x9] \u2014 remember, we added a new feature column to the inputs.", "To close up, have a look at the fitted model using the toy dataset and Newton\u2019s method. The crosses are the test data.", "In summary, generative models are a class of ML algorithms that learn the class probabilities explicitly.", "Discriminative models learn the class probabilities implicitly.", "For binary classification, Logistic Regression uses the sigmoid function to represent the posterior probabilities. For multiclass classification, it uses softmax.", "For more cool stuff on Machine Learning, take a look at:", "Christopher M. Bishop. 2006. Pattern Recognition and Machine Learning (Information Science and Statistics). Springer-Verlag, Berlin, Heidelberg.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Computer Vision & Deep Learning. Personal blog: https://sthalles.github.io/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F55efa68e11df&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----55efa68e11df--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@thalles.silva?source=post_page-----55efa68e11df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thalles.silva?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Thalles Silva"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff8db098eb9ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&user=Thalles+Silva&userId=f8db098eb9ca&source=post_page-f8db098eb9ca----55efa68e11df---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.freecodecamp.org/an-illustrative-introduction-to-fishers-linear-discriminant-9484efee15ac?source=friends_link&sk=842b291dc6304d477b278c7aa622ec23", "anchor_text": "Machine Learning classification through the lens of dimensionality reduction"}, {"url": "https://github.com/sthalles/logistic-regression", "anchor_text": "Colab notebooks"}, {"url": "https://www.deeplearningbook.org/contents/numerical.html", "anchor_text": "Deep Learning"}, {"url": "https://medium.freecodecamp.org/an-illustrative-introduction-to-fishers-linear-discriminant-9484efee15ac", "anchor_text": "An illustrative introduction to Fisher\u2019s Linear DiscriminantTo deal with classification problems with two or more classes, most Machine Learning (ML) algorithms work the same way.medium.freecodecamp.org"}, {"url": "https://medium.freecodecamp.org/an-introduction-to-high-dimensional-hyper-parameter-tuning-df5c0106e5a4", "anchor_text": "An introduction to high-dimensional hyper-parameter tuningBest practices for optimizing ML modelsmedium.freecodecamp.org"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----55efa68e11df---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----55efa68e11df---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----55efa68e11df---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/programming?source=post_page-----55efa68e11df---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----55efa68e11df---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&user=Thalles+Silva&userId=f8db098eb9ca&source=-----55efa68e11df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&user=Thalles+Silva&userId=f8db098eb9ca&source=-----55efa68e11df---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F55efa68e11df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----55efa68e11df---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----55efa68e11df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----55efa68e11df--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----55efa68e11df--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----55efa68e11df--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----55efa68e11df--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thalles.silva?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@thalles.silva?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thalles Silva"}, {"url": "https://medium.com/@thalles.silva/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.4K Followers"}, {"url": "https://sthalles.github.io/", "anchor_text": "https://sthalles.github.io/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff8db098eb9ca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&user=Thalles+Silva&userId=f8db098eb9ca&source=post_page-f8db098eb9ca--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fea9a35433442&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flogistic-regression-the-good-parts-55efa68e11df&newsletterV3=f8db098eb9ca&newsletterV3Id=ea9a35433442&user=Thalles+Silva&userId=f8db098eb9ca&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}