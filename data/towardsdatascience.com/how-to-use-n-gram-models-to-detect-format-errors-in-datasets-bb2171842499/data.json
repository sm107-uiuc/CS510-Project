{"url": "https://towardsdatascience.com/how-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499", "time": 1683004853.111331, "path": "towardsdatascience.com/how-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499/", "webpage": {"metadata": {"title": "How to Use n-gram Models to Detect Format Errors in Datasets | by Dimitris Poulopoulos | Towards Data Science", "h1": "How to Use n-gram Models to Detect Format Errors in Datasets", "description": "Format errors, in the best-case scenario, can break an automated data processing pipeline. In this story, we use n-grams, a language model, to automate error detection."}, "outgoing_paragraph_urls": [{"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "Learning Rate", "paragraph_index": 3}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://www.poetryfoundation.org/poems/47651/after-great-pain-a-formal-feeling-comes-372", "anchor_text": "Emily Dickinson", "paragraph_index": 4}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack", "paragraph_index": 23}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium", "paragraph_index": 23}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn", "paragraph_index": 23}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl", "paragraph_index": 23}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me", "paragraph_index": 25}], "all_paragraphs": ["Format errors, in the best-case scenario, can break an automated data processing pipeline. In the worst case, they introduce logical errors in downstream analytical tasks that are difficult to debug. Spotting such errors is a monotonous and inefficient chore, that kills productivity. Moreover, such a manual process may introduce different types of errors. So, could we automate the process of detecting the corrupted values?", "For instance, consider a dataset D that has millions of rows and contains a Date column. Let us also assume that values in this column conform to a specific pattern: mm.dd.yyyy. Imagine that somewhere exists an invalid cell, where, because of a typo, the date follows a different format: 01.15\u20132019. In an automated pipeline, the parser will try to read that feature and probably throw an exception. Trying to locate that error prior to the pipeline execution is almost impossible. But what if we could let the computer detect it?", "In this story, we use n-grams, a language model, to automate error detection. We briefly talk about n-grams and how NLP engineers use them for language generation and examine how can we harness their properties to identify possibly corrupted values in datasets.", "Learning Rate is a newsletter for those who are curious about the world of AI and MLOps. You\u2019ll hear from me every Friday with updates and thoughts on the latest AI news and articles. Subscribe here!", "An n-gram is a probabilistic model, which, in simple terms, tries to predict the next word in a sequence. Probabilistic models like n-grams are always better understood with an example. Thus, consider the following excerpt of a poem by Emily Dickinson:", "After great pain, a formal feeling comes \u2013The Nerves sit ceremonious, like Tombs \u2013The stiff Heart questions \u2018was it He, that bore,\u2019And \u2018Yesterday, or Centuries before\u2019?", "First, we would like to know where each sentence starts and when it stops. To this end, let us use the special characters <s> to indicate the starting point and </s> to pinpoint the end position.", "<s> After great pain, a formal feeling comes \u2014 </s><s> The Nerves sit ceremonious, like Tombs \u2014 </s><s> The stiff Heart questions \u2018was it He, that bore,\u2019 </s><s> And \u2018Yesterday, or Centuries before\u2019? </s>", "To create an n-gram model first we have to set a specific number for the n hyperparameter. Thus, let n = 2, in which case the n-gram model translates to a bi-gram model. Now, we can calculate the probability of two consecutive words. For example, the sentences in this excerpt usually start with the word the.", "Using these probabilities and given a new word as a seed, we could predict the next word in a sequence. Apparently, the bigger the data set the better the results. Also, depending on the problem 3-grams may work better, but the greater the value of n the more sparsity is introduced.", "In order to use n-grams to detect format errors in tables, we need a way to generalize raw values to patterns. We could also train an n-gram model with the raw values but the complexity of that approach introduces too many degrees of freedom, leading to high sparsity.", "For example, let v\u2081 be a raw sequence of numbers expressing a zip code: 15122. Then, let v\u2082,v\u2083 signify two different codes: 345a7, 47592. Clearly, v\u2082 is erroneous, but if we pass the raw values in an n-gram model we will not get valuable information; see that p(a|5) = p(1|5), thus we either miss the error or produce a false positive. But if we could generalize a raw value into a pattern we could get more meaningful representations.", "To this end, we use the notion of generalization trees and generalization languages. A generalization tree is just a hierarchy like the one below, mapping raw values to a different representation.", "From that tree, we can derive many languages. An example is given below.", "Using L\u2081 we can transform v\u2081,v\u2082,v\u2083 into DDDDD,DDDLD,DDDDD. We could also compress that pattern to v\u2081 = D(5), v\u2082 = D(3)L(1),D(1), v\u2083 = D(5). Having this representation and a big enough dataset to train an n-gram model, we can get that the probability of having a letter L in a zip-code format is very low. That is the idea of generalization trees and languages in a nutshell. If you need a more detailed introduction, see the story below.", "Now it is time to get our hands dirty. For this example, we use a synthetic dataset that contains 100 rows of three features: email, date, zip-code. So, let us load the data using pandas to see what it is like.", "This time, we play with the zip_code column, in which we have introduced certain errors. So, we specify the generalization language we will use. It closely follows the rules defined in L\u2081.", "We use the popular python library nltk, to create 3-grams and build a Maximum Likelihood Estimation model (MLE).", "First, we pad the sequences, as we saw in the first section of this story. Next, we construct a set of 3-grams for every padded sequence (i.e. for every padded zip code pattern). Finally, we use the 3-grams to fit an MLE model.", "To evaluate a zip code and detect any errors we need a score function. Thus, below we define such a function.", "This function takes a raw value, generalizes it to a pattern accordingly, pads it and calculates the score for each 3-gram. In the end, it returns the least probable computed value. This is because we need only one 3-gram to be confident that we have an error. This is a simplistic explanation for this toy example, but if you want to read how you can aggregate the outcomes of many generalization languages read the story below.", "Now, if we pass a valid zip code value to the score method the resulting probability is high: score('15378') = 0.951. On the other hand, if there are any values that contain letters, symbols or more than five numbers the probability drops. For instance, for the first zip code 243x2 has a score of 0.0098.", "In this story, we use a toy example to show how a language model \u2014 n-grams \u2014 can be used for format error detection in a tabular dataset. We briefly explain what n-grams are, and how to use generalization trees and languages to fight the sparsity problem. Finally, we implemented a simple solution that leverages the power of n-grams in combination with a generalization language to detect errors in a synthetic dataset.", "My name is Dimitris Poulopoulos and I\u2019m a machine learning researcher at BigDataStack and PhD(c) at the University of Piraeus, Greece. I have worked on designing and implementing AI and software solutions for major clients such as the European Commission, Eurostat, IMF, the European Central Bank, OECD, and IKEA. If you are interested in reading more posts about Machine Learning, Deep Learning and Data Science, follow me on Medium, LinkedIn or @james2pl on twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning Engineer. I talk about AI, MLOps, and Python programming. More about me: www.dimpo.me"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbb2171842499&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1----bb2171842499---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/users/Ronile-126846/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=359950", "anchor_text": "Ronile"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=359950", "anchor_text": "Pixabay"}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "Learning Rate"}, {"url": "https://mailchi.mp/d2d2d4a109b5/learning-rate-newsletter", "anchor_text": "here"}, {"url": "https://www.poetryfoundation.org/poems/47651/after-great-pain-a-formal-feeling-comes-372", "anchor_text": "Emily Dickinson"}, {"url": "https://towardsdatascience.com/how-to-auto-detect-format-errors-in-a-dataset-6609a9e9aacc", "anchor_text": "How to Auto-Detect Errors in a DatasetIntroducing generalization trees and generalization languages to auto-detect corrupted values in a structured dataset.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/how-to-auto-detect-errors-in-a-dataset-part-ii-683b114865be", "anchor_text": "How to Use Generalization Languages to Auto-Detect Errors in a DatasetGenerate validation data using distant-supervision and aggregate prediction results to find the needle in a haystack.towardsdatascience.com"}, {"url": "https://bigdatastack.eu/", "anchor_text": "BigDataStack"}, {"url": "https://medium.com/@dpoulopoulos", "anchor_text": "Medium"}, {"url": "https://www.linkedin.com/in/dpoulopoulos/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/james2pl", "anchor_text": "@james2pl"}, {"url": "https://medium.com/tag/nlp?source=post_page-----bb2171842499---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/data-science?source=post_page-----bb2171842499---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----bb2171842499---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-cleaning?source=post_page-----bb2171842499---------------data_cleaning-----------------", "anchor_text": "Data Cleaning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----bb2171842499---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----bb2171842499---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=-----bb2171842499---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbb2171842499&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----bb2171842499---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----bb2171842499--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----bb2171842499--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bb2171842499--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----bb2171842499--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----bb2171842499--------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dpoulopoulos.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dimitris Poulopoulos"}, {"url": "https://dpoulopoulos.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12.5K Followers"}, {"url": "http://www.dimpo.me", "anchor_text": "www.dimpo.me"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7cc87df5b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=post_page-7cc87df5b1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb5ab149102ea&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-use-n-gram-models-to-detect-format-errors-in-datasets-bb2171842499&newsletterV3=7cc87df5b1&newsletterV3Id=b5ab149102ea&user=Dimitris+Poulopoulos&userId=7cc87df5b1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}