{"url": "https://towardsdatascience.com/primary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e", "time": 1683000584.052138, "path": "towardsdatascience.com/primary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e/", "webpage": {"metadata": {"title": "Primary Keys and Group By\u2019s \u2014 A Brief SQL Investigation | by Jeremy Chow | Towards Data Science", "h1": "Primary Keys and Group By\u2019s \u2014 A Brief SQL Investigation", "description": "Today an acquaintance asked me an interesting SQL question, but not in the typical query sense; his question revolved more around an understanding of the underlying framework of SQL. Here is the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://pgexercises.com/questions/aggregates/payback.html", "anchor_text": "PostgreSQL exercise page", "paragraph_index": 1}, {"url": "https://wiki.postgresql.org/wiki/Retrieve_primary_key_columns", "anchor_text": "PostgreSQL wiki", "paragraph_index": 10}, {"url": "https://www.postgresql.org/docs/current/sql-select.html#SQL-GROUPBY", "anchor_text": "PostgreSQL help docs", "paragraph_index": 12}, {"url": "https://stackoverflow.com/questions/3913620/get-all-table-names-of-a-particular-database-by-sql-query", "anchor_text": "Stack Overflow user Tony L.", "paragraph_index": 14}], "all_paragraphs": ["Today an acquaintance asked me an interesting SQL question, but not in the typical query sense; his question revolved more around an understanding of the underlying framework of SQL. Here is the context:", "The exercise comes from this PostgreSQL exercise page and has the following schema:", "The SQL question the website is asking isn\u2019t important, but their posted solution is this:", "My friend tried switching the line GROUP BY facs.facid to GROUP BY facs.name, which broke the query with the message:", "The question my friend asked was :", "Why does the above query not work with the lines switched, even if both columns are both unique to each row?", "If you know the answer, congrats, you should answer my question posted at the end! If you\u2019d like to skip to the answer, scroll to \u2018The Answer\u2019 section of this article. Otherwise, let\u2019s go into the thought process of solving this question!", "First, let\u2019s check for the obvious \u2014 Are those columns really unique, and are there multiple combinations of the columns used in our query (name, facid, initialoutlay, monthlymaintenance)? To check this we look at distinct combinations of those columns in the facilities table.", "Name and facid are both unique to each row and 1 to 1, and each pair only has one initialoutlay and monthlymaintenance value. Intuitively, grouping by either of those two columns should be functionally equivalent to grouping by the other. So why doesn\u2019t grouping by name work for this query?", "As you may intuit if you\u2019re familiar with SQL, this is a primary key issue. For those that don\u2019t know, a primary key is the value that uniquely identifies each row of a table, and it can never be \u2018NULL\u2019 for a row. But how do we find the designated primary key of a table?", "A quick google search gives us the following code from the PostgreSQL wiki. Running this on the website\u2019s query section gives the following:", "So facid is a primary key of the facilities table! Now we\u2019ve confirmed the probable cause, but what is the reason grouping by the primary key allows you to throw in columns with no aggregate function like we do with facs.initialoutlay and facs.monthlymaintenance?", "To answer this question we look at the PostgreSQL help docs, specifically for GROUP BY :", "When GROUP BY is present, or any aggregate functions are present, it is not valid for the SELECT list expressions to refer to ungrouped columns except within aggregate functions or when the ungrouped column is functionally dependent on the grouped columns, since there would otherwise be more than one possible value to return for an ungrouped column. A functional dependency exists if the grouped columns (or a subset thereof) are the primary key of the table containing the ungrouped column.", "As a Stack Overflow user Tony L. puts it:", "Grouping by primary key results in a single record in each group which is logically the same as not grouping at all / grouping by all columns, therefore we can select all other columns.", "Essentially this means grouping by the primary key of a table results in no change in rows to that table, therefore if we group by the primary key of a table, we can call on all columns of that table with no aggregate function.", "Let\u2019s reiterate: Given that we\u2019re looking at one table, grouping by its primary key is the same as grouping by everything, which is the same as not grouping at all \u2014 each of these approaches will result in one group per row. Once you understand that, you understand the crux of this problem.", "Because of this, queries like this work:", "These all output the same values! Now we have our solution.", "The reason the first query works is simply that facid is the primary key and name is not. Despite them both being unique to each row, the table facilities was created with facid as the primary key, thus it gets special treatment when used in a group by as covered above.", "Some alternative solutions to what they posted would be:", "That concludes the main question, but if you are interested in exploring more quirks, I ran into the following issue while solving the posted problem. If any of you know why feel free to ping me or leave a comment!", "Thanks for reading, I hope this article helped you out! Feel free to check out my other tutorials and stay posted for new ones in the future!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist passionate about using machine learning to impact business decisions and discover meaningful insights."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe0c3a8b20a6e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jeremyrchow?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jeremyrchow?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Jeremy Chow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf26ba3661a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&user=Jeremy+Chow&userId=caf26ba3661a&source=post_page-caf26ba3661a----e0c3a8b20a6e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pgexercises.com/questions/aggregates/payback.html", "anchor_text": "PostgreSQL exercise page"}, {"url": "https://wiki.postgresql.org/wiki/Retrieve_primary_key_columns", "anchor_text": "PostgreSQL wiki"}, {"url": "https://www.postgresql.org/docs/current/sql-select.html#SQL-GROUPBY", "anchor_text": "PostgreSQL help docs"}, {"url": "https://stackoverflow.com/questions/3913620/get-all-table-names-of-a-particular-database-by-sql-query", "anchor_text": "Stack Overflow user Tony L."}, {"url": "https://medium.com/tag/programming?source=post_page-----e0c3a8b20a6e---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----e0c3a8b20a6e---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/sql?source=post_page-----e0c3a8b20a6e---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/database?source=post_page-----e0c3a8b20a6e---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e0c3a8b20a6e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&user=Jeremy+Chow&userId=caf26ba3661a&source=-----e0c3a8b20a6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&user=Jeremy+Chow&userId=caf26ba3661a&source=-----e0c3a8b20a6e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe0c3a8b20a6e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e0c3a8b20a6e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e0c3a8b20a6e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jeremyrchow?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jeremyrchow?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jeremy Chow"}, {"url": "https://medium.com/@jeremyrchow/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "300 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fcaf26ba3661a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&user=Jeremy+Chow&userId=caf26ba3661a&source=post_page-caf26ba3661a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F5950ea45395a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fprimary-keys-and-group-bys-a-brief-sql-investigation-e0c3a8b20a6e&newsletterV3=caf26ba3661a&newsletterV3Id=5950ea45395a&user=Jeremy+Chow&userId=caf26ba3661a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}