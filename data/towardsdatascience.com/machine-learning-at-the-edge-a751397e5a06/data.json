{"url": "https://towardsdatascience.com/machine-learning-at-the-edge-a751397e5a06", "time": 1683010178.5372071, "path": "towardsdatascience.com/machine-learning-at-the-edge-a751397e5a06/", "webpage": {"metadata": {"title": "Machine Learning at the Edge!. Getting Machine Learning/image\u2026 | by Peter Gaston | Towards Data Science", "h1": "Machine Learning at the Edge!", "description": "By the way, my ML model processes images for depth estimation to provide perception capabilities for an autonomous robot. The machine learning model used is based on Fast Depth from MIT. This is a\u2026"}, "outgoing_paragraph_urls": [{"url": "http://fastdepth.mit.edu/", "anchor_text": "Fast Depth from MIT", "paragraph_index": 1}, {"url": "https://lutzroeder.github.io/netron/", "anchor_text": "Netron", "paragraph_index": 15}], "all_paragraphs": ["So, I have a working machine learning (ML) model that I want to move to the edge.", "By the way, my ML model processes images for depth estimation to provide perception capabilities for an autonomous robot. The machine learning model used is based on Fast Depth from MIT. This is a U-Net architecture focused on speed. It uses a MobileNet encoder and a matching decoder with skip connections.", "It was developed using Keras (PyTorch at first) on Python with a CUDA backend.", "By moving to the edge, I mean I needed this running on a small CPU/GPU (Qualcomm 820) running an embedded Linux where the GPU (Adreno 530) can only be accessed via OpenCL (i.e., not CUDA.)", "Caveat \u2014 If you\u2019re on iOS or Android you\u2019re already relatively home free. This article is for getting machine learning on the GPU on embedded Linux using OpenCL.", "Travels to Find a Workable Solution", "This is going to be easy. Hah! Turns out once you leave CUDA behind you\u2019re in the wilderness\u2026", "There are really two broad approaches to deploying a model at the edge.", "Through googling as well as references, I came across a laundry list of potential approaches.", "Again, I have a Keras model that I want to run as fast as possible on a Qualcomm 820 GPU (actually the Adreno 530 is the GPU) on embedded Linux. No quantized approaches were evaluated.", "Here is the world I explored: (i.e., lots and lots of \u2018dead ends\u2019)", "Build your own working solution on MACE", "Here are the rough steps to get your model running on the GPU (on an embedded Linux system using OpenCL!) This is pretty much a voice-over on their documentation, with a few key hints tossed in.", "All of that is a one-time, startup event (once it works).", "Now, to get the MACE conversion of your Keras model\u2026", "Oh, wait. It turns out that MACE only supports Tensorflow up to, roughly v1.14. And no Keras at all. So I had to convert my Keras model to Tensorflow of the right vintage. This was some work, basically making the exact same model in Tensorflow and then copying over the weights. And iterating, because nothing is ever that easy. A good tool is Netron for looking inside and comparing the nitty-gritty of your models.", "An optimization is that you can also easily add image preprocessing for performance gains. For example, these lines are not in the Keras model, only upfront in the Tensorflow model. This allows us to move preprocessing off the CPU and onto the GPU, specifically an image resize and data normalization.", "3. Test your conversion. Okay, MACE sort of fell down here. Turns out the Linux version didn\u2019t really work without some jumping in to move things. What should work is\u2026", "But it doesn\u2019t. It turns out their script fails. (Fix \u2014 You need to manually move the \u2018/tmp/mace_run/yourmodel/validate_in/xxx\u2019 up one level\u2026 and then do the ./mace_run command that\u2019s in their script.)", "And lastly, write your C++ code to run on your target environment. I was running inside of a ROS node that listened for new camera image events. This node would process them and create a depth cloud output for downstream processing by, say an Octomap.", "The key parts of calling the MACE inference engine included:", "The real good news. I was hoping for 10 frames per second. Even after adding in the image pre-processing shown previously (normally in the C++ code) I finally ended up achieving 25 fps. Awesome. So much so that other parts of the overall system became the gating factor. I actually have to throttle down the execution of the ML inferencing so as to not overload other parts of the system!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Consultant in AI covering Fashion Science, Perception, and Financial Services. Background includes McKinsey & Co. and MIT (SM/SB in Artificial Intelligence.)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa751397e5a06&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a751397e5a06--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@peter.gaston?source=post_page-----a751397e5a06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@peter.gaston?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Peter Gaston"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F89126c3d969b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&user=Peter+Gaston&userId=89126c3d969b&source=post_page-89126c3d969b----a751397e5a06---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://fastdepth.mit.edu/", "anchor_text": "Fast Depth from MIT"}, {"url": "https://github.com/XiaoMi/mace", "anchor_text": "https://github.com/XiaoMi/mace"}, {"url": "https://lutzroeder.github.io/netron/", "anchor_text": "Netron"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a751397e5a06---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/edge-computing?source=post_page-----a751397e5a06---------------edge_computing-----------------", "anchor_text": "Edge Computing"}, {"url": "https://medium.com/tag/gpu?source=post_page-----a751397e5a06---------------gpu-----------------", "anchor_text": "Gpu"}, {"url": "https://medium.com/tag/keras?source=post_page-----a751397e5a06---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----a751397e5a06---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&user=Peter+Gaston&userId=89126c3d969b&source=-----a751397e5a06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&user=Peter+Gaston&userId=89126c3d969b&source=-----a751397e5a06---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa751397e5a06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a751397e5a06---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a751397e5a06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a751397e5a06--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a751397e5a06--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a751397e5a06--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a751397e5a06--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@peter.gaston?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@peter.gaston?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Peter Gaston"}, {"url": "https://medium.com/@peter.gaston/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "44 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F89126c3d969b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&user=Peter+Gaston&userId=89126c3d969b&source=post_page-89126c3d969b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb3317909b127&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-at-the-edge-a751397e5a06&newsletterV3=89126c3d969b&newsletterV3Id=b3317909b127&user=Peter+Gaston&userId=89126c3d969b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}