{"url": "https://towardsdatascience.com/how-to-build-an-image-duplicate-finder-f8714ddca9d2", "time": 1682993996.004716, "path": "towardsdatascience.com/how-to-build-an-image-duplicate-finder-f8714ddca9d2/", "webpage": {"metadata": {"title": "How to build an image duplicate finder for your dataset | by Francisco Ingham | Towards Data Science", "h1": "How to build an image duplicate finder for your dataset", "description": "When you download images from the internet you usually find noisy data. Furthermore, popular pictures are all around the place. It is tedious to see them one by one and try to find duplicates to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/fastai/fastai", "anchor_text": "fastai", "paragraph_index": 1}, {"url": "https://docs.fast.ai/callbacks.hooks.html", "anchor_text": "hook", "paragraph_index": 2}, {"url": "http://deeplearning.stanford.edu/tutorial/supervised/Pooling/", "anchor_text": "pooling", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Cosine_similarity", "anchor_text": "cosine similarity function", "paragraph_index": 7}, {"url": "https://github.com/fpingham/duplicate-finder/blob/master/duplicates_v5.ipynb", "anchor_text": "repo", "paragraph_index": 8}, {"url": "http://www.robots.ox.ac.uk/~vgg/data/pets/", "anchor_text": "Oxford-IIIT Pet Dataset", "paragraph_index": 8}, {"url": "https://github.com/fpingham/dataset-cleaner", "anchor_text": "tutorial notebook", "paragraph_index": 12}], "all_paragraphs": ["When you download images from the internet you usually find noisy data. Furthermore, popular pictures are all around the place. It is tedious to see them one by one and try to find duplicates to clean you dataset.", "With this problem in mind, I built a duplicate finder that finds the duplicates for you so you only need to choose if you want to delete them. You can find the code in the fastai library. In this post I will explain how I built this tool.", "We usually use CNN\u2019s to classify images and we are only interested in the output of the softmax at the end of the network which tells us what the network thinks the labels of our images are. In this case, we are going to compare the inner layers of the network in the hope that some of the features learned by the network are useful to find similar images. To implement this I took advantage of the great hook functionality in the fastai library which allows us to save the activations of any sublayer in the network.", "The activations I used were the output of the last convolutional block of the Resnet architecture since I noticed they worked better empirically.", "As you probably know, hidden layers in CNNs have four dimensions: batch size, number of features, height and width. Let\u2019s suppose we are talking about one specific image, or bs=1. For example, in the case of Resnet 50, the output of the last layer would have dimensions (1, 512, 7, 7). Since the dimensionality here is very high, it would be very time consuming to compute similarities and this would be a pain for users. The answer to this problem is to use pooling. We will pool each of the 7x7 matrices so that we get a tensor of dimensions (1, 512, pool_dim, pool_dim).", "The pooling function I used was AdaptiveConcatPooling (Adaptive Average Pooling and Adaptive Max Pooling concatenated together) and the pooling dimension I used was 4 since I found it was a good combination of speed and performance.", "We ended the last step with a tensor of four dimensions. However, to compute the similarity between different examples we need one dimensional tensors (vectors). We will flatten the activations of each image to get a vector of size pool_dim x pool_dim x 512 and we will concatenate every image\u2019s vector into a matrix with dimensions (n_exs, vector_dim). Now we have a feature vector for each of our n_exs images. Time to compute similarities!", "To compute the similarities between each of the feature vectors, we will use the cosine similarity function. Notice that if we combine every vector with every other vector, all similarities would be computed twice. Also notice that if we compute the similarity of a vector with itself the measure of similarity will obviously be the highest. So for our similarity matrix we will replace the diagonal and the upper right part with zeros.", "Let\u2019s see if our method works! Let\u2019s look at the most similar images in our dataset and see if we can spot some duplicates (I posted some screenshots here, for more please visit my repo). The dataset I used to test the algorithm is the Oxford-IIIT Pet Dataset with 37 dog and cat breeds.", "I also tested the algorithm with CIFAR10, a well-known dataset in computer vision, to see if I could find some duplicates. These are some examples of what I found:", "I also run the relabeler widget and here is an extra interesting finding:", "Once we have the network\u2019s suggestions for duplicates what should we do with them? Well, we should choose those that are actually duplicates and delete them from our dataset since having duplicates will cause the network to give too much importance to those images. How can we easily delete duplicates? It is very easy with fastai\u2019s interactive widgets! You can try it out by running:", "Want to use it? Check out my tutorial notebook with CIFAR.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff8714ddca9d2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@fpingham?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@fpingham?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Francisco Ingham"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa69573c6c96c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&user=Francisco+Ingham&userId=a69573c6c96c&source=post_page-a69573c6c96c----f8714ddca9d2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/fastai/fastai", "anchor_text": "fastai"}, {"url": "https://docs.fast.ai/callbacks.hooks.html", "anchor_text": "hook"}, {"url": "http://deeplearning.stanford.edu/tutorial/supervised/Pooling/", "anchor_text": "pooling"}, {"url": "https://en.wikipedia.org/wiki/Cosine_similarity", "anchor_text": "cosine similarity function"}, {"url": "https://github.com/fpingham/duplicate-finder/blob/master/duplicates_v5.ipynb", "anchor_text": "repo"}, {"url": "http://www.robots.ox.ac.uk/~vgg/data/pets/", "anchor_text": "Oxford-IIIT Pet Dataset"}, {"url": "https://github.com/fpingham/dataset-cleaner", "anchor_text": "tutorial notebook"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----f8714ddca9d2---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----f8714ddca9d2---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----f8714ddca9d2---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----f8714ddca9d2---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&user=Francisco+Ingham&userId=a69573c6c96c&source=-----f8714ddca9d2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&user=Francisco+Ingham&userId=a69573c6c96c&source=-----f8714ddca9d2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff8714ddca9d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f8714ddca9d2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f8714ddca9d2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@fpingham?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@fpingham?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Francisco Ingham"}, {"url": "https://medium.com/@fpingham/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "549 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa69573c6c96c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&user=Francisco+Ingham&userId=a69573c6c96c&source=post_page-a69573c6c96c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F57e51290a19e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-image-duplicate-finder-f8714ddca9d2&newsletterV3=a69573c6c96c&newsletterV3Id=57e51290a19e&user=Francisco+Ingham&userId=a69573c6c96c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}