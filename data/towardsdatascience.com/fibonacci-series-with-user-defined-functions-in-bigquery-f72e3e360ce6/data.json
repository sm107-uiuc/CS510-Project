{"url": "https://towardsdatascience.com/fibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6", "time": 1683008448.688731, "path": "towardsdatascience.com/fibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6/", "webpage": {"metadata": {"title": "Fibonacci series in BigQuery. Using user-defined JavaScript functions\u2026 | by Bence Komarniczky | Towards Data Science", "h1": "Fibonacci series in BigQuery", "description": "How to use BigQuery JavaScript UDFs to generate Fibonacci numbers."}, "outgoing_paragraph_urls": [{"url": "https://projecteuler.net", "anchor_text": "Project Euler", "paragraph_index": 1}, {"url": "https://tio.run/##VY/BCoMwDEDvfkWOFae0t4FzPyIyVOrMcKm0VQ/Db@@qdsIOgSZ9eUle9VybVuNo0/nqXDdRa1ERdNgwiuETAcy1BprejdQGCij5BUTly0uPgwRGcAdxgAGVy8PjHg1NJa8gORNR5Tsa8sz02FkW/xfHyfQsiH5fkBYgtvfqQ0s7aTql5KWr26ajn8vzKArbIdx8Fz/2axUZNchsUE@23Yfx7kZIdvPqvg", "anchor_text": "Here it is", "paragraph_index": 7}, {"url": "https://medium.com/@niczky12/fizzbuzz-in-bigquery-e0c4fbc1d195", "anchor_text": "FizzBuzz with BigQuery", "paragraph_index": 11}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions#including-javascript-libraries", "anchor_text": "JavaScript libraries", "paragraph_index": 17}], "all_paragraphs": ["BigQuery has some neat functionality to support user-defined functions written in SQL and JavaScript so I thought I\u2019d be fun to tackle a little a challenge with Fibonacci numbers.", "I\u2019m pretty sure I saw this challenge on Project Euler or somewhere similar so please don\u2019t use this as a way to cheat. The challenge is:", "Find the sum of the last 6 six digits for the first 1000 Fibonacci numbers. Now, this might sound a bit complicated so we will start out slow by calculating the full Fibonacci numbers and then go from there.", "So each element is the sum of the previous 2. Here it is in action:", "Now that we know what the Fibonacci series is, the obvious question is how do we do a loop in BigQuery. Well, there are ways to do this with BigQuery scripting but here I will use JavaScript user-defined functions instead.", "Here\u2019s the JavaScript function to calculate the nth Fibonacci number:", "I know zero to none JavaScript so please call me out in the comments if I\u2019m doing something silly here!", "Here it is in action if you want to play around with it.", "In order to create this function in BigQuery we need to use the CREATE TEMP FUNCTION declaration:", "We can use the same JavaScript function body as above. All we need to do is remove the function fib(n) bit from the JavaScript bit and add the input and output types to the SQL bit. Notice how we say fibonacci(n INT64) to declare that the input must be an integer and RETURNS INT64 to specify the output type.", "Let\u2019s get some numbers in BigQuery:", "If you don\u2019t know what\u2019s happening with the array generator and the unnesting in the withstatement then check out my article on FizzBuzz with BigQuery \ud83c\udf7e\u2014 it\u2019s all explained there.", "This took 0.5s to run. Not too shabby and it looks like it\u2019s working just fine since we got the same 50th element as above.", "If you go back to the top, you can see that the original challenge was to calculate the sum of the last 6 digits for the first 1000 Fibonacci numbers. Doing that will be easy now. The trick here is to realize that in order to accurately calculate the last 6 digits you only ever need the last 6 digits, so we can throw the rest away by using the modulo operator. We need this trick as otherwise, our INT64 would get too big and overflow.", "We just need to add: var new_num = (numbers[0] + numbers[1]) % 1000000; inside our JavaScript function and then sum up all the results. Here\u2019s the SQL for this:", "This ran in 0.9s so BigQuery is really sweating now\u2026 And the result is:", "I would recommend you change the above SQL and look at the last 6 digits of the 100th Fibonacci numbers to see if that\u2019s correct!", "To sum up, JavaScript functions are really easy to add into BigQuery and you can hack some interesting calculations together. Even better, you can even use JavaScript libraries if you include the .js file on a Google Cloud Storage bucket. How awesome is that?", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist building ML products in ad-tech. I write tutorials on data science\ud83e\uddd1\u200d\ud83d\udd2c, machine learning \ud83e\udd16, Julia and cloud computing \u2601\ufe0f."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff72e3e360ce6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://niczky12.medium.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": ""}, {"url": "https://niczky12.medium.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Bence Komarniczky"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29f55325f60b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&user=Bence+Komarniczky&userId=29f55325f60b&source=post_page-29f55325f60b----f72e3e360ce6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pxfuel.com/en/free-photo-qqlvf", "anchor_text": "pxfuel"}, {"url": "https://projecteuler.net", "anchor_text": "Project Euler"}, {"url": "https://onlinelibrary.wiley.com/doi/pdf/10.1002/9781118033067.app3", "anchor_text": "get pretty big pretty quickly"}, {"url": "https://tio.run/##VY/BCoMwDEDvfkWOFae0t4FzPyIyVOrMcKm0VQ/Db@@qdsIOgSZ9eUle9VybVuNo0/nqXDdRa1ERdNgwiuETAcy1BprejdQGCij5BUTly0uPgwRGcAdxgAGVy8PjHg1NJa8gORNR5Tsa8sz02FkW/xfHyfQsiH5fkBYgtvfqQ0s7aTql5KWr26ajn8vzKArbIdx8Fz/2axUZNchsUE@23Yfx7kZIdvPqvg", "anchor_text": "Here it is"}, {"url": "https://medium.com/@niczky12/fizzbuzz-in-bigquery-e0c4fbc1d195", "anchor_text": "FizzBuzz with BigQuery"}, {"url": "https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions#including-javascript-libraries", "anchor_text": "JavaScript libraries"}, {"url": "https://towardsdatascience.com/load-files-faster-into-bigquery-94355c4c086a", "anchor_text": "Load files faster into BigQueryBenchmarking CSV, GZIP, AVRO and PARQUET file types for ingestiontowardsdatascience.com"}, {"url": "https://towardsdatascience.com/loops-in-bigquery-db137e128d2d", "anchor_text": "Loops in BigQueryLearn how to use BigQuery scripting to calculate Fibonacci numberstowardsdatascience.com"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----f72e3e360ce6---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/fibonacci?source=post_page-----f72e3e360ce6---------------fibonacci-----------------", "anchor_text": "Fibonacci"}, {"url": "https://medium.com/tag/javascript?source=post_page-----f72e3e360ce6---------------javascript-----------------", "anchor_text": "JavaScript"}, {"url": "https://medium.com/tag/function?source=post_page-----f72e3e360ce6---------------function-----------------", "anchor_text": "Function"}, {"url": "https://medium.com/tag/bigquery?source=post_page-----f72e3e360ce6---------------bigquery-----------------", "anchor_text": "Bigquery"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&user=Bence+Komarniczky&userId=29f55325f60b&source=-----f72e3e360ce6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&user=Bence+Komarniczky&userId=29f55325f60b&source=-----f72e3e360ce6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff72e3e360ce6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f72e3e360ce6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f72e3e360ce6--------------------------------", "anchor_text": ""}, {"url": "https://niczky12.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://niczky12.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bence Komarniczky"}, {"url": "https://niczky12.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "410 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F29f55325f60b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&user=Bence+Komarniczky&userId=29f55325f60b&source=post_page-29f55325f60b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3891999cdd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffibonacci-series-with-user-defined-functions-in-bigquery-f72e3e360ce6&newsletterV3=29f55325f60b&newsletterV3Id=3891999cdd4&user=Bence+Komarniczky&userId=29f55325f60b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}