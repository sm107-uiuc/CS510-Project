{"url": "https://towardsdatascience.com/increase-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb", "time": 1683005056.498771, "path": "towardsdatascience.com/increase-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb/", "webpage": {"metadata": {"title": "CLAHE on Python images | Towards Data Science", "h1": "Increase Your Face Recognition Model\u2019s Accuracy by Improving Face Contrast", "description": "An introduction into Contrast Limited Adaptive Histogram Equalization. This algorithm can increase the contrast in faces, making them easier to identify."}, "outgoing_paragraph_urls": [{"url": "https://opencv.org/", "anchor_text": "OpenCV", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Contrast_(vision)", "anchor_text": "Wikipedia", "paragraph_index": 4}, {"url": "https://www.dieterjordens.com/", "anchor_text": "https://www.dieterjordens.com/", "paragraph_index": 43}], "all_paragraphs": ["Let me introduce you to a problem I had a while ago. I was experimenting with face detection and OpenCV to explore the latest machine and deep learning models.", "I noticed that for faces, which have a clear contrast, the detection and recognition rate was significantly higher. That got me thinking, how can I improve the contrast for images automatically?", "I will show you what histogram equalization is. At the end of this blog post, you will have learned a preprocessing step that can improve your recognition rate. I\u2019ll start by explaining what contrast means in image processing and we\u2019ll work our way up from there.", "In the end, I will show you how to apply a very advanced histogram equalization method on coloured images, the so-called Contrast Limited Adaptive Histogram Equalization algorithm (CLAHE).", "\u201cThe difference in color or luminance is what makes an object distinguishable from other objects within the same field of view.\u201d \u2014 Wikipedia", "This definition makes sense to everyone familiar with photography. It tells us directly what we need to separate objects from their background.", "What we do not need is low or high contrast, but something in between. It needs to be optimal.", "The image on the left has a lower contrast than the image on the right. It is more difficult to see the contours of the left face.", "While the latter has better contours, an image with too much contrast loses subtle information. This last part could be something my inner data scientist would worry about.", "When you improve the contrast before classifying an object, you are removing a bit of noise and it tends to improve the model. The big contours are the most important.", "So, when you would apply a contrast improving algorithm, you have to keep one thing in mind \u2014 do not overdo it.", "Histogram equalization is an image processing technique for adjusting the image\u2019s intensity. This enhances the contrast in an image.", "Behind the scenes, it can be explained by using a histogram. An equalized histogram means that the image uses all grey levels in equal proportions. Then, intensities are better distributed on the histogram.", "The image below shows this visually with T being the transformation function. I think this should make sense for anyone with a statistical background, don\u2019t you agree?", "OpenCV has a cv2.equalizeHist() method that performs a histogram on a grayscale input image. It has as output a histogram equalized image. This method is useful for images with both a bright/dark background and foreground.", "But, histogram equalization has an important limitation \u2014 it only works well when the distribution of the pixel values is similar throughout the image.", "When some regions are significantly different (e.g. lighter or darker) from other parts of the image, the contrast in some regions might not be enhanced correctly.", "One example of such an image, light that enters from a window which makes some regions of the image significantly brighter.", "To solve the shortcomings of the histogram equalization algorithm, you can compute multiple histograms for one image.", "Every histogram then corresponds to one specific region of the image. This causes every region of the image to be enhanced separately, thus solving the original problem.", "However, a new problem results from the adaptive histogram equalization algorithm. AHE can over-amplify the contrast in near-constant regions of the image.", "Since this over-amplification causes noise to be amplified in particular regions of the image, we need an alternative. I propose an alternative in the next section, so hang in there.", "As discussed in the previous section, adaptive histogram equalization causes noise to be amplified in near-constant regions.", "Contrast limited AHE limits the contrast amplification to reduce amplified noise. It does so by distributing that part of the histogram that exceeds the clip limit equally across all histograms.", "But you want to see some results now, don\u2019t you? I got something prepared, so let\u2019s not keep you waiting any longer.", "Notice that the contours of the face are much more visual. You don\u2019t have to follow me in this preprocessing step, but I think this is a visual improvement. The regions that matter most are slightly amplified. But how do you do this?", "I found that most implementations work only with grayscale images. So, I think it will be really useful if I would make a difference right here, by providing an example for a coloured image. The implementation is as follows:", "I\u2019ve only pasted the most important part, I figured that every seasoned data scientist/engineer should be capable of figuring out the rest. However, I\u2019ll explain this method in a lot of detail.", "First of all, I converted the BGR image (blue, green, and red channel) to the HSV format (Hue, Saturation, and Value channel). This allows us to perform the CLAHE algorithm only on the value channel. We don\u2019t want to mess up the hue or saturation of the image.", "Before I go further, let me explain HSV:", "Next, I apply CLAHE on the value channel of the image. I\u2019ll explain the parameters I use as well. I found the default clipping limit of 40 way too aggressive and found generally improved results when using 2.", "The second parameter \u2014 the tile grid size \u2014 splits an image into 64 tiles with 8 columns and 8 rows. Imagine that your input image is 160x160 pixels wide. In that case, I split the image into regions of 20x20 pixels.", "Both parameters are often used as default, so I didn\u2019t bother changing them much. Keep in mind that if you want consistent behaviour, every image should be on the same scale.", "In the last steps, I simply merge the changed value channel with the hue and saturation channel, before I return the image to the original BGR format.", "I leave that to the reader to find out. For me, there are two phases where this could be useful. In the detection phase or the recognition phase. I\u2019ll explain both and I will discuss alternatives if that is possible.", "In this phase, it can certainly help to find more objects. I did the test and after using CLAHE, the model can detect more objects. It also has an application in, for example, MRI scans.", "For object detection, however, sometimes it is more useful to upsample your image. This has a better effect than using CLAHE on an image as a whole.", "As I showed, it can be certainly helpful to use CLAHE in the recognition phase. For example, when people need to classify images to train a model, it can visually aid them in performing that task better.", "It might also be beneficial for specific machine learning models as a preprocessing step. In one of my projects, I was able to increase my average accuracy over 50 runs with 1.5 per cent (with CLAHE 0.9534%, without 0.9384%). It\u2019s a significant increase, which also makes me confident that it is a very good pre-processing step.", "I\u2019m not yet certain if it makes a life-changing difference for object recognition, because it\u2019s hard to find good research on this topic. Feel free to comment on this story if you have some good research results, for example, in the domain of face recognition.", "I hope to find some answers and hope that you, as a reader, can contribute to my search for improved object detection and recognition.", "I\u2019m always open to a discussion on a topic I\u2019m enthusiastic about, so feel free to comment below. I intend to keep on learning about this subject.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Writes about Craftsmanship | Machine Learning | Software Development. Read more on https://www.dieterjordens.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa3e71bb6b9fb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dieterjordens.medium.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": ""}, {"url": "https://dieterjordens.medium.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Dieter Jordens"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb3cf0bc86c7f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&user=Dieter+Jordens&userId=b3cf0bc86c7f&source=post_page-b3cf0bc86c7f----a3e71bb6b9fb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@domenika?utm_source=medium&utm_medium=referral", "anchor_text": "Tiko Giorgadze"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://opencv.org/", "anchor_text": "OpenCV"}, {"url": "https://en.wikipedia.org/wiki/Contrast_(vision)", "anchor_text": "Wikipedia"}, {"url": "http://filmschoolonline.com/sample_lessons/sample_lesson_cinematography.htm", "anchor_text": "filmschoolonline.com"}, {"url": "https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_histograms/py_histogram_equalization/py_histogram_equalization.html", "anchor_text": "documentation"}, {"url": "https://unsplash.com/@medvedevmax?utm_source=medium&utm_medium=referral", "anchor_text": "Maxim Medvedev"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "http://char.txa.cornell.edu/language/ELEMENT/COLOR/color.htm", "anchor_text": "hue circle"}, {"url": "https://unsplash.com/@mattartz?utm_source=medium&utm_medium=referral", "anchor_text": "Matt Artz"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a3e71bb6b9fb---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/opencv?source=post_page-----a3e71bb6b9fb---------------opencv-----------------", "anchor_text": "Opencv"}, {"url": "https://medium.com/tag/python?source=post_page-----a3e71bb6b9fb---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----a3e71bb6b9fb---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/programming?source=post_page-----a3e71bb6b9fb---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&user=Dieter+Jordens&userId=b3cf0bc86c7f&source=-----a3e71bb6b9fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&user=Dieter+Jordens&userId=b3cf0bc86c7f&source=-----a3e71bb6b9fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa3e71bb6b9fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a3e71bb6b9fb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a3e71bb6b9fb--------------------------------", "anchor_text": ""}, {"url": "https://dieterjordens.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dieterjordens.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dieter Jordens"}, {"url": "https://dieterjordens.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "822 Followers"}, {"url": "https://www.dieterjordens.com/", "anchor_text": "https://www.dieterjordens.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb3cf0bc86c7f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&user=Dieter+Jordens&userId=b3cf0bc86c7f&source=post_page-b3cf0bc86c7f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F30547b98c6eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fincrease-your-face-recognition-models-accuracy-by-improving-face-contrast-a3e71bb6b9fb&newsletterV3=b3cf0bc86c7f&newsletterV3Id=30547b98c6eb&user=Dieter+Jordens&userId=b3cf0bc86c7f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}