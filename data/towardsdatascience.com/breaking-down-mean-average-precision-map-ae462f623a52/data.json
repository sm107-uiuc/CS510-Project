{"url": "https://towardsdatascience.com/breaking-down-mean-average-precision-map-ae462f623a52", "time": 1682995499.881224, "path": "towardsdatascience.com/breaking-down-mean-average-precision-map-ae462f623a52/", "webpage": {"metadata": {"title": "Breaking Down Mean Average Precision (mAP) | by Ren Jie Tan | Towards Data Science", "h1": "Breaking Down Mean Average Precision (mAP)", "description": "If you have come across the PASCAL Visual Object Classes (VOC) and MS Common Objects in Context (COCO) challenge, or dabbled with projects involving information retrieval and re-identification\u2026"}, "outgoing_paragraph_urls": [{"url": "http://host.robots.ox.ac.uk/pascal/VOC/index.html", "anchor_text": "PASCAL Visual Object Classes (VOC)", "paragraph_index": 0}, {"url": "http://cocodataset.org/#home", "anchor_text": "MS Common Objects in Context (COCO)", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision", "anchor_text": "Wikipedia", "paragraph_index": 2}, {"url": "http://host.robots.ox.ac.uk/pascal/VOC/pubs/everingham10.pdf", "anchor_text": "1", "paragraph_index": 40}, {"url": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173", "anchor_text": "well-written article [2]", "paragraph_index": 45}, {"url": "https://medium.com/@jonathan_hui", "anchor_text": "Jonathan Hui", "paragraph_index": 45}, {"url": "http://cocodataset.org/#detection-eval", "anchor_text": "5", "paragraph_index": 47}, {"url": "https://towardsdatascience.com/@raimibinkarim", "anchor_text": "Raimi", "paragraph_index": 53}, {"url": "https://medium.com/@derekchia", "anchor_text": "Derek", "paragraph_index": 53}, {"url": "https://medium.com/@polars", "anchor_text": "Wai Kit", "paragraph_index": 53}, {"url": "https://twitter.com/rahjaytee", "anchor_text": "Twitter", "paragraph_index": 54}, {"url": "https://www.linkedin.com/in/renjietan/", "anchor_text": "LinkedIn", "paragraph_index": 54}, {"url": "https://github.com/notha99y", "anchor_text": "Github", "paragraph_index": 55}, {"url": "https://notha99y.github.io/", "anchor_text": "https://notha99y.github.io/", "paragraph_index": 57}], "all_paragraphs": ["If you have come across the PASCAL Visual Object Classes (VOC) and MS Common Objects in Context (COCO) challenge, or dabbled with projects involving information retrieval and re-identification (ReID), you might then be quite familiar with a metric called mAP.", "The mean average precision (mAP) or sometimes simply just referred to as AP is a popular metric used to measure the performance of models doing document/information retrival and object detection tasks.", "The mean average precision (mAP) of a set of queries is defined by Wikipedia as such:", "where Q is the number of queries in the set and AveP(q) is the average precision (AP) for a given query, q.", "What the formula is essentially telling us is that, for a given query, q, we calculate its corresponding AP, and then the mean of the all these AP scores would give us a single number, called the mAP, which quantifies how good our model is at performing the query.", "This definition baffles people (like me) who are just starting out in this field. I had questions like what is this set of queries? And what does AP mean? Is it just an average of the precision?", "This article hopes to address these questions and calculate mAP for both object detection and information retrieval tasks. This article would also be exploring why mAP is an appropriate and commonly used metric for information retrieval and object detection tasks.", "Precision and recall are two commonly used metric to judge the performance of a given classification model. To understand mAP, we would need to first review precision and recall.", "In the field of statistics and Data Science, precision of a given class in classification, a.k.a. positive predicted value, is given as the ratio of true positive (TP) and the total number of predicted positives. The formula is given as such:", "Similarly, the recall, a.k.a. true positive rate or sensitivity, of a given class in classification, is defined as the ratio of TP and total of ground truth positives. The formula is given as such:", "Just by looking at the formulas, we could suspect that for a given classification model, there lies a trade-off between its precision and recall performance. If we are using a neural network, this trade-off can be adjusted by the model\u2019s final layer softmax threshold.", "For our precision to be high, we would need to decrease our number of FP, by doing so, it will decrease our recall. Similarly, by decreasing our number of FN would increase our recall and decrease our precision. Very often for information retrieval and object detection cases, we would want our precision to be high (our predicted positives to be TP).", "Precision and recall are commonly used along with other metrics such as accuracy, F1-score, specificity, a.k.a. true negative rate (TNR), receiver operating characteristics (ROC), lift and gain.", "However, when it comes to information retrieval, the definition is different.", "As defined by Wiki, precision is defined as the ratio of the retrived documents that are relevant to user\u2019s query over the retrieved documents.", "Keeping the nomenclature similar to formula defined above, a relevant document can be regarded as a TP.", "By default, precision takes all the retrieved documents into account, but however, it can also be evaluated at a given number of retrieved documents, commonly known as cut-off rank, where the model is only assessed by considering only its top-most queries. The measure is called precision at k or P@K.", "Let us use an example to better understand the formula.", "A typical task in information retrieval is for a user to provide a query to a database and retrieving information very similar to the query. Let\u2019s now perform a calculation for precision with an example with three ground truth positives (GTP).", "Additional nomenclature: Ground truth positives are the labeled-as-positive data. In other words, the relevant documents.", "We shall define the following variables:", "After calculating the d( , ) for each of the documents with Q, we can sort G and get G\u2019.", "Say the model returns the following G\u2019", "Using the Precision formula above, we get the following,", "Similarly, the recall formula defined by Wiki is given as the ratio retrieved documents that are relevant to user\u2019s query over the relevant documents.", "Recall in this case is not as useful as by running returning all the documents for a query will result in a trivial 100% recall, hence recall by itself is commonly not used as a metric.", "Being familiar with precision@k, we can now move on to calculate the Average Precision. This would give us a better measurement of our model in its ability to sorting the results of the query, G\u2019.", "where GTP refers to the total number of ground truth positives, n refers to the total number of documents you are interested in, P@k refers to the precision@k and rel@k is a relevance function. The relevance function is an indicator function which equals 1 if the document at rank k is relevant and equals to 0 otherwise.", "Recall the definition of precision, we shall now use it to calculate the AP for each document in G\u2019. Using the same example shown above,", "The overall AP for this query is 0.7. One thing to note is that since we know that there are only three GTP, the AP@5 would equal to overall AP.", "For another query, Q, we could get a perfect AP of 1 if the returned G\u2019 is sorted as such:", "What AP does, in this case, is to penalise models that are not able to sort G\u2019 with TPs leading the set. It provides a number that is able to quantify the goodness of the sort based on the score function d( , ). By dividing the sum of precision with the total GTP instead of dividing by the length of G\u2019 allows a better representation for queries that only have a few GTP.", "For each query, Q, we can calculate a corresponding AP. A user can have as much queries as he/she likes against this labeled database. The mAP is simply the mean of all the queries that the use made.", "Note: This is the same formula as Wikipedia\u2019s, just written differently.", "To do the calculation of AP for object detection, we would first need to understand IoU. The IoU is given by the ratio of the area of intersection and area of union of the predicted bounding box and ground truth bounding box.", "The IoU would be used to determine if a predicted bounding box (BB) is TP, FP or FN. The TN is not evaluated as each image is assumed to have an object in it. Let us consider the following image with:", "The image contains a person and horse with their corresponding ground truth bounding boxes. Let us ignore the horse for the moment. We run our object detection model on this image and received a predicted bounding box for the person. Traditionally, we define a prediction to be a TP if the IoU is > 0.5. The are possible scenarios are described below:", "There are two possible scenarios where a BB would be considered as FP:", "When our object detection model missed the target, then it would be considered as a False Negative. The two possible scenarios are as follows:", "With the TP, FP and FN formally defined, we can now calculate the precision and recall of our detection for a given class across the test set. Each BB would have its confidence level, usually given by its softmax layer, and would be used to rank the output. Note that this is very similar to the information retrieval case, just that instead of having a similarity function d( , ) to provide the ranking, we used the model\u2019s predicted BB\u2019s confidence.", "Before we plot the PR curve, we need first need to know the interpolated precision introduced in [1]. The interpolated precision, p_interp, is calculated at each recall level, r, by taking the maximum precision measured for that r. The formula is given as such:", "where p(r)\u02dc is the measured precision at recall r\u02dc.", "Their intention of interpolating the PR curve was to reduce the impact of \u201cwiggles\u201d caused by small variations in the ranking of detections.", "With that out of the way, we can now start plotting the PR curve. Consider an example for the person class with 3 TP and 4 FP. We calculate the corresponding precision, recall, and interpolated precision given by the formulas defined above.", "The AP is then calculated by taking the area under the PR curve. This is done by segmenting the recalls evenly to 11 parts: {0,0.1,0.2,\u2026,0.9,1}. We get the following:", "For another example, I would like to refer you to this well-written article [2] by Jonathan Hui.", "The mAP for object detection is the average of the AP calculated for all the classes. It is also important to note that for some papers, they use AP and mAP interchangeably.", "With reference to [5], COCO provided six new methods of calculating AP.", "Three of these methods are thresholding the BB at different IoUs:", "For the primary AP, 0.5:0.05:0.95 means starting from IoU = 0.5, with steps of 0.05, we increase to an IoU = 0.95. These would result in computations of AP threshold at ten different IoUs. An average is done to provide a single number which rewards detectors that are better at localisation.", "The remaining three methods are calculating AP across scales:", "This would allow better differentiation of models as some datasets have more small objects than others.", "Spot an error? Feel free to comment!", "Special thanks to Raimi, Derek and Wai Kit for proofreading and giving me feedback on this article.", "Feel free to connect with me via Twitter, LinkedIn!", "If you are interested in other projects that I have worked on, feel free to visit my Github!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "NUS MTech (Knowledge Engineering) & BSc Physics Graduate | Data Scientist @ FinAccel https://notha99y.github.io/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fae462f623a52&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ae462f623a52--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@renjietan?source=post_page-----ae462f623a52--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@renjietan?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Ren Jie Tan"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffdf264797c2a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&user=Ren+Jie+Tan&userId=fdf264797c2a&source=post_page-fdf264797c2a----ae462f623a52---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@byadonia?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "\u015eahin Ye\u015filyaprak"}, {"url": "https://towardsdatascience.com/s/photos/mean-average-precision?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://host.robots.ox.ac.uk/pascal/VOC/index.html", "anchor_text": "PASCAL Visual Object Classes (VOC)"}, {"url": "http://cocodataset.org/#home", "anchor_text": "MS Common Objects in Context (COCO)"}, {"url": "https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision", "anchor_text": "Wikipedia"}, {"url": "https://en.wikipedia.org/wiki/Precision_and_recall", "anchor_text": "source"}, {"url": "https://www.pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/", "anchor_text": "source"}, {"url": "https://www.walmart.com/ip/LAMINATED-POSTER-Countryside-Horse-Mountains-Atlas-Man-Poster-Print-11-x-17/868208111", "anchor_text": "source"}, {"url": "http://host.robots.ox.ac.uk/pascal/VOC/pubs/everingham10.pdf", "anchor_text": "1"}, {"url": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173", "anchor_text": "well-written article [2]"}, {"url": "https://medium.com/@jonathan_hui", "anchor_text": "Jonathan Hui"}, {"url": "http://cocodataset.org/#detection-eval", "anchor_text": "5"}, {"url": "https://towardsdatascience.com/@raimibinkarim", "anchor_text": "Raimi"}, {"url": "https://medium.com/@derekchia", "anchor_text": "Derek"}, {"url": "https://medium.com/@polars", "anchor_text": "Wai Kit"}, {"url": "https://twitter.com/rahjaytee", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/renjietan/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/notha99y", "anchor_text": "Github"}, {"url": "https://towardsdatascience.com/a-starter-pack-to-exploratory-data-analysis-with-python-pandas-seaborn-and-scikit-learn-a77889485baf", "anchor_text": "A Starter Pack to Exploratory Data Analysis with Python, pandas, seaborn, and scikit-learn"}, {"url": "https://towardsdatascience.com/6-steps-to-quickly-train-a-human-action-classifier-with-validation-accuracy-of-over-80-655fcb8781c5", "anchor_text": "How I improved a Human Action Classifier to 80% Validation Accuracy in 6 Easy Steps"}, {"url": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173", "anchor_text": "https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173"}, {"url": "https://makarandtapaswi.wordpress.com/2012/07/02/intuition-behind-average-precision-and-map/", "anchor_text": "https://makarandtapaswi.wordpress.com/2012/07/02/intuition-behind-average-precision-and-map/"}, {"url": "https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision", "anchor_text": "https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision"}, {"url": "http://cocodataset.org/#detection-eval", "anchor_text": "http://cocodataset.org/#detection-eval"}, {"url": "https://tarangshah.com/blog/2018-01-27/what-is-map-understanding-the-statistic-of-choice-for-comparing-object-detection-models/", "anchor_text": "https://tarangshah.com/blog/2018-01-27/what-is-map-understanding-the-statistic-of-choice-for-comparing-object-detection-models/"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----ae462f623a52---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----ae462f623a52---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/data-science?source=post_page-----ae462f623a52---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/information-retrieval?source=post_page-----ae462f623a52---------------information_retrieval-----------------", "anchor_text": "Information Retrieval"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----ae462f623a52---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&user=Ren+Jie+Tan&userId=fdf264797c2a&source=-----ae462f623a52---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&user=Ren+Jie+Tan&userId=fdf264797c2a&source=-----ae462f623a52---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fae462f623a52&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ae462f623a52---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ae462f623a52--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ae462f623a52--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ae462f623a52--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ae462f623a52--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ae462f623a52--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@renjietan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@renjietan?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ren Jie Tan"}, {"url": "https://medium.com/@renjietan/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "295 Followers"}, {"url": "https://notha99y.github.io/", "anchor_text": "https://notha99y.github.io/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffdf264797c2a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&user=Ren+Jie+Tan&userId=fdf264797c2a&source=post_page-fdf264797c2a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F72e8177e5372&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbreaking-down-mean-average-precision-map-ae462f623a52&newsletterV3=fdf264797c2a&newsletterV3Id=72e8177e5372&user=Ren+Jie+Tan&userId=fdf264797c2a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}