{"url": "https://towardsdatascience.com/deploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e", "time": 1683010835.053925, "path": "towardsdatascience.com/deploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e/", "webpage": {"metadata": {"title": "Deploy a Dockerized Flask App to Google Cloud Platform | by Edward Krueger | Towards Data Science", "h1": "Deploy a Dockerized Flask App to Google Cloud Platform", "description": "Deploy a Flask app in a Docker container to GCP (Google Cloud Platform ) using Cloud Build, Cloud Run, Connect it to a GCP hosted database."}, "outgoing_paragraph_urls": [{"url": "https://www.linkedin.com/in/edkrueger/", "anchor_text": "Edward Krueger", "paragraph_index": 0}, {"url": "https://www.linkedin.com/in/douglas-franklin-1a3a2aa3/", "anchor_text": "Douglas Franklin", "paragraph_index": 0}, {"url": "https://medium.com/@edkrueger_16881/virtual-environments-for-data-science-running-python-and-jupyter-with-pipenv-c6cb6c44a405", "anchor_text": "this article", "paragraph_index": 1}, {"url": "https://cloud.google.com/run/docs/quickstarts/build-and-deploy#python", "anchor_text": "documentation", "paragraph_index": 10}, {"url": "https://docs.docker.com/engine/reference/builder/#dockerignore-file", "anchor_text": ".dockerignore", "paragraph_index": 15}, {"url": "https://cloud.google.com/sdk/gcloud/reference/topic/gcloudignore", "anchor_text": ".gcloudignore", "paragraph_index": 15}, {"url": "https://console.cloud.google.com/run?_ga=2.112811590.313737761.1591368161-572251819.1590763098&amp;_gac=1.61558494.1591368161.CjwKCAjw2uf2BRBpEiwA31VZj5hm5tgEHH-Ldim6HaH954LjVPoeEdbL9XkMUnSw3yKCOv1UYdvGdRoCzasQAvD_BwE", "anchor_text": "GCP cloud run", "paragraph_index": 27}, {"url": "https://console.cloud.google.com/storage/", "anchor_text": "cloud console", "paragraph_index": 35}, {"url": "https://towardsdatascience.com/fastapi-cloud-database-loading-with-python-1f531f1d438a", "anchor_text": "Medium guide to building a data API", "paragraph_index": 55}, {"url": "https://github.com/edkrueger/sars-fastapi", "anchor_text": "GitHub repository", "paragraph_index": 57}], "all_paragraphs": ["By: Edward Krueger and Douglas Franklin.", "In this article, we\u2019ll cover how to deploy an app with a Pipfile.lock to the cloud and connect the app to a cloud database. For more information on virtual environments or getting started with the environment and package manager Pipenv, check out this article!", "Newer developers often install everything at the system level due to a lack of understanding of, or experience with, virtual environments. Python packages installed with pip are placed at the system level. Retrieving requirements this way for every project creates an unmanageable global Python environment on your machine. Virtual environments allow you to compartmentalize your software while keeping an inventory of dependencies.", "Pipenv, a tool for virtual environment and package management, allows developers to create isolated software products that are much easier to deploy, build upon, and modify.", "Pipenv combines package management and virtual environment control into one tool for installing, removing, tracking, and documenting your dependencies; and to create, use, and manage your virtual environments. Pipenv is essentially pip and virtualenv wrapped together into a single product.", "For app deployment, GCP can build environments from a Pipfile. Pipenv will automatically update our Pipfile as we add and remove dependencies.", "Docker is the best way to put apps into production. Docker uses a Dockerfile to build a container. The built container is stored in Google Container Registry were it can be deployed. Docker containers can be built locally and will run on any system running Docker.", "GCP Cloud Build allows you to build containers remotely using the instructions contained in Dockerfiles. Remote builds are easy to integrate into CI/CD pipelines. They also save local computational time and energy as Docker uses lots of RAM.", "Here is the Dockerfile we used for this project:", "The first line of every Dockerfile begins with FROM. This is where we import our OS or programming language. The next line, starting with ENV, sets our environment variable ENV to APP_HOME / app.", "These lines are part of the Python cloud platform structure and you can read more about them in the documentation.", "The WORKDIR line sets our working directory to /app. Then, the Copy line makes local files available in the docker container.", "The next three lines involve setting up the environment and executing it on the server. The RUN command can be followed with any bash code you would like executed. We use RUN to install pipenv. Then use pipenv to install our dependencies. Finally, the CMDline executes our HTTP server gunicorn, binds our container to $PORT, assigns the port a worker, specifies the number of threads to use at that port and finally states the path to the app asapp.main:app.", "You can add a .dockerignore file to exclude files from your container image. The .dockerignore is used to keep files out of your container. For example, you likely do not want to include your test suite in your container.", "To exclude files from being uploaded to Cloud Build, add a.gcloudignore file. Since Cloud Build copies your files to the cloud, you may want to omit images or data to cut down on storage costs.", "If you would like to use these, be sure to check out the documentation for .dockerignore and .gcloudignorefiles, however, know that the pattern is the same as a.gitignore !", "We need to make some final changes to our project files in preparation for deployment.", "We need to add gunicorn and Pymysql to our Pipfile with the following.", "Git add the Pipfile, Pipfile.lock, and the Dockerfile you made earlier to your repository.", "Now, once we have our Dockerfile ready, build your container image using Cloud Build by running the following command from the directory containing the Dockerfile:", "Note: Replace PROJECT-ID with your GCP project ID and container-name with your container name. You can view your project ID by running the command gcloud config get-value project.", "This Docker image now accessible at the GCP container registry or GCR and can be accessed via URL with Cloud Run.", "Note: Replace PROJECT-ID with your GCP project ID and container-name with your containers\u2019 name. You can view your project ID by running the command gcloud config get-value project.", "2. You will be prompted for service name and region: select the service name and region of your choice.", "3. You will be prompted to allow unauthenticated invocations: respond y if you want public access, and n to limit IP access to resources in the same google project.", "4. Wait a few moments until the deployment is complete. On success, the command line displays the service URL.", "5. Visit your deployed container by opening the service URL in a web browser.", "Now that we have a container image stored in GCR, we are ready to deploy our application. Visit GCP cloud run and click create service, be sure to set up billing as required.", "Select the region you would like to serve and specify a unique service name. Then choose between public or private access to your application by choosing unauthenticated or authenticated, respectively.", "Now we use our GCR container image URL from above. Paste the URL into the space or click select and find it using a dropdown list. Check out the advanced settings to specify server hardware, container port and additional commands, maximum requests and scaling behaviors.", "Click create when you\u2019re ready to build and deploy!", "You\u2019ll be brought to the GCP Cloud Run service details page where you can manage the service and view metrics and build logs.", "Click the URL to view your deployed application!", "Congratulations! You have just deployed an application packaged in a container image to Cloud Run. Cloud Run automatically and horizontally scales your container image to handle the received requests, then scales down when demand decreases. You only pay for the CPU, memory, and networking consumed during request handling.", "That being said, be sure to shut down your services when you do not want to pay for them!", "Go to the cloud console and set up billing if you haven\u2019t already. Now you can create an SQL instance.", "Select the SQL dialect you would like to use, we are using MySQL.", "Set an instance ID, password, and location.", "Setting a new Cloud SQL connection, like any configuration change, leads to the creation of a new Cloud Run revision. To connect your cloud service to your cloud database instance:", "If you are adding a Cloud SQL connection to a new service:", "If you are adding Cloud SQL connections to an existing service:", "3. Enable connecting to a Cloud SQL:", "In either case, we\u2019ll want our connection string to look like the one below for now.", "We\u2019ll need to make a change to the DB connection string so that it uses the Pymysql driver.", "In a text editor, remove the mysql and add in its place mysql+pymysql and then save the updated string as your SQL connection.", "Note that you do not have to use GCP\u2019s SQL. If you are using a third-party database, you can add the connection string as a VAR instead of Cloud SQL and input your connection string.", "Locally, create a new file called .env and add the connection string for your cloud database as DB_CONN,shown below.", "Note: Running pipenv shell gives us access to these hidden environmental variables. Similarly, we can access the hidden variables in Python with os.", "Be sure to add the above line to your database.py file so that it ready to connect to the cloud!", "This .env file now contains sensitive information and should be added to your .gitignore so that it doesn't end up somewhere publically visible.", "Now that we have our app and database in the cloud let\u2019s ensure our system is working correctly.", "Once you can see the database listed on GCP, you are ready to load the database with a load script. The following gist includes our load.py script.", "Let\u2019s run this load script to see if we can post to our DB.", "First, run the following line to enter your virtual environment.", "Visit the remote app address and see if your data has been added to the cloud database. Be sure to check your build logs to find tracebacks if you run into any issues!", "For more clarification on this loading process or setting up your app in a modular way, visit our Medium guide to building a data API! That article explains the code above in detail.", "In this article, we learned a little about environment management with pipenv and how to Dockerize apps. Then we covered how to store a Docker container in Google Container Registry and deploy the container with the Cloud Build CLI and GUI. Next, we set up a cloud SQL database and connected it to our app. Lastly, we discussed one way to load the database, running load.py locally. Note that if your app collects data itself, you only need to deploy the app and database, then the deployed app will populate the database as it collects data.", "Here is a link to the GitHub repository with our code for this project. Be sure to check out this code to see how we set up the whole codebase!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist, Software Developer and Educator"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F71d91b39b25e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.edkruegerdata.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": ""}, {"url": "https://medium.edkruegerdata.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Edward Krueger"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4889b755e348&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&user=Edward+Krueger&userId=4889b755e348&source=post_page-4889b755e348----71d91b39b25e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.linkedin.com/in/edkrueger/", "anchor_text": "Edward Krueger"}, {"url": "https://www.linkedin.com/in/douglas-franklin-1a3a2aa3/", "anchor_text": "Douglas Franklin"}, {"url": "https://medium.com/@edkrueger_16881/virtual-environments-for-data-science-running-python-and-jupyter-with-pipenv-c6cb6c44a405", "anchor_text": "this article"}, {"url": "https://cloud.google.com/run/docs/quickstarts/build-and-deploy#python", "anchor_text": "documentation"}, {"url": "https://docs.docker.com/engine/reference/builder/#dockerignore-file", "anchor_text": ".dockerignore"}, {"url": "https://cloud.google.com/sdk/gcloud/reference/topic/gcloudignore", "anchor_text": ".gcloudignore"}, {"url": "https://console.cloud.google.com/run?_ga=2.112811590.313737761.1591368161-572251819.1590763098&amp;_gac=1.61558494.1591368161.CjwKCAjw2uf2BRBpEiwA31VZj5hm5tgEHH-Ldim6HaH954LjVPoeEdbL9XkMUnSw3yKCOv1UYdvGdRoCzasQAvD_BwE", "anchor_text": "GCP cloud run"}, {"url": "https://console.cloud.google.com/storage/", "anchor_text": "cloud console"}, {"url": "https://console.cloud.google.com/run", "anchor_text": "Go to Cloud Ru"}, {"url": "https://towardsdatascience.com/fastapi-cloud-database-loading-with-python-1f531f1d438a", "anchor_text": "Medium guide to building a data API"}, {"url": "https://github.com/edkrueger/sars-fastapi", "anchor_text": "GitHub repository"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----71d91b39b25e---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/cloud-computing?source=post_page-----71d91b39b25e---------------cloud_computing-----------------", "anchor_text": "Cloud Computing"}, {"url": "https://medium.com/tag/software-development?source=post_page-----71d91b39b25e---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/programming?source=post_page-----71d91b39b25e---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/app-development?source=post_page-----71d91b39b25e---------------app_development-----------------", "anchor_text": "App Development"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&user=Edward+Krueger&userId=4889b755e348&source=-----71d91b39b25e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&user=Edward+Krueger&userId=4889b755e348&source=-----71d91b39b25e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F71d91b39b25e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----71d91b39b25e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----71d91b39b25e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----71d91b39b25e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----71d91b39b25e--------------------------------", "anchor_text": ""}, {"url": "https://medium.edkruegerdata.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.edkruegerdata.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Edward Krueger"}, {"url": "https://medium.edkruegerdata.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "699 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4889b755e348&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&user=Edward+Krueger&userId=4889b755e348&source=post_page-4889b755e348--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f629c0dbfb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-dockerized-flask-app-to-google-cloud-platform-71d91b39b25e&newsletterV3=4889b755e348&newsletterV3Id=1f629c0dbfb9&user=Edward+Krueger&userId=4889b755e348&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}