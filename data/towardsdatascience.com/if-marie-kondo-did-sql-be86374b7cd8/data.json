{"url": "https://towardsdatascience.com/if-marie-kondo-did-sql-be86374b7cd8", "time": 1682996597.9592, "path": "towardsdatascience.com/if-marie-kondo-did-sql-be86374b7cd8/", "webpage": {"metadata": {"title": "If Marie Kondo did SQL\u2026. \u2026she\u2019d be all over dbplyr | by Keith McNulty | Towards Data Science", "h1": "If Marie Kondo did SQL\u2026", "description": "In a number of previous posts I have mentioned the dbplyr package as a really cool way to handle SQL databases in R. dbplyr is a very clever SQL translator which is getting more and more powerful\u2026"}, "outgoing_paragraph_urls": [{"url": "http://www.sqlitetutorial.net/sqlite-sample-database/", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://www.linkedin.com/in/keith-mcnulty/", "anchor_text": "LinkedIn", "paragraph_index": 21}, {"url": "https://twitter.com/dr_keithmcnulty", "anchor_text": "Twitter", "paragraph_index": 21}, {"url": "http://keithmcnulty.org", "anchor_text": "keithmcnulty.org", "paragraph_index": 23}], "all_paragraphs": ["In a number of previous posts I have mentioned the dbplyr package as a really cool way to handle SQL databases in R. dbplyr is a very clever SQL translator which is getting more and more powerful with every update. It allows you to treat your database table like it is an R dataframe object and to manipulate it using simple, clean tidyverse commands. It\u2019s so much nicer and more intuitive that handling all those messy SQL strings in your R console.", "I thought I would use a quick example to illustrate how dbplyr works, and I hope you can pick this example up and play further with it. Before you know it, you\u2019ll never want to write in SQL again!", "chinook is a SQLite database which can be downloaded here, and it\u2019s really easy to use for practice. Once you\u2019ve unzipped it to a folder, get your R session open and we will use the following packages:", "First we will establish the connection with the SQLite database. Although this database is simply a locally saved file, you would use a similar connection into your Oracle or MSSQL databases or whatever[1].", "We now have an active connection into the chinook database. We can browse the tables in there using RSQLite::dbListTables(chinook) which tells that there are the following tables inside:", "We are going to play around with a few of these tables using dbplyr \u2014 in particular the following:", "We can easily set these tables up as database objects using dplyr as follows[2]:", "Each of these tables are now SQL database objects in your R session which you can manipulate in the same way as a dataframe. Note that you can see an extract of the data in each table by simply typing the table name in your R console. Importantly, in defining these tables, you are not physically downloading them, just creating a bare minimum extract to work with.", "Now let\u2019s try to do a really simple query, like how many employees do we have grouped by the year we hired them. If we were to write this as a straight SQL query, it would look like this:", "Now if we run DBI::dbGetQuery(chinook, qry) we get this returned:", "But we can also do this using nice tidyverse code as follows:", "Since this is a very small table, you can see it by simply typing its name in the console and it does indeed return the same table as the one just above. If it was larger, you\u2019d have to collect it from the database \u2014 more on that later.", "How does this magic seem to happen? Well, because employees is recognized by R as a SQL database object, R invokes dbplyr in the background to translate the piped tidyverse code into SQL. You can see the translated SQL using the dbplyr::sql_render() function. So for example dbplyr::sql_render(employees_by_hire_year) returns this:", "The example above is pretty simple, and it\u2019s not until your queries become quite complex that you really see the benefits of using dbplyr.", "Let\u2019s say that you want to work out how much customers spent per year on their orders. This means that you will have to extract the year from the Invoice Date, then join invoice to invoice_items using InvoiceId, then group by year and then calculate the total unit price times quantity ordered in that year. Thanks to dbplyr, we can just use our beautiful tidyverse grammar to do this:", "This is so much nicer and easier to work with than its SQL equivalent[3]. Note that in its current form amount_per_year is still only a database object and the data has not yet been formally extracted from the database. To formally extract the data you can use dplyr's collect() function, as follows:", "If you were working on a remote database as opposed to a local SQLite database, the added advantage is that dbplyr ensures that all the manipulation is done on the database and you simply collect the results, rather than having to draw all that data down into your session.", "See if you can get dbplyr working for you on the chinook dataset by trying these practice exercises:", "[1] The general code for connecting to a remote database is as follows:", "[2] To create a similar table inside a schema of a remote database, you\u2019d use the in_schema() function in dbplyr:", "[3] Here\u2019s the SQL translation of that last dbplyr query I wrote:", "Originally I was a Pure Mathematician, then I became a Psychometrician and a Data Scientist. I am passionate about applying the rigor of all those disciplines to complex people questions. I\u2019m also a coding geek and a massive fan of Japanese RPGs. Find me on LinkedIn or on Twitter.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Expert and Author in Applied Mathematics, Data Science, Statistics. Also writes History, Science, Culture. Find me on Twitter or keithmcnulty.org"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbe86374b7cd8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://keith-mcnulty.medium.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": ""}, {"url": "https://keith-mcnulty.medium.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Keith McNulty"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa859aab532a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&user=Keith+McNulty&userId=a859aab532a0&source=post_page-a859aab532a0----be86374b7cd8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "http://www.sqlitetutorial.net/sqlite-sample-database/", "anchor_text": "here"}, {"url": "https://www.linkedin.com/in/keith-mcnulty/", "anchor_text": "LinkedIn"}, {"url": "https://twitter.com/dr_keithmcnulty", "anchor_text": "Twitter"}, {"url": "https://medium.com/tag/data-science?source=post_page-----be86374b7cd8---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/programming?source=post_page-----be86374b7cd8---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/analytics?source=post_page-----be86374b7cd8---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/web-development?source=post_page-----be86374b7cd8---------------web_development-----------------", "anchor_text": "Web Development"}, {"url": "https://medium.com/tag/rstats?source=post_page-----be86374b7cd8---------------rstats-----------------", "anchor_text": "Rstats"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&user=Keith+McNulty&userId=a859aab532a0&source=-----be86374b7cd8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&user=Keith+McNulty&userId=a859aab532a0&source=-----be86374b7cd8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fbe86374b7cd8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----be86374b7cd8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----be86374b7cd8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----be86374b7cd8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----be86374b7cd8--------------------------------", "anchor_text": ""}, {"url": "https://keith-mcnulty.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://keith-mcnulty.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Keith McNulty"}, {"url": "https://keith-mcnulty.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "11K Followers"}, {"url": "http://keithmcnulty.org", "anchor_text": "keithmcnulty.org"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa859aab532a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&user=Keith+McNulty&userId=a859aab532a0&source=post_page-a859aab532a0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7991b3dbcee9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fif-marie-kondo-did-sql-be86374b7cd8&newsletterV3=a859aab532a0&newsletterV3Id=7991b3dbcee9&user=Keith+McNulty&userId=a859aab532a0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://peopleanalytics-regression-book.org/", "anchor_text": "Handbook of Regression Modeling in People Analytics2021"}, {"url": "https://ona-book.org", "anchor_text": "Handbook of Graphs and Networks in People Analytics2022"}, {"url": "https://medium.com/@keith-mcnulty/books?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "See all (2)"}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}