{"url": "https://towardsdatascience.com/forecasting-in-a-spare-parts-business-45437cadf195", "time": 1683007366.555614, "path": "towardsdatascience.com/forecasting-in-a-spare-parts-business-45437cadf195/", "webpage": {"metadata": {"title": "Forecasting in a Spare Parts Business | by Ant\u00f3nio Fernandes | Towards Data Science", "h1": "Forecasting in a Spare Parts Business", "description": "With this example, an R forecasting pipeline was created with several statistical methods, running daily and for each part, to support the Automatic Replenishment System. Methods like additive\u2026"}, "outgoing_paragraph_urls": [{"url": "https://mariadb.com/kb/en/recursive-common-table-expressions-overview/", "anchor_text": "Recursive Common Table Expressions", "paragraph_index": 17}, {"url": "https://github.com/robjhyndman/forecast", "anchor_text": "forecast", "paragraph_index": 25}], "all_paragraphs": ["With this example, an R forecasting pipeline was created with several statistical methods, running daily and for each part, to support the Automatic Replenishment System. Methods like additive Holt-Winters, exponential smoothing, Croston and Facebook Prophet were ensembled to output a demand forecast for each part and for the next demand period. As future work, other approaches like LSTM can be implemented and analyzed to improve forecasts, when applicable.", "The spare parts business has its own set of challenges:", "These three issues increase the problem of dead stock and low inventory turns and are inversely proportional to the wholesaler size: small parts businesses are more prone to the impact of these issues.", "On top of these challenges\u2019 others do exist but are more common to other businesses:", "I\u2019ll start by telling a story about the future: it will not be exactly the thing you predict it to be! And the more you want to predict on a granularity basis, the biggest the error you can get out of it.", "On a business side, that doesn\u2019t mean that you should ignore it. You only need to do, on average, a little better than the competition and, on the long run, you will have a competitive advantage.", "For this business problem, I used 4 approaches:", "Others could be added(ARIMA, LSTM) to the pipeline but, for brevity and simplicity, we choose to start with these.", "Exponential smoothing was introduced in the final years of 1950s by Charles C. Holt. The basic concept is structuring the time-series in a sequence of moving average windows and then weight more the recent windows over older ones. The weighting method is exponential producing good forecasts.", "Exponential smoothing is a rule of thumb technique for smoothing time series data using the exponential window function. Whereas in the simple moving average the past observations are weighted equally, exponential functions are used to assign exponentially decreasing weights over time.", "This method was an improvement on the previous work of Holt. It was developed by Peter R. Winters adding seasonality and became also known as triple exponential smoothing.", "Published in 1972 with the title \u201cForecasting and Stock Control for Intermittent Demands\u201d, it tackles the problem of exponential smoothing overstock by averaging the occurrences only on the periods that they occur and multiplying by the probability of having an occurrence.", "The caveat about it, is that it cannot handle negative sales (invoice credit being done to clients if the sum is negative). You will have to be aware of that when forecasting for a specific spare part.", "Prophet is a procedure for forecasting time series data based on an additive model where non-linear trends are fit with yearly, weekly, and daily seasonality, plus holiday effects. It works best with time series that have strong seasonal effects and several seasons of historical data. Prophet is robust to missing data and shifts in the trend, and typically handles outliers well.", "This method was published in 2017 (more recently than the first three that we use) and the reason we studied it was that it accounted for calendar effects (like holidays) besides being completely automated.", "On the downside, data ingestion is different from the previous three, forcing to develop another data extraction procedure. Also, and for our business case, it was much slower than the others and forced us to rebuild/upgrade some server software components. It has somewhat of a bigger barrier to implement in production.", "The spare parts business has a lot of supersessions. A part starts with sku A, changes to B, goes to C (or back to A)\u2026 A mess, to whoever wants a clean approach.", "So, we\u2019ll need a function that can fetch, for a part, its supersession chain. Thanks to Recursive Common Table Expressions with one swoop, it can get all parts in the chain:", "And, from a tabular view of supersessions, we get a list:", "This is, perhaps, something more troublesome to tackle. Being supplied by several providers (with different lead times), for each part, it is necessary to assess the main supplier (if multiples exist) and forecast accordingly.", "Assuming, for example, supplier A has a stock replenishment lead time of 1 week (from order to stock availability after goods in), we can forecast for n periods of 1 week each. If, on the other hand, supplier B\u2019 parts take a month to deliver, then its forecasting period should be also in windows of 1 month.", "For brevity purposes on this post, the analysis done is going to assume windows of 1 month (the production approach had variable lead times on a per supplier/brand basis).", "Almost every sales data source comes in a tabular form. You get something like this:", "For forecasting purposes, it is necessary to change this structure to a time series (example for a single sku using monthly buckets \u2014 take note of a negative occurrence in September 2018):", "To convert from tabular to a series, just \u2018group by\u2019 the time period in the database:", "Now, using the data, we needed to setup the forecasting side of it. We used R for that (thanks to the phenomenal library forecast) but you could use Python or other solutions.", "Add the required libraries and connect to the database:", "Get the data from the database:", "Create a time-series from the data:", "Attempt the first forecasts (for Croston only if there is no negative occurrences):", "If you, even so, choose to use Croston, you can zero the negative occurrences (please consider when comparing forecasting methods since you are changing data for one of them):", "Looking at the graphs, we tend to choose Holt-Winters upfront (the others seem \u201ctoo flat\u201d). But, for this use case, only the forecast for the \u201cnext period\u201d is important because we will be doing it recurrently.", "All methods lead to a similar result with either 4 or 5 units sold in January 2020 on average and \u201cHi 95\u201d interval reaching 18 or 13.", "As I mentioned, Prophet data intake is a little different. First it expects daily data and the headers must be \u2018ds\u2019 and \u2018y\u2019:", "So, we will need to change our data source SQL. Something like this will do:", "(If you took notice, we are zeroing negative occurrences. There\u2019s also a feature from the model called \u201cSaturating Minimum\u201d that we can use.)", "And getting the forecast for the next period is just a matter of tailing the forecast:", "Now that we have a working MVP, it\u2019s time to take it to production. For those still using their IT infrastructure on-premises, computation is relatively cheap. The servers are already there, idling most of the time and begging to do something useful.", "Doing 4 forecasts for each sku easily takes more than a full day for our dataset (+50.000 sku). I\u2019ll give you a hint: Prophet is to blame on this \ud83d\ude0a", "But there are strategies to use to reduce the time taken:", "This is the best option to decrease the time taken. Split the workers by warehouse or by brand or by any other criteria. Just note that, equally cardinality of the groups usually means that it runs faster (ends sooner) by avoiding one lingering group with more skus than the rest.", "Another approach you can use, is split Prophet from the others. That way, and since data capturing is different, the others will end sooner. Be aware that some Prophet forecasts are long running and the database connections / transactions might close on the database side.", "On the other hand, parallelizing the calculations has 2 problems you will need to tackle:", "This option is another type of shortcut \ud83d\ude0a. If your replenishment orders occur every day, the parts not sold/bought in the previous day \u201ccould\u201d mainly have their stock forecast decreased (please take this with a grain of salt because it\u2019s no mathematically correct when other issues like seasonality came into effect).", "This kind of solution has the advantage of also decreasing the calculations done by a factor related to the number of different parts (on average) sold per day. If your set has 50.000 skus and you only sell/buy around 5.000 on an average day, then you reduce the calculations by 90%.", "If you choose to use this strategy, I recommend to have a full run every week/month.", "Now that we have a pipeline running 4 different forecasts on each part, which one should we select?", "There are a few notions to help you choose (I cannot go in much detail here):", "This is, perhaps, the more business side of the project. It really depends on what is the underlying reason you are trying to forecast: if it is mathematical accuracy or business advantage. \ud83d\udc4d", "From the work done, both Croston and Holt-Winters did very good. ETS was the model with worst performance and Prophet, being much more computing intensive, did not gave enough advantage for 7 days, 15 days or 30 days forecast.", "With the work done on the automatic order pipeline, the forecasting side fed the estimated sales to it and allowed for a complete automated stock management.", "That\u2019s it! All done! New challenges awaiting some place else!!! \ud83d\udc4f", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F45437cadf195&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----45437cadf195--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@antoniopaisfernandes?source=post_page-----45437cadf195--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@antoniopaisfernandes?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Ant\u00f3nio Fernandes"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc1374a64810c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&user=Ant%C3%B3nio+Fernandes&userId=c1374a64810c&source=post_page-c1374a64810c----45437cadf195---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@danielsessler", "anchor_text": "Daniel Se\u00dfler"}, {"url": "https://unsplash.com/?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Exponential_smoothing", "anchor_text": "https://en.wikipedia.org/wiki/Exponential_smoothing"}, {"url": "https://mariadb.com/kb/en/recursive-common-table-expressions-overview/", "anchor_text": "Recursive Common Table Expressions"}, {"url": "https://github.com/robjhyndman/forecast", "anchor_text": "forecast"}, {"url": "https://medium.com/tag/forecasting?source=post_page-----45437cadf195---------------forecasting-----------------", "anchor_text": "Forecasting"}, {"url": "https://medium.com/tag/r?source=post_page-----45437cadf195---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/holt-winters?source=post_page-----45437cadf195---------------holt_winters-----------------", "anchor_text": "Holt Winters"}, {"url": "https://medium.com/tag/spare-parts?source=post_page-----45437cadf195---------------spare_parts-----------------", "anchor_text": "Spare Parts"}, {"url": "https://medium.com/tag/prophet?source=post_page-----45437cadf195---------------prophet-----------------", "anchor_text": "Prophet"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&user=Ant%C3%B3nio+Fernandes&userId=c1374a64810c&source=-----45437cadf195---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&user=Ant%C3%B3nio+Fernandes&userId=c1374a64810c&source=-----45437cadf195---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----45437cadf195--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F45437cadf195&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----45437cadf195---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----45437cadf195--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----45437cadf195--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----45437cadf195--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----45437cadf195--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----45437cadf195--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@antoniopaisfernandes?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@antoniopaisfernandes?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ant\u00f3nio Fernandes"}, {"url": "https://medium.com/@antoniopaisfernandes/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "15 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc1374a64810c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&user=Ant%C3%B3nio+Fernandes&userId=c1374a64810c&source=post_page-c1374a64810c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F792c37482454&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fforecasting-in-a-spare-parts-business-45437cadf195&newsletterV3=c1374a64810c&newsletterV3Id=792c37482454&user=Ant%C3%B3nio+Fernandes&userId=c1374a64810c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}