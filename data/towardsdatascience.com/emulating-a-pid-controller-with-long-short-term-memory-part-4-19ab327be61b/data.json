{"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b", "time": 1683015817.906068, "path": "towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b/", "webpage": {"metadata": {"title": "Emulating a PID Controller with Long Short-term Memory: Part 4 | by Nicholas Lewis | Towards Data Science", "h1": "Emulating a PID Controller with Long Short-term Memory: Part 4", "description": "Here we are in the last section of this fun project! Here\u2019s where we\u2019ll see some practical applications of using the LSTM to emulate the PID controller, as well as some potential shortcomings. If you\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "code", "paragraph_index": 0}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "Temperature Control Lab", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Part 2", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Part 3", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Part 3", "paragraph_index": 8}, {"url": "https://www.sciencedirect.com/science/article/pii/S2405896318320597", "anchor_text": "paper", "paragraph_index": 12}, {"url": "https://apmonitor.com/do/index.php/Main/TCLabB", "anchor_text": "APMonitor.com", "paragraph_index": 19}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "LinkedIn", "paragraph_index": 21}], "all_paragraphs": ["Here we are in the last section of this fun project! Here\u2019s where we\u2019ll see some practical applications of using the LSTM to emulate the PID controller, as well as some potential shortcomings. If you haven\u2019t read the previous articles in the series, I highly recommend going back so you can have some context. And of course, the neat thing about this project is that you can run all the code on your own Temperature Control Lab device, simulating something that you might see in a real refinery or chemical plant. So here\u2019s a quick recap of this series, then we\u2019ll get started!", "If you\u2019re familiar with PID controllers, the first thing you may have been wondering during the problem setup is what happens if you change the tuning parameters? Recall the PID controller equation:", "If we change K_c, \u03c4_I, or \u03c4_D, the heater output changes, and then the LSTM that we trained no longer matches the output. One could look at this as a huge downside \u2014 if we change the tuning parameters for the PID controller, we\u2019d have to go to all the work to retrain the LSTM to emulate the new behavior (back to Part 2). On the other hand, we could use this to our advantage. Once a PID controller is tuned to a system, it\u2019s rare that we\u2019d need to change the tuning parameters, so changes to the PID behavior might indicate a malicious attack from an outsider (or potentially an insider such as a disgruntled employee).", "Suddenly, we have an anomaly detection method out of the box. We can do what we did as a check in Part 3, where we run the controller off the PID, but also check the LSTM output to make sure they\u2019re similar. If they\u2019re not, then we know something has set the PID controller out of whack, and we can investigate to fix it.", "Let\u2019s take a look at our setup, which should be familiar by now, but with a few changes:", "As usual, we import our model and accompanying parameters, set a run time, initiate the arrays to store data, and create a setpoint profile. There are also a few things to point out. We have t_pid and t_lstm, which we\u2019ll be using later on to time the controllers. We have the start_anom variable, which I use to indicate when the anomalous section of data should begin. Notice that I also setup an array for heater 2 (Q2), which we\u2019ll be using for another test later on. And finally, I kept the setpoint for the heater a bit lower during the anomalous section of data \u2014 it will work with higher temperatures, but it\u2019s easier to see when the temperature stays lower.", "I also made a change to the pid(sp,pv,pv_last,ierr,dt) function, so it now takes the tuning \u201cconstants\u201d as additional inputs (Kc,tauI,tauD). This will let us change the PID controller output mid-run.", "And finally, here\u2019s what the code will look like as we run the simulation:", "There\u2019s a lot in there, but it should look familiar from Part 3. The main difference is the line where we change the PID tuning parameters: Kc, tauI, tauD = 3.0*Kc0, 0.5*tauI0, tauD0 + 2.0 when our time count goes beyond our start_anom specification. You\u2019ll also notice a few time recordings in there, which we\u2019ll address in the next section.", "After letting this run, we can plot the results and put them into a video to visualize. Let\u2019s see what happened!", "As we saw in Part 3, the LSTM output closely resembles that of the PID, with obvious exceptions during the transient timeframe. This abruptly changes, as expected, when the PID tuning parameters change. You\u2019ll notice that since the PID controller is the one actually writing the output, that the heater output also starts to go erratic, and the temperature starts to fluctuate a lot more.", "We could easily plot the error between Qpid and Qlstm and use that to detect anomalous behavior. It\u2019s also convenient to have a backup in this case; if we notice that the PID controller starts behaving oddly, we can quickly switch control over to the LSTM controller, just by changing lab.Q1(Qpid[i])to lab.Q1(Qlstm[i]). Pretty neat that what initially might be thought of as a shortcoming actually turns out to be quite useful!", "If you recall, the primary reason we started this project was from a paper talking about using a neural network to emulate a model predictive controller, with the idea that the neural network would be faster than the controller. From the last run where we were computing both the LSTM and PID controller, we conveniently saved the time each one took. Let\u2019s see what the results are:", "Well, that\u2019s honestly what I expected. The PID is actually significantly faster than the LSTM, although the LSTM controller still computes in well under 1 second. There\u2019s a reason that PID controllers are used, and that\u2019s because they\u2019re fast and perform quite well for several control problems. If you have a more complex controller, though, we might expect the LSTM controller to still only take a fraction of a second for each computation, assuming the model inputs and parameters are similar. So while it actually has a time disadvantage over a PID controller, there are still some uses (check back for a bonus article coming November 2020 about a more complex controller and how the LSTM controller could be advantageous in that case).", "Finally, let\u2019s take another look at how the LSTM controller could be used to detect other types of anomalies. We\u2019ll simulate a situation where the ambient conditions are no longer standard in the refinery. Maybe this is from something as benign as different weather, or something as malicious as a cyber attack that is targeting another part of the plant (or even this specific process). How would the controller behave differently?", "Let\u2019s simulate this anomalous event by turning on heater 2 for part of the time. While heater 2 is physically separated from the sensor on heater 1, it is still close enough to affect the conditions around heater 1 which we\u2019re trying to control. Our LSTM controller is trained on a specific set of data that was operating under standard room temperature, so if we turn on heater 2, we have a situation that the LSTM controller isn\u2019t trained to control. Similar to the case of changing the PID tuning parameters, this initially seems like a downfall of using the LSTM controller. However, if we have a carefully controlled ambient environment in our plant, then we\u2019d expect the controller to behave consistently; any deviation from that would indicate something anomalous is happening.", "Here\u2019s a look at the code for the run (recall that we already specified the Q2 parameters in the initial setup).", "This probably all looks familiar by now, with the notable exception of the last two lines: we\u2019ve turned over control to the LSTM, and we also read the Q2 value in. After running the simulation, we again can plot the results and put them into an animation.", "Very interesting. Notice that once we turn on Q2, the temperature tends to overshoot the setpoint, and the controller isn\u2019t able to properly account for the overshoot. That\u2019s because the controller isn\u2019t trained to account for extra heat coming from the nearby heater.", "That gives me an idea, but I think I\u2019ll let you try it out, now that you know how to set up the TCLab, train an LSTM, and run a temperature control simulation with it. Could you use the skills you learned from this series to set up a control system that turns on both of the heaters and tries to control both temperatures to a certain setpoint? This would be a Multiple Input, Multiple Output (MIMO) controller. For a prod in the right direction, visit the MIMO lab at APMonitor.com.", "That brings us to the conclusion of this project. We started with a basic PID controller, generated some data, used that data to train an LSTM to emulate the PID controller, turned over control to the LSTM, and then looked at some useful applications such as detecting various anomalies and potential computation time savings.", "So how did you do? Did you get excited about this project like I did? What other applications can you think of for this? I\u2019m happy to hear suggestions for areas that could use more clarification. Thanks for following along on this project, and I look forward to future interactions. If you enjoyed this, feel free to connect with me on LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F19ab327be61b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://nrlewis929.medium.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702----19ab327be61b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@mantasos?utm_source=medium&utm_medium=referral", "anchor_text": "Tasos Mansour"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/nrlewis929/TCLab_emulate_PID", "anchor_text": "code"}, {"url": "http://apmonitor.com/pdc/index.php/Main/ArduinoTemperatureControl", "anchor_text": "Temperature Control Lab"}, {"url": "https://medium.com/@nrlewis929/emulating-a-pid-controller-with-long-short-term-memory-part-1-bb5b87165b08", "anchor_text": "Using the Temperature Control Lab to create Proportional-Integral-Derivative controller data"}, {"url": "https://nrlewis929.medium.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Training a Long Short-term Memory neural network in Keras to emulate a PID controller"}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Controlling the Temperature Control Lab with an LSTM"}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-2-4a37d32e5b47", "anchor_text": "Part 2"}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Part 3"}, {"url": "https://towardsdatascience.com/emulating-a-pid-controller-with-long-short-term-memory-part-3-23da7df3e033", "anchor_text": "Part 3"}, {"url": "https://www.sciencedirect.com/science/article/pii/S2405896318320597", "anchor_text": "paper"}, {"url": "https://apmonitor.com/do/index.php/Main/TCLabB", "anchor_text": "APMonitor.com"}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "LinkedIn"}, {"url": "https://medium.com/tag/lstm?source=post_page-----19ab327be61b---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----19ab327be61b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/pid-controller?source=post_page-----19ab327be61b---------------pid_controller-----------------", "anchor_text": "Pid Controller"}, {"url": "https://medium.com/tag/python?source=post_page-----19ab327be61b---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/lstm-control-emulation?source=post_page-----19ab327be61b---------------lstm_control_emulation-----------------", "anchor_text": "Lstm Control Emulation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----19ab327be61b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=-----19ab327be61b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F19ab327be61b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----19ab327be61b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----19ab327be61b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----19ab327be61b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----19ab327be61b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----19ab327be61b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----19ab327be61b--------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://nrlewis929.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nicholas Lewis"}, {"url": "https://nrlewis929.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "214 Followers"}, {"url": "https://www.linkedin.com/in/nicholas-lewis-0366146b/", "anchor_text": "https://www.linkedin.com/in/nicholas-lewis-0366146b/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4cd35f7b702&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&user=Nicholas+Lewis&userId=a4cd35f7b702&source=post_page-a4cd35f7b702--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9c6ec087b148&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Femulating-a-pid-controller-with-long-short-term-memory-part-4-19ab327be61b&newsletterV3=a4cd35f7b702&newsletterV3Id=9c6ec087b148&user=Nicholas+Lewis&userId=a4cd35f7b702&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}