{"url": "https://towardsdatascience.com/real-time-custom-object-detection-a95d955cecda", "time": 1683008981.5608408, "path": "towardsdatascience.com/real-time-custom-object-detection-a95d955cecda/", "webpage": {"metadata": {"title": "Real Time Custom Object Detection: Part 2 | Towards Data Science", "h1": "Real Time Custom Object Detection", "description": "Implementation of custom trained object detection model"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/", "anchor_text": "Kaggle", "paragraph_index": 1}, {"url": "https://medium.com/u/c7445a0614a3?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Shauryasikt Jena", "paragraph_index": 1}, {"url": "https://pjreddie.com/darknet/", "anchor_text": "Darknet", "paragraph_index": 18}, {"url": "https://www.pyimagesearch.com/2017/11/06/deep-learning-opencvs-blobfromimage-works/", "anchor_text": "Mean Subtraction and Scaling", "paragraph_index": 22}], "all_paragraphs": ["In this article we will test the Custom trained Darknet model from my previous article", "Citations: The video output feed is available on YouTube by Bloomberg Quicktake. Image of a window is a screenshot of my personal computer. The output image feed is taken from an open source dataset from Kaggle. Huge thanks to Shauryasikt Jena", "In my last article, we saw how to create a custom mask detector using darknet. It would be more fun to see it in action, wouldn't it ;)", "So let\u2019s make it work and yeah, the steps are way easier than the one to train the model because you have already installed the required libraries if you have followed my previous article (Phew!).", "If you haven\u2019t, Keep Calm :), you can check everything in detail by going on my article.", "This entire code is executed using a CPU. If you are writing the video output, you don\u2019t need a GPU, the video is written according to your preferred frames per second value. For writing a video file, check out step 10.", "Okay\u2026 let\u2019s make it work! Please go through the entire article so that you don\u2019t miss out anything. Thanks :)", "Note: You also need ffmpeg==4.2.2+ to write the video output file. Please go through my previous article if you\u2019re having any issues. Once you have ffmpeg make sure you are running everything in the same anaconda environment in which you have installed ffmpeg.", "That\u2019s all you need, let\u2019s go to the important next step!", "This is a very crucial step for our object detector to roll. I am listing these files down below, ensure you have these files.", "Note: We created these files just before our training, so if you are missing any one of them, your model will give you a hard time. These two files are very specific to your custom object detector, my previous article will guide you what changes can be made. You can chill out! it just takes a minute to create these files, if followed every detail :)", "Okay\u2026 let\u2019s pause here for a minute to understand exactly how you get it.", "This file is known as the weights file, it is generally a large file also depending on your training size(for me it was 256mb). You get this file when your training has completed. In my case, the file name which I used was yolov3_custom_train_3000.weights. Here, \u20183000\u2019 means that the file was generated after completing 3000 epochs. If you have gone through the .cfg file, you\u2019ll find the epochs set to be 6000.", "This was because after some testing I found out that the weights file generated after 3000 epochs had the best accuracy among every weights file generated actually, not just the \u20186000\u2019 one.", "Okay. So more epochs should mean more accuracy right?", "More epochs can also mean overfitting which can drastically reduce the accuracy. My training data might have had some duplicate images, or I might have labelled some incorrectly (Yeah I know.. it was a tedious task so uh.. you know how the mind deviates right) which indeed had a direct impact on accuracy.", "Now.. the testing part starts. I will try my best to make it easy and simple to follow and obviously, understand side by side :)", "Luckily, cv2 has a built-in function.", "These beautiful functions makes our day way easier by directly reading the network model stored in Darknet model files and setting them up to for our detector code(Yaaasss!!).", "For more info on the function \u2014", "You also need to get the labels from the \u2018yolo.names\u2019 file..", "Note: configPath, weightsPath and labelsPath contain the paths to the respective files", "These are some steps we need to do for our model to get some preprocessed images. The preprocessing includes Mean Subtraction and Scaling.", "Yeah\u2026literally after this step we will have some confidence about our code and better understanding about what we have done and what are we gonna do after this.", "So what exactly is this code doing?", "layerOutputs contain a huge 2D array of float numbers from which we need the coordinates of our \u201cto be\u201d drawn bounding boxes, classid and the confidence scores of each prediction or we can say detection :)", "Oh yeah.. this step gave me a hard time initially when I was not providing the correct input data type to it. I also tried some pre-written functions of NMS, but my object detection was so slow\u2026", "After hitting my head for some time (not literally..), I was able to get the correct input datatype by writing the code given in the previous step for this super-fast life-saving function.", "You can find some info here \u2014", "The model returns more than one predictions, hence more than one boxes are present to a single object. We surely don\u2019t want that. Thanks to NMS, it returns a single best bounding box for that object.", "To get a deep understanding of NMS and how it works \u2014", "Aahhaa.. the interesting part. Let\u2019s get our detector running now", "Done!! This code will give you an image/frame containing your bounding boxes", "Note: Be sure to change OBJECT_NAME_1 and OBJECT_NAME_2 according to your object name. This would make your understanding better about your code;)", "Tip: I would recommend you to create a function in which you pass an image because later you can use this function for video as well as for an image input ;)", "The above code can be used in two ways \u2014", "This can be done by just reading the frame from a video, you can also resize it if you want so that your \u2018cv2.imshow\u2019 displays the output frames at a quicker rate that is frames per second. To read a video using cv2 \u2014", "Note: You don\u2019t need to convert the frames obtained to grey-scale.", "Now just pass the frame to the function (mentioned in the tip) and boom.. you have your real time object detector ready!", "Note: The above video output is smooth because I have saved the frames by writing it to a .mp4 file at 20 Frames per Second(fps)", "You can also test your object detector by just passing a single image. (Yeah.. less fun). To read an image using cv2 \u2014", "You might be wondering how I got the video output so smooth, right? Here\u2019s a trick you can use to get your smooth video output\u2026", "OpenCV has a function called as cv2.VideoWriter(), you can write your frames by specifying the file name, codecid, fps, and the same resolution as your input field.", "Define the variable out outside the while loop in which you are reading each frame of a video", "Note: The second parameter \u2018-1\u2019 is the codecid to be given, but it worked fine for me on my computer. The codecid can be different on your computer. Please visit this site for debugging\u2014", "The last parameter will help you to get the resolution of your input video. After this, put the code below in the while loop where your detector function is being called.", "Note: Your detector function should return an \u2018image\u2019", "Tip: You can also use \u2018moviepy\u2019 to write your frames into video\u2026", "So that\u2019s it! I hope you have your own custom object detector by now. Cheers!", "Thank you for going through the entire article, hope you found it informative. If you have any feedbacks they are most welcome!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AI enthusiast | Exploring stuff | MS in CS Conc. Applied Artificial Intelligence @ uOttawa"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa95d955cecda&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tejas-khare99.medium.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": ""}, {"url": "https://tejas-khare99.medium.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Tejas Khare"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd29109a93a63&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&user=Tejas+Khare&userId=d29109a93a63&source=post_page-d29109a93a63----a95d955cecda---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@dylu?utm_source=medium&utm_medium=referral", "anchor_text": "Jacek Dylag"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/", "anchor_text": "Kaggle"}, {"url": "https://medium.com/u/c7445a0614a3?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Shauryasikt Jena"}, {"url": "https://medium.com/@tejas.khare99/custom-object-detection-using-darknet-9779170faca2", "anchor_text": "Custom Object Detection using DarknetFull guide to Custom Darknetmedium.com"}, {"url": "https://pjreddie.com/darknet/", "anchor_text": "Darknet"}, {"url": "https://docs.opencv.org/3.4/d6/d0f/group__dnn.html#gafde362956af949cce087f3f25c6aff0d", "anchor_text": "OpenCV: Deep Neural Network modulecv::dnn::blobFromImage ( InputArray image, double scalefactor=1.0, const Size &size= Size(), const Scalar & mean=\u2026docs.opencv.org"}, {"url": "https://www.pyimagesearch.com/2017/11/06/deep-learning-opencvs-blobfromimage-works/", "anchor_text": "Mean Subtraction and Scaling"}, {"url": "https://docs.opencv.org/3.4/d6/d0f/group__dnn.html#ga29f34df9376379a603acd8df581ac8d7", "anchor_text": "OpenCV: Deep Neural Network modulecv::dnn::blobFromImage ( InputArray image, double scalefactor=1.0, const Size &size= Size(), const Scalar & mean=\u2026docs.opencv.org"}, {"url": "https://unsplash.com/@nbabrams?utm_source=medium&utm_medium=referral", "anchor_text": "Nick Abrams"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://docs.opencv.org/master/d6/d0f/group__dnn.html#gaeec27cb32195e71e6d88032bda193162", "anchor_text": "OpenCV: Deep Neural Network modulecv::dnn::blobFromImage ( InputArray image, double scalefactor=1.0, const Size &size= Size(), const Scalar & mean=\u2026docs.opencv.org"}, {"url": "https://towardsdatascience.com/non-maximum-suppression-nms-93ce178e177c", "anchor_text": "Non-maximum Suppression (NMS)A Technique to remove duplicates and false positives in object detectiontowardsdatascience.com"}, {"url": "https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_gui/py_video_display/py_video_display.html", "anchor_text": "Getting Started with Videos - OpenCV-Python Tutorials 1 documentationLearn to read video, display video and save video. Learn to capture from Camera and display it. You will learn these\u2026opencv-python-tutroals.readthedocs.io"}, {"url": "https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_gui/py_image_display/py_image_display.html", "anchor_text": "Getting Started with Images - OpenCV-Python Tutorials 1 documentationcv2.waitKey() is a keyboard binding function. Its argument is the time in milliseconds. The function waits for\u2026opencv-python-tutroals.readthedocs.io"}, {"url": "https://docs.opencv.org/3.4/dd/d9e/classcv_1_1VideoWriter.html", "anchor_text": "OpenCV: cv::VideoWriter Class ReferenceVideo writer class. More... Default constructors. The constructors/functions initialize video writers. On Linux FFMPEG\u2026docs.opencv.org"}, {"url": "https://stackoverflow.com/questions/38397964/cant-write-and-save-a-video-file-using-opencv-and-python", "anchor_text": "Can't write and save a video file using OpenCV and PythonThanks for contributing an answer to Stack Overflow! Please be sure to answer the question. Provide details and share\u2026stackoverflow.com"}, {"url": "https://pypi.org/project/moviepy/", "anchor_text": "moviepyMoviePy depends on the Python modules Numpy, imageio, Decorator, and tqdm, which will be automatically installed during\u2026pypi.org"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----a95d955cecda---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----a95d955cecda---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/yolov3?source=post_page-----a95d955cecda---------------yolov3-----------------", "anchor_text": "Yolov3"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----a95d955cecda---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/custom?source=post_page-----a95d955cecda---------------custom-----------------", "anchor_text": "Custom"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&user=Tejas+Khare&userId=d29109a93a63&source=-----a95d955cecda---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&user=Tejas+Khare&userId=d29109a93a63&source=-----a95d955cecda---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fa95d955cecda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----a95d955cecda---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----a95d955cecda--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----a95d955cecda--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----a95d955cecda--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----a95d955cecda--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----a95d955cecda--------------------------------", "anchor_text": ""}, {"url": "https://tejas-khare99.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tejas-khare99.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tejas Khare"}, {"url": "https://tejas-khare99.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "48 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd29109a93a63&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&user=Tejas+Khare&userId=d29109a93a63&source=post_page-d29109a93a63--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F139e2e5a9031&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-custom-object-detection-a95d955cecda&newsletterV3=d29109a93a63&newsletterV3Id=139e2e5a9031&user=Tejas+Khare&userId=d29109a93a63&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}