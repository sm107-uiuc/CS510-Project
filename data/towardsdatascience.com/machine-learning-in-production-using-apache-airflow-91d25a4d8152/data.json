{"url": "https://towardsdatascience.com/machine-learning-in-production-using-apache-airflow-91d25a4d8152", "time": 1683008827.0440361, "path": "towardsdatascience.com/machine-learning-in-production-using-apache-airflow-91d25a4d8152/", "webpage": {"metadata": {"title": "Machine Learning in Production using Apache Airflow | by Danylo Baibak | Towards Data Science", "h1": "Machine Learning in Production using Apache Airflow", "description": "To build a solution using Machine Learning (ML) is a complex task by itself. Whilst academic ML has its roots in research from the 1980s, the practical implementation of Machine Learning Systems in\u2026"}, "outgoing_paragraph_urls": [{"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "Apache Airflow", "paragraph_index": 2}, {"url": "https://github.com/DanilBaibak/ml-in-production", "anchor_text": "whole project", "paragraph_index": 2}, {"url": "https://github.com/DanilBaibak/ml-in-production/tree/master/docker", "anchor_text": "dockerized", "paragraph_index": 2}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.CheckOperator", "anchor_text": "CheckOperator", "paragraph_index": 9}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.IntervalCheckOperator", "anchor_text": "IntervalCheckOperator", "paragraph_index": 10}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.ValueCheckOperator", "anchor_text": "ValueCheckOperator", "paragraph_index": 14}, {"url": "https://scikit-learn.org/stable/", "anchor_text": "sklearn", "paragraph_index": 22}, {"url": "https://github.com/DanilBaibak/ml-in-production", "anchor_text": "DanilBaibak/ml-in-production", "paragraph_index": 25}], "all_paragraphs": ["\u201cAll models are wrong, but some are useful.\u201d \u2014 George Box.", "To build a solution using Machine Learning (ML) is a complex task by itself. Whilst academic ML has its roots in research from the 1980s, the practical implementation of Machine Learning Systems in production is still relatively new.", "Today I would like to share some ideas on how to make your ML Pipelines robust and interpretable using Apache Airflow. The whole project is available on Github. The code is dockerized, so it\u2019s pretty straightforward to play around with it even if you are not familiar with the technology.", "The topic is complex and multifaceted. In this article, I would like to focus only on the two parts of any ML project \u2014 Data Validation and Model Evaluation. The goal is to share practical ideas, that you can introduce in your project relatively simple, but still achieve great benefits.", "The subject is very extensive, so let\u2019s introduce several restrictions:", "If you are not familiar with Airflow, it is a platform to programmatically author, schedule, and monitor workflows [1]. Airflow workflows are built as Directed Acyclic Graphs (DAGs) of tasks. The Airflow scheduler executes your tasks on an array of workers while following the specified dependencies. The command-line utilities make performing complex surgeries on DAGs a snap. The user interface makes it easy to visualize pipelines running in production, monitor progress, and troubleshoot issues when needed.", "Data Validation is the process of ensuring that data is present, correct, and meaningful. Ensuring the quality of your data through automated validation checks is a critical step in building data pipelines at any organization.", "The data validation step is required before model training to decide whether you could train the model or stop the execution of the pipeline. This decision is automatically made if the following was identified by the pipeline [2]:", "Airflow provides a group of check operators, that allows us easy verify data quality. Let\u2019s look at how to use such Operators on practical examples.", "The CheckOperator expects a SQL query that will return a single row. Each value on that first row is evaluated using python bool casting. If any of the values return False the check is failed and errors out. So, simply added one task to the pipeline we can check if data exists for instance for a specific date.", "For more complex checks Airflow has IntervalCheckOperator. The Checks that the values of metrics given as SQL expressions are within a certain tolerance of the ones from \u201cdays_back\u201d before.", "One of the key-point for this check is ratio formula \u2014 which formula to use to compute the ratio between the two metrics. You can choose from two possible:", "relative_diff : computes abs(cur-ref) / ref", "IntervalCheckOperator allows you to check different metrics at the same time with the different ratios for some specific table.", "The ValueCheckOperator \u2014 a simple and powerful operator. It performs a pure value check using SQL code. You can use a SQL query of any complexity to get any value. The check will pass if the computed value is equal to the passed value with some tolerance.", "Using the check operators from Airflow, it is easier to understand where is a problem when you see that a check is failed, instead of dealing with error in the code.", "In the current example, I use all checks to test input data. But you can also check any output values. Also, it will be useful to add the checks to ETL pipelines.", "This step occurs after you successfully train the model given the new data. We evaluate and validate the model before it\u2019s promoted to production. Ideally, the offline model validation step should include [2]:", "In reality, it can be hard and expensive to keep the representative test dataset. But we still have to monitor the quality of the re-trained model.", "The simplest what we can do \u2014 calculate the metrics using the training dataset. The idea is that the researchers know the values of the error metrics for the training and test sets on the final step of the prototyping. If the value of the error after the next training becomes much higher or lower we should not use this model in production. Also if you are observing the ascending trend of the error value may mean the degradation of the model.", "The idea is the same. You want to be able to do a quick diagnostic of your model, that is working for a long time. The model\u2019s metadata could give you the ability to see some critical moments of the model lifecycle.", "We want to have some simple, but useful, solution, that we can quickly implement even for the existing projects. You can start monitoring for such properties:", "Here is an example of how it can be done with sklearn:", "Depending on the tech stack of your company you can, for instance, store the values to the database and build Grafana dashboard or if you use Datadog, simply log values and build the dashboard.", "The main ideas, that you should keep in mind while putting in production a new project:", "You can find the code of the project in the repository DanilBaibak/ml-in-production.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software Engineer at Meta | Machine Learning Engineer, Software Engineer, open-source enthusiast | Background in physics & engineering"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F91d25a4d8152&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://danylo-baibak.medium.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": ""}, {"url": "https://danylo-baibak.medium.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Danylo Baibak"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa76301d99d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&user=Danylo+Baibak&userId=a76301d99d29&source=post_page-a76301d99d29----91d25a4d8152---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@realaxer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "tian kuan"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "Apache Airflow"}, {"url": "https://github.com/DanilBaibak/ml-in-production", "anchor_text": "whole project"}, {"url": "https://github.com/DanilBaibak/ml-in-production/tree/master/docker", "anchor_text": "dockerized"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.CheckOperator", "anchor_text": "CheckOperator"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.IntervalCheckOperator", "anchor_text": "IntervalCheckOperator"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html?highlight=intervalcheckoperator#airflow.operators.check_operator.ValueCheckOperator", "anchor_text": "ValueCheckOperator"}, {"url": "https://scikit-learn.org/stable/", "anchor_text": "sklearn"}, {"url": "https://github.com/DanilBaibak/ml-in-production", "anchor_text": "DanilBaibak/ml-in-production"}, {"url": "https://airflow.apache.org/docs/stable/", "anchor_text": "Apache Airflow Documentation"}, {"url": "https://cloud.google.com/solutions/machine-learning/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning", "anchor_text": "MLOps: Continuous delivery and automation pipelines in machine learning"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.SGDClassifier.html", "anchor_text": "SGDClassifier"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html", "anchor_text": "RandomForestRegressor"}, {"url": "https://airflow.apache.org/docs/stable/_api/airflow/operators/check_operator/index.html", "anchor_text": "Airflow Check Operators"}, {"url": "https://ai.google/research/pubs/pub46555", "anchor_text": "The ML Test Score: A Rubric for ML Production Readiness and Technical Debt Reduction"}, {"url": "https://www.microsoft.com/en-us/research/uploads/prod/2019/03/amershi-icse-2019_Software_Engineering_for_Machine_Learning.pdf", "anchor_text": "Software Engineering for Machine Learning: A Case Study"}, {"url": "https://christophergs.com/machine%20learning/2020/03/14/how-to-monitor-machine-learning-models/", "anchor_text": "Monitoring Machine Learning Models in Production"}, {"url": "https://airflow.apache.org/docs/stable/best-practices.html", "anchor_text": "Airflow Best Practices"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----91d25a4d8152---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-pipeline?source=post_page-----91d25a4d8152---------------data_pipeline-----------------", "anchor_text": "Data Pipeline"}, {"url": "https://medium.com/tag/data-science?source=post_page-----91d25a4d8152---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/airflow?source=post_page-----91d25a4d8152---------------airflow-----------------", "anchor_text": "Airflow"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----91d25a4d8152---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&user=Danylo+Baibak&userId=a76301d99d29&source=-----91d25a4d8152---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&user=Danylo+Baibak&userId=a76301d99d29&source=-----91d25a4d8152---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F91d25a4d8152&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----91d25a4d8152---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----91d25a4d8152--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----91d25a4d8152--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----91d25a4d8152--------------------------------", "anchor_text": ""}, {"url": "https://danylo-baibak.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://danylo-baibak.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Danylo Baibak"}, {"url": "https://danylo-baibak.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "74 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa76301d99d29&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&user=Danylo+Baibak&userId=a76301d99d29&source=post_page-a76301d99d29--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F917eaaeacda&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmachine-learning-in-production-using-apache-airflow-91d25a4d8152&newsletterV3=a76301d99d29&newsletterV3Id=917eaaeacda&user=Danylo+Baibak&userId=a76301d99d29&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}