{"url": "https://towardsdatascience.com/testing-serverless-services-59c688812a0d", "time": 1683000308.6798139, "path": "towardsdatascience.com/testing-serverless-services-59c688812a0d/", "webpage": {"metadata": {"title": "Testing Serverless Services. python unit-testing of AWS lambda\u2026 | by Vincent Claes | Towards Data Science", "h1": "Testing Serverless Services", "description": "python unit-testing of AWS lambda functions using moto. moto for aws mocking. arrange the tests with the AAA-pattern (Arrange, Act, Assert)"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/build-a-serverless-data-pipeline-on-aws-7c7d498d9707", "anchor_text": "tutorial I wrote earlier", "paragraph_index": 2}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline/lambda_function/extract.py", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless.yml#L43", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless.yml#L52", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://docs.python.org/3/library/unittest.html#module-unittest", "anchor_text": "unittest", "paragraph_index": 7}, {"url": "https://gist.github.com/vincentclaes/659f940445b482ae74aad92ac5d056bf#file-test_extract-py-L20", "anchor_text": "setUp", "paragraph_index": 10}, {"url": "https://gist.github.com/vincentclaes/659f940445b482ae74aad92ac5d056bf#file-test_extract-py-L28", "anchor_text": "tearDown", "paragraph_index": 11}, {"url": "https://github.com/spulec/moto", "anchor_text": "moto", "paragraph_index": 12}, {"url": "http://wiki.c2.com/?ArrangeActAssert", "anchor_text": "Arrange, Act, Assert (AAA) principle", "paragraph_index": 14}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L106", "anchor_text": "arrange", "paragraph_index": 15}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L113", "anchor_text": "act", "paragraph_index": 17}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L116", "anchor_text": "assert", "paragraph_index": 19}, {"url": "https://docs.python.org/2/library/unittest.html#assert-methods", "anchor_text": "here", "paragraph_index": 20}], "all_paragraphs": ["Having tests is crucial for the success of any software project. If you are developing an application, you want to write tests that check your applications functionality. With tests, you can add new features or fix bugs and deploy the changed code with some piece of mind. Without tests, you will live in a world full of insecurities and frustrations.", "We will test the python functionality of our AWS lambda using the python default test framework unittest and an AWS services mocking tool called moto. Furthermore we will explain how you can use the AAA-pattern (Arrange, Act, Assert) to arrange and format your testing code.", "The code below is a snippet from the original code that is part of a project called \"serverless data pipeline example\" that was the result of a tutorial I wrote earlier. The original code for this handler can be found here on my Github.", "The lambda handler is triggered by an s3 event. The event is a .eml file (email file) that is created in the unzip/ folder of our s3 bucket. The configuration of the lambda and the s3 event that triggers the lambda can be found here in the serverless.yml of the project.", "The event is passed to our handler function as the first argument in the form of a dictionary. We take the bucket name and the s3 key from the event, which points to the location of our email file. We read the email file and extract the contents as a JSON object. The JSON object is dumped back onto s3. The destination bucket and key are retrieved from the environment variables. The environment variables are configured here in the serverless.yml file.", "Start with creating a structure for your tests in your project. The easiest is to mimic the application structure in your tests folder. you can find an example here:", "inside the test_extract.py module we have the following code:", "For testing the logic of our lambda handler we will be using unittest. unittest is part of the python standard library and helps you create and run unit tests.", "We start by creating a class called TestExtract inside the test_extract.py file. Our class inherits from unittest.TestCase. by inheriting from TestCase you have access to functions that help facilitate your tests. Inside a testcase, the methods that start with the keyword \"test\" are considered as a test by the unittest test runner. you will find one test function in our example:", "Tip: make yourself and others easy to understand what you are testing by describing what your are testing in the name of your test function.", "unittest provides functions that can setup and teardown your test environment without needing to call them explicitly before and after each test. In our example, we need the necessary s3 buckets and some environment variables in order to let our test run successfully. We add this logic in the setUp function and before a test gets executed the setUp function is called.", "Once the test has run we want to remove the s3 buckets and the environment variables. We add this logic in the tearDown function and each time a test has finished the tearDown function is executed.", "We want to execute our functions locally and do not want to interact with the \u201creal\u201d AWS environment. Preferably we would like to interact with a mocked AWS environment. To create a mocked AWS environment we will use moto. moto is a library that allows your tests to easily mock out AWS Services. From moto we inherit mock_s3 which we use as a decorator on our test class:", "As soon as you set mock_s3 as a decorator, every interaction with S3 via boto3 is mocked. Like this, our tests can run offline like they were interacting with AWS services.", "Inside the test function, we test if the contents get extracted from the .eml file and that the contents are dumped successfully on s3 as a JSON object. Each test function is structured according to the Arrange, Act, Assert (AAA) principle.", "First, we arrange our environment in order for our test to execute. The generic setup and teardown functionality can be done in the functions setUp and tearDown, as described above. The test-specific configuration can be done in the test function itself.", "Once the s3 buckets are created and the environment variables are set in the setUp function, we arrange the test specific environment in our test function by reading a .eml file and upload the file to s3. The reading and uploading happens in the function", "The next step is to act by executing the lambda handler function we want to test.", "We see that our handler function returns an s3 key. In production, this s3 key is not used and has no value. We only return this value in order to verify that our test ran as we expect it.", "Once our handler function ran, we assert that the expected results have occurred. We do this by taking the s3 key the lambda handler returns and check if the mocked s3 bucket contains the expected JSON object.", "We read the object from s3 and we assert that the JSON object equals the object we expect. Don't start to write your own assertion functions, unittest has a bunch of advanced assertion methods which can be found here. we use the function", "To run the above example yourself, start with cloning the original project and installing the dependencies:", "to execute all the tests in the project, run:", "It will run all the test functions of the testcases. The test should pass and you should see the output \"OK\".", "to run an individual testcase you can run:", "to run an individual test function you can run:", "If all your tests pass you can deploy your project to AWS with some piece of mind.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Somewhere between Data Engineering and Data Science"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F59c688812a0d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----59c688812a0d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@vincentclaes_43752?source=post_page-----59c688812a0d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vincentclaes_43752?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Vincent Claes"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff0f938b799df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&user=Vincent+Claes&userId=f0f938b799df&source=post_page-f0f938b799df----59c688812a0d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@battlecreekcoffeeroasters?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Battlecreek Coffee Roasters"}, {"url": "https://unsplash.com/search/photos/quality-control?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/build-a-serverless-data-pipeline-on-aws-7c7d498d9707", "anchor_text": "tutorial I wrote earlier"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline/lambda_function/extract.py", "anchor_text": "here"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless.yml#L43", "anchor_text": "here"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless.yml#L52", "anchor_text": "here"}, {"url": "https://docs.python.org/3/library/unittest.html#module-unittest", "anchor_text": "unittest"}, {"url": "https://gist.github.com/vincentclaes/659f940445b482ae74aad92ac5d056bf#file-test_extract-py-L20", "anchor_text": "setUp"}, {"url": "https://gist.github.com/vincentclaes/659f940445b482ae74aad92ac5d056bf#file-test_extract-py-L28", "anchor_text": "tearDown"}, {"url": "https://github.com/spulec/moto", "anchor_text": "moto"}, {"url": "http://wiki.c2.com/?ArrangeActAssert", "anchor_text": "Arrange, Act, Assert (AAA) principle"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L106", "anchor_text": "arrange"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L113", "anchor_text": "act"}, {"url": "https://github.com/vincentclaes/serverless_data_pipeline_example/blob/master/serverless_data_pipeline_tests/lambda_function/test_extract.py#L116", "anchor_text": "assert"}, {"url": "https://docs.python.org/2/library/unittest.html#assert-methods", "anchor_text": "here"}, {"url": "https://medium.com/tag/aws?source=post_page-----59c688812a0d---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/serverless?source=post_page-----59c688812a0d---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/python?source=post_page-----59c688812a0d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/testing?source=post_page-----59c688812a0d---------------testing-----------------", "anchor_text": "Testing"}, {"url": "https://medium.com/tag/unittest?source=post_page-----59c688812a0d---------------unittest-----------------", "anchor_text": "Unittest"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&user=Vincent+Claes&userId=f0f938b799df&source=-----59c688812a0d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&user=Vincent+Claes&userId=f0f938b799df&source=-----59c688812a0d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F59c688812a0d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----59c688812a0d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----59c688812a0d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----59c688812a0d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----59c688812a0d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----59c688812a0d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----59c688812a0d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vincentclaes_43752?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@vincentclaes_43752?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Vincent Claes"}, {"url": "https://medium.com/@vincentclaes_43752/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "357 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff0f938b799df&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&user=Vincent+Claes&userId=f0f938b799df&source=post_page-f0f938b799df--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7c58e30392c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftesting-serverless-services-59c688812a0d&newsletterV3=f0f938b799df&newsletterV3Id=7c58e30392c2&user=Vincent+Claes&userId=f0f938b799df&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}