{"url": "https://towardsdatascience.com/pytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd", "time": 1683002779.811018, "path": "towardsdatascience.com/pytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd/", "webpage": {"metadata": {"title": "PyTorch Layer Dimensions: Get your layers to work every time (the complete guide) | Towards Data Science", "h1": "PyTorch Layer Dimensions: Get your layers to work every time (the complete guide)", "description": "Get your layers to fit smoothly, the first time, every time. A starter's guide to becoming fluent in tensor and layer dimensions in PyTorch."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/pytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd?source=your_stories_page-------------------------------------", "anchor_text": "PyTorch layer dimensions: What size and why?", "paragraph_index": 0}, {"url": "https://pytorch.org/docs/stable/nn.html#conv2d", "anchor_text": "documentation", "paragraph_index": 11}, {"url": "https://pytorch.org/docs/stable/torch.html#torch.unsqueeze", "anchor_text": "unsqueeze()", "paragraph_index": 18}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int", "paragraph_index": 20}, {"url": "https://pytorch.org/tutorials/beginner/blitz/neural_networks_tutorial.html", "anchor_text": "60-minute-beginner-blitz", "paragraph_index": 23}, {"url": "https://pytorch.org/docs/stable/nn.html#linear", "anchor_text": "Documentation", "paragraph_index": 25}, {"url": "https://pytorch.org/docs/stable/tensors.html#torch.Tensor.view", "anchor_text": "view", "paragraph_index": 29}], "all_paragraphs": ["This article covers defining tensors, and properly initializing neural network layers in PyTorch, and more! (Formerly titled PyTorch layer dimensions: What size and why?)", "You might be asking: \u201cHow do I initialize my layer dimensions in PyTorch without getting yelled at?\u201d Is it all just trial and error? No, really\u2026 What are they supposed to be? For starters, did you know that the first two required arguments of a torch.nn.Conv2d layer, and a torch.nn.Linear layer ask for completely different aspects of the exact same tensor data? If you didn\u2019t know this, keep reading.", "Example 1: Same, same, but different.", "Constructing a convolution layer and linear layer are syntactically similar, but the args do not expect similar things, despite being able to operate on the exact same input data (although that data should be sized differently).", "You need to develop your understanding of how PyTorch models would like to consume data before just throwing a dataset at some network layers.", "Below are some common tensor sizes encountered in PyTorch and typical examples of when to utilize them. It\u2019s important to know what you\u2019re looking at, because their structures are not as predictable as one might desire (this somewhat unintuitive design choice was implemented primarily for performance benefits, which is OK\u2026 I guess).", "One mental anchor we have when feeding tensors into convolutional or linear layers (although not RNN\u2019s) is that the first dimension is always batch size (N). Whereas, the remaining dimensions depend on what phase the moon is in and the intermittent frequency of cricket (Acheta domesticus) chirps at moonrise in your region. Just kidding, it\u2019s not that simple. You have to learn them by rote. So start roting (Example 2 below).", "It\u2019s important to know how PyTorch expects its tensors to be shaped\u2014 because you might be perfectly satisfied that your 28 x 28 pixel image shows up as a tensor of torch.Size([28, 28]). Whereas PyTorch on the other hand, thinks you want it to be looking at your 28 batches of 28 feature vectors. Suffice it to say, you\u2019re not going to be friends with each other for a little while until you learn how to see things her way \u2014 so, don\u2019t be that guy. Study your tensor dimensions!", "Example 2: The tensor dimensions PyTorch likes.", "Notice how the Conv2d layer wants a 4d tensor? How about the 1d or 3d layers?", "So, if you wanted to load a grey scale, 28 x 28 pixel image into a Conv2d network layer, find the layer type in the example above. Since it wants a 4d tensor, and you already have a 2d tensor with height and width, just add batch_size, and channels (see rule of thumb for channels below) to pad out the extra dimensions, like so: [1, 1, 28, 28]. That way, you and PyTorch can make up and be friends again.", "The documentation describes a Conv2d layer like this:", "Remember which dimension your input channels are? See Lesson 1 if you forgot. Simply use that number for your in_channels argument in the first convolutional layer. Done.", "Rule of thumb for \u201cin_channels\u201d on your first Conv2d layer:", "\u2014 If your image is black and white, it is 1 channel. (You can ensure this by running transforms.Grayscale(1) in the transforms argument of the dataloader.)", "\u2014 If your image is color, it is 3 channels (RGB).", "\u2014 If there is an alpha (transparency) channel, it has 4 channels.", "This means for your first Conv2d layer, even if your image size is something enormous like 1080px by 1080px, your in_channels will typically be either 1 or 3.", "Note: If you tested this with some randomly generated tensor and it throws up at you still and you\u2019re yelling at your computer right now, breathe. It\u2019s OK. Make sure it has the right dimensions. Did you unsqueeze() the tensor? Pytorch wants batches. The unsqueeze() function will add a dimension of 1 representing a batch size of 1.", "What about the out_channels you say? That\u2019s your choice for how deep you want your network to be. Basically, your out_channels dimension, defined by Pytorch is:", "out_channels (int) \u2014 Number of channels produced by the convolution", "For each convolutional kernel you use, your output tensor becomes one channel deeper when passing through that layer. If you want a ton of kernels, make this number high like 121, if you want just a few, make this number low like 8 or 12. Whatever number you choose here will be the value for channels_in of the next convolutional layer, and so on and so forth.", "Note: The value of kernel_size is custom, and although important, doesn\u2019t lead to head-scratching errors, so it is omitted from this tutorial. Just make it an odd number, typically between 3\u201311, but sizes may vary between your applications.", "Generally, convolutional layers at the front half of a network get deeper and deeper, while fully-connected (aka: linear, or dense) layers at the end of a network get smaller and smaller. Here\u2019s a valid example from the 60-minute-beginner-blitz (notice the out_channel of self.conv1 becomes the in_channel of self.conv2):", "Let\u2019s talk about fully connected layers now.", "Documentation for Linear layers tells us the following:", "I know these look similar, but do not be confused: \u201cin_features\u201d and \u201cin_channels\u201d are completely different, beginners often mix them up and think they\u2019re the same attribute.", "There are two, specifically important arguments for all nn.Linear layer networks that you should be aware of no matter how many layers deep your network is. The very first argument, and the very last argument. It doesn\u2019t matter how many fully connected layers you have in between, those dimensions are easy, as you\u2019ll soon see.", "If you want to pass in your 28 x 28 image into a linear layer, you have to know two things:", "Use view() to change your tensor\u2019s dimensions.", "You supply your batch_size as the first number, and then \u201c-1\u201d basically tells Pytorch, \u201cyou figure out this other number for me\u2026 please.\u201d Your tensor will now feed properly into any linear layer. Now we\u2019re talking!", "So then, to initialize the very first argument of your linear layer, pass it the number of features of your input data. For 28 x 28, our new view tensor is of size [1, 784] (1 * 28 * 28):", "Example 3: Resize with view() to fit into a linear layer", "Remember this \u2014 if you\u2019re ever transitioning from a convolutional layer output to a linear layer input, you must resize it from 4d to 2d using view, as described with image example above.", "The second argument of a linear layer, if you\u2019re passing it on to more layers, is called H for hidden layer. You just kind of play positional ping-pong with H and make it the last of the previous and the first of the next, like this:", "The very last output, aka your output layer depends on your model and your loss function. If you have 10 classes like in MNIST, and you\u2019re doing a classification problem, you want all of your network architecture to eventually consolidate into those final 10 units so that you can determine which of those 10 classes your input is predicting.", "The last layer is dependent on what you want to infer from your data. The operations you can do to get the answer you need is a topic for another article, because there is a lot to cover. But for now you should have all the basics covered.", "You should now be able to build a network without scratching your head or getting shouted at by the interpreter. Remember, your batch_size or dim 0 is the same, all the way through. Your convolution layers care about depth (channels), and your linear layers care about feature counts. And learn how to read those tensors!", "Please leave a comment, or share this article if you liked it and found it helpful!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "\u2627 Cognitive Science Master, Experienced digital product designer. Formerly @GoPro . Exploring the intersection of tech, startups, and a.i./deep learning"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4265a41e01fd&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://jakekrajewski.medium.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": ""}, {"url": "https://jakekrajewski.medium.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Jake Krajewski"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd08d60aa08c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&user=Jake+Krajewski&userId=d08d60aa08c&source=post_page-d08d60aa08c----4265a41e01fd---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@snaps_by_clark?utm_source=medium&utm_medium=referral", "anchor_text": "Clark Van Der Beken"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/pytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd?source=your_stories_page-------------------------------------", "anchor_text": "PyTorch layer dimensions: What size and why?"}, {"url": "https://unsplash.com/@punttim?utm_source=medium&utm_medium=referral", "anchor_text": "Tim Gouw"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://pytorch.org/docs/stable/nn.html#conv2d", "anchor_text": "documentation"}, {"url": "https://pytorch.org/docs/stable/torch.html#torch.unsqueeze", "anchor_text": "unsqueeze()"}, {"url": "https://docs.python.org/3/library/functions.html#int", "anchor_text": "int"}, {"url": "https://pytorch.org/tutorials/beginner/blitz/neural_networks_tutorial.html", "anchor_text": "60-minute-beginner-blitz"}, {"url": "https://pytorch.org/docs/stable/nn.html#linear", "anchor_text": "Documentation"}, {"url": "https://pytorch.org/docs/stable/tensors.html#torch.Tensor.view", "anchor_text": "view"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4265a41e01fd---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----4265a41e01fd---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----4265a41e01fd---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/dimensions?source=post_page-----4265a41e01fd---------------dimensions-----------------", "anchor_text": "Dimensions"}, {"url": "https://medium.com/tag/neural-network?source=post_page-----4265a41e01fd---------------neural_network-----------------", "anchor_text": "Neural Network"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&user=Jake+Krajewski&userId=d08d60aa08c&source=-----4265a41e01fd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&user=Jake+Krajewski&userId=d08d60aa08c&source=-----4265a41e01fd---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4265a41e01fd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4265a41e01fd---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4265a41e01fd--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4265a41e01fd--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4265a41e01fd--------------------------------", "anchor_text": ""}, {"url": "https://jakekrajewski.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://jakekrajewski.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jake Krajewski"}, {"url": "https://jakekrajewski.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "210 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd08d60aa08c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&user=Jake+Krajewski&userId=d08d60aa08c&source=post_page-d08d60aa08c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe248356cbb48&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpytorch-layer-dimensions-what-sizes-should-they-be-and-why-4265a41e01fd&newsletterV3=d08d60aa08c&newsletterV3Id=e248356cbb48&user=Jake+Krajewski&userId=d08d60aa08c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}