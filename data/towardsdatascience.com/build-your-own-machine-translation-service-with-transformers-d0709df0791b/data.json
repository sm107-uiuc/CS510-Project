{"url": "https://towardsdatascience.com/build-your-own-machine-translation-service-with-transformers-d0709df0791b", "time": 1683008970.553867, "path": "towardsdatascience.com/build-your-own-machine-translation-service-with-transformers-d0709df0791b/", "webpage": {"metadata": {"title": "Build Your Own Machine Translation Service with Transformers | by Kyle Gallatin | Towards Data Science", "h1": "Build Your Own Machine Translation Service with Transformers", "description": "Machine translation is in demand within the enterprise environment. It\u2019s vital that global companies are able to share documents, notes, emails, and other texts with people across the world in a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://twitter.com/huggingface/status/1260942644286537728?s=20", "anchor_text": "Huggingface released", "paragraph_index": 4}, {"url": "https://huggingface.co/models?search=Helsinki-NLP", "anchor_text": "1,000 pre-trained language models from Helsinki University", "paragraph_index": 4}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Huggingface", "paragraph_index": 5}, {"url": "https://huggingface.co/transformers/model_doc/marian.html", "anchor_text": "transformers docs", "paragraph_index": 5}, {"url": "https://github.com/kylegallatin/machine-translation-service", "anchor_text": "git repo", "paragraph_index": 7}, {"url": "https://github.com/kylegallatin/machine-translation-service/tree/docker-compose-flow", "anchor_text": "branch on git", "paragraph_index": 27}], "all_paragraphs": ["Machine translation is in demand within the enterprise environment. It\u2019s vital that global companies are able to share documents, notes, emails, and other texts with people across the world in a gamut of different languages.", "Arguably even more important is the need to democratize information alongside globalization. Regardless of your spoken language, you should have access to the same open source publications, healthcare info, tools, and knowledge as those whose primary language is widely spoken, like English.", "Fortunately, machine translation has been around for a while \u2014 many us of have used Google translate to confirm the contents of something online or just to sound smart and worldly. If you have translation needs that require scale, Azure, AWS and GCP have consumable APIs for as little as $10 per every million characters that support thousands of language pairs (a pair is comprised of a source language and target language).", "In the open source space, there has beens tons of machine learning work across a number of languages and people have long since been able to train their own machine translation models. However, most approaches seem disparate in terms of modeling approach and number of supported languages (in my own naive assessment).", "More recently, Huggingface released over 1,000 pre-trained language models from Helsinki University. For anyone looking to create their own AWS or Google translate API, it\u2019s never been easier. So, I figured I\u2019d capitalize on others\u2019 hard work. This is the functional equivalent of \u201clet\u2019s wrap machine learning in a flask API and docker image\u201d but, whatever, it\u2019s fun. Let\u2019s do it.", "Huggingface has done an incredible job making SOTA (state of the art) models available in a simple Python API for copy + paste coders like myself. To translate text locally, you just need to pip install transformers and then use the snippet below from the transformers docs.", "This will download the required model and translate source text -> target text. With the sheer quantity of supported languages available in this format, it\u2019s super easy to toss this into a dockerized flask app and call it a day, but we do have a bit additional of work to do first\u2026", "Feel free to follow along in the git repo.", "When you initialize the model above, transformers will download the required files if you don\u2019t have them locally. This is awesome for local use, but not when using docker containers. Since container storage is ephemeral, every time we exit the container we\u2019ll lose all the models, and need to download them all over again the next time.", "To circumvent this, we can handle the model download separately and mount the models as a volume. This also gives us more control over the languages we want our service to support from the get. Huggingface hosts all the necessary files on S3, so we can just standardize this\u2026", "And then create a simple command line utility for downloading them:", "Cool. Now we can download the models we need with a single command. Take the below example for Japanese -> English.", "python download_models.py --source ja --target en", "This will download them to a directory called data by default, so just check to make sure that exists.", "Now that we have a better way to manage the languages we support, let\u2019s get to the meat of the problem, then a class and associated methods to manage our translations.", "We need a couple of functions here:", "Thanks to the user friendliness of transformers, it takes hardly any time to wrap this functionality in a lightweight class for us to use.", "This class is initialized with the path we\u2019re using to save models and handles the rest itself. If we get a translation request and we don\u2019t have that model in memory, load_models is called to load it into the self.models dictionary. This check our data directory to see if we have that model, and returns a message to let us know whether or not we do.", "All we need to do now is wrap this in flask so we can make HTTP calls to it.", "To use it, just run python app.py and then make calls to the service. To check if it\u2019s working you can curl localhost:5000 or use something more sophisticated, like Postman. I use the flask server here, but you\u2019ll want a production web server to use this anywhere real.", "Now that our app works with base Python, we want to make it work with Docker or docker-compose so that we can scale it up and out as far as we need to. The actual Dockerfile we use for this is pretty simple. We just need to make sure we run the service with the volume attached so it already has access to the data.", "I\u2019d normally use a smaller base image but, honestly, I didn\u2019t feel like debugging:", "Again, we can test our endpoints by making calls to the service. If I\u2019ve downloaded a language route like en -> fr, then I should be able to make the following API call with curl:", "I\u2019ve wrapped my service in a little flask API, and even \u201ccorrectly\u201d made it a Docker container that can scale in a reproducible manner. However, I\u2019d like to share a few concerns with this approach.", "These translation models are pretty big (as in each one is like 300MB). Even if the data/models are downloaded separately, we still need to load every single language pair we want to support in memory \u2014 and that is quickly going to get out of hand for a single container.", "So, instead, why not create a configurable image we can use to spin up a container for each service using docker-compose? That way, there\u2019s one service per language pair and each pair can scale individually as demand increases. Then, we can write a single, exposed API that passes requests to all containers in the network.", "Disclaimer: It\u2019s at this point I just started making it up as I went along, and I\u2019m by no means convinced this was the optimal approach \u2014 but I wanted to see how far I could take it.", "To kick things off, I reworked the directory a bit. To check it out you can explore the branch on git I made:", "The purpose of the proxy is to redirect requests towards each machine translation service that gets spun up. This will be the only endpoint exposed. I made a quick docker-compose file for services that support en -> fr translation.", "Each translation service has the same env variables (I should probably just make a .env file), same command, and same volume which contains our models. There\u2019s probably a better way to scale this with yaml automation or something similar but I haven\u2019t gotten there yet.", "After that, I just do some ugly work to the /translate endpoint of my proxy in order to construct the requested service endpoint on demand. When users make requests to this exposed service, it will make another request to other containers only reachable from within that network.", "All we have to do is build the base image.", "And badabing badaboom. Here\u2019s a screenshot from the output using postman.", "Not going to go in depth here, but the logical next step would be to take this to kubernetes for true scale. An easy starting point is using the kompose CLI to turn docker-compose into kubernetes YAML. On macOS:", "This should create some of the YAML files you\u2019ll need to scale your services and deployments to K8s.", "Here\u2019s the example deployment for the fr-en service:", "Once you have a configured kubernetes cluster, you can kubectl apply -f $FILENAME to create your services, deployments, and persistent volume claims.", "Of course, there\u2019s more work to do and yet more kubernetes objects to create, but I wanted to provide a simple starter here for anyone actually looking to scale something akin to this.", "I\u2019m hoping that the tools Huggingface continues to build (along with the models dedicated researchers train) keep providing equitable access to intelligent machine learning. Efforts in open machine translation not only contribute to the research field, but enable worldwide access to extremely important resources written in a single language.", "I have no idea if hosting these massive models yourself is even half as cheap as using an AWS or Google Translate API, and I also haven\u2019t explored the quality. But this was super fun to dive into and hopefully offers some insight into what you can build with the thousands of SOTA machine learning models available at your fingertips.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software Engineer for ML Infra. Building scalable, operationalized machine learning services. I don\u2019t represent my employer."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd0709df0791b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d0709df0791b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kylegallatin?source=post_page-----d0709df0791b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kylegallatin?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Kyle Gallatin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F51ff4b76ebf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=post_page-51ff4b76ebf4----d0709df0791b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://twitter.com/huggingface/status/1260942644286537728?s=20", "anchor_text": "Huggingface released"}, {"url": "https://huggingface.co/models?search=Helsinki-NLP", "anchor_text": "1,000 pre-trained language models from Helsinki University"}, {"url": "https://huggingface.co/transformers/", "anchor_text": "Huggingface"}, {"url": "https://huggingface.co/transformers/model_doc/marian.html", "anchor_text": "transformers docs"}, {"url": "https://github.com/kylegallatin/machine-translation-service", "anchor_text": "git repo"}, {"url": "http://localhost:5000/translate'", "anchor_text": "http://localhost:5000/translate'"}, {"url": "https://github.com/kylegallatin/machine-translation-service/tree/docker-compose-flow", "anchor_text": "branch on git"}, {"url": "https://medium.com/tag/machine-translation?source=post_page-----d0709df0791b---------------machine_translation-----------------", "anchor_text": "Machine Translation"}, {"url": "https://medium.com/tag/transformers?source=post_page-----d0709df0791b---------------transformers-----------------", "anchor_text": "Transformers"}, {"url": "https://medium.com/tag/nlp?source=post_page-----d0709df0791b---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/docker?source=post_page-----d0709df0791b---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/flask?source=post_page-----d0709df0791b---------------flask-----------------", "anchor_text": "Flask"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=-----d0709df0791b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=-----d0709df0791b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd0709df0791b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d0709df0791b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d0709df0791b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d0709df0791b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d0709df0791b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d0709df0791b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d0709df0791b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kylegallatin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kylegallatin?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kyle Gallatin"}, {"url": "https://medium.com/@kylegallatin/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.4K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F51ff4b76ebf4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=post_page-51ff4b76ebf4--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1e64fc6ee18e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuild-your-own-machine-translation-service-with-transformers-d0709df0791b&newsletterV3=51ff4b76ebf4&newsletterV3Id=1e64fc6ee18e&user=Kyle+Gallatin&userId=51ff4b76ebf4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}