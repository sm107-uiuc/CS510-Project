{"url": "https://towardsdatascience.com/detecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1", "time": 1683005987.728461, "path": "towardsdatascience.com/detecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1/", "webpage": {"metadata": {"title": "Detecting Changes in COVID-19 Cases with Bayesian Models | by Jonathan Ramkissoon | Towards Data Science", "h1": "Detecting Changes in COVID-19 Cases with Bayesian Models", "description": "With the current global pandemic and its associated resources (data, analyses, etc.), I\u2019ve been trying for some time to come up with an interesting COVID-19 problem to attack with statistics. After\u2026"}, "outgoing_paragraph_urls": [{"url": "https://nbviewer.jupyter.org/github/jramkiss/jramkiss.github.io/blob/master/_posts/notebooks/covid19-changes.ipynb", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://jramkiss.github.io/2020/04/15/covid-changepoint-analysis/", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://pyro.ai/", "anchor_text": "Pyro", "paragraph_index": 5}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 5}, {"url": "https://nbviewer.jupyter.org/github/jramkiss/jramkiss.github.io/blob/master/_posts/notebooks/covid19-changes.ipynb", "anchor_text": "this notebook", "paragraph_index": 5}, {"url": "https://www.kaggle.com/imdevskp/corona-virus-report", "anchor_text": "Kaggle", "paragraph_index": 6}, {"url": "https://www.cs.toronto.edu/~radford/ftp/ham-mcmc.pdf", "anchor_text": "Hamiltonian Monte Carlo", "paragraph_index": 13}, {"url": "https://rdrr.io/cran/asbio/man/R.hat.html", "anchor_text": "R_hat", "paragraph_index": 18}, {"url": "https://stats.stackexchange.com/questions/120936/why-we-need-trace-plot-for-mcmc-results", "anchor_text": "trace plots", "paragraph_index": 19}, {"url": "https://jramkiss.github.io/", "anchor_text": "blog", "paragraph_index": 27}], "all_paragraphs": ["With the current global pandemic and its associated resources (data, analyses, etc.), I\u2019ve been trying for some time to come up with an interesting COVID-19 problem to attack with statistics. After looking at the number of confirmed cases for some counties, it was clear that at some date, the number of new cases stopped being exponential and its distribution changed. However, this date was different for each country (obviously). This post introduces and discusses a Bayesian model for estimating the date that the distribution of new COVID-19 cases in a particular country changes. The model coefficients are interpretable and can be used for future analysis on the effectiveness of social distancing measures adopted by different countries.", "An important reminder before we get into it is that all models are wrong, but some are useful. This model is useful for estimating the date of change, not for predicting what will happen with COVID-19. It should not be mistaken for an amazing epidemiology model that will tell us when the quarantine will end, but instead a way of describing what we have already observed with probability distributions.", "All the code for this post can be found here and you can read the original version of this post here.", "We want to describe y, log of the number of new COVID-19 cases in a particular country each day, as a function of t, the number of days since the virus started in that country. We\u2019ll do this using a segmented regression model. The point at which we segment will be determined by a learned parameter, \u03c4, as described below:", "In other words, y will be modelled as w\u2081 + b\u2081 for days up until day \u03c4. After that it will be modelled as w\u2082 + b\u2082.", "The model was written in Pyro, a probabilistic programming language built on PyTorch. Chunks of the code are included in this post, but the majority of code is in this notebook.", "The data used was downloaded from Kaggle. Available to us is the number of daily confirmed cases in each country, and the figure below shows this data in Italy. It is clear that there are some inconsistencies in how the data is reported, for example, in Italy there are no new confirmed cases on March 12th, but nearly double the expected cases on March 13th. In cases like this, the data was split between the two days.", "The virus also starts at different times in different countries. Because we have a regression model, it is inappropriate to include data prior to the virus being in a particular country. This date is chosen by hand for each country based on the progression of new cases and is never the date the first patient is recorded. The \u201cstart\u201d date is better interpreted as the date the virus started to consistently grow, as opposed to the date the patient 0 was recorded.", "Virus growth is sensitive to population dynamics of individual countries and we are limited in the amount of data available, so prior specification is really important here.", "Starting with w\u2081 and w\u2082, these parameters can be loosely interpreted as the growth rate of the virus before and after the date change. We know that the growth will be positive in the beginning and is not likely to be larger than 1 (after all, w\u2081 is a gradient). With these assumptions, w\u2081 ~ N(0.5, 0.25) is a suitable prior.We\u2019ll use similar logic for p(w\u2082), but will have to keep in mind flexibility. Without a flexible enough prior here, the model won\u2019t do well in cases where there is no real change point in the data. In these cases, w\u2082 \u2248 w\u2081, and we\u2019ll see and example of this in the Results section. For now, we want p(w\u2082) to be symmetric about 0, with the majority of values lying between (-0.5, 0.5). We\u2019ll use w\u2082 ~ N(0, 0.25).", "Next are the bias terms, b\u2081 and b\u2082. Priors for these parameters are especially sensitive to country characteristics. Countries that are more exposed to COVID-19 (for whatever reason), will have more confirmed cases at its peak than countries that are less exposed. This will directly affect the posterior distribution for b\u2082 (which is the bias term for the second regression). In order to automatically adapt this parameter to different countries, we use the mean of the first and forth quartiles of y as the prior means of b\u2081 and b\u2082 respectively. The standard deviation for b\u2081 is taken as 1, which makes p(b\u2081) a relatively flat prior. The standard deviation of p(b\u2082) is taken as a quarter of its prior mean so that the prior scales with larger mean values.", "As for \u03c4, since at this time we don\u2019t have access to all the data (the virus is ongoing), we\u2019re unable to have a completely flat prior and have the model estimate it. Instead, the assumption is made that the change is more likely to occur in the second half of the date range at hand, so we use \u03c4 ~ Beta(4, 3).", "Below is the model written in Pyro.", "Hamiltonian Monte Carlo is used for posterior sampling. The code for this is shown below.", "Since I live in Canada and have exposure to the dates precautions started, modelling will start here. We\u2019ll use February 27th as the date the virus \u201cstarted\u201d.", "Starting with the posteriors for w\u2081 and w\u2082, if there was no change in the data we would expect to see these two distributions close to each other as they govern the growth rate of the virus. It is a good sign that these distributions, along with the posteriors for b\u2081 and b\u2082, don\u2019t overlap. This is evidence that the change point estimated by our model is true.", "As a side note (warning: no science) my company issued a mandatory work from home policy on March 16th. Around this date is when most companies in Toronto would have issues mandatory work from home policies where applicable. Assuming the reported incubation period of the virus is up to 14 days, this estimated date change makes sense as it is 12 days after widespread social distancing measures began!", "The model fit along with 90% credible interval bands can be seen in the plot below. On the left is log of the number of daily cases, which is what we used to fit the model, and on the right is the true number of daily cases. It is very difficult to visually determine a change point by simply looking at the number of daily cases, and even more difficult by looking at the total number of confirmed cases.", "When running these experiments, the most important step is to diagnose the MCMC for convergence. I adopt 3 ways of assessing convergence for this model by observing mixing and stationarity of the chains and R_hat. R_hat is the factor by which each posterior distribution will reduce by as the number of samples tends to infinity. A perfect R_hat value is 1 but values less than 1.1 are a strong indication of convergence. We observe mixing and stationarity of the Markov chains in order to know if the HMC is producing appropriate posterior samples.", "Below are trace plots for each parameter. Each chain is stationary and mixes well. Additionally, all R_hat values are less than 1.1.", "After convergence, the last thing to check before moving on to other examples is how appropriate the model is for the data. Is it consistent with the assumptions made earlier? To test this we\u2019ll use a residual plot and a QQ-plot, as shown below.I\u2019ve outlined the estimated change point in order to compare residuals before and after the change to test for homoscedasticity. The residuals follow a Normal distribution with zero mean, and no have dependence with time, before and after the date of change.", "Aha! What if the number of new cases has not started to flatten yet?! To test the model\u2019s robustness to this case, we\u2019ll look at data from Canada up until March 28th. This is the day that the model estimated curve flattening began in Canada.", "Just because there isn\u2019t a true change date doesn\u2019t mean the model will output \u201cNo change\u201d (lol). We\u2019ll have to use the posterior distributions to reason that the change date provided by the model is inappropriate, and consequentially there is no change in the data.", "The posteriors for w\u2081 and w\u2082 have significant overlap, indicating that the growth rate of the virus hasn\u2019t changed significantly. Posteriors for b\u2081 and b\u2082 are also overlapping. These show that the model is struggling to estimate a reasonable \u03c4, which is good validation for us that the priors aren\u2019t too strong.", "Although we have already concluded that there is no change date for this data, we\u2019ll still plot the model out of curiosity.", "Similar to the previous example, the MCMC has converged. The trace plots below show sufficient mixing and stationarity of the chains, and most R_hat values less than 1.1.", "This model is able to describe the data well enough to produce a reliable estimate of the day flattening the curve started. A useful byproduct of this is the coefficient term for the 2nd regression line, w\u2082. By calculating w\u2082 and b\u2082 for different countries, we can compare how effective their social distancing measures were. This analysis and more will likely come in a subsequent post.", "Keep an eye out on my personal blog for related posts!", "Thank you for reading, and definitely reach out to me by e-mail or other means if you have suggestions or recommendations, or even just to chat!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1b628214e8b1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jramkiss?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jramkiss?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Jonathan Ramkissoon"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4d0d3b9bbc14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&user=Jonathan+Ramkissoon&userId=4d0d3b9bbc14&source=post_page-4d0d3b9bbc14----1b628214e8b1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@rxspawn?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Florian Olivo"}, {"url": "https://unsplash.com/s/photos/light-at-the-end-of-the-tunnel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://nbviewer.jupyter.org/github/jramkiss/jramkiss.github.io/blob/master/_posts/notebooks/covid19-changes.ipynb", "anchor_text": "here"}, {"url": "https://jramkiss.github.io/2020/04/15/covid-changepoint-analysis/", "anchor_text": "here"}, {"url": "https://pyro.ai/", "anchor_text": "Pyro"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://nbviewer.jupyter.org/github/jramkiss/jramkiss.github.io/blob/master/_posts/notebooks/covid19-changes.ipynb", "anchor_text": "this notebook"}, {"url": "https://www.kaggle.com/imdevskp/corona-virus-report", "anchor_text": "Kaggle"}, {"url": "https://www.cs.toronto.edu/~radford/ftp/ham-mcmc.pdf", "anchor_text": "Hamiltonian Monte Carlo"}, {"url": "https://rdrr.io/cran/asbio/man/R.hat.html", "anchor_text": "R_hat"}, {"url": "https://stats.stackexchange.com/questions/120936/why-we-need-trace-plot-for-mcmc-results", "anchor_text": "trace plots"}, {"url": "https://jramkiss.github.io/", "anchor_text": "blog"}, {"url": "https://medium.com/tag/bayesian-statistics?source=post_page-----1b628214e8b1---------------bayesian_statistics-----------------", "anchor_text": "Bayesian Statistics"}, {"url": "https://medium.com/tag/statistics?source=post_page-----1b628214e8b1---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/covid-19?source=post_page-----1b628214e8b1---------------covid_19-----------------", "anchor_text": "Covid-19"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1b628214e8b1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1b628214e8b1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&user=Jonathan+Ramkissoon&userId=4d0d3b9bbc14&source=-----1b628214e8b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&user=Jonathan+Ramkissoon&userId=4d0d3b9bbc14&source=-----1b628214e8b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1b628214e8b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1b628214e8b1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1b628214e8b1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1b628214e8b1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1b628214e8b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jramkiss?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jramkiss?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jonathan Ramkissoon"}, {"url": "https://medium.com/@jramkiss/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "34 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4d0d3b9bbc14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&user=Jonathan+Ramkissoon&userId=4d0d3b9bbc14&source=post_page-4d0d3b9bbc14--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb62979fd26ed&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdetecting-changes-in-covid-19-cases-with-bayesian-models-1b628214e8b1&newsletterV3=4d0d3b9bbc14&newsletterV3Id=b62979fd26ed&user=Jonathan+Ramkissoon&userId=4d0d3b9bbc14&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}