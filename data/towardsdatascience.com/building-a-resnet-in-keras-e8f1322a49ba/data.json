{"url": "https://towardsdatascience.com/building-a-resnet-in-keras-e8f1322a49ba", "time": 1683004486.169579, "path": "towardsdatascience.com/building-a-resnet-in-keras-e8f1322a49ba/", "webpage": {"metadata": {"title": "Building a ResNet in Keras. Using Keras Functional API to construct\u2026 | by Dorian Lazar | Towards Data Science", "h1": "Building a ResNet in Keras", "description": "In principle, neural networks should get better results as they have more layers. A deeper network can learn anything a shallower version of itself can, plus (possibly) more than that. If, for a\u2026"}, "outgoing_paragraph_urls": [{"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "docs", "paragraph_index": 8}, {"url": "https://www.nablasquared.com/building-a-resnet-in-keras/", "anchor_text": "here", "paragraph_index": 21}, {"url": "https://www.nablasquared.com/", "anchor_text": "https://www.nablasquared.com/", "paragraph_index": 23}], "all_paragraphs": ["In principle, neural networks should get better results as they have more layers. A deeper network can learn anything a shallower version of itself can, plus (possibly) more than that. If, for a given dataset, there are no more things a network can learn by adding more layers to it, then it can just learn the identity mapping for those additional layers. In this way, it preserves the information in the previous layers and can not do worse than shallower ones. A network should be able to learn at least the identity mapping if it doesn\u2019t find something better than that.", "But in practice, things are not like that. Deeper networks are harder to optimize. With each extra layer that we add to a network, we add more difficulty in the process of training; it becomes harder for the optimization algorithm that we use to find the right parameters. As we add more layers, the network gets better results until at some point; then as we continue to add extra layers, the accuracy starts to drop.", "Residual Networks attempt to solve this issue by adding the so-called skip connections. A skip connection is depicted in the image above. As I said previously, deeper networks should be able to learn at least identity mappings; this is what skip connections do: they add identity mappings from one point in the network to a forward point, and then lets the network to learn just that extra \ud835\udc39(\ud835\udc65). If there are no more things the network can learn, then it just learns \ud835\udc39(\ud835\udc65) as being 0. It turns out that it is easier for the network to learn a mapping closer to 0 than the identity mapping.", "A block with a skip connection as in the image above is called a residual block, and a Residual Neural Network (ResNet) is just a concatenation of such blocks.", "An interesting fact is that our brains have structures similar to residual networks, for example, cortical layer VI neurons get input from layer I, skipping intermediary layers.", "If you are reading this, probably you are already familiar with the Sequential class which allows one to easily construct a neural network by just stacking layers one after another, like this:", "But this way of building neural networks is not sufficient for our needs. With the Sequential class, we can\u2019t add skip connections. Keras also has the Model class, which can be used along with the functional API for creating layers to build more complex network architectures.When constructed, the class keras.layers.Input returns a tensor object. A layer object in Keras can also be used like a function, calling it with a tensor object as a parameter. The returned object is a tensor that can then be passed as input to another layer, and so on.", "But the above code still constructs a network that is sequential, so no real use for this fancy functional syntax so far. The real use of this syntax is when using the so called Merge layers with which one can combine more input tensors. A few examples of these layers are: Add, Subtract, Multiply, Average. The one that we will need in building residual blocks is Add.", "This is by no means a comprehensive guide to Keras functional API. If you want to learn more please refer to the docs.", "Next, we will implement a ResNet along with its plain (without skip connections) counterpart, for comparison.", "The ResNet that we will build here has the following structure:", "It has a total of 30 conv+dense layers. All the kernel sizes are 3x3. We use ReLU activation and BatchNormalization after conv layers.The plain version is the same except for the skip connections.", "We create first a helper function that takes a tensor as input and adds relu and batch normalization to it:", "Then we create a function for constructing a residual block. It takes a tensor x as input and passes it through 2 conv layers; let's call the output of these 2 conv layers as y. Then adds the input x to y, adds relu and batch normalization, and then returns the resulting tensor. When parameter downsample == True the first conv layer uses strides=2 to halve the output size and we use a conv layer with kernel_size=1 on input x to make it the same shape as y. The Add layer requires the input tensors to be of the same shape.", "create_res_net() function puts everything together.Here is the full code for this:", "The plain network is constructed in a similar way, but it doesn\u2019t have skip connections and we don\u2019t use the residual_block() helper function; everything is done inside create_plain_net().The code for the plain network:", "CIFAR-10 is a dataset of 32x32 rgb images over 10 categories. It contains 50k train images and 10k test images.Below is a sample of 10 random images from each class:", "We will train both ResNet and PlainNet on this dataset for 20 epochs, and then compare the results.", "The training took about 55 min for each ResNet and PlainNet on a machine with 1 NVIDIA Tesla K80. There is no significant difference in training time between ResNet and PlainNet.The results that we got are shown below.", "So, we got an increase of 1.59% in validation accuracy by using a ResNet on this dataset. The difference should be bigger on deeper networks. Feel free to experiment and see the results that you get.", "I hope you found this information useful and thanks for reading!", "This article is also posted on my own website here. Feel free to have a look!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Passionate about Data Science, AI, Programming & Math | Owner of \u2207\u00b2 https://www.nablasquared.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe8f1322a49ba&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://dorianlazar.medium.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": ""}, {"url": "https://dorianlazar.medium.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Dorian Lazar"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F79574042e17b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&user=Dorian+Lazar&userId=79574042e17b&source=post_page-79574042e17b----e8f1322a49ba---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "docs"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "Deep Residual Learning for Image Recognition"}, {"url": "https://en.wikipedia.org/wiki/Residual_neural_network", "anchor_text": "Residual neural network \u2014 Wikipedia"}, {"url": "https://keras.io/getting-started/functional-api-guide/", "anchor_text": "Guide to the Functional API \u2014 Keras documentation"}, {"url": "https://keras.io/models/model/", "anchor_text": "Model (functional API) \u2014 Keras documentation"}, {"url": "https://keras.io/layers/merge/", "anchor_text": "Merge Layers \u2014 Keras documentation"}, {"url": "https://www.cs.toronto.edu/~kriz/cifar.html", "anchor_text": "CIFAR-10 and CIFAR-100 datasets"}, {"url": "https://www.nablasquared.com/building-a-resnet-in-keras/", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e8f1322a49ba---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e8f1322a49ba---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----e8f1322a49ba---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----e8f1322a49ba---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e8f1322a49ba---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&user=Dorian+Lazar&userId=79574042e17b&source=-----e8f1322a49ba---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&user=Dorian+Lazar&userId=79574042e17b&source=-----e8f1322a49ba---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe8f1322a49ba&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e8f1322a49ba---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e8f1322a49ba--------------------------------", "anchor_text": ""}, {"url": "https://dorianlazar.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://dorianlazar.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dorian Lazar"}, {"url": "https://dorianlazar.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "593 Followers"}, {"url": "https://www.nablasquared.com/", "anchor_text": "https://www.nablasquared.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F79574042e17b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&user=Dorian+Lazar&userId=79574042e17b&source=post_page-79574042e17b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F9fdaa579c06&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-resnet-in-keras-e8f1322a49ba&newsletterV3=79574042e17b&newsletterV3Id=9fdaa579c06&user=Dorian+Lazar&userId=79574042e17b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}