{"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "time": 1683016350.441597, "path": "towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b/", "webpage": {"metadata": {"title": "Fine-tuning a BERT model with transformers | by Thiago G. Martins | Towards Data Science", "h1": "Fine-tuning a BERT model with transformers", "description": "This post describes a simple way to get started with fine-tuning transformer models. It will cover the basics and introduce you to the amazing Trainer class from the transformers library. You can run\u2026"}, "outgoing_paragraph_urls": [{"url": "https://colab.research.google.com/github/thigm85/blog/blob/master/_notebooks/2020-11-12-fine-tune-bert-basic-transformers-trainer.ipynb", "anchor_text": "Google Colab", "paragraph_index": 0}, {"url": "https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge", "anchor_text": "COVID-19 Open Research Dataset Challenge", "paragraph_index": 1}, {"url": "https://cord19.vespa.ai/", "anchor_text": "cord19 search app", "paragraph_index": 1}, {"url": "https://huggingface.co/transformers/pretrained_models.html", "anchor_text": "which BERT model to use", "paragraph_index": 5}, {"url": "https://huggingface.co/transformers/preprocessing.html#everything-you-always-wanted-to-know-about-padding-and-truncation", "anchor_text": "padding and truncation", "paragraph_index": 5}, {"url": "https://huggingface.co/transformers/custom_datasets.html", "anchor_text": "custom datasets", "paragraph_index": 6}, {"url": "https://onnx.ai/", "anchor_text": "ONNX", "paragraph_index": 10}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai", "paragraph_index": 13}], "all_paragraphs": ["This post describes a simple way to get started with fine-tuning transformer models. It will cover the basics and introduce you to the amazing Trainer class from the transformers library. You can run the code from Google Colab but do not forget to enable GPU support.", "We use a dataset built from COVID-19 Open Research Dataset Challenge. This work is one small piece of a larger project that is to build the cord19 search app.", "To fine-tune the BERT models for the cord19 application, we need to generate a set of query-document features and labels that indicate which documents are relevant for the specific queries. For this exercise, we will use the query string to represent the query and the title string to represent the documents.", "For each query, we have a list of documents, divided between relevant (label=1) and irrelevant (label=0).", "We are going to use a simple data split into train and validation sets for illustration purposes. Even though we have more than 50 thousand data points when considering unique query and document pairs, I believe this specific case would benefit from cross-validation since it has only 50 queries containing relevance judgment.", "Create a train and validation encodings. To do that, we need to chose which BERT model to use. We will use padding and truncation because the training routine expects all tensors within a batch to have the same dimensions.", "Now that we have the encodings and the labels, we can create a Dataset object as described in the transformers webpage about custom datasets.", "We are going to use BertForSequenceClassification, since we are trying to classify query and document pairs into two distinct classes (non-relevant, relevant).", "We can set requires_grad to False for all the base model parameters to fine-tune only the task-specific parameters.", "We can then fine-tune the model with Trainer. Below is a basic routine with an out-of-the-box set of parameters. Care should be taken when choosing the parameters below, but this is out of this piece's scope.", "Once training is complete, we can export the model using the ONNX format to be deployed elsewhere. I assume below that you have access to a GPU, which you can get from Google Colab, for example.", "As mentioned before, this post covered basic training setup. This is a good starting point to be improved upon. It is better to start simple and complement than the opposite, especially when learning something new. I left important topics such as hyperparameter tuning, cross-validation, and more detailed model validation to followup posts. But having a basic training setup is a good first step.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Working on Vespa.ai. Follow me on Twitter @Thiagogm"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc8e49c4e008b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tgmstat.medium.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86----c8e49c4e008b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://colab.research.google.com/github/thigm85/blog/blob/master/_notebooks/2020-11-12-fine-tune-bert-basic-transformers-trainer.ipynb", "anchor_text": "Google Colab"}, {"url": "https://unsplash.com/@samule?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Samule Sun"}, {"url": "https://unsplash.com/s/photos/transformers?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge", "anchor_text": "COVID-19 Open Research Dataset Challenge"}, {"url": "https://cord19.vespa.ai/", "anchor_text": "cord19 search app"}, {"url": "https://huggingface.co/transformers/pretrained_models.html", "anchor_text": "which BERT model to use"}, {"url": "https://huggingface.co/transformers/preprocessing.html#everything-you-always-wanted-to-know-about-padding-and-truncation", "anchor_text": "padding and truncation"}, {"url": "https://huggingface.co/transformers/custom_datasets.html", "anchor_text": "custom datasets"}, {"url": "https://onnx.ai/", "anchor_text": "ONNX"}, {"url": "https://medium.com/tag/bert?source=post_page-----c8e49c4e008b---------------bert-----------------", "anchor_text": "Bert"}, {"url": "https://medium.com/tag/transformers?source=post_page-----c8e49c4e008b---------------transformers-----------------", "anchor_text": "Transformers"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c8e49c4e008b---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c8e49c4e008b---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----c8e49c4e008b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----c8e49c4e008b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc8e49c4e008b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c8e49c4e008b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c8e49c4e008b--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://tgmstat.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "96 Followers"}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd1c0d81e840f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-with-transformers-c8e49c4e008b&newsletterV3=a578be8bee86&newsletterV3Id=d1c0d81e840f&user=Thiago+G.+Martins&userId=a578be8bee86&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}