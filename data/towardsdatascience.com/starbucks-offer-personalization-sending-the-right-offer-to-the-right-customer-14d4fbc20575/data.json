{"url": "https://towardsdatascience.com/starbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575", "time": 1682997633.268567, "path": "towardsdatascience.com/starbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575/", "webpage": {"metadata": {"title": "Starbucks Offer Personalization \u2014 Sending the right offer to the right customer | by Andrea Xue | Towards Data Science", "h1": "Starbucks Offer Personalization \u2014 Sending the right offer to the right customer", "description": "Starbucks is arguably one of the most successful coffee chains in the world. It is also one of the pioneers to introduce its own rewards apps back in 2010. Customers can get promotional offer\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Starbucks is arguably one of the most successful coffee chains in the world. It is also one of the pioneers to introduce its own rewards apps back in 2010. Customers can get promotional offer notifications, order and pay through the mobile app and earn reward points for their orders. This allows Starbucks to not only connect with customers directly and improve brand loyalty, but also collect valuable first- hand customer information as well as their transactional behaviors.", "But here is the question - do all the users get the same offers? Imagine you are a data scientist at Starbucks, what would you do to determine what the most effective offers are to send to each individual customer that he/she is most likely to use to improve user engagement?", "In this project, I take on this challenge and my goal is to use the demographic and behavioral attributes of the users collected through the rewards app to predict what the best-personalized offer is to send to individual customers that would maximize the conversion rate.", "Also, I want to see whether there are any distinct subgroups within the entire customer base that exhibit certain patterns of demographics and buying behaviors, which set them apart from one another.", "portfolio.json \u2014 contains offer ids and metadata about each offer. It contains the following attributes:", "profile.json \u2014 demographic data for each customer.", "transcript.json \u2014 records for transactions and usage of offers.", "The transcript data is the main dataset I will be using to engineer user behavioral features. It contains simulated data that mimics real customer purchases and offer usages on the Starbucks rewards app including the timestamp of purchase and the amount of money spent on a purchase. This transactional data also has a record for each offer that a user receives as well as a record for when a user actually views the offer. There are also records for when a user completes an offer.", "Here is the tricky part. Every offer has a validity period before the offer expires. A user might receive the \u201cbuy 10 dollars get 2 dollars off offer\u201d, but the user never opens the offer during the 10 day validity period. The customer spends 15 dollars during those ten days. There will be an offer completion record in the data set; however, the customer was not influenced by the offer because the customer never viewed the offer. For the informational offers, if a user makes transactions within the validity period after viewing the offer, he will be considered as completing the offer.", "Given those rules and exceptions for offer completion, the data cleaning and feature engineering part become especially important and tricky.", "The key part of the project is summarizing each customer\u2019s transaction behaviors from the chronological activity log to attribute the right transactions to the right offer types and track down their conversions for different offers on the user level. Those engineered features will then be combined with the user profile information such as income, age, gender and when their membership started to provide a holistic view of each customer.", "With that in mind, my approach to tackling the problem will follow the below steps.", "1. Exploratory Analysis & Data Cleaning: Understand the three datasets and prepare the datasets", "2. Feature Engineering: Create attributes from the transaction log on the user level", "3. Machine Learning: Build a multioutput classification model to determine the best offer types for each customer ranked by likelihood of conversion", "4. Clustering: Find subgroups within customers that Starbucks can target differently according to each group\u2019s distinct demographical or behavioral patterns.", "There are some outliers in the age distribution- more than 2000 people out of 17000 total number of customers are older than 110 which don\u2019t seem right. I will replace them with NaN then fill in with the median age. Income has a widespread but in general, looks good. There are 2150 NaN records which I will also fill in with median income later.", "The left chart below shows male customers have been growing much more than females in most years. I converted the membership start date to the number of months in tenure as a numeric demographic attribute. The histogram on the right shows how the distribution looks like.", "There are 10 rows for 10 offer types in total since this is a simplified version of real Starbucks offers. The data is very straightforward.", "This is the most important dataset I will work with. Here is how it originally looks like.", "The \u201cvalue\u201d column is a dictionary, and here are the unique keys.", "We can see that \u201coffer id\u201d shows up twice- when it comes with \u201creward\u201d, the event column shows \u201coffer completed\u201d, otherwise, the event is either \u201coffer received\u201d or \u201coffer viewed\u201d. When \u201camount\u201d is not null, the event is always a \u201ctransaction\u201d.", "I separated the dictionary keys into 3 columns: \u201coffer_id\u201d, \u201camount\u201d and \u201creward\u201d. The two \u201coffer_id\u201d keys were consolidated to be one single column.", "I then joined the transcript data with portfolio data on the offer_id to see the event distribution across different offer types.", "Let\u2019s check one person\u2019s journey to have a better idea of the sequence of events when he completes an offer. In this case, the customer made two offer conversions with two transactions. The other five transactions are made with no offers.", "For an offer to be effective, the events leading to conversion would happen in the sequence below: 1. offer received -> offer viewed -> transaction -> offer completed (BOGO and discount offers) 2. offer received -> offer viewed -> transaction (informational offers but transactions have to happen within the valid offer duration)", "Only when these two conversion sequences are observed can we count the offer as completed.", "There are couple other scenarios are deemed as ineffective offers: 1. offer received but no action was taken by the customers 2. offer received -> transact -> offer viewed \u2014 this is also ineffective because the person did not use the offer in the transaction 3. transact with no offer \u2014 this type of people would transact anyway with or without an offer. From a business perspective, we may not need to send them offers after all.", "With those in mind, and knowing my goal is to predict the best offer we should send to each individual customer that would maximize the offer conversion rate, I need to build a user-level dataset that includes the user demographics and features about each user\u2019s transactional behaviors extracted from the transcript log and their response to each offer type.", "In detail, these are the features I want to engineer on the user level for the machine learning model.", "3 binary target variables for the model:", "As I have mentioned in the beginning, the biggest challenge in this process is identifying the right effective offers by following the specific sequence of events leading to the offer completion depending on the offer type.", "Essentially, all the effective offer related features can be calculated based on offer completion count and transactions amount from the offer conversion.", "The full script for feature engineering is quite long. Essentially the steps are:", "After this process, I then combined the user demographics with the engineered features as the final panel of user attributes.", "The plan is to build a Multioutput Classification Model to predict the best offer type using the 3 offer types as target variables Y, and the engineered features above(excluding the last 6 features because that\u2019d cause information leak) along with the demographics features in the profile dataset as X. Note that it\u2019s possible for a user to have multiple 1s in the prediction result, in that case, the offer type with higher probability will be prioritized in the recommendation.", "Since there is more than one output, there are limited choices of classifiers that support multioutput \u2014 decision tree family in general all support multioutput models.", "I will choose Random Forest for the following reasons:", "Model performances are very good. What are the most important features that distinguish the converters and non-converters for each offer type?", "It seems that reward_per_offer and offer_trans_amt are the most important features across the board. How is each feature different among the three offer types?", "The labels on the X-axis correspond to the three offer types respectively. When it\u2019s 1, it means people who use that offer type. eg. (1,1,0) means people who respond to BOGO and discount offers but not informational offers.", "It\u2019s apparent that people who use all three offer types not only spend the most with offers but also have the highest total transaction amount. It means the more we motivate the customers to use the offer, the more they are likely to spend in-store.", "Also, BOGO offer drives more sales than discount and informational offers in general since the right three groups with higher total transaction amount all have responded to BOGO offer. It\u2019s also worth noting that people who use BOGO and discount offers actually spend more than half of the total transaction amount without offers on average. Those are Starbuck\u2019s most active and valuable customers. It is a positive sign to prove that giving our offers with rewards can indeed improve customers\u2019 engagement and as a result, drive sales overall.", "Now let\u2019s take a look at how the overall offer completion rate, transaction amount ratio motivated by offers, and reward per offer affected by the user demographics.", "Key takeaways from the scatter plots above:", "Next, I want to check whether different demographic groups respond differently to the three offer types.", "There are a couple of interesting insights from this set of scatter plots.", "Predict the best offer type for any given customers", "If the model predicts multiple offer types for the customer, sort the recommendation based on descending order of probability.", "Below are the recommended offer types for 20 customer ids randomly selected from the test set and higher probability offers are in the front. If the customer only has transactions and never used any offer before, the model will show \u201cno offer is recommended\u201d. In the business context, if a user is willing to spend $10 anyway, we might not even need to send him a \u201cbuy $10 get $2 off\u201d discount offer.", "Now that we can predict the best offer type, I wonder if I can take it to a more granular level \u2014 to use the same set of features as X to predict which specific offer id to send to each customer. The idea is that for a customer who only likes to use low difficulty(transaction minimum) offers, we might want to send him/her offers based on the offer difficulty level not just by a broad offer type, since the difficulty level can vary in a fairly large range for the same offer type.", "Since some offer ids are mapped to the same offer name, they have been consolidated into one column. If a user has ever converted with any of the offer ids under the same type + reward + difficulty combo, then that offer name will be labeled as 1 else 0.", "Still the same drill as before, I replaced the 3 offer types with the 6 offer names as Y, nothing much changed in X except I included 3 features that were excluded in the last model to avoid information leakage: completion counts for BOGO, discount and informational. Moreover, I created a new feature called \u201cdifficulty_per_offer\u201d that is the sum of the minimum transaction(difficulty) to use each completed offer/ total number of offer completion. I believe this new feature tells a lot about customers\u2019 tolerance for the minimum spend to enjoy the offer benefits.", "With those additional new features, the model performances even improved from switching the offer types to actual offers as target variables. To make sure the high scores are not caused by high accuracy in only class 0, let\u2019s print the classification reports for each offer model and they all look good.", "\u201cdifficulty_per_offer\u201d clearly dominated the top features for almost every offer model, just as I expected!", "Predict the best offer for any given customers", "Here are the recommended offers for users randomly selected from the test set using the same prediction function as last time.", "After making the predictions for the best offer type to send to each individual customers, I want to know whether there are any generalized patterns of behavioral and demographic attributes for certain subgroups within the whole Starbuck\u2019s customer base that set them apart from one another. This way allows us to understand the customers not only on an individual level but also under a market segmentation context that would help to devise different marketing strategies towards different customer groups and make targeting more precise and efficient.", "I fitted the KMeans clustering model on standardized user attributes with a various number of clusters and extracted inertia at each iteration. Using the elbow method, I decided to use 3 clusters although the line chart is very ambiguous. After fitting the model again with n_clusters= 3, I inversely transformed the data back to the original scale.", "Below are the cluster centers of each attribute for the 3 clusters.", "From the cluster centers, we can see that the average age are almost the same across the three clusters. cluster 1 has much more male than female, the lowest average income, transaction amount and offer completion rate. cluster 0 and 2 are very similar in average member tenure, total transaction amount and transaction amount per offer. However, they clearly exhibit different preference patterns for different offer types \u2014 we can confirm that with some visualizations.", "Cluster 0 and 2 have some extremely high spend people with high income.", "cluster 1 is in general unresponsive to offers. cluster 2 seems to have the highest offer completion rate on average, while cluster 0 spends the most with no offer than cluster 2.", "cluster 0 has 0 informational offer conversion rate, while cluster 2 people apparently favor informational offers the most among the 3 groups.", "Cluster 0 clearly has much higher rewards per offer on average, which means they are more inclined to use offers with higher rewards and the accompanying higher transaction minimum.", "From the visualizations above together with cluster centers, we can see each cluster has a set of distinct attributes in their transactional behaviors and reactions to different offers, although they share very similar demographics in terms of age, income and member tenure.", "When I first started this project, my goal was only to predict the best offer type for each customer. As I progressed through the project, I came up with more questions and more angles to analyze user behaviors, that led to the more granular personalized offer recommendation and the clustering for customer segmentation.", "As I had expected, the most challenging part of the whole project was the feature engineering step. Extracting and summarizing the right set of user behavioral attributes of transactions and offer usage played a pivotal role in the following predictive and clustering models.", "The clustering model successfully separated the customers based on their differences in behavioral attributes, although not many differences were observed in the demographics of the first and last clusters. If we can get more user demographic information from other sources, we can map the groups identified by KMeans back to better profile each user clusters.", "We can also confirm if the clustering result is accurate by cross-checking for example, whether the classification model does recommend the informational offer to users in cluster 2. If the result is satisfying, the fitted clustering model can be used as the first pass for market segmentation before enough data can be collected for offer personalization.", "The more we study customers behaviors, the better we can get at sending personalized offers that yield higher conversion rate, and the higher the customer engagement and user stickiness would be. This is the goal most of the businesses are striving towards.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A data scientist and nature lover who never stops learning and hiking new heights."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F14d4fbc20575&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@andrea.xyw?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrea.xyw?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Andrea Xue"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3cb7e36d5b8c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&user=Andrea+Xue&userId=3cb7e36d5b8c&source=post_page-3cb7e36d5b8c----14d4fbc20575---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----14d4fbc20575---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/feature-engineering?source=post_page-----14d4fbc20575---------------feature_engineering-----------------", "anchor_text": "Feature Engineering"}, {"url": "https://medium.com/tag/user-behavior?source=post_page-----14d4fbc20575---------------user_behavior-----------------", "anchor_text": "User Behavior"}, {"url": "https://medium.com/tag/data-science?source=post_page-----14d4fbc20575---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&user=Andrea+Xue&userId=3cb7e36d5b8c&source=-----14d4fbc20575---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&user=Andrea+Xue&userId=3cb7e36d5b8c&source=-----14d4fbc20575---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F14d4fbc20575&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----14d4fbc20575---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----14d4fbc20575--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----14d4fbc20575--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----14d4fbc20575--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrea.xyw?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@andrea.xyw?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Andrea Xue"}, {"url": "https://medium.com/@andrea.xyw/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "79 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3cb7e36d5b8c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&user=Andrea+Xue&userId=3cb7e36d5b8c&source=post_page-3cb7e36d5b8c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F69639d48d09&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fstarbucks-offer-personalization-sending-the-right-offer-to-the-right-customer-14d4fbc20575&newsletterV3=3cb7e36d5b8c&newsletterV3Id=69639d48d09&user=Andrea+Xue&userId=3cb7e36d5b8c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}