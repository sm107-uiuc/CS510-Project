{"url": "https://towardsdatascience.com/beyond-xgboost-and-tree-based-ensembles-4516fa382119", "time": 1683017331.505206, "path": "towardsdatascience.com/beyond-xgboost-and-tree-based-ensembles-4516fa382119/", "webpage": {"metadata": {"title": "Interpretable Models | Sanity Checks - How Linear Regression Outperforms Boosted Trees | Towards Data Science", "h1": "Interpretable Models \u2014 How Linear Regression Outperforms Boosted Trees on Sanity Checks", "description": "Gradient boosted trees have been widely used to win several competitions on Kaggle. It is no surprise that for most tabular datasets you are working with, you would likely find XGBoost or another\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/harlfoxem/housesalesprediction", "anchor_text": "https://www.kaggle.com/harlfoxem/housesalesprediction", "paragraph_index": 12}], "all_paragraphs": ["Gradient boosted trees have been widely used to win several competitions on Kaggle. It is no surprise that for most tabular datasets you are working with, you would likely find XGBoost or another implementation of boosted decision trees as the model with the best cross-validation score on your metric(s).", "Question \u2014 How many times have you deployed a gradient boosted trees model with a supposedly good cross-validation score, but your end users questioned the validity of predictions?", "Did you explain away the unexpected prediction using LIME or SHAP?", "In the above example where house price was estimated using a decision tree regressor, SHAP can help explain how having more than 4,000 sqft of living room, a waterfront, and a good view increased the estimated value of the house, whereas its grade of 8 decreases its estimated value.", "If you haven\u2019t used SHAP before, red = increases estimated price, blue = reduces estimated price.", "In the next example, a grade of 8 actually increases the estimated value of the house. While one can conceive how a grade of 8 may be good/bad conditional on other variables, this is difficult to explain to a typical user of your house price prediction model.", "Even worse is, if in the 2nd example, we ran a counterfactual where that same house, with the same features, had a better grade of 9 instead of 8, its estimated value would be go down from USD 1.31 mln to 622k!! Try to explain that away to a user of your house price prediction model.", "There is no bug in the decision tree regressor used in the above examples. Tree-based models are trained by default to greedily increase information gain at each split without considering such sanity checks.", "In a linear regression model, for example, we at least have a parametric model with some form of \u201cstructure\u201d to the prediction logic in the form of assuming a linear, monotonic, relationship between each explanatory variable/feature and the target (house price in the above examples). This added \u201cstructure\u201d would, for e.g. help ensure that an increase in grade only increases the estimated price of a house (monotonicity). It can also be more easily controlled to enforce rules such as feature A should cannot have a larger impact on price compared to feature B, where we simply have to ensure the coefficients of the linear regression are aligned with our business rules and common intuition. This makes the behaviour of the system, i.e. linear regression, more controllable since this parametric structure can be modified.", "Controllability is an innate attribute of model interpretability.", "Explainability of results is not equivalent to interpretability. I sometimes see Decision Trees placed at the extremely interpretable side of the spectrum, even more than linear regression, and I would argue that this should not be the case. If I am unable to explain to a non-technical person why the model predicted a lower grade house is 2x worth a higher grade house with the same features, the model is not interpretable. That is aside from the very bad user experience this creates and the loss in trust in the model.", "When there is a better defined structure embedded in your model, you can better understand the dynamics of your model and you can more easily control your model\u2019s behavior. In the below sections, I want to demonstrate how prevalent is the failure in sanity checks and how having a more controllable model can help.", "The sample dataset we will be using is a list of 21,613 house sales at King Country in the USA spanning from May 2014 to May 2015 https://www.kaggle.com/harlfoxem/housesalesprediction.", "Below is what the data looks like", "The columns we have are the areas of different sections of the house (sqft_above, sqft_basement etc.), date of transaction), # of bath/bedrooms, year the house was built and last renovated, address details (lat, long, and zip code), a binary indicating whether the house is waterfront, and ordinal categories representing view, condition, and grade.", "This is the first time I work on this dataset, so to check that the last 3 columns are ordinal I look for a monotonic relationship between the price of the house and the levels of these 3 columns (view, condition, and grade).", "Given that the categories are ordinal, we can simplify the analysis by keeping their numeric values as-is. Also for the sake of simplicity, no feature engineering was done aside from replacing the date with the age of the transaction (trx_age) and dropping the address info.", "To select an optimal model, we\u2019ll use PyCaret and pass the selected columns as numeric. Below is the code to set-up a regression analysis in PyCaret.", "Now we can run a one-liner to compare the performance of several models.", "The above one-liner compares the performance of multiple models on R2 score where 10-fold cross-validation is conducted on 70% of the data (15,129 transactions). The remaining 30% are kept as a hold-out set.", "As expected, boosted trees perform the best with CatBoost being the top performer in this case followed by LightGBM and XGBoost.", "We will now select two models to proceed with our analysis, a linear regression model and a CatBoost regressor. We can compare how well they perform on some sanity checks in the next section.", "The CatBoost model can be tuned in PyCaret by simply running tune_model() method. The 0.76 R2 achieved by the CatBoost regressor using default hyperparameters is already close to the ~0.85 R2 that several have found as the best achievable score on a validation set. That is despite the fact that we have done no feature engineering aside from converting the date column to transaction age and we even simply drop lat, long, and zip code.", "The R2 score of 0.66 (hold-out set) for the linear regression model is significantly lower than that of the CatBoost regressor.", "Lastly, we will run finalize_model() in order to re-train the models on the entire dataset.", "Sanity checks are the #1 validation checks to be considered.", "Imagine a user had access to an interface, where they can enter house details and get the estimated price as an output. As soon as they put in the details of some house, the first thing a user would typically do is test the model behavior by changing one of the input variables. If a user selects a higher grade for a house and sees its estimated value go down by half (example in intro section), the user can absolutely not trust the model anymore.", "Let\u2019s set-up 4 simple sanity checks that no model should fail.", "Holding all other variables constant, house price should increase as the:", "Below is the function that is being used to run the sanity checks.", "Let\u2019s test the CatBoost model, when the \u201cgrade\u201d of the house increases by one level (delta parameter), the house of the house increases or remains unchanged for 99.8% of observations. For 0.2% of the observations, the model predicts the house price decreases which is a failure of our sanity check", "Below is a similar analysis using the CatBoost model, where we increment the \u201ccondition\u201d of the house instead of the \u201cgrade\u201d. For more than 5% of the observations, the sanity check fails!", "We can also run a combined test to check the % of observations in the data where at least one of the sanity checks on \u201ccondition\u201d, \u201cgrade\u201d, \u201cview\u201d fails.", "We are only looking at a 1-level increase in the 3 ordinal categorical variables (condition, grade, and view). If we look at different scenarios where those variables increase or decrease by one or more levels and we consider area related columns, we would see that the predicted house price will move in the wrong direction in a lot more cases.", "Actually, if we only look at area-related columns and increment each one of them (sqft_living, sqft_lot, etc.) by 100 sqft with the expectation that predicted price should increase, we can see that the test fails for > 86% of the observations! This gives us a good idea about how likely is it that a user would experience such an inconvenience.", "Given the greedy nature of tree based algorithms and the short-sighted goal of maximizing information gain at each step, this is an expected result.", "To pass those basic sanity checks, we can use monotone constraints in CatBoost which eliminates splits that can produce non-monotonic relationships.", "R2 is down to 0.74 but at least we are certain that the most basic sanity checks are passed.", "When we run a sanity check on the relationship between house price and grade, view, and condition using the linear regression model, the test is passed for 100% of the observations.", "That is because there is a parametric structure where linear relationships are assumed and fortunately the coefficients are positive for all 3 variables.", "When we check if prediction price increases with area columns, the test fails for 100% of the columns.", "That is because the coefficient on the variable sqft_lot15 is negative, so for every observation, price decreases with sqft_lot15. This result is often observed when there is high multicollinearity in the variables.", "Given the arguably more controllable structure of a linear regression, this can be fixed in many ways. We will apply one simple way that is we will use non-negative least squares forcing the coefficients to be \u2265 0.", "I am not aware of a readily available implementation on scikit-learn (as of the publishing date), but we\u2019ll apply a hack using the \u201cpositive\u201d parameter in the Lasso regression implementation.", "The model R2 score is reduced by just under 0.05, but now all sanity checks pass for the linear regression model.", "Though achieving a high R2 score is not our main concern in this article, below is a sample quick set-up in PyCaret that makes use of feature interactions, polynomial features, feature selection, and normalization to achieve an R2 score of 0.75 on the hold-out set. Linear regression models are more sensitive to those transformations than CatBoost. The latter can already capture a lot of those interactions and non-linearities without explicitly passing such features and is insensitive to scaling.", "We can achieve a good R2 score, pass the basic sanity checks and still maintain an arguably more controllable model that can be more useful for embedding other business rules.", "Here is another, final example showcasing how enforcing a positive, linear relationships can help ensure predictions are intuitive. 1 additional sqft of living room at a high grade house should be worth more than 1 additional sqft at a house with a lower grade and exactly the same features aside from grade. Below code tests for how often does this sanity check succeed.", "It is very important to consider how your model will be used in your final analytical product. In some cases, if not most, model interpretability transitions from a nice-to-have to a must-have feature, where it becomes essential in creating the right user experience. This is especially important in the early phases of your product when you are trying to garner trust.", "We focused on boosted trees in this exercise due to their widespread adoption in the data science community and the great performance they achieve on cross-validation scores, but the learnings apply to other algorithms as well.", "The goal is also not to discredit less controllable or interpretable models, but to highlight the importance of considering multiple factors, including user experience, in deciding what model to use. It is up to you and the use case at hand to decide what works best and where to draw the balance between interpretability (with a special focus on controllability) and predictive performance.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data & Analytics Leader @ Majid Al Futtaim"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4516fa382119&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://bassel-karami.medium.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": ""}, {"url": "https://bassel-karami.medium.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Bassel Karami"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68fc7cb80932&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&user=Bassel+Karami&userId=68fc7cb80932&source=post_page-68fc7cb80932----4516fa382119---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/model-interpretability", "anchor_text": "Model Interpretability"}, {"url": "https://www.pexels.com/@josemlvega?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Jose Vega"}, {"url": "https://www.pexels.com/photo/photo-of-trees-in-forest-3801030/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://www.kaggle.com/harlfoxem/housesalesprediction", "anchor_text": "https://www.kaggle.com/harlfoxem/housesalesprediction"}, {"url": "https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pixabay"}, {"url": "https://www.pexels.com/photo/banking-business-checklist-commerce-416322/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4516fa382119---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----4516fa382119---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/model-interpretability?source=post_page-----4516fa382119---------------model_interpretability-----------------", "anchor_text": "Model Interpretability"}, {"url": "https://medium.com/tag/xgboost?source=post_page-----4516fa382119---------------xgboost-----------------", "anchor_text": "Xgboost"}, {"url": "https://medium.com/tag/linear-regression?source=post_page-----4516fa382119---------------linear_regression-----------------", "anchor_text": "Linear Regression"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&user=Bassel+Karami&userId=68fc7cb80932&source=-----4516fa382119---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&user=Bassel+Karami&userId=68fc7cb80932&source=-----4516fa382119---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4516fa382119&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4516fa382119---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4516fa382119--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4516fa382119--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4516fa382119--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4516fa382119--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4516fa382119--------------------------------", "anchor_text": ""}, {"url": "https://bassel-karami.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://bassel-karami.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bassel Karami"}, {"url": "https://bassel-karami.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "142 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F68fc7cb80932&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&user=Bassel+Karami&userId=68fc7cb80932&source=post_page-68fc7cb80932--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F342c739ecf14&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeyond-xgboost-and-tree-based-ensembles-4516fa382119&newsletterV3=68fc7cb80932&newsletterV3Id=342c739ecf14&user=Bassel+Karami&userId=68fc7cb80932&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}