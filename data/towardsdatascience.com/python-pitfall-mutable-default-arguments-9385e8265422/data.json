{"url": "https://towardsdatascience.com/python-pitfall-mutable-default-arguments-9385e8265422", "time": 1683006363.935515, "path": "towardsdatascience.com/python-pitfall-mutable-default-arguments-9385e8265422/", "webpage": {"metadata": {"title": "Python Pitfall: Mutable Default Arguments | by Don Cross | Towards Data Science", "h1": "Python Pitfall: Mutable Default Arguments", "description": "Optional function arguments in Python can cause surprising bugs. If the default value of the parameter is mutable, unwanted side effects can occur."}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Functional_programming", "anchor_text": "functional programming", "paragraph_index": 12}, {"url": "https://en.wikipedia.org/wiki/Principle_of_least_astonishment", "anchor_text": "principle of least surprise", "paragraph_index": 13}], "all_paragraphs": ["Many programming languages allow you to write functions that accept optional arguments. Python is one of them. This is a handy way to make function calls concise (when an argument can be omitted) and flexible (when a particular argument value is needed). But there are dangers lurking for the unwary.", "Let\u2019s look at a simple algorithm for illustration purposes. Suppose you have a string like aaabbaccaaa, and you want to count up how many of each letter there is in that string. You want a function that returns a dictionary whose keys are letters and whose values are positive integer counts of how many times each letter appears in the string.", "Here is a straightforward implementation of this idea as a Python function.", "This function works. It does exactly what we wanted. But now let\u2019s add a twist. What if sometimes we want to tally a series of strings and combine the results? We would like the option to call Tally more than once and end up with a single dictionary that has the letter counts combined.", "One approach is to include the count dictionary as another argument to the function:", "This is a more flexible function because it can process a series of strings instead of only a single string. And of course, we can still process strings separately if we want to:", "What if separate counting is what we most often want? It sure would be nice not to have to type the {} empty dictionary argument in every single call. Developers new to Python, but who are familiar with default arguments in other programming languages, typically go down the following road:", "This is the most obvious way to write the Tally function so that you don\u2019t need to pass in an explicit empty dictionary. It sure looks right. But it\u2019s wrong. There is a subtle flaw that will bite you! Let\u2019s test it to see what happens:", "The first line works exactly as we expect. It finds one a, one b, and one c. But after that, things get wacky. What in the world is happening here?", "The core issue is that in Python, the value of a default argument is evaluated only once, when the function is declared. The default argument syntax count = {} causes the Python interpreter to create an empty dictionary, but it\u2019s the same dictionary object every time the function is called.", "To clarify the problem, the behavior of our broken function is the same as this:", "This is not a bug in Python. That is, the behavior is intentional, not accidental.\u00b9", "However, if we veer away from facts and into the world of opinion, many people \u2014 and I am one of them \u2014 consider this a design flaw of Python, even though there are justifiable technical reasons for it.\u00b2 The behavior goes against the idea of functional programming. It makes it more difficult to write a deterministic function whose return value depends only on its arguments.", "More fundamentally, it violates the principle of least surprise. This behavior isn\u2019t what most programmers expect, which leads to bugs.", "It is natural to vent one\u2019s frustration with a tool\u2019s dangerous quirks. But it is what it is. This is Python\u2019s behavior, and it\u2019s not going to change. It\u2019s too late to alter this oddity in the language, because doing so would break many existing programs that depend on it. As professional developers, it\u2019s up to us to understand our tools and use them properly.", "Does this mean default function arguments are too dangerous to use? Not at all. It\u2019s possible to work around the issue so that we can still write a Tally function that behaves the way we want. It\u2019s just a matter of avoiding using a mutable default value.", "A common way to create a new mutable object by default every time a function is called is to use an immutable placeholder value like None. The function looks for that placeholder value and, when found, replaces it with a brand new instance of the mutable type.", "That sounds abstract, so to make things clear, let\u2019s apply the idea to the now-familiar Tally function.", "Now we finally have a function that satisfies all our requirements. When given a single string argument, it counts up the distinct characters in that one string. When given a string argument and a dictionary argument, it adds the string\u2019s letter counts to the given dictionary.", "If your desired default value is already of an immutable type, there is no need to worry about any of this. But there are a lot of mutable types to be cautious with, like lists, dictionaries, sets, and most class instances. Even a tuple is risky if it contains mutable members.", "Even if your function does not mutate an optional parameter, unwanted side effects can occur if your function exposes the mutable value to the caller. For example, if the function returns the mutable value, and the calling code modifies its state, subsequent calls to the function will see the modifications, even though they are not explicitly passed in. Even worse, completely unrelated code (perhaps inside different modules) can call the same function and thereby contaminate each other\u2019s inner workings.", "I got burned by this problem recently. I hope this article saves you from the same kind of confusing bug I encountered in my Python code. It\u2019s admirable to learn from your own mistakes, but I think you will agree it\u2019s more pleasant to learn from someone else\u2019s!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F9385e8265422&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----9385e8265422--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@cosinekitty?source=post_page-----9385e8265422--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Don Cross"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2d2166d7d92&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&user=Don+Cross&userId=e2d2166d7d92&source=post_page-e2d2166d7d92----9385e8265422---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@uomo_libero?utm_source=medium&utm_medium=referral", "anchor_text": "uomo libero"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Functional_programming", "anchor_text": "functional programming"}, {"url": "https://en.wikipedia.org/wiki/Principle_of_least_astonishment", "anchor_text": "principle of least surprise"}, {"url": "https://docs.python.org/3/reference/compound_stmts.html#function-definitions", "anchor_text": "Python documentation about function definitions"}, {"url": "https://stackoverflow.com/questions/1132941/least-astonishment-and-the-mutable-default-argument", "anchor_text": "this Stack Overflow thread"}, {"url": "https://medium.com/tag/programming?source=post_page-----9385e8265422---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----9385e8265422---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/software-development?source=post_page-----9385e8265422---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/debugging?source=post_page-----9385e8265422---------------debugging-----------------", "anchor_text": "Debugging"}, {"url": "https://medium.com/tag/programming-languages?source=post_page-----9385e8265422---------------programming_languages-----------------", "anchor_text": "Programming Languages"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&user=Don+Cross&userId=e2d2166d7d92&source=-----9385e8265422---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&user=Don+Cross&userId=e2d2166d7d92&source=-----9385e8265422---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----9385e8265422--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F9385e8265422&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----9385e8265422---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----9385e8265422--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----9385e8265422--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----9385e8265422--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----9385e8265422--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----9385e8265422--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Don Cross"}, {"url": "https://medium.com/@cosinekitty/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "534 Followers"}, {"url": "https://github.com/cosinekitty", "anchor_text": "https://github.com/cosinekitty"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2d2166d7d92&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&user=Don+Cross&userId=e2d2166d7d92&source=post_page-e2d2166d7d92--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F376b6ecea8c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpython-pitfall-mutable-default-arguments-9385e8265422&newsletterV3=e2d2166d7d92&newsletterV3Id=376b6ecea8c2&user=Don+Cross&userId=e2d2166d7d92&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}