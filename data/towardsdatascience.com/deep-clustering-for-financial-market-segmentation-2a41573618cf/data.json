{"url": "https://towardsdatascience.com/deep-clustering-for-financial-market-segmentation-2a41573618cf", "time": 1683001531.566219, "path": "towardsdatascience.com/deep-clustering-for-financial-market-segmentation-2a41573618cf/", "webpage": {"metadata": {"title": "Deep Clustering for Financial Market Segmentation | by Yuefeng Zhang, PhD | Towards Data Science", "h1": "Deep Clustering for Financial Market Segmentation", "description": "Unsupervised learning, supervised learning and reinforcement learning are three main categories of machine learning methods. Unsupervised learning has many applications such as clustering\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Unsupervised_learning", "anchor_text": "Unsupervised learning", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Supervised_learning", "anchor_text": "supervised learning", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Reinforcement_learning", "anchor_text": "reinforcement learning", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/K-means_clustering", "anchor_text": "K-means", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Principal_component_analysis", "anchor_text": "Principal Component Analysis", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding", "anchor_text": "T-distributed Stochastic Neighbor Embedding", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Autoencoder", "anchor_text": "Autoencoder", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Semi-supervised_learning", "anchor_text": "Semi-supervised learning", "paragraph_index": 1}, {"url": "https://www.nature.com/articles/srep26094", "anchor_text": "deep patient", "paragraph_index": 1}, {"url": "https://arxiv.org/pdf/1511.06335.pdf", "anchor_text": "Deep Embedded Clustering", "paragraph_index": 2}, {"url": "https://github.com/piiswrong/dec", "anchor_text": "original implementation of DEC", "paragraph_index": 2}, {"url": "https://caffe.berkeleyvision.org/", "anchor_text": "Caffe", "paragraph_index": 2}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 2}, {"url": "https://en.wikipedia.org/wiki/MNIST_database", "anchor_text": "MNIST", "paragraph_index": 2}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Kaggle Credit Card Dataset for Clustering", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/Silhouette_(clustering)", "anchor_text": "silhouette", "paragraph_index": 11}, {"url": "https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence", "anchor_text": "Kullback-Leibler", "paragraph_index": 26}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Kaggle Credit Card Dataset for Clustering", "paragraph_index": 41}, {"url": "https://www.dlology.com/blog/how-to-do-unsupervised-clustering-with-keras/", "anchor_text": "How to do Unsupervised Clustering with Keras", "paragraph_index": 44}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Credit Card Dataset for Clustering", "paragraph_index": 45}, {"url": "https://github.com/yzzhang/machine-learning/tree/master/deep_learning/unsupervised_learning/dec_keras_clustering", "anchor_text": "Github", "paragraph_index": 46}], "all_paragraphs": ["Unsupervised learning, supervised learning and reinforcement learning are three main categories of machine learning methods. Unsupervised learning has many applications such as clustering, dimensionality reduction, etc. The machine learning algorithms K-means and Principal Component Analysis (PCA) are widely used for clustering and dimensionality reduction respectively. Similarly to PCA, the T-distributed Stochastic Neighbor Embedding (t-SNE) is another unsupervised machine learning algorithm for dimensionality reduction. t-SNE is typically used for embedding high-dimensional data in a two or three dimensional space for data visualization.", "With the advancement of unsupervised deep learning, the Autoencoder neural network is now frequently used for high dimensionality (e.g., a dataset with thousands or more features) reduction. Autoencoder can also be combined with supervised learning (e.g., Random Forest) to form Semi-supervised learning method (see deep patient as an example).", "Recently a Deep Embedded Clustering (DEC) method [1] was published. It combines autoencoder with K-means and other machine learning techniques for clustering rather than dimensionality reduction. The original implementation of DEC is based on Caffe. An implementation of DEC in Keras for MNIST dataset can be found in [2].", "In this article, similarly to [2], I implement the DEC algorithm in Keras and use the public dataset Kaggle Credit Card Dataset for Clustering [3] to show how to use the new implemented DEC model to cluster the credit card dataset for customer segmentation. The rest of this article is arranged as follows:", "This section describes the common data preprocessing steps required for clustering.", "After the Kaggle credit card dataset [3] has been downloaded onto a local machine, it can be loaded into Pandas DataFrame as follows:", "It can be seen from the DataFrame above that CUST_ID field is unique for each customer data record. This field with unique values is not useful for clustering and thus can be dropped:", "It can also be seen from the DataFrame that the ranges of values are very different for different fields/features. It is well known that K-means is sensitive to the scale of feature values because it uses Euclidean distance as similarity metrics. To avoid this issue, the values of all features are rescaled into the range of [0, 1]:", "The following code is to check if any missing data exists in the dataset:", "The above table shows that there are one missing CREDIT_LIMIT record and 313 missing MINIMUM_PAYMENTS. In this case, it makes sense to fill up missing data with zero:", "Similarly to [2], the DEC algorithm in [1] is implemented in Keras in this article as follows:", "As described before, the DEC method combines Autoencoder with K-means and other machine learning techniques. In order to train a K-means model, an estimated number of clusters is required. The number of clusters is estimated in this article by exploring the silhouette values of different K-means model executions:", "A silhouette value measures how similar a data record is to its own cluster (cohesion) compared to other clusters. The silhouette value ranges from \u22121 to +1, where a high value indicates that the data record matches to its own cluster well and matches poorly to its neighboring clusters.", "The silhouette values above indicate that the top two choices of the number of clusters are 2 and 3. The number of clusters of 3 is chosen in this article.", "Once the number of clusters is determined, a K-means model can be created:", "In addition to K-means, an autoencoder is required as well in the DEC algorithm [1]. The following function is to create an autoencoder:", "An autoencoder model is created as follows:", "As described in [1], the sizes of layers [500, 500, 2000, 10] are chosen as a generic configuration of the autoencoder neural network for any dataset.", "The diagram of the resulting encoder model can be created as below:", "The autoencoder is trained as follows:", "The weights of the trained autoencoder are saved for later usage:", "One of the key components in the DEC method [1] is soft labeling, that is, assigning an estimated class to each of the data samples in such a way that it can be refined iteratively. To this end, similarly to [2], a new ClusteringLayer class is defined:", "Once the soft labeling layer is defined, it can be used to form a DEC model as follows:", "A diagram of the new DEC model can be created as below:", "The new DEC model can be compiled as follows:", "The new DEC model is trained iteratively:", "As described in [1], the training procedure above iteratively refines the clusters by learning from the high confidence assignments with the help of the auxiliary target distribution function target_distribution(). Specifically, the DEC model is trained by matching the soft assignment to the target distribution. To this end, in the DEC model the objective/loss function is defined as a Kullback-Leibler (KL) divergence loss between the soft assignments and the auxiliary distribution.", "The model weights of the trained model are saved for later usage:", "Once the DEC model is trained, then it can be used for predicting clustering classes as follows:", "A silhouette score of 0.291 is obtained as follows:", "The following code can be used to use t-SNE to embed the dataset into a two dimensional space and then use color coding of the predicted clustering labels to visualize the predicted clustering result:", "Figure 1: Clustering of the new DEC model with silhouette score of 0.291.", "The main idea behind the DEC method [1] is to simultaneously learn the feature representations and cluster assignments using deep neural networks. To this end, the following code uses the pre-trained autoencoder and K-means model to define a new model that takes the preprocessed credit card dataset as input and output both the predicted clustering classes and decoded input data records.", "The diagram of the joined model can be created as follows:", "The refinement of the DEC model is performed as follows:", "The jointly refined model weights are saved:", "The following code is to use the refined DEC model for predicting clustering classes:", "The code below can be used to reuse the t-SNE embedded two dimensional space (vis_x, vis_y) and use the color coding of the new predicted clustering labels to visualize the new predicted clustering result:", "Figure 2: Clustering of the refined DEC model with silhouette score of 0.318.", "Figure 3 shows the result of clustering by K-means. By comparing Figure 3 with Figure 2, we can see that K-means achieved relatively higher silhouette score. However, it can be seen that the refined DEC model predicted clusters with more clearly separable boundaries.", "Figure 3: Clustering of the K-means model with silhouette score of 0.372.", "In this article, similarly to [2], I implemented a new DEC model in Keras based on the original DEC algorithm in [1] and then applied the new model to the public dataset Kaggle Credit Card Dataset for Clustering [3].", "The model evaluation results demonstrated that the new refined DEC model predicted more clearly separable clusters of the credit card dataset compared with the K-means method. This new DEC model has the potential of being used for credit card customer segmentation, other financial market segmentation, etc.", "A Jupyter notebook with all of the source code used in this article is available in Github [4].", "[2] Chengwei, How to do Unsupervised Clustering with Keras", "[3] Kaggle Credit Card Dataset for Clustering", "[4] Y. Zhang, Jupyter notebook in Github", "DISCLOSURE STATEMENT: \u00a9 2019 Capital One. Opinions are those of the individual author. Unless noted otherwise in this post, Capital One is not affiliated with, nor endorsed by, any of the companies mentioned. All trademarks and other intellectual property used or displayed are property of their respective owners.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior Data Scientist at Wavicle Data Solutions, He was a Senior Data Scientist at SMS Assist, a Senior Data Engineer at Capital One, and a DMTS at Motorola"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2a41573618cf&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2a41573618cf--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@zhangyuefeng1?source=post_page-----2a41573618cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zhangyuefeng1?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Yuefeng Zhang, PhD"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F80e8f2faf4bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&user=Yuefeng+Zhang%2C+PhD&userId=80e8f2faf4bc&source=post_page-80e8f2faf4bc----2a41573618cf---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://en.wikipedia.org/wiki/Unsupervised_learning", "anchor_text": "Unsupervised learning"}, {"url": "https://en.wikipedia.org/wiki/Supervised_learning", "anchor_text": "supervised learning"}, {"url": "https://en.wikipedia.org/wiki/Reinforcement_learning", "anchor_text": "reinforcement learning"}, {"url": "https://en.wikipedia.org/wiki/K-means_clustering", "anchor_text": "K-means"}, {"url": "https://en.wikipedia.org/wiki/Principal_component_analysis", "anchor_text": "Principal Component Analysis"}, {"url": "https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding", "anchor_text": "T-distributed Stochastic Neighbor Embedding"}, {"url": "https://en.wikipedia.org/wiki/Autoencoder", "anchor_text": "Autoencoder"}, {"url": "https://en.wikipedia.org/wiki/Semi-supervised_learning", "anchor_text": "Semi-supervised learning"}, {"url": "https://www.nature.com/articles/srep26094", "anchor_text": "deep patient"}, {"url": "https://arxiv.org/pdf/1511.06335.pdf", "anchor_text": "Deep Embedded Clustering"}, {"url": "https://github.com/piiswrong/dec", "anchor_text": "original implementation of DEC"}, {"url": "https://caffe.berkeleyvision.org/", "anchor_text": "Caffe"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://en.wikipedia.org/wiki/MNIST_database", "anchor_text": "MNIST"}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Kaggle Credit Card Dataset for Clustering"}, {"url": "https://en.wikipedia.org/wiki/Silhouette_(clustering)", "anchor_text": "silhouette"}, {"url": "https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence", "anchor_text": "Kullback-Leibler"}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Kaggle Credit Card Dataset for Clustering"}, {"url": "https://arxiv.org/pdf/1511.06335.pdf", "anchor_text": "Unsupervised Deep Embedding for Clustering Analysis"}, {"url": "https://www.dlology.com/blog/how-to-do-unsupervised-clustering-with-keras/", "anchor_text": "How to do Unsupervised Clustering with Keras"}, {"url": "https://www.kaggle.com/arjunbhasin2013/ccdata", "anchor_text": "Credit Card Dataset for Clustering"}, {"url": "https://github.com/yzzhang/machine-learning/tree/master/deep_learning/unsupervised_learning/dec_keras_clustering", "anchor_text": "Github"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----2a41573618cf---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/unsupervised-learning?source=post_page-----2a41573618cf---------------unsupervised_learning-----------------", "anchor_text": "Unsupervised Learning"}, {"url": "https://medium.com/tag/autoencoder?source=post_page-----2a41573618cf---------------autoencoder-----------------", "anchor_text": "Autoencoder"}, {"url": "https://medium.com/tag/k-means?source=post_page-----2a41573618cf---------------k_means-----------------", "anchor_text": "K Means"}, {"url": "https://medium.com/tag/finantial-data-clustering?source=post_page-----2a41573618cf---------------finantial_data_clustering-----------------", "anchor_text": "Finantial Data Clustering"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&user=Yuefeng+Zhang%2C+PhD&userId=80e8f2faf4bc&source=-----2a41573618cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&user=Yuefeng+Zhang%2C+PhD&userId=80e8f2faf4bc&source=-----2a41573618cf---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2a41573618cf&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2a41573618cf---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2a41573618cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2a41573618cf--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2a41573618cf--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2a41573618cf--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2a41573618cf--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zhangyuefeng1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@zhangyuefeng1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yuefeng Zhang, PhD"}, {"url": "https://medium.com/@zhangyuefeng1/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "293 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F80e8f2faf4bc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&user=Yuefeng+Zhang%2C+PhD&userId=80e8f2faf4bc&source=post_page-80e8f2faf4bc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F84632d34eae6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-clustering-for-financial-market-segmentation-2a41573618cf&newsletterV3=80e8f2faf4bc&newsletterV3Id=84632d34eae6&user=Yuefeng+Zhang%2C+PhD&userId=80e8f2faf4bc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}