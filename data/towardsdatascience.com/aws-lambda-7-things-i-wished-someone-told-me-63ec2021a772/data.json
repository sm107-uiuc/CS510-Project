{"url": "https://towardsdatascience.com/aws-lambda-7-things-i-wished-someone-told-me-63ec2021a772", "time": 1683017141.42129, "path": "towardsdatascience.com/aws-lambda-7-things-i-wished-someone-told-me-63ec2021a772/", "webpage": {"metadata": {"title": "AWS Lambda - 7 things I wished someone told me | by Charles Malafosse | Towards Data Science", "h1": "AWS Lambda - 7 things I wished someone told me", "description": "AWS Lambda is quite simple to use but as the same time it can be tricky to implement and optimize. In this post I summarized 3 years of experience working with this service. The result is a list of 7\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Cloud_computing#Service_models", "anchor_text": "FaaS", "paragraph_index": 1}, {"url": "https://lucyinthecloud.com/", "anchor_text": "https://lucyinthecloud.com/", "paragraph_index": 30}], "all_paragraphs": ["AWS Lambda is quite simple to use but as the same time it can be tricky to implement and optimize. In this post I summarized 3 years of experience working with this service. The result is a list of 7 things I wish I already knew when I started, from service logic, DB connections management and cost optimization. Hope this helps people starting off.", "AWS Lambda is Amazon \u201cFunction as a Service\u201d (FaaS), a category of cloud computing services that allows customers to run application functionalities without the complexity of maintaining the infrastructure. You pay only for the compute time you consume, which is great, and there is no charge when your code is not running.", "First things first, how does AWS Lambda work?", "Each lambda function is executed in a container that provides an isolated execution environment. When a function is executed for the first time, a new container with the appropriate resources will be created to execute it, and the code for the function will be loaded into the container. This happens every time the function\u2019s code is updated or when a previously created container is destroyed.", "Although AWS will reuse a container when one is available, after some time this container is destroyed. There is no documentation that describe when a container is destroyed nor what event can trigger its destruction. We must keep in mind that Lambda function should be stateless and we should accept that a container could live few minutes or few seconds.", "TAKEAWAY: Lambda need to create an isolated container to execute your code. This container can be destroyed at anytime. Make sure your function\u2019s code is stateless.", "The cold start issue is an important factor to keep in mind when writing a Lambda function. It refers to the fact that when a container is created, AWS needs extra time to load the code and set up the environment versus just reusing an existing container.", "This is important when a lambda function need to load data, set global variables, and initiate connections to a database. Depending on your function, it can take few milliseconds to few seconds. And anything above 1 second can feel like an eternity for a user of your API!", "Also note that cold start happens once for each concurrent execution of your function. Therefore, a burst of requests on your lambda can lead to multiple users experiencing a slow execution due to the cold start\u2026 not great.", "When you write your Lambda function code, do not assume that AWS Lambda automatically reuses the execution context for subsequent function invocations. Other factors may dictate a need for AWS Lambda to create a new execution context, which can lead to unexpected results, such as database connection failures.", "TAKEAWAY: The cold start issue can happen anytime and slow the execution of your lambda function.", "Extra care should be used when writing a Lambda function that connects to a SQL database.", "Lambda is (almost) infinitely scalable. When concurrent executions of a lambda are triggered, each of these executions will set up their own global variables and database connections. Unfortunately, your database\u2019s available connections might not be enough to allow each lambda function to create their own connection. And this could result in a denial of service.", "TAKEAWAY: Even though Lambda is highly scalable, your DB connections are not. Keep that in mind when using Lambdas.", "Unless you have deep pockets and can afford a fast server to host your SQL database, a query returning large chunk of data can slow your Lambda function.", "One way I used to speed up things is to use the S3 service. First I dumped an extract of my SQL table to a csv file in a S3 bucket. Next, every time my lambda function starts for the first time (cold start) the file is transferred from S3 to the /tmp/ directory of my lambda container. In python the code to do so is quite simple (to not forget to allow lambda to access S3):", "On my lambda with 1280MB of memory, a file of 125mb takes approximately 2000ms to be transferred. Still a significant amount but keep in mind it only has to be done once. The equivalent with an SQL query on my database would be more than 20 seconds. According to the doc: \u201cdata transferred between Amazon S3 [\u2026] and AWS Lambda functions in the same AWS Region is free.\u201d, so no worries regarding the cost.", "TAKEWAY: You can load data directly in your Lambda\u2019s memory thanks to the S3 service. This might be a way to reduce the load on your database and increase the speed of your lambda at the same time.", "Lambda function can pull in additional code and content in the form of layers. From AWS docs: \u201cA layer is a ZIP archive that contains libraries, a custom runtime, or other dependencies. With layers, you can use libraries in your function without needing to include them in your deployment package.\u201d", "Simply put, a lambda layer is a piece of code that can be reused in other lambda functions. The main advantages of layers are, in my opinion:", "TAKEAWAY: Use Lambda layers as much as possible to keep your deployment package small and to stay under the 3MB threshold to be able to edit your code in the AWS console.", "One parameter of Lambda functions is the amount of memory available to the function. Lambda allocates CPU power linearly in proportion to the amount of memory configured. According to the docs, at 1,792 MB, a function has the equivalent of one full vCPU (one vCPU-second of credits per second).", "Of course, higher memory means higher cost. For example, in the eu-west-1 region it costs $0.0000166667 for every GB of memory per second. One might think that increasing the memory of a Lambda function will result in a higher bill. But this is not entirely true for 2 reasons:", "TAKEAWAY: Increased memory in lambdas do not necessarily translate in higher cost. With more memory lambdas are executed faster. Hence there is usually a sweet spot with higher memory and similar cost.", "Lambda is priced reasonably. However it is classic to end up with a larger bill than a similar code running on an EC2 instance. Here is why:", "Below is a table summarizing the price difference of a 128MB lambda vs. a cheap T3.nano. Lambda cost is twice as much, assuming full use of the lambda, and ignoring the fact that T3.nano can run pseudo concurrent execution at no extra cost.", "Having said that, Lambda flexibility and the fact that there is no infrastructure to manage is worth the price in my opinion. But keep in mind that heavily invoked lambda might be better off running in a EC2 instance.", "TAKEAWAY: Lambda functions are not always the best option when they are heavily invoked. EC2 or Elastic Beanstalk might be good alternatives.", "AWS Lambda is a great service. It is fast and reliable and can help deploy code without managing the infrastructure. Nonetheless it can also be expensive both in terms of time and money if not understood to a certain level. Hopefully this article helped you visualize the techniques and details I encountered while developing hundreds of AWS Lambdas.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A Quant in the Cloud. Expert in the field of AWS, ML & Big data. Director at https://lucyinthecloud.com/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F63ec2021a772&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://charlesmalafosse.medium.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Charles Malafosse"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd97a784141f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&user=Charles+Malafosse&userId=dd97a784141f&source=post_page-dd97a784141f----63ec2021a772---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/making-sense-of-big-data", "anchor_text": "Making Sense of Big Data"}, {"url": "https://giphy.com/", "anchor_text": "https://giphy.com/"}, {"url": "https://en.wikipedia.org/wiki/Cloud_computing#Service_models", "anchor_text": "FaaS"}, {"url": "https://aws.amazon.com/blogs/compute/container-reuse-in-lambda/", "anchor_text": "Understanding Container Reuse in AWS Lambda | Amazon Web ServicesTim Wagner, AWS Lambda AWS Lambda functions execute in a container (sandbox) that isolates them from other functions\u2026aws.amazon.com"}, {"url": "https://medium.com/hackernoon/im-afraid-you-re-thinking-about-aws-lambda-cold-starts-all-wrong-7d907f278a4f", "anchor_text": "I\u2019m afraid you\u2019re thinking about AWS Lambda cold starts all wrongWhen I discuss AWS Lambda cold starts with folks in the context of API Gateway, I often get responses along the line\u2026medium.com"}, {"url": "https://aws.amazon.com/rds/proxy/", "anchor_text": "Amazon RDS Proxy | Highly Available Database Proxy | Amazon Web ServicesMake your applications more scalable, resilient, and secure Amazon RDS Proxy is a fully managed, highly available\u2026aws.amazon.com"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html", "anchor_text": "AWS Lambda layersYou can configure your Lambda function to pull in additional code and content in the form of layers. A layer is a ZIP\u2026docs.aws.amazon.com"}, {"url": "https://medium.com/@charlesmalafosse/membership", "anchor_text": "https://medium.com/@charlesmalafosse/membership"}, {"url": "https://medium.com/tag/aws-lambda?source=post_page-----63ec2021a772---------------aws_lambda-----------------", "anchor_text": "AWS Lambda"}, {"url": "https://medium.com/tag/serverless?source=post_page-----63ec2021a772---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/cloud-computing?source=post_page-----63ec2021a772---------------cloud_computing-----------------", "anchor_text": "Cloud Computing"}, {"url": "https://medium.com/tag/database?source=post_page-----63ec2021a772---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/making-sense-of-big-data?source=post_page-----63ec2021a772---------------making_sense_of_big_data-----------------", "anchor_text": "Making Sense Of Big Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&user=Charles+Malafosse&userId=dd97a784141f&source=-----63ec2021a772---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&user=Charles+Malafosse&userId=dd97a784141f&source=-----63ec2021a772---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F63ec2021a772&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----63ec2021a772---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----63ec2021a772--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----63ec2021a772--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----63ec2021a772--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----63ec2021a772--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----63ec2021a772--------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://charlesmalafosse.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Charles Malafosse"}, {"url": "https://charlesmalafosse.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "312 Followers"}, {"url": "https://lucyinthecloud.com/", "anchor_text": "https://lucyinthecloud.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdd97a784141f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&user=Charles+Malafosse&userId=dd97a784141f&source=post_page-dd97a784141f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F6fc3c69b59a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Faws-lambda-7-things-i-wished-someone-told-me-63ec2021a772&newsletterV3=dd97a784141f&newsletterV3Id=6fc3c69b59a6&user=Charles+Malafosse&userId=dd97a784141f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}