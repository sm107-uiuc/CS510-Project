{"url": "https://towardsdatascience.com/extra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c", "time": 1683006145.4784708, "path": "towardsdatascience.com/extra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c/", "webpage": {"metadata": {"title": "Extra 4 SQL Tricks Every Data Scientist Should Know | by Kat Li | Towards Data Science", "h1": "Extra 4 SQL Tricks Every Data Scientist Should Know", "description": "In my previous blog, 6 SQL Tricks Every Data Scientist Should Know, I discussed the most useful SQL functionalities in my daily work as a data scientist. This blog, as Part 2 of this mini-series, I\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "6 SQL Tricks Every Data Scientist Should Know", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Don%27t_repeat_yourself", "anchor_text": "the DRY / Don\u2019t Repeat Yourself principle", "paragraph_index": 23}, {"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "my previous post for tips of extracting data from SQL database to Python", "paragraph_index": 29}, {"url": "https://github.com/YiLi225/SQL_Python_R", "anchor_text": "here in my Github", "paragraph_index": 30}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link", "paragraph_index": 31}, {"url": "https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw", "anchor_text": "\u201cData Talk with Kat\u201d", "paragraph_index": 32}], "all_paragraphs": ["In my previous blog, 6 SQL Tricks Every Data Scientist Should Know, I discussed the most useful SQL functionalities in my daily work as a data scientist. This blog, as Part 2 of this mini-series, I will continue to share my SQL tips to help you level up your analytics/reporting efficiency.", "Today, we will be working with a new toy table shown below containing multiple data types, and for demonstration purpose, this exercise will be implemented in MS SQL server 2017,", "The ROW_NUMBER() function in SQL creates a unique incrementing integer value to each row of the result. This column of values is considered a pseudo-column as it does not inherently exist in our data table, and because of which, the result is returned in the order determined by the analysts in the ORDER BY clause.", "With this pseudo-column, we can solve the \u201ctop N\u201d questions using a simple query, and the following demonstrates how to select the top 3 records with the highest Num_Var value for each ID,", "Here is the returned subset (and of course, you can remove the column RowNumber from the output),", "Noticed that in spite of being only one row, ID 0180 was returned correctly just as other IDs (with more than 3 rows). Hence, no extra caution needed in regard to whether the raw data have enough rows for the number N specified. Straightforward!", "*** Update 2022: You can also watch the video version of this article here,", "2. Compute the length of consecutive days with the ROW_NUMBER()(advanced)", "Knowing the concept of the ROW_NUMBER(), you must be thinking about another possible application in time series, where we calculate the consecutive time the event of interest lasts.", "What do I mean? Well, let\u2019s consider our toy data being customers logging in to our website. Customer ID 0155 logged in on 06/01, 06/02, and 06/03 (i.e., 3 consecutive days), and then there were another 2 consecutive logins on 09/29 and 09/30 each. Visually it is not that simple for us to do this calculation if the dates are not sorted. How a SQL query could help?", "An intuitive way would be first using the ROW_NUMBER() to assign row numbers ordered by dates within each customer ID. Because the integer row numbers happen to be incremental by 1 also, the length of consecutive days is just the difference between the last date and the first date! Unfortunately, it won\u2019t work because it would give us a 5, rather than 3 and 2 (for customer 0155).", "This brings up an important note on the ROW_NUMBER() function: it has no gaps! It creates an ever-increasing value that always starts with 1 for each partition, whereas our data has gaps (e.g., 06/03 and 09/29 are not consecutive). Thus, simply applying ROW_NUMBER() cannot get us the desired output. We need some tweaks, and here\u2019s how,", "Step 1: Create the RowNumber (order by date ASC)", "which gives us this interim output, and let\u2019s label it output_table_with_RowNumber for easy reference below,", "Step 2: Date_Var \u2212 RowNumber to group the consecutive days (i.e., dates with the same starting points for counting)", "and here\u2019s the return, which is labeled as output_table_with_grouping_var,", "now, don\u2019t get hung up on the values of this derived variable Starting_Count_DT because it\u2019s meaningless. It is just a grouping variable to basically tell SQL that these rows are consecutive (i.e., incremental by 1).", "Step 3: Calculate the length (of consecutive days) grouped by the Starting_Count_DT", "Phew, problem solved! If you don\u2019t get it the first time, no worries, you can put this into your data science code snippets stash, and refer back whenever you need to. Spoil alert, don\u2019t be surprised to encounter this exact problem in your next data scientist position interview with the big tech companies \ud83d\ude04", "3. WITH statement to keep it DRY", "The previous query, as we just saw, is a fairly complex one containing 2 nested sub-queries. These sub-queries add more complexity to read and debug our code in the sense that if we were to pass it to other teammates, chances are they would have no idea what this query is doing.", "Now the WITH clause (a.k.a., subquery factoring) to the rescue! Let\u2019s see how we can re-write the query above to make it more understandable,", "Here, (1) by leveraging the WITH clause, we broke down the nested queries into 2 individual temp views for better code readability; (2) no requirement for the relations among the multiple WITH queries, meaning they can be independent or dependent (like in our example).", "Another useful scenario of the WITH clause is when the WITH query is referenced multiple times. Without repeatedly writing the same sub-query again and again (i.e., the DRY / Don\u2019t Repeat Yourself principle), we can introduce upfront and reuse it later.", "4. Concatenating to re-format your data structure", "Moving on, our next task is to create an aggregated report for our internal stakeholders, showing the dates each customer logged in. This will be an aggregation of many-to-many information. Also observing that the ID_Var and Gen_Var both contain duplicated values across rows, therefore to make it suitable for human reading, we immediately think of the STRING_AGG() function in MS SQL 2017,", "As we can see, (1) ordering the elements in the concatenated list is allowed by simply specifying the ORDER BY statement (e.g., ID 0155); (2) despite of being more commonly used for string concatenation, the STRING_AGG() function also works for other data types (e.g., the date and number variables in our example).", "Now, a couple of callouts regarding this aggregation functionality:", "(1) although it is available in major SQL databases, the specific function name varies. In Oracle/PLSQL (11g), it\u2019s the LISTAGG(), in MySQL along with IBM Netezza, it\u2019s the GROUP_CONCAT(), in MS SQL server 2017 and PostgresSQL, it\u2019s the STRING_AGG().", "(2) besides making the data view simpler, I find it also useful in scenarios where we need to pull data into R or Python for in-depth analysis (by the way, check out my previous post for tips of extracting data from SQL database to Python if you haven't done so). Instead of transferring the entire raw data table as is with most columns having duplicates, we can first concatenate the field with varying values into one row per ID to reduce the data size and then parse this field in R or Python. In this concatenation, Null values will be excluded, and thus, we don\u2019t have to worry about missing value handling at this point.", "So there you have it \u2014 4 additional SQL tips for data analytics! I hope you find this mini-series inspiring, and enjoyed reading it as much as me writing it. As always, all the code snippets together with the toy data is available here in my Github \ud83d\ude00", "Want more data science and programming tips? Use my link to sign up to Medium and gain full access to all my content.", "Also subscribe to my newly created YouTube channel \u201cData Talk with Kat\u201d,", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd3ed7cd7bc6c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yilistats.medium.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Kat Li"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7657f76e72be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&user=Kat+Li&userId=7657f76e72be&source=post_page-7657f76e72be----d3ed7cd7bc6c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "6 SQL Tricks Every Data Scientist Should Know"}, {"url": "https://en.wikipedia.org/wiki/Don%27t_repeat_yourself", "anchor_text": "the DRY / Don\u2019t Repeat Yourself principle"}, {"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "my previous post for tips of extracting data from SQL database to Python"}, {"url": "https://github.com/YiLi225/SQL_Python_R", "anchor_text": "here in my Github"}, {"url": "https://yilistats.medium.com/membership", "anchor_text": "my link"}, {"url": "https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw", "anchor_text": "\u201cData Talk with Kat\u201d"}, {"url": "https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5", "anchor_text": "6 SQL Tricks Every Data Scientist Should KnowSQL tricks to make your analytics work more efficienttowardsdatascience.com"}, {"url": "https://medium.com/tag/sql?source=post_page-----d3ed7cd7bc6c---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/data-science?source=post_page-----d3ed7cd7bc6c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/analytics?source=post_page-----d3ed7cd7bc6c---------------analytics-----------------", "anchor_text": "Analytics"}, {"url": "https://medium.com/tag/python?source=post_page-----d3ed7cd7bc6c---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&user=Kat+Li&userId=7657f76e72be&source=-----d3ed7cd7bc6c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&user=Kat+Li&userId=7657f76e72be&source=-----d3ed7cd7bc6c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd3ed7cd7bc6c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d3ed7cd7bc6c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d3ed7cd7bc6c--------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yilistats.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kat Li"}, {"url": "https://yilistats.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.5K Followers"}, {"url": "https://www.youtube.com/@DataTalksWithKat", "anchor_text": "https://www.youtube.com/@DataTalksWithKat"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7657f76e72be&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&user=Kat+Li&userId=7657f76e72be&source=post_page-7657f76e72be--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F37afe5b5308f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fextra-4-sql-tricks-every-data-scientist-should-know-d3ed7cd7bc6c&newsletterV3=7657f76e72be&newsletterV3Id=37afe5b5308f&user=Kat+Li&userId=7657f76e72be&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}