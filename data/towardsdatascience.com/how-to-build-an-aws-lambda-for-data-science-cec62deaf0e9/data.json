{"url": "https://towardsdatascience.com/how-to-build-an-aws-lambda-for-data-science-cec62deaf0e9", "time": 1683017931.795143, "path": "towardsdatascience.com/how-to-build-an-aws-lambda-for-data-science-cec62deaf0e9/", "webpage": {"metadata": {"title": "How to Build an AWS Lambda for Data Science | by McKlayne Marshall | Towards Data Science", "h1": "How to Build an AWS Lambda for Data Science", "description": "On Dec 1st, the CEO of AWS, Andy Jassy, made an announcement at the annual re:Invent conference to support lambdas built on container images. This was one of the many announcements made at the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/u/d7a7f01c81e3?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Isaac Rhea", "paragraph_index": 0}, {"url": "https://medium.com/u/f8bcb330ac60?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Cody Crofoot", "paragraph_index": 0}, {"url": "https://aws.amazon.com/blogs/aws/aws-reinvent-announcements-2020/", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/", "anchor_text": "documentation", "paragraph_index": 3}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "lambda function", "paragraph_index": 5}, {"url": "https://www.docker.com/resources/what-container", "anchor_text": "container image", "paragraph_index": 6}, {"url": "https://docs.aws.amazon.com/general/latest/gr/root-vs-iam.htmlhttps://docs.aws.amazon.com/general/latest/gr/root-vs-iam.html", "anchor_text": "here", "paragraph_index": 8}, {"url": "https://www.youtube.com/watch?v=GjVFf83dcE8", "anchor_text": "Here", "paragraph_index": 9}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html", "anchor_text": "here", "paragraph_index": 10}, {"url": "https://docs.docker.com/desktop/", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://docs.docker.com/engine/reference/commandline/cp/", "anchor_text": "Here", "paragraph_index": 38}], "all_paragraphs": ["Co-authored with Isaac Rhea and Cody Crofoot", "On Dec 1st, the CEO of AWS, Andy Jassy, made an announcement at the annual re:Invent conference to support lambdas built on container images. This was one of the many announcements made at the conference, see the list here.", "This new feature makes it very convenient to build lambda-based applications using any and all existing container development workflows, as mentioned in the announcement. Another key benefit is the increase in the deployment package size of 250 MB for the code/dependencies and 50 MB for the function to 10 GB or 10000 MB. That is more than a 33X improvement, which makes a big difference when trying to run data intensive or machine learning lambda\u2019s.", "The purpose of this article is to provide a detailed, step-by-step guide on how to get started. The hope is that someone new to containers, lambdas, and AWS will be able to set up a lambda running off of a container image. If you are fairly familiar with these concepts, here is the documentation from AWS on how to get started.", "Before we begin the step-by-step guide, it is important to understand the concepts of a lambda function and a container image.", "First, a lambda function allows individuals to run chunks of code in the cloud (serverless). Imagine you have a piece of code you would like to run everyday at the same time for the next 5 years. You could do this on your own computer or a server, but you would have to ensure that your computer has power, is on, and the code is scheduled to run or is ran manually. Essentially, there is a fixed cost around the \u201cserver\u201d method. Serverless, or leveraging the cloud, removes those fixed costs and you are only charged for the compute time that your chunk of code uses. You can also schedule your code to run at any point in time and tie it to other services within the cloud.", "Second, a container image is a way to containerize the needed computer software, packages and files for a job you are hoping to accomplish. Oftentimes, you don\u2019t need everything on your typical computer for a specific job, so a container allows you to specify exactly what you need for the job and to bundle it up in a neat and organized file.", "Combining the two together, we will be creating a container image that allows us to run a lambda function in the cloud. Our lambda function code has large dependencies, so we will be using a container to specify what those dependencies are and then push it to the cloud and run our lambda off of it.", "Be sure to set up your root account and IAM account. This provides a layer of security within AWS. See documentation on this topic here.", "For individuals that are new to AWS, IAM management is a foreign concept. IAM stands for Identity Account Management. This allows you to build security policies for individuals, services, and the different types of accounts (root, master, federate). Here is a brief video that may be helpful to understand these concepts.", "Oftentimes, you will be doing the grunt work on your local machine. You will then want to talk with the AWS console without going into the front-end. Later on you will be pushing your container image to ECR (an AWS Service) via the command line. So, be sure to complete this step. See the documentation from AWS here.", "Navigate to the ECR (Elastic Container Registry) service in the AWS console. Select the \u201cCreate a Repository\u201d in orange and get started with the settings. I leave all of the defaults and add a name for my repository, which I have named as lambda_dependencies.", "If your repository has been set up correctly, you will see the lambda_dependencies repository appear in the repository list.", "You will now need to set up the correct permissions for this repository. As of right now, this repository doesn\u2019t have access to anything and nothing has access to it. This is a great example of how IAM rules work. Click into your newly created repository and you will see a permissions option under your repository.", "You can then add a policy statement via the console or with the policy JSON at the top. You will be able to select the IAM entities you want to grant permission to this repository. The actions section below the IAM entities will need to be set up correctly.", "These actions are what allows you to be able to push your docker image to the cloud. See image below for an idea of what it needs to look like. The lambdaECRImageRetrievalPolicy was created from the IAM service.", "Here is an example of the policy in JSON format. **I have removed my AWS entities because yours will differ.", "Now, we are ready to build our custom built container image using docker. To display an example of package dependencies greater than 250 MB, we will be building a data science container built with python that installs xgboost and scikit-learn. If you do not already have docker installed, here is the link to get started.", "There are two main components to building a docker image for a lambda.", "You will want these files in the same folder. Feel free to use the files below to get started.", "Once you have both files saved, open up your command line (powershell, bash, linux) and \u201ccd\u201d to where these files are located. Once there, open up ECR in the AWS console and open your repository that you created earlier. In the top right hand corner click on \u201cview push commands\u201d", "Follow each of these commands in the order presented. The second command will take a while because it is building your container image. The fourth command will also take a while because it is pushing the container image to the cloud and has to build all layers of the image.", "After completing this step, refresh the ECR page and check to see if your image made it.", "Now that your container image is all set up, head over to the lambda service in the AWS console and create a new function.", "You will select the container image option and name your function however you would like. After you have named your function, you will select the container image you just completed building.", "Leave the container image overrides blank for the time being. We have set the Entrypoint and CMD in the dockerfile already. However, there will come a time when this will be handy.", "It will take a minute to create the function. Once the bar on the top turns green, you will need to configure a few things.", "First, configure your test event in the top right. The hello-world test will do the trick. Just put a name on it and save it.", "Second, dependent on the code you are trying to run, you may need to increase the timeout and memory for the lambda in basic settings. See below.", "I would start with 300 MB and 30 sec timeout. Feel free to adjust this per your needs.", "Finally, run your test and let\u2019s see if our first lambda function works, running off of our container image we built. Our prediciton.py file, right now, is just checking the versions of xgboost, scikit-learn, and pandas.", "Once you have a container image you are happy with, you can add new lambdas and edit old ones quickly without having to rebuild your container image. Note: if you add any new package dependencies, you will have to rebuild your container.", "We will first edit our first lambda, prediction.py by adding another message to display.", "Second, let\u2019s create a new lambda function that says hello world and what version of python we are running, to show how it works.", "Now that we have our new and updated files, open up docker desktop and find the docker image you built on your local machine. Select run and name your container file_update.", "Head over to your command line and type in the following commands.", "Note: You will need the information displayed here for the next steps.", "Next, you will use the copy docker command to copy a local file on your machine into a docker container. The docker container we just ran is named file_update. We then do file_update:/function/ to tell it where to put the new file in our docker container. (refer back to the dockerfile)", "***Here is some additional documentation from docker if you get lost", "Next we need to commit the changes we have made to this container to our docker image. We will need the containerID from when we ran the first command (docker ps -a) and our original image name and the tag (lambda_dependencies:latest)", "Your image now has the updated predictions.py and the new hello_world.py. The last two commands are familiar. We just need to tag and push the repo to send to AWS.", "Now it\u2019s time to test our lambda functions.", "You will need to deploy the new image that you just pushed to ECR.", "Find the latest version of the image and wait for it to build. Once it has finished building, test the lambda. This first test will check to see if our updated predictions.py has the extra line of text in the message.", "Our next test is to call the hello_world.py lambda instead of the predictions.py lambda. We can do this simply by changing the CMD within the image configuration on the lambda. See below.", "All we need to add is hello_world.handler to our image configuration and save.", "We have now successfully added and edited two lambda functions with the same docker image. This means that you can build out all of your lambda functions under the same docker image if you would like to.", "Combining container images with lambda functions in AWS is powerful. The deployment limitations have been obliterated by this announcement, opening up the doors to limitless creations and exploration \u2014 or at least up to 10 GB worth. ;)", "I hope that this step-by-step guide pushes you one step closer to the problem you are attempting to solve. I realize that this guide is not perfect and that there are countless ways to set up a lambda with a container image; however, this is what made the most sense to me and I hope it has helped you in some way.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fcec62deaf0e9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://mcklayne.medium.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": ""}, {"url": "https://mcklayne.medium.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "McKlayne Marshall"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F94383faa7cb4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&user=McKlayne+Marshall&userId=94383faa7cb4&source=post_page-94383faa7cb4----cec62deaf0e9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/u/d7a7f01c81e3?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Isaac Rhea"}, {"url": "https://medium.com/u/f8bcb330ac60?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Cody Crofoot"}, {"url": "https://aws.amazon.com/blogs/aws/aws-reinvent-announcements-2020/", "anchor_text": "here"}, {"url": "https://unsplash.com/@helloimnik?utm_source=medium&utm_medium=referral", "anchor_text": "Hello I'm Nik \ud83c\udf9e"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/", "anchor_text": "documentation"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/welcome.html", "anchor_text": "lambda function"}, {"url": "https://www.docker.com/resources/what-container", "anchor_text": "container image"}, {"url": "https://portal.aws.amazon.com/billing/signup?nc2=h_ct&src=default&redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start", "anchor_text": "AWS"}, {"url": "https://docs.aws.amazon.com/general/latest/gr/root-vs-iam.htmlhttps://docs.aws.amazon.com/general/latest/gr/root-vs-iam.html", "anchor_text": "here"}, {"url": "https://www.youtube.com/watch?v=GjVFf83dcE8", "anchor_text": "Here"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html", "anchor_text": "here"}, {"url": "https://docs.docker.com/desktop/", "anchor_text": "here"}, {"url": "https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/", "anchor_text": "New for AWS Lambda \u2014 Container Image Support | AWS News Blog (amazon.com)"}, {"url": "https://docs.docker.com/engine/reference/commandline/cp/", "anchor_text": "Here"}, {"url": "https://medium.com/tag/data-science?source=post_page-----cec62deaf0e9---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/aws?source=post_page-----cec62deaf0e9---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/cloud-computing?source=post_page-----cec62deaf0e9---------------cloud_computing-----------------", "anchor_text": "Cloud Computing"}, {"url": "https://medium.com/tag/python?source=post_page-----cec62deaf0e9---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/docker?source=post_page-----cec62deaf0e9---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&user=McKlayne+Marshall&userId=94383faa7cb4&source=-----cec62deaf0e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&user=McKlayne+Marshall&userId=94383faa7cb4&source=-----cec62deaf0e9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fcec62deaf0e9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----cec62deaf0e9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----cec62deaf0e9--------------------------------", "anchor_text": ""}, {"url": "https://mcklayne.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://mcklayne.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "McKlayne Marshall"}, {"url": "https://mcklayne.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "544 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F94383faa7cb4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&user=McKlayne+Marshall&userId=94383faa7cb4&source=post_page-94383faa7cb4--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F25e265ca0fd2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-build-an-aws-lambda-for-data-science-cec62deaf0e9&newsletterV3=94383faa7cb4&newsletterV3Id=25e265ca0fd2&user=McKlayne+Marshall&userId=94383faa7cb4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}