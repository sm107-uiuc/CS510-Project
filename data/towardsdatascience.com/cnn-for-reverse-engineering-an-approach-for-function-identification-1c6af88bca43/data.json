{"url": "https://towardsdatascience.com/cnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43", "time": 1683005835.553967, "path": "towardsdatascience.com/cnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43/", "webpage": {"metadata": {"title": "CNN for Reverse Engineering: an Approach for Function Identification | by Alon Stern | Towards Data Science", "h1": "CNN for Reverse Engineering: an Approach for Function Identification", "description": "Before deploying binaries to third party environments, it is very common to strip the binaries from any information that is not required for them to function properly. This is done to make reverse\u2026"}, "outgoing_paragraph_urls": [{"url": "https://people.eecs.berkeley.edu/~dawnsong/papers/Recognizing%20functions%20in%20binaries%20with%20neural%20networks_augsut%202015.pdf", "anchor_text": "Recognizing Functions in Binaries with Neural Networks", "paragraph_index": 2}, {"url": "https://www.usenix.org/system/files/conference/usenixsecurity14/sec14-paper-bao.pdf", "anchor_text": "ByteWeight: Learning to Recognize Functions in Binary Code", "paragraph_index": 14}, {"url": "http://security.ece.cmu.edu/byteweight/", "anchor_text": "http://security.ece.cmu.edu/byteweight", "paragraph_index": 15}], "all_paragraphs": ["Before deploying binaries to third party environments, it is very common to strip the binaries from any information that is not required for them to function properly. This is done to make reverse engineering of the binary more difficult. Some of the information that is erased from the binary is the boundaries of each function. For someone who wants to reverse engineer a binary this information can be extremely useful.", "Function identification is a task in the reverse engineering field where given a compiled binary, one should determine the addresses of the boundaries of each function. Boundries of a function are the start address and the end address of the function.", "The idea of using neural networks for function identification is not new. It was first introduced in a paper called Recognizing Functions in Binaries with Neural Networks written by Eui et al. The authors used a bidirectional RNN for learning the function boundaries. According to their paper, they not only achieved similar or better results relative to the former state of the art but also reduced the computation time from 587 hours to 80 hours. I think this research really demonstrates the power of neural networks.", "CNN (Convolutional Neural Network) is highly popular in tasks regarding computer vision. One of the reasons is that CNN can only capture local features.", "Local features describe the input patches (key points in the input). For example, for an image, it can be any feature regarding a specific area in the image such as a point or an edge.", "Global features are features that describe the input as a whole.", "RNN, on the other hand, is a \u201cstronger\u201d model in the sense that it can learn both local and global features.", "But stronger is not always better. Using a model capable of learning both local and global features for a task that requires learning only local features, might lead to overfitting and increase the training time.", "For function identification it is enough, for each byte in the binary, to look at the 10 bytes before it and 10 bytes after it to determine if it is a start or a stop of a function. This property makes it seems a CNN is supposed to achieve good results for this task. With that being said, there are global features that can help to determine the boundaries of the function. For example, call opcodes can help us determine the start of a function. However, even RNN will have a hard time learning those features as RNN does not perform well on long sequences (that is why in the Eui et al. paper they train their network with a random 1000 bytes sequence from the binary and not the whole binary).", "In addition, unlike RNN which is a sequential model, CNN can be run in parallel which means both training and testing the network are supposed to be faster.", "We are done with the introduction. Let\u2019s code!", "The code is implemented in Python3.6 using PyTorch library.", "For simplicity, we are going to implement a model that identifies the beginning of each function, but the same code can be applied to identify the ending as well.", "The full code is available here:", "We are going to use the same dataset Eui et al. used in their paper.The dataset was originally created for a paper called ByteWeight: Learning to Recognize Functions in Binary Code. Eui et al. used the same dataset to compare their results to the results reported in the original paper.", "The dataset is available at http://security.ece.cmu.edu/byteweightThe dataset consists of a set of binaries compiled with debug information.", "We are going to use the elf_32 dataset but the same code can be applied also for the elf_64 dataset (and the PE_dataset, but that will require different debug info parsing procedure).", "The dataset can be downloaded by running:", "First, we need to extract from each binary its code section and its function addresses.", "Elf files are composed of sections. Each section contains different information. The sections we are interested in are the .text section and the .symtab section.", "Note that the information in the .symtab section can be stripped from the binary. This project is useful for those cases.", "For parsing the sections in the binaries we are going to use Pyelftools library.", "First, let\u2019s extract the .text section data", "For each byte in the code of the binary, we need to extract whether it is a start of a function.", "Now let\u2019s iterate over the binaries in our dataset.We will use tqdm library to make a nice progress bar for our preprocessing with zero effort!", "Great! We have our data and its tags.", "To feed the data into the model we should not just feed it file by file. Instead, we should determine the size of the data we would like to train the model with each time and split our data into blocks with that size.", "Also, if we want a CNN to output a vector with the size of tags, we need to pad the input according to the CNN kernel size.", "Let\u2019s wrap it up under a torch.utils.data.Dataset class:", "The input of the model is going to be a vector where each value is between 0 to 257 (0\u2013255 for the byte value, 256 is a symbol for a start of a file and 257 is a symbol for an end of a file). The output of the model is going to a matrix where each row contains two values \u2014 the probability of a byte to be a start of a function and the probability to not be a start of a function (the values are summed to 1).", "Since every byte value represents a different symbol we would like to convert every value to a vector. The way to do so is to use an embedding layer.", "After the embedding layer, we are ready to add the convolution layer with Relu activation function. Notice we want the convolution to work on whole bytes so the kernel size should be: the number of bytes we want to look at X the size of each byte (the output dimension of the embedding layer).", "Now we add a fully connected output layer with softmax activation function.", "First, we need to split the data to train and test. We are going to use 90% of the data for training and 10% for testing.", "Now, to create the model we can simply instantiate CNNModel", "For the training, we are going to use the Negative Log-Likelihood loss function with Adam optimizer. Again, we add the tqdm for a nice progress bar for our training.", "For the testing, we look at four parameters. accuracy, precision, recall, and f-score.", "Accuracy alone would be insufficient for measuring the performance for this task since most of the bytes are not a start of a function. Therefore even a model that would classify everything as \u201cnot a start of a function\u201d would get high accuracy.", "I trained and tested the model on my personal laptop with Intel(R) Core(TM) i7\u20137500U CPU @ 2.70GHz and 16 GB ram.", "Preprocessing the whole data took 43 seconds.Training the model on 90% of the dataset took 33 minutes and 43 seconds.Testing the model on the remaining 10% took 24 seconds.", "Eui et al reported in their paper the training time were 2 hours for each model. Our training took almost a quarter of the time!", "The results on the test set:", "The best model to classify the start address of the functions reported in Eui et al. paper achieved an f1 score of 99.24%.", "So there it is, a CNN network that can find the start of each function in a binary. This was the first medium article I have written. Hope you liked it! For more information/questions, feel free to contact me.", "[1] E. C. R. Shin, D. Song, and R. Moazzezi. Recognizing Functions in Binaries with Neural Networks (2015). In Proceedings of the 24th USENIX Security Symposium.", "[2] T. Bao, J. Burket, M. Woo, R. Turner, and D. Brumley. BYTEWEIGHT: Learning to Recognize Functions in Binary Code (2014). In Proceedings of the 23rd USENIX Security Symposium.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1c6af88bca43&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@alon.stern206?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.stern206?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Alon Stern"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa35ba213dad2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&user=Alon+Stern&userId=a35ba213dad2&source=post_page-a35ba213dad2----1c6af88bca43---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://people.eecs.berkeley.edu/~dawnsong/papers/Recognizing%20functions%20in%20binaries%20with%20neural%20networks_augsut%202015.pdf", "anchor_text": "Recognizing Functions in Binaries with Neural Networks"}, {"url": "https://github.com/alonstern/function-identification?", "anchor_text": "alonstern/function-identificationContribute to alonstern/function-identification development by creating an account on GitHub.github.com"}, {"url": "https://www.usenix.org/system/files/conference/usenixsecurity14/sec14-paper-bao.pdf", "anchor_text": "ByteWeight: Learning to Recognize Functions in Binary Code"}, {"url": "http://security.ece.cmu.edu/byteweight/", "anchor_text": "http://security.ece.cmu.edu/byteweight"}, {"url": "http://security.ece.cmu.edu/byteweight/elf_32/", "anchor_text": "http://security.ece.cmu.edu/byteweight/elf_32"}, {"url": "https://towardsdatascience.com/neural-network-embeddings-explained-4d028e6f0526", "anchor_text": "Neural Network Embeddings ExplainedHow deep learning can represent War and Peace as a vectortowardsdatascience.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1c6af88bca43---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/reverse-engineering?source=post_page-----1c6af88bca43---------------reverse_engineering-----------------", "anchor_text": "Reverse Engineering"}, {"url": "https://medium.com/tag/programming?source=post_page-----1c6af88bca43---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----1c6af88bca43---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----1c6af88bca43---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&user=Alon+Stern&userId=a35ba213dad2&source=-----1c6af88bca43---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&user=Alon+Stern&userId=a35ba213dad2&source=-----1c6af88bca43---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1c6af88bca43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1c6af88bca43---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1c6af88bca43--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1c6af88bca43--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1c6af88bca43--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.stern206?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@alon.stern206?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alon Stern"}, {"url": "https://medium.com/@alon.stern206/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "13 Followers"}, {"url": "http://M.Sc", "anchor_text": "M.Sc"}, {"url": "https://www.linkedin.com/in/alon-stern-695576144", "anchor_text": "https://www.linkedin.com/in/alon-stern-695576144"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa35ba213dad2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&user=Alon+Stern&userId=a35ba213dad2&source=post_page-a35ba213dad2--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa35ba213dad2%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcnn-for-reverse-engineering-an-approach-for-function-identification-1c6af88bca43&user=Alon+Stern&userId=a35ba213dad2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}