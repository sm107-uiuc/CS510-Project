{"url": "https://towardsdatascience.com/transfer-learning-with-pyspark-729d49604d45", "time": 1682997379.450185, "path": "towardsdatascience.com/transfer-learning-with-pyspark-729d49604d45/", "webpage": {"metadata": {"title": "Multi-Class Image Classification With Transfer Learning In PySpark | by Innat | Towards Data Science", "h1": "Multi-Class Image Classification With Transfer Learning In PySpark", "description": "In this article, We\u2019ll be using Keras (TensorFlow backend), PySpark, and Deep Learning Pipelines libraries to build an end-to-end deep learning computer vision solution for a multi-class image\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.databricks.com/applications/deep-learning/single-node-training/deep-learning-pipelines.html", "anchor_text": "Deep Learning Pipelines", "paragraph_index": 1}, {"url": "https://spark.apache.org/mllib/", "anchor_text": "Spark MLlib", "paragraph_index": 1}, {"url": "https://gist.github.com/innat/b0ab252c954eb2a28a984774e3ee1f2d", "anchor_text": "installation instruction", "paragraph_index": 1}, {"url": "https://github.com/innat/Transfer-Learning-PySpark", "anchor_text": "GitHub", "paragraph_index": 3}, {"url": "https://arxiv.org/abs/1512.00567", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Numerical_digit", "anchor_text": "numerical digits", "paragraph_index": 8}, {"url": "https://arxiv.org/abs/1806.02452", "anchor_text": "NumtaDB", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Confusion_matrix", "anchor_text": "confusion matrix", "paragraph_index": 20}, {"url": "https://medium.com/@plog397/auc-roc-curve-scoring-function-for-multi-class-classification-9822871a6659", "anchor_text": "h", "paragraph_index": 24}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet", "paragraph_index": 27}, {"url": "https://github.com/innat", "anchor_text": "GitHub", "paragraph_index": 30}, {"url": "http://innat1994@gmail.com", "anchor_text": "Email", "paragraph_index": 32}, {"url": "https://www.linkedin.com/in/innat2k14/", "anchor_text": "LinkedIn", "paragraph_index": 32}, {"url": "https://www.quora.com/profile/Mohammed-Innat#", "anchor_text": "Quora", "paragraph_index": 32}, {"url": "https://github.com/innat", "anchor_text": "GitHub", "paragraph_index": 32}, {"url": "https://twitter.com/innat_2k14", "anchor_text": "Twitter", "paragraph_index": 32}, {"url": "https://www.instagram.com/i_innat/", "anchor_text": "Instagram", "paragraph_index": 32}], "all_paragraphs": ["In this article, We\u2019ll be using Keras (TensorFlow backend), PySpark, and Deep Learning Pipelines libraries to build an end-to-end deep learning computer vision solution for a multi-class image classification problem that runs on a Spark cluster. Spark is a robust open-source distributed analytics engine that can process large amounts of data with great speed. PySpark is the Python API for Spark that allows us to use Python programming language and leverage the power of Apache Spark.", "In this article, we\u2019ll be using majorly Deep Learning Pipelines(DLP) which is a high-level Deep Learning framework that facilitates common Deep Learning workflows via the Spark MLlib Pipelines API. It currently supports TensorFlow and Keras with the TensorFlow backend. In this article, We\u2019ll be using this DLP to build a multi-class image classifier that will run on the Spark cluster. To get everything set up, please follow this installation instruction.", "The library comes from Databricks and leverages Spark for its two strongest facets:", "My goal is to integrate Deep Learning into the PySpark pipeline with the DLP. I\u2019m running the entire project using Jupyter Notebook on my local machine to build the prototype. However, I found it a bit difficult to put together this prototype so I hope others will find this article useful. I\u2019ll break down this project into a few steps. Some of the steps will be self-explanatory, but for others, I\u2019ll try to explain as possible to make it painless. If you want to see just the notebook with explanations and code you can go directly to GitHub.", "Transfer learning is a technique in machine learning in general that focuses on saving knowledge (weights and biases) gained while solving one problem and further applying it to a different but related problem.", "Deep Learning Pipelines provide utilities to perform transfer learning on the images, which is one of the fastest ways to start using deep learning. With the concept of a Featurizer, Deep Learning Pipelines enable fast transfer learning on Spark-Cluster. Right now it provides the following neural nets for Transfer Learning:", "For demonstration purposes, we\u2019ll work only on the InceptionV3 model. You can read the technical details of this model here.", "The following example combines the InceptionV3 model and multinomial logistic regression in Spark. A utility function from Deep Learning Pipelines called DeepImageFeaturizer automatically peels off the last layer of a pre-trained neural network and uses the output from all the previous layers as features for the logistic regression algorithm.", "The Bengali script has ten numerical digits (graphemes or symbols indicating the numbers from 0 to 9). Numbers larger than 9 are written in Bengali using a positional base 10 numeral system.", "We choose NumtaDB as a source of our dataset. It\u2019s a collection of Bengali Handwritten Digit data. The dataset contains more than 85,000 digits from over 2,700 contributors. But here we\u2019re not planning to work on the whole data set rather than choose randomly 50 images of each class.", "Let\u2019s look below what we\u2019ve inside each above ten folders. I rename each image shown below of its corresponding class label for demonstration purposes.", "At first, we load all the images to SparkData Frame. Then we build the model and train it. After that, we\u2019ll evaluate the performance of our trained model.", "The data sets (from 0 to 9) contain almost 500 handwritten Bangla digits (50 images each class). Here we manually load each image into a spark data frame with a target column. After loading the whole dataset we split into an 8:2 ratio randomly for the training set and final test set.", "Our goal is to train the model with the training data set and finally evaluate the model\u2019s performance with the test dataset.", "Here we can perform various Exploratory Data Analyses on Spark DataFrame. We can also view the schema of the data frame too.", "We can also convert Spark-DataFrame to Pandas-DataFrame using .toPandas().", "Here we combine the InceptionV3 model and logistic regression in Spark. The DeepImageFeaturizer automatically peels off the last layer of a pre-trained neural network and uses the output from all the previous layers as features for the logistic regression algorithm.", "Since logistic regression is a simple and fast algorithm, this transfer learning training can converge quickly.", "Now, It\u2019s time to evaluate model performance. We now like to evaluate four evaluation metrics such as F1-score, Precision, Recall, and Accuracy on the test data set.", "Here we get the result. It\u2019s promising until now.", "Here, we\u2019ll summarize the performance of a classification model using the confusion matrix.", "For this, we need to convert Spark-DataFrame to Pandas-DataFrame first and then call Confusion Matrix with true and predicted labels.", "Here we can also get a report on the classification of each class by the evaluation matrix.", "It\u2019ll demonstrate much better the model performance for each class label prediction.", "Let\u2019s also find the ROC AUC score point of this model. I\u2019ve found the following piece of code from here.", "Let\u2019s see some of its predictions, in comparison with the real label.", "And, the result would be as follows", "Though we\u2019ve used an ImageNet weight our model performs pretty much promising to recognize handwritten digits. Moreover, we didn\u2019t also perform any image processing tasks for better generalization. Also, the model is trained on very few amounts of data compared to the ImageNet dataset.", "At a very high level, each Spark app consists of a driver program that launches various parallel operations on a cluster. The driver program contains our apps\u2019 main function and defines distributed datasets on the cluster, then applies operations to them.", "This is a standalone application where we\u2019ve linked the application to Spark first and then we imported the Spark packages in our program and create a SparkContext using SparkSession. Though we\u2019ve worked on a single machine, we can connect the same shell to a cluster to train data in parallel.", "However, you can get the source code of today\u2019s demonstration from the link below and can also follow me on GitHub for future code updates. :)", "Next, We\u2019ll do Distributed Hyperparameter Tuning with Spark, and will try the custom Keras model and some new challenging examples. Get in touch :)", "Say Hi On: Email | LinkedIn | Quora | GitHub | Twitter | Instagram", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AI Software Engineer @ AI Samurai Japan Ltd."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F729d49604d45&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://innat-2k14.medium.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": ""}, {"url": "https://innat-2k14.medium.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Innat"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7d2fd3db33b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&user=Innat&userId=e7d2fd3db33b&source=post_page-e7d2fd3db33b----729d49604d45---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pixabay"}, {"url": "https://www.pexels.com/photo/close-up-of-a-book-over-white-background-256424/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels", "anchor_text": "Pexels"}, {"url": "https://docs.databricks.com/applications/deep-learning/single-node-training/deep-learning-pipelines.html", "anchor_text": "Deep Learning Pipelines"}, {"url": "https://spark.apache.org/mllib/", "anchor_text": "Spark MLlib"}, {"url": "https://gist.github.com/innat/b0ab252c954eb2a28a984774e3ee1f2d", "anchor_text": "installation instruction"}, {"url": "https://docs.databricks.com/applications/deep-learning/single-node-training/deep-learning-pipelines.html", "anchor_text": "Deep Learning Pipelines \u2014 Databricks DocumentationThe Deep Learning Pipelines library is included in Databricks Runtime ML, a machine learning runtime that provides a\u2026docs.databricks.com"}, {"url": "https://spark.apache.org/mllib/", "anchor_text": "Spark MLlib"}, {"url": "https://github.com/innat/Transfer-Learning-PySpark", "anchor_text": "GitHub"}, {"url": "https://arxiv.org/abs/1512.00567", "anchor_text": "here"}, {"url": "https://en.wikipedia.org/wiki/Numerical_digit", "anchor_text": "numerical digits"}, {"url": "https://arxiv.org/abs/1806.02452", "anchor_text": "NumtaDB"}, {"url": "https://en.wikipedia.org/wiki/Confusion_matrix", "anchor_text": "confusion matrix"}, {"url": "https://medium.com/@plog397/auc-roc-curve-scoring-function-for-multi-class-classification-9822871a6659", "anchor_text": "h"}, {"url": "http://www.image-net.org/", "anchor_text": "ImageNet"}, {"url": "https://github.com/innat", "anchor_text": "GitHub"}, {"url": "https://github.com/innat/Transfer-Learning-PySpark", "anchor_text": "innat/Transfer-Learning-PySparkA promising solution for a Computer Vision problem with the power to combine state-of-the-art technologies: Deep\u2026github.com"}, {"url": "http://innat1994@gmail.com", "anchor_text": "Email"}, {"url": "https://www.linkedin.com/in/innat2k14/", "anchor_text": "LinkedIn"}, {"url": "https://www.quora.com/profile/Mohammed-Innat#", "anchor_text": "Quora"}, {"url": "https://github.com/innat", "anchor_text": "GitHub"}, {"url": "https://twitter.com/innat_2k14", "anchor_text": "Twitter"}, {"url": "https://www.instagram.com/i_innat/", "anchor_text": "Instagram"}, {"url": "https://github.com/maxpumperla/elephas?source=post_page---------------------------", "anchor_text": "Elephas"}, {"url": "https://github.com/intel-analytics/BigDL", "anchor_text": "BigDL"}, {"url": "https://github.com/yahoo/TensorFlowOnSpark", "anchor_text": "TensorFlowOnSpark"}, {"url": "https://docs.databricks.com/applications/deep-learning/index.html", "anchor_text": "Deep Learning Guide"}, {"url": "https://spark.apache.org/docs/latest/api/python/index.html", "anchor_text": "PySpark Machine Learning"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----729d49604d45---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/python?source=post_page-----729d49604d45---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----729d49604d45---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/transfer-learning?source=post_page-----729d49604d45---------------transfer_learning-----------------", "anchor_text": "Transfer Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----729d49604d45---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&user=Innat&userId=e7d2fd3db33b&source=-----729d49604d45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&user=Innat&userId=e7d2fd3db33b&source=-----729d49604d45---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F729d49604d45&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----729d49604d45---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----729d49604d45--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----729d49604d45--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----729d49604d45--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----729d49604d45--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----729d49604d45--------------------------------", "anchor_text": ""}, {"url": "https://innat-2k14.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://innat-2k14.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Innat"}, {"url": "https://innat-2k14.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "38 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7d2fd3db33b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&user=Innat&userId=e7d2fd3db33b&source=post_page-e7d2fd3db33b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff1dd70601e67&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftransfer-learning-with-pyspark-729d49604d45&newsletterV3=e7d2fd3db33b&newsletterV3Id=f1dd70601e67&user=Innat&userId=e7d2fd3db33b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}