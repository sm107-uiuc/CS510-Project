{"url": "https://towardsdatascience.com/how-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d", "time": 1683017784.045105, "path": "towardsdatascience.com/how-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d/", "webpage": {"metadata": {"title": "How could I do simple inference on my Fine-Tuned Transformers NER models? | by Martin Keywood | Towards Data Science", "h1": "How could I do simple inference on my Fine-Tuned Transformers NER models?", "description": "I had done it in the wonderful scispaCy package, and even in Transformers via the amazing Simple Transformers, but I wanted to do it in the raw HuggingFace Transformers package. Why? I had it working\u2026"}, "outgoing_paragraph_urls": [{"url": "https://allenai.github.io/scispacy/", "anchor_text": "scispaCy", "paragraph_index": 1}, {"url": "https://simpletransformers.ai/", "anchor_text": "Simple Transformers", "paragraph_index": 1}, {"url": "https://huggingface.co/transformers/", "anchor_text": "HuggingFace Transformers", "paragraph_index": 1}, {"url": "https://github.com/cambridgeltl/MTL-Bioinformatics-2016/tree/master/data/BC5CDR-IOB", "anchor_text": "BC5CDR", "paragraph_index": 11}], "all_paragraphs": ["I knew what I wanted to do. I wanted to generate NER in a biomedical domain.", "I had done it in the wonderful scispaCy package, and even in Transformers via the amazing Simple Transformers, but I wanted to do it in the raw HuggingFace Transformers package.", "Why? I had it working in scispaCy out the box with their pre-trained models, and in Simple Transformers with only a couple of lines of code and some preprocessing of data, so wasn\u2019t that enough?", "Of course not. I wanted to understand \u2018how\u2019 it worked. How to do it myself in Transformers, and then push the boundaries of what I could do.", "I found so so many examples of how to train and / or fine-tune a Transformer model.", "By a lot of experimenting and dark magic I was able to make some sense of the preprocessing of the data and \u2018thought\u2019 I had it right. After all, I had a model that trained. The loss going down sensibly. Awesome. Done, right?", "Sadly, not. I want to use that model. Easily and sensibly. So how do I do simple inference on the model?", "In Simple Transformers I could just call something: model.predict([\"the text I was to predict on\"]) and get my predictions back. No preprocessing the text and just so, well, simple. I guess that's why it was called Simple Transformers :)", "Most other ML libraries I had used in the past (sklearn, fast.ai, etc) all had something similar. a \u2018predict\u2019 method on the model.", "And trying to figure out how to do this in raw Transformers was where my problems started :(", "OK so firstly I needed some data.", "I thought I\u2019d start with a well understood Biomedical NER dataset, BC5CDR, and a little Pre-Processing to get the data into a format to make it easier to manipulate the sentences.", "Firstly make sure everything is installed, and define some defaults settings that will help. (note: a lot of the Train section here was inspired by the wonderful run_ner example in Transformers)", "OK so let\u2019s load the data and create some simple lookups of the associated labels.", "Load the pre-trained model and tokenizer.", "We are doing \u2018max length\u2019 padding and need a little helper function to Tokenize all texts and align the labels with them.", "The words are already separated into \u2018tokens\u2019 aren\u2019t they? One per line, with a label for each word? We can just use those by passing in is_split_into_words = True and it's all fine, right?", "On the surface that seems true, however given the tokenizer is based on the model, and it may be a Byte Pair Encoding Tokenizer (extremely likely) then the words are potentially split further.", "So regardless of the special tokens, the number of tokens goes from 21 to 29 in this example. And so the labels need to be rejigged to continue to align with the base words.", "Use tried and tested methods to split into train / val sets, and use those to generate some Transformer Datasets, ensuring we make them all Tensors along the way.", "Not bad after only 1 epoch :)", "And this was where my problems started.", "I could find nothing, nada, zero, nowt, zilch that could explain to me \u2018simply\u2019 how to do it.", "There was no predict method on the model. The predict method on the Trainer just made no sense to me and required DataSets creating and I wanted to do inference on just a single string: \u201cheart disease, a new house, a dose of penicillin, and bowel cancer. The diagnosis of COPD, a flashy new car and a skin rash.\u201d", "Was it badly written Transformers libraries? Not at all. It\u2019s amazing.", "Was it me just me being daft? Not enough coffee? Yeah I think so. One thing that was clear was it was \u2018user error\u2019 and when I finally discovered the answer I kicked myself:", "Well that is just amazing. I mean, mind blowingly ace :) It\u2019s picked out the diseases and the medication (chemicals).", "And it got better. I could misspell \u2018cancer\u2019 as \u2018canrce\u2019, or \u2018bowel\u2019 as \u2018bowl\u2019 and it still found it.", "This was all really exciting for me and has opened up the door to me exploring a lot more in this area.", "My hope is this will help someone else in a similar situation and a similar stage on their NLP journey, where they follow all the tutorials to train and fine-tune and then say \u2018now what? how do I use it\u2019 :) That\u2019s certainly where I was.", "And if you\u2019re interested and like it, please let me know and I will be sure to write up future experiments too :)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science, Machine Learning and LLMs are hugely exciting, enabling better data understanding to see beyond the obvious & help make decisions & help patients."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe074da3a5a9d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@martinkeywood?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinkeywood?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Martin Keywood"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F48fb893c4d60&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&user=Martin+Keywood&userId=48fb893c4d60&source=post_page-48fb893c4d60----e074da3a5a9d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://freeimages.com/photographer/svilen001-32617", "anchor_text": "Svilen Milev"}, {"url": "https://freeimages.com/", "anchor_text": "FreeImages"}, {"url": "https://allenai.github.io/scispacy/", "anchor_text": "scispaCy"}, {"url": "https://simpletransformers.ai/", "anchor_text": "Simple Transformers"}, {"url": "https://huggingface.co/transformers/", "anchor_text": "HuggingFace Transformers"}, {"url": "https://github.com/cambridgeltl/MTL-Bioinformatics-2016/tree/master/data/BC5CDR-IOB", "anchor_text": "BC5CDR"}, {"url": "https://medium.com/tag/transformers?source=post_page-----e074da3a5a9d---------------transformers-----------------", "anchor_text": "Transformers"}, {"url": "https://medium.com/tag/nlp?source=post_page-----e074da3a5a9d---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/tag/named-entity-recognition?source=post_page-----e074da3a5a9d---------------named_entity_recognition-----------------", "anchor_text": "Named Entity Recognition"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e074da3a5a9d---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e074da3a5a9d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&user=Martin+Keywood&userId=48fb893c4d60&source=-----e074da3a5a9d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&user=Martin+Keywood&userId=48fb893c4d60&source=-----e074da3a5a9d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe074da3a5a9d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e074da3a5a9d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e074da3a5a9d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinkeywood?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@martinkeywood?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Martin Keywood"}, {"url": "https://medium.com/@martinkeywood/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "14 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F48fb893c4d60&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&user=Martin+Keywood&userId=48fb893c4d60&source=post_page-48fb893c4d60--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F191f830baded&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-could-i-do-simple-inference-on-my-fine-tuned-transformers-ner-models-e074da3a5a9d&newsletterV3=48fb893c4d60&newsletterV3Id=191f830baded&user=Martin+Keywood&userId=48fb893c4d60&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}