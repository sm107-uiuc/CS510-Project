{"url": "https://towardsdatascience.com/fast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33", "time": 1683004324.626899, "path": "towardsdatascience.com/fast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33/", "webpage": {"metadata": {"title": "Fast & Asynchronous in Python. Accelerate Your Requests Using asyncio | by Dylan Castillo | Towards Data Science", "h1": "Fast & Asynchronous in Python", "description": "Speedup your Python code by learning how to make concurrent requests to an API using asyncio and aiohttp."}, "outgoing_paragraph_urls": [{"url": "https://dylancastillo.co/mind-reading-algorithms-an-introduction-to-recommender-systems/", "anchor_text": "content-based recommender", "paragraph_index": 0}, {"url": "https://github.com/andrewsayre/pysmartthings/issues/20", "anchor_text": "some small changes", "paragraph_index": 6}, {"url": "https://realpython.com/async-io-python/", "anchor_text": "Async IO in Python", "paragraph_index": 27}, {"url": "https://realpython.com/python-concurrency", "anchor_text": "Speed Up Your Python Program With Concurrency", "paragraph_index": 27}, {"url": "https://2.python-requests.org/en/v1.1.0/user/advanced/", "anchor_text": "here", "paragraph_index": 29}, {"url": "http://www.dabeaz.com/coroutines/Coroutines.pdf", "anchor_text": "A Curious Course on Couroutines and Concurrency", "paragraph_index": 30}, {"url": "https://dylancastillo.co/", "anchor_text": "https://dylancastillo.co/", "paragraph_index": 32}], "all_paragraphs": ["A few weeks ago, I was working on a Python script to extract books\u2019 metadata for a content-based recommender. After a couple of hours, I realized that I needed to make thousands of requests to the Google Books API to get the data. So I thought there had to be a way of speeding up the process.", "As I enjoy learning, especially when it\u2019s also a chance of procrastinating on my goals, I decided to build a project using asyncio. Afterward, feeling guilty for the time wasted, I decided to write this tutorial with what I learned in the process.", "This article aims to provide the basics of how to use asyncio for making asynchronous requests to an API. I focus mostly on the actual code and skip most of the theory (besides the short introduction below). However, if you are looking for a more in-depth introduction to asyncio, check the recommendations in the references\u00b9.", "asyncio is a Python library that allows you to execute some tasks in a seemingly concurrent\u00b2 manner. It is commonly used in web-servers and database connections. It is also useful for speeding up IO-bound tasks, like services that require making many requests or do lots of waiting for external APIs\u00b3.", "The essence of asyncio is that it allows the program to continue executing other instructions while waiting for specific processes to finish (e.g., a request to an API). In this tutorial, we will see how to use asyncio for accelerating a program that makes multiple requests to an API.", "So let\u2019s get down to business. To get the most out of this tutorial, try running the code yourself. These code snippets have been tested with Python 3.8.3. You can try running them with a more recent version, but they might require some small changes.", "Before running the code, you need to install the required libraries: requests, and aiohttp. Then, you can run the code snippets below in a Jupyter Notebook. If you\u2019d like to run the snippets using a Python script, you\u2019ll need to do some small changes to get it working.", "We\u2019ll build a sequential and an asynchronous version of a small program and compare their results and structure. Both programs will do the same:", "The algorithm would look something like the diagram below.", "We\u2019ll now compare two possible approaches for building this algorithm. First, Option A, which executes the requests sequentially. Then, Option B, which uses asyncio to run requests asynchronously.", "A sequential version of that algorithm could look as follows:", "Now, let\u2019s breakdown the code to understand what\u2019s going on.", "As usual, we start by importing the required libraries. Then, we define two variables:", "Next, we define the extract_fields_from_response function. This function takes as input the response from the API and extracts the fields we're interested in.", "The parsing process in extract_fields_from_response is based on the response's structure from the Google Books API, which looks as follows:", "Finally, we go into the most relevant parts of the program: how we make requests to the Google Books API.", "There are two major pieces here:", "For me, executing this process takes from 4 to 6 seconds. If you only need to do this a couple of times, you will not find much benefit from using asyncio. However, if instead of 10 requests, you need to do 10,000, having some concurrency in your program pays out. In the next section, we\u2019ll see how to make this algorithm faster using asyncio.", "An asynchronous version of the same algorithm may look as follows:", "First, check the get_book_details_async function. An async keyword prepends it. This keyword tells Python that your function is a coroutine. Then, in the function's body, there are two await keywords. These tell that coroutine to suspend execution and give back control to the event loop, while the operation it is awaiting finishes.", "A coroutine is a type of generator function in Python that, instead of producing values, consumes values\u2075. The interesting thing about it is that its execution pauses while waiting for new data being sent to it. In our case, this allows the execution of other parts of the program to continue in a seemingly concurrent manner.", "In this case, the execution of get_book_details_async is suspended while the request is being performed: await session.request(method='GET', url=url). It is suspended again, while the request response is being parsed into a JSON structure: await response.json().", "Next, we have the run_program coroutine. This one is simply a wrapper around the pipeline of getting a response from the API, parsing it, and printing the results in the screen. It awaits the execution of the get_book_details_async coroutine.", "Finally, we have the code block under async with ClientSession() as session:. Using the asyncio.gather syntax, we tell the program to schedule all the tasks based on the list of coroutines we provided. This is what allows us to execute tasks concurrently.", "For me, running this process takes around 800\u20131000 milliseconds.", "Comparing both versions, we see that the asynchronous one is around 4 to 7.5 times faster than the sequential version. If we increase the number of requests, you\u2019ll likely get an even higher speedup. Besides, the version using asyncio is not much more complicated than the sequential version, which makes using asyncio an excellent option for the kind of task we reviewed in the tutorial.", "Here are some tips I gathered while working with asyncio:", "[1] Real Python has a two of amazing articles introducing asyncio: Async IO in Python and Speed Up Your Python Program With Concurrency", "[2] It is not strictly concurrent execution. But in practical terms, it looks like it is.", "[4] The session object is a functionality from the requests library that allows you to persist certain parameters across sessions. This usually results in requests with lower latency. Read more here.", "[5] D. Beasly, A Curious Course on Couroutines and Concurrency (2009)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Product Data Scientist. I write at https://dylancastillo.co/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F62dafca83c33&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----62dafca83c33--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@dcast?source=post_page-----62dafca83c33--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dcast?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Dylan Castillo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ffc74d6a7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&user=Dylan+Castillo&userId=4ffc74d6a7e&source=post_page-4ffc74d6a7e----62dafca83c33---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@marcojodoin", "anchor_text": "Marc-Olivier Jodoin"}, {"url": "https://unsplash.com/photos/NqOInJ-ttqM", "anchor_text": "Unsplash"}, {"url": "https://dylancastillo.co/mind-reading-algorithms-an-introduction-to-recommender-systems/", "anchor_text": "content-based recommender"}, {"url": "https://github.com/andrewsayre/pysmartthings/issues/20", "anchor_text": "some small changes"}, {"url": "https://www.googleapis.com/books/v1/volumes?q=isbn:9780002005883", "anchor_text": "https://www.googleapis.com/books/v1/volumes?q=isbn:9780002005883"}, {"url": "https://docs.python.org/3/library/asyncio-sync.html#asyncio.Semaphore", "anchor_text": "asyncio\u2019s Semaphore"}, {"url": "https://docs.python.org/3/library/threading.html", "anchor_text": "threading,"}, {"url": "https://docs.python.org/2/library/multiprocessing.html", "anchor_text": "multiprocessing"}, {"url": "https://github.com/dylanjcastillo/google_books_crawler", "anchor_text": "Google Books Crawler"}, {"url": "https://realpython.com/async-io-python/", "anchor_text": "Async IO in Python"}, {"url": "https://realpython.com/python-concurrency", "anchor_text": "Speed Up Your Python Program With Concurrency"}, {"url": "https://www.quora.com/What-is-the-use-case-for-asyncio-and-coroutines-in-Python-3-6", "anchor_text": "What Is the use case of coroutines and asyncio in Python 3.6?"}, {"url": "https://2.python-requests.org/en/v1.1.0/user/advanced/", "anchor_text": "here"}, {"url": "http://www.dabeaz.com/coroutines/Coroutines.pdf", "anchor_text": "A Curious Course on Couroutines and Concurrency"}, {"url": "https://medium.com/tag/python?source=post_page-----62dafca83c33---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----62dafca83c33---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/api?source=post_page-----62dafca83c33---------------api-----------------", "anchor_text": "API"}, {"url": "https://medium.com/tag/asyncio?source=post_page-----62dafca83c33---------------asyncio-----------------", "anchor_text": "Asyncio"}, {"url": "https://medium.com/tag/aiohttp?source=post_page-----62dafca83c33---------------aiohttp-----------------", "anchor_text": "Aiohttp"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&user=Dylan+Castillo&userId=4ffc74d6a7e&source=-----62dafca83c33---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&user=Dylan+Castillo&userId=4ffc74d6a7e&source=-----62dafca83c33---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F62dafca83c33&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----62dafca83c33---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----62dafca83c33--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----62dafca83c33--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----62dafca83c33--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----62dafca83c33--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----62dafca83c33--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dcast?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@dcast?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dylan Castillo"}, {"url": "https://medium.com/@dcast/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "129 Followers"}, {"url": "https://dylancastillo.co/", "anchor_text": "https://dylancastillo.co/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4ffc74d6a7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&user=Dylan+Castillo&userId=4ffc74d6a7e&source=post_page-4ffc74d6a7e--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3cd1654afffa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffast-and-async-in-python-accelerate-your-requests-using-asyncio-62dafca83c33&newsletterV3=4ffc74d6a7e&newsletterV3Id=3cd1654afffa&user=Dylan+Castillo&userId=4ffc74d6a7e&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}