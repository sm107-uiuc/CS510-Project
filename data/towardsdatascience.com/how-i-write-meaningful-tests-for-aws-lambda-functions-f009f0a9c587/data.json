{"url": "https://towardsdatascience.com/how-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587", "time": 1683012690.584882, "path": "towardsdatascience.com/how-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587/", "webpage": {"metadata": {"title": "How I Write Meaningful Tests for AWS Lambda Functions | by Paul Singman | Towards Data Science", "h1": "How I Write Meaningful Tests for AWS Lambda Functions", "description": "If you are going to write meaningless unit tests that are more likely to mask errors than expose them, you are better off skipping the exercise altogether. Your time is precious and could be spent on\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html", "anchor_text": "AWS documentation", "paragraph_index": 14}, {"url": "https://devopedia.org/mock-testing#:~:text=Mock%20testing%20is%20an%20approach,behaviour%20of%20the%20real%20ones.", "anchor_text": "mock", "paragraph_index": 18}, {"url": "https://github.com/spulec/moto", "anchor_text": "moto", "paragraph_index": 19}, {"url": "https://github.com/spulec/moto/blob/master/IMPLEMENTATION_COVERAGE.md", "anchor_text": "odds are moto", "paragraph_index": 25}, {"url": "https://stackoverflow.com/questions/5626193/what-is-monkey-patching", "anchor_text": "monkeypatching", "paragraph_index": 26}, {"url": "https://docs.pytest.org/en/stable/monkeypatch.html", "anchor_text": "monkeypatch", "paragraph_index": 29}, {"url": "https://docs.pytest.org/en/stable/fixture.html", "anchor_text": "fixtures", "paragraph_index": 31}], "all_paragraphs": ["If you are going to write meaningless unit tests that are more likely to mask errors than expose them, you are better off skipping the exercise altogether.", "Your time is precious and could be spent on better things than achieving a hollow coverage percentage.", "Effective testing of code has long been a challenging problem in programming, and newer tools like AWS Lambda seem to bring out the worst in developers when it comes to writing tests.", "I think the main reason for this is that it\u2019s more difficult (or at least less intuitive) to mirror the Lambda production environment locally. And as a result, some developers abstain from testing entirely.", "I know because I\u2019ve done it myself, even for projects in production. Instead, testing was done integration-style only after code was already deployed to the cloud.", "This is extremely manual and wastes time in the long run.", "Another approach I\u2019ve seen results in tests that look something like this:", "This is the unmistakeable sign of an engineering team with a test coverage requirement but a lack of accountability. And no explanation is needed that the above is a no-no.", "So, how do we go about transforming the sad test_lambda_function.py file above into something meaningful?", "Before we can dive right into testing our Lambda code, there are a couple hurdles in the way. We\u2019ll cover each of these individually and determine how to best handle them. Once dealt with, we are then free to test Lambdas to our heart\u2019s content!", "Note: I\u2019ll be including small snippets of code throughout the article for clarity. But at the end there will be a full working code example to reference.", "Every Lambda function gets invoked in response to a pre-defined trigger that passes specific event data into the default lambda_handler() method. And your first task for effectively testing a Lambda function is to create a realistic input event to test with.", "The format of this event depends on the type of trigger. As of the time of writing there are 16 distinct AWS services that can act as the invocation trigger for Lambda.", "Below is a code snippet with several examples of inputs that I most commonly use:", "The full list of sample input events can be found in the AWS documentation. Alternatively, you can also print the event variable in your lambda_handler code after deploying and view the payload in CloudWatch Logs:", "Once you have that example, simply hardcode it in your test file as shown above and we\u2019re off to a fantastic start!", "Almost inevitably, a Lambda function interacts with other AWS services. Maybe you are writing data to a DynamoDB table. Or posting a message to an SNS topic. Or simply sending a metric to CloudWatch. Or a combination of all three!", "When testing it is not a good idea to send data or alter actual AWS resources used in production. To get around this problem, one approach is to set up and later tear down separate test resources.", "A cleaner approach though, is to mock interactions with AWS services. And since this is a common problem, a package has been developed to solve this specific problem. And what\u2019s better is it does so in a super elegant way.", "It\u2019s name is moto (a portmanteau of mock & boto) and its elegance is derived from two main features:", "What does this look like? All that\u2019s needed is some decorator magic and a little set up!", "Say we read data from S3 in our Lambda. Instead of creating and populating a test bucket in S3, we can use moto to create a fake S3 bucket \u2014 one that looks and behaves exactly like a real one \u2014 without actually touching AWS.", "And the best part is we can do this using standard boto3 syntax, as seen in the example below when calling the create_bucket and put_object methods:", "Similarly, if we write data to DynamoDB, we could set up our test by creating a fake Dynamo table first:", "It requires a bit of trust, but if the test passes, you can be confident your code will work in production, too.", "Yes, it is true that moto doesn\u2019t maintain parity with every AWS API. For example, if your Lambda function interacts with AWS Glue, odds are moto will leave you high and dry since it is only 5% implemented for the Glue service.", "This is where we need to roll up our sleeves and do the dirty work of mocking calls ourselves by monkeypatching. This is true whether we\u2019re talking about AWS-related calls or any external service your Lambda may touch, like when posting a message to Slack, for example.", "Admittedly the terminology and concepts around this get dense, so it is best explained via an example. Let\u2019s stick with AWS Glue and say we have a burning desire to list our account\u2019s Glue crawlers with the following code:", "If we don\u2019t want the success or failure of our illustrious test to depend on the list_crawlers() response, we can hardcode a return value like so:", "By leveraging the setattr method of the pytest monkeypatch fixture, we allow glue client code in a lambda_handler to dynamically at runtime access the hardcoded list_clusters response from the MockBotoSession class.", "What\u2019s nice about this solution is that is it flexible enough to work for any boto client.", "We\u2019ve already covered how to deal with event inputs and external dependencies in Lambda tests. Another tip I\u2019d like to share involves the use of pytest fixtures to maintain an organized testing file.", "The code examples thus far have shown set up code directly in the test_lambda_handler method itself. A better pattern, however, is to create a separate set_up function as a pytest fixture that gets passed into any test method that needs to use it.", "For the final code snippet, let\u2019s show an example of this fixture structure using the @pytest.fixture decorator and combine everything covered:", "We\u2019ve come a long way from the empty test file at the beginning of the article, no?", "As a reminder, this code tests a Lambda function that:", "By employing these strategies though, you should feel confident testing a Lambda triggered from any event type, and one that interacts with any AWS service.", "If you\u2019ve been struggling to test your Lambda functions, my hope is this article showed you a few tips to help you do so in a useful way.", "While we spent a lot of time on common issues and how you shouldn\u2019t test a Lambda, we didn\u2019t get a chance to cover the opposite, yet equally important aspect of this topic\u2014 namely what should you test, and how can you structure your Lambda function\u2019s code to make it easier to do so.", "I look forward to hearing from you and discussing how you test Lambda functions!", "Thank you to Vamshi Rapolu for inspiration and feedback on this article.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data @ Meta. Whisperer of data and productivity wisdom. Standing on the shoulders of giants."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff009f0a9c587&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://psingman.medium.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b----f009f0a9c587---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html", "anchor_text": "AWS documentation"}, {"url": "https://devopedia.org/mock-testing#:~:text=Mock%20testing%20is%20an%20approach,behaviour%20of%20the%20real%20ones.", "anchor_text": "mock"}, {"url": "https://github.com/spulec/moto", "anchor_text": "moto"}, {"url": "https://github.com/spulec/moto/blob/master/IMPLEMENTATION_COVERAGE.md", "anchor_text": "odds are moto"}, {"url": "https://stackoverflow.com/questions/5626193/what-is-monkey-patching", "anchor_text": "monkeypatching"}, {"url": "https://docs.pytest.org/en/stable/monkeypatch.html", "anchor_text": "monkeypatch"}, {"url": "https://docs.pytest.org/en/stable/fixture.html", "anchor_text": "fixtures"}, {"url": "https://aalvarez.me/posts/pytest-tricks-for-better-python-tests/", "anchor_text": "Pytest Tricks for Better Python TestsPytest is my Python testing framework of choice. Very easy to use, and makes tests look much better. In this article\u2026aalvarez.me"}, {"url": "https://www.fernandomc.com/posts/serverless-testing-with-moto/", "anchor_text": "Serverless Unit Testing with MotoServerless development can speed up your development process a lot by moving infrastructure responsibilities over to\u2026www.fernandomc.com"}, {"url": "https://semaphoreci.com/community/tutorials/mocks-and-monkeypatching-in-python", "anchor_text": "Mocks and Monkeypatching in Python - Semaphore TutorialIn this post I will look into the essential part of testing - mocks. First of all, what I want to accomplish here is to\u2026semaphoreci.com"}, {"url": "https://github.com/pytest-dev/pytest/issues/4576#issuecomment-449864333", "anchor_text": "Advice request: monkeypatch vs mock.patch \u00b7 Issue #4576 \u00b7 pytest-dev/pytestDismiss GitHub is home to over 50 million developers working together to host and review code, manage projects, and\u2026github.com"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----f009f0a9c587---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/aws?source=post_page-----f009f0a9c587---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/serverless?source=post_page-----f009f0a9c587---------------serverless-----------------", "anchor_text": "Serverless"}, {"url": "https://medium.com/tag/programming?source=post_page-----f009f0a9c587---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/python?source=post_page-----f009f0a9c587---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&user=Paul+Singman&userId=d810baa7423b&source=-----f009f0a9c587---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&user=Paul+Singman&userId=d810baa7423b&source=-----f009f0a9c587---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ff009f0a9c587&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----f009f0a9c587---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f009f0a9c587--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----f009f0a9c587--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----f009f0a9c587--------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://psingman.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Paul Singman"}, {"url": "https://psingman.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.3K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd810baa7423b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&user=Paul+Singman&userId=d810baa7423b&source=post_page-d810baa7423b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc7186ddb0db1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-i-write-meaningful-tests-for-aws-lambda-functions-f009f0a9c587&newsletterV3=d810baa7423b&newsletterV3Id=c7186ddb0db1&user=Paul+Singman&userId=d810baa7423b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}