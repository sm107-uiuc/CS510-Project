{"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-c44aadef59fe", "time": 1683009167.7478888, "path": "towardsdatascience.com/chat-images-to-textual-conversation-c44aadef59fe/", "webpage": {"metadata": {"title": "Chat Images to Textual Conversation | by Avani Sharma | Towards Data Science", "h1": "Chat Images to Textual Conversation", "description": "In recent times, there are a lot of chat images floating around on social media, could be chat images with customer service, or just fun chat images from WhatsApp or Facebook, could be any important\u2026"}, "outgoing_paragraph_urls": [{"url": "https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/33418.pdf", "anchor_text": "paper", "paragraph_index": 3}, {"url": "https://github.com/tesseract-ocr/docs/blob/master/das_tutorial2016/6ModernizationEfforts.pdf", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://medium.com/u/bd8d094402aa?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Akshat Sharma", "paragraph_index": 15}], "all_paragraphs": ["In recent times, there are a lot of chat images floating around on social media, could be chat images with customer service, or just fun chat images from WhatsApp or Facebook, could be any important group conversation. This data is present and lying around all over the internet without being put to any good use.", "I was approached by Messagink for an interesting use case of this problem. The task was to extract messages from the chat images into a JSON format. So, I thought why not explore this area and see if something can be achieved in this particular domain.", "I started with the task of taking in chat images and spitting out JSON object out of it. The seemingly simple task involved a lot many intricate problems. Each requiring me to iterate over my approach and use Machine Learning concepts to solve them. Let\u2019s go through these problems in detail.", "Firstly I had to find a good library which could detect text in images with very high accuracy. I searched a lot, read through pros and cons of many libraries and finally finalized Google\u2019s tesseract library (sponsored by Google since 2006, before that was developed by HP Labs). Legacy Tesseract works in a multistage process. Initially binarizing the image using a threshold, followed by determining connected components and connection between them, character classification and aggregating characters to form words, lines, paragraphs. More details can be read in this paper.", "In October 2018 they launched tesseract 4 which uses bidirectional LSTMs underneath for this OCR task. Since then they have done several improvements and latest version was available on December 26, 2019. To learn more about how tesseract 4 uses Deep Neural Nets, read here. We will be using Tesseract 4 for all our tasks.", "Initially, I just fed in some chat images to spit out the text. I used \u201cpytesseract\u201d wrapper around tesseract for the same as the results were precise and accurate using it. Well I got text from images, but hardest part was to make atleast some sense out of that text. Like if it is a chat between two people how do we segregate text messages, how do we remove unwanted text from image, How do we detect timings of messages. So these were few next challenges that needed attention.", "To be able to come up with solution for all these problems, main problem was detecting bounding box around the lines of text. Below is the image showing red bounding box around text", "Ideally I wanted to detect bounding box around each message but it was hard to find such a tool. And \u201cpytesseract\u201d was detecting individual bounding boxes around characters, which did not suit my purpose. I found another wrapper \u201ctesserocr\u201d around tesseract which exposed the functionality of detecting bounding box around each line of text, however \u201ctesserocr\u2019s\u201d text recognition was not as accurate as pytesseract, hence I decide to use tesserocr for bounding box detection and use pytesseract\u2019s image_to_string function to recognize text in that bounding box. The basic function of tesserocr along with pytesseract is shown in below code snippet", "Finally we had both bounding box and text together. Now had to put these bounding boxes to a good use. Considering a two person chat, first main task was segregating messages between them accurately. I just used X coordinate of starting edge of each bounding box and compared it with a threshold. The threshold is decided based on width of image, to handle images of different resolution. So I wanted threshold to be a value such that the X coordinate of starting edge of bounding box for messages on left side is lesser than threshold and X coordinate of starting edge of bounding box for messages on right side is greater than threshold. After a lot of experimentations on whatsapp images, found that keeping threshold as 10% of width of image will suit the purpose. This helped segregating messages between two people. Following image shows how, threshold maps over the image. Blue dot shows threshold while red boxes are bounding boxes over the text.", "Since \u201ctesserocr\u201d detects one bounding box per line, so the messages longer than one line got separated into multiple lines. I had to collate all the lines together which belonged to same message. Again bounding box around texts played an important role here. So I noticed that the difference between Y coordinates of bounding boxes in the same message was less that than the bounding boxes in different messages. Hence, we could again use a threshold here to decide whether to collate lines of text or not. Experimenting with different resolution whatsapp images it turned out that using threshold as 1% of the width of image was best option. In the image below you can see that how lines in the same message are close enough while lines in different messages are far. Green annotation shows Y coordinate difference between the bounding box of two different messages and Blue annotation shows Y coordinate difference between the lines of same message.", "Nice! so now we had text lines collated as messages and segregated between two people. The next problem with the output was that it had unnecessary detection of noise at the header or footer of image. For example in whatsapp chat image, if taken as full screen shot will have somethings detected on top or bottom part of image as shown below. Now the hard part was how do we know if image is cropped or full image. I tried things like figuring out header from the font-size, or trying to map name near the Avatar image, but nothing was giving promising result. Then it struck me that images from same source will have exactly same template. That is if the screenshots are from IOS device of a specific person, they will have same header and bottom template. I could definitely use image subtraction to detect the differences and just take the largest bounding box encompassing all differences. But the implementation was harder than the idea, and I used opencv\u2019s functionality to extract such a bounding box. I will explain process below using 2 chat screenshots from same source:", "So finally we were able to crop the image if any header or footer were present. Next step was removing some of the noise encountered while recognizing text from the bounding boxes. In some lines, \u2018pytesseract\u2019 was detecting time as well which was getting appended at the end of the text. We had to remove this time from the texts. We used time regex for both 12 hr and 24 hr format to detect time in the text and strip it off accordingly.", "After performing all these steps, the algorithm was ready and was giving good results for test images. We deployed it on messagink.com and you can see it live working at this website below. (You would have to create a story and select the import option.)", "However when we started throwing random images on this \u2014 several problems popped up. We aim to solve all of these problems listed below very soon:", "I will post in the next blog what solution I found to these problems. Let me start hacking on these, see you soon\u2026.", "Thanks Akshat Sharma for collaborating in this work :)!", "Update: I have published Part 2 of blog as well, please give it a read here :", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning / Sequence Modelling / Data Science Enthusiast, MSCS from University of Utah (2018), Software Engineer @ Goldman Sachs"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc44aadef59fe&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://avaninith.medium.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Avani Sharma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65c1fd6e51fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&user=Avani+Sharma&userId=65c1fd6e51fb&source=post_page-65c1fd6e51fb----c44aadef59fe---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@rachitank?utm_source=medium&utm_medium=referral", "anchor_text": "Rachit Tank"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/33418.pdf", "anchor_text": "paper"}, {"url": "https://github.com/tesseract-ocr/docs/blob/master/das_tutorial2016/6ModernizationEfforts.pdf", "anchor_text": "here"}, {"url": "https://messagink.com/", "anchor_text": "Messagink - Tell your storyDiscover interesting stories. Create your own text stories with our editor. Publish it for free.messagink.com"}, {"url": "https://medium.com/u/bd8d094402aa?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Akshat Sharma"}, {"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-part-2-8260c09a032e", "anchor_text": "Chat Images To Textual Conversation: Part 2So I am here again, with part 2 for Chat Images to Textual Conversation. If you have not read about part 1 yet, I\u2026towardsdatascience.com"}, {"url": "https://medium.com/tag/optical-character-recogn?source=post_page-----c44aadef59fe---------------optical_character_recogn-----------------", "anchor_text": "Optical Character Recogn"}, {"url": "https://medium.com/tag/ai?source=post_page-----c44aadef59fe---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/image-to-text?source=post_page-----c44aadef59fe---------------image_to_text-----------------", "anchor_text": "Image To Text"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----c44aadef59fe---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/tesseract?source=post_page-----c44aadef59fe---------------tesseract-----------------", "anchor_text": "Tesseract"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&user=Avani+Sharma&userId=65c1fd6e51fb&source=-----c44aadef59fe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&user=Avani+Sharma&userId=65c1fd6e51fb&source=-----c44aadef59fe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc44aadef59fe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c44aadef59fe---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c44aadef59fe--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c44aadef59fe--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c44aadef59fe--------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Avani Sharma"}, {"url": "https://avaninith.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65c1fd6e51fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&user=Avani+Sharma&userId=65c1fd6e51fb&source=post_page-65c1fd6e51fb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc98e63f1f65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-c44aadef59fe&newsletterV3=65c1fd6e51fb&newsletterV3Id=c98e63f1f65d&user=Avani+Sharma&userId=65c1fd6e51fb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}