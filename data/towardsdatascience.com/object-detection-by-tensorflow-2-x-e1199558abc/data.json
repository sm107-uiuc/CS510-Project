{"url": "https://towardsdatascience.com/object-detection-by-tensorflow-2-x-e1199558abc", "time": 1683013801.126365, "path": "towardsdatascience.com/object-detection-by-tensorflow-2-x-e1199558abc/", "webpage": {"metadata": {"title": "Object Detection by Tensorflow 2.x | by Yuki Takahashi | Towards Data Science", "h1": "Object Detection by Tensorflow 2.x", "description": "The computer vision is one of the top fast growing domain and the deep learning based approach is now widely applied to solve real-world problems such as face recognition, cancer detection, etc. One\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "Tensorflow Object Detection API", "paragraph_index": 1}, {"url": "https://www.tensorflow.org/guide/eager", "anchor_text": "eager execution", "paragraph_index": 2}, {"url": "https://arxiv.org/abs/1904.08189", "anchor_text": "CenterNet", "paragraph_index": 2}, {"url": "https://arxiv.org/abs/1901.08043", "anchor_text": "ExtremeNet", "paragraph_index": 2}, {"url": "https://arxiv.org/abs/1911.09070", "anchor_text": "EfficientDet", "paragraph_index": 2}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b", "anchor_text": "Here is TF1 version of step-by-step guide.", "paragraph_index": 3}, {"url": "http://www.cvlibs.net/datasets/kitti/index.php", "anchor_text": "http://www.cvlibs.net/datasets/kitti/index.php", "paragraph_index": 7}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 8}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 9}, {"url": "https://github.com/yuki678/driving-object-detection/tree/master/scripts", "anchor_text": "all scripts", "paragraph_index": 11}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md", "anchor_text": "Tensorflow 2 Detection Model Zoo", "paragraph_index": 13}, {"url": "https://cocodataset.org/#home", "anchor_text": "coco dataset", "paragraph_index": 13}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b?source=friends_link&sk=e39d1d3ced6f1ff657f3a8a92998262c", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection/samples/configs", "anchor_text": "tensorflow model repo", "paragraph_index": 15}, {"url": "https://github.com/tzutalin/labelImg#installation", "anchor_text": "installation guide", "paragraph_index": 16}, {"url": "https://github.com/yuki678/driving-object-detection/blob/master/traffic-light-detection-tf2.ipynb", "anchor_text": "traffic-light-detection-tf2.ipynb", "paragraph_index": 22}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b", "anchor_text": "this post", "paragraph_index": 41}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo", "paragraph_index": 41}, {"url": "https://github.com/yuki678", "anchor_text": "https://github.com/yuki678", "paragraph_index": 43}], "all_paragraphs": ["The computer vision is one of the top fast growing domain and the deep learning based approach is now widely applied to solve real-world problems such as face recognition, cancer detection, etc.", "One of the most effective tool is Tensorflow Object Detection API and use their pre-trained model, replacing the last layer for the particular problem trying to solve and fine tune the model.", "Now the API supports Tensorflow 2.x. There are good reasons to use TF2 instead of TF1 \u2014 e.g. eager execution, which was introduced in TF1.5 to make the coding simpler and debugging easier, and new state of the art (SOTA) models such as CenterNet, ExtremeNet, and EfficientDet are available. The latest version as of writing this is Tensorflow 2.3.", "The API is backward compatible but still it would make your life easier to use TF1 if your runtime cannot be upgraded. Here is TF1 version of step-by-step guide.", "Here, I take the traffic light detection for a self-driving car, where red, yellow or green traffic light have to be detected at high frequency (~10fps) even on a small computing resource on the car by older libraries due to dependencies.", "Please note that this post only describes the object detection by a machine learning approach. An actual self-driving car uses Lidar, Rader, GPS and map, and apply various filters for localization, object detection, trajectory planning and so on then apply actuators to accelerate, decelerate or turn the car, which is beyond this post.", "The pre-trained model used is Centernet Resnet50, which has achieved a great efficiency with reasonably good accuracy by means of the cascade corner pooling and center pooling architecture, using Resnet50 as the backbone network, which fits for this use case.", "As for training data, kitti (http://www.cvlibs.net/datasets/kitti/index.php) provides comprehensive dataset for autonomous car.", "The below uses Google Colab. If you train on a local environment, please refer to README in the repo.", "1. Clone the project repo or create new one", "If you created a new repo, make the following directories", "When creating a new repo, copy all scripts in scripts dir.", "2. Select which pre-trained model to use", "Go to Tensorflow 2 Detection Model Zoo in github and download the one which fits for the purpose. All models here have been trained by coco dataset as of writing, which works well in most cases. Speed and accuracy (mAP) are trade-off. I selected CenterNet Resnet50 V1 FPN 512x512, of which Speed is 27 and mAP is 31.2 \u2014 in deed this is much faster and more accurate than SSD Mobilenet v2 in TF1 with Speed is 31 and mAP is 21, which I used here!", "One can of course choose more complex model if the environment allows much larger model size and slower inference time.", "Once the model is decided, unarchive and copy pipeline.config. This config is the one used for their training and need to modify later as we use it for fine tuning. Alternatively, you can copy sample pipeline config from the tensorflow model repo, as you actually don\u2019t need to download the model itself when using Colab environment.", "As is always the case for supervised learning, you need to spend a few hours to manually label input data. Save training images under images directory where I provided traffic light detection images in a simulator with labels in Pascal VOC in my repo. There are a number of tools available and labelImg is one of the simplest classic ones for box type. Make sure you have python 3 and simply install it from PyPI, or refer to installation guide.", "Save the xml files in the same directory. Good news is, no need to prepare tens of thousands of labels as this is a transfer learning and 100 labels per category will yield good results for fine tuning.", "This is just a list of labels. Names should match with the annotated labels in the previous step. Save the file as annotations/label_map.pbtxt", "Next step of training set preparation is to separate images to train set and test set, then generate .TFRecord for each the xml files. This can be done locally here but I included in the step on Colab.", "Some changes are mandatory and others are optional but better to fit for the training data.", "Push the changes to github \u2014 all set!", "Next, go to Google Colab and create a new notebook. traffic-light-detection-tf2.ipynb is a sample in my repo.", "Clone, compile protocol buffers, set PTTHONPATH and install.", "Then, install COCO API for evaluation", "Make sure the local changes are committed in master branch and pushed to github beforehand.", "6. Process input images (training dataset)", "First, split the images to train set and test set.", "Then, convert xml files to a csv", "Finally, convert csv files to TFRecord format", "It is very useful to launch tensorboard to monitor the training progress. In TF1 version we use ngrok tunnel but now a magic command is available to launch tensorboard within the notebook!", "Simply, execute model_main_tf2.py. Note that TF1 uses model_main.py with slightly different arguments.", "This takes a while, depending on the model and parameters though, a few minutes to hours or more. Take a couple of tea, or even dinner and shower and TV and sleep\u2026", "In TF1, it was done within the training process but somehow it has been separated. It\u2019s useful when running locally but not so much in Colab\u2026 anyway you can run this after the training by specifying checkpoint_dir, which runs the evaluation mode. Set eval_timeout or kill the process after evaluation is done as it waits for the inputs infinitely.", "Adjust parameters in pipeline.config if the loss is not decreased, accuracy/recall is not improved or learning curve is not as expected. Target total loss under 2.", "It provides nice comparison between ground truth and detection in images too, at each evaluation step.", "Don\u2019t forget to export and download the trained model, which will be used for inference. Again, here uses exporter_main_v2.py instead of exporter_main.py in TF1.", "Once successfully exported, archive and download it.", "The whole purpose of training a model is to use the trained model for inference, of course. Here, I used the test images for demonstration but this can be any new images which you would like to detect objects in.", "Now, run the inference for each image in image paths.", "Here are some sample outputs. It can detect and classify traffic lights in all cases with a good confidence level even with a faster inference speed.", "This post explains how to use Tensorflow Object Detection API 2.x for training and perform inference on the fine-tuned model. If you use Tensorflow 1.x, please see this post. Sample code and images are available in my github repo.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A product manager in London. Github \u2014 https://github.com/yuki678"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe1199558abc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yuki678.medium.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Yuki Takahashi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3acb9d6e47b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=post_page-3acb9d6e47b8----e1199558abc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection", "anchor_text": "Tensorflow Object Detection API"}, {"url": "https://www.tensorflow.org/guide/eager", "anchor_text": "eager execution"}, {"url": "https://arxiv.org/abs/1904.08189", "anchor_text": "CenterNet"}, {"url": "https://arxiv.org/abs/1901.08043", "anchor_text": "ExtremeNet"}, {"url": "https://arxiv.org/abs/1911.09070", "anchor_text": "EfficientDet"}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b", "anchor_text": "Here is TF1 version of step-by-step guide."}, {"url": "https://arxiv.org/abs/1904.08189", "anchor_text": "https://arxiv.org/abs/1904.08189"}, {"url": "https://arxiv.org/abs/1512.03385", "anchor_text": "https://arxiv.org/abs/1512.03385"}, {"url": "http://www.cvlibs.net/datasets/kitti/index.php", "anchor_text": "http://www.cvlibs.net/datasets/kitti/index.php"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://github.com/yuki678/driving-object-detection/tree/master/scripts", "anchor_text": "all scripts"}, {"url": "https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md", "anchor_text": "Tensorflow 2 Detection Model Zoo"}, {"url": "https://cocodataset.org/#home", "anchor_text": "coco dataset"}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b?source=friends_link&sk=e39d1d3ced6f1ff657f3a8a92998262c", "anchor_text": "here"}, {"url": "https://github.com/tensorflow/models/tree/master/research/object_detection/samples/configs", "anchor_text": "tensorflow model repo"}, {"url": "https://github.com/tzutalin/labelImg#installation", "anchor_text": "installation guide"}, {"url": "https://github.com/yuki678/driving-object-detection/blob/master/traffic-light-detection-tf2.ipynb", "anchor_text": "traffic-light-detection-tf2.ipynb"}, {"url": "https://medium.com/@yukitakahashi_46678/object-detection-by-tensorflow-1-x-5a8cb72c1c4b", "anchor_text": "this post"}, {"url": "https://github.com/yuki678/driving-object-detection", "anchor_text": "repo"}, {"url": "https://medium.com/tag/ai?source=post_page-----e1199558abc---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e1199558abc---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----e1199558abc---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----e1199558abc---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/self-driving-cars?source=post_page-----e1199558abc---------------self_driving_cars-----------------", "anchor_text": "Self Driving Cars"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=-----e1199558abc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=-----e1199558abc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe1199558abc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e1199558abc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e1199558abc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e1199558abc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e1199558abc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e1199558abc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e1199558abc--------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yuki678.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yuki Takahashi"}, {"url": "https://yuki678.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "385 Followers"}, {"url": "https://github.com/yuki678", "anchor_text": "https://github.com/yuki678"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3acb9d6e47b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=post_page-3acb9d6e47b8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F23923a612f87&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fobject-detection-by-tensorflow-2-x-e1199558abc&newsletterV3=3acb9d6e47b8&newsletterV3Id=23923a612f87&user=Yuki+Takahashi&userId=3acb9d6e47b8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}