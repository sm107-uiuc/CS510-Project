{"url": "https://towardsdatascience.com/4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8", "time": 1682996336.261143, "path": "towardsdatascience.com/4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8/", "webpage": {"metadata": {"title": "4 easy steps to improve your machine learning code performance | by Maksym Balatsko | Towards Data Science", "h1": "4 easy steps to improve your machine learning code performance", "description": "It is really astonishing, how many new machine learning libraries and models are created every day. But it is such a disappointment that most of them are just not properly designed. Actually\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/EFord36/normalise", "anchor_text": "normalize", "paragraph_index": 0}, {"url": "https://www.numpy.org/", "anchor_text": "official web page", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/data-science-with-python-turn-your-conditional-loops-to-numpy-vectors-9484ff9c622e", "anchor_text": "post", "paragraph_index": 9}, {"url": "https://docs.python.org/3.7/library/multiprocessing.html", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://github.com/EFord36/normalise", "anchor_text": "normalize", "paragraph_index": 25}], "all_paragraphs": ["It is really astonishing, how many new machine learning libraries and models are created every day. But it is such a disappointment that most of them are just not properly designed. Actually sometimes great thing with great ideas behind it is just not being used, because it is not well documented, has difficult or not intuitive API or just because the thing doesn\u2019t perform well and is too slow for the production environment. A great example of this would the library that I mentioned in my previous post \u2014 normalize. Such a beautiful idea behind it and it produces the results that really can make the difference in some nlp tasks, but there are some unexpected bugs in it and API is not flexible enough. OK, you say, these two things are not so crucial and actually, you can survive it. But the thing you cannot survive is that its performance is awful, it is just SLOW and so can\u2019t be used in a production environment.", "I want to encourage everyone, who creates machine learning libraries or just shows his own pieces of reusable code to try to optimize it as much as it is possible. Because everybody, who does it more or less wants to make the difference or to make this world a little bit better, helping other people shorten the way they passed and have better results immediately. I want to show you 4 easy steps, that will help you, without any knowledge about optimization, speed-up your code at least twice and make it more efficient and readable.", "Captain Obvious says: \u201cUse math functions of the library you work with or just use numpy and you\u2019ll be always alright\u201d. He is right because in most cases the author of the library optimized all the functions in a way, to make his code as fast as it is possible. But almost every python ML library is based on numpy. Numpy official web page says:", "NumPy is the fundamental package for scientific computing with Python. It contains among other things:", "tools for integrating C/C++ and Fortran code", "useful linear algebra, Fourier transform, and random number capabilities", "Actually, in ML we just making some matrix operations, again and again. Numpy uses all possible state-of-the-art optimization techniques you can imagine to make all these operations efficient. So rule number one:", "Use numpy instead of python math, use numpy arrays instead of python arrays.", "If you follow just this first simple rule, you\u2019ll soon feel the difference.", "How to get rid of annoying for loops that just applies the same function on a set of inputs? Just vectorize this function! Numpy allows you to vectorize a function, which means that newly created function will be applied on list inputs and produce an array of function results. According to this post, it might speed up your computation for at least twice. I highly recommend to read it, because there author shows the beautiful comparison of forloops and numpy vectorize and shows measurements as the proofs that numpy vectorize just works faster! Let\u2019s just see some simple code snippets, to show how it works:", "Numpy vectorization code, in this case, runs 2x faster! Vectorization not only can help to speed-up your code but also make it cleaner. For example, make stemming in nltk to run on all tokens, instead of only one:", "It looks fancier than ForLoop alternative:", "So to conclude, vectorization is a very powerful mechanism, that will help you not only speed-up your code but also to make it look cleaner.", "Almost every computer nowadays has more than one core. Not using all of them, if you have paid for it, as for me is a crime. Actually, you have to take from your computer everything it can give you. For ML developer his computer does not have to be a pretty and fancy thing, first of all, it is a hard-working miner, which have to work in three shifts like Stakhanov in USSR. You just have to take from your computer everything it can give you, if you still don\u2019t understand why, just remember one simple thing: \u201cYou have paid for it\u201d. The easiest way for ML developer to use more than core in his pipelines is just not to forget to set n_jobs parameter in every sklearn model he uses. n_jobs tells sklearn how many jobs to run in parallel both to fit and predict on the model. Most sklearn models support parallelized training and transformations. This will help you to save much time while GridSearching the best parameters or training models on large or high dimensional datasets. Beware of setting n_jobs to -1, because parallelizations save your time, not RAM. Yeah, actually parallelization might be memory extensive but using at least 2 jobs instead of 1 will already help you to optimize your model training and prediction performance.", "MapReduce is a programming model and an associated implementation for processing and generating big data sets with a parallel, distributed algorithm on a cluster.", "Looks like something complex, like something you could use only on a big cluster or on an enormous dataset, right? But it is very easy, I\u2019ll explain it in a couple of sentences and 1 example.", "MapReduce is divided into two parts:", "For example, you have to calculate the sum of squares of an array of data. Sequential implementation would look like:", "Let\u2019s convert this task into MapReduce:", "As was aforementioned the map part will be parallelized, reduce would stay sequential. Let\u2019s take a glance on parallelized implementation:", "So now for this task, you use all the power of your computer! .map method of pool object assumes that the map function has only one argument, there is an equivalent .starmap , which assumes more than one argument in map function, the full description of these functions you can find here. Good to mention is that both .map and .starmap returns mapped values in the same order as input parameters.", "Sometimes it is more efficient to compute map function not only on one sample but on a batch of samples. If the computation task is simple and quick enough, the main overhead of the multiprocessing computation will be transferring data between processes, which could slow down the process a lot. As in the previous part of my post we were talking about n_jobs parameter of sklearn models, let's create universal code snippet of base transformer, which could parallelize the process of its transformations, in this case, batch processing will be the best choice.", "Here is a code snippet of pandas apply parallelization inside a base sklearn transformer, which you could use in you further pipelines:", "I\u2019ll summarize this code. Determine whether to process dataset in parallel or sequential. If in parallel, divide into n_jobs batches all the data and transform in parallel, then concatenate back transformed batches of the dataset. And that\u2019s all! I hope this code snippet, will help you to boost your transformation pipelines.", "I hope you liked my post, if you have further questions, ask in comments I\u2019ll be glad to answer it. I\u2019m looking forward to your feedback!", "P.S. If you are an experienced developer, who wants to contribute to open source, one of your possible tasks could be helping good but not optimized libraries become fast and production ready. If you don\u2019t know, where to start, you can help normalize library to optimize its performance. I don\u2019t have any connections with the authors of this library, they don\u2019t pay me and it is not an advertisement. Just another library, which needs your help ;)", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F88a0b0eeffa8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mbalatsko?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mbalatsko?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Maksym Balatsko"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa6012a510db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&user=Maksym+Balatsko&userId=fa6012a510db&source=post_page-fa6012a510db----88a0b0eeffa8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/EFord36/normalise", "anchor_text": "normalize"}, {"url": "https://www.numpy.org/", "anchor_text": "official web page"}, {"url": "https://towardsdatascience.com/data-science-with-python-turn-your-conditional-loops-to-numpy-vectors-9484ff9c622e", "anchor_text": "post"}, {"url": "https://docs.python.org/3.7/library/multiprocessing.html", "anchor_text": "here"}, {"url": "https://github.com/EFord36/normalise", "anchor_text": "normalize"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----88a0b0eeffa8---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/distributed-systems?source=post_page-----88a0b0eeffa8---------------distributed_systems-----------------", "anchor_text": "Distributed Systems"}, {"url": "https://medium.com/tag/optimization?source=post_page-----88a0b0eeffa8---------------optimization-----------------", "anchor_text": "Optimization"}, {"url": "https://medium.com/tag/parallel-computing?source=post_page-----88a0b0eeffa8---------------parallel_computing-----------------", "anchor_text": "Parallel Computing"}, {"url": "https://medium.com/tag/mapreduce?source=post_page-----88a0b0eeffa8---------------mapreduce-----------------", "anchor_text": "Mapreduce"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&user=Maksym+Balatsko&userId=fa6012a510db&source=-----88a0b0eeffa8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&user=Maksym+Balatsko&userId=fa6012a510db&source=-----88a0b0eeffa8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F88a0b0eeffa8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----88a0b0eeffa8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----88a0b0eeffa8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mbalatsko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mbalatsko?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maksym Balatsko"}, {"url": "https://medium.com/@mbalatsko/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "144 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffa6012a510db&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&user=Maksym+Balatsko&userId=fa6012a510db&source=post_page-fa6012a510db--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1d91ba9341d2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2F4-easy-steps-to-improve-your-machine-learning-code-performance-88a0b0eeffa8&newsletterV3=fa6012a510db&newsletterV3Id=1d91ba9341d2&user=Maksym+Balatsko&userId=fa6012a510db&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}