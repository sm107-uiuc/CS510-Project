{"url": "https://towardsdatascience.com/predicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6", "time": 1683013648.143435, "path": "towardsdatascience.com/predicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6/", "webpage": {"metadata": {"title": "Predicting the flow of the South Fork Payette River using an LSTM neural network | by Will Stauffer-Norris | Towards Data Science", "h1": "Predicting the flow of the South Fork Payette River using an LSTM neural network", "description": "I made an LSTM neural network model that uses 30+ years of weather and streamflow data to quite accurately predict what the streamflow will be tomorrow. The main reason I practice data science is to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.nwrfc.noaa.gov/river/station/flowplot/flowplot.cgi?lid=PRLI1", "anchor_text": "including the South Fork.", "paragraph_index": 1}, {"url": "https://hydroforecast.com/case-study-south-payette", "anchor_text": "Upstream Tech", "paragraph_index": 4}, {"url": "https://www.ncdc.noaa.gov/cdo-web/datasets#GHCND", "anchor_text": "downloaded daily meteorological data from NOAA", "paragraph_index": 7}, {"url": "https://waterdata.usgs.gov/usa/nwis/uv?13235000", "anchor_text": "USGS gauge at Lowman, Idaho", "paragraph_index": 9}, {"url": "https://keras.io/examples/timeseries/timeseries_weather_forecasting/", "anchor_text": "Keras documentation", "paragraph_index": 19}, {"url": "https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/", "anchor_text": "Machine Learning Mastery", "paragraph_index": 19}, {"url": "http://www.rivers.fyi", "anchor_text": "rivers.fyi,", "paragraph_index": 31}, {"url": "https://github.com/willstauffernorris/streamflow_predictions", "anchor_text": "here", "paragraph_index": 32}, {"url": "http://www.willstauffer.com", "anchor_text": "www.willstauffer.com", "paragraph_index": 34}], "all_paragraphs": ["I made an LSTM neural network model that uses 30+ years of weather and streamflow data to quite accurately predict what the streamflow will be tomorrow.", "The main reason I practice data science is to apply it to real-world problems. As a kayaker, I have spent many, many hours poring over weather forecasts, hydrologic forecasts, and SNOTEL station data to make a prediction about a river\u2019s flow. There are good places out there that make this prediction- NOAA runs prediction centers throughout each major river basin in the country, including the South Fork.", "But these forecasts often fall short. In particular, I\u2019ve noticed that the forecasts are susceptible to major rain events (flashy rivers in the Pacific Northwest are notoriously hard to predict), and the forecasts are typically only put out once or twice per day, which is often not frequent enough to react to rapidly changing mountain weather forecasts. NOAA also only gives forecasts on a select group of rivers. If you want a forecast for a smaller or more remote drainage, even if it\u2019s gauged, you\u2019re out of luck.", "So I\u2019m setting out to create a model that will meet or exceed NOAA\u2019s forecasts, and build models for some drainages that are not covered by NOAA.", "To start out, I\u2019m benchmarking my model against an industry-standard model created by Upstream Tech.", "The South Fork Payette is a great place to start, for several reasons:", "The Upstream Tech model I\u2019m benchmarking against uses meteorological as well as remote sensing data to build the model. I haven\u2019t incorporated any satellite imagery yet, although this is the next development in my model.", "To start, I downloaded daily meteorological data from NOAA from a weather station on Banner Summit, which is at the headwaters of the South Fork. Eventually, I will incorporate more stations into my forecast, but I wanted to keep it simple for this first iteration. The metrics measured are:", "These are my predictive features. The data go back to 1987.", "Next, I went to the USGS gauge at Lowman, Idaho, and grabbed the daily discharge for every day since 1987. In a more refined model, I might get hourly data, but I decided daily was good enough for this iteration.", "I merged the two datasets using pandas, creating a dataframe with features and a target variable (discharge).", "There were a few missing values in the meteorological data, so I imputed some values to replace the NaNs. I created a correlation matrix to see if any values were correlated and could be dropped. I decided to get rid of the average temperature reading, as there were already min and max temperature features.", "With the data cleaned up, it was time to start modeling.", "I started with just a baseline- what would happen if you just guessed the average discharge \u2014 about 800 CFS \u2014 of the South Fork every time? It turns out that the average error is about 600 CFS. This is unacceptably large, as it\u2019s almost the flow of the river itself!", "I knew I could do better- a lot better.", "Linear regressions are very simple, but not a bad place to start getting my hands dirty. I used one, then two, then all the features to see how well they would predict the flow of the South Fork. The answer is- pretty badly.", "OK, so linear regressions aren\u2019t known to be the most powerful machine learning models out there. Time to bring out some more complicated stuff. I put all the features in a random forest model. I could have spent longer tweaking the hyperparameters, but I decided to just use the stock scikit-learn settings, with the exception of using 100 estimators.", "The results were a striking improvement- the random forest didn\u2019t quite capture the nuances of the runoff, but it did track the general seasonal trend much better than a linear regression.", "Now time for the newest, biggest and baddest model- the neural network. LSTM neural networks can be useful for time series prediction, although they have some limitations. I used the Keras LSTM model.", "The model has some quirks- you must wrangle data in a very specific way to make it fit- and I found a few tutorials that were invaluable (the Keras documentation and Machine Learning Mastery).", "I trained the model on the period 1987\u20132015 and evaluated it on the years 2016\u20132020. In later iterations, I will look more into better validation techniques for time series data, such as nested cross-validation.", "Eventually, I managed to get a model that had a 98% R\u00b2 value and a mean absolute error of only ~50 cfs! This is head and shoulders better than the other (quite simple) models I tried.", "The craziest part is that I haven\u2019t even incorporated any other weather stations or remote sensing data into the neural network.", "I suspect that the previous day\u2019s flow is contributing most to the prediction because the predicted peaks seem to lag the actual peaks by about a day.", "I\u2019d like to do more investigation into how exactly the LSTM is coming up with the prediction, and visualize the feature importances.", "Although my model performed decently well a day in advance, I\u2019d like to model the flow in a longer forecast range (2\u201310 days out). I\u2019ve started doing this with the LSTM, but I need to spend some more time on it.", "I also want to incorporate more weather stations. NOAA operates several more stations in the area, and it will be quite interesting to see how the position of the station in the watershed changes the prediction.", "I also want to incorporate satellite imagery as a feature. This is quite a bit more complicated, due to the large file sizes and acquiring the images in the first place. I\u2019ve started building a pipeline to ingest Google Earth Engine data into my machine learning models.", "Finally, looking at the model, it\u2019s able to predict very well the down-legs of the hydrograph- but so can I, just intuitively. The model is less able to predict abrupt upswings due to rapid snowmelt or a rain event. These are the kinds of events where prediction is critically important for hydropower, flood control, and public safety.", "As always, there is more work to do!", "Thanks for reading, and stay tuned for Part 2, where I will go through some of these next steps, especially incorporating satellite imagery.", "For the latest on my predictions, check out rivers.fyi, where I\u2019m putting LSTM neural networks into production for multiple rivers.", "You can view the notebooks I used on Github here.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I\u2019m all about the intersection of water and climate change. www.willstauffer.com"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F65292eadf6a6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@willstauffernorris?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@willstauffernorris?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Will Stauffer-Norris"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2bebc4143b5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&user=Will+Stauffer-Norris&userId=2bebc4143b5b&source=post_page-2bebc4143b5b----65292eadf6a6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.nwrfc.noaa.gov/river/station/flowplot/flowplot.cgi?lid=PRLI1", "anchor_text": "including the South Fork."}, {"url": "https://hydroforecast.com/case-study-south-payette", "anchor_text": "Upstream Tech"}, {"url": "https://www.ncdc.noaa.gov/cdo-web/datasets#GHCND", "anchor_text": "downloaded daily meteorological data from NOAA"}, {"url": "https://waterdata.usgs.gov/usa/nwis/uv?13235000", "anchor_text": "USGS gauge at Lowman, Idaho"}, {"url": "https://keras.io/examples/timeseries/timeseries_weather_forecasting/", "anchor_text": "Keras documentation"}, {"url": "https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/", "anchor_text": "Machine Learning Mastery"}, {"url": "http://www.rivers.fyi", "anchor_text": "rivers.fyi,"}, {"url": "https://github.com/willstauffernorris/streamflow_predictions", "anchor_text": "here"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----65292eadf6a6---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/lstm?source=post_page-----65292eadf6a6---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----65292eadf6a6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/hydrology?source=post_page-----65292eadf6a6---------------hydrology-----------------", "anchor_text": "Hydrology"}, {"url": "https://medium.com/tag/idaho?source=post_page-----65292eadf6a6---------------idaho-----------------", "anchor_text": "Idaho"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&user=Will+Stauffer-Norris&userId=2bebc4143b5b&source=-----65292eadf6a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&user=Will+Stauffer-Norris&userId=2bebc4143b5b&source=-----65292eadf6a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F65292eadf6a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----65292eadf6a6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----65292eadf6a6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----65292eadf6a6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----65292eadf6a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@willstauffernorris?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@willstauffernorris?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Will Stauffer-Norris"}, {"url": "https://medium.com/@willstauffernorris/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "17 Followers"}, {"url": "http://www.willstauffer.com", "anchor_text": "www.willstauffer.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2bebc4143b5b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&user=Will+Stauffer-Norris&userId=2bebc4143b5b&source=post_page-2bebc4143b5b--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F2bebc4143b5b%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-the-flow-of-the-south-fork-payette-river-using-an-lstm-neural-network-65292eadf6a6&user=Will+Stauffer-Norris&userId=2bebc4143b5b&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}