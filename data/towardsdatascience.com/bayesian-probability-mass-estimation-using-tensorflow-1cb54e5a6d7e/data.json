{"url": "https://towardsdatascience.com/bayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e", "time": 1683016932.445524, "path": "towardsdatascience.com/bayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e/", "webpage": {"metadata": {"title": "Bayesian probability mass estimation using TensorFlow | by Michael Larionov, PhD | Towards Data Science", "h1": "Bayesian probability mass estimation using TensorFlow", "description": "I have spent some time studying data with categorical variables trying to explore many ways to encode them into numeric features. What if all your variables are categorical? One of the mechanism to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Gamma_function", "anchor_text": "the Gamma function", "paragraph_index": 16}, {"url": "https://github.com/mlarionov/contingency_tables", "anchor_text": "github repository", "paragraph_index": 26}], "all_paragraphs": ["I have spent some time studying data with categorical variables trying to explore many ways to encode them into numeric features. What if all your variables are categorical? One of the mechanism to describe this scenario known as contingency tables.", "Contingency tables in their essence are (potentially multidimensional) tables where rows, columns and other dimensions represent categorical variables, and the cells contain counts of the occurrences of the combinations. As an example, consider a simple contingency table that represents salary (rows) vs. years of experience (columns). The data are taken from [1] and reported by a study conducted by the Department of Energy.", "The task of probability mass estimation is to learn probabilities of every combination of categories. A na\u00efve approach would be to set the probabilities as fractions of observed cell count and total sample size:", "where m_ij is the cell count. This is called a saturated model and it fits the training data perfectly, but usually suffers from poor generalization due to its excessive complexity. One of the symptoms of its poor generalization is that it predicts zero probabilities for all cells with zero count. But zero cell counts can be due to the small sample size, not due to the probabilities being zero.", "To address this problem various smoothing techniques were proposed. In essence, all of them update the cell probabilities based on some prior assumptions to correct the extreme values of cell counts. One such smoothing assumption is that the variable may be independent, meaning that the joint probability is a product of the probabilities of of individual variables:", "Here the plus in p_i+ indicates that we take a sum over the second variable:", "In terms of cell counts this would mean:", "where N is the sample size.", "If we assume the variables are independent, we get the following smoothed contingency matrix:", "Note that the cell counts are very different from the source table. In fact it seems that the independence model does not fit the data well. In statistics there are independence tests specifically designed for contingency tables, but here we are not trying to prove or reject the independence hypothesis. Instead we will use this hypothesis as our prior belief.", "For each of the model we would like to measure two things: how well the model fits data and how dependent on each other are the categorical variables. The first is measured using categorical cross entropy, the second using mutual information:", "For completely smoothed data we get the following", "We can see that the model of complete independence does not fit data very well. From the other hand, the saturated model fits data perfectly, but implies high degree of variable dependence.", "Using Bayesian approach, we would like to encode independence assumption as a prior distribution. First we construct the likelihood function as a product of Multinomial distributions:", "Our prior belief is that both dimensions are independent, that is", "So we constrict the prior distribution as a Dirichlet distribution that is centered around p_i+p_+j:", "where \u03bb is a hyperparameter of the model, and \u0393(x) is the Gamma function", "So the cost function (negative log-posterior) will be this:", "This is a complex function with respect to the parameter p and it cannot be minimized analytically. For this reason will use an optimization framework that can optimize non-linear functions. I picked TensorFlow for this purpose, but other frameworks can also be used. The code to run the experiment is pretty simple, but I will walk you through it to explain the details and gotchas.", "Here\u2019s the quick rundown of the code:", "Let\u2019s train the model for several values of the regularization parameter \u03bb:", "As we see, the predicted counts match the training data very closely. Let\u2019s see what the predictions would be for high value of regularization", "We see that the dependence is much lower, and the predictions is much more smooth, meaning that there are no zeros or exreme values. However the model does not fit very well to the data. How to find optimal regularization parameter \u03bb? We will use cross-validation, a common method in machine learning.", "Our plan is to generate five folds of data and run the train the model for different values of the regularization hyperparameter. For every split we train the model on the training data and test it on the test data. As a metric here we use cross-entropy loss (the first component returning by the result_metric function). We use grid search in logarithmic scale.", "Based on the cross-validation results the best performance of the model happens when \u03bb=64. We can also see that the model performance changes little after \u03bb=4. Perhaps it makes sense to average several models of comparable performance. Let\u2019s see the results generated by the best model:", "We see a good balance between prediction smoothness and how well it fit the training data.", "In this article we considered a fully Bayesian approach for contingency table smoothing. This approach is different from pseudo-Bayes approach [2,3], where the prior distribution is defined using the data. We can take advantage of compute power that was not available in the 1970s, and use the true Bayesian approach to get more consistent results. It is certainly possible to use the same method for a higher number of dimensions as most real world data are. In this article I used a two dimensional contingency table solely because it is much easier to visualize than multidimensional tables. All the code is available in my github repository.", "[2] Yvonne Bishop et al., Discrete Multivariate Analysis, MIT, 1975", "[3] Stephen E. Fienberg and Paul W. Holland, Simultaneous Estimation of Multinomial Cell Probabilities, Journal of the American Statistical Association 68(343):683\u2013691, 1973", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1cb54e5a6d7e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://me.dm/@michaellarionov", "anchor_text": "Mastodon"}, {"url": "https://towardsdatascience.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://michaellarionov.medium.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Michael Larionov, PhD"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9158ca11a43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=post_page-f9158ca11a43----1cb54e5a6d7e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/hands-on-tutorials", "anchor_text": "Hands-on Tutorials"}, {"url": "https://unsplash.com/@steve_j?utm_source=medium&utm_medium=referral", "anchor_text": "Steve Johnson"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://en.wikipedia.org/wiki/Gamma_function", "anchor_text": "the Gamma function"}, {"url": "https://github.com/mlarionov/contingency_tables", "anchor_text": "github repository"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1cb54e5a6d7e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/bayesian-statistics?source=post_page-----1cb54e5a6d7e---------------bayesian_statistics-----------------", "anchor_text": "Bayesian Statistics"}, {"url": "https://medium.com/tag/categorical-data?source=post_page-----1cb54e5a6d7e---------------categorical_data-----------------", "anchor_text": "Categorical Data"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1cb54e5a6d7e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/hands-on-tutorials?source=post_page-----1cb54e5a6d7e---------------hands_on_tutorials-----------------", "anchor_text": "Hands On Tutorials"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=-----1cb54e5a6d7e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=-----1cb54e5a6d7e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1cb54e5a6d7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1cb54e5a6d7e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1cb54e5a6d7e--------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://michaellarionov.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Michael Larionov, PhD"}, {"url": "https://michaellarionov.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "611 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff9158ca11a43&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=post_page-f9158ca11a43--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fcf000f0c5fdd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbayesian-probability-mass-estimation-using-tensorflow-1cb54e5a6d7e&newsletterV3=f9158ca11a43&newsletterV3Id=cf000f0c5fdd&user=Michael+Larionov%2C+PhD&userId=f9158ca11a43&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}