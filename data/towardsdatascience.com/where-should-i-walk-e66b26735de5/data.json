{"url": "https://towardsdatascience.com/where-should-i-walk-e66b26735de5", "time": 1683000609.228105, "path": "towardsdatascience.com/where-should-i-walk-e66b26735de5/", "webpage": {"metadata": {"title": "Where should I walk?. Using new tools from NVIDIA RAPIDS to\u2026 | by Tom Drabas | Towards Data Science", "h1": "Where should I walk?", "description": "In the previous story, we\u2019ve explored the Paid Parking Occupancy dataset provided by the City of Seattle Department of Transportation. You could see (and, hopefully, test) how quickly all the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/where-should-i-park-29e8da95265a", "anchor_text": "previous story", "paragraph_index": 0}, {"url": "https://rapids.ai/", "anchor_text": "NVIDIA RAPIDS", "paragraph_index": 0}, {"url": "http://tomdrabas.com/data/seattle_parking/parking_MayJun2019.tar.gz", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://www.nvidia.com/en-us/titan/titan-rtx/", "anchor_text": "NVIDIA Titan RTX", "paragraph_index": 1}, {"url": "https://www.nvidia.com/en-us/geforce/graphics-cards/rtx-2080-ti/", "anchor_text": "NVIDIA RTX 2080 Ti", "paragraph_index": 1}, {"url": "http://tomdrabas.com/data/seattle_parking/parking_May2019.tar.gz", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://medium.com/rapids-ai/releasing-cuspatial-to-accelerate-geospatial-and-spatiotemporal-processing-b686d8b32a9", "anchor_text": "announced another great piece in the data science puzzle: cuSpatial", "paragraph_index": 2}, {"url": "https://twitter.com/tomekdrabas/status/1172350554229506048?s=20", "anchor_text": "I first reported the impressive speedups I saw", "paragraph_index": 7}, {"url": "https://github.com/rapidsai/cudf/issues/2805", "anchor_text": "additional performance squeeze", "paragraph_index": 7}, {"url": "https://fusiondatascience.com/", "anchor_text": "Fusion Data Science", "paragraph_index": 9}, {"url": "https://catalog.data.gov/dataset/tiger-line-shapefile-2018-county-king-county-wa-all-roads-county-based-shapefile", "anchor_text": "the King County Tiger/Line road network", "paragraph_index": 9}, {"url": "http://tomdrabas.com/data/seattle_parking/king_county_road_graph_20190909.tar.gz", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://github.com/drabastomek/rapids-notebooks/blob/master/codes/rapids_seattleParking_graph.ipynb", "anchor_text": "the notebook", "paragraph_index": 9}, {"url": "https://rapidsai.github.io/projects/cudf/en/0.9.0/api.html#cudf.dataframe.DataFrame.nsmallest", "anchor_text": ".nsmallest(\u2026)", "paragraph_index": 11}, {"url": "https://rapidsai.github.io/projects/cudf/en/0.9.0/api.html#cudf.dataframe.DataFrame.nlargest", "anchor_text": "nlargest(\u2026)", "paragraph_index": 11}, {"url": "https://geopy.readthedocs.io/en/stable/", "anchor_text": "geopy", "paragraph_index": 14}, {"url": "https://docs.rapids.ai/api/cugraph/stable/", "anchor_text": "documentation", "paragraph_index": 16}, {"url": "http://users.cecs.anu.edu.au/~Alistair.Rendell/Teaching/apac_comp3600/module4/single_source_shortest_paths.xhtml", "anchor_text": "these notes", "paragraph_index": 17}, {"url": "https://towardsdatascience.com/where-should-i-park-29e8da95265a", "anchor_text": "previous workflow", "paragraph_index": 21}], "all_paragraphs": ["In the previous story, we\u2019ve explored the Paid Parking Occupancy dataset provided by the City of Seattle Department of Transportation. You could see (and, hopefully, test) how quickly all the calculations on this data can be done using NVIDIA RAPIDS.", "Just to recap: the data we used can be downloaded here. It is a subset of the full dataset that has been published since the beginning of 2019 and includes all the transactions for May and June. The dataset is around 7GB in size and fits nicely on the NVIDIA Titan RTX with 24GB of VRAM; to use this dataset on a GPU with less RAM (like the NVIDIA RTX 2080 Ti with 11GB) you might need to extract only one month \u2014 I have already prepared a smaller dataset that includes only the transactions for May 2019 and you can download it here.", "Before we go on with this story let\u2019s go on a small tangent. Literally one day after I published my story NVIDIA\u2019s RAPIDS team announced another great piece in the data science puzzle: cuSpatial!", "Figure 1. The cuSpatial stack, used with permission from NVIDIA", "cuSpatial is a library that, as the name suggests, focuses on the geospatial calculations. It is a bunch of C++/CUDA kernels exposed via Python interface just as every other tool in the RAPIDS toolkit. And it is fast, just like the rest of them!", "Just so we get a feeling for how fast it does the calculations we will use the full dataset from the previous story (as a reminder, the data consists of 48M geocoded transactions) and test how much quicker we could have done the calculations if we had used cuSpatial.", "In this test, we can see a 4.8x speedup over the vanilla Python without breaking a sweat (and much less code!!). To compare the performance, we reused (somewhat syntactically compressed) version of the calculateDistance(\u2026) method from the previous story.", "Note, that if you run the .apply_rows(\u2026) method for the first time you will incur the compilation penalty as RAPIDS needs to JIT compile the calculateDistance(\u2026) method first: the first run of the cell normally reports ~650ms on my machine but if you rerun the cell again the execution time drops to ~220ms thereafter; assuming you didn\u2019t make any changes, the calculateDistance(\u2026) method would have been cached at that point. I caught myself on this when I first reported the impressive speedups I saw. However, the discussion that ensued actually led to a discovery of an additional performance squeeze that will come to RAPIDS soon!", "So, now back to the continuation of our story. Last time we calculated the distance as crow flies not as we walk. This led to the inclusion of some parking spots that would actually be farther than 1000 ft if reached on foot.", "Thankfully, the one and only John Murray of Fusion Data Science took the shapefiles of the King County Tiger/Line road network and kindly created and donated a graph of King County roads in a form of a list of intersections (with geo coordinates) and list of edges linking the intersections with calculated length (in yards). The data can be downloaded here but if you use the code we post on Github, the notebook will do this for you anyway.", "The parking locations, obviously, are not present in the graph so we need to add them. In the first attempt to achieve this we will loop through all the 1,500 parking locations, calculate the distance to each and every road intersection, and select 3 nearest intersections. This is a bit of a hack and leads to some artifacts (showing later on the map) but will do for now. In the next story, we will discuss how to add new nodes that place the parking spots perpendicular to the road/edge (thanks again to John for suggesting this and helping with the code!)", "The .nsmallest(\u2026) method (there is also nlargest(\u2026) available) returns the top 3 closest intersections; we append these edges to the road_graph_data DataFrame using the .concat(\u2026) method. Finally, we also add a new node to the parking_locations_nodes DataFrame so we can then later append them to the full list of the graph nodes.", "Let\u2019s pause here for a second: we have just calculated the haversine distance using cuSpatial for all 1,500 parking locations to each of the 127k road intersections (so, that is around 200M calculations), selected the 3 closest intersections, and updated the datasets, all in a matter of 1 minute. If this is not fast I don\u2019t know what is\u2026", "Moving on, we also need to do add a node for the Space Needle. However, instead of linking to the nearest 3 intersections, a glimpse on the map suggests we should link it to 5.", "Just like before, we use the Nomatim geo encoder from the geopy package to get the coordinates of Space Needle.", "Now that we have the full list of nodes and edges we can build the graph. This is super easy in RAPIDS.", "Check the documentation for the full list of available methods and algorithms!", "With the full graph constructed we can now use the Single-Source Shortest Path (SSSP) to calculate distances from the Space Needle to each parking location! The algorithm traverses the graph and finds the shortest paths to all the 128k nodes; for an overview of SSSP algorithms I found these notes to be useful. In return, we get a DataFrame with a list of vertices and the corresponding shortest distance to such vertex. The DataFrame also shows the predecessor, a node (or vertex, if you will) that one needs to visit right before a particular node in question that forms the shortest path. All of that in 174 ms.", "We can now use this information to create the full path from the Space Needle to each of the parking spots that are within 1,000ft walking distance.", "In the snippet above I simply hop from node to node and add the edges to the paths DataFrame. After about 1 second we can start charting. From the road_nodes DataFrame we extract the coordinates of each node so we can later use them to plot the points on the map.", "So, given the required distance, the closest parking spots from Space Needle are to the South and the East. Now, if you look close, you can see the artifacts I mentioned earlier and the inadequacy of the method of assigning parking spots to the nearest 3 intersections: to get to some of the parking spots the algorithm would require you to walk past the parking spot and then walk back to it. In the next story, we\u2019ll tackle this problem.", "Compared to our previous workflow (that run in about 20 seconds on the Titan RTX), this end-to-end process takes about 2 minutes to finish. Still, most of this work can be saved and then reused later, reducing the inference time to a mere second or two.", "Stay tuned for more examples of the power, speed and agility of NVIDIA RAPIDS!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist, math lover, computer geek, tube-amps designer and builder, die-hard TOOL fan. Working for Blazing SQL. Ex Microsoft."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe66b26735de5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tomekdrabas.medium.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": ""}, {"url": "https://tomekdrabas.medium.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Tom Drabas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F44003e7498c6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&user=Tom+Drabas&userId=44003e7498c6&source=post_page-44003e7498c6----e66b26735de5---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/where-should-i-park-29e8da95265a", "anchor_text": "previous story"}, {"url": "https://rapids.ai/", "anchor_text": "NVIDIA RAPIDS"}, {"url": "http://tomdrabas.com/data/seattle_parking/parking_MayJun2019.tar.gz", "anchor_text": "here"}, {"url": "https://www.nvidia.com/en-us/titan/titan-rtx/", "anchor_text": "NVIDIA Titan RTX"}, {"url": "https://www.nvidia.com/en-us/geforce/graphics-cards/rtx-2080-ti/", "anchor_text": "NVIDIA RTX 2080 Ti"}, {"url": "http://tomdrabas.com/data/seattle_parking/parking_May2019.tar.gz", "anchor_text": "here"}, {"url": "https://medium.com/rapids-ai/releasing-cuspatial-to-accelerate-geospatial-and-spatiotemporal-processing-b686d8b32a9", "anchor_text": "announced another great piece in the data science puzzle: cuSpatial"}, {"url": "https://twitter.com/tomekdrabas/status/1172350554229506048?s=20", "anchor_text": "I first reported the impressive speedups I saw"}, {"url": "https://github.com/rapidsai/cudf/issues/2805", "anchor_text": "additional performance squeeze"}, {"url": "https://fusiondatascience.com/", "anchor_text": "Fusion Data Science"}, {"url": "https://catalog.data.gov/dataset/tiger-line-shapefile-2018-county-king-county-wa-all-roads-county-based-shapefile", "anchor_text": "the King County Tiger/Line road network"}, {"url": "http://tomdrabas.com/data/seattle_parking/king_county_road_graph_20190909.tar.gz", "anchor_text": "here"}, {"url": "https://github.com/drabastomek/rapids-notebooks/blob/master/codes/rapids_seattleParking_graph.ipynb", "anchor_text": "the notebook"}, {"url": "https://rapidsai.github.io/projects/cudf/en/0.9.0/api.html#cudf.dataframe.DataFrame.nsmallest", "anchor_text": ".nsmallest(\u2026)"}, {"url": "https://rapidsai.github.io/projects/cudf/en/0.9.0/api.html#cudf.dataframe.DataFrame.nlargest", "anchor_text": "nlargest(\u2026)"}, {"url": "https://geopy.readthedocs.io/en/stable/", "anchor_text": "geopy"}, {"url": "https://docs.rapids.ai/api/cugraph/stable/", "anchor_text": "documentation"}, {"url": "http://users.cecs.anu.edu.au/~Alistair.Rendell/Teaching/apac_comp3600/module4/single_source_shortest_paths.xhtml", "anchor_text": "these notes"}, {"url": "https://towardsdatascience.com/where-should-i-park-29e8da95265a", "anchor_text": "previous workflow"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e66b26735de5---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/nvidia?source=post_page-----e66b26735de5---------------nvidia-----------------", "anchor_text": "Nvidia"}, {"url": "https://medium.com/tag/gpu?source=post_page-----e66b26735de5---------------gpu-----------------", "anchor_text": "Gpu"}, {"url": "https://medium.com/tag/rapids-ai?source=post_page-----e66b26735de5---------------rapids_ai-----------------", "anchor_text": "Rapids Ai"}, {"url": "https://medium.com/tag/seattle?source=post_page-----e66b26735de5---------------seattle-----------------", "anchor_text": "Seattle"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&user=Tom+Drabas&userId=44003e7498c6&source=-----e66b26735de5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&user=Tom+Drabas&userId=44003e7498c6&source=-----e66b26735de5---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe66b26735de5&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e66b26735de5---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e66b26735de5--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e66b26735de5--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e66b26735de5--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e66b26735de5--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e66b26735de5--------------------------------", "anchor_text": ""}, {"url": "https://tomekdrabas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tomekdrabas.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tom Drabas"}, {"url": "https://tomekdrabas.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "84 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F44003e7498c6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&user=Tom+Drabas&userId=44003e7498c6&source=post_page-44003e7498c6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F44003e7498c6%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhere-should-i-walk-e66b26735de5&user=Tom+Drabas&userId=44003e7498c6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}