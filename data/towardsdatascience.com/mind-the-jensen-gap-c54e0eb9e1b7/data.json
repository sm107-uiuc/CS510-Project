{"url": "https://towardsdatascience.com/mind-the-jensen-gap-c54e0eb9e1b7", "time": 1683012074.9560819, "path": "towardsdatascience.com/mind-the-jensen-gap-c54e0eb9e1b7/", "webpage": {"metadata": {"title": "Mind the Jensen Gap. When transforming data prior to\u2026 | by Ben Ogorek | Towards Data Science", "h1": "Mind the Jensen Gap", "description": "In Kaggle\u2019s M5 Forecasting \u2014 Accuracy competition, the square root transformation ruined many of my team\u2019s forecasts and led to a selective patching effort in the eleventh hour. Although it turned\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/c/m5-forecasting-accuracy", "anchor_text": "M5 Forecasting \u2014 Accuracy competition", "paragraph_index": 0}, {"url": "https://nousot.com/blog/how-we-won-gold/", "anchor_text": "turned out well", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Poisson_distribution", "anchor_text": "Poisson data", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Poisson_distribution#Related_distributions", "anchor_text": "Wikipedia puts it", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Jensen%27s_inequality", "anchor_text": "Jensen\u2019s Inequality", "paragraph_index": 3}, {"url": "https://math.stackexchange.com/questions/1536459/expected-value-of-square-root-of-poisson-random-variable", "anchor_text": "Mathematics StackExchange", "paragraph_index": 6}, {"url": "https://math.stackexchange.com/users/312/leonbloy", "anchor_text": "contributor Hernan Gonzalez", "paragraph_index": 6}, {"url": "https://github.com/nousot/Public/blob/main/blog/simulate-transformation-bias.R", "anchor_text": "demonstration code", "paragraph_index": 8}, {"url": "https://github.com/nousot/Public/blob/main/blog/simulate-transformation-bias.R", "anchor_text": "Nousot\u2019s Public Github repository", "paragraph_index": 11}, {"url": "https://onlinelibrary.wiley.com/doi/pdf/10.1111/biom.12728", "anchor_text": "Why You Cannot Transform Your Way Out of Trouble for Small Counts", "paragraph_index": 14}, {"url": "https://medium.com/@oseiskar/hello-great-to-hear-you-found-my-kaggle-solution-inspiring-5ba651aee3e0", "anchor_text": "Otto Seiskari\u2019s advice", "paragraph_index": 14}, {"url": "https://arxiv.org/pdf/1712.05267.pdf", "anchor_text": "Gao et al (2018)", "paragraph_index": 16}], "all_paragraphs": ["In Kaggle\u2019s M5 Forecasting \u2014 Accuracy competition, the square root transformation ruined many of my team\u2019s forecasts and led to a selective patching effort in the eleventh hour. Although it turned out well, we were reminded that \u201creconstitution bias\u201d can plague predictions on the original scale, even with common transformations such as the square root.", "For Poisson data, the rationale of the square root is that it is a variance-stabilizing transformation; in theory, the square root of the values are distributed approximately normal with constant variance and a mean that is the square root of the original mean. It is an approximation, and as Wikipedia puts it, one in which the \u201cconvergence to normality (as [the original mean] increases) is far faster than the untransformed variable.\u201d", "Imagine you decide to take square roots in a count data scenario, feeling good reassured that the convergence to normality is \u201cfast.\u201d You then model the mean of square-root transformed data and then get predictions on the square root scale. At some point, especially in a forecasting scenario, you\u2019ll have to get back to the original scale. That probably entails squaring the model-estimated means. The M5 competition served as a reminder that this approach can and will break down.", "Jensen\u2019s Inequality states that for convex functions, the function evaluated at the expectation is less than or equal to the expectation of the function, i.e., g(E[Y]) \u2264 E[g(Y)]. The inequality is flipped for concave functions.", "Similarly, the Jensen Gap is defined as the difference E[g(Y)]-g(E[Y]), which is positive for convex functions g. (As an aside, notice that when g(x) is the square function, the Jensen Gap is the Variance of Y, which had better be non-negative!)", "When considering g(x) as the square function and the square root of Y as the random variable, the Jensen Gap becomes E[Y]-E[sqrt(Y)]\u00b2. Since that quantity is positive, our reconstituted mean will be biased downward. To learn more about the magnitude of the gap, we turn to the Taylor expansion.", "To the Mathematics StackExchange prompt \u201cExpected Value of Square Root of Poisson Random Variable,\u201d contributor Hernan Gonzalez explains the Taylor expansion of a random variable about its mean, as shown in the screenshot below.", "Note that the expansion needs at least a few central moments of the original distribution. For the Poisson, the first three are just the mean parameter.", "Ignoring that the mean estimator is also a random variable, we can run the expectation above through the inverse transformation, i.e., square it, to get an idea of the bias on the original scale for any Poisson mean value (the algebra isn\u2019t here but it\u2019s computed in line 34 of the demonstration code.) Similarly, with properties of the square root of the random variable, it\u2019s straightforward to analyze g(x) = x ^2 in the same way. That opens up the possibility of bias correction, an interesting proposition, albeit one with assumptions and complexities of its own.", "Near the end of his answer, Gonzalez mentions that the approximation \u201cis only useful if\u201d the mean of the original Poisson is quite a bit bigger than 1, clarifying in the comments that this is needed so that \u201cthe terms of the sum decrease quickly.\u201d That follows from the mean being raised to negative powers after the original term.", "In the M5 competition, mean sales for many items were substantially below one, and thus using the square root transformation was a recipe for poor performance. To get an idea of how this plays out in an actual sample, the next section will investigate this phenomenon via simulation.", "In this section, we use the loess smoother to create models on both the original scale and the square root scale, and square the mean estimates of the latter. For simulated Poisson data with both a mean of 20 and a mean of 0.2, we plot the two sets of predictions and examine the bias. The code is under 50 lines and is available in Nousot\u2019s Public Github repository.", "For the case where the mean of the Poisson random variable is 20, the retransformation bias is negative (as Jensen\u2019s Inequality said it would be), but also relatively small. In the code, the first two terms of the Taylor expansion are computed and compared to the empirical bias on the square root scale. At -0.027 and -0.023, respectively, they are relatively close.", "For the case where the mean of the Poisson random variable is 0.20, the picture is much different. While Jensen\u2019s Inequality always holds, the Jensen Gap is now large in a relative sense. Furthermore, the Taylor approximation has completely broken down, with the first two bias terms summing to 0.419 while the empirical bias is -.251 (still on the square root scale).", "David Warton\u2019s 2018 paper \u201cWhy You Cannot Transform Your Way Out of Trouble for Small Counts\u201d demonstrates the hopelessness of getting to the standard assumptions for small-mean count data. For the sparse time series in M5, there was nothing to gain and a lot to lose by taking the square root. At the very least, we should have treated those series differently. (Regarding our use of the Kalman Filter, Otto Seiskari\u2019s advice to tune via cross-validation when the model is misspecified is especially compelling).", "Warton\u2019s paper has some harsh words for users of transformations in general. I still believe that if a transformation brings you closer to the standard assumptions, where your code runs faster and you enjoy nicer properties, then it\u2019s worth considering. But there needs to be an honest exploration of properties of the transformation in the context of the data, and this does not come for free.", "Typically transformations (and their inverses) are either convex or concave, and thus Jensen\u2019s Inequality will guarantee bias in the form of a Jensen Gap. If you\u2019re wondering why you\u2019ve never heard of it, it\u2019s because it\u2019s often written off as approximation error. According to Gao et al (2018),", "\u201cComputing a hard-to-compute [expectation of a function] appears in theoretical estimates in a variety of scenarios from statistical mechanics to machine learning theory. A common approach to tackle this problem is to \u2026 show that the error, i.e., the Jensen gap, would be small enough for the application.\u201d", "When using transformations, the work to understand the properties of inverse-transformation (in the context of the data) is worth it. It\u2019s dangerous out there. Watch your step, and mind the Jensen Gap!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist who enjoys learning and writing about methods. @benogorek on Twitter"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc54e0eb9e1b7&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@baogorek?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@baogorek?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Ben Ogorek"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7ecfd165396&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&user=Ben+Ogorek&userId=a7ecfd165396&source=post_page-a7ecfd165396----c54e0eb9e1b7---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/w/index.php?curid=4379199", "anchor_text": "WillMcC"}, {"url": "https://www.kaggle.com/c/m5-forecasting-accuracy", "anchor_text": "M5 Forecasting \u2014 Accuracy competition"}, {"url": "https://nousot.com/blog/how-we-won-gold/", "anchor_text": "turned out well"}, {"url": "https://en.wikipedia.org/wiki/Poisson_distribution", "anchor_text": "Poisson data"}, {"url": "https://en.wikipedia.org/wiki/Poisson_distribution#Related_distributions", "anchor_text": "Wikipedia puts it"}, {"url": "https://en.wikipedia.org/wiki/Jensen%27s_inequality", "anchor_text": "Jensen\u2019s Inequality"}, {"url": "https://math.stackexchange.com/questions/1536459/expected-value-of-square-root-of-poisson-random-variable", "anchor_text": "Mathematics StackExchange"}, {"url": "https://math.stackexchange.com/users/312/leonbloy", "anchor_text": "contributor Hernan Gonzalez"}, {"url": "https://github.com/nousot/Public/blob/main/blog/simulate-transformation-bias.R", "anchor_text": "demonstration code"}, {"url": "https://github.com/nousot/Public/blob/main/blog/simulate-transformation-bias.R", "anchor_text": "Nousot\u2019s Public Github repository"}, {"url": "https://onlinelibrary.wiley.com/doi/pdf/10.1111/biom.12728", "anchor_text": "Why You Cannot Transform Your Way Out of Trouble for Small Counts"}, {"url": "https://medium.com/@oseiskar/hello-great-to-hear-you-found-my-kaggle-solution-inspiring-5ba651aee3e0", "anchor_text": "Otto Seiskari\u2019s advice"}, {"url": "https://arxiv.org/pdf/1712.05267.pdf", "anchor_text": "Gao et al (2018)"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----c54e0eb9e1b7---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/data-transformation?source=post_page-----c54e0eb9e1b7---------------data_transformation-----------------", "anchor_text": "Data Transformation"}, {"url": "https://medium.com/tag/forecasting?source=post_page-----c54e0eb9e1b7---------------forecasting-----------------", "anchor_text": "Forecasting"}, {"url": "https://medium.com/tag/bias?source=post_page-----c54e0eb9e1b7---------------bias-----------------", "anchor_text": "Bias"}, {"url": "https://medium.com/tag/statistics?source=post_page-----c54e0eb9e1b7---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&user=Ben+Ogorek&userId=a7ecfd165396&source=-----c54e0eb9e1b7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&user=Ben+Ogorek&userId=a7ecfd165396&source=-----c54e0eb9e1b7---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc54e0eb9e1b7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c54e0eb9e1b7---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c54e0eb9e1b7--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@baogorek?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@baogorek?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ben Ogorek"}, {"url": "https://medium.com/@baogorek/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "177 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa7ecfd165396&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&user=Ben+Ogorek&userId=a7ecfd165396&source=post_page-a7ecfd165396--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F536bc54ba88c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fmind-the-jensen-gap-c54e0eb9e1b7&newsletterV3=a7ecfd165396&newsletterV3Id=536bc54ba88c&user=Ben+Ogorek&userId=a7ecfd165396&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}