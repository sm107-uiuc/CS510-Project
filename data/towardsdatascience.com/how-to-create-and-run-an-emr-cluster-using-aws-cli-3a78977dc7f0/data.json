{"url": "https://towardsdatascience.com/how-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0", "time": 1683011372.838793, "path": "towardsdatascience.com/how-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0/", "webpage": {"metadata": {"title": "How to create and run an EMR cluster using AWS CLI | by Tran Nguyen | Towards Data Science", "h1": "How to create and run an EMR cluster using AWS CLI", "description": "\u201cApache Spark is a unified analytics engine for large-scale data processing\u201d. Spark is considered as \u201cthe king of the \u2018big data\u2019 jungle\u201d with various applications in data analysis, machine learning\u2026"}, "outgoing_paragraph_urls": [{"url": "https://spark.apache.org/docs/latest/", "anchor_text": "Apache Spark is a unified analytics engine for large-scale data processing", "paragraph_index": 0}, {"url": "https://spark.apache.org/docs/latest/", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/nhntran/aws_spark_cluster_tutorial", "anchor_text": "my Github", "paragraph_index": 4}, {"url": "https://aws.amazon.com/premiumsupport/knowledge-center/emr-default-role-invalid/", "anchor_text": "this instruction", "paragraph_index": 31}, {"url": "https://console.aws.amazon.com/vpc/", "anchor_text": "VPC Dashboard on AWS", "paragraph_index": 36}, {"url": "https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html", "anchor_text": "AWS site", "paragraph_index": 36}, {"url": "https://github.com/nhntran/aws_spark_cluster_tutorial", "anchor_text": "my Github", "paragraph_index": 55}], "all_paragraphs": ["\u201cApache Spark is a unified analytics engine for large-scale data processing\u201d. Spark is considered as \u201cthe king of the \u2018big data\u2019 jungle\u201d with various applications in data analysis, machine learning, streaming and graph analytics, etc. There are 4 different Spark modes: (1) Local mode: Spark on a single machine such as a laptop for learning syntax and prototyping the project; the other 3 modes are cluster manager modes: (2) Stand-alone mode is used for working on a private cluster; (3) YARN and (4) Mesos modes are used when sharing cluster with a team. With stand-alone mode, Spark is deployed on a private cluster such as EC2 on Amazon Web Service AWS. A Spark cluster includes multiple machines. To use Spark code on each machine, Spark and its dependencies need to be downloaded and installed manually. With Elastic Map Reduce service, EMR, from AWS, everything is ready to use without any manual installation. So instead of using EC2, we use the EMR service to set up Spark clusters.", "I did spend many hours struggling to create, set up, and run the Spark cluster on EMR using AWS Command Line Interface, AWS CLI. Although there are a few tutorials for this task that I found or were provided through courses, most of them are so frustrating to follow. Some are not clear enough; some miss some crucial steps; or assume the learners know some prior knowledge about AWS, CLI configurations, etc. After successfully setting up and getting the cluster running, I realized that this task is actually not that complicated; and we should get it done with ease. I don\u2019t want to see people struggling with this anymore. Therefore, I decided to make this tutorial.", "This article assumes that you already have some working knowledge of Spark, PySpark, command-line environment, and AWS. Specifically, this article is for readers who know why they need to create the Spark cluster :). For more about Spark, please read the reference here.", "This is a long and detailed tutorial. In brief, all the steps include:", "Please feel free to skip any step that you already know. The Jupyter notebook version of this tutorial, together with other tutorials on Spark and many more data science tutorials could be found on my Github. Now, let\u2019s dive in!", "I am so glad that many of you found this tutorial useful. It is my honor to discuss any issue you encountered during the EMR creating process with you all. Based on some of our discussions, here are some updates for this tutorial.", "1. For this tutorial, AWS regular account should be used instead of AWS Educate account. The AWS regular account provides users the full access to AWS resources and IAM roles; while educate account has some limited access.", "2. This is your responsibility for monitoring usage charges on the AWS account you use. Remember to terminate the cluster and other related resources each time you finish working. I have implemented the EMR cluster many times; and this tutorial should produce no cost or cost less than $0.5 on AWS.", "3. The AWS console and Udacity content are subjected to change/upgrade through time, so I would recommend you to search AWS site and your Udacity\u2019s lessons for any updated tutorials/guidelines. This tutorial was generated according to the AWS console in July, 2020.", "4. This tutorial is produced using Chrome and Mac OS X. It should not be so much different on Windows platform.", "From the AWS console, click onService, type \u2018IAM\u2019 to go to IAM console:", "=> Choose User => Add user => Enter a user name such as 'emr_user' , Choose Access type as Programmatic access, and then Next: Permissions.", "Click on Attach existence policies directly page, type and set permission as Administrator Access and then choose Next: Tags.", "Skip this tag page and choose Next: Review => Choose Create user => Save the user name, Access Key and Secret Access Key.", "We will use this IAM user and the access and secret key to set up and access AWS via AWS CLI.", "From the AWS console, click on Service, type 'EC2' to go to EC2 console", "Choose Key Pairs in Network & Security on the left panel => Choose Create key pair", "Type the name for the key pairs, such as \"emr-cluster\", File format: pem => Choose Create key pair . After this step, a .pem file will be automatically downloaded, in this case, the file name is emr_cluster.pem. We will use this file in Step 6.", "This step will help us automatically access AWS on the awscli environment using the user credentials we got on Step 2 above.", "There are 2 approaches for this set-up: manually creating the credentials and config files (approach 1) or creating these files using theaws command (approach 2). You can use either one.", "Create the credentials file on the terminal as follow (you can use nano or any other text editor of your choice):", "$mkdir .aws (period to denote a hidden directory)", "On the terminal, type $aws configure and type in the required information as followed:", "The 2 files will be automatically created in the hidden folder .aws, usually located at root directory as follow:", "To connect to the cluster, we need the .pem file created in step 3. Move the .pem file we downloaded in Step 3 to a desire location used for the project. For me, I put it to the same location as credentials and config files in the hidden folder .aws located at the root directory ~/.aws/emr-cluster.pem )", "To verify if we successfully install awscli and set up the credentials, type some aws commands such as", "Now we are ready to create our EMR cluster on the terminal. On the terminal, type the command:", "The explanation for the EMR script components:", "Desired output after we create an EMR cluster would be:", "Using the ClusterId to check status and information of the cluster (j- EXAMPLECLUSTERID) using the command:", "We should wait for a few minutes for the cluster to be available (Status changes to \u2018available\u2019) before proceeding to the next step.", "***Update 1: If you run into the problem that \"EMR_DefaultRole is invalid\" or \"EMR_EC2_DefaultRole is invalid\" error when creating an Amazon EMR cluster, you may have to delete the roles and the instance profile; then recreate the roles as this instruction. Thank Trevor S. for discussing this issue.", "***Update 2: To make the cluster available for the notebook on EMR, we may need to include the SubnetIds in \u2014 ec2-attributes:", "(Thank Saverio G. for discussing me about this issue.)", "Click on the VPCSubnets tab on the EMR console to choose from the list.", "Another safe way for the beginner: Create a similar EMR cluster using the AWS console. Then look at the \u201cNetwork and hardware\u201d session on the Summary page of that cluster to see the Subnet ID:", "You can access Subnets via VPC Dashboard on AWS. More about subnet and VPC could be found on the AWS site.", "From the AWS console, click on Service, type EMR, and go to EMR console.", "=> Choose Clusters => Choose the name of the cluster on the list, in this case, is test-emr-cluster", "On the Summary tab, scroll down to see the part Security and access, choose the Security groups for Master link", "Choose the Security group ID for ElasticMapReduce-master", "Scroll down on Inbound rules, Edit inbound rules => For safety, delete any SSH rule if have, then choose Add Rule => Choose Type: SSH, TCP for Protocol and 22 for Port Range => For source, select My IP => Choose Save .", "If we see the screen with the EMR letter as below, congratulations, you successfully create, set up, and connect to the EMR cluster using AWS CLI !!!!", "Close the connection to the cluster using the command $logout .", "If we see the screen with the EMR letter, congratulations, you successfully create, set up, and connect to the EMR cluster using AWS CLI !!!!", "Create a simple Spark task, for example, create a Spark data frame containing the time as type string and then convert that column to a different format.", "On the cluster terminal, create the file test_emr.py", "Copy and paste this script to test_emr.py", "The content of the file as shown on nano text editor:", "Submit the script on the cluster terminal using the command:", "When the task runs, it may get overwhelming with any information on the terminal, which is normal in Spark. The output could be found among the info logging:", "Remember to terminate the cluster when not using it anymore.", "Type logout to log out of the cluster. Then terminate the cluster using this command:", "Notice that we can easily create a cluster with the same configurations again using the AWS CLI command, which could be found when clicking on the AWS CLI export tab when we choose the terminated cluster `test-emr-cluster` on the EMR console:", "I hope no one has to struggle to create, set up, and run the Spark cluster on EMR using AWS CLI anymore. Please let me know if you have any issues or find anything wrong with this tutorial.", "The Jupyter notebook version of this tutorial, together with other tutorials on Spark and many more data science tutorials could be found on my Github. Please enjoy!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "My random thoughts through the career development process"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F3a78977dc7f0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@tranhnnguyenvn?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tranhnnguyenvn?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Tran Nguyen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F90ed820b9879&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&user=Tran+Nguyen&userId=90ed820b9879&source=post_page-90ed820b9879----3a78977dc7f0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://spark.apache.org/docs/latest/", "anchor_text": "Apache Spark is a unified analytics engine for large-scale data processing"}, {"url": "https://spark.apache.org/docs/latest/", "anchor_text": "here"}, {"url": "https://github.com/nhntran/aws_spark_cluster_tutorial", "anchor_text": "my Github"}, {"url": "https://www.udacity.com/course/data-engineer-nanodegree--nd027", "anchor_text": "the Data Engineer nanodegree program on Udacity."}, {"url": "https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/", "anchor_text": "AWS site"}, {"url": "https://console.aws.amazon.com/", "anchor_text": "Log into"}, {"url": "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html", "anchor_text": "configure and enable a virtual multi-factor authentication (MFA)"}, {"url": "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html", "anchor_text": "AWS guide here"}, {"url": "https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-bootstrap.html", "anchor_text": "AWS site"}, {"url": "https://aws.amazon.com/premiumsupport/knowledge-center/emr-default-role-invalid/", "anchor_text": "this instruction"}, {"url": "https://console.aws.amazon.com/vpc/", "anchor_text": "VPC Dashboard on AWS"}, {"url": "https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html", "anchor_text": "AWS site"}, {"url": "https://github.com/nhntran/aws_spark_cluster_tutorial", "anchor_text": "my Github"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----3a78977dc7f0---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/tag/spark?source=post_page-----3a78977dc7f0---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/aws?source=post_page-----3a78977dc7f0---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/aws-cli?source=post_page-----3a78977dc7f0---------------aws_cli-----------------", "anchor_text": "Aws Cli"}, {"url": "https://medium.com/tag/programming?source=post_page-----3a78977dc7f0---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&user=Tran+Nguyen&userId=90ed820b9879&source=-----3a78977dc7f0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&user=Tran+Nguyen&userId=90ed820b9879&source=-----3a78977dc7f0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F3a78977dc7f0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----3a78977dc7f0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----3a78977dc7f0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tranhnnguyenvn?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@tranhnnguyenvn?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Tran Nguyen"}, {"url": "https://medium.com/@tranhnnguyenvn/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "105 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F90ed820b9879&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&user=Tran+Nguyen&userId=90ed820b9879&source=post_page-90ed820b9879--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff136f72e8c83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-create-and-run-an-emr-cluster-using-aws-cli-3a78977dc7f0&newsletterV3=90ed820b9879&newsletterV3Id=f136f72e8c83&user=Tran+Nguyen&userId=90ed820b9879&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}