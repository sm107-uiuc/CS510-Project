{"url": "https://towardsdatascience.com/web-scraping-advanced-football-statistics-11cace1d863a", "time": 1682996788.998512, "path": "towardsdatascience.com/web-scraping-advanced-football-statistics-11cace1d863a/", "webpage": {"metadata": {"title": "Web Scraping Advanced Football Statistics | by Sergi Lehkyi | Towards Data Science", "h1": "Web Scraping Advanced Football Statistics", "description": "Lately I\u2019ve being debating about the role of luck in football. Or maybe it\u2019s not pure luck, but a skill? Do teams win their leagues purely on skill? Or the importance of luck is quite huge? Who is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://understat.com/", "anchor_text": "understat.com", "paragraph_index": 4}, {"url": "https://understat.com", "anchor_text": "understat.com", "paragraph_index": 5}, {"url": "https://understat.com/league/La_liga/2018", "anchor_text": "understat.com", "paragraph_index": 31}, {"url": "https://github.com/slehkyi/notebooks-for-articles/blob/master/web_scrapping_understatcom_for_xG_dataset.ipynb", "anchor_text": "Github", "paragraph_index": 37}, {"url": "https://www.kaggle.com/slehkyi/web-scraping-football-statistics-2014-now?scriptVersionId=16171675", "anchor_text": "Kaggle", "paragraph_index": 37}, {"url": "https://www.kaggle.com/slehkyi/extended-football-stats-for-european-leagues-xg", "anchor_text": "here", "paragraph_index": 38}], "all_paragraphs": ["Lately I\u2019ve being debating about the role of luck in football. Or maybe it\u2019s not pure luck, but a skill? Do teams win their leagues purely on skill? Or the importance of luck is quite huge? Who is lucky and who is not? Did that team deserve the relegation? And many-many more.", "But as I am a data guy, I thought, so let\u2019s get the data and find that out. Although, how do you measure luck? How do you measure skill? There is no such a single metric like in FIFA or PES computer games. We have to look at the general picture, on a long-term data with multiple variables and taking into account the context of every single game played. Because in some moments the player of one team just don\u2019t have enough luck to score the winning goal on last minutes after total domination over the opponent and it ends up as equalizer and both teams get 1 point, while it was clear that the first team deserved the victory. One team was lucky, another wasn\u2019t. Yes, in this situation it\u2019s a luck, because one team did everything, created enough dangerous moments, but didn\u2019t score. It happens. And that\u2019s why we love football. Because everything can happen here.", "Although you cannot measure luck, but you get an understanding of how the team played based on a relatively new metric in football \u2014 xG, or expected goals.", "xG \u2014 is a statistical measure of the quality of chances created and conceded", "You can find the data with this metric at understat.com. This is the web I am about to scrap.", "So what the heck is xG and why is it important. Answer we can find at understat.com home page.", "Expected goals (xG) is the new revolutionary football metric, which allows you to evaluate team and player performance.", "In a low-scoring game such as football, final match score does not provide a clear picture of performance.", "This is why more and more sports analytics turn to the advanced models like xG, which is a statistical measure of the quality of chances created and conceded.", "Our goal was to create the most precise method for shot quality evaluation.", "For this case, we trained neural network prediction algorithms with the large dataset (>100,000 shots, over 10 parameters for each).", "The researchers trained neural network based on situations that led to goals and now it gives us an estimation of how many real chances did the team have during the match. Because you can have 25 shots during the game, but if they all are from long distance or from low angle or too weak, shorter \u2014 low quality shots, they won\u2019t lead to the goal. While some \u201cexperts\u201d that didn\u2019t see the game will say that the team dominated, created tons of chances bla-bla-bla-bla. Quality of those chances matters. And that\u2019s where the xG metric becomes very handy. With this metric you now understand that Messi creates goals in conditions where it\u2019s very hard to score, or the goalkeeper makes save where it should\u2019ve being goal. All these things add up and we see champions that have skilled players and some luck and we see losers that might have good players, but don\u2019t have enough luck. And my intent with this project is to understand and present these numbers to show the role of luck in today\u2019s football.", "We start by importing libraries that will be used in this project:", "In any web scraping project first thing you have to do is to research the web-page you want to scrape and understand how it works. That\u2019s fundamental. So we start from there.", "On the home page we can notice that the site has data for 6 European Leagues:", "And we also see that the data collected is starting from season 2014/2015. Another notion we make is the structure of URL. It is \u2018 https://understat.com/league' + '/name_of_the_league' + '/year_start_of_the_season '", "So we create variables with this data to be able to select any season or any league.", "Next step is to understand where the data is located on the web-page. For this we open Developer Tools in Chrome, go to tab \u201cNetwork\u201d, find file with data (in this case 2018) and check the \u201cResponse\u201d tab. This is what we will get after running requests.get(URL)", "After going through content of the web-page we find that the data is stored under \u201cscript\u201d tag and it is JSON encoded. So we will need to find this tag, get JSON from it and convert it into Python readable data structure.", "We found that the data interesting us is stored in teamsData variable, after creating a soup of html tags it becomes just a string, so we find that text and extract JSON from it.", "Once we have gotten our JSON and cleaned it up we can convert it into Python dictionary and check how it looks (commented print statement).", "When we start to research the data we understand that this is a dictionary of dictionaries of 3 keys: id, title and history. The first layer of dictionary uses ids as keys too.", "Also from this we understand that history has data regarding every single match the team played in its own league (League Cup or Champions League games are not included).", "We can gather teams names after going over the first layer dictionary.", "The history is the array of dictionaries where keys are names of metrics (read column names) and values are values, despite how tautological is that :D.", "We understand that column names repeat over and over again so we add them to separate list. Also checking how the sample values look like.", "After outputting few print statements we find that Sevilla has the id=138, so getting all the data for this team to be able to reproduce the same steps for all teams in the league.", "For the sake of leaving this article clean I won\u2019t add the content of created DataFrame, but in the end you will find links to IPython notebooks on Github and Kaggle with all code and outputs. Here just samples for the context.", "So, wualya, congrats! We have the data for all matches of Sevilla in season 2018\u20132019 within La Liga! Now we want to get that data for all Spanish teams. Let\u2019s loop through those bites baby!", "After this code finishes running we have a dictionary of DataFrames where key is the name of the team and value is the DataFrame with all games of that team.", "When we look at the content of DataFrame we can notice that such metrics as PPDA and OPPDA (ppda and ppda_allowed) are represented as total amounts of attacking/defensive actions, but in the original table it is shown as coefficients. Let\u2019s fix that!", "Now we have all our numbers, but for every single game. What we need is the totals for the team. Let\u2019s find out the columns we have to sum up. For this we go back to original table at understat.com and we find that all metrics should be summed up and only PPDA and OPPDA are means in the end.", "We are ready to calculate our totals and means. For this we loop through dictionary dataframes and call .sum() and .mean() DataFrame methods that return Series, that\u2019s why we add .transpose() to those calls. We put these new DataFrames into a list and after that .concat() them into a new DataFrame full_stat.", "Next we reorder columns for better readability, sort rows based on points, reset index and add column \u2018position\u2019.", "Also in the original table we have values of differences between expected metrics and real. Let\u2019s add those too.", "Converting floats to integers where appropriate.", "Prettifying output and final view of a DataFrame.", "Now when we got our numbers for one season from one league we can replicate the code and put it into the loop to get all data for all seasons of all leagues. I won\u2019t put this code here, but will leave a link to entire scraping solution at my Github and Kaggle.", "After looping through all leagues and all seasons and few manipulation steps to make data exportable I\u2019ve got a CSV file with scraped numbers. The dataset is available here.", "Hope you found it useful and got some valuable info. Anyway, if you reached this point I just want to say thank you for reading, for allocating your time, energy and attention to my 5 cents and wish you a lot of love and happiness, you\u2019re awesome!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data and Cloud Developer, love technology in general, maybe too much humor and never too serious, based in amazing Barcelona"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F11cace1d863a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sergilehkyi.medium.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Sergi Lehkyi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F82a9856ae35c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&user=Sergi+Lehkyi&userId=82a9856ae35c&source=post_page-82a9856ae35c----11cace1d863a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@guoshiwushuang?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Michael Lee"}, {"url": "https://unsplash.com/search/photos/soccer-stadium?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://understat.com/", "anchor_text": "understat.com"}, {"url": "https://understat.com", "anchor_text": "understat.com"}, {"url": "https://understat.com/league/La_liga/2018", "anchor_text": "understat.com"}, {"url": "https://github.com/slehkyi/notebooks-for-articles/blob/master/web_scrapping_understatcom_for_xG_dataset.ipynb", "anchor_text": "Github"}, {"url": "https://www.kaggle.com/slehkyi/web-scraping-football-statistics-2014-now?scriptVersionId=16171675", "anchor_text": "Kaggle"}, {"url": "https://www.kaggle.com/slehkyi/extended-football-stats-for-european-leagues-xg", "anchor_text": "here"}, {"url": "http://sergilehkyi.com/web-scraping-advanced-football-statistics/", "anchor_text": "http://sergilehkyi.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----11cace1d863a---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/web-scraping?source=post_page-----11cace1d863a---------------web_scraping-----------------", "anchor_text": "Web Scraping"}, {"url": "https://medium.com/tag/football?source=post_page-----11cace1d863a---------------football-----------------", "anchor_text": "Football"}, {"url": "https://medium.com/tag/data?source=post_page-----11cace1d863a---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/tag/sports-analytics?source=post_page-----11cace1d863a---------------sports_analytics-----------------", "anchor_text": "Sports Analytics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&user=Sergi+Lehkyi&userId=82a9856ae35c&source=-----11cace1d863a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&user=Sergi+Lehkyi&userId=82a9856ae35c&source=-----11cace1d863a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F11cace1d863a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----11cace1d863a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----11cace1d863a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----11cace1d863a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----11cace1d863a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----11cace1d863a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----11cace1d863a--------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sergi Lehkyi"}, {"url": "https://sergilehkyi.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "598 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F82a9856ae35c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&user=Sergi+Lehkyi&userId=82a9856ae35c&source=post_page-82a9856ae35c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F65a0e191fdf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fweb-scraping-advanced-football-statistics-11cace1d863a&newsletterV3=82a9856ae35c&newsletterV3Id=65a0e191fdf8&user=Sergi+Lehkyi&userId=82a9856ae35c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}