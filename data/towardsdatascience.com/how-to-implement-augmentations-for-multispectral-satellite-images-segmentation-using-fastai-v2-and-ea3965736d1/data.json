{"url": "https://towardsdatascience.com/how-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1", "time": 1683013924.501429, "path": "towardsdatascience.com/how-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1/", "webpage": {"metadata": {"title": "How to implement augmentations for Multispectral Satellite Images Segmentation using Fastai-v2 and Albumentations | by Maur\u00edcio Cordeiro | Towards Data Science", "h1": "How to implement augmentations for Multispectral Satellite Images Segmentation using Fastai-v2 and Albumentations", "description": "For information about the course Introduction to Python for Scientists (available on YouTube) and other articles like this, please visit my website cordmaur.carrd.co. We know that image augmentation\u2026"}, "outgoing_paragraph_urls": [{"url": "https://youtu.be/oQaoj6LE5E4", "anchor_text": "available on YouTube", "paragraph_index": 0}, {"url": "http://cordmaur.carrd.co/", "anchor_text": "cordmaur.carrd.co", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/how-to-create-a-datablock-for-multispectral-satellite-image-segmentation-with-the-fastai-v2-bc5e82f4eb5", "anchor_text": "\u201cHow to create a DataBlock for Multispectral Satellite Image Segmentation with the Fastai-v2\u201d", "paragraph_index": 2}, {"url": "https://www.kaggle.com/sorour/95cloud-cloud-segmentation-on-satellite-images", "anchor_text": "\u201c95-Cloud: Cloud Segmentation on Satellite Images\u201d", "paragraph_index": 3}, {"url": "https://medium.com/analytics-vidhya/a-simple-cloud-detection-walk-through-using-convolutional-neural-network-cnn-and-u-net-and-bc745dda4b04", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://www.kaggle.com/cordmaur/remotesensing-fastai2-multiband-augmentations", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://towardsdatascience.com/how-to-create-a-datablock-for-multispectral-satellite-image-segmentation-with-the-fastai-v2-bc5e82f4eb5", "anchor_text": "story", "paragraph_index": 5}, {"url": "https://albumentations.ai/docs/getting_started/transforms_and_targets/", "anchor_text": "here", "paragraph_index": 12}, {"url": "https://www.kaggle.com/cordmaur/remotesensing-fastai2-multiband-augmentations", "anchor_text": "here", "paragraph_index": 17}, {"url": "https://www.linkedin.com/in/cordmaur/", "anchor_text": "https://www.linkedin.com/in/cordmaur/", "paragraph_index": 19}], "all_paragraphs": ["For information about the course Introduction to Python for Scientists (available on YouTube) and other articles like this, please visit my website cordmaur.carrd.co.", "We know that image augmentation is a key factor for computer vision tasks. It helps the algorithm to avoid overfitting, as well as it limits the need for huge training datasets [1]. Most deep learning frameworks have a vision module that implements augmentation \u201cout-of-the-box\u201d, as it is the case of Keras, PyTorch and Fastai libraries. The problem starts to rise when we need to feed the model with images that don\u2019t match the 3-channel standard (RGB). That\u2019s the case of most remote sensing applications (ex. Figure 1) and a number of other areas.", "To overcome this limitation, I will show how to implement a multispectral augmentation using the Albumentations library [2] and plug it into a Fastai v2 DataBlock for further training. The principles about how to create a DataBlock for satellite images can be found in my previous story \u201cHow to create a DataBlock for Multispectral Satellite Image Segmentation with the Fastai-v2\u201d.", "The data we will be using is a public dataset available at Kaggle, called \u201c95-Cloud: Cloud Segmentation on Satellite Images\u201d , that contains training patches extracted from 57 Landsat 8 scenes. This dataset is, in fact, an extension of a previous Kaggle dataset that has been used to train a very simple Fastai v1 model (here). The patches are 384x384 size and contains 4 bands \u2014 Red, Green, Blue and Near Infrared. Additionally, there is a patch with the ground truth that mark the clouds. As our objective is just to show how to implement the augmentation, without further considerations about accuracy, we will stay with the latest version only.", "To make life easier, all the code shown here is ready to be used in a Kaggle notebook (here), so we will start by installing the necessary dependencies:", "Besides the problem that the vision libraries don\u2019t support multichannel images, this dataset keeps each band into a separate folder. So, in order to open an image, we first need to correct the paths for each band and then collate them into a single 4-channel image. Instead of subclassing the TensorImage class, as we did in the previous story, I will try to make things easier here and open the image as a tensor. The drawback of this approach is that we will not be able to use internal visualization functions of Fastai like DataLoader.showbatch(), as it doesn\u2019t know how to display the 4 bands.", "The first step will be to create three base functions:", "Once our functions are defined, we will test them by passing one item into a Pipeline. The Pipeline is a sequence of functions that are applied to the one item to transform it the way we want.", "To load the items, we will consider that our base images are in the red folder, and we will then get the other bands automatically. So, our pipeline will be composed with two functions: 1- get_filenames and 2- open_ms_tif. Our final image will have shape (4, 384, 384). To display it with matplotlib will do a final permutation in the dimensions to put the channels in the last axis to be (384, 384, 4), and also slice out the Nir band using [\u2026, :3].", "Considering that our final objective is to segment the clouds in the image, we have to apply the same augmentations to the ground truth. So, a similar procedure will be done to open the mask.", "As we can see, our pipeline worked just fine. I used the .show() method of TensorMask with context ctx argument, just to show that in Fastai you can force the output to any context. Another interesting command is the partial, that returns reference to a function with a given set of parameters pre-filled.", "Before going into the augmentations, we will first create a dataset and a dataloader, just to check if everything is working as desired. Note that we don\u2019t need to specify the get_items function in the DataBlock, because our source is already a list of items. We will also define a function show_img() to display the multichannel tensor.", "For the augmentations we will be using the Albumentations [2] library. There is a huge list of possible augmentations, separated in different classes like Pixel level and spatial-level transformations. For this tutorial we will keep it simple and use just the basic shift, flip, scale, rotate, brightness and contrast. The full list can be accessed by their online documentation (here).", "One important aspect of the Albumentations library is that it supports augmentation for segmentation and for object detection. That means it can apply the corresponding augmentation that was applied to the image to its target (mask or bounding box). That\u2019s a crucial point, as we need to keep our cloud masks matching the augmented images.", "Fastai will apply the augmentation to a tuple (X, Y), where X is the image and Y is the mask. To make it work within the framework it is necessary to subclass the ItemTransform class and create the encodes() method. To make it generic, our subclass will receive the desired transformation at the time of instance creation, like so:", "Note that there is a split_idx=0 defined within the class. That\u2019s to tell Fastai to augment just the training dataset, and not the validation dataset. Now that we have set up our transformation class, let\u2019s use it in the DataBlock. We will recreate the DataBlock, now with item_tfms parameter set to aug. We will then ask the dataloader to create one item multiple times to see how it goes.", "As we saw in this story, implementing data augmentation for multispectral satellite images is just a matter of finding the right tools. In this regard, Albumentations is a great companion, as it can deal with many channels and augment the targets as well.", "As mentioned before, the notebook with all the code can be found at Kaggle (here). There, it will be also possible to find a comparison of the learning accuracy with and without the augmentations.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Ph.D. Geospatial Data Scientist and water specialist at Brazilian National Water and Sanitation Agency. To get in touch: https://www.linkedin.com/in/cordmaur/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fea3965736d1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://cordmaur.medium.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Maur\u00edcio Cordeiro"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8878c77fe1a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=post_page-8878c77fe1a3----ea3965736d1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://youtu.be/oQaoj6LE5E4", "anchor_text": "available on YouTube"}, {"url": "http://cordmaur.carrd.co/", "anchor_text": "cordmaur.carrd.co"}, {"url": "https://towardsdatascience.com/how-to-create-a-datablock-for-multispectral-satellite-image-segmentation-with-the-fastai-v2-bc5e82f4eb5", "anchor_text": "\u201cHow to create a DataBlock for Multispectral Satellite Image Segmentation with the Fastai-v2\u201d"}, {"url": "https://www.kaggle.com/sorour/95cloud-cloud-segmentation-on-satellite-images", "anchor_text": "\u201c95-Cloud: Cloud Segmentation on Satellite Images\u201d"}, {"url": "https://medium.com/analytics-vidhya/a-simple-cloud-detection-walk-through-using-convolutional-neural-network-cnn-and-u-net-and-bc745dda4b04", "anchor_text": "here"}, {"url": "https://www.kaggle.com/sorour/95cloud-cloud-segmentation-on-satellite-images", "anchor_text": "https://www.kaggle.com/sorour/95cloud-cloud-segmentation-on-satellite-images"}, {"url": "https://www.kaggle.com/cordmaur/remotesensing-fastai2-multiband-augmentations", "anchor_text": "here"}, {"url": "https://download.pytorch.org/whl/torch_stable.html", "anchor_text": "https://download.pytorch.org/whl/torch_stable.html"}, {"url": "https://towardsdatascience.com/how-to-create-a-datablock-for-multispectral-satellite-image-segmentation-with-the-fastai-v2-bc5e82f4eb5", "anchor_text": "story"}, {"url": "https://albumentations.ai/docs/getting_started/transforms_and_targets/", "anchor_text": "here"}, {"url": "https://www.kaggle.com/cordmaur/remotesensing-fastai2-multiband-augmentations", "anchor_text": "here"}, {"url": "https://doi.org/10.1186/s40537-019-0197-0", "anchor_text": "https://doi.org/10.1186/s40537-019-0197-0"}, {"url": "https://doi.org/10.3390/info11020125", "anchor_text": "https://doi.org/10.3390/info11020125"}, {"url": "https://medium.com/tag/augmentation?source=post_page-----ea3965736d1---------------augmentation-----------------", "anchor_text": "Augmentation"}, {"url": "https://medium.com/tag/remote-sensing?source=post_page-----ea3965736d1---------------remote_sensing-----------------", "anchor_text": "Remote Sensing"}, {"url": "https://medium.com/tag/fastai?source=post_page-----ea3965736d1---------------fastai-----------------", "anchor_text": "Fastai"}, {"url": "https://medium.com/tag/pytorch?source=post_page-----ea3965736d1---------------pytorch-----------------", "anchor_text": "Pytorch"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ea3965736d1---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=-----ea3965736d1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=-----ea3965736d1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fea3965736d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ea3965736d1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ea3965736d1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ea3965736d1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ea3965736d1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ea3965736d1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ea3965736d1--------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://cordmaur.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Maur\u00edcio Cordeiro"}, {"url": "https://cordmaur.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.7K Followers"}, {"url": "https://www.linkedin.com/in/cordmaur/", "anchor_text": "https://www.linkedin.com/in/cordmaur/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8878c77fe1a3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=post_page-8878c77fe1a3--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa9b1761194a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-implement-augmentations-for-multispectral-satellite-images-segmentation-using-fastai-v2-and-ea3965736d1&newsletterV3=8878c77fe1a3&newsletterV3Id=a9b1761194a9&user=Maur%C3%ADcio+Cordeiro&userId=8878c77fe1a3&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}