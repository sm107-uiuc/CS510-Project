{"url": "https://towardsdatascience.com/whos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316", "time": 1682993689.5963368, "path": "towardsdatascience.com/whos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316/", "webpage": {"metadata": {"title": "Who\u2019s talking? \u2014 Using K-Means clustering to sort neural events in Python | by Carsten Klein | Towards Data Science", "h1": "Who\u2019s talking? \u2014 Using K-Means clustering to sort neural events in Python", "description": "Epilepsy is a form of brain disorder in which an excess of synchronous electrical brain activity leads to seizures which can range from having no outward symptom at all to jerking movements\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/using-signal-processing-to-extract-neural-events-in-python-964437dc7c0", "anchor_text": "previous article", "paragraph_index": 0}, {"url": "https://github.com/akcarsten/spike_sorting", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://twitter.com/ak_carsten", "anchor_text": "Twitter", "paragraph_index": 2}, {"url": "https://www.linkedin.com/in/carsten-klein/", "anchor_text": "LinkedIn", "paragraph_index": 2}, {"url": "http://www.scholarpedia.org/article/Spike_sorting", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://github.com/akcarsten/akcarsten.github.io/blob/master/spike_sorting/Spike_sorting%20.ipynb", "anchor_text": "Jupyter Notebook", "paragraph_index": 4}, {"url": "https://github.com/akcarsten/spike_sorting", "anchor_text": "here", "paragraph_index": 11}, {"url": "https://twitter.com/ak_carsten", "anchor_text": "Twitter", "paragraph_index": 11}, {"url": "https://www.linkedin.com/in/carsten-klein/", "anchor_text": "LinkedIn", "paragraph_index": 11}], "all_paragraphs": ["Epilepsy is a form of brain disorder in which an excess of synchronous electrical brain activity leads to seizures which can range from having no outward symptom at all to jerking movements (tonic-clonic seizure) and loss of awareness (absence seizure). For some epilepsy patients surgical removal of the effected brain tissue can be an effective treatment. But before a surgery can be performed the diseased brain tissue needs to be precisely localized. To find this seizure focus, recording electrodes are inserted into the patients brain with which the neural activity can be monitored in real time. In a previous article we looked at how to process such electrophysiological data from a human epilepsy patient in order to extract spike events.", "Such spike events as depicted above reflect the activity of individual neurons and therefore can give important insights into the nature of the disease. However as the plot below also illustrates a single electrode will typically pick up signals from more than one neuron at a time. While this might not be an issue for locating the seizure focus, research questions related to the mechanisms behind epileptic seizures often require a more detailed understanding of which neuron was active at what time. So how can we figure out the how many neurons were contributing to our signal and when each of them was active?", "Now before we start answering these questions I want to remind you that you can find the Jupyter Notebook with the code for this article here. And of course feel free to follow me on Twitter or connect via LinkedIn.", "Figuring out which of the above spike wave shapes belongs to a certain neuron is a challenging task which is further complicated by the fact that we do not have any ground truth data to compare our results to. So applying an unsupervised clustering algorithm to sort our spike data seems like a good choice. Spike sorting is actually a complex topic and an ongoing field of research and if you want to have a more detailed overview you can take a look here. In the following we will use K-means clustering to sort our spikes and to outline the general process of spike sorting. However it should be noted that in practice K-means is not the optimal algorithm for sorting spikes. As mentioned above there are more sophisticated algorithms available which will yield better results but for illustrating the general process of extracting and sorting spikes K-means well do.", "So the first thing we need to do is decide what features of our spike wave forms we want to feed into our algorithm. At the moment each wave form is defined by 90 samples which equals a total duration of ~2.8 milliseconds. However not all samples are equally informative. For example, sample number one of most wave forms fluctuates somewhere around 0. Whereas samples 25 to 30 represent the first positive deflection of the waveform and seem to fall into two groups, one with a high peak and one with low peak. So we should select some features that represent the spike wave shapes well and get rid of the other ones. One way to do so could be going for the max and min amplitude of the spike or its width or timing parameters. Another common approach is to apply principal component analysis (PCA) and use the principal components as features. The PCA implementation with scikit-learn can be found in the Jupyter Notebook to this tutorial. In the figure below the first principal component is plotted against the second principal component while the third component is represented as the color of the dots.", "Looking at the plot it seems we have three different and slightly overlapping clusters in our data. One big cluster in the center that is surround by two smaller clusters on the left and right. So what we actually did here is to reduce the dimensionality of our data. While before each spike wave form was represented by 90 samples the dimensionality is now reduced to only three features which allow us to assign each spike to a cluster. And for that we now need our K-means clustering algorithm.", "The way we will implement K-means is quite straight forward. First, we choose a number of K random data points from our sample. These data points represent the cluster centers and their number equals the number of clusters. Next, we will calculate the Euclidean distance between all the random cluster centers and any data point. Then we assign each data point to the cluster center closest to it. Obviously doing all of this with random data points as cluster centers will not give us a good clustering result. So, we start over again. But this time we do not use random data points as cluster centers. Instead we calculate the actual cluster centers based on the previous random assignments and start the process again\u2026 and again\u2026 and again. With every iteration the data points that switch clusters will become less and we will arrive at a (hopefully) global optimum. Below you can find the Python implementation of K-means as outlined above.", "Good, so we are ready to go. We have our spikes extracted from the data, we selected the features and we wrote the K-means function. Now the last question is: How many clusters do we expect to find in the data? There are several ways to approach this question. One would be to use our domain knowledge. From experience we expect not to find more than two or three separable clusters from a single electrode recording. The first plot in this article seems to confirm this notion. Another more objective way is to use the Elbow method. For this we run the K-means function several times on our data and increase the number of clusters with every run. For each run we calculate the average distance of each data point to its cluster center. As the plot below shows, with the number of clusters increasing the average inter cluster distance decreases. This is not too surprising but what we can see as well is that when we reach six clusters the average distance to the cluster center does not change much anymore. This is called the Elbow point and gives us a recommendation of how many clusters to use.", "Alright, six clusters seems a bit high but lets see what we get. The left plot below shows again the 1st versus the 2nd principal component but this time the color code represents the cluster to which the K-means algorithm assigned each data point. The right plot shows the mean spike wave shape of each cluster.", "As we can see from the right plot above our K-means algorithm does a good job at clustering our wave forms. And indeed we have more than three clusters. The mean wave shapes labeled \u201cCluster 2\u201d in green are the ones with the high amplitude peak. The brown \u201cCluster 5\u201d is the mean wave shape of the spikes with the low peak amplitude while the orange \u201cCluster 1\u201d has a lot of noise and a high standard deviation (shaded area). It seems we have a lot of artifacts summed up in this cluster so we should drop it. Finally Clusters 0, 3 and 4 appear identical so we could combine them to one cluster. Doing so will give us four clusters in total, with one of them containing mostly artifacts. So we have more than three but less than six clusters. The plot below shows the resulting three clusters.", "Before we finish we should think again about what these results actually mean. The Elbow method told us to look for six clusters in the data. However from experience we know that this number is a bit too optimistic. So we clustered the data with six initial clusters, looked at the average wave forms of each cluster and then combined three clusters to one based on the similarity of their mean wave shapes. Another cluster we dropped because it contained mainly noise. In the end we have three clusters but does this also mean that we recorded the signal of three individual neurons? Not necessarily. To answer this question we would have to check the data in more detail. For example: After a neuron generated a spike it cannot generate a new spike for 1\u20132 milliseconds. This is called the refractory period which limits the maximum spike rate of a neuron and ensures that signals only travel from the cell body of the neuron along the axon to the synapse and not the other way around. So if we were to calculate the inter time difference between the spikes of one of the clusters and we would get time differences <1 millisecond we had to conclude that the cluster contains spikes from more than one neuron. Also the brain is pulsating inside the skull which means that the distance between a neuron and the tip of the electrode can change over time, which would effect the wave shape of the spike. So two slightly different wave shapes could still be generated by the same neuron. So in summary we outlined the spike sorting process and the implementation of K-means in Python but all this is rather a starting point than a definite answer to how many neurons were actually contributing to the signal.", "If you want the complete code of this project you can find it here. And of course feel free to follow me on Twitter or connect via LinkedIn.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "PhD in neuroscience interested in data analysis and artificial intelligence"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe7a8a76f316&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://carstenklein.medium.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": ""}, {"url": "https://carstenklein.medium.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Carsten Klein"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc804c71f161a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&user=Carsten+Klein&userId=c804c71f161a&source=post_page-c804c71f161a----e7a8a76f316---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/using-signal-processing-to-extract-neural-events-in-python-964437dc7c0", "anchor_text": "previous article"}, {"url": "https://github.com/akcarsten/spike_sorting", "anchor_text": "here"}, {"url": "https://twitter.com/ak_carsten", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/carsten-klein/", "anchor_text": "LinkedIn"}, {"url": "http://www.scholarpedia.org/article/Spike_sorting", "anchor_text": "here"}, {"url": "https://github.com/akcarsten/akcarsten.github.io/blob/master/spike_sorting/Spike_sorting%20.ipynb", "anchor_text": "Jupyter Notebook"}, {"url": "https://github.com/akcarsten/spike_sorting", "anchor_text": "here"}, {"url": "https://twitter.com/ak_carsten", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/carsten-klein/", "anchor_text": "LinkedIn"}, {"url": "https://github.com/akcarsten/spike_sorting", "anchor_text": "akcarsten/spike_sortingContribute to akcarsten/spike_sorting development by creating an account on GitHub.github.com"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e7a8a76f316---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/k-means?source=post_page-----e7a8a76f316---------------k_means-----------------", "anchor_text": "K Means"}, {"url": "https://medium.com/tag/data-science?source=post_page-----e7a8a76f316---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/neuroscience?source=post_page-----e7a8a76f316---------------neuroscience-----------------", "anchor_text": "Neuroscience"}, {"url": "https://medium.com/tag/python?source=post_page-----e7a8a76f316---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&user=Carsten+Klein&userId=c804c71f161a&source=-----e7a8a76f316---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&user=Carsten+Klein&userId=c804c71f161a&source=-----e7a8a76f316---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe7a8a76f316&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e7a8a76f316---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e7a8a76f316--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e7a8a76f316--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e7a8a76f316--------------------------------", "anchor_text": ""}, {"url": "https://carstenklein.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://carstenklein.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Carsten Klein"}, {"url": "https://carstenklein.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "669 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc804c71f161a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&user=Carsten+Klein&userId=c804c71f161a&source=post_page-c804c71f161a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F540b346ea76a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fwhos-talking-using-k-means-clustering-to-sort-neural-events-in-python-e7a8a76f316&newsletterV3=c804c71f161a&newsletterV3Id=540b346ea76a&user=Carsten+Klein&userId=c804c71f161a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}