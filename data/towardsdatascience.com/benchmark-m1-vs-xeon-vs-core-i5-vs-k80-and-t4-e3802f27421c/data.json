{"url": "https://towardsdatascience.com/benchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c", "time": 1683018229.57267, "path": "towardsdatascience.com/benchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c/", "webpage": {"metadata": {"title": "Benchmark M1 vs Xeon vs Core i5 vs K80 and T4 | by Fabrice Daniel | Towards Data Science", "h1": "Benchmark M1 vs Xeon vs Core i5 vs K80 and T4", "description": "Since their launch in November, Apple Silicon M1 Macs are showing very impressive performances in many benchmarks. These new processors are so fast that many tests compare MacBook Air or Pro to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/apple/tensorflow_macos", "anchor_text": "Apple Silicon native version of TensorFlow", "paragraph_index": 1}, {"url": "https://blog.tensorflow.org/2020/11/accelerating-tensorflow-performance-on-mac.html", "anchor_text": "benchmark", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/tensorflow-2-4-on-apple-silicon-m1-installation-under-conda-environment-ba6de962b3b8", "anchor_text": "my previous article", "paragraph_index": 5}, {"url": "https://en.wikipedia.org/wiki/Multilayer_perceptron", "anchor_text": "MLP", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Convolutional_neural_network", "anchor_text": "CNN", "paragraph_index": 6}, {"url": "https://en.wikipedia.org/wiki/Long_short-term_memory", "anchor_text": "LSTM", "paragraph_index": 6}, {"url": "https://github.com/zalandoresearch/fashion-mnist", "anchor_text": "Fashion MNIST", "paragraph_index": 6}, {"url": "https://www.tensorflow.org/guide/eager", "anchor_text": "Eager mode", "paragraph_index": 9}, {"url": "https://www.tensorflow.org/api_docs/python/tf/one_hot", "anchor_text": "one hot tensors", "paragraph_index": 14}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/losses/SparseCategoricalCrossentropy", "anchor_text": "sparse categorical cross entropy", "paragraph_index": 14}, {"url": "https://www.nvidia.com/en-gb/data-center/tesla-k80/", "anchor_text": "K80", "paragraph_index": 19}, {"url": "https://www.nvidia.com/en-us/data-center/tesla-t4/", "anchor_text": "T4", "paragraph_index": 19}, {"url": "https://developer.apple.com/documentation/mlcompute", "anchor_text": "ML Compute", "paragraph_index": 26}, {"url": "https://towardsdatascience.com/benchmark-m1-part-2-vs-20-cores-xeon-vs-amd-epyc-16-and-32-cores-8e394d56003d", "anchor_text": "here", "paragraph_index": 37}, {"url": "https://arxiv.org/abs/1708.07747", "anchor_text": "Fashion-MNIST: a Novel Image Dataset for Benchmarking Machine Learning Algorithms", "paragraph_index": 38}, {"url": "https://www.linkedin.com/in/fabrice-daniel-250930164/", "anchor_text": "https://www.linkedin.com/in/fabrice-daniel-250930164/", "paragraph_index": 40}], "all_paragraphs": ["Since their launch in November, Apple Silicon M1 Macs are showing very impressive performances in many benchmarks. These new processors are so fast that many tests compare MacBook Air or Pro to high-end desktop computers instead of staying in the laptop range. It usually does not make sense in benchmark. But here things are different as M1 is faster than most of them for only a fraction of their energy consumption.", "Apple is working on an Apple Silicon native version of TensorFlow capable to benefit from the full potential of the M1. On November 18th Google has published a benchmark showing performances increase compared to previous versions of TensorFlow on Macs.", "As a consequence, machine learning engineers now have very high expectations about Apple Silicon.", "But we should not forget one important fact: M1 Macs starts under $1,000, so is it reasonable to compare them with $5,000 Xeon(R) Platinum processors? or to expect competing with a $2,000 Nvidia GPU?", "In this article I benchmark my M1 MacBook Air against a set of configurations I use in my day to day work for Machine Learning.", "On the M1, I installed TensorFlow 2.4 under a Conda environment with many other packages like pandas, scikit-learn, numpy and JupyterLab as explained in my previous article.", "This benchmark consists of a python program running a sequence of MLP, CNN and LSTM models training on Fashion MNIST\u00b9 for three different batch size of 32, 128 and 512 samples.", "It also uses a validation set to be consistent with the way most of training are performed in real life applications. Then a test set is used to evaluate the model after the training, making sure everything works well. So, the training, validation and test set sizes are respectively 50000, 10000, 10000.", "Today this alpha version of TensorFlow 2.4 still have some issues and requires workarounds to make it work in some situations.", "Eager mode can only work on CPU. Training on GPU requires to force the graph mode. This is performed by the following code", "Evaluating a trained model fails in two situations:", "The solution simply consists to always set the same batch size for training and for evaluation as in the following code.", "The three models are quite simple and summarized below.", "They are all using the following optimizer and loss function.", "Fashion MNIST from tf.keras.dataset has integer labels, so instead of converting them to one hot tensors, I directly use a sparse categorical cross entropy loss function.", "The following plots shows the results for trainings on CPU.", "In CPU training, the MacBook Air M1 exceed the performances of the 8 cores Intel(R) Xeon(R) Platinum instance and iMac 27\" in any situation.", "The following plot shows how many times other devices are slower than M1 CPU.", "For MLP and LSTM M1 is about 2 to 4 times faster than iMac 27\" Core i5 and 8 cores Xeon(R) Platinum instance. For CNN, M1 is roughly 1.5 times faster.", "Here are the results for M1 GPU compared to Nvidia Tesla K80 and T4.", "In GPU training the situation is very different as the M1 is much slower than the two GPUs except in one case for a convnet trained on K80 with a batch size of 32.", "The following plot shows how many times other devices are faster than M1 CPU (to make it more readable I inverted the representation compared to the similar previous plot for CPU).", "Here K80 and T4 instances are much faster than M1 GPU in nearly all the situations. The difference even increases with the batch size. K80 is about 2 to 8 times faster than M1 while T4 is 3 to 13 times faster depending on the case.", "So does the M1 GPU is really used when we force it in graph mode?", "The answer is Yes. When looking at the GPU usage on M1 while training, the history shows a 70% to 100% GPU load average while CPU never exceeds 20% to 30% on some cores only.", "Now we should not forget that M1 is an integrated 8 GPU cores with 128 execution units for 2.6 TFlops (FP32) while a T4 has 2 560 Cuda Cores for 8.1 TFlops (FP32). The price is also not the same at all.", "We should wait for Apple to complete its ML Compute integration to TensorFlow before drawing conclusions but even if we can get some improvements in the near future there is only a very little chance for M1 to compete with such high-end cards. But we can fairly expect the next Apple Silicon processors to reduce this gap.", "An interesting fact when doing these tests is that training on GPU is nearly always much slower than training on CPU. The following plots shows these differences for each case.", "As we observe here, training on the CPU is much faster than on GPU for MLP and LSTM while on CNN, starting from 128 samples batch size the GPU is slightly faster.", "The last two plots compare training on M1 CPU with K80 and T4 GPUs.", "From these tests it appears that", "Of course, these metrics can only be considered for similar neural network types and depths as used in this test.", "As a machine learning engineer, for my day-to-day personal research, using TensorFlow on my MacBook Air M1 is really a very good option.", "My research mostly focuses on structured data and time series, so even if I sometimes use CNN 1D units, most of the models I create are based on Dense, GRU or LSTM units so M1 is clearly the best overall option for me.", "For people working mostly with convnet, Apple Silicon M1 is not convincing at the moment, so a dedicated GPU is still the way to go.", "Apple is still working on ML Compute integration to TensorFlow. If any new release shows a significant performance increase at some point, I will update this article accordingly.", "After a comment from a reader I double checked the 8 core Xeon(R) instance. It\u2019s using multithreading.", "Part 2 of this article is available here.", "[1] Han Xiao and Kashif Rasul and Roland Vollgraf, Fashion-MNIST: a Novel Image Dataset for Benchmarking Machine Learning Algorithms (2017)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Head of AI lab at Lusis. Co-lead AI research projects in a university chair with CentraleSupelec. https://www.linkedin.com/in/fabrice-daniel-250930164/"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe3802f27421c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://fabrice-daniel.medium.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": ""}, {"url": "https://fabrice-daniel.medium.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Fabrice Daniel"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F926442548db0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&user=Fabrice+Daniel&userId=926442548db0&source=post_page-926442548db0----e3802f27421c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/apple/tensorflow_macos", "anchor_text": "Apple Silicon native version of TensorFlow"}, {"url": "https://blog.tensorflow.org/2020/11/accelerating-tensorflow-performance-on-mac.html", "anchor_text": "benchmark"}, {"url": "https://towardsdatascience.com/tensorflow-2-4-on-apple-silicon-m1-installation-under-conda-environment-ba6de962b3b8", "anchor_text": "my previous article"}, {"url": "https://en.wikipedia.org/wiki/Multilayer_perceptron", "anchor_text": "MLP"}, {"url": "https://en.wikipedia.org/wiki/Convolutional_neural_network", "anchor_text": "CNN"}, {"url": "https://en.wikipedia.org/wiki/Long_short-term_memory", "anchor_text": "LSTM"}, {"url": "https://github.com/zalandoresearch/fashion-mnist", "anchor_text": "Fashion MNIST"}, {"url": "https://www.tensorflow.org/guide/eager", "anchor_text": "Eager mode"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/one_hot", "anchor_text": "one hot tensors"}, {"url": "https://www.tensorflow.org/api_docs/python/tf/keras/losses/SparseCategoricalCrossentropy", "anchor_text": "sparse categorical cross entropy"}, {"url": "https://www.nvidia.com/en-gb/data-center/tesla-k80/", "anchor_text": "K80"}, {"url": "https://www.nvidia.com/en-us/data-center/tesla-t4/", "anchor_text": "T4"}, {"url": "https://developer.apple.com/documentation/mlcompute", "anchor_text": "ML Compute"}, {"url": "https://towardsdatascience.com/benchmark-m1-part-2-vs-20-cores-xeon-vs-amd-epyc-16-and-32-cores-8e394d56003d", "anchor_text": "here"}, {"url": "https://arxiv.org/abs/1708.07747", "anchor_text": "Fashion-MNIST: a Novel Image Dataset for Benchmarking Machine Learning Algorithms"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----e3802f27421c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e3802f27421c---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----e3802f27421c---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----e3802f27421c---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/benchmark?source=post_page-----e3802f27421c---------------benchmark-----------------", "anchor_text": "Benchmark"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&user=Fabrice+Daniel&userId=926442548db0&source=-----e3802f27421c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&user=Fabrice+Daniel&userId=926442548db0&source=-----e3802f27421c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe3802f27421c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e3802f27421c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e3802f27421c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e3802f27421c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e3802f27421c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e3802f27421c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e3802f27421c--------------------------------", "anchor_text": ""}, {"url": "https://fabrice-daniel.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://fabrice-daniel.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Fabrice Daniel"}, {"url": "https://fabrice-daniel.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "268 Followers"}, {"url": "https://www.linkedin.com/in/fabrice-daniel-250930164/", "anchor_text": "https://www.linkedin.com/in/fabrice-daniel-250930164/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F926442548db0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&user=Fabrice+Daniel&userId=926442548db0&source=post_page-926442548db0--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7116984ccbca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbenchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c&newsletterV3=926442548db0&newsletterV3Id=7116984ccbca&user=Fabrice+Daniel&userId=926442548db0&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}