{"url": "https://towardsdatascience.com/working-with-google-geofence-api-2e04a227ff27", "time": 1683006515.777518, "path": "towardsdatascience.com/working-with-google-geofence-api-2e04a227ff27/", "webpage": {"metadata": {"title": "Targeting Users In Specific Area Using Geofence API | by Himanshu Verma | Towards Data Science", "h1": "Targeting Users In Specific Area Using Geofence API", "description": "Google Geofence API is used when you want to notify users if they are near the specific area in the world (such as Shopping Malls, Airport, Restaurants etc.). For example, the customer has installed\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/himanshujbd/Google-Geofence", "anchor_text": "Github", "paragraph_index": 80}, {"url": "http://thehimanshuverma.com/", "anchor_text": "website", "paragraph_index": 81}, {"url": "https://mailchi.mp/b08da935e5d9/himanshuverma", "anchor_text": "Subscribe", "paragraph_index": 82}, {"url": "https://medium.com/the-code-monster", "anchor_text": "The Code Monster", "paragraph_index": 82}, {"url": "http://thehimanshuverma.com/", "anchor_text": "http://thehimanshuverma.com/", "paragraph_index": 85}], "all_paragraphs": ["Google Geofence API is used when you want to notify users if they are near the specific area in the world (such as Shopping Malls, Airport, Restaurants etc.). For example, the customer has installed an online shopping app and if they are near one of the stores that the app has a tie up with, then store could generate a notification in the app to let the customer know that the store near them has a special offer running for them. This way you can engage more users.", "To use the Geofence API, you\u2019ll have to obtain the Google Maps API key using the following set of steps.", "You can give any name to this project or you can just leave it as it is and click on CREATE now.", "We\u2019re going to build an application which will allow you to set your location (or specific area to be precise) on a map. And when you reach the specified location, your app will notify you with a message you defined at the time when you set the location.", "In the end, you\u2019ll have an app which will look similar to this.", "To set the location on the map, you can drag the marker on your desired location. Once you specified your location, you can proceed by clicking CONTINUE button.", "Are you excited now?, I\u2019m sure you\u2019ll be.", "Now let\u2019s quickly set up our project and proceed.", "Then add the following line inside your build.gradle", "Let\u2019s get quickly familiar with some android components used in this app", "Service: A service is an android component which is used to perform background tasks. A task may be of any kind such as uploading photos, syncing user data on server and generating notifications etc.", "Broadcast Receiver: A broadcast receiver is also a fundamental component of android, it comes handy when you want to perform some actions in your app which are based on future events. For instance, you only want to upload user data to your server when the phone is connected to the WIFI and another example is, you want to start the background service when the user restarts his phone.", "PendingIntent: PendingIntent is similar to normal intent except that it will not execute immediately.", "I\u2019ve all the classes, utility functions and constants under the root package.", "Let\u2019s understand them one by one.", "Enough talking? let\u2019s get back to business\u2026", "When you create a project, you will have a default ActivityMain.kt class. I want you to create one more class and name it as ReminderActivity.kt. In this class extend AppCompatActivity() class and implement OnMapReadyCallback the interface of Google Map and implement its method onMapReady(). For now, leave everything as it is.", "Now we\u2019ll create our AppConstants class and define all constants and few methods.", "In this class, we defined our constants and three methods, newIntentForMainActivity() method will call the MainActivity.kt class and newIntentForReminderActivity() will call the ReminderActivity.kt class. enqueueWork() method will be called by our broadcast receiver to generate the notification.Tip: All constants and methods are defined inside the companion object, and this is because whenever we need to call any of these methods, we won\u2019t have to create object of this class.", "Now we\u2019ll create Utils.kt and add the following methods", "When we\u2019ll call this method, we have to pass two parameters i.e context.resources and an id of our image which needs to converted into bitmap. The context.resources returns a resources instance for your application. Inside this method, I got the drawable object, created the Bitmap and Canvas objects. We now have our image in vectorDrawable and we\u2019ll convert this object into bitmap, then draw bitmap on canvas and set its bounds and return.", "Tip: If you\u2019re not familiar with Canvas, then you can think of it as a blank piece of paper where you can draw any shape.", "showReminderInMap() method takes context, GoogleMap object and MyReminder class object as an argument and checks if myReminder has a value, then it proceeds further otherwise it does nothing. Inside the if statement I\u2019m getting the latitude and longitude from my myReminder object and casting it to LatLng and in the second if statement, I\u2019m drawing the circle around the specified location. In general, this method is used to draw the circle on a specified location.", "The sendNotification() method is pretty straightforward, it does nothing except creating the notification. This method is called from the service to show the notification.", "Now create this class in your root directory and also add this broadcast receiver in your AndroidManifest.xml file.", "This class extends the BroadcastReceiver() class which is an abstract class and implements its onReceive() method. As the onReceive() method is executed, it will execute the enqueueWork() method of AppConstants.kt.", "This receiver would be registered viaPendingIntent when you will add the reminder.", "Create this class and declare it in the AndroidManifest.xml file", "Note: If a job service is declared in the manifest but not protected with BIND_JOB_SERVICE permission, that service will be ignored by the system.", "This is a service which extends the JobIntentService class, IntentService or JobIntentService is a service which runs in the background on a separate thread and it gets destroyed when the job is done. To use this class we\u2019ll have to implement its required method onHandleWork() .", "Inside this method, we can do our task. I\u2019m getting the object of GeofencingEvent class inside this method, if there is an issue, we show the error message otherwise we call the handleEvent() method.", "In this method, we first use the GeofencingEvent object and checks whether the user enters in the specified area or not, if it then gets the reminder object from the repository, retrieves its data and send the notification.", "getFirstReminder() method returns the object of MyReminder class from the MyRepository class.", "Below is the full code for this service class", "Tip: lateinit is a keyword in Kotlin which frees you from not to initialise it at time of declaration but it should be initialised before its use otherwise, you will run into the NullPointerException.", "You can think of this class as a local server which means it serves us everything we needed to perform any action on the map such as adding a reminder or removing reminder and maintaining all reminders.", "The following code snippet creates an object of GeofencingClient which helps you to manipulate the geofences.", "Here we\u2019re getting the SharedPreference object and Gson object", "In the SharedPreference, we\u2019ll store the reminders and using Gson object we\u2019ll convert json string to Java object and vice-versa. Since SharedPreference can hold only primitive values in the form of key-value pairs but we want to store our class object, so how it is possible?. Obviously, we can convert our object to json string and store it in a SharedPreference, whenever we need to use it, we will convert it into a real object.", "The combination of latitude, longitude and a radius is known as geofence. It\u2019s a circular area at a specific location on the map. Whenever users enter this area, the app will trigger particular behaviour.", "Look at the code, we\u2019re building the geofence using Geofence.Builder().", "In the method setRequestId(), I\u2019m passing unique id since every geofence is unique in its way, you will get this id from your model class.", "In the setCircularRegion(), I\u2019m setting my latitude, longitude and radius, all these parameters together form a circle on a specific location.", "The setTransitionTypes() defines the transition type, you can use GEOFENCE_TRANSITION_ENTER to trigger an event when the user enters into the defined area.", "The setExpirationDuration() method sets the expiry of the geofence, we\u2019re using NEVER_EXPIRE which means that it will never expire until the user removes it.", "You\u2019ll use this method to build the geofence request.", "Here you\u2019re setting setInitialTrigger() to 0 which means that you don\u2019t want your app to trigger an event when the app is already inside the geofence. And the next addGeofences() method adds the request to geofence.", "As you can see in the code snippet, we\u2019re passing MyBroadcastReceiver in the intent object which means that when this pending intent is called, it will call broadcast receiver and this receiver will call GeofenceTransitionService.", "This code will only be executed when GEOFENCE_TRANSITION_ENTER event is triggered.", "Tip: by lazy property, the value only gets computed when this is used for the first time.", "This add() method adds the reminder in the SharedPreference and also adds the request to the geofence.", "First of all, we\u2019re checking the permission if it is granted, then we proceed, and next, we\u2019re creating the geofence using the geofencingClient if it is successful, then only we\u2019ll save in shared preference, otherwise report an error message.", "This method simply removes the reminder from the list.", "This method adds all the reminders in the list in shared-preference.", "Notice we\u2019re converting the list to Json string, then we\u2019re storing it.", "This method returns the list of all reminders we stored in the shared-preference.", "This function returns the reminder added in the list.", "Notice this function first calls the getAll() method which returns a list and we call lastOrNull() function which is a method of List class and this method returns the last value.", "This method returns the first reminder from the list if the list is not null.", "{it.id == requestId } is a lambda expression which is performing null checking. When there is only a single parameter inside the lambda expression, then it can be used.", "This activity allows us to add the new reminder on the specified location.", "First of all, create these objects in this activity.", "Now paste the following code inside your onCreate() method", "In this onCreate() method, I\u2019m initialising my repository instance variable and setting the map. Initially, I hide all the TextView.", "In this method, I\u2019m getting LatLng as well as zoom value from the intent and setting the camera at the centre of the location.", "This method updates the reminder. On calling this method, it will show you circle around the location.", "This method simply guides you through how you can navigate on the map.", "This method is same as the above method and it guides you through how to add a message. This message will be shown when you will get a notification.", "This method calls the add method from the MyReminderRepository class and adds the reminder. If the reminder is added successfully, then it will you Snackbar on the bottom with a message \u201cReminder added\u201d else failure message.", "Inside this method, we\u2019re assigning the GoogleMap object to our map and then configuring settings.", "The only thing you can notice in <fragment> tag is \u201candroid:name=\u201dcom.google.android.gms.maps.SupportMapFragment\u201d line and this line helps you to add the Google map on the screen. This is the simplest way of adding a map. And rest of the code inside this file must be quite familiar for you.", "Finally, this is the last part of our code. This is our home activity which you will see when you first interact with the app.", "First of all, add these listeners in your activity and implement all its methods.", "In this method, we\u2019re initialising our instance variables first, then getting a map from a fragment from the activity_main.xml file and the listeners on the action buttons. Initially, these buttons will not be visible until the user gives ACCESS_FINE_LOCATION permission. As a user grants the permission, we make the buttons visible to the users inside the onMapAndPermissionReady() method.", "Look at the below code, here I\u2019m attaching a listener to the button and inside the lambda expression, I\u2019m calling run method of Google map class. This run is also a lambda function. When user presses (+) action button, we take the user to the ReminderActivity.kt class.", "When permission is granted and the map doesn\u2019t equal null, then we\u2019re making visible our buttons and adding a listener to the actionCurrentLocation button. Now if the user presses the actionCurrentLocation button, then we get the location provider and last known location of the user. And if this is not null, then we\u2019ll move the camera to the last know location.", "When a user clicks on the marker, then an alert dialog pops up to ask user, if he wants to remove the reminder, if he presses \u201cYES\u201d then that reminder gets removed from the list.", "This method only creates an alert dialog with two options, i.e OK and Cancel and if a user clicks on \u201cOk\u201d, then we call removeReminder() to remove it.", "Complete code of our ActivityMain.kt file", "Now finally we have our activity_main.xml file", "If you have any difficulty with your project, then you can seek help from my Github project.", "I hope you liked reading this article, you can also visit my website where I keep posting article regularly.", "Subscribe to my mailing list to get the early access of my articles directly in your inbox and don\u2019t forget to follow my own publication on Medium The Code Monster to polish your technical knowledge.", "We\u2019ve learnt how we can use Google map and Geofence APIs in our own project and we also learnt about services and broadcast receivers. Apart from this, we learnt a trick to store custom java object in SharedPreference using Gson and retrieving them using the same.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Visit my website http://thehimanshuverma.com/. Android & IOS Developer | Researcher | ML & Data Science Enthusiastic | Blogger | FA"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F2e04a227ff27&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@himanshusoni501?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@himanshusoni501?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Himanshu Verma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4db1a6f4e63&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&user=Himanshu+Verma&userId=a4db1a6f4e63&source=post_page-a4db1a6f4e63----2e04a227ff27---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@kobuagency?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "KOBU Agency"}, {"url": "https://unsplash.com/s/photos/google-map?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://console.cloud.google.com/projectcreate", "anchor_text": "THIS"}, {"url": "https://github.com/himanshujbd/Google-Geofence", "anchor_text": "Github"}, {"url": "http://thehimanshuverma.com/", "anchor_text": "website"}, {"url": "https://mailchi.mp/b08da935e5d9/himanshuverma", "anchor_text": "Subscribe"}, {"url": "https://medium.com/the-code-monster", "anchor_text": "The Code Monster"}, {"url": "https://medium.com/tag/android?source=post_page-----2e04a227ff27---------------android-----------------", "anchor_text": "Android"}, {"url": "https://medium.com/tag/android-app-development?source=post_page-----2e04a227ff27---------------android_app_development-----------------", "anchor_text": "Android App Development"}, {"url": "https://medium.com/tag/google?source=post_page-----2e04a227ff27---------------google-----------------", "anchor_text": "Google"}, {"url": "https://medium.com/tag/api?source=post_page-----2e04a227ff27---------------api-----------------", "anchor_text": "API"}, {"url": "https://medium.com/tag/kotlin?source=post_page-----2e04a227ff27---------------kotlin-----------------", "anchor_text": "Kotlin"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&user=Himanshu+Verma&userId=a4db1a6f4e63&source=-----2e04a227ff27---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&user=Himanshu+Verma&userId=a4db1a6f4e63&source=-----2e04a227ff27---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F2e04a227ff27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----2e04a227ff27---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----2e04a227ff27--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----2e04a227ff27--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----2e04a227ff27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@himanshusoni501?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@himanshusoni501?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Himanshu Verma"}, {"url": "https://medium.com/@himanshusoni501/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "304 Followers"}, {"url": "http://thehimanshuverma.com/", "anchor_text": "http://thehimanshuverma.com/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa4db1a6f4e63&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&user=Himanshu+Verma&userId=a4db1a6f4e63&source=post_page-a4db1a6f4e63--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fbe81368ce856&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fworking-with-google-geofence-api-2e04a227ff27&newsletterV3=a4db1a6f4e63&newsletterV3Id=be81368ce856&user=Himanshu+Verma&userId=a4db1a6f4e63&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}