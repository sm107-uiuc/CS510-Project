{"url": "https://towardsdatascience.com/data-science-by-hazy-4c2f2352f3a0", "time": 1683006937.871885, "path": "towardsdatascience.com/data-science-by-hazy-4c2f2352f3a0/", "webpage": {"metadata": {"title": "Optimising deep learning neural networks | by Johnny Kelsey | Towards Data Science", "h1": "Optimising deep learning neural networks", "description": "Douglas Adams, in The Hitchhiker\u2019s Guide to the Galaxy, once asserted that: \u201cSpace is big. You just won\u2019t believe how vastly, hugely, mind-bogglingly big it is. I mean, you may think it\u2019s a long way\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.microsoft.com/en-us/research/blog/turing-nlg-a-17-billion-parameter-language-model-by-microsoft/", "anchor_text": "Microsoft Turing Natural Language Generation or T-NLG network", "paragraph_index": 1}, {"url": "https://www.hazy.com", "anchor_text": "Hazy", "paragraph_index": 9}, {"url": "https://optuna.readthedocs.io/en/latest/", "anchor_text": "Optuna Python package", "paragraph_index": 9}, {"url": "https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html", "anchor_text": "Iris Dataset", "paragraph_index": 17}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html", "anchor_text": "random forest classifier", "paragraph_index": 17}, {"url": "https://optuna.readthedocs.io/en/latest/reference/trial.html", "anchor_text": "trial object", "paragraph_index": 22}, {"url": "https://optuna.readthedocs.io/en/latest/reference/trial.html#optuna.trial.Trial.suggest_loguniform", "anchor_text": "suggest_loguniform", "paragraph_index": 24}, {"url": "http://archive.ics.uci.edu/ml/datasets/Adult", "anchor_text": "adult dataset", "paragraph_index": 33}, {"url": "https://hazy.com/", "anchor_text": "Hazy", "paragraph_index": 41}], "all_paragraphs": ["Douglas Adams, in The Hitchhiker\u2019s Guide to the Galaxy, once asserted that: \u201cSpace is big. You just won\u2019t believe how vastly, hugely, mind-bogglingly big it is. I mean, you may think it\u2019s a long way down the road to the chemist\u2019s, but that\u2019s just peanuts to space.\u201d", "Neural networks are also big. The Microsoft Turing Natural Language Generation or T-NLG network has some 19 billion parameters. Which is pretty big, by most people\u2019s standards.", "However, it\u2019s not just the number of parameters that might concern us, but also the metaparameters. Data scientists working with generative adversarial networks (GAN) typically have to run millions of experiments in order to optimise their neural networks. In this piece, we explain how at Hazy we injected automated metaparameter optimisation into our GANs to then allow you train better models with less frustration.", "Deep learning neural networks have a dizzying array of metaparameters.", "Metaparameters are those parameters given to the network which guide its training process, controlling how it modifies the parameters.", "Metaparameters include the learning rate, the momentum, the number of hidden layers, the number of neurons per layer, and the type of optimiser to use.", "A standard part of the machine learning engineer\u2019s job is to tune the network, that is, to choose the metaparameters which result in the best performance. This can be a time-consuming process, since the larger the network, the longer it takes to converge, and often the more metaparameters there are to tune and tweak.", "Tuning the network is rather like being a scientist with a complex piece of equipment, with lots of knobs to twiddle, and performing lots of experimental trials to see which one gives you the best result.", "Fortunately, there are packages out there which can make this task easier.", "At Hazy, the synthetic data generation company, we\u2019re big fans of the Optuna Python package.", "Optuna is an automatic metaparameter optimisation software framework, designed specifically for machine learning. The code is highly modular and imperative. It supports parallel, distributed optimisation, dynamic pruning of trials. It\u2019s machine learning framework agnostic and also highly customisable.", "Let\u2019s take an example. Let\u2019s say that we have a GAN and we want to optimise the learning rates for its generator and discriminator. How would we go about this?", "Optuna has two basic concepts: the study and the trial.", "The study is the overall task of optimisation, based on a function which returns the result of the optimisation. This function is usually known as the objective function. The trial is a single execution of the objective function.", "Let\u2019s go through an example, which we took from the Optuna site and applied to Hazy\u2019s GAN models, to give you a flavour of what\u2019s possible.", "First, we define an objective function to study.", "The objective function encapsulates the whole training process and returns the value of this particular instantiation of the metaparameters.", "The function loads up the Iris Dataset \u2014 a well-known dataset used to evaluate machine learning classifiers. It then gets a suggested number of estimators and a maximum depth from the trial object. It then instantiates a random forest classifier and returns the score.", "Let\u2019s go through this in a little more detail.", "The dataset consists of three different species of iris, and the machine learning task is to correctly assign a given datapoint to the correct iris species given four measurements:", "The Iris Dataset is regarded as a fairly difficult classification problem, since there is quite a bit of overlap between the species with respect to these measurements. It is quite difficult to draw a clear decision boundary between the species.", "The metaparameters which we wish to optimise are n_estimators and max_depth.", "The trial object suggests an integer in the range 2\u2264\ud835\udc5b\u226420 for the n_estimators:", "Optuna has a number of different mechanisms for providing the value of a metaparameter to test in each trial; the value of max_depth is assigned using a log uniform distribution:", "The suggest_loguniform function takes a range, in this case 1\u2264 \ud835\udc65 \u226432, and returns a floating point value in the range. This is cast to an integer.", "The random forest classifier is then created, with the suggested max_depth and n_estimators. It\u2019s evaluated, and a score is returned:", "Having created the objective function, we need to create an Optuna study, and create a number of trials. We then output the best values for the metaparameters:", "This outputs the score for each trial, along with the metaparameters used. Eventually, after the study completes, it outputs the best metaparameters:", "How can we use this to optimise the highly complex system represented by generative adversarial networks?", "Let\u2019s define a few functions for those metaparameters we want to optimise.", "A GAN is composed of two neural networks, the generator and the discriminator. The generator is tasked with trying to fool the discriminator by creating fake data; the discriminator, given inputs of real and fake data, must be able to distinguish one from the other.", "Say that we want to optimise the learning rates for the two networks:", "We make use of the suggest_loguniform function and give it a wide range.", "Below we set up the code which will optimise both learning rates, using the adult dataset.", "Let\u2019s start below by setting up a Python dictionary which will contain default metaparameters to build the network with.", "Note that we already provide default values for the GAN\u2019s learning rates; this allows a user to select which metaparameter they want to optimise. Potentially any of these could be optimised; however, the dictionary can also be used as it is, to create neural networks.", "The user could also specify metaparameters from the command line, so let\u2019s accommodate that by creating a command line parser namespace from argparse.", "We need a way of combining the command-line metaparameters from the namespace with the default network dictionary:", "Finally, we define our objective function.", "The objective function has to cover a number of bases, since it has to contain all the code to create, train and test a GAN. The function creates a GAN. Then it sets up logging, so that we can see the results of running the trial. It then calls a function to run the trial, with the given metaparameters.", "The objective function \u2014 and the run_experiment function it calls \u2014 both look a little complicated, but inherently they\u2019re just assigning and parsing parameters. There\u2019s quite a bit going on in both pieces of code. However, they\u2019re really just setting up the generator and discriminator networks, the dataset, and the evaluators.", "After a few more imports from the Hazy code library, you can set up an Optuna study object, and ask it to optimise our metaparameters for us.", "Note that this is (probably) too few a number of trials for a useful study. For a metaparameter such as both the discriminator\u2019s and generator\u2019s learning rates, we would require a greater number of trials. Similarly, the number of epochs may not be large enough for an accurate assessment of the GANs performance. These are given merely as examples.", "As machine learning engineers, there\u2019s something thrilling about being able to automate metaparameter optimisation, so we can spend more time exploring the effects optimising them has on the synthetic datasets provided. We have worked the Optuna code into the models, which will save us all time.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Senior machine learning engineer at Hazy. Interested in deep learning, nature-inspired computation, evolutionary algorithms."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4c2f2352f3a0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@johnny_kelsey?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@johnny_kelsey?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Johnny Kelsey"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2a544220700&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&user=Johnny+Kelsey&userId=e2a544220700&source=post_page-e2a544220700----4c2f2352f3a0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.flickr.com/photos/wocintechchat/", "anchor_text": "WOCinTech"}, {"url": "https://www.microsoft.com/en-us/research/blog/turing-nlg-a-17-billion-parameter-language-model-by-microsoft/", "anchor_text": "Microsoft Turing Natural Language Generation or T-NLG network"}, {"url": "https://www.hazy.com", "anchor_text": "Hazy"}, {"url": "https://optuna.readthedocs.io/en/latest/", "anchor_text": "Optuna Python package"}, {"url": "https://scikit-learn.org/stable/auto_examples/datasets/plot_iris_dataset.html", "anchor_text": "Iris Dataset"}, {"url": "https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html", "anchor_text": "random forest classifier"}, {"url": "https://optuna.readthedocs.io/en/latest/reference/trial.html", "anchor_text": "trial object"}, {"url": "https://optuna.readthedocs.io/en/latest/reference/trial.html#optuna.trial.Trial.suggest_loguniform", "anchor_text": "suggest_loguniform"}, {"url": "http://archive.ics.uci.edu/ml/datasets/Adult", "anchor_text": "adult dataset"}, {"url": "https://hazy.com/", "anchor_text": "Hazy"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&user=Johnny+Kelsey&userId=e2a544220700&source=-----4c2f2352f3a0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&user=Johnny+Kelsey&userId=e2a544220700&source=-----4c2f2352f3a0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4c2f2352f3a0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4c2f2352f3a0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4c2f2352f3a0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@johnny_kelsey?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@johnny_kelsey?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Johnny Kelsey"}, {"url": "https://medium.com/@johnny_kelsey/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "18 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2a544220700&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&user=Johnny+Kelsey&userId=e2a544220700&source=post_page-e2a544220700--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fe2a544220700%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-by-hazy-4c2f2352f3a0&user=Johnny+Kelsey&userId=e2a544220700&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}