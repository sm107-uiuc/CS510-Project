{"url": "https://towardsdatascience.com/so-you-want-to-bootstrap-with-pyspark-fd04d056e4aa", "time": 1683017789.029227, "path": "towardsdatascience.com/so-you-want-to-bootstrap-with-pyspark-fd04d056e4aa/", "webpage": {"metadata": {"title": "So you want to bootstrap with PySpark | by Celso M. Cantanhede Silva | Towards Data Science", "h1": "So you want to bootstrap with PySpark", "description": "If you\u2019re here, there\u2019s a small chance that you\u2019ve found my article on one of my social media pages. More likely, you found out how hard it was to compute bootstrap, and since you have access to\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["It\u2019s more complicated than you think.", "If you\u2019re here, there\u2019s a small chance that you\u2019ve found my article on one of my social media pages. More likely, you found out how hard it was to compute bootstrap, and since you have access to spark, you thought, \u201cwhy not use it to increase this to warp speed\u201d (or some other less nerdy concept of fast)? So, you\u2019ve googled it.", "Well, there are a few obstacles, but it\u2019s possible. Let\u2019s discuss what are the steps of bootstrapping and how not to naively use spark while calculating it.", "First, the basics. I assume that you have a good grasp of what bootstrapping even is if you\u2019re reading this article but, if that\u2019s not the case, I would recommend Lorna Yen\u2019s article at Towards Data Science:", "Here, we just need to remember the basic steps:", "The important thing for us is the second step. The thing with Spark is that it works by partitioning the data and into disjoint subsets and distributing them across the nodes in your cluster.", "So, let\u2019s say you\u2019re trying to create bootstrap resamples with 1 million data points. In this case, we\u2019re dealing with a very particular dataset, with 999.999 zeroes and only a single number 1. Also, you\u2019re using 50 partitions for this calculation. In that case, what would it be the probability of a resample consisting of 1 million number ones?", "In real life, 1/10\u00b3\u2076. In naive spark, zero. You see, only one of these partitions will have a number one; all the other will only see zeroes. It\u2019ll be impossible to have more than 20.000 ones; that would be the specific case when the only partition in 50 that has the one returns only ones. Thus, a naive approach won\u2019t return all the possible resamples because every resampling needs the complete dataset to count as real bootstrapping.", "So, how can we do it the right way? A good reference is Paul Cho\u2019s blog post, Bootstrapping with spark.", "In it, Paul explains the same issue I\u2019ve explained above and how to circumvent it, but with code in Scala. Here, we\u2019ll show how to do the same with Pyspark.", "We have to use Spark as a parallel execution engine so that we could generate the bootstrap resamples in parallel. That will allow us to broadcast the full dataset to every single node. To do that, we need to create a higher-order function to help us run a statistical function in parallel on this broadcasted data.", "First, we create a RDD (resilient distributed dataset) with the number of desired resamples. To each resample index, we map the statistical function we want to apply to the data. After that, we convert the RDD into a Spark Data Frame. Finally, we rename the columns to something more relevant than \u201c_1\u201d and \u201c_2\u201d, and voil\u00e1, we have a spark data frame with the calculated statistics for every resample, and we can proceed to the construction of the distribution.", "Below, we show an example of a function to get a mean of the bootstrapping resample:", "In this function, we\u2019re taking a list of floating numbers; for each index of the list, we take a random sample of the list and add it to a sum. In the end, we return the mean of this resample of the list.", "The full code would loke something like this:", "Some final notes. This will not be as fast as naive spark, but will be faster than regular python, especially for big sets of data.", "Also, Paul Cho proposed another set of functions to compress datasets with millions of data points, which takes a toll in performance, but allows Spark to broadcast those datasets without memory issues.", "For our purposes, the functions that I\u2019ve decribed above suits just fine, but we can get back to translating Paul\u2019s Scala code to pyspark in the future.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffd04d056e4aa&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://celso-mattheus.medium.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": ""}, {"url": "https://celso-mattheus.medium.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Celso M. Cantanhede Silva"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F16d9da4b602f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&user=Celso+M.+Cantanhede+Silva&userId=16d9da4b602f&source=post_page-16d9da4b602f----fd04d056e4aa---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@joshchai?utm_source=medium&utm_medium=referral", "anchor_text": "Joshua Chai"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/an-introduction-to-the-bootstrap-method-58bcb51b4d60", "anchor_text": "An Introduction to the Bootstrap MethodAn exploration about bootstrap method, the motivation, and how it workstowardsdatascience.com"}, {"url": "https://medium.com/udemy-engineering/bootstrapping-with-spark-f7ac338702d6", "anchor_text": "Bootstrapping with SparkIn the last blog post, Robert described why we bootstrap our experimentation data. While that may or may not have\u2026medium.com"}, {"url": "https://medium.com/tag/data-science?source=post_page-----fd04d056e4aa---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/python?source=post_page-----fd04d056e4aa---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/pyspark?source=post_page-----fd04d056e4aa---------------pyspark-----------------", "anchor_text": "Pyspark"}, {"url": "https://medium.com/tag/spark?source=post_page-----fd04d056e4aa---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/bootstrapping?source=post_page-----fd04d056e4aa---------------bootstrapping-----------------", "anchor_text": "Bootstrapping"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&user=Celso+M.+Cantanhede+Silva&userId=16d9da4b602f&source=-----fd04d056e4aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&user=Celso+M.+Cantanhede+Silva&userId=16d9da4b602f&source=-----fd04d056e4aa---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Ffd04d056e4aa&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----fd04d056e4aa---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----fd04d056e4aa--------------------------------", "anchor_text": ""}, {"url": "https://celso-mattheus.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://celso-mattheus.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Celso M. Cantanhede Silva"}, {"url": "https://celso-mattheus.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "19 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F16d9da4b602f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&user=Celso+M.+Cantanhede+Silva&userId=16d9da4b602f&source=post_page-16d9da4b602f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F16d9da4b602f%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fso-you-want-to-bootstrap-with-pyspark-fd04d056e4aa&user=Celso+M.+Cantanhede+Silva&userId=16d9da4b602f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}