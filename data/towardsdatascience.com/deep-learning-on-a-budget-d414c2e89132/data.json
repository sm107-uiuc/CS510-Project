{"url": "https://towardsdatascience.com/deep-learning-on-a-budget-d414c2e89132", "time": 1682997271.7150578, "path": "towardsdatascience.com/deep-learning-on-a-budget-d414c2e89132/", "webpage": {"metadata": {"title": "Deep Learning on a Budget. Tips for cost effective model training | by Manu Sharma | Towards Data Science", "h1": "Deep Learning on a Budget", "description": "There are many articles and courses dedicated to the latest ML/AI research aimed at training bigger models and achieving higher classification accuracy. This is great for research and academia and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cloud.google.com/free/", "anchor_text": "[1]", "paragraph_index": 4}, {"url": "http://karpathy.github.io/2019/04/25/recipe/", "anchor_text": "[2]", "paragraph_index": 8}, {"url": "https://arxiv.org/", "anchor_text": "[3]", "paragraph_index": 16}, {"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "[4]", "paragraph_index": 17}, {"url": "https://dawn.cs.stanford.edu/benchmark/v1/CIFAR10/train.html", "anchor_text": "[5]", "paragraph_index": 29}, {"url": "https://n2ws.com/blog/how-to-guides/connect-aws-ebs-volume-another-instance", "anchor_text": "[11]", "paragraph_index": 38}, {"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "ICML 2019", "paragraph_index": 40}, {"url": "https://arxiv.org/abs/1611.05431", "anchor_text": "CVPR 2017", "paragraph_index": 41}], "all_paragraphs": ["There are many articles and courses dedicated to the latest ML/AI research aimed at training bigger models and achieving higher classification accuracy. This is great for research and academia and pushing the limits of what AI can do. However, these are not really tailored for poor student practitioners starting off with their first major AI projects or penny conscious entrepreneurs looking to build an MVP of their cool revolutionary idea.", "In this work I take a budgeted approach to model training and try to answer the question:", "What is the minimum, practical cost to complete a real world AI project?", "The problem that I chose for this was an Image Classification problem.This article captures the process I followed and key budgeting lessons learned from each step.", "The answer is roughly $300 \u2192 This is the amount it takes to train a well performing Computer Vision model using cloud computing. Incidentally (or not) this is also the amount of credit that Google gives as incentive to get started on the Google Cloud Platform (GCP) [1].", "The breakdown of the budget is given below. The two rightmost columns list the instances from AWS and GCP that are most amenable to this task. The cost is an average of the instances listed in these columns. At present there is not a lot separating the two cloud providers in terms of cost.", "Of course there can be some variation in all these steps depending on the complexity of the problem and size of data. But in my experience for most initial projects or MVPs the total cost would not vary by more than a factor of 2 in either direction.", "A detailed discussion of each phase follows below.", "When tackling a new dataset and ML problem the first thing to do is understand the data, or in the words of A. Karpathy \u2014 \u201cBecome ONE with the data.\u201d[2]", "There is a huge variance in what practitioners do in this phase but there are a few common components:", "A>Understand the input format and develop some pipelines to play around with the data. I have seen that this step often takes more time than planned for when dealing with a new data set. However, if done well once, this will save a lot of time and effort throughout the project lifetime.", "B> Look at a few random images from each class While looking we are really trying to mentally answer questions like: What features could a CNN use to distinguish the output classes? What is the scale of these features? How varied is the lighting? How centered is the object in the image? \u2014 The answers to these questions will determine our pre-processing pipeline and the model architecture.", "C> Get a handle of the distribution of training samples across classes. This will tell us how skewed or balanced our training data is. If the data is skewed, as is often and painfully the case in any real world application, we would have to take appropriate steps in the training/testing process.", "This phase can be time consuming and will involve some scripting/notebooking effort. Also, these steps often don\u2019t benefit from GPUs or multi-core CPUs. On a budget, choose a light weight cloud instance for this phase. I try to mimic my macbook config for this \u2014 2 to 4 intel cores with a few hundred GB of SSD.", "The sample configurations from AWS/GCP listed in the summary table are priced between $0.10/hour to $0.20/hour with GCP being slightly more cost effective than AWS for a similar instance type. At ~ $0.10/hour, a day of usage costs around $1. This is the least expensive instance used in the project. Do the maximum amount of development here.", "The second step in the process is transfer learning i.e. \u2014 finding the most related CV paper in literature and trying to adapt its network architecture for the task at hand.", "There are hundreds of network architectures for object classification and a few more are added on arXiv[3] every month. It is easy to get enticed to use the latest model touting the best accuracy on ImageNet. However, that might not be the best idea when on a budget \u2026. or even otherwise.", "In the figure below (borrowed and simplified from [4]), the classification accuracy of some well known models is plotted against their complexity. FLOPS here stands for number of Floating Point Operations and is indicative of the complexity of the model.", "More complex models takes longer to train as compared to models with lower complexity. The models to the extreme right of this figure usually take a few weeks to train on a single GPU instance, the models on the left can be trained in a few days.", "In any exploratory project there will be quite a few iterations to figure out the right hyper-parameters and fine-tuning the data pre-processing pipeline. Hence, it is highly desirable to have a model that can be trained and validated in a few hours.", "You might notice as you browse through literature that most network architectures come in a few variants with different degrees of complexity and performance. While working on a budget pick the simplest variant of these architectures.", "My goto network architectures for an Image Classification problem are: \u2014", "These two architectures provide a great tradeoff between performance and complexity. Also, they are very popular models with good native implementations in all DL frameworks like TF and PyTorch. In addition, there are a great number of tutorials and blogs written about them that can help with quick on-boarding.", "Selecting the right set of hyper-parameters quickly and with less number of iterations is critical while working on a budget. Here are the top three hyper-parameters to focus on:", "A>Mini Batch Size: A mini-batch size should be large enough to keep the GPU fully utilized but no larger.", "B> Learning Rate: Selecting the optimum learning rate is in general a useful exercise. However, it becomes even more important while doing machine learning on a budget. A very low learning rate can waste precious time and dollars.", "C> Number of Trainable Layers & Input Image Size: During transfer learning, usually the initial layers of the network are frozen and gradient descent is applied only on the weights of the final few layers. The training time depends directly on the number of un-frozen weights. When the training data set is small, there is usually not a option to un-freeze many layers. However, when the training data set is large smartly changing the number of trainable layers can improve training time.", "Most networks today can work with different image sizes without any modification. This gives us a unique power to modify the input image size at different stages of training. Generally, we want to keep the image size small for faster processing while ensuring that the features needed for classification are clearly discernible.", "GPUs are the only sane way to train CNNs. All cloud services provide an array of GPU instance options. These instances vary by the number of GPUs and the capacity of each GPU. Figuring out the right GPU instance is one of the most critical decisions that impacts the time and dollar budget of the project.", "In this post, only single GPU instances are discussed \u2014 will probably discuss multi-GPU instances in a separate post. Surprisingly, none of the cloud providers publish any data on the performance comparison of their various GPU instances. The best reference for this that I found was from a group at Stanford called Stanford DAWN. [5]", "From above, note that the ResNet164 takes around 10 hours to train on a single instance K80 GPU (K80 is the least expensive of GPU instance on AWS and GCP) and the cost of running the complete model is ~$10. For tuning most hyper-parameters we might run the model for about half as long.", "Given a problem the same size as CIFAR10 most experiments should complete in 5\u201310 hours on a K80 instance.", "With this cost structure, we should be able to run around 20 complete experiments in 20 X $10 = $200. In practice, we would run maybe 20 experiments that last a short amount of time \u2014 maybe a 1\u201310 epochs and around 10 -15 experiments for a longer duration of time.", "Note that this is the best case time. In practice, there will be many times when the GPU is idle, there will be times when the code is modified or we are plotting results or debugging the model. This should add roughly a 20% overhead to the process.", "This is a topic often ignored in most Deep Learning courses. Everyone will tell Deep neural networks take a long time to train and that is true. However, it is good to know what to expect during the training process. Below are the training curves for some variations of ResNet from 4 different sources.", "A surprisingly observation is that all of the above training curves show exactly two elbows or big jumps in accuracy. Also note that two of the above training curves are on the CIFAR10 dataset while the other two are on the ImageNet1K dataset. Also, note that the performance jumps often occur after plateaus where it seems like the network has saturated and is not learning anything for 20\u201330 epochs!", "The long training times and step nature of learning curves leads to a conundrum when iterating on the model on a budget. The key to tackling this problem is the (unproven here) hypothesis that hyper-parameters which perform well on the first few epochs also seem to work well at higher epochs. This implies that for hyper-parameter tuning we can restrict ourselves to a small number of epochs, say 10\u201320. And we can then train for a large number of epochs (100 -200) when we have finalized on the hyper-parameters.", "There are a bunch of storage options available on AWS and GCP. AWS provides 30GB of EBS and 5GB of EFS storage for free. Additional storage is priced at $0.1/GB-month to $0.3/GB-month. GCP prices SSD storage at ~$0.17 /GB-month. For most initial applications a few hundred GBs of storage should suffice.", "If we are using different instances for data exploration and modeling it might be possible to use a common SSD volume across these phases. For details please refer to [11].", "For anyone starting a real world AI project in the cloud, the cost of infrastructure should be roughly in the range of a few hundred dollars. The key things that can help increase efficiency are:", "[4] M. Tan, Q.V. Le, EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks, ICML 2019.", "[9] S.Xie, R.Girshick, P.Doll\u00e1r, Z.Tu, K. He, Aggregated Residual Transformations for Deep Neural Networks, CVPR 2017", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd414c2e89132&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d414c2e89132--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@manusharma.fyi?source=post_page-----d414c2e89132--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manusharma.fyi?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Manu Sharma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F60d9ca8c6390&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&user=Manu+Sharma&userId=60d9ca8c6390&source=post_page-60d9ca8c6390----d414c2e89132---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://cloud.google.com/free/", "anchor_text": "[1]"}, {"url": "http://karpathy.github.io/2019/04/25/recipe/", "anchor_text": "[2]"}, {"url": "https://arxiv.org/", "anchor_text": "[3]"}, {"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "[4]"}, {"url": "https://dawn.cs.stanford.edu/benchmark/v1/CIFAR10/train.html", "anchor_text": "[5]"}, {"url": "https://dawn.cs.stanford.edu/benchmark/v1/CIFAR10/train.html", "anchor_text": "[4]"}, {"url": "https://arxiv.org/pdf/1512.03385.pdf", "anchor_text": "[8]"}, {"url": "https://github.com/facebookresearch/ResNeXt", "anchor_text": "[9]"}, {"url": "https://arxiv.org/pdf/1711.00489.pdf", "anchor_text": "[10]"}, {"url": "http://tbd-suite.ai/", "anchor_text": "[11]"}, {"url": "https://n2ws.com/blog/how-to-guides/connect-aws-ebs-volume-another-instance", "anchor_text": "[11]"}, {"url": "https://cloud.google.com/free/", "anchor_text": "https://cloud.google.com/free/"}, {"url": "http://karpathy.github.io/2019/04/25/recipe/", "anchor_text": "http://karpathy.github.io/2019/04/25/recipe/"}, {"url": "https://arxiv.org/", "anchor_text": "https://arxiv.org/"}, {"url": "https://arxiv.org/pdf/1905.11946.pdf", "anchor_text": "ICML 2019"}, {"url": "https://dawn.cs.stanford.edu/benchmark/v1/CIFAR10/train.html", "anchor_text": "https://dawn.cs.stanford.edu/benchmark/v1/CIFAR10/train.html"}, {"url": "https://aws.amazon.com/ec2/pricing/on-demand/", "anchor_text": "https://aws.amazon.com/ec2/pricing/on-demand/"}, {"url": "https://cloud.google.com/compute/vm-instance-pricing", "anchor_text": "https://cloud.google.com/compute/vm-instance-pricing"}, {"url": "http://openaccess.thecvf.com/content_cvpr_2016/papers/He_Deep_Residual_Learning_CVPR_2016_paper.pdf", "anchor_text": "CVPR 2016"}, {"url": "https://arxiv.org/abs/1611.05431", "anchor_text": "CVPR 2017"}, {"url": "https://arxiv.org/abs/1711.00489", "anchor_text": "ICLR 2018"}, {"url": "https://n2ws.com/blog/how-to-guides/connect-aws-ebs-volume-another-instance", "anchor_text": "https://n2ws.com/blog/how-to-guides/connect-aws-ebs-volume-another-instance"}, {"url": "https://pixabay.com/users/1820796-1820796/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2070384", "anchor_text": "1820796"}, {"url": "https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2070384", "anchor_text": "Pixabay"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d414c2e89132---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&user=Manu+Sharma&userId=60d9ca8c6390&source=-----d414c2e89132---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&user=Manu+Sharma&userId=60d9ca8c6390&source=-----d414c2e89132---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd414c2e89132&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d414c2e89132---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d414c2e89132--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d414c2e89132--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d414c2e89132--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d414c2e89132--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d414c2e89132--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manusharma.fyi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@manusharma.fyi?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Manu Sharma"}, {"url": "https://medium.com/@manusharma.fyi/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "7 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F60d9ca8c6390&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&user=Manu+Sharma&userId=60d9ca8c6390&source=post_page-60d9ca8c6390--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F60d9ca8c6390%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-on-a-budget-d414c2e89132&user=Manu+Sharma&userId=60d9ca8c6390&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}