{"url": "https://towardsdatascience.com/how-to-make-your-pandas-operation-100x-faster-81ebcd09265c", "time": 1683018145.7030861, "path": "towardsdatascience.com/how-to-make-your-pandas-operation-100x-faster-81ebcd09265c/", "webpage": {"metadata": {"title": "How to make your Pandas operation 100x faster | by Yifei Huang | Towards Data Science", "h1": "How to make your Pandas operation 100x faster", "description": "Pandas is a great tool for exploring and working with data. As such, it is deliberately optimized for versatility and ease of use, instead of performance. There are often many different ways to do\u2026"}, "outgoing_paragraph_urls": [{"url": "https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html", "anchor_text": "Cython", "paragraph_index": 10}, {"url": "https://numba.readthedocs.io/en/stable/user/5minguide.html", "anchor_text": "Numba", "paragraph_index": 10}, {"url": "https://twitter.com/yifei_huang", "anchor_text": "Twitter", "paragraph_index": 13}, {"url": "https://www.linkedin.com/in/yifeihuangdatascience/", "anchor_text": "Linkedin", "paragraph_index": 13}, {"url": "https://yifei-huang.medium.com/", "anchor_text": "Medium", "paragraph_index": 13}, {"url": "http://twitter.com/yifei_huang", "anchor_text": "twitter.com/yifei_huang", "paragraph_index": 15}, {"url": "http://linkedin.com/in/yifeihuangdatascience", "anchor_text": "linkedin.com/in/yifeihuangdatascience", "paragraph_index": 15}], "all_paragraphs": ["Pandas is a great tool for exploring and working with data. As such, it is deliberately optimized for versatility and ease of use, instead of performance. There are often many different ways to do the exact same operation, some of which are far more performant than others. This is not a problem if your data is relatively small or your transformation is relatively simple, but it can quickly becomes a bottleneck as the scale and complexity increase. In this article, I will walk through a few different approaches to optimizing the performance ranging from vectorization to parallelization.", "Let\u2019s start by making this issue more concrete with an example.", "A common operation when using Pandas is to create a new derived value based on one or more existing columns. The examples below (inspired by [1]) illustrates the various different ways of doing this using Pandas, and measure the resulting performance using the%timeit magic command in Jupyter notebooks.", "uses list comprehension along with the method iterrows , and is the slowest by a long shot. This is because it is effectively using a simple for loop and incurring the heavy overhead of using the pandas series object in each iteration. It is rarely necessary to use series object in your transformation function, so you should almost never use the iterrows method.", "replaces the iterrows method of the first approach with itertuples method. The improvement in performance is a whopping 60x (575ms -> 9.53ms). This is because the itertuples method bypasses the overhead associated with the Pandas series object and uses the simple tuples instead. If you need to loop through a Pandas dataframe, you should almost always itertuples instead of the iterrows", "uses the apply method instead of list comprehension to apply the function to each row of the dataframe. It still incurs the overhead of the Pandas series object when working with each row, but is 6x faster than the first approach because it is able to leverage some more efficient pre-compiled looping methods underneath the hood. It is, however, still effectively a for loop, just more efficient way to do so.", "is able to achieve a 4x speed up relative to the third approach, with a very simple parameter tweak in adding raw=True . This is telling the apply method to bypass the overhead associated with the Pandas series object and use simple map objects instead. It is interesting note that this is still slower than the second approach with itertuples", "uses np.vectorize to attempt to make the function provided more \u201cvectorized\u201d. This basically means it tries to leverage pre-compiled and native methods that are SIMD (Single Instruction Multiple Data) and significantly faster [2], as much as possible. Depending on the function, it may or may not actually yield a speed up, but it never hurts to try given the relative simplicity. In this particularly example, it worked quite well and yielded a 171x speed up relative to the first approach. It is even 3x faster than the itertuple method in the second approach.", "fully takes advantage of the vectorized native Numpy methods and is 1888x faster than the first approach we started with. Just like the np.vectorize method, it may not always be possible (or clear as to how) to vectorize the given function, but when you can you should definitely try. A good rule of thumb for assessing whether you can vectorize the function is if you can represent it as linear algebra operations on matrices and scalar values. If you can, you can likely find native Numpy methods to vectorize those operations.", "What if your function cannot be vectorized or you don\u2019t know how to?", "There are transformations of the data that simply cannot be vectorized, and therefore cannot benefit from the dramatic improvements that vectorization provided above (but you should still never use iterrows). One example of this type of transformation is regex operations on strings like extracting the top level domain from URLs. In these cases, there are a few different approaches like compiling your function using Cython or run-time compilers like Numba, or using parallel processing. I prefer parallel processing because it requires the least amount of rewrite of your existing code. You simply have to add a few lines wrapper code to make it work. The example below illustrates how you can do this", "As you can see with relatively little effort and no modification to the existing code, we were able to achieve a 7x speed up to the code by leveraging parallel processing. It is worth noting that this improvement increases with data scale and function run time, as can be seen in the graph below, where I varied simulated function run time from 0 to 0.5ms. The serial implementation processing time scales at a much higher rate than parallel implementation.", "A few important consideration to keep in mind when using parallel processing", "Hope this was a useful discussion. Feel free to reach out if you have comments or questions. Twitter | Linkedin | Medium", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data science at Sequoia Capital | Ex head of data science at Palantir | twitter.com/yifei_huang | linkedin.com/in/yifeihuangdatascience"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F81ebcd09265c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://yifei-huang.medium.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": ""}, {"url": "https://yifei-huang.medium.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Yifei Huang"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F829cb1ab6458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&user=Yifei+Huang&userId=829cb1ab6458&source=post_page-829cb1ab6458----81ebcd09265c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@mrbrodeur?utm_source=medium&utm_medium=referral", "anchor_text": "Matthew Brodeur"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html", "anchor_text": "Cython"}, {"url": "https://numba.readthedocs.io/en/stable/user/5minguide.html", "anchor_text": "Numba"}, {"url": "https://realpython.com/python-concurrency/", "anchor_text": "This article"}, {"url": "https://twitter.com/yifei_huang", "anchor_text": "Twitter"}, {"url": "https://www.linkedin.com/in/yifeihuangdatascience/", "anchor_text": "Linkedin"}, {"url": "https://yifei-huang.medium.com/", "anchor_text": "Medium"}, {"url": "https://stackoverflow.com/questions/52673285/performance-of-pandas-apply-vs-np-vectorize-to-create-new-column-from-existing-c", "anchor_text": "https://stackoverflow.com/questions/52673285/performance-of-pandas-apply-vs-np-vectorize-to-create-new-column-from-existing-c"}, {"url": "https://towardsdatascience.com/decoding-the-performance-secret-of-worlds-most-popular-data-science-library-numpy-7a7da54b7d72", "anchor_text": "https://towardsdatascience.com/decoding-the-performance-secret-of-worlds-most-popular-data-science-library-numpy-7a7da54b7d72"}, {"url": "https://realpython.com/python-concurrency/", "anchor_text": "https://realpython.com/python-concurrency/"}, {"url": "https://medium.com/tag/python?source=post_page-----81ebcd09265c---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/data-science?source=post_page-----81ebcd09265c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/editors-pick?source=post_page-----81ebcd09265c---------------editors_pick-----------------", "anchor_text": "Editors Pick"}, {"url": "https://medium.com/tag/numpy?source=post_page-----81ebcd09265c---------------numpy-----------------", "anchor_text": "Numpy"}, {"url": "https://medium.com/tag/pandas?source=post_page-----81ebcd09265c---------------pandas-----------------", "anchor_text": "Pandas"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&user=Yifei+Huang&userId=829cb1ab6458&source=-----81ebcd09265c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&user=Yifei+Huang&userId=829cb1ab6458&source=-----81ebcd09265c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F81ebcd09265c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----81ebcd09265c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----81ebcd09265c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----81ebcd09265c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----81ebcd09265c--------------------------------", "anchor_text": ""}, {"url": "https://yifei-huang.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://yifei-huang.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yifei Huang"}, {"url": "https://yifei-huang.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.1K Followers"}, {"url": "http://twitter.com/yifei_huang", "anchor_text": "twitter.com/yifei_huang"}, {"url": "http://linkedin.com/in/yifeihuangdatascience", "anchor_text": "linkedin.com/in/yifeihuangdatascience"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F829cb1ab6458&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&user=Yifei+Huang&userId=829cb1ab6458&source=post_page-829cb1ab6458--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa3ea401afa28&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-make-your-pandas-operation-100x-faster-81ebcd09265c&newsletterV3=829cb1ab6458&newsletterV3Id=a3ea401afa28&user=Yifei+Huang&userId=829cb1ab6458&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}