{"url": "https://towardsdatascience.com/advanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3", "time": 1682994242.7585049, "path": "towardsdatascience.com/advanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3/", "webpage": {"metadata": {"title": "Advanced Queries With SQL That Will Save Your Time | by Sergi Lehkyi | Towards Data Science", "h1": "Advanced Queries With SQL That Will Save Your Time", "description": "During the years of working with telecom data my folder with code snippets collected a lot of reusable examples. And it is not about \u201cSELECT * FROM Table1\u201d, I am talking about finding and handling or\u2026"}, "outgoing_paragraph_urls": [{"url": "http://sergilehkyi.com/advanced-queries-with-sql-that-will-save-your-time/", "anchor_text": "sergilehkyi.com", "paragraph_index": 19}], "all_paragraphs": ["During the years of working with telecom data my folder with code snippets collected a lot of reusable examples. And it is not about \u201cSELECT * FROM Table1\u201d, I am talking about finding and handling or removing duplicate values, selecting top N values from each group of data within same table, shuffling records within the groups, but keep groups sorted, finding the longest left match, expanding numbers by N digits and so on.", "Today I would like to share those snippets and explain how it all works. I work with Microsoft SQL Server and use T-SQL in my queries, but I am sure it is possible to find alternatives for other DBMS. If not, reach me out and we will try to find it together \ud83d\ude42", "For this article I have prepared the table of fake calls with fake numbers and real countries, so if you try to repeat the same transaction it won\u2019t work \ud83d\ude00 (ok, except for UK, they really have +44 country code, but I am not sure the number I used exists)", "The fastest and the easiest way to select only unique values from the table is by using DISTINCT keyword", "By indicating the columns we want to retrieve, we can select unique values based on numbers and countries only.", "But we lose information from other columns.", "Also we can find duplicates with GROUP BY, HAVING and COUNT(*)", "I know, in SQL database duplicates should not appear at all, you should use unique ids, constrains and indexes. But sometimes you just performing some tests, or doing some computations for the first time, experimenting \u2014 and duplicates appeared. Or your records have distinct ids, although you understand that one of them should be removed. What would you do in these cases? A long time ago I found this solution on stackoverflow, saved it and from then I use it at least few times per day (duplicates are quite common, job specifics). WITH statement and ROW_NUMBER() are my saviors.", "I have copied the original data into temporary table #t, because \u201cUndo\u201d doesn\u2019t work after delete, heh \ud83d\ude42 and we see the same result as with the GROUP BY, although with all columns. And now we can perform a DELETE here and remove all the duplication values based on our definition of duplication.", "PARTITION BY will serve as the duplication definition in this case and with ORDER BY we can, for example, remove calls that were shorter/longer in duration or those that started earlier/later or whatever condition you may found in other columns. Please note, ORDER BY clause is a must here, so if you don\u2019t have any specific condition for ordering just put any field there.", "I believe you already know how to do that :D. Yes, with ROW_NUMBER() again. This function will partition our data and assign a number to each record within a group, so then we just have to specify which range of top N we want to select: top 10? \u2014 RN = 3 and RN", "Let\u2019s select only top 2nd record within the groups of countries from which the calls were made (\u2018CountryFrom\u2019) that have their names starting with the same letter and sort values by duration within the groups. (I have inserted the same data into temp table 3 times to better see the differences)", "Look how Germany and Greece are put in one group and Ireland with Italy into another. And to select only second record within each group:", "Actually this technique can be used to shuffle records in any case, not only within the group, but as we already started with groups, ROW_NUMBER and WITH statements I decided to make it little bit more complicated. I don\u2019t know if in any period of your life you will need to shuffle records within a group, but if that one occasion appears you know how to do that. Again, this is part of my day-to-day job and I know it\u2019s a rare task :)) So back to queries. We will use the same grouping condition and for shuffling it\u2019ll be a combination of functions ABS() \u2014 function that is used to get the absolute value of a number passed as an argument, CHECKSUM() \u2014 function that returns the checksum value computed over a table row, or over an expression list, and NEWID() \u2014 that creates a unique value of type uniqueidentifier. While reading you might think \u2014 what the hell? But I\u2019m telling, it does the job. Look:", "It might be not that obvious with small amount of data, but the most exiting thing is every time you run this query it shuffles again. So after a second run:", "You may noticed now POLAND is the first record and SPAIN is the second.", "That\u2019s it for today. Few tips with ROW_NUMBER() that help me a lot in my work and I hope will help someone else too.", "Despite it doesn\u2019t include machine learning, artificial intelligence, image recognition, model tuning, deep neural networks or any other fancy terms that pop up in data science field, working with data using SQL is still part of data science. And there are still a lot of data professionals that work with this language and relational databases. Let\u2019s do not forget our roots, my fellows.", "Thanks for reading, be cool, professional and have a fantastic day.", "Originally published at sergilehkyi.com on December 16, 2018 in 4 different languages (EN, ES, UA, RU)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data and Cloud Developer, love technology in general, maybe too much humor and never too serious, based in amazing Barcelona"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F48a45b7ca2e3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://sergilehkyi.medium.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Sergi Lehkyi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F82a9856ae35c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&user=Sergi+Lehkyi&userId=82a9856ae35c&source=post_page-82a9856ae35c----48a45b7ca2e3---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/Bkci_8qcdvQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Kalen Emsley"}, {"url": "https://unsplash.com/search/photos/mountains?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://sergilehkyi.com/advanced-queries-with-sql-that-will-save-your-time/", "anchor_text": "sergilehkyi.com"}, {"url": "https://medium.com/tag/sql?source=post_page-----48a45b7ca2e3---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/sql-server?source=post_page-----48a45b7ca2e3---------------sql_server-----------------", "anchor_text": "Sql Server"}, {"url": "https://medium.com/tag/database?source=post_page-----48a45b7ca2e3---------------database-----------------", "anchor_text": "Database"}, {"url": "https://medium.com/tag/data-analysis?source=post_page-----48a45b7ca2e3---------------data_analysis-----------------", "anchor_text": "Data Analysis"}, {"url": "https://medium.com/tag/data?source=post_page-----48a45b7ca2e3---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&user=Sergi+Lehkyi&userId=82a9856ae35c&source=-----48a45b7ca2e3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&user=Sergi+Lehkyi&userId=82a9856ae35c&source=-----48a45b7ca2e3---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F48a45b7ca2e3&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----48a45b7ca2e3---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----48a45b7ca2e3--------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://sergilehkyi.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sergi Lehkyi"}, {"url": "https://sergilehkyi.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "598 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F82a9856ae35c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&user=Sergi+Lehkyi&userId=82a9856ae35c&source=post_page-82a9856ae35c--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F65a0e191fdf8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-queries-with-sql-that-will-save-your-time-48a45b7ca2e3&newsletterV3=82a9856ae35c&newsletterV3Id=65a0e191fdf8&user=Sergi+Lehkyi&userId=82a9856ae35c&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}