{"url": "https://towardsdatascience.com/to-serve-man-60246a82d953", "time": 1683004128.8431869, "path": "towardsdatascience.com/to-serve-man-60246a82d953/", "webpage": {"metadata": {"title": "To Serve Man. Deploying models on Kubernetes using\u2026 | by Alexander Sack | Towards Data Science", "h1": "To Serve Man", "description": "One of the very best papers ever written about machine learning ironically had very little to do with, well, actual machine learning! In the paper, Hidden Technical Debt in Machine Learning Systems\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=11&cad=rja&uact=8&ved=2ahUKEwjBoYzg-8DnAhWIl-AKHfQ2AOEQFjAKegQIAxAB&url=https%3A%2F%2Fpapers.nips.cc%2Fpaper%2F5656-hidden-technical-debt-in-machine-learning-systems&usg=AOvVaw3pwxPSkCQaevZTdxkTOe0G", "anchor_text": "Hidden Technical Debt in Machine Learning Systems,", "paragraph_index": 1}, {"url": "https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/", "anchor_text": "YAML", "paragraph_index": 11}, {"url": "https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/", "anchor_text": "CRDs", "paragraph_index": 11}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/reference/apis/internal-api.html", "anchor_text": "Seldon Core supports a number of different kinds of nodes", "paragraph_index": 18}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/workflow/install.html", "anchor_text": "Just follow a few simple instructions to deploy it", "paragraph_index": 21}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/wrappers/README.html", "anchor_text": "Seldon Core supports a multitude of languages", "paragraph_index": 22}, {"url": "https://github.com/openshift/source-to-image", "anchor_text": "OpenShift\u2019s s2i tool", "paragraph_index": 25}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/", "anchor_text": "extensive documentation", "paragraph_index": 49}], "all_paragraphs": ["One of the very best papers ever written about machine learning ironically had very little to do with, well, actual machine learning!", "In the paper, Hidden Technical Debt in Machine Learning Systems, a group of machine learning researchers from Google astutely pointed out that \u201conly a small fraction of any real-world ML system is composed of ML code\u201d and that typically \u201cthe required surrounding infrastructure [of the model] is vast and complex.\u201d", "In other words, being able to transition a model from a single cell in a Jupyter notebook to a piece of actual production software is not easy.", "As the paper\u2019s diagram illustrates above, one of the bigger pieces of any production ML system is its serving infrastructure, which is typically where stakeholders get to actually interact with the ML code.", "And for many enterprises that infrastructure is some sort of container orchestration engine like Kubernetes.", "But before diving into the technical details about how to serve models under Kubernetes using a framework like Seldon Core, why go through all this trouble in the first place?", "It is much easier to maintain and manage a complex system when it defines and enforces true separation of concerns across its major functional areas.", "Put simply, you want all the machine learning code to be self-contained and not be dependent on the run-time of the broader application in which it is a part of.", "That\u2019s why for example, serving models as self-contained Docker images or burying them within a custom Flask or Shiny application is generally frowned upon in production \u2014 it hides the machine learning bits underneath a lot of layers making it harder to manage.", "Ideally, you want to be able to leverage the same deployment and management idioms you use for your other compute resources like CPU, storage, etc. but with your models.", "That way data scientists and/or machine learning engineers can focus on model design and performance while your MLop person can focus on model deployment and the infrastructure around it.", "In the Kubernetes world, that means models should be defined as true Kubernetes objects (YAML/CRDs) and managed with kubectl.", "Seldon Core is an open source project that provides a general purpose model serving framework for your Kubernetes cluster. It solves three main challenges:", "In this article, we are going to deploy a simple REST style model service under Seldon Core that ingests an image and then returns it unmodified.", "In the process, you will see how easily it is to inject your ML code to perform inference to create a full fledged model microservice.", "By the end of the article, you should have a solid understanding on how to deploy models under Seldon Core on Kubernetes.", "Seldon Core\u2019s prediction API has you define your model as an inference graph.", "Requests flow through each node of the graph eventually hitting a Model leaf node that runs some kind of prediction function in your favorite ML framework (e.g. Tensorflow, scikit-learn) and returns the result.", "Seldon Core supports a number of different kinds of nodes that allows you to create more complex inference graph workflows as the diagram above demonstrates.", "The simplest inference graph though is one with just a single root Model node, which is what our example service will implement.", "The following assumptions are being made when walking through the below tutorial:", "Seldon Core is easy to install: Just follow a few simple instructions to deploy it.", "Currently, Seldon Core supports a multitude of languages including Python, R, Java, NodeJS, and now Go (alpha).", "The fundamental unit of execution in any k8s cluster is a Pod, which is always backed by one or more Docker containers.", "Seldon Core has you first implement your model code under their prediction API and then wrap it within a Docker container.", "The image you create can either be built via a Dockerfile directly or using OpenShift\u2019s s2i tool with Seldon Core\u2019s wrapper images as a base.", "For our simple Python based service example, we will create it directly using a few simple Dockerfile directives.", "Alright, let\u2019s code up a simple Python service we can deploy under Seldon Core using its prediction API.", "Our service is simply going to read in an image as a tensor and then return it.", "Create a file called MyModel.py as follows:", "Now that we have our model class is sorted out, let\u2019s use this code to build a Docker container using the Seldon Core wrapper APIs.", "Create a Dockerfile that looks like:", "Build the image and push it to your cluster\u2019s repository:", "Now that we have an image built, let\u2019s test it by running our seldon-core-microservice as a stand alone docker container:", "Notice that the MyModel class you wrote above got loaded and is being served up as a Flask application on port 5000. The model\u2019s prediction endpoint is at \u2018/predict\u2019 or \u2018/api/v0.1/predictions\u2019.", "Let\u2019s test our MyModel service by writing a simple client script that will POST an image file to our model\u2019s predict endpoint. We will use this same script to test our deployment lon Kubernetes by just changing the URL.", "Let\u2019s test our service now using this script:", "Let\u2019s also see the log messages of the docker container that processed the image:", "Like all things Kubernetes, Seldon Core defines its own Deployment object called a SeldonDeployment via a Custom Resource Definition (CRD) file.", "Let\u2019s define our model\u2019s SeldonDeployment via a seldon-deploy.yaml file:", "Let\u2019s create the SeldonDeployment and look at deployment as well as the objects behind that get created:", "Now that our model microservice is up and running, let\u2019s test it using the same client above. We need to either setup a publicly accessible Ingress or use port-forwarding to create a direct connection to our Service object.", "In our simple example, let\u2019s just use a simple port-forward:", "We just sent an image for inference and got a response back from our microservice running on our cluster.", "You can now open up your original image and the result one returned by our microservice and it should look the same.", "To verify we can even dump the logs within the Pod itself:", "Our SeldonDeployment and associated objects are all now terminated.", "I hope by going through this short tutorial you have a deeper understanding of how to use Seldon Core to deploy your models as microservices under Kubernetes.", "In general, the Seldon Core development workflow is as follows:", "Seldon Core supports many advanced features that I did not touch upon within this article so I encourage you to really peruse the project\u2019s extensive documentation to better understand its overall design and vast feature set.", "But hopefully, this article gave you just enough of a taste to pique your interest in why a dedicated serving infrastructure like Seldon Core is well worth your time and energy.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Currently, I\u2019m a senior member of IEX Cloud's engineering team. We develop and evolve a streaming Fintech platform called Apperate."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F60246a82d953&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----60246a82d953--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@pisymbol?source=post_page-----60246a82d953--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pisymbol?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Alexander Sack"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe13ebfdd5f62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&user=Alexander+Sack&userId=e13ebfdd5f62&source=post_page-e13ebfdd5f62----60246a82d953---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=11&cad=rja&uact=8&ved=2ahUKEwjBoYzg-8DnAhWIl-AKHfQ2AOEQFjAKegQIAxAB&url=https%3A%2F%2Fpapers.nips.cc%2Fpaper%2F5656-hidden-technical-debt-in-machine-learning-systems&usg=AOvVaw3pwxPSkCQaevZTdxkTOe0G", "anchor_text": "Hidden Technical Debt in Machine Learning Systems,"}, {"url": "https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/", "anchor_text": "YAML"}, {"url": "https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/", "anchor_text": "CRDs"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/reference/apis/internal-api.html", "anchor_text": "Seldon Core supports a number of different kinds of nodes"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/workflow/install.html", "anchor_text": "Just follow a few simple instructions to deploy it"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/wrappers/README.html", "anchor_text": "Seldon Core supports a multitude of languages"}, {"url": "https://github.com/openshift/source-to-image", "anchor_text": "OpenShift\u2019s s2i tool"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/reference/apis/prediction.html#proto-buffer-and-grpc-definition", "anchor_text": "here"}, {"url": "https://opencv.org/", "anchor_text": "OpenCV"}, {"url": "https://bootstrap.pypa.io/get-pip.py", "anchor_text": "https://bootstrap.pypa.io/get-pip.py"}, {"url": "https://flask.palletsprojects.com", "anchor_text": "Flask"}, {"url": "http://0.0.0.0:5000/", "anchor_text": "http://0.0.0.0:5000/"}, {"url": "http://localhost:5000/api/v0.1/predictions", "anchor_text": "http://localhost:5000/api/v0.1/predictions"}, {"url": "http://localhost:5000/api/v0.1/predictions", "anchor_text": "http://localhost:5000/api/v0.1/predictions"}, {"url": "http://localhost:8000/api/v0.1/predictions", "anchor_text": "http://localhost:8000/api/v0.1/predictions"}, {"url": "http://localhost:8000/api/v0.1/predictions", "anchor_text": "http://localhost:8000/api/v0.1/predictions"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/", "anchor_text": "extensive documentation"}, {"url": "https://medium.com/tag/kubernetes?source=post_page-----60246a82d953---------------kubernetes-----------------", "anchor_text": "Kubernetes"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----60246a82d953---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/seldon?source=post_page-----60246a82d953---------------seldon-----------------", "anchor_text": "Seldon"}, {"url": "https://medium.com/tag/data-science?source=post_page-----60246a82d953---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&user=Alexander+Sack&userId=e13ebfdd5f62&source=-----60246a82d953---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&user=Alexander+Sack&userId=e13ebfdd5f62&source=-----60246a82d953---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----60246a82d953--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F60246a82d953&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----60246a82d953---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----60246a82d953--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----60246a82d953--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----60246a82d953--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----60246a82d953--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----60246a82d953--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pisymbol?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@pisymbol?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alexander Sack"}, {"url": "https://medium.com/@pisymbol/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "33 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe13ebfdd5f62&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&user=Alexander+Sack&userId=e13ebfdd5f62&source=post_page-e13ebfdd5f62--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff2ad4d2ded18&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fto-serve-man-60246a82d953&newsletterV3=e13ebfdd5f62&newsletterV3Id=f2ad4d2ded18&user=Alexander+Sack&userId=e13ebfdd5f62&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}