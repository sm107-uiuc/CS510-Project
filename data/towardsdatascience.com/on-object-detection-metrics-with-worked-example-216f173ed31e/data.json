{"url": "https://towardsdatascience.com/on-object-detection-metrics-with-worked-example-216f173ed31e", "time": 1683013075.4978602, "path": "towardsdatascience.com/on-object-detection-metrics-with-worked-example-216f173ed31e/", "webpage": {"metadata": {"title": "Object Detection Metrics With Worked Example | by Kiprono Elijah Koech | Towards Data Science", "h1": "Object Detection Metrics With Worked Example", "description": "Average Precision (AP) and mean Average Precision (mAP) are the most popular metrics used to evaluate object detection models, such as Faster R_CNN, Mask R-CNN, and YOLO, among others. The same\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/pdf/1405.0312.pdf", "anchor_text": "Microsoft COCO", "paragraph_index": 26}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Mask R-CNN", "paragraph_index": 26}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Mask R-CNN paper", "paragraph_index": 27}, {"url": "https://medium.com/@kiprono_65591/membership", "anchor_text": "https://medium.com/@kiprono_65591/membership", "paragraph_index": 42}, {"url": "https://medium.com/subscribe/@kiprono_65591", "anchor_text": "https://medium.com/subscribe/@kiprono_65591", "paragraph_index": 43}, {"url": "https://www.linkedin.com/in/kipronokoech/", "anchor_text": "https://www.linkedin.com/in/kipronokoech/", "paragraph_index": 46}], "all_paragraphs": ["Average Precision (AP) and mean Average Precision (mAP) are the most popular metrics used to evaluate object detection models, such as Faster R_CNN, Mask R-CNN, and YOLO, among others. The same metrics have also been used to evaluate submissions in competitions like COCO and PASCAL VOC challenges.", "In this article, we will go through these concepts so that, at the end of the day, you can understand them clearly. The following Figures (Fig 1 and Fig 2) show the usage of these metrics in some start-of-art (SOTA) models.", "At a low level, evaluating the performance of an object detector boils down to determining if the detection is correct.", "We need another helper metric called Intersection over Union (IoU) to define those terms in a more quantifiable way.", "IoU metric in object detection evaluates the degree of overlap between the ground(gt) truth and prediction(pd). The ground truth and the prediction can be of any shape-rectangular box, circle, or irregular shape). It is calculated as follows:", "Diagrammatically, IoU is defined as follows (the area of the intersection divided by the area of union between ground-truth and predicted box.", "IoU ranges between 0 and 1, where 0 shows no overlap, and 1 means perfect overlap between gt and pd. IoU metric is useful through thresholding; that is, we need a threshold (\u03b1, say) to determine whether detection is correct.", "For the IoU threshold at \u03b1, True Positive(TP) is a detection for which IoU(gt,pd)\u2265 \u03b1 and False Positive is a detection for which IoU(gt,pd)< \u03b1. False Negative is a ground truth missed together with gt for which IoU(gt,pd)< \u03b1.", "Is that clear? If not, the following Figure should make the definitions clearer.", "Considering the IoU threshold, \u03b1 = 0.5, then TP, FP and FNs can be identified as shown in Fig 4 below.", "Note: If we raise the IoU threshold above 0.86, the first instance will be FP; if we lower the IoU threshold below 0.24, the second instance becomes TP.", "Remark: The decision to mark a detection as TP or FP and ground-truth as FN is completely contingent on the choice of IoU threshold, \u03b1. For example, in the above Figure, if we lower the threshold below 0.24, then the detection in the second image becomes TP, and if the IoU threshold is raised above 0.86, the detection on the first image will be FP.", "Precision is the degree of exactness of the model in identifying only relevant objects. It is the ratio of TPs over all detections made by the model.", "Recall measures the ability of the model to detect all ground truths\u2014 proposition of TPs among all ground truths.", "A model is said to be good if it has high precision and high recall. A perfect model has zero FNs and zero FPs (precision=1 and recall=1). Often, attaining a perfect model is not feasible.", "Heads up: Before going on, look at this Figure and read its caption.", "Just like IoU described earlier, confidence scoring also relies on the threshold. Raising the confidence score threshold means that more objects will be missed by the model (more FNs and, therefore, low recall and high precision), whereas a low confidence score will mean that the model gets more FPs (hence low precision and high recall). This means we need to develop some trade-offs for precision and recall.", "The precision-recall (PR) curve is a plot of precision and recall at varying confidence values. For a good model, precision and recall stay high even when the confidence score varies.", "AP@\u03b1 is Area Under the Precision-Recall Curve(AUC-PR) evaluated at \u03b1 IoU threshold. Formally, it is defined as follows.", "Notation: AP@\u03b1 or AP\u03b1 means that AP precision is evaluated at \u03b1 IoU threshold. If you see metrics like AP50 and A75, they mean AP calculated at IoU=0.5 and IoU=0.75, respectively.", "A high Area Under the PR Curve means high recall and high precision. Naturally, the PR curve is a zig-zag-like plot. That means that it is not monotonically decreasing. We can remove this property using interpolation methods. We will discuss two of those interpolation methods below:", "An 11-point AP is a plot of interpolated precision scores for model results at 11 equally spaced standard recall levels, namely, 0.0, 0.1, 0.2, . . . 1.0. It is defined as", "that is, interpolated precision at recall value, r \u2014 It is the highest precision for any recall value r'\u2265 r. If this one doesn't make sense, I promise you it will make full sense once we go through an example.", "All \u2014 point interpolation methodIn this case, interpolation is done for all the positions (recall values), that is,", "Remark (AP and the number of classes): AP is calculated individually for each class. This means that there are as many AP values as the number of classes (loosely). These AP values are averaged to obtain the mean Average Precision (mAP) metric.", "Definition: The mean Average Precision (mAP) is the average of AP values over all classes.", "Remark (AP and IoU): As mentioned earlier, AP is calculated at a given IoU threshold, \u03b1. With this reasoning, AP can be calculated over a range of thresholds. Microsoft COCO calculated the AP of a given category/class at 10 different IoU ranging from 50% to 95% at 5% step-size, usually denoted AP@[.50:.5:.95]. Mask R-CNN reports the average of AP@[.50:.5:.95] simply as AP. It says", "\u201cWe report the standard COCO metrics including AP (averaged over IoU thresholds), AP50,AP75, and APS, APM, APL(AP at different scales)\u201d \u2014 Extract from Mask R-CNN paper", "To make all these things clearer, let us go through an example.", "Consider the 3 images shown in Figure 5 below. They contain 12 detection (red boxes) and 9 ground truths (green). Each detection has a class marked by a letter and the model confidence. In this example, consider that all the detections are of the same object class, and the IoU threshold is set \u03b1 = 50 per cent. IoU values are shown in Table 1 below.", "Remark (Multiple detections): e.g. c,d in image 1, g,f in image 2 and i,k in image 3. For multiple detections like that, a detection with the highest confidence is labelled TP, and all other detections are marked as FPs, provided that the detection has an IoU\u2265threshold with the truth box. This means that:", "Multiple detections of the same object in an image were considered false detections e.g. 5 detections of a single object counted as 1 correct detection and 4 false detections \u2014 Source: PASCAL VOC 2012 paper.", "Some detectors can output multiple detections overlapping a single ground truth. For those cases the detection with the highest confidence is considered a TP and the others are considered as FP, as applied by the PASCAL VOC 2012 challenge. -Source: A Survey on Performance Metrics for Object-Detection Algorithms paper.", "Important: Before filling up cumTP, cumFP, all_detection, precision, and recall, you need to sort the table values by confidence in descending order. precision is cumTP/all_detections and recall is cumTP/number_of_ground_truths. We have nine ground truths.", "To calculate the approximation of AP@0.5 using 11-point interpolation, we need to average the precision values for recall values in R (see Equation 3), that is, for recall values 0.0, 0.1, 0.2, . . . 1.0. as shown in Fig 6 Right below.", "From the definition in Equation 5, we can calculate AP@50 using all-point interpolation as follows.", "Simply put, all-point interpolation involves calculating and summing area values of the four regions (R1, R2, R3 and R4) in Figure 1.3b, that is,", "Remark: Recall that we said AP is calculated for each class. Our calculations are for one class. For several classes, we can calculate mAP by simply taking the average of the resulting AP values for the different classes.", "Here is another article on object detection metrics", "After going through this article, I hope you understand AP, mAP and PR curves well. You have also noticed that IoU is an important concept because we can define none of these metrics without defining a threshold based on IoU. We have also learnt that AP is calculated per class, and the average of the resulting AP values is the mAP. AP can also be calculated for different IoU thresholds.", "It is also important to note that the prediction mask may not necessarily be a rectangular box. It can come in any shape, specifically the shape of the detected object. The following Figure shows an example of detections being irregular in shape.", "If you found this article helpful and would like to know about Python implementation, please write to me. Email on my profile.", "Join medium at https://medium.com/@kiprono_65591/membership to get full access to every story on Medium.", "You can also get the articles into your email inbox whenever I post using this link: https://medium.com/subscribe/@kiprono_65591", "As always, thank you for reading :-)", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Scientist || Statistician||Writer. You can contact me on LinkedIn on: https://www.linkedin.com/in/kipronokoech/ or on email using: kiprono@aims.ac.za"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F216f173ed31e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----216f173ed31e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@kiprono_65591?source=post_page-----216f173ed31e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kiprono_65591?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Kiprono Elijah Koech"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9872f324f100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&user=Kiprono+Elijah+Koech&userId=9872f324f100&source=post_page-9872f324f100----216f173ed31e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@xps?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "XPS"}, {"url": "https://unsplash.com/s/photos/computer?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Source"}, {"url": "https://pjreddie.com/media/files/papers/YOLOv3.pdf", "anchor_text": "Source"}, {"url": "https://cocodataset.org/#detection-eval", "anchor_text": "Source"}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Mask R-CNN"}, {"url": "https://arxiv.org/pdf/1405.0312.pdf", "anchor_text": "Microsoft COCO"}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Mask R-CNN"}, {"url": "https://arxiv.org/pdf/1703.06870.pdf", "anchor_text": "Mask R-CNN paper"}, {"url": "https://towardsdatascience.com/confusion-matrix-and-object-detection-f0cbcb634157", "anchor_text": "Confusion Matrix and Object DetectionA metric to evaluate performance of instance segmentation modelstowardsdatascience.com"}, {"url": "https://towardsdatascience.com/7-months-of-a-relationship-whatsapp-messages-analyzed-e5c34b8aaa63", "anchor_text": "7 Months of a Relationship, WhatsApp Messages AnalyzedAnalysis of WhatsApp data using Python. So simple. Anyone can follow.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/web-scraping-e-commerce-website-using-selenium-1088131c8541", "anchor_text": "Web Scraping E-Commerce Website Using SeleniumA simplified example of scraping an online books store.towardsdatascience.com"}, {"url": "https://github.com/rafaelpadilla/Object-Detection-Metrics", "anchor_text": "https://github.com/rafaelpadilla/Object-Detection-Metrics"}, {"url": "https://medium.com/@kiprono_65591/membership", "anchor_text": "https://medium.com/@kiprono_65591/membership"}, {"url": "https://medium.com/subscribe/@kiprono_65591", "anchor_text": "https://medium.com/subscribe/@kiprono_65591"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----216f173ed31e---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/data-science?source=post_page-----216f173ed31e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/mean-average-precision?source=post_page-----216f173ed31e---------------mean_average_precision-----------------", "anchor_text": "Mean Average Precision"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----216f173ed31e---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----216f173ed31e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&user=Kiprono+Elijah+Koech&userId=9872f324f100&source=-----216f173ed31e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&user=Kiprono+Elijah+Koech&userId=9872f324f100&source=-----216f173ed31e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F216f173ed31e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----216f173ed31e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----216f173ed31e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----216f173ed31e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----216f173ed31e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----216f173ed31e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----216f173ed31e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kiprono_65591?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@kiprono_65591?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Kiprono Elijah Koech"}, {"url": "https://medium.com/@kiprono_65591/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1K Followers"}, {"url": "https://www.linkedin.com/in/kipronokoech/", "anchor_text": "https://www.linkedin.com/in/kipronokoech/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9872f324f100&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&user=Kiprono+Elijah+Koech&userId=9872f324f100&source=post_page-9872f324f100--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fab1eb8a83bbd&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fon-object-detection-metrics-with-worked-example-216f173ed31e&newsletterV3=9872f324f100&newsletterV3Id=ab1eb8a83bbd&user=Kiprono+Elijah+Koech&userId=9872f324f100&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}