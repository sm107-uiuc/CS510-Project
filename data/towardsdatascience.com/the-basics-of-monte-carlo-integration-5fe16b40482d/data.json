{"url": "https://towardsdatascience.com/the-basics-of-monte-carlo-integration-5fe16b40482d", "time": 1683015675.244283, "path": "towardsdatascience.com/the-basics-of-monte-carlo-integration-5fe16b40482d/", "webpage": {"metadata": {"title": "The basics of Monte Carlo integration | by Victor Cumer | Towards Data Science", "h1": "The basics of Monte Carlo integration", "description": "We all remember the integrals we had to compute manually in hight school. To do so, we had to compute a series of more or less complexe operations to find the antiderivative functions\u2019 expressions\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["We all remember the integrals we had to compute manually in hight school. To do so, we had to compute a series of more or less complexe operations to find the antiderivative functions\u2019 expressions before applying substraction through the desired interval. However, you may also remember that integrating a function is graphically equivalent to calculating the area under the curve of that function. The principle of numerical integration lies on this second statement. The idea is to estimate the integral of a function, over a defined interval, only knowing the function expression. For such an aim, Monte Carlo methods are a great help. Monte Carlo integration is a technique for numerical integration using random numbers.", "Let\u2019s try to integrate a univariate function f. We will denote by F the value of the integral.", "As we said in the introduction, this integral can be interpreted as the area below the function\u2019s curve. Let\u2019s take the following function as an example:", "The figure 1 is the graphical representation of f and the integral we\u2019d like to compute.", "Let\u2019s say a=-2 and b=5. If we take a random point x_i between a and b, we can multiply f(x_i) by (b-a) to get the area of a rectangle of width (b-a) and height f(x_i). The idea behind Monte Carlo integration is to approximate the integral value (gray area on figure 1) by the averaged area of rectangles computed for random picked x_i. This is illustrated in figure 2 below.", "By adding up the area of the rectangles and averaging the sum, the resulting number gets closer and closer to the actual result of the integral. In fact, the rectangles which are too large compensate for the rectangles which are too small. So it seems that the empirical mean of f(x) could be a good estimator for the integral. This idea is formalized with the following formula, which is the Monte Carlo estimator (N is the number of random draws for X):", "In this formula, X is a random variable, and so is FN. The law of large numbers gives us that as N approaches infinity, the Monte Carlo estimator converges in probability to F, the true value of the integral:", "Another important result we get from the Monte Carlo estimator is the variance of the estimator: \ud835\udf0e^2 / N where \ud835\udf0e is the standard deviation of the function values, and N is the number of samples x_i. It means we need 4 times more samples to reduce the error of the estimator by 2.", "In the following two parts, we will give concrete examples of implementation for integration in python (2D and 3D) with the crude method first, and then we will explain a variance reduction solution: importance sampling.", "The crude Monte Carlo method is the most basic application of the concept described above:", "To illustrate the process, let\u2019s take a concrete use case: we want to integrate the beta distribution function beta(x, 50, 50) over the interval [0 ; 0.55] as it is described on figure 3 below. If X is a random variable that follows this beta law, this integral corresponds to P(X <= 0.55), which can be calculated exactly with the cumulative density function (c.d.f.) of the beta(x, 50, 50) density law: it gives 0.8413. We will try to approach this number through Monte Carlo integration.", "As describe earlier, we will do N = 10 000 random draws of x_i using the uniform distribution. Then, we compute the integral estimation and the associated error using the following formulas:", "The blue points correspond to the 10 000 values of f(x_i) computed from the uniform draws we made over X.", "We can already notice that because the draws were made uniformly over X (i.e. the horizontal axe), we have quite some space and less overlapping between the points when the slope of the curve increases.", "Another way to compute the integral is to make a geometric approximation of the integral. Indeed, by using uniform random draws over both x and y axes, we map a 2D rectangle that correspond to the desired range [x_min ; x_max] and compute the ratio of points under the curve over the total points drawn in the rectangle. This ratio would converge to the area under the curve with N, the number of draws. This idea is illustrated in figure 5.", "The idea behind Importance Sampling is very simple: as the error of the Monte Carlo estimator is proportional to the standard deviation of f(x) divided by the square root of the number of samples, we should find a cleverer method to chose x_i than the uniform law. Importance Sampling is in fact a way to draw x_i to reduce the variance of f(x). Indeed, for the function beta(x, 50, 50) we noticed a lot of x_i over [0 ; 0.55] will give a f(x) ~ 0, while only few values of x around 0.5 will give f(x) ~ 8.", "The key idea of Importance Sampling is that we use a probability density function (p.d.f.) to draw samples over X that will give more chance to high values of f(x) to be computed, and then we weight the sum of f(x) by the chance that x happened (i.e. the value of the p.d.f.).", "Following this idea, the integral we try to approximate will became:", "And the variance of f used to compute error of the estimator becomes:", "Back to our use case with the beta(x,50,50) distribution function, it seems that using a normal distribution centered at 0.5 as the g function could help us. The links between f and g are shown on figure 6 below.", "Figure 7 below shows the results of using such a method to integrate beta(x,50,50) over [0 ; 0.55]. The density of the points also shows the relevance to use of the Gaussian p.d.f compared to the uniform law to choose x_i: the x_i points are concentrated in areas of interest, where f(x_i) != 0.", "Here is the summary of integral values and relative errors. We reduce x4 the error with the Importance Sampling method.", "Figure 8 takes an example of 3D jointplot mapped on a 2D space (x_A, x_B). This example is taken from the analysis of Bayesian A/B tests. The blue contour plot corresponds to beta distribution functions for 2 different variants (A and B). The idea is to compute the probability that variation B is better than variation A by calculating the integral of the joint posterior f, the blue contour plot on the graph, for x_A and x_B values that are over the orange line (i.e. values where x_B >= x_A ).", "Thus, let\u2019s compute the integral that corresponds to the area below the blue 3D bell for values of x_A and x_B that respect x_B >= x_A (upper to the orange line on the graph). This time we will draw N = 100 000 samples.", "The importance sampling method enabled to reach an almost x10 more precise result with the same amount of samples.", "The crude method and importance sampling belong to a large range of Monte Carlo integration methods. Here you have all the material to implement these two techniques in python with no more than usual libraries as numpy and scipy. Keep in mind that Monte Carlo integration is particularly useful for higher-dimensional integrals. With the example we came through, we got a x10 improvement regarding precision for the 3D case, while it was a x4 improvement for the 2D case.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5fe16b40482d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://victor-cumer.medium.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": ""}, {"url": "https://victor-cumer.medium.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Victor Cumer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2c7560f4c546&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&user=Victor+Cumer&userId=2c7560f4c546&source=post_page-2c7560f4c546----5fe16b40482d---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@roman_lazygeek?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Roman Mager"}, {"url": "https://unsplash.com/s/photos/maths?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://cs.dartmouth.edu/~wjarosz/publications/dissertation/appendixA.pdf", "anchor_text": "https://cs.dartmouth.edu/~wjarosz/publications/dissertation/appendixA.pdf"}, {"url": "https://www.scratchapixel.com/lessons/mathematics-physics-for-computer- graphics/monte-carlo-methods-in-practice/monte-carlo-integration", "anchor_text": "https://www.scratchapixel.com/lessons/mathematics-physics-for-computer- graphics/monte-carlo-methods-in-practice/monte-carlo-integration"}, {"url": "https://medium.com/tag/monte-carlo-method?source=post_page-----5fe16b40482d---------------monte_carlo_method-----------------", "anchor_text": "Monte Carlo Method"}, {"url": "https://medium.com/tag/python?source=post_page-----5fe16b40482d---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/numerical-integration?source=post_page-----5fe16b40482d---------------numerical_integration-----------------", "anchor_text": "Numerical Integration"}, {"url": "https://medium.com/tag/data-science?source=post_page-----5fe16b40482d---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&user=Victor+Cumer&userId=2c7560f4c546&source=-----5fe16b40482d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&user=Victor+Cumer&userId=2c7560f4c546&source=-----5fe16b40482d---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5fe16b40482d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5fe16b40482d---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5fe16b40482d--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5fe16b40482d--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5fe16b40482d--------------------------------", "anchor_text": ""}, {"url": "https://victor-cumer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://victor-cumer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Victor Cumer"}, {"url": "https://victor-cumer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "29 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2c7560f4c546&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&user=Victor+Cumer&userId=2c7560f4c546&source=post_page-2c7560f4c546--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F2c7560f4c546%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fthe-basics-of-monte-carlo-integration-5fe16b40482d&user=Victor+Cumer&userId=2c7560f4c546&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}