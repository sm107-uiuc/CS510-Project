{"url": "https://towardsdatascience.com/demystifying-apache-arrow-8ba2b4fc5cd4", "time": 1683015546.660346, "path": "towardsdatascience.com/demystifying-apache-arrow-8ba2b4fc5cd4/", "webpage": {"metadata": {"title": "Demystifying Apache Arrow. In my work as a data scientist, I\u2019ve\u2026 | by Robin Linacre | Towards Data Science", "h1": "Demystifying Apache Arrow", "description": "In my work as a data scientist, I\u2019ve come across Apache Arrow in a range of seemingly-unrelated circumstances. However, I\u2019ve always struggled to describe exactly what it is, and what it does. which\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arrow.apache.org/powered_by/", "anchor_text": "wide range", "paragraph_index": 3}, {"url": "https://youtu.be/fyj4FyH3XdU?t=1030", "anchor_text": "more than 10x faster", "paragraph_index": 7}, {"url": "https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html#apache-arrow-in-pyspark", "anchor_text": "it possible to efficiently transfer data between JVM and Python processes.", "paragraph_index": 11}, {"url": "https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html#apache-arrow-in-pyspark", "anchor_text": "huge speedups", "paragraph_index": 11}, {"url": "https://blog.cloudera.com/improving-query-performance-using-partitioning-in-apache-hive/", "anchor_text": "partitioned into subfolders", "paragraph_index": 15}, {"url": "https://www.kdnuggets.com/2017/02/apache-arrow-parquet-columnar-data.html", "anchor_text": "formats", "paragraph_index": 22}, {"url": "https://docs.google.com/document/d/10RoUZmiMQRi_J1FcPeVAUAMJ6d_ZuiEbaM2Y33sNPu4/edit", "anchor_text": "creates an opportunity for the development of:", "paragraph_index": 30}, {"url": "https://arrow.apache.org/docs/r/articles/dataset.html", "anchor_text": "vignette in the Arrow package in R", "paragraph_index": 36}, {"url": "https://github.com/apache/arrow/pull/4225", "anchor_text": "Filesystems API", "paragraph_index": 39}, {"url": "https://docs.google.com/document/d/1bVhzifD38qDypnSjtf8exvpP3sSB5x_Kw9m-n66FB2c/edit?usp=sharing", "anchor_text": "Datasets API", "paragraph_index": 39}, {"url": "https://docs.google.com/document/d/1XHe_j87n2VHGzEbnLe786GHbbcbrzbjgG8D0IXWAeHg/edit#heading=h.g70gstc7jq4h", "anchor_text": "DataFrame API", "paragraph_index": 39}, {"url": "https://docs.google.com/document/d/10RoUZmiMQRi_J1FcPeVAUAMJ6d_ZuiEbaM2Y33sNPu4/edit?usp=sharing", "anchor_text": "C++ Query Engine", "paragraph_index": 39}, {"url": "http://robinlinacre.com", "anchor_text": "robinlinacre.com", "paragraph_index": 41}, {"url": "http://twitter.com/robinlinacre", "anchor_text": "twitter.com/robinlinacre", "paragraph_index": 41}], "all_paragraphs": ["In my work as a data scientist, I\u2019ve come across Apache Arrow in a range of seemingly-unrelated circumstances. However, I\u2019ve always struggled to describe exactly what it is, and what it does.", "The official description of Arrow is:", "a cross-language development platform for in-memory analytics", "which is quite abstract \u2014 and for good reason. The project is extremely ambitious, and aims to provide the backbone for a wide range of data processing tasks. This means it sits at a low level, providing building blocks for higher level, user-facing, analytics tools like pandas or dplyr.", "As a result, the importance of the project can be hard to understand for users who run into it occasionally in their day to day work, because much of what it does is behind the scenes.", "In this post I describe some of the user-facing features of Apache Arrow which I have run into in my work, and explain why they are all facets of more fundamental problems which Apache Arrow aims to solve.", "By connecting these dots it becomes clear why Arrow is not just a useful tool to solve some practical problems today, but one of the most exciting emerging tools, with the potential to be the engine behind large parts of future data science workflows.", "A striking feature of Arrow is that it can read csvs into Pandas more than 10x faster than pandas.read.csv.", "This is actually a two step process: Arrow reads the data into memory in an Arrow table, which is really just a collection of record batches, and then converts the Arrow table into a pandas dataframe.", "The speedup is thus a consequence of the underlying design of Arrow:", "Running Python user defined functions in Apache Spark has historically been very slow \u2014 so slow that the usual recommendation was not to do it on datasets of any significant size.", "More recently, Apache Arrow has made it possible to efficiently transfer data between JVM and Python processes. Combined with vectorised UDFs, this has resulted in huge speedups.", "Prior to the introduction of Arrow, the process of translating data from the Java representation to the Python representation and back was slow \u2014 involving serialisation and deserialisation. It was also one-row-at-a-time, which is slower because many optimised data processing operations work most efficiently on data held in a columnar format, which data in each column held in contiguous sections of memory.", "The use of Arrow almost completely eliminates the serialisation and deserialisation step, and also allows data to be processed in columnar batches, meaning more efficient vectorised algorithms can be used.", "The ability of Arrow to transfer data between languages without a large serialisation/deserialisation overhead is a key feature, making it much more feasible for algorithms implemented in one language being able to be used by data scientists working in other languages.", "Arrow is able to read a folder containing many data files into a single dataframe. Arrow also supports reading folders where data is partitioned into subfolders.", "This functionality is illustrative of the higher-level design of Arrow around record batches. If everything is a record batch, then it matters little whether the source data is stored in a single file or multiple files.", "Arrow can be used to read parquet files into data science tools like Python and R, correctly representing the data types in the target tool. Since parquet is a self-describing format, with the data types of the columns specified in the schema, getting data types right may not seem difficult. But a process of translation is still needed to load data into different data science tools, and this is surprisingly complex.", "For example, historically the pandas integer type has not allowed integers to be null, despite this being possible in parquet files. Similar quirks apply to other languages. Arrow handles this process of translation for us. Data is always loaded into the Arrow format first, but Arrow provides translators that are then able to convert this into language-specific in-memory formats like the pandas dataframe. This means that for each target format, a single format-to-arrow translator is needed, a huge improvement over the current situation of \u2018n take 2\u2019 translators being needed (one for each pair of tools).", "This problem of translation is one that Arrow aims eventually to eliminate altogether: ideally there would be a single in-memory format for dataframes rather than each tool having its own representation.", "Arrow makes it easy to write data held in-memory in tools like pandas and R to disk in Parquet format.", "Why not just persist the data to disk in Arrow format, and thus have a single, cross-language data format that is the same on-disk and in-memory? One of the biggest reasons is that Parquet generally produces smaller data files, which is more desirable if you are IO-bound. This will especially be the case if you are loading data from cloud storage like such as AWS S3.", "Julien LeDem explains this further in a blog post discussing the two formats:", "The trade-offs for columnar data are different for in-memory. For data on disk, usually IO dominates latency, which can be addressed with aggressive compression, at the cost of CPU. In memory, access is much faster and we want to optimise for CPU throughput by paying attention to cache locality, pipelining, and SIMD instructions.", "This makes it desirable to have close cooperation in the development of the in-memory and on-disk formats, with predictable and speedy translation between the two representations \u2014 and this is what is offered by the Arrow and Parquet formats.", "Whilst very useful, the user-facing features discussed so far are not revolutionary. The real power is in the potential of the underlying building blocks to enable new approaches to data science tooling. At the moment (autumn 2020), some of this is still work in progress by the team behind Arrow.", "In Apache Arrow, dataframes are composed of record batches. If stored on disk in Parquet files, these batches can be read into the in-memory Arrow format very quickly.", "We\u2019ve seen this can be used to read a csv file into memory. But more broadly this concept opens the door to entire data science workflows which are parallelised and operate on record batches, thereby eliminating the need for the full table to be stored in memory.", "Currently, the close coupling of data science tools and their in-memory representations of dataframes means that algorithms written in one language are not easily portable to other languages. This means the same standard operations, such as filters and aggregations, get endlessly re-written and optimisations do not easily translate between tools.", "Arrow provides a standard for representing dataframes in memory, and a mechanism for allowing multiple languages and to refer to the same in-memory data.", "This creates an opportunity for the development of:", "an Arrow-native columnar query execution engine in C++, with intended use not only from C++ but also from user-space languages like Python, R, and Ruby.", "This would provide a single, highly optimised codebase, available for use from multiple languages. The pool of developers who have an interest in maintaining and contributing to this library would be much larger because it would be available for use across a wide range of tools.", "These ideas come together in the description of Arrow as an \u2018API for data\u2019. The idea is that Arrow provides a cross-language in-memory data format, and an associated query execution language that provide the building blocks for analytics libraries. Like any good API, Arrow provides a performant solution to common problems without the user needing to fully understand the implementation.", "This paves the way for a step change in data processing capabilities, with analytics libraries:", "whilst breaking down barriers to sharing data between tools via faster ways to transmit data between tools, either on a single machine or over the network.", "We can get a glimpse of the potential of this approach in the vignette in the Arrow package in R, in which a 37gb dataset with 2 billion rows is processed and aggregated on a laptop in under 2 seconds.", "Where does this leave existing high-level data science tools and languages like SQL, pandas and R?", "As the vignette illustrates, the intention is not for Arrow to compete directly with these tools. Instead, higher level tools can use Arrow under the hood, imposing little constraint on their user-facing API. It therefore allows for continued innovation in the expressiveness and features of different tools whilst improving performance and saving authors the task of reinventing the common components.", "Filesystems APIDatasets APIDataFrame APIC++ Query Engine", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data scientist for UK Government. All views my own. robinlinacre.com twitter.com/robinlinacre"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8ba2b4fc5cd4&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://robinlinacre.medium.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": ""}, {"url": "https://robinlinacre.medium.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Robin Linacre"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8a6a0dc508d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&user=Robin+Linacre&userId=8a6a0dc508d6&source=post_page-8a6a0dc508d6----8ba2b4fc5cd4---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arrow.apache.org/powered_by/", "anchor_text": "wide range"}, {"url": "https://youtu.be/fyj4FyH3XdU?t=1030", "anchor_text": "more than 10x faster"}, {"url": "http://arrow.apache.org/docs/python/data.html#tables", "anchor_text": "table"}, {"url": "https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html#apache-arrow-in-pyspark", "anchor_text": "it possible to efficiently transfer data between JVM and Python processes."}, {"url": "https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html#apache-arrow-in-pyspark", "anchor_text": "huge speedups"}, {"url": "https://blog.cloudera.com/improving-query-performance-using-partitioning-in-apache-hive/", "anchor_text": "partitioned into subfolders"}, {"url": "https://www.kdnuggets.com/2017/02/apache-arrow-parquet-columnar-data.html", "anchor_text": "formats"}, {"url": "https://docs.google.com/document/d/10RoUZmiMQRi_J1FcPeVAUAMJ6d_ZuiEbaM2Y33sNPu4/edit", "anchor_text": "creates an opportunity for the development of:"}, {"url": "https://arrow.apache.org/docs/r/articles/dataset.html", "anchor_text": "vignette in the Arrow package in R"}, {"url": "https://arrow.apache.org/overview/", "anchor_text": "https://arrow.apache.org/overview/"}, {"url": "https://arrow.apache.org/use_cases/", "anchor_text": "https://arrow.apache.org/use_cases/"}, {"url": "https://arrow.apache.org/powered_by/", "anchor_text": "https://arrow.apache.org/powered_by/"}, {"url": "https://arrow.apache.org/blog/", "anchor_text": "https://arrow.apache.org/blog/"}, {"url": "https://ursalabs.org/blog/", "anchor_text": "https://ursalabs.org/blog/"}, {"url": "https://wesmckinney.com/archives.html", "anchor_text": "https://wesmckinney.com/archives.html"}, {"url": "https://www.youtube.com/watch?v=fyj4FyH3XdU", "anchor_text": "https://www.youtube.com/watch?v=fyj4FyH3XdU"}, {"url": "https://github.com/apache/arrow/pull/4225", "anchor_text": "Filesystems API"}, {"url": "https://docs.google.com/document/d/1bVhzifD38qDypnSjtf8exvpP3sSB5x_Kw9m-n66FB2c/edit?usp=sharing", "anchor_text": "Datasets API"}, {"url": "https://docs.google.com/document/d/1XHe_j87n2VHGzEbnLe786GHbbcbrzbjgG8D0IXWAeHg/edit#heading=h.g70gstc7jq4h", "anchor_text": "DataFrame API"}, {"url": "https://docs.google.com/document/d/10RoUZmiMQRi_J1FcPeVAUAMJ6d_ZuiEbaM2Y33sNPu4/edit?usp=sharing", "anchor_text": "C++ Query Engine"}, {"url": "https://medium.com/tag/data-science?source=post_page-----8ba2b4fc5cd4---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----8ba2b4fc5cd4---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/data?source=post_page-----8ba2b4fc5cd4---------------data-----------------", "anchor_text": "Data"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&user=Robin+Linacre&userId=8a6a0dc508d6&source=-----8ba2b4fc5cd4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&user=Robin+Linacre&userId=8a6a0dc508d6&source=-----8ba2b4fc5cd4---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8ba2b4fc5cd4&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8ba2b4fc5cd4---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8ba2b4fc5cd4--------------------------------", "anchor_text": ""}, {"url": "https://robinlinacre.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://robinlinacre.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Robin Linacre"}, {"url": "https://robinlinacre.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "122 Followers"}, {"url": "http://robinlinacre.com", "anchor_text": "robinlinacre.com"}, {"url": "http://twitter.com/robinlinacre", "anchor_text": "twitter.com/robinlinacre"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8a6a0dc508d6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&user=Robin+Linacre&userId=8a6a0dc508d6&source=post_page-8a6a0dc508d6--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc45012e5ca38&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdemystifying-apache-arrow-8ba2b4fc5cd4&newsletterV3=8a6a0dc508d6&newsletterV3Id=c45012e5ca38&user=Robin+Linacre&userId=8a6a0dc508d6&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}