{"url": "https://towardsdatascience.com/visualising-lstm-activations-in-keras-b50206da96ff", "time": 1683003306.812149, "path": "towardsdatascience.com/visualising-lstm-activations-in-keras-b50206da96ff/", "webpage": {"metadata": {"title": "Visualising LSTM Activations in Keras | by Praneet Bomma | Towards Data Science", "h1": "Visualising LSTM Activations in Keras", "description": "Have you ever wondered what an LSTM layer learns? Ever wondered if it is possible to see how each cell contributes to the final output. I was curious to try and visualise this. While satisfying my\u2026"}, "outgoing_paragraph_urls": [{"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "The Unreasonable Effectiveness of Recurrent Neural Networks", "paragraph_index": 0}, {"url": "https://keras.io/", "anchor_text": "Keras", "paragraph_index": 1}, {"url": "https://keras.io/layers/recurrent/#lstm", "anchor_text": "LSTM", "paragraph_index": 2}, {"url": "https://keras.io/layers/core/#dropout", "anchor_text": "Dropout", "paragraph_index": 2}, {"url": "https://keras.io/layers/core/#dense", "anchor_text": "Dense", "paragraph_index": 2}, {"url": "https://github.com/Praneet9/Visualising-LSTM-Activations", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb#recent=true", "anchor_text": "Google Colab", "paragraph_index": 8}, {"url": "https://keras.io/backend/", "anchor_text": "Keras Backend", "paragraph_index": 13}, {"url": "https://github.com/Praneet9/Visualising-LSTM-Activations", "anchor_text": "Github profile", "paragraph_index": 23}], "all_paragraphs": ["Have you ever wondered what an LSTM layer learns? Ever wondered if it is possible to see how each cell contributes to the final output. I was curious to try and visualise this. While satisfying my curious neurons I stumbled upon a blog by Andrej Karpathy named The Unreasonable Effectiveness of Recurrent Neural Networks. If you want to get a more in-depth explanation, I would suggest going through his blog.", "In this article, we are not only going to build a Text Generation model in Keras, but also visualise what some of the cells are looking at while generating text. As is the case with CNNs, it learns general features of an image like horizontal and vertical edges, lines, patches, etc. Similarly in Text Generation, LSTMs learn features like spaces, capital letters, punctuation, etc. We are going to see what features each cell in the LSTM layer is learning.", "We will be using the book Alice\u2019s Adventures in Wonderland by Lewis Carroll as training data. The model architecture will rather be a simple one with two blocks of LSTM and Dropout layers and a Dense layer at the end.", "You can download the training data and trained model weights here", "This is how our activations of single cell will look like. I hope you can make out the pattern in the above image. If you can\u2019t, you\u2019ll find it at the end of the article.", "Note: I\u2019ve used CuDNNLSTM in place of LSTM as it trains 15x faster. CuDNNLSTM is backed by CuDNN and can only be run on GPU.", "We will be removing more than one spaces with single space using regex. The char_to_int and int_to_char are just number to character and character to number mappings.", "It is important to prepare our data such that every input is a sequence of characters and output is the following character.", "I could not train my model for 300 epochs in one go as I was using Google Colab to train my model. I had to train it across 3 days with 100 epochs on each day by saving weights and loading them again to train from the same point that I ended it on.", "If you have a powerful GPU with you, you can train the model for 300 epochs in one go. If you don\u2019t, I would suggest using Colab as it is free.", "You can load the model using code below and start training from last point.", "Now to the most important part of the article \u2014 Visualising LSTM activations. We will need some functions to actually make these visualisations understandable. Let\u2019s dive in.", "As we can see in Step 4 above, first and third layers are LSTM layers. Our aim is to visualise outputs of second LSTM layer i.e. third layer in the whole architecture.", "Keras Backend helps us create a function that takes in the input and gives us outputs from an intermediate layer. We can use it to create a pipeline function of our own. Here attn_func will return a hidden state vector of size 512. These will be activations of LSTM layer with 512 units. We can visualise each of these cell activations to understand what they are trying to interpret. To do that we will have to convert it into a range which can denote its importance.", "These helper functions will help us visualise character sequence with each of their activation values. We are passing the activations through sigmoid function as we need values in a scale that can denote their importance to the whole output. get_clr function helps get appropriate colour for a given value.", "The image below shows how each value is denoted with its respective colour.", "get_predictions function randomly chooses an input seed sequence and gets the predicted sequence for that seed sequence. visualize function takes as input the predicted sequence, the sigmoid values for each character in the sequence and the cell number to visualise. Based on the value of the output, character is printed with an appropriate background colour.", "After applying sigmoid on the layer output, the values lie in the range 0 to 1. Closer the number is to 1, higher importance it has. If the number is closer to 0, it is meant to not contribute in any major way to the final prediction. The importance of these cells is denoted by the colour, where Blue denotes lower importance and Red denotes higher importance.", "More than 90% of the cells do not show any understandable patterns. I visualised all 512 cells manually and noticed three of them (189, 435, 463) to show some understandable patterns.", "Cell Number 189 is activated for text inside quotes as you can notice below. This signifies what the cell is looking for while predicting. As shown below, this cell contributes highly to text between quotes.", "Cell Number 435 is activated for a couple of words after a sentence in quotes.", "Cell Number 463 is activated for first character in every word.", "The results can be furthered improved with more training or more data. This just proves the point that Deep Learning is not a complete black box after all.", "You can checkout the whole code on my Github profile.", "This was my first attempt at writing a blog. I hope you learned something from this.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb50206da96ff&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://praneet9.medium.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": ""}, {"url": "https://praneet9.medium.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Praneet Bomma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb4b75c391bcc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&user=Praneet+Bomma&userId=b4b75c391bcc&source=post_page-b4b75c391bcc----b50206da96ff---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@franki?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Franki Chamaki"}, {"url": "https://unsplash.com/s/photos/artificial-intelligence?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "The Unreasonable Effectiveness of Recurrent Neural Networks"}, {"url": "https://keras.io/", "anchor_text": "Keras"}, {"url": "https://keras.io/layers/recurrent/#lstm", "anchor_text": "LSTM"}, {"url": "https://keras.io/layers/core/#dropout", "anchor_text": "Dropout"}, {"url": "https://keras.io/layers/core/#dense", "anchor_text": "Dense"}, {"url": "https://github.com/Praneet9/Visualising-LSTM-Activations", "anchor_text": "here"}, {"url": "https://colab.research.google.com/notebooks/intro.ipynb#recent=true", "anchor_text": "Google Colab"}, {"url": "https://keras.io/backend/", "anchor_text": "Keras Backend"}, {"url": "https://github.com/Praneet9/Visualising-LSTM-Activations", "anchor_text": "Github profile"}, {"url": "https://medium.com/tag/visualization?source=post_page-----b50206da96ff---------------visualization-----------------", "anchor_text": "Visualization"}, {"url": "https://medium.com/tag/lstm?source=post_page-----b50206da96ff---------------lstm-----------------", "anchor_text": "Lstm"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----b50206da96ff---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/keras?source=post_page-----b50206da96ff---------------keras-----------------", "anchor_text": "Keras"}, {"url": "https://medium.com/tag/data-science?source=post_page-----b50206da96ff---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&user=Praneet+Bomma&userId=b4b75c391bcc&source=-----b50206da96ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&user=Praneet+Bomma&userId=b4b75c391bcc&source=-----b50206da96ff---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb50206da96ff&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b50206da96ff---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b50206da96ff--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b50206da96ff--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b50206da96ff--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b50206da96ff--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b50206da96ff--------------------------------", "anchor_text": ""}, {"url": "https://praneet9.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://praneet9.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Praneet Bomma"}, {"url": "https://praneet9.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "67 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb4b75c391bcc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&user=Praneet+Bomma&userId=b4b75c391bcc&source=post_page-b4b75c391bcc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff30c4d1fb25a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fvisualising-lstm-activations-in-keras-b50206da96ff&newsletterV3=b4b75c391bcc&newsletterV3Id=f30c4d1fb25a&user=Praneet+Bomma&userId=b4b75c391bcc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}