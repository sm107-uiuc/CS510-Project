{"url": "https://towardsdatascience.com/how-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22", "time": 1683008386.5466821, "path": "towardsdatascience.com/how-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22/", "webpage": {"metadata": {"title": "How to secure Python Flask Web APIs with Azure AD | by Ren\u00e9 Bremer | Towards Data Science", "h1": "How to secure Python Flask Web APIs with Azure AD", "description": "Python Flask is a popular tool to create web applications. Using Azure AD, users can authenticate to the REST APIs and retrieve data from Azure SQL. In this blog, a sample Python web application is\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/rebremer/ms-identity-python-webapp-backend", "anchor_text": "here", "paragraph_index": 1}, {"url": "https://towardsdatascience.com/how-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5", "anchor_text": "my follow-up blog", "paragraph_index": 3}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios", "anchor_text": "Authentication Scenarios for Azure AD", "paragraph_index": 4}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims", "anchor_text": "this", "paragraph_index": 11}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps", "anchor_text": "this", "paragraph_index": 14}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps#assign-users-and-groups-to-roles", "anchor_text": "link", "paragraph_index": 15}, {"url": "https://docs.microsoft.com/en-us/azure/azure-sql/database/single-database-create-quickstart?tabs=azure-portal#create-a-single-database", "anchor_text": "link", "paragraph_index": 19}], "all_paragraphs": ["Python Flask is a popular tool to create web applications. Using Azure AD, users can authenticate to the REST APIs and retrieve data from Azure SQL. In this blog, a sample Python web application is created as follows:", "The code of the project can be found here, architecture can be found below.", "In the remaining of this blog, the following steps are executed:", "To learn how to access an Azure Function backend using delegated or application permissions, see my follow-up blog which shares the same git repo as this blog.", "This sample shows how to build a Python web app using Flask and MSAL Python, that signs in a user, and get access to Azure SQL Database. For more information about how the protocols work in this scenario and other scenarios, see Authentication Scenarios for Azure AD. In this step, the following sub steps are executed:", "Step 1 focusses on the follow part of the architecture.", "To run this sample, you\u2019ll need:", "Create and configure an app registration as follows:", "You will need to install dependencies using pip as follows:", "Run app.py from shell or command line using the following command:", "When the app is run locally, it can be visited by localhost:5000 (not 127.0.0.1:5000). After step 1, users can login using their Azure AD credentials. In the next step, the user roles are set that can be used to verify if user is allowed to retrieve data using the API.", "In this step, the claims in the tokens can be set which can be just be the web app to verify whether a user is allowed to call an api. See this link for more information on token claims. The following sub steps are executed:", "Step 2 focusses on the follow part of the architecture.", "Claim verification is an optional step and can be enabled using the following setting in app_config.py file: AAD_ROLE_CHECK = True .", "Follow the steps in this tutorial to add roles to app registration created in step 1.2. As manifest, the following appRoles shall be used:", "The assignment of users is explained in th link. As a test, two users can be created. User 1 is assigned the basic_user_access, whereas user 2 gets the premium_user_access role.", "In the next step, the Azure SQL database is created and the application identity is used to retrieve data form the database.", "In this step, the managed identity of the app is used to retrieve data, which is linked to the app registration created in step 1. The following sub steps are executed:", "Step 3a focusses on the follow part of the architecture.", "Create an Azure SQL DB using this link in which the cheapest SKU (basic) can be selected. Make sure the following is done:", "The backend_settings needs to be set to database. Make also sure that connection is filled in with your settings. Since the MI of the app is used, application_permissions need to point to \u201chttps://database.windows.net//.default\" in the app_config.py file, see also below.", "Now the app can be run as described in step 1.4. When you click on the link (Premium users only) Get Customer data from Database , customer data is retrieved. Subsequently, when there is clicked on the link Get Product data from Database, product data is retrieved (provided that claims are set correctly for user in step 2 or check is disabled)", "In this step, the identity of the app is used to retrieve data. However, the identity of the user can also passed (AAD passthrough) to retrieve data from the database.", "In the step, the identity of the user itself is used to retrieve data. This means that the token created in step 1 to login in the web app is also used to authenticate to the database. The following sub steps are executed:", "Step 3b focusses on the follow part of the architecture.", "Since AAD passthrough is used in this step, the users themselves shall have the appropriate roles in the SQLDB as external user and datareader. See example how to do this below.", "In case you want to be more granular in rolemembers in the database, read_customer reads data from SalesLT.Customer, whereas read_product reads data from SalesLT.Product)", "AAD User passthrough authentication can be set in the app_config.py file by setting delegated_permissions to [\u201chttps://sql.azuresynapse-dogfood.net/user_impersonation\"], see also below", "Now the app can be run as described in step 1.4, in which data can be retrieved from the database using the identity of the logged in user.", "In this blog, a Python web application is created that retrieves data from SQLDB. Users claims, managed identities and signed-in user passthrough tokens are discussed to authenticate and authorize users to retrieve data from Azure SQL, see also overview below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Solution Architect @ Microsoft, working with Azure services as ADFv2, ADLSgen2, Azure DevOps, Databricks, Function Apps and SQL. Opinions here are mine."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F14b46b8abf22&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://rebremer.medium.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771----14b46b8abf22---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/rebremer/ms-identity-python-webapp-backend", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/how-to-use-the-microsoft-identity-platform-in-your-azure-web-app-fcb3839a44e5", "anchor_text": "my follow-up blog"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios", "anchor_text": "Authentication Scenarios for Azure AD"}, {"url": "https://www.python.org/downloads/release/python-2713/", "anchor_text": "Python 2.7+"}, {"url": "https://www.python.org/downloads/release/python-364/", "anchor_text": "Python 3+"}, {"url": "https://docs.microsoft.com/azure/active-directory/develop/quickstart-create-new-tenant", "anchor_text": "how to get an Azure AD tenant."}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app", "anchor_text": "link"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-optional-claims", "anchor_text": "this"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps", "anchor_text": "this"}, {"url": "https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-app-roles-in-azure-ad-apps#assign-users-and-groups-to-roles", "anchor_text": "link"}, {"url": "https://docs.microsoft.com/en-us/azure/azure-sql/database/single-database-create-quickstart?tabs=azure-portal#create-a-single-database", "anchor_text": "link"}, {"url": "https://docs.microsoft.com/en-us/azure/azure-sql/database/active-directory-interactive-connect-azure-sql-db#register-your-app-and-set-permissions", "anchor_text": "link"}, {"url": "https://medium.com/tag/azure?source=post_page-----14b46b8abf22---------------azure-----------------", "anchor_text": "Azure"}, {"url": "https://medium.com/tag/python?source=post_page-----14b46b8abf22---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----14b46b8abf22---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/programming?source=post_page-----14b46b8abf22---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----14b46b8abf22---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----14b46b8abf22---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=-----14b46b8abf22---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F14b46b8abf22&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----14b46b8abf22---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----14b46b8abf22--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----14b46b8abf22--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----14b46b8abf22--------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://rebremer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ren\u00e9 Bremer"}, {"url": "https://rebremer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "731 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F11e5e7fb3771&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=post_page-11e5e7fb3771--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fed36bca8eb16&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-secure-python-flask-web-apis-with-azure-ad-14b46b8abf22&newsletterV3=11e5e7fb3771&newsletterV3Id=ed36bca8eb16&user=Ren%C3%A9+Bremer&userId=11e5e7fb3771&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}