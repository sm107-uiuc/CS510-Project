{"url": "https://towardsdatascience.com/treatment-assignment-strategy-in-a-b-test-931133bb048f", "time": 1683007115.437382, "path": "towardsdatascience.com/treatment-assignment-strategy-in-a-b-test-931133bb048f/", "webpage": {"metadata": {"title": "Treatment Assignment Strategy in A/B Test | by Chong Han Khai | Towards Data Science", "h1": "Treatment Assignment Strategy in A/B Test", "description": "In my previous post, I gave a step by step process of planning an A/B Test but did not cover the implementation part. This week, I focus on one of the components of an A/B Test implementation\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/step-by-step-for-planning-an-a-b-test-ef3c93143c0b", "anchor_text": "post", "paragraph_index": 0}], "all_paragraphs": ["In my previous post, I gave a step by step process of planning an A/B Test but did not cover the implementation part. This week, I focus on one of the components of an A/B Test implementation, treatment assignment.", "One of the requirements of a valid randomized controlled experiment is random treatment assignment. Despite its importance, this is unfortunately also the part that most people seem to not care too much about. Perhaps because the concept of random seems so easy, I just randomly assign my experiment subjects to the control and treatment groups and that\u2019s it, right? In a business environment, the reality is actually far from this because there are some requirements that make randomness hard to achieve.", "In this blog post, I will attempt to highlight some of these requirements, common strategies people use to fulfill them, problems that arise with these strategies and lastly a simple and elegant solution that fulfills all the requirements.", "Treatment given to an experiment subject has to be the consistent every time.", "I will give a few examples here:", "If we randomly assign treatment every time when an experiment subject is exposed, then we will not be able to guarantee this. (e.g. user A might log in and see different treatments every time.)", "For ease of explanation and the fact that most experiments are done using users as subjects, I am going to treat users like experiment subjects henceforth.", "It is rather easy to fulfill the first requirement, we just log down which user is given which treatment when they are first exposed to the experiment. In subsequent login or subsequent exposure, we just look up for this user\u2019s past treatment and assign the same treatment.", "This may be feasible for a small company, but as you scale, you will find that this method is not very scalable at all. We can imagine that it is almost impossible to achieve this when we have tens of millions of users and hundreds of experiments.", "In order to solve both of the issues above, one of the common strategies that companies use is to utilize the last character or digit of the user\u00a0ID. In this case, treatment will be consistent and fully scalable because the treatment only depends on a fixed user ID.", "This, however, poses another problem. The experiment, by itself, is indeed truly random. But as we do more and more experiments, we will find that the treatment assignments across different experiments are now correlated with each other.", "Imagine if we have 10,000 users and we did two experiments. In the first experiment (Exp 1), we tested if a reduction in subscription fee increases the conversion rate of paid members and found a significant result. In the second experiment (Exp 2), we tested if an additional feature increases the number of purchases our users make and found that the effect is not statistically significant.", "Here is why this might be the case:", "To be truly random, there should not be correlation between treatment assignment in different experiments.", "To examine this, I performed the following simulation.", "2. Create 20 experiments. For each of the experiments, randomly select 8 out of the 16 possible values (0 - 9, a - f) as control. If the last character of a user ID is in the control, assign them the control group, otherwise, assign them to treatment group.", "3. For each pair of experiments, generate a contingency table like the one shown in the example above and perform a chi-square test.", "Intuitively, if the treatment assignments are truly independent, we should expect to see the following (assuming 50% of the samples are assigned to control and 50% to treatment).", "A chi-square test tells us how far the actual count is, from the independent case. The further away it is, the higher the chi-square test statistic and hence there is stronger evidence that there is some association between treatment assignments of the two experiments.", "I ran the above simulation 100 times and see how many pairs of experiments failed the chi-square test within each simulation and got a mean of 62% (118 out of 190 pairs)! In other words, if we use this approach, on average, we will observe 62% of the experiment pairs failing the chi-square test. I also tried with 5 or 10 experiments (instead of the original 20) and got similar results (~60%).", "The solution to fulfilling all the requirements above is actually very simple. All we have to do is to use a hash function. A hash function is any function that can be used to map data of arbitrary size to fixed-size values. This property ensures that the first two requirements (consistency and scalability) is fulfilled.", "In order to fulfill the final requirement, instead of hashing only the user ID, we just have to hash the concatenation of user ID and experiment ID.", "Below is an example of how to do this using python.", "The above function will return either treatment or control depending on your control bucket and experiment ID. We can also expand this to more-than-two-variant experiments.", "I ran the above simulation again using this approach and below is the result.", "We can see that 73 out of the 100 simulations result in 2 or fewer pairs of experiments (out of 190 pairs) failing the chi-square test, proving that it is a robust way of assigning treatments without violating any of the requirements.", "In this blog post, I gave a detailed overview of the requirements of treatment assignment in experiments. I listed down some common practices I have seen and stated why they violate some of the requirements. Violating any of the requirements will mean the experiment results are no longer valid, which is why we should start putting more attention to treatment assignment.", "Lastly, I gave a simple solution that fulfills all the requirements that are generalizable to more-than-two-variant experiments.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A data person who cares a lot about best practices and being scientifically correct."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F931133bb048f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----931133bb048f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@chonghankhai?source=post_page-----931133bb048f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chonghankhai?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Chong Han Khai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Feb876f621a36&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&user=Chong+Han+Khai&userId=eb876f621a36&source=post_page-eb876f621a36----931133bb048f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/step-by-step-for-planning-an-a-b-test-ef3c93143c0b", "anchor_text": "post"}, {"url": "https://blog.offerup.com/a-good-hash-is-hard-to-find-60e8a201e8ce", "anchor_text": "https://blog.offerup.com/a-good-hash-is-hard-to-find-60e8a201e8ce"}, {"url": "https://medium.com/tag/a-b-testing?source=post_page-----931133bb048f---------------a_b_testing-----------------", "anchor_text": "A B Testing"}, {"url": "https://medium.com/tag/statistics?source=post_page-----931133bb048f---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/data-science?source=post_page-----931133bb048f---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/experiment?source=post_page-----931133bb048f---------------experiment-----------------", "anchor_text": "Experiment"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&user=Chong+Han+Khai&userId=eb876f621a36&source=-----931133bb048f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&user=Chong+Han+Khai&userId=eb876f621a36&source=-----931133bb048f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----931133bb048f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F931133bb048f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----931133bb048f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----931133bb048f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----931133bb048f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----931133bb048f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----931133bb048f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----931133bb048f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chonghankhai?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@chonghankhai?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Chong Han Khai"}, {"url": "https://medium.com/@chonghankhai/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "58 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Feb876f621a36&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&user=Chong+Han+Khai&userId=eb876f621a36&source=post_page-eb876f621a36--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F79f8b547f842&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ftreatment-assignment-strategy-in-a-b-test-931133bb048f&newsletterV3=eb876f621a36&newsletterV3Id=79f8b547f842&user=Chong+Han+Khai&userId=eb876f621a36&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}