{"url": "https://towardsdatascience.com/instance-segmentation-web-app-63016b8ed4ae", "time": 1683011186.560742, "path": "towardsdatascience.com/instance-segmentation-web-app-63016b8ed4ae/", "webpage": {"metadata": {"title": "Instance Segmentation Web App. Building a Web App for Instance\u2026 | by Neel Iyer | Towards Data Science", "h1": "Instance Segmentation Web App", "description": "Detectron2 offers state of the art instance segmentation models. It\u2019s very quick to train and offers very good results. Model training is fairly straightforward. There are many tutorials to help you\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/facebookresearch/detectron2", "anchor_text": "Detectron2", "paragraph_index": 0}, {"url": "https://detectron2.readthedocs.io/notes/benchmarks.html", "anchor_text": "quick to train", "paragraph_index": 0}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/GETTING_STARTED.md", "anchor_text": "tutorials", "paragraph_index": 1}, {"url": "https://flask.palletsprojects.com/en/1.1.x/", "anchor_text": "flask", "paragraph_index": 3}, {"url": "https://github.com/realpython/flask-boilerplate/blob/master/app.py", "anchor_text": "boilerplate code", "paragraph_index": 3}, {"url": "https://cocodataset.org/", "anchor_text": "COCO", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/an-overview-of-resnet-and-its-variants-5281e2f56035", "anchor_text": "ResNet", "paragraph_index": 15}, {"url": "https://towardsdatascience.com/review-fpn-feature-pyramid-network-object-detection-262fc7482610", "anchor_text": "FPN", "paragraph_index": 15}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md#common-settings-for-coco-models", "anchor_text": "best speed/accuracy tradeoff", "paragraph_index": 15}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/docker/Dockerfile", "anchor_text": "dockerfile", "paragraph_index": 22}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/docker/Dockerfile", "anchor_text": "github repo", "paragraph_index": 23}, {"url": "https://github.com/spiyer99/detectron2_web_app/blob/master/requirements.txt", "anchor_text": "requirements.txt", "paragraph_index": 24}, {"url": "https://jimhoskins.com/2013/07/27/remove-untagged-docker-images.html", "anchor_text": "lot of space", "paragraph_index": 27}, {"url": "https://jimhoskins.com/2013/07/27/remove-untagged-docker-images.html", "anchor_text": "Jim Hoskins", "paragraph_index": 28}, {"url": "https://github.com/spiyer99/detectron2_web_app", "anchor_text": "github", "paragraph_index": 31}], "all_paragraphs": ["Detectron2 offers state of the art instance segmentation models. It\u2019s very quick to train and offers very good results.", "Model training is fairly straightforward. There are many tutorials to help you there. Deploying the model to a web app is a different story. When I was trying to do this I didn\u2019t find a lot of help on the internet.", "So, in this post we\u2019ll create a web app for detectron2\u2019s instance segmentation.", "First, we\u2019ll create the machine learning backend. This will use basic flask. We\u2019ll start from some fairly standard boilerplate code", "This app will simply render the template index.html. I've specified the port manually.", "Next we\u2019ll add functions to get the image. We want to be able to upload an image to the website. We also want to be able to supply the website with a url and the image will be downloaded automatically. I\u2019ve created the code do to exactly that below.", "This piece of code allows us to upload an image into the backend (POST request). Or we can supply the backend with a url and it will download the image automatically (GET request). The code also converts the image to a jpg. I couldn't do inference on a png image using detectron2. So we'll have to convert to a jpg.", "If the code can\u2019t download the image for whatever reason \u2014 It will return the failure.html template. This will basically just be a simple html page saying there was an error in retrieving the image.", "Also, I\u2019ve specified a different @app.route. This will need to reflected in the index.html file.", "Now I\u2019ll create the frontend html code. This inferface alows the user to upload an image or specify a url to an image.", "There\u2019s not much to it. We create a simple form and tell it to link to the @app.route(\u2018/detect\u2019) flask code. We also need to specify the method. If the user is uploading an image, it\u2019s POST. If the user is giving us the url to an image, it\u2019s GET.", "The failure.html template is even simpler.", "Now we can move on to the actual deep learning part.", "In this part, we\u2019ll get a detectron2 pretrained model to do inference on an image. Then we\u2019ll link it to our existing backend.", "This part is slightly more involved. We\u2019ll create a new class called Detector. In that we'll create the cfg that is required for detectron2. Then we'll create another function that will do the inference on an image.", "I\u2019ll be using the mask rcnn pretrained model trained on the COCO dataset. It will use a ResNet+ FPN backbone. This model is said to obtain the best speed/accuracy tradeoff.", "This piece of code pretty much does everything we need it to do for inference. We just need to specify the path to the pretrained model that we downloaded.", "It gets the config that corresponds our pretrained model automatically from the model zoo. It should also get the pretrained model from the model zoo as well. But I found that this doesn\u2019t really work in docker \u2014 at least for me.", "The next step is to integrate this Detector class into our existing script.", "In this piece of code I\u2019ve added in the Detector class we created previously. I've also created a function called run_inference. This is where the backend will run the detectron2 model on an image. It will take in an image path and call the detectron2 model through the Detector class we created earlier.", "The run_inference function will return an image once instance segmentation is completed. I had to do some hacky stuff with the result fo the run_inference function to get it to work. result_img is pasted into a file object and that file object is returned as a png. There might be a better way to do this though.", "The final step is creating a docker container for our code. Then we\u2019ll deploy the docker container locally.", "Thankfully, detectron2 has already created a dockerfile for us.", "I\u2019ve bascially used the dockerfile supplied in detectron2\u2019s github repo. But I made a few changes.", "I\u2019ve added a requirements.txt file. I do a pip install from that requirements file. That installs a few libraries that we need for this to work. I've also changed the command to start the app.py script we created earlier. That will start the flask application and render the index.html template.", "Now we can start the docker container. We can do this using the following:", "That will build the current dockerfile in the current working directory. Then it will run that image on port 8080. That\u2019s the port that I specified earlier.", "But the issue with that if you keep running those commands over time you\u2019ll have too many docker images and containers on your computer. This can take up a lot of space on your computer.", "Jim Hoskins has a pretty elegant solution to this, which I adapted for my purposes.", "I created a nice shell script which:", "Run this script from terminal. It will build and run the detectron2 web app. The web app should show up at localhost:8080 on your browser.", "The code for this can be found on github.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F63016b8ed4ae&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://neel-iyer.medium.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1----63016b8ed4ae---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/facebookresearch/detectron2", "anchor_text": "Detectron2"}, {"url": "https://detectron2.readthedocs.io/notes/benchmarks.html", "anchor_text": "quick to train"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/GETTING_STARTED.md", "anchor_text": "tutorials"}, {"url": "https://flask.palletsprojects.com/en/1.1.x/", "anchor_text": "flask"}, {"url": "https://github.com/realpython/flask-boilerplate/blob/master/app.py", "anchor_text": "boilerplate code"}, {"url": "https://cocodataset.org/", "anchor_text": "COCO"}, {"url": "https://towardsdatascience.com/an-overview-of-resnet-and-its-variants-5281e2f56035", "anchor_text": "ResNet"}, {"url": "https://towardsdatascience.com/review-fpn-feature-pyramid-network-object-detection-262fc7482610", "anchor_text": "FPN"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/MODEL_ZOO.md#common-settings-for-coco-models", "anchor_text": "best speed/accuracy tradeoff"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/docker/Dockerfile", "anchor_text": "dockerfile"}, {"url": "https://github.com/facebookresearch/detectron2/blob/master/docker/Dockerfile", "anchor_text": "github repo"}, {"url": "https://github.com/spiyer99/detectron2_web_app/blob/master/requirements.txt", "anchor_text": "requirements.txt"}, {"url": "https://jimhoskins.com/2013/07/27/remove-untagged-docker-images.html", "anchor_text": "lot of space"}, {"url": "https://jimhoskins.com/2013/07/27/remove-untagged-docker-images.html", "anchor_text": "Jim Hoskins"}, {"url": "https://unsplash.com/@nabeelsyed", "anchor_text": "Nabeel Syed"}, {"url": "https://unsplash.com/photos/Jk3-Uhdwjcs", "anchor_text": "Unsplash"}, {"url": "https://github.com/spiyer99/detectron2_web_app", "anchor_text": "github"}, {"url": "https://spiyer99.github.io/Detectron2-Web-App/", "anchor_text": "https://spiyer99.github.io"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----63016b8ed4ae---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/docker?source=post_page-----63016b8ed4ae---------------docker-----------------", "anchor_text": "Docker"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----63016b8ed4ae---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/detectron2?source=post_page-----63016b8ed4ae---------------detectron2-----------------", "anchor_text": "Detectron2"}, {"url": "https://medium.com/tag/instance-segmentation?source=post_page-----63016b8ed4ae---------------instance_segmentation-----------------", "anchor_text": "Instance Segmentation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----63016b8ed4ae---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&user=Neel+Iyer&userId=e7c5e1c9cae1&source=-----63016b8ed4ae---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F63016b8ed4ae&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----63016b8ed4ae---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----63016b8ed4ae--------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://neel-iyer.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Neel Iyer"}, {"url": "https://neel-iyer.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "418 Followers"}, {"url": "https://www.linkedin.com/in/neel-iyer/", "anchor_text": "https://www.linkedin.com/in/neel-iyer/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe7c5e1c9cae1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&user=Neel+Iyer&userId=e7c5e1c9cae1&source=post_page-e7c5e1c9cae1--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fa4687e9ccf6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Finstance-segmentation-web-app-63016b8ed4ae&newsletterV3=e7c5e1c9cae1&newsletterV3Id=a4687e9ccf6&user=Neel+Iyer&userId=e7c5e1c9cae1&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}