{"url": "https://towardsdatascience.com/real-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe", "time": 1683014718.6353521, "path": "towardsdatascience.com/real-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe/", "webpage": {"metadata": {"title": "Real Time Machine Learning at Scale using SpaCy, Kafka & Seldon Core | by Alejandro Saucedo | Towards Data Science", "h1": "Real Time Machine Learning at Scale using SpaCy, Kafka & Seldon Core", "description": "In this post, we will cover how to train and deploy a machine learning model leveraging a scalable stream processing architecture for an automated text prediction use-case. We will be using Sklearn\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/scikit-learn/scikit-learn", "anchor_text": "Sklearn", "paragraph_index": 0}, {"url": "https://spacy.io/", "anchor_text": "SpaCy", "paragraph_index": 0}, {"url": "https://www.kaggle.com/areeves87/rscience-popular-comment-removal/kernels", "anchor_text": "Reddit /r/science Content Moderation Dataset", "paragraph_index": 2}, {"url": "https://ethical.institute/principles.html", "anchor_text": "principles and best practices", "paragraph_index": 4}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/blob/master/Exploratory%20Data%20Analysis.ipynb", "anchor_text": "exploratory data analysis", "paragraph_index": 5}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/blob/master/Data%20Preprocessing.ipynb", "anchor_text": "model training", "paragraph_index": 5}, {"url": "https://scikit-learn.org/stable/", "anchor_text": "Sklearn", "paragraph_index": 7}, {"url": "https://spacy.io/", "anchor_text": "SpaCy", "paragraph_index": 7}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/overview.html", "anchor_text": "prepackaged-model servers", "paragraph_index": 11}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/custom.html", "anchor_text": "custom model server", "paragraph_index": 11}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/sklearn.html", "anchor_text": "sklearn pre-packaged server", "paragraph_index": 11}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/python/python_wrapping_s2i.html", "anchor_text": "Python Language wrapper", "paragraph_index": 12}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/examples/sklearn_spacy_text_classifier_example.html", "anchor_text": "Jupyter notebook", "paragraph_index": 14}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "jupyter notebook", "paragraph_index": 18}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "the full instructions", "paragraph_index": 19}], "all_paragraphs": ["In this post, we will cover how to train and deploy a machine learning model leveraging a scalable stream processing architecture for an automated text prediction use-case. We will be using Sklearn and SpaCy to train an ML model from the Reddit Content Moderation dataset, and we will deploy that model using Seldon Core for real time processing of text data from Kafka real-time streams. You can also find an overview of the content in this post in video form, presented at the NLP Summit 2020.", "You can find the full code for this article in the following links:", "For this use-case we will be using the Reddit /r/science Content Moderation Dataset. This dataset consists of over 200,000 reddit comments \u2014 primarily labelled based on whether the comments have been removed by moderators. We\u2019ll be tasked to train an ML model that is able to predict the comments that would have been removed by reddit moderators.", "SpaCy is one of the most popular and actively used NLP libraries for production text processing use-cases \u2014 it provides \u201cindustrial-strength\u201d capabilities including tokenization, NER, deep learning integration, and more across a broad range of language models. Similarly, Sklearn is the most popular machine learning toolkit in Python. We\u2019ll be using both of these frameworks for the exploratory data (and model) analysis, as well as for the training of our machine learning model.", "When it comes to building a machine learning model \u2014 especially when it is to be deployed to a production system \u2014 it is important that principles and best practices are used to ensure its responsible design, development and operation.", "You will be able to find best practices and techniques of exploratory data analysis in the model training notebooks. These covers feature engineering, data distributions, data imbalances, data cleaning, algorithm performance comparison, tokenization approaches, partial dependency plots, etc.", "These techniques enable data scientists and engineers to identify domain specific best practices for the training, deployment and even produciton monitoring of the machine learning models.", "In this tutorial, we will be building the machine learning pipeline using Sklearn and SpaCy. As outlined in the image above, we use the following components in the pipeline:", "For a more intuitive flow of how our model will process the data, the image above shows how a text data input instance would be transformed during each of the stages. More specifically, if we receive a phrase, it will be sent through each of the pipeline components until we\u2019re able to receive a prediction.", "Once we train our model, we will be able to use the same code that was used for the pipeline, and we will export the artifacts of the models trained using pickle so we can load them when deploying the model.", "Seldon Core can be used to convert our model into a scalable microservice and deploy it to Kubernetes using the Seldon cloud native kubernetes operator. Models deployed with Seldon Core support REST and GRPC interfaces, but since version 1.3 it also supports native kafka interface, which we\u2019ll be using in this article.", "Seldon provides several ways to productionise machine learning models. The most common approach is using one of the existing prepackaged-model servers. In this case, however, we will be building our own custom model server by extending the default sklearn pre-packaged server to add SpaCy and its respective English language model.", "To containerise our model with Seldon, we will be following the standard Seldon Core workflow using the Python Language wrapper. As shown in the image below, the standard steps required to containerise a model are:", "In our case we will just have to define a Python wrapper that will consist of:", "The code for the wrapper can be found in the image below, or alternatively you can find the full Jupyter notebook to train, containerise and test the Seldon wrapped model.", "Once we have the wrapper, we are able to simply run the Seldon utilities using the s2i CLI, namely:", "Now we have fully containerised our model as the image nlp-model:0.1 and we will be able to deploy it for stream processing in the next section.", "Seldon models support REST, GRPC and Kafka protocols \u2014 in this example we will be using the latter to support stream processing.", "You are able to find the full jupyter notebook for the example including the deployment files as well as the request workflows.", "For simplicity we will skip the steps required to set up the kubernetes cluster \u2014 including setting up the Kafka brokers and installing Seldon Core \u2014 but you can find the full instructions in the notebook example.", "Now we\u2019re able to deploy our model. For this we will just need to define our deployment configuration file following the SeldonDeployment schema:", "As you can see in the configuration YAML, the structure contains the following key points:", "We can now create the model using the kubectl command:", "Once our model is created we can now send data into the input topic. We can do so by using the kafka-console-producer.sh utility.", "Similarly, we can also listen for the output data that the model produces.", "Now when we send the input data to the input topic:", "We would consequently see the prediction in the output topic stream:", "With this we now have a model deployed in a scalable architecture for real time machine learning processing \u2014 more specifically, this architecture allows for horizontal and vertical scalability of each of the respective components. The deployed models can scale to a variable number of replicas, together with autoscaling based on Kubernetes HPA that would horizontally scale based on resource usage. Similarly, Kafka can also scale horizontally through the number of brokers, which enables for large throughputs with low latency. This can be seen more intuitively in the diagram below.", "Now that you have the intuition and understanding of the core architectural components, you are now able to delve into the practical details. For this you will be able to access the code and resources in the following links:", "If you are interested in further hands on examples of scalable deployment strategies of machine learning models, you can check out:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Chief Scientist @ The Institute for Ethical AI & Machine learning | Engineering Director @ Seldon | Member at Large @ ACM | Building the future of production ML"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6360f2fedbe&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@AxSaucedo?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AxSaucedo?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Alejandro Saucedo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F32de426f7278&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&user=Alejandro+Saucedo&userId=32de426f7278&source=post_page-32de426f7278----6360f2fedbe---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/scikit-learn/scikit-learn", "anchor_text": "Sklearn"}, {"url": "https://spacy.io/", "anchor_text": "SpaCy"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/examples/sklearn_spacy_text_classifier_example.html", "anchor_text": "Seldon Model Containerisation Notebook"}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/", "anchor_text": "Reddit Dataset Exploratory Data Analysis Notebook"}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "Kafka Seldon Core Stream Processing Deployment Notebook"}, {"url": "https://www.kaggle.com/areeves87/rscience-popular-comment-removal/kernels", "anchor_text": "Reddit /r/science Content Moderation Dataset"}, {"url": "https://ethical.institute/principles.html", "anchor_text": "principles and best practices"}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/blob/master/Exploratory%20Data%20Analysis.ipynb", "anchor_text": "exploratory data analysis"}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/blob/master/Data%20Preprocessing.ipynb", "anchor_text": "model training"}, {"url": "https://scikit-learn.org/stable/", "anchor_text": "Sklearn"}, {"url": "https://spacy.io/", "anchor_text": "SpaCy"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/overview.html", "anchor_text": "prepackaged-model servers"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/custom.html", "anchor_text": "custom model server"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/servers/sklearn.html", "anchor_text": "sklearn pre-packaged server"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/python/python_wrapping_s2i.html", "anchor_text": "Python Language wrapper"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/examples/sklearn_spacy_text_classifier_example.html", "anchor_text": "Jupyter notebook"}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "jupyter notebook"}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "the full instructions"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/examples/sklearn_spacy_text_classifier_example.html", "anchor_text": "Seldon Model Containerisation Notebook"}, {"url": "https://github.com/axsaucedo/reddit-classification-exploration/", "anchor_text": "Reddit Dataset Exploratory Data Analysis Notebook"}, {"url": "https://github.com/SeldonIO/seldon-core/blob/master/examples/kafka/sklearn_spacy/README.ipynb", "anchor_text": "Kafka Seldon Core Stream Processing Deployment Notebook"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/examples/argo_workflows_batch.html", "anchor_text": "Batch Processing with Argo Workflows"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/streaming/knative_eventing.html", "anchor_text": "Serverless eventing with Knative"}, {"url": "https://docs.seldon.io/projects/seldon-core/en/latest/analytics/explainers.html", "anchor_text": "AI Explainability Patterns with Alibi"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6360f2fedbe---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/real-time?source=post_page-----6360f2fedbe---------------real_time-----------------", "anchor_text": "Real Time"}, {"url": "https://medium.com/tag/scale?source=post_page-----6360f2fedbe---------------scale-----------------", "anchor_text": "Scale"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6360f2fedbe---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/production?source=post_page-----6360f2fedbe---------------production-----------------", "anchor_text": "Production"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&user=Alejandro+Saucedo&userId=32de426f7278&source=-----6360f2fedbe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&user=Alejandro+Saucedo&userId=32de426f7278&source=-----6360f2fedbe---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6360f2fedbe&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6360f2fedbe---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6360f2fedbe--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6360f2fedbe--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6360f2fedbe--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AxSaucedo?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@AxSaucedo?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Alejandro Saucedo"}, {"url": "https://medium.com/@AxSaucedo/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "616 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F32de426f7278&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&user=Alejandro+Saucedo&userId=32de426f7278&source=post_page-32de426f7278--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fb1b4684c4c42&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Freal-time-stream-processing-for-machine-learning-at-scale-with-spacy-kafka-seldon-core-6360f2fedbe&newsletterV3=32de426f7278&newsletterV3Id=b1b4684c4c42&user=Alejandro+Saucedo&userId=32de426f7278&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}