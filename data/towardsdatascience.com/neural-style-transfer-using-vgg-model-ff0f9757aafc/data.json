{"url": "https://towardsdatascience.com/neural-style-transfer-using-vgg-model-ff0f9757aafc", "time": 1683002967.35675, "path": "towardsdatascience.com/neural-style-transfer-using-vgg-model-ff0f9757aafc/", "webpage": {"metadata": {"title": "Neural Style Transfer using VGG model | by Darshan Adakane | Towards Data Science", "h1": "Neural Style Transfer using VGG model", "description": "Before we begin, let\u2019s go to this website to get some inspiration. On the website, we choose a photo from the local computer (let\u2019s assume the image named Joey.jpg). Let\u2019s call this content image\u2026"}, "outgoing_paragraph_urls": [{"url": "https://deepart.io/", "anchor_text": "this", "paragraph_index": 0}, {"url": "https://www.coursera.org/learn/convolutional-neural-networks?", "anchor_text": "CNN", "paragraph_index": 1}, {"url": "https://arxiv.org/abs/1508.06576", "anchor_text": "original paper", "paragraph_index": 6}, {"url": "https://s3.amazonaws.com/cadl/models/vgg16.tfmodel", "anchor_text": "here", "paragraph_index": 6}, {"url": "https://deepart.io/", "anchor_text": "DeepArt", "paragraph_index": 25}, {"url": "https://github.com/darshanadakane/neuralStyleTransfer_usingVGG", "anchor_text": "this", "paragraph_index": 27}], "all_paragraphs": ["Before we begin, let\u2019s go to this website to get some inspiration. On the website, we choose a photo from the local computer (let\u2019s assume the image named Joey.jpg). Let\u2019s call this content image. Then we choose another image, say style image named style1.jpg from the local computer. What this website does is produces a mixed image that preserves the contours of the content image and adds the texture and color pattern from the style image to the content image. Following is the result.", "This is called Neural Style Transfer (NST) and is done by using Deep Learning, Convolution Neural Network (CNN) to be specific. I assume you are familiar with CNN. If not, I would highly recommend Andrew Ng\u2019s Course on CNN.", "Let us understand the basics of NST with the help of the following flowchart. It shows the Style Transfer algorithm which has 13 convolutional layers (only a few are shown for simplicity). Two images are input to the neural network i.e. a content image and a style image. Our motive here is to generate a mixed image that has contours of the content image and texture, color pattern of the style image. We do this by optimizing several loss functions.", "The loss function for the content image minimizes the difference of the features activated for the content image corresponding to the mixed image (which initially is just a noise image that gradually improves) at one or more layers. This preserves the contour of the content image to the resultant mixed image.", "Whereas the loss function for the style image minimizes the difference between so-called Gram-matrices between style image and the mixed image. This is done at one or more layers. The usage of the Gram matrix is it identifies which features are activated simultaneously at a given layer. Then we mimic the same behavior to apply it to the mixed image.", "Using TensorFlow, we update the gradient of these combined loss functions of content and style image to a satisfactory level. Certain calculations of Gram matrices, storing intermediate values for efficiency, loss function for denoising of images, normalizing combined loss function so both image scale relative to each other.", "Now that we have understood the algorithm, let us begin coding. The original paper uses the VGG-19 model. But here we are going to use the VGG-16 model which is available publicly. Download the VGG-16 model from here (Please remember it is ~550MB file).", "In the root directory, create a new folder name it as vgg16 and paste the above file and vgg.py from the Github link. Also, we have modified the vgg16.py file by commenting out maybe_download function (since you have already downloaded the vgg16.tfmodel file)", "Let\u2019s import the libraries first. Then import the vgg16 model.", "Let\u2019s define a couple of helper functions for image manipulations.", "load_image load an image and returns a numpy array of floating points. The image is resized to a maximum of height or width.", "save_image saves an image to jpeg file with pixel values between 0 ad 255", "plot_images plots content, style, and mixed image.", "Next, we will define loss functions that are used in Tensorflow for optimization.", "mean_squared_error operation will return a tensor that is mean squared error (MSE) difference between two input tensors.", "create_content_loss will calculate the MSE between the content and the mixed image. The loss is minimized so that the activation features of content are made similar to the mixed image so that it transfers the contours from content image to a mixed image.", "Next, our motive is to capture the style features of the mixed image. To do this, we will do something similar i.e measure which features activate for the style layers simultaneously and copy this pattern to the mixed image. An efficient way to do this is by calculating the Gram matrix. Gram matrix is essentially the dot product for the vectors of the feature activation layers. If the entry in the matrix has a smaller value it means the two features in the given layers do not activate simultaneously and vice versa.", "Let\u2019s first define the calculating GramMatrix first as gram_matrix followed by create_style_loss which calculates the MSE of Gram matrix instead of the two raw tensors (as we did it in create_content_loss).", "To reduce the noise in the resultant mixed image, we use a denoising filtering algorithm called \u2018Total Variation Denoising\u2019 using the following code.", "The next section of code is the core. We will define the Style Transfer Algorithm that calculates the gradient descent on the loss functions. The algorithm uses normalization such that loss values are equal to one that helps in choosing the loss weights independent of the content and style layers.", "At first, we will load the content image which has contour feature we wish to be in the mixed image. Here I have named it as 1.jpg", "Now, we will load the style image of whose we want the color and texture to appear in the mixed image.", "Further, we will define the layer indices that we want to match the content image. Usually, it is a few layers just after the start. The 5th layer (index is 4) in the VGG-16 seems to work well. Similarly, the layer indices for the style image. Usually, it is towards the end of the total layer. Here we will define the 13th layer.", "The final part of the execution is applying style transfer to our defined content and style images. As defined, it automatically creates the loss functions for content and style layers and performs optimizations based on the number of iterations. Finally, displaying the mixed image.", "P.S. This process may run slow on CPU (I am using CPU). Let\u2019s see what results are given.", "Not bad! The results demonstrate the basic idea of combining two images. They are not at par like DeepArt who are pioneers in these techniques. Perhaps more iterations, smaller step sizes, higher resolution images, changing style and content layer indices or more computational power would increase the quality of the mixed image.", "Thanks for reading out the article. I hope it helps.", "You can find the github repo at this link.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fff0f9757aafc&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@darshanadakane?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@darshanadakane?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Darshan Adakane"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F902af3f3babc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&user=Darshan+Adakane&userId=902af3f3babc&source=post_page-902af3f3babc----ff0f9757aafc---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://deepart.io/", "anchor_text": "this"}, {"url": "https://www.coursera.org/learn/convolutional-neural-networks?", "anchor_text": "CNN"}, {"url": "https://arxiv.org/abs/1508.06576", "anchor_text": "original paper"}, {"url": "https://s3.amazonaws.com/cadl/models/vgg16.tfmodel", "anchor_text": "here"}, {"url": "https://deepart.io/", "anchor_text": "DeepArt"}, {"url": "https://github.com/darshanadakane/neuralStyleTransfer_usingVGG", "anchor_text": "this"}, {"url": "https://www.youtube.com/watch?v=LoePx3QC5Js&t=268s", "anchor_text": "Source"}, {"url": "https://medium.com/tag/neural-style-transfer?source=post_page-----ff0f9757aafc---------------neural_style_transfer-----------------", "anchor_text": "Neural Style Transfer"}, {"url": "https://medium.com/tag/deep-neural-networks?source=post_page-----ff0f9757aafc---------------deep_neural_networks-----------------", "anchor_text": "Deep Neural Networks"}, {"url": "https://medium.com/tag/vgg?source=post_page-----ff0f9757aafc---------------vgg-----------------", "anchor_text": "Vgg"}, {"url": "https://medium.com/tag/convolutional-network?source=post_page-----ff0f9757aafc---------------convolutional_network-----------------", "anchor_text": "Convolutional Network"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----ff0f9757aafc---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&user=Darshan+Adakane&userId=902af3f3babc&source=-----ff0f9757aafc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&user=Darshan+Adakane&userId=902af3f3babc&source=-----ff0f9757aafc---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fff0f9757aafc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----ff0f9757aafc---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----ff0f9757aafc--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@darshanadakane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@darshanadakane?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Darshan Adakane"}, {"url": "https://medium.com/@darshanadakane/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "29 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F902af3f3babc&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&user=Darshan+Adakane&userId=902af3f3babc&source=post_page-902af3f3babc--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F89b4645c0727&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fneural-style-transfer-using-vgg-model-ff0f9757aafc&newsletterV3=902af3f3babc&newsletterV3Id=89b4645c0727&user=Darshan+Adakane&userId=902af3f3babc&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}