{"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-for-search-applications-33a7a442b9d0", "time": 1683017000.6295621, "path": "towardsdatascience.com/fine-tuning-a-bert-model-for-search-applications-33a7a442b9d0/", "webpage": {"metadata": {"title": "Fine-tuning a BERT model for search applications | by Thiago G. Martins | Towards Data Science", "h1": "Fine-tuning a BERT model for search applications", "description": "There are cases where the inputs to your Transformer model are pairs of sentences, but you want to process each sentence of the pair at different times due to your application\u2019s nature. Search\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "a blog post", "paragraph_index": 3}, {"url": "https://vespa.ai/", "anchor_text": "Vespa", "paragraph_index": 3}, {"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "previous post", "paragraph_index": 4}, {"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "training routine", "paragraph_index": 6}, {"url": "https://pyvespa.readthedocs.io/en/latest/index.html", "anchor_text": "pyvespa", "paragraph_index": 8}, {"url": "https://vespa.ai/", "anchor_text": "Vespa", "paragraph_index": 8}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai", "paragraph_index": 10}], "all_paragraphs": ["There are cases where the inputs to your Transformer model are pairs of sentences, but you want to process each sentence of the pair at different times due to your application\u2019s nature. Search applications are one example.", "Search applications involve a large collection of documents that can be pre-processed and stored before a search action is required. On the other hand, a query triggers a search action, and we can only process it in real-time. Search apps\u2019 goal is to return the most relevant documents to the query as quickly as possible. By applying the tokenizer to the documents as soon as we feed them to the application, we only need to tokenize the query when a search action is required, saving us precious time.", "In addition to applying the tokenizer at different times, you also want to retain adequate control about encoding your pair of sentences. For search, you might want to have a joint input vector of length 128 where the query, which is usually smaller than the document, contributes with 32 tokens while the document can take up to 96 tokens.", "When training a Transformer model for search, you want to ensure that the training data will follow the same pattern used by the search engine serving the final model. I have written a blog post on how to get started with BERT model fine-tuning using the transformer library. This piece will adapt the training routine with a custom encoding based on two separate tokenizers to reproduce how a Vespa application would serve the model once deployed.", "The only change required is simple but essential. In my previous post, we discussed the vanilla case where we applied the tokenizer directly to the pairs of queries and documents.", "In the search case, we create the create_bert_encodings function that will apply two different tokenizers, one for the query and the other for the document. In addition to allowing for different query and document max_length, we also need to set add_special_tokens=False and not use padding as those need to be included by our custom code when joining the tokens generated by the tokenizer.", "We then create the train_encodings and val_encodings required by the training routine. Everything else on the training routine works just the same.", "Training a model to deploy in a search application require us to ensure that the training encodings are compatible with encodings used at serving time. We generate document encodings offline when feeding the documents to the search engine while creating query encoding at run-time upon arrival of the query. It is often relevant to use different maximum lengths for queries and documents, and other possible configurations.", "We showed how to customize BERT model encodings to ensure this training and serving compatibility. However, a better approach is to build tools that bridge the gap between training and serving by allowing users to request training data that respects by default the encodings used when serving the model. pyvespa will include such integration to make it easier for Vespa users to train BERT models without having to adjust the encoding generation manually as we did above.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Working on Vespa.ai. Follow me on Twitter @Thiagogm"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F33a7a442b9d0&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://tgmstat.medium.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86----33a7a442b9d0---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@alicegrace?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Alice Dietrich"}, {"url": "https://unsplash.com/collections/8801515/cd-manual?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "a blog post"}, {"url": "https://vespa.ai/", "anchor_text": "Vespa"}, {"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "previous post"}, {"url": "https://towardsdatascience.com/fine-tuning-a-bert-model-with-transformers-c8e49c4e008b", "anchor_text": "training routine"}, {"url": "https://unsplash.com/@steve_j?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Steve Johnson"}, {"url": "https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://pyvespa.readthedocs.io/en/latest/index.html", "anchor_text": "pyvespa"}, {"url": "https://vespa.ai/", "anchor_text": "Vespa"}, {"url": "https://medium.com/tag/search?source=post_page-----33a7a442b9d0---------------search-----------------", "anchor_text": "Search"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----33a7a442b9d0---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----33a7a442b9d0---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/nlp?source=post_page-----33a7a442b9d0---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----33a7a442b9d0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&user=Thiago+G.+Martins&userId=a578be8bee86&source=-----33a7a442b9d0---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F33a7a442b9d0&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----33a7a442b9d0---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----33a7a442b9d0--------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://tgmstat.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Thiago G. Martins"}, {"url": "https://tgmstat.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "96 Followers"}, {"url": "http://Vespa.ai", "anchor_text": "Vespa.ai"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa578be8bee86&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&user=Thiago+G.+Martins&userId=a578be8bee86&source=post_page-a578be8bee86--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd1c0d81e840f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Ffine-tuning-a-bert-model-for-search-applications-33a7a442b9d0&newsletterV3=a578be8bee86&newsletterV3Id=d1c0d81e840f&user=Thiago+G.+Martins&userId=a578be8bee86&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}