{"url": "https://towardsdatascience.com/advanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089", "time": 1683014361.7172742, "path": "towardsdatascience.com/advanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089/", "webpage": {"metadata": {"title": "Advanced Tensorflow Data Input Pipelines: Handling Time Series | by Theodoros Ntakouris | Towards Data Science", "h1": "Advanced Tensorflow Data Input Pipelines: Handling Time Series", "description": "The tf.data.Dataset API is a very efficient pipeline builder. Time Series Tasks can be a bit tricky to implement properly. In this article, we are going to dive deep into common tasks: With the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.tensorflow.org/guide/data", "anchor_text": "tf.data.Dataset", "paragraph_index": 0}], "all_paragraphs": ["The tf.data.Dataset API is a very efficient pipeline builder. Time Series Tasks can be a bit tricky to implement properly. In this article, we are going to dive deep into common tasks:", "With the dataset api this is simple to do. Assume the following configuration. input feature is a and label is b .", "Each row can be described by a tensor shaped (2,) . So our dataset is of size (6, 2) .", "Now, with a window size of 2 , produce training data. This would look like:", "The .window() function actually produces a set of datasets. This is why we need to do a .flat_map(batch) operation to end up with a series of tensors we can treat uniformly.", "Sometimes you just want to predict the next tick of a sequence. This can be done without it being labelled. For an input dataset:", "The training pairs would be (again, with a window of size 2 ):", "Let\u2019s try to take the previous approach, with a window of size 3 , to keep the last element as a label.", "The best \u2014 practisey way to do this would be to create 2 similar dataset pipelines with a window size of 2 , but with one of 2, lagging infront.", "The quintessential way of large scale deep learning input pipelines is to shard your input data to files in the 1\u2013100MBs range, that are able to be read sequentially and in parallel. This means that the storage server cost is reduced drastically by just using rotational drives instead of SSDs, by keeping up the performance.", "A very common case of this practise is to store TF Records in a Hadoop File System or on bucket \u2014 based public cloud solutions like Google Cloud Storage.", "Splitting X-Y pair datasets (like images) to multiple files is trivial. With a time series windowing task at hand, it becomes tricky to maintain sequential integrity and avoid data loss.", "Let\u2019s walk through a simple example.", "For sure, you can get a file glob and load them up and push em straight to training. But you\u2019ve got many issues.", "Firstly, for maximum performance, order is non-deterministic between 2+ shards. This means that your data will be out of order, similarly to position \u2014 invariant parallel algorithms like map \u2014 reduce.", "You will end up windowing together line 1 from file 1 and line 2 from file 2, while another worker windows together line 2 from file 1 and line 1 from file 2.", "The out \u2014 of \u2014 order part is now fixed. But there\u2019s another problem that needs careful inspection. Missing cross-file data. If file 2 is the sequence continuation of file 1, you need to make sure that your look \u2014 back window includes a link between those 2 files. Else, you lose data points.", "This means that while tf.data.Dataset is parsing the sharded files, the final dataset that is generated for your model to train, needs to include (let\u2019s demonstrate this for a window of 2):", "Sure, you can drop those few datapoints. But keep in mind that the bigger your window size is, the more data points you\u2019re going to lose. Depending on the nature and the size of data, make the correct decision.", "If you enforce a purely sequential read like we demonstrated on the Windowing Unlabelled Data by Looking Ahead section above, you\u2019re going to enjoy no benefit from the parallel read speedup.", "The simple and effective solution is to make multiple datasets, and sequentially concatenate them by 2.", "You can even use such optimized pipelines to train with massive amounts of time series data on one or more TPUs.", "By implementing the techniques mentioned in this article, you can create performant pipelines for sequential data by avoiding common pitfalls such as data loss and sequential integrity.", "Congratulations! You\u2019ve achieved time series excellence.", "Thank you for reading all the way to the end!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe990717d0089&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://zarkopafilis.medium.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Theodoros Ntakouris"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa030fa2f6701&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=post_page-a030fa2f6701----e990717d0089---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://pixabay.com/photos/grow-blossom-time-lapse-sequence-73353/", "anchor_text": "Image by stux from Pixabay"}, {"url": "https://www.tensorflow.org/guide/data", "anchor_text": "tf.data.Dataset"}, {"url": "https://medium.com/tag/time-series-forecasting?source=post_page-----e990717d0089---------------time_series_forecasting-----------------", "anchor_text": "Time Series Forecasting"}, {"url": "https://medium.com/tag/cloud-native?source=post_page-----e990717d0089---------------cloud_native-----------------", "anchor_text": "Cloud Native"}, {"url": "https://medium.com/tag/software-engineering?source=post_page-----e990717d0089---------------software_engineering-----------------", "anchor_text": "Software Engineering"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----e990717d0089---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----e990717d0089---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=-----e990717d0089---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=-----e990717d0089---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe990717d0089&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e990717d0089---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e990717d0089--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e990717d0089--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e990717d0089--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e990717d0089--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e990717d0089--------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://zarkopafilis.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Theodoros Ntakouris"}, {"url": "https://zarkopafilis.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "450 Followers"}, {"url": "https://ntakour.is/", "anchor_text": "https://ntakour.is/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa030fa2f6701&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=post_page-a030fa2f6701--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3c6cbfa1ceca&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fadvanced-tensorflow-data-input-pipelines-handling-time-series-e990717d0089&newsletterV3=a030fa2f6701&newsletterV3Id=3c6cbfa1ceca&user=Theodoros+Ntakouris&userId=a030fa2f6701&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}