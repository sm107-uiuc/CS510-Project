{"url": "https://towardsdatascience.com/deploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498", "time": 1683004214.509141, "path": "towardsdatascience.com/deploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498/", "webpage": {"metadata": {"title": "Deploying a Scikit-Learn Model on AWS Using SKLearn Estimators, Local Jupyter Notebooks, and the Terminal | by Quinn Lanners | Towards Data Science", "h1": "Deploying a Scikit-Learn Model on AWS Using SKLearn Estimators, Local Jupyter Notebooks, and the Terminal", "description": "Amazon Web Services (AWS) is currently the most in-demand cloud platform for Data Science and Machine Learning professionals. Given this, the first collection of blog posts in this Machine Learning\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.docker.com/engine/docker-overview/", "anchor_text": "here", "paragraph_index": 2}, {"url": "https://github.com/qlanners/ml_deploy/tree/master/aws/scikit-learn/sklearn_estimators_locally", "anchor_text": "here", "paragraph_index": 4}, {"url": "https://portal.aws.amazon.com/billing/signup?nc2=h_ct&src=header_signup&redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start", "anchor_text": "this page to create your free AWS account", "paragraph_index": 5}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html", "anchor_text": "install", "paragraph_index": 7}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html", "anchor_text": "configure", "paragraph_index": 7}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-using.html", "anchor_text": "use", "paragraph_index": 7}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/index.html", "anchor_text": "Boto3", "paragraph_index": 8}, {"url": "https://github.com/aws/sagemaker-python-sdk", "anchor_text": "Sagemaker", "paragraph_index": 8}, {"url": "https://archive.ics.uci.edu/ml/datasets/Iris", "anchor_text": "here", "paragraph_index": 9}, {"url": "https://aws.amazon.com/s3/", "anchor_text": "Click here for more information on S3", "paragraph_index": 12}, {"url": "https://docs.aws.amazon.com/general/latest/gr/sagemaker.html", "anchor_text": "here", "paragraph_index": 13}, {"url": "https://s3.console.aws.amazon.com/", "anchor_text": "AWS S3 Console", "paragraph_index": 14}, {"url": "https://sagemaker.readthedocs.io/en/stable/using_sklearn.html", "anchor_text": "here", "paragraph_index": 20}, {"url": "https://console.aws.amazon.com/iam/home?#/roles$new?step=type", "anchor_text": "here", "paragraph_index": 22}, {"url": "https://aws.amazon.com/sagemaker/pricing/instance-types/", "anchor_text": "here", "paragraph_index": 26}, {"url": "https://sagemaker.readthedocs.io/en/stable/using_sklearn.html#required-arguments", "anchor_text": "here", "paragraph_index": 27}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-runtime.html#SageMakerRuntime.Client.invoke_endpoint", "anchor_text": "here", "paragraph_index": 29}], "all_paragraphs": ["Amazon Web Services (AWS) is currently the most in-demand cloud platform for Data Science and Machine Learning professionals. Given this, the first collection of blog posts in this Machine Learning Deployment series will outline how to deploy various models in a number of different ways on AWS.", "The first AWS deployment we will cover will be the deployment of a simple Scikit-learn model done completely from one\u2019s local computer using the AWS pre-build Scikit-learn Estimators.", "Before we dig into the steps, it\u2019s important to understand the basic concept of how AWS Sagemaker trains and deploys models. If you are unfamiliar with Docker, I recommend reading their overview docs here. Without going into too much detail, AWS essentially uses Docker containers to store a model\u2019s configuration, train the model, and eventually deploy the model. By encapsulating ML models within Docker containers, AWS is able to simultaneously provide a set of preconfigured Docker images for common ML frameworks, while also allowing for complete customization.", "Luckily for us, in 2018, AWS added Scikit-learn to its list of supported frameworks. Thus, we can quickly deploy our model using a pre-configured Docker container. As you\u2019ll see below, we will create a training script and execute it inside the container using the AWS Scikit-learn Estimators. So, without further ado, let\u2019s get to it.", "You can find the code from this post in the repo I started for this blog series here.", "Before we begin, we have to set up an AWS account. If you already have an AWS account, then you can skip to the next step. Otherwise, let\u2019s get you signed up for AWS and their 175 (and continually growing) services. To start, navigate to this page to create your free AWS account and get 12 months of free tier access (which will be plenty to complete the code in this post).", "Step 2: AWS CLI and Pip Packages", "Once you have registered for AWS, we also need to download the AWS command-line interface (CLI) so we can work on our AWS account from our local device. AWS does a good job of explaining how to install, configure, and use their CLI.", "We will also need to install a couple of python SDKs in order to access AWS in our python scripts. Specifically, we will need the Boto3 to handle data upload and Sagemaker to create our Scikit-learn estimators. Run the pip commands below to install them.", "In order to focus on the deployment of the model and avoid getting caught up in the weeds regarding data cleaning and model tuning, we are going to be training a simple logistic regression model on the Iris dataset. You can download the dataset here and save it to your local device.", "We will use the code block below to strip a few samples from the dataset for testing out API calls once we have deployed the model, and save the data into two new files called train.csv and deploy_test.csv.", "Note: We are disregarding ML train/test set guidelines. In practice, you should always be splitting your data into a train/test set. However, for this tutorial, we are just focusing on deploying the model and will check how the model predicts the few points we saved in deploy_test.csv by making an API call at the end.", "In order for AWS Sagemaker to access this data when it comes time to train the model, we must upload the data to our AWS account by creating a new Simple Storage Service (S3) bucket and adding our training data to it. To do this, we will be using the boto3 SDK we installed above to create an S3 bucket in a specified region and then save our train.csv file inside a train/ folder in that bucket. Click here for more information on S3.", "Note: In order for Sagemaker to access the data, the S3 bucket and Sagemaker session need to be in the same region. And given that Sagemaker is only available in certain regions, be sure to select a region for your S3 bucket from the regions listed here.", "To double-check that the above scripts worked correctly, you can navigate to the AWS S3 Console, login, and see if the bucket we created above is there. If it\u2019s there, we are ready to move on to the meat of the work and create our model!", "In order to deploy a model to AWS using the Scikit-learn Sagemaker SDK, we first have to create a script that tells Sagemaker how to train and deploy our model. While much less work than creating our own Docker container to deploy our model, the SDK does require us to stick to rather strict guidelines.", "First off, we will import all the packages we will need and create a couple of dictionaries to convert the target labels from text to numbers and vice versa.", "After these imports, we need to wrap the training steps within a __main__ function. We will also include a line to save the model at the end. The SKLearn Sagemaker SDK will run this __main__ function to train a model on the data we pushed to the S3 bucket above and then save the model so that it can be used later when we want to deploy it.", "The __main__ function is the only required function. However, we have the ability to modify a number of additional functions that determine how the model will handle API calls once it is deployed. These optional functions are:", "model_fn: specifies from where and how to load the model that is being deployed. input_fn: formats the request body sent to the deployed model into a format that can be fed into the model. predict_fn: uses the deployed model loaded by model_fn and the data formatted by input_fn to make predictions. output_fn: reformats the predictions made by predict_fn into the final format that is returned as the response to the API call.", "The Gist below shows these optional functions for our model. The comments above each function provide a bit more information on each. For even more information on these functions and their default behavior see here.", "Step 5: Create IAM Sagemaker Role", "Unfortunately, I lied a bit earlier when I said we were going to do ALL of this from our local computer. If you do not already have a Sagemaker IAM role, we are going to need to navigate to the AWS IAM Console and create a new role. Start by clicking here and logging in. You should see a screen like the one below:", "From here, select Sagemaker as the service and push Next.", "Skip through the next two pages by selecting Next, until you see the following screen:", "On this page, just create your own Role name* and (optional) Role description before pressing Create Role. Just be sure to remember what you named your role, as we will be needing it in the next step!", "With the hard work out of the way, let\u2019s deploy your model. Luckily, with AWS SKLearn class, this only takes a few lines of code. Just make sure that the entry_point path points to the script we saved in step 4 and the role variable is the Role name* you created in step 5. In this snippet, we also specify instance_types for the model and the deployed endpoint. The instance_type specifies how much computing power we want AWS to allocate for our services. Obviously, the more power the more cost, so for this example we use small instances. Check here for a list of all the Sagemaker instance types available.", "Note: the SKLearn() constructor has a number of optional arguments you can add to configure the Scikit-learn framework_version, hyperparameters, etc. Click here for more info.", "To test the endpoint, we will feed send a request with the data samples we saved to deploy_test.csv way back in step 3. In order to send a request to the deployed endpoint, we first need to get our test samples into a format that the model can parse (i.e. a format that can be interpreted by the input_fn function we defined in aws_sklearn_main.py). Since we configured our model to understand requests with multiple samples were each sample\u2019s features are separated by a \u201c,\u201d and each individual sample is separated by a \u201c|\u201d we format our request_body into a format like below:", "From here, we use boto3 to create a Sagemaker session which will allow us to interact with our deployed model. In order to call our Sagemaker endpoint, we use the invoke_endpoint function. For this function, we must specify an endpoint, a conent_type, and a body. There are also a number of optional arguments you can read more about here. In our case, we will pass the endpoint that we printed out in the previous step, the content_type \u2018text/csv\u2019, and a string formatted to look like above. Finally, once we have run this method and received a response, we subscript into the body of our response and read what is returned.", "If the expected response matches what was actually returned by the model, you have successfully trained and deployed a working Scikit-learn model on AWS!", "In order to avoid any AWS charges, be sure to clean up your resources. You can quickly terminate your model\u2019s endpoint by uncommenting the final line in Step 6 and running it.", "While this will delete the endpoint, to totally purge your AWS account of all of the resources you used in this tutorial complete the following.", "Overall, while the learning curve is a bit high, once you are able to navigate your way around the AWS services and understand the Sagemaker principals, AWS SKLearn Estimators become an incredible tool to quickly deploy Scikit-learn models.", "Other Blog Posts in this Series:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Biostatistics PhD student at Duke University. My work centers around interpretable AI and Causal Inference with observational data, particularly in medicine."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd94396589498&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d94396589498--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d94396589498--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lannersq?source=post_page-----d94396589498--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lannersq?source=post_page-----d94396589498--------------------------------", "anchor_text": "Quinn Lanners"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8a2f7df48b90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&user=Quinn+Lanners&userId=8a2f7df48b90&source=post_page-8a2f7df48b90----d94396589498---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@lannersq/why-you-should-know-how-to-deploy-your-models-in-the-cloud-41d1c85a8df0", "anchor_text": "Intro"}, {"url": "https://docs.docker.com/engine/docker-overview/", "anchor_text": "here"}, {"url": "https://github.com/qlanners/ml_deploy/tree/master/aws/scikit-learn/sklearn_estimators_locally", "anchor_text": "here"}, {"url": "https://portal.aws.amazon.com/billing/signup?nc2=h_ct&src=header_signup&redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start", "anchor_text": "this page to create your free AWS account"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html", "anchor_text": "install"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html", "anchor_text": "configure"}, {"url": "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-using.html", "anchor_text": "use"}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/index.html", "anchor_text": "Boto3"}, {"url": "https://github.com/aws/sagemaker-python-sdk", "anchor_text": "Sagemaker"}, {"url": "https://archive.ics.uci.edu/ml/datasets/Iris", "anchor_text": "here"}, {"url": "https://aws.amazon.com/s3/", "anchor_text": "Click here for more information on S3"}, {"url": "https://docs.aws.amazon.com/general/latest/gr/sagemaker.html", "anchor_text": "here"}, {"url": "https://s3.console.aws.amazon.com/", "anchor_text": "AWS S3 Console"}, {"url": "https://sagemaker.readthedocs.io/en/stable/using_sklearn.html", "anchor_text": "here"}, {"url": "https://console.aws.amazon.com/iam/home?#/roles$new?step=type", "anchor_text": "here"}, {"url": "https://aws.amazon.com/sagemaker/pricing/instance-types/", "anchor_text": "here"}, {"url": "https://sagemaker.readthedocs.io/en/stable/using_sklearn.html#required-arguments", "anchor_text": "here"}, {"url": "https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-runtime.html#SageMakerRuntime.Client.invoke_endpoint", "anchor_text": "here"}, {"url": "https://console.aws.amazon.com/sagemaker/", "anchor_text": "Sagemaker Console"}, {"url": "https://console.aws.amazon.com/s3/", "anchor_text": "S3 Console"}, {"url": "https://console.aws.amazon.com/iam/", "anchor_text": "IAM Console"}, {"url": "https://console.aws.amazon.com/cloudwatch/", "anchor_text": "Cloudwatch Console"}, {"url": "https://medium.com/@lannersq/why-you-should-know-how-to-deploy-your-models-in-the-cloud-41d1c85a8df0", "anchor_text": "Intro"}, {"url": "https://medium.com/tag/aws?source=post_page-----d94396589498---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/tag/deployment?source=post_page-----d94396589498---------------deployment-----------------", "anchor_text": "Deployment"}, {"url": "https://medium.com/tag/cloud-services?source=post_page-----d94396589498---------------cloud_services-----------------", "anchor_text": "Cloud Services"}, {"url": "https://medium.com/tag/scikit-learn?source=post_page-----d94396589498---------------scikit_learn-----------------", "anchor_text": "Scikit Learn"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d94396589498---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&user=Quinn+Lanners&userId=8a2f7df48b90&source=-----d94396589498---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&user=Quinn+Lanners&userId=8a2f7df48b90&source=-----d94396589498---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d94396589498--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd94396589498&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d94396589498---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d94396589498--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d94396589498--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d94396589498--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d94396589498--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d94396589498--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d94396589498--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d94396589498--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d94396589498--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lannersq?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lannersq?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Quinn Lanners"}, {"url": "https://medium.com/@lannersq/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "85 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8a2f7df48b90&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&user=Quinn+Lanners&userId=8a2f7df48b90&source=post_page-8a2f7df48b90--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F874b67ced0c1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploying-a-scikit-learn-model-on-aws-using-sklearn-estimators-local-jupyter-notebooks-and-the-d94396589498&newsletterV3=8a2f7df48b90&newsletterV3Id=874b67ced0c1&user=Quinn+Lanners&userId=8a2f7df48b90&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}