{"url": "https://towardsdatascience.com/a-guide-to-forecasting-in-r-6b0c9638c261", "time": 1683009134.996587, "path": "towardsdatascience.com/a-guide-to-forecasting-in-r-6b0c9638c261/", "webpage": {"metadata": {"title": "Time Series Forecasting in R. Exponential Smoothing, TBATS, ARIMA\u2026 | by Fran\u00e7ois St-Amant | Towards Data Science", "h1": "Time Series Forecasting in R", "description": "Python is great, but when it comes to forecasting, I personally think R still has the upper hand. The Forecast package is the most complete forecasting package available on R or Python, and it\u2019s\u2026"}, "outgoing_paragraph_urls": [], "all_paragraphs": ["Python is great, but when it comes to forecasting, I personally think R still has the upper hand. The Forecast package is the most complete forecasting package available on R or Python, and it\u2019s worth knowing about it.", "Here is what we will see in this article:", "For every method, we will build a model on a validation set, forecast with it for the duration of the validation set and compare the forecast with the real observations to obtain a Mean Absolute Percentage Error (MAPE).", "The data used will be coming from the Air Passengers Dataset, available on R.", "Any forecasting method should be evaluated by being compared to a naive method. This helps ensure that the efforts put in having a more complex model are worth it in terms of performance.", "The simplest of all methods is called simple naive. Extremely simple: the forecast for tomorrow is what we are observing today.", "Another approach, seasonal naive, is a little more \u201ccomplex\u201d: the forecast for tomorrow is what we observed the week/month/year (depending what horizon we are working with) before.", "Here is how to do a seasonal naive forecast:", "That gives us an MAPE of 27.04%. That\u2019s the score to beat. By the way, remove the s from \u201csnaive\u201d and you have the code for simple naive. Here is how to plot the forecast:", "We see that what happened in the last year of data is repeated as a forecast for the entire validation set.", "There are many ways to do exponential smoothing. The idea is always to have a declining weight given to observations. The more recent an observation, the more importance it will have in our forecast.", "Parameters can also be added. You can for instance add a trend paramenter (Holt method) or add a seasonality (Holt-Winters).", "With the Forecast Package, smoothing methods can be placed within the structure of state space models. By using this structure, we can find the optimal exponential smoothing model, using the ets function.", "We see ETS (M, Md, M). This means we have an ets model with multiplicative errors, a multiplicative trend and a multiplicative seasonality. Basically, multiplicative means that the parameter is \u201camplified\u201d over time. For instance the trend is getting bigger and bigger as time goes by (our case here).", "Here is how to forecast using the estimated optimal smoothing model:", "We see that the upward trend in demand is being capture a little bit (far from perfect, better than naive). It gives an MAPE of 12.6%.", "The ets function is good, but it only allows for one seasonality. Sometimes, the data we have can be composed of multiple seasonalities (monthly and yearly for instance).", "Double Seasonal Holt-Winters (DSHW) allows for two seasonalities: a smaller one repeated often and a bigger one repeated less often. For the method to work however, the seasonalities need to be nested, meaning one must be an integer multiple of the other (2 and 4, 24 and 168, etc.).", "The code here is a bit different since we need to specify the lenghts of our two seasonalities (which is not always something we know) and the forecast is computed directly when creating the model with the dshw function.", "We get a MAPE of 3.7% with this method!", "DSHW is good, but some processes have more complex seasonalities, which our previous functions cannot handle. Indeed, you could have both a weekly and yearly seasonality. You could even have more than 2!", "BATS and TBATS allow for multiple seasonalities. TBATS is a modification (an improvement really) of BATS that allows for multiple non-integer seasonality cycles.", "Here is how to build a TBATS model and forecast with it:", "We get a MAPE of 12.9% for this method.", "That\u2019s it for ARIMA but if you know the data you have is seasonal, then you need more. That\u2019s where SARIMA comes into play.", "SARIMA adds a seasonal part to the model.", "P represents the seasonal AR order, D the seasonal differencing order, Q the seasonal MA order and m the number of observations per year.", "The auto.arima function can be used to return the best estimated model. Here is the code:", "To forecast a SARIMA model (which is what we have here since we have a seasonal part), we can use the sarima.for function from the astsa package.", "We get a MAPE of 6.5% with this SARIMA model.", "Just so you know, we could in theory complexify things even more by adding exogenous variables (explanatory variables) to an ARIMA/SARIMA model, which would make it SARIMAX.", "For this data, DSHW gave the best results. Keep in mind however that no model does best all the time.", "In all the previous examples, I forecasted 5 years into the future. However, if you want to forecast on a daily basis, why would you use a forecasted value from 5 years ago when you could use the real observations to predict tomorrow?", "The idea of setting up a one-step-ahead forecast is to evaluate how well a model would have done if you were forecasting for one day ahead, during 5 years, using latest observations to make your forecast.", "Simply put: instead of forecasting once for the 60 months ahead, we forecast 60 times for the upcoming month, using latest observations.", "Coding this is quite simple. All we need is to iteratively add the latest observation to the training dataset, forecast from there and repeat. Here is the code to do it using the SARIMA model we found earlier.", "As you see, for every iteration, the training set grows by one observation, a new forecast for n.ahead=1 is computed and results are stored in the one_step_ahead_sarima matrix.", "Here is how to get the plot:", "We get a MAPE of 4.1%, which is an improvement of more than 2% on what we had when using the same SARIMA model to forecast 5 years ahead.", "That\u2019s not surprising considering that the shorter the forecasting horizon, the better the forecast should be. That is why you should always set up a one-step-ahead forecast if it is possible!", "I hope this helped. Thanks a lot for reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6b0c9638c261&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://francoisstamant.medium.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": ""}, {"url": "https://francoisstamant.medium.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Fran\u00e7ois St-Amant"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f8974d28029&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&user=Fran%C3%A7ois+St-Amant&userId=4f8974d28029&source=post_page-4f8974d28029----6b0c9638c261---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/photos/pGcqw1ARGyg", "anchor_text": "https://unsplash.com/photos/pGcqw1ARGyg"}, {"url": "https://otexts.com/fpp2/seasonal-arima.html", "anchor_text": "https://otexts.com/fpp2/seasonal-arima.html"}, {"url": "https://francoisstamant.medium.com/membership", "anchor_text": "https://francoisstamant.medium.com/membership"}, {"url": "https://medium.com/tag/forecasting?source=post_page-----6b0c9638c261---------------forecasting-----------------", "anchor_text": "Forecasting"}, {"url": "https://medium.com/tag/r?source=post_page-----6b0c9638c261---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/tutorial?source=post_page-----6b0c9638c261---------------tutorial-----------------", "anchor_text": "Tutorial"}, {"url": "https://medium.com/tag/arima?source=post_page-----6b0c9638c261---------------arima-----------------", "anchor_text": "Arima"}, {"url": "https://medium.com/tag/time-series-forecasting?source=post_page-----6b0c9638c261---------------time_series_forecasting-----------------", "anchor_text": "Time Series Forecasting"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&user=Fran%C3%A7ois+St-Amant&userId=4f8974d28029&source=-----6b0c9638c261---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&user=Fran%C3%A7ois+St-Amant&userId=4f8974d28029&source=-----6b0c9638c261---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6b0c9638c261&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6b0c9638c261---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6b0c9638c261--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6b0c9638c261--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6b0c9638c261--------------------------------", "anchor_text": ""}, {"url": "https://francoisstamant.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://francoisstamant.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Fran\u00e7ois St-Amant"}, {"url": "https://francoisstamant.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "501 Followers"}, {"url": "https://francoisstamant.medium.com/membership", "anchor_text": "https://francoisstamant.medium.com/membership"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F4f8974d28029&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&user=Fran%C3%A7ois+St-Amant&userId=4f8974d28029&source=post_page-4f8974d28029--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc94c3a4f2e83&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fa-guide-to-forecasting-in-r-6b0c9638c261&newsletterV3=4f8974d28029&newsletterV3Id=c94c3a4f2e83&user=Fran%C3%A7ois+St-Amant&userId=4f8974d28029&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}