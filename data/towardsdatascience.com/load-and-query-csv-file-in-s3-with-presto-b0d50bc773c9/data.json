{"url": "https://towardsdatascience.com/load-and-query-csv-file-in-s3-with-presto-b0d50bc773c9", "time": 1683010549.927639, "path": "towardsdatascience.com/load-and-query-csv-file-in-s3-with-presto-b0d50bc773c9/", "webpage": {"metadata": {"title": "Load and Query CSV File in S3 with Presto | by Yifeng Jiang | Towards Data Science", "h1": "Load and Query CSV File in S3 with Presto", "description": "It is such a simple and common task in big data that I thought folks must have done this a thousand times, so when a customer asked me this, I went straight to the internet trying to find some good\u2026"}, "outgoing_paragraph_urls": [{"url": "https://data.cityofnewyork.us/Transportation/2018-Yellow-Taxi-Trip-Data/t29m-gskq", "anchor_text": "NewYork City 2018 Yellow Taxi Trip Dataset", "paragraph_index": 2}, {"url": "https://medium.com/swlh/presto-with-kubernetes-and-s3-deployment-4e262849244a", "anchor_text": "Presto with Kubernetes and S3 \u2014 Deployment", "paragraph_index": 3}, {"url": "https://github.com/peak/s5cmd", "anchor_text": "s5cmd", "paragraph_index": 6}, {"url": "https://www.purestorage.com/products/flashblade.html", "anchor_text": "FlashBlade", "paragraph_index": 6}, {"url": "https://help.tableau.com/current/pro/desktop/en-us/examples_presto.htm", "anchor_text": "visualise", "paragraph_index": 11}], "all_paragraphs": ["It is such a simple and common task in big data that I thought folks must have done this a thousand times, so when a customer asked me this, I went straight to the internet trying to find some good examples to share with the customer. Guess what? I couldn\u2019t find one! So I decided to write one myself.", "A typical data ETL flow with Presto and S3 looks like:", "In this blog, I use the NewYork City 2018 Yellow Taxi Trip Dataset. The dataset has 112 million rows, 17 columns each row in CSV format. Total size is 9.8GB.", "I assume you have completed a basic Presto and S3 setup. You also need to set up the Hive catalog in Presto for it to query data in S3. If you haven\u2019t, please take a look at my blog Presto with Kubernetes and S3 \u2014 Deployment.", "Create a directory in S3 to store the CSV file. We can use any S3 client to create a S3 directory, here I simply use the hdfs command because it is available on the Hive Metastore node as part of the Hive catalog setup in the above blog.", "Run the below command from the Hive Metastore node. Change bucket name to match your environment. Note I specified s3a:// as the directory path schema so that hdfs command creates the directory on S3 instead of HDFS.", "Upload the CSV file to S3 under the directory we just created. Any S3 client should work, I use s5cmd, a very fast S3 client, to upload the CSV file into my S3 directory. Here I use FlashBlade S3, so I specified endpoint-url to my FlashBlade data VIP.", "In order to query data in S3, I need to create a table in Presto and map its schema and location to the CSV file.", "Create a new schema for text data using Presto CLI.", "Create an external table for CSV data. You can create many tables under a single schema. Notes:", "Now I can query the CSV data.", "At this point, I can connect Tableau to visualise data in the Presto table. However, because CSV format table only supports VARCHAR data type, it may expose limits to Tableau. If this is the case, convert CSV to Parquet or ORC format (see below). Parquet or ORC tables generally have better performance than Text/CSV tables.", "This is an optional task, but it is recommended if the data will be queried multiple times. By converting text data into analytics optimised format in Parquet or ORC, it does not only improve query performance, but also reduce server and storage resource consumption.", "Presto is good for simple conversions that can be done in SQL. For those with complex business logics that cannot be easily done with SQL (e.g., requires Java/Python programming), it is better to use Apache Spark. In this example, I simply convert text to Parquet format without introducing any complex business logic, so I will use Presto for the conversion.", "A common practice for managing data in Presto is to use different schemas for your raw text (CSV/TSV) tables and optimised (Parquet/ORC) tables. So I will create a new schema nyc_parq for the Parquet table.", "Create a S3 directory for the new schema. Change bucket name to match your environment.", "Create the nyc_parq schema in Presto CLI.", "Create a Parquet table, convert CSV data to Parquet format. You can change the SELECT cause to add simple business and conversion logic.", "Depending on the data size, this conversion may take time. Once it is done, I can query the Parquet data.", "Confirm the Parquet table\u2019s schema. Note columns are with desired type in this table.", "Finally, I configure my analytics application / Tableau to use the optimised nyc_parq schema and Parquet tables.", "As data size grows larger (e.g., over TBs), organising data in a way that is optimal for query performance becomes more important. Using Parquet or ORC formant is one optimisation, there are others such as:", "These topics are not Presto specific, they apply to most storages and query engines, including S3 and Presto. The details of these topics are beyond the scope of this blog. Stay tuned on my blogs.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Software & solutions engineer, big data and machine learning, jogger, hiker, traveler, gamer."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb0d50bc773c9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://uprush.medium.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": ""}, {"url": "https://uprush.medium.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Yifeng Jiang"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F98df5da871eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&user=Yifeng+Jiang&userId=98df5da871eb&source=post_page-98df5da871eb----b0d50bc773c9---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://data.cityofnewyork.us/Transportation/2018-Yellow-Taxi-Trip-Data/t29m-gskq", "anchor_text": "NewYork City 2018 Yellow Taxi Trip Dataset"}, {"url": "https://medium.com/swlh/presto-with-kubernetes-and-s3-deployment-4e262849244a", "anchor_text": "Presto with Kubernetes and S3 \u2014 Deployment"}, {"url": "https://github.com/peak/s5cmd", "anchor_text": "s5cmd"}, {"url": "https://www.purestorage.com/products/flashblade.html", "anchor_text": "FlashBlade"}, {"url": "http://192.168.170.12:80", "anchor_text": "http://192.168.170.12:80"}, {"url": "https://help.tableau.com/current/pro/desktop/en-us/examples_presto.htm", "anchor_text": "visualise"}, {"url": "https://medium.com/tag/presto?source=post_page-----b0d50bc773c9---------------presto-----------------", "anchor_text": "Presto"}, {"url": "https://medium.com/tag/s3?source=post_page-----b0d50bc773c9---------------s3-----------------", "anchor_text": "S3"}, {"url": "https://medium.com/tag/csv?source=post_page-----b0d50bc773c9---------------csv-----------------", "anchor_text": "Csv"}, {"url": "https://medium.com/tag/sql?source=post_page-----b0d50bc773c9---------------sql-----------------", "anchor_text": "Sql"}, {"url": "https://medium.com/tag/hive?source=post_page-----b0d50bc773c9---------------hive-----------------", "anchor_text": "Hive"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&user=Yifeng+Jiang&userId=98df5da871eb&source=-----b0d50bc773c9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&user=Yifeng+Jiang&userId=98df5da871eb&source=-----b0d50bc773c9---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fb0d50bc773c9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----b0d50bc773c9---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----b0d50bc773c9--------------------------------", "anchor_text": ""}, {"url": "https://uprush.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://uprush.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Yifeng Jiang"}, {"url": "https://uprush.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "413 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F98df5da871eb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&user=Yifeng+Jiang&userId=98df5da871eb&source=post_page-98df5da871eb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F83afa5c91d88&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fload-and-query-csv-file-in-s3-with-presto-b0d50bc773c9&newsletterV3=98df5da871eb&newsletterV3Id=83afa5c91d88&user=Yifeng+Jiang&userId=98df5da871eb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}