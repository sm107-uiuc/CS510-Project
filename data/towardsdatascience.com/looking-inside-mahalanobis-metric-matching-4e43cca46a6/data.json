{"url": "https://towardsdatascience.com/looking-inside-mahalanobis-metric-matching-4e43cca46a6", "time": 1683008347.4099698, "path": "towardsdatascience.com/looking-inside-mahalanobis-metric-matching-4e43cca46a6/", "webpage": {"metadata": {"title": "Looking Inside Mahalanobis Metric Matching | by Dr. Lucky | Towards Data Science", "h1": "Looking Inside Mahalanobis Metric Matching", "description": "My previous post shows how the propensity score matching can be implemented using 13 lines of R codes. Though those codes, you can see that matching is much about data pre-processing. The idea is to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@bowenchen_9406/matching-estimator-is-powerful-and-simple-82350f08515a", "anchor_text": "post", "paragraph_index": 0}, {"url": "https://medium.com/@bowenchen_9406/matching-estimator-is-powerful-and-simple-82350f08515a", "anchor_text": "post", "paragraph_index": 2}, {"url": "https://github.com/cbw1243/rfuncs/blob/master/do1.R", "anchor_text": "here", "paragraph_index": 2}], "all_paragraphs": ["My previous post shows how the propensity score matching can be implemented using 13 lines of R codes. Though those codes, you can see that matching is much about data pre-processing. The idea is to find control units that are comparable to the treated units, so we can attribute the differences in the outcome between treatment groups to the treatment with more confidence. Besides, I want to argue that matching is, in fact, simple, so you should not be terrified by it.", "Today, I look into a popular alternative to propensity score matching: Mahalanobis Metric (MM) matching. The two matching methods are different mainly in that MM matching uses the Mahalanobis metric to find matches instead of propensity scores. I will show you step-by-step that how MM matching is done in practice using the simplest R codes. These steps are embedded in programs that does matching, but they are often invisible.", "Similar to my previous post, I simulate for a small data set for the data exercise. You can find the R codes for generating the simulated data from here. The simulated data have two continuous covariates (W1, W2), a binary treatment (A), and a continuous outcome (Y). For simplicity, I generate 10 data points only, and 4 show up as treated units.", "The codes for generating the data are:", "Step 1. Define a function to calculate Mahalanobis distance", "The math formula to calculate Mahalanobis Distance is: MD = (X1 - X2)\u2019S(X1 - X2), where X1, X2 are vectors of covariates (W1 and W2 in our case) for a treated and a control unit, respectively. S is inverse of sample covariance of data. Note that we can calculate distance for each pair (treated versus control). We do not calculate distance between treated units, because we are matching between treatment groups, not within the same treatment group.", "Let\u2019s define a function that can calculate MD for one pair of observation units. Then we can loop it over all pairs. The function is given below. Each line of code is self-explanatory, so I do not provide any more discussions here.", "Step 2. Calculate Mahalanobis distance for each treated/control pair", "Now we calculate MD for each treated/control pair using the codes below:", "Note that the last mapply function is simply looping over the calculation of MD (defined by mahalDist) over all possible treated/control pairs based on their row numbers. Below reports the output of mdist, which says that, for example, the MD between the treated unit located at row 1 and the control unit located at row 3 is 12.12. It seems that this value is the largest among all MDs associated with the treated unit located at row 1. The smallest MD is 1.67 associated with the control unit located at row 6.", "Step 3. Look for the best matches with the lowest distances", "Since the sample size is low, we can easily find the best matches (with the lowest MD) for each treated unit. But below are some codes to automatically find the best matches:", "You can see that four control units with the lowest MD are matched to four treated units. The last pair (i.e., treated unit at row 7\u2013 control unit at row 9) is the closest pair, while the first part (i.e., treat unit at row 1\u2013 control unit at row 6) is the most distinct pair, relatively speaking. Indeed, as shown in figure 1, the treated unit at row 1 happens to have the lowest W1 and highest W2. Therefore, it would be hard to find a good match for it (too different to others).", "After three steps with a handful of codes, we have completed the data pre-processing based on Mahalanobis metric matching. One can do further analyses with the matched data. I hope that you have enjoyed the reading!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I try to understand the world through data. Dog lover."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4e43cca46a6&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@lucky0712?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucky0712?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Dr. Lucky"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1691fbe36506&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&user=Dr.+Lucky&userId=1691fbe36506&source=post_page-1691fbe36506----4e43cca46a6---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@polarmermaid?utm_source=medium&utm_medium=referral", "anchor_text": "Anne Nyg\u00e5rd"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://medium.com/@bowenchen_9406/matching-estimator-is-powerful-and-simple-82350f08515a", "anchor_text": "post"}, {"url": "https://medium.com/@bowenchen_9406/matching-estimator-is-powerful-and-simple-82350f08515a", "anchor_text": "post"}, {"url": "https://github.com/cbw1243/rfuncs/blob/master/do1.R", "anchor_text": "here"}, {"url": "https://medium.com/tag/data-science?source=post_page-----4e43cca46a6---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/causal-inference?source=post_page-----4e43cca46a6---------------causal_inference-----------------", "anchor_text": "Causal Inference"}, {"url": "https://medium.com/tag/economics?source=post_page-----4e43cca46a6---------------economics-----------------", "anchor_text": "Economics"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&user=Dr.+Lucky&userId=1691fbe36506&source=-----4e43cca46a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&user=Dr.+Lucky&userId=1691fbe36506&source=-----4e43cca46a6---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F4e43cca46a6&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----4e43cca46a6---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4e43cca46a6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----4e43cca46a6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----4e43cca46a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucky0712?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@lucky0712?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Dr. Lucky"}, {"url": "https://medium.com/@lucky0712/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "49 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1691fbe36506&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&user=Dr.+Lucky&userId=1691fbe36506&source=post_page-1691fbe36506--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff786c1d6021e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flooking-inside-mahalanobis-metric-matching-4e43cca46a6&newsletterV3=1691fbe36506&newsletterV3Id=f786c1d6021e&user=Dr.+Lucky&userId=1691fbe36506&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}