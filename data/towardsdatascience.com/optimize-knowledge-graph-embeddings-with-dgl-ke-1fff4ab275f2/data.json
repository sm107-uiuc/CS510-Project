{"url": "https://towardsdatascience.com/optimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2", "time": 1683009288.1798441, "path": "towardsdatascience.com/optimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2/", "webpage": {"metadata": {"title": "Optimize Knowledge Graph Embeddings with DGL-KE | by Balaji Kamakoti | Towards Data Science", "h1": "Optimize Knowledge Graph Embeddings with DGL-KE", "description": "Authors: Cyrus Vahid, Principal Solutions Engineer, Da Zheng, George Karypis and Balaji Kamakoti: AWS AI In our previous post, we introduced the concept of Knowledge Graph Embeddings (KGEs) and two\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@bkamakot/introduction-to-knowledge-graph-embedding-with-dgl-ke-77ace6fb60ef", "anchor_text": "previous post", "paragraph_index": 1}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 2}, {"url": "https://www.dgl.ai/", "anchor_text": "Deep Graph Library", "paragraph_index": 2}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 3}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 7}, {"url": "https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/", "anchor_text": "resource", "paragraph_index": 8}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 9}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 12}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 13}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 13}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 14}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 14}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 15}, {"url": "https://www.microsoft.com/en-us/download/details.aspx?id=52312", "anchor_text": "Freebase dataset", "paragraph_index": 15}, {"url": "https://docs.conda.io/en/latest/", "anchor_text": "conda", "paragraph_index": 16}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 17}, {"url": "https://www.dgl.ai/pages/start.html", "anchor_text": "DGL", "paragraph_index": 19}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch", "paragraph_index": 19}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE", "paragraph_index": 20}, {"url": "https://www.dgl.ai/", "anchor_text": "DGL", "paragraph_index": 20}], "all_paragraphs": ["Authors: Cyrus Vahid, Principal Solutions Engineer, Da Zheng, George Karypis and Balaji Kamakoti: AWS AI", "In our previous post, we introduced the concept of Knowledge Graph Embeddings (KGEs) and two popular models used to generate them in DGL-KE. This blog outlines how DGL-KE accelerates KGE training. We also share an example that readers can run on their local machines.", "To recap, DGL-KE is a high performance, easy-to-use, and scalable toolkit to generate knowledge graph embeddings from large graphs. It is built on top of the Deep Graph Library (DGL), an open-source library to implement Graph Neural Networks (GNN).", "As illustrated in the picture above, DGL-KE implements some of the most popular knowledge embedding models such as TransE, TransR, RotateE, DistMulti, RESCAL, and ComplEx.", "Though there are a variety of models available to generate embeddings, training these embeddings is either time consuming or infeasible for large graphs because of two main reasons:", "The rest of this blog explores these optimizations implemented in DGL-KE to address these challenges. But before we explore these optimizations, let\u2019s review the hardware infrastructure required to train KGEs.", "Training KGEs on large graphs requires large amounts of hardware resources, such as multicore CPU machines, multi-GPU machines and a cluster of machines. The three main configurations supported today are:", "DGL-KE provides unified software optimizations for all of these hardware configurations to train KGE efficiently.", "For all hardware configurations, the training process starts with a preprocessing step to partition a KG and follows with mini-batch training. You can learn more about mini-batch training using this resource. The partitioning step assigns a disjoint set of triplets in a KG to a device. Mini-batch training executes the following steps:", "DGL-KE deploys optimizations on each of these steps to accelerate training.", "During the training process, mini-batch computation on each device needs to access the data associated with the KG \u2014 the entity and relation embeddings. Placing this data at the right location, and coordinating its access and updates are essential to DGL-KE\u2019s performance.", "The figure below graphically illustrates these data distributions are executed.", "DGL-KE constructs a large number of negative samples for each triplet. Sampling is always performed using the system CPU. If negative samples are constructed independently, it will result in accessing a large number of entities across hardware. To reduce data communication, we jointly sample negative edges for edges in a batch so that the number of entities accessed in a batch does not increase dramatically by negative sampling. Simply performing a uniform sample from heads and tails and ignoring the degree of each node, the number of edges that are connected to a node, results in easy negative samples. As nodes with higher degree require more data to discover more patterns about them, we perform negative sampling proportional to degree of nodes. This results in creation of hard negative samples. These hard negative samples often improve the quality of KG embeddings.", "The larger the ratio of actual relations in a KG relative to the batch size (\u22481000\u22481000), the sparser the relation embedding. DGL-KE employs sparse relation embedding reads and updates for communication efficiency. In multi-GPU training, DGL-KE partitions relations into groups and assigns a group to a GPU to reduce data communication between CPU and GPUs.", "DGL-KE uses CPUs to sample mini-batches and loads entity embeddings before sending them to GPUs for computing gradients. Once a GPU has finished computing the embeddings\u2019 gradients, it sends them to the CPU to update the corresponding embeddings. This means if a process runs serially, the GPU has to wait for the CPU to create a mini-batch and write gradients to the embeddings. To prevent GPU idling, DGL-KE overlaps mini-batch creation and gradient updates in CPUs with mini-batch computation in GPUs.", "Due to relation partitioning, DGL-KE keeps relation embeddings in GPUs and updates them separately from the entity embeddings in CPU. Updating entity embeddings is offloaded to a dedicated process per trainer. This optimization provides a 40% speedup for many KGE models on the Freebase dataset.", "If you have conda installed on your machine, create an environment using the following command:", "Install the appropriate version of PyTorch on your machine. If you are using Mac, you can use", "I am using an Ubuntu machine with 4 GPUs and CUDA 10.0, so I am running:", "First, we set the DGL\u2019s backend to be PyTorch. We then created a training task using dglke-train. This training task uses TransE with L2 loss, downloads FB15k dataset. We then instructed the model to build k=200k=200 negative samples with \u03b3=400 for embedding dimension, 1000 for the mini-batch size (batch_size 1000), and with batch_size_eval=16 as hyper-parameter used for the test.", "Learn more about DGL-KE and DGL, and stay tuned for additional examples.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1fff4ab275f2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bkamakot?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bkamakot?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Balaji Kamakoti"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad11aea5ba40&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&user=Balaji+Kamakoti&userId=ad11aea5ba40&source=post_page-ad11aea5ba40----1fff4ab275f2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@bkamakot/introduction-to-knowledge-graph-embedding-with-dgl-ke-77ace6fb60ef", "anchor_text": "previous post"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://www.dgl.ai/", "anchor_text": "Deep Graph Library"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/", "anchor_text": "resource"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://www.microsoft.com/en-us/download/details.aspx?id=52312", "anchor_text": "Freebase dataset"}, {"url": "https://docs.conda.io/en/latest/", "anchor_text": "conda"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://www.dgl.ai/pages/start.html", "anchor_text": "DGL"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://www.dgl.ai/pages/start.html", "anchor_text": "DGL"}, {"url": "https://pytorch.org/", "anchor_text": "PyTorch"}, {"url": "https://github.com/awslabs/dgl-ke", "anchor_text": "DGL-KE"}, {"url": "https://www.dgl.ai/", "anchor_text": "DGL"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----1fff4ab275f2---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1fff4ab275f2---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/graph?source=post_page-----1fff4ab275f2---------------graph-----------------", "anchor_text": "Graph"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----1fff4ab275f2---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/embedding?source=post_page-----1fff4ab275f2---------------embedding-----------------", "anchor_text": "Embedding"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&user=Balaji+Kamakoti&userId=ad11aea5ba40&source=-----1fff4ab275f2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&user=Balaji+Kamakoti&userId=ad11aea5ba40&source=-----1fff4ab275f2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1fff4ab275f2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1fff4ab275f2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1fff4ab275f2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bkamakot?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bkamakot?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Balaji Kamakoti"}, {"url": "https://medium.com/@bkamakot/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "90 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fad11aea5ba40&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&user=Balaji+Kamakoti&userId=ad11aea5ba40&source=post_page-ad11aea5ba40--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F775018e94b6f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Foptimize-knowledge-graph-embeddings-with-dgl-ke-1fff4ab275f2&newsletterV3=ad11aea5ba40&newsletterV3Id=775018e94b6f&user=Balaji+Kamakoti&userId=ad11aea5ba40&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}