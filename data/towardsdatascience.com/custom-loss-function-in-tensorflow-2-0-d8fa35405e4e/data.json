{"url": "https://towardsdatascience.com/custom-loss-function-in-tensorflow-2-0-d8fa35405e4e", "time": 1683002615.986136, "path": "towardsdatascience.com/custom-loss-function-in-tensorflow-2-0-d8fa35405e4e/", "webpage": {"metadata": {"title": "Custom loss function in Tensorflow 2.0 | by Sunny Guha | Towards Data Science", "h1": "Custom loss function in Tensorflow 2.0", "description": "The first hitch I ran into when I was learning to write my own layers in Tensorflow (TF) was how to write a loss function. TF contains almost all the loss functions you\u2019ll ever need but sometimes\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/sol0invictus/Blog_stuff/blob/master/custom%20loss/high_level_keras.py", "anchor_text": "link", "paragraph_index": 6}, {"url": "https://github.com/sol0invictus/Blog_stuff/blob/master/custom%20loss/low_level_tf.py", "anchor_text": "link", "paragraph_index": 15}, {"url": "https://www.tensorflow.org/guide/keras/train_and_evaluate", "anchor_text": "TensorFlow documentation", "paragraph_index": 16}], "all_paragraphs": ["The first hitch I ran into when I was learning to write my own layers in Tensorflow (TF) was how to write a loss function. TF contains almost all the loss functions you\u2019ll ever need but sometimes that is not enough. When implementing deep reinforcement learning or constructing your own models you might need to write your loss functions. This is exactly what this blog post intends to elucidate. We will write a loss function in two different ways:", "For both cases, we will construct a simple neural network to learn squares of numbers. The network will take in one input and will have one output. The network is by no means successful or complete. It is highly rudimentary and is meant to only demonstrate the different loss function implementations.", "Let's look at a high-level loss function. We assume that we have already constructed a model using tf.keras. A custom loss function for the model can be implemented in the following way:", "First things first, a custom loss function ALWAYS requires two arguments. The first one is the actual value (y_actual) and the second one is the predicted value via the model (y_model). It is important to note that both these are TF Tensors and not Numpy arrays. Inside the function you free to calculate loss however you want to calculate it, with the exception that the return value needs to be a TF scalar.", "In the above example, I have calculated squared error loss using the tensorflow.keras.backend.square(). However, it is not necessary to use Keras backend, and any valid tensor operation will do just fine.", "Once the loss function is computed we need to pass it in the model compile call.", "The complete code can be found here: link", "In the previous part, we looked at a tf.keras model. What if we wanted to write a network from scratch in TF, how would we implement the loss function in this case? This will be a low level implementation of the model. Let us again write the same model. The complete implementation is given below,", "Ufff! that\u2019s a lot of code. Let's unpack the information.", "__init__(): The constructor constructs the layers of the model (without returning a tf.keras.model.", "run(): Runs the model for a given input by passing the input manually through layers and returns the output of the final layer.", "get_loss(): computes the loss and returns it as a TF Tensor value", "Till now it seemed pretty easy to implement loss since we were dealing directly with models, but now we need to perform learning by auto-differentiation. This is implemented in TF 2.0 using tf.GradientTape(). The function get_grad() computes the gradient wrt to the variables of the layers. It is important to note that all the variables and arguments are TF Tensors.", "network_learn(): We apply the gradient descent step in this function using the gradients obtained from the get_grad() function.", "With everything written out, we can implement the training loop as following,", "Full code can be found here: link", "In this post, we have seen both the high-level and the low-level implantation of a custom loss function in TensorFlow 2.0. Knowing how to implement a custom loss function is indispensable in Reinforcement Learning or advanced Deep Learning and I hope that this small post has made it easier for you to implement your own loss function. For more details on custom loss functions, we refer to the reader to the TensorFlow documentation.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "I am currently pursuing PhD in Theoretical Physics. In my spare time I like to dabble in Deep Learning and Reinforcement Learning."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd8fa35405e4e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@eosaten?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eosaten?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Sunny Guha"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fed10d9f9fd04&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&user=Sunny+Guha&userId=ed10d9f9fd04&source=post_page-ed10d9f9fd04----d8fa35405e4e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/sol0invictus/Blog_stuff/blob/master/custom%20loss/high_level_keras.py", "anchor_text": "link"}, {"url": "https://github.com/sol0invictus/Blog_stuff/blob/master/custom%20loss/low_level_tf.py", "anchor_text": "link"}, {"url": "https://www.tensorflow.org/guide/keras/train_and_evaluate", "anchor_text": "TensorFlow documentation"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----d8fa35405e4e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----d8fa35405e4e---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----d8fa35405e4e---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/loss-function?source=post_page-----d8fa35405e4e---------------loss_function-----------------", "anchor_text": "Loss Function"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&user=Sunny+Guha&userId=ed10d9f9fd04&source=-----d8fa35405e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&user=Sunny+Guha&userId=ed10d9f9fd04&source=-----d8fa35405e4e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd8fa35405e4e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d8fa35405e4e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d8fa35405e4e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eosaten?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@eosaten?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Sunny Guha"}, {"url": "https://medium.com/@eosaten/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "87 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fed10d9f9fd04&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&user=Sunny+Guha&userId=ed10d9f9fd04&source=post_page-ed10d9f9fd04--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc5518cc5e0c7&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fcustom-loss-function-in-tensorflow-2-0-d8fa35405e4e&newsletterV3=ed10d9f9fd04&newsletterV3Id=c5518cc5e0c7&user=Sunny+Guha&userId=ed10d9f9fd04&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}