{"url": "https://towardsdatascience.com/beat-the-stock-market-with-machine-learning-d9432ea5241e", "time": 1683004075.5863218, "path": "towardsdatascience.com/beat-the-stock-market-with-machine-learning-d9432ea5241e/", "webpage": {"metadata": {"title": "BEAT THE STOCK MARKET WITH MACHINE LEARNING: the Lazy Strategy | Towards Data Science", "h1": "Find stocks worth buying with Machine Learning", "description": "Is it possible to have a machine learning model learn the differences between stocks that perform well and those that don't, and then leverage this knowledge in order to predict which stock will be worth buying? Moreover, is it possible to achieve this simply by looking at financial indicators found in the 10-K filings?"}, "outgoing_paragraph_urls": [{"url": "https://financialmodelingprep.com/developer/docs/", "anchor_text": "https://financialmodelingprep.com/developer/docs/", "paragraph_index": 7}, {"url": "https://github.com/CNIC92/beat-the-stock-market/tree/master/All%20tickers%20and%20Indicators", "anchor_text": "https://github.com/CNIC92/beat-the-stock-market/tree/master/All%20tickers%20and%20Indicators", "paragraph_index": 15}, {"url": "https://scikit-learn.org/stable/modules/model_evaluation.html", "anchor_text": "https://scikitlearn.org/stable/modules/model_evaluation.html", "paragraph_index": 31}], "all_paragraphs": ["The algorithmic trading space is buzzing with new strategies. Companies have already spent billions (and keep investing) in infrastructures and R&D to be able to jump ahead of the competition and beat the market. Still, it is well acknowledged that the buy & hold strategy is able to outperform many of the algorithmic strategies, especially in the long-run. However, finding value in stocks is an art that very few mastered, can an algorithm be trained to do that?", "This article contains all the steps required to build a dataset of financial data for a lot of stocks and to analyze it with different machine learning models. You will see throughout the article that this modus-operandi does not leverage historic ticker price data, but financial indicators found in the 10-K filings that each publicly traded company releases yearly. In particular, for the sake of this article, we will use the financial data from 2018 in order to make some fictitious predictions regarding the performance of stocks during 2019 (meaning from the first trading day of Jan \u201819 to the last trading day of Dec \u201819).", "Before jumping in the code, it must be crystal clear is that this article does not present an actual trading strategy that you can use:", "What this article wants to explore is the possibility of having ML algorithms recognise stocks that grew in value by training and feeding them with the numbers reported in the financial statements. To check whether or not this is true, the predictions made by the ML algorithms in the testing phase (which can be considered as fictitious trades) will be compared to the S&P 500 and Dow Jones benchmarks.", "Finally, we will not buy and sell the stocks multiple times during the year: we will use a lazy strategy, buying stocks at the beginning of the year (2019 in this case) and then selling them at the end of the year, hopefully for a profit.", "With that being said, let\u2019s jump right into the fun part.", "If you are familiar with machine learning in Python you should already know all the packages and library that we will be using. If you are new to the field don\u2019t be scared, you can find a lot of information and tutorials for each package and library. All packages used are easily retrievable and can be installed with either pip or conda depending on your Python setup (Python 3.7.5 has been used here).", "An internet connection is required in order to scrape the data from the web (we will use the excellent free API https://financialmodelingprep.com/developer/docs/ and the well knownpandas_datareader).", "We will also need a few helper functions in order to streamline the code:", "First, we need to get a list of stocks that will be used to build the dataset. Since there are thousands of stocks whose information can be scraped online, I decided to simply pull the whole list of available stocks on Financial Modeling Prep API.", "The list comprehends a total of more than 7k stocks, which clearly spans more than one sector. Indeed, each company belongs to its sector (Technology, Healthcare, Energy, \u2026), which in turn may be characterized by certain seasonalities, macro-economic trends and so on. As of now, I decided to focus on the Technology sector: this means that from the complete list of available stocks available_tickers I only keep those whose sector is equal to Technology. This operation is quite straight forward thanks to the power of pandas library.", "So, the list tickers_tech will contain all the available stocks, on Financial Modeling Prep API, belonging to the Technology sector.", "The price variation of each stock listed in tickers_tech during 2019 will be used as metric to distinguish between stocks worth buying and those that are not (because they decrease their value, for reasons we don\u2019t really care about). So, we need to:", "For the stocks in D, we now need to find the values of the indicators that will become the input data to the classification models. We leverage once again the FinancialModelingPrep API.", "First we load the indicators.tx file (available in the repository). As explained the the README document, a plethora of financial indicators are being scraped. I decided to perform a brute force of all the available indicators from the FinancialModelingPrep API, and then I will worry about cleaning and preparing the dataset for the models. The table below summarizes the quantity of financial indicator available for each category.", "In total, 224 indicators are available. However, since there are some duplicates, the actual number of indicators in indicators.txtis 221 (not counting the date). You can find the indicators.txt file here: https://github.com/CNIC92/beat-the-stock-market/tree/master/All%20tickers%20and%20Indicators", "As of now we have listed the stocks that belong to the Technology sector, and we have also listed their 2019 price variation. It is time to scrape the financial indicators that will later be used as input features to out classification models.", "The scraping will once again be performed thanks to the Financial Modeling Prep API. This process is quite time-consuming since it is required to pull a lot of data iteratively.", "Furthermore, it is important to keep in mind that:", "In the end, what we want to obtain is a dataframe DATA where the rows correspond to the stocks for which the data has been found (actual_tickers) and the columns correspond to the financial indicators (indicators).", "The preparation of the dataset is somewhat an art form. I limited my actions to the application of the common practices, such as:", "For instance, in this specific case there are an average of 84 0-values per column, with a standard deviation of 140. So I decided to remove from the dataframe all those columns where the occurrences of 0-values is higher than 20 (20 being about 3.1% of the total number of rows of the dataset).", "At the same time, there is an average of about 37 nan entries per column, with a standard deviation of about 86. So I decided to remove from the dataframe all those columns where the occurrences of nan entries is higher than 15 (15 being about 2.4% of the total number of rows of the dataset). Then, the remaining nan entries have been filled with the average value of the column.", "At the end of the cleaning process, the number of columns of DATA has decreased from 221 to 108, a 50% reduction. While certainly some of the discarded indicators were useless due to the lack of data, it is possible that useful data has been lost in this process too. However, it must be considered that we need useful data across all stocks in the dataset, so I think it is acceptable to discard those indicators (columns) that may be relevant only to a small portion of the dataset.", "Finally, it is required to classify each sample. For each stock it has already been computed the difference in trading price between the first trading day on January 2019 and the last trading day on December 2019 (dataset D). If this difference is positive, then that stock will belong to class 1, which is a BUY signal. On the contrary, if the difference in price is negative, the stock will be classified as a 0, which is an IGNORE signal (do not buy). A quick recap is found in the table below.", "So, this array of 1 and 0 values will be appended as the last column of the dataframe DATA.", "This concludes the section 1 of this article. We have built a dataset containing both relevant financial indicators from 2018 and the binary classes which come from the price action of the stocks during 2019. In section 2, we will focus on the implementation of a few machine learning algorithms in order to make predictions about the stocks, and try to beat the market!", "Before having fun running experiments with different machine learning algorithms, we must apply the finishing touches to the dataset, which comprehend:", "So, for what concerns the split it into training and testing, 80% of the available data in DATA will be used to train the algorithms, while the remaining 20% will be used to test the ML algorithms. Note the parameter stratify used in order to keep the same class-ratio between training and testing datasets. From the train_split and test_split we extract both input data X_train, X_test and output target data y_train, y_test. A sanity check is performed afterwards.", "For what concerns the standardization of the data, we leverage the StandardScaler() available from scikit-learn. It is important to use the same coefficients when standardizing both training and testing data: for this reason we first fit the scaler to X_train, and then apply it it both X_train and X_test via the method .transform().", "The first classification algorithm we will run is the support vector machine. A GridSeachCV is performed in order to tune some hyper-parameters (kernel, gamma, C). The required number of cross-validations is set to 5. We want to achieve maximum weighted precision, in order to minimize the number of false positives.", "The results are not too bad. We can see, as shown below, that we have a weighted precision of 71.3%. If you read carefully, you may have noticed that the scoring parameter is set equal to the metric precision_weighted. This has been done in order to optimize the algorithms with respect to their precision (to not be confused with accuracy!) and weighted, because we don\u2019t have the same number of sample for both classes (buy-worthy stocks and not buy-worthy stocks). For more info about this and others scoring parameters you can check the docs here https://scikitlearn.org/stable/modules/model_evaluation.html.", "The second classification algorithm we will run is the random forest. A GridSeachCV is performed in order to tune some hyper-parameters (n_estimators, max_features, max_depth, criterion). The required number of cross-validations is set to 5. We want to achieve maximum weighted precision, in order to minimize the number of false positives.", "We can see, as shown below, that this algorithm outperforms the support vector machine by a few percent points, since we have a weighted precision of 72.4%.", "The third classification algorithm we will run is the extreme gradient boosting. A GridSeachCV is performed in order to tune some hyper-parameters (learning_rate, max_depth, n_estimators). The required number of cross-validations is set to 5. We want to achieve maximum weighted precision, in order to minimize the number of false positives.", "This algorithm underperfoms both the support vector machine and the random forest classifier by a few percent points, since we have a weighted precision of 69.7%.", "The fourth classification algorithm we will run is the multi-layer perceptron (feed-forward neural network). A GridSeachCV is performed in order to tune some hyper-parameters (hidden_layer_sizes, activation, solver). The required number of cross-validations is set to 5. We want to achieve maximum weighted precision, in order to minimize the number of false positives.", "This algorithm is the best yet, since it outperforms all the previously tested algorithms. The MLP yields to a weighted precision of 73%.", "Now that 4 classification algorithms have been trained, we must test them and compare their performance with respect to each other and to what is considered the benchmark in this field (S&P 500, DOW JONES). Indeed, we don\u2019t limit ourselves to the comparison of their testing accuracies: we want to understand which algorithm leads to the best return on investment (ROI). To do this, we must first get the 2019 price variations contained inpvar of only those stocks that belong to the testing dataset (which we did not use yet!).", "Now, we build a new dataframe df1 in which, for each tested stock, we collect all the predicted classes from each model (it is reminded that the two classes are 0=IGNORE, 1=BUY).", "If the model predicts class 1, we proceed to buy 100 USD worth of that stock; otherwise, we ignore the stock.", "Finally, we build a compact dataframe MODELS_COMPARISON in which we collect the main information required to perform the comparison between the classification models and the benchmarks (S&P 500, DOW JONES).", "Leveraging the dataframe df1, we can easily compute gains and losses for each model (net_gain_, percent_gain_).", "Since we miss the data from the benchmarks, we quickly exploit the custom function get_price_var in order to get the percent price variation for both S&P 500 (^GSPC) and DOW JONES (^DJI) for the year 2019.", "From the dataframe MODELS_COMPARISON, it is possible to see that:", "So, this example proves, at least as proof-of-concept, that it is possible to find useful information in the 10-K filings that the publicly traded companies release. The financial information can be used to train machine learning models that learn to recognize buy-worthy stocks.", "For what concerns a more traditional comparison between the performance of the ML models implemented, it is possible to analyze the classification_report.", "Looking carefully, it is fair to ask: why does the RF returns the highest ROI if it is the method with the lowest weighted accuracy? This happens because:", "However, all this means that we miss a lot of potential stocks to be bought, since RF leads to a high number of false negatives. Indeed, it is easy to see that RF has the lowest recall value for the BUY class (43%), meaning that we only find 43% of the total stocks that should have been classified as BUY-worthy.", "This concludes section 2 of this article. Hopefully you find it useful and inspiring. For more about Financial Modeling Prep API, codes and historical data check out the links below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "MSc. Mechanical Engineering \u2014 Advanced Mechanical Design"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd9432ea5241e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nicolascarbone92?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nicolascarbone92?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Nicolas Carbone"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F35c78ede5d99&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&user=Nicolas+Carbone&userId=35c78ede5d99&source=post_page-35c78ede5d99----d9432ea5241e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@markusspiske?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Markus Spiske"}, {"url": "https://unsplash.com/s/photos/stock-market?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://financialmodelingprep.com/developer/docs/", "anchor_text": "https://financialmodelingprep.com/developer/docs/"}, {"url": "https://financialmodelingprep.com", "anchor_text": "https://financialmodelingprep.com"}, {"url": "https://github.com/CNIC92/beat-the-stock-market/tree/master/All%20tickers%20and%20Indicators", "anchor_text": "https://github.com/CNIC92/beat-the-stock-market/tree/master/All%20tickers%20and%20Indicators"}, {"url": "https://scikit-learn.org/stable/modules/model_evaluation.html", "anchor_text": "https://scikitlearn.org/stable/modules/model_evaluation.html"}, {"url": "https://financialmodelingprep.com/developer/docs/", "anchor_text": "Free Stock API and Financial Statements API - FMP APIThis documentation includes a financial statements API, a free stock API and a historical quotes API. Find all\u2026financialmodelingprep.com"}, {"url": "https://github.com/CNIC92/beat-the-stock-market", "anchor_text": "CNIC92/beat-the-stock-marketThis project begins from a question I asked myself during the 2019 winter holidays: it is possible to understand which\u2026github.com"}, {"url": "https://www.kaggle.com/cnic92/200-financial-indicators-of-us-stocks-20142018", "anchor_text": "200+ Financial Indicators of US stocks (2014-2018)Try to predict stocks' future performance leveraging 200+ financial indicatorswww.kaggle.com"}, {"url": "https://medium.com/tag/financial-statement-api?source=post_page-----d9432ea5241e---------------financial_statement_api-----------------", "anchor_text": "Financial Statement Api"}, {"url": "https://medium.com/tag/stocks-api?source=post_page-----d9432ea5241e---------------stocks_api-----------------", "anchor_text": "Stocks Api"}, {"url": "https://medium.com/tag/historical-data-api?source=post_page-----d9432ea5241e---------------historical_data_api-----------------", "anchor_text": "Historical Data Api"}, {"url": "https://medium.com/tag/python?source=post_page-----d9432ea5241e---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&user=Nicolas+Carbone&userId=35c78ede5d99&source=-----d9432ea5241e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&user=Nicolas+Carbone&userId=35c78ede5d99&source=-----d9432ea5241e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fd9432ea5241e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----d9432ea5241e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d9432ea5241e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----d9432ea5241e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----d9432ea5241e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nicolascarbone92?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nicolascarbone92?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nicolas Carbone"}, {"url": "https://medium.com/@nicolascarbone92/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "89 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F35c78ede5d99&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&user=Nicolas+Carbone&userId=35c78ede5d99&source=post_page-35c78ede5d99--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F35c78ede5d99%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbeat-the-stock-market-with-machine-learning-d9432ea5241e&user=Nicolas+Carbone&userId=35c78ede5d99&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}