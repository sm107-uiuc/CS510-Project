{"url": "https://towardsdatascience.com/exploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8", "time": 1682995661.738915, "path": "towardsdatascience.com/exploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8/", "webpage": {"metadata": {"title": "Scraping and Exploring The SP500 with R Part 1 | by Bryant Crocker | Towards Data Science", "h1": "Scraping and Exploring The SP500 with R Part 1", "description": "Today I wanted to walk through a quick example combining scraping, calls to the Yahoo finance api, data joining and simple asset analysis using functional programming and tidy iteration concepts. The\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@Psr1/exploring-the-sp500-with-r-part-2-asset-analysis-657d3c1caf60", "anchor_text": "second part of this series", "paragraph_index": 2}, {"url": "https://www.tidyverse.org/", "anchor_text": "tidyverse", "paragraph_index": 4}, {"url": "https://vita.had.co.nz/papers/tidy-data.pdf", "anchor_text": "tidy data", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Map_(higher-order_function)", "anchor_text": "Most programming languages", "paragraph_index": 15}, {"url": "https://softwareengineering.stackexchange.com/questions/179965/functional-programming-compared-to-oop-with-classes", "anchor_text": "classes", "paragraph_index": 16}, {"url": "https://adv-r.hadley.nz/fp.html", "anchor_text": "Advanced R book", "paragraph_index": 17}, {"url": "https://github.com/pysr1/medium_sp500", "anchor_text": "The Code can be found here", "paragraph_index": 29}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 31}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 31}], "all_paragraphs": ["Today I wanted to walk through a quick example combining scraping, calls to the Yahoo finance api, data joining and simple asset analysis using functional programming and tidy iteration concepts.", "I would like to identify which SP500 assets had the highest average return over the last 3 months.", "The making of this chart, asset analysis and answering my question will be covered in the second part of this series.", "In todays analysis I will be using the R programming language. If you have read any of my posts on Linkedin or Medium in the past, you may have noticed that I usually program in python. In general, I prefer the python programming language because it has simpler syntax, wider adoption and is easier to put into production.", "In the R programming language, there is a set of packages that make up what is called the tidyverse. These packages are mostly maintained by engineers and data scientists at Rstudio and provide a simple, integrated and uniform way to manipulate data in R. The tidyverse centers around the idea of tidy data a term coined by Hadley Wickham to describe data where:", "I will make use of several tidyverse libraries todays. In the following chunk I import the libraries that I will be using.", "The next thing that I will do is define a variable with todays date. I then subtract 3 months from todays date. This returns another date object, indicating what day came 3 months before today. I will need this because I want to get the last 3 months of price data for each ticker.", "I\u2019m going to use the tidyquant package to get the financial data for all SP500 tickers. The tidyqunat package\u2019s core function is tq_get(), which can be used to get various information about stocks. If I pass a string containing a ticker name to tq_get(), it will return Open, High, Low, Close or OHLC data. I pass ^GSPC, the SP500\u2019s ticker to the tq_get() function.", "Theres a few things to note above:", "I want OHLC data for all SP500 tickers. In order to do this, I will need a to do a few things:", "Wow! That sounds a little complicated, right? luckily, with R, going about this will be pretty simple. Wikipedia has a table of all 505 SP500 tickers (some companies, like Google, have multiple asset classes) located at this URL:", "To get all the SP500 tickers, we are going to scrape this table, using the rvest package. The rvest package is a simple scraping package in R that is very similar to python\u2019s beautiful soup. In the context of programming, scraping is defined as programmatically collecting human readable content from the internet and webpages.", "In the code below I scrape the wikipedia table and create a vector of all SP500 tickers:", "The hardest part of scraping is figuring out the xpath or css to indicate which html nodes to select. I really don\u2019t know much about html or css, but using Google Chrome I was able to find the correct xpath (more on this below).", "Iterating refers to programmatically repeating a step or sets of steps, a set number of times or until a condition is meant.", "Typically, when we iterate in any programming language, we use a loop, typically a for loop. I will need to iterate over each element in the vector of SP500 tickers and pass it to the function tq_get(). I could do this with a for loop, but using the purrr package is a better idea. Loops in R are slow and hard to read. The purrr package provides a suite of functions for iteration and functional programming that integrate well with the rest of the tidyverse. The core function in purrr in map(). Most programming languages (including my favorite one python) have a map function that serves to apply a function to all elements of an object.", "Functional Programming is a programming paradigm in which functions, as opposed to classes, build the structure and logic of programs. For loops are typically avoided in functional programming. Instead, functions are mapped or applied to lists or other objects.", "As Hadley Wickham stated perfectly in his Advanced R book:", "\u201cIt\u2019s hard to describe exactly what a functional style is, but generally I think it means decomposing a big problem into smaller pieces, then solving each piece with a function or combination of functions. When using a functional style, you strive to decompose components of the problem into isolated functions that operate independently. Each function taken by itself is simple and straightforward to understand; complexity is handled by composing functions in various ways.\u201d", "Let\u2019s look at the difference between iteration in purrr and a for loop with an example. Both of these operations are roughly equivalent:", "First I need to write a function to iterate over or apply to each element of the vector. I cannot simply use tq_get() with map() because it does not return the ticker name as a column of the dataframe. In order to get the ticker with the dataframe, I will use the mutate() function from dplyr to create a new column with the ticker name.", "I then use this function in conjunction with map() to iterate over the list of all symbols. This returns a nested list containing a dataframe for each ticker. I use the dplyr bind_rows() function to bind the dataframes together row-wise, to create one dataframe with all the SP500 tickers.", "I also want this dataframe to contain the information from the wikipedia table, most importantly, the name of the company. This can be achieved by joining the two dataframes by the symbol.", "After joining the data we should do a quick sanity check to make sure that we have all 505 SP500 tickers", "Finally, we can inspect the first few rows of the dataframe, to confirm we have gotten the data we want:", "In this first blog post we have:", "I will answer my original question:", "Which SP500 assets had the highest average return over the last 3 months?", "Disclaimer: In college, I did a project with SP500 data and python. It is against class policy to share this project. While what I am doing here is somewhat similar, I am using a completely different programming language and answering a completely different question. Given my previous statement, I assert that this is not a violation of that courses policy. I intentionally used the R programming language as opposed to python to completely avoid any issues and to respect my former professors wishes.", "The Code can be found here", "This is another great source on scraping that helped a bit when writing the article.", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F56c9498f38e8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@Psr1?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Psr1?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Bryant Crocker"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F93a17102968d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&user=Bryant+Crocker&userId=93a17102968d&source=post_page-93a17102968d----56c9498f38e8---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/", "anchor_text": "https://unsplash.com"}, {"url": "https://medium.com/@Psr1/exploring-the-sp500-with-r-part-2-asset-analysis-657d3c1caf60", "anchor_text": "analysis"}, {"url": "https://medium.com/@Psr1/exploring-the-sp500-with-r-part-2-asset-analysis-657d3c1caf60", "anchor_text": "second part of this series"}, {"url": "https://www.tidyverse.org/", "anchor_text": "tidyverse"}, {"url": "https://vita.had.co.nz/papers/tidy-data.pdf", "anchor_text": "tidy data"}, {"url": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies", "anchor_text": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"}, {"url": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies", "anchor_text": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"}, {"url": "http://twitter.com/id", "anchor_text": "@id"}, {"url": "http://twitter.com/id", "anchor_text": "@id"}, {"url": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies", "anchor_text": "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"}, {"url": "http://twitter.com/id", "anchor_text": "@id"}, {"url": "http://twitter.com/id", "anchor_text": "@id"}, {"url": "https://en.wikipedia.org/wiki/Map_(higher-order_function)", "anchor_text": "Most programming languages"}, {"url": "https://softwareengineering.stackexchange.com/questions/179965/functional-programming-compared-to-oop-with-classes", "anchor_text": "classes"}, {"url": "https://adv-r.hadley.nz/fp.html", "anchor_text": "Advanced R book"}, {"url": "https://medium.com/@Psr1/exploring-the-sp500-with-r-part-2-asset-analysis-657d3c1caf60", "anchor_text": "next post"}, {"url": "https://github.com/pysr1/medium_sp500", "anchor_text": "The Code can be found here"}, {"url": "https://medium.com/@kyleake/wikipedia-data-scraping-with-r-rvest-in-action-3c419db9af2d", "anchor_text": "https://medium.com/@kyleake/wikipedia-data-scraping-with-r-rvest-in-action-3c419db9af2dhttps://medium.com/@kyleake/wikipedia-data-scraping-with-r-rvest-in-action-3c419db9af2d"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/data-science?source=post_page-----56c9498f38e8---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/r?source=post_page-----56c9498f38e8---------------r-----------------", "anchor_text": "R"}, {"url": "https://medium.com/tag/tidyverse?source=post_page-----56c9498f38e8---------------tidyverse-----------------", "anchor_text": "Tidyverse"}, {"url": "https://medium.com/tag/functional-programming?source=post_page-----56c9498f38e8---------------functional_programming-----------------", "anchor_text": "Functional Programming"}, {"url": "https://medium.com/tag/scraping?source=post_page-----56c9498f38e8---------------scraping-----------------", "anchor_text": "Scraping"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&user=Bryant+Crocker&userId=93a17102968d&source=-----56c9498f38e8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&user=Bryant+Crocker&userId=93a17102968d&source=-----56c9498f38e8---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F56c9498f38e8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----56c9498f38e8---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----56c9498f38e8--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----56c9498f38e8--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----56c9498f38e8--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Psr1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@Psr1?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bryant Crocker"}, {"url": "https://medium.com/@Psr1/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "199 Followers"}, {"url": "https://www.linkedin.com/in/bcrocke1/", "anchor_text": "https://www.linkedin.com/in/bcrocke1/"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F93a17102968d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&user=Bryant+Crocker&userId=93a17102968d&source=post_page-93a17102968d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F907e19d94c65&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fexploring-the-sp500-with-r-part-1-scraping-data-acquisition-and-functional-programming-56c9498f38e8&newsletterV3=93a17102968d&newsletterV3Id=907e19d94c65&user=Bryant+Crocker&userId=93a17102968d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}