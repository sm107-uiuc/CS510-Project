{"url": "https://towardsdatascience.com/an-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b", "time": 1683004491.8588428, "path": "towardsdatascience.com/an-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b/", "webpage": {"metadata": {"title": "An Introduction to Betfair API and How to Use it | by Jamie Blair | Towards Data Science", "h1": "An Introduction to Betfair API and How to Use it", "description": "The world of online gambling is an ever changing beast which allows very few people outside of the business to take a glimpse into their ever changing world. Betfair is one of the few online bookies\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/JamieBlair1996/Betfair-API", "anchor_text": "GitHub", "paragraph_index": 1}, {"url": "https://docs.developer.betfair.com/visualisers/api-ng-account-operations/", "anchor_text": "APING Demo Tool", "paragraph_index": 2}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Certificate+Generation+With+XCA", "anchor_text": "from here", "paragraph_index": 6}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Betting+API", "anchor_text": "here", "paragraph_index": 11}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/listRunnerBook", "anchor_text": "here", "paragraph_index": 18}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 28}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 28}], "all_paragraphs": ["The world of online gambling is an ever changing beast which allows very few people outside of the business to take a glimpse into their ever changing world. Betfair is one of the few online bookies to allow everyone access to their API. This is because of the Betfair Exchange which works on similar principles as that of the Stock Market on Wall Street, with millions of users backing and laying bets in the hopes of making some money. Some people are able to earn a living on the Exchange but it isn\u2019t for everyone as many of these people are using bots to place these bets by using the API.", "When I first wanted to start using the API it was mainly to track how odds of certain markets would change over time and in the future analyse these changes and see what was causing the changes in price. When reading through the Betfair API documentation there wasn\u2019t exactly clear instructions on how to gain access to it, and also helped by the fact that the documentation hasn\u2019t really been updated since it was uploaded. So below I have created a basic guide on how to gain access to the Betfair API and how to use it. The full Notebook can be accessed from my GitHub. Also, before you start make sure you are able to access/place bets on Betfair. I also started trying to access the API on Google Colaboratory but was denied access as the servers are based in the US, a country that can\u2019t access Betfair.", "To begin you will need to have a Betfair account in order to gain access to the API key. To gain access to your API keys you will first need to have your SSOID and use the APING Demo Tool. When you are logged into Betfair right click and select Inspect Element. On Chrome you are looking for the Applications tab and then Cookies. It should look similar to this.", "When you have your SSOID paste it into the APING Demo Tool and add an application name then press execute at the bottom of the page.", "You should then have an app show up like this:", "Notice that there are 2 keys. For this application we are using the Delayed key as this is free whereas the other has no delay and costs \u00a3200. If you want to use it just make sure you have that amount in your Betfair account as it will be deducted from there. If you have already created an App, then select the getDeveloperAppKeys button and press execute at the bottom and this should display the keys.", "Now that you have access to your API Keys you will now need to download XCA. It is more beneficial to follow the guide for creating them from here this is the only piece of documentation that I found exceptionally useful. Make sure to double check all the information and settings are correct before advancing as these can\u2019t be changed and will have to be created again if they are wrong. When you have your certificate and key exported from XCA its time to upload the certificate to your Betfair account. This is done by going into your \u201cMy Betfair Account\u201d then the \u201cMy Details\u201d dropdown menu and selecting \u201cSecurity Settings\u201d.", "On this page click \u201cedit\u201d next to the \u201cAutomated Betting Program Access\u201d menu. Upload the .crt file and you should be ready to get into the programming.", "Throughout this example my key will have the extension .key this is because I changed it from .pem, either works as long as it is the correct extension in your code.", "First things first, import the libraries that are used", "To get started I am using POST just to login and access the SSOID. The SSOID that you found at the start was only to gain access to the API once you have your keys you can get it whenever you log in this way. The way I am setting the username, password and app key isn\u2019t necessary, but it will prove more time efficient later on. In this instance I am keeping my certificate and key in the same place as the notebook for ease, but you can save them elsewhere and use an absolute address.", "Here we are setting the URL that will be posting to, the request, and the headers. This particular request will provide a list of all available sports from Betfair. The URL below is set once and is the same URL that all requests are sent to. The event_req is the request that is being sent to the URL. This has to be set up like below bet can be changed when in this format. The method can be changed using the operations that can be found here. req retrieves the HTML response and is then converted into json to allow us to read it.", "The json response is made up of Dicts and Lists, or more accurately a Dictionary containing a List of Dictionaries which contains a Dictionary. The results show the name of the market, the market ID (which is used later on when filtering for upcoming matches), and the market count (the number of available markets to bet on). This will provide the number of markets that include inplay and upcoming, this can be set to show only upcoming or inplay which will be mentioned later. Below is the output of the above code. Notice how the \u2018id\u2019 doesn\u2019t follow the usual way of indexing and starts at 1 with a number of events not even following that convention.", "Below is an example of how to see the name of the event. Notice the aforementioned Dictionary with a List of Dictionaries which contain a Dictionary. If at any time you are unsure of what the dictionaries keys are use .keys() like so", "Next, we will move on and find how to get the available markets available for a specific event that is currently inplay. By using the listMarketTypes method the request is asking for all markets and with the addition of filters it can be fine-tuned to see markets specific to an event. The first filter used finds only the events for that specific id in this case it is Football using its id of 1. The other filter is whether it is inplay or not, if it is omitted it will provide both inplay and not inplay markets, this way it can effectively toggle between inplay and not.", "The market types above can be used to find out what teams are playing with the selected market by using the listMarketCatalogue method. Sticking with Football as the event with the addition of the filter marketTypeCodes. In this example MATCH_ODDS is used and shows the fixtures with this market. Another addition is setting a time range. This is set before adding it to the request as it is easier to add to the request with a single name rather than a large line. The response is sorted to display the first fixture to start and will only have 1 result. Note that max results will only accept a maximum of 1000. To see the teams playing in the fixture marketProjection is added.", "From this point on we will be looking at Horse Racing. Let\u2019s add some more details to our API request. You can see that I have pulled a number of variables from the request, this is to make it easier if changes need to be made. The variables are the same as the above example with the addition of metadata and inplay.", "The result of this request will give all the races in the UK and Ireland over the next 24 hours. When checking each race, it shows the all the information associated with the race importantly the marketId, which will be useful later. It also lists the runners and all the metadata associated with them including the horse\u2019s form, which will also be important, alongside its selectionId. To explore further into this output it is the same as before.", "An API request can be used to get the odds for a specific team/person/horse within which ever market you select. For this the horse from above will be used. To get the odds for the horse the API URL is set up the same as the previous URLs except it is the listRunnerBook that will be requested. The operations used can be found here. Note: You can only pass in one marketId and one selectionId in that market per request. If the selectionId being passed in is not a valid one/doesn\u2019t belong in that market then the call will still work but only the market data is returned.", "To get the necessary Ids you can just look at the output and enter it in manually or you can set them as variables.", "This is the output if there is an invalid selectionId passed. No odds are shown as there was nothing specific to get the odds for.", "This is the output if there is an valid selectionId passed. As can be seen there is now information connected to the selectionId used. It shows the Price that it was last traded at on the Betfair Exchange along with the prices that it can be backed at and the price that it can be layed against it. I will not get into what a lay bet is and for this example will only be looking at the first price available to back.", "Now that the basics have been covered on how to get the Races in a 24 hour period, the horses running in the races and the odds a specific horse. why not combine them all into one function, with a couple of additions.", "The function that will be created will calculate the average of each horses form in each race. It will then determine which horse has the best average form and it will be added to a dataframe alongside the odds for the selected horse, race, and the name of the horse.", "A horses form is made up of the positions that it has placed in its last 6 races. However not every horse can place, there are a number of different codes used in horse racing for which can\u2019t be added to the horses average. To combat this, you can weight these codes with whatever value you think is reasonable, which I have done below. Now, some of the code will rarely come up but that doesn\u2019t mean they won\u2019t, that is why I have added them anyway otherwise it will break. This function is also intended to be the only thing need to be run that is why I have added the first part about getting the SSOID.", "The first part of the function is the declaration of variables and lists that will be used within the function, along with the creation of the pandas dataframe. after that it is the same as before when the getting the SSOID, then getting the races and runners. It is at this point where the form is averaged out, as can be seen this is a bit messy and requires some clean-up but for the time being it operates as required.", "As can be seen the averaged number is added to a list. This list is then iterated through and checked against the lowest average that was set to 100 at the beginning. If the average at the current list location is less than the lowest average, then the new average is set as the new lowest average and the name of the horse and selectionId are appended to a list. Once the list has been iterated through, the odds of the horse with the best average is collected by using the method shown above. The values are then added into the dataframe. The reason for using horsename[-1] and selectionID[-1] is because the last item in the list is needed.", "And there you have it. A basic guide through the somewhat confusing Betfair API. Now, there is many more ways to use the Betfair API and I have only scratched the surface of the possibilities that can come from this. The form function is only a guideline to follow when looking at picking a horse to place a bet on as there are a number of other variables which haven\u2019t even been addressed like the horses weight, the jockey, the trainer, the condition of the track, or weather. Like anything that has to do with predicting the outcomes of races or matches take it with a grain of salt and use it in conjunction with whatever other information you would be usually look at when deciding on which bet to place.", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "A Big Data Technologies Graduate with an interest in anything sports related."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fe3cdbd79c94b&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@JamieBlair973?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamieBlair973?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Jamie Blair"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F352954ac1ccb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&user=Jamie+Blair&userId=352954ac1ccb&source=post_page-352954ac1ccb----e3cdbd79c94b---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://i.ytimg.com/vi/3MKaMjt5JLo/maxresdefault.jpg", "anchor_text": "lbbonline.com"}, {"url": "https://github.com/JamieBlair1996/Betfair-API", "anchor_text": "GitHub"}, {"url": "https://docs.developer.betfair.com/visualisers/api-ng-account-operations/", "anchor_text": "APING Demo Tool"}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Certificate+Generation+With+XCA", "anchor_text": "from here"}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/Betting+API", "anchor_text": "here"}, {"url": "https://docs.developer.betfair.com/display/1smk3cen4v3lu3yomq5qye0ni/listRunnerBook", "anchor_text": "here"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/gambling?source=post_page-----e3cdbd79c94b---------------gambling-----------------", "anchor_text": "Gambling"}, {"url": "https://medium.com/tag/python?source=post_page-----e3cdbd79c94b---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/api?source=post_page-----e3cdbd79c94b---------------api-----------------", "anchor_text": "API"}, {"url": "https://medium.com/tag/horse-racing?source=post_page-----e3cdbd79c94b---------------horse_racing-----------------", "anchor_text": "Horse Racing"}, {"url": "https://medium.com/tag/betting?source=post_page-----e3cdbd79c94b---------------betting-----------------", "anchor_text": "Betting"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&user=Jamie+Blair&userId=352954ac1ccb&source=-----e3cdbd79c94b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&user=Jamie+Blair&userId=352954ac1ccb&source=-----e3cdbd79c94b---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fe3cdbd79c94b&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----e3cdbd79c94b---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----e3cdbd79c94b--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamieBlair973?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@JamieBlair973?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jamie Blair"}, {"url": "https://medium.com/@JamieBlair973/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "36 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F352954ac1ccb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&user=Jamie+Blair&userId=352954ac1ccb&source=post_page-352954ac1ccb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F3d76da11507&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-introduction-to-betfair-api-and-how-to-use-it-e3cdbd79c94b&newsletterV3=352954ac1ccb&newsletterV3Id=3d76da11507&user=Jamie+Blair&userId=352954ac1ccb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}