{"url": "https://towardsdatascience.com/deep-learning-and-soil-science-part-2-129e0cb4be94", "time": 1682993675.352868, "path": "towardsdatascience.com/deep-learning-and-soil-science-part-2-129e0cb4be94/", "webpage": {"metadata": {"title": "Deep learning and Soil Science \u2014 Part 2 | by Jos\u00e9 Padarian | Towards Data Science", "h1": "Deep learning and Soil Science \u2014 Part 2", "description": "Digital Soil Mapping using contextual spatial information. A multi-task CNN to generate soil maps from point information."}, "outgoing_paragraph_urls": [{"url": "https://en.wikipedia.org/wiki/Variogram", "anchor_text": "variograms", "paragraph_index": 15}], "all_paragraphs": ["This is the second article of a Series that I am devoting to the use of Deep Learning in Soil Science. This is an ongoing series and so far it also includes:", "In the first part of this series, I gave some context about how soil scientists collect information, which usually involves some field work and laboratory analysis. This is an expensive and time-consuming process and that is one of the reasons why we try to build models to predict soil properties.", "In this article I focus on spatial models to generate maps. First I give some context about the traditional and \u201cmachine learning\u201d ways of producing soil maps. Then I dive into why contextual information is important and how we can use convolutional neural networks (CNNs) to leverage this information.", "In the late 1800\u2019s, the geologist and geographer V. V. Dokuchaev, in charge of mapping the soils of the Russian Empire, developed the idea that soil formation (and hence variation) was dependent on multiple factors including its parent material, climate, topography, vegetation, and time. This general concept is the basis of modern pedology (the study of the soils).", "Humans have been mapping soils for a long time. To decide what to grow and where, for taxation purposes, etc. To understand soil, and nature in general, observation is a key part of the process. In the field, after digging a pit, we describe the soil profile and its strata to try to understand its history. But that is just one part of the story. Since that pit is immerse in the landscape, the soil scientist observes the surroundings before drawing any conclusion (or map).", "After describing and observing, it is time to draw a map! You position all the points (pits) on a blank paper and draw polygons around them based on: 1) their (dis)similarity and 2) the information about the forming factors. After a while (probably many years in this example), you obtain something like this:", "Since Dokuchaev\u2019s work, things have changed. Not much in the theory, but in how we observe nature and how we process the data. Now, technology is present in most of the process, from a GPS to get the exact location of the pit, to satellite imagery that describes the soil forming factors.", "In traditional soil mapping, the conclusions derived from the observation of the interactions between the forming factors are drawn in the head of the soil scientist. In Digital Soil Mapping (DSM), the whole process is now aided by modelling and machine learning. A soil scientist can learn that the soils in a valley are different from the soils on a hill-slope. And sure we can train a model to do the same, right?", "DSM is a dynamic sub-field of soil sciences, so it is hard to summarise all that the community is doing. We use models from linear regressions, to random forests. We have many sources to obtain predictors (forming factors), including satellite imagery and derived products. To get more information about DSM, I refer you to McBratney et al. (2003).", "As I mentioned in the previous section, the theoretical background of DSM is based on the relationship between a soil attribute and soil forming factors. In practice, a single soil observation is usually described as a point p with coordinates (x,y) and the corresponding soil forming factors are represented by a vector of pixel values of multiple covariate rasters (a1,a2,\u2026,an) at the same location, where n is the total number of covariate rasters.", "This point representation is definitely useful but it is the equivalent to a soil scientist just looking at the soil profile without considering the surrounding landscape. To complete the picture, we can expose the model to the spatial context of each observation\u2026 the equivalent of stepping out of the soil pit and looking around.", "With the help of CNNs, we can expand the classic DSM approach by including information about the vicinity of (x,y) and fully leverage the spatial context of a soil observation. We can replace the covariates vector with a 3D array with shape (w,h,n), where w and h are the width and height in pixels of a window centred at point p.", "Because I\u2019m a fan of multi-task learning, we used a CNN with the 3D array as input and generated predictions for a soil property (soil organic carbon) at 5 depth ranges, based on a digital elevation model, slope, topographic wetness index, long term mean annual temperature and total annual rainfall. The network looks something like this:", "The head of the network (\u201cShared layers\u201d) extracts a general representation of the data which is then directed to 5 different branches, one for each target depth. The branches should be able to learn signals that are specific for each depth.", "Data augmentation is a common pre-treatment in machine learning. When we talk about maps, we usually have a top-view of the point of interest so the simplest method to augment the data is by rotation. Here we rotated the images by 90, 180 and 270\u00ba. There are two benefits of doing this:", "The size of the neighbourhood window (vicinity) had a significant effect on the prediction error (Fig. 5). Sizes above 9 pixels showed an increase in the error. In this example for a country-scale mapping of SOC at 100 m grid size, information from 150 to 450 m radius is useful. This range is similar to the spatial correlation range was reported for croplands in an review by Paterson et al. (2018), where, based on 41 variograms, the authors estimated an average spatial correlation range of around 400 m. Since we used a relatively coarse pixel resolution (100m) it is hard to tell what is the minimum amount of context needed to improve SOC predictions. We believe that using higher resolutions (< 10m) could produce more insights about this matter.", "In DSM, there are two main approaches to deal with the vertical variation of a soil property. You can make prediction layer by layer (depth is implicit), or you include depth in your model (depth is explicit). Both approaches show a decrease in the variance explained by the model as the prediction depth increases. This is expected since the information used as covariates usually represents surface conditions.", "In this study we can see again the synergistic effect of using a multitask CNN (I talked about that in the first post). As shown in the figure below, in this case the variance explained by the model actually increased with depth. Absolute values of R\u00b2 shouldn\u2019t be compared between models and datasets, but it is absolutely possible to compare the trends.", "I think this is the main reason I like multi-task CNNs. But be aware that it doesn\u2019t always work\u2026 In a future post I will show you some examples.", "If you have reached this point, you definitely deserve a map! After all, that was what the introduction was about, right? This study was carried out using soil information from Chile. In the figure below you can see an example of the predictions in a small test area (I will share a link to the full map eventually).", "Visually, the maps generated with the CNN showed some differences compared with the traditional model (Cubist). The map generated with the Cubist model shows more details related with the topography, but also presents some artefacts due to the sharp limits generated by the tree rules, and possibly some artefacts of the covariate rasters. On the other hand, the map generated with the CNN shows a smoothing effect, an expected behaviour consequence of using neighbour pixels.", "It\u2019s hard to visually evaluate a map because we inevitably judge it based on aesthetics. How smooth or sharp is reality? That is an ongoing discussion in my field. The traditional soil polygon is not the best way of describing a soil since soil is a continuum, but it is not hard to find cases when we see sharp changes between two soils, hence a very smooth raster might be wrong\u2026 Most likely the solution is somewhere in between.", "After testing this approach in different scenarios, it was obvious that we needed a way to interpret the CNN models to, at the very least, corroborate that they were capturing sensible relationships between the SOC and the predictors. In the article linked below, you can read on how I used SHAP values to do that.", "Digital soil mapping is a very interesting and dynamic discipline, and it is nice to see that methods like convolutional neural networks are applicable here. Intuitively, a method that is capable of exploiting contextual spatial information fits perfectly within the theoretical framework of soil science.", "Also, we saw again the synergistic effect of the multi-task network by regularising the predictions in the deeper layers. If the model already made an effort to predict the top layer, it should definitely use that to guide the prediction of the deeper layers! That is exactly what a soil scientist does when describing a profile!", "I\u2019ve been promising a post about transfer learning, and hopefully that will be the next post. I have a half-done draft, but my PhD is keeping me busy\u2026 so be patient please!", "More details about this work can be found in the corresponding paper.", "Note 04/09/2018: The paper has not been accepted yet and it is under public review and discussion until 15/10/2018. You are welcome to participate in this process.", "Dokuchaev, V. V., 1883. Schematic Map of Humus Content in the Upper Horizon of Soils of the Chernozemic Zone: Supplement to the Book \u201cRussian Chernozem\u201d.", "I would like to thank my editor Clara da Costa-Reidel for her corrections. It\u2019s great to have someone with a science background to proofread your work!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Research Fellow at The University of Sydney. Trying to use Machine Learning for everything related to Geo Sciences\u2026 It mostly works :)"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F129e0cb4be94&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@spadarian?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@spadarian?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Jos\u00e9 Padarian"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3e87fae89f4a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&user=Jos%C3%A9+Padarian&userId=3e87fae89f4a&source=post_page-3e87fae89f4a----129e0cb4be94---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/deep-learning-and-soil-science-part-1-8c0669b18097", "anchor_text": "Deep learning and Soil Science \u2014 Part 1Soil spectroscopy to predict soil properties. A multitask convolutional neural network to predict multiple soil properties from spectrograms.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/deep-learning-and-soil-science-part-3-c793407e4997", "anchor_text": "Deep learning and Soil Science \u2014 Part 3Soil spectroscopy and transfer learning. \u201cLocalising\u201d a continental soil spectral model to a national context.towardsdatascience.com"}, {"url": "https://towardsdatascience.com/geovec-word-embeddings-for-geosciences-ac1e1e854e19", "anchor_text": "GeoVec: word embeddings for geosciencesAnalogies, categorisation, relatedness and spatial interpolation of word embeddings.towardsdatascience.com"}, {"url": "https://en.wikipedia.org/wiki/Variogram", "anchor_text": "variograms"}, {"url": "https://towardsdatascience.com/explaining-a-cnn-generated-soil-map-with-shap-f1ec08a041eb", "anchor_text": "Explaining a CNN generated soil map with SHAPUsing SHAP to corroborate that the digital soil mapping CNN is capturing sensible relationships.towardsdatascience.com"}, {"url": "https://doi.org/10.5194/soil-5-79-2019", "anchor_text": "https://doi.org/10.5194/soil-5-79-2019"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----129e0cb4be94---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----129e0cb4be94---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/soil?source=post_page-----129e0cb4be94---------------soil-----------------", "anchor_text": "Soil"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----129e0cb4be94---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----129e0cb4be94---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&user=Jos%C3%A9+Padarian&userId=3e87fae89f4a&source=-----129e0cb4be94---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&user=Jos%C3%A9+Padarian&userId=3e87fae89f4a&source=-----129e0cb4be94---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F129e0cb4be94&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----129e0cb4be94---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----129e0cb4be94--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----129e0cb4be94--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----129e0cb4be94--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@spadarian?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@spadarian?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jos\u00e9 Padarian"}, {"url": "https://medium.com/@spadarian/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "503 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F3e87fae89f4a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&user=Jos%C3%A9+Padarian&userId=3e87fae89f4a&source=post_page-3e87fae89f4a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff423d6bca138&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeep-learning-and-soil-science-part-2-129e0cb4be94&newsletterV3=3e87fae89f4a&newsletterV3Id=f423d6bca138&user=Jos%C3%A9+Padarian&userId=3e87fae89f4a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}