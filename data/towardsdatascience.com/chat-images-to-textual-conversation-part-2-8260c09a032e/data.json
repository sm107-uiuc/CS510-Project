{"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-part-2-8260c09a032e", "time": 1683012795.0888672, "path": "towardsdatascience.com/chat-images-to-textual-conversation-part-2-8260c09a032e/", "webpage": {"metadata": {"title": "Chat Images To Textual Conversation: Part 2 | by Avani Sharma | Towards Data Science", "h1": "Chat Images To Textual Conversation: Part 2", "description": "So I am here again with part two for Chat Images to Textual Conversation. If you have not read about part 1 yet, I definitely recommend reading it on below link: This blog specifically addresses one\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-c44aadef59fe", "anchor_text": "part 1", "paragraph_index": 0}, {"url": "https://medium.com/u/bd8d094402aa?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Akshat Sharma", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/a-comprehensive-guide-to-convolutional-neural-networks-the-eli5-way-3bd2b1164a53", "anchor_text": "Convolutional Neural Networks (CNNs)", "paragraph_index": 2}, {"url": "https://arxiv.org/pdf/1807.05511.pdf", "anchor_text": "\u201cObject Detection with Deep Learning: A Review\u201d", "paragraph_index": 2}, {"url": "https://towardsdatascience.com/r-cnn-fast-r-cnn-faster-r-cnn-yolo-object-detection-algorithms-36d53571365e", "anchor_text": "1", "paragraph_index": 2}, {"url": "https://medium.com/@jonathan_hui/object-detection-speed-and-accuracy-comparison-faster-r-cnn-r-fcn-ssd-and-yolo-5425656ae359", "anchor_text": "2", "paragraph_index": 2}, {"url": "https://github.com/kbardool/keras-frcnn", "anchor_text": "Kbardool", "paragraph_index": 5}, {"url": "https://github.com/eleow/tfKerasFRCNN", "anchor_text": "eleow", "paragraph_index": 5}, {"url": "https://lilianweng.github.io/lil-log/2018/12/27/object-detection-part-4.html#retinanet", "anchor_text": "YOLOv3 and RetinaNet", "paragraph_index": 6}, {"url": "https://pypi.org/project/ImageHash/", "anchor_text": "Imagehash", "paragraph_index": 16}, {"url": "https://en.wikipedia.org/wiki/Scale-invariant_feature_transform", "anchor_text": "SIFT", "paragraph_index": 17}, {"url": "https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf", "anchor_text": "paper", "paragraph_index": 17}, {"url": "https://github.com/adumrewal/SIFTImageSimilarity/", "anchor_text": "this github repo", "paragraph_index": 17}, {"url": "https://appstore.com/messagink", "anchor_text": "ios", "paragraph_index": 20}, {"url": "https://play.google.com/store/apps/details?id=com.messagink.messagink", "anchor_text": "android", "paragraph_index": 20}, {"url": "https://messagink.com/", "anchor_text": "website", "paragraph_index": 20}], "all_paragraphs": ["So I am here again with part two for Chat Images to Textual Conversation. If you have not read about part 1 yet, I definitely recommend reading it on below link:", "This blog specifically addresses one main problem that was not addressed in part 1 \u2014 \u201cEmoji Detection and Recognition in Chat Images\u201d.", "This was just an open ended problem for us, so Akshat Sharma and I tried several different approaches. Apparently it seemed like Object Detection and Recognition problem, so we wanted to detect emojis first and then classify them into one of several categories. We researched several approaches for this type of problem and found that people generally use Convolutional Neural Networks (CNNs). Again in this domain, there was a vast range of choices we could use from. This paper entitled \u201cObject Detection with Deep Learning: A Review\u201d gives a good review of the approaches starting from Region based Convolutional Neural Networks RCNNs to You Look Only Once (YOLO) that can be specifically used for object detection and recognition. Going through several blogs and research results we came to conclusion that Faster-RCNN is the most accurate. While YOLO and Single Shot Detector are fast enough, there are several mentions that they are not good for small object detection as mentioned in these blogs: (1, 2 ) citing several research papers.", "Now we wanted to train a deep neural network, and we needed a lot of training data. Training data, in this case, will simply be chat images annotating emoji\u2019s using bounding boxes and unicode of emoji\u2019s to determine which class they belong to. We could not find any such dataset available on the internet and decided to write our own script to generate fake chat images along with emoji annotation information. Being constrained by the compute, we were able to to generate around 1500 chat images and their corresponding emoji annotations. We first wanted to give it a try using this much training data only. We divided the dataset between train (1300 images) and test (200 images). Below is the example of sample image generated using our script:", "There were a total of 88 Emoji classes with more that 350 samples for each class in the training set.", "I basically searched and found two implementations of Faster-RCNN. The first one was by Kbardool and other was by eleow. I could not make the the first implementation work on GPU as it required old CUDA and CUDNN version and Google Colab was not allowing downgrading. Using the second approach, I was able to train the network on training images, it took almost a day to train on 1300 images for 60 epochs. Finally, I was excited for the results, however, it did not work as expected and was detecting random emojis in chat images. I think it might be that our dataset was very small and the size of emoji\u2019s to be detected in chat images was almost constant and very small (15x24 / 24x24).", "We went back to drawing board and started exploring more on the approaches that could solve the emoji recognition problem. I researched more in the domain of CNNs and found that YOLOv3 and RetinaNet are single stage detectors and have been improved on previous implementations for smaller object detection. However limited by compute power and time it takes for training we decided to hold on and try some classic approaches first before we again explore this area.", "We again started from scratch and read and researched about the classic approaches that exist for image processing which could be helpful for our problem. Now I will discuss how we could achieve our target using some classic image processing along with Machine Learning for Emoji Detection and Recognition.", "So first let\u2019s talk about the subproblems that need to be tackled in order to achieve our target goal. We identified following subproblems:", "So let\u2019s start with first step, Detection of Emoji in Chat Images. For detecting emoji\u2019s we basically use image processing techniques to draw bounding box around region of interests where there is possibility of emoji/icon existence. So, basic idea here is to be able to detect the possible areas using color / brightness for emoji existence.", "2. Next step is to decrease intensity of the objects in chat image so that they appear more darker, where as background remains light only. This is to be able to differentiate objects from background. Below is the code snippet for step 2 :", "And following are the results for step 1 and 2:", "3. Now we had darker spots in the image, however to be able to clearly separate objects from background we wanted to threshold the image and convert each pixel to either white/black.", "4. We wanted to use cv2.connectedComponentsWithStats() to find the bounding box around the objects in chat image, and this cv2 function only works great with black background and white objects on top of it. Hence we used gaussian adaptive thresholding with inverse binary threshold to convert the resulting image from step 3 to our desired form.", "5. Now in the resulting image obtained from step 4, we can use cv2.connectedComponentsWithStats() to find the bounding box around the objects in image. Specifically while extracting the boxes we put in some thresholds so as to filter based on the Emoji size.", "Outputs of step 3, 4, 5 are displayed below:", "Now once we get all the objects from the image, our second step is to be able to classify them. Since emoji images are never going to be different from the ground truth, there will be no change in orientation or direction, it makes sense to compare them pixel by pixel. We researched about several approaches that could be used for this task, One of them was using Imagehash module in python, we performed several experiments using it, however hashed value varied a lot for different set of similar images and we could not decide on single threshold that could generalize better all sets of similar images.", "Hence we came up with another approach of comparing SIFT features of the emoji images generated using Scale-Invariant Feature Transform (SIFT) algorithm. We decided to use this algorithm because it would best suit our use case of emoji recognition. Since in our case we only had varied size of emojis without any change in geometry or direction and SIFT features are invariant to translation, rotations, and rescaling of the image, we anticipated that it might solve our problem. Now we needed a ground truth emoji database so that we could find probable match for detected emojis. I collected 29 distinct popular emoji images and extracted SIFT keypoints and descriptors using SIFT algorithm available in opencv for initial testing. Next we compare SIFT features of each detected object in the first step to each image in emoji database (ground truth SIFT keypoints and descriptors features) using David G. Lowe\u2019s K nearest neighbors SIFT matching algorithm as described in his paper. We used a basic scoring metric taken from this github repo on the returned matches to return final score between extracted image and ground truth images.", "Finally we pick the highest scoring emoji image having a score of greater than 8 to be the best possible match for input image. If there is no emoji image whose score is greater than 8, then no possible match exists, this helps in filtering out the non emoji images which got extracted in first step. This way we assign label (emoji unicode) to each extracted image in step 1.", "So after second step we have successfully detected and recognized emoji in Chat image. Now the next/third step is integration of the results from both the previous steps into our existing text chat recognition code. So to embed emoji\u2019s in the recognized text we made use of emoji bounding box extracted in Step 2 and text bounding boxes extracted for each text line in Part 1 of this blog. The idea was such that the bounding box of text should almost contain bounding box of emoji with a buffer of +5/-5 px to include some edge cases. Though this won\u2019t help determining the position of emoji between the line but we could successfully append emoji at the end of line. Assuming mostly people use emoji\u2019s at the end of line we thought this would be great initial start. In future to make it more precise we can look for other approaches to handle this situation. After step 3 we got a successfully running model and in the output we could see emoji\u2019s embedded in the output JSON.", "Now the step 4 was to deploy this model on the Messagink\u2019s app (ios, android) and website and see some exciting results in chat story format. We just updated the code on the server and configured Messagink\u2019s backend code to run the model in Conda environment. I am just attaching screen shots below of the original chat images and corresponding Messagink chat generated from these images. There might be some discrepancies as we don\u2019t claim that our model is 100 percent accurate but yes results are amazing for high quality images as can be seen below:", "As we can see here image imports look pretty good. To try this feature use Import button available in the editor on Messagink website by clicking below link:", "We were successfully able to integrate emoji recognition in the existing text chat recognition model. Hooray!!", "But there are still lot many things that I feel this module can be improved on. Our next target will be following in the order of priority.", "Till then see you! Good Bye!", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning / Sequence Modelling / Data Science Enthusiast, MSCS from University of Utah (2018), Software Engineer @ Goldman Sachs"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8260c09a032e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://avaninith.medium.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Avani Sharma"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65c1fd6e51fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&user=Avani+Sharma&userId=65c1fd6e51fb&source=post_page-65c1fd6e51fb----8260c09a032e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@danielkorpai?utm_source=medium&utm_medium=referral", "anchor_text": "Daniel Korpai"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-c44aadef59fe", "anchor_text": "part 1"}, {"url": "https://towardsdatascience.com/chat-images-to-textual-conversation-c44aadef59fe", "anchor_text": "Chat Images to Textual ConversationIn recent times, there are a lot of chat images floating around on social media, could be chat images with customer\u2026towardsdatascience.com"}, {"url": "https://medium.com/u/bd8d094402aa?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Akshat Sharma"}, {"url": "https://towardsdatascience.com/a-comprehensive-guide-to-convolutional-neural-networks-the-eli5-way-3bd2b1164a53", "anchor_text": "Convolutional Neural Networks (CNNs)"}, {"url": "https://arxiv.org/pdf/1807.05511.pdf", "anchor_text": "\u201cObject Detection with Deep Learning: A Review\u201d"}, {"url": "https://towardsdatascience.com/r-cnn-fast-r-cnn-faster-r-cnn-yolo-object-detection-algorithms-36d53571365e", "anchor_text": "1"}, {"url": "https://medium.com/@jonathan_hui/object-detection-speed-and-accuracy-comparison-faster-r-cnn-r-fcn-ssd-and-yolo-5425656ae359", "anchor_text": "2"}, {"url": "https://github.com/kbardool/keras-frcnn", "anchor_text": "Kbardool"}, {"url": "https://github.com/eleow/tfKerasFRCNN", "anchor_text": "eleow"}, {"url": "https://lilianweng.github.io/lil-log/2018/12/27/object-detection-part-4.html#retinanet", "anchor_text": "YOLOv3 and RetinaNet"}, {"url": "https://pypi.org/project/ImageHash/", "anchor_text": "Imagehash"}, {"url": "https://en.wikipedia.org/wiki/Scale-invariant_feature_transform", "anchor_text": "SIFT"}, {"url": "https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf", "anchor_text": "paper"}, {"url": "https://github.com/adumrewal/SIFTImageSimilarity/", "anchor_text": "this github repo"}, {"url": "https://appstore.com/messagink", "anchor_text": "ios"}, {"url": "https://play.google.com/store/apps/details?id=com.messagink.messagink", "anchor_text": "android"}, {"url": "https://messagink.com/", "anchor_text": "website"}, {"url": "https://messagink.com/editor/new", "anchor_text": "Messagink - discover text storiesRead conversations and text stories in your favourite genre. Write your own text stories for free.messagink.com"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----8260c09a032e---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/image-processing?source=post_page-----8260c09a032e---------------image_processing-----------------", "anchor_text": "Image Processing"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----8260c09a032e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/emoji-detection?source=post_page-----8260c09a032e---------------emoji_detection-----------------", "anchor_text": "Emoji Detection"}, {"url": "https://medium.com/tag/chat-image-to-text?source=post_page-----8260c09a032e---------------chat_image_to_text-----------------", "anchor_text": "Chat Image To Text"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&user=Avani+Sharma&userId=65c1fd6e51fb&source=-----8260c09a032e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&user=Avani+Sharma&userId=65c1fd6e51fb&source=-----8260c09a032e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F8260c09a032e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----8260c09a032e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----8260c09a032e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----8260c09a032e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8260c09a032e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----8260c09a032e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----8260c09a032e--------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://avaninith.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Avani Sharma"}, {"url": "https://avaninith.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "12 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F65c1fd6e51fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&user=Avani+Sharma&userId=65c1fd6e51fb&source=post_page-65c1fd6e51fb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc98e63f1f65d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fchat-images-to-textual-conversation-part-2-8260c09a032e&newsletterV3=65c1fd6e51fb&newsletterV3Id=c98e63f1f65d&user=Avani+Sharma&userId=65c1fd6e51fb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}