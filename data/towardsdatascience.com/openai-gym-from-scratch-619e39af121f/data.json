{"url": "https://towardsdatascience.com/openai-gym-from-scratch-619e39af121f", "time": 1682994185.051496, "path": "towardsdatascience.com/openai-gym-from-scratch-619e39af121f/", "webpage": {"metadata": {"title": "OpenAI Gym from scratch. From a environment development to a\u2026 | by Jonathas Figueiredo | Towards Data Science", "h1": "OpenAI Gym from scratch", "description": "There are a lot of work and tutorials out there explaining how to use OpenAI Gym toolkit and also how to use Keras and TensorFlow to train existing environments using some existing OpenAI Gym\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/jmpf2018/SimpleShipAI/blob/master/simulator_simple.py", "anchor_text": "here", "paragraph_index": 15}, {"url": "https://docs.python.org/3/library/turtle.html", "anchor_text": "turtle", "paragraph_index": 29}, {"url": "https://github.com/jmpf2018/SimpleShipAI/blob/master/viewer.py", "anchor_text": "here", "paragraph_index": 29}, {"url": "https://github.com/jmpf2018/SimpleShipAI", "anchor_text": "here", "paragraph_index": 31}, {"url": "https://github.com/keras-rl/keras-rl", "anchor_text": "Keras-rl project", "paragraph_index": 32}, {"url": "https://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html", "anchor_text": "here", "paragraph_index": 32}, {"url": "https://github.com/jmpf2018/ShipAI", "anchor_text": "here", "paragraph_index": 39}], "all_paragraphs": ["There are a lot of work and tutorials out there explaining how to use OpenAI Gym toolkit and also how to use Keras and TensorFlow to train existing environments using some existing OpenAI Gym structures. However in this tutorial I will explain how to create an OpenAI environment from scratch and train an agent on it.", "I will also explain how to create a simulator in order to develop the environment. The tutorial is divided in 4 sections: Problem statement, Simulator, Gym environment and Training.", "The problem here proposed is based on my final graduation project. The objective is to create an artificial intelligence agent to control the navigation of a ship throughout a channel.", "Nowadays navigation in restricted waters such as channels and ports are basically based on the pilot knowledge about environmental conditions such as wind and water current in a given location.", "Let\u2019s say the humans still making mistakes that costs billions of dollars sometimes and AI is a possible alternative that could be applied in navigation to reduce the number of accidents.", "In order to create an AI agent to control a ship we need an environment where the AI agent can perform navigation experiences and learn with its own mistakes how to navigate correctly throughout a channel. Moreover, because we cannot use a real ship to train the AI agent, the best alternative is to use a simulator that mimics the dynamics behavior of a real-world ship. For this purpose we could use an existing commercial software (paid option) , but in this tutorial we\u2019are going to create our own ship simulator.", "To do so, some hypothesis are adopted such as: the ship is a rigid body, the only external forces that actuate in the ship are the water-resistance forces (no wind, no water current), furthermore the propulsion and rudder control forces are used control the direction and the velocity of the ship. The complete equations that govern the dynamics of the ship are complex and can be found in reference [1] . Here we\u2019re going to use a very simple 3DOF model presented bellow:", "In this diagram u is the longitudinal velocity of the ship in relation to a frame fixed on the ship CG, v is the draft velocity and d\u03c8/dt is the angular velocity in relation to the fixed reference and \u03c8 is the attack angle of the ship measured in relation to a fixed frame OXY. The velocities U, V (fixed frame) are linked t1o u, v via the 2x2 rotation matrix. \u03a6 is the rudder angle measured w.r.t the moving frame as shown in the figure.", "The formulations of the resistance and propulsion forces is out of scope of this tutorial, but, in summary, the resistance forces are opposite to the ship movement and proportional to the ship velocity. The rudder and propulsion forces are proportional to the parameters Al in [\u22121, 1] and Ap in [0, 1]. These parameters have a direct proportional relation with the rudder angle and the propulsion (Tp). Note that Al and Ap are controllable parameters, such that:", "Now that we have the model differential equations, we can use a integrator to build up our simulator. Let\u2019s write down our simulator.", "In the first 6 lines we just define the variable names from x1 to x6, beta and alpha are the control constants used to control rudder and propulsion control, after we compute the resistance forces and finally we isolate the derivative terms fx1,fx2 \u2026, fx6 such that:", "We define a function that uses the scipy RK45 to integrate a function fun using a start point y0. The integration is done from t0 to t_bound, with relative tolerance rtol and absolute tolerance atol.", "Because we are using a global reference(OXY) to locate the ship and a local one to integrate the equations (oxyz), we define a \u201cmask\u201d function to use in the integrator. This function basically transform the differential vector outputted in the function simulate to the global reference.", "For each step we pass a rudder (angle_level) and a rotational level (rot_level) to control the thrust delivered by the propulsion.", "In the first line we store the current action vector, in the second line we integrate using RK45 self.integrator.step() until it have reached the final time span. Finally we update the self.last_global_state, self.last_local_state and the integration interval via self.integrator. Finally we return the global states self.last_global_state.", "The final code can be checked here.", "Once we have our simulator we can now create a gym environment to train the agent.", "The states are the environment variables that the agent can \u201csee\u201d the world. The agent uses the variables to locate himself in the environment and decide what actions to take to accomplish the proposed mission. In our problem the mission is stated as:", "Use the rudder control to perform a defined linear navigation path along a channel under a given constant propulsion action.", "The states chosen for the application of RL in the task are the following:", "Where d is the distance from the center of mass of the ship to the guideline; \u03b8 is the angle between the longitudinal axis of the ship and the guideline; vx is the horizontal speed of the ship in its center of mass (in the direction of the guideline; vy is the vertical speed of the ship in its center of mass (perpendicular to the guideline); d\u03b8/dt is the angular velocity of the ship.", "The reward function is responsible for punishing the agent if he does not follow the guideline, and will reward him if he can stay in line without too much wavering. The defined reward function is:", "The actions are the input parameters for controlling the ship maneuver movement. The forces that make the ship controllable are the rudder and propulsion forces. The actions have the vector form Av = [Al, Ap], where Al is the dimensionless rudder command and Ap is the dimensionless propulsion command, such that Al in [-1,1] and Ap in [0,1].", "Now that we have defined the main aspects of our environment, we can write down the code.", "First we define the limits bounds of our ship and the kind of \u201cbox\u201d of our observable space-state (features), we also define the initial condition box.", "After that we define a function to transform the simulator space-state to the environment space-state. Note that we mirror the vy velocity the \u03b8 angle and the distance d to make easier to the AI to learn (decrease the space-state dimension).", "Than we define a function to compute the reward as defined before", "We also have to define the step function. This function is used by the agent when navigating, at each step the agent choose an action and run a simulation during 10s (in our integrator) and do it again and again until it reaches the end of the channel or until it hits the channel edge.", "Because we mirror the states we also have to mirror the rudder actions multiplying it by side. In this tutorial we are going to create a network to control only the rudder actions and keep the rotational angle constant (rot_action = 0.2).", "We also create a viewer using the library turtle, you can check the code here. It is used to show the learning process or the performance after training. The viewer is called in the function render.", "Finally we define the function to setup the init space-state and the reset, they are used in the beginning of each new iteration.", "The complete code can be found here.", "To train our agent we are using a DDPG agent from the Keras-rl project. Details about the DDPG method can be found here.", "We than import all used methods to build our neural network.", "The neural network used has the following structure (actor-critic structure):", "The code that implements this is structure is the following:", "Finally we train our agent using 300.000 iterations and after training we save the network weights and the history of training:", "The agent have learned how to control the rudder and how to stay in the channel mid-line.", "Thanks if you have read this far! Any questions just leave a comment bellow", "In my final-year project I used a more-detailed ship model and also included the propulsion action to be controlled by the AI agent. The project repository can be found here.", "[1] FOSSEN, Thor I. Handbook of marine craft hydrodynamics and motion control. John Wiley & Sons, Ltd, 2011.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Graduated in Mechatronics and Automation Control, I have a particular interest in innovation engineering activities and AI development."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F619e39af121f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----619e39af121f--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@jonathas.mpf?source=post_page-----619e39af121f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jonathas.mpf?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Jonathas Figueiredo"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4becf60c47f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&user=Jonathas+Figueiredo&userId=e4becf60c47f&source=post_page-e4becf60c47f----619e39af121f---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/jmpf2018/SimpleShipAI/blob/master/simulator_simple.py", "anchor_text": "here"}, {"url": "https://docs.python.org/3/library/turtle.html", "anchor_text": "turtle"}, {"url": "https://github.com/jmpf2018/SimpleShipAI/blob/master/viewer.py", "anchor_text": "here"}, {"url": "https://github.com/jmpf2018/SimpleShipAI", "anchor_text": "here"}, {"url": "https://github.com/keras-rl/keras-rl", "anchor_text": "Keras-rl project"}, {"url": "https://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html", "anchor_text": "here"}, {"url": "https://github.com/jmpf2018/ShipAI", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----619e39af121f---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/openai?source=post_page-----619e39af121f---------------openai-----------------", "anchor_text": "OpenAI"}, {"url": "https://medium.com/tag/reinforcement-learning?source=post_page-----619e39af121f---------------reinforcement_learning-----------------", "anchor_text": "Reinforcement Learning"}, {"url": "https://medium.com/tag/simulation?source=post_page-----619e39af121f---------------simulation-----------------", "anchor_text": "Simulation"}, {"url": "https://medium.com/tag/navigation?source=post_page-----619e39af121f---------------navigation-----------------", "anchor_text": "Navigation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&user=Jonathas+Figueiredo&userId=e4becf60c47f&source=-----619e39af121f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&user=Jonathas+Figueiredo&userId=e4becf60c47f&source=-----619e39af121f---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----619e39af121f--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F619e39af121f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----619e39af121f---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----619e39af121f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----619e39af121f--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----619e39af121f--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----619e39af121f--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----619e39af121f--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jonathas.mpf?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@jonathas.mpf?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Jonathas Figueiredo"}, {"url": "https://medium.com/@jonathas.mpf/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "73 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe4becf60c47f&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&user=Jonathas+Figueiredo&userId=e4becf60c47f&source=post_page-e4becf60c47f--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F7a55498e8f99&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fopenai-gym-from-scratch-619e39af121f&newsletterV3=e4becf60c47f&newsletterV3Id=7a55498e8f99&user=Jonathas+Figueiredo&userId=e4becf60c47f&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}