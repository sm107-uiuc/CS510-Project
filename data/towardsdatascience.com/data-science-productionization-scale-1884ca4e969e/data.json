{"url": "https://towardsdatascience.com/data-science-productionization-scale-1884ca4e969e", "time": 1682995527.15104, "path": "towardsdatascience.com/data-science-productionization-scale-1884ca4e969e/", "webpage": {"metadata": {"title": "Data science productionization: scale | by Schaun Wheeler | Towards Data Science", "h1": "Data science productionization: scale", "description": "You can wait until you are surprised by the unexpected, or you can build systems to limit the extent to which the unexpected can hurt you."}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/deploy-a-python-model-more-efficiently-over-spark-497fc03e0a8d", "anchor_text": "here", "paragraph_index": 13}, {"url": "http://aampe.co", "anchor_text": "aampe.co", "paragraph_index": 21}], "all_paragraphs": ["This is the fourth part of a five-part series on data science productionization:", "Let\u2019s look at the word-normalizing code (from my previous two posts) one more time.", "The code we wrote previously works fine for a single word. It would even work fine for a few thousand words. But if we need to normalize millions or billions of words, it will take more time than we probably want to spend. That\u2019s the problem of scalability: the amount of data you have to process usually has a direct relationship to how long it takes to process it. Businesses operate on deadlines \u2014 if you can\u2019t get results within the time frame you need, then the results won\u2019t do you any good.", "In the example, we scale our code by parallelizing it. There are a number of ways to do this \u2014 I used Spark because it\u2019s currently one of the more popular ways to process data at scale. I start by creating a DataFrame, which is more or less Python\u2019s version of a spreadsheet. It has two columns \u2014 ids and words \u2014 and each of those columns have three values. I then convert the DataFrame to a Spark DataFrame, which allows each record to be processed separately and in parallel. I then turn our `normalize_word` function into a Spark \u201cuser-defined function\u201d (UDF), which allows the function to be distributed to the different virtual machines that will process the data. For the same reason, I convert our list of stops into a Spark array.", "Once I\u2019ve converted all of our non-scalable pieces of code into their scalable counterparts, I can process the dataframe using the UDF. This farms each row of the dataframe out to an \u201cexecutor\u201d which processes the record using the supplied function and gives me the result:", "Spark lets me tune how many records get sent to each executor, and how many executors I want (or can afford). I can decide how much memory I want each executor to have (I need very little for the example above, but at times I have needed a lot if I was distributing an entire machine learning model).", "When we move from thinking about code to thinking about systems of code, I think scalability boils down to three major components: resources management, integrations, and implementation creativity.", "I find it useful to think about resources in terms of memory, compute power, and disk space. I don\u2019t think there\u2019s any analogy of these things that won\u2019t get me in trouble for being overly-simplistic, but I\u2019ll risk it: if you were trying to ship a lot of goods from one state to another, the number and size of your trucks would be your memory, the speed and horsepower of your trucks would be your compute power, and the size and number of your warehouses would be your disk space. Each component constrains the others. It doesn\u2019t matter how many trucks you have or how fast those trucks can drive if you have no place to store you goods once they reach their destination. And it doesn\u2019t matter how big your warehouse is if your goods don\u2019t fit into your trucks. And neither the size of your warehouses nor your trucks matters if the trucks have no fuel. You get the point.", "Even though we\u2019re really only managing three basic kinds of resources, there are many, many ways to manage each of them. Think of all the ways a single truck can break. There are just as many ways you can mess up your memory usage. For a spark job, I typically have to play with the following parameters:", "There are 10\u201320 other parameters for which I have preferred defaults that I apply to pretty much any job. And there are dozens of other parameters that I don\u2019t even know about because I\u2019ve never had the need to mess with them. Scalability is only marginally about getting more resources. It\u2019s mostly about learning how to allocate available resources wisely.", "Sometimes the bottlenecks in your process aren\u2019t the result of technical resource allocation. In other words, sometimes humans mess your stuff up. Some of the most common ways I\u2019ve seen this happen:", "The solution to all of these problems is to ask whether a human really needs to be in the loop in the first place. Does an individual analyst need to hand-roll each report each time it\u2019s requested? Does an individual person over in finance really need to be the one to compile data from a few systems into an Excel report and email it to you? Do you really need to schedule the re-evaluation of an old model on your calendar? All of these things can be partially or wholly automated. There are several common ways to do this:", "Integrations allow you to more explicitly and efficiently manage resources that aren\u2019t under your direct control. They also allow you the benefits of alerting and reporting.", "Often, scalability has more to with how you think about the problem than how you manage technical resources and partnerships. Let me explain what I mean by reference to an example from my own work (which I\u2019ve described in more detail here). In my current job, one way we look at location data is by overlaying mobile location signals with land parcels. Parcels come from city or county assessor\u2019s offices and are used to demarcate property lines. They often look something like this:", "It\u2019s useful to us when we can see that a location signal is, say, within a residential parcel, or a parcel on which IKEA pays the taxes. It helps us understand why those signals are where they are. Not all parcels are well labeled, so we had a need to infer labels for unlabeled parcels. In particular, we wanted to differentiate between residential and non-residential parcels. The method for modeling residentialism was really simple: we had tens of millions of parcels that were labeled, and we had a lot of metadata associated with those parcels on which we could train the model to identify the correct label.", "The difficulty came when we wanted to actually generate the labels. We had about 140 million parcels that needed a decision. We had trained the model using Python\u2019s scikit-learn library. However, calling a scikit-learn `predict` method through a PySpark user-defined-function creates a couple problems. First, it incurs the overhead of serializing the model object for transport to the executors and then deserializing that object to actually use on the executors. It has to do that for every executor used in the job. Second, it fails to take advantage of scikit-learn\u2019s optimizations, which mostly are due to its dependency on another package \u2014 numpy \u2014 to quickly perform calculations on whole arrays of data at once rather than loop through individual records.", "The overhead in using spark\u2019s row-by-row application of the model was so great that we couldn\u2019t even get the process to finish. The solution, we finally found, was to think creatively about how to apply the trained model:", "The above code does a few things:", "As I said, the original implementation hadn\u2019t completed even after running for 48 hours. The new implementation finished in 30 minutes. The lesson: when it comes to scalability, sometimes we need fancy new technology; sometimes we just need a five-minute walk so we can get a fresh perspective. Sometimes we need both.", "Scalability is about future-proofing your work. You can\u2019t really anticipate how many people are going to end up wanting what you build or the time frame in which they will want it. You can wait until you are surprised by an unexpected increase in demand, or you can build your systems to limit the extent to which changes in demand can bottleneck your work.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Co-founder @ aampe.co. Anthropologist + Data Scientist."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1884ca4e969e&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@schaun.wheeler?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schaun.wheeler?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Schaun Wheeler"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2d3762e7f110&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&user=Schaun+Wheeler&userId=2d3762e7f110&source=post_page-2d3762e7f110----1884ca4e969e---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://towardsdatascience.com/tagged/ds-productionization", "anchor_text": "DS Productionization"}, {"url": "https://towardsdatascience.com/what-does-it-mean-to-productionize-data-science-82e2e78f044c", "anchor_text": "What does it mean to \u201cproductionize\u201d data science?"}, {"url": "https://towardsdatascience.com/data-science-productionization-portability-f5d1a1f2f45b", "anchor_text": "Portability"}, {"url": "https://towardsdatascience.com/data-science-productionization-maintenance-af59ce6c958", "anchor_text": "Maintenance"}, {"url": "https://towardsdatascience.com/data-science-productionization-scale-1884ca4e969e", "anchor_text": "Scale"}, {"url": "https://towardsdatascience.com/data-science-productionization-trust-b37f10b8f426", "anchor_text": "Trust"}, {"url": "https://towardsdatascience.com/deploy-a-python-model-more-efficiently-over-spark-497fc03e0a8d", "anchor_text": "here"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----1884ca4e969e---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1884ca4e969e---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/tech?source=post_page-----1884ca4e969e---------------tech-----------------", "anchor_text": "Tech"}, {"url": "https://medium.com/tag/spark?source=post_page-----1884ca4e969e---------------spark-----------------", "anchor_text": "Spark"}, {"url": "https://medium.com/tag/ds-productionization?source=post_page-----1884ca4e969e---------------ds_productionization-----------------", "anchor_text": "Ds Productionization"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&user=Schaun+Wheeler&userId=2d3762e7f110&source=-----1884ca4e969e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&user=Schaun+Wheeler&userId=2d3762e7f110&source=-----1884ca4e969e---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1884ca4e969e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1884ca4e969e---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1884ca4e969e--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1884ca4e969e--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1884ca4e969e--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schaun.wheeler?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@schaun.wheeler?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Schaun Wheeler"}, {"url": "https://medium.com/@schaun.wheeler/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "894 Followers"}, {"url": "http://aampe.co", "anchor_text": "aampe.co"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F2d3762e7f110&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&user=Schaun+Wheeler&userId=2d3762e7f110&source=post_page-2d3762e7f110--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fd8dcfa98f86c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdata-science-productionization-scale-1884ca4e969e&newsletterV3=2d3762e7f110&newsletterV3Id=d8dcfa98f86c&user=Schaun+Wheeler&userId=2d3762e7f110&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}