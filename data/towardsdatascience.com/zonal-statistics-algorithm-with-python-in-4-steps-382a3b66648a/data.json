{"url": "https://towardsdatascience.com/zonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a", "time": 1683016249.123382, "path": "towardsdatascience.com/zonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a/", "webpage": {"metadata": {"title": "Zonal Statistics Algorithm with Python in 4 Steps | by Konrad Hafen | Towards Data Science", "h1": "Zonal Statistics Algorithm with Python in 4 Steps", "description": "It is a common need to summarize information from a gridded dataset within an irregularly shaped area. While at first glance this may seem simple, reconciling differences between raster (gridded) and\u2026"}, "outgoing_paragraph_urls": [{"url": "https://live.osgeo.org/en/quickstart/gdal_quickstart.html", "anchor_text": "GDAL and OGR documentation", "paragraph_index": 7}, {"url": "https://opensourceoptions.com/blog/zonal-statistics-algorithm-with-python-in-4-steps/", "anchor_text": "https://opensourceoptions.com", "paragraph_index": 14}], "all_paragraphs": ["It is a common need to summarize information from a gridded dataset within an irregularly shaped area. While at first glance this may seem simple, reconciling differences between raster (gridded) and vector (polygon) datatypes can quickly become complicated. This article shows how to implement a zonal statistics algorithm in Python in 4 steps.", "Start by importing the necessary Python modules.", "Now set the file paths for the raster and vector data and use gdal and ogr to load the raster and vector data, respectively. Access the layer which contains the polygon data from the vector data source that was loaded. Then get the GeoTransform information (positions the gridded raster data and specifies cell sizes) and no data value for the raster data.", "We\u2019re also going to do a little more setup with gdal and ogr to prepare for determining the overlap between the raster grid and vector polygons. Let's get gdal and ogr drivers to create temporary raster and vector layers in memory and set the name for a temporary shapefile.", "Once the raster and vector data are loaded it\u2019s time to determine where they overlap. This will be the most complicated and intensive part of the algorithm. To start, read the first polygon feature from the vector layer. Then start a while loop that will continue as long as there is another feature in the vector layer. Below is the basic way to set up the loop. This loop will be modified as we continue.", "We need to create some functions that will help us create a new raster to store the rasterized polygon features. These functions will make more sense when we call them with actual data. For now, add the function definitions at the top of the script. First we need to convert the convert the coordinates of the bounding box containing a polygon feature to cell coordinates, or offsets, (row and column numbers) that to correspond the input raster. The bounding box of a polygon is the rectangle that contains the entire polygon feature, it consists of minimum and maximum X and Y coordinates.", "Next write a function that creates a new GeoTransform with the cell offsets that were calculated in the function above. These two functions will allow us to create a new, smaller raster that only covers the area overlapped by a polygon feature.", "Now comes the most complicated part of the algorithm: creating a new empty raster in memory and converting the polygon features to rasters. Follow the comments in code snippet below to understand what is accomplished by each line of code. You may also find it useful to review the GDAL and OGR documentation.", "At this point we have two concurrent (overlapping) numpy arrays: tr_array and r_array. tr_array has a value of 1 that indicates where the polygon has been rasterized. r_array has the values we want to use to calculate zonal statistics for each polygon.", "First, make sure that the input raster exists. Next create a mask array. We want to get data from r_array where it does not contain no-data values and where the corresponding value in tr_array equals 1 (or True).", "Now we\u2019ll use maskarray to calculate zonal statistics for each polygon feature.", "Write one more function that takes a number of values as inputs and creates a dictionary of values. Place this function with the others at the top of the zonal statistics script.", "Now, calculate the values from maskarray and pass them to the setFeatureStats function. Only do this if the array exists ( is not None). Otherwise, pass the no data value to set the statistics.", "Congratulations! You have created a Python zonal statistics script that can be applied to many different applications. The full script is available below. Using a custom zonal statistics algorithm gives you a lot of flexibility for how you use the results. From this point it\u2019s easy to convert the list of dictionaries to pandas dataframe for analysis, export to a csv, or create new fields in the original shapefile and add the statistics directly to the original data. This can speed up, simplify and customize your workflows.", "Originally published at https://opensourceoptions.com on November 10, 2020.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F382a3b66648a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://khafen.medium.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": ""}, {"url": "https://khafen.medium.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Konrad Hafen"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56d662f7324a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&user=Konrad+Hafen&userId=56d662f7324a&source=post_page-56d662f7324a----382a3b66648a---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@claybanks?utm_source=medium&utm_medium=referral", "anchor_text": "Clay Banks"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://live.osgeo.org/en/quickstart/gdal_quickstart.html", "anchor_text": "GDAL and OGR documentation"}, {"url": "https://opensourceoptions.com/blog/zonal-statistics-algorithm-with-python-in-4-steps/", "anchor_text": "https://opensourceoptions.com"}, {"url": "https://medium.com/tag/python?source=post_page-----382a3b66648a---------------python-----------------", "anchor_text": "Python"}, {"url": "https://medium.com/tag/zonal-statistics?source=post_page-----382a3b66648a---------------zonal_statistics-----------------", "anchor_text": "Zonal Statistics"}, {"url": "https://medium.com/tag/statistics?source=post_page-----382a3b66648a---------------statistics-----------------", "anchor_text": "Statistics"}, {"url": "https://medium.com/tag/gis?source=post_page-----382a3b66648a---------------gis-----------------", "anchor_text": "GIS"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----382a3b66648a---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&user=Konrad+Hafen&userId=56d662f7324a&source=-----382a3b66648a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&user=Konrad+Hafen&userId=56d662f7324a&source=-----382a3b66648a---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F382a3b66648a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----382a3b66648a---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----382a3b66648a--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----382a3b66648a--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----382a3b66648a--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----382a3b66648a--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----382a3b66648a--------------------------------", "anchor_text": ""}, {"url": "https://khafen.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://khafen.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Konrad Hafen"}, {"url": "https://khafen.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "255 Followers"}, {"url": "https://opensourceoptions.com", "anchor_text": "https://opensourceoptions.com"}, {"url": "https://publiclandsjournal.com", "anchor_text": "https://publiclandsjournal.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F56d662f7324a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&user=Konrad+Hafen&userId=56d662f7324a&source=post_page-56d662f7324a--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1e1cde455f3a&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fzonal-statistics-algorithm-with-python-in-4-steps-382a3b66648a&newsletterV3=56d662f7324a&newsletterV3Id=1e1cde455f3a&user=Konrad+Hafen&userId=56d662f7324a&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}