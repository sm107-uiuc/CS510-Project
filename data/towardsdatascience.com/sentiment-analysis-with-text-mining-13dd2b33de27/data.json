{"url": "https://towardsdatascience.com/sentiment-analysis-with-text-mining-13dd2b33de27", "time": 1682993650.915188, "path": "towardsdatascience.com/sentiment-analysis-with-text-mining-13dd2b33de27/", "webpage": {"metadata": {"title": "Sentiment Analysis with Text Mining | by Bert Carremans | Towards Data Science", "h1": "Sentiment Analysis with Text Mining", "description": "In this tutorial, I will explore some text mining techniques for sentiment analysis. First, we will spend some time preparing the textual data. This will involve cleaning the text data, removing stop\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.kaggle.com/crowdflower/twitter-airline-sentiment", "anchor_text": "Twitter US Airline Sentiment data set on Kaggle", "paragraph_index": 0}, {"url": "https://github.com/bertcarremans/TwitterUSAirlineSentiment", "anchor_text": "notebook on Github", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Confusion_matrix", "anchor_text": "confusion matrix", "paragraph_index": 24}, {"url": "https://en.wikipedia.org/wiki/Tf%E2%80%93idf", "anchor_text": "TF-IDF (term frequency \u2014 inverse document frequency)", "paragraph_index": 28}, {"url": "https://radimrehurek.com/gensim/models/word2vec.html", "anchor_text": "gensim", "paragraph_index": 30}, {"url": "https://en.wikipedia.org/wiki/Multinomial_distribution", "anchor_text": "multinomial distribution", "paragraph_index": 37}], "all_paragraphs": ["In this tutorial, I will explore some text mining techniques for sentiment analysis. First, we will spend some time preparing the textual data. This will involve cleaning the text data, removing stop words and stemming. The Twitter US Airline Sentiment data set on Kaggle is nice to work with for this purpose. It contains the tweet\u2019s text and one variable with three possible sentiment values.", "To infer the tweets\u2019 sentiment we use two classifiers: logistic regression and multinomial naive Bayes. We will tune the hyperparameters of both classifiers with grid search.", "We will compare the performance with three metrics: precision, recall and the F1 score.", "We start by importing the packages and configuring some settings.", "We read in the comma separated file we downloaded from the Kaggle Datasets. We shuffle the data frame in case the classes are sorted. Applying the reindex method on the permutation of the original indices is good for that. In this notebook, we will work with the text variable and the airline_sentiment variable.", "There are three class labels we will predict: negative, neutral or positive.", "The class labels are imbalanced as we can see below in the chart. This is something that we should keep in mind during the model training phase. With the factorplot of the seaborn package, we can visualize the distribution of the target variable.", "To analyze the text variable we create a class TextCounts. In this class we compute some basic statistics on the text variable.", "It could be interesting to see how the TextStats variables relate to the class variable. So we write a function show_dist that provides descriptive statistics and a plot per target class.", "Below you can find the distribution of the number of words in a tweet per target class. For brevity, we will limit us to only this variable. The charts for all TextCounts variables are in the notebook on Github.", "Before we start using the tweets\u2019 text we need to clean it. We\u2019ll do the this in the class CleanText. With this class we\u2019ll perform the following actions:", "To show how the cleaned text variable will look like, here\u2019s a sample.", "glad rt bet bird wish flown south winterpoint upc code check baggag tell luggag vacat day tri swimsuitvx jfk la dirti plane not standardtell mean work need estim time arriv pleas need laptop work thanksure busi go els airlin travel name kathryn sotelo", "One side-effect of text cleaning is that some rows do not have any words left in their text. For the CountVectorizer and TfIdfVectorizer this does not pose a problem. Yet, for the Word2Vec algorithm this causes an error. There are different strategies to deal with these missing values.", "Here we will impute with placeholder text.", "Now that we have the cleaned text of the tweets, we can have a look at what are the most frequent words. Below we\u2019ll show the top 20 words. The most frequent word is \u201cflight\u201d.", "To check the performance of the models we\u2019ll need a test set. Evaluating on the train data would not be correct. You should not test on the same data used for training the model.", "First, we combine the TextCounts variables with the CleanText variable. Initially, I made the mistake to execute TextCounts and CleanText in the GridSearchCV. This took too long as it applies these functions each run of the GridSearch. It suffices to run them only once.", "So df_model now contains several variables. But our vectorizers (see below) will only need the clean_text variable. The TextCountsvariables can be added as such. To select columns, I wrote the class ColumnExtractor below.", "As we will see below, the vectorizers and classifiers all have configurable parameters. To choose the best parameters, we need to test on a separate validation set. This validation set was not used during the training. Yet, using only one validation set may not produce reliable validation results. Due to chance, you might have a good model performance on the validation set. If you would split the data otherwise, you might end up with other results. To get a more accurate estimation, we perform cross-validation.", "With cross-validation we split the data into a train and validation set many times. The evaluation metric is then averaged over the different folds. Luckily, GridSearchCV applies cross-validation out-of-the-box.", "To find the best parameters for both a vectorizer and classifier, we create a Pipeline.", "By default GridSearchCV uses the default scorer to compute the best_score_. For both the MultiNomialNb and LogisticRegression this default scoring metric is accuracy.", "In our function grid_vectwe additionally generate the classification_report on the test data. This provides some interesting metrics per target class. This might be more appropriate here. These metrics are the precision, recall and F1 score.", "With the elements of the confusion matrix we can calculate Precision and Recall.", "In the grid search, we will investigate the performance of the classifier. The set of parameters used to test the performance are specified below.", "Here we will compare the performance of a MultinomialNBand LogisticRegression.", "To use words in a classifier, we need to convert the words to numbers. Sklearn\u2019s CountVectorizer takes all words in all tweets, assigns an ID and counts the frequency of the word per tweet. We then use this bag of words as input for a classifier. This bag of words is a sparse data set. This means that each record will have many zeroes for the words not occurring in the tweet.", "One issue with CountVectorizer is that there might be words that occur frequently. These words might not have discriminatory information. Thus they can be removed. TF-IDF (term frequency \u2014 inverse document frequency) can be used to down-weight these frequent words.", "Another way of converting the words to numerical values is to use Word2Vec. Word2Vec maps each word in a multi-dimensional space. It does this by taking into account the context in which a word appears in the tweets. As a result, words that are similar are also close to each other in the multi-dimensional space.", "The Word2Vec algorithm is part of the gensim package.", "The Word2Vec algorithm uses lists of words as input. For that purpose, we use the word_tokenize method of the the nltk package.", "The Word2Vec model provides a vocabulary of the words in all the tweets. For each word you also have its vector values. The number of vector values is equal to the chosen size. These are the dimensions on which each word is mapped in the multi-dimensional space. Words with an occurrence less than min_count are not kept in the vocabulary.", "A side effect of the min_count parameter is that some tweets could have no vector values. This is would be the case when the word(s) in the tweet occur in less than min_count tweets. Due to the small corpus of tweets, there is a risk of this happening in our case. Thus we set the min_count value equal to 1.", "The tweets can have a different number of vectors, depending on the number of words it contains. To use this output for modeling we will calculate the average of all vectors per tweet. As such we will have the same number (i.e. size) of input variables per tweet.", "We do this with the function compute_avg_w2v_vector. In this function we also check whether the words in the tweet occur in the vocabulary of the Word2Vec model. If not, a list filled with 0.0 is returned. Else the average of the word vectors.", "This gives us a Series with a vector of dimension equal to SIZE. Now we will split this vector and create a DataFrame with each vector value in a separate column. That way we can concatenate the Word2Vec variables to the other TextCounts variables. We need to reuse the index of X_train and X_test. Otherwise this will give issues (duplicates) in the concatenation later on.", "We only consider LogisticRegression as we have negative values in the Word2Vec vectors. MultinomialNB assumes that the variables have a multinomial distribution. So they cannot contain negative values.", "For the fun, we will use the best model and apply it to some new tweets that contain \u201c@VirginAmerica\u201d. I selected 3 negative and 3 positive tweets by hand.", "Thanks to the GridSearchCV, we now know what are the best hyperparameters. So now we can train the best model on all training data, including the test data that we split off before.", "The model classifies all tweets correctly. A larger test set should be used to assess the model\u2019s performance. But on this small data set it does what we are aiming for.", "I hope you enjoyed reading this story. And if you did, feel free to clap for it.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F13dd2b33de27&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@bert.carremans?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bert.carremans?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Bert Carremans"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc67e7b9d12a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&user=Bert+Carremans&userId=c67e7b9d12a9&source=post_page-c67e7b9d12a9----13dd2b33de27---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@rvignes?utm_source=medium&utm_medium=referral", "anchor_text": "Romain Vignes"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://www.kaggle.com/crowdflower/twitter-airline-sentiment", "anchor_text": "Twitter US Airline Sentiment data set on Kaggle"}, {"url": "https://github.com/bertcarremans/TwitterUSAirlineSentiment", "anchor_text": "notebook on Github"}, {"url": "https://en.wikipedia.org/wiki/Confusion_matrix", "anchor_text": "confusion matrix"}, {"url": "http://scikit-learn.org/stable/auto_examples/model_selection/grid_search_text_feature_extraction.html", "anchor_text": "http://scikit-learn.org/stable/auto_examples/model_selection/grid_search_text_feature_extraction.html"}, {"url": "https://en.wikipedia.org/wiki/Tf%E2%80%93idf", "anchor_text": "TF-IDF (term frequency \u2014 inverse document frequency)"}, {"url": "https://radimrehurek.com/gensim/models/word2vec.html", "anchor_text": "gensim"}, {"url": "https://en.wikipedia.org/wiki/Multinomial_distribution", "anchor_text": "multinomial distribution"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----13dd2b33de27---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/data-science?source=post_page-----13dd2b33de27---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/text-mining?source=post_page-----13dd2b33de27---------------text_mining-----------------", "anchor_text": "Text Mining"}, {"url": "https://medium.com/tag/sentiment-analysis?source=post_page-----13dd2b33de27---------------sentiment_analysis-----------------", "anchor_text": "Sentiment Analysis"}, {"url": "https://medium.com/tag/nlp?source=post_page-----13dd2b33de27---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&user=Bert+Carremans&userId=c67e7b9d12a9&source=-----13dd2b33de27---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&user=Bert+Carremans&userId=c67e7b9d12a9&source=-----13dd2b33de27---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F13dd2b33de27&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----13dd2b33de27---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----13dd2b33de27--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----13dd2b33de27--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----13dd2b33de27--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bert.carremans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@bert.carremans?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Bert Carremans"}, {"url": "https://medium.com/@bert.carremans/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "640 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc67e7b9d12a9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&user=Bert+Carremans&userId=c67e7b9d12a9&source=post_page-c67e7b9d12a9--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F68f746403bb9&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsentiment-analysis-with-text-mining-13dd2b33de27&newsletterV3=c67e7b9d12a9&newsletterV3Id=68f746403bb9&user=Bert+Carremans&userId=c67e7b9d12a9&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}