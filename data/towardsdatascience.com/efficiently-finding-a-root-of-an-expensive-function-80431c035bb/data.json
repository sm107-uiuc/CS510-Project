{"url": "https://towardsdatascience.com/efficiently-finding-a-root-of-an-expensive-function-80431c035bb", "time": 1683001420.577803, "path": "towardsdatascience.com/efficiently-finding-a-root-of-an-expensive-function-80431c035bb/", "webpage": {"metadata": {"title": "Efficiently Finding a Root of an Expensive Function | by Don Cross | Towards Data Science", "h1": "Efficiently Finding a Root of an Expensive Function", "description": "Sometimes in scientific programming, you need to work with a smooth, real-valued function f(t) that is expensive to calculate. Specifically, you may need to find where the value of the function\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/cosinekitty/astronomy", "anchor_text": "open-source astronomy library", "paragraph_index": 0}, {"url": "https://github.com/cosinekitty/astronomy/blob/master/source/python/astronomy.py", "anchor_text": "Python version of Astronomy Engine", "paragraph_index": 29}], "all_paragraphs": ["Sometimes in scientific programming, you need to work with a smooth, real-valued function f(t) that is expensive to calculate. Specifically, you may need to find where the value of the function becomes zero. I encountered this recently while working on my open-source astronomy library. I want to solve for the time of moonrise and moonset. This involves calculating the rotation of the Earth and the orbit of the Moon around the Earth, to determine when the moon appears to cross the horizon as seen by an observer at a particular geographic location.", "In my case, f(t) is the Moon\u2019s apparent angular altitude above or below the horizon, as seen by the observer at time t. Finding a moonrise or moonset time means finding the value of t such that f(t)=0. In mathematical terms, I wanted to find a root of the function f.", "Evaluating f(t) includes calculating the Moon\u2019s position, which requires thousands of floating point operations. I wanted to minimize the number of times I had to evaluate f(t) as I homed in on a sufficiently good value of t. I sought a time that is accurate to within a few seconds.", "A reasonably good approach for solving a problem like this is to find a time t\u2080 before the root and another time t\u2081 after the root. Assume that you know that the time interval is small enough that there can\u2019t be more than one root within it. (In my example, I know it\u2019s not possible for there to be more than one moonrise within 1 hour.)", "Suppose you determine that f(t\u2080)<0 and f(t\u2081)>0. The situation looks like this:", "Given that f is a continuous function, there must be at least one value of t between t\u2080 and t\u2081 such that f(t)=0. There is no way for a continuous function to go from a negative value to a positive value without passing through zero.", "To make progress, we evaluate the function at the time t\u2082 in the middle of the interval:", "Suppose you find that f(t\u2082)<0. Now you have learned some new information. You have discovered that the root must be somewhere in the narrower interval t\u2082<t<t\u2081:", "Alternatively, if you find that f(t\u2082)>0, you can constrain your search to the half-interval on the left, t\u2080<t<t\u2082.", "Either way, you can keep cutting the interval in half and picking which half must contain the root. Doing this repeatedly is called a binary search. You can keep iterating until the size of the time interval is tolerably small.", "Like I said, a binary search is a reasonably fast approach. But under certain conditions, it is much faster to use quadratic interpolation than a binary search to find a root of the function. Here are the conditions:", "The setup is similar to the binary search above, in that you evaluate the function at three equally spaced argument values t. The difference is that you find the unique quadratic function that passes through the three points. The quadratic function approximates the value of the expensive function f over the small interval. The quadratic function looks like the red curve here:", "Once you have the formula for the parabola that passes through the three points, you can use the quadratic formula to solve for the value of t where the parabola crosses the t-axis.", "So how do you find the parabola? Let\u2019s do this in steps. First, we will substitute the time variable t that varies over the range t\u2080\u2264t\u2264t\u2081 with an abstract parameter x that has a more convenient range \u22121\u2264x\u2264+1. This will make the math simpler.", "Take a moment to verify that", "The third case is true because t\u2082 is halfway between t\u2080 and t\u2081, and therefore the numerator and denominator are equal.", "The second step is to write a generic parabolic function p(x):", "There is always exactly one parabolic curve that passes through the three points. Our next goal is to find values of Q, R, and S that cause the parabolic curve p(x) to pass through the three points we have evaluated for the expensive function f. We write three linear equations that reflect this requirement:", "Solving this system of three linear equations in terms of the known values f(t\u2080), f(t\u2082), and f(t\u2081), we find:", "Before going any further, your algorithm must check for special cases. If Q=0, it means a straight line, not a parabola, passes through all three points. In other words, p(x) = Rx + S. Solve for the root to find x = \u2212S/R. When Q=0, you also have check for R=0 to avoid division by zero. This is the case where the line is horizontal and thus has no zero-crossing. Otherwise, if Q is not zero, proceed with the following steps to find 0, 1, or 2 real roots.", "To find the root(s) of the quadratic curve p(x) when Q\u22600, we use the familiar quadratic formula:", "The next special case is whether the radicand R\u00b2\u22124QS is negative. If R\u00b2\u22124QS < 0, there are no real roots of p(x). This happens when p(x) is always positive or always negative for all values of x. Because the parabola never crosses through zero, your solver must report a failure.", "You must decide in your own application how to handle the case where R\u00b2\u22124QS = 0. When the radicand is zero, it indicates that p(x) has a tangent root, meaning the parabola\u2019s vertex just touches the horizontal axis but does not pass through it, like this:", "In my astronomy code, it did not make sense to count this as a moonrise or a moonset. Therefore, I chose to treat R\u00b2\u22124QS \u2264 0 as a failure. This behavior is reflected in the sample Python code below.", "If you have ruled out the special cases mentioned above, now you have two candidate values of x, thanks to the \u00b1 operator in the quadratic formula. Your code should check both values to see which of them, if either, is inside the range \u22121\u2264x\u2264+1. Any value of x outside this range should be discarded because it is outside your specified search interval. Even if you wanted to use one of these outliers, the parabola cannot be trusted as a good approximation of the original function f very far outside the search interval.", "In my astronomical use case, I know a priori that my search interval must contain at most one valid root. Therefore, I also report a failure if two values of x satisfy the search interval.", "Assuming you end up with a unique valid value of x, the final step is to translate x back into your independent variable t:", "And there you have it. By evaluating an expensive function only three times, and assuming the function is sufficiently parabolic within the enclosed interval, we now have a good approximation of t such that f(t)=0.", "But how accurate is t? There is no simple answer to that question. You will have to experiment with your own function and interval sizes to find out.", "You may find a hybrid approach helpful: first use a binary search to narrow in on a small enough interval (based on experimental testing), then finish the job with a quadratic interpolation. My own algorithm (see the function Search in the Python version of Astronomy Engine) uses a more complicated hybrid that tries to guess very small intervals for quadratic interpolation, which works most of the time. It falls back to the binary search when the guess is incorrect. In my performance testing, this is just as accurate as the \u201cpure\u201d binary search, but with about 1/6 of the computation time.", "Here is sample Python code that illustrates using quadratic interpolation to find approximate roots. Feel free to use the function QuadraticInterpolate as a starting point for your own applications.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F80431c035bb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----80431c035bb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@cosinekitty?source=post_page-----80431c035bb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Don Cross"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2d2166d7d92&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&user=Don+Cross&userId=e2d2166d7d92&source=post_page-e2d2166d7d92----80431c035bb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@joshriemer?utm_source=medium&utm_medium=referral", "anchor_text": "Josh Riemer"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://github.com/cosinekitty/astronomy", "anchor_text": "open-source astronomy library"}, {"url": "https://github.com/cosinekitty/astronomy/blob/master/source/python/astronomy.py", "anchor_text": "Python version of Astronomy Engine"}, {"url": "https://medium.com/tag/programming?source=post_page-----80431c035bb---------------programming-----------------", "anchor_text": "Programming"}, {"url": "https://medium.com/tag/data-science?source=post_page-----80431c035bb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/mathematics?source=post_page-----80431c035bb---------------mathematics-----------------", "anchor_text": "Mathematics"}, {"url": "https://medium.com/tag/software-development?source=post_page-----80431c035bb---------------software_development-----------------", "anchor_text": "Software Development"}, {"url": "https://medium.com/tag/science?source=post_page-----80431c035bb---------------science-----------------", "anchor_text": "Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&user=Don+Cross&userId=e2d2166d7d92&source=-----80431c035bb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&user=Don+Cross&userId=e2d2166d7d92&source=-----80431c035bb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----80431c035bb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F80431c035bb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----80431c035bb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----80431c035bb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----80431c035bb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----80431c035bb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----80431c035bb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----80431c035bb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@cosinekitty?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Don Cross"}, {"url": "https://medium.com/@cosinekitty/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "534 Followers"}, {"url": "https://github.com/cosinekitty", "anchor_text": "https://github.com/cosinekitty"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fe2d2166d7d92&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&user=Don+Cross&userId=e2d2166d7d92&source=post_page-e2d2166d7d92--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F376b6ecea8c2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fefficiently-finding-a-root-of-an-expensive-function-80431c035bb&newsletterV3=e2d2166d7d92&newsletterV3Id=376b6ecea8c2&user=Don+Cross&userId=e2d2166d7d92&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}