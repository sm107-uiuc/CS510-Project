{"url": "https://towardsdatascience.com/teaching-new-tricks-to-an-old-camera-5ab37f4a4406", "time": 1683011971.361453, "path": "towardsdatascience.com/teaching-new-tricks-to-an-old-camera-5ab37f4a4406/", "webpage": {"metadata": {"title": "Teaching New Tricks To An Old Camera | by Juan Altmayer Pizzorno | Towards Data Science", "h1": "Teaching New Tricks To An Old Camera", "description": "Living in the boonies, I\u2019m fortunate that for many food items I can just walk to the local farm. For most other things, though, my family shops online. This year our fairly long driveway really\u2026"}, "outgoing_paragraph_urls": [{"url": "https://www.axis.com/en-us/products/axis-q6035-e", "anchor_text": "\u201cairport class\u201d camera", "paragraph_index": 1}, {"url": "https://en.wikipedia.org/wiki/Power_over_Ethernet", "anchor_text": "PoE", "paragraph_index": 2}, {"url": "https://github.com/jaltmayerpizzorno/d2k", "anchor_text": "YOLO v3/v4 object detector", "paragraph_index": 3}, {"url": "https://en.wikipedia.org/wiki/ETRAX_CRIS", "anchor_text": "a custom chip", "paragraph_index": 3}, {"url": "https://coral.withgoogle.com/products/accelerator", "anchor_text": "an accelerator", "paragraph_index": 3}, {"url": "https://www.java.com/en/download/faq/chrome.xml", "anchor_text": "yeah, right", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Server_Message_Block", "anchor_text": "SMBv1", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Incantation", "anchor_text": "incantation", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol", "anchor_text": "RTSP stream", "paragraph_index": 6}, {"url": "https://pjreddie.com/darknet/yolo/", "anchor_text": "original YOLOv3", "paragraph_index": 9}, {"url": "https://en.wikipedia.org/wiki/Pan%E2%80%93tilt%E2%80%93zoom_camera", "anchor_text": "PTZ", "paragraph_index": 10}, {"url": "http://www.port25.com", "anchor_text": "previous work", "paragraph_index": 11}, {"url": "https://www.tensorflow.org/guide/data", "anchor_text": "tf.data", "paragraph_index": 13}, {"url": "https://en.wikipedia.org/wiki/Raspberry_Pi", "anchor_text": "Raspberry Pi", "paragraph_index": 16}, {"url": "https://en.wikipedia.org/wiki/Arduino", "anchor_text": "Arduino", "paragraph_index": 16}, {"url": "https://gist.github.com/jaltmayerpizzorno/935b021acdb3b562031f374b7deddfea", "anchor_text": "check it out on GitHub", "paragraph_index": 17}, {"url": "https://en.wikipedia.org/wiki/Test-driven_development", "anchor_text": "test driven", "paragraph_index": 18}], "all_paragraphs": ["Living in the boonies, I\u2019m fortunate that for many food items I can just walk to the local farm. For most other things, though, my family shops online. This year our fairly long driveway really needed to be re-paved, which meant that for two months, no delivery or other heavy trucks could drive on it. We put a box for deliveries at the end of the driveway, but we can\u2019t see it from our house, so both for convenience and safety we really wanted a camera on it.", "I figured a good place to mount a camera was an existing utility pole by the driveway (inside the property), which is a bit less than 100m (328 ft) from the house and some 50m (164 ft) from the box; the question then was how to best bring power and connectivity to it. There are lots of ways one could do this, from batteries, solar cells and cell networks to radio links and cables. Wanting to keep costs down, I thought of the 10 or so year old \u201cairport class\u201d camera I had unused in my basement.", "The pole was within PoE range, so to run it I just needed some direct burial cable. I could solve the delivery box notification problem with minimal cost, put the camera to use AND use some deep learning to get a modern detector\u2026 that was too good a project to pass up!", "After most of a sweaty day climbing the pole, burying, routing, securing and crimping cables, I had the camera up and running. Following a path of least resistance, but also to see what I would learn, I decided to have the camera continuously record over the network onto a Linux system and to process it there using a YOLO v3/v4 object detector I wrote some time ago. I would have loved to run the inference right on the camera, but its CPU (a custom chip) and its storage are tiny and there\u2019s no USB port for an accelerator.", "While quite feature rich, the camera is old enough to make some things hard to use. It has a motion detection feature, for example, but requires Java applet support in the browser to easily configure\u2026 yeah, right. And it can record to network attached storage, but only using the SMBv1 protocol. Installing samba on my system was a matter of sudo apt install samba, but it took some more serious research to find the \u201cincantation\u201d needed in /etc/samba/smb.conf so it\u2019d speak SMBv1:", "By recording to the Linux system, I got easy access to the data (no need to research its API for processing on the camera itself), the ability to re-process data at will as I tweaked my code and neural net, and longer term archival. I used OpenCV to read the files and to create small clips that I include in the notifications.", "Running the detection off the files did introduce a bit of a delay, though: the recording is done in one-minute segments, and it isn\u2019t processed until it is finished; add to that a few seconds for the script to notice that there is a new file, a few more for running inference on it, and a few more to send out any notifications. All in all, it could take about a minute and a half between the detected event and its notification. I thought that was good enough, but another option would have been to process the video using an RTSP stream, which both the camera and OpenCV support.", "The camera\u2019s view of the driveway entrance also includes some of the road, and you wouldn\u2019t believe just how much goes by a quiet country road\u2026 until you get notified about each one. Not just cars and trucks, but also neighbors walking their dog at 5 am, a turkey family or (non skid steer) bobcat going by.", "In my case, the border between \u201cin\u201d and \u201cout\u201d is a straight line, which makes the road simple to ignore:", "I also filter out all but a few detection classes: I used the original YOLOv3 weights trained using the COCO dataset, which includes classes such as \u201ctoothbrush\u201d, \u201czebra\u201d and \u201cfire hydrant\u201d. Realistically any such detections would be false positives.", "Since the camera is PTZ, at the start I ambitiously thought I\u2019d train a neural network to recognize where it was pointed and adjust the relevant detection area. I might still try that, but for now it was simpler to just not change the orientation.", "For the notifications, given my previous work, it seemed easiest to email myself, with the credentials coming from a JSON file so that they\u2019re not in the code.", "For each detection sequence, I include a small MP4 clip and a corresponding \u201crepresentative\u201d image in higher resolution. Usually the image is all I need, but the clip, which also plays on my phone, can be instrumental to understand what is going on, such as when someone decides to turn around at the entrance. I use the frame with the the largest area in bounding boxes for the \u201crepresentative\u201d image.", "The camera is set to record 1080p video at 15 FPS. On my Linux system, using a tf.data pipeline and only using the CPU, I can process that at about 4 FPS, so I needed it to be faster. Significantly faster, in fact, so that it could catch up if interrupted. Some options were:", "All in all, on my 4.5 GHz Intel i9\u201310900X, 32GB RAM Linux system I can process a one-minute segment in just below 10s, or less if I let it use the GPU.", "I didn\u2019t really evaluate this accuracy wise, but did run into some false positives\u2026 If I decide to run this system longer term, I will likely fine tune it to avoid these.", "The driveway is drivable again and the deliveries box is gone\u2026 having said that, most of those things I mentioned not having done or completed could become projects. I might try running something on the camera itself or on a Raspberry Pi or Arduino. It would also be cool to use the camera\u2019s PTZ to track detections.", "It\u2019s down below, but you can also check it out on GitHub.", "Use at your own risk! I normally develop code test driven, but I was experimenting a lot here and didn\u2019t treat this project to TDD.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5ab37f4a4406&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@juan.pizzorno?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@juan.pizzorno?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Juan Altmayer Pizzorno"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb137a111e945&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&user=Juan+Altmayer+Pizzorno&userId=b137a111e945&source=post_page-b137a111e945----5ab37f4a4406---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://www.axis.com/en-us/products/axis-q6035-e", "anchor_text": "\u201cairport class\u201d camera"}, {"url": "https://en.wikipedia.org/wiki/Power_over_Ethernet", "anchor_text": "PoE"}, {"url": "https://github.com/jaltmayerpizzorno/d2k", "anchor_text": "YOLO v3/v4 object detector"}, {"url": "https://en.wikipedia.org/wiki/ETRAX_CRIS", "anchor_text": "a custom chip"}, {"url": "https://coral.withgoogle.com/products/accelerator", "anchor_text": "an accelerator"}, {"url": "https://www.java.com/en/download/faq/chrome.xml", "anchor_text": "yeah, right"}, {"url": "https://en.wikipedia.org/wiki/Server_Message_Block", "anchor_text": "SMBv1"}, {"url": "https://en.wikipedia.org/wiki/Incantation", "anchor_text": "incantation"}, {"url": "https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol", "anchor_text": "RTSP stream"}, {"url": "https://pjreddie.com/darknet/yolo/", "anchor_text": "original YOLOv3"}, {"url": "https://en.wikipedia.org/wiki/Pan%E2%80%93tilt%E2%80%93zoom_camera", "anchor_text": "PTZ"}, {"url": "http://www.port25.com", "anchor_text": "previous work"}, {"url": "https://www.tensorflow.org/guide/data", "anchor_text": "tf.data"}, {"url": "https://docs.opencv.org/3.4/d6/d0f/group__dnn.html#gafde362956af949cce087f3f25c6aff0d", "anchor_text": "readNetFromDarkne"}, {"url": "https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/", "anchor_text": "TensorFlow object detection API"}, {"url": "https://towardsdatascience.com/edge-ai-cc478f9fbb5a", "anchor_text": "edge ML"}, {"url": "https://en.wikipedia.org/wiki/Raspberry_Pi", "anchor_text": "Raspberry Pi"}, {"url": "https://en.wikipedia.org/wiki/Arduino", "anchor_text": "Arduino"}, {"url": "https://gist.github.com/jaltmayerpizzorno/935b021acdb3b562031f374b7deddfea", "anchor_text": "check it out on GitHub"}, {"url": "https://en.wikipedia.org/wiki/Test-driven_development", "anchor_text": "test driven"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----5ab37f4a4406---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/tag/real-life-stories?source=post_page-----5ab37f4a4406---------------real_life_stories-----------------", "anchor_text": "Real Life Stories"}, {"url": "https://medium.com/tag/projects?source=post_page-----5ab37f4a4406---------------projects-----------------", "anchor_text": "Projects"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&user=Juan+Altmayer+Pizzorno&userId=b137a111e945&source=-----5ab37f4a4406---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&user=Juan+Altmayer+Pizzorno&userId=b137a111e945&source=-----5ab37f4a4406---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5ab37f4a4406&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5ab37f4a4406---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5ab37f4a4406--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@juan.pizzorno?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@juan.pizzorno?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Juan Altmayer Pizzorno"}, {"url": "https://medium.com/@juan.pizzorno/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "9 Followers"}, {"url": "http://jaltmayerpizzorno.github.io", "anchor_text": "jaltmayerpizzorno.github.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb137a111e945&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&user=Juan+Altmayer+Pizzorno&userId=b137a111e945&source=post_page-b137a111e945--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fb137a111e945%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fteaching-new-tricks-to-an-old-camera-5ab37f4a4406&user=Juan+Altmayer+Pizzorno&userId=b137a111e945&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}