{"url": "https://towardsdatascience.com/building-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1", "time": 1683006282.4706612, "path": "towardsdatascience.com/building-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1/", "webpage": {"metadata": {"title": "Building a Distance Violation Detector (D.V.D)for a post-Lockdown era | by Devrup Banerjee | Towards Data Science", "h1": "Building a Distance Violation Detector (D.V.D)for a post-Lockdown era", "description": "As countries start harboring the idea of relaxing lockdown norms, maintaining a physical distance of more than 5 feet or above between people finally going out may play a crucial role in stalling the\u2026"}, "outgoing_paragraph_urls": [{"url": "https://docs.opencv.org/3.4/db/d28/tutorial_cascade_classifier.html", "anchor_text": "here", "paragraph_index": 3}, {"url": "https://www.geeksforgeeks.org/send-mail-attachment-gmail-account-using-python/", "anchor_text": "here", "paragraph_index": 5}, {"url": "http://www.cs.cmu.edu.", "anchor_text": "www.cs.cmu.edu.", "paragraph_index": 17}], "all_paragraphs": ["As countries start harboring the idea of relaxing lockdown norms, maintaining a physical distance of more than 5 feet or above between people finally going out may play a crucial role in stalling the spread of Covid-19.", "I was first introduced to this idea (Coldewey, 2020) by a computer software company in San Francisco California, Zensors. This program monitors and tracks crowd in real-time through CCTV footage, looking out for people or groups coming closer to each other by less than 5\u20136 feet. A red box is drawn on such groups to inform the monitoring authorities of the same.", "A person constantly monitoring security cameras to identify the red blocks for violation may sound like a waste of valuable human resources. Thus I have integrated a mailing feature with the program, which instantaneously informs the authority of any distancing violations as soon as it identifies one. The definition of violation can be set as per criteria set by local authorities, which may vary from 2 people walking together to a gathering of more than 20 people. Below are the code and explanation. It has been compiled on Google Collab with GPU runtime.", "I have decided to use a very simple classifier namely Haar Cascade Classifiers for full-body detection which is a pre-trained classifier developed by (Paul Viola, 2001). If you want to read more about the detection module on this classifier you can read it here. This is available in the OpenCV library. Recent developments have resulted in better and faster classifiers like faster R-CNNS and YOLO which I would be trying to use in future versions to improve this model.", "Here an instance of the classifier has been loaded in person_clf, and the output directory for the analyzed video with violation markings has been set. cv2.VideoCapture is used for loading our test video and is a prebuilt callable function of the cv2 object.", "Building functions for your project is a good way to assist in transfer learning when doing similar\u00a0work. Thus I have made two base functions here one for finding centers between two points and the other for sending mailers to a target with attachments. I will explain the center function in detail below. The mailer function takes the name of the pic, which gets stored in my Google drive, having the violation moment, and attaches it into a mail with a message body and sends it to target. I found this article here really informative and used it to incorporate this.", "Right now to the main function. To understand the main code we have to first understand the hierarchy in which different kinds of loops are operating and the work they are doing.", "We call the cap instance where our input video is stored and open it so that we can process one Frame at a time. This is our first while loop, and all code hence will be inside it. We also start 3 counters. \u2018I\u2019 to keep count of the Frames being processed, \u2018contn_frame_with_detection\u2019 to keep the number of continuous frames where a violation has been detected and \u2018skipped_frames\u2019 to keep the count of frames between detected frames where no violation was found. The idea of skipped frames will be discussed later.", "Here another counter \u2018frame_violator\u2019 is initiated to count the number of times violation is detected in each frame. Some authorities may like to keep it high if they need to detect only large congregations and ignore 2,3 people walking together. person_id is set at 1 in anticipation of the first person getting detected in the first frame. \u2018cap.read()\u2019 helps us read the frame and store for further processing. Its also instructed to break when the frame ends.", "We need to first resize the frame with cv2.resize(), to about 60% so that calculations can be done in real-time without compromising on speed. If you have faster processors than Google Collab Gpu you can keep it higher. cv2.INTER_LANCZOS4 is generally said to be the best interpolation method, but other methods like INTER_LINEAR, INTER_AREA may also be used depending on the upsampling or downsampling of the image. COLOR_BGR2GRAY method is used to convert a BGR image(which is how OpenCV reads images) having 3 channels to grayscale having just 1 channel. As can be seen, while making convolution layers even, the computation is far lower in grayscale without losing much information, and thus easier for the machine to process. Hence we use the detectMutiScale method of cv2 detect persons in the given frame from the grayed image. Its to be noted, this returns the starting and ending coordinates of the diagonal of a rectangle inside which the detected person can be found. We store these coordinates inside persons variable to loop through it later one by one.", "The above code forms the logical heart of this algorithm. We first start looping through each person individually(For Loop A) and store the coordinates of a rectangle in a python dictionary, named in format [\u2018box-person_id-x\u2019]: value. Then we call our center function to find the center of mass of this person and store it in a list. The function center takes in the person_id whose center of mass is to be calculated, retrieves his data from the dictionary of start and endpoints, and calculates the center coordinate. Now as per our hierarchy a second loop is initialized(For Loop B) when the person_id in a frame is more than 0,( effectively meaning more than two-person), its distance from each of the previously detected person\u2019s center of mass is calculated by simple Euclidian distance formula. If a violation is detected, feed_detector is increased by one, indicating the ingoing feed has a violation, a red box is drawn around detected violations with cv2.rectangle keeping color dimension as (0,0,255) indicating red for BGR format which is used by cv2.", "A skipped frame counter is introduced to account for the False Negatives of our model. There will be many frames in between two detected frames of violation, where the HAAR classifier may not be able to even detect all people. This will result in falsely identifying a frame as no violation. Thus when we see the number of continuous frames where a violation was detected, we also have to see if skipped frames are kept below a certain number. If skipped_frame is greater than say 5, it may mean that the frames where a violation was occurring previously were in reality maybe just false positives, and we should again thus set the continuous_frame_counter to 0 and skipped_frames to 0 start the counting again.", "To reinforce the detections as true positives, we only consider a major violation of distance when the continuous_frame_counter goes above 25 (or higher depending on the needs of the user),", "we take a pic at this point by calling the cv2.imwrite function and call our pre-defined mailer function to feed the name of the jpg image. This mailer function thus instantaneously sends a mail to the target user updating him of the situation.", "Lastly, we make an instance of cv2.VideoWriter and save our video file in XviD format, one frame at a time.", "After the end of frames is reached we release the writer, cap, and destroy all windows of by cv2.destroyAllWindows() so that the computer doesn\u2019t crash. Below is a sample output of the program", "Ok, so that is quite a lot of loops to understand in one day. I have tried to build every function from scratch and implement the whole thing by logic thus those complicated loops. I will be posting on how to deploy this on the web, using maybe an EC2 instance of Azure ml. I hope you liked the intuition behind the program and were able to appreciate the various counters and loops used for building it. Anyone having any ideas, to maybe add some feature to this program or make it run faster can definitely reach out to me. Till then, live long and data science.", "Paul Viola, M. J. (2001). Rapid Object Detection using a Boosted Cascade of Simple Features. www.cs.cmu.edu.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Data Science enthusiast, a creator, and implementer of analytical and AI-driven solutions"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5b9894f5a6b1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@rightskewed?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rightskewed?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Devrup Banerjee"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F227150530ceb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&user=Devrup+Banerjee&userId=227150530ceb&source=post_page-227150530ceb----5b9894f5a6b1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://docs.opencv.org/3.4/db/d28/tutorial_cascade_classifier.html", "anchor_text": "here"}, {"url": "https://www.geeksforgeeks.org/send-mail-attachment-gmail-account-using-python/", "anchor_text": "here"}, {"url": "https://techcrunch.com/activity-monitoring-startup-zensors-repurposes-its-tech-to-help-coronavirus-response.", "anchor_text": "https://techcrunch.com/activity-monitoring-startup-zensors-repurposes-its-tech-to-help-coronavirus-response."}, {"url": "https://techcrunch.com/2020/04/02/activity-monitoring-startup-zensors-repurposes-its-tech-to-help-coronavirus-response/", "anchor_text": "https://techcrunch.com/2020/04/02/activity-monitoring-startup-zensors-repurposes-its-tech-to-help-coronavirus-response/"}, {"url": "https://github.com/opencv/opencv/tree/master/data/haarcascades", "anchor_text": "https://github.com/opencv/opencv/tree/master/data/haarcascades"}, {"url": "http://www.cs.cmu.edu.", "anchor_text": "www.cs.cmu.edu."}, {"url": "https://medium.com/tag/data-science?source=post_page-----5b9894f5a6b1---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----5b9894f5a6b1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/computer-vision?source=post_page-----5b9894f5a6b1---------------computer_vision-----------------", "anchor_text": "Computer Vision"}, {"url": "https://medium.com/tag/opencv?source=post_page-----5b9894f5a6b1---------------opencv-----------------", "anchor_text": "Opencv"}, {"url": "https://medium.com/tag/object-detection?source=post_page-----5b9894f5a6b1---------------object_detection-----------------", "anchor_text": "Object Detection"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&user=Devrup+Banerjee&userId=227150530ceb&source=-----5b9894f5a6b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&user=Devrup+Banerjee&userId=227150530ceb&source=-----5b9894f5a6b1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F5b9894f5a6b1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----5b9894f5a6b1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----5b9894f5a6b1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rightskewed?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@rightskewed?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Devrup Banerjee"}, {"url": "https://medium.com/@rightskewed/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "16 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F227150530ceb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&user=Devrup+Banerjee&userId=227150530ceb&source=post_page-227150530ceb--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2F227150530ceb%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fbuilding-a-distance-violation-detector-d-v-d-for-a-post-lockdown-era-5b9894f5a6b1&user=Devrup+Banerjee&userId=227150530ceb&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}