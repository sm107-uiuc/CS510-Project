{"url": "https://towardsdatascience.com/earth-movers-distance-68fff0363ef2", "time": 1682995698.846196, "path": "towardsdatascience.com/earth-movers-distance-68fff0363ef2/", "webpage": {"metadata": {"title": "Earth mover's distance, semantic search | Towards Data Science", "h1": "Earth mover\u2019s distance", "description": "Earth mover distance is an algorithm to apply to semantic search, used by Google search. This is an introductory tutorial to learn the steps of the algorithm."}, "outgoing_paragraph_urls": [{"url": "https://anebz.eu/semantic-search", "anchor_text": "Semantic search", "paragraph_index": 0}, {"url": "https://towardsdatascience.com/overview-of-text-similarity-metrics-3397c4601f50", "anchor_text": "more centered in theory", "paragraph_index": 13}, {"url": "https://medium.com/@adriensieg/text-similarities-da019229c894", "anchor_text": "more practical", "paragraph_index": 13}, {"url": "https://anebz.eu/semantic-search", "anchor_text": "semantic search", "paragraph_index": 43}, {"url": "https://markroxor.github.io/gensim/static/notebooks/WMD_tutorial.html", "anchor_text": "implementation tutorials", "paragraph_index": 44}, {"url": "https://www.dropbox.com/s/7wd6110uiyqa835/semantic_search.pdf?dl=0", "anchor_text": "Semantic search", "paragraph_index": 47}, {"url": "https://dl.acm.org/citation.cfm?id=2666194", "anchor_text": "Towards Named-Entity-based similarity measures: challenges and opportunities", "paragraph_index": 48}, {"url": "http://infolab.stanford.edu/pub/cstr/reports/cs/tr/99/1620/CS-TR-99-1620.pdf", "anchor_text": "Finding color and shape patterns in images", "paragraph_index": 49}, {"url": "http://www.d.umn.edu/~tpederse/Pubs/patwardhan.pdf", "anchor_text": "Incorporating Dictionary and Corpus Information into a Context Vector Measure of Semantic Relatedness", "paragraph_index": 50}, {"url": "https://www.researchgate.net/publication/221613335_The_earth_mover's_distance_as_a_semantic_measure_for_document_similarity", "anchor_text": "The Earth Mover\u2019s Distance as a Semantic Measure for Document Similarity", "paragraph_index": 51}, {"url": "http://proceedings.mlr.press/v37/kusnerb15.pdf", "anchor_text": "From Word Embeddings To Document Distances", "paragraph_index": 52}], "all_paragraphs": ["This is the sequel of my initial Semantic search post. This one is about the Earth mover\u2019s distance, which can be applied in semantic search.", "The way semantic search engines retrieve results from their ontology is by computing the closest / most similar documents to the query. In order to get the top most similar documents, the algorithm computes the distance between the query and many documents. When the similarities are obtained, the documents are ranked accordingly and the ones at the top are retrieved.", "For example, imagine that the ontology has 5 documents:", "First we compute the distance between the query and the 5 documents, and the one(s) with the highest similarity are returned to the user.", "What is this distance between documents? Humans can quickly know which document is the most appropriate for this query, because language is inherent to us and we understand the meaning of each word and and also the sentence as a whole, we can even predict what each document is about. Simple grammatical mistakes or a slightly different word order doesn\u2019t affect our thinking process.", "In a matter of seconds, we reach the conclusion that document #3 is the closest one: even if the user may not have a marine biology background, the marine biologist\u2019s experience might prove useful.", "But how does a computer calculate the distance between two sentences? A sentence isn\u2019t just a sequence of words: each word has its place, there\u2019s an invisible underlying grammatical structure that we intuitively understand because we\u2019ve been exposed to language since birth, but computers have historically had trouble gaining this \u2018intuition\u2019.", "A simple document similarity measure would be counting how many words there are in common between the two sentences, regardless of the position:", "According to this metric, document #5 is the most similar one to the query. But we quickly realize that some words are irrelevant, \u2018a\u2019. \u2018how\u2019, \u2018in\u2019 and such words don\u2019t add meaning to the sentence. These words are called stopwords and are removed in most text processing algorithms.", "Slight variations in words aren\u2019t included in this metric either. Verbs in present vs. past tense, singular vs. plural words, adverbs vs. adjectives, etc. are regarded as different words when in reality, they refer to almost the same term. Stemming, lemmatizing and tokenization are methods for obtaining the root form of the word.", "Lastly, document #3 should get points for including the word \u2018job\u2019, which in this context, is a synonym of \u2018career\u2019. \u2018career\u2019 and \u2018job\u2019 should be processed as if they were equivalent., the same as the word \u2018career\u2019 in document #5. Including synonym coverage in the algorithm can greatly improve performance.", "And if we dig deep, one may argue that \u2018how do I do X\u2019 is similar in meaning to \u2018someone\u2019s guide to doing X\u2019, although implementing that is another story.", "As a summary, the motivation of using semantic document similarity measures is to improve existing measures by using semantic features such as synonyms, hyponyms, etc.", "There are many document similarity measures, lexical and semantic. You can read about many of them, more centered in theory or more practical.", "This post is about the Earth mover\u2019s distance (EMD), one of the semantic approaches, where the meaning of the words and the intent of the user are considered.", "In the case of EMD, the distance between documents is based on semantic distances between words, where words are stored in an electronical lexical database called WordNet. Once the semantic distances between words are obtained, the EMD calculates the document similarity with a many-to-many matching between words. That is, three words in one document can be equivalent in meaning to just one word in the other document. [1]", "Let\u2019s abstract from sentences, words and documents and let\u2019s imagine a document is a distribution of weighted points. The distributions are tuples of positions and weights.", "The EMD between two distributions is proportional to the minimum amount of work required to convert one distribution into the other.", "1 unit of work is the amount of work necessary to move one unit of weight by one unit of distance.", "Intuitively, the weight flows from one distribution to the other until they are identical, similar to filing holes with piles of dirt. One distribution acts as a group of holes, while the points of the other distribution are dirt. [2]", "From an initial point where the two distributions are displayed in the space, one distribution is assigned the role of dirt and the other holes, each point of dirt is assigned to a point of hole (not necessarily one point of dirt for each point of hole), and iteratively the dirt \u2018moves\u2019 towards the hole, until it fills it.", "The cost/work of moving the dirt depends on the weight/amount of dirt and the distance it needs to cover.", "The ground distance metric between points can be Euclidean, Manhattan\u2026 but don\u2019t confuse this distance with the distance between words. This ground distance is merely the distance between points in the dimensional space.", "In example #2, the distance that the red distribution has to cover is greater than in example #1, so it will take more work to \u2018move the dirt\u2019.", "The goal of the EMD algorithm is to optimize how to distribute the weights so that all of the dirt covers all of the holes while moving the weights through the minimum distance possible.", "Note: in this scenario, the two distributions are balanced, that is, the amount of dirt equals the amount of hole. There\u2019s no dirt left once all the holes are covered, or there\u2019s no extra holes once all the dirt has been placed. If you want to see imbalanced distributions, consider reading [2].", "There are many ways to distribute the weights, the leftmost dirt point in the red distribution could be matched to the lowest hole point in the blue distribution, but this wouldn\u2019t be very efficient. One step in calculating the EMD is obtaining the most feasible flow between the two distributions.", "Notation and formulas can be found in the slides of my presentation [0]. I\u2019ve tried to keep this post more theoretical and intuitive, without getting too deep in the mathematics.", "Given two distributions, x and y, a flow between them is any matrix F that defines a weight distribution among x and y. Each point in the matrix F, f_ij, represents the amount of weight at x_i matched to y_j.", "Note: emphasis on the any, a flow can be any weight distribution, efficient or not. Finding an efficient/feasible flow is an optimization problem in which the EMD is based.", "Finding a feasible flow: the flow F is feasible if and only if it fulfills the following constraints for each f_ij: [2]", "The flows that fulfill these requirements are considered feasible.", "The work done by a feasible flow in matching x and y is the amount of matched weight, multiplied by the distance, for each point in x and y.", "The Earth mover\u2019s distance is the minimum amount of work to match x and y, normalized by the total weight of the lighter distribution, but in this case both distributions have the same total weight so there is no lighter distribution. The work is simply divided by the total weight of one distribution.", "The optimization problem is finding the flow that minimizes the work. The weight, all of it, has to be moved. But which weight to which point, and in what quantity, depending on the distance between the points, so that the weights don\u2019t have to move too far, that\u2019s the optimization problem.", "A non-optimal vs. optimal flow in regards of the work. In the left scenario, the distance covered by the 0.26 weight (d=316.3) causes the work to be so high. This example is quite intuitive, the optimal flow is relatively easy to obtain.", "A less intuitive example, in this case the total amount of weight in the distributions is different. So either there will be dirt overflow, or the holes won\u2019t be fully covered.", "The Earth mover\u2019s distance is the distance it takes to move/transform one distribution into the other. The two characteristics of these distributions are that the points are in a space, 2D in the examples, and each point has a certain weight. By calculating the most efficient way to distribute these weights, we reach a number denoting the EMD.", "How is this related to a semantic measure for document similarity that this post is supposed to be about? As mentioned in the beginning, the distance between documents is based on semantic distances between words, where words are stored in an electronical lexical database called WordNet. Let\u2019s try to map this WordNet representation into a distribution of points and weights: [3][4]", "A sentence X can be described as a distribution of points and weights, where:", "The EMD is calculated by finding the flow that minimizes the work to match x and y, normalized to 1, and the document similarity is obtained as follows:", "The Earth mover\u2019s distance is a type of distance where the position and weight of the points in an N-dimensional space is critical.", "By turning words into word vectors and weights into TF-IDF values, the EMD can be used as a semantic measure for document similarity.", "EMD can be used to calculate the semantic similarity between an query and a document, and thus play a role in the ontology matching stage of semantic search.", "WMD is a similar, more recent variation of EMD but using word2vec instead of WordNet. It was released in 2015 [6], and there are several implementation tutorials available, very useful to learn the implementation side of the measure.", "I researched this topic quite intensely for my presentation and I hope I summarized it in a clear and concise way. If anything is not explained well enough, I\u2019d be happy to give it another try.", "I would really appreciate any feedback, incomplete or erroneous information I might have included. Thank you for reading!", "[0]: Semantic search, slides from a presentation I gave in my Master\u2019s degree at LMU, 2018", "[1]: Towards Named-Entity-based similarity measures: challenges and opportunities, De Nies et al, 2014", "[2]: Finding color and shape patterns in images, Cohen, Stanford University, 1999", "[3]: Incorporating Dictionary and Corpus Information into a Context Vector Measure of Semantic Relatedness, Pathwardan, University of Minnesota, 2003", "[5]: The Earth Mover\u2019s Distance as a Semantic Measure for Document Similarity, Wan and Peng, Peking University, 2005", "[6]: From Word Embeddings To Document Distances, Kusner et al, 2015.", "Your home for data science. A Medium publication sharing concepts, ideas and codes."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F68fff0363ef2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://anebz.medium.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": ""}, {"url": "https://anebz.medium.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Ane Berasategi"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb250300b3b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&user=Ane+Berasategi&userId=b250300b3b8&source=post_page-b250300b3b8----68fff0363ef2---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@luis_ruiz?utm_source=medium&utm_medium=referral", "anchor_text": "Luis Enrique Ruiz Carvajal"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://anebz.eu/earth-mover-distance", "anchor_text": "ORIGINAL POST"}, {"url": "https://anebz.eu/semantic-search", "anchor_text": "Semantic search"}, {"url": "https://towardsdatascience.com/overview-of-text-similarity-metrics-3397c4601f50", "anchor_text": "more centered in theory"}, {"url": "https://medium.com/@adriensieg/text-similarities-da019229c894", "anchor_text": "more practical"}, {"url": "https://en.wikipedia.org/wiki/Tf%E2%80%93idf", "anchor_text": "TF-IDF"}, {"url": "https://anebz.eu/semantic-search", "anchor_text": "semantic search"}, {"url": "https://markroxor.github.io/gensim/static/notebooks/WMD_tutorial.html", "anchor_text": "implementation tutorials"}, {"url": "https://www.dropbox.com/s/7wd6110uiyqa835/semantic_search.pdf?dl=0", "anchor_text": "Semantic search"}, {"url": "https://dl.acm.org/citation.cfm?id=2666194", "anchor_text": "Towards Named-Entity-based similarity measures: challenges and opportunities"}, {"url": "http://infolab.stanford.edu/pub/cstr/reports/cs/tr/99/1620/CS-TR-99-1620.pdf", "anchor_text": "Finding color and shape patterns in images"}, {"url": "http://www.d.umn.edu/~tpederse/Pubs/patwardhan.pdf", "anchor_text": "Incorporating Dictionary and Corpus Information into a Context Vector Measure of Semantic Relatedness"}, {"url": "http://www.aclweb.org/anthology/J98-1004", "anchor_text": "Automatic word sense discrimination"}, {"url": "https://www.researchgate.net/publication/221613335_The_earth_mover's_distance_as_a_semantic_measure_for_document_similarity", "anchor_text": "The Earth Mover\u2019s Distance as a Semantic Measure for Document Similarity"}, {"url": "http://proceedings.mlr.press/v37/kusnerb15.pdf", "anchor_text": "From Word Embeddings To Document Distances"}, {"url": "https://towardsdatascience.com/word-distance-between-word-embeddings-cc3e9cf1d632", "anchor_text": "Word distance between word embeddings"}, {"url": "https://medium.com/@stephenhky/word-movers-distance-as-a-linear-programming-problem-6b0c2658592e", "anchor_text": "Word Mover\u2019s Distance as a Linear Programming Problem"}, {"url": "https://medium.com/@dieswaytoofast/earth-movers-distance-276d46e0511d", "anchor_text": "Earth Mover\u2019s Distance"}, {"url": "https://medium.com/tag/data-science?source=post_page-----68fff0363ef2---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/linguistics?source=post_page-----68fff0363ef2---------------linguistics-----------------", "anchor_text": "Linguistics"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----68fff0363ef2---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/towards-data-science?source=post_page-----68fff0363ef2---------------towards_data_science-----------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/tag/nlp?source=post_page-----68fff0363ef2---------------nlp-----------------", "anchor_text": "NLP"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&user=Ane+Berasategi&userId=b250300b3b8&source=-----68fff0363ef2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&user=Ane+Berasategi&userId=b250300b3b8&source=-----68fff0363ef2---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F68fff0363ef2&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----68fff0363ef2---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----68fff0363ef2--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----68fff0363ef2--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----68fff0363ef2--------------------------------", "anchor_text": ""}, {"url": "https://anebz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://anebz.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Ane Berasategi"}, {"url": "https://anebz.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "351 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb250300b3b8&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&user=Ane+Berasategi&userId=b250300b3b8&source=post_page-b250300b3b8--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F14aee5609f7e&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fearth-movers-distance-68fff0363ef2&newsletterV3=b250300b3b8&newsletterV3Id=14aee5609f7e&user=Ane+Berasategi&userId=b250300b3b8&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}