{"url": "https://towardsdatascience.com/deploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb", "time": 1683001163.746721, "path": "towardsdatascience.com/deploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb/", "webpage": {"metadata": {"title": "Deploy a Kafka Cluster with Terraform and Ansible | by Marcos Lombog | Towards Data Science", "h1": "Deploy a Kafka Cluster with Terraform and Ansible", "description": "In my previous post \u2014 Install a Kafka Cluster on Ubuntu in AWS, I have detailed the steps to manually set up your messaging backbone in AWS. This is a great step to understand how Kafka works, but it\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/install-a-kafka-cluster-on-ubuntu-in-aws-17c951287284", "anchor_text": "post \u2014 Install a Kafka Cluster on Ubuntu in AWS", "paragraph_index": 0}, {"url": "https://en.wikipedia.org/wiki/Open-source_software", "anchor_text": "open-source", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Infrastructure_as_code", "anchor_text": "infrastructure as code", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/HashiCorp", "anchor_text": "HashiCorp", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/JSON", "anchor_text": "JSON", "paragraph_index": 4}, {"url": "https://en.wikipedia.org/wiki/Amazon_Web_Services", "anchor_text": "Amazon Web Services", "paragraph_index": 5}, {"url": "https://en.wikipedia.org/wiki/Google_Cloud_Platform", "anchor_text": "Google Cloud Platform", "paragraph_index": 5}, {"url": "https://en.wikipedia.org/wiki/Microsoft_Azure", "anchor_text": "Microsoft Azure", "paragraph_index": 5}, {"url": "https://crunchify.com/my-favorite-linux-commands-list-of-basic-linux-commands-and-cheat-sheet/", "anchor_text": "command", "paragraph_index": 12}, {"url": "https://crunchify.com/have-you-noticed-missing-library-folder-in-mac-os-x-lion/", "anchor_text": "macOS", "paragraph_index": 12}, {"url": "https://github.com/mlomboglia/kafka-cluster-infra", "anchor_text": "my GitHub", "paragraph_index": 16}, {"url": "https://towardsdatascience.com/your-first-kafka-application-9b1358ccb870", "anchor_text": "Your First Kafka Application", "paragraph_index": 48}], "all_paragraphs": ["In my previous post \u2014 Install a Kafka Cluster on Ubuntu in AWS, I have detailed the steps to manually set up your messaging backbone in AWS. This is a great step to understand how Kafka works, but it takes a long time and is not scalable.", "A Kafka Cluster has several components such as Brokers, Zookeepers, Workers running on multiple instances like the example below. The simplest way to provision, deploy and manage your platform is by using tools that will automate this task.", "On this post, I will explain how can we use Terraform to quickly provision multiple instances and then install Kafka on these instances using Ansible to set up your Cluster.", "First, let\u2019s quickly understand what is Terraform and Ansible in a high-level view", "Terraform is an open-source infrastructure as code software tool created by HashiCorp. It enables users to define and provision infrastructure using a high-level configuration language known as Hashicorp Configuration Language (HCL), or optionally JSON.", "Terraform supports a number of cloud infrastructure providers such as Amazon Web Services, Google Cloud Platform, Microsoft Azure.", "Terraform generates an execution plan describing what it will do to reach the desired state, and then executes it to build the described infrastructure. As the configuration changes, Terraform is able to determine what changed and create incremental execution plans which can be applied.", "Infrastructure is described using a high-level configuration syntax. This allows a blueprint of your datacenter to be versioned and treated as you would any other code. Additionally, infrastructure can be shared and re-used.", "Ansible is a radically simple IT automation platform that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applications \u2014 automate in a language that approaches plain English, using SSH, with no agents to install on remote systems.", "First, let\u2019s install Terraform and Ansible", "You can follow the instructions below or if you are on Mac, the simplest way is using brew:", "Confirm Terraform is correctly installed with:", "Install Ansible using pip command. PIP is a package manager for Python packages. macOS doesn\u2019t have pip installed by default. You have to install it first.", "For other OS, please use the reference below:", "Now, let\u2019s build the Kafka infrastructure using Terraform HCL.", "The setup is based on the Enterprise Confluent Kafka using a public VPC and subnet.", "All code is available in my GitHub", "Inside the terraform folder, there are the following files:", "gateway.tf \u2192 Internet Gateway creation. There is no need to change this file", "instances.tf \u2192 Instances to be created. There is no need to change this file", "There are five types of instances with a short name in parenthesis:", "public.tf \u2192 Subnet creation. For this example, I am using a public subnet", "security_group.tf \u2192 Security group settings to allow for necessary network traffic into the instances. There is no need to change this file for the example.", "Please keep in mind that ingress allows 0.0.0.0/0, so this is open to the public internet. You will need to restrict this to be used in a production environment.", "variables.tf contain the parameters for our terraform. You can modify this. For my example, I will provision 7 instances in AWS.", "Important: Confluent recommends a minimum instance type \u201ct2.large\u201d to run Kafka, so if you modify this it will be out of AWS Free Tier and it will cost you money", "You will need an AWS Key Pair to create your instances. If you don\u2019t have one yet, log in to your AWS account", "Give a name and click Create.", "Download your key, copy to a safe folder and update permissions", "Update the section below of the variables.tf with your Key Name", "Now, we are good to go.", "Terraform init will download your dependencies", "Terraform plan will create your deployment plan", "Now, be careful on the next step. It will cost you money depending on your configuration.", "if there is an error: ami is not found, go to your EC2 console, launch instance and update with the latest ami label:", "Now you have provisioned all the instances in AWS.", "Go your AWS and see all your instances running and take note of the public DNS (IPv4) of each instance. You will need this in the next section.", "Now, let\u2019s proceed to install Kafka using Ansible", "To install Kafka, I will use the Confluent version.", "1. Create a copy of the hosts_example.yml file.", "2. Use your favourite IDE and edit hosts.yml file entering the hosts from your AWS Terraform installation above following the labels for each instance type, looking similar to this with your Public DNS.", "Be very careful to use correct indentation on YML files:", "Uncomment the following line in the hosts.yml file adding your key path", "3. Confirm Ansible can connect over SSH", "Type \u201cyes\u201d to trust all servers.", "If there is an issue connecting to an instance, try to SSH manually with the command below:", "The Ansible playbook will perform the Kafka installation on all your instances.", "After some time, you should see this message above. Everything installed!", "To continue you can build Your First Kafka Application with my other post:", "Don\u2019t forget to destroy your Cluster and terminate your instances running the command below:", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "AWS Certified Architect | Tech enthusiast"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F21bee1ee4fb&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@mlombog?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mlombog?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Marcos Lombog"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9df2628aa301&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&user=Marcos+Lombog&userId=9df2628aa301&source=post_page-9df2628aa301----21bee1ee4fb---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://unsplash.com/@lucabravo?utm_source=medium&utm_medium=referral", "anchor_text": "Luca Bravo"}, {"url": "https://unsplash.com?utm_source=medium&utm_medium=referral", "anchor_text": "Unsplash"}, {"url": "https://towardsdatascience.com/install-a-kafka-cluster-on-ubuntu-in-aws-17c951287284", "anchor_text": "post \u2014 Install a Kafka Cluster on Ubuntu in AWS"}, {"url": "https://aws.amazon.com/quickstart/architecture/confluent-platform/", "anchor_text": "https://aws.amazon.com/quickstart/architecture/confluent-platform/"}, {"url": "https://en.wikipedia.org/wiki/Open-source_software", "anchor_text": "open-source"}, {"url": "https://en.wikipedia.org/wiki/Infrastructure_as_code", "anchor_text": "infrastructure as code"}, {"url": "https://en.wikipedia.org/wiki/HashiCorp", "anchor_text": "HashiCorp"}, {"url": "https://en.wikipedia.org/wiki/JSON", "anchor_text": "JSON"}, {"url": "https://en.wikipedia.org/wiki/Amazon_Web_Services", "anchor_text": "Amazon Web Services"}, {"url": "https://en.wikipedia.org/wiki/Google_Cloud_Platform", "anchor_text": "Google Cloud Platform"}, {"url": "https://en.wikipedia.org/wiki/Microsoft_Azure", "anchor_text": "Microsoft Azure"}, {"url": "https://learn.hashicorp.com/terraform/getting-started/install.html", "anchor_text": "Installing TerraformTerraform must first be installed on your machine. Terraform is distributed as a binary package for all supported\u2026learn.hashicorp.com"}, {"url": "https://crunchify.com/my-favorite-linux-commands-list-of-basic-linux-commands-and-cheat-sheet/", "anchor_text": "command"}, {"url": "https://crunchify.com/have-you-noticed-missing-library-folder-in-mac-os-x-lion/", "anchor_text": "macOS"}, {"url": "https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html", "anchor_text": "Installation Guide - Ansible DocumentationWelcome to the Ansible Installation Guide! Ansible by default manages machines over the SSH protocol. Once Ansible is\u2026docs.ansible.com"}, {"url": "https://github.com/mlomboglia/kafka-cluster-infra", "anchor_text": "my GitHub"}, {"url": "https://towardsdatascience.com/your-first-kafka-application-9b1358ccb870", "anchor_text": "Your First Kafka Application"}, {"url": "https://towardsdatascience.com/your-first-kafka-application-9b1358ccb870", "anchor_text": "Your First Kafka ApplicationCreate Your First Kafka Application Producing and Consuming Messagestowardsdatascience.com"}, {"url": "https://medium.com/tag/ansible?source=post_page-----21bee1ee4fb---------------ansible-----------------", "anchor_text": "Ansible"}, {"url": "https://medium.com/tag/terraform?source=post_page-----21bee1ee4fb---------------terraform-----------------", "anchor_text": "Terraform"}, {"url": "https://medium.com/tag/kafka?source=post_page-----21bee1ee4fb---------------kafka-----------------", "anchor_text": "Kafka"}, {"url": "https://medium.com/tag/data-science?source=post_page-----21bee1ee4fb---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/aws?source=post_page-----21bee1ee4fb---------------aws-----------------", "anchor_text": "AWS"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&user=Marcos+Lombog&userId=9df2628aa301&source=-----21bee1ee4fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&user=Marcos+Lombog&userId=9df2628aa301&source=-----21bee1ee4fb---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F21bee1ee4fb&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----21bee1ee4fb---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----21bee1ee4fb--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mlombog?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@mlombog?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Marcos Lombog"}, {"url": "https://medium.com/@mlombog/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "280 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F9df2628aa301&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&user=Marcos+Lombog&userId=9df2628aa301&source=post_page-9df2628aa301--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fe8cde471a4d1&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fdeploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb&newsletterV3=9df2628aa301&newsletterV3Id=e8cde471a4d1&user=Marcos+Lombog&userId=9df2628aa301&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}