{"url": "https://towardsdatascience.com/an-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c", "time": 1683009800.6080089, "path": "towardsdatascience.com/an-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c/", "webpage": {"metadata": {"title": "An algorithm to find the best moving average for stock trading | by Gianluca Malato | Towards Data Science", "h1": "An algorithm to find the best moving average for stock trading", "description": "Moving averages are one of the most used tools in stock trading. Many traders actually use only this tool in their investment toolbox. Let\u2019s see what they are and how we can use Python to fine-tune\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines", "paragraph_index": 35}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms", "paragraph_index": 35}, {"url": "http://YourDataTeacher.com", "anchor_text": "YourDataTeacher.com", "paragraph_index": 37}], "all_paragraphs": ["Moving averages are one of the most used tools in stock trading. Many traders actually use only this tool in their investment toolbox. Let\u2019s see what they are and how we can use Python to fine-tune their features.", "In a time series, a moving average of period N at a certain time t, is the mean value of the N values before t (included). It\u2019s defined for each time instant excluding the first N ones. In this particular case, we are talking about the Simple Moving Average (SMA) because every point of the average has the same weight. There are types of moving averages that weigh every point in a different way, giving more weight to the most recent data. It\u2019s the case of the Exponential Moving Average (EMA) or the Linear Weighted Moving Average (LWMA).", "In trading, the number of previous time series observations the average is calculated from is called period. So, an SMA with period 20 indicates a moving average of the last 20 periods.", "As you can see, SMA follows the time series and it\u2019s useful to remove noise from the signal, keeping the relevant information about the trend.", "Moving averages are often used in time series analysis, for example in ARIMA models and, generally speaking, when we want to compare a time series value to the average value in the past.", "Moving averages are often used to detect a trend. It\u2019s very common to assume that if the stock price is above its moving average, it will likely continue rising in an uptrend.", "The longer the period of an SMA, the longer the time horizon of the trend it spots.", "As you can see, short moving averages are useful to catch short-term movements, while the 200-period SMA is able to detect a long-term trend.", "Generally speaking, the most used SMA periods in trading are:", "It\u2019s a general rule of thumb among traders that if a stock price is above its 200-days moving average, the trend is bullish (i.e. the price rises). So they are often looking for stocks whose price is above the 200-periods SMA.", "In order to find the best period of an SMA, we first need to know how long we are going to keep the stock in our portfolio. If we are swing traders, we may want to keep it for 5\u201310 business days. If we are position traders, maybe we must raise this threshold to 40\u201360 days. If we are portfolio traders and use moving averages as a technical filter in our stock screening plan, maybe we can focus on 200\u2013300 days.", "Choosing the investment period is a discretionary choice of the trader. Once we have determined it, we must try to set a suitable SMA period. We have seen 20, 50 and 200 periods, but are they always good? Well not really.", "Markets change a lot during the time and they often make traders fine-tune their indicators and moving averages in order to follow volatility burst, black swans and so on. So there isn\u2019t the right choice for the moving average period, but we can build a model that self-adapts to market changes and auto-adjust itself in order to find the best moving average period.", "The algorithm I propose here is an attempt to find the best moving average according to the investment period we choose. After we choose this period, we\u2019ll try different moving averages length and find the one that maximizes the expected return of our investment (i.e. if we buy at 100 and after the chosen period the price rises to 105, we have a 5% return).", "The reason of using the average return after N days as an objective function is pretty simple: we want our moving average to give us the best prediction of the trend according to the time we want to keep stocks in our portfolio, so we want to maximize the average return of our investment in such a time.", "In practice, we\u2019ll do the following:", "The last point is the most important one because it performs cross-validation that helps us avoid overfitting after the optimization phase. If this check is satisfied, we can use the moving average length we found.", "For this example, we\u2019ll use different stocks and investment length. The statistical significance of the mean values will be done using Welch\u2019s test.", "First of all, we must install yfinance library. It\u2019s very useful for downloading stock data.", "Then we can import some useful packages:", "Let\u2019s assume we want to keep the SPY ETF on S&P 500 index for 2 days and that we want to analyze 10 years of data.", "Now we can download our data and calculate the return after 2 days.", "Now we can perform the optimization for searching the best moving average. We\u2019ll do a for loop that spans among 20-period moving average and 500-period moving average. For each period we split our dataset in training and test sets, then we\u2019ll look only ad those days when the close price is above the SMA and calculate the forward return. Finally, we\u2019ll calculate the average forward return in training and test sets, comparing them using a Welch\u2019s test.", "We\u2019ll sort all the results by training average future returns in order to get the optimal moving average.", "The first item, which has the best score, is:", "As you can see, the p-value is higher than 5%, so we can assume that the average return in the test set is comparable with the average return in the training set, so we haven\u2019t suffered overfitting.", "Let\u2019s see the price chart according to the best moving average we\u2019ve found (which is the 479-period moving average).", "It\u2019s clear that the price is very often above the SMA.", "Now, let\u2019s see what happens if we set n_forward = 40 (that is, we keep our position opened for 40 days).", "The best moving average produces these results:", "As you can see, the p-value is lower than 5%, so we can assume that the training phase has introduced some kind of overfitting, so we can\u2019t use this SMA in the real world. Another reason could be that volatility has changed too much and the market needs to stabilize before making us invest in it.", "Finally, let\u2019s see what happens with a Gold-based ETF (ticker: GLD) with 40-days investment.", "p-value is quite high, so there\u2019s no overfitting.", "The best moving average period is 136, as we can see in the chart below.", "In this article, we\u2019ve seen a simple algorithm to find the best Simple Moving Average for stock and ETF trading. It can be easily applied every trading day in order to find, day by day, the best moving average. In this way, a trader can easily adapt to market changes and to volatility fluctuations.", "Note from Towards Data Science\u2019s editors: While we allow independent authors to publish articles in accordance with our rules and guidelines, we do not endorse each author\u2019s contribution. You should not rely on an author\u2019s works without seeking professional advice. See our Reader Terms for details.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Theoretical Physicists, Data Scientist and fiction author. I teach Data Science, statistics and SQL on YourDataTeacher.com. E-mail: gianluca@gianlucamalato.it"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1b024672299c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://gianlucamalato.medium.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Gianluca Malato"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f015e9ee21d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&user=Gianluca+Malato&userId=1f015e9ee21d&source=post_page-1f015e9ee21d----1b024672299c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://github.com/gianlucamalato/machinelearning/blob/master/Find_the_best_moving_average.ipynb", "anchor_text": "https://github.com/gianlucamalato/machinelearning/blob/master/Find_the_best_moving_average.ipynb"}, {"url": "https://towardsdatascience.com/questions-96667b06af5", "anchor_text": "rules and guidelines"}, {"url": "https://towardsdatascience.com/readers-terms-b5d780a700a4", "anchor_text": "Reader Terms"}, {"url": "https://medium.com/tag/data-science?source=post_page-----1b024672299c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/stock-market?source=post_page-----1b024672299c---------------stock_market-----------------", "anchor_text": "Stock Market"}, {"url": "https://medium.com/tag/trading?source=post_page-----1b024672299c---------------trading-----------------", "anchor_text": "Trading"}, {"url": "https://medium.com/tag/algorithmic-trading?source=post_page-----1b024672299c---------------algorithmic_trading-----------------", "anchor_text": "Algorithmic Trading"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----1b024672299c---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&user=Gianluca+Malato&userId=1f015e9ee21d&source=-----1b024672299c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&user=Gianluca+Malato&userId=1f015e9ee21d&source=-----1b024672299c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F1b024672299c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----1b024672299c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----1b024672299c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----1b024672299c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1b024672299c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----1b024672299c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----1b024672299c--------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://gianlucamalato.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Gianluca Malato"}, {"url": "https://gianlucamalato.medium.com/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.8K Followers"}, {"url": "http://YourDataTeacher.com", "anchor_text": "YourDataTeacher.com"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1f015e9ee21d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&user=Gianluca+Malato&userId=1f015e9ee21d&source=post_page-1f015e9ee21d--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fadb09bc451d&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fan-algorithm-to-find-the-best-moving-average-for-stock-trading-1b024672299c&newsletterV3=1f015e9ee21d&newsletterV3Id=adb09bc451d&user=Gianluca+Malato&userId=1f015e9ee21d&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}