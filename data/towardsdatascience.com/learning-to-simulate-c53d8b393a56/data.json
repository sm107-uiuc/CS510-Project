{"url": "https://towardsdatascience.com/learning-to-simulate-c53d8b393a56", "time": 1683000872.126743, "path": "towardsdatascience.com/learning-to-simulate-c53d8b393a56/", "webpage": {"metadata": {"title": "Learning to Simulate. How learning to simulate better\u2026 | by Nataniel Ruiz | Towards Data Science", "h1": "Learning to Simulate", "description": "The paper presented at ICLR 2019 can be found here. I also have slides as well as a poster explaining the work in detail. Deep neural networks are an amazing piece of technology. With enough labelled\u2026"}, "outgoing_paragraph_urls": [{"url": "https://arxiv.org/abs/1810.02513", "anchor_text": "here", "paragraph_index": 0}, {"url": "https://docs.google.com/presentation/d/1AEqPi-bJ1q-o1bxosBjcqEgCb2Vs2TcJF6cI4nHZKTg/edit?usp=sharing", "anchor_text": "slides", "paragraph_index": 0}, {"url": "https://natanielruiz.github.io/docs/lts_poster.pdf", "anchor_text": "poster", "paragraph_index": 0}, {"url": "https://www.di.ens.fr/willow/research/surreal/data/", "anchor_text": "computer vision", "paragraph_index": 2}, {"url": "https://openai.com/blog/generalizing-from-simulation/", "anchor_text": "robotic control applications", "paragraph_index": 2}, {"url": "https://arxiv.org/abs/1608.02192", "anchor_text": "Researchers have leveraged a dataset", "paragraph_index": 3}, {"url": "http://carla.org", "anchor_text": "Carla plugin", "paragraph_index": 6}, {"url": "http://www.cvlibs.net/publications/Geiger2013IJRR.pdf", "anchor_text": "KITTI traffic segmentation dataset", "paragraph_index": 19}, {"url": "http://natanielruiz.github.io", "anchor_text": "natanielruiz.github.io", "paragraph_index": 24}], "all_paragraphs": ["The paper presented at ICLR 2019 can be found here. I also have slides as well as a poster explaining the work in detail.", "Deep neural networks are an amazing piece of technology. With enough labelled data they can learn to produce very accurate classifiers for high dimensional inputs such as images and sound. In recent years the machine learning community has been able to successfully tackle problems such as classifying objects, detecting objects in images and segmenting images.", "The caveat in the above statement is with enough labelled data. Simulations of real phenomena and of the real world can sometimes help. There are cases where synthetic data has improved performance in deep learning systems in computer vision or robotic control applications.", "Simulation can give us accurate scenes with free labels. But let\u2019s take Grand Theft Auto V (GTA) for example. Researchers have leveraged a dataset collected by free-roaming the GTA V world and have been using this dataset to bootstrap deep learning systems among other things. Many game designers and map creators have worked on creating the intricate world of GTA V. They painstakingly designed it, street by street, and then fine-combed the streets adding pedestrians, cars, objects, etc.", "This is expensive. Both in time and in money. Using random simulated scenes we might not do much better. This means important edge cases might be severely undersampled and our classifier might not learn how to detect them correctly. Let us imagine we are trying to train a classifier which detects dangerous scenes. In the real world we will run into dangerous scenes like the one below with very low frequency, yet they are very important. If we generate a large number of random scenes, we will have very few dangerous scenes like the one below as well. A dataset which undersamples these important cases might yield a classifier which fails on them.", "Learning to simulate is the idea that we can potentially learn how to optimally generate scenes such that a deep network can either learn a very good representation or can perform well in a downstream task.", "To test our work, we create a parameterized procedural traffic scene simulator using Unreal Engine 4 and the Carla plugin. Our simulator creates a road of variable length with different types of intersections (X, T, or L). We can populate the road with buildings on the side and cars of 5 different types on the road. The amount of buildings and cars are controlled by tunable parameters, as well as the type of cars. We can also change the weather between 4 different weather types, which control for lighting and rain effects. The main idea will be to learn the optimal parameters which control these scene characteristics for different tasks (for example semantic segmentation, or object detection).", "To get sensor data we place a car on the road of our generated scenes which can capture RGB images from the generated scene which automatically have semantic segmentation labels and depth annotations (for free!).", "However, the learning to simulate algorithm is more general than this. We don\u2019t have to use it exclusively for traffic scenes, it can apply to any type of parameterized simulator. By this we mean that, for any simulator that takes in parameters as an input, we present a way to search for the best parameters such that the data generated is optimal for a deep network to learn the downstream task. Our work, to the best of our knowledge, is the first to do simulation optimization to maximize performance on a main task, as well as apply it to traffic scenes.", "Moving on to the crux of our algorithm. A traditional machine learning setup is the following, where data is sampled from a distribution P(x,y) (x is the data and y is the label). Usually this happens by collecting data in the real world and manually labeling the samples. This dataset is fixed, and we use it to train our model.", "By using a simulator to train a main task network, we can generate data from a new distribution Q defined by the simulator. This dataset is not fixed and we can generate as much data as our computation and time constraints allow. Still, the data generated in this domain randomization setup is randomly sampled from Q. The data needed for obtaining a good model could be large and performance can be suboptimal. Can we do better?", "We introduce learning to simulate which optimizes a metric of our choice on a main task \u2014 the pipeline is trained by defining a reward function R which is directly related to this metric (usually is identical to the metric itself). We sample data from a parameterized simulator Q(x,y|\u0398), with which we train the main task model at every iteration of the algorithm. The reward R that we defined is then used to inform the update of the Policy which controls the parameter \u0398. The reward R is obtained by testing the trained network on a validation set. In our case, we use vanilla policy gradient to optimize our policy.", "Informally, we are trying to find the best parameter \u0398 which gives us the distribution Q(x,y|\u0398) which maximizes accuracy (or whichever metric) for the main task.", "The mathematical formulation of the learning to simulate problem is a bi-level optimization problem. Attempting to solve it with a gradient-based approach poses smoothness and differentiability constraints on the lower-level problem. In this case the simulator should also be differentiable, which is generally not true! This is why a derivative-free optimization approach like vanilla policy gradients makes sense.", "We demonstrate our approach on instance counting and semantic segmentation.", "The car-counting task that we explore is simple. We ask the network to count how many individual cars of each specific type are in the scene. Below is an example scene with the correct labels on the right.", "We use learning to simulate to solve this problem and compare to what happens using only random simulation. In the graph below, focus on the red and grey curves, which show how learning to simulate (LTS) achieves a much higher reward (lower mean absolute error of cars counted) after 250 epochs. The random sampling case briefly improves, but performance decreases once the sampled random batch is not adequate for the task. The grey curve rises slowly over several iterations but learning to simulate converges on the best possible accuracy shown by the blue curve (where we use the ground-truth simulation parameters).", "What is happening? A nice way to look at it is by visualizing the probabilities of different scenarios and objects in our scene. We plot the weather probabilities over time. The ground-truth validation dataset that we generated oversampled certain weathers (clear noon and clear sunset) and undersampled the rest. This means there were more images with clear noon and clear sunset weather than other types of weather. We can see that our algorithm recovers the rough proportions!", "Let\u2019s do the same with car spawning probabilities. Our ground-truth dataset oversampled certain types of cars (silver Nissan and Green Beatle). Learning to simulate reflects these proportions after training as well. In essence, the algorithm pushes the simulator parameters to generate datasets which are similar to the ground-truth dataset.", "Now we show an example of how learning to simulate improves accuracy over random simulation on the KITTI traffic segmentation dataset which is a dataset captured in the real world.", "As our baseline we train the main task model separately 600 times, with data generated by the simulator using different sets of random parameters for each one. We monitor the validation Car IoU metric for each of these networks and pick the one with highest validation reward. We then test it on the unseen KITTI test set. We train learning to simulate for 600 iterations and obtain a Car IoU (widespread segmentation metric) of 0.579, much higher than the 0.480 achieved using the random parameter baseline (random params). We also show our results using another derivative-free optimization technique (random search) which did not achieve good results in this experiment (although it did work pretty well in car counting). Finally, we also show the actual performance of the ResNet-50 network we used for segmentation by training on 982 annotated real KITTI training images (KITTI train set), to show an upper bound.", "Learning to simulate can be seen as a meta-learning algorithm that adjusts parameters of a simulator to generate synthetic data such that a machine learning model trained on this data achieves high accuracies on validation and test sets, respectively. We show that it beats domain randomization in real problems and believe it is a very promising research area. It will be exciting to see what can happen with extensions and applications of this in the near-future and I encourage everyone to look into how simulation and learning to simulate can help you in your applications or research.", "All questions are more than welcome! My website is below.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine Learning PhD at Boston University. Interned at Apple AI Research and NEC Labs. M.S. from Georgia Tech. natanielruiz.github.io"], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc53d8b393a56&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@nataniel.ruiz777?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nataniel.ruiz777?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Nataniel Ruiz"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa967b2741c51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&user=Nataniel+Ruiz&userId=a967b2741c51&source=post_page-a967b2741c51----c53d8b393a56---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://arxiv.org/abs/1810.02513", "anchor_text": "here"}, {"url": "https://docs.google.com/presentation/d/1AEqPi-bJ1q-o1bxosBjcqEgCb2Vs2TcJF6cI4nHZKTg/edit?usp=sharing", "anchor_text": "slides"}, {"url": "https://natanielruiz.github.io/docs/lts_poster.pdf", "anchor_text": "poster"}, {"url": "https://unsplash.com/@davidclode?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "David Clode"}, {"url": "https://unsplash.com/s/photos/brain?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText", "anchor_text": "Unsplash"}, {"url": "https://www.di.ens.fr/willow/research/surreal/data/", "anchor_text": "computer vision"}, {"url": "https://openai.com/blog/generalizing-from-simulation/", "anchor_text": "robotic control applications"}, {"url": "https://arxiv.org/abs/1608.02192", "anchor_text": "Researchers have leveraged a dataset"}, {"url": "http://carla.org", "anchor_text": "Carla plugin"}, {"url": "http://www.cvlibs.net/publications/Geiger2013IJRR.pdf", "anchor_text": "KITTI traffic segmentation dataset"}, {"url": "https://natanielruiz.github.io", "anchor_text": "Nataniel RuizResearch I have explored several topics in computer vision including face and gesture analysis, simulation and\u2026natanielruiz.github.io"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----c53d8b393a56---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----c53d8b393a56---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----c53d8b393a56---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----c53d8b393a56---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/data-science?source=post_page-----c53d8b393a56---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&user=Nataniel+Ruiz&userId=a967b2741c51&source=-----c53d8b393a56---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&user=Nataniel+Ruiz&userId=a967b2741c51&source=-----c53d8b393a56---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2Fc53d8b393a56&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----c53d8b393a56---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c53d8b393a56--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----c53d8b393a56--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----c53d8b393a56--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nataniel.ruiz777?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@nataniel.ruiz777?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Nataniel Ruiz"}, {"url": "https://medium.com/@nataniel.ruiz777/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "62 Followers"}, {"url": "http://natanielruiz.github.io", "anchor_text": "natanielruiz.github.io"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fa967b2741c51&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&user=Nataniel+Ruiz&userId=a967b2741c51&source=post_page-a967b2741c51--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fusers%2Fa967b2741c51%2Flazily-enable-writer-subscription&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Flearning-to-simulate-c53d8b393a56&user=Nataniel+Ruiz&userId=a967b2741c51&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}