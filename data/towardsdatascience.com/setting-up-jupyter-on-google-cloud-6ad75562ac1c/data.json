{"url": "https://towardsdatascience.com/setting-up-jupyter-on-google-cloud-6ad75562ac1c", "time": 1683004624.1791081, "path": "towardsdatascience.com/setting-up-jupyter-on-google-cloud-6ad75562ac1c/", "webpage": {"metadata": {"title": "Setting Up Jupyter on Google Cloud | by Asko Seeba | Towards Data Science", "h1": "Setting Up Jupyter on Google Cloud", "description": "UPDATE: In my next post I gave the equivalent instructions for Setting Up Jupyter on AWS \u2014 if you are more into AWS, go and check that article. Google Cloud is a great, powerful and rapidly evolving\u2026"}, "outgoing_paragraph_urls": [{"url": "https://towardsdatascience.com/setting-up-jupyter-on-aws-6b3018dff41f", "anchor_text": "Setting Up Jupyter on AWS", "paragraph_index": 0}, {"url": "https://cloud.google.com/resource-manager/docs/creating-managing-projects", "anchor_text": "Create", "paragraph_index": 7}, {"url": "https://cloud.google.com/compute/docs/disks/add-persistent-disk", "anchor_text": "here", "paragraph_index": 22}], "all_paragraphs": ["UPDATE: In my next post I gave the equivalent instructions for Setting Up Jupyter on AWS \u2014 if you are more into AWS, go and check that article.", "Google Cloud is a great, powerful and rapidly evolving contemporary cloud environment, which provides plenty of cool services and tools for data scientists and data engineers. As a data scientist, when you run your analysis projects on your local laptop computer, you often face technical resource challenges, be it network speed for downloading large datasets, disk size limitations, CPU power limitations or memory limitations. In a contemporary cloud environment, you basically have easy solutions at hand for any of those obstacles. You have fast network connectivity. You can always start any task with small, lean and mean resources. Whenever you face disk storage problems, you just hire a bigger disk with a couple of clicks. Or you can load the dataset into BigQuery or some other suitable storage service for cost-effective handling. Too little CPU power? No worries, add more CPU to your VM (which you can scale back down immediately when you don\u2019t need it anymore). Out of memory? A couple of clicks later you have more memory, and again, you can take it back down if it isn\u2019t needed any more. Any sort of cluster formation for distributed computing is also usually just some clicks away, when you just know what you do: boot the cluster up for the heavier compute job, persist the results in some storage service outside of the cluster, and shut the cluster down to not let it stand idle (and incur unnecessary cost).", "As most of the data scientists these days are used to work with Jupyter Notebook or JupyterLab (the newer version of Jupyter Notebook), one of the first questions that any data scientist faces when getting started with Google Cloud, is how to set it up in a way that is reasonably convenient to use and avoid unnecessary cloud costs. One thing that Google Cloud catches your attention with, is their Datalab product, which is basically Google\u2019s facelift to Jupyter Notebook deployed within a dedicated VM with extra persistent disk and couple of extra services (like automated backup and Ungit) added to it.", "One of the main virtues of using GC Datalab instead of your own deployed Jupyter is that its deployment is all prepared and automated for you \u2014 you just type in a specific command line from the Cloud Shell, wait a bit for the provisioning, and there you go, the entire UI environment readily accessible through the GC Cloud Shell Web Preview feature, SDK-s for easy integration with different cloud services already deployed etc. So, it is really easy to get quickly started with GC Datalab.", "However, that convenience of getting quickly started comes with drawbacks of a bit too constrained and custom designed underlying Linux environment and setup (not a familiar Debian family \u2014 no apt* based tools to install additional packages), and few other unexpected unnecessary annoyances, at least to my tastes. So I figured out a way to set up Jupyter Lab (a newer version of Jupyter Notebooks) in a way that achieves the similar (or actually even better) ease of use and cloud integration, and is less costly (by avoiding the mandatory additional persistent disk that comes with Datalab while actually not always necessary). I have preferred using Jupyter Lab over Datalab when working in otherwise Google Cloud environment ever since.", "If you are experienced with Jupyter Notebook and feel comfortable with Debian-like environments, then you might find the following instructions helpful.", "For the purpose of being scriptable/automatable, the following instructions rely on Google Cloud Shell command line, i.e. we avoid doing the same things via the Cloud Console UI.", "1. Create or select a cloud project where you want to deploy the Jupyter VM.", "2. Open the Google Cloud console and activate the Cloud Shell from the Cloud Console. You can do that from the toolbar button at to top right corner of the Cloud Console:", "3. At the Cloud Shell command prompt, enter the following commands (adjust the project name, instance vm name, region and machine-type as you wish \u2014 rest of the options I\u2019d recommend to leave as they are here, unless you know what you do):", "4. The last command above takes you to the newly created VM\u2019s command prompt. Enter the following commands there:", "IMPORTANT!!! On the next command, --ip=127.0.0.1 is necessary for the security reasons, to block any external access attempt, especially as we are turning off the password and security token here to achieve usage convenience that is identical to Datalab. When you get more familiar with Google Cloud later and learn how to configure networking, then for an added security measure, you can turn off the external IP from the VM at all, and create a firewall setup so the VM would still be able to communicate with the outer world (needed for installing the packages and downloading datasets). However, to not over-complicate the current instructions with the firewall features, this is what already achieves the setup where you can access your notebooks through your GC account authentication, without extra password interaction by Jupyter, while not exposing your notebooks to the public world:", "5. The VM with JupyterLab is now provisioned and configured, and with the exit command at the end above you get back to the Cloud Shell command line. Let\u2019s connect the dots that make the JupyterLab easy to launch and use:", "6. The exit command in the end above closes the Cloud Shell. Open the Cloud Shell again, and enter the following command to test the command line alias we just created:", "7. The last command above opens the ssh connection to the newly created VM, created the tunnel needed for the Cloud Console Web Preview feature, and launched the JupyterLab service inside the VM \u2014 you should see the JupyterLab\u2019s log output on the Console Shell terminal output. If you hit Ctrl+C here and terminate the JupyterLab service, the connection gets closed and you\u2019ll be back on the Console Shell command line prompt. But don\u2019t do it (i.e. don\u2019t hit the Ctrl+C \u2014 if you did, enter the above command again) yet, if you want the next step to succeed as well :).", "8. To open the JupyterLab UI, click on the \u201cWeb Preview\u201d button on the Cloud Shell toolbar, and then click \u201cPreview on port 8080\u201d", "9. Voila! You are in JupyterLab! You have the Google Cloud\u2019s python API installed (see the pip3 install --upgrade command above), and it has access to the Google Cloud services (see the --scopes=cloud-platform option at VM creation above). Your JupyterLab python environment is fully integrated with all the Google Cloud services and able to interact with these services the same way the Datalab would be.", "From here on, you can create and edit notebooks, interact with the underlying Debian platform (through the notebook command line magic or launch a Terminal from JupyterLab for that), or do whatever you feel comfortable to do in Debian based Jupyter environment. Add whatever packages you feel are necessary (apt install git; pip3 install pandas; etc).", "Whenever you stop working with your notebooks, don\u2019t forget to shut down the VM, to avoid unnecessary cloud costs. When you later return back to working on your notebooks do the following:", "2. Open the Cloud Console command prompt.", "4. Click on the \u201cWeb Preview\u201d button on the Cloud Shell toolbar, and then click \u201cPreview on port 8080\u201d.", "The default VM primary disk size is 10GB. I would recommend leaving it as it is and adding an additional persistent disk to the VM only when you need to work with bigger datasets. Having that extra space as an additional disk gives you the opportunity to drop and delete it (having those files you want to preserve backed up to Cloud Storage before deleting the disk) if you have finished your project. Persistent disks are a rather costly service at typical personal budget levels so it doesn\u2019t make sense to just let them sit idle, having you to pay for them on a monthly basis. Also, due to the same cost reason, before creating another persistent disk, think a bit about how big disk you actually need. Datalab creates a 200GB disk for you by default (as of writing this, europe-west1 price for a regular 200GB SSD is \u20ac31.30/month), but maybe 25GB is already big enough for your current project at hand (\u20ac3.91/month)?", "You can find the instructions for adding a persistent disk to VM from here.", "One thing that is specific to Google Cloud Web Preview based web UI tunneling, that might happen, is that you suddenly see the Jupyter web UI loses the connection to the Jupyter service (the same thing might happen to the Datalab as well, by the way). In such a case, go and check if your Cloud Shell is still connected, and reconnect it, if necessary. The reason in such case is that the Cloud Shell holds the tunnel, and if Cloud Shell somehow disconnects, it takes the tunnel with it, and causes the Jupyter web UI to lose the connection to the backend. If that disconnect happened due to a temporary network connectivity, then clicking on the \u201creconnect\u201d link on the Cloud Shell toolbar might suffice to recover the JupyterLab connection without even losing the session state. But if the connection between Cloud Shell and Jupyter VM has been lost (i.e. it is not just the network connectivity issue between your browser and Google Cloud Console services), then you have to enter the my_jupyterlab command again from Cloud Shell, to launch the Jupyter service again.", "The above is enough to get you up and running with the Jupyter environment in Google Cloud. But to force you to think, practice some Google Cloud tinkering and strengthen your confidence with that environment, here are some bonus exercises, that result in making your life even easier, and that I suggest you try to solve on your own. Feel free to post the description of your solutions or questions you might get as a response below, and I will attempt to comment on them for your feedback.", "Make the launching of the Jupyter VM more convenient. Improve the my_jupyterlab Cloud Shell alias in the way, that it checks if the VM is already running \u2014 if not, then automatically launch the VM, wait for it to be up and ready, and launch Jupyter in it. This way you\u2019ll eliminate the separate manual step of launching the VM.", "Improve the my_jupyterlab Cloud Shell alias in the way that after stopping the Jupyter service with ctrl+c it would offer you to stop the VM as well (with default action being stopping the VM) \u2014 this way you avoid unnecessary cloud costs incurring from accidentally forgetting to shut down the VM.", "Install the Cloud SDK into your local desktop or laptop machine, and try to achieve the setup where you can connect the ssh tunnel to the cloud-hosted Jupyter VM and launch the Jupyter service there from your local desktop or laptop, instead of using the Cloud Shell and Web Preview. This way you would eliminate another extra step from your everyday workflow (which is opening the cloud console and launching the Console Shell).", "Automate the deployment of the new Jupyter VM, to avoid manually copy-pasting all the commands above every time you want to create one. This way you make your life even more flexible and agile if you want to maintain separate environments for different projects. There are several ways to do it. Here are a couple of ideas (pick your choice and implement it).", "Ex. 4 option 1. Script everything in the above instructions so that it would all be triggered from one command line command.", "Ex. 4 option 2. Create a Jupyter VM image that you can use as a template whenever you want to launch another clean Jupyter environment independent of other projects.", "Your home for data science. A Medium publication sharing concepts, ideas and codes.", "Machine learning engineer, entrepreneur, nerd. Head of data science, co-founder, Mooncascade."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6ad75562ac1c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://towardsdatascience.com/?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Towards Data Science"}, {"url": "https://medium.com/@askoseeba?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@askoseeba?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Asko Seeba"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc7244ac6ef58&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&user=Asko+Seeba&userId=c7244ac6ef58&source=post_page-c7244ac6ef58----6ad75562ac1c---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://commons.wikimedia.org/wiki/File:Jupyter_logo.svg", "anchor_text": "Jupyter"}, {"url": "https://commons.wikimedia.org/wiki/File:Google_Cloud_Logo.svg", "anchor_text": "Google Cloud"}, {"url": "https://towardsdatascience.com/setting-up-jupyter-on-aws-6b3018dff41f", "anchor_text": "Setting Up Jupyter on AWS"}, {"url": "https://cloud.google.com/resource-manager/docs/creating-managing-projects", "anchor_text": "Create"}, {"url": "https://cloud.google.com/compute/docs/disks/add-persistent-disk", "anchor_text": "here"}, {"url": "https://medium.com/tag/jupyter?source=post_page-----6ad75562ac1c---------------jupyter-----------------", "anchor_text": "Jupyter"}, {"url": "https://medium.com/tag/google-cloud-platform?source=post_page-----6ad75562ac1c---------------google_cloud_platform-----------------", "anchor_text": "Google Cloud Platform"}, {"url": "https://medium.com/tag/data-science?source=post_page-----6ad75562ac1c---------------data_science-----------------", "anchor_text": "Data Science"}, {"url": "https://medium.com/tag/data-engineering?source=post_page-----6ad75562ac1c---------------data_engineering-----------------", "anchor_text": "Data Engineering"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----6ad75562ac1c---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&user=Asko+Seeba&userId=c7244ac6ef58&source=-----6ad75562ac1c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Ftowards-data-science%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&user=Asko+Seeba&userId=c7244ac6ef58&source=-----6ad75562ac1c---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://towardsdatascience.com/?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "More from Towards Data Science"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Ftowards-data-science%2F6ad75562ac1c&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&collection=Towards+Data+Science&collectionId=7f60cf5620c9&source=post_page-----6ad75562ac1c---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://towardsdatascience.com/?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Read more from Towards Data Science"}, {"url": "https://medium.com/?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----6ad75562ac1c--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@askoseeba?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@askoseeba?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Asko Seeba"}, {"url": "https://medium.com/@askoseeba/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "329 Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc7244ac6ef58&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&user=Asko+Seeba&userId=c7244ac6ef58&source=post_page-c7244ac6ef58--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F414ff0200020&operation=register&redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsetting-up-jupyter-on-google-cloud-6ad75562ac1c&newsletterV3=c7244ac6ef58&newsletterV3Id=414ff0200020&user=Asko+Seeba&userId=c7244ac6ef58&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}