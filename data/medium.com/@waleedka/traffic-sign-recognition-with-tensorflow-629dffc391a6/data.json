{"url": "https://medium.com/@waleedka/traffic-sign-recognition-with-tensorflow-629dffc391a6", "time": 1682988336.837746, "path": "medium.com/@waleedka/traffic-sign-recognition-with-tensorflow-629dffc391a6/", "webpage": {"metadata": {"title": "Traffic Sign Recognition with TensorFlow | by Waleed Abdulla | Medium", "h1": "Traffic Sign Recognition with TensorFlow", "description": "This is part 1 of a series about building a deep learning model to recognize traffic signs. It\u2019s intended to be a learning experience, for myself and for anyone else who likes to follow along. There\u2026"}, "outgoing_paragraph_urls": [{"url": "https://github.com/waleedka/traffic-signs-tensorflow", "anchor_text": "source code", "paragraph_index": 1}, {"url": "https://github.com/waleedka/traffic-signs-tensorflow/blob/master/notebook1.ipynb", "anchor_text": "Jupyter notebook", "paragraph_index": 3}, {"url": "https://hub.docker.com/r/waleedka/modern-deep-learning/", "anchor_text": "Docker image that contains many popular deep learning tools", "paragraph_index": 3}, {"url": "http://btsd.ethz.ch/shareddata/", "anchor_text": "Belgian Traffic Sign Dataset", "paragraph_index": 6}, {"url": "http://btsd.ethz.ch/shareddata/", "anchor_text": "http://btsd.ethz.ch/shareddata/", "paragraph_index": 7}, {"url": "http://scikit-image.org/", "anchor_text": "Scikit Image library", "paragraph_index": 11}, {"url": "https://github.com/waleedka/traffic-signs-tensorflow/blob/master/notebook1.ipynb", "anchor_text": "See code in the notebook", "paragraph_index": 13}, {"url": "http://cs231n.github.io/neural-networks-1/", "anchor_text": "here", "paragraph_index": 33}, {"url": "https://www.quora.com/What-are-the-benefits-of-using-rectified-linear-units-vs-the-typical-sigmoid-activation-function", "anchor_text": "here", "paragraph_index": 33}, {"url": "https://www.tensorflow.org/api_docs/python/math_ops/sequence_comparison_and_indexing#argmax", "anchor_text": "argmax", "paragraph_index": 36}, {"url": "https://jamesmccaffrey.wordpress.com/2013/11/05/why-you-should-use-cross-entropy-error-instead-of-classification-error-or-mean-squared-error-for-neural-network-classifier-training/", "anchor_text": "here", "paragraph_index": 38}, {"url": "http://neuralnetworksanddeeplearning.com/chap3.html#the_cross-entropy_cost_function", "anchor_text": "here", "paragraph_index": 38}, {"url": "http://sebastianruder.com/optimizing-gradient-descent/index.html", "anchor_text": "comparing different gradient descent optimizers", "paragraph_index": 40}], "all_paragraphs": ["Yes officer, I saw the speed limit sign. I just didn\u2019t see you.", "This is part 1 of a series about building a deep learning model to recognize traffic signs. It\u2019s intended to be a learning experience, for myself and for anyone else who likes to follow along. There are a lot of resources that cover the theory and math of neural networks, so I\u2019ll focus on the practical aspects instead. I\u2019ll describe my own experience building this model and share the source code and relevant materials. This is suitable for those who know Python and the basics of machine learning already, but want hands on experience and to practice building a real application.", "In this part, I\u2019ll talk about image classification and I\u2019ll keep the model as simple as possible. In later parts, I\u2019ll cover convolutional networks, data augmentation, and object detection.", "The source code is available in this Jupyter notebook. I\u2019m using Python 3.5 and TensorFlow 0.12. If you prefer to run the code in Docker, you can use my Docker image that contains many popular deep learning tools. Run it with this command:", "Note that my project directory is in ~/traffic and I\u2019m mapping it to the /traffic directory in the Docker container. Modify this if you\u2019re using a different directory.", "My first challenge was finding a good training dataset. Traffic sign recognition is a well studied problem, so I figured I\u2019ll find something online.", "I started by googling \u201ctraffic sign dataset\u201d and found several options. I picked the Belgian Traffic Sign Dataset because it was big enough to train on, and yet small enough to be easy to work with.", "You can download the dataset from http://btsd.ethz.ch/shareddata/. There are a lot of datasets on that page, but you only need the two files listed under BelgiumTS for Classification (cropped images):", "After expanding the files, this is my directory structure. Try to match it so you can run the code without having to change the paths:", "Each of the two directories contain 62 subdirectories, named sequentially from 00000 to 00061. The directory names represent the labels, and the images inside each directory are samples of each label.", "Or, if you prefer to sound more formal: do Exploratory Data Analysis. It\u2019s tempting to skip this part, but I\u2019ve found that the code I write to examine the data ends up being used a lot throughout the project. I usually do this in Jupyter notebooks and share them with the team. Knowing your data well from the start saves you a lot of time later.", "The images in this dataset are in an old .ppm format. So old, in fact, that most tools don\u2019t support it. Which meant that I couldn\u2019t casually browse the folders to take a look at the images. Luckily, the Scikit Image library recognizes this format. This code will load the data and return two lists: images and labels.", "This is a small dataset so I\u2019m loading everything into RAM to keep it simple. For larger datasets, you\u2019d want to load the data in batches.", "After loading the images into Numpy arrays, I display a sample image of each label. See code in the notebook. This is our dataset:", "Looks like a good training set. The image quality is great, and there are a variety of angles and lighting conditions. More importantly, the traffic signs occupy most of the area of each image, which allows me to focus on object classification and not have to worry about finding the location of the traffic sign in the image (object detection). I\u2019ll get to object detection in a future post.", "The first thing I noticed from the samples above is that images are square-ish, but have different aspect ratios. My neural network will take a fixed-size input, so I have some preprocessing to do. I\u2019ll get to that soon, but first let\u2019s pick one label and see more of its images. Here is an example of label 32:", "It looks like the dataset considers all speed limit signs to be of the same class, regardless of the numbers on them. That\u2019s fine, as long as we know about it beforehand and know what to expect. That\u2019s why understanding your dataset is so important and can save you a lot of pain and confusion later.", "I\u2019ll leave exploring the other labels to you. Labels 26 and 27 are interesting to check. They also have numbers in red circles, so the model will have to get really good to differentiate between them.", "Most image classification networks expect images of a fixed size, and our first model will do as well. So we need to resize all the images to the same size.", "But since the images have different aspect ratios, then some of them will be stretched vertically or horizontally. Is that a problem? I think it\u2019s not in this case, because the differences in aspect ratios are not that large. My own criteria is that if a person can recognize the images when they\u2019re stretched then the model should be able to do so as well.", "What are the sizes of the images anyway? Let\u2019s print a few examples:", "The sizes seem to hover around 128x128. I could use that size to preserve as much information as possible, but in early development I prefer to use a smaller size because it leads to faster training, which allows me to iterate faster. I experimented with 16x16 and 20x20, but they were too small. I ended up picking 32x32 which is easy to recognize (see below) and reduces the size of the model and training data by a factor of 16 compared to 128x128.", "I\u2019m also in the habit of printing the min() and max() values often. It\u2019s a simple way to verify the range of the data and catch bugs early. This tells me that the image colors are the standard range of 0\u2013255.", "We\u2019re getting to the interesting part! Continuing the theme of keeping it simple, I started with the simplest possible model: A one layer network that consists of one neuron per label.", "This network has 62 neurons and each neuron takes the RGB values of all pixels as input. Effectively, each neuron receives 32*32*3=3072 inputs. This is a fully-connected layer because every neuron connects to every input value. You\u2019re probably familiar with its equation:", "I start with a simple model because it\u2019s easy to explain, easy to debug, and fast to train. Once this works end to end, expanding on it is much easier than building something complex from the start.", "TensorFlow encapsulates the architecture of a neural network in an execution graph. The graph consists of operations (Ops for short) such as Add, Multiply, Reshape, \u2026etc. These ops perform actions on data in tensors (multidimensional arrays).", "I\u2019ll go through the code to build the graph step by step below, but here is the full code if you prefer to scan it first:", "First, I create the Graph object. TensorFlow has a default global graph, but I don\u2019t recommend using it. Global variables are bad in general because they make it too easy to introduce bugs. I prefer to create the graph explicitly.", "Then I define Placeholders for the images and labels. The placeholders are TensorFlow\u2019s way of receiving input from the main program. Notice that I create the placeholders (and all other ops) inside the block of with graph.as_default(). This is so they become part of my graph object rather than the global graph.", "The shape of the images_ph placeholder is [None, 32, 32, 3]. It stands for [batch size, height, width, channels] (often shortened as NHWC) . The None for batch size means that the batch size is flexible, which means that we can feed different batch sizes to the model without having to change the code. Pay attention to the order of your inputs because some models and frameworks might use a different arrangement, such as NCHW.", "Next, I define the fully connected layer. Rather than implementing the raw equation, y = xW + b, I use a handy function that does that in one line and also applies the activation function. It expects input as a one-dimensional vector, though. So I flatten the images first.", "I\u2019m using the ReLU activation function here:", "It simply converts all negative values to zeros. It\u2019s been shown to work well in classification tasks and trains faster than sigmoid or tanh. For more background, check here and here.", "The output of the fully connected layer is a logits vector of length 62 (technically, it\u2019s [None, 62] because we\u2019re dealing with a batch of logits vectors).", "A row in the logits tensor might look like this: [0.3, 0, 0, 1.2, 2.1, .01, 0.4, \u2026.., 0, 0]. The higher the value, the more likely that the image represents that label. Logits are not probabilities, though \u2014 They can have any value, and they don\u2019t add up to 1. The actual absolute values of the logits are not important, just their values relative to each other. It\u2019s easy to convert logits to probabilities using the softmax function if needed (it\u2019s not needed here).", "In this application, we just need the index of the largest value, which corresponds to the id of the label. The argmax op does that.", "The argmax output will be integers in the range 0 to 61.", "Choosing the right loss function is an area of research in and of itself, which I won\u2019t delve into it here other than to say that cross-entropy is the most common function for classification tasks. If you\u2019re not familiar with it, there is a really good explanation here and here.", "Cross-entropy is a measure of difference between two vectors of probabilities. So we need to convert labels and the logits to probability vectors. The function sparse_softmax_cross_entropy_with_logits() simplifies that. It takes the generated logits and the groundtruth labels and does three things: converts the label indexes of shape [None] to logits of shape [None, 62] (one-hot vectors), then it runs softmax to convert both prediction logits and label logits to probabilities, and finally calculates the cross-entropy between the two. This generates a loss vector of shape [None] (1D of length = batch size), which we pass through reduce_mean() to get one single number that represents the loss value.", "Choosing the optimization algorithm is another decision to make. I usually use the ADAM optimizer because it\u2019s been shown to converge faster than simple gradient descent. This post does a great job comparing different gradient descent optimizers.", "The last node in the graph is the initialization op, which simply sets the values of all variables to zeros (or to random values or whatever the variables are set to initialize to).", "Notice that the code above doesn\u2019t execute any of the ops yet. It\u2019s just building the graph and describing its inputs. The variables we defined above, such as init, loss, predicted_labels don\u2019t contain numerical values. They are references to ops that we\u2019ll execute next.", "This is where we iteratively train the model to minimize the loss function. Before we start training, though, we need to create a Session object.", "I mentioned the Graph object earlier and how it holds all the Ops of the model. The Session, on the other hand, holds the values of all the variables. If a graph holds the equation y=xW+b then the session holds the actual values of these variables.", "Usually the first thing to run after starting a session is the initialization op, init, to initialize the variables.", "Then we start the training loop and run the train op repeatedly. While not necessary, it\u2019s useful to run the loss op as well to print its values and monitor the progress of the training.", "In case you\u2019re wondering, I set the loop to 201 so that the i % 10 condition is satisfied in the last round and prints the last loss value. The output should look something like this:", "Now we have a trained model in memory in the Session object. To use it, we call session.run() just like in the training code. The predicted_labels op returns the output of the argmax() function, so that\u2019s what we need to run. Here I classify 10 random images and print both, the predictions and the groundtruth labels for comparison.", "In the notebook, I include a function to visualize the results as well. It generates something like this:", "The visualization shows that the model is working , but doesn\u2019t quantify how accurate it is. And you might\u2019ve noticed that it\u2019s classifying the training images, so we don\u2019t know yet if the model generalizes to images that it hasn\u2019t seen before. Next, we calculate a better evaluation metric.", "To properly measure how the model generalizes to data it hasn\u2019t seen, I do the evaluation on test data that I didn\u2019t use in training. The BelgiumTS dataset makes this easy by providing two separate sets, one for training and one for testing.", "In the notebook I load the test set, resize the images to 32x32, and then calculate the accuracy. This is the relevant part of the code that calculates the accuracy.", "The accuracy I get in each run ranges between 0.40 and 0.70 depending on whether the model lands on a local minimum or a global minimum. This is expected when running a simple model like this one. In a future post I\u2019ll talk about ways to improve the consistency of the results.", "Congratulations! We have a working simple neural network. Given how simple this neural network is, training takes just a minute on my laptop so I didn\u2019t bother saving the trained model. In the next part, I\u2019ll add code to save and load trained models and expand to use multiple layers, convolutional networks, and data augmentation. Stay tuned!"], "all_outgoing_urls": [{"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@waleedka?source=post_page-----629dffc391a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@waleedka?source=post_page-----629dffc391a6--------------------------------", "anchor_text": "Waleed Abdulla"}, {"url": "https://github.com/waleedka/traffic-signs-tensorflow", "anchor_text": "source code"}, {"url": "https://github.com/waleedka/traffic-signs-tensorflow/blob/master/notebook1.ipynb", "anchor_text": "Jupyter notebook"}, {"url": "https://hub.docker.com/r/waleedka/modern-deep-learning/", "anchor_text": "Docker image that contains many popular deep learning tools"}, {"url": "http://btsd.ethz.ch/shareddata/", "anchor_text": "Belgian Traffic Sign Dataset"}, {"url": "http://btsd.ethz.ch/shareddata/", "anchor_text": "http://btsd.ethz.ch/shareddata/"}, {"url": "http://scikit-image.org/", "anchor_text": "Scikit Image library"}, {"url": "https://github.com/waleedka/traffic-signs-tensorflow/blob/master/notebook1.ipynb", "anchor_text": "See code in the notebook"}, {"url": "http://cs231n.github.io/neural-networks-1/", "anchor_text": "here"}, {"url": "https://www.quora.com/What-are-the-benefits-of-using-rectified-linear-units-vs-the-typical-sigmoid-activation-function", "anchor_text": "here"}, {"url": "https://www.tensorflow.org/api_docs/python/math_ops/sequence_comparison_and_indexing#argmax", "anchor_text": "argmax"}, {"url": "https://jamesmccaffrey.wordpress.com/2013/11/05/why-you-should-use-cross-entropy-error-instead-of-classification-error-or-mean-squared-error-for-neural-network-classifier-training/", "anchor_text": "here"}, {"url": "http://neuralnetworksanddeeplearning.com/chap3.html#the_cross-entropy_cost_function", "anchor_text": "here"}, {"url": "http://sebastianruder.com/optimizing-gradient-descent/index.html", "anchor_text": "comparing different gradient descent optimizers"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----629dffc391a6---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/neural-networks?source=post_page-----629dffc391a6---------------neural_networks-----------------", "anchor_text": "Neural Networks"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----629dffc391a6---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/self-driving-cars?source=post_page-----629dffc391a6---------------self_driving_cars-----------------", "anchor_text": "Self Driving Cars"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----629dffc391a6---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/@waleedka?source=post_page-----629dffc391a6--------------------------------", "anchor_text": "More from Waleed Abdulla"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f594181b9d7&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40waleedka%2Ftraffic-sign-recognition-with-tensorflow-629dffc391a6&newsletterV3=1a69ae209bc4&newsletterV3Id=1f594181b9d7&user=Waleed+Abdulla&userId=1a69ae209bc4&source=-----629dffc391a6---------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://medium.com/?source=post_page-----629dffc391a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----629dffc391a6--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----629dffc391a6--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----629dffc391a6--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----629dffc391a6--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----629dffc391a6--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----629dffc391a6--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/plans?source=upgrade_membership---two_column_layout_sidebar----------------------------------", "anchor_text": "Get unlimited access"}, {"url": "https://medium.com/@waleedka?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@waleedka?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Waleed Abdulla"}, {"url": "https://medium.com/@waleedka/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "1.7K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F1f594181b9d7&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40waleedka%2Ftraffic-sign-recognition-with-tensorflow-629dffc391a6&newsletterV3=1a69ae209bc4&newsletterV3Id=1f594181b9d7&user=Waleed+Abdulla&userId=1a69ae209bc4&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}