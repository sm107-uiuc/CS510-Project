{"url": "https://medium.com/@erikhallstrm/hello-world-rnn-83cd7105b767", "time": 1682988279.7997718, "path": "medium.com/@erikhallstrm/hello-world-rnn-83cd7105b767/", "webpage": {"metadata": {"title": "How to build a Recurrent Neural Network in TensorFlow (1/7) | by Erik Hallstr\u00f6m | Medium", "h1": "How to build a Recurrent Neural Network in TensorFlow (1/7)", "description": "This article has been republished at Educaora and has also been open sourced. Unfortunately TensorFlow 2.0 changed the API so it is broken for later versions. Any help to make the tutorials up to\u2026"}, "outgoing_paragraph_urls": [{"url": "https://educaora.com/@erikhallstrom/How_to_build_a_Recurrent_Neural_Network_in_TensorFlow", "anchor_text": "Educaora", "paragraph_index": 0}, {"url": "https://github.com/3h4/tutorials", "anchor_text": "open sourced", "paragraph_index": 0}, {"url": "https://medium.com/@erikhallstrm/hello-world-tensorflow-649b15aed18c#.kogbhxazp", "anchor_text": "available here", "paragraph_index": 1}, {"url": "https://arxiv.org/pdf/1506.00019.pdf", "anchor_text": "this article", "paragraph_index": 4}, {"url": "https://www.quora.com/In-deep-learning-why-dont-we-use-the-whole-training-set-to-compute-the-gradient/answer/Ian-Goodfellow?srid=9KXj", "anchor_text": "this question", "paragraph_index": 8}, {"url": "https://docs.scipy.org/doc/numpy/user/basics.broadcasting.html", "anchor_text": "broadcasted", "paragraph_index": 17}, {"url": "https://www.tensorflow.org/versions/r0.11/api_docs/python/nn.html#sparse_softmax_cross_entropy_with_logits", "anchor_text": "the API", "paragraph_index": 21}, {"url": "http://r2rt.com/styles-of-truncated-backpropagation.html", "anchor_text": "this article", "paragraph_index": 24}, {"url": "https://medium.com/@erikhallstrm/tensorflow-rnn-api-2bb31821b185#.u3wew5ck0", "anchor_text": "the next post", "paragraph_index": 30}], "all_paragraphs": ["This article has been republished at Educaora and has also been open sourced. Unfortunately TensorFlow 2.0 changed the API so it is broken for later versions. Any help to make the tutorials up to date are greatly appreciated. I also recommend you looking into PyTorch.", "In this tutorial I\u2019ll explain how to build a simple working Recurrent Neural Network in TensorFlow. This is the first in a series of seven parts where various aspects and techniques of building Recurrent Neural Networks in TensorFlow are covered. A short introduction to TensorFlow is available here. For now, let\u2019s get started with the RNN!", "It is short for \u201cRecurrent Neural Network\u201d, and is basically a neural network that can be used when your data is treated as a sequence, where the particular order of the data-points matter. More importantly, this sequence can be of arbitrary length.", "The most straight-forward example is perhaps a time-series of numbers, where the task is to predict the next value given previous values. The input to the RNN at every time-step is the current value as well as a state vector which represent what the network has \u201cseen\u201d at time-steps before. This state-vector is the encoded memory of the RNN, initially set to zero.", "The best and most comprehensive article explaining RNN:s I\u2019ve found so far is this article by researchers at UCSD, highly recommended. For now you only need to understand the basics, read it until the \u201cModern RNN architectures\u201d-section. That will be covered later.", "Although this article contains some explanations, it is mostly focused on the practical part, how to build it. You are encouraged to look up more theory on the Internet, there are plenty of good explanations.", "We will build a simple Echo-RNN that remembers the input data and then echoes it after a few time-steps. First let\u2019s set some constants we\u2019ll need, what they mean will become clear in a moment.", "Now generate the training data, the input is basically a random binary vector. The output will be the \u201cecho\u201d of the input, shifted echo_step steps to the right.", "Notice the reshaping of the data into a matrix with batch_size rows. Neural networks are trained by approximating the gradient of loss function with respect to the neuron-weights, by looking at only a small subset of the data, also known as a mini-batch. The theoretical reason for doing this is further elaborated in this question. The reshaping takes the whole dataset and puts it into a matrix, that later will be sliced up into these mini-batches.", "TensorFlow works by first building up a computational graph, that specifies what operations will be done. The input and output of this graph is typically multidimensional arrays, also known as tensors. The graph, or parts of it can then be executed iteratively in a session, this can either be done on the CPU, GPU or even a resource on a remote server.", "The two basic TensorFlow data-structures that will be used in this example are placeholders and variables. On each run the batch data is fed to the placeholders, which are \u201cstarting nodes\u201d of the computational graph. Also the RNN-state is supplied in a placeholder, which is saved from the output of the previous run.", "The weights and biases of the network are declared as TensorFlow variables, which makes them persistent across runs and enables them to be updated incrementally for each batch.", "The figure below shows the input data-matrix, and the current batch batchX_placeholder is in the dashed rectangle. As we will see later, this \u201cbatch window\u201d is slided truncated_backprop_length steps to the right at each run, hence the arrow. In our example below batch_size = 3, truncated_backprop_length = 3, and total_series_length = 36. Note that these numbers are just for visualization purposes, the values are different in the code. The series order index is shown as numbers in a few of the data-points.", "Now it\u2019s time to build the part of the graph that resembles the actual RNN computation, first we want to split the batch data into adjacent time-steps.", "As you can see in the picture below that is done by unpacking the columns (axis = 1) of the batch into a Python list. The RNN will simultaneously be training on different parts in the time-series; steps 4 to 6, 16 to 18 and 28 to 30 in the current batch-example. The reason for using the variable names \u201cplural\u201d_\u201dseries\u201d is to emphasize that the variable is a list that represent a time-series with multiple entries at each step.", "The fact that the training is done on three places simultaneously in our time-series, requires us to save three instances of states when propagating forward. That has already been accounted for, as you see that the init_state placeholder has batch_size rows.", "Next let\u2019s build the part of the graph that does the actual RNN computation.", "Notice the concatenation on line 6, what we actually want to do is calculate the sum of two affine transforms current_input * Wa + current_state * Wb in the figure below. By concatenating those two tensors you will only use one matrix multiplication. The addition of the bias b is broadcasted on all samples in the batch.", "You may wonder the variable name truncated_backprop_length is supposed to mean. When a RNN is trained, it is actually treated as a deep neural network with reoccurring weights in every layer. These layers will not be unrolled to the beginning of time, that would be too computationally expensive, and are therefore truncated at a limited number of time-steps. In our sample schematics above, the error is backpropagated three steps in our batch.", "This is the final part of the graph, a fully connected softmax layer from the state to the output that will make the classes one-hot encoded, and then calculating the loss of the batch.", "The last line is adding the training functionality, TensorFlow will perform back-propagation for us automatically \u2014 the computation graph is executed once for each mini-batch and the network-weights are updated incrementally.", "Notice the API call to sparse_softmax_cross_entropy_with_logits, it automatically calculates the softmax internally and then computes the cross-entropy. In our example the classes are mutually exclusive (they are either zero or one), which is the reason for using the \u201cSparse-softmax\u201d, you can read more about it in the API. The usage is to havelogits is of shape [batch_size, num_classes] and labels of shape [batch_size].", "There is a visualization function so we can se what\u2019s going on in the network as we train. It will plot the loss over the time, show training input, training output and the current predictions by the network on different sample series in a training batch.", "It\u2019s time to wrap up and train the network, in TensorFlow the graph is executed in a session. New data is generated on each epoch (not the usual way to do it, but it works in this case since everything is predictable).", "You can see that we are moving truncated_backprop_length steps forward on each iteration (line 15\u201319), but it is possible have different strides. This subject is further elaborated in this article. The downside with doing this is that truncated_backprop_length need to be significantly larger than the time dependencies (three steps in our case) in order to encapsulate the relevant training data. Otherwise there might a lot of \u201cmisses\u201d, as you can see on the figure below.", "Also realize that this is just simple example to explain how a RNN works, this functionality could easily be programmed in just a few lines of code. The network will be able to exactly learn the echo behavior so there is no need for testing data.", "The program will update the plot as training progresses, shown in the picture below. Blue bars denote a training input signal (binary one), red bars show echos in the training output and green bars are the echos the net is generating. The different bar plots show different sample series in the current batch.", "Our algorithm will fairly quickly learn the task. The graph in the top-left corner shows the output of the loss function, but why are there spikes in the curve? Think of it for a moment, answer is below.", "The reason for the spikes is that we are starting on a new epoch, and generating new data. Since the matrix is reshaped, the first element on each row is adjacent to the last element in the previous row. The first few elements on all rows (except the first) have dependencies that will not be included in the state, so the net will always perform badly on the first batch.", "This is the whole runnable program, just copy-paste and run. After each part in the article series the whole runnable program will be presented. If a line is referenced by number, these are the line numbers that we mean.", "In the next post in this series we will be simplify the computational graph creation by using the native TensorFlow RNN API."], "all_outgoing_urls": [{"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@erikhallstrm?source=post_page-----83cd7105b767--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@erikhallstrm?source=post_page-----83cd7105b767--------------------------------", "anchor_text": "Erik Hallstr\u00f6m"}, {"url": "https://educaora.com/@erikhallstrom/How_to_build_a_Recurrent_Neural_Network_in_TensorFlow", "anchor_text": "Educaora"}, {"url": "https://github.com/3h4/tutorials", "anchor_text": "open sourced"}, {"url": "https://medium.com/@erikhallstrm/hello-world-tensorflow-649b15aed18c#.kogbhxazp", "anchor_text": "available here"}, {"url": "https://arxiv.org/pdf/1506.00019.pdf", "anchor_text": "this article"}, {"url": "https://www.quora.com/In-deep-learning-why-dont-we-use-the-whole-training-set-to-compute-the-gradient/answer/Ian-Goodfellow?srid=9KXj", "anchor_text": "this question"}, {"url": "https://docs.scipy.org/doc/numpy/user/basics.broadcasting.html", "anchor_text": "broadcasted"}, {"url": "https://www.tensorflow.org/versions/r0.11/api_docs/python/nn.html#sparse_softmax_cross_entropy_with_logits", "anchor_text": "the API"}, {"url": "http://r2rt.com/styles-of-truncated-backpropagation.html", "anchor_text": "this article"}, {"url": "https://medium.com/@erikhallstrm/tensorflow-rnn-api-2bb31821b185#.u3wew5ck0", "anchor_text": "the next post"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----83cd7105b767---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/artificial-intelligence?source=post_page-----83cd7105b767---------------artificial_intelligence-----------------", "anchor_text": "Artificial Intelligence"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----83cd7105b767---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----83cd7105b767---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/recurrent-neural-network?source=post_page-----83cd7105b767---------------recurrent_neural_network-----------------", "anchor_text": "Recurrent Neural Network"}, {"url": "https://medium.com/@erikhallstrm?source=post_page-----83cd7105b767--------------------------------", "anchor_text": "More from Erik Hallstr\u00f6m"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff3de7ac04d94&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40erikhallstrm%2Fhello-world-rnn-83cd7105b767&newsletterV3=b3c3035347b2&newsletterV3Id=f3de7ac04d94&user=Erik+Hallstr%C3%B6m&userId=b3c3035347b2&source=-----83cd7105b767---------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://medium.com/?source=post_page-----83cd7105b767--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----83cd7105b767--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----83cd7105b767--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----83cd7105b767--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----83cd7105b767--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----83cd7105b767--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----83cd7105b767--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/plans?source=upgrade_membership---two_column_layout_sidebar----------------------------------", "anchor_text": "Get unlimited access"}, {"url": "https://medium.com/@erikhallstrm?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@erikhallstrm?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Erik Hallstr\u00f6m"}, {"url": "https://medium.com/@erikhallstrm/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ff3de7ac04d94&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40erikhallstrm%2Fhello-world-rnn-83cd7105b767&newsletterV3=b3c3035347b2&newsletterV3Id=f3de7ac04d94&user=Erik+Hallstr%C3%B6m&userId=b3c3035347b2&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}