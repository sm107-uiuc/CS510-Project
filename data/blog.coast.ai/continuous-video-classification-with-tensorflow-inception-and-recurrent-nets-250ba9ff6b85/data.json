{"url": "https://blog.coast.ai/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85", "time": 1683019548.92151, "path": "blog.coast.ai/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85/", "webpage": {"metadata": {"title": "Continuous video classification with TensorFlow, Inception and Recurrent Nets | by Matt Harvey | Coastline Automation", "h1": "Continuous video classification with TensorFlow, Inception and Recurrent Nets", "description": "A video is a sequence of images. In our previous post, we explored a method for continuous online video classification that treated each frame as discrete, as if its context relative to previous\u2026"}, "outgoing_paragraph_urls": [{"url": "https://medium.com/@harvitronix/continuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1", "anchor_text": "continuous online video classification", "paragraph_index": 0}, {"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "The Unreasonable Effectiveness of Recurrent Neural Networks", "paragraph_index": 3}, {"url": "http://colah.github.io/posts/2015-08-Understanding-LSTMs/", "anchor_text": "outstanding essay about LSTMs", "paragraph_index": 5}, {"url": "https://github.com/harvitronix/continuous-online-video-classification-blog", "anchor_text": "available on GitHub", "paragraph_index": 9}, {"url": "http://tflearn.org/", "anchor_text": "TFLearn", "paragraph_index": 13}, {"url": "https://hackernoon.com/five-video-classification-methods-implemented-in-keras-and-tensorflow-99cad29cc0b5", "anchor_text": "Five video classification methods implemented in Keras and TensorFlow", "paragraph_index": 25}], "all_paragraphs": ["A video is a sequence of images. In our previous post, we explored a method for continuous online video classification that treated each frame as discrete, as if its context relative to previous frames was unimportant. Today, we\u2019re going to stop treating our video as individual photos and start treating it like the video that it is by looking at our images in a sequence. We\u2019ll process these sequences by harnessing the magic of recurrent neural networks (RNNs).", "To restate the problem we outlined in our previous post: We\u2019re attempting to continually classify video as it\u2019s streamed, in an online system. Specifically, we\u2019re classifying whether what\u2019s streaming on a TV is a football game or an advertisement.", "Convolutional neural networks, which we used exclusively in our previous post, do an amazing job at taking in a fixed-size vector, like an image of an animal, and generating a fixed-size label, like the class of animal in the image. What CNNs cannot do (without computationally intensive 3D convolution layers) is accept a sequence of vectors. That\u2019s where RNNs come in.", "RNNs allow us to understand the context of a video frame, relative to the frames that came before it. They do this by passing the output of one training step to the input of the next training step, along with the new frames. Andrej Karpathy describes this eloquently in his popular blog post, \u201cThe Unreasonable Effectiveness of Recurrent Neural Networks\u201d:", "At the core, RNNs have a deceptively simple API: They accept an input vector x and give you an output vector y. However, crucially this output vector\u2019s contents are influenced not only by the input you just fed in, but also on the entire history of inputs you\u2019ve fed in in the past.", "We\u2019re using a special type of RNN here, called an LSTM, that allows our network to learn long-term dependencies. Christopher Olah writes in his outstanding essay about LSTMs: \u201cAlmost all exciting results based on recurrent neural networks are achieved with [LSTMs].\u201d", "Our aim is to use the power of CNNs to detect spatial features and RNNs for the temporal features, effectively building a CNN->RNN network, or CRNN. For the sake of time, rather than building and training a new network from scratch, we\u2019ll\u2026", "Step 2 is unique so we\u2019ll expand on it a bit. There are two interesting paths that come to mind when adding a recurrent net to the end of our convolutional net:", "Let\u2019s say you\u2019re baking a cake. You have at your disposal all of the ingredients in the world. We\u2019ll say that this assortment of ingredients is our image to be classified. By looking at a recipe, you see that all of the possible things you could use to make a cake (flour, whisky, another cake) have been reduced down to ingredients and measurements that will make a good cake. The person who created the recipe out of all possible ingredients is the convolutional network, and the resulting instructions are the output of our pool layer. Now you make the cake and it\u2019s ready to eat. You\u2019re the softmax layer, and the finished product is our class prediction.", "I\u2019ve made the code to explore these methods available on GitHub. I\u2019ll pull out a couple interesting bits here:", "In order to turn our discrete predictions or features into a sequence, we loop through each frame in chronological order, add it to a queue of size N, and pop off the first frame we previously added. Here\u2019s the gist:", "N represents the length of our sequence that we\u2019ll pass to the RNN. We could choose any length for N, but I settled on 40. At 10fps, which is the framerate of our video, that gives us 4 seconds of video to process at a time. This seems like a good balance of memory usage and information.", "The architecture of the network is a single LSTM layer with 256 nodes. This is followed by a dropout of 0.2 to help prevent over-fitting and a fully-connected softmax layer to generate our predictions. I also experimented with wider and deeper networks, but neither performed as well as this one. It\u2019s likely that with a larger training set, a deeper network would perform best.", "Note: I\u2019m using the incredible TFLearn library, a higher-level API for TensorFlow, to construct our network, which saves us from having to write a lot of code.", "Once we have our sequence of features and our network, training with TFLearn is a breeze.", "Now, let\u2019s evaluate each of the methods we outlined above for adding an RNN to our CNN.", "Intuitively, if one frame is an ad and the next is a football game, it\u2019s essentially impossible that the next will be an ad again. (I wish commercials were only 1/10th of a second long!)", "This is why it could be interesting to examine the temporal dependencies of the probabilities of each label before we look at the more raw output of the pool layer. We convert our individual predictions into sequences using the code above, and then feed the sequences to our RNN.", "After training the RNN on our first batch of data, we then evaluate the predictions on both the batch we used for training and a holdout set that the RNN has never seen. No surprise, evaluating the same data we used to train gives us an accuracy of 99.55%! Good sanity check that we\u2019re on the right path.", "Now the fun part. We run the holdout set through the same network and get\u2026 95.4%! Better than our 93.3% we got without the LSTM, and not a bad result, given we\u2019re using the full output of the CNN, and thus not giving the RNN much responsibility. Let\u2019s change that.", "Here we\u2019ll go a little deeper. (See what I did there?) Instead of letting the CNN do all the hard work, we\u2019ll give more responsibility to the RNN by using output of the CNN\u2019s pool layer, which gives us the feature representation (not a prediction) of our images. We again build sequences with this data to feed into our RNN.", "Running our training data through the network to make sure we get high accuracy succeeds at 99.89%! Sanity checked.", "We have shown that taking both spatial and temporal features into consideration improves our accuracy significantly.", "Next, we\u2019ll want to try this method on a more complex dataset, perhaps using multiple classes of TV programming, and with a whole whackload more data to train on. (Remember, we\u2019re only using 20 minutes of TV here.)", "Once we feel comfortable there, we\u2019ll go ahead and combine the RNN and CNN into one network so we can more easily deploy it in an online system. That\u2019s going to be fun.", "Part 3 is now available: Five video classification methods implemented in Keras and TensorFlow", "Practical applications of deep learning and research reports from the road.", "Founder of Coastline Automation, using AI to make every car crash-proof."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F250ba9ff6b85&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://blog.coast.ai/?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": ""}, {"url": "https://blog.coast.ai/?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Coastline Automation"}, {"url": "https://medium.com/@harvitronix?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Matt Harvey"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F58288d309a98&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&user=Matt+Harvey&userId=58288d309a98&source=post_page-58288d309a98----250ba9ff6b85---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://medium.com/@harvitronix/continuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1", "anchor_text": "continuous online video classification"}, {"url": "http://karpathy.github.io/2015/05/21/rnn-effectiveness/", "anchor_text": "The Unreasonable Effectiveness of Recurrent Neural Networks"}, {"url": "http://colah.github.io/posts/2015-08-Understanding-LSTMs/", "anchor_text": "outstanding essay about LSTMs"}, {"url": "https://github.com/harvitronix/continuous-online-video-classification-blog", "anchor_text": "available on GitHub"}, {"url": "http://tflearn.org/", "anchor_text": "TFLearn"}, {"url": "https://hackernoon.com/five-video-classification-methods-implemented-in-keras-and-tensorflow-99cad29cc0b5", "anchor_text": "Five video classification methods implemented in Keras and TensorFlow"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----250ba9ff6b85---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----250ba9ff6b85---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/recurrent-neural-network?source=post_page-----250ba9ff6b85---------------recurrent_neural_network-----------------", "anchor_text": "Recurrent Neural Network"}, {"url": "https://medium.com/tag/classification?source=post_page-----250ba9ff6b85---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/tag/ai?source=post_page-----250ba9ff6b85---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fcoastline-automation%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&user=Matt+Harvey&userId=58288d309a98&source=-----250ba9ff6b85---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fcoastline-automation%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&user=Matt+Harvey&userId=58288d309a98&source=-----250ba9ff6b85---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://blog.coast.ai/?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "More from Coastline Automation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fcoastline-automation%2F250ba9ff6b85&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&collection=Coastline+Automation&collectionId=1336970de061&source=post_page-----250ba9ff6b85---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://blog.coast.ai/?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Read more from Coastline Automation"}, {"url": "https://medium.com/?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----250ba9ff6b85--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matt Harvey"}, {"url": "https://medium.com/@harvitronix/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.9K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F58288d309a98&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&user=Matt+Harvey&userId=58288d309a98&source=post_page-58288d309a98--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F41f0af8130eb&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85&newsletterV3=58288d309a98&newsletterV3Id=41f0af8130eb&user=Matt+Harvey&userId=58288d309a98&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}