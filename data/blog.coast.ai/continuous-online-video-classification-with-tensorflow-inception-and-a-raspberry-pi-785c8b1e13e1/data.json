{"url": "https://blog.coast.ai/continuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1", "time": 1682988303.222347, "path": "blog.coast.ai/continuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1/", "webpage": {"metadata": {"title": "Continuous online video classification with TensorFlow, Inception and a Raspberry Pi | by Matt Harvey | Coastline Automation", "h1": "Continuous online video classification with TensorFlow, Inception and a Raspberry Pi", "description": "Much has been written about using deep learning to classify prerecorded video clips. These papers and projects impressive tag, classify and even caption each clip, with each comprising a single\u2026"}, "outgoing_paragraph_urls": [{"url": "https://petewarden.com/2016/02/28/tensorflow-for-poets/", "anchor_text": "TensorFlow for Poets", "paragraph_index": 11}, {"url": "https://github.com/tensorflow/tensorflow", "anchor_text": "TensorFlow repo", "paragraph_index": 14}, {"url": "https://github.com/samjabrahams/tensorflow-on-raspberry-pi", "anchor_text": "excellent instructions", "paragraph_index": 26}, {"url": "https://medium.com/@harvitronix/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85#.edhv7ysrx", "anchor_text": "the next post", "paragraph_index": 31}, {"url": "https://medium.com/@harvitronix/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85#.edhv7ysrx", "anchor_text": "Part 2 is now live!", "paragraph_index": 32}, {"url": "https://github.com/harvitronix/continuous-online-video-classification-blog", "anchor_text": "available on GitHub.", "paragraph_index": 33}], "all_paragraphs": ["Much has been written about using deep learning to classify prerecorded video clips. These papers and projects impressive tag, classify and even caption each clip, with each comprising a single action or subject.", "Today, we\u2019re going to explore a way to continuously classify video as it\u2019s captured, in an online system. Continuous classification allows us to solve all sorts of interesting problems in real-time, like understanding what\u2019s in front of a car for autonomous driving applications to understanding what\u2019s streaming on a TV. We\u2019ll attempt to do the latter using only open source software and uber-cheap hardware. Specifically, TensorFlow on a Raspberry Pi with a PiCamera.", "We\u2019ll use a \u201cnaive\u201d classification approach in this post (see next section), which will give us a relatively straightforward path to solving our problem and will form the basis for more advanced systems to explore later.", "By the time we\u2019re done today, we should be able to classify what we see on our TV as either a football game or an advertisement, running on our Raspberry Pi.", "Video is an interesting classification problem because it includes both temporal and spatial features. That is, at each frame within a video, the frame itself holds important information (spatial), as does the context of that frame relative to the frames before it in time (temporal).", "We hypothesize that for many applications, using only spatial features is sufficient for achieving high accuracy. This approach has the benefit of being relatively simple, or at least minimal. It\u2019s naive because it ignores the information encoded between multiple frames of the video.", "Since football games have rather distinct spatial features, we believe this method should work wonderfully for the task at hand.", "We\u2019re going to collect data for offline training with a Raspberry Pi and a PiCamera. We\u2019ll point the camera at a TV and record 10 frames per second, or more specifically, save 10 jpegs every second, which will comprise our \u201cvideo\u201d.", "Here\u2019s the code for capturing our images:", "Once we have our data, we\u2019ll use a convolutional neural network (CNN) to classify each frame with one of our labels: ad or football.", "CNNs are the state-of-the-art for image classification. And in 2016, it\u2019s essentially a solved problem. It feels crazy to say that, but it really is: Thanks in large part to Google\u2192TensorFlow\u2192Inception and the many researchers who came before it, there\u2019s very little low-level coding required for us when it comes to training a CNN for our continuous video classification problem.", "Pete Warden at Google wrote an awesome blog post called TensorFlow for Poets that shows how to retrain the last layer of Inception with new images and classes. This is called transfer learning, and it lets us take advantage of weeks of previous training without having to train a complex CNN from scratch. Put another way, it lets us train an image classifier with a relatively small training set.", "We collected 20 minutes of footage at 10 jpegs per second, which amounted to 4,146 ad frames and 7,899 football frames. The next step is to sort each frame into two folders: football and ad. The name of the folders represent the labels of each frame, which will be the classes our network will learn to predict on when we retrain the top layer of the Inception v3 CNN.", "This is essentially using the flowers method described in TensorFlow for Poets, applied to video frames.", "To retrain the final layer of the CNN on our new data, we checkout the r0.11 tag from the TensorFlow repo and run the following command:", "Retraining the final layer of the network on this data takes about 30 minutes on my laptop with a GeForce GTX 960m GPU. At the completion of 4,000 training steps, our model reports an incredible 98.8% accuracy on the held out validation set! I\u2019m not sure I could do much better using my eyes on the same data. As a point of reference, if the network had classified each frame as football, it would have achieved about 66% accuracy. So it seems to be working!", "It\u2019s always a good idea to run some known data through a trained network to sanity check the results, so we\u2019ll do that here.", "Here\u2019s the code we use to classify a single image manually through our retrained model:", "And here are the results of spot checking individual frames:", "Before we transfer everything to our Pi and do this in real-time, let\u2019s use a different batch of recorded data and see how well we do on that set.", "To get this dataset, and to make sure we don\u2019t have any data leakage into our training set, we separately record another 19 minutes of the football broadcast. This dataset amounted to 2,639 ad frames and 8,524 football frames.", "We run each frame of this set through our classifier and achieve a true holdout accuracy score of 93.3%. Awesome!", "Looks like we\u2019ve validated our hypothesis that we can achieve high levels of accuracy while only considering spatial features. Impressive results, considering that we only used 20 minutes of training data! Thank you, Google, Pete, TensorFlow and all the folks who have developed CNNs over the years for your incredible work and contributions.", "Great, so now we have our CNN trained and we know that we can classify each frame of our video with relatively high accuracy. How does it do on live TV, with always changing context?", "For this, we load up our Raspberry Pi 3 with our newly trained model weights, turn on the PiCamera at 10 fps, and instead of saving the image, send it through our CNN to be classified.", "We have to make some modifications to the code to classify in real time. The final result looks like this:", "We also have to get TensorFlow running on the Pi. Sam Abrahams wrote up excellent instructions for doing this, so I won\u2019t cover them again here.", "After we install our dependencies, we run the program and\u2026 crap! Inception on the Raspberry Pi 3 can only classify one image every four seconds.", "Okay, so we don\u2019t quite have the hardware yet to do 10fps, but this still feels like magic, so let\u2019s see how we do.", "Flipping on Sunday Night Football and pointing our camera at the TV shows a remarkable job at classifying each moment as football or ad, once every few seconds. For the vast majority of the broadcast, we see our prediction come out true to life. So cool.", "In all, our naive method worked remarkably well at continuous online video classification for this particular use case. But we know that we\u2019re only considering part of the information provided to us inherently in video, and so there must be room for improvement, especially as our datasets become more complex.", "For that, we\u2019ll have to dive deeper. So in the next post, we\u2019ll explore feeding the output of our CNN (both the final softmax layer and the pool layer, which gives us a 2,048-d feature vector of each image) to an LSTM RNN to see if we can increase our accuracy.", "Update: Part 2 is now live!", "The code that accompanies this post is available on GitHub.", "Practical applications of deep learning and research reports from the road.", "Founder of Coastline Automation, using AI to make every car crash-proof."], "all_outgoing_urls": [{"url": "https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F785c8b1e13e1&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---two_column_layout_nav----------------------------------", "anchor_text": "Open in app"}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://medium.com/?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---two_column_layout_nav-----------------------new_post_sidenav-----------", "anchor_text": "Write"}, {"url": "https://medium.com/search?source=---two_column_layout_nav----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign up"}, {"url": "https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=post_page---two_column_layout_nav-----------------------global_nav-----------", "anchor_text": "Sign In"}, {"url": "https://blog.coast.ai/?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": ""}, {"url": "https://blog.coast.ai/?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Coastline Automation"}, {"url": "https://medium.com/@harvitronix?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Matt Harvey"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F58288d309a98&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&user=Matt+Harvey&userId=58288d309a98&source=post_page-58288d309a98----785c8b1e13e1---------------------follow_byline-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=--------------------------bookmark_header-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=--------------------------bookmark_header-----------", "anchor_text": "Save"}, {"url": "https://petewarden.com/2016/02/28/tensorflow-for-poets/", "anchor_text": "TensorFlow for Poets"}, {"url": "https://github.com/tensorflow/tensorflow", "anchor_text": "TensorFlow repo"}, {"url": "https://github.com/samjabrahams/tensorflow-on-raspberry-pi", "anchor_text": "excellent instructions"}, {"url": "https://medium.com/@harvitronix/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85#.edhv7ysrx", "anchor_text": "the next post"}, {"url": "https://medium.com/@harvitronix/continuous-video-classification-with-tensorflow-inception-and-recurrent-nets-250ba9ff6b85#.edhv7ysrx", "anchor_text": "Part 2 is now live!"}, {"url": "https://github.com/harvitronix/continuous-online-video-classification-blog", "anchor_text": "available on GitHub."}, {"url": "https://arxiv.org/pdf/1609.06782.pdf", "anchor_text": "Deep Learning for Video Classification and Captioning"}, {"url": "https://arxiv.org/pdf/1504.01561v1.pdf", "anchor_text": "Modeling Spatial-Temporal Clues in a Hybrid Deep Learning Framework for Video Classification"}, {"url": "http://www.cv-foundation.org/openaccess/content_cvpr_2015/papers/Ng_Beyond_Short_Snippets_2015_CVPR_paper.pdf", "anchor_text": "Beyond Short Snippets: Deep Networks for Video Classification"}, {"url": "https://medium.com/tag/machine-learning?source=post_page-----785c8b1e13e1---------------machine_learning-----------------", "anchor_text": "Machine Learning"}, {"url": "https://medium.com/tag/deep-learning?source=post_page-----785c8b1e13e1---------------deep_learning-----------------", "anchor_text": "Deep Learning"}, {"url": "https://medium.com/tag/tensorflow?source=post_page-----785c8b1e13e1---------------tensorflow-----------------", "anchor_text": "TensorFlow"}, {"url": "https://medium.com/tag/ai?source=post_page-----785c8b1e13e1---------------ai-----------------", "anchor_text": "AI"}, {"url": "https://medium.com/tag/classification?source=post_page-----785c8b1e13e1---------------classification-----------------", "anchor_text": "Classification"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fcoastline-automation%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&user=Matt+Harvey&userId=58288d309a98&source=-----785c8b1e13e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fcoastline-automation%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&user=Matt+Harvey&userId=58288d309a98&source=-----785c8b1e13e1---------------------clap_footer-----------", "anchor_text": ""}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&source=--------------------------bookmark_footer-----------", "anchor_text": ""}, {"url": "https://blog.coast.ai/?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "More from Coastline Automation"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fcoastline-automation%2F785c8b1e13e1&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&collection=Coastline+Automation&collectionId=1336970de061&source=post_page-----785c8b1e13e1---------------------follow_footer-----------", "anchor_text": "Follow"}, {"url": "https://blog.coast.ai/?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Read more from Coastline Automation"}, {"url": "https://medium.com/?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/about?autoplay=1&source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "About"}, {"url": "https://help.medium.com/hc/en-us?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Help"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Terms"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": "Privacy"}, {"url": "https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": ""}, {"url": "https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page-----785c8b1e13e1--------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=---two_column_layout_sidebar----------------------------------", "anchor_text": ""}, {"url": "https://medium.com/@harvitronix?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Matt Harvey"}, {"url": "https://medium.com/@harvitronix/followers?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "2.9K Followers"}, {"url": "https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F58288d309a98&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&user=Matt+Harvey&userId=58288d309a98&source=post_page-58288d309a98--two_column_layout_sidebar-----------------------follow_profile-----------", "anchor_text": "Follow"}, {"url": "https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F41f0af8130eb&operation=register&redirect=https%3A%2F%2Fblog.coast.ai%2Fcontinuous-online-video-classification-with-tensorflow-inception-and-a-raspberry-pi-785c8b1e13e1&newsletterV3=58288d309a98&newsletterV3Id=41f0af8130eb&user=Matt+Harvey&userId=58288d309a98&source=---two_column_layout_sidebar-----------------------subscribe_user-----------", "anchor_text": ""}, {"url": "https://help.medium.com/hc/en-us?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Help"}, {"url": "https://medium.statuspage.io/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Status"}, {"url": "https://about.medium.com/creators/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Writers"}, {"url": "https://blog.medium.com/?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Blog"}, {"url": "https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Careers"}, {"url": "https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Privacy"}, {"url": "https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Terms"}, {"url": "https://medium.com/about?autoplay=1&source=---two_column_layout_sidebar----------------------------------", "anchor_text": "About"}, {"url": "https://speechify.com/medium?source=---two_column_layout_sidebar----------------------------------", "anchor_text": "Text to speech"}]}, "scrape_status": {"code": "1"}}